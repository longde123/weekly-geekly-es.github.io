<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ğŸ¾ ğŸ¤ğŸ¿ ğŸŒ» Unityä¸­çš„å…­è¾¹å½¢åœ°å›¾ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ ğŸ‰ ğŸ¤´ ğŸ‘©ğŸ¼â€ğŸš€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬1-3éƒ¨åˆ†ï¼šç½‘æ ¼ï¼Œé¢œè‰²å’Œåƒå…ƒé«˜åº¦ 

 ç¬¬4-7éƒ¨åˆ†ï¼šé¢ ç°¸ï¼Œæ²³æµå’Œé“è·¯ 

 ç¬¬8-11éƒ¨åˆ†ï¼šæ°´ï¼Œåœ°è²Œå’ŒåŸå¢™ 

 ç¬¬12-15éƒ¨åˆ†ï¼šä¿å­˜å’ŒåŠ è½½ï¼Œçº¹ç†ï¼Œè·ç¦» 

 ç¬¬16-19éƒ¨åˆ†ï¼šæ‰¾åˆ°é“è·¯ï¼Œé˜Ÿå‘˜ï¼ŒåŠ¨ç”» 

 ç¬¬20-23éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ 

 ç¬¬24-27éƒ¨åˆ†ï¼šæ°´å¾ªç¯ï¼Œä¾µèš€ï¼Œç”Ÿ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unityä¸­çš„å…­è¾¹å½¢åœ°å›¾ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427003/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1-3éƒ¨åˆ†ï¼šç½‘æ ¼ï¼Œé¢œè‰²å’Œåƒå…ƒé«˜åº¦</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬4-7éƒ¨åˆ†ï¼šé¢ ç°¸ï¼Œæ²³æµå’Œé“è·¯</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬8-11éƒ¨åˆ†ï¼šæ°´ï¼Œåœ°è²Œå’ŒåŸå¢™</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬12-15éƒ¨åˆ†ï¼šä¿å­˜å’ŒåŠ è½½ï¼Œçº¹ç†ï¼Œè·ç¦»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬16-19éƒ¨åˆ†ï¼šæ‰¾åˆ°é“è·¯ï¼Œé˜Ÿå‘˜ï¼ŒåŠ¨ç”»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬20-23éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ï¼Œåœ°å›¾ç ”ç©¶ï¼Œç¨‹åºç”Ÿæˆ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬24-27éƒ¨åˆ†ï¼šæ°´å¾ªç¯ï¼Œä¾µèš€ï¼Œç”Ÿç‰©ç¾¤è½ï¼Œåœ†æŸ±å›¾</a> <br><br><h1> ç¬¬20éƒ¨åˆ†ï¼šæˆ˜äº‰è¿·é›¾ </h1><br><ul><li> å°†å•å…ƒæ ¼æ•°æ®ä¿å­˜åœ¨çº¹ç†ä¸­ã€‚ </li><li> æ›´æ”¹æµ®é›•ç±»å‹è€Œæ— éœ€ä¸‰è§’å‰–åˆ†ã€‚ </li><li> æˆ‘ä»¬è·Ÿè¸ªå¯è§åº¦ã€‚ </li><li> ä½¿æ‰€æœ‰çœ‹ä¸è§çš„ä¸œè¥¿å˜æš—ã€‚ </li></ul><br> åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†å‘åœ°å›¾æ·»åŠ æˆ˜äº‰è¿·é›¾æ•ˆæœã€‚ <br><br> ç°åœ¨ï¼Œè¯¥ç³»åˆ—å°†åœ¨Unity 2017.1.0ä¸Šåˆ›å»ºã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/716/b6b/8a9/716b6b8a9d024dc87b2d645b5d4bdbb6.jpg"></div><br>  <i>ç°åœ¨æˆ‘ä»¬çœ‹åˆ°å¯ä»¥çœ‹åˆ°ï¼Œä¸èƒ½çœ‹åˆ°ã€‚</i> <br><a name="habracut"></a><br><h2> ç€è‰²å™¨ä¸­çš„å•å…ƒæ•°æ® </h2><br> è®¸å¤šç­–ç•¥æ¸¸æˆéƒ½ä½¿ç”¨æˆ˜äº‰è¿·é›¾æ¦‚å¿µã€‚ è¿™æ„å‘³ç€ç©å®¶çš„è§†åŠ›å—åˆ°é™åˆ¶ã€‚ ä»–åªèƒ½çœ‹åˆ°é è¿‘ä»–çš„å•ä½æˆ–æ§åˆ¶åŒºåŸŸçš„ä¸œè¥¿ã€‚ å°½ç®¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•‘æµï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚ é€šå¸¸ï¼Œçœ‹ä¸è§çš„åœ°å½¢ä¼šå˜æš—ã€‚ ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è·Ÿè¸ªå•å…ƒçš„å¯è§æ€§å¹¶è¿›è¡Œç›¸åº”æ¸²æŸ“ã€‚ <br><br> æ›´æ”¹éšè—å•å…ƒæ ¼å¤–è§‚çš„æœ€ç®€å•æ–¹æ³•æ˜¯å‘ç½‘æ ¼æ•°æ®æ·»åŠ å¯è§æ€§åº¦é‡ã€‚ ä½†æ˜¯ï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸å¼€å§‹æ–°çš„æµ®é›•ä¸‰è§’å‰–åˆ†ï¼Œä»¥æ”¹å˜å¯è§åº¦ã€‚ è¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„å†³å®šï¼Œå› ä¸ºåœ¨æ¸¸æˆè¿‡ç¨‹ä¸­å¯è§æ€§ä¸€ç›´åœ¨å˜åŒ–ã€‚ <br><br> é€šå¸¸ä½¿ç”¨åœ¨åŠé€æ˜è¡¨é¢çš„åœ°å½¢ä¸Šæ¸²æŸ“çš„æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯éƒ¨åˆ†æ©ç›–äº†ç©å®¶çœ‹ä¸è§çš„å•å…ƒã€‚ è¯¥æ–¹æ³•é€‚ç”¨äºç›¸å¯¹å¹³å¦çš„åœ°å½¢ï¼Œå¹¶å…·æœ‰æœ‰é™çš„è§†è§’ã€‚ ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„åœ°å½¢å¯ä»¥åŒ…å«é«˜åº¦ä¸åŒçš„é«˜åº¦å’Œå¯ä»¥ä»ä¸åŒè§’åº¦æŸ¥çœ‹çš„å¯¹è±¡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜åº¦è¯¦ç»†çš„ç½‘æ ¼ï¼Œä»¥åŒ¹é…åœ°å½¢çš„å½¢çŠ¶ã€‚ è¯¥æ–¹æ³•å°†æ¯”ä¸Šè¿°æœ€ç®€å•çš„æ–¹æ³•æ˜‚è´µã€‚ <br><br> å¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨ä¸æµ®é›•ç½‘æ ¼ç‰©ä½“åˆ†å¼€æ¸²æŸ“æ—¶å°†å•å…ƒçš„æ•°æ®ä¼ è¾“åˆ°ç€è‰²å™¨ã€‚ è¿™å°†ä½¿æˆ‘ä»¬ä»…æ‰§è¡Œä¸€æ¬¡ä¸‰è§’å‰–åˆ†ã€‚ å¯ä»¥ä½¿ç”¨çº¹ç†ä¼ è¾“å•å…ƒæ ¼æ•°æ®ã€‚ æ›´æ”¹çº¹ç†æ¯”å¯¹åœ°å½¢è¿›è¡Œä¸‰è§’å‰–åˆ†è¦ç®€å•å¾—å¤šã€‚ æ­¤å¤–ï¼Œæ‰§è¡Œå¤šä¸ªå…¶ä»–çº¹ç†æ ·æœ¬æ¯”æ¸²æŸ“å•ä¸ªåŠé€æ˜å±‚è¦å¿«ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨ç€è‰²å™¨æ•°ç»„æ€ä¹ˆåŠï¼Ÿ</b> <div class="spoiler_text"> æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å‘é‡æ•°ç»„å°†å•å…ƒæ ¼æ•°æ®ä¼ è¾“åˆ°ç€è‰²å™¨ã€‚ ä½†æ˜¯ï¼Œç€è‰²å™¨é˜µåˆ—æœ‰å¤§å°é™åˆ¶ï¼Œä»¥æ•°åƒä¸ªå­—èŠ‚ä¸ºå•ä½ï¼Œå¹¶ä¸”çº¹ç†å¯ä»¥åŒ…å«æ•°ç™¾ä¸‡ä¸ªåƒç´ ã€‚ ä¸ºäº†æ”¯æŒå¤§å‹åœ°å›¾ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨çº¹ç†ã€‚ </div></div><br><h3> ç»†èƒæ•°æ®ç®¡ç† </h3><br> æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æ§åˆ¶åŒ…å«å•å…ƒæ ¼æ•°æ®çš„çº¹ç†ã€‚ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„<code>HexCellShaderData</code>ç»„ä»¶æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexCellShaderData</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { Texture2D cellTexture; }</code> </pre> <br> åœ¨åˆ›å»ºæˆ–åŠ è½½æ–°åœ°å›¾æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå…·æœ‰æ­£ç¡®å°ºå¯¸çš„æ–°çº¹ç†ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•æ¥ä¸ºå…¶åˆ›å»ºçº¹ç†ã€‚ æˆ‘ä»¬ä½¿ç”¨æ²¡æœ‰Mipçº¹ç†å’Œçº¿æ€§è‰²å½©ç©ºé—´çš„RGBAçº¹ç†ã€‚ æˆ‘ä»¬ä¸éœ€è¦æ··åˆå•å…ƒæ ¼æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ç‚¹è¿‡æ»¤ã€‚ æ­¤å¤–ï¼Œæ•°æ®ä¸åº”æŠ˜å ã€‚ çº¹ç†ä¸­çš„æ¯ä¸ªåƒç´ å°†åŒ…å«æ¥è‡ªä¸€ä¸ªå•å…ƒçš„æ•°æ®ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( x, z, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">çº¹ç†å¤§å°æ˜¯å¦åº”ä¸åœ°å›¾å¤§å°åŒ¹é…ï¼Ÿ</b> <div class="spoiler_text"> ä¸ï¼Œå®ƒåªéœ€è¦æœ‰è¶³å¤Ÿçš„åƒç´ æ¥å®¹çº³æ‰€æœ‰å•å…ƒã€‚ ä¸åœ°å›¾çš„å¤§å°å®Œå…¨åŒ¹é…æ—¶ï¼Œå¾ˆå¯èƒ½ä¼šåˆ›å»ºå¤§å°ä¸æ˜¯2çš„å¹‚ï¼ˆé2çš„å¹‚ï¼ŒNPOTï¼‰çš„çº¹ç†ï¼Œå¹¶ä¸”è¿™ç§çº¹ç†æ ¼å¼ä¸æ˜¯æœ€æœ‰æ•ˆçš„ã€‚ å°½ç®¡æˆ‘ä»¬å¯ä»¥å°†ä»£ç é…ç½®ä¸ºä½¿ç”¨2çš„å¹‚çš„çº¹ç†è¿›è¡Œå¤„ç†ï¼Œä½†è¿™æ˜¯æ¬¡è¦çš„ä¼˜åŒ–ï¼Œè¿™ä½¿å¯¹å•å…ƒæ•°æ®çš„è®¿é—®å˜å¾—å¤æ‚ã€‚ </div></div><br> å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸å¿…æ¯æ¬¡åˆ›å»ºæ–°åœ°å›¾æ—¶éƒ½åˆ›å»ºæ–°çº¹ç†ã€‚ å¦‚æœçº¹ç†å·²ç»å­˜åœ¨ï¼Œåˆ™è¶³ä»¥è°ƒæ•´å…¶å¤§å°ã€‚ æˆ‘ä»¬ç”šè‡³ä¸éœ€è¦æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å·²ç»å…·æœ‰åˆé€‚çš„å°ºå¯¸ï¼Œå› ä¸º<code>Texture2D.Resize</code>è¶³å¤Ÿèªæ˜åœ°ä¸ºæˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellTexture) { cellTexture.Resize(x, z); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( cellCountX, cellCountZ, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; } }</code> </pre> <br> æˆ‘ä»¬ä½¿ç”¨é¢œè‰²ç¼“å†²åŒºå¹¶ä¸€æ¬¡åº”ç”¨æ‰€æœ‰å•å…ƒçš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡åº”ç”¨ä¸€ä¸ªåƒç´ çš„å•å…ƒæ•°æ®ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>Color32</code>æ•°ç»„ã€‚ å¦‚æœ‰å¿…è¦ï¼Œæˆ‘ä»¬å°†åœ¨<code>Initialize</code>çš„æœ«å°¾åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å®ä¾‹ã€‚ å¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªæ­£ç¡®å¤§å°çš„æ•°ç»„ã€‚ ç„¶åæˆ‘ä»¬æ¸…é™¤å…¶å†…å®¹ã€‚ <br><br><pre> <code class="cs hljs"> Texture2D cellTexture; Color32[] cellTextureData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellTextureData == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || cellTextureData.Length != x * z) { cellTextureData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color32[x * z]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellTextureData.Length; i++) { cellTextureData[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color32(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä»€ä¹ˆæ˜¯color32ï¼Ÿ</b> <div class="spoiler_text"> æ ‡å‡†çš„æœªå‹ç¼©RGBAçº¹ç†åŒ…å«å››ä¸ªå­—èŠ‚çš„åƒç´ ã€‚ å››ä¸ªé¢œè‰²é€šé“çš„æ¯ä¸ªæ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼Œå³å®ƒä»¬å…·æœ‰256ä¸ªå¯èƒ½çš„å€¼ã€‚ ä½¿ç”¨Unity <code>Color</code>ç»“æ„æ—¶ï¼Œå…¶åœ¨åŒºé—´0â€“1ä¸­çš„æµ®ç‚¹åˆ†é‡å°†è½¬æ¢ä¸ºåœ¨åŒºé—´0â€“255ä¸­çš„å­—èŠ‚ã€‚ é‡‡æ ·æ—¶ï¼ŒGPUæ‰§è¡Œé€†å˜æ¢ã€‚ <br><br>  <code>Color32</code>ç»“æ„ç›´æ¥ä¸å­—èŠ‚ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤å®ƒä»¬å ç”¨çš„ç©ºé—´æ›´å°‘ï¼Œå¹¶ä¸”ä¸éœ€è¦è½¬æ¢ï¼Œä»è€Œæé«˜äº†ä½¿ç”¨æ•ˆç‡ã€‚ ç”±äºæˆ‘ä»¬å­˜å‚¨çš„æ˜¯å•å…ƒæ ¼æ•°æ®è€Œä¸æ˜¯é¢œè‰²ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨åŸå§‹çº¹ç†æ•°æ®è€Œä¸æ˜¯ä½¿ç”¨<code>Color</code>æ›´åŠ åˆä¹é€»è¾‘ã€‚ </div></div><br>  <code>HexGrid</code>åº”è¯¥å¤„ç†ç€è‰²å™¨ä¸­è¿™äº›å•å…ƒçš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å‘å…¶æ·»åŠ ä¸€ä¸ª<code>cellShaderData</code>å­—æ®µï¼Œå¹¶åœ¨<code>Awake</code>åˆ›å»ºä¸€ä¸ªç»„ä»¶ã€‚ <br><br><pre> <code class="cs hljs"> HexCellShaderData cellShaderData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); HexUnit.unitPrefab = unitPrefab; cellShaderData = gameObject.AddComponent&lt;HexCellShaderData&gt;(); CreateMap(cellCountX, cellCountZ); }</code> </pre> <br> åˆ›å»ºæ–°åœ°å›¾æ—¶ï¼Œè¿˜åº”<code>cellShaderData</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ cellCountX = x; cellCountZ = z; chunkCountX = cellCountX / HexMetrics.chunkSizeX; chunkCountZ = cellCountZ / HexMetrics.chunkSizeZ; cellShaderData.Initialize(cellCountX, cellCountZ); CreateChunks(); CreateCells(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3> ç¼–è¾‘å•å…ƒæ ¼æ•°æ® </h3><br> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æ›´æ”¹å•å…ƒæ ¼çš„å±æ€§æ—¶ï¼Œæœ‰å¿…è¦æ›´æ–°ä¸€ä¸ªæˆ–å‡ ä¸ªç‰‡æ®µï¼Œä½†æ˜¯ç°åœ¨å¯èƒ½æœ‰å¿…è¦æ›´æ–°å•å…ƒæ ¼çš„æ•°æ®ã€‚ è¿™æ„å‘³ç€å•å…ƒå¿…é¡»å…·æœ‰æŒ‡å‘ç€è‰²å™¨ä¸­å•å…ƒæ•°æ®çš„é“¾æ¥ã€‚ ä¸ºæ­¤ï¼Œå‘<code>HexCell</code>æ·»åŠ ä¸€ä¸ªå±æ€§ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexCellShaderData ShaderData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br> åœ¨<code>HexGrid.CreateCell</code>æˆ‘ä»¬<code>HexGrid.CreateCell</code>ä¸ºè¯¥å±æ€§åˆ†é…ä¸€ä¸ªç€è‰²å™¨æ•°æ®ç»„ä»¶ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { â€¦ HexCell cell = cells[i] = Instantiate&lt;HexCell&gt;(cellPrefab); cell.transform.localPosition = position; cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.ShaderData = cellShaderData; â€¦ }</code> </pre> <br> ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿å•å…ƒæ›´æ–°å…¶ç€è‰²å™¨æ•°æ®ã€‚ è™½ç„¶æˆ‘ä»¬ä¸è·Ÿè¸ªå¯è§æ€§ï¼Œä½†å¯ä»¥å°†ç€è‰²å™¨æ•°æ®ç”¨äºå…¶ä»–ç”¨é€”ã€‚ å•å…ƒçš„æµ®é›•ç±»å‹ç¡®å®šç”¨äºæ¸²æŸ“å®ƒçš„çº¹ç†ã€‚ å®ƒä¸ä¼šå½±å“åƒå…ƒçš„å‡ ä½•å½¢çŠ¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†é«˜ç¨‹ç±»å‹ç´¢å¼•å­˜å‚¨åœ¨åƒå…ƒæ•°æ®ä¸­ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨ç½‘æ ¼æ•°æ®ä¸­ã€‚ è¿™å°†ä½¿æˆ‘ä»¬åœ¨æ›´æ”¹å•å…ƒæ ¼æ‹“æ‰‘çš„ç±»å‹æ—¶æ— éœ€è¿›è¡Œä¸‰è§’å‰–åˆ†ã€‚ <br><br> å‘<code>RefreshTerrain</code>æ·»åŠ <code>HexCellShaderData</code>æ–¹æ³•å¯ç®€åŒ–ç‰¹å®šå•å…ƒæ ¼çš„æ­¤ä»»åŠ¡ã€‚ è®©æˆ‘ä»¬æš‚æ—¶å°†æ­¤æ–¹æ³•ç•™ç©ºã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br> æ›´æ”¹<code>HexCell.TerrainTypeIndex</code>ä»¥ä¾¿å®ƒ<code>HexCell.TerrainTypeIndex</code>æ­¤æ–¹æ³•ï¼Œå¹¶ä¸”ä¸æŒ‰é¡ºåºæ›´æ–°ç‰‡æ®µã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TerrainTypeIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> terrainTypeIndex; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (terrainTypeIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { terrainTypeIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Refresh(); ShaderData.RefreshTerrain(this); } } }</span></span></code> </pre> <br> æ”¶åˆ°å•å…ƒæ ¼çš„åœ°å½¢ç±»å‹åï¼Œæˆ‘ä»¬è¿˜å°†åœ¨<code>HexCell.Load</code>ä¸­å°†å…¶<code>HexCell.Load</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader</span></span></span><span class="hljs-function">)</span></span> { terrainTypeIndex = reader.ReadByte(); ShaderData.RefreshTerrain(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); elevation = reader.ReadByte(); RefreshPosition(); â€¦ }</code> </pre> <br><h3> ç»†èƒæŒ‡æ•° </h3><br> è¦æ›´æ”¹è¿™äº›å•å…ƒæ ¼ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å•å…ƒæ ¼çš„ç´¢å¼•ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†<code>Index</code>å±æ€§æ·»åŠ åˆ°<code>HexCell</code> ã€‚ å®ƒå°†æŒ‡ç¤ºè´´å›¾çš„å•å…ƒæ ¼åˆ—è¡¨ä¸­è¯¥å•å…ƒæ ¼çš„ç´¢å¼•ï¼Œè¯¥ç´¢å¼•ä¸å…¶åœ¨ç€è‰²å™¨ä¸­ç»™å®šå•å…ƒæ ¼ä¸­çš„ç´¢å¼•ç›¸å¯¹åº”ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Index { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br> è¯¥ç´¢å¼•å·²ç»åœ¨<code>HexGrid.CreateCell</code> ï¼Œå› æ­¤åªéœ€å°†å…¶åˆ†é…ç»™åˆ›å»ºçš„å•å…ƒæ ¼å³å¯ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { â€¦ cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.Index = i; cell.ShaderData = cellShaderData; â€¦ }</code> </pre> <br> ç°åœ¨<code>HexCellShaderData.RefreshTerrain</code>å¯ä»¥ä½¿ç”¨æ­¤ç´¢å¼•æ¥æŒ‡å®šå•å…ƒæ ¼æ•°æ®ã€‚ é€šè¿‡ç®€å•åœ°å°†ç±»å‹è½¬æ¢ä¸ºå­—èŠ‚ï¼Œè®©æˆ‘ä»¬å°†é«˜ç¨‹ç±»å‹ç´¢å¼•ä¿å­˜åœ¨å…¶åƒç´ çš„alphaåˆ†é‡ä¸­ã€‚ è¿™å°†æ”¯æŒå¤šè¾¾256ç§åœ°å½¢ï¼Œå¯¹æˆ‘ä»¬è€Œè¨€å·²ç»è¶³å¤Ÿã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cellTextureData[cell.Index].a = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)cell.TerrainTypeIndex; }</code> </pre> <br> è¦å°†æ•°æ®åº”ç”¨äºçº¹ç†å¹¶å°†å…¶ä¼ é€’ç»™GPUï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨<code>Texture2D.SetPixels32</code> ï¼Œç„¶åè°ƒç”¨<code>Texture2D.Apply</code> ã€‚ ä¸ç‰‡æ®µçš„æƒ…å†µä¸€æ ·ï¼Œæˆ‘ä»¬å°†è¿™äº›æ“ä½œæ¨è¿Ÿåˆ°<code>LateUpdate</code>ä»¥ä½¿å®ƒä»¬æ¯å¸§æœ€å¤šå¯ä»¥æ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä¸æ›´æ”¹çš„å•å…ƒæ ¼æ•°é‡æ— å…³ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cellTextureData[cell.Index].a = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)cell.TerrainTypeIndex; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { cellTexture.SetPixels32(cellTextureData); cellTexture.Apply(); enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br> ä¸ºç¡®ä¿åœ¨åˆ›å»ºæ–°æ˜ å°„åå°†æ›´æ–°æ•°æ®ï¼Œè¯·åœ¨åˆå§‹åŒ–åå¯ç”¨ç»„ä»¶ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3> ä¸‰è§’åŒ–ç»†èƒæŒ‡æ•° </h3><br> ç”±äºæˆ‘ä»¬ç°åœ¨å°†é«˜ç¨‹ç±»å‹ç´¢å¼•å­˜å‚¨åœ¨è¿™äº›å•å…ƒæ ¼ä¸­ï¼Œå› æ­¤ä¸å†éœ€è¦åœ¨ä¸‰è§’æµ‹é‡è¿‡ç¨‹ä¸­åŒ…æ‹¬å®ƒä»¬ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†ä½¿ç”¨å•å…ƒæ•°æ®ï¼Œç€è‰²å™¨å¿…é¡»çŸ¥é“è¦ä½¿ç”¨å“ªäº›ç´¢å¼•ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦å°†å•å…ƒæ ¼ç´¢å¼•å­˜å‚¨åœ¨ç½‘æ ¼æ•°æ®ä¸­ï¼Œä»¥æ›¿æ¢é«˜ç¨‹ç±»å‹ç´¢å¼•ã€‚ å¦å¤–ï¼Œä½¿ç”¨è¿™äº›åƒå…ƒæ—¶ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ç½‘æ ¼çš„é¢œè‰²é€šé“æ¥æ··åˆåƒå…ƒã€‚ <br><br> æˆ‘ä»¬<code>useTerrainTypes</code> <code>HexMesh</code>è¿‡æ—¶çš„å…¬å…±å­—æ®µ<code>useColors</code>å’Œ<code>useTerrainTypes</code> ã€‚ ç”¨ä¸€ä¸ª<code>useCellData</code>å­—æ®µæ›¿æ¢å®ƒä»¬ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public bool useCollider, useColors, useUVCoordinates, useUV2Coordinates; // public bool useTerrainTypes; public bool useCollider, useCellData, useUVCoordinates, useUV2Coordinates;</span></span></code> </pre><br> æˆ‘ä»¬å°†<code>terrainTypes</code>åˆ—è¡¨çš„é‡å‘½åé‡æ„ä¸º<code>cellIndices</code> ã€‚ è®©æˆ‘ä»¬ä¹Ÿå°†<code>colors</code>é‡æ„ä¸º<code>cellWeights</code>è¿™ä¸ªåç§°ä¼šæ›´å¥½ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// [NonSerialized] List&lt;Vector3&gt; vertices, terrainTypes; // [NonSerialized] List&lt;Color&gt; colors; [NonSerialized] List&lt;Vector3&gt; vertices, cellIndices; [NonSerialized] List&lt;Color&gt; cellWeights; [NonSerialized] List&lt;Vector2&gt; uvs, uv2s; [NonSerialized] List&lt;int&gt; triangles;</span></span></code> </pre><br> æ›´æ”¹<code>Clear</code>ä»¥ä¾¿åœ¨ä½¿ç”¨è¿™äº›å•å…ƒæ ¼æ—¶å°†ä¸¤ä¸ªåˆ—è¡¨æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯åˆ†å¼€ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCellData) { cellWeights = ListPool&lt;Color&gt;.Get(); cellIndices = ListPool&lt;Vector3&gt;.Get(); } <span class="hljs-comment"><span class="hljs-comment">// if (useColors) { // colors = ListPool&lt;Color&gt;.Get(); // } if (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } if (useUV2Coordinates) { uv2s = ListPool&lt;Vector2&gt;.Get(); } // if (useTerrainTypes) { // terrainTypes = ListPool&lt;Vector3&gt;.Get(); // } triangles = ListPool&lt;int&gt;.Get(); }</span></span></code> </pre> <br> åœ¨<code>Apply</code>æ‰§è¡Œç›¸åŒçš„åˆ†ç»„ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCellData) { hexMesh.SetColors(cellWeights); ListPool&lt;Color&gt;.Add(cellWeights); hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">2</span></span>, cellIndices); ListPool&lt;Vector3&gt;.Add(cellIndices); } <span class="hljs-comment"><span class="hljs-comment">// if (useColors) { // hexMesh.SetColors(colors); // ListPool&lt;Color&gt;.Add(colors); // } if (useUVCoordinates) { hexMesh.SetUVs(0, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } if (useUV2Coordinates) { hexMesh.SetUVs(1, uv2s); ListPool&lt;Vector2&gt;.Add(uv2s); } // if (useTerrainTypes) { // hexMesh.SetUVs(2, terrainTypes); // ListPool&lt;Vector3&gt;.Add(terrainTypes); // } hexMesh.SetTriangles(triangles, 0); ListPool&lt;int&gt;.Add(triangles); hexMesh.RecalculateNormals(); if (useCollider) { meshCollider.sharedMesh = hexMesh; } }</span></span></code> </pre> <br> è®©æˆ‘ä»¬åˆ é™¤æ‰€æœ‰çš„<code>AddTriangleColor</code>å’Œ<code>AddTriangleTerrainTypes</code> ã€‚ å°†å®ƒä»¬æ›¿æ¢ä¸ºé€‚å½“çš„<code>AddTriangleCellData</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸€æ¬¡æ·»åŠ ç´¢å¼•å’Œæƒé‡ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 indices, Color weights1, Color weights2, Color weights3 </span></span></span><span class="hljs-function">)</span></span> { cellIndices.Add(indices); cellIndices.Add(indices); cellIndices.Add(indices); cellWeights.Add(weights1); cellWeights.Add(weights2); cellWeights.Add(weights3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 indices, Color weights</span></span></span><span class="hljs-function">)</span></span> { AddTriangleCellData(indices, weights, weights, weights); }</code> </pre> <br> åœ¨é€‚å½“çš„<code>AddQuad</code>æ–¹æ³•ä¸­æ‰§è¡Œç›¸åŒçš„<code>AddQuad</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 indices, Color weights1, Color weights2, Color weights3, Color weights4 </span></span></span><span class="hljs-function">)</span></span> { cellIndices.Add(indices); cellIndices.Add(indices); cellIndices.Add(indices); cellIndices.Add(indices); cellWeights.Add(weights1); cellWeights.Add(weights2); cellWeights.Add(weights3); cellWeights.Add(weights4); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 indices, Color weights1, Color weights2 </span></span></span><span class="hljs-function">)</span></span> { AddQuadCellData(indices, weights1, weights1, weights2, weights2); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 indices, Color weights</span></span></span><span class="hljs-function">)</span></span> { AddQuadCellData(indices, weights, weights, weights, weights); }</code> </pre> <br><h3>  HexGridChunké‡æ„ </h3><br> åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬åœ¨<code>HexGridChunk</code>ä¸­é‡åˆ°äº†è®¸å¤šéœ€è¦<code>HexGridChunk</code>çš„ç¼–è¯‘å™¨é”™è¯¯ã€‚ ä½†æ˜¯é¦–å…ˆï¼Œä¸ºäº†ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬å°†é™æ€é¢œè‰²é‡æ„ä¸ºé‡ç‰©ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color weights1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color weights2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color weights3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br> è®©æˆ‘ä»¬ä»ä¿®å¤<code>TriangulateEdgeFan</code>å¼€å§‹ã€‚ ä»–æ›¾ç»éœ€è¦ä¸€ä¸ªç±»å‹ï¼Œä½†æ˜¯ç°åœ¨ä»–éœ€è¦ä¸€ä¸ªå•å…ƒæ ¼ç´¢å¼•ã€‚  <code>AddTriangleColor</code>ç›¸åº”çš„<code>AddTriangleCellData</code>ä»£ç <code>AddTriangleColor</code>å’Œ<code>AddTriangleCellData</code>ä»£ç ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeFan</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, EdgeVertices edge, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { terrain.AddTriangle(center, edge.v1, edge.v2); terrain.AddTriangle(center, edge.v2, edge.v3); terrain.AddTriangle(center, edge.v3, edge.v4); terrain.AddTriangle(center, edge.v4, edge.v5); Vector3 indices; indices.x = indices.y = indices.z = index; terrain.AddTriangleCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1); // terrain.AddTriangleColor(weights1); // terrain.AddTriangleColor(weights1); // terrain.AddTriangleColor(weights1); // Vector3 types; // types.x = types.y = types.z = type; // terrain.AddTriangleTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); }</span></span></code> </pre> <br> åœ¨å¾ˆå¤šåœ°æ–¹éƒ½è°ƒç”¨æ­¤æ–¹æ³•ã€‚ è®©æˆ‘ä»¬éå†å®ƒä»¬ï¼Œç¡®ä¿å°†å•å…ƒæ ¼çš„ç´¢å¼•è½¬ç§»åˆ°é‚£é‡Œï¼Œè€Œä¸æ˜¯åœ°å½¢çš„ç±»å‹ã€‚ <br><br><pre> <code class="cs hljs"> TriangulateEdgeFan(center, e, cell.Index);</code> </pre> <br> æ¥ä¸‹æ¥æ˜¯<code>TriangulateEdgeStrip</code> ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚ è¿˜å°†å‚æ•°åç§°<code>c1</code>å’Œ<code>c2</code>é‡æ„ä¸º<code>w1</code>å’Œ<code>w2</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color w1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index1, EdgeVertices e2, Color w2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { terrain.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); terrain.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); terrain.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); terrain.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); Vector3 indices; indices.x = indices.z = index1; indices.y = index2; terrain.AddQuadCellData(indices, w1, w2); terrain.AddQuadCellData(indices, w1, w2); terrain.AddQuadCellData(indices, w1, w2); terrain.AddQuadCellData(indices, w1, w2); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddQuadColor(c1, c2); // terrain.AddQuadColor(c1, c2); // terrain.AddQuadColor(c1, c2); // terrain.AddQuadColor(c1, c2); // Vector3 types; // types.x = types.z = type1; // types.y = type2; // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); if (hasRoad) { TriangulateRoadSegment(e1.v2, e1.v3, e1.v4, e2.v2, e2.v3, e2.v4); } }</span></span></code> </pre> <br> æ›´æ”¹å¯¹æ­¤æ–¹æ³•çš„è°ƒç”¨ï¼Œä»¥ä¾¿å°†å•å…ƒæ ¼ç´¢å¼•ä¼ é€’ç»™ä»–ä»¬ã€‚ æˆ‘ä»¬è¿˜ä¿æŒå˜é‡åç§°çš„ä¸€è‡´æ€§ã€‚ <br><br><pre> <code class="cs hljs"> TriangulateEdgeStrip( m, weights1, cell.Index, e, weights1, cell.Index ); â€¦ TriangulateEdgeStrip( e1, weights1, cell.Index, e2, weights2, neighbor.Index, hasRoad ); â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices begin, HexCell beginCell, EdgeVertices end, HexCell endCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e2 = EdgeVertices.TerraceLerp(begin, end, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color w2 = HexMetrics.TerraceLerp(weights1, weights2, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> i1 = beginCell.Index; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> i2 = endCell.Index; TriangulateEdgeStrip(begin, weights1, i1, e2, w2, i2, hasRoad); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { EdgeVertices e1 = e2; Color w1 = w2; e2 = EdgeVertices.TerraceLerp(begin, end, i); w2 = HexMetrics.TerraceLerp(weights1, weights2, i); TriangulateEdgeStrip(e1, w1, i1, e2, w2, i2, hasRoad); } TriangulateEdgeStrip(e2, w2, i1, end, weights2, i2, hasRoad); }</code> </pre> <br> ç°åœ¨æˆ‘ä»¬ç»§ç»­è§’åº¦æ–¹æ³•ã€‚ è¿™äº›æ›´æ”¹å¾ˆç®€å•ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨å¤§é‡ä»£ç è¿›è¡Œã€‚ é¦–å…ˆæ˜¯<code>TriangulateCorner</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 bottom, HexCell bottomCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { terrain.AddTriangle(bottom, left, right); Vector3 indices; indices.x = bottomCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; terrain.AddTriangleCellData(indices, weights1, weights2, weights3); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1, weights2, weights3); // Vector3 types; // types.x = bottomCell.TerrainTypeIndex; // types.y = leftCell.TerrainTypeIndex; // types.z = rightCell.TerrainTypeIndex; // terrain.AddTriangleTerrainTypes(types); } features.AddWall(bottom, bottomCell, left, leftCell, right, rightCell); }</span></span></code> </pre> <br> æ¥åˆ°<code>TriangulateCornerTerraces</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCornerTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { Vector3 v3 = HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>); Vector3 v4 = HexMetrics.TerraceLerp(begin, right, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color w3 = HexMetrics.TerraceLerp(weights1, weights2, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color w4 = HexMetrics.TerraceLerp(weights1, weights3, <span class="hljs-number"><span class="hljs-number">1</span></span>); Vector3 indices; indices.x = beginCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; terrain.AddTriangle(begin, v3, v4); terrain.AddTriangleCellData(indices, weights1, w3, w4); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1, w3, w4); // terrain.AddTriangleTerrainTypes(indices); for (int i = 2; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v3; Vector3 v2 = v4; Color w1 = w3; Color w2 = w4; v3 = HexMetrics.TerraceLerp(begin, left, i); v4 = HexMetrics.TerraceLerp(begin, right, i); w3 = HexMetrics.TerraceLerp(weights1, weights2, i); w4 = HexMetrics.TerraceLerp(weights1, weights3, i); terrain.AddQuad(v1, v2, v3, v4); terrain.AddQuadCellData(indices, w1, w2, w3, w4); // terrain.AddQuadColor(w1, w2, w3, w4); // terrain.AddQuadTerrainTypes(indices); } terrain.AddQuad(v3, v4, left, right); terrain.AddQuadCellData(indices, w3, w4, weights2, weights3); // terrain.AddQuadColor(w3, w4, weights2, weights3); // terrain.AddQuadTerrainTypes(indices); }</span></span></code> </pre> <br> ç„¶ååœ¨<code>TriangulateCornerTerracesCliff</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCornerTerracesCliff</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (rightCell.Elevation - beginCell.Elevation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { b = -b; } Vector3 boundary = Vector3.Lerp( HexMetrics.Perturb(begin), HexMetrics.Perturb(right), b ); Color boundaryWeights = Color.Lerp(weights1, weights3, b); Vector3 indices; indices.x = beginCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; TriangulateBoundaryTriangle( begin, weights1, left, weights2, boundary, boundaryWeights, indices ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.GetEdgeType(rightCell) == HexEdgeType.Slope) { TriangulateBoundaryTriangle( left, weights2, right, weights3, boundary, boundaryWeights, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { terrain.AddTriangleUnperturbed( HexMetrics.Perturb(left), HexMetrics.Perturb(right), boundary ); terrain.AddTriangleCellData( indices, weights2, weights3, boundaryWeights ); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights2, weights3, boundaryColor); // terrain.AddTriangleTerrainTypes(indices); } }</span></span></code> </pre> <br> ä¸<code>TriangulateCornerCliffTerraces</code>æœ‰æ‰€ä¸åŒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCornerCliffTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (leftCell.Elevation - beginCell.Elevation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { b = -b; } Vector3 boundary = Vector3.Lerp( HexMetrics.Perturb(begin), HexMetrics.Perturb(left), b ); Color boundaryWeights = Color.Lerp(weights1, weights2, b); Vector3 indices; indices.x = beginCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; TriangulateBoundaryTriangle( right, weights3, begin, weights1, boundary, boundaryWeights, indices ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.GetEdgeType(rightCell) == HexEdgeType.Slope) { TriangulateBoundaryTriangle( left, weights2, right, weights3, boundary, boundaryWeights, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { terrain.AddTriangleUnperturbed( HexMetrics.Perturb(left), HexMetrics.Perturb(right), boundary ); terrain.AddTriangleCellData( indices, weights2, weights3, boundaryWeights ); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights2, weights3, boundaryWeights); // terrain.AddTriangleTerrainTypes(indices); } }</span></span></code> </pre> <br> å‰ä¸¤ç§æ–¹æ³•ä½¿ç”¨<code>TriangulateBoundaryTriangle</code> ï¼Œè¿™ä¹Ÿéœ€è¦æ›´æ–°ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateBoundaryTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, Color beginWeights, Vector3 left, Color leftWeights, Vector3 boundary, Color boundaryWeights, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { Vector3 v2 = HexMetrics.Perturb(HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>)); Color w2 = HexMetrics.TerraceLerp(beginWeights, leftWeights, <span class="hljs-number"><span class="hljs-number">1</span></span>); terrain.AddTriangleUnperturbed(HexMetrics.Perturb(begin), v2, boundary); terrain.AddTriangleCellData(indices, beginWeights, w2, boundaryWeights); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(beginColor, c2, boundaryColor); // terrain.AddTriangleTerrainTypes(types); for (int i = 2; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v2; Color w1 = w2; v2 = HexMetrics.Perturb(HexMetrics.TerraceLerp(begin, left, i)); w2 = HexMetrics.TerraceLerp(beginWeights, leftWeights, i); terrain.AddTriangleUnperturbed(v1, v2, boundary); terrain.AddTriangleCellData(indices, w1, w2, boundaryWeights); // terrain.AddTriangleColor(c1, c2, boundaryColor); // terrain.AddTriangleTerrainTypes(types); } terrain.AddTriangleUnperturbed(v2, HexMetrics.Perturb(left), boundary); terrain.AddTriangleCellData(indices, w2, leftWeights, boundaryWeights); // terrain.AddTriangleColor(c2, leftColor, boundaryColor); // terrain.AddTriangleTerrainTypes(types); }</span></span></code> </pre> <br> æœ€åéœ€è¦æ›´æ”¹çš„æ–¹æ³•æ˜¯<code>TriangulateWithRiver</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ terrain.AddTriangle(centerL, m.v1, m.v2); terrain.AddQuad(centerL, center, m.v2, m.v3); terrain.AddQuad(center, centerR, m.v3, m.v4); terrain.AddTriangle(centerR, m.v4, m.v5); Vector3 indices; indices.x = indices.y = indices.z = cell.Index; terrain.AddTriangleCellData(indices, weights1); terrain.AddQuadCellData(indices, weights1); terrain.AddQuadCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1); // terrain.AddQuadColor(weights1); // terrain.AddQuadColor(weights1); // terrain.AddTriangleColor(weights1); // Vector3 types; // types.x = types.y = types.z = cell.TerrainTypeIndex; // terrain.AddTriangleTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); â€¦ }</span></span></code> </pre> <br> ä¸ºäº†ä½¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å‡ºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å•å…ƒæ•°æ®ä½œä¸ºé¢„åˆ¶ç¢ç‰‡æµ®é›•çš„å­å…ƒç´ ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/919/b8c/731/919b8c7317b2aa3c06f1077eef27fe96.png"></div><br>  <i>æ•‘æµä½¿ç”¨å•å…ƒæ ¼æ•°æ®ã€‚</i> <br><br> åœ¨æ­¤é˜¶æ®µï¼Œç½‘æ ¼åŒ…å«å•å…ƒç´¢å¼•è€Œä¸æ˜¯é«˜ç¨‹ç±»å‹ç´¢å¼•ã€‚ ç”±äºé«˜ç¨‹ç€è‰²å™¨ä»å°†å®ƒä»¬è§£é‡Šä¸ºé«˜ç¨‹ç´¢å¼•ï¼Œå› æ­¤æˆ‘ä»¬å°†çœ‹åˆ°ç¬¬ä¸€ä¸ªåƒå…ƒæ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªçº¹ç†æ¸²æŸ“çš„ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°åˆ°è¾¾æœ€åä¸€ä¸ªæµ®é›•çº¹ç†ä¸ºæ­¢ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/a23/ce8/8a5a23ce850af789e759dde6879f93eb.png"></div><br>  <i>ä½¿ç”¨åƒå…ƒç´¢å¼•ä½œä¸ºé«˜ç¨‹çº¹ç†ç´¢å¼•ã€‚</i> <br><br><div class="spoiler">  <b class="spoiler_title">æˆ‘æ— æ³•ä½¿é‡æ„ä»£ç æ­£å¸¸å·¥ä½œã€‚</b>  <b class="spoiler_title">æˆ‘åšé”™äº†ä»€ä¹ˆï¼Ÿ</b> <div class="spoiler_text"> ä¸€æ¬¡ï¼Œæˆ‘ä»¬æ›´æ”¹äº†å¤§é‡çš„ä¸‰è§’å‰–åˆ†ä»£ç ï¼Œå› æ­¤å¾ˆå¯èƒ½å‡ºç°é”™è¯¯æˆ–ç–å¿½ã€‚ å¦‚æœæ‰¾ä¸åˆ°é”™è¯¯ï¼Œè¯·å°è¯•ä»æœ¬èŠ‚ä¸‹è½½ç¨‹åºåŒ…å¹¶æå–é€‚å½“çš„æ–‡ä»¶ã€‚ æ‚¨å¯ä»¥å°†å®ƒä»¬å¯¼å…¥ä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ä¸­ï¼Œå¹¶ä¸è‡ªå·±çš„ä»£ç è¿›è¡Œæ¯”è¾ƒã€‚ </div></div><br><h3> å°†å•å…ƒæ ¼æ•°æ®ä¼ è¾“åˆ°ç€è‰²å™¨ </h3><br> è¦ä½¿ç”¨è¿™äº›å•å…ƒï¼Œåœ°å½¢ç€è‰²å™¨å¿…é¡»å¯ä»¥è®¿é—®å®ƒä»¬ã€‚ å¯ä»¥é€šè¿‡shaderå±æ€§å®ç°ã€‚ è¿™å°†éœ€è¦<code>HexCellShaderData</code>è®¾ç½®æµ®é›•çš„æè´¨å±æ€§ã€‚ æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿æ‰€æœ‰ç€è‰²å™¨å…¨å±€å¯è§è¿™äº›å•å…ƒçš„çº¹ç†ã€‚ è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å¤šä¸ªç€è‰²å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ <br><br> åˆ›å»ºå•å…ƒçº¹ç†åï¼Œè°ƒç”¨é™æ€<code>Shader.SetGlobalTexture</code>æ–¹æ³•ä»¥ä½¿å…¶å…¨å±€å¯è§ä¸º<em>_HexCellData</em> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( x, z, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; Shader.SetGlobalTexture(<span class="hljs-string"><span class="hljs-string">"_HexCellData"</span></span>, cellTexture); } â€¦ }</code> </pre> <br> ä½¿ç”¨shaderå±æ€§æ—¶ï¼ŒUnityé€šè¿‡<em>textureName_TexelSize</em>å˜é‡ä½¿çº¹ç†å¤§å°å¯ç”¨äºç€è‰²å™¨ã€‚ è¿™æ˜¯ä¸€ä¸ªå››åˆ†é‡çŸ¢é‡åŒ–å™¨ï¼ŒåŒ…å«ä¸å®½åº¦å’Œé«˜åº¦ä»¥åŠå®½åº¦å’Œé«˜åº¦æœ¬èº«ç›¸åçš„å€¼ã€‚ ä½†æ˜¯åœ¨è®¾ç½®å…¨å±€çº¹ç†æ—¶ï¼Œä¸ä¼šæ‰§è¡Œæ­¤æ“ä½œã€‚ å› æ­¤ï¼Œåœ¨åˆ›å»ºæˆ–è°ƒæ•´çº¹ç†å¤§å°ä¹‹åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>Shader.SetGlobalVector</code>è‡ªå·±è¿›è¡Œå¤„ç†ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( x, z, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; Shader.SetGlobalTexture(<span class="hljs-string"><span class="hljs-string">"_HexCellData"</span></span>, cellTexture); } Shader.SetGlobalVector( <span class="hljs-string"><span class="hljs-string">"_HexCellData_TexelSize"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(<span class="hljs-number"><span class="hljs-number">1f</span></span> / x, <span class="hljs-number"><span class="hljs-number">1f</span></span> / z, x, z) );</code> </pre> <br><h3> ç€è‰²å™¨æ•°æ®è®¿é—® </h3><br> åœ¨åä¸º<em>HexCellData</em>çš„æè´¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç€è‰²å™¨åŒ…å«æ–‡ä»¶ã€‚ åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰å˜é‡ä»¥è·å–æœ‰å…³è¿™äº›å•å…ƒçš„çº¹ç†å’Œå¤§å°çš„ä¿¡æ¯ã€‚ æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°æ¥è·å–ç»™å®šé¡¶ç‚¹ç½‘æ ¼æ•°æ®çš„åƒå…ƒæ•°æ®ã€‚ <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sampler2D</span></span> _HexCellData; <span class="hljs-attribute"><span class="hljs-attribute">float4</span></span> _HexCellData_TexelSize; <span class="hljs-attribute"><span class="hljs-attribute">float4</span></span> GetCellData (appdata_full v) { }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a64/604/dbc/a64604dbc7d3ad5ff1e1578bd0c84eec.png"></div><br>  <i>æ–°çš„åŒ…å«æ–‡ä»¶ã€‚</i> <br><br> åƒåœ°å½¢ç±»å‹<code>v.texcoord2</code> ï¼Œå•å…ƒ<code>v.texcoord2</code>å­˜å‚¨åœ¨<code>v.texcoord2</code> ã€‚ è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªç´¢å¼•<code>v.texcoord2.x</code> ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨ç´¢å¼•æ¥é‡‡æ ·è¿™äº›å•å…ƒçš„çº¹ç†ã€‚ æˆ‘ä»¬å°†ä¸å¾—ä¸å°†å…¶è½¬æ¢ä¸ºUVåæ ‡ã€‚ <br><br> åˆ›å»ºUåæ ‡çš„ç¬¬ä¸€æ­¥æ˜¯å°†å•å…ƒæ ¼ç´¢å¼•é™¤ä»¥çº¹ç†çš„å®½åº¦ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶ä¹˜ä»¥<code>_HexCellData_TexelSize.x</code> ã€‚ <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">appdata_full v</span></span></span><span class="hljs-function">)</span></span> { float2 uv; uv.x = v.texcoord2.x * _HexCellData_TexelSize.x; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœå°†æ˜¯ZUå½¢å¼çš„æ•°å­—ï¼Œå…¶ä¸­Zæ˜¯è¡Œç´¢å¼•ï¼ŒUæ˜¯Uå•å…ƒçš„åæ ‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ•°å­—å››èˆäº”å…¥ç„¶åä»æ•°å­—ä¸­å‡å»æ¥è·å¾—Uåæ ‡æ¥æå–å­—ç¬¦ä¸²ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v) { float2 uv; uv.x = v.texcoord2.x * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Våæ ‡å°†çº¿é™¤ä»¥çº¹ç†çš„é«˜åº¦ã€‚ </font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v) { float2 uv; uv.x = v.texcoord2.x * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> * _HexCellData_TexelSize.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æ­£åœ¨é‡‡æ ·çº¹ç†ï¼Œå› æ­¤éœ€è¦åœ¨åƒç´ ä¸­å¿ƒè€Œä¸æ˜¯è¾¹ç¼˜ä½¿ç”¨åæ ‡ã€‚</font><font style="vertical-align: inherit;">è¿™æ ·ï¼Œæˆ‘ä»¬ä¿è¯å¯ä»¥å¯¹æ­£ç¡®çš„åƒç´ è¿›è¡Œé‡‡æ ·ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œé™¤ä»¥çº¹ç†å¤§å°åï¼ŒåŠ Â½ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v) { float2 uv; uv.x = (v.texcoord2.x + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ä¸ºé¡¶ç‚¹æ•°æ®ä¸­å­˜å‚¨çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼çš„ç´¢å¼•æä¾›äº†æ­£ç¡®çš„UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">ä½†æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬æœ€å¤šå¯ä»¥æœ‰ä¸‰ä¸ªä¸åŒçš„ç´¢å¼•ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿å…¶</font></font><code>GetCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‚ç”¨äºä»»ä½•ç´¢å¼•ã€‚</font><font style="vertical-align: inherit;">å‘å…¶æ·»åŠ ä¸€ä¸ªæ•´æ•°å‚æ•°</font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥</font><font style="vertical-align: inherit;">å‚æ•°</font><font style="vertical-align: inherit;">è®¿é—®å¸¦æœ‰å•å…ƒæ ¼ç´¢å¼•çš„å‘é‡åˆ†é‡ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { float2 uv; uv.x = (v.texcoord2[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†è¿™äº›å•å…ƒæ ¼çš„æ‰€æœ‰å¿…è¦åæ ‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œé‡‡æ ·</font></font><code>_HexCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æ­£åœ¨é¡¶ç‚¹ç¨‹åºä¸­å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ˜¾å¼å‘Šè¯‰ç€è‰²å™¨è¦ä½¿ç”¨å“ªä¸ªmipçº¹ç†ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥ä½¿ç”¨</font></font><code>tex2Dlod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦å››ä¸ªçº¹ç†åæ ‡çš„</font><font style="vertical-align: inherit;">å‡½æ•°æ¥å®Œæˆ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”±äºè¿™äº›å•å…ƒæ ¼æ²¡æœ‰mipçº¹ç†ï¼Œå› æ­¤æˆ‘ä»¬å°†é›¶å€¼åˆ†é…ç»™é¢å¤–çš„åæ ‡ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { float2 uv; uv.x = (v.texcoord2[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> data = tex2Dlod(_HexCellData, <span class="hljs-type"><span class="hljs-type">float4</span></span>(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬å››ä¸ªæ•°æ®ç»„ä»¶åŒ…å«ä¸€ä¸ªé«˜ç¨‹ç±»å‹ç´¢å¼•ï¼Œæˆ‘ä»¬ç›´æ¥å°†å…¶å­˜å‚¨ä¸ºå­—èŠ‚ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼ŒGPUä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º0-1èŒƒå›´å†…çš„æµ®ç‚¹å€¼ã€‚</font><font style="vertical-align: inherit;">è¦å°†å…¶è½¬æ¢å›æ­£ç¡®çš„å€¼ï¼Œè¯·ä¹˜ä»¥255ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥è¿”å›æ•°æ®ã€‚</font></font><br><br><pre> <code class="hljs kotlin"> float4 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = tex2Dlod(_HexCellData, float4(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.w *= <span class="hljs-number"><span class="hljs-number">255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨ä¸­</font><em><font style="vertical-align: inherit;">å¯ç”¨HexCellData</font></em><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘å°†æ­¤ç€è‰²å™¨æ”¾ç½®åœ¨â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æè´¨/åœ°å½¢â€ä¸­</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../HexCellData.cginc</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs lisp"> #include <span class="hljs-string"><span class="hljs-string">"../HexCellData.cginc"</span></span> UNITY_DECLARE_TEX2DARRAY(<span class="hljs-name"><span class="hljs-name">_MainTex</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é¡¶ç‚¹ç¨‹åºä¸­ï¼Œæˆ‘ä»¬è·å–å­˜å‚¨åœ¨é¡¶ç‚¹æ•°æ®ä¸­çš„æ‰€æœ‰ä¸‰ä¸ªåƒå…ƒç´¢å¼•çš„åƒå…ƒæ•°æ®ã€‚</font><font style="vertical-align: inherit;">ç„¶ååˆ†é…</font></font><code>data.terrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶æµ·æ‹”æŒ‡æ•°ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); // data.terrain = v.texcoord2.xyz; <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); data.terrain.x = cell0.w; data.terrain.y = cell1.w; data.terrain.z = cell2.w; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ—¶ï¼Œåœ°å›¾å†æ¬¡å¼€å§‹æ˜¾ç¤ºæ­£ç¡®çš„åœ°å½¢ã€‚</font><font style="vertical-align: inherit;">æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œä»…ç¼–è¾‘åœ°å½¢ç±»å‹å°†ä¸å†å¯¼è‡´æ–°çš„ä¸‰è§’å‰–åˆ†ã€‚</font><font style="vertical-align: inherit;">å¦‚æœåœ¨ç¼–è¾‘æœŸé—´æ›´æ”¹äº†å…¶ä»–ä»»ä½•å•å…ƒæ ¼æ•°æ®ï¼Œåˆ™å°†ç…§å¸¸æ‰§è¡Œä¸‰è§’å‰–åˆ†ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> èƒ½è§åº¦ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºäº†è¿™äº›å•å…ƒçš„åŸºç¡€ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ”¯æŒå¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ç€è‰²å™¨ï¼Œå•å…ƒæ ¼æœ¬èº«ä»¥åŠç¡®å®šå¯è§æ€§çš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">è¯·æ³¨æ„ï¼Œä¸‰è§’å‰–åˆ†è¿‡ç¨‹å¯¹æ­¤ä¸€æ— æ‰€çŸ¥ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç€è‰²å™¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»å‘Šè¯‰</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å½¢</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">å¯è§æ€§å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">å®ƒå°†ä»é¡¶ç‚¹ç¨‹åºæ¥æ”¶å¯è§æ€§æ•°æ®ï¼Œå¹¶ä½¿ç”¨è¯¥ç»“æ„å°†å…¶ä¼ é€’ç»™ç‰‡æ®µç¨‹åº</font></font><code>Input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä¼ é€’äº†ä¸‰ä¸ªå•ç‹¬çš„æµ·æ‹”æŒ‡æ•°ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å°†ä¼ é€’ä¸‰ä¸ªå¯è§æ€§å€¼ã€‚</font></font><br><br><pre> <code class="hljs swift"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float4 color : <span class="hljs-type"><span class="hljs-type">COLOR</span></span>; float3 worldPos; float3 terrain; float3 visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºäº†å­˜å‚¨å¯è§æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›å•å…ƒæ ¼çš„ç¬¬ä¸€ä¸ªç»„ä»¶ã€‚ </font></font><br><br><pre> <code class="hljs kotlin"> void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { UNITY_INITIALIZE_OUTPUT(Input, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>); float4 cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); float4 cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); float4 cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.terrain.x = cell0.w; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.terrain.y = cell1.w; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.terrain.z = cell2.w; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cell0.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cell1.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.z = cell2.x; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯è§æ€§0è¡¨ç¤ºè¯¥å•å…ƒæ ¼å½“å‰ä¸å¯è§ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå¯è§ï¼Œå®ƒå°†å…·æœ‰å¯è§æ€§1çš„å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç»“æœä¹˜ä»¥</font></font><code>GetTerrainColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸åº”çš„å¯è§æ€§çŸ¢é‡</font><font style="vertical-align: inherit;">æ¥ä½¿åœ°å½¢å˜æš—</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬åˆ†åˆ«è°ƒæ•´æ¯ä¸ªæ··åˆå•å…ƒçš„æµ®é›•é¢œè‰²ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> GetTerrainColor (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { float3 uvw = float3(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.terrain[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>]); <span class="hljs-type"><span class="hljs-type">float4</span></span> c = UNITY_SAMPLE_TEX2DARRAY(_MainTex, uvw); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c * (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>]); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1bf/183/e69/1bf183e695a42f4691f63cec72255993.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»†èƒå˜æˆé»‘è‰²ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éš¾é“æˆ‘ä»¬ä¸èƒ½åœ¨é¡¶ç‚¹ç¨‹åºä¸­ç»“åˆå¯è§æ€§å—ï¼Ÿ</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç‰‡æ®µç¨‹åºåªéœ€è¦ä¼ è¾“ä¸€ä¸ªå¯è§æ€§æŒ‡ç¤ºå™¨ã€‚</font><font style="vertical-align: inherit;">å½“ä¸ºå‚ä¸æ··åˆçš„æ¯ä¸ªå°åŒºä¼ è¾“æŒ‡æ ‡æ—¶ï¼Œä¸‰ä¸ªåœ°å½¢æ ·æœ¬å°†è¢«å•ç‹¬æ··åˆã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œå¯è§ç»†èƒå°†å¯¹æ··åˆåŒºåŸŸåšå‡ºæ›´å¤§è´¡çŒ®ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨ä¸€ä¸ªæŒ‡æ ‡æ—¶ï¼Œå¿…é¡»é¦–å…ˆæ‰§è¡Œæ··åˆï¼Œç„¶ååº”ç”¨æœ€ç»ˆçš„å†…æ’å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨è§†è§‰ä¸Šå®ƒä»¬æ˜¯ä¸åŒçš„ã€‚</font></font></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œå…¨é»‘æš—æ˜¯æš‚æ—¶çœ‹ä¸è§ç»†èƒçš„åŠèº«åƒã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†æˆ‘ä»¬ä»ç„¶å¯ä»¥çœ‹åˆ°ç¼“è§£ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ç”¨äºéšè—å•å…ƒæ ¼çš„æŒ‡æ ‡ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»0â€“1ç§»è‡³Â¼â€“ 1ï¼Œè¿™å¯ä»¥ä½¿ç”¨</font></font><code>lerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¡¶ç‚¹ç¨‹åºæœ«å°¾</font><font style="vertical-align: inherit;">çš„å‡½æ•°æ¥å®Œæˆ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs kotlin"> void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cell0.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cell1.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.z = cell2.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a20/090/3e2/a200903e2f31f3bdcd0c996d42f91a02.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜´å½±ç»†èƒã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å•å…ƒå¯è§æ€§è·Ÿè¸ª </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿å¯è§æ€§èµ·ä½œç”¨ï¼Œå•å…ƒå¿…é¡»è·Ÿè¸ªå…¶å¯è§æ€§ã€‚ä½†æ˜¯ç»†èƒå¦‚ä½•ç¡®å®šå®ƒæ˜¯å¦å¯è§ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡è·Ÿè¸ªçœ‹åˆ°å®ƒçš„å®ä½“æ•°é‡æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å½“æŸäººå¼€å§‹çœ‹åˆ°ä¸€ä¸ªå•å…ƒæ ¼æ—¶ï¼Œä»–å¿…é¡»æŠ¥å‘Šè¯¥å•å…ƒæ ¼ã€‚å½“æŸäººåœæ­¢çœ‹åˆ°ç‰¢æˆ¿æ—¶ï¼Œè¿˜å¿…é¡»é€šçŸ¥å¥¹ã€‚è¯¥å•å…ƒåªæ˜¯è·Ÿè¸ªè§‚å¯Ÿè€…çš„æ•°é‡ï¼Œæ— è®ºè¿™äº›å®ä½“æ˜¯ä»€ä¹ˆã€‚å¦‚æœå•å…ƒæ ¼çš„å¯è§æ€§å€¼è‡³å°‘ä¸º1ï¼Œåˆ™å®ƒæ˜¯å¯è§çš„ï¼Œå¦åˆ™å®ƒæ˜¯ä¸å¯è§çš„ã€‚ä¸ºäº†å®ç°æ­¤è¡Œä¸ºï¼Œæˆ‘ä»¬å‘</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜é‡</font><font style="vertical-align: inherit;">æ·»åŠ äº†</font><font style="vertical-align: inherit;">ä¸¤ä¸ªæ–¹æ³•å’Œä¸€ä¸ªå±æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVisible { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visibility &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } } â€¦ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visibility; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility += <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility -= <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæ·»åŠ åˆ°</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">method </font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå®ƒä¸çš„åŠŸèƒ½ç›¸åŒ</font></font><code>RefreshTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåªæ˜¯ä¸ºäº†å¯è§ã€‚</font><font style="vertical-align: inherit;">å°†æ•°æ®ä¿å­˜åœ¨æ•°æ®å•å…ƒçš„ç»„ä»¶Rä¸­ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„å­—èŠ‚å°†è¢«è½¬æ¢ä¸ºå€¼0-1ï¼Œå› æ­¤æˆ‘ä»¬ç”¨æ¥è¡¨ç¤ºå¯è§æ€§</font></font><code>(byte)255</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cellTextureData[cell.Index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†é€šè¿‡å¢åŠ å’Œå‡å°‘å¯è§æ€§ï¼ˆåœ¨0åˆ°1ä¹‹é—´æ›´æ”¹å€¼ï¼‰æ¥è°ƒç”¨æ­¤æ–¹æ³•ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility == <span class="hljs-number"><span class="hljs-number">1</span></span>) { ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºç­ç»„å¯è§åº¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä½¿å®ƒä»¬èƒ½å¤Ÿçœ‹åˆ°å®ƒä»¬æ‰€å æ®çš„å•å…ƒã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡</font></font><code>IncreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´</font><font style="vertical-align: inherit;">è°ƒç”¨</font><font style="vertical-align: inherit;">å•å…ƒçš„æ–°ä½ç½®æ¥å®Œæˆ</font></font><code>HexUnit.Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜è¦æ±‚ä½¿ç”¨æ—§ä½ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</font></font><code>DecreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexCell Location { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> location; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { location.DecreaseVisibility(); location.Unit = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } location = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Unit = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.IncreaseVisibility(); transform.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Position; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bc/f95/a07/7bcf95a07fdf4c10ed1d53055dddf6a4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•ä½å¯ä»¥çœ‹åˆ°ä»–ä»¬åœ¨å“ªé‡Œã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨å¯è§æ€§ï¼</font><font style="vertical-align: inherit;">å•ä½æ·»åŠ åˆ°åœ°å›¾åï¼Œå…¶å•å…ƒæ ¼å°†å¯è§ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œå®ƒä»¬çš„èŒƒå›´åœ¨ç§»åŠ¨åˆ°æ–°ä½ç½®æ—¶ä¼šè¢«ä¼ é€ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œä»åœ°å›¾ä¸Šåˆ é™¤å•ä½æ—¶ï¼Œå®ƒä»¬çš„ä½œç”¨åŸŸä»ç„¶æœ‰æ•ˆã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨é”€æ¯å•ä½æ—¶é™ä½å…¶ä½ç½®çš„å¯è§æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Die</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { location.DecreaseVisibility(); } location.Unit = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Destroy(gameObject); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> èƒ½è§åº¦èŒƒå›´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…çœ‹åˆ°åˆ†ç¦»æ‰€åœ¨çš„å•å…ƒï¼Œè¿™é™åˆ¶äº†å¯èƒ½æ€§ã€‚è‡³å°‘æˆ‘ä»¬éœ€è¦çœ‹åˆ°ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå•ä½å¯ä»¥çœ‹åˆ°ä¸€å®šè·ç¦»å†…çš„æ‰€æœ‰å•å…ƒï¼Œå…·ä½“å–å†³äºå•ä½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ åˆ°è¯¥</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•ä¸­ï¼Œä»¥è€ƒè™‘åˆ°èŒƒå›´ï¼Œæ‰¾åˆ°ä¸€ä¸ªå•å…ƒæ ¼ä¸­æ‰€æœ‰å¯è§çš„å•å…ƒæ ¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤åˆ¶å’Œæ›´æ”¹æ¥åˆ›å»ºæ­¤æ–¹æ³•</font></font><code>Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ›´æ”¹å…¶å‚æ•°ï¼Œå¹¶ä½¿å…¶è¿”å›å¯ä»¥ä½¿ç”¨åˆ—è¡¨æ± çš„å•å…ƒæ ¼åˆ—è¡¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ¯æ¬¡è¿­ä»£æ—¶ï¼Œå½“å‰å•å…ƒæ ¼éƒ½ä¼šæ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚æœ€ç»ˆå•å…ƒä¸å†å­˜åœ¨ï¼Œå› æ­¤æœç´¢åˆ°æ­¤ä¸ºæ­¢å°†æ°¸è¿œä¸ä¼šç»“æŸã€‚æˆ‘ä»¬è¿˜æ‘†è„±äº†ç§»åŠ¨çš„é€»è¾‘å’Œç§»åŠ¨çš„æˆæœ¬ã€‚åˆ¶ä½œå±æ€§</font></font><code>PathFrom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»–ä»¬ä¸å†è¢«é—®åˆ°æ˜¯å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å®ƒä»¬ï¼Œæˆ‘ä»¬ä¹Ÿä¸æƒ³å¹²æ‰°æ²¿ç€ç½‘æ ¼çš„è·¯å¾„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œè·ç¦»ä»…å¢åŠ 1ã€‚å¦‚æœè¶…å‡ºèŒƒå›´ï¼Œåˆ™è·³è¿‡è¯¥å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œæˆ‘ä»¬ä¸éœ€è¦æœç´¢å¯å‘å¼ç®—æ³•ï¼Œå› æ­¤å¯ä»¥å°†å…¶åˆå§‹åŒ–ä¸º0å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®è´¨ä¸Šï¼Œæˆ‘ä»¬è¿”å›äº†Dijkstraç®—æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">List&lt;HexCell&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVisibleCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { List&lt;HexCell&gt; visibleCells = ListPool&lt;HexCell&gt;.Get(); searchFrontierPhase += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchFrontier == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { searchFrontier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCellPriorityQueue(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { searchFrontier.Clear(); } fromCell.SearchPhase = searchFrontierPhase; fromCell.Distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(fromCell); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); current.SearchPhase += <span class="hljs-number"><span class="hljs-number">1</span></span>; visibleCells.Add(current); <span class="hljs-comment"><span class="hljs-comment">// if (current == toCell) { // return true; // } // int currentTurn = (current.Distance - 1) / speed; for (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); if ( neighbor == null || neighbor.SearchPhase &gt; searchFrontierPhase ) { continue; } // â€¦ // int moveCost; // â€¦ int distance = current.Distance + 1; if (distance &gt; range) { continue; } // int turn = (distance - 1) / speed; // if (turn &gt; currentTurn) { // distance = turn * speed + moveCost; // } if (neighbor.SearchPhase &lt; searchFrontierPhase) { neighbor.SearchPhase = searchFrontierPhase; neighbor.Distance = distance; // neighbor.PathFrom = current; neighbor.SearchHeuristic = 0; searchFrontier.Enqueue(neighbor); } else if (distance &lt; neighbor.Distance) { int oldPriority = neighbor.SearchPriority; neighbor.Distance = distance; // neighbor.PathFrom = current; searchFrontier.Change(neighbor, oldPriority); } } } return visibleCells; }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æ›´ç®€å•çš„ç®—æ³•æ¥æŸ¥æ‰¾èŒƒå›´å†…çš„æ‰€æœ‰åƒå…ƒå—ï¼Ÿ</font></font></b> <div class="spoiler_text"> ,          ,      . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜è¦æ·»åŠ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>IncreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>DecreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬è·å–å•å…ƒæ ¼å’ŒèŒƒå›´ï¼Œè·å–ç›¸åº”å•å…ƒæ ¼çš„åˆ—è¡¨ï¼Œå¹¶å¢åŠ /å‡å°‘å…¶å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">å®Œæˆåï¼Œä»–ä»¬åº”å°†åˆ—è¡¨è¿”å›åˆ°å…¶æ± ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { List&lt;HexCell&gt; cells = GetVisibleCells(fromCell, range); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Count; i++) { cells[i].IncreaseVisibility(); } ListPool&lt;HexCell&gt;.Add(cells); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { List&lt;HexCell&gt; cells = GetVisibleCells(fromCell, range); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Count; i++) { cells[i].DecreaseVisibility(); } ListPool&lt;HexCell&gt;.Add(cells); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œ</font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦è®¿é—®ç½‘æ ¼ï¼Œå› æ­¤è¯·å‘å…¶æ·»åŠ ä¸€ä¸ªå±æ€§</font></font><code>Grid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid Grid { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å°é˜Ÿæ·»åŠ åˆ°ç½‘æ ¼æ—¶ï¼Œå®ƒå°†ä¸ºè¯¥å±æ€§åˆ†é…ä¸€ä¸ªç½‘æ ¼</font></font><code>HexGrid.AddUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUnit</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexUnit unit, HexCell location, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orientation</span></span></span><span class="hljs-function">)</span></span> { units.Add(unit); unit.Grid = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; unit.transform.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); unit.Location = location; unit.Orientation = orientation; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œä¸‰ä¸ªå•å…ƒæ ¼çš„å¯è§èŒƒå›´å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ·»åŠ äº†</font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸é‡ï¼Œå°†æ¥å®ƒæ€»æ˜¯å¯ä»¥å˜æˆå˜é‡ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿å°é˜Ÿé’ˆå¯¹ç½‘æ ¼</font></font><code>IncreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">è°ƒç”¨æ–¹æ³•ï¼Œ</font><font style="vertical-align: inherit;">å¹¶</font></font><code>DecreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ é€’å…¶å¯è§æ€§èŒƒå›´ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ°è¿™ä¸ªåœ°æ–¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visionRange = <span class="hljs-number"><span class="hljs-number">3</span></span>; â€¦ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexCell Location { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> location; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { <span class="hljs-comment"><span class="hljs-comment">// location.DecreaseVisibility(); Grid.DecreaseVisibility(location, visionRange); location.Unit = null; } location = value; value.Unit = this; // value.IncreaseVisibility(); Grid.IncreaseVisibility(value, visionRange); transform.localPosition = value.Position; } } â€¦ public void Die () { if (location) { // location.DecreaseVisibility(); Grid.DecreaseVisibility(location, visionRange); } location.Unit = null; Destroy(gameObject); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cd/c45/ccb/8cdc45ccb01449b3c7d50a7bef9b249c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒ½è§åº¦èŒƒå›´å¯ä»¥é‡å çš„å•ä½ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç§»åŠ¨æ—¶èƒ½è§åº¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤åˆ»ï¼Œç§»åŠ¨å‘½ä»¤åçš„ç­ç»„å¯è§åŒºåŸŸç«‹å³ä¼ é€åˆ°ç»ˆç‚¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¯¥å•å…ƒåŠå…¶å¯è§åŒºåŸŸä¸€èµ·ç§»åŠ¨ï¼Œåˆ™æ•ˆæœä¼šæ›´å¥½ã€‚</font><font style="vertical-align: inherit;">ç¬¬ä¸€æ­¥æ˜¯æˆ‘ä»¬å°†ä¸å†è®¾ç½®å±æ€§</font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code>HexUnit.Travel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å°†ç›´æ¥æ›´æ”¹å­—æ®µ</font></font><code>location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œé¿å…ä½¿ç”¨å±æ€§ä»£ç ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†æ‰‹åŠ¨æ¸…é™¤æ—§ä½ç½®å¹¶é…ç½®æ–°ä½ç½®ã€‚</font><font style="vertical-align: inherit;">å¯è§æ€§å°†ä¿æŒä¸å˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Travel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;HexCell&gt; path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Location = path[path.Count - 1]; location.Unit = null; location = path[path.Count - 1]; location.Unit = this; pathToTravel = path; StopAllCoroutines(); StartCoroutine(TravelPath()); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åç¨‹å†…éƒ¨ï¼Œ</font></font><code>TravelPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åªæœ‰å®Œæˆå</font><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ‰ä¼šé™ä½ç¬¬ä¸€ä¸ªå•å…ƒæ ¼çš„å¯è§æ€§</font></font><code>LookAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œåœ¨ç§»è‡³æ–°å•å…ƒä¹‹å‰ï¼Œæˆ‘ä»¬å°†å¢åŠ è¯¥å•å…ƒçš„å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">å®Œæˆæ­¤æ“ä½œåï¼Œæˆ‘ä»¬å†æ¬¡é™ä½äº†å¯è§åº¦ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œå¢åŠ æœ€åä¸€ä¸ªå•å…ƒæ ¼çš„å¯è§æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TravelPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Vector3 a, b, c = pathToTravel[<span class="hljs-number"><span class="hljs-number">0</span></span>].Position; <span class="hljs-comment"><span class="hljs-comment">// transform.localPosition = c; yield return LookAt(pathToTravel[1].Position); Grid.DecreaseVisibility(pathToTravel[0], visionRange); float t = Time.deltaTime * travelSpeed; for (int i = 1; i &lt; pathToTravel.Count; i++) { a = c; b = pathToTravel[i - 1].Position; c = (b + pathToTravel[i].Position) * 0.5f; Grid.IncreaseVisibility(pathToTravel[i], visionRange); for (; t &lt; 1f; t += Time.deltaTime * travelSpeed) { â€¦ } Grid.DecreaseVisibility(pathToTravel[i], visionRange); t -= 1f; } a = c; b = location.Position; // We can simply use the destination here. c = b; Grid.IncreaseVisibility(location, visionRange); for (; t &lt; 1f; t += Time.deltaTime * travelSpeed) { â€¦ } â€¦ }</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åŠ¨ä¸­çš„å¯è§æ€§ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€æœ‰è¿™ä¸€åˆ‡éƒ½æœ‰æ•ˆï¼Œé™¤äº†åœ¨åˆ†é˜Ÿç§»åŠ¨æ—¶å‘å‡ºæ–°è®¢å•æ—¶ã€‚</font><font style="vertical-align: inherit;">è¿™å¯¼è‡´éšå½¢ä¼ æ€ï¼Œè¿™ä¹Ÿåº”é€‚ç”¨äºèƒ½è§åº¦ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç§»åŠ¨æ—¶è·Ÿè¸ªå°é˜Ÿçš„å½“å‰ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell location, currentTravelLocation;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯å½“æˆ‘ä»¬åœ¨ç§»åŠ¨ä¸­å‘½ä¸­ä¸€ä¸ªæ–°å•å…ƒæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ›´æ–°æ­¤ä½ç½®ï¼Œç›´åˆ°ç­é•¿åˆ°è¾¾æœ€åä¸€ä¸ªå•å…ƒä¸ºæ­¢ã€‚</font><font style="vertical-align: inherit;">ç„¶åå¿…é¡»å°†å…¶é‡ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TravelPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; pathToTravel.Count; i++) { currentTravelLocation = pathToTravel[i]; a = c; b = pathToTravel[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].Position; c = (b + currentTravelLocation.Position) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Grid.IncreaseVisibility(pathToTravel[i], visionRange); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; t &lt; <span class="hljs-number"><span class="hljs-number">1f</span></span>; t += Time.deltaTime * travelSpeed) { transform.localPosition = Bezier.GetPoint(a, b, c, t); Vector3 d = Bezier.GetDerivative(a, b, c, t); dy = <span class="hljs-number"><span class="hljs-number">0f</span></span>; transform.localRotation = Quaternion.LookRotation(d); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } Grid.DecreaseVisibility(pathToTravel[i], visionRange); t -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; } currentTravelLocation = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œåœ¨å®Œæˆä¸Šäº¤ä¹‹åï¼Œ</font></font><code>TravelPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥æ£€æŸ¥è·¯å¾„çš„æ—§ä¸­é—´ä½ç½®æ˜¯å¦å·²çŸ¥ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦é™ä½æ­¤å•å…ƒæ ¼ä¸­çš„å¯è§æ€§ï¼Œè€Œä¸æ˜¯è·¯å¾„çš„å¼€å¤´ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TravelPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Vector3 a, b, c = pathToTravel[<span class="hljs-number"><span class="hljs-number">0</span></span>].Position; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LookAt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pathToTravel[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">].Position</span></span></span><span class="hljs-function">)</span></span>; Grid.DecreaseVisibility( currentTravelLocation ? currentTravelLocation : pathToTravel[<span class="hljs-number"><span class="hljs-number">0</span></span>], visionRange ); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜éœ€è¦æ ¡æ­£å°é˜Ÿç§»åŠ¨æœŸé—´é‡æ–°ç¼–è¯‘åçš„å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸­é—´ä½ç½®ä»ç„¶æ˜¯å·²çŸ¥çš„ï¼Œåˆ™å‡å°å…¶ä¸­çš„å¯è§æ€§å¹¶å¢åŠ ç«¯ç‚¹å¤„çš„å¯è§æ€§ï¼Œç„¶åé‡ç½®ä¸­é—´ä½ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { transform.localPosition = location.Position; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentTravelLocation) { Grid.IncreaseVisibility(location, visionRange); Grid.DecreaseVisibility(currentTravelLocation, visionRange); currentTravelLocation = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯å’Œæ°´çš„å¯è§æ€§ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æµ®é›•é¢œè‰²çš„æ›´æ”¹åŸºäºå¯è§æ€§ï¼Œä½†è¿™ä¸ä¼šå½±å“é“è·¯å’Œæ°´ã€‚</font><font style="vertical-align: inherit;">å¯¹äºçœ‹ä¸è§çš„ç»†èƒï¼Œå®ƒä»¬çœ‹èµ·æ¥å¤ªäº®äº†ã€‚</font><font style="vertical-align: inherit;">è‹¥è¦å°†å¯è§æ€§åº”ç”¨äºé“è·¯å’Œæ°´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…¶ç½‘æ ¼æ•°æ®ä¸­æ·»åŠ åƒå…ƒç´¢å¼•å’Œæ··åˆæƒé‡ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥</font><font style="vertical-align: inherit;">é¢„åˆ¶ç¢ç‰‡</font><font style="vertical-align: inherit;">çš„</font><em><font style="vertical-align: inherit;">æ²³æµ</font></em><font style="vertical-align: inherit;">ï¼Œ</font><em><font style="vertical-align: inherit;">é“è·¯</font></em><font style="vertical-align: inherit;">ï¼Œ</font><em><font style="vertical-align: inherit;">æ°´</font></em><font style="vertical-align: inherit;">ï¼Œ</font><em><font style="vertical-align: inherit;">æ°´å²¸</font></em><font style="vertical-align: inherit;">å’Œ</font><em><font style="vertical-align: inherit;">æ²³å£</font></em></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨å•å…ƒæ•°æ®</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„å­çº§</font><font style="vertical-align: inherit;">ã€‚</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä»é“è·¯å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">è¯¥æ–¹æ³•</font></font><code>HexGridChunk.TriangulateRoadEdge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºåœ¨å•å…ƒä¸­å¿ƒåˆ›å»ºé“è·¯çš„ä¸€å°éƒ¨åˆ†ï¼Œå› æ­¤å®ƒéœ€è¦ä¸€ä¸ªå•å…ƒç´¢å¼•ã€‚</font><font style="vertical-align: inherit;">å‘å…¶æ·»åŠ å‚æ•°å¹¶ç”Ÿæˆä¸‰è§’å½¢çš„å•å…ƒæ ¼æ•°æ®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index </span></span></span><span class="hljs-function">)</span></span> { roads.AddTriangle(center, mL, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); Vector3 indices; indices.x = indices.y = indices.z = index; roads.AddTriangleCellData(indices, weights1); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºé“è·¯çš„å¦ä¸€ç§ç®€å•æ–¹æ³•æ˜¯</font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒåœ¨å•å…ƒå†…éƒ¨å’Œå•å…ƒä¹‹é—´ä½¿ç”¨ï¼Œå› æ­¤åº”ä¸ä¸¤ä¸ªä¸åŒçš„ç´¢å¼•ä¸€èµ·ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œä½¿ç”¨ç´¢å¼•å‘é‡å‚æ•°å¾ˆæ–¹ä¾¿ã€‚</font><font style="vertical-align: inherit;">ç”±äºè·¯æ®µå¯ä»¥æ˜¯å£æ¶çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æƒé‡ä¹Ÿå¿…é¡»é€šè¿‡å‚æ•°ä¼ é€’ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, Vector3 v5, Vector3 v6, Color w1, Color w2, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { roads.AddQuad(v1, v2, v4, v5); roads.AddQuad(v2, v3, v5, v6); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); roads.AddQuadCellData(indices, w1, w2); roads.AddQuadCellData(indices, w1, w2); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­åˆ°</font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå®ƒä¼šåœ¨å•å…ƒå†…éƒ¨åˆ›å»ºé“è·¯ã€‚</font><font style="vertical-align: inherit;">å®ƒè¿˜éœ€è¦ä¸€ä¸ªç´¢å¼•å‚æ•°ã€‚</font><font style="vertical-align: inherit;">ä»–å°†æ­¤æ•°æ®ä¼ é€’ç»™ä»–è°ƒç”¨çš„é“è·¯æ–¹æ³•ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ä»–åˆ›å»ºçš„ä¸‰è§’å½¢ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoadThroughCellEdge, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoadThroughCellEdge) { Vector3 indices; indices.x = indices.y = indices.z = index; Vector3 mC = Vector3.Lerp(mL, mR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); TriangulateRoadSegment( mL, mC, mR, e.v2, e.v3, e.v4, weights1, weights1, indices ); roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleCellData(indices, weights1); roads.AddTriangleCellData(indices, weights1); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateRoadEdge(center, mL, mR, index); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒä»ç„¶æ·»åŠ æ‰€éœ€çš„æ–¹æ³•å‚æ•°</font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>TriangulateRoadEdge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶</font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº æ­£æ‰€æœ‰çš„ç¼–è¯‘å™¨é”™è¯¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { Vector2 interpolators = GetRoadInterpolators(direction, cell); TriangulateRoad( center, Vector3.Lerp(center, e.v1, interpolators.x), Vector3.Lerp(center, e.v5, interpolators.y), e, cell.HasRoadThroughEdge(direction), cell.Index ); } } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge, cell.Index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { TriangulateRoadEdge(roadCenter, center, mL, cell.Index); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { TriangulateRoadEdge(roadCenter, mR, center, cell.Index); } } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> â€¦ </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoad) { TriangulateRoadSegment( e1.v2, e1.v3, e1.v4, e2.v2, e2.v3, e2.v4, w1, w2, indices ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ç½‘æ ¼æ•°æ®æ­£ç¡®ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Road</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shader </font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒéœ€è¦ä¸€ä¸ªé¡¶ç‚¹ç¨‹åºï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs css"> <span class="hljs-selector-id"><span class="hljs-selector-id">#pragma</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">surface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">surf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Standard</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fullforwardshadows</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">decal</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:blend</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vertex</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:vert</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#pragma</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">target</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">HexCellData</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cginc</span></span>"</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºæˆ‘ä»¬æ²¡æœ‰æ··åˆå‡ ç§ææ–™ï¼Œå› æ­¤å°†ä¸€ä¸ªå¯è§æ€§æŒ‡æ ‡ä¼ é€’ç»™ç‰‡æ®µç¨‹åºå°±è¶³å¤Ÿäº†ã€‚ </font></font><br><br><pre> <code class="hljs cpp"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> {</span></span> float2 uv_MainTex; float3 worldPos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªæ–°çš„é¡¶ç‚¹ç¨‹åºè¶³ä»¥ä»ä¸¤ä¸ªå•å…ƒä¸­æ¥æ”¶æ•°æ®ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç«‹å³æ··åˆå®ƒä»¬çš„å¯è§æ€§ï¼Œå¯¹å…¶è¿›è¡Œè°ƒæ•´å¹¶æ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨ç‰‡æ®µç¨‹åºä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å¢åŠ é¢œè‰²çš„å¯è§æ€§å³å¯ã€‚ </font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); fixed4 c = _Color * ((noise.y * <span class="hljs-number"><span class="hljs-number">0.75</span></span> + <span class="hljs-number"><span class="hljs-number">0.25</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af8/92f/46e/af892f46e364906cc547aaecb4e50e3a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰èƒ½è§åº¦çš„é“è·¯ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¼€æ°´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯è§æ€§ä¼¼ä¹å·²ç»å½±å“äº†æ°´ï¼Œä½†è¿™åªæ˜¯æµ¸å…¥æ°´ä¸­çš„åœ°å½¢è¡¨é¢ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»å¯¹å¼€æ”¾æ°´åŸŸåº”ç”¨å¯è§æ€§å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜</font></font><code>HexGridChunk.TriangulateOpenWater</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { â€¦ water.AddTriangle(center, c1, c2); Vector3 indices; indices.x = indices.y = indices.z = cell.Index; water.AddTriangleCellData(indices, weights1); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { â€¦ water.AddQuad(c1, c2, e1, e2); indices.y = neighbor.Index; water.AddQuadCellData(indices, weights1, weights2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { â€¦ water.AddTriangle( c2, e2, c2 + HexMetrics.GetWaterBridge(direction.Next()) ); indices.z = nextNeighbor.Index; water.AddTriangleCellData( indices, weights1, weights2, weights3 ); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¿˜éœ€è¦å‘é è¿‘æµ·å²¸çš„ä¸‰è§’å½¢çš„æ‰‡å½¢æ·»åŠ å•å…ƒæ•°æ®ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { â€¦ water.AddTriangle(center, e1.v1, e1.v2); water.AddTriangle(center, e1.v2, e1.v3); water.AddTriangle(center, e1.v3, e1.v4); water.AddTriangle(center, e1.v4, e1.v5); Vector3 indices; indices.x = indices.y = indices.z = cell.Index; water.AddTriangleCellData(indices, weights1); water.AddTriangleCellData(indices, weights1); water.AddTriangleCellData(indices, weights1); water.AddTriangleCellData(indices, weights1); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦ä»¥ä¸â€œ </font><em><font style="vertical-align: inherit;">é“è·¯â€</font></em><font style="vertical-align: inherit;">ç€è‰²å™¨ç›¸åŒçš„æ–¹å¼æ›´æ”¹</font><font style="vertical-align: inherit;">â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²</font><font style="vertical-align: inherit;">å™¨</font><font style="vertical-align: inherit;">ï¼Œä½†æ˜¯å®ƒéœ€è¦åˆå¹¶çš„å¯è§†æ€§ä¸æ˜¯ä¸¤ä¸ªï¼Œè€Œæ˜¯ä¸‰ä¸ªå•å…ƒã€‚</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y + cell2.x * v.color.z; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a4/c52/36c/6a4c5236c52eaae78cbde54fb2fdeeac.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€é˜”æ°´é¢èƒ½è§åº¦ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æµ·å²¸å’Œæ²³å£ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ”¯æŒæµ·å²¸ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡æ”¹å˜</font></font><code>HexGridChunk.TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ç´¢å¼•å‘é‡ï¼Œä½†æ˜¯å¯¹äºå¼€æ”¾æ°´åŸŸï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨äº†ä¸€ä¸ªç»†èƒç´¢å¼•ã€‚</font><font style="vertical-align: inherit;">æµ·å²¸ä¹Ÿéœ€è¦é‚»å±…ç´¢å¼•ï¼Œå› æ­¤è¯·æ›´æ”¹ä»£ç ã€‚</font></font><br><br><pre> <code class="cs hljs"> Vector3 indices; <span class="hljs-comment"><span class="hljs-comment">// indices.x = indices.y = indices.z = cell.Index; indices.x = indices.z = cell.Index; indices.y = neighbor.Index;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†åƒå…ƒæ•°æ®æ·»åŠ åˆ°æµ·å²¸çš„å››è¾¹å½¢å’Œä¸‰è§’å½¢ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜ä¼šåœ¨é€šè¯ä¸­ä¼ é€’ç´¢å¼•</font></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary( e1, e2, cell.IncomingRiver == direction, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { â€¦ waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadCellData(indices, weights1, weights2); waterShore.AddQuadCellData(indices, weights1, weights2); waterShore.AddQuadCellData(indices, weights1, weights2); waterShore.AddQuadCellData(indices, weights1, weights2); } HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { â€¦ waterShore.AddTriangleUV( â€¦ ); indices.z = nextNeighbor.Index; waterShore.AddTriangleCellData( indices, weights1, weights2, weights3 ); }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘æµ·å²¸å’Œæ²³å£</font><font style="vertical-align: inherit;">æ·»åŠ å¿…è¦çš„å‚æ•°</font><font style="vertical-align: inherit;">å¹¶ç…§é¡¾è¿™äº›ç»†èƒã€‚</font><font style="vertical-align: inherit;">ä¸è¦å¿˜è®°ï¼Œå˜´æ˜¯æ¢¯å½¢çš„ï¼Œä¾§é¢æœ‰ä¸¤ä¸ªä¸‰è§’å½¢çš„æµ·å²¸ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç¡®ä¿æƒé‡ä»¥æ­£ç¡®çš„é¡ºåºä¼ è¾“ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { waterShore.AddTriangle(e2.v1, e1.v2, e1.v1); waterShore.AddTriangle(e2.v5, e1.v5, e1.v4); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleCellData(indices, weights2, weights1, weights1); waterShore.AddTriangleCellData(indices, weights2, weights1, weights1); estuaries.AddQuad(e2.v1, e1.v2, e2.v2, e1.v3); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadCellData( indices, weights2, weights1, weights2, weights1 ); estuaries.AddTriangleCellData(indices, weights1, weights2, weights2); estuaries.AddQuadCellData(indices, weights1, weights2); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WaterShore</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨ä¸­ï¼Œ</font><em><font style="vertical-align: inherit;">æ‚¨</font></em><font style="vertical-align: inherit;">éœ€è¦è¿›è¡Œä¸</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨ç›¸åŒçš„æ›´æ”¹</font><font style="vertical-align: inherit;">ï¼ŒåŒæ—¶æ··åˆä¸‰ä¸ªå•å…ƒçš„å¯è§æ€§ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y + cell2.x * v.color.z; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { â€¦ fixed4 c = saturate(_Color + max(foam, waves)); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°¢å¾·</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³å£</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¤ä¸ªç»†èƒæ··åˆçš„çŸ¥ååº¦ï¼Œä»¥åŠç€è‰²</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è·¯æ¦‚è¿°</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»–å·²ç»æœ‰äº†ä¸€ä¸ªé¡¶ç‚¹ç¨‹åºï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä»–æ¥ä¼ è¾“æ²³æµçš„UVåæ ‡ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 riverUV; float3 worldPos; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> o) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, o); o.riverUV = v.texcoord1.xy; <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); o.visibility = cell0.x * v.color.x + cell1.x * v.color.y; o.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, o.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { â€¦ fixed4 c = saturate(_Color + water); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88f/829/254/88f829254235a293040ac755d8318bc3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ·å²¸å’Œæ²³å£å…·æœ‰å¯è§æ€§ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ²³æµ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åå¯ä»¥ä½¿ç”¨çš„æ°´åŸŸæ˜¯æ²³æµã€‚</font><font style="vertical-align: inherit;">å°†</font></font><code>HexGridChunk.TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç´¢å¼•å‘é‡</font><font style="vertical-align: inherit;">æ·»åŠ åˆ°</font><font style="vertical-align: inherit;">å‚æ•°å¹¶å°†å…¶æ·»åŠ åˆ°ç½‘æ ¼ï¼Œä»¥ä¾¿å®ƒå¯ä»¥ä¿æŒä¸¤ä¸ªåƒå…ƒçš„å¯è§æ€§ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { TriangulateRiverQuad(v1, v2, v3, v4, y, y, v, reversed, indices); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { â€¦ rivers.AddQuadCellData(indices, weights1, weights2); }</code> </pre> <br> <code>TriangulateWithRiverBeginOrEnd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºåœ¨å•å…ƒæ ¼ä¸­å¿ƒå…·æœ‰å››è¾¹å½¢å’Œä¸‰è§’å½¢çš„æ²³æµç«¯ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤æ·»åŠ å¿…è¦çš„å•å…ƒæ ¼æ•°æ®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; Vector3 indices; indices.x = indices.y = indices.z = cell.Index; TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed, indices ); center.y = m.v2.y = m.v4.y = cell.RiverSurfaceY; rivers.AddTriangle(center, m.v2, m.v4); â€¦ rivers.AddTriangleCellData(indices, weights1); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»æœ‰è¿™äº›å•å…ƒæ ¼ç´¢å¼•</font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤æˆ‘ä»¬åªåœ¨è°ƒç”¨æ—¶ä¼ é€’å®ƒä»¬</font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; TriangulateRiverQuad( centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, reversed, indices ); TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed, indices ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¿˜ä¸ºå€’å…¥æ·±æ°´çš„ç€‘å¸ƒæ·»åŠ äº†ç´¢å¼•æ”¯æŒã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterfallInWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterY, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { â€¦ rivers.AddQuadCellData(indices, weights1, weights2); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œå¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿å°†å¿…è¦çš„ç´¢å¼•ä¼ é€’ç»™æ²³æµå’Œç€‘å¸ƒæ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver) { e2.v3.y = neighbor.StreamBedY; Vector3 indices; indices.x = indices.z = cell.Index; indices.y = neighbor.Index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &gt; neighbor.WaterLevel) { TriangulateWaterfallInWater( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, neighbor.WaterSurfaceY, indices ); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !neighbor.IsUnderwater &amp;&amp; neighbor.Elevation &gt; cell.WaterLevel ) { TriangulateWaterfallInWater( e2.v4, e2.v2, e1.v4, e1.v2, neighbor.RiverSurfaceY, cell.RiverSurfaceY, cell.WaterSurfaceY, indices ); } } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">éœ€è¦è¿›è¡Œä¸</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Road</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨ç›¸åŒçš„æ›´æ”¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; â€¦ <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, _MainTex); fixed4 c = saturate(_Color + river); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ef/db6/76a/1efdb676afe28b61b73f317d25158505.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰èƒ½è§åº¦çš„æ²³æµã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯¹è±¡å’Œå¯è§æ€§ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¯è§æ€§é€‚ç”¨äºæ•´ä¸ªè¿‡ç¨‹ç”Ÿæˆçš„åœ°å½¢ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä¸å½±å“åœ°å½¢ç‰¹å¾ã€‚å»ºç­‘ç‰©ï¼Œå†œåœºå’Œæ ‘æœ¨æ˜¯ç”±é¢„åˆ¶ä»¶è€Œéç¨‹åºå‡ ä½•åˆ›å»ºçš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•æ·»åŠ å•å…ƒç´¢å¼•å¹¶å°†æƒé‡ä¸å…¶é¡¶ç‚¹æ··åˆã€‚ç”±äºè¿™äº›å¯¹è±¡ä»…å±äºä¸€ä¸ªå•å…ƒæ ¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç¡®å®šå®ƒä»¬ä½äºå“ªä¸ªå•å…ƒæ ¼ä¸­ã€‚å¦‚æœå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å¯ä»¥è®¿é—®ç›¸åº”å•å…ƒæ ¼çš„æ•°æ®å¹¶åº”ç”¨å¯è§æ€§ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»å¯ä»¥å°†ä¸–ç•Œçš„XZä½ç½®è½¬æ¢ä¸ºå•å…ƒæ ¼ç´¢å¼•ã€‚æ­¤è½¬æ¢ç”¨äºç¼–è¾‘åœ°å½¢å’Œç®¡ç†å°é˜Ÿã€‚ä½†æ˜¯ï¼Œç›¸åº”çš„ä»£ç å¹¶ä¸ç®€å•ã€‚å®ƒä½¿ç”¨æ•´æ•°è¿ç®—ï¼Œå¹¶ä¸”éœ€è¦é€»è¾‘æ¥å¤„ç†è¾¹ã€‚è¿™å¯¹äºç€è‰²å™¨æ¥è¯´æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çƒ˜ç„™çº¹ç†ä¸­çš„å¤§éƒ¨åˆ†é€»è¾‘å¹¶ä½¿ç”¨å®ƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨å…·æœ‰å…­è¾¹å½¢å›¾æ¡ˆçš„çº¹ç†æ¥å°†ç½‘æ ¼æŠ•å½±åˆ°åœ°å½¢ä¸Šã€‚æ­¤çº¹ç†å®šä¹‰äº†2Ã—2çš„å•å…ƒæ ¼åŒºåŸŸã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è®¡ç®—å‡ºæˆ‘ä»¬åœ¨å“ªä¸ªåŒºåŸŸã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä¸ºè¯¥åŒºåŸŸä¸­çš„å•å…ƒæ ¼åº”ç”¨åŒ…å«Xå’ŒZåç§»é‡çš„çº¹ç†ï¼Œå¹¶ä½¿ç”¨æ­¤æ•°æ®æ¥è®¡ç®—æˆ‘ä»¬æ‰€åœ¨çš„å•å…ƒæ ¼ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ç±»ä¼¼çš„çº¹ç†ã€‚ Xåç§»é‡å­˜å‚¨åœ¨å…¶çº¢è‰²é€šé“ä¸­ï¼ŒZåç§»é‡å­˜å‚¨åœ¨ç»¿è‰²é€šé“ä¸­ã€‚ç”±äºå®ƒè¦†ç›–2Ã—2å•å…ƒçš„é¢ç§¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»0å’Œ2å¼€å§‹çš„åç§»é‡ã€‚æ­¤ç±»æ•°æ®æ— æ³•å­˜å‚¨åœ¨é¢œè‰²é€šé“ä¸­ï¼Œå› æ­¤åç§»é‡å‡å°‘äº†ä¸€åŠã€‚æˆ‘ä»¬ä¸éœ€è¦é€æ˜çš„å•å…ƒæ ¼è¾¹ç¼˜ï¼Œå› æ­¤å°çš„çº¹ç†å°±è¶³å¤Ÿäº†ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/795/63c/d3c/79563cd3c22e7aa2ca66e40b5ffe3f7e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘æ ¼åæ ‡çš„çº¹ç†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘é¡¹ç›®æ·»åŠ çº¹ç†ã€‚</font><font style="vertical-align: inherit;">è®¾ç½®å…¶â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…è£¹æ¨¡å¼â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºâ€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡å¤â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå°±åƒå…¶ä»–ç½‘æ ¼çº¹ç†ä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸éœ€è¦ä»»ä½•æ··åˆï¼Œå› æ­¤å¯¹äº</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ··åˆæ¨¡å¼ï¼Œ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€‰æ‹©</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åŒæ—¶å…³é—­</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‹ç¼©</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»¥ä½¿æ•°æ®ä¸å¤±çœŸã€‚</font><font style="vertical-align: inherit;">å…³é—­</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sRGB</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å¼ï¼Œ</font><font style="vertical-align: inherit;">ä»¥ä¾¿åœ¨çº¿æ€§æ¨¡å¼ä¸‹æ¸²æŸ“æ—¶ï¼Œä¸æ‰§è¡Œé¢œè‰²ç©ºé—´è½¬æ¢ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬ä¸éœ€è¦MIPçº¹ç†ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/866/aa9/de3/866aa9de36f6953f54d4fb8197fb75ff.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¹ç†å¯¼å…¥é€‰é¡¹ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å…·æœ‰å¯è§æ€§çš„å¯¹è±¡ç€è‰²å™¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªæ–°çš„</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹å¾</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">ä»¥å‘å¯¹è±¡æ·»åŠ å¯è§æ€§æ”¯æŒã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å¸¦æœ‰é¡¶ç‚¹ç¨‹åºçš„ç®€å•è¡¨é¢ç€è‰²å™¨ã€‚</font><font style="vertical-align: inherit;">å‘å…¶ä¸­æ·»åŠ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å¯è§æ€§æŒ‡ç¤ºå™¨ä¼ é€’ç»™ç‰‡æ®µç¨‹åºï¼Œç„¶ååƒå¾€å¸¸ä¸€æ ·å°†å…¶è§†ä¸ºå½©è‰²ã€‚</font><font style="vertical-align: inherit;">åŒºåˆ«åœ¨äºæˆ‘ä»¬æ— æ³•ä½¿ç”¨</font></font><code>GetCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒï¼Œå› ä¸ºæ‰€éœ€çš„ç½‘æ ¼æ•°æ®ä¸å­˜åœ¨ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬åœ¨ä¸–ç•Œä¸Šå æœ‰ä¸€å¸­ä¹‹åœ°ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæš‚æ—¶å°†å¯è§åº¦è®¾ç½®ä¸º1ã€‚</font></font><br><br><pre> <code class="hljs pgsql">Shader "Custom/Feature" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> [NoTilingOffset] _GridCoordinates ("Grid Coordinates", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} } SubShader { Tags { "RenderType"="Opaque" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "../HexCellData.cginc" sampler2D _MainTex, _GridCoordinates; half _Glossiness; half _Metallic; fixed4 _Color; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); float3 pos = mul(unity_ObjectToWorld, v.vertex); data.visibility = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ›´æ”¹å¯¹è±¡çš„æ‰€æœ‰æè´¨ï¼Œä»¥ä½¿å®ƒä»¬ä½¿ç”¨æ–°çš„ç€è‰²å™¨å¹¶ä¸ºå…¶åˆ†é…ç½‘æ ¼åæ ‡çš„çº¹ç†ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e35/fad/546/e35fad5469e6c9e5c6a31626ba182ec8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸå¸‚ä¸ç½‘æ ¼çº¹ç†ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®¿é—®å•å…ƒæ ¼æ•°æ® </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†åœ¨é¡¶ç‚¹ç¨‹åºä¸­é‡‡æ ·ç½‘æ ¼åæ ‡çš„çº¹ç†ï¼Œæˆ‘ä»¬å†æ¬¡éœ€è¦</font></font><code>tex2Dlod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªå››åˆ†é‡çº¹ç†åæ ‡å‘é‡ã€‚</font><font style="vertical-align: inherit;">å‰ä¸¤ä¸ªåæ ‡æ˜¯XZä¸–ç•Œçš„ä½ç½®ã€‚</font><font style="vertical-align: inherit;">å¦‚å‰æ‰€è¿°ï¼Œå…¶ä»–ä¸¤ä¸ªç­‰äºé›¶ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); float3 pos = mul(unity_ObjectToWorld, v.vertex); <span class="hljs-type"><span class="hljs-type">float4</span></span> gridUV = <span class="hljs-type"><span class="hljs-type">float4</span></span>(pos.xz, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); data.visibility = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åœ¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨ä¸­ä¸€æ ·</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬æ‹‰ä¼¸UVåæ ‡ï¼Œä»¥ä½¿çº¹ç†å…·æœ‰ä¸å…­è¾¹å½¢ç½‘æ ¼ç›¸å¯¹åº”çš„æ­£ç¡®çºµæ¨ªæ¯”ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> gridUV = <span class="hljs-type"><span class="hljs-type">float4</span></span>(pos.xz, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); gridUV.x *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">8.66025404</span></span>); gridUV.y *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">15.0</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å–å››èˆäº”å…¥çš„UVåæ ‡å€¼ï¼Œå¯ä»¥æ‰¾å‡º2Ã—2å•å…ƒæ ¼ä¸­çš„å“ªä¸ªéƒ¨åˆ†ã€‚</font><font style="vertical-align: inherit;">è¿™æ„æˆäº†ç»†èƒåæ ‡çš„åŸºç¡€ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> gridUV = <span class="hljs-type"><span class="hljs-type">float4</span></span>(pos.xz, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); gridUV.x *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">8.66025404</span></span>); gridUV.y *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">15.0</span></span>); float2 cellDataCoordinates = floor(gridUV.xy);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºäº†æ‰¾åˆ°æˆ‘ä»¬æ‰€åœ¨çš„å•å…ƒçš„åæ ‡ï¼Œæˆ‘ä»¬æ·»åŠ äº†å­˜å‚¨åœ¨çº¹ç†ä¸­çš„ä½ç§»ã€‚ </font></font><br><br><pre> <code class="hljs pgsql"> float2 cellDataCoordinates = floor(gridUV.xy) + tex2Dlod(_GridCoordinates, gridUV).rg;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºç½‘æ ¼çš„ä¸€éƒ¨åˆ†å¤§å°ä¸º2Ã—2ï¼Œå¹¶ä¸”åç§»é‡å‡åŠï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†ç»“æœåŠ å€ä»¥è·å¾—æœ€ç»ˆåæ ‡ã€‚ </font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">float2</span></span> cellDataCoordinates = floor(gridUV.xy) + tex2Dlod(_GridCoordinates, gridUV).rg; <span class="hljs-attribute"><span class="hljs-attribute">cellDataCoordinates</span></span> *= <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬æœ‰äº†å•å…ƒæ ¼çš„XZåæ ‡ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸ºè¿™äº›å•å…ƒçš„UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡ç®€å•åœ°ç§»åŠ¨åˆ°åƒç´ çš„ä¸­å¿ƒï¼Œç„¶åå°†å®ƒä»¬åˆ’åˆ†ä¸ºçº¹ç†å¤§å°æ¥å®Œæˆã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬</font><font style="vertical-align: inherit;">ä¸ºæ­¤</font><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ª</font><font style="vertical-align: inherit;">åŠŸèƒ½åˆ°</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…å«æ–‡ä»¶ä¸­</font><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">æ–‡ä»¶</font><font style="vertical-align: inherit;">ä¹Ÿå°†å¤„ç†é‡‡æ ·ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (float2 cellDataCoordinates) { float2 uv = cellDataCoordinates + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; uv.x *= _HexCellData_TexelSize.x; uv.y *= _HexCellData_TexelSize.y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tex2Dlod(_HexCellData, <span class="hljs-type"><span class="hljs-type">float4</span></span>(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ç¨‹åºä½¿ç”¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„åŠŸèƒ½</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs haskell"> cellDataCoordinates *= <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCellData</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cellDataCoordinates</span></span></span><span class="hljs-class">).x; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility = lerp(0.25, 1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visibility</span></span></span><span class="hljs-class">);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ed/9c9/7ed/1ed9c97ed37aa88aaee6c0efd9d075d7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰å¯è§æ€§çš„å¯¹è±¡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œå¯è§æ€§ä¼šå½±å“æ•´ä¸ªåœ°å›¾ï¼Œä½†å§‹ç»ˆå¯è§çš„å•ä½é™¤å¤–ã€‚ç”±äºæˆ‘ä»¬ç¡®å®šæ¯ä¸ªé¡¶ç‚¹çš„å¯¹è±¡çš„å¯è§æ€§ï¼Œå› æ­¤å¯¹äºç©¿è¿‡å•å…ƒæ ¼è¾¹ç•Œçš„å¯¹è±¡ï¼Œå°†å…³é—­å…¶å…³é—­çš„å•å…ƒæ ¼çš„å¯è§æ€§ã€‚ä½†æ˜¯ç‰©ä½“æ˜¯å¦‚æ­¤ä¹‹å°ï¼Œä»¥è‡³äºå³ä½¿è€ƒè™‘åˆ°ä½ç½®çš„å˜å½¢ï¼Œå®ƒä»¬ä¹Ÿå§‹ç»ˆä¿ç•™åœ¨å…¶å†…éƒ¨ã€‚ä½†æ˜¯ï¼Œæœ‰äº›å¯èƒ½æ˜¯å¦ä¸€ä¸ªå•å…ƒä¸­é¡¶ç‚¹çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ–¹æ³•ä¾¿å®œä½†ä¸å®Œå–„ã€‚è¿™åœ¨å¢™å£çš„æƒ…å†µä¸‹æœ€ä¸ºæ˜æ˜¾ï¼Œå¢™å£çš„å¯è§æ€§åœ¨ç›¸é‚»å•å…ƒçš„å¯è§æ€§ä¹‹é—´å˜åŒ–ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/421/1c7/f7d/4211c7f7dea80bbbd13664586074c43a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èƒ½è§åº¦ä¸æ–­å˜åŒ–çš„å¢™ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå¢™æ®µæ˜¯æŒ‰ç¨‹åºç”Ÿæˆçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å•å…ƒæ ¼æ•°æ®æ·»åŠ åˆ°å…¶ç½‘æ ¼ä¸­ï¼Œå¹¶ä½¿ç”¨ç”¨äºæµ®é›•çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›å¡”æ˜¯é¢„åˆ¶çš„ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶ä¼šæœ‰ä¸ä¸€è‡´ä¹‹å¤„ã€‚</font><font style="vertical-align: inherit;">æ¦‚æ‹¬è€Œè¨€ï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨çš„ç®€å•å‡ ä½•å›¾å½¢ï¼Œç°æœ‰æ–¹æ³•çœ‹èµ·æ¥è¶³å¤Ÿå¥½ã€‚</font><font style="vertical-align: inherit;">å°†æ¥ï¼Œæˆ‘ä»¬å°†è€ƒè™‘æ›´è¯¦ç»†çš„æ¨¡å‹å’Œå¢™ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†æ”¹è¿›æ··åˆå…¶å¯è§æ€§çš„æ–¹æ³•ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬21éƒ¨åˆ†ï¼šåœ°å›¾ç ”ç©¶ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è·Ÿè¸ªè°ƒæŸ¥çš„ç»†èƒã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬éšè—äº†ä»ç„¶æœªçŸ¥çš„ä¸œè¥¿ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å¼ºè¿«éƒ¨é˜Ÿé¿å¼€æœªå¼€å‘çš„åŒºåŸŸã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†æˆ˜äº‰è¿·é›¾ï¼Œç°åœ¨å°†å¯¹å…¶è¿›è¡Œç»†åŒ–ä»¥å®æ–½åœ°å›¾ç ”ç©¶ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81d/40e/bff/81d40ebff615fc7c4e39a15d88da016d.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å‡†å¤‡æ¢ç´¢ä¸–ç•Œã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºæ•´ä¸ªåœ°å›¾ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥ç ”ç©¶çš„æ„ä¹‰åœ¨äºï¼Œç›´åˆ°çœ‹ä¸è§ç»†èƒä¹‹å‰ï¼Œéƒ½è¢«è®¤ä¸ºæ˜¯æœªçŸ¥çš„ï¼Œå› æ­¤æ˜¯ä¸å¯è§çš„ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬ä¸åº”è¢«é®ç›–ï¼Œä½†æ ¹æœ¬ä¸æ˜¾ç¤ºã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨æ·»åŠ ç ”ç©¶æ”¯æŒä¹‹å‰ï¼Œæˆ‘ä»¬å°†åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹å¯ç”¨å¯è§æ€§ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯è§æ€§åˆ‡æ¢ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³é”®å­—æ§åˆ¶ç€è‰²å™¨æ˜¯å¦ä½¿ç”¨å¯è§æ€§ï¼Œå°±åƒåœ¨ç½‘æ ¼ä¸Šè¿›è¡Œè¦†ç›–ä¸€æ ·ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä½¿ç”¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_MAP_EDIT_MODE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³é”®å­—æ¥</font><font style="vertical-align: inherit;">æŒ‡ç¤ºç¼–è¾‘æ¨¡å¼çš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">ç”±äºä¸€äº›ç€è‰²å™¨åº”è¯¥çŸ¥é“æ­¤å…³é”®å­—ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨é™æ€æ–¹æ³•</font></font><code>Shader.EnableKeyWord</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œè¿›è¡Œ</font><font style="vertical-align: inherit;">å…¨å±€å®šä¹‰</font></font><code>Shader.DisableKeyword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><code>HexGameUI.SetEditMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹ç¼–è¾‘æ¨¡å¼æ—¶ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è°ƒç”¨é€‚å½“çš„æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetEditMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { enabled = !toggle; grid.ShowUI(!toggle); grid.ClearPath(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (toggle) { Shader.EnableKeyword(<span class="hljs-string"><span class="hljs-string">"HEX_MAP_EDIT_MODE"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Shader.DisableKeyword(<span class="hljs-string"><span class="hljs-string">"HEX_MAP_EDIT_MODE"</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¼–è¾‘æ¨¡å¼ç€è‰²å™¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_MAP_EDIT_MODE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®å®šç€è‰²å™¨ä¼šå¿½ç•¥å¤–è§‚ã€‚</font><font style="vertical-align: inherit;">è¿™å½’ç»“ä¸ºä¸€ä¸ªäº‹å®ï¼Œå³å•å…ƒæ ¼å¯è§æ€§å°†å§‹ç»ˆè¢«è§†ä¸ºç­‰äº1ã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª</font><font style="vertical-align: inherit;">å‡½æ•°ï¼Œä»¥æ ¹æ®</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> include-fileå¼€å¤´</font><font style="vertical-align: inherit;">çš„å…³é”®å­—æ¥è¿‡æ»¤å•å…ƒæ ¼çš„æ•°æ®ã€‚</font></font><br><br><pre> <code class="hljs kotlin">sampler2D _HexCellData; float4 _HexCellData_TexelSize; float4 FilterCellData (float4 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> defined(HEX_MAP_EDIT_MODE) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>GetCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿”å›å®ƒä¹‹å‰</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªå‡½æ•°çš„ç»“æœä¼ é€’ç»™è¯¥å‡½æ•°</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FilterCellData(data); } <span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (float2 cellDataCoordinates) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FilterCellData(tex2Dlod(_HexCellData, <span class="hljs-type"><span class="hljs-type">float4</span></span>(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œï¼Œæ‰€æœ‰çš„ç€è‰²å™¨éƒ½å¿…é¡»æ¥æ”¶multi_compileæŒ‡ä»¤æ‰èƒ½åˆ›å»ºé€‰é¡¹ï¼Œä»¥é˜²</font><font style="vertical-align: inherit;">å®šä¹‰</font><font style="vertical-align: inherit;">äº†</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_MAP_EDIT_MODE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³é”®å­—</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨ç›®æ ‡æŒ‡ä»¤å’Œç¬¬ä¸€ä¸ªincludeæŒ‡ä»¤ä¹‹é—´ï¼Œ</font><font style="vertical-align: inherit;">å°†é€‚å½“çš„è¡Œæ·»åŠ åˆ°ç€è‰²å™¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estuary</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feature</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">River</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Road</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water Shore</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> multi_compile _ HEX_MAP_EDIT_MODE</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå½“åˆ‡æ¢åˆ°åœ°å›¾ç¼–è¾‘æ¨¡å¼æ—¶ï¼Œæˆ˜äº‰è¿·é›¾å°†æ¶ˆå¤±ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»†èƒç ”ç©¶ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”å°†å•å…ƒæ ¼è§†ä¸ºæœªå¼€å‘å•å…ƒã€‚</font><font style="vertical-align: inherit;">å½“å°é˜Ÿçœ‹åˆ°ä»–ä»¬æ—¶ï¼Œä»–ä»¬å°±ä¼šè¢«æ¢ç´¢ã€‚</font><font style="vertical-align: inherit;">æ­¤åï¼Œå¦‚æœåˆ†é˜Ÿå¯ä»¥çœ‹åˆ°ä»–ä»¬ï¼Œä»–ä»¬å°†ç»§ç»­æ¥å—è°ƒæŸ¥ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿½è¸ªå­¦ä¹ çŠ¶æ€ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†å¢åŠ å¯¹ç›‘è§†ç ”ç©¶çŠ¶æ€çš„æ”¯æŒï¼Œæˆ‘ä»¬åœ¨</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸è§„å±æ€§ä¸­</font><font style="vertical-align: inherit;">æ·»åŠ </font></font><code>IsExplored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExplored { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç ”ç©¶çš„çŠ¶æ€ç”±ç»†èƒæœ¬èº«å†³å®šã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåº”ä»…è®¾ç½®æ­¤å±æ€§</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¦æ·»åŠ æ­¤é™åˆ¶ï¼Œæˆ‘ä»¬å°†è®¾ç½®å™¨è®¾ç½®ä¸ºç§æœ‰ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExplored { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å…ƒæ ¼çš„å¯è§æ€§é¦–æ¬¡å¤§äºé›¶æ—¶ï¼Œä¾¿å¼€å§‹è€ƒè™‘å¯¹è¯¥å•å…ƒæ ¼è¿›è¡Œè°ƒæŸ¥ï¼Œå› æ­¤</font></font><code>IsExplored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”åˆ†é…ä¸€ä¸ªå€¼</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œå½“å¯è§æ€§å¢åŠ åˆ°1æ—¶ï¼Œä»…å°†å•å…ƒæ ‡è®°ä¸ºå·²æ£€æŸ¥å°±è¶³å¤Ÿäº†ã€‚è¿™å¿…é¡»åœ¨callä¹‹å‰å®Œæˆ</font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility == <span class="hljs-number"><span class="hljs-number">1</span></span>) { IsExplored = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†ç ”ç©¶çŠ¶æ€è½¬ç§»åˆ°ç€è‰²å™¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ç»†èƒå¯è§æ€§ä¸€æ ·ï¼Œæˆ‘ä»¬é€šè¿‡ç€è‰²å™¨æ•°æ®å°†å…¶ç ”ç©¶çŠ¶æ€è½¬ç§»åˆ°ç€è‰²å™¨ã€‚</font><font style="vertical-align: inherit;">æœ€åï¼Œè¿™åªæ˜¯å¯è§æ€§çš„å¦ä¸€ç§ç±»å‹ã€‚</font></font><code>HexCellShaderData.RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å¯è§æ€§çŠ¶æ€å­˜å‚¨åœ¨æ•°æ®é€šé“Rä¸­ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†ç ”ç©¶çŠ¶æ€ä¿ç•™åœ¨Gé€šé“æ•°æ®ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; cellTextureData[index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; cellTextureData[index].g = cell.IsExplored ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é»‘è‰²æœªå¼€å‘çš„æµ®é›• </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç€è‰²å™¨æ¥å¯è§†åŒ–ç»†èƒç ”ç©¶çš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬å°†æœªå¼€å‘çš„åœ°å½¢è®¾ä¸ºé»‘è‰²ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯é¦–å…ˆï¼Œè¦ä½¿ç¼–è¾‘æ¨¡å¼èµ·ä½œç”¨ï¼Œè¯·å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>FilterCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥è¿‡æ»¤å‡ºç ”ç©¶æ•°æ®ã€‚</font></font><br><br><pre> <code class="hljs kotlin">float4 FilterCellData (float4 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> defined(HEX_MAP_EDIT_MODE) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.xy = <span class="hljs-number"><span class="hljs-number">1</span></span>; #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å½¢</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">å°†æ‰€æœ‰ä¸‰ä¸ªå¯èƒ½å•å…ƒçš„å¯è§æ€§æ•°æ®ä¼ é€’ç»™ç‰‡æ®µç¨‹åºã€‚</font><font style="vertical-align: inherit;">åœ¨ç ”ç©¶çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å°†å®ƒä»¬åˆå¹¶åˆ°é¡¶ç‚¹ç¨‹åºä¸­ï¼Œå¹¶å°†å”¯ä¸€çš„å€¼è½¬ç§»åˆ°ç‰‡æ®µç¨‹åºä¸­ã€‚</font><font style="vertical-align: inherit;">å°†</font></font><code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬å››ä¸ªç»„ä»¶</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">åˆ°</font><font style="vertical-align: inherit;">è¾“å…¥ä¸­ï¼Œ</font><font style="vertical-align: inherit;">ä»¥ä¾¿ä¸ºæ­¤æ”¾ç½®ä¸€ä¸ªä½ç½®ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; float3 worldPos; float3 terrain; <span class="hljs-type"><span class="hljs-type">float4</span></span> visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œåœ¨é¡¶ç‚¹ç¨‹åºä¸­ï¼Œå½“æˆ‘ä»¬æ›´æ”¹å¯è§æ€§ç´¢å¼•æ—¶ï¼Œå¿…é¡»æ˜¾å¼è®¿é—®</font></font><code>data.visibility.xyz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { â€¦ data.visibility.xyz = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility.xyz); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹åï¼Œæˆ‘ä»¬ç»“åˆç ”ç©¶çŠ¶æ€å¹¶å°†ç»“æœå†™å…¥</font></font><code>data.visibility.w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™ç±»ä¼¼äºåœ¨å…¶ä»–ç€è‰²å™¨ä¸­åˆå¹¶å¯è§æ€§ï¼Œä½†ä½¿ç”¨è¿™äº›å•å…ƒçš„åˆ†é‡Yã€‚</font></font><br><br><pre> <code class="hljs haskell"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility.xyz = lerp(0.25, 1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visibility</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xyz</span></span></span><span class="hljs-class">); </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility.w = cell0.y * v.color.x + cell1.y * v.color.y + cell2.y * v.color.z;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å¯ä»¥é€šè¿‡ç‰‡æ®µç¨‹åºè·å¾—ç ”ç©¶çŠ¶æ€</font></font><code>IN.visibility.w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨åç…§ç‡çš„è®¡ç®—ä¸­è€ƒè™‘å®ƒã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { â€¦ <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.w; o.Albedo = c.rgb * grid * _Color * explored; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2d/de4/c18/b2dde4c1831a9ecc637550b2b8e2e134.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœªå¼€å‘çš„åœ°å½¢ç°åœ¨ä¸ºé»‘è‰²ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæœªå¼€å‘çš„å•å…ƒçš„æµ®é›•ä¸ºé»‘è‰²ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™å°šæœªå½±å“ç‰©ä½“ï¼Œé“è·¯å’Œæ°´ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œè¿™è¶³ä»¥ç¡®ä¿ç ”ç©¶èƒ½å¤Ÿè¿›è¡Œã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¿å­˜å’ŒåŠ è½½ç ”ç©¶çŠ¶æ€ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å·²ç»æ·»åŠ äº†ç ”ç©¶æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨ä¿å­˜å’ŒåŠ è½½åœ°å›¾æ—¶è€ƒè™‘åˆ°ç ”ç©¶çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†åœ°å›¾æ–‡ä»¶çš„ç‰ˆæœ¬å¢åŠ åˆ°3ã€‚ä¸ºäº†ä½¿è¿™äº›æ›´æ”¹æ›´æ–¹ä¾¿ï¼Œè®©æˆ‘ä»¬ä¸ºæ­¤æ·»åŠ ä¸€ä¸ª</font></font><code>SaveLoadMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¸é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mapFileVersion = <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å‘ä¸­å†™å…¥æ–‡ä»¶ç‰ˆæœ¬</font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŠåœ¨ä¸­æ£€æŸ¥æ–‡ä»¶æ”¯æŒ</font><font style="vertical-align: inherit;">æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­¤å¸¸é‡</font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( BinaryWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryWriter(File.Open(path, FileMode.Create)) ) { writer.Write(mapFileVersion); hexGrid.Save(writer); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!File.Exists(path)) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">"File does not exist "</span></span> + path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (BinaryReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryReader(File.OpenRead(path))) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> header = reader.ReadInt32(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header &lt;= mapFileVersion) { hexGrid.Load(reader, header); HexMapCamera.ValidatePosition(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">"Unknown map format "</span></span> + header); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åä¸€æ­¥ï¼Œ</font></font><code>HexCell.Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è®°å½•ç ”ç©¶çŠ¶æ€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryWriter writer</span></span></span><span class="hljs-function">)</span></span> { â€¦ writer.Write(IsExplored); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨æœ€åé˜…è¯»å®ƒ</font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤åï¼Œ</font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœç ”ç©¶çŠ¶æ€ä¸å…ˆå‰çš„çŠ¶æ€ä¸åŒ</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å°†æ‰“ç”µè¯ç»™æˆ‘ä»¬</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader</span></span></span><span class="hljs-function">)</span></span> { â€¦ IsExplored = reader.ReadBoolean(); ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä¿æŒä¸æ—§ä¿å­˜æ–‡ä»¶çš„å‘åå…¼å®¹æ€§ï¼Œå¦‚æœæ–‡ä»¶ç‰ˆæœ¬å°äº3ï¼Œåˆ™éœ€è¦è·³è¿‡è¯»å–ä¿å­˜çŠ¶æ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå•å…ƒæ ¼çš„çŠ¶æ€ä¸ºâ€œæœªæ¢ç´¢â€ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†</font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å¤´æ•°æ®</font><font style="vertical-align: inherit;">æ·»åŠ ä¸ºå‚æ•°</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { â€¦ IsExplored = header &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? reader.ReadBoolean() : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨</font></font><code>HexGrid.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå®ƒå°†å¿…é¡»ä¼ å…¥</font></font><code>HexCell.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å¤´æ•°æ®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].Load(reader, header); } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œåœ¨ä¿å­˜å’ŒåŠ è½½åœ°å›¾æ—¶ï¼Œå°†è€ƒè™‘ç»†èƒçš„æ¢ç´¢çŠ¶æ€ã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšè—æœªçŸ¥çš„å•å…ƒæ ¼ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å½“å‰é˜¶æ®µï¼Œæœªæ¢ç´¢çš„ç»†èƒä¼šé€šè¿‡é»‘è‰²æµ®é›•è§†è§‰æ˜¾ç¤ºã€‚</font><font style="vertical-align: inherit;">ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›ç»†èƒä¸å¯è§ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æœªçŸ¥çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ä¸é€æ˜çš„å‡ ä½•ä½“é€æ˜ï¼Œä»è€Œä½¿å…¶ä¸å¯è§ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œåœ¨å¼€å‘Unityè¡¨é¢ç€è‰²å™¨æ¡†æ¶æ—¶å¹¶æœªè€ƒè™‘åˆ°è¿™ç§å¯èƒ½æ€§ã€‚</font><font style="vertical-align: inherit;">ä»£æ›¿ä½¿ç”¨çœŸå®çš„é€æ˜åº¦ï¼Œæˆ‘ä»¬å°†æ›´æ”¹ç€è‰²å™¨ä»¥åŒ¹é…èƒŒæ™¯ï¼Œè¿™ä¹Ÿå°†ä½¿å®ƒä»¬ä¸å¯è§ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿æ•‘æµçœŸæ­£å˜é»‘ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡ç ”ç©¶çš„æµ®é›•æ˜¯é»‘è‰²çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥è¯†åˆ«å®ƒï¼Œå› ä¸ºå®ƒä»ç„¶å…·æœ‰é•œé¢ç…§æ˜ã€‚è¦æ‘†è„±ç…§æ˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿å…¶å®Œå…¨ä¸ºå“‘å…‰é»‘è‰²ã€‚ä¸ºäº†ä¸å½±å“å…¶ä»–è¡¨é¢ç‰¹æ€§ï¼Œæœ€å®¹æ˜“å°†é•œé¢é¢œè‰²æ›´æ”¹ä¸ºé»‘è‰²ã€‚å¦‚æœæ‚¨ä½¿ç”¨å¯ä¸é«˜å…‰é…åˆä½¿ç”¨çš„è¡¨é¢ç€è‰²å™¨ï¼Œåˆ™å¯ä»¥è¿™æ ·åšï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†é‡‘å±æè´¨ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»å°†</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨åˆ‡æ¢</font><font style="vertical-align: inherit;">ä¸ºé«˜å…‰å¼€å§‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ¢é¢œè‰²å±æ€§</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Metallic</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©ä¸š</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Specular</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¶é¢œè‰²å€¼åº”ç­‰äºï¼ˆ0.2ï¼Œ0.2ï¼Œ0.2ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¿è¯å®ƒä¼šä¸é‡‘å±ç‰ˆæœ¬çš„å¤–è§‚åŒ¹é…ã€‚</font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-section"><span class="hljs-section">Properties</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">_Color</span></span> (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex (<span class="hljs-string"><span class="hljs-string">"Terrain Texture Array"</span></span>, 2DArray) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-attribute"><span class="hljs-attribute">_GridTex</span></span> (<span class="hljs-string"><span class="hljs-string">"Grid Texture"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-attribute"><span class="hljs-attribute">_Glossiness</span></span> (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> // _Metallic (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> _Specular (<span class="hljs-string"><span class="hljs-string">"Specular"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜æ›´æ”¹ç›¸åº”çš„ç€è‰²å™¨å˜é‡ã€‚</font><font style="vertical-align: inherit;">é•œé¢æ›²é¢ç€è‰²å™¨çš„é¢œè‰²å®šä¹‰ä¸º</font></font><code>fixed3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤è®©æˆ‘ä»¬ä½¿ç”¨å®ƒã€‚</font></font><br><br><pre> <code class="hljs objectivec"> half _Glossiness; <span class="hljs-comment"><span class="hljs-comment">// half _Metallic; fixed3 _Specular; fixed4 _Color;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ç¼–è¯‘æŒ‡ç¤ºæ›²é¢ä»</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standard</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹</font><font style="vertical-align: inherit;">ä¸º</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StandardSpecular</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™å°†å¼ºåˆ¶Unityä½¿ç”¨é«˜å…‰ç”Ÿæˆç€è‰²å™¨ã€‚</font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf StandardSpecular fullforwardshadows vertex:vert</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œè¯¥å‡½æ•°</font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦ç¬¬äºŒä¸ªå‚æ•°ä¸ºtype </font></font><code>SurfaceOutputStandardSpecular</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œç°åœ¨æ‚¨éœ€è¦åˆ†é…çš„å€¼ä¸æ˜¯</font></font><code>o.Metallic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œæ˜¯</font></font><code>o.Specular</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { â€¦ <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.w; o.Albedo = c.rgb * grid * _Color * explored; // o.Metallic = _Metallic; o.Specular = _Specular; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘</font></font><code>explored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é•œé¢åå°„çš„é¢œè‰²æ¥é®æŒ¡é«˜å…‰ã€‚</font></font><br><br><pre> <code class="hljs"> o.Specular = _Specular * explored;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/289/d05/128/289d0512816a7d6f692b0e7639e882eb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœªå¼€å‘çš„åœ°å½¢ï¼Œæ— åå°„å…‰ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨åœ¨å›¾ç‰‡ä¸­æ‰€çœ‹åˆ°çš„ï¼Œç°åœ¨æœªå¼€å‘çš„æµ®é›•çœ‹èµ·æ¥æš—æ·¡çš„é»‘è‰²ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå½“ä»¥åˆ‡çº¿è§’åº¦æŸ¥çœ‹æ—¶ï¼Œè¿™äº›è¡¨é¢ä¼šå˜æˆä¸€é¢é•œå­ï¼Œå› æ­¤ï¼Œæµ®é›•å¼€å§‹åå°„ç¯å¢ƒï¼Œå³å¤©ç©ºç›’ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆè¡¨é¢å˜æˆé•œå­ï¼Ÿ</font></font></b> <div class="spoiler_text">    .  .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rendering</a> . </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/255/d63/627/255d636278eb947c27117d6c596a9489.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœªå¼€å‘çš„åŒºåŸŸä»ç„¶åæ˜ ç¯å¢ƒã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ¶ˆé™¤è¿™äº›åå°„ï¼Œæˆ‘ä»¬å°†å®Œå…¨å±è”½æœªå¼€å‘çš„æµ®é›•ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯é€šè¿‡</font></font><code>explored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºé®æŒ¡å‚æ•°</font><font style="vertical-align: inherit;">åˆ†é…ä¸€ä¸ªå€¼æ¥å®ç°çš„</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å°†å…¶ç”¨ä½œåå°„è’™ç‰ˆã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.w; o.Albedo = c.rgb * grid * _Color * explored; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = ca;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/118/ab6/a5a/118ab6a5a91711eda2165433a7b99513.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœªå¼€å‘ï¼Œæ— æ€è€ƒã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é…å¥—èƒŒæ™¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æœªå¼€å‘çš„åœ°å½¢ä¼šå¿½ç•¥æ‰€æœ‰ç…§æ˜ï¼Œæ‚¨éœ€è¦ä½¿å…¶ä¸èƒŒæ™¯åŒ¹é…ã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬çš„ç›¸æœºå§‹ç»ˆä»ä¸Šæ–¹çœ‹ï¼Œå› æ­¤èƒŒæ™¯å§‹ç»ˆä¸ºç°è‰²ã€‚</font><font style="vertical-align: inherit;">è¦å‘Šè¯‰</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å½¢</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">ä½¿ç”¨å“ªç§é¢œè‰²ï¼Œè¯·æ·»åŠ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_BackgroundColor</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§</font><font style="vertical-align: inherit;">ï¼Œè¯¥</font><font style="vertical-align: inherit;">å±æ€§</font><font style="vertical-align: inherit;">é»˜è®¤ä¸ºé»‘è‰²ã€‚</font></font><br><br><pre> <code class="hljs dos"> Properties { â€¦ _BackgroundColor ("Background <span class="hljs-built_in"><span class="hljs-built_in">Color</span></span>", <span class="hljs-built_in"><span class="hljs-built_in">Color</span></span>) = (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) } â€¦ half _Glossiness; fixed3 _Specular; fixed4 _Color; half3 _BackgroundColor;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ç”¨æ­¤é¢œè‰²ï¼Œæˆ‘ä»¬å°†å…¶æ·»åŠ ä¸ºå‘å°„å…‰ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯</font></font><code>o.Emission</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡æŒ‡å®šèƒŒæ™¯è‰²å€¼ä¹˜ä»¥æ¢ç´¢çš„ä¸€å‡æ¥å®ç°çš„ã€‚</font></font><br><br><pre> <code class="hljs"> o.Occlusion = explored; o.Emission = _BackgroundColor * (1 - explored);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å¤©ç©ºç›’ï¼Œå› æ­¤å¯è§çš„èƒŒæ™¯é¢œè‰²å®é™…ä¸Šå¹¶ä¸ç›¸åŒã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ï¼Œç•¥å¸¦çº¢è‰²çš„ç°è‰²æ˜¯æœ€å¥½çš„é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">è®¾ç½®æµ®é›•ææ–™æ—¶ï¼Œå¯ä»¥å°†</font><font style="vertical-align: inherit;">ä»£ç 68615BFF </font><font style="vertical-align: inherit;">ç”¨äº</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åå…­è¿›åˆ¶é¢œè‰²</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eeb/307/7dd/eeb3077dd097a7649575a371cbb361f6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•‘æµææ–™å…·æœ‰ç°è‰²èƒŒæ™¯è‰²ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼Œå°½ç®¡å¦‚æœæ‚¨çŸ¥é“ä»å“ªé‡Œçœ‹ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°è½®å»“å¾ˆå¼±ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿æ’­æ”¾å™¨çœ‹ä¸åˆ°å®ƒä»¬ï¼Œæ‚¨å¯ä»¥ä¸ºç›¸æœºåˆ†é…ç»Ÿä¸€çš„èƒŒæ™¯è‰²68615BFFï¼Œè€Œä¸æ˜¯å‘å¤©ç›’ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b9/8cc/ec9/7b98ccec9228ac333cc23ec19cc6f28b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸æœºå…·æœ‰ç»Ÿä¸€çš„èƒŒæ™¯è‰²ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆä¸åˆ é™¤å¤©ç©ºç›’ï¼Ÿ</font></font></b> <div class="spoiler_text">   ,   ,     environmental lighting .     ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬æ— æ³•æ‰¾åˆ°èƒŒæ™¯å’Œæœªå¼€å‘å•å…ƒæ ¼ä¹‹é—´çš„å·®å¼‚ã€‚</font><font style="vertical-align: inherit;">è¾ƒé«˜çš„æœªå‹˜æ¢åœ°å½¢ä»å¯ä»¥åœ¨ä½æ‘„åƒæœºè§’åº¦æ©ç›–è¾ƒä½çš„å‹˜æ¢åœ°å½¢ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæœªå‹˜æ¢çš„é›¶ä»¶ä»åœ¨å‹˜æ¢å¯¹è±¡ä¸Šç•™ä¸‹é˜´å½±ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è¿™äº›æœ€å°çš„çº¿ç´¢å¯ä»¥å¿½ç•¥ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f88/764/d67/f88764d67aec0bf90267d273e1a248d5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœªæ¢ç´¢çš„å•å…ƒæ ¼ä¸å†å¯è§ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœæ‚¨ä¸ä½¿ç”¨ç»Ÿä¸€çš„èƒŒæ™¯è‰²æ€ä¹ˆåŠï¼Ÿ</font></font></b> <div class="spoiler_text">    ,        ,      .        .      ,          .       ,     ,  ,  UV-           . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšè—æ•‘æµå¯¹è±¡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åªéšè—äº†æµ®é›•çš„ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">å…¶ä½™çš„ç ”ç©¶çŠ¶æ€å°šæœªå—å½±å“ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/282/c0c/a0f/282c0ca0fb55bf26ee0bb1d43cadd42f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåªæœ‰æ•‘æµæ˜¯éšè—çš„ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ›´æ”¹</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feature</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">ï¼Œå®ƒæ˜¯</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrainä¹‹</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç±»çš„ä¸é€æ˜ç€è‰²å™¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å°†å…¶å˜æˆé•œé¢åå°„ç€è‰²å™¨ï¼Œå¹¶ä¸ºå…¶æ·»åŠ èƒŒæ™¯è‰²ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»å±æ€§å¼€å§‹ã€‚</font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-section"><span class="hljs-section">Properties</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">_Color</span></span> (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex (<span class="hljs-string"><span class="hljs-string">"Albedo (RGB)"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-attribute"><span class="hljs-attribute">_Glossiness</span></span> (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> // _Metallic (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> _Specular (<span class="hljs-string"><span class="hljs-string">"Specular"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>) _BackgroundColor (<span class="hljs-string"><span class="hljs-string">"Background Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) [NoScaleOffset] _GridCoordinates (<span class="hljs-string"><span class="hljs-string">"Grid Coordinates"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åƒä»¥å‰ä¸€æ ·è¿›ä¸€æ­¥ç¼–è¯‘æ‚ç‰©è¡¨é¢å’Œå˜é‡ã€‚ </font></font><br><br><pre> <code class="hljs cpp"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf StandardSpecular fullforwardshadows vertex:vert â€¦ half _Glossiness; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// half _Metallic; fixed3 _Specular; fixed4 _Color; half3 _BackgroundColor;</span></span></span></span></code> </pre> <br> <code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜éœ€è¦ä¸€ä¸ªç»„ä»¶ã€‚</font><font style="vertical-align: inherit;">ç”±äºâ€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ç´ â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“åˆäº†æ¯ä¸ªé¡¶ç‚¹çš„å¯è§æ€§ï¼Œå› æ­¤ä»…éœ€è¦ä¸€ä¸ªæµ®ç‚¹å€¼ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªã€‚</font></font><br><br><pre> <code class="hljs swift"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float2 uv_MainTex; float2 visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>vert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿å…¶æ˜ç¡®ç”¨äºå¯è§æ€§æ•°æ®</font></font><code>data.visibility.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶ååˆ†é…</font></font><code>data.visibility.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç ”ç©¶æ•°æ®</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">å€¼ã€‚</font></font><br><br><pre> <code class="hljs kotlin"> void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { â€¦ float4 cellData = GetCellData(cellDataCoordinates); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cellData.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cellData.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿å…¶ä½¿ç”¨æ–°æ•°æ®ï¼Œä¾‹å¦‚</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; o.Albedo = c.rgb * (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x * explored); // o.Metallic = _Metallic; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Emission = _BackgroundColor * (<span class="hljs-number"><span class="hljs-number">1</span></span> - explored); o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d13/863/dc6/d13863dc60bbb92750cd5c8f8b69d82b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšè—çš„æ•‘æµç‰©ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšè—æ°´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥æ˜¯â€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œâ€œ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´å²¸â€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆå°†å®ƒä»¬è½¬æ¢ä¸ºé•œé¢ç€è‰²å™¨ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå®ƒä»¬ä¸éœ€è¦èƒŒæ™¯è‰²ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é€æ˜çš„ç€è‰²å™¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¬æ¢åï¼Œå†æ·»åŠ </font></font><code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªç»„ä»¶å¹¶ç›¸åº”åœ°è¿›è¡Œæ›´æ”¹</font></font><code>vert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸¤ä¸ªç€è‰²å™¨ç»„åˆæ¥è‡ªä¸‰ä¸ªå•å…ƒçš„æ•°æ®ã€‚</font></font><br><br><pre> <code class="hljs dos"> struct Input { â€¦ float2 visibility; }; â€¦ void vert (inout appdata_full v, out Input data) { â€¦ data.visibility.x = cell0.x * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.x + cell1.x * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.y + cell2.x * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.z; data.visibility.x = lerp(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility.x); data.visibility.y = cell0.y * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.x + cell1.y * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.y + cell2.y * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.z; }</code> </pre> <br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Water Shore</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰§è¡Œ</font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸åŒçš„æ“ä½œï¼Œä½†ä»¥ç›¸åŒçš„æ–¹å¼è®¾ç½®å…¶è¡¨é¢å±æ€§ã€‚</font><font style="vertical-align: inherit;">ç”±äºå®ƒä»¬æ˜¯é€æ˜çš„ï¼Œå› æ­¤æˆ‘ä»¬å°†</font></font><code>explore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨Alphaé€šé“ä¸­åŠ ä»¥è€ƒè™‘ï¼Œå¹¶ä¸”ä¸ä¼šè®¾ç½®å‘å°„ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { â€¦ <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = ca * explored; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15a/e39/390/15ae39390ccbe91f3d12f068992a7c14.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšè—çš„æ°´ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬éšè—æ²³å£ï¼Œæ²³æµå’Œé“è·¯ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜æœ‰</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³å£</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²³æµ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é“è·¯</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç€è‰²å™¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸‰ä¸ªéƒ½æ˜¯é€æ˜çš„ï¼Œå¹¶ä¸”åˆå¹¶äº†ä¸¤ä¸ªå•å…ƒæ ¼çš„æ•°æ®ã€‚</font><font style="vertical-align: inherit;">å°†å®ƒä»¬å…¨éƒ¨åˆ‡æ¢ä¸ºé•œé¢åå°„ï¼Œç„¶åå°†å®ƒä»¬æ·»åŠ åˆ°</font></font><code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç ”ç©¶æ•°æ®ä¸­ã€‚</font></font><br><br><pre> <code class="hljs kotlin"> struct Input { â€¦ float2 visibility; }; â€¦ void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cell0.x * v.color.x + cell1.x * v.color.y; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cell0.y * v.color.x + cell1.y * v.color.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹</font><em><font style="vertical-align: inherit;">æ²³å£</font></em><font style="vertical-align: inherit;">å’Œ</font><em><font style="vertical-align: inherit;">æ²³æµ</font></em></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç€è‰²å™¨</font><font style="vertical-align: inherit;">çš„åŠŸèƒ½ï¼Œä»¥</font><font style="vertical-align: inherit;">ä½¿å…¶ä½¿ç”¨æ–°æ•°æ®ã€‚</font><font style="vertical-align: inherit;">ä¸¤è€…éƒ½éœ€è¦è¿›è¡Œç›¸åŒçš„æ›´æ”¹ã€‚</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { â€¦ <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; fixed4 c = saturate(_Color + water); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = ca * explored; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Road</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†é¢å¤–çš„æ··åˆæŒ‡æ ‡ã€‚</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); fixed4 c = _Color * ((noise.y * <span class="hljs-number"><span class="hljs-number">0.75</span></span> + <span class="hljs-number"><span class="hljs-number">0.25</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x); <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x; blend *= noise.x + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; blend = smoothstep(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, blend); <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; o.Albedo = c.rgb; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = blend * explored; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c6/1d2/c65/1c61d2c652b436385b42188c39476c14.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€åˆ‡éƒ½æ˜¯éšè—çš„ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¿å…æœªå¼€å‘çš„ç»†èƒ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æ‰€æœ‰æœªçŸ¥çš„å†…å®¹éƒ½åœ¨è§†è§‰ä¸Šéšè—äº†ï¼Œä½†æ˜¯åœ¨æœç´¢è·¯å¾„æ—¶ä¸ä¼šè€ƒè™‘ç ”ç©¶çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œå¯ä»¥å‘½ä»¤å•ä½åœ¨æœªæ¢ç´¢çš„å•å…ƒä¹‹é—´ç§»åŠ¨ï¼Œç¥å¥‡åœ°ç¡®å®šäº†ç§»åŠ¨çš„æ–¹å‘ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å¼ºè¿«éƒ¨é˜Ÿé¿å…æœªå¼€å‘çš„ç»†èƒã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca9/eb9/f22/ca9eb9f22cd36b917bd5f0c38028bce7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµè§ˆæœªå¼€å‘çš„å•å…ƒæ ¼ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°é˜Ÿå†³å®šæ¬å®¶çš„æˆæœ¬ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹‹å‰è¿›å…¥æœªå¼€å‘çš„ç”µæ± ï¼Œè®©æˆ‘ä»¬è¿”å·¥çš„ä»£ç è½¬ç§»æˆæœ¬çš„è¿åŠ¨</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨</font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ç®€åŒ–å¯¹å…·æœ‰ä¸åŒç§»åŠ¨è§„åˆ™çš„å•ä½çš„æ”¯æŒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ åˆ°</font><font style="vertical-align: inherit;">ç¡®å®šç§»åŠ¨æˆæœ¬</font><font style="vertical-align: inherit;">çš„</font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šç”¨æ–¹æ³•</font></font><code>GetMoveCost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­ã€‚</font><font style="vertical-align: inherit;">ä»–éœ€è¦çŸ¥é“å“ªäº›å•å…ƒæ ¼åœ¨å®ƒä»¬ä¹‹é—´ç§»åŠ¨ä»¥åŠæ–¹å‘ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¤åˆ¶ç›¸åº”çš„ä»£ç ï¼Œä»¥æ”¯ä»˜ä»</font></font><code>HexGrid.Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿ç§»åˆ°æ­¤æ–¹æ³•</font><font style="vertical-align: inherit;">çš„æˆæœ¬ï¼Œ</font><font style="vertical-align: inherit;">å¹¶æ›´æ”¹å˜é‡åç§°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMoveCost</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexCell fromCell, HexCell toCell, HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { HexEdgeType edgeType = fromCell.GetEdgeType(toCell); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edgeType == HexEdgeType.Cliff) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> moveCost; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.HasRoadThroughEdge(direction)) { moveCost = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.Walled != toCell.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { moveCost = edgeType == HexEdgeType.Flat ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>; moveCost += toCell.UrbanLevel + toCell.FarmLevel + toCell.PlantLevel; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥æ–¹æ³•åº”è¿”å›ç§»åŠ¨æˆæœ¬ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä½¿ç”¨æ—§ä»£ç è·³è¿‡æ— æ•ˆåŠ¨ä½œ</font></font><code>continue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•åœ¨è¿™é‡Œè¡Œä¸é€šã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ— æ³•ç§»åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é€€å›ç§»åŠ¨çš„è´Ÿæˆæœ¬ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMoveCost</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexCell fromCell, HexCell toCell, HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { HexEdgeType edgeType = fromCell.GetEdgeType(toCell); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edgeType == HexEdgeType.Cliff) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> moveCost; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.HasRoadThroughEdge(direction)) { moveCost = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.Walled != toCell.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { moveCost = edgeType == HexEdgeType.Flat ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>; moveCost += toCell.UrbanLevel + toCell.FarmLevel + toCell.PlantLevel; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveCost; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦çŸ¥é“ä½•æ—¶æŸ¥æ‰¾è·¯å¾„ï¼Œä¸ä»…æ˜¯é€Ÿåº¦ï¼Œè¿˜åŒ…æ‹¬æ‰€é€‰å•ä½ã€‚</font><font style="vertical-align: inherit;">ç›¸åº”åœ°æ›´æ”¹</font></font><code>HexGameUI.DoPathFinding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoPathfinding</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UpdateCurrentCell()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentCell &amp;&amp; selectedUnit.IsValidDestination(currentCell)) { grid.FindPath(selectedUnit.Location, currentCell, selectedUnit); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { grid.ClearPath(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨å°é˜Ÿé€Ÿåº¦ï¼Œå› æ­¤æˆ‘ä»¬å°†æ·»åŠ åˆ°</font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§ä¸­</font></font><code>Speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è™½ç„¶å®ƒå°†è¿”å›ä¸€ä¸ªæ’å®šå€¼24ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Speed { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜åŒ–</font></font><code>FindPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶ä¸”</font></font><code>Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ä»–ä»¬èƒ½å¤Ÿä¸æˆ‘ä»¬çš„æ–°æ–¹æ³•çš„å·¥ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, HexCell toCell, HexUnit unit</span></span></span><span class="hljs-function">)</span></span> { ClearPath(); currentPathFrom = fromCell; currentPathTo = toCell; currentPathExists = Search(fromCell, toCell, unit); ShowPath(unit.Speed); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Search</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, HexCell toCell, HexUnit unit</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> speed = unit.Speed; â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»</font></font><code>Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®å®šæ˜¯å¦å¯ä»¥ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•å…ƒæ ¼ä»¥åŠç§»åŠ¨æˆæœ¬æ˜¯å¤šå°‘</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">æ—§ä»£ç ä¸­</font><font style="vertical-align: inherit;">åˆ é™¤</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å°†è°ƒç”¨</font></font><code>HexUnit.IsValidDestination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>HexUnit.GetMoveCost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœç§»åŠ¨æˆæœ¬ä¸ºè´Ÿï¼Œæˆ‘ä»¬å°†è·³è¿‡è¯¥å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || neighbor.SearchPhase &gt; searchFrontierPhase ) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// if (neighbor.IsUnderwater || neighbor.Unit) { // continue; // } // HexEdgeType edgeType = current.GetEdgeType(neighbor); // if (edgeType == HexEdgeType.Cliff) { // continue; // } // int moveCost; // if (current.HasRoadThroughEdge(d)) { // moveCost = 1; // } // else if (current.Walled != neighbor.Walled) { // continue; // } // else { // moveCost = edgeType == HexEdgeType.Flat ? 5 : 10; // moveCost += neighbor.UrbanLevel + neighbor.FarmLevel + // neighbor.PlantLevel; // } if (!unit.IsValidDestination(neighbor)) { continue; } int moveCost = unit.GetMoveCost(current, neighbor, d); if (moveCost &lt; 0) { continue; } int distance = current.Distance + moveCost; int turn = (distance - 1) / speed; if (turn &gt; currentTurn) { distance = turn * speed + moveCost; } â€¦ }</span></span></code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»•è¿‡æœªå¼€å‘çš„åŒºåŸŸ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é¿å…æœªæ¢ç´¢çš„ç»†èƒï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ç¡®ä¿</font></font><code>HexUnit.IsValidDestination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥ç»†èƒæ˜¯å¦å·²æ£€æŸ¥</font><font style="vertical-align: inherit;">å°±è¶³å¤Ÿ</font><font style="vertical-align: inherit;">äº†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell.IsExplored &amp;&amp; !cell.IsUnderwater &amp;&amp; !cell.Unit; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a84/831/2c6/a848312c6231a168a966e4cdafc2df38.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´å¤šå•ä½å°†æ— æ³•è¿›å…¥æœªå¼€å‘çš„å•å…ƒã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæœªå¼€å‘çš„å•å…ƒä¸å†æ˜¯æœ‰æ•ˆçš„ç«¯ç‚¹ï¼Œå› æ­¤å°é˜Ÿåœ¨ç§»è‡³ç«¯ç‚¹æ—¶ä¼šé¿å…ä½¿ç”¨å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">å°±æ˜¯è¯´ï¼Œæœªå¼€å‘çš„åŒºåŸŸå……å½“äº†é˜»ç¢è·¯å¾„çš„éšœç¢ï¼Œç”šè‡³å»¶é•¿äº†è·¯å¾„çš„å¯èƒ½æ€§ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†é¦–å…ˆæ¢ç´¢è¯¥åœ°åŒºï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿è¿™äº›å•ä½é è¿‘æœªçŸ¥çš„åœ°å½¢ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­å‡ºç°ä¸€æ¡è¾ƒçŸ­çš„è·¯å¾„æ€ä¹ˆåŠï¼Ÿ</font></font></b> <div class="spoiler_text">                .           ,        .       . <br><br>   ,        ,            .            ,    . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬22éƒ¨åˆ†ï¼šå¢å¼ºçš„å¯è§æ€§ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹³ç¨³åœ°æ›´æ”¹å¯è§æ€§ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨å•å…ƒæ ¼çš„é«˜åº¦ç¡®å®šèŒƒå›´ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšè—åœ°å›¾çš„è¾¹ç¼˜ã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é€šè¿‡å¢åŠ å¯¹åœ°å›¾æ¢ç´¢çš„æ”¯æŒï¼Œæˆ‘ä»¬å°†æ”¹å–„èŒƒå›´çš„è®¡ç®—å’Œè½¬æ¢ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/c4a/793/2d2c4a7939e75fe09298f96ff6125478.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦çœ‹å¾—æ›´è¿œï¼Œè¯·çˆ¬ä¸Šæ›´é«˜çš„ä½ç½®ã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯è§æ€§è½¬æ¢ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥å•å…ƒæ ¼æ˜¯å¯è§çš„è¿˜æ˜¯ä¸å¯è§çš„ï¼Œå› ä¸ºå®ƒæ˜¯å¦åœ¨åˆ†ç¦»èŒƒå›´ä¹‹å†…ã€‚</font><font style="vertical-align: inherit;">å³ä½¿è¯¥å•å…ƒä¼¼ä¹éœ€è¦ä¸€äº›æ—¶é—´åœ¨å•å…ƒä¹‹é—´ç§»åŠ¨ï¼Œå®ƒçš„è§†åœºä¹Ÿä¼šç«‹å³åœ¨å•å…ƒä¹‹é—´è·³è·ƒã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œå‘¨å›´ç»†èƒçš„å¯è§æ€§æ€¥å‰§å˜åŒ–ã€‚</font><font style="vertical-align: inherit;">å°é˜Ÿçš„ç§»åŠ¨ä¼¼ä¹å¾ˆå¹³ç¨³ï¼Œä½†æ˜¯èƒ½è§åº¦çš„å˜åŒ–å´æ˜¯çªç„¶çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç†æƒ³æƒ…å†µä¸‹ï¼Œå¯è§æ€§ä¹Ÿåº”å¹³ç¨³å˜åŒ–ã€‚</font><font style="vertical-align: inherit;">è¿›å…¥å¯è§åŒºåŸŸåï¼Œåº”é€æ¸ç…§äº®ç»†èƒï¼Œå¹¶ä½¿å…¶é€æ¸å˜æš—ã€‚</font><font style="vertical-align: inherit;">è¿˜æ˜¯æ‚¨æ›´å–œæ¬¢å³æ—¶è½¬æ¢ï¼Ÿ</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ åˆ°</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ‡æ¢å³æ—¶è½¬æ¢</font><font style="vertical-align: inherit;">çš„</font><font style="vertical-align: inherit;">å±æ€§ã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ¸¡æ˜¯å¹³æ»‘çš„ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ImmediateMode { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿‡æ¸¡ç»†èƒè¿½è¸ª </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å³ä½¿æ˜¾ç¤ºå¹³æ»‘çš„è¿‡æ¸¡ï¼ŒçœŸå®çš„å¯è§æ€§æ•°æ®ä»ç„¶ä¿æŒäºŒè¿›åˆ¶ï¼Œå³æ•ˆæœåªæ˜¯è§†è§‰ä¸Šçš„ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€å¿…é¡»å¤„ç†å¯è§æ€§è½¬æ¢</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸ºå…¶æä¾›æ‰§è¡Œè½¬æ¢çš„å•å…ƒæ ¼åˆ—è¡¨ã€‚</font><font style="vertical-align: inherit;">ç¡®ä¿åœ¨æ¯æ¬¡åˆå§‹åŒ–æ—¶ä¸ºç©ºã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexCellShaderData</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { Texture2D cellTexture; Color32[] cellTextureData; List&lt;HexCell&gt; transitioningCells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;HexCell&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ImmediateMode { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ transitioningCells.Clear(); enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å‰ï¼Œæˆ‘ä»¬æ­£åœ¨</font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´æ¥</font><font style="vertical-align: inherit;">è®¾ç½®å•å…ƒæ ¼æ•°æ®</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯¹äºå³æ—¶è¿‡æ¸¡æ¨¡å¼ï¼Œè¿™ä»ç„¶æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å½“ç¦ç”¨å®ƒæ—¶ï¼Œå¿…é¡»å°†ä¸€ä¸ªå•å…ƒæ ¼æ·»åŠ åˆ°è¿‡æ¸¡å•å…ƒæ ¼åˆ—è¡¨ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ImmediateMode) { cellTextureData[index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; cellTextureData[index].g = cell.IsExplored ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { transitioningCells.Add(cell); } enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯è§æ€§ä¼¼ä¹ä¸å†èµ·ä½œç”¨ï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸å¯¹åˆ—è¡¨ä¸­çš„å•å…ƒæ ¼åšä»»ä½•äº‹æƒ…ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¾ªç¯éå†å•å…ƒæ ¼ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€Œä¸æ˜¯ç«‹å³å°†ç›¸åº”çš„å€¼è®¾ç½®ä¸º255æˆ–0ï¼Œæˆ‘ä»¬å°†é€æ¸å¢å¤§/å‡å°è¿™äº›å€¼ã€‚</font><font style="vertical-align: inherit;">è¿‡æ¸¡çš„å¹³æ»‘åº¦å–å†³äºå˜åŒ–ç‡ã€‚</font><font style="vertical-align: inherit;">å®ƒä¸åº”è¯¥å¾ˆå¿«ä¹Ÿä¸åº”è¯¥å¾ˆæ…¢ã€‚</font><font style="vertical-align: inherit;">æ¼‚äº®çš„è¿‡æ¸¡ä¸æ¸¸æˆä¾¿åˆ©æ€§ä¹‹é—´çš„ä¸€ä¸ªå¾ˆå¥½çš„æŠ˜è¡·æ˜¯åœ¨ä¸€ç§’é’Ÿå†…æ”¹å˜ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä¸ºæ­¤è®¾ç½®ä¸€ä¸ªå¸¸é‡ï¼Œä»¥ä½¿å…¶æ›´å®¹æ˜“æ›´æ”¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> transitionSpeed = <span class="hljs-number"><span class="hljs-number">255f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œ</font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥å®šä¹‰åº”ç”¨äºå€¼çš„å¢é‡ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œå°†æ—¶é—´å¢é‡ä¹˜ä»¥é€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">å®ƒå¿…é¡»æ˜¯æ•´æ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å®ƒçš„å¤§å°ã€‚</font><font style="vertical-align: inherit;">å¸§é€Ÿç‡çš„æ€¥å‰§ä¸‹é™ä¼šä½¿å¢é‡è¶…è¿‡255ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œåœ¨æœ‰è¿‡æ¸¡å•å…ƒçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ›´æ–°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå½“åˆ—è¡¨ä¸­åŒ…å«æŸäº›å†…å®¹æ—¶ï¼Œåº”åŒ…æ‹¬è¯¥ä»£ç ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Time.deltaTime * transitionSpeed); cellTexture.SetPixels32(cellTextureData); cellTexture.Apply(); enabled = transitioningCells.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç†è®ºä¸Šä¹Ÿå¯èƒ½éå¸¸é«˜çš„å¸§é€Ÿç‡ã€‚</font><font style="vertical-align: inherit;">ç»“åˆè¾ƒä½çš„è¿‡æ¸¡é€Ÿåº¦ï¼Œè¿™å¯ä»¥ä½¿æˆ‘ä»¬å¾—åˆ°0çš„å˜åŒ–é‡ã€‚è¦è¿›è¡Œæ›´æ”¹ï¼Œæˆ‘ä»¬å°†å˜åŒ–é‡æœ€å°å€¼æœ€å°å€¼è®¾ä¸º1ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Time.deltaTime * transitionSpeed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta == <span class="hljs-number"><span class="hljs-number">0</span></span>) { delta = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¶åˆ°å¢é‡åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰è¿‡æ¸¡å•å…ƒå‘¨å›´å¾ªç¯å¹¶æ›´æ–°å…¶æ•°æ®ã€‚</font><font style="vertical-align: inherit;">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹æ³•</font></font><code>UpdateCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå…¶å‚æ•°æ˜¯ç›¸åº”çš„åƒå…ƒå’Œå¢é‡ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Time.deltaTime * transitionSpeed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta == <span class="hljs-number"><span class="hljs-number">0</span></span>) { delta = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; transitioningCells.Count; i++) { UpdateCellData(transitioningCells[i], delta); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æŸä¸ªæ—¶å€™ï¼Œå•å…ƒæ ¼è¿‡æ¸¡åº”è¯¥å®Œæˆã€‚</font><font style="vertical-align: inherit;">å‡å®šè¯¥æ–¹æ³•è¿”å›æœ‰å…³è¿‡æ¸¡æ˜¯å¦ä»åœ¨è¿›è¡Œçš„ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">å½“å®ƒåœæ­¢è¿›è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»åˆ—è¡¨ä¸­åˆ é™¤è¯¥å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»å‡å°è¿­ä»£å™¨ï¼Œä»¥å…è·³è¿‡å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; transitioningCells.Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!UpdateCellData(transitioningCells[i], delta)) { transitioningCells.RemoveAt(i--); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‡æ¸¡å•å…ƒçš„å¤„ç†é¡ºåºå¹¶ä¸é‡è¦ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¿…åˆ é™¤å½“å‰ç´¢å¼•å¤„çš„å•å…ƒæ ¼ï¼Œè¿™å°†è¿«ä½¿</font></font><code>RemoveAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€æœ‰å•å…ƒæ ¼</font><font style="vertical-align: inherit;">åœ¨</font><font style="vertical-align: inherit;">å…¶åç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å°†æœ€åä¸€ä¸ªå•å…ƒæ ¼ç§»åˆ°å½“å‰ç´¢å¼•ï¼Œç„¶ååˆ é™¤æœ€åä¸€ä¸ªã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!UpdateCellData(transitioningCells[i], delta)) { transitioningCells[i--] = transitioningCells[transitioningCells.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>]; transitioningCells.RemoveAt(transitioningCells.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–¹æ³•</font></font><code>UpdateCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¦å®Œæˆä»–çš„å·¥ä½œï¼Œä»–å°†éœ€è¦ä¸€ä¸ªç´¢å¼•å’Œå•å…ƒæ ¼æ•°æ®ï¼Œå› æ­¤è®©æˆ‘ä»¬ä»è·å–å®ƒä»¬å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">å®ƒè¿˜åº”ç¡®å®šæ˜¯å¦ç»§ç»­æ›´æ–°å•å…ƒã€‚</font><font style="vertical-align: inherit;">é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å‡å®šæ²¡æœ‰å¿…è¦ã€‚</font><font style="vertical-align: inherit;">å·¥ä½œå®Œæˆåï¼Œæœ‰å¿…è¦åº”ç”¨æ›´æ”¹çš„æ•°æ®å¹¶è¿”å›çŠ¶æ€â€œæ›´æ–°æ­£åœ¨ç»§ç»­â€ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; Color32 data = cellTextureData[index]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> stillUpdating = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; cellTextureData[index] = data; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stillUpdating; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ›´æ–°å•å…ƒæ ¼æ•°æ® </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£åœ¨è¿‡æ¸¡æˆ–å·²ç»å®Œæˆçš„å•å…ƒã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥å•å…ƒæ¢é’ˆçš„çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ£€æŸ¥äº†è¯¥å•å…ƒæ ¼ï¼Œä½†å…¶Gå€¼å°šæœªç­‰äº255ï¼Œåˆ™å®ƒå¤„äºè½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œç›‘è§†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> stillUpdating = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsExplored &amp;&amp; data.g &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } cellTextureData[index] = data;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†æ‰§è¡Œè¿‡æ¸¡ï¼Œæˆ‘ä»¬å°†å‘è¯¥å•å…ƒæ ¼çš„Gå€¼æ·»åŠ ä¸€ä¸ªå¢é‡ã€‚</font><font style="vertical-align: inherit;">ç®—æœ¯è¿ç®—ä¸é€‚ç”¨äºå­—èŠ‚ï¼Œå®ƒä»¬é¦–å…ˆè½¬æ¢ä¸ºæ•´æ•°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ€»å’Œå°†ä¸ºæ•´æ•°æ ¼å¼ï¼Œå¿…é¡»å°†å…¶è½¬æ¢ä¸ºå­—èŠ‚ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsExplored &amp;&amp; data.g &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.g + delta; data.g = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½†æ˜¯åœ¨è½¬æ¢ä¹‹å‰ï¼Œæ‚¨éœ€è¦ç¡®ä¿è¯¥å€¼ä¸è¶…è¿‡255ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.g + delta; data.g = t &gt;= <span class="hljs-number"><span class="hljs-number">255</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¯è§æ€§è¿›è¡Œç›¸åŒçš„æ“ä½œï¼Œå®ƒä½¿ç”¨Rçš„å€¼ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsExplored &amp;&amp; data.g &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { â€¦ } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsVisible &amp;&amp; data.r &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.r + delta; data.r = t &gt;= <span class="hljs-number"><span class="hljs-number">255</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºå•å…ƒæ ¼å¯ä»¥å†æ¬¡å˜ä¸ºä¸å¯è§ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å¿…è¦å‡å°Rçš„å€¼ã€‚å½“å•å…ƒæ ¼ä¸å¯è§ä½†Rå¤§äºé›¶æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsVisible) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.r &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.r + delta; data.r = t &gt;= <span class="hljs-number"><span class="hljs-number">255</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.r &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.r - delta; data.r = t &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å·²ç»</font></font><code>UpdateCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡†å¤‡å°±ç»ªï¼Œå¯è§æ€§è½¬æ¢å·²æ­£ç¡®æ‰§è¡Œã€‚</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯è§æ€§è½¬æ¢ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é˜²æ­¢é‡å¤çš„è¿‡æ¸¡å…ƒç´  </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¬æ¢æœ‰æ•ˆï¼Œä½†é‡å¤çš„é¡¹ç›®å¯èƒ½ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå•å…ƒæ ¼çš„å¯è§çŠ¶æ€åœ¨è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå½“å°é˜Ÿç§»åŠ¨æœŸé—´ä»…åœ¨çŸ­æ—¶é—´å†…å¯è§è¯¥å•å…ƒæ ¼æ—¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå‡ºç°äº†é‡å¤çš„å…ƒç´ ï¼Œå› æ­¤æ¯å¸§ä¼šå¯¹å•å…ƒæ ¼è¿‡æ¸¡è¿›è¡Œå‡ æ¬¡æ›´æ–°ï¼Œä»è€ŒåŠ å¿«äº†è¿‡æ¸¡é€Ÿåº¦å¹¶å¢åŠ äº†å·¥ä½œé‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ·»åŠ å•å…ƒæ ¼ä¹‹å‰æ£€æŸ¥å®ƒæ˜¯å¦å·²ç»åœ¨åˆ—è¡¨ä¸­æ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæ¯ä¸ªç”µè¯éƒ½ä¼šè¿›è¡Œåˆ—è¡¨æœç´¢</font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆæœ¬å¾ˆé«˜ï¼Œå°¤å…¶æ˜¯åœ¨æ‰§è¡Œå¤šä¸ªå•å…ƒè½¬æ¢æ—¶ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å¦ä¸€ä¸ªå°šæœªç”¨äºæŒ‡ç¤ºå•å…ƒæ ¼æ˜¯å¦å¤„äºè¿‡æ¸¡è¿‡ç¨‹ä¸­çš„é€šé“ï¼Œä¾‹å¦‚å€¼B.å°†å•å…ƒæ ¼æ·»åŠ åˆ°åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬å°†ä¸ºå…¶åˆ†é…å€¼255ï¼Œå¹¶ä»…æ·»åŠ å€¼ä¸ç­‰äº255çš„é‚£äº›å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ImmediateMode) { cellTextureData[index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; cellTextureData[index].g = cell.IsExplored ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellTextureData[index].b != <span class="hljs-number"><span class="hljs-number">255</span></span>) { cellTextureData[index].b = <span class="hljs-number"><span class="hljs-number">255</span></span>; transitioningCells.Add(cell); } enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å•å…ƒæ ¼è½¬æ¢å®Œæˆåé‡ç½®Bçš„å€¼ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!stillUpdating) { data.b = <span class="hljs-number"><span class="hljs-number">0</span></span>; } cellTextureData[index] = data; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stillUpdating; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰é‡å¤çš„è¿‡æ¸¡ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å³æ—¶åŠ è½½å¯è§æ€§ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå³ä½¿åœ¨åŠ è½½åœ°å›¾æ—¶ï¼Œå¯è§æ€§æ›´æ”¹ä¹Ÿå§‹ç»ˆæ˜¯æ¸è¿›çš„ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸åˆé€»è¾‘çš„ï¼Œå› ä¸ºåœ°å›¾æè¿°äº†å·²ç»å¯è§ç»†èƒçš„çŠ¶æ€ï¼Œå› æ­¤æ­¤å¤„çš„è¿‡æ¸¡æ˜¯ä¸åˆé€‚çš„ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œå¯¹å¤§å‹åœ°å›¾çš„è®¸å¤šå¯è§å•å…ƒæ‰§è¡Œè¿‡æ¸¡å¯èƒ½ä¼šå‡æ…¢åŠ è½½åçš„æ¸¸æˆé€Ÿåº¦ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨åŠ è½½åƒå…ƒå’Œå°é˜Ÿä¹‹å‰ï¼Œè®©æˆ‘ä»¬åˆ‡æ¢</font></font><code>HexGrid.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°å³æ—¶è½¬æ¢æ¨¡å¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { â€¦ cellShaderData.ImmediateMode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].Load(reader, header); } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†é‡æ–°å®šä¹‰å³æ—¶è¿‡æ¸¡æ¨¡å¼çš„åˆå§‹è®¾ç½®ï¼Œæ— è®ºå®ƒæ˜¯ä»€ä¹ˆã€‚</font><font style="vertical-align: inherit;">ä¹Ÿè®¸å®ƒå·²ç»è¢«å…³é—­ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šè®°ä½åˆå§‹æ¨¡å¼ï¼Œå¹¶åœ¨å·¥ä½œå®Œæˆååˆ‡æ¢åˆ°å®ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> originalImmediateMode = cellShaderData.ImmediateMode; cellShaderData.ImmediateMode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; â€¦ cellShaderData.ImmediateMode = originalImmediateMode; }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é«˜åº¦èŒƒå›´ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰å•å…ƒéƒ½ä½¿ç”¨äº†æ’å®šçš„ä¸‰ä¸ªèŒƒå›´ï¼Œä½†å®é™…ä¸Šæ›´å¤æ‚ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”±äºä¸¤ä¸ªåŸå› ï¼Œæˆ‘ä»¬æ— æ³•çœ‹åˆ°å¯¹è±¡ï¼šæŸä¸ªéšœç¢é˜»æ­¢äº†æˆ‘ä»¬çœ‹åˆ°å®ƒï¼Œæˆ–è€…å¯¹è±¡å¤ªå°æˆ–å¤ªè¿œã€‚åœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ä»…å®ç°èŒƒå›´é™åˆ¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çœ‹ä¸åˆ°åœ°çƒå¦ä¸€ä¾§çš„äº‹ç‰©ï¼Œå› ä¸ºè¡Œæ˜Ÿä½¿æˆ‘ä»¬è’™æ˜§ã€‚æˆ‘ä»¬åªèƒ½çœ‹åˆ°åœ°å¹³çº¿ã€‚ç”±äºè¡Œæ˜Ÿå¯ä»¥è¿‘ä¼¼åœ°è§†ä¸ºçƒä½“ï¼Œå› æ­¤è§†è§’è¶Šé«˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„è¡¨é¢è¶Šå¤šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ°å¹³çº¿å–å†³äºé«˜åº¦ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/071/788/208/0717882082a42e92b14e158876c6e28b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å¹³çº¿å–å†³äºè§†ç‚¹çš„é«˜åº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å•ä½çš„èƒ½è§åº¦æœ‰é™ï¼Œæ¨¡ä»¿äº†åœ°çƒæ›²ç‡äº§ç”Ÿçš„åœ°å¹³çº¿æ•ˆåº”ã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬çš„å®¡æŸ¥èŒƒå›´å–å†³äºè¡Œæ˜Ÿçš„å¤§å°å’Œåœ°å›¾çš„æ¯”ä¾‹ã€‚</font><font style="vertical-align: inherit;">è‡³å°‘è¿™æ˜¯åˆä¹é€»è¾‘çš„è§£é‡Šã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç¼©å°èŒƒå›´çš„ä¸»è¦åŸå› æ˜¯æ¸¸æˆç©æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æˆ˜äº‰è¿·å±€ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œäº†è§£äº†è§†åœºçš„ç‰©ç†åŸç†åï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œé«˜è§†ç‚¹åº”è¯¥å…·æœ‰æˆ˜ç•¥ä»·å€¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ç§»åŠ¨è§†é‡å¹¶å…è®¸æ‚¨æŸ¥çœ‹è¾ƒä½çš„éšœç¢ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°å®ƒã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®¡æŸ¥é«˜åº¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¡®å®šèŒƒå›´æ—¶è¦è€ƒè™‘é«˜åº¦ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">è¿™å°†æ˜¯é€šå¸¸çš„æ°´ä½æˆ–æ°´ä½ï¼Œå…·ä½“å–å†³äºé™†åœ°ç»†èƒè¿˜æ˜¯æ°´ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§ä¸­ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ViewElevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation &gt;= waterLevel ? elevation : waterLevel; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœé«˜åº¦å½±å“èŒƒå›´ï¼Œåˆ™éšç€å•å…ƒæ ¼è§‚å¯Ÿé«˜åº¦çš„å˜åŒ–ï¼Œå¯è§æ€§çŠ¶å†µä¹Ÿå¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚</font><font style="vertical-align: inherit;">ç”±äºå•å…ƒæ ¼å·²é˜»æ­¢æˆ–æ­£åœ¨é˜»æ­¢å¤šä¸ªå•å…ƒçš„ä½œç”¨åŸŸï¼Œå› æ­¤ç¡®å®šéœ€è¦æ›´æ”¹çš„å†…å®¹å¹¶éé‚£ä¹ˆå®¹æ˜“ã€‚</font><font style="vertical-align: inherit;">å•å…ƒæœ¬èº«å°†æ— æ³•è§£å†³æ­¤é—®é¢˜ï¼Œå› æ­¤è¯·è®©å…¶æŠ¥å‘Šæƒ…å†µçš„å˜åŒ–</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å‡è®¾æ‚¨</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ä¸€ç§æ–¹æ³•</font></font><code>ViewElevationChanged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><code>HexCell.Elevation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœ‰å¿…è¦ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åœ¨åˆ†é…åç§°å‘¼å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elevation == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalViewElevation = ViewElevation; elevation = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ViewElevation != originalViewElevation) { ShaderData.ViewElevationChanged(); } â€¦ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ ·çš„é“ç†</font></font><code>WaterLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WaterLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waterLevel == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalViewElevation = ViewElevation; waterLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ViewElevation != originalViewElevation) { ShaderData.ViewElevationChanged(); } ValidateRivers(); Refresh(); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‡ç½®å¯è§æ€§ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–¹æ³•</font></font><code>HexCellShaderData.ViewElevationChanged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç¡®å®šä¸€èˆ¬å¯è§æ€§æƒ…å†µå¦‚ä½•å˜åŒ–æ˜¯ä¸€é¡¹å¤æ‚çš„ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯åœ¨åŒæ—¶æ›´æ”¹å¤šä¸ªå•å…ƒæ ¼æ—¶ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä¼šæå‡ºä»»ä½•æŠ€å·§ï¼Œè€Œåªæ˜¯è®¡åˆ’é‡ç½®æ‰€æœ‰å•å…ƒçš„å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªå¸ƒå°”å­—æ®µä»¥è·Ÿè¸ªæ˜¯å¦æ‰§è¡Œæ­¤æ“ä½œã€‚</font><font style="vertical-align: inherit;">åœ¨æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°å°†å…¶è®¾ç½®ä¸ºtrueå¹¶åŒ…å«ç»„ä»¶ã€‚</font><font style="vertical-align: inherit;">æ— è®ºåŒæ—¶æ›´æ”¹äº†å¤šå°‘ä¸ªå•å…ƒï¼Œè¿™éƒ½ä¼šå¯¼è‡´ä¸€æ¬¡å¤ä½ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> needsVisibilityReset; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewElevationChanged</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { needsVisibilityReset = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦é‡ç½®æ‰€æœ‰å•å…ƒæ ¼çš„å¯è§æ€§å€¼ï¼Œæ‚¨å¿…é¡»æœ‰æƒè®¿é—®å®ƒä»¬ï¼Œè€Œæ‚¨</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰</font><font style="vertical-align: inherit;">è®¿é—®æƒé™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬å§”æ´¾è¿™ä¸ªè´£ä»»</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦æ·»åŠ åˆ°</font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§ï¼Œè¯¥å±æ€§å…è®¸æ‚¨å¼•ç”¨ç½‘æ ¼ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒ</font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥è¯·æ±‚é‡ç½®ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid Grid { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (needsVisibilityReset) { needsVisibilityReset = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Grid.ResetVisibility(); } â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»§ç»­</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><code>HexGrid.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºç€è‰²å™¨æ•°æ®åï¼Œ</font><font style="vertical-align: inherit;">è®¾ç½®åˆ°ç½‘æ ¼çš„é“¾æ¥</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); HexUnit.unitPrefab = unitPrefab; cellShaderData = gameObject.AddComponent&lt;HexCellShaderData&gt;(); cellShaderData.Grid = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; CreateMap(cellCountX, cellCountZ); }</code> </pre> <br> <code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿˜åº”è¯¥è·å¾—ä¸€ç§</font></font><code>ResetVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¢å¼ƒæ‰€æœ‰å•å…ƒæ ¼</font><font style="vertical-align: inherit;">çš„æ–¹æ³•</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åªéœ€ä½¿å…¶éå†å¾ªç¯ä¸­çš„æ‰€æœ‰å•å…ƒï¼Œç„¶åå°†é‡ç½®å§”æ‰˜ç»™å®ƒè‡ªå·±å³å¯ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].ResetVisibility(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦æ·»åŠ è¯¥</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•</font></font><code>ResetVisibilty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒå°†ç®€å•åœ°å°†å¯è§æ€§å½’é›¶å¹¶è§¦å‘å¯è§æ€§æ›´æ–°ã€‚</font><font style="vertical-align: inherit;">å½“å•å…ƒæ ¼å¯è§æ€§å¤§äºé›¶æ—¶ï¼Œå¿…é¡»æ‰§è¡Œæ­¤æ“ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { visibility = <span class="hljs-number"><span class="hljs-number">0</span></span>; ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡ç½®æ‰€æœ‰å¯è§æ€§æ•°æ®åï¼Œ</font></font><code>HexGrid.ResetVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»–å¿…é¡»å†æ¬¡å°†å¯è§æ€§åº”ç”¨äºæ‰€æœ‰å°é˜Ÿï¼Œä¸ºæ­¤ä»–éœ€è¦äº†è§£æ¯ä¸ªå°é˜Ÿçš„èŒƒå›´ã€‚</font><font style="vertical-align: inherit;">å‡è®¾å¯ä»¥ä½¿ç”¨å±æ€§è·å¾—å®ƒ</font></font><code>VisionRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].ResetVisibility(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; units.Count; i++) { HexUnit unit = units[i]; IncreaseVisibility(unit.Location, unit.VisionRange); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†é‡å‘½å</font></font><code>HexUnit.visionRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸º</font><font style="vertical-align: inherit;">é‡æ„å¹¶å°†</font></font><code>HexUnit.VisionRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¶è½¬æ¢ä¸ºå±æ€§ã€‚</font><font style="vertical-align: inherit;">è™½ç„¶å®ƒå°†æ”¶åˆ°3çš„æ’å®šå€¼ï¼Œä½†æ˜¯å°†æ¥å®ƒå°†æ”¹å˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> VisionRange { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨æ›´æ”¹å•å…ƒæ ¼çš„æŸ¥çœ‹é«˜åº¦åï¼Œå¯è§æ€§æ•°æ®å°†è¢«é‡ç½®å¹¶ä¿æŒæ­£ç¡®ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬å¯èƒ½ä¼šæ›´æ”¹ç¡®å®šèŒƒå›´çš„è§„åˆ™ï¼Œå¹¶åœ¨â€œæ’­æ”¾â€æ¨¡å¼ä¸‹è¿è¡Œé‡æ–°ç¼–è¯‘ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿èŒƒå›´ç‹¬ç«‹æ›´æ”¹ï¼Œè®©æˆ‘ä»¬</font></font><code>HexGrid.OnEnable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ£€æµ‹åˆ°é‡æ–°ç¼–è¯‘æ—¶</font><font style="vertical-align: inherit;">è¿›è¡Œä¸€æ¬¡é‡ç½®</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!HexMetrics.noiseSource) { â€¦ ResetVisibility(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ›´æ”¹èŒƒå›´ä»£ç å¹¶æŸ¥çœ‹ç»“æœï¼ŒåŒæ—¶ä¿æŒåœ¨â€œæ’­æ”¾â€æ¨¡å¼ä¸‹ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰©å¤§è§†é‡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®å®šèŒƒå›´çš„è®¡ç®—</font></font><code>HexGrid.GetVisibleCells</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿é«˜åº¦å½±å“èŒƒå›´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡</font></font><code>fromCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸´æ—¶é‡æ–°å®šä¹‰é€å°„åŒºåŸŸ</font><font style="vertical-align: inherit;">æ¥ç®€å•åœ°ä½¿ç”¨æŸ¥çœ‹é«˜åº¦</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ£€æŸ¥æ˜¯å¦å¯è¡Œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">List&lt;HexCell&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVisibleCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { â€¦ range = fromCell.ViewElevation; fromCell.SearchPhase = searchFrontierPhase; fromCell.Distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(fromCell); â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/727/032/6d3/7270326d379796f2b4f2f3c3ca65512c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨é«˜åº¦ä½œä¸ºèŒƒå›´ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯è§æ€§éšœç¢ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…å½“æ‰€æœ‰å…¶ä»–å•å…ƒæ ¼çš„é«˜åº¦éƒ½ä¸ºé›¶æ—¶ï¼Œæ‰èƒ½å°†æŸ¥çœ‹é«˜åº¦ç”¨ä½œèŒƒå›´ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰åƒå…ƒçš„é«˜åº¦éƒ½ä¸è§†ç‚¹ç›¸åŒï¼Œåˆ™è§†åœºåº”ä¸ºé›¶ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œé«˜åº¦è¾ƒé«˜çš„ç‰¢æˆ¿åº”é®æŒ¡åé¢çš„çŸ®ç‰¢æˆ¿çš„å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™è¿˜æ²¡æœ‰å®ç°ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de8/7be/a6f/de87bea6f4b88cd61765450a63f738f9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èŒƒå›´ä¸å¹²æ¶‰ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®å®šèŒƒå›´çš„æœ€æ­£ç¡®æ–¹æ³•æ˜¯é€šè¿‡å°„çº¿çš„å‘å°„è¿›è¡Œæ£€æŸ¥ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¾ˆå¿«ä¼šå˜å¾—æ˜‚è´µï¼Œå¹¶ä¸”ä»ç„¶ä¼šäº§ç”Ÿå¥‡æ€ªçš„ç»“æœã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ä¸€ç§å¿«é€Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥äº§ç”Ÿè¶³å¤Ÿå¥½çš„ç»“æœï¼Œè€Œä¸å¿…æ˜¯å®Œç¾çš„ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œé‡è¦çš„æ˜¯ï¼Œç¡®å®šèŒƒå›´çš„è§„åˆ™å¯¹äºç©å®¶æ¥è¯´å¿…é¡»ç®€å•ï¼Œç›´è§‚å’Œå¯é¢„æµ‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹-ç¡®å®šå•å…ƒæ ¼çš„å¯è§æ€§æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†ç›¸é‚»å•å…ƒæ ¼çš„å¯è§†é«˜åº¦æ·»åŠ åˆ°è¦†ç›–è·ç¦»å†…ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬æŸ¥çœ‹è¿™äº›å•å…ƒæ ¼æ—¶ï¼Œè¿™ä¼šç¼©å°èŒƒå›´ï¼Œå¹¶ä¸”å¦‚æœè·³è¿‡å®ƒä»¬ï¼Œåˆ™å°†ä¸å…è®¸æˆ‘ä»¬åˆ°è¾¾å®ƒä»¬åé¢çš„å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> distance = current.Distance + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distance + neighbor.ViewElevation &gt; range) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/774/44c/efe/77444cefe82d428ee32e094213e82a1a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜æ ¼æŒ¡è§†çº¿ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸åº”è¯¥åœ¨è¿œå¤„çœ‹åˆ°é«˜å¤§çš„ç»†èƒå—ï¼Ÿ</font></font></b> <div class="spoiler_text">      ,     ,   ,   .       ,       . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸è¦å››å¤„å¯»æ‰¾ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œä¼¼ä¹é«˜çš„å•å…ƒæ ¼å°†è§†çº¿é™ä½åˆ°ä½ç‚¹ï¼Œä½†æœ‰æ—¶ç¤ºæ³¢å™¨ä¼šç©¿é€å®ƒä»¬ï¼Œå°½ç®¡ä¼¼ä¹ä¸åº”è¯¥å¦‚æ­¤ã€‚</font><font style="vertical-align: inherit;">å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæœç´¢ç®—æ³•ä»ç„¶ç»•è¿‡é˜»å¡å•å…ƒæ ¼æ‰¾åˆ°äº†è¿™äº›å•å…ƒæ ¼çš„è·¯å¾„ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œçœ‹èµ·æ¥æˆ‘ä»¬çš„å¯è§èŒƒå›´å¯ä»¥ç»•è¿‡éšœç¢ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨ç¡®å®šåƒå…ƒå¯è§æ€§æ—¶ä»…è€ƒè™‘æœ€çŸ­è·¯å¾„ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡åˆ é™¤æ¯”æ‰€éœ€æ—¶é—´æ›´é•¿çš„è·¯å¾„æ¥å®Œæˆã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCoordinates fromCoordinates = fromCell.coordinates; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> distance = current.Distance + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distance + neighbor.ViewElevation &gt; range || distance &gt; fromCoordinates.DistanceTo(neighbor.coordinates) ) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } â€¦ } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30d/bfa/1c2/30dbfa1c2df2fb6119249f00cdc3d8d8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»…ä½¿ç”¨æœ€çŸ­çš„è·¯å¾„ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä¿®å¤äº†å¤§å¤šæ•°æ˜æ˜¾é”™è¯¯çš„æƒ…å†µã€‚å¯¹äºé™„è¿‘çš„å°åŒºï¼Œæ­¤æ–¹æ³•æ•ˆæœå¾ˆå¥½ï¼Œå› ä¸ºåªæœ‰æœ€çŸ­çš„è·¯å¾„å¯ä»¥åˆ°è¾¾å®ƒä»¬ã€‚è·ç¦»æ›´è¿œçš„å•å…ƒå…·æœ‰æ›´å¤šçš„è·¯å¾„é€‰æ‹©ï¼›å› æ­¤ï¼Œåœ¨é•¿è·ç¦»ä¸Šï¼Œå¯è§èŒƒå›´ä»ç„¶å¯èƒ½å‘ç”Ÿã€‚å¦‚æœå¯è§åŒºåŸŸä¿æŒè¾ƒå°å¹¶ä¸”ç›¸é‚»é«˜åº¦ä¹‹é—´çš„å·®å¼‚ä¸å¤ªå¤§ï¼Œè¿™å°†ä¸æ˜¯é—®é¢˜ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬æ²¡æœ‰å–ä»£é€å°„çš„è§†é‡ï¼Œè€Œæ˜¯å¢åŠ äº†è§†é‡çš„é«˜åº¦ã€‚è¯¥å°é˜Ÿè‡ªå·±çš„è§†é‡è¡¨æ˜å…¶é«˜åº¦ï¼Œé£è¡Œé«˜åº¦æˆ–ä¾¦å¯Ÿèƒ½åŠ›ã€‚</font></font><br><br><pre> <code class="cs hljs"> range += fromCell.ViewElevation;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ff/1ce/a2b/3ff1cea2b833bda69990576fa8323aec.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½è§†è§’æŸ¥çœ‹å®Œæ•´è§†é‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œè€ƒè™‘åˆ°ç›¸å¯¹äºè§†ç‚¹çš„åƒå…ƒé«˜åº¦å·®å¼‚ï¼Œæ²¿ç€å¯è§å…‰çš„æœ€çŸ­è·¯å¾„ç§»åŠ¨æ—¶ï¼Œè§†è§‰çš„æœ€ç»ˆè§„åˆ™é€‚ç”¨äºè§†è§‰ã€‚</font><font style="vertical-align: inherit;">å½“å•å…ƒè¶…å‡ºèŒƒå›´æ—¶ï¼Œå®ƒå°†é˜»æ­¢é€šè¿‡å®ƒçš„æ‰€æœ‰è·¯å¾„ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œæ²¡æœ‰ä»»ä½•é˜»ç¢è§†çº¿çš„é«˜è§‚å¯Ÿç‚¹å°±å…·æœ‰äº†æˆ˜ç•¥ä¸Šçš„ä»·å€¼ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜»ç¢å¯¹è±¡çš„å¯è§æ€§å‘¢ï¼Ÿ</font></font></b> <div class="spoiler_text">  ,        ,  . ,  ,        .          . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ— æ³•æ¢ç´¢çš„ç»†èƒ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯è§æ€§çš„æœ€åä¸€ä¸ªé—®é¢˜æ¶‰åŠåœ°å›¾çš„è¾¹ç¼˜ã€‚</font><font style="vertical-align: inherit;">æµ®é›•çªç„¶è¿‡æ¸¡å¹¶ä¸”æ²¡æœ‰è¿‡æ¸¡ç»“æŸï¼Œå› ä¸ºè¾¹ç¼˜çš„å•å…ƒæ²¡æœ‰é‚»å±…ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/587/217/fbb/587217fbb248ae8a13759a33e22e25ff.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å›¾çš„æ ‡è®°è¾¹ç¼˜ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç†æƒ³æƒ…å†µä¸‹ï¼Œæœªå‹˜æ¢åŒºåŸŸå’Œåœ°å›¾è¾¹ç¼˜çš„è§†è§‰æ˜¾ç¤ºåº”ç›¸åŒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¯¹è¾¹ç¼˜è¿›è¡Œä¸‰è§’æµ‹é‡æ—¶ï¼ˆå½“å®ƒä»¬æ²¡æœ‰é‚»å±…æ—¶ï¼‰æ·»åŠ ç‰¹æ®Šæƒ…å†µæ¥å®ç°æ­¤ç›®çš„ï¼Œä½†è¿™å°†éœ€è¦é™„åŠ çš„é€»è¾‘ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†ä¸å¾—ä¸å¤„ç†ç¼ºå°‘çš„åƒå…ƒã€‚å› æ­¤ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆæ˜¯ä¸å¹³å‡¡çš„ã€‚ä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯å¼ºåˆ¶åœ°å›¾çš„è¾¹ç•Œåƒå…ƒå¤„äºæ¢ç´¢èŒƒå›´ä¹‹å†…ï¼Œè€Œå¯¹å…¶è¿›è¡Œæ¢ç´¢ã€‚è¿™ç§æ–¹æ³•è¦ç®€å•å¾—å¤šï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨å®ƒã€‚å®ƒè¿˜å…è®¸æ‚¨å°†æ ‡è®°ä¸ºæœªæ¢ç´¢çš„å•å…ƒæ ¼å’Œå…¶ä»–å•å…ƒæ ¼ï¼Œä»è€Œæ›´å®¹æ˜“å®ç°åœ°å›¾ä¸å‡åŒ€è¾¹ç¼˜çš„åˆ›å»ºã€‚æ­¤å¤–ï¼Œè¾¹ç¼˜å¤„çš„éšè—å•å…ƒæ ¼ä½¿æ‚¨å¯ä»¥åˆ›å»ºè¿›å…¥å’Œç¦»å¼€æ²³æµå’Œé“è·¯åœ°å›¾çš„é“è·¯å’Œæ²³æµï¼Œå› ä¸ºå®ƒä»¬çš„ç«¯ç‚¹å°†ä¸åœ¨èŒƒå›´å†…ã€‚å¦å¤–ï¼Œå€ŸåŠ©æ­¤è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥æ·»åŠ è¿›å…¥å’Œç¦»å¼€åœ°å›¾çš„å•ä½ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†ç»†èƒæ ‡è®°ä¸ºå·²è°ƒæŸ¥ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦æŒ‡ç¤ºå¯ä»¥æ£€æŸ¥ä¸€ä¸ªå•å…ƒæ ¼ï¼Œè¯·æ·»åŠ åˆ°</font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§ä¸­</font></font><code>Explorable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Explorable { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¦‚æœä¸€ä¸ªå•å…ƒæ ¼æ˜¯ç»è¿‡è°ƒæŸ¥çš„å•å…ƒæ ¼ï¼Œåˆ™å¯ä»¥çœ‹åˆ°å®ƒï¼Œå› æ­¤</font></font><code>IsVisible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†</font><font style="vertical-align: inherit;">æ›´æ”¹å±æ€§</font><font style="vertical-align: inherit;">ä»¥è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVisible { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visibility &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Explorable; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒæ ·é€‚ç”¨äº</font></font><code>IsExplored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬è°ƒæŸ¥äº†æ ‡å‡†å±æ€§ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ˜¾å¼å±æ€§ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ›´æ”¹å…¶å¸æ°”å‰‚çš„é€»è¾‘ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExplored { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> explored &amp;&amp; Explorable; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { explored = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } â€¦ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> explored;</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éšè—åœ°å›¾çš„è¾¹ç¼˜ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åœ¨æ–¹æ³•ä¸­éšè—çŸ©å½¢åœ°å›¾çš„è¾¹ç¼˜</font></font><code>HexGrid.CreateCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯¹ä¸åœ¨è¾¹ç¼˜çš„å•å…ƒè¿›è¡Œè°ƒæŸ¥ï¼Œå…¶ä½™æ‰€æœ‰å•å…ƒå‡æœªå¼€å‘ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { â€¦ HexCell cell = cells[i] = Instantiate&lt;HexCell&gt;(cellPrefab); cell.transform.localPosition = position; cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.Index = i; cell.ShaderData = cellShaderData; cell.Explorable = x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; z &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; x &lt; cellCountX - <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; z &lt; cellCountZ - <span class="hljs-number"><span class="hljs-number">1</span></span>; â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¡çš„è¾¹ç¼˜å˜æš—ï¼Œåœ¨å®ƒä»¬åé¢éšè—äº†å·¨å¤§çš„æœªå¼€å‘ç©ºé—´ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œç ”ç©¶çš„åœ°å›¾åŒºåŸŸçš„å¤§å°åœ¨æ¯ä¸ªç»´åº¦ä¸Šå‡å°äº†ä¸¤å€ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/594/19f/353/59419f35345fa4eac3380c4e16461baf.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å›¾çš„æœªå¼€å‘è¾¹ç¼˜ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å¦å¯ä»¥ä½¿ç ”ç©¶çŠ¶æ€å¯ç¼–è¾‘ï¼Ÿ</font></font></b> <div class="spoiler_text"> ,  ,     .          . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœªå¼€å‘çš„ç»†èƒä¼šé˜»ç¢å¯è§æ€§ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œå¦‚æœæ— æ³•æ£€æŸ¥ç»†èƒï¼Œé‚£ä¹ˆå®ƒå°†å¹²æ‰°å¯è§æ€§ã€‚</font><font style="vertical-align: inherit;">è¿›è¡Œæ›´æ”¹</font></font><code>HexGrid.GetVisibleCells</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || neighbor.SearchPhase &gt; searchFrontierPhase || !neighbor.Explorable ) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬23éƒ¨åˆ†ï¼šäº§ç”ŸåœŸåœ° </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”¨ç”Ÿæˆçš„æ™¯è§‚å¡«å……æ–°åœ°å›¾ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬åœ¨æ°´ä¸Šè€•ç§åœŸåœ°ï¼Œåœ¨ä¸€äº›åœ°æ–¹å……æ°´ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬æ§åˆ¶å·²åˆ›å»ºåœŸåœ°çš„æ•°é‡ï¼Œå…¶é«˜åº¦å’Œä¸å¹³å¦åº¦ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å¢åŠ äº†å¯¹å„ç§é…ç½®é€‰é¡¹çš„æ”¯æŒï¼Œä»¥åˆ›å»ºå˜é‡æ˜ å°„ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†å¯ä»¥å†æ¬¡ç”Ÿæˆç›¸åŒçš„åœ°å›¾ã€‚ </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†å°†æ˜¯è¿‡ç¨‹å›¾ç”Ÿæˆç³»åˆ—çš„å¼€å§‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™éƒ¨åˆ†æ˜¯åœ¨Unity 2017.1.0ä¸­åˆ›å»ºçš„ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99e/798/7bb/99e7987bbcb46f1f961b72ba76a78aa0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼—å¤šç”Ÿæˆçš„åœ°å›¾ä¹‹ä¸€ã€‚</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¡ç”Ÿæˆ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å¯ä»¥åˆ›å»ºä»»ä½•åœ°å›¾ï¼Œä½†éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚å¦‚æœè¯¥åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä¸ºè®¾è®¡å¸ˆç”Ÿæˆå¡ç‰‡æ¥å¸®åŠ©è®¾è®¡å¸ˆï¼Œç„¶åä»–å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œåˆ™å°†å¾ˆæ–¹ä¾¿ã€‚æ‚¨å¯ä»¥é‡‡å–å¦ä¸€æ­¥ï¼Œå®Œå…¨æ‘†è„±æ‰‹åŠ¨åˆ›å»ºè®¾è®¡çš„è¿‡ç¨‹ï¼Œå°†ç”Ÿæˆæœ€ç»ˆåœ°å›¾çš„è´£ä»»å®Œå…¨è½¬ç§»åˆ°åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œæ¯æ¬¡å¯ä»¥ä½¿ç”¨æ–°å¡ç©æ¸¸æˆï¼Œå¹¶ä¸”æ¯æ¬¡æ¸¸æˆä¼šè¯éƒ½ä¸åŒã€‚ä¸ºäº†ä½¿æ‰€æœ‰è¿™äº›æˆä¸ºå¯èƒ½ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªåœ°å›¾ç”Ÿæˆç®—æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨éœ€è¦çš„ç”Ÿæˆç®—æ³•çš„ç±»å‹å–å†³äºæ‚¨éœ€è¦çš„å¡çš„ç±»å‹ã€‚æ²¡æœ‰æ­£ç¡®çš„æ–¹æ³•ï¼Œæ‚¨æ€»æ˜¯å¿…é¡»åœ¨ä¿¡èª‰å’Œå¯ç©æ€§ä¹‹é—´å¯»æ±‚æŠ˜è¡·æ–¹æ¡ˆã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦ä½¿ä¸€å¼ çº¸ç‰Œä»¤äººä¿¡æœï¼Œå¯¹äºç©å®¶æ¥è¯´ï¼Œå®ƒå¿…é¡»çœ‹èµ·æ¥å¾ˆæœ‰å¯èƒ½ä¸”çœŸå®ã€‚è¿™å¹¶ä¸æ„å‘³ç€åœ°å›¾åº”è¯¥çœ‹èµ·æ¥åƒæˆ‘ä»¬æ˜Ÿçƒçš„ä¸€éƒ¨åˆ†ã€‚å®ƒå¯èƒ½æ˜¯ä¸åŒçš„æ˜Ÿçƒï¼Œä¹Ÿå¯èƒ½æ˜¯å®Œå…¨ä¸åŒçš„ç°å®ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒåº”è¯¥è¡¨ç¤ºåœ°çƒçš„è§£è„±ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»è‡³å°‘éƒ¨åˆ†ç±»ä¼¼äºåœ°çƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ç©æ€§ä¸çº¸ç‰Œå¦‚ä½•ä¸æ¸¸æˆç©æ³•ç›¸å…³ã€‚æœ‰æ—¶ï¼Œå®ƒä¸å¯ä¿¡åº¦å†²çªã€‚ä¾‹å¦‚ï¼Œå°½ç®¡å±±è„‰çœ‹èµ·æ¥å¾ˆç¾ï¼Œä½†åŒæ—¶å®ƒä»¬æå¤§åœ°é™åˆ¶äº†å•ä½çš„ç§»åŠ¨å’Œè§†é‡ã€‚å¦‚æœè¿™æ˜¯ä¸å¯å–çš„ï¼Œé‚£ä¹ˆæ‚¨å°±å¿…é¡»åœ¨æ²¡æœ‰éšœç¢çš„æƒ…å†µä¸‹åšï¼Œè¿™ä¼šé™ä½ä¿¡èª‰å¹¶é™åˆ¶æ¸¸æˆçš„è¡¨ç°åŠ›ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¯æ•‘å±±è„‰ï¼Œä½†å‡å°‘å®ƒä»¬å¯¹æ¸¸æˆç©æ³•çš„å½±å“ï¼Œè¿™ä¹Ÿå¯ä»¥é™ä½ä¿¡èª‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦å¤–ï¼Œå¿…é¡»è€ƒè™‘å¯è¡Œæ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿæ„é€ æ¿å—ï¼Œä¾µèš€ï¼Œé™é›¨ï¼Œç«å±±å–·å‘ï¼Œé™¨çŸ³å’Œæœˆçƒçš„å½±å“ç­‰æ¥åˆ›å»ºä¸€ä¸ªéå¸¸é€¼çœŸçš„ç±»åœ°çƒè¡Œæ˜Ÿã€‚ä½†æ˜¯å¼€å‘è¿™æ ·çš„ç³»ç»Ÿå°†éœ€è¦å¤§é‡æ—¶é—´ã€‚æ­¤å¤–ï¼Œç”Ÿæˆè¿™æ ·çš„æ˜Ÿçƒå¯èƒ½è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œå¹¶ä¸”ç©å®¶ä¹Ÿä¸æƒ³åœ¨å¼€å§‹æ–°æ¸¸æˆä¹‹å‰ç­‰å¾…å‡ åˆ†é’Ÿã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡æ‹Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä½†å®ƒæœ‰ä»£ä»·ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸¸æˆé€šå¸¸ä¼šåœ¨å¯ä¿¡åº¦ï¼Œå¯ç©æ€§å’Œå¯è¡Œæ€§ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚æœ‰æ—¶ï¼Œè¿™ç§æŠ˜è¡·æ˜¯çœ‹ä¸è§â€‹â€‹çš„ï¼Œçœ‹èµ·æ¥å®Œå…¨æ˜¯æ­£å¸¸çš„ï¼Œè€Œæœ‰æ—¶ï¼Œå®ƒä»¬çœ‹èµ·æ¥æ˜¯éšæœºçš„ï¼Œä¸ä¸€è‡´çš„æˆ–æ··ä¹±çš„ï¼Œå…·ä½“å–å†³äºå¼€å‘è¿‡ç¨‹ä¸­åšå‡ºçš„å†³å®šã€‚è¿™ä¸ä»…é€‚ç”¨äºå¡ç”Ÿæˆï¼Œè€Œä¸”åœ¨å¼€å‘ç¨‹åºå¡ç”Ÿæˆå™¨æ—¶ï¼Œæ‚¨éœ€è¦ç‰¹åˆ«æ³¨æ„è¿™ä¸€ç‚¹ã€‚æ‚¨å¯èƒ½éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´æ¥åˆ›å»ºä¸€ç§ç®—æ³•ï¼Œè¯¥ç®—æ³•å¯ä»¥ç”Ÿæˆæ¼‚äº®çš„å¡ç‰‡ï¼Œè¿™äº›å¡ç‰‡å¯¹äºæ‚¨æ­£åœ¨åˆ›å»ºçš„æ¸¸æˆæ¯«æ— ç”¨å¤„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æœ¬æ•™ç¨‹ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç±»ä¼¼åœŸåœ°çš„æµ®é›•ã€‚</font><font style="vertical-align: inherit;">å®ƒçœ‹èµ·æ¥åº”è¯¥å¾ˆæœ‰è¶£ï¼Œå…·æœ‰å¾ˆå¤§çš„å¯å˜æ€§å¹¶ä¸”æ²¡æœ‰è¾ƒå¤§çš„å‡åŒ€åŒºåŸŸã€‚</font><font style="vertical-align: inherit;">æ•‘æµè§„æ¨¡å°†å¾ˆå¤§ï¼Œåœ°å›¾å°†è¦†ç›–ä¸€ä¸ªæˆ–å¤šä¸ªå¤§æ´²ï¼Œæµ·æ´‹åŒºåŸŸï¼Œç”šè‡³æ•´ä¸ªæ˜Ÿçƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦æ§åˆ¶åœ°ç†ç¯å¢ƒï¼ŒåŒ…æ‹¬åœŸåœ°è´¨é‡ï¼Œæ°”å€™ï¼ŒåŒºåŸŸæ•°é‡å’Œåœ°å½¢é¢ ç°¸ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºåˆ›å»ºå¯¿å¸å¥ å®šåŸºç¡€ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹å…¥é—¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸“æ³¨äºåœ°å›¾ï¼Œè€Œä¸æ˜¯æ¸¸æˆç©æ³•ï¼Œå› æ­¤åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹å¯åŠ¨åº”ç”¨ç¨‹åºä¼šæ›´åŠ æ–¹ä¾¿ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³çœ‹åˆ°å¡ç‰‡ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†é€šè¿‡</font></font><code>HexMapEditor.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ç¼–è¾‘æ¨¡å¼è®¾ç½®ä¸ºtrueå¹¶æ‰“å¼€æ­¤æ¨¡å¼çš„shaderå…³é”®å­—æ¥è¿›è¡Œ</font><font style="vertical-align: inherit;">æ›´æ”¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrainMaterial.DisableKeyword(<span class="hljs-string"><span class="hljs-string">"GRID_ON"</span></span>); Shader.EnableKeyword(<span class="hljs-string"><span class="hljs-string">"HEX_MAP_EDIT_MODE"</span></span>); SetEditMode(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¡ç”Ÿæˆå™¨ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºç”Ÿæˆè¿‡ç¨‹å›¾éœ€è¦å¤§é‡ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šå°†å…¶ç›´æ¥æ·»åŠ åˆ°ä¸­</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶</font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶ä¸”</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ä¸çŸ¥é“å®ƒã€‚</font><font style="vertical-align: inherit;">å¦‚æœéœ€è¦ï¼Œè¿™å°†ç®€åŒ–å‘å¦ä¸€ç§ç®—æ³•çš„è¿‡æ¸¡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”Ÿæˆå™¨éœ€è¦ä¸€ä¸ªåˆ°ç½‘æ ¼çš„é“¾æ¥ï¼Œå› æ­¤æˆ‘ä»¬å°†å‘å®ƒæ·»åŠ ä¸€ä¸ªå¸¸è§„å­—æ®µã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ç§é€šç”¨æ–¹æ³•</font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å¤„ç†ç®—æ³•çš„å·¥ä½œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸ºå®ƒæä¾›åœ°å›¾çš„å°ºå¯¸â€‹â€‹ä½œä¸ºå‚æ•°ï¼Œç„¶åå¼ºåˆ¶å°†å…¶ç”¨äºåˆ›å»ºæ–°çš„ç©ºåœ°å›¾ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexMapGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid grid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { grid.CreateMap(x, z); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å…·æœ‰ç»„ä»¶çš„å¯¹è±¡æ·»åŠ åˆ°åœºæ™¯</font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶è¿æ¥åˆ°ç½‘æ ¼ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/932/b6e/fd2/932b6efd2dd1809893af27ec7a91c620.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å›¾ç”Ÿæˆå™¨å¯¹è±¡ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ›´æ”¹æ–°åœ°å›¾çš„èœå• </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>NewMapMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿å®ƒå¯ä»¥ç”Ÿæˆå¡ç‰‡ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ›å»ºç©ºå¡ç‰‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€šè¿‡å¸ƒå°”å­—æ®µ</font></font><code>generateMaps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆé»˜è®¤æƒ…å†µä¸‹å…·æœ‰ä¸€ä¸ªå€¼ï¼‰</font><font style="vertical-align: inherit;">æ¥æ§åˆ¶å…¶åŠŸèƒ½</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè®¾ç½®æ­¤å­—æ®µçš„é€šç”¨æ–¹æ³•ï¼Œå°±åƒæˆ‘ä»¬åˆ‡æ¢optionsä¸€æ ·</font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å°†é€‚å½“çš„å¼€å…³æ·»åŠ åˆ°èœå•å¹¶å°†å…¶è¿æ¥åˆ°æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> generateMaps = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleMapGeneration</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { generateMaps = toggle; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc9/9c7/0c9/fc99c70c99095b3565104ef42254859d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¦æœ‰å¼€å…³çš„æ–°å¡çš„èœå•ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨èœå•ä¸Šæä¾›æŒ‡å‘åœ°å›¾ç”Ÿæˆå™¨çš„é“¾æ¥ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œå¦‚æœéœ€è¦</font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†å¼ºåˆ¶å…¶è°ƒç”¨</font><font style="vertical-align: inherit;">generator </font><font style="vertical-align: inherit;">æ–¹æ³•</font><font style="vertical-align: inherit;">ï¼Œè€Œä¸ä»…ä»…æ˜¯æ‰§è¡Œ</font></font><code>CreateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘æ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMapGenerator mapGenerator; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (generateMaps) { mapGenerator.GenerateMap(x, z); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { hexGrid.CreateMap(x, z); } HexMapCamera.ValidatePosition(); Close(); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d1/e98/3d9/7d1e983d927d912b75d9b245219659f1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿æ¥åˆ°å‘ç”µæœºã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å•å…ƒè®¿é—® </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿ç”Ÿæˆå™¨æ­£å¸¸å·¥ä½œï¼Œå®ƒéœ€è¦è®¿é—®å•å…ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·²ç»æœ‰å¸¸ç”¨çš„æ–¹æ³•</font></font><code>GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œéœ€è¦æˆ–ä½ç½®çŸ¢é‡ï¼Œæˆ–å…­è¾¹å½¢åæ ‡ã€‚</font><font style="vertical-align: inherit;">ç”Ÿæˆå™¨ä¸éœ€è¦ä½¿ç”¨ä»»ä½•ä¸€ç§ï¼Œå› æ­¤æˆ‘ä»¬æ·»åŠ äº†ä¸¤ç§æ–¹ä¾¿çš„æ–¹æ³•</font></font><code>HexGrid.GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå®ƒä»¬å°†ä¸åƒå…ƒçš„åç§»é‡æˆ–ç´¢å¼•çš„åæ ‡ä¸€èµ·ä½¿ç”¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xOffset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zOffset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[xOffset + zOffset * cellCountX]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cellIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[cellIndex]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å®ƒ</font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥ç›´æ¥æ¥æ”¶ç»†èƒã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œåˆ›å»ºæ–°åœ°å›¾åï¼Œä»–å¯ä»¥ä½¿ç”¨è‰åæ ‡å°†è‰è®¾ç½®ä¸ºå•å…ƒæ ¼ä¸­é—´åˆ—çš„æµ®é›•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { grid.CreateMap(x, z); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; z; i++) { grid.GetCell(x / <span class="hljs-number"><span class="hljs-number">2</span></span>, i).TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/860/aee/119/860aee119f0e000ef290f6c87e61ad05.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‰çš„ä¸“æ åœ¨ä¸€å¼ å°åœ°å›¾çš„ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åšå¯¿å¸ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”Ÿæˆåœ°å›¾æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨æ²¡æœ‰åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥æƒ³è±¡ï¼Œæ•´ä¸ªä¸–ç•Œè¢«ä¸€ç‰‡å·¨å¤§çš„æµ·æ´‹æ·¹æ²¡ã€‚</font><font style="vertical-align: inherit;">å½“æµ·åº•çš„ä¸€éƒ¨åˆ†è¢«æ¨å¾—å¤ªå¤šä»¥è‡³äºå®ƒä¸Šå‡åˆ°æ°´é¢ä¹‹ä¸Šæ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€å—åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬éœ€è¦ç¡®å®šåº”ä»¥è¿™ç§æ–¹å¼åˆ›å»ºå¤šå°‘åœŸåœ°ï¼Œå®ƒä¼šå‡ºç°åœ¨ä½•å¤„ä»¥åŠå½¢çŠ¶å¦‚ä½•ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡è½»å‹åŠ› </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»å°å¤„å¼€å§‹-åœ¨æ°´é¢ä¸Šæ–¹ä¸¾èµ·ä¸€å—åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¦æœ‰å‚æ•°</font><font style="vertical-align: inherit;">çš„æ–¹æ³•</font><font style="vertical-align: inherit;">æ¥æ§åˆ¶ç»˜å›¾çš„å¤§å°ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸­è°ƒç”¨æ­¤æ–¹æ³•</font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»¥æ›¿æ¢å…ˆå‰çš„æµ‹è¯•ä»£ç ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»ç”±ä¸ƒä¸ªå•å…ƒç»„æˆçš„ä¸€å°å—åœŸåœ°å¼€å§‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { grid.CreateMap(x, z); <span class="hljs-comment"><span class="hljs-comment">// for (int i = 0; i &lt; z; i++) { // grid.GetCell(x / 2, i).TerrainTypeIndex = 1; // } RaiseTerrain(7); } void RaiseTerrain (int chunkSize) {}</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œè‰â€ç±»æµ®é›•æ¥è¡¨ç¤ºé«˜åœ°ï¼ŒåŸå§‹çš„â€œæ²™â€ç±»æµ®é›•æ˜¯æŒ‡æµ·æ´‹ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‰æ‹©ä¸€ä¸ªéšæœºå•å…ƒï¼Œå¹¶æ›´æ”¹å…¶æ•‘æµçš„ç±»å‹ï¼Œç›´åˆ°è·å¾—é€‚å½“æ•°é‡çš„åœŸåœ°ä¸ºæ­¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†è·å¾—éšæœºå•å…ƒæ ¼ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ç§</font></font><code>GetRandomCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¡®å®šéšæœºå•å…ƒæ ¼ç´¢å¼•å¹¶ä»ç½‘æ ¼ä¸­è·å–ç›¸åº”å•å…ƒæ ¼çš„æ–¹æ³•ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RaiseTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunkSize</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunkSize; i++) { GetRandomCell().TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-function"><span class="hljs-function">HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRandomCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> grid.GetCell(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, grid.cellCountX * grid.cellCountZ)); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/396/fb8/ce6/396fb8ce67de74961b31562e275bd81a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ƒä¸ªéšæœºçš„å¯¿å¸å®¤ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæœ€ç»ˆæˆ‘ä»¬å¯èƒ½éœ€è¦å¤§é‡éšæœºå•å…ƒæ ¼æˆ–éå†æ‰€æœ‰å•å…ƒæ ¼å‡ æ¬¡ï¼Œå› æ­¤è®©æˆ‘ä»¬è·Ÿè¸ªå•å…ƒæ ¼æœ¬èº«ä¸­å•å…ƒæ ¼çš„æ•°é‡</font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cellCount; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellCount = x * z; â€¦ } â€¦ <span class="hljs-function"><span class="hljs-function">HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRandomCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> grid.GetCell(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, cellCount)); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºä¸€ä¸ªç«™ç‚¹ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ­£åœ¨å°†ä¸ƒä¸ªéšæœºå°åŒºå˜æˆé™†åœ°ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬å¾ˆå¯èƒ½æ²¡æœ‰å½¢æˆä¸€ä¸ªå•ä¸€çš„åœŸåœ°åŒºåŸŸã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å¤šæ¬¡é€‰æ‹©ç›¸åŒçš„åƒå…ƒï¼Œå› æ­¤å¯ä»¥å‡å°‘åœŸåœ°é¢ç§¯ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†åŒæ—¶è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä»…é€‰æ‹©ç¬¬ä¸€ä¸ªå•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">åœ¨é‚£ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥åªé€‰æ‹©é‚£äº›ä¸å…ˆå‰é€‰æ‹©çš„å•å…ƒæ ¼ç›¸é‚»çš„å•å…ƒæ ¼ã€‚</font><font style="vertical-align: inherit;">è¿™äº›é™åˆ¶ç±»ä¼¼äºè·¯å¾„æœç´¢çš„é™åˆ¶ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ­¤å¤„ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ·»åŠ </font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº†è‡ªå·±çš„å±æ€§ä»¥åŠæœç´¢è¾¹ç•Œé˜¶æ®µçš„è®¡æ•°å™¨ï¼Œå°±åƒåœ¨ä¸­ä¸€æ ·</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCellPriorityQueue searchFrontier; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> searchFrontierPhase;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨éœ€è¦ä¼˜å…ˆçº§é˜Ÿåˆ—ä¹‹å‰ï¼Œè¯·å…ˆæ£€æŸ¥å®ƒæ˜¯å¦å­˜åœ¨ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellCount = x * z; grid.CreateMap(x, z); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchFrontier == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { searchFrontier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCellPriorityQueue(); } RaiseTerrain(<span class="hljs-number"><span class="hljs-number">7</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºæ–°åœ°å›¾åï¼Œæ‰€æœ‰åƒå…ƒçš„æœç´¢è¾¹ç•Œå‡ä¸ºé›¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨åœ°å›¾ç”Ÿæˆè¿‡ç¨‹ä¸­æœç´¢åƒå…ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†åœ¨æ­¤è¿‡ç¨‹ä¸­å¢åŠ å®ƒä»¬çš„æœç´¢è¾¹ç•Œã€‚å¦‚æœæˆ‘ä»¬æ‰§è¡Œè®¸å¤šæœç´¢æ“ä½œï¼Œå®ƒä»¬å¯èƒ½ä¼šè¶…å‡ºè®°å½•çš„æœç´¢è¾¹ç•Œçš„é˜¶æ®µ</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚è¿™å¯èƒ½ä¼šå¹²æ‰°å¯¹å•ä½è·¯å¾„çš„æœç´¢ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œåœ¨åœ°å›¾ç”Ÿæˆè¿‡ç¨‹ç»“æŸæ—¶ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰åƒå…ƒçš„æœç´¢é˜¶æ®µé‡ç½®ä¸ºé›¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> RaiseTerrain(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { grid.GetCell(i).SearchPhase = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…é¡»å¯»æ‰¾é€‚å½“çš„å•å…ƒæ ¼ï¼Œè€Œä¸æ˜¯éšæœºé€‰æ‹©å®ƒä»¬ã€‚æ­¤è¿‡ç¨‹ä¸ä¸­çš„æœç´¢æ–¹æ³•éå¸¸ç›¸ä¼¼</font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è®¿é—®å•å…ƒæ ¼ä¸ä¼šè¶…è¿‡ä¸€æ¬¡ï¼Œå› æ­¤ï¼Œå°†æœç´¢è¾¹ç•Œçš„ç›¸ä½å¢åŠ 1è€Œä¸æ˜¯2ï¼Œå°±è¶³å¤Ÿäº†ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºé€‰æ‹©çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼åˆå§‹åŒ–è¾¹ç•Œã€‚ä¸å¾€å¸¸ä¸€æ ·ï¼Œé™¤äº†è®¾ç½®å…¶æœç´¢é˜¶æ®µå¤–ï¼Œæˆ‘ä»¬è¿˜å°†å…¶è·ç¦»å’Œå¯å‘å¼æ–¹æ³•åˆ†é…ä¸ºé›¶ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RaiseTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunkSize</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// for (int i = 0; i &lt; chunkSize; i++) { // GetRandomCell().TerrainTypeIndex = 1; // } searchFrontierPhase += 1; HexCell firstCell = GetRandomCell(); firstCell.SearchPhase = searchFrontierPhase; firstCell.Distance = 0; firstCell.SearchHeuristic = 0; searchFrontier.Enqueue(firstCell); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨é‚£ä¹‹åï¼Œæœç´¢å¾ªç¯å°†æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œè¦ç»§ç»­æœç´¢ç›´åˆ°è¾¹ç•Œä¸ºç©ºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰‡æ®µè¾¾åˆ°æ‰€éœ€å¤§å°æ—¶åœæ­¢ï¼Œå› æ­¤æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œè·Ÿè¸ªã€‚</font><font style="vertical-align: inherit;">åœ¨æ¯æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬å°†ä»é˜Ÿåˆ—ä¸­æå–ä¸‹ä¸€ä¸ªå•å…ƒæ ¼ï¼Œè®¾ç½®å…¶é‡Šæ”¾ç±»å‹ï¼Œå¢åŠ å¤§å°ï¼Œç„¶åç»•è¿‡è¯¥å•å…ƒæ ¼çš„é‚»å±…ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå°šæœªå°†æ‰€æœ‰é‚»å±…æ·»åŠ åˆ°è¾¹ç•Œï¼Œåˆ™ä»…å°†å…¶æ·»åŠ åˆ°è¾¹ç•Œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œä»»ä½•æ›´æ”¹æˆ–æ¯”è¾ƒã€‚</font><font style="vertical-align: inherit;">å®Œæˆåï¼Œæ‚¨éœ€è¦æ¸…é™¤è¾¹æ¡†ã€‚</font></font><br><br><pre> <code class="cs hljs"> searchFrontier.Enqueue(firstCell); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); current.TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; size += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor &amp;&amp; neighbor.SearchPhase &lt; searchFrontierPhase) { neighbor.SearchPhase = searchFrontierPhase; neighbor.Distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; neighbor.SearchHeuristic = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(neighbor); } } } searchFrontier.Clear();</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97a/f44/023/97af440236cb6909130d6a8bfaab3f5a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€æ’ç»†èƒã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªåˆé€‚å¤§å°çš„åœ°å—ã€‚</font><font style="vertical-align: inherit;">ä»…å½“æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„å•å…ƒæ ¼æ—¶ï¼Œå®ƒæ‰ä¼šæ›´å°ã€‚</font><font style="vertical-align: inherit;">ç”±äºè¾¹ç•Œçš„å¡«å……æ–¹å¼ï¼Œåœ°å—å§‹ç»ˆç”±è¥¿åŒ—å»¶ä¼¸çš„çº¿ç»„æˆã€‚</font><font style="vertical-align: inherit;">ä»…å½“åˆ°è¾¾åœ°å›¾è¾¹ç¼˜æ—¶ï¼Œå®ƒæ‰ä¼šæ”¹å˜æ–¹å‘ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¿æ¥ç»†èƒ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™†åœ°åŒºåŸŸå¾ˆå°‘åƒçº¿ä¸€æ ·ï¼Œå¦‚æœç¡®å®å¦‚æ­¤ï¼Œå®ƒä»¬çš„æ–¹å‘ä¸ä¸€å®šæ€»æ˜¯ç›¸åŒã€‚</font><font style="vertical-align: inherit;">è¦æ›´æ”¹ç«™ç‚¹çš„å½¢çŠ¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹å•å…ƒçš„ä¼˜å…ˆçº§ã€‚</font><font style="vertical-align: inherit;">ç¬¬ä¸€ä¸ªéšæœºåƒå…ƒå¯ä»¥ç”¨ä½œå›¾çš„ä¸­å¿ƒã€‚</font><font style="vertical-align: inherit;">ç„¶ååˆ°æ‰€æœ‰å…¶ä»–åƒå…ƒçš„è·ç¦»å°†ç›¸å¯¹äºæ­¤ç‚¹ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¸ºé è¿‘ä¸­å¿ƒçš„å•å…ƒæ ¼èµ‹äºˆæ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå› æ­¤è¯¥ç«™ç‚¹å°†ä¸ä¼šä»¥ä¸€æ¡çº¿çš„å½¢å¼å¢é•¿ï¼Œè€Œæ˜¯ä¼šä»¥ä¸­å¿ƒä¸ºä¸­å¿ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> searchFrontier.Enqueue(firstCell); HexCoordinates center = firstCell.coordinates; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); current.TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; size += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor &amp;&amp; neighbor.SearchPhase &lt; searchFrontierPhase) { neighbor.SearchPhase = searchFrontierPhase; neighbor.Distance = neighbor.coordinates.DistanceTo(center); neighbor.SearchHeuristic = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(neighbor); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/117/149/84111714960a293415b1d24edf92f56b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»†èƒçš„ç§¯ç´¯ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œå¦‚æœä¸­å¿ƒå•å…ƒæ ¼æ²¡æœ‰å‡ºç°åœ¨åœ°å›¾è¾¹ç¼˜ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„ä¸ƒä¸ªå•å…ƒæ ¼å°†è¢«ç²¾ç¾åœ°åŒ…è£…åœ¨ä¸€ä¸ªç´§å‡‘çš„å…­è§’å½¢åŒºåŸŸä¸­ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨30çš„åœ°å—å¤§å°ã€‚</font></font><br><br><pre> <code class="cs hljs"> RaiseTerrain(<span class="hljs-number"><span class="hljs-number">30</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/893/c36/13e/893c3613edfe02b457cc4ee6d191072c.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30æ ¼ä¸­çš„å¯¿å¸å—ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æ²¡æœ‰è¶³å¤Ÿçš„å•å…ƒæ ¼æ¥è·å¾—æ­£ç¡®çš„å…­è¾¹å½¢ï¼Œä½†æˆ‘ä»¬å†æ¬¡å¾—åˆ°äº†ç›¸åŒçš„å½¢çŠ¶ã€‚</font><font style="vertical-align: inherit;">ç”±äºå›¾çš„åŠå¾„è¾ƒå¤§ï¼Œå› æ­¤å®ƒå¾ˆå¯èƒ½é è¿‘åœ°å›¾çš„è¾¹ç¼˜ï¼Œè¿™å°†è¿«ä½¿å…¶é‡‡å–å…¶ä»–å½¢çŠ¶ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯¿å¸éšæœºåŒ– </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸å¸Œæœ›æ‰€æœ‰åŒºåŸŸçœ‹èµ·æ¥éƒ½ä¸€æ ·ï¼Œå› æ­¤æˆ‘ä»¬å°†ç•¥å¾®æ›´æ”¹å•å…ƒæ ¼çš„ä¼˜å…ˆçº§ã€‚</font><font style="vertical-align: inherit;">æ¯æ¬¡æˆ‘ä»¬å‘è¾¹ç•Œæ·»åŠ ä¸€ä¸ªç›¸é‚»çš„å•å…ƒæ ¼æ—¶ï¼Œå¦‚æœä¸‹ä¸€ä¸ªæ•°å­—</font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°äºæŸä¸ªé˜ˆå€¼ï¼Œåˆ™æ­¤å•å…ƒæ ¼çš„è¯•æ¢æ³•å°†å˜ä¸º0ï¼Œè€Œä¸æ˜¯1ã€‚è®©æˆ‘ä»¬ä½¿ç”¨å€¼0.5ä½œä¸ºé˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¾ˆå¯èƒ½ä¼šå½±å“ä¸€åŠçš„å•å…ƒæ ¼ã€‚</font></font><br><br><pre> <code class="cs hljs"> neighbor.Distance = neighbor.coordinates.DistanceTo(center); neighbor.SearchHeuristic = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0.5f</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(neighbor);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43e/aec/793/43eaec79315f68e0618fe71c0f93c3f3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰­æ›²çš„åŒºåŸŸã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å¢åŠ å•å…ƒçš„æœç´¢å¯å‘å¼ï¼Œæˆ‘ä»¬ä½¿å®ƒçš„è®¿é—®æ¯”é¢„æœŸçš„æ™šã€‚åŒæ—¶ï¼Œè·ç¦»ä¸­å¿ƒæ›´è¿œä¸€æ­¥çš„å…¶ä»–å•å…ƒå°†è¢«æ›´æ—©è®¿é—®ï¼Œé™¤éå®ƒä»¬ä¹Ÿå¢åŠ äº†å¯å‘å¼æ–¹æ³•ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬å°†æ‰€æœ‰å•å…ƒçš„è¯•æ¢æ³•å¢åŠ ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™å°†ä¸ä¼šå½±å“åœ°å›¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé˜ˆå€¼1ä¸ä¼šäº§ç”Ÿå½±å“ï¼Œå°±åƒé˜ˆå€¼0ä¸€æ ·ã€‚é˜ˆå€¼0.8ç­‰äº0.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¦‚ç‡ä¸º0.5ä¼šä½¿æœç´¢è¿‡ç¨‹æœ€â€œå‘æŠ–â€ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‚å½“çš„æŒ¯è¡é‡å–å†³äºæ‰€éœ€çš„åœ°å½¢ç±»å‹ï¼Œå› æ­¤è®©å®ƒå¯è‡ªå®šä¹‰ã€‚å°†</font></font><code>jitterProbability</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰å±æ€§</font><font style="vertical-align: inherit;">çš„é€šç”¨floatå­—æ®µæ·»åŠ åˆ°ç”Ÿæˆå™¨</font></font><code>Range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™åˆ¶åœ¨0-0.5èŒƒå›´å†…ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼ï¼Œç­‰äºè¯¥é—´éš”çš„å¹³å‡å€¼ï¼Œå³0.25ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨Unity inspectorçª—å£ä¸­é…ç½®ç”Ÿæˆå™¨ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(0f, 0.5f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> jitterProbability = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/795/b50/381/795b50381d8c9cda219ff092cf64cee5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ³¢åŠ¨çš„å¯èƒ½æ€§ã€‚ </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åœ¨æ¸¸æˆç•Œé¢ä¸­è‡ªå®šä¹‰å®ƒå—ï¼Ÿ</font></font></b> <div class="spoiler_text">  ,       .           UI,       .          ,      UI.  ,     .         ,       . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°åœ¨ï¼Œè¦ç¡®å®šå¯å‘å¼ç®—æ³•ä½•æ—¶åº”ç­‰äº1ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¦‚ç‡è€Œä¸æ˜¯å¸¸æ•°ã€‚ </font></font><br><br><pre> <code class="cs hljs"> neighbor.SearchHeuristic = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; jitterProbability ? <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬ä½¿ç”¨0å’Œ1çš„å¯å‘å¼å€¼ã€‚å°½ç®¡å¯ä»¥ä½¿ç”¨æ›´å¤§çš„å€¼ï¼Œä½†è¿™å°†å¤§å¤§æ¶åŒ–æˆªé¢çš„å˜å½¢ï¼Œæœ€æœ‰å¯èƒ½å°†å…¶å˜æˆä¸€å †æ¡çº¹ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç­¹é›†åœŸåœ° </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸ä»…é™äºä¸€å—åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªè°ƒç”¨</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¾åœ¨å¾ªç¯ä¸­ä»¥è·å–äº”ä¸ªéƒ¨åˆ†ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++) { RaiseTerrain(<span class="hljs-number"><span class="hljs-number">30</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d42/83f/acd/d4283facd88705107d705290c3d8e78b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº”å—åœŸåœ°ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡ç°åœ¨æˆ‘ä»¬æ­£åœ¨ç”Ÿæˆäº”å¼ å›¾ï¼Œæ¯å¼ å›¾å„æœ‰30ä¸ªåƒå…ƒï¼Œä½†ä¸ä¸€å®šèƒ½å‡†ç¡®å¾—åˆ°150ä¸ªåƒå…ƒçš„åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ¯ä¸ªç«™ç‚¹éƒ½æ˜¯å•ç‹¬åˆ›å»ºçš„ï¼Œå› æ­¤å®ƒä»¬å½¼æ­¤ä¹‹é—´å¹¶ä¸äº†è§£ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç›¸äº¤ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå› ä¸ºå®ƒå¯ä»¥åˆ›å»ºæ¯”ä¸€ç»„å•ç‹¬çš„éƒ¨åˆ†æ›´å¤šçš„æœ‰è¶£é£æ™¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†å¢åŠ åœŸåœ°çš„å¯å˜æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ›´æ”¹æ¯ä¸ªåœ°å—çš„å¤§å°ã€‚</font><font style="vertical-align: inherit;">æ·»åŠ ä¸¤ä¸ªæ•´æ•°å­—æ®µä»¥æ§åˆ¶å›¾çš„æœ€å°å’Œæœ€å¤§å¤§å°ã€‚</font><font style="vertical-align: inherit;">ç»™å®ƒä»¬åˆ†é…è¶³å¤Ÿå¤§çš„æ—¶é—´é—´éš”ï¼Œä¾‹å¦‚20-200ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†ä½¿æ ‡å‡†æœ€å°å€¼ç­‰äº30ï¼Œä½¿æ ‡å‡†æœ€å¤§å€¼ç­‰äº100ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(20, 200)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSizeMin = <span class="hljs-number"><span class="hljs-number">30</span></span>; [Range(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSizeMax = <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ea/026/e43/9ea026e43e949f571be0358332447de5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šæµ†é—´éš”ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›å­—æ®µéšæœºç¡®å®šåŒºåŸŸçš„å¤§å°</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> RaiseTerrain(Random.Range(chunkSizeMin, chunkSizeMax + <span class="hljs-number"><span class="hljs-number">1</span></span>));</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0df/124/dab/0df124dab1f706825f75304d2862aea3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­é—´åœ°å›¾ä¸Šæœ‰äº”ä¸ªéšæœºå¤§å°çš„éƒ¨åˆ†ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ¶ä½œè¶³å¤Ÿçš„å¯¿å¸ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è™½ç„¶æˆ‘ä»¬ä¸èƒ½ç‰¹åˆ«æ§åˆ¶äº§ç”Ÿçš„åœŸåœ°æ•°é‡ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å¯ä»¥ä¸ºå›¾çš„æ•°é‡æ·»åŠ é…ç½®é€‰é¡¹ï¼Œä½†å›¾æœ¬èº«çš„å¤§å°æ˜¯éšæœºçš„ï¼Œå¯èƒ½ä¼šç•¥æœ‰é‡å æˆ–ç´§å¯†é‡å ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ°ç‚¹çš„æ•°é‡å¹¶ä¸èƒ½ä¿è¯åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºæ‰€éœ€åœŸåœ°çš„æ•°é‡ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé€‰é¡¹æ¥ç›´æ¥æ§åˆ¶ä»¥æ•´æ•°è¡¨ç¤ºçš„åœŸåœ°ç™¾åˆ†æ¯”ã€‚</font><font style="vertical-align: inherit;">ç”±äº100ï¼…çš„åœŸåœ°æˆ–æ°´ä¸æ˜¯å¾ˆæœ‰è¶£ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶é™åˆ¶ä¸º5â€“95ï¼Œé»˜è®¤å€¼ä¸º50ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(5, 95)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> landPercentage = <span class="hljs-number"><span class="hljs-number">50</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21e/281/912/21e281912ad5a4a5378c5e55514c639c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¿å¸çš„ç™¾åˆ†æ¯”ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä¿è¯åˆ›å»ºé€‚é‡çš„åœŸåœ°ï¼Œæˆ‘ä»¬åªéœ€è¦ç»§ç»­æé«˜åœ°å½¢åŒºåŸŸï¼Œç›´åˆ°è·å¾—è¶³å¤Ÿçš„åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶æµç¨‹ï¼Œè¿™ä¼šä½¿åœŸåœ°çš„äº§ç”Ÿå˜å¾—å¤æ‚ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬é€šè¿‡è°ƒç”¨æ–°æ–¹æ³•æ¥æ›¿æ¢ç°æœ‰çš„é¥²å…»åœºå‘¨æœŸ</font></font><code>CreateLand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤æ–¹æ³•è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è®¡ç®—åº”å˜ä¸ºé™†åœ°çš„åƒå…ƒæ•°ã€‚</font><font style="vertical-align: inherit;">è¿™å°†æ˜¯æˆ‘ä»¬å¯¿å¸å•å…ƒçš„æ€»å’Œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-comment"><span class="hljs-comment">// for (int i = 0; i &lt; 5; i++) { // RaiseTerrain(Random.Range(chunkSizeMin, chunkSizeMax + 1)); // } CreateLand(); for (int i = 0; i &lt; cellCount; i++) { grid.GetCell(i).SearchPhase = 0; } } void CreateLand () { int landBudget = Mathf.RoundToInt(cellCount * landPercentage * 0.01f); }</span></span></code> </pre> <br> <code>CreateLand</code><font style="vertical-align: inherit;"></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´åˆ°æˆ‘ä»¬ç”¨å®Œæ‰€æœ‰ç»†èƒå</font><font style="vertical-align: inherit;">æ‰ä¼šå¯¼è‡´</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä¸è¶…è¿‡é‡‘é¢ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æ›´æ”¹ï¼Œ</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿å®ƒæ¥æ”¶é‡‘é¢ä½œä¸ºé™„åŠ å‚æ•°ã€‚</font><font style="vertical-align: inherit;">å®Œæˆå·¥ä½œåï¼Œä»–å¿…é¡»é€€è¿˜å‰©ä½™çš„æ¬¾é¡¹ã€‚</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// void RaiseTerrain (int chunkSize) { int RaiseTerrain (int chunkSize, int budget) { â€¦ return budget; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯æ¬¡å°†ç‰¢æˆ¿ä»è¾¹ç•Œç§»å¼€å¹¶è½¬æ¢ä¸ºåœŸåœ°æ—¶ï¼Œæ•°é‡åº”å‡å°‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¿™ä¹‹åå…¨éƒ¨èŠ±å…‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»åœæ­¢æœç´¢å¹¶å®Œæˆç«™ç‚¹ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œä»…å½“å½“å‰å•å…ƒå°šæœªç€é™†æ—¶ï¼Œæ‰åº”æ‰§è¡Œæ­¤æ“ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.TerrainTypeIndex == <span class="hljs-number"><span class="hljs-number">0</span></span>) { current.TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--budget == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } size += <span class="hljs-number"><span class="hljs-number">1</span></span>; â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå®ƒ</font></font><code>CreateLand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥è€•ç§åœŸåœ°ï¼Œç›´åˆ°èŠ±å®Œæ•´ä¸ªç‰¢æˆ¿ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLand</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> landBudget = Mathf.RoundToInt(cellCount * landPercentage * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (landBudget &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { landBudget = RaiseTerrain( Random.Range(chunkSizeMin, chunkSizeMax + <span class="hljs-number"><span class="hljs-number">1</span></span>), landBudget ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d15/34e/7f4/d1534e7f47ba4cf87f3dbeed60aa7d00.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°å¥½ä¸€åŠçš„åœ°å›¾å˜æˆäº†åœŸåœ°ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è€ƒè™‘é«˜åº¦ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœŸåœ°ä¸ä»…æ˜¯ä¸€å—å¹³å¦çš„åœŸåœ°ï¼Œè¿˜å—åˆ°æµ·å²¸çº¿çš„é™åˆ¶ã€‚</font><font style="vertical-align: inherit;">å¥¹çš„èº«é«˜ä¸æ–­å˜åŒ–ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸˜é™µï¼Œå±±è„‰ï¼Œå±±è°·ï¼Œæ¹–æ³Šç­‰ã€‚</font><font style="vertical-align: inherit;">ç”±äºç¼“æ…¢ç§»åŠ¨çš„æ„é€ æ¿å—çš„ç›¸äº’ä½œç”¨ï¼Œå­˜åœ¨é«˜åº¦å·®å¼‚ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬ä¸ä¼šå¯¹å…¶è¿›è¡Œæ¨¡æ‹Ÿï¼Œä½†æˆ‘ä»¬çš„é™†åœ°åŒºåŸŸåº”åœ¨æŸç§ç¨‹åº¦ä¸Šç±»ä¼¼äºæ­¤ç±»æ¿å—ã€‚</font><font style="vertical-align: inherit;">ç«™ç‚¹ä¸ç§»åŠ¨ï¼Œä½†å¯èƒ½ç›¸äº¤ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¨é«˜åœŸåœ° </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ä¸ªåœ°å—ä»£è¡¨ä»æµ·åº•æ¨å‡ºçš„ä¸€éƒ¨åˆ†åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬ä¸æ–­å¢åŠ å½“å‰å•å…ƒæ ¼çš„é«˜åº¦ï¼Œ</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); current.Elevation += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.TerrainTypeIndex == <span class="hljs-number"><span class="hljs-number">0</span></span>) { â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3c/f6e/d3e/b3cf6ed3e71eb737ea7246c92bdd5624.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜åœ°ç€é™†ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬è¾¾åˆ°äº†é¡¶å³°ï¼Œä½†å¾ˆéš¾çœ‹åˆ°ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å¯¹æ¯ä¸ªé«˜åº¦çº§åˆ«ä½¿ç”¨è‡ªå·±çš„åœ°å½¢ç±»å‹ï¼Œä¾‹å¦‚åœ°ç†åˆ†å±‚ï¼Œåˆ™å¯ä»¥ä½¿å®ƒä»¬æ›´åŠ æ¸…æ™°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªä¼šè¿™æ ·åšï¼Œä»¥ä½¿é«˜åº¦æ›´å¼•äººæ³¨ç›®ï¼Œå› æ­¤æ‚¨å¯ä»¥ç®€å•åœ°å°†é«˜åº¦çº§åˆ«ç”¨ä½œé«˜ç¨‹ç´¢å¼•ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœé«˜åº¦è¶…è¿‡åœ°å½¢ç±»å‹çš„æ•°é‡ä¼šæ€æ ·ï¼Ÿ</font></font></b> <div class="spoiler_text">        .        ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•</font></font><code>SetTerrainType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä»…è®¾ç½®ä¸€æ¬¡æ‰€æœ‰åœ°å½¢ç±»å‹</font><font style="vertical-align: inherit;">ï¼Œè€Œä¸æ˜¯éšé«˜åº¦çš„å˜åŒ–æ¥æ›´æ–°å•å…ƒçš„</font><font style="vertical-align: inherit;">åœ°å½¢ç±»å‹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetTerrainType</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { HexCell cell = grid.GetCell(i); cell.TerrainTypeIndex = cell.Elevation; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºå¯¿å¸åï¼Œæˆ‘ä»¬å°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚ </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ CreateLand(); SetTerrainType(); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ä»–</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸èƒ½åº”ä»˜é‚£ç§æ•‘æµï¼Œè€Œä¸“æ³¨äºèº«é«˜ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦æ›´æ”¹å…¶é€»è¾‘ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå½“å‰å•å…ƒæ ¼çš„æ–°é«˜åº¦ä¸º1ï¼Œåˆ™å®ƒåˆšå¥½å˜ä¸ºé™†åœ°ï¼Œå› æ­¤å•å…ƒæ ¼çš„æ€»å’Œå·²å‡å°‘ï¼Œè¿™å¯èƒ½å¯¼è‡´è¯¥ç«™ç‚¹çš„å¢é•¿å®Œæˆã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); current.Elevation += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.Elevation == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// if (current.TerrainTypeIndex == 0) { // current.TerrainTypeIndex = 1; // if (--budget == 0) { // break; // } // }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee0/eec/b9e/ee0eecb9e59f527bd27f0275e230de0a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±‚çš„åˆ†å±‚ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åŠ æ°´ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®©æˆ‘ä»¬æ˜ç¡®æŒ‡å‡ºå“ªäº›å•å…ƒæ ¼æ˜¯æ°´æˆ–é™†åœ°ï¼Œå°†æ‰€æœ‰å•å…ƒæ ¼çš„æ°´ä½è®¾ç½®ä¸º1ã€‚</font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨åˆ›å»ºé™†åœ°ä¹‹å‰</font><font style="vertical-align: inherit;">æ‰§è¡Œæ­¤æ“ä½œ</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellCount = x * z; grid.CreateMap(x, z); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchFrontier == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { searchFrontier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCellPriorityQueue(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { grid.GetCell(i).WaterLevel = <span class="hljs-number"><span class="hljs-number">1</span></span>; } CreateLand(); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¯¹äºåœŸåœ°å±‚çš„æŒ‡å®šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰€æœ‰ç±»å‹çš„åœ°å½¢ã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰çš„æµ·åº•ç»†èƒä»¥åŠæœ€ä½çš„é™†åœ°ç»†èƒéƒ½å°†ä¿æŒæ²™å­ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡ä»é«˜åº¦å‡å»æ°´ä½å¹¶å°†è¯¥å€¼ç”¨ä½œæµ®é›•ç±»å‹çš„æŒ‡æ•°æ¥å®Œæˆã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetTerrainType</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { HexCell cell = grid.GetCell(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { cell.TerrainTypeIndex = cell.Elevation - cell.WaterLevel; } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b5/449/bc3/1b5449bc37b1c677d908484c7bcd0286.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœŸåœ°å’Œæ°´ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æé«˜æ°´ä½ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸ä»…é™äºä¸€ä¸ªæ°´ä½ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä½¿ç”¨é—´éš”ä¸º1â€“5ä¸”é»˜è®¤å€¼ä¸º3çš„å…¬å…±å­—æ®µæ¥è‡ªå®šä¹‰å®ƒã€‚</font><font style="vertical-align: inherit;">åˆå§‹åŒ–å•å…ƒæ ¼æ—¶ä½¿ç”¨æ­¤çº§åˆ«ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(1, 5)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> waterLevel = <span class="hljs-number"><span class="hljs-number">3</span></span>; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { grid.GetCell(i).WaterLevel = waterLevel; } â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c32/9cf/82f/c329cf82f9a847ac01f2754cc3252500.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/850/c9d/fe4/850c9dfe4694834486bf4be64ac1783a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´ä½3ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æ°´ä½ä¸º3æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„åœŸåœ°å°‘äºæˆ‘ä»¬çš„é¢„æœŸã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å› ä¸ºå®ƒ</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»ç„¶è®¤ä¸ºæ°´ä½æ˜¯1ã€‚è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œä¿®å¤ã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); current.Elevation += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.Elevation == waterLevel &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨è¾ƒé«˜çš„æ°´ä½ä¼šå¯¼è‡´è¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">ç‰¢æˆ¿ä¸ä¼šç«‹å³å˜æˆåœŸåœ°ã€‚</font><font style="vertical-align: inherit;">å½“æ°´ä½ä¸º2æ—¶ï¼Œç¬¬ä¸€éƒ¨åˆ†ä»å°†ç•™åœ¨æ°´ä¸‹ã€‚</font><font style="vertical-align: inherit;">æµ·æ´‹åº•éƒ¨å·²ç»ä¸Šå‡ï¼Œä½†ä»ç„¶ç•™åœ¨æ°´ä¸‹ã€‚</font><font style="vertical-align: inherit;">ä»…åœ¨è‡³å°‘ä¸¤ä¸ªéƒ¨åˆ†çš„ç›¸äº¤å¤„å½¢æˆå¹³å°ã€‚</font><font style="vertical-align: inherit;">æ°´ä½è¶Šé«˜ï¼Œå°±è¶Šéœ€è¦è¶Šå¤šçš„åœºåœ°æ¥åˆ›é€ åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œéšç€æ°´ä½çš„å‡é«˜ï¼ŒåœŸåœ°å˜å¾—æ›´åŠ æ··ä¹±ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œå½“éœ€è¦æ›´å¤šçš„åœ°å—æ—¶ï¼Œå®ƒä»¬æ›´æœ‰å¯èƒ½åœ¨å·²ç»å­˜åœ¨çš„åœŸåœ°ä¸Šç›¸äº¤ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨è¾ƒå°çš„åœ°å—çš„æƒ…å†µä¸‹ï¼Œå±±åœ°å°†å˜å¾—æ›´å¸¸è§ï¼Œè€Œå¹³åœ°åˆ™æ›´å°‘ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c39/f02/abf/c39f02abf2bfa93f01395208da92ae9a.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a9/01f/4e2/5a901f4e2785456e0784f33508be4ede.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/863/816/cc1/863816cc19c0fd7cbf172905962970d9.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd0/412/190/fd041219043df072443b00d6799f3946.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ°´ä½ä¸º2â€“5ï¼Œå¯¿å¸å§‹ç»ˆä¸º50ï¼…ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‚ç›´è¿åŠ¨ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€æ¬¡å°†æƒ…èŠ‚æé«˜äº†ä¸€å±‚ï¼Œä½†æˆ‘ä»¬ä¸å¿…å±€é™äºæ­¤ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é«˜åœ° </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æ¯ä¸ªéƒ¨åˆ†å°†å…¶å•å…ƒæ ¼çš„é«˜åº¦å¢åŠ äº†ä¸€ä¸ªçº§åˆ«ï¼Œä½†å¯èƒ½ä¼šå‘ç”Ÿå‰ªè£ã€‚</font><font style="vertical-align: inherit;">å½“ä¸¤ä¸ªéƒ¨åˆ†çš„è¾¹ç¼˜æ¥è§¦æ—¶ï¼Œä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥åˆ›å»ºå­¤ç«‹çš„æ‚¬å´–ï¼Œä½†æ˜¯é•¿é•¿çš„æ‚¬å´–çº¿å°†å¾ˆå°‘è§ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å›¾çš„é«˜åº¦å¢åŠ ä¸€çº§ä»¥ä¸Šæ¥å¢åŠ å…¶å‡ºç°çš„é¢‘ç‡ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™ä»…éœ€è¦åœ¨ä¸€å®šæ¯”ä¾‹çš„ç«™ç‚¹ä¸­å®Œæˆã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‰€æœ‰åŒºåŸŸéƒ½å‡é«˜ï¼Œåˆ™å¾ˆéš¾æ²¿ç€åœ°å½¢ç§»åŠ¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨é»˜è®¤å€¼ä¸º0.25çš„æ¦‚ç‡å­—æ®µä½¿æ­¤å‚æ•°å¯è‡ªå®šä¹‰ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(0f, 1f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> highRiseProbability = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb6/485/8d7/cb64858d7531bb31842aebdd49b68304.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»†èƒå¼ºçƒˆä¸Šå‡çš„å¯èƒ½æ€§ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡æˆ‘ä»¬å¯ä»¥åœ¨é«˜å¤„ä½¿ç”¨ä»»ä½•å¢åŠ çš„é«˜åº¦ï¼Œä½†è¿™å¾ˆå¿«å°±å¤±å»äº†æ§åˆ¶ã€‚</font><font style="vertical-align: inherit;">é«˜åº¦å·®2å·²ç»äº§ç”Ÿäº†æ‚¬å´–ï¼Œæ‰€ä»¥è¿™å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">ç”±äºæ‚¨å¯ä»¥è·³è¿‡ç­‰äºæ°´ä½çš„é«˜åº¦ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ”¹ç¡®å®šå•å…ƒæ˜¯å¦å·²ç€é™†çš„æ–¹å¼ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ°´ä½ä½äºæ°´ä½ï¼Œè€Œç°åœ¨åˆç­‰äºæˆ–é«˜äºæ°´ä½ï¼Œåˆ™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é™†åœ°å•å…ƒã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rise = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; highRiseProbability ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; current.Elevation = originalElevation + rise; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &lt; waterLevel &amp;&amp; current.Elevation &gt;= waterLevel &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } size += <span class="hljs-number"><span class="hljs-number">1</span></span>; â€¦ }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b31/8c1/ea5/b318c1ea557ced17d2cb0d9a951bcfc3.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ba/353/78b/4ba35378bc60e74b624e136b90a4a7eb.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea3/8ac/b0a/ea38acb0a5cf12835c2ba177e41d6178.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/018/0df/bd9/0180dfbd9869a0d0e0d5a1712af34fb3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜åº¦æ€¥å‰§å¢åŠ çš„æ¦‚ç‡ä¸º0.25ã€0.50ã€0.75å’Œ1ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é™ä½åœŸåœ° </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœŸåœ°å¹¶ä¸æ€»æ˜¯ä¼šä¸Šå‡ï¼Œæœ‰æ—¶ä¼šä¸‹é™ã€‚</font><font style="vertical-align: inherit;">å½“åœŸåœ°é™åˆ°è¶³å¤Ÿä½æ—¶ï¼Œæ°´å°±ä¼šå¡«æ»¡ï¼ŒåœŸåœ°å°±ä¼šæµå¤±ã€‚</font><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è¿™æ ·åšã€‚</font><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬ä»…å°†åŒºåŸŸå‘ä¸Šæ¨ï¼Œå› æ­¤åœŸåœ°é€šå¸¸çœ‹èµ·æ¥åƒæ˜¯ä¸€ç»„ç›¸å½“åœ†å½¢çš„åŒºåŸŸï¼Œæ··åˆåœ¨ä¸€èµ·ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæœ‰æ—¶å°†é¢ç§¯é™ä½ï¼Œåˆ™ä¼šå¾—åˆ°æ›´å¤šå˜åŒ–çš„å½¢å¼ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e4/95e/d81/9e495ed818dfffc39e5a238f273c8c5b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰æ²‰æ²¡çš„å¯¿å¸çš„å¤§åœ°å›¾ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªæ¦‚ç‡åœºæ¥æ§åˆ¶åœ°é¢æ²‰é™çš„é¢‘ç‡ã€‚</font><font style="vertical-align: inherit;">ç”±äºé™ä½å¯èƒ½ä¼šç ´ååœŸåœ°ï¼Œå› æ­¤é™ä½çš„å¯èƒ½æ€§åº”å§‹ç»ˆä½äºæé«˜çš„å¯èƒ½æ€§ã€‚</font><font style="vertical-align: inherit;">å¦åˆ™ï¼Œå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½è·å¾—æ­£ç¡®æ¯”ä¾‹çš„åœŸåœ°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨æœ€å¤§é™ä½æ¦‚ç‡0.4å’Œé»˜è®¤å€¼0.2ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(0f, 0.4f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sinkProbability = <span class="hljs-number"><span class="hljs-number">0.2f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/997/e82/a11997e824700a045e9faaedaafeb121.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™ä½çš„å¯èƒ½æ€§ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™ä½åœºåœ°ç±»ä¼¼äºå‡é«˜åœºåœ°ï¼Œä½†æœ‰æ‰€ä¸åŒã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¤åˆ¶è¯¥æ–¹æ³•</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶åç§°æ›´æ”¹ä¸º</font></font><code>SinkTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é™¤äº†ç¡®å®šä¸Šå‡å¹…åº¦ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥ä½¿ç”¨ç›¸åŒé€»è¾‘çš„ä¸‹é™å€¼ã€‚</font><font style="vertical-align: inherit;">åŒæ—¶ï¼Œéœ€è¦è¿›è¡Œæ¯”è¾ƒä»¥æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å·²ç»ç©¿è¿‡æ°´é¢ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œé™ä½æµ®é›•æ—¶ï¼Œæˆ‘ä»¬ä¸é™äºå•å…ƒæ ¼çš„æ€»å’Œã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæ¯ä¸ªä¸¢å¤±çš„å¯¿å¸å•å…ƒéƒ½ä¼šè¿”å›èŠ±è´¹åœ¨å…¶ä¸Šçš„é‡‘é¢ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶å¢åŠ å¹¶ç»§ç»­å·¥ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SinkTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunkSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> budget</span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sink = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; highRiseProbability ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; current.Elevation = originalElevation - sink; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &gt;= waterLevel &amp;&amp; current.Elevation &lt; waterLevel <span class="hljs-comment"><span class="hljs-comment">// &amp;&amp; --budget == 0 ) { // break; budget += 1; } size += 1; â€¦ } searchFrontier.Clear(); return budget; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œåœ¨å†…éƒ¨çš„æ¯æ¬¡è¿­ä»£ä¸­ï¼Œ</font></font><code>CreateLand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¿…é¡»æ ¹æ®é™ä½çš„å¯èƒ½æ€§é™ä½æˆ–å‡é«˜åœŸåœ°ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLand</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> landBudget = Mathf.RoundToInt(cellCount * landPercentage * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (landBudget &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSize = Random.Range(chunkSizeMin, chunkSizeMax - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; sinkProbability) { landBudget = SinkTerrain(chunkSize, landBudget); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { landBudget = RaiseTerrain(chunkSize, landBudget); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6b/c5e/762/d6bc5e76274e4aa9c8a692f90fde3646.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2f/8ae/3e3/c2f8ae3e3a4b814b6ae954d40225149e.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e3/f5d/461/1e3f5d461421feddbb145d4e1d56c000.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33b/39d/462/33b39d462682688fc2a8094556e4fc91.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰è½çš„æ¦‚ç‡ä¸º0.1ã€0.2ã€0.3å’Œ0.4ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æé™é«˜åº¦ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å½“å‰é˜¶æ®µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡å è®¸å¤šéƒ¨åˆ†ï¼Œæœ‰æ—¶ä¼šå¢åŠ ä¸€äº›é«˜åº¦ï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½ä¼šä¸‹é™ç„¶åå†æ¬¡ä¸Šå‡ã€‚</font><font style="vertical-align: inherit;">åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¾ˆé«˜çš„é«˜åº¦ï¼Œæœ‰æ—¶è¿˜å¯ä»¥åˆ›å»ºéå¸¸ä½çš„é«˜åº¦ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤§é‡åœŸåœ°çš„æƒ…å†µä¸‹ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3f/c2e/359/f3fc2e359db04b4411f2bcd06b81888b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨90ï¼…çš„åœŸåœ°ä¸Šéƒ½å¾ˆé«˜ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†é™åˆ¶é«˜åº¦ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚</font><font style="vertical-align: inherit;">åˆç†çš„æœ€å°å€¼åº”ä»‹äº-4å’Œ0ä¹‹é—´ï¼Œå¯æ¥å—çš„æœ€å¤§å€¼å¯ä»¥åœ¨6-10ä¹‹é—´ã€‚</font><font style="vertical-align: inherit;">å‡è®¾é»˜è®¤å€¼ä¸ºâˆ’2å’Œ8ã€‚å½“æ‰‹åŠ¨ç¼–è¾‘åœ°å›¾æ—¶ï¼Œå®ƒä»¬å°†è¶…å‡ºå…è®¸çš„é™åˆ¶ï¼Œå› æ­¤æ‚¨å¯ä»¥æ›´æ”¹UIç¼–è¾‘å™¨çš„æ»‘å—ï¼Œä¹Ÿå¯ä»¥ä¿æŒä¸å˜ã€‚</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(-4, 0)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elevationMinimum = <span class="hljs-number"><span class="hljs-number">-2</span></span>; [Range(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elevationMaximum = <span class="hljs-number"><span class="hljs-number">8</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bcb/20b/efc/bcb20befc496cd2c5bffbc94b0a9d267.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€å°å’Œæœ€å¤§é«˜åº¦ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œ</font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¿…é¡»ç¡®ä¿é«˜åº¦ä¸è¶…è¿‡å…è®¸çš„æœ€å¤§å€¼ã€‚</font><font style="vertical-align: inherit;">è¿™å¯ä»¥é€šè¿‡æ£€æŸ¥å½“å‰å•å…ƒæ ¼æ˜¯å¦å¤ªé«˜æ¥å®Œæˆã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†è·³è¿‡å®ƒä»¬è€Œä¸æ›´æ”¹å…¶é«˜åº¦å¹¶æ·»åŠ å…¶é‚»å±…ã€‚</font><font style="vertical-align: inherit;">è¿™å°†å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šé™†åœ°åŒºåŸŸå°†é¿å¼€å·²è¾¾åˆ°æœ€å¤§é«˜åº¦çš„åŒºåŸŸï¼Œå¹¶åœ¨å…¶å‘¨å›´ç”Ÿé•¿ã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newElevation = originalElevation + rise; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newElevation &gt; elevationMaximum) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } current.Elevation = newElevation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &lt; waterLevel &amp;&amp; newElevation &gt;= waterLevel &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } size += <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä¸­è¿›è¡Œç›¸åŒçš„æ“ä½œ</font></font><code>SinkTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†æœ€å°é«˜åº¦ã€‚</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newElevation = current.Elevation - sink; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newElevation &lt; elevationMinimum) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } current.Elevation = newElevation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &gt;= waterLevel &amp;&amp; newElevation &lt; waterLevel ) { budget += <span class="hljs-number"><span class="hljs-number">1</span></span>; } size += <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4af/cbe/339/4afcbe339d0d697779ff0649f6c2c125.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜åº¦é™åˆ¶ä¸º90ï¼…ã€‚</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è´Ÿæµ·æ‹”ä¿æŠ¤ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ—¶ï¼Œä¿å­˜å’ŒåŠ è½½ä»£ç æ— æ³•å¤„ç†è´Ÿé«˜åº¦ï¼Œå› ä¸ºæˆ‘ä»¬å°†é«˜åº¦å­˜å‚¨ä¸ºå­—èŠ‚ã€‚</font><font style="vertical-align: inherit;">ä¿å­˜ä¸ºå¤§æ­£æ•°æ—¶å°†è½¬æ¢ä¸ºè´Ÿæ•°ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨ä¿å­˜å’ŒåŠ è½½ç”Ÿæˆçš„åœ°å›¾æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¾ˆé«˜çš„ä½ç½®ï¼Œä»¥ä»£æ›¿åŸå§‹çš„æ°´ä¸‹å•å…ƒã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶å­˜å‚¨ä¸ºæ•´æ•°è€Œä¸æ˜¯å­—èŠ‚æ¥å¢åŠ å¯¹è´Ÿé«˜åº¦çš„æ”¯æŒã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶ä¸éœ€è¦æ”¯æŒå¤šä¸ªé«˜åº¦çº§åˆ«ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ 127æ¥æŠµæ¶ˆå­˜å‚¨çš„å€¼ã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå­—èŠ‚å†…æ­£ç¡®å­˜å‚¨åœ¨-127â€“128èŒƒå›´å†…çš„é«˜åº¦ã€‚</font><font style="vertical-align: inherit;">ç›¸åº”åœ°æ›´æ”¹</font></font><code>HexCell.Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryWriter writer</span></span></span><span class="hljs-function">)</span></span> { writer.Write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)terrainTypeIndex); writer.Write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(elevation + <span class="hljs-number"><span class="hljs-number">127</span></span>)); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºæˆ‘ä»¬æ›´æ”¹äº†ä¿å­˜åœ°å›¾æ•°æ®çš„æ–¹å¼ï¼Œå› æ­¤</font></font><code>SaveLoadMenu.mapFileVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†</font><font style="vertical-align: inherit;">å…¶</font><font style="vertical-align: inherit;">å¢åŠ åˆ°4ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mapFileVersion = <span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œå¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼Œ</font></font><code>HexCell.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä½¿å…¶ä»ç‰ˆæœ¬4æ–‡ä»¶åŠ è½½çš„é«˜åº¦ä¸­å‡å»127ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { terrainTypeIndex = reader.ReadByte(); ShaderData.RefreshTerrain(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); elevation = reader.ReadByte(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>) { elevation -= <span class="hljs-number"><span class="hljs-number">127</span></span>; } â€¦ }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‡æ–°åˆ›å»ºç›¸åŒçš„åœ°å›¾ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºå„ç§å„æ ·çš„åœ°å›¾ã€‚</font><font style="vertical-align: inherit;">ç”Ÿæˆæ¯ä¸ªæ–°ç»“æœæ—¶å°†æ˜¯éšæœºçš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªèƒ½ä½¿ç”¨é…ç½®é€‰é¡¹æ¥æ§åˆ¶å¡çš„ç‰¹æ€§ï¼Œè€Œä¸èƒ½æ§åˆ¶æœ€å‡†ç¡®çš„å½¢å¼ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬éœ€è¦å†æ¬¡é‡æ–°åˆ›å»ºå®Œå…¨ç›¸åŒçš„åœ°å›¾ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œä¸æœ‹å‹åˆ†äº«ç²¾ç¾çš„åœ°å›¾ï¼Œæˆ–è€…åœ¨æ‰‹åŠ¨ç¼–è¾‘åé‡æ–°å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">å®ƒåœ¨æ¸¸æˆå¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ·»åŠ æ­¤åŠŸèƒ½ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨ç§å­ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†ä½¿åœ°å›¾ç”Ÿæˆè¿‡ç¨‹ä¸å¯é¢„æµ‹ï¼Œæˆ‘ä»¬ä½¿ç”¨</font></font><code>Random.Range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¦å†æ¬¡è·å¾—ç›¸åŒçš„ä¼ªéšæœºæ•°å­—åºåˆ—ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç§å­å€¼ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»é‡‡ç”¨äº†ç±»ä¼¼çš„æ–¹æ³•</font></font><code>HexMetrics.InitializeHashGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒé¦–å…ˆä¿å­˜ç”¨ç‰¹å®šç§å­å€¼åˆå§‹åŒ–çš„æ•°å­—ç”Ÿæˆå™¨çš„å½“å‰çŠ¶æ€ï¼Œç„¶åæ¢å¤å…¶åŸå§‹çŠ¶æ€ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥å¯¹ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•</font></font><code>HexMapGenerator.GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥å†æ¬¡è®°ä½æ—§çŠ¶æ€ï¼Œå¹¶åœ¨å®Œæˆåå°†å…¶è¿˜åŸï¼Œä»¥å…å¹²æ‰°ä½¿ç”¨çš„ä»»ä½•å…¶ä»–çŠ¶æ€</font></font><code>Random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { Random.State originalRandomState = Random.state; â€¦ Random.state = originalRandomState; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ç”¨äºç”Ÿæˆæœ€åä¸€å¼ å¡ç‰‡çš„ç§å­ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯é€šè¿‡ä½¿ç”¨å…¬å…±æ•´æ•°å­—æ®µå®Œæˆçš„ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> seed;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41d/3b5/538/41d3b553898698698636b6bada081aa6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¾ç¤ºç§å­ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬éœ€è¦ç§å­å€¼æ¥åˆå§‹åŒ–</font></font><code>Random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¦åˆ›å»ºéšæœºå¡ç‰‡ï¼Œæ‚¨éœ€è¦ä½¿ç”¨éšæœºç§å­ã€‚</font><font style="vertical-align: inherit;">æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä»»æ„ç§å­å€¼ç”Ÿæˆ</font></font><code>Random.Range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä¸å½±å“åˆå§‹éšæœºçŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¿å­˜åæ‰§è¡Œæ­¤æ“ä½œã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { Random.State originalRandomState = Random.state; seed = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue); Random.InitState(seed); â€¦ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå®Œæˆåæˆ‘ä»¬å°†æ¢å¤éšæœºçŠ¶æ€ï¼Œå› æ­¤å¦‚æœç«‹å³ç”Ÿæˆå¦ä¸€å¼ å¡ï¼Œç»“æœå°†è·å¾—ç›¸åŒçš„ç§å­å€¼ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œæˆ‘ä»¬ä¸çŸ¥é“åˆå§‹éšæœºçŠ¶æ€æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå°½ç®¡å®ƒå¯ä»¥ä½œä¸ºä»»æ„èµ·ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ›´å¤šçš„ä¸œè¥¿æ‰èƒ½åœ¨æ¯æ¬¡è°ƒç”¨æ—¶å°†å…¶éšæœºåŒ–ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å¤šç§åˆå§‹åŒ–éšæœºæ•°ç”Ÿæˆå™¨çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ç»„åˆå¤šä¸ªåœ¨å¾ˆå¤§èŒƒå›´å†…å˜åŒ–çš„ä»»æ„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé‡æ–°ç”ŸæˆåŒä¸€å¼ å¡çš„å¯èƒ½æ€§å¾ˆä½ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿæ—¶é—´çš„ä½32ä½ï¼ˆä»¥å‘¨æœŸè¡¨ç¤ºï¼‰åŠ ä¸Šåº”ç”¨ç¨‹åºçš„å½“å‰è¿è¡Œæ—¶ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨æŒ‰ä½å¼‚æˆ–è¿ç®—å°†è¿™äº›å€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥ä½¿ç»“æœä¸æ˜¯å¾ˆå¤§ã€‚</font></font><br><br><pre> <code class="cs hljs"> seed = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue); seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)System.DateTime.Now.Ticks; seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Time.unscaledTime; Random.InitState(seed);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœæ•°å­—å¯èƒ½ä¸ºè´Ÿï¼Œè¿™å¯¹äºå…¬å…±ä»·å€¼ç§å­è€Œè¨€ä¼¼ä¹ä¸æ˜¯å¾ˆå¥½ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æœ€å¤§æ•´æ•°å€¼çš„æŒ‰ä½å±è”½æ¥ä½¿å®ƒä¸¥æ ¼ä¸ºæ­£ï¼Œè¿™å°†é‡ç½®ç¬¦å·ä½ã€‚</font></font><br><br><pre> <code class="cs hljs"> seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Time.unscaledTime; seed &amp;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; Random.InitState(seed);</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¯é‡å¤ä½¿ç”¨çš„ç§å­ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä»ç„¶ä¼šç”Ÿæˆéšæœºå¡ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªå¡ä½¿ç”¨äº†ä»€ä¹ˆç§å­å€¼ã€‚</font><font style="vertical-align: inherit;">è¦å†æ¬¡é‡æ–°åˆ›å»ºç›¸åŒçš„åœ°å›¾ï¼Œæˆ‘ä»¬å¿…é¡»å‘½ä»¤ç”Ÿæˆå™¨å†æ¬¡ä½¿ç”¨ç›¸åŒçš„ç§å­å€¼ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„ç§å­å€¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨å¸ƒå°”å­—æ®µæ·»åŠ ä¸€ä¸ªå¼€å…³æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useFixedSeed;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/200/4c6/eed/2004c6eed8c2244bdfe660bf477d2fa3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‰æ‹©ä½¿ç”¨æ’å®šç§å­ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœé€‰æ‹©äº†å¸¸é‡ç§å­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è·³è¿‡ä¸­çš„ç”Ÿæˆæ–°ç§å­</font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬ä¸æ‰‹åŠ¨æ›´æ”¹ç§å­å­—æ®µï¼Œé‚£ä¹ˆç»“æœå°†å†æ¬¡æ˜¯åŒä¸€å¼ åœ°å›¾ã€‚</font></font><br><br><pre> <code class="cs hljs"> Random.State originalRandomState = Random.state; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!useFixedSeed) { seed = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue); seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)System.DateTime.Now.Ticks; seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Time.time; seed &amp;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; } Random.InitState(seed);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¤åˆ¶æ‰€éœ€åœ°å›¾çš„ç§å­å€¼å¹¶å°†å…¶ä¿å­˜åœ¨æŸä¸ªä½ç½®ï¼Œä»¥ä¾¿å°†æ¥å†æ¬¡ç”Ÿæˆå®ƒã€‚</font><font style="vertical-align: inherit;">ä¸è¦å¿˜äº†ï¼Œåªæœ‰ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ç”Ÿæˆå™¨å‚æ•°ï¼ˆå³ï¼Œç›¸åŒçš„å¡å¤§å°ä»¥åŠæ‰€æœ‰å…¶ä»–é…ç½®é€‰é¡¹ï¼‰æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½è·å¾—åŒä¸€å¼ å¡ã€‚</font><font style="vertical-align: inherit;">å³ä½¿è¿™äº›æ¦‚ç‡å‘ç”Ÿå¾ˆå°çš„å˜åŒ–ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå®Œå…¨ä¸åŒçš„åœ°å›¾ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œé™¤äº†ç§å­ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°ä½æ‰€æœ‰è®¾ç½®ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ff/cd2/279/7ffcd2279b4dd882db924d8e1fc61d0e.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/486/6db/156/4866db15628d75936b7e19fa4841f2f5.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§å­å€¼ä¸º0å’Œ929396788çš„å¤§å‹å¡ï¼Œæ ‡å‡†å‚æ•°ã€‚</font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»Ÿä¸€åŒ…è£…</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427003/">https://habr.com/ru/post/zh-CN427003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN426991/index.html">åˆ›ä¸šæ–‡æ‘˜ï¼šè«æ–¯ç§‘å³å°†ä¸¾è¡Œçš„10ä¸ªITäº‹ä»¶</a></li>
<li><a href="../zh-CN426993/index.html">æˆ‘éœ€è¦å­¦ä¹ Cæ‰èƒ½ç†è§£è®¡ç®—æœºçš„å·¥ä½œåŸç†å—ï¼Ÿ</a></li>
<li><a href="../zh-CN426995/index.html">å›æ”¶ä¼šå±å®³äº§å“å’Œå‘˜å·¥</a></li>
<li><a href="../zh-CN426997/index.html">å¦‚ä½•ä½¿ç”¨MaterialShapeDrawableåˆ›å»ºè‡ªå®šä¹‰å½¢çŠ¶</a></li>
<li><a href="../zh-CN426999/index.html">é¡ºåº”è¶‹åŠ¿ï¼Œæˆ–è½¬å‘RxJavaå’ŒLiveData</a></li>
<li><a href="../zh-CN427005/index.html">AIå¼€å‘äººå‘˜-ç™¾ä¸‡å¯Œç¿çš„èŒä¸šï¼Ÿ</a></li>
<li><a href="../zh-CN427009/index.html">ç”µå­çš„â€œè¡Œèµ°â€ï¼šå¯¹ä¸é¥±å’Œé”®ç»“æ„å†…éƒ¨çš„ç”µè·çš„æ“çºµ</a></li>
<li><a href="../zh-CN427011/index.html">æˆ‘çš„â€œ Hello Worldï¼â€ åœ¨FPGAæˆ–UARTçš„ä¸‹ä¸€ç‰ˆæœ¬ä¸Š</a></li>
<li><a href="../zh-CN427013/index.html">é¢å¯¹é¢çš„NeoQUEST-2018ï¼šè¿˜è®°å¾—å—</a></li>
<li><a href="../zh-CN427015/index.html">ä¸ºä»€ä¹ˆå•†ä¸šæ™ºèƒ½æ•°æ®ä¸­å¿ƒéœ€è¦æ™ºèƒ½PDUï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>