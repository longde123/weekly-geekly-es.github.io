<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍✈️ 🏙️ 🎶 Membuat bot obrolan sederhana di VK di Python 3 🍐 ☺️ 🚰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Membuat dasar untuk bot akan terdiri dari langkah-langkah berikut: 


1. Membuat bot di VK 
2. Pembuatan kunci API 
3. Membuat program bot melalui Lon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membuat bot obrolan sederhana di VK di Python 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427691/"><h3>  Membuat dasar untuk bot akan terdiri dari langkah-langkah berikut: </h3><br><ol><li>  Membuat bot di VK </li><li>  Pembuatan kunci API </li><li>  Membuat program bot melalui LongPoolVK </li></ol><br><h3>  Untuk siapa artikel ini? </h3><br>  Artikel ini dirancang untuk programmer pemula.  Metode kerja program ini sangat sederhana dan siapa pun yang mengetahui sintaksis Python dan tahu sedikit OOP akan dapat mengimplementasikannya untuk kebutuhan mereka.  Tetapi pada prinsipnya, bahkan tanpa mengetahui prinsip-prinsip OOP, saya pikir Anda dapat belajar cara menambahkan fungsi sederhana atau setidaknya dalam kasus ekstrim menggunakan sumber-sumber yang sudah jadi dari GitHub. <br><br><h3>  Apa yang ada di artikel ini? </h3><br>  <b>Menciptakan dasar bot.</b>  Setelah itu, dapat diprogram sesuka Anda.  Otomatis beberapa rutin atau digunakan sebagai teman bicara. <br><br>  <b>Perbaikan (versi bot yang sedikit rumit).</b>  Saya memutuskan untuk pertama-tama memperkenalkan kode prosedural bot yang sederhana, dan kemudian sedikit menyulitkannya dengan menambahkan fungsi yang secara signifikan meningkatkan kinerja bot. <br><br>  <b>Menambahkan fungsi transfer cuaca.</b>  Kami akan mengajarkan bot untuk memberi tahu kami cuaca. <br><a name="habracut"></a><br><h3>  Membuat bot di VK </h3><br>  Kami akan mulai dengan membuat bot, yaitu grup di VK. <br><br>  Untuk melakukan ini, buka "grup" → "buat komunitas." <br><br>  Pilih semua jenis komunitas dan masukkan nama, tema grup. <br><br>  Pada halaman pengaturan yang terbuka, pilih "Bekerja dengan API" <br><br>  Selanjutnya, Anda perlu membuat kunci API. <br><br>  Kemudian pilih parameter yang Anda butuhkan dengan akses untuk kunci API Anda. <br><br>  Kemungkinan besar, Anda harus mengkonfirmasi tindakan dalam VK menggunakan ponsel Anda.  Kemudian salin kunci API yang dihasilkan di suatu tempat ke file.  Kami masih membutuhkannya. <br><br>  Maka Anda perlu mengizinkan pesan.  Untuk melakukan ini, buka "pesan" dan nyalakan. <br><br><h3>  Mari kita lanjutkan ke bagian program bot </h3><br>  Kami tidak akan mengimplementasikannya melalui permintaan ke VC, atau lebih tepatnya, kami hanya menggunakan perpustakaan VkLongPool, yang akan melakukannya untuk kami. <br><br>  Ini membutuhkan perpustakaan vk_api.  Instal melalui pip: <br><br><blockquote>  python -m pip instal vk_api </blockquote><br>  Tetapi secara pribadi, saya bekerja dengan lingkungan virtual Anaconda.  Ini sering menyebabkan masalah selama pekerjaan pertama.  Biasanya masalahnya adalah bahwa sistem tidak mengenali perintah python.  Dan masalah ini diselesaikan dengan menambahkannya ke PATH. <br><br>  Mari kita beralih ke kode itu sendiri: <br><br>  Kami mengimpor modul yang diperlukan: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api.longpoll <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkLongPoll, VkEventType</code> </pre> <br>  Kemudian kodenya: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_msg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user_id, message)</span></span></span><span class="hljs-function">:</span></span> vk.method(<span class="hljs-string"><span class="hljs-string">'messages.send'</span></span>, {<span class="hljs-string"><span class="hljs-string">'user_id'</span></span>: user_id, <span class="hljs-string"><span class="hljs-string">'message'</span></span>: message}) <span class="hljs-comment"><span class="hljs-comment"># API-   token = "6a9c267cd469388709a9e9acaddbe0aa81a0abbf12239b3e597a31729ffbddb9c88e80a443554c918b8f7" #    vk = vk_api.VkApi(token=token) #    longpoll = VkLongPoll(vk) #   for event in longpoll.listen(): #     if event.type == VkEventType.MESSAGE_NEW: #      (   ) if event.to_me: #    request = event.text #    if request == "": write_msg(event.user_id, "") elif request == "": write_msg(event.user_id, "((") else: write_msg(event.user_id, "   ...")</span></span></code> </pre> <br>  Fungsi write_msg menerima id pengguna VK &lt;user_id&gt;, di mana ia akan mengirim pesan dan pesan itu sendiri. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_msg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user_id, message)</span></span></span><span class="hljs-function">:</span></span> vk.method(<span class="hljs-string"><span class="hljs-string">'messages.send'</span></span>, {<span class="hljs-string"><span class="hljs-string">'user_id'</span></span>: user_id, <span class="hljs-string"><span class="hljs-string">'message'</span></span>: message})</code> </pre> <br>  Masuk sebagai komunitas dan menyiapkan longpool: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># API-   token = "6a9c267cd469388709a9e9acaddbe0aa81a0abbf12239b3e597a31729ffbddb9c88e80a443554c918b8f7" #    vk = vk_api.VkApi(token=token) #    longpoll = VkLongPoll(vk)    : #   for event in longpoll.listen():</span></span></code> </pre> <br>  Di dalamnya, kami akan memeriksa acara secara siklus.  Dan kita bisa mendapatkan tipe acara dengan event.type. <br><br>  Setelah itu, setelah menerima pesan dari pengguna, kami akan dapat mengiriminya surat yang sesuai menggunakan fungsi write_msg yang sudah dibuat. <br><br>  Jadi, kami membuat bot yang sangat sederhana di VK dengan implementasi sederhana yang sama.  Dan logika bot bisa diprogram sesuai keinginan. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Daftar kode GH</a> <br><br><h3>  Sekarang mari kita mulai dengan pemrograman yang lebih nyata. </h3><br>  Buat kelas VkBot di file vk_bot.py, yang akan melayani kita sebagai bot. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VkBot</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"  !"</span></span>) self._USER_ID = user_id self._USERNAME = self._get_user_name_from_vk_id(user_id) self._COMMANDS = [<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>]</code> </pre> <br>  Dan tambahkan metode di sana dengan mana Anda bisa mendapatkan nama pengguna melalui vk id. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_user_name_from_vk_id</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function">:</span></span> request = requests.get(<span class="hljs-string"><span class="hljs-string">"https://vk.com/id"</span></span>+str(user_id)) bs = bs4.BeautifulSoup(request.text, <span class="hljs-string"><span class="hljs-string">"html.parser"</span></span>) user_name = self._clean_all_tag_from_str(bs.findAll(<span class="hljs-string"><span class="hljs-string">"title"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user_name.split()[<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br>  Ini dilakukan dengan menggunakan beatifulsoup4. <br><br>  Instal jika tidak: <br><blockquote>  python -m pip instal bs4 </blockquote>  Ada cukup artikel di dalamnya yang layak untuk dipelajari.  Dengan menggunakannya, kami akan membuat beberapa metode lagi: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  : def _get_time(self): request = requests.get("https://my-calend.ru/date-and-time-today") b = bs4.BeautifulSoup(request.text, "html.parser") return self._clean_all_tag_from_str(str(b.select(".page")[0].findAll("h2")[1])).split()[1] #   def _get_weather(city: str = "-") -&gt; list: request = requests.get("https://sinoptik.com.ru/-" + city) b = bs4.BeautifulSoup(request.text, "html.parser") p3 = b.select('.temperature .p3') weather1 = p3[0].getText() p4 = b.select('.temperature .p4') weather2 = p4[0].getText() p5 = b.select('.temperature .p5') weather3 = p5[0].getText() p6 = b.select('.temperature .p6') weather4 = p6[0].getText() result = '' result = result + (' :' + weather1 + ' ' + weather2) + '\n' result = result + (' :' + weather3 + ' ' + weather4) + '\n' temp = b.select('.rSide .description') weather = temp[0].getText() result = result + weather.strip() return result #       @staticmethod def _clean_all_tag_from_str(string_line): """   stringLine      :param string_line:   :return:   """ result = "" not_skip = True for i in list(string_line): if not_skip: if i == "&lt;": not_skip = False else: result += i else: if i == "&gt;": not_skip = True return result</span></span></code> </pre> <br>  Ubah parameter _get_weather ke kota yang diinginkan, kemudian metode ini dapat dipanggil dengan kota, dan secara default akan menjadi nilai yang Anda tentukan. <br><br>  Dengan menggunakan metode ini, kita bisa mendapatkan waktu dan cuaca.  Metode ini dipotong dari proyek bot utama saya.  Anda harus mengaturnya dalam paket dan kelas yang terpisah, menggunakan warisan.  Tetapi demi contoh pekerjaan, saya memutuskan untuk memasukkan semua ini ke dalam satu kelas bot, yang tentu saja buruk. <br><br>  Kami membuat metode utama new_message, yang akan memproses pesan pengguna dan mengembalikan respons: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  if message.upper() == self._COMMANDS[0]: return f"-, {self._USERNAME}!" #  elif message.upper() == self._COMMANDS[1]: return self._get_weather() #  elif message.upper() == self._COMMANDS[2]: return self._get_time() #  elif message.upper() == self._COMMANDS[3]: return f"-, {self._USERNAME}!" else: return "    ..."</span></span></code> </pre> <br>  Sekarang kembali ke file yang dapat dieksekusi: <br><br>  Impor kelas bot kami: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_bot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkBot</code> </pre> <br>  Mari kita ubah loop utama kami: <br><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"Server started"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> longpoll.listen(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event.type == VkEventType.MESSAGE_NEW: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event.to_me: print(<span class="hljs-string"><span class="hljs-string">'New message:'</span></span>) print(<span class="hljs-string"><span class="hljs-string">f'For me by: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{event.user_id}</span></span></span><span class="hljs-string">'</span></span>, end=<span class="hljs-string"><span class="hljs-string">''</span></span>) bot = VkBot(event.user_id) write_msg(event.user_id, bot.new_message(event.text)) print(<span class="hljs-string"><span class="hljs-string">'Text: '</span></span>, event.text)</code> </pre> <br>  Artinya, sekarang kami akan mengirimkan pesan yang diterima ke objek bot, yang akan mengembalikan jawaban yang diinginkan kepada kami. <br><br>  Komplikasi program ini hanya diperlukan jika Anda ingin lebih meningkatkan fungsionalitas bot: <br><br>  Buat paket dan kelas terpisah untuk setiap fungsi _get_time dan _get_weather.  Atur warisan dari kelas umum.  Dan mendefinisikan setiap fungsi baru dalam kelas yang terpisah, yang terbaik, tentu saja, juga untuk dibagi menjadi beberapa paket. <br><br>  Tambahkan kamus dengan kunci ID pengguna dan nilai objek bot.  Jadi, tidak perlu membuat objek bot setiap kali dalam satu siklus.  Selain itu, ini akan memastikan penggunaan beberapa pengguna sekaligus dalam desain yang kompleks. <br><br>  Jadi, memilih arsitektur kode yang baik, Anda dapat membuat bot multi-fungsi. <br><br>  Misalnya, saya mengajar bot saya untuk memutar musik di komputer, membuka situs sambil duduk di telepon.  Kirim resep untuk sarapan, makan siang, makan malam. <br><br>  Anda dapat mengedit bot sendiri. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bot dari artikel</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proyek bot utama (lanjutan) di GH</a> <br><br>  Saya akan senang dengan ide Anda.  Untuk pertanyaan apa pun, tulis. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id427691/">https://habr.com/ru/post/id427691/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id427681/index.html">Seret dan Geser di RecyclerView. Bagian 1: ItemTouchHelper</a></li>
<li><a href="../id427683/index.html">Mengapa porting over integer overflow bukanlah ide yang baik</a></li>
<li><a href="../id427685/index.html">FSB terhadap Internet satelit dari operator asing</a></li>
<li><a href="../id427687/index.html">Referensi untuk aplikasi bisnis | Arsitektur DentalTap</a></li>
<li><a href="../id427689/index.html">Bir langsung dari awan</a></li>
<li><a href="../id427693/index.html">Buku “Gravity. Godaan Terakhir Einstein</a></li>
<li><a href="../id427695/index.html">Bagaimana saya memulai karir pengembangan saya dari awal dan menerima tawaran hanya dalam 10 bulan</a></li>
<li><a href="../id427697/index.html">Mahasiswa Baru: Universitas.Petunjuk 1.0</a></li>
<li><a href="../id427699/index.html">Barang Antik: Ericsson T39 dan Internet Seluler Awal</a></li>
<li><a href="../id427701/index.html">Panduan Power Bi: Memulai</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>