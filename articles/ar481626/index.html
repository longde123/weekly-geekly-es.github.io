<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐๐ป ๐ ูุฌููุนุงุช ุงูุนุฑุถ ุงููุนูุฏุฉ ูู ูุธุงู ุงูุชุดุบูู iOS: ุงููุดููุงุช ูุงูุญููู ูู ูุซุงู ููุฌุฒ VKontakte ๐ฉ ๐ฅ ๐ง๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุญูุฉ! ุงุณูู ุณุงุดุง ุ ุฃูุง ูุทูุฑ ูุธุงู iOS ูู ุงููุฑูู ุงูุฐู ูุตูุน ุฎูุงุตุฉ VKontakte. ุงูุขู ุณูู ุฃุฎุจุฑู ููู ูููููุง ุชุญุณูู ุนุฑุถ ุงููุงุฌูุฉ ูุงูุชุบูุจ ุนูู ุงููุดุงูู ุงููุฑุชุจุทุฉ ุจุฐูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฌููุนุงุช ุงูุนุฑุถ ุงููุนูุฏุฉ ูู ูุธุงู ุงูุชุดุบูู iOS: ุงููุดููุงุช ูุงูุญููู ูู ูุซุงู ููุฌุฒ VKontakte</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/481626/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชุญูุฉ!  ุงุณูู ุณุงุดุง ุ ุฃูุง ูุทูุฑ ูุธุงู iOS ูู ุงููุฑูู ุงูุฐู ูุตูุน ุฎูุงุตุฉ VKontakte.  ุงูุขู ุณูู ุฃุฎุจุฑู ููู ูููููุง ุชุญุณูู ุนุฑุถ ุงููุงุฌูุฉ ูุงูุชุบูุจ ุนูู ุงููุดุงูู ุงููุฑุชุจุทุฉ ุจุฐูู. <br>  ุฃุนุชูุฏ ุฃูู ููููู ุชุฎูู ูุง ูู ุดุฑูุท VK.  ูุฐู ุดุงุดุฉ ููููู ูู ุฎูุงููุง ูุดุงูุฏุฉ ูุฌููุนุฉ ูุชููุนุฉ ูู ุงููุญุชูู: ุงููุตูุต ูุงูุตูุฑ ุงูุซุงุจุชุฉ ูุตูุฑ GIF ุงููุชุญุฑูุฉ ูุงูุนูุงุตุฑ ุงููุถููุฉ (ุงูููุฏูู ูุงูููุณููู).  ูุฌุจ ุนุฑุถ ูู ูุฐุง ุจุณูุงุณุฉ ุ ูุจุงูุชุงูู ุงููุทุงูุจ ุงูุนุงููุฉ ุนูู ุฃุฏุงุก ุงูุญููู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ููุฑู ูุง ูู ุงูุฃุณุงููุจ ุงูููุงุณูุฉ ููุชุนุงูู ูุน ุงูุชุนูููุงุช ุงูููุฌูุฏุฉ ููุง ูู ุงููููุฏ ุฃู ุงููุฒุงูุง ุงูุชู ูุฌุจ ูุฑุงุนุงุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงูุงุณุชูุงุน ุฃูุซุฑ ูู ูุฑุงุกุฉ ุ ูุฅู ุชุณุฌูู ุงูููุฏูู ุงูุฎุงุต ุจุงูุชูุฑูุฑ <a href="https://vk.com/video-147415323_456239051">ููุง</a> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6u/np/1d/6unp1dycdkq5wxkhtv-6ixrmv-q.png"></p><a name="habracut"></a><br><h1 id="soderzhanie" style=";text-align:right;direction:rtl">  ูุญุชูู </h1><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ูุตู ูุญุณุงุจ ุงูุชุตููู <br>  1.1.  ุชุฎุทูุท ุงูุณูุงุฑุงุช <br>  1.2.  ุญุณุงุจ <code>frame</code> ุงููุฏูู </li><li style=";text-align:right;direction:rtl">  ุญุณุงุจ ุญุฌู ุงููุต <br>  2.1.  ุงูุทุฑู ุงูููุงุณูุฉ ูุญุณุงุจ ุญุฌู <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> <br>  2.2.  ุทุฑู <code>NSAttributedString</code> / <code>NSAttributedString</code> <br>  2.3.  TextKit <br>  2.4.  CoreText </li><li style=";text-align:right;direction:rtl">  ููู ุชุนูู ุฎูุงุตุฉ ููููุชุงูุชูุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุงูุญุตูู ุนูู ุฃุฏุงุก ุฃูุถู <br>  4.1 ููุงุฐุง ูุดุงูู ุงูุฃุฏุงุก <br>  4.2. <code>CATransaction.commit</code> <br>  4.3.  ุชูุฏูู ุฎุท ุฃูุงุจูุจ <br>  4.4.  ุงูุฃูุงูู ุงูุฃูุซุฑ ุถุนูุง ููุฃุฏุงุก </li><li style=";text-align:right;direction:rtl">  ุฃุฏูุงุช ุงูููุงุณ <br>  5.1.  ุชุชุจุน ุงููุธุงู ุงููุนุฏูู <br>  5.2.  ูููู ุจุฅุตูุงุญ ุนูููุงุช ุณุญุจ ุงูุฃุฏุงุก ูู ุงูููุฏ ุฃุซูุงุก ุชุดุบูู ุงูุชุทุจูู </li></ol><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููููุฉ ุงูุจุญุซ ุนู ุงููุดุงูู.  ุชูุตูุงุช </li><li style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </li><li style=";text-align:right;direction:rtl">  ูุตุงุฏุฑ ุงููุนูููุงุช </li></ul><br><h1 id="1-opisanie-i-vychislenie-layout" style=";text-align:right;direction:rtl">  <strong>1. ูุตู ูุญุณุงุจ ุงูุชุตููู</strong> </h1><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุฏุนูุง ูุชุฐูุฑ ููููุฉ ุฅูุดุงุก ุจููุฉ ูุงุฌูุฉ ูุฑุฆูุฉ ( <em>ุชุฎุทูุท</em> ) ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ุนุงุฏูุฉ.  ูู ุฃุฌู ุชูููุฑ ูุณุงุญุฉ ุ ุณููุนู ุจุฏูู ููุงุฆู - ุณุฃููู ุจุจุณุงุทุฉ ุจุณุฑุฏ ุงูุญููู ูุดุฑุญ ููุฒุงุชูุง. </p><br><h2 id="11-auto-layout" style=";text-align:right;direction:rtl">  <strong>1.1.</strong>  <strong>ุชุฎุทูุท ุงูุณูุงุฑุงุช</strong> </h2><br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ุชููู ุงูุทุฑููุฉ ุงูุฃูุซุฑ ุดููุนูุง ูุฅูุดุงุก ูุงุฌูุฉ ูู iOS ูู ุงุณุชุฎุฏุงู ูุธุงู <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html">ุชุฎุทูุท Auto Layout ูู</a> Apple.  ููู <a href="https://habr.com/ru/company/oleg-bunin/blog/437584/">ุชุณุชูุฏ</a> ุฅูู ุฎูุงุฑุฒููุฉ <a href="https://constraints.cs.washington.edu/cassowary/">ูุงุณุงูุงุฑู</a> ุ ุงููุฑุชุจุทุฉ ุงุฑุชุจุงุทูุง ูุซูููุง ุจููููู <em>ุงููููุฏ.</em> </p><br><p style=";text-align:right;direction:rtl">  <em>ุงูุขู ุ ุชุฐูุฑ ุฃู ุงููุงุฌูุฉ ุงููุทุจูุฉ ุจุงุณุชุฎุฏุงู ุงูุชูุณูู ุงูุชููุงุฆู ูุจููุฉ ุนูู ูููุฏ.</em> </p><br><p style=";text-align:right;direction:rtl">  <strong>ููุฒุงุช ุงูููุฌ:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุชุญููู ูุธุงู ุงูููุฏ ุฅูู <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">ูุดููุฉ ุงูุจุฑูุฌุฉ ุงูุฎุทูุฉ</a> . </li><li style=";text-align:right;direction:rtl">  <a href="https://constraints.cs.washington.edu/solvers/cassowary-tochi.pdf">Cassowary ูุญู</a> ูุดููุฉ ุงูุชุญุณูู ุงููุงุชุฌุฉ ุจุงุณุชุฎุฏุงู <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BC%25D0%25BF%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581-%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4">ุทุฑููุฉ simplex</a> .  ูุฐู ุงูุทุฑููุฉ ููุง ุชุนููุฏ ููุงุฑุจ ุงูุฃุณู.  ูุงุฐุง ูุนูู ูุฐุงุ  ูุน ุงุฒุฏูุงุฏ ุนุฏุฏ ุงููููุฏ ูู ุงูุชุฎุทูุท ุ ูู ุฃุณูุฃ ุงูุญุงูุงุช ุ ูููู ุฃู ุชุจุทุฆ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุฃุถุนุงูุง ูุถุงุนูุฉ. </li><li style=";text-align:right;direction:rtl">  ููู <a href="https://developer.apple.com/documentation/uikit/uiview/1622621-frame"><code>frame</code></a> ุงููุงุชุฌุฉ ูู <a href="https://developer.apple.com/documentation/uikit/uiview"><code>UIView</code></a> ูู ุงูุญู ููุดููุฉ ุงูุชุญุณูู ุงูููุงุจูุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  <strong>ููุงุฆุฏ ุงุณุชุฎุฏุงู ุงูุชุฎุทูุท ุงูุชููุงุฆู:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://developer.apple.com/videos/play/wwdc2018/220">ูู ุงูุชุนูููุงุช ุงูุจุณูุทุฉ ุ ุงูุชุนููุฏ ุงูุญุณุงุจู ุงูุฎุทู ูููู</a> . </li><li style=";text-align:right;direction:rtl">  ุฅููุง ุชุชูุงูู ุจุดูู ุฌูุฏ ูุน ุฌููุน ุงูุนูุงุตุฑ ุงูููุงุณูุฉ ุ ูุฃููุง ุชูููุฉ "ุฃุตููุฉ" ูู Apple. </li><li style=";text-align:right;direction:rtl">  ุฎุงุฑุฌ ุงูุตูุฏูู ูุนูู ูุน <code>UIView</code> . </li><li style=";text-align:right;direction:rtl">  ูุชููุฑ ูู Interface Builder ุ ูุงูุฐู ูุณูุญ ูู ุจูุตู ุงูุชุฎุทูุท ูู ููุญุฉ ุงูุนูู ุฃู XIB. </li><li style=";text-align:right;direction:rtl">  ุฅูู ูุถูู ุญูุงู ูุญุฏุซูุง ุญุชู ุฃุซูุงุก ุงูุงูุชูุงู.  ูุฐุง ูุนูู ุฃู ูููุฉ <code>frame</code> ููู <code>UIView</code> ุฏุงุฆููุง (!) ุญู ููููุฉ ุงูุชุฎุทูุท ุงููุนูู. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุฏุฑุงุช ุงููุธุงู ูุงููุฉ ููุนุธู ุงูุนุฑูุถ.  ููููุง ููุณุช ููุงุณุจุฉ ูุฅูุดุงุก ุฃุดุฑุทุฉ ูุน ูููุฉ ูุจูุฑุฉ ูู ุงููุญุชูู ุบูุฑ ุงููุชุฌุงูุณุฉ.  ููุงุฐุงุ </p><br><p style=";text-align:right;direction:rtl">  <strong>ูู ุงูููู ุฃู ุชุชุฐูุฑ ุฃู ุงูุชูุณูู ุงูุชููุงุฆู:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <em>ูุนูู ููุท ูู ุงูููุถูุน ุงูุฑุฆูุณู</em> .  ุงูุชุฑุถ ุฃู ูููุฏุณู Apple ูุฏ ุงุฎุชุงุฑูุง Mainstream ูููุทุฉ ุงูุชุฒุงูู ูู ุญู Auto Layout ูููู ุงูุฅุทุงุฑ ูุฌููุน <code>UIView</code> .  ุจุฏูู ูุฐุง ุ ุณูููู ุนููู ุญุณุงุจ "ุงูุชุฎุทูุท ุงูุชููุงุฆู" ูู ุณูุณูุฉ ุฑุณุงุฆู ูููุตูุฉ ููุฒุงููุฉ ุงูููู ูุน ุณูุณูุฉ ุงูุฑุณุงุฆู ุงูุฑุฆูุณูุฉ ุจุงุณุชูุฑุงุฑ. </li><li style=";text-align:right;direction:rtl">  <em>ูููู ุฃู ุชุนูู ุจุจุทุก ุนูู ุชูุซููุงุช ูุนูุฏุฉ</em> ุ ูุฃููุง ุชุณุชูุฏ ุฅูู ุฎูุงุฑุฒููุฉ ุงูููุฉ ุงูุบุงุดูุฉ ุงูุชู ุงูุชุนููุฏ ูู ุฃุณูุฃ ุงูุญุงูุงุช ูู ุงูุฃุณู. </li><li style=";text-align:right;direction:rtl">  <em>ูุชููุฑ</em> <em>ูุน ูุธุงู iOS 6.0</em> .  ูุฐู ุงููุดููุฉ ููุณุช ุจุงููุงุฏ ุ ููู ุงูุฃูุฑ ูุณุชุญู ุงูุงูุชูุงู. </li></ul><br><p style=";text-align:right;direction:rtl">  <em>ุงูุฎูุงุตุฉ: ุจุงุณุชุฎุฏุงู ุงูุชูุณูู ุงูุชููุงุฆู ุ ูููู ูู ุงูููุงุณุจ ุฅูุดุงุก ุดุงุดุงุช ุจุฏูู ุฃู ูุน ูุฌููุนุงุช ุ ูููู ุจุฏูู ุนูุงูุงุช ูุนูุฏุฉ ุจูู ุงูุนูุงุตุฑ.</em> </p><br><h2 id="12-raschyot-frame-vruchnuyu" style=";text-align:right;direction:rtl">  <strong>1.2.</strong>  <strong>ุญุณุงุจ <code>frame</code> ุงููุฏูู</strong> </h2><br><p style=";text-align:right;direction:rtl">  ุฌููุฑ ุงูููุฌ: ูุญุณุจ ุฌููุน ููู <code>frame</code> ุจุฃููุณูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ูุญู ูููุฐ ุฃุณุงููุจ <a href="https://developer.apple.com/documentation/uikit/uiview/1622482-layoutsubviews%3Flanguage%3Dobjc%2560"><code>layoutSubviews</code></a> ุ <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> .  ููุฐุง ูู ุ ูู <code>layoutSubviews</code> ุฃููุณูุง ูุฑุชุจ ุฌููุน ุงูุนูุงุตุฑ ุงููุฑุนูุฉ ุ ูู <code>sizeThatFits</code> ุ <code>sizeThatFits</code> ูุง ูุญุณุจ ุญุฌู ุงูููุงุจูุฉ ูููููุน ุงููุทููุจ ููุนูุงุตุฑ ูุงููุญุชูู ุงูุชุงุจุน. </p><br><p style=";text-align:right;direction:rtl">  ูุงุฐุง ูุนุทูุ  ูููููุง ููู ุงูุญุณุงุจุงุช ุงููุนูุฏุฉ ุฅูู ุฏูู ุงูุฎูููุฉ ุ ููููู ุฅุฌุฑุงุก ุญุณุงุจุงุช ุจุณูุทุฉ ูุณุจููุง ูู ุงูุฏูู ุงูุฑุฆูุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุง ูู ุงููุดููุฉุ  ุนููู ุฃู ุชููุฐ ุงูุญุณุงุจุงุช ุจููุณู ุ ููู ุงูุณูู ุฃู ุชุฑุชูุจ ุฎุทุฃ.  ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุงูุชุฃูุฏ ูู ุฃู ูููู ุงูุฃุทูุงู ูุงููุชุงุฆุฌ ุงูุชู ูุชู ุฅุฑุฌุงุนูุง ูู <code>sizeThatFits</code> . </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุชูููู ุงูุฐุงุชู ูู ูุง ูุจุฑุฑู ุฅุฐุง:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุฏ ุตุงุฏููุง ุฃู ูุชููุน ุฃููุง ุณููุงุฌู ูููุฏ ุฃุฏุงุก Auto Layout. </li><li style=";text-align:right;direction:rtl">  ูุญุชูู ุงูุชุทุจูู ุนูู ูุฌููุนุฉ ูุนูุฏุฉ ุ ูููุงู ูุฑุตุฉ ุฌูุฏุฉ ุฃู ูุณูุท ุงูุนูุตุฑ ุงููุทููุฑ ูู ุฅุญุฏู ุฎูุงูุงู ุ </li><li style=";text-align:right;direction:rtl">  ูุญู ูุฑูุฏ ุญุณุงุจ ุญุฌู ุงูุนูุตุฑ ูู ูุคุดุฑ ุชุฑุงุจุท ุงูุฎูููุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุนุฑุถ ุนูุงุตุฑ ุบูุฑ ููุงุณูุฉ ุนูู ุงูุดุงุดุฉ ุ ูุฌุจ ุฅุนุงุฏุฉ ุญุณุงุจ ุญุฌููุง ุจุงุณุชูุฑุงุฑ ุญุณุจ ุงููุญุชูู ุฃู ุงูุจูุฆุฉ. <br><img src="https://habrastorage.org/webt/tg/-l/nl/tg-lnlwfkzfzkqir1xdd2dun6la.png"></li></ul><br><p style=";text-align:right;direction:rtl">  <strong>ูุซุงู</strong>  ุงุฑุณู ุชูููุญุงุช ุงูุฃุฏูุงุช ุงูุชู ุชุชุณุน ุชููุงุฆููุง ูุชูุงุณุจ ุงููุญุชูู.  ุงูุฌุฒุก ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ูุฐู ุงููููุฉ ูู ููููุฉ ุญุณุงุจ ุงูุญุฌู ุงููุฑุฆู ูููุต ูู ูู ุชูููุญ ุงูุฃุฏูุงุช. </p><br><hr><br><h1 id="2-vychislenie-razmera-teksta" style=";text-align:right;direction:rtl">  <strong>2. ุญุณุงุจ ุญุฌู ุงููุต</strong> </h1><br><p style=";text-align:right;direction:rtl">  ูููู ุญู ูุฐู ุงููุดููุฉ ุจุฃุฑุจุนุฉ ุทุฑู ุนูู ุงูุฃูู ุ ูุนุชูุฏ ูู ูููุง ุนูู ูุฌููุนุฉ ุงูุทุฑู ุงูุฎุงุตุฉ ุจู.  ูููู ูููุง ุฎุตุงุฆุตูุง ูุงููููุฏ ุงูุฎุงุตุฉ ุจูุง. </p><br><h2 id="21-standartnye-metody-vychisleniya-razmera-uilabeluitextviewuitextfield" style=";text-align:right;direction:rtl">  <strong>2.1.</strong>  <strong>ุงูุทุฑู ุงูููุงุณูุฉ ูุญุณุงุจ ุญุฌู <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code></strong> </h2><br><p style=";text-align:right;direction:rtl">  ุชุฑุฌุน <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> (ุงููุณุชุฎุฏูุฉ ุงูุชุฑุงุถููุง ูู <a href="https://developer.apple.com/documentation/uikit/uiview/1622630-sizetofit"><code>sizeToFit</code></a> ) ู <a href="https://developer.apple.com/documentation/uikit/uiview/1622600-intrinsiccontentsize"><code>intrinsicContentSize</code></a> (ุงููุณุชุฎุฏูุฉ ูู ุงูุชูุณูู ุงูุชููุงุฆู) ุงูุญุฌู ุงูููุถู ููุญุชูู ุงูุนุฑุถ.  ุนูู ุณุจูู ุงููุซุงู ุ ุจูุณุงุนุฏุชูู ุ ูููููุง ูุนุฑูุฉ ููุฏุงุฑ ุงููุณุงุญุฉ ุงูุชู <code>UILabel</code> ุงููุต ุงูููุชูุจ ูู <code>UILabel</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุฌุงูุจ ุงูุณูุจู ูู ุฃู ููุง ุงูุทุฑููุชูู ุชุนููุงู ููุท ูู ุงูุฎูุท ุงูุฑุฆูุณู - ูุง ูููู ุงุณุชุฏุนุงุคููุง ูู ุงูุฎูููุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุชู ุชููู ุงูุทุฑู ุงูููุงุณูุฉ ูููุฏุฉุ</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุงุณุชุฎุฏููุง ุจุงููุนู <code>sizeToFit</code> ุฃู Auto Layout. </li><li style=";text-align:right;direction:rtl">  ุนูุฏูุง ุชููู ููุงู ุนูุงุตุฑ ููุงุณูุฉ ูู ุงูุดุงุดุฉ ุ ููุฑูุฏ ุงูุญุตูู ุนูู ุญุฌููุง ูู ุงูููุฏ. </li><li style=";text-align:right;direction:rtl">  ูุฃู ูุนุฑุถ ุฏูู ูุฌููุนุงุช ูุนูุฏุฉ. </li></ul><br><h2 id="22-metody-nsattributedstringnsstring" style=";text-align:right;direction:rtl">  <strong>2.2.</strong>  <strong>ุทุฑู NSAttributedString / NSString</strong> </h2><br><p style=";text-align:right;direction:rtl">  ูุงุญุธ <a href="https://developer.apple.com/documentation/foundation/nsstring/1531844-sizewithattributes%3Flanguage%3Dobjc"><code>sizeWithAttributes</code></a> ู <a href="https://developer.apple.com/documentation/foundation/nsstring/1531844-sizewithattributes%3Flanguage%3Dobjc"><code>sizeWithAttributes</code></a> .  ูุง ุฃูุตุญ ุจุงุณุชุฎุฏุงููุง ููุฑุงุกุฉ ุญุฌู ูุญุชููุงุช <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> .  ูู ุฃุฌุฏ ูู ุฃู ููุงู ูู ูุนูููุงุช ุงููุซุงุฆู ุฃู ุฃุณุงููุจ <code>NSString</code> ูุทุฑู ุชุฎุทูุท ุนูุงุตุฑ <code>UIView</code> ุชุณุชูุฏ ุฅูู ููุณ ุงูููุฏ (ููุณ ุงููุฆุงุช).  ุชูุชูู ูุงุชุงู ุงููุฌููุนุชุงู ูู ุงููุฆุงุช ุฅูู ุฃุทุฑ ุนูู ูุฎุชููุฉ: Foundation ู UIKit ุ ุนูู ุงูุชูุงูู.  ุฑุจูุง ูุงู ูุฏูู ุจุงููุนู ูุชูุงุณุจ ุงููุชูุฌุฉ <code>UILabel</code> ุญุฌู <code>UILabel</code> ุ  ุฃู ูู <a href="https://stackoverflow.com/questions/15965525/how-to-get-nsstring-size-when-nsstring-includes-emojis"><code> NSString</code></a> ุญูููุฉ ุฃู <a href="https://stackoverflow.com/questions/15965525/how-to-get-nsstring-size-when-nsstring-includes-emojis"><code> NSString</code> ูุง ุชุฃุฎุฐ ุญุฌู ุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ ูู ุงูุงุนุชุจุงุฑ</a> ุ  ูุฐู ูู ุงููุดุงูู ุงูุชู ููููู ุงูุญุตูู ุนูููุง. </p><br><p style=";text-align:right;direction:rtl">  ุณุฃุฎุจุฑู ุฃูุถูุง ุจุงููุตูู ุงูุฏุฑุงุณูุฉ ุงููุณุคููุฉ ุนู ุฑุณู ุงููุต ูู <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> ุ ูููู ุงูุขู <code>UITextField</code> ูุนูุฏ ุฅูู ุงูุฃุณุงููุจ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฅู ุงุณุชุฎุฏุงู boundingRect ู sizeWithAttributes ูุณุชุญู ุฐูู ุฅุฐุง ููุง:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฑุณู ุนูุงุตุฑ ูุงุฌูุฉ ุบูุฑ ููุงุณูุฉ ุจุงุณุชุฎุฏุงู <a href="https://developer.apple.com/documentation/foundation/nsstring/1533109-drawatpoint"><code>drawAtPoint</code></a> ุฃู <a href="https://developer.apple.com/documentation/foundation/nsstring/1533109-drawatpoint"><code>drawAtPoint</code></a> ุฃู ุทุฑู ุฃุฎุฑู <code>NSAttributedString</code> / <code>NSAttributedString</code> . </li><li style=";text-align:right;direction:rtl">  ูุฑูุฏ ุฃู ููุธุฑ ูู ุญุฌู ุงูุนูุงุตุฑ ูู ุฏูู ุงูุฎูููุฉ.  ูุฑุฉ ุฃุฎุฑู ุ ูููู ูุฐุง ููุท ุนูุฏ ุงุณุชุฎุฏุงู ุทุฑู ุงูุชูุฏูู ุงูููุงุณุจุฉ. </li><li style=";text-align:right;direction:rtl">  ุงุฑุณู ุนูู <a href="https://developer.apple.com/documentation/coregraphics/cgcontextref%3Flanguage%3Dobjc">ุณูุงู</a> ุงุนุชุจุงุทู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงุนุฑุถ ุฎุทูุง ุฃุนูู ุงูุตูุฑุฉ. </li></ul><br><h2 id="23-textkit" style=";text-align:right;direction:rtl">  <strong>2.3.</strong>  <strong>TextKit</strong> </h2><br><p style=";text-align:right;direction:rtl">  ุชุชููู ูุฐู ุงูุฃุฏุงุฉ ูู ุงููุฆุงุช ุงูููุงุณูุฉ <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager"><code>NLayoutManager</code></a> ู <a href="https://developer.apple.com/documentation/uikit/nstextstorage"><code>NSTextStorage</code></a> ู <a href="https://developer.apple.com/documentation/uikit/nstextcontainer"><code>NSTextContainer</code></a> .  <code>UILabel</code> ุชุฎุทูุท <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> ุนูููุง. </p><br><p style=";text-align:right;direction:rtl">  TextKit ูุฑูุญุฉ ููุบุงูุฉ ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ูุตู ูููุน ุงููุต ุจุงูุชูุตูู <a href="https://developer.apple.com/documentation/uikit/nstextcontainer/1444569-exclusionpaths">ูุงูุฅุดุงุฑุฉ ุฅูู ุงูุฃุดูุงู ุงูุชู ุณูุชุฏูู ุญูููุง</a> : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/g8/m1/hi/g8m1hixof_ic7gpugctcvug9gsk.png"></p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู TextKit ุ ููููู ุญุณุงุจ ุญุฌู ุนูุงุตุฑ ุงููุงุฌูุฉ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฎูููุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager/1403160-enumeratelinefragments"><code>  frame</code> ุงูุฃุณุทุฑ / ุงูุฃุญุฑู</a> .  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุณูุญ ูู ุงูุฅุทุงุฑ <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager/1403158-drawglyphs">ุจุฑุณู ุงูุญุฑูู ุงูุฑุณูููุฉ</a> ูุชุบููุฑ ูุธูุฑ ุงููุต ุจุงููุงูู ูู ุงูุชุฎุทูุท ุงูููุฌูุฏ.  ูู ูุฐุง ูุนูู ูู ูุธุงู iOS 7.0 ููุง ููู. </p><br><p style=";text-align:right;direction:rtl">  <strong>TextKit ูููุฏ ุนูุฏูุง ุชุญุชุงุฌ ุฅูู:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนุฑุถ ุงููุต ูุน ุชุฎุทูุท ูุนูุฏ. </li><li style=";text-align:right;direction:rtl">  ุฑุณู ุงููุต ุนูู ุงูุตูุฑ. </li><li style=";text-align:right;direction:rtl">  ุญุณุงุจ ุฃุญุฌุงู ุฑูุงุฆุฒ ุงููุฑุฏูุฉ. </li><li style=";text-align:right;direction:rtl">  ุญุณุงุจ ุนุฏุฏ ุงูุฎุทูุท ุ </li><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ูุชุงุฆุฌ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ูู <code>UITextView</code> . </li></ul><br><p style=";text-align:right;direction:rtl">  ุฃุคูุฏ ูุฑุฉ ุฃุฎุฑู.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุญุณุงุจ ุญุฌู <code>UITextView</code> ุ ูุณูููู ุฃููุงู ุจุชูููู ูุซููุงุช <code>NSTextContainer</code> ู <code>NSTextContainer</code> ู <code>NSTextContainer</code> ุ ุซู <code>NSTextContainer</code> <a href="https://developer.apple.com/documentation/uikit/uitextview/1618602-layoutmanager">ุจุชูุฑูุฑ ูุฐู ุงูุญุงูุงุช ุฅูู</a> <code>UITextView</code> <a href="https://developer.apple.com/documentation/uikit/uitextview/1618602-layoutmanager">ุงูููุงุจูุฉ</a> ุ ุญูุซ ุณุชููู ูุณุคููุฉ ุนู ุงูุชุฎุทูุท.  ุจูุฐู ุงูุทุฑููุฉ ููุท ูุถูู ุงููุตุงุฏูุฉ ุงููุงููุฉ ูุฌููุน ุงูููู. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชุณุชุฎุฏู TextKit ูุน <code>UILabel</code> ู <code>UITextField</code> !  ุจุงููุณุจุฉ ููู (ุนูู ุนูุณ <code>UITextView</code> ) ูุง ููููู ุชูููู <code>NSLayoutManager</code> ู <code>NSTextStorage</code> ู <code>NSTextContainer</code> . </p><br><h2 id="24-coretext" style=";text-align:right;direction:rtl">  <strong>2.4.</strong>  <strong>CoreText</strong> </h2><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ุฃุฏุงุฉ ุงููุต ุงููุณุชูู ุงูุฃุฏูู ูู ุฏุงุฆุฑุฉ ุงูุฑูุงุจุฉ ุงูุฏุงุฎููุฉ.  ุฅูู ูููุฑ ุฃูุตู ูุฏุฑ ูู ุงูุชุญูู ูู ุนุฑุถ ุงูุฎุทูุท ูุงูุฃุญุฑู ูุงูุฎุทูุท ูุงููุณุงูุงุช ุงูุจุงุฏุฆุฉ.  ููู ุ ูุซู TextKit ุ ูุณูุญ ูู ุจุญุณุงุจ ุงููุนููุงุช ุงููุทุจุนูุฉ ูููุต ุ ูุซู ุงูุฎุท ุงูุฃุณุงุณู ูุญุฌู ุงูุฅุทุงุฑ ููุฎุทูุท ุงููุฑุฏูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุง ุชุนูููู ุ ูููุง ุฒุงุฏุช ุงูุญุฑูุฉ ุ ุฒุงุฏุช ุงููุณุคูููุฉ.  ูููู ุชุญุตู ุนูู ูุชุงุฆุฌ ุฌูุฏุฉ ุจุงุณุชุฎุฏุงู CoreText ุ ูุฌุจ ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุงุณุชุฎุฏุงู ุทุฑููุง. </p><br><p style=";text-align:right;direction:rtl">  ูููุฑ CoreText ุฃูุงู ูุคุดุฑ ุงูุชุฑุงุจุท ููุนูููุงุช ุนูู ูุนุธู ุงููุงุฆูุงุช.  ูุฐุง ูุนูู ุฃูู ูููููุง ุงุณุชุฏุนุงุก ุฃุณุงููุจูุง ูู ุฎููุท ูุฎุชููุฉ.  ููููุงุฑูุฉ ุ ุนูุฏ ุงุณุชุฎุฏุงู TextKit ุ ุนููู ุฃู ุชููุฑ ูู ุชุณูุณู ููุงููุงุช ุงูุทุฑููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุงุณุชุฎุฏุงู CoreText ุฅุฐุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงู ุญุงุฌุฉ ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุจุณูุทุฉ ููุฎูุถุฉ ุงููุณุชูู ูููุตูู ุงููุจุงุดุฑ ุฅูู ูุนููุงุช ุงููุต.  ูุฌุจ ุฃู ุฃููู ุนูู ุงูููุฑ ุฃูู ุจุงููุณุจุฉ ููุบุงูุจูุฉ ุงูุนุธูู ูู ุงูููุงู ุ ูุฅู ูุฏุฑุงุช TextKit ูุงููุฉ. </li><li style=";text-align:right;direction:rtl">  ููุงู ุงููุซูุฑ ูู ุงูุนูู ุงูุฐู ูุฌุจ ุงูููุงู ุจู ูุน ุงูุฎุทูุท ุงููุฑุฏูุฉ ( <a href="https://developer.apple.com/documentation/coretext/ctline-61l"><code>CTLine</code></a> ) ูุงูุดุฎุตูุงุช / ุงูุนูุงุตุฑ. </li><li style=";text-align:right;direction:rtl">  ุงูุฏุนู ููู ูู ูุธุงู ุงูุชุดุบูู iOS 6.0. </li></ul><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูุชุบุฐูุฉ VKontakte ุ ุงุณุชุฎุฏููุง CoreText.  ููุงุฐุงุ  ูู ุงูููุช ุงูุฐู ูููุง ููู ุจุชูููุฐ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ููุนูู ูุน ุงููุต ุ ูู ููู TextKit ููุฌูุฏูุง ุจุนุฏ. </p><br><hr><br><h1 id="3-kak-rabotaet-lenta-vkontakte" style=";text-align:right;direction:rtl">  <strong>3. ููู ุชุนูู ุชุบุฐูุฉ ููููุชุงูุชูุ</strong> </h1><br><p style=";text-align:right;direction:rtl">  ุจุงุฎุชุตุงุฑ ุญูู ููููุฉ ุงุณุชูุงููุง ููุจูุงูุงุช ูู ุงูุฎุงุฏู ูุชุฎุทูุท ุงูููุงุฐุฌ ูุงูุนุฑูุถ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7g/kx/pt/7gkxptt4lpgjhjzbtyl3prm4vxy.png"></p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุถุน ูู ุงุนุชุจุงุฑู ุงูููุงู ุงูุชู ุชู ุชูููุฐูุง ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฎูููุฉ.  ูุชููู ุจูุงูุงุช ูู ุงูุฎุงุฏู ุ ููููู ุจูุนุงูุฌุชูุง ููุตู ุงูุนุฑุถ ุงููุงุญู.  ูู ูุฐู ุงููุฑุญูุฉ ุ ููุณ ูุฏููุง ูุซููุงุช <code>UIView</code> ุ ููุญู ููุท ูุถุน ููุงุนุฏ ููููู ุงููุงุฌูุฉ ุงููุณุชูุจููุฉ ุจุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุงูุชุนุฑูู ุงูุฎุงุตุฉ ุจูุง ุ ูุงูุชู ุชุดุจู ุฅูู ุญุฏ ูุง <a href="https://developer.apple.com/xcode/swiftui/">SwiftUI</a> .  ูุญุณุงุจ ุงูุชุฎุทูุท ุ ูุญุณุจ <code>frame</code> ุจุฃูููู ูุน ูุฑุงุนุงุฉ ุงููููุฏ ุงูุญุงููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนุฑุถ ุงูุดุงุดุฉ.  ูุฌุนู ุชุญุฏูุซ ูุตุฏุฑ ุงูุจูุงูุงุช ุงูุญุงูู ( <code>dataSourceUpdate</code> ).  ููุง ุ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฎูููุฉ ุ ูููู ุจุฅุนุฏุงุฏ ุงูุตูุฑ: ุฅุฌุฑุงุก ุฅูุบุงุก ุงูุถุบุท (ุงูุธุฑ ูุณู ุงูุฃุฏุงุก ููุฒูุฏ ูู ุงูุชูุงุตูู) ุ ูุฑุณู ุงูุธูุงู ุ ูุงูุฌููุงุช ุ ูุงูุชุฃุซูุฑุงุช ุงูุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูู ุงูุขู ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุฑุฆูุณูุฉ.  <code>dataSourceUpdate</code> ุงููุณุชููุฉ ุนูู <code>dataSourceUpdate</code> ุงุณุชุฎุฏุงู ุฃุญุฏุงุซ ุงููุงุฌูุฉ ุ <code>dataSourceUpdate</code> . </p><br><p style=";text-align:right;direction:rtl">  ููุตู ูุธุงู ุงูุชุตููู ุงูุฎุงุต ุจูุง ุ ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ููุงูุฉ ูููุตูุฉ ุ ููู ููุง ุณุฃุฏุฑุฌ ููุฒุงุชู ุงูุฑุฆูุณูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  API ุงูุชุนุฑููู ูู ูุฌููุนุฉ ูู ุงูููุงุนุฏ ุงูุชู ุจููุช ุนูููุง ุงููุงุฌูุฉ. </li><li style=";text-align:right;direction:rtl">  ุงูููููุงุช ุงูุฃุณุงุณูุฉ ุชุดูู ุดุฌุฑุฉ ( <code>nodes</code> ). </li><li style=";text-align:right;direction:rtl">  ุญุณุงุจุงุช ุจุณูุทุฉ ูู ุงูููููุงุช ุงูุฃุณุงุณูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงูููุงุฆู ุ ูุญุณุจ ุฅุฒุงุญุฉ <code>origin</code> ููุท ุ ูุน ูุฑุงุนุงุฉ ุนุฑุถ / ุงุฑุชูุงุน ุฌููุน ุงูุฃุทูุงู. </li><li style=";text-align:right;direction:rtl">  ูุง ุชูุดุฆ ุงูุนูุงุตุฑ ุงูุฃุณุงุณูุฉ "ุญุงููุงุช" ุบูุฑ ุถุฑูุฑูุฉ ูู <code>UIView</code> ูู ุงูุชุณูุณู ุงููุฑูู.  ุนูู ุณุจูู ุงููุซุงู ุ ูุง ูุดูู ูููู ุงููุงุฆูุฉ <code>UIView</code> ุฅุถุงููุฉ ููุง ูุถูู ุฅููู ุฃุทูุงููุง.  ุจุฏูุงู ูู ุฐูู ุ ูุญุณุจ ุฅุฒุงุญุฉ <code>origin</code> ุงูุฃุทูุงู ุจุงููุณุจุฉ ุฅูู ุงูุนูุตุฑ ุงูุฃุตู (ููุงุฆูุฉ). </li><li style=";text-align:right;direction:rtl">  ุฅุฏุงุฑุฉ ุงููุต ููุฎูุถุฉ ุงููุณุชูู ูุน CoreText. </li></ul><br><p style=";text-align:right;direction:rtl">  ูููู ุญุชู ูุน ูุฐุง ุงูููุฌ ุ ูุฏ ูุง ูููู ุนุฑุถ ุงูุดุฑูุท ุณูุณูุง ุจุณุจุจ ูุดููุงุช ูู ุงูุฃุฏุงุก.  ููุงุฐุงุ </p><br><p style=";text-align:right;direction:rtl">  ูู ุฎููุฉ ููุง ุชุณูุณู ูุฑูู ูุนูุฏ ูู <code>nodes</code> .  ูุนูู ุงูุฑุบู ูู ุฃู ุงูุนูุงุตุฑ ุงูุฃุณุงุณูุฉ ูุง ุชูุดุฆ ุญุงููุงุช ุบูุฑ ุถุฑูุฑูุฉ ุ <code>UIView</code> ูุฒุงู <code>UIView</code> ุนุฑุถ ุงููุซูุฑ ูู <code>UIView</code> ูู ุงูุดุฑูุท.  ูุนูุฏ ููุก ุงูุชุณูุณู ุงููุฑูู ุจู "ุงูุนูุฏ" (ุนุฑุถ ุงูุฑุจุท) ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุฑุฆูุณูุฉ ุ ููุงู ุนูู ุฅุถุงูู ูุตุนุจ ุงูุงุจุชุนุงุฏ ุนูู. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงูููุง ููู ุฃูุจุฑ ุนุฏุฏ ูููู ูู ุงูููุงู ุฅูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฎูููุฉ ูููุงุตู ุงูุขู ุงูููุงู ุจุฐูู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ุนูููุงุช ูุซููุฉ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุงููุนุงูุฌุงุช ุงูููุซูุฉ ุงูุชู ูุฌุจ ุฃู ุชุคุฎุฐ ูู ุงูุงุนุชุจุงุฑ ูุงูุชุญุงูู ุนูููุง. </p><br><hr><br><h1 id="4-kak-dobitsya-luchshey-proizvoditelnosti" style=";text-align:right;direction:rtl">  <strong>4. ููููุฉ ุชุญููู ุฃุฏุงุก ุฃูุถู</strong> </h1><br><p style=";text-align:right;direction:rtl">  ุฃุจุณุท ุฅุฌุงุจุฉ ูู ุฅูุบุงุก ุชุญููู ุงูุณูุณูุฉ ุงูุฑุฆูุณูุฉ ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ููุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช.  ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู ููู ุนููู ูุนูู ุชุทุจููุงุช ุฏุงุฆุฑุฉ ุงูุฑูุงุจุฉ ุงูุฏุงุฎููุฉ.  ููุจู ูู ุดูุก ุ ุชุญุฏูุฏ ูุตุงุฏุฑ ุงููุดุงูู. </p><br><h2 id="41-pochemu-voznikayut-problemy-s-proizvoditelnostyu" style=";text-align:right;direction:rtl">  <strong>4.1 ููุงุฐุง ูุดุงูู ุงูุฃุฏุงุก</strong> </h2><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุฃุณุงุณูุฉ ุ <code>RunLoop</code> ูุงูุชูุฑูุฑ</strong> <br>  ููุชุฐูุฑ ููู ุชู ุจูุงุก ุงููุงุฌูุฉ ูู ูุธุงู iOS.  ูู ุงููุณุชูู ุงูุฃุนูู ุ ููุงู <a href="https://developer.apple.com/documentation/uikit">UIKit</a> ุ ุงููุณุคููุฉ ุนู ุงูุชูุงุนู ูุน ุงููุณุชุฎุฏู: ุงูุชุนุงูู ูุน ุงูุฅููุงุกุงุช ุ ูุงุณุชููุงุธ ุงูุชุทุจูู ูู ุงูููู ุ ูุฃุดูุงุก ููุงุซูุฉ.  ูุชูุฏูู ุงููุงุฌูุฉ ุ ุชููู ุงูุฃุฏุงุฉ ุฐุงุช ุงููุณุชูู ุงูุฃุฏูู ูุณุคููุฉ - <a href="https://developer.apple.com/documentation/quartzcore">ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุฃุณุงุณูุฉ</a> (ููุง ูู ุงูุญุงู ูู ูุธุงู ุงูุชุดุบูู MacOS).  ูุฐุง ุฅุทุงุฑ ูุน <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html">ูุธุงู ูุตู ุงููุงุฌูุฉ</a> ุงูุฎุงุต ุจู.  ุงููุธุฑ ูู ุงูููุงููู ุงูุฃุณุงุณูุฉ ูุจูุงุก ูุงุฌูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูู Core Animation ุ ุงููุงุฌูุฉ ุจุงููุงูู ูู ุทุจูุงุช <a href="https://developer.apple.com/documentation/quartzcore/calayer"><code>CALayer</code></a> .  ุฃููุง ุชุดูู ุดุฌุฑุฉ ุชุฌุณูุฏ ุ ุชุฏุงุฑ ูู ุฎูุงู ุงููุนุงููุงุช <a href="https://developer.apple.com/documentation/quartzcore/catransaction"><code>CATransaction</code></a> . </p><br><p style=";text-align:right;direction:rtl">  ุงููุนุงููุฉ ูู ูุฌููุนุฉ ูู ุงูุชุบููุฑุงุช ุ ูุจุดูู ุฃูุซุฑ ุฏูุฉ ุ ูุนูููุงุช ุญูู ุงูุญุงุฌุฉ ุฅูู ุชุญุฏูุซ ุดูุก ูุง ูู ุงููุงุฌูุฉ ุงููุนุฑูุถุฉ.  ููุน ุฃู ุชุบููุฑ ูู <code>frame</code> ุฃู ูุนููุงุช ุทุจูุฉ ุฃุฎุฑู ูู ุงููุนุงููุฉ ุงูุญุงููุฉ.  ุฅู ูู ููู ุจุงููุนู ุ ูุฅู ุงููุธุงู ููุณู ููุดุฆ <a href="https://developer.apple.com/documentation/quartzcore/catransaction%3Flanguage%3Dobjc"><em>ูุนุงููุฉ ุถูููุฉ</em></a> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุนุฏูุฏ ูู ุงููุนุงููุงุช ุชุดูู ููุฏุณ.  ุชุญุฏูุซุงุช ุฌุฏูุฏุฉ ุชูุฏุฑุฌ ูู ุฃุนูู ูุนุงููุฉ ุงูููุฏุณ. </p><br><p style=";text-align:right;direction:rtl">  <em>ูุนูู ุงูุขู ุฃูู ูุชุญุฏูุซ ุงูุดุงุดุฉ ุ ูุญุชุงุฌ ุฅูู ุชุดููู ูุนุงููุงุช ุจูุนููุงุช ุฌุฏูุฏุฉ ูุดุฌุฑุฉ ุงูุทุจูุฉ.</em> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/84/2n/q5/842nq5jznw5i30ybdmqjrngqhiw.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ูุชู ูููู ุชูุดุฆ ุงููุนุงููุงุชุ</strong>  ูู ุชุทุจูููุง ุ ุงูููุงุถูุน ูุฏููุง <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html">ููุงู</a> ูุณูู <a href="https://developer.apple.com/documentation/foundation/runloop"><code>RunLoop</code></a> .  ุจุนุจุงุฑุงุช ุจุณูุทุฉ ุ ูุฐู ุญููุฉ ูุง ููุงุฆูุฉ ุ ูุชู ุนูุฏูุง ูุนุงูุฌุฉ <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BA%25D0%25BB_%25D1%2581%25D0%25BE%25D0%25B1%25D1%258B%25D1%2582%25D0%25B8%25D0%25B9">ูุงุฆูุฉ ุงูุงูุชุธุงุฑ</a> ุงูุญุงููุฉ <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BA%25D0%25BB_%25D1%2581%25D0%25BE%25D0%25B1%25D1%258B%25D1%2582%25D0%25B8%25D0%25B9">ููุฃุญุฏุงุซ</a> . </p><br><p style=";text-align:right;direction:rtl">  ูู ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฑุฆูุณู ุ ููุงู ุญุงุฌุฉ ุฅูู <code>RunLoop</code> ููุนุงูุฌุฉ ุงูุฃุญุฏุงุซ ูู ูุตุงุฏุฑ ูุฎุชููุฉ ุ ูุซู ุงููุงุฌูุฉ (ุงูุฅููุงุกุงุช) ุฃู <a href="https://developer.apple.com/documentation/foundation/nsstream"><code>NSStream</code></a> ุฃู ุนูู ุณุจูู ุงููุซุงู ูุนุงูุฌุงุช ูุชููู ุงูุจูุงูุงุช ูู <a href="https://developer.apple.com/documentation/foundation/nsstream"><code>NSStream</code></a> ู <a href="https://developer.apple.com/documentation/foundation/nsport"><code>NSPort</code></a> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rd/f_/_m/rdf__mlll7k8wkiz6ijg8cnhhba.png"></p><br><p style=";text-align:right;direction:rtl">  ููู ุชุฑุชุจุท ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุฃุณุงุณูุฉ ู <code>RunLoop</code> ุ  ููุฏ ูุฌุฏูุง ุฃุนูุงู ุฃูู ุนูุฏ ุชุบููุฑ ุฎุตุงุฆุต ุทุจูุฉ ูู Render Tree ุ ูููู ุงููุธุงู ุจุฅูุดุงุก ูุนุงููุงุช ุถูููุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ (ูุฐูู ุ ูุญู ูุณูุง ุจุญุงุฌุฉ ุฅูู ุงุณุชุฏุนุงุก <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448282-begin"><code>CATransaction.begin</code></a> ูุฅุนุงุฏุฉ ุฑุณู ุดูุก).  ุนูุงูุฉ ุนูู ุฐูู ุ ูู ูู ุชูุฑุงุฑ ูู <code>RunLoop</code> ุงููุธุงู ุชููุงุฆููุง ุจุฅุบูุงู ุงููุนุงููุงุช ุงูููุชูุญุฉ ููุทุจู ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง ( <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448255-commit"><code>CATransaction.commit</code></a> ). </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุชุจู!</strong>  ูุง ูุนุชูุฏ ุนุฏุฏ ุงูุชูุฑุงุฑุงุช <code>RunLoop</code> ุนูู ูุนุฏู ุชุญุฏูุซ ุงูุดุงุดุฉ.  ูุง ุชุชู ูุฒุงููุฉ ุงูุฏูุฑุฉ ูุน ุงูุดุงุดุฉ ุนูู ุงูุฅุทูุงู ูุชุนูู ูุซู "ูุงููุงุฆู <code>while()</code> ". </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนููุง ูุฑู ูุง ูุญุฏุซ ูู ุชูุฑุงุฑุงุช <code>RunLoop</code> ุนูู ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฑุฆูุณู ุฃุซูุงุก ุงูุชูุฑูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ... if (dispatchBlocks.count &gt; 0) { //   MainQueue doBlocks() } ... if (hasPanEvent) { handlePan() // UIScrollView change content offset -&gt; change bounds } ... if (hasCATransaction) { CATransaction.commit() } ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุชู ุชูููุฐ ุงููุชู ุงููุถุงูุฉ ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุฑุฆูุณูุฉ ูู ุฎูุงู <a href="https://developer.apple.com/documentation/dispatch/1453057-dispatch_async"><code>dispatch_async</code></a> / <a href="https://developer.apple.com/documentation/dispatch/1452870-dispatch_sync"><code>dispatch_sync</code></a> .  ูุญุชู ูุชู ุฅููุงููุง ุ ูุง ููุชูู ุงูุจุฑูุงูุฌ ุฅูู ุงูููุงู ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ุชุจุฏุฃ UIKit ูู ูุนุงูุฌุฉ <a href="https://developer.apple.com/documentation/uikit/uipangesturerecognizer">ุฅููุงุกุฉ ุงููุณุชุฎุฏู</a> .  ูุฌุฒุก ูู ูุนุงูุฌุฉ ูุฐู ุงูุฅููุงุกุฉ ุ ูุชุบูุฑ <a href="https://developer.apple.com/documentation/uikit/uiscrollview/1619404-contentoffset"><code>UIScrollView.contentOffset</code></a> ุ ููุชูุฌุฉ ูุฐูู ุ <a href="https://developer.apple.com/documentation/uikit/uiview/1622580-bounds"><code>UIScrollView.bounds</code></a> .  ูุคุฏู ุชุบููุฑ <code>bounds</code> <a href="https://developer.apple.com/documentation/uikit/uiscrollview"><code>UIScrollView</code></a> (ุนูู ุงูุชูุงูู ุ ูุฃุญูุงุฏูุง <a href="https://developer.apple.com/documentation/uikit/uicollectionview"><code>UICollectionView</code></a> ุ <a href="https://developer.apple.com/documentation/uikit/uicollectionview"><code>UICollectionView</code></a> ) ุฅูู ุชุญุฏูุซ ุงูุฌุฒุก ุงููุฑุฆู ูู ุงููุญุชูู ( <code>viewport</code> ). </p><br><p style=";text-align:right;direction:rtl">  ูู ููุงูุฉ ุงูุชูุฑุงุฑ <code>RunLoop</code> ุ ุฅุฐุง ูุงู ูุฏููุง ูุนุงููุงุช ููุชูุญุฉ ุ ูุญุฏุซ <code>commit</code> ุฃู <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448270-flush"><code>flush</code></a> ุชููุงุฆููุง. </p><br><p style=";text-align:right;direction:rtl">  ููุชุญูู ูู ููููุฉ ุนูู ุฐูู ุ ุถุน ููุงุท ุงูุชููู ูู ุงูุฃูุงูู ุงูููุงุณุจุฉ. <br>  ุฅููู ูุง ุณุชุจุฏู ุนููู ุนูููุฉ ุงูุฅููุงุกุงุช: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/9c/kw/08/9ckw08wo9cay2nhxqm7qikm1n4w.png"></p><br><p style=";text-align:right;direction:rtl">  <code>CATransaction.commit</code> ุจุนุฏ <code>handlePan</code> : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/0k/h0/xc/0kh0xcaq1yx04htvepmilc_przq.png"></p><br><p style=";text-align:right;direction:rtl">  ุฃุซูุงุก ุชุจุงุทุค ุนูููุฉ ุงูุชูุฑูุฑ ุ ุชูุดุฆ <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> ุฌูุงุฒ <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> ููุช <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> ููุฒุงููุฉ ุนุฏุฏ ุงูุชุบููุฑุงุช ุงูุชู ูุชู ุฅุฌุฑุงุคูุง ุนูู <code>contentOffset</code> ูู ุงูุซุงููุฉ ูุน ูุนุฏู ุชุญุฏูุซ ุงูุดุงุดุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/42/gz/5x/42gz5xmatumqfi9jpcl3z1gabic.png"></p><br><p style=";text-align:right;direction:rtl">  <code>CATransaction.commit</code> ุฃู <code>CATransaction.commit</code> ูุง ูุญุฏุซ ูู ููุงูุฉ ุงูุชูุฑุงุฑ <code>RunLoop</code> ุ ูููู ูุจุงุดุฑุฉ ูู ูุนุงูุฌุฉ ูุคูุช <code>CADisplayLink</code> .  ููู ูุฐุง ูุง ููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/oq/si/f0/oqsif0ek7f1-w4f4lguvp_eun20.png"></p><br><h2 id="42-catransactioncommit" style=";text-align:right;direction:rtl">  <strong>4.2.</strong> <strong><code>CATransaction.commit</code></strong> </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ูุชู ุชูููุฐ ุฌููุน ุงูุนูููุงุช ุฏุงุฎู <code>CATransaction.commit</code> ุนูู ุทุจูุงุช <code>CALayer</code> .  <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410935-layoutsublayers%3Flanguage%3Dobjc"><code>layoutSublayers</code></a> ุทุฑููุง ุงูุฎุงุตุฉ ูุชุญุฏูุซ ุงูุชูุณูู ( <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410935-layoutsublayers%3Flanguage%3Dobjc"><code>layoutSublayers</code></a> ) ูุงูุตูุฑุฉ ( <a href="https://developer.apple.com/documentation/quartzcore/calayerdelegate/2097262-draw"><code>drawLayer</code></a> ).  ููุชุฌ ุนู ุงูุชุทุจูู ุงูุงูุชุฑุงุถู ููุฐู ุงูุทุฑู ุงุณุชุฏุนุงุกุงุช ุฃุณููุจ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410984-delegate">ุงููููุถ</a> .  ุจุฅุถุงูุฉ ูุซูู ุฌุฏูุฏ ูู <code>UIView</code> ุฅูู ุงูุชุณูุณู ุงููุฑูู <code>UIView</code> ุ ูุฅููุง ูุถูู ุถููููุง ุงูุทุจูุฉ ุงูููุงุจูุฉ ุฅูู ุงูุชุณูุณู ุงููุฑูู ูุทุจูุฉ ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงูุฃุณุงุณูุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู <code>UIView</code> ุงูุชุฑุงุถููุง ูููุถูุง ูุทุจูุชู.  ููุง ุชุฑูู ูู ููุฏุณ ุงูุงุณุชุฏุนุงุกุงุช ุ ุชููุฐ <code>UIView</code> ูุฌุฒุก ูู ุชูููุฐ ุฃุณุงููุจ ุชูููุถ <code>CALayer</code> ุ ุฃุณุงููุจูุง ุ ูุงูุชู ุณูุชู ููุงูุดุชูุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/oq/si/f0/oqsif0ek7f1-w4f4lguvp_eun20.png"></p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง ุนุงุฏุฉู ูุง ูุนูู ูุน ุงูุชุณูุณู ุงููุฑูู <code>UIView</code> ุ <code>UIView</code> ุงููุตู ูุน ุฃูุซูุฉ <code>UIView</code> . </p><br><p style=";text-align:right;direction:rtl">  ุฃุซูุงุก <code>CATransaction.commit</code> ุ ูุชู ุชูููุฐ ุชุฎุทูุท ุฌููุน <code>UIView</code> ุงููููุฒุฉ ุจู <a href="https://developer.apple.com/documentation/uikit/uiview/1622601-setneedslayout"><code>setNeedsLayout</code></a> .  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงุณุชุฏุนุงุก <a href="https://developer.apple.com/documentation/uikit/uiview/1622482-layoutsubviews"><code>layoutSubviews</code></a> ุฃู <a href="https://developer.apple.com/documentation/uikit/uiview/1622507-layoutifneeded"><code>layoutIfNeeded</code></a> ูุฑุฉ ุฃุฎุฑู ููุณ ููุทูููุง ุจุณุจุจ ุชูููุฐูุง ุงููุคุฌู ุงููุถููู ูู ุงููุธุงู ุฏุงุฎู <code>CATransaction.commit</code> .  ุญุชู ูู ููุช ูู ุฅุญุฏู ุงููุนุงููุงุช (ุจูู ุงูููุงููุงุช ุฅูู <code>CATransaction.begin</code> ู <code>CATransaction.commit</code> ) ุจุชุบููุฑ <code>frame</code> ุนุฏุฉ ูุฑุงุช ูุงุณุชุฏุนุงุก <code>setNeedsLayout</code> ุ ููู ูุชู ุชุทุจูู ูู ุชุบููุฑ ุนูู ุงูููุฑ.  ูู ุชุณุฑู ุงูุชุบููุฑุงุช ุงูููุงุฆูุฉ ุฅูุง ุจุนุฏ ุงูุงุชุตุงู ุจู <code>CATransaction.commit</code> .  ุฃุณุงููุจ <code>CALayer</code> ุฐุงุช ุงูุตูุฉ: <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410946-setneedslayout%3Flanguage%3Dobjc"><code>setNeedsLayout</code></a> ู <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410873-layoutifneeded%3Flanguage%3Dobjc"><code>layoutIfNeeded</code></a> ู <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410935-layoutsublayers%3Flanguage%3Dobjc"><code>layoutSublayers</code></a> . </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููู ูุฌููุนุฉ ูุดุงุจูุฉ ููุฑุณู ุจูุงุณุทุฉ ุฃุณุงููุจ <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> ู <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> .  ุจุงููุณุจุฉ ุฅูู <code>CALayer</code> ูุฐุง ูู <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410855-setneedsdisplay"><code>setNeedsDisplay</code></a> ู <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410813-displayifneeded"><code>displayIfNeeded</code></a> ู <a href="https://developer.apple.com/documentation/quartzcore/calayerdelegate/2097262-draw"><code>drawLayer</code></a> .  ูุณุชุฏุนู <code>CATransaction.commit</code> ุทุฑู ุงูุชูุฏูู ุนูู ุฌููุน ุงูุนูุงุตุฑ ุงููููุฒุฉ ุจู <code>setNeedsDisplay</code> .  ูุดุงุฑ ุฅูู ูุฐู ุงูุฎุทูุฉ ุฃุญูุงููุง ุจุงูุฑุณู ุฎุงุฑุฌ ุงูุดุงุดุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุซุงู</strong>  <code>UITableView</code> ูุงูุฑุงุญุฉ ุ ุฎุฐ <code>UITableView</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ... // Layout UITableView.layoutSubviews() //  ,   .. ... // Offscreen drawing UITableView.drawRect() //    ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  UIKit ุชุนูุฏ ุงุณุชุฎุฏุงู <code>UICollectionView</code> / <code>UICollectionView</code> ูู <code>layoutSubviews</code> : ุชุณุชุฏุนู <code>willDisplayCell</code> ููุฏูุจ <code>willDisplayCell</code> ููุง ุฅูู ุฐูู.  ูุญุฏุซ ุฑุณู Offscreen ุฃุซูุงุก <code>CATransaction.commit</code> : ูุชู <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> ุฃุณุงููุจ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> ูุฌููุน ุงูุทุจูุงุช ุฃู <a href="https://developer.apple.com/documentation/uikit/uiview/1622529-drawrect"><code>drawRect</code></a> ูุฌููุน <code>UIView</code> ุงูุชู <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> .  ูุงุญุธุช ุนูุฏูุง ูุฑุณู ุดูุฆูุง ูุง ูู <code>drawRect</code> ุ ูุญุฏุซ ูุฐุง ูู ุงูุฎูุท ุงูุฑุฆูุณู ุ ููุญู ุจุญุงุฌุฉ ูุงุณุฉ ุฅูู ุชุบููุฑ ุนุฑุถ ุงูุทุจูุงุช ูุฅุทุงุฑ ุฌุฏูุฏ.  ูู ุงููุงุถุญ ุฃู ูุซู ูุฐุง ุงูุญู ูููู ุฃู ูููู ุบูุฑ ูุนุงู ููุบุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุงุฐุง ูุญุฏุซ ุจุนุฏ ุฐูู ูู <code>CATransaction.commit</code> ุ  ูุชู ุฅุฑุณุงู Render Tree ุฅูู Render Server. </p><br><h2 id="43-rendering-pipeline" style=";text-align:right;direction:rtl">  <strong>4.3.</strong>  <strong>ุชูุฏูู ุฎุท ุฃูุงุจูุจ</strong> </h2><br><p style=";text-align:right;direction:rtl">  ุงุณุชุฑุฌุน ุงูุนูููุฉ ุจุฃููููุง ูุชุดููู ุฅุทุงุฑ ูุงุฌูุฉ ูู iOS (ุฎุท ุฃูุงุจูุจ ุงูุชูุฏูู [WWDC 2014 Session 419. ุงูุฑุณููุงุช ุงููุชูุฏูุฉ ูุงูุฑุณูู ุงููุชุญุฑูุฉ ูุชุทุจููุงุช iOS]): </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wh/ac/dj/whacdjlwdz9p3yxk4q2lonad4ag.png"></p><br><p style=";text-align:right;direction:rtl">  ููุณ ููุท ุนูููุฉ ุชุทุจูููุง ูู ุงููุณุคููุฉ ุนู ุชุดููู ุงูุฅุทุงุฑ - Core Animation ุชุนูู ุฃูุถูุง ูู ุนูููุฉ ูุธุงู ูููุตูุฉ ุชุณูู Render Server. </p><br><p style=";text-align:right;direction:rtl">  <strong>ููู ูุชู ุชุดููู ุงูุฅุทุงุฑ.</strong>  ูุญู (ุฃู ุงููุธุงู ุจุงููุณุจุฉ ููุง) ูููู ุจุฅูุดุงุก ูุนุงููุฉ ุฌุฏูุฏุฉ ( <code>CATransaction</code> ) ูู ุงูุชุทุจูู ูุน ูุตู ูุชุบููุฑุงุช ุงููุงุฌูุฉ ุ "ุงูุงูุชุฒุงู" ุจูุง ูููููุง ุฅูู Render Server.  ูู ุดูุก ุ ุนูู ุฌุงูุจ ุงูุชุทุจูู ุ ูุชู ุงูุนูู.  ุจุนุฏ ุฐูู ุ ูููู Render Server ุจูู ุชุดููุฑ ุงููุนุงููุฉ (Render Tree) ุ ููุณุชุฏุนู ุงูุฃูุงูุฑ ุงููุงุฒูุฉ ุนูู ุฑูุงูุฉ ุงูููุฏูู ุ ููุฑุณู ุฅุทุงุฑูุง ุฌุฏูุฏูุง ููุนุฑุถู ุนูู ุงูุดุงุดุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููู ุงููุซูุฑ ููุงูุชูุงู ุ ุนูุฏ ุฅูุดุงุก ุงูุฅุทุงุฑ ุ ูุชู ุงุณุชุฎุฏุงู "ุชุนุฏุฏ ูุคุดุฑุงุช ุชุฑุงุจุท" ูุนูู.  ุฅุฐุง ูุงู ูุนุฏู ุชุญุฏูุซ ุงูุดุงุดุฉ 60 ุฅุทุงุฑูุง ูู ุงูุซุงููุฉ ุ ูุชู ุชุดููู ุฅุทุงุฑ ุฌุฏูุฏ ูู ุงููุฌููุน ููุณ ูู 1/60 ุ ูููู ูู 1/30 ูู ุงูุซุงููุฉ.  ูุฐุง ูุฃูู ุจูููุง ูุนุฏ ุงูุชุทุจูู ุฅุทุงุฑูุง ุฌุฏูุฏูุง ุ ูุง ูุฒุงู Render Server ูุนุงูุฌ ุงูุฅุทุงุฑ ุงูุณุงุจู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vz/cp/oa/vzcpoae_zvhzw0zkhll1_tjuwwy.png"></p><br><p style=";text-align:right;direction:rtl">  ูุจุดูู ุชูุฑูุจู ุ ูุชููู ุฅุฌูุงูู ููุช ุชูููู ุงูุฅุทุงุฑ ูุจู ุนุฑุถูุง ุนูู ุงูุดุงุดุฉ ูู 1/60 ุซุงููุฉ ูู ุนูููุชูุง ูุชุดููู ุงููุนุงููุฉ ู 1/60 ุซุงููุฉ ูู ุนูููุฉ Render Server ุนูุฏ ูุนุงูุฌุฉ ุงููุนุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุฏ ุฃู ุฃุฏูู ุจุงูููุงุญุธุฉ ุงูุชุงููุฉ.  <strong>ูููููุง ููุงุฒุงุฉ ุฑุณู ุงูุทุจูุงุช ุจุฃููุณูุง</strong> <a href="https://developer.apple.com/documentation/uikit/1623912-uigraphicsbeginimagecontextwitho">ูุชูุฏูู</a> ูุญุชููุงุช <code>CGImage</code> <code>UIImage</code> / <code>CGImage</code> ูู ุฏูู ุงูุฎูููุฉ.  ุจุนุฏ ุฐูู ุ ูู <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410773-contents"><code>CALayer.contents</code></a> ุงูุฑุฆูุณูุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุนููู ุงูุตูุฑุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ูุฎุงุตูุฉ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410773-contents"><code>CALayer.contents</code></a> .  ูู ุญูุซ ุงูุฃุฏุงุก ุ ูุฐุง ูู ููุฌ ุฌูุฏ ููุบุงูุฉ.  ูุฐุง ูู ุงููุทูุฑูู ุงูุฐูู ูุณุชุฎุฏููู ุฐูู <a href="https://texturegroup.org/">ุงููููุณ</a> .  ูููู ูุธุฑูุง ูุฃููุง ูุง ูุณุชุทูุน ุชุบููุฑ <code>CALayer.contents</code> ุฅูุง ูู ุนูููุฉ ุฅูุดุงุก ูุนุงููุฉ ูู ุนูููุฉ ุชุทุจูููุง ุ ูุฏููุง ููุท 1/60 ุซุงููุฉ ุนูุฏ 60 ุฅุทุงุฑูุง ูุฅูุดุงุก ุตูุฑุฉ ุฌุฏูุฏุฉ ูุงุณุชุจุฏุงููุง ุ ุจุฏูุงู ูู 1/30 ุซุงููุฉ (ูุน ุงูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุชุญุณููุงุช ูููุงุฒูุฉ ุฎุท ุฃูุงุจูุจ ุงูุชูุฏูู ูุน Render Server ). </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุง ูุฒุงู Render Server ูุงุฏุฑูุง ุนูู ุงูุชุนุงูู ูุน ุงููุฒุฌ (ุงูุธุฑ ุฃุฏูุงู) ูุงูุชุฎุฒูู ุงููุคูุช ููุทุจูุฉ ุงููุตูุฑุฉ ุงูุฃุฌู [iOS Core Animation: Advanced Techniques.  ููู ูููููุฏ].        1/60      <code>CALayer.contents</code> ,         .     . </p><br><p style=";text-align:right;direction:rtl"> <em>:    ,     .</em> </p><br><h2 id="44-samye-uyazvimye-po-proizvoditelnosti-mesta" style=";text-align:right;direction:rtl"> <strong>4.4.     </strong> </h2><br><p style=";text-align:right;direction:rtl"> <strong>Main-thread</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yt/c7/2n/ytc72nywgvqohz44yx_lsr9jhti.png"></p><br><p style=";text-align:right;direction:rtl"> <strong><em> 1.     ( <code>CATransaction.commit</code> )</em></strong> -   <code>UIView.layoutSubviews</code>     <code>UIView</code> (,  <code>CALayer</code> ).   ,         <code>layoutSubviews</code> / <code>cellForRow</code> / <code>willDisplayCell</code> . </p><br><p style=";text-align:right;direction:rtl"> <strong><em> 2.    <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> / <a href="https://developer.apple.com/documentation/uikit/uiview/1622529-drawrect"><code>drawRect</code></a> .</em></strong>  -  Main-      ( <code>CATransaction.commit</code> ) โ  .                 ,    . </p><br><p style=";text-align:right;direction:rtl"> <strong><em> 3.     </em></strong> .          .        <code>CATransaction.commit</code> ,        ,  <a href="https://developer.apple.com/documentation/uikit/uiimage/1624092-draw"></a>    . </p><br><p style=";text-align:right;direction:rtl"> <strong><em> 4.   .</em></strong>                <code>UIImage</code> / <code>CGImage</code> . </p><br><p style=";text-align:right;direction:rtl"> <strong><em> 5.  </em></strong> .     Main-thread   ,     scroll.           -  ,       UI. </p><br><p style=";text-align:right;direction:rtl"> <strong><em> 6.    Main-.</em></strong>    , <code>RunLoop</code>  Main-   ,     ,   Main-.         . </p><br><p style=";text-align:right;direction:rtl"> <strong>GPU</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xx/gl/cq/xxglcqd-3yjgmjsuxkppjbzbc38.png"></p><br><p style=";text-align:right;direction:rtl"> <strong><em>Blending</em></strong> .        GPU       (  Render Server       GPU,         ).   ,      ,      Background-. </p><br><p style=";text-align:right;direction:rtl"> <strong><em> </em></strong> . ,    <a href="https://developer.apple.com/documentation/uikit/uiblureffect"><code>UIBlurEffect</code></a> , <a href="https://developer.apple.com/documentation/uikit/uivibrancyeffect"><code>UIVibrancyEffect</code></a>    ,  ,    (Render Pass).      ,       ,    . </p><br><p style=";text-align:right;direction:rtl"> <strong>Offscreen rendering (Render Server)</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zm/ru/b4/zmrub4eko8bdeelh2lbivcem8bi.png"></p><br><p style=";text-align:right;direction:rtl"> Render Server        .        , ,     : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410818-cornerradius"><code>cornerRadius</code></a> โ  Render Server      ,         ; </li><li style=";text-align:right;direction:rtl"> <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410819-shadowradius"><code>shadowRadius</code></a> โ   Render Server    ,   ; </li><li style=";text-align:right;direction:rtl"> <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410861-mask"><code>mask</code></a> โ        . </li></ul><br><p style=";text-align:right;direction:rtl">    <code>CALayer</code> ,       ,    Offscreen rendering.    ,     <a href="https://developer.apple.com/documentation/uikit/uivisualeffect"><code>UIVisualEffect</code></a> (   ,     Render Server  CPU,   GPU). </p><br><p style=";text-align:right;direction:rtl">  ,       . </p><br><hr><br><h1 id="5-instrumenty-izmereniy" style=";text-align:right;direction:rtl"> <strong>5.  </strong> </h1><br><p style=";text-align:right;direction:rtl">    ,    ,    Time Profiler.   <a href="https://developer.apple.com/documentation/metal/using_metal_system_trace_in_instruments_to_profile_your_app">Metal System Trace</a> โ         Time Profiler    . </p><br><h2 id="51-metal-system-trace" style=";text-align:right;direction:rtl"> <strong>5.1. Metal System Trace</strong> </h2><br><p style=";text-align:right;direction:rtl">  ,          ( ).   ,    : ,    . </p><br><p style=";text-align:right;direction:rtl">  ,   Metal System Trace  ,           .     ,       Render Server.       ,      Main-,   โ ,     . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gy/pv/ay/gypvay-wwr1f0ldbjazina-ewtg.png"></p><br><p style=";text-align:right;direction:rtl">      - ,   : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/0r/af/6e/0raf6e-cvoukj_6jzt1o6frzjom.png"></p><br><p style=";text-align:right;direction:rtl">  Metal System Trace   .     64- ,     iPhone 5s.  ,    <em></em>    .   , -   ,  ,          UI. </p><br><h2 id="52-fiksiruem-prosadki-proizvoditelnosti-v-kode-vo-vremya-raboty-prilozheniya" style=";text-align:right;direction:rtl"> <strong>5.2.         </strong> </h2><br><p style=";text-align:right;direction:rtl">         . ,   - -  .         ,    <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> . </p><br><p style=";text-align:right;direction:rtl">   <code>CADisplayLink</code>   <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink/1621257-timestamp"><code>timestamp</code></a> โ     (    Render Server).         <code>CADisplayLink.timestamp</code>     <code>timestamp</code> .   ,          (, 1/60 )  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> //  CADisplayLink. link = [CADisplayLink displayLinkWithTarget:target selector:selector] [link addToRunLoop:[NSRunLoop mainRunLoop] forMode:UITrackingRunLoopMode] //    CADisplayLink : diff = prevTimestamp - link.timestamp if (diff &gt; 1/fps) { //  freeze } prevTimestamp = link.timestamp</code> </pre> <br><p style=";text-align:right;direction:rtl"> <code>CADisplayLink</code>   <a href="https://developer.apple.com/documentation/uikit/uitrackingrunloopmode%3Flanguage%3Dobjc"><code>UITrackingRunLoopMode</code></a> ,       . </p><br><p style=";text-align:right;direction:rtl">     Rendering Pipeline: <br><img src="https://habrastorage.org/webt/yv/ca/t3/yvcat3yxparod3whs19qzwwjzhw.png"></p><br><p style=";text-align:right;direction:rtl">      UI-,         .    ยซยป     <code>freezeFrameTimeRate</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">scrollTime //    Scroll freezeFrameTime //    ,  "",       freezeFrameTimeRate = freezeFrameTime / scrollTime</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,            -    <code>UIView</code> .   ,      ยซยป: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ws/l7/tr/wsl7trcro6gr-t7ax-paqn_rxls.png"></p><br><p style=";text-align:right;direction:rtl">  ,          ,    ยซ <code>UIView</code> ยป         .  ููุงุฐุงุ   ,   . , ,      ,     : <code>CADisplayLink</code> ,       Render Server    <code>link.timetamp</code> ,    Render Server     ,      .   60     UI-,         Render Server.   Render Server      ,     . </p><br><p style=";text-align:right;direction:rtl">  ,     ,   ,  Render Server    .    <a href="https://developer.apple.com/documentation/metal/mtlcommandbuffer/1442997-addcompletedhandler%3Flanguage%3Dobjc">Metal</a> ,        Render Server. ,  ,       iOS,   Render Server            . </p><br><h2 id="kak-issledovat-problemy-rekomendacii" style=";text-align:right;direction:rtl"> <strong>  . </strong> </h2><br><p style=";text-align:right;direction:rtl">   ,   ,      .             ,        . </p><br><p style=";text-align:right;direction:rtl"> :   โ   !          โ        . </p><br><hr><br><h1 id="zaklyuchenie" style=";text-align:right;direction:rtl">  <strong>ุงุณุชูุชุงุฌ</strong> </h1><br><p style=";text-align:right;direction:rtl">   โ               .    ,     ,      . </p><br><hr><br><h1 id="istochniki-informacii" style=";text-align:right;direction:rtl"> <strong> </strong> </h1><br><p style=";text-align:right;direction:rtl">  ,        โ        .        ,   . </p><br><p style=";text-align:right;direction:rtl">  ,        : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://developer.apple.com/documentation"> Apple</a> . </li><li style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/company/oleg-bunin/blog/437584/">    Auto Layout</a> . </li><li style=";text-align:right;direction:rtl"> <a href="https://constraints.cs.washington.edu/solvers/cassowary-tochi.pdf">The Cassowary Linear Arithmetic Constraint Solving Algorithm</a> . </li><li style=";text-align:right;direction:rtl"> iOS Core Animation: Advanced Techniques. Nick Lockwood. </li><li style=";text-align:right;direction:rtl"> WWDC 2014 Session 419. Advanced Graphics and Animations for iOS Apps. </li></ol><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ij/vj/ex/ijvjexv2ppdy6bdkepcwbqk7wy8.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar481626/">https://habr.com/ru/post/ar481626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar481612/index.html">ูุณุงููุชูุง ุงูุตุบูุฑุฉ ูู ูุถุงู ุฃูุงููููุง ูุงุฌูุฉ ุงููุณุชุฎุฏู ูู ุฃุฌู ููุตุงุช ุฃูู</a></li>
<li><a href="../ar481616/index.html">ุงููุจุฉ ุงูุฌููุฏูุณูุฉ. ุญูู ุงูุฌูุงุฒ ูุชุฌุฑุจุชู ูู ุงูุนูููุงุช ุงูุญุณุงุจูุฉ</a></li>
<li><a href="../ar481618/index.html">MVP ูู ุงููุญุฏุฉ ุฃู ููููุฉ ุชุจุณูุท ุงูุญูุงุฉ</a></li>
<li><a href="../ar481620/index.html">Juniper SRX ู Cisco ASA: ุงูุณูุณูุฉ ุงูุชุงููุฉ</a></li>
<li><a href="../ar481624/index.html">ูุชุงุจุฉ ุทูุจ ุนูู ุงูุฑูุฑูุฉ ุจุงูุงุดุชุฑุงู ูุน Redux</a></li>
<li><a href="../ar481628/index.html">ููุงุนุฏ ููุชุงุจุฉ ุงูุฎุทูุงุช ุงูุฃูููุฉ ูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ</a></li>
<li><a href="../ar481630/index.html">ุฃูุถู ุงูุฃุฏูุงุช ูุงูููุงุฑุฏ ุงููููุฏุฉ ูุฌุนู ุงูุดุฑูุงุช ุงููุงุดุฆุฉ ุฃูุซุฑ ุฐูุงุกู ูู ุนุงู 2019</a></li>
<li><a href="../ar481632/index.html">ุณุญุงุจุฉ ููุฏูู ุงูุฎุฏูุงุช: ูู ูู ุฃุฌูู ูู ุงูุณููุ</a></li>
<li><a href="../ar481634/index.html">ููุฎุต ุชุตููู ุงูุทุนุงู ุ ููููุจุฑ 2019</a></li>
<li><a href="../ar481638/index.html">ููุงุฐุง ุงูููุงุฐุฌ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ููุฅูุชุงุฌ ุงููุนูุฏ ูููุฏุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>