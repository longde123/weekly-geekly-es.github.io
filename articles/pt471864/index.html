<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÅ üìø üë©üèΩ‚Äçüî¨ Gera√ß√£o de analisador PEG üìñ ü§¥üèª üë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Agora que esbocei o b√°sico de um analisador propriet√°rio, passemos a gerar seus m√©todos a partir da gram√°tica, como prometi. Tamb√©m mostrarei como imp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gera√ß√£o de analisador PEG</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471864/"><p> Agora que esbocei o b√°sico de um analisador propriet√°rio, passemos a gerar seus m√©todos a partir da gram√°tica, como prometi.  Tamb√©m mostrarei como implementar um analisador de <code>@memoize</code> usando o decorador <code>@memoize</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Conte√∫do da s√©rie Ps Parser Python</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Analisadores de Peg</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Implementa√ß√£o do Analisador PEG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gera√ß√£o de analisador PEG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Visualiza√ß√£o do analisador PEG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gram√°tica PEG recursiva esquerda</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Adicionando a√ß√µes √† gram√°tica PEG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Meta gram√°tica para analisador PEG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Implementando os recursos restantes do PEG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PEG no Core Developer Sprint</a> </li></ul></div></div><br><p>  Na √∫ltima vez, vimos alguns m√©todos de an√°lise.  Com algumas restri√ß√µes que removeremos um pouco mais tarde, elas s√£o f√°ceis de gerar automaticamente a partir da gram√°tica. </p><a name="habracut"></a><br><p>  Precisamos de duas coisas: algo que leia a gram√°tica e construa uma estrutura de dados apropriada;  e algo que pega essa estrutura de dados e gera um analisador.  Tamb√©m precisamos de outros m√©todos auxiliares, mas eles n√£o s√£o interessantes, ent√£o eu os omitirei. </p><br><p>  Ent√£o, estamos criando um compilador simples.  Vou simplificar um pouco a nota√ß√£o gramatical na medida em que s√≥ temos regras e alternativas;  isso √© suficiente para a gram√°tica de brinquedos que usei nas partes anteriores: </p><br><pre> <code class="plaintext hljs">statement: assignment | expr | if_statement expr: expr '+' term | expr '-' term | term term: term '*' atom | term '/' atom | atom atom: NAME | NUMBER | '(' expr ')' assignment: target '=' expr target: NAME if_statement: 'if' expr ':' statement</code> </pre> <br><p>  Usando a nota√ß√£o completa, podemos descrever a gram√°tica como: </p><br><pre> <code class="plaintext hljs">grammar: rule+ ENDMARKER rule: NAME ':' alternative ('|' alternative)* NEWLINE alternative: item+ item: NAME | STRING</code> </pre> <br><p>  Esta √© a nossa primeira meta-gram√°tica (gram√°tica para gram√°ticas) e nosso gerador de analisador ser√° um meta-compilador (um compilador √© um programa que traduz programas de um idioma para outro; um meta-compilador √© um compilador em que a entrada √© uma gram√°tica e a sa√≠da √© um analisador) </p><br><p>  Uma maneira f√°cil de descrever uma meta-gram√°tica √© usar apenas os tipos de dados internos: a parte certa da regra √© uma lista de listas de elementos, cada um dos quais pode ser apenas uma sequ√™ncia.  A prop√≥sito, podemos separar <code>NAME</code> e <code>STRING</code> verificando se o primeiro caractere √© entre aspas. </p><br><p>  Para regras, eu uso a classe <code>Rule</code> simples, e a gram√°tica inteira √© uma lista desses objetos.  Aqui est√° a classe <code>Rule</code> , excluindo <code>__repr__</code> e <code>__eq__</code> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rule</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, alts)</span></span></span><span class="hljs-function">:</span></span> self.name = name self.alts = alts</code> </pre> <br><p>  E aqui est√° a classe <code>GrammarParser</code> que a usa: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GrammarParser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Parser)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grammar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> pos = self.mark() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rule := self.rule(): rules = [rule] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> rule := self.rule(): rules.append(rule) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.expect(ENDMARKER): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rules <span class="hljs-comment"><span class="hljs-comment"># &lt;------------- final result self.reset(pos) return None def rule(self): pos = self.mark() if name := self.expect(NAME): if self.expect(":"): if alt := self.alternative(): alts = [alt] apos = self.mark() while (self.expect("|") and (alt := self.alternative())): alts.append(alt) apos = self.mark() self.reset(apos) if self.expect(NEWLINE): return Rule(name.string, alts) self.reset(pos) return None def alternative(self): items = [] while item := self.item(): items.append(item) return items def item(self): if name := self.expect(NAME): return name.string if string := self.expect(STRING): return string.string return None</span></span></code> </pre> <br><p>  Preste aten√ß√£o ao uso do <code>ENDMARKER</code> .  L√°, garanto que nada resta ap√≥s a √∫ltima regra (e isso pode acontecer se houver um erro de digita√ß√£o na gram√°tica).  Tamb√©m apontei para o local em que o m√©todo <code>grammar()</code> retorna uma lista de regras.  Todo o resto √© muito parecido com a classe <code>ToyParser</code> do √∫ltimo artigo, por isso n√£o vou insistir nisso.  Observe que <code>item()</code> retorna uma string, <code>alternative()</code> retorna uma lista de strings e a vari√°vel √© <code>alts</code> dentro de <code>rule()</code> coleta uma lista de strings.  Em seguida, o m√©todo <code>rule()</code> combina o nome da regra (string) e o converte em um objeto <code>Rule</code> . </p><br><p>  Se aplicarmos esse algoritmo √† nossa gram√°tica de brinquedos, o m√©todo <code>grammar()</code> retornar√° a seguinte lista de regras: </p><br><pre> <code class="plaintext hljs">[ Rule('statement', [['assignment'], ['expr'], ['if_statement']]), Rule('expr', [['term', "'+'", 'expr'], ['term', "'-'", 'term'], ['term']]), Rule('term', [['atom', "'*'", 'term'], ['atom', "'/'", 'atom'], ['atom']]), Rule('atom', [['NAME'], ['NUMBER'], ["'('", 'expr', "')'"]]), Rule('assignment', [['target', "'='", 'expr']]), Rule('target', [['NAME']]), Rule('if_statement', [["'if'", 'expr', "':'", 'statement']]), ]</code> </pre> <br><p>  Agora que temos a parte de an√°lise do nosso meta compilador, vamos criar um gerador de c√≥digo.  Juntos, eles formam um meta compilador elementar: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_parser_class</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rules)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">f"class ToyParser(Parser):"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rule <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rules: print() print(<span class="hljs-string"><span class="hljs-string">f" @memoize"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" def </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rule.name}</span></span></span><span class="hljs-string">(self):"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" pos = self.mark()"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> alt <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rule.alts: items = [] print(<span class="hljs-string"><span class="hljs-string">f" if (True"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> alt: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'"'</span></span>, <span class="hljs-string"><span class="hljs-string">"'"</span></span>): print(<span class="hljs-string"><span class="hljs-string">f" and self.expect(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item}</span></span></span><span class="hljs-string">)"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: var = item.lower() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items: var += str(len(items)) items.append(var) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item.isupper(): print(<span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-string"><span class="hljs-string">f"and (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{var}</span></span></span><span class="hljs-string"> := self.expect(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item}</span></span></span><span class="hljs-string">))"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">f" "</span></span> + <span class="hljs-string"><span class="hljs-string">f"and (</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{var}</span></span></span><span class="hljs-string"> := self.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item}</span></span></span><span class="hljs-string">())"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" ):"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" "</span></span> + <span class="hljs-string"><span class="hljs-string">f"return Node(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rule.name!r}</span></span></span><span class="hljs-string">, [</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">', '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.join(items)}</span></span></span><span class="hljs-string">])"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" self.reset(pos)"</span></span>) print(<span class="hljs-string"><span class="hljs-string">f" return None"</span></span>)</code> </pre> <br><p>  Esse c√≥digo √© muito feio, mas funciona (mais ou menos), e no futuro eu o reescreverei de qualquer maneira. </p><br><p>  Algumas linhas dentro do <code>for alt in rule.alts</code> podem exigir explica√ß√£o: para cada elemento na alternativa, escolhemos uma das 3 op√ß√µes: </p><br><ul><li>  se o elemento for uma string literal, por exemplo <code>'+'</code> , geramos <code>self.expect('+')</code> </li><li>  se o elemento estiver totalmente em mai√∫sculas, por exemplo, <code>NAME</code> , geraremos <code>(name := self.expect(NAME))</code> </li><li>  caso contr√°rio, por exemplo, se for <code>expr</code> , geramos <code>(expr := self.expr())</code> </li></ul><br><p>  Se houver v√°rios elementos com o mesmo nome em uma variante (por exemplo, <code>term '-' term</code> ), adicionamos um d√≠gito ao segundo.  H√° tamb√©m um pequeno erro aqui que eu corrigirei no pr√≥ximo epis√≥dio. </p><br><p>  Aqui est√° um pequeno resultado de seu trabalho (toda a classe seria muito chata).  N√£o se preocupe com o c√≥digo redundante <code>if (True and</code> ... <code>)</code> necess√°rio para que cada condi√ß√£o gerada possa come√ßar com <code>and</code> .  O compilador de bytes Python otimiza isso. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToyParser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Parser)</span></span></span><span class="hljs-class">:</span></span> @memoize <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">statement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> pos = self.mark() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (assignment := self.assignment()) ): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Node(<span class="hljs-string"><span class="hljs-string">'statement'</span></span>, [assignment]) self.reset(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (expr := self.expr()) ): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Node(<span class="hljs-string"><span class="hljs-string">'statement'</span></span>, [expr]) self.reset(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (if_statement := self.if_statement()) ): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Node(<span class="hljs-string"><span class="hljs-string">'statement'</span></span>, [if_statement]) self.reset(pos) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> ...</code> </pre> <br><p>  Preste aten√ß√£o ao decorador <code>@memoize</code> : eu a apresentei para passar para outro t√≥pico: usando a memoriza√ß√£o para tornar o analisador gerado r√°pido o suficiente. </p><br><p>  Aqui est√° a fun√ß√£o <code>memoize()</code> que implementa este decorador: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">memoize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">memoize_wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> pos = self.mark() memo = self.memos.get(pos) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> memo <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: memo = self.memos[pos] = {} key = (func, args) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> memo: res, endpos = memo[key] self.reset(endpos) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: res = func(self, *args) endpos = self.mark() memo[key] = res, endpos <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memoize_wrapper</code> </pre> <br><p>  Como em outros decoradores, ele cont√©m uma fun√ß√£o aninhada que substitui (ou envolve) uma fun√ß√£o decorada, por exemplo, o m√©todo <code>statement()</code> da classe <code>ToyParser</code> .  Como a fun√ß√£o que est√° sendo quebrada √© um m√©todo, o wrapper tamb√©m √© realmente um m√©todo: seu primeiro argumento √© chamado de <code>self</code> e refere-se √† inst√¢ncia <code>ToyParser</code> para a qual o m√©todo decorado √© chamado. </p><br><p>  O wrapper armazena em cache o resultado da chamada do m√©todo para cada posi√ß√£o de entrada - √© por isso que √© chamado de analisador de pacotes!  [aprox.  trans.  packrat √© um "ladr√£o", mas esse termo n√£o √© traduzido em fontes no idioma russo.] Cache √© um dicion√°rio de dicion√°rios, armazenado em uma inst√¢ncia do <code>Parser</code> .  A chave do dicion√°rio externo √© a posi√ß√£o no fluxo de dados de entrada;  Tamb√©m adicionei <code>self.memos = {}</code> ao <code>Parser .__ init__()</code> para inicializ√°-lo.  Dicion√°rios internos s√£o adicionados conforme necess√°rio;  suas chaves consistem em um m√©todo e seus argumentos.  (N√£o h√° argumentos no design atual, mas podemos memorizar a fun√ß√£o <code>expect()</code> que possui uma, o que √© bastante trivial) </p><br><p>  O resultado do m√©todo do analisador √© apresentado na forma de uma tupla, porque existem realmente dois valores: o resultado em si (para nossos m√©todos gerados, este √© o <code>Node</code> para a regra de correspond√™ncia) e um ponteiro para a posi√ß√£o atual no fluxo de entrada, que obtemos de <code>self.mark()</code> .  Assim, armazenamos em cache o valor de retorno ( <code>res</code> ) e a nova posi√ß√£o ( <code>endpos</code> ) no dicion√°rio interno com valores memorizados.  Nas chamadas subseq√ºentes ao mesmo m√©todo de an√°lise com os mesmos argumentos na mesma posi√ß√£o de entrada, n√≥s as retiraremos do cache.  Para fazer isso, basta mover o ponteiro para a posi√ß√£o de entrada usando <code>self.reset()</code> e procure no cache. </p><br><p>  Tamb√©m √© importante armazenar em cache resultados negativos - na verdade, a maioria das chamadas ser√° negativa.  Nesse caso, o valor de retorno √© <code>None</code> e a posi√ß√£o de entrada n√£o muda.  Voc√™ pode adicionar <code>assert</code> para verificar isso. </p><br><p>  Nota  No Python, √© habitual implementar um cache em uma vari√°vel local na fun√ß√£o <code>memoize()</code> .  No nosso caso, isso n√£o funcionar√°: como descobri no final da depura√ß√£o, cada inst√¢ncia do <code>Parser</code> deve ter seu pr√≥prio cache.  No entanto, voc√™ pode se livrar de dicion√°rios aninhados usando ( <code>pos</code> , <code>func</code> , <code>args</code> ) como chave. </p><br><p>  Na pr√≥xima semana, prepararei c√≥digo e rastreios para mostrar como tudo isso √© realmente montado e executado ao analisar um programa de exemplo.  Ainda estou em busca de uma maneira melhor de visualizar a colabora√ß√£o do buffer de tokeniza√ß√£o, analisador e cache.  Talvez eu consiga criar um gif animado em ASCII em vez de apenas exibir as listagens de rastreamento como texto. </p><br><p>  Licen√ßa para este artigo e c√≥digo citado: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CC BY-NC-SA 4.0</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471864/">https://habr.com/ru/post/pt471864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471854/index.html">Calor Morte 5G</a></li>
<li><a href="../pt471856/index.html">Resolvemos todas as 42 vers√µes do quebra-cabe√ßa de po√ß√µes de Harry Potter</a></li>
<li><a href="../pt471858/index.html">RabbitMQ vs. Kafka: Failover e alta disponibilidade em clusters</a></li>
<li><a href="../pt471860/index.html">Analisadores de Peg</a></li>
<li><a href="../pt471862/index.html">Implementa√ß√£o do Analisador PEG</a></li>
<li><a href="../pt471870/index.html">Uso efetivo do libdispatch</a></li>
<li><a href="../pt471872/index.html">Interfaces no C # 8: suposi√ß√µes perigosas na implementa√ß√£o padr√£o</a></li>
<li><a href="../pt471876/index.html">PDU e Tudo-Tudo-Tudo: Distribui√ß√£o de Energia em Rack</a></li>
<li><a href="../pt471878/index.html">Como escrever um contrato inteligente para o WebAssembly em uma rede Ontology? Parte 1: Ferrugem</a></li>
<li><a href="../pt471884/index.html">10 utilit√°rios ApexSQL gratuitos para gerenciar bancos de dados do Microsoft SQL Server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>