<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÑ üèÄ üîå Dron aut√≥nomo de bricolaje con control sobre Internet. Parte 2 sobre software üë®üèª‚Äçüéì üë®üèº‚Äçüî¨ ‚óªÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta es una continuaci√≥n de la historia de un dron aut√≥nomo. La primera parte habl√≥ sobre hardware, esta hablar√° sobre software. Para empezar, un pequ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dron aut√≥nomo de bricolaje con control sobre Internet. Parte 2 sobre software</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414587/">  Esta es una continuaci√≥n de la historia de un dron aut√≥nomo.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera parte</a> habl√≥ sobre hardware, esta hablar√° sobre software.  Para empezar, un peque√±o programa educativo sobre la interacci√≥n del operador con el helic√≥ptero.  Aqu√≠ hay un dise√±o t√≠pico para la mayor√≠a de los drones autoensamblados: <br><br><img src="https://habrastorage.org/webt/f6/jn/na/f6jnnadl96jkvjtcngwxhxogkcu.png" alt="imagen"><br><br>  Y aqu√≠ est√° el esquema para los drones avanzados: <br><br><img src="https://habrastorage.org/webt/gz/5t/bg/gz5tbg7qqv82_5t86usnrsyhgsg.png" alt="imagen"><br><a name="habracut"></a><br>  As√≠ es como funcionan los drones de juguete, que se controlan desde un tel√©fono inteligente: <br><br><img src="https://habrastorage.org/webt/zr/tu/7r/zrtu7r2febul6zxzy2uzrkpf8rq.png" alt="imagen"><br><br>  Puede controlar el dron a trav√©s de Internet (si tiene una tarjeta SIM con una direcci√≥n IP est√°tica): <br><br><img src="https://habrastorage.org/webt/ae/d1/yk/aed1yk46dzosxybjpglxk6bwu5i.png" alt="imagen"><br><br>  O as√≠, si la direcci√≥n IP es din√°mica: <br><br><img src="https://habrastorage.org/webt/v2/x_/jo/v2x_jo1dtumefo_wekedrufda0o.png" alt="imagen"><br><br>  Para la confiabilidad y la redundancia de los canales de comunicaci√≥n, la √∫ltima opci√≥n se puede desarrollar a tal estado: <br><br><img src="https://habrastorage.org/webt/x6/yz/ho/x6yzhoievpeggh8ya7jo8cmxvo4.png" alt="imagen"><br><br>  A continuaci√≥n, describir√© el proceso de configuraci√≥n del controlador de vuelo Emlid Navio 2 y el microordenador Raspberry Pi 3. <br><br><img src="https://habrastorage.org/webt/7g/lr/cv/7glrcvssoyxvii2swoekbsrkuf8.jpeg" alt="imagen"><br>  Pero, con modificaciones menores, esta configuraci√≥n es adecuada para cualquier controlador de vuelo, con el que puede comunicarse a trav√©s del protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAVLink</a> junto con cualquier computadora en una familia de sistemas operativos Linux. <br><br><img src="https://habrastorage.org/webt/bq/6c/my/bq6cmyprlzet6b8w4kemu_nn_ao.png" alt="imagen"><br><br>  <b><u>Importante!</u></b>  <b><u>El ajuste debe realizarse con la alimentaci√≥n apagada en los controladores de velocidad para que los motores no arranquen accidentalmente.</u></b> <br><br><h3>  Software de control de drones para PC y tabletas </h3><br>  Para controlar el UAV, se utilizan programas especiales GCS (estaci√≥n de control de tierra).  M√°s adelante en el texto usar√© esta abreviatura.  Me gust√≥ el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">QGroundControl</a> , un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GCS</a> multiplataforma de c√≥digo abierto (Windows, Linux, MacOS, iOS, Android) que se convirti√≥ en parte del proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DroneCode</a> .  Pero hay alternativas, gratuitas y comerciales: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">APM Planner</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MissionPlanner</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UgCS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LibrePilot</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenPilot</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tower</a> (DroidPlanner) para Android, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAVPilot</a> (iOS), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SidePilot</a> (iOS).  As√≠ como la consola <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAVProxy</a> . <br><br><h3>  Instalar una imagen del sistema operativo en una tarjeta SD </h3><br>  Para el funcionamiento normal del piloto autom√°tico, se recomienda utilizar tarjetas SD "r√°pidas" (clase 10).  Las tarjetas de memoria lentas no tienen tiempo para guardar los registros del piloto autom√°tico, incluso a baja frecuencia, como resultado de lo cual resultan torcidos o no est√°n escritos en absoluto.  La evidencia de esto puede ser un error de " <i>No latido IO</i> ", que se puede observar en la consola MAVLink (a continuaci√≥n se describe c√≥mo ver la consola MAVLink).  Al comprar, observe la capacidad de escribir video 4K: lo m√°s probable es que sea una SD r√°pida.  Desafortunadamente, me enter√© de esto despu√©s de la ca√≠da del avi√≥n no tripulado, cuando fue necesario analizar los registros y descubrir la raz√≥n.  Los registros eran ilegibles para varios GCS.  La raz√≥n para apagar los motores durante el vuelo result√≥ ser banal: olvid√© ajustar el voltaje m√≠nimo de la bater√≠a en la configuraci√≥n para una operaci√≥n a prueba de fallas. <br><br>  Entonces, descargue la imagen de Raspbian Stretch terminada con Ardupilot y ROS preinstalados de Emlid desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina de instrucciones original</a> .  Y lo escribimos en una tarjeta de memoria usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Etcher</a> o cualquier programa similar. <br><br>  Para conectar Raspberry a su red WiFi inmediatamente despu√©s de encenderlo, debe editar el archivo <i>wpa_supplicant.conf</i> en la ra√≠z de la tarjeta SD.  Debe contener las siguientes l√≠neas: <br><br><pre><code class="bash hljs">network={ ssid=<span class="hljs-string"><span class="hljs-string">"_wifi_"</span></span> psk=<span class="hljs-string"><span class="hljs-string">"_wifi_"</span></span> }</code> </pre> <br>  Tambi√©n puede configurarlo sin WiFi conectando una computadora de placa √∫nica al enrutador con un cable Ethernet.  Ahora retire la tarjeta SD de la PC, ins√©rtela en la Raspberry y encienda la alimentaci√≥n.  Despu√©s de medio minuto, deber√≠a aparecer en el panel de administraci√≥n del enrutador en la p√°gina de dispositivos conectados (nombre de <i>host de</i> navio). <br><br><h3>  Actualizaci√≥n del kit de distribuci√≥n e instalaci√≥n de los paquetes necesarios. </h3><br>  Abra el cliente SSH y con√©ctese a Raspberry (direcci√≥n IP de navegaci√≥n local en lugar de <i>RASPBERRY_IP_ADDRESS</i> ): <br><br><pre> <code class="bash hljs">ssh pi@RASPBERRY_IP_ADDRESS</code> </pre> <br>  Contrase√±a est√°ndar: <i>frambuesa</i> .  En primer lugar, es necesario expandir el sistema de archivos del sistema operativo a todo el volumen de la tarjeta SD: <br><br><pre> <code class="bash hljs">sudo raspi-config --expand-rootfs</code> </pre> <br>  y reiniciar: <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre> <br>  Despu√©s de reiniciar, con√©ctese nuevamente y actualice la distribuci√≥n: <br><br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade -y</code> </pre> <br>  Instalar paquetes adicionales: <br><br><pre> <code class="bash hljs">sudo apt-get install autoconf automake libtool pkg-config libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libraspberrypi-dev gstreamer1.0-tools gstreamer1.0-plugins-good gstreamer1.0-plugins-bad</code> </pre> <br>  y compile el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">contenedor gst-rpicamsrc</a> para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gstreamer</a> y la c√°mara nativa Raspicam: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/thaytan/gst-rpicamsrc.git rpicamsrc <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> rpicamsrc chmod +x autogen.sh ./autogen.sh --prefix=/usr --libdir=/usr/lib/arm-linux-gnueabihf/ make sudo make install</code> </pre> <br>  Compruebe si la c√°mara funciona (se crea el archivo de video test.h264): <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc bitrate=1000000 ! filesink location=test.h264</code> </pre> <br>  Si se inicia gstreamer, espere un par de segundos para que se grabe el video.  Puede interrumpir el proceso presionando <i>Ctrl + C.</i>  Si hay video, entonces la c√°mara est√° funcionando. <br><br><h3>  Configurar y ejecutar Ardupilot </h3><br>  Los lanzamientos de nuevas versiones de Ardupilot est√°n un poco retrasados ‚Äã‚Äãen el montaje de Emlid.  Si la funcionalidad necesaria est√° disponible en la √∫ltima versi√≥n, puede instalarla desde la fuente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utilizando estas instrucciones</a> . <br><br>  Los desarrolladores de Navio agregaron una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta de herramienta Emlid</a> simple y conveniente a sus sensores para verificar los sensores y configurar Ardupilot.  Primero, verifique si Raspberry ve el controlador Navio: <br><br><pre> <code class="bash hljs">emlidtool info</code> </pre> <br>  Si en respuesta a este comando produce algo como: <br><br><pre> <code class="bash hljs">Vendor: Emlid Limited Product: Navio 2 Issue: Emlid 2018-06-05 831f3b08594f2da17dccae980a2e3659115ef71f Kernel: 4.14.34-emlid-v7+ RCIO firmware: 0xcaec2284</code> </pre> <br>  significa que √©l ve.  Verifique el estado de los sensores (muestre la lista y el estado): <br><br><pre> <code class="bash hljs">emlidtool <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br>  y controladores de controlador PWM en el kernel de Linux: <br><br><pre> <code class="bash hljs">cat /sys/kernel/rcio/status/alive</code> </pre> <br>  0 = no funciona, 1 = funciona. <br><br>  El firmware del controlador PWM se actualiza de la siguiente manera: <br><br><pre> <code class="bash hljs">sudo emlidtool rcio update</code> </pre> <br>  Ahora configure Ardupilot: <br><br><pre> <code class="bash hljs">sudo emlidtool ardupilot</code> </pre> <br>  Se abrir√° una GUI de texto con men√∫s paso a paso en el terminal.  Seleccionamos el helic√≥ptero de la √∫ltima versi√≥n, <i>escribimos arducopter</i> , inicio autom√°tico al inicio (al <i>iniciar: habilitar</i> ), <i>iniciamos</i> despu√©s de la configuraci√≥n ( <i>Ardupilot: inicio</i> ). <br><br><img src="https://habrastorage.org/webt/w8/p7/yn/w8p7ynlxvrqybsaqrdkqxbk68yy.png" alt="imagen"><br><br>  Salimos a trav√©s del elemento de men√∫ <i>Salir</i> . <br><br>  Comprueba si Ardupilot ha comenzado: <br><br><pre> <code class="bash hljs">sudo systemctl status arducopter</code> </pre> <br>  Tenga en cuenta que el archivo de inicio en systemd se llama <u>arducopter</u> , ya que se configur√≥ la opci√≥n de <i>helic√≥ptero</i> . <br><br>  Ahora necesitamos configurar el Ardupilot para que nos env√≠e telemetr√≠a.  Para hacer esto, edite el archivo de configuraci√≥n: <br><br><pre> <code class="bash hljs">sudo nano /etc/default/arducopter</code> </pre> <br>  Debe contener las siguientes l√≠neas: <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-A udp:127.0.0.1:14550"</span></span> ARDUPILOT_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TELEM1</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Guarde el archivo ( <i>Ctrl + X</i> , luego <i>Y</i> ) y reinicie Ardupilot: <br><br><pre> <code class="bash hljs">sudo systemctl daemon-reload sudo systemctl restart arducopter</code> </pre> <br>  Puede verificar el estado del proceso Ardupilot con el siguiente comando: <br><br><pre> <code class="bash hljs">sudo systemctl status arducopter</code> </pre> <br>  Con esta configuraci√≥n, Ardupilot transmitir√° telemetr√≠a (paquetes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAVLink</a> ) al puerto UDP local 14550. Luego, el script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MAVProxy</a> (descripci√≥n a continuaci√≥n) tomar√° telemetr√≠a desde all√≠ y lo enviar√° a GCS o al script, as√≠ como tambi√©n enviar√° paquetes con comandos en la direcci√≥n opuesta. <br><br>  En lugar de la direcci√≥n local y el puerto, puede grabar la direcci√≥n IP de una PC o tableta en la red local y los paquetes se transmitir√°n inmediatamente all√≠. <br><br><img src="https://habrastorage.org/webt/8p/no/vv/8pnovvpynimp8tvucgtqnbvqhls.png" alt="imagen"><br><br>  Sin embargo, este enfoque se justifica si los datos de telemetr√≠a no se utilizan en ning√∫n otro lugar y el dispositivo con GCS tiene una direcci√≥n IP est√°tica.  De lo contrario, cada vez que tenga que registrar un nuevo Ardupilot en la configuraci√≥n.  Para comunicarse con el piloto autom√°tico a trav√©s de TCP, varios GCS con direcciones din√°micas y algunos otros scripts en la computadora de a bordo podr√≠an simult√°neamente, es m√°s conveniente usar MAVProxy. <br><br><img src="https://habrastorage.org/webt/lt/gu/o6/ltguo6ghxcrnv8syshno6arbwi8.png" alt="imagen"><br><br>  Este script (escrito en Python) puede recibir paquetes MAVLink a una direcci√≥n UDP local y retransmitirlos a varias direcciones IP locales o remotas, tanto a trav√©s de UDP como de TCP.  Los paquetes se env√≠an en ambas direcciones al Ardupilot ‚áî GCS.  Adem√°s, MAVProxy es un GCS completo, pero con una interfaz de texto. <br><br><h3>  MAVProxy </h3><br>  MAVProxy ya est√° instalado en la imagen de Navio.  Tambi√©n se puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instalar</a> en una PC (Windows, Linux, MacOS) para una mayor comunicaci√≥n con el piloto autom√°tico en modo consola. <br><br>  Despu√©s de asegurarse de que Ardupilot est√° funcionando, ejecute el script MAVProxy en Raspberry con este comando: <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550</code> </pre> <br>  El <i>par√°metro --master = udp: 127.0.0.1: 14550</i> establece la fuente de datos para el script.  Este es el puerto UDP local que se registr√≥ en el archivo de configuraci√≥n de Ardupilot.  Despu√©s de ejecutar el comando, MAVProxy se conectar√° a este puerto y mostrar√° mensajes de piloto autom√°tico, similar al m√≠o: <br><br><pre> <code class="bash hljs">pi@navio:~ $ mavproxy.py --master=udp:127.0.0.1:14550 Connect udp:127.0.0.1:14550 source_system=255 Failed to load module: No module named adsb. Use <span class="hljs-string"><span class="hljs-string">'set moddebug 3'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the MAVProxy console to <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> traceback Log Directory: Telemetry <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>: mav.tlog Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> heartbeat from 127.0.0.1:14550 MAV&gt; online system 1 STABILIZE&gt; Mode STABILIZE fence breach GPS lock at 0 meters APM: APM:Copter V3.5.5 (88a1ecdd) APM: Frame: UNKNOWN APM: PreArm: RC Roll not configured APM: PreArm: Compass not calibrated APM: PreArm: 3D Accel calibration needed APM: PreArm: check firmware or FRAME_CLASS APM: PreArm: Throttle below Failsafe</code> </pre> <br>  Dado que el piloto autom√°tico a√∫n no se ha calibrado y no est√° totalmente sintonizado, los mensajes tambi√©n hablan elocuentemente de esto.  En este modo, puede comunicarse con el piloto autom√°tico a trav√©s de comandos.  Si el dron estaba completamente sintonizado, tal secuencia de dos comandos conducir√≠a al arranque de los motores y al dron para despegar a una altura de 20 m: <br><br><pre> <code class="bash hljs">arm throttle takeoff 20</code> </pre> <br>  Un piloto autom√°tico no calibrado no volar√°, pero mostrar√° mensajes con los motivos por los que no puede hacerlo. <br><br><h3>  Establecer comunicaci√≥n con el dron en la red local. </h3><br>  Detenga el script ( <i>Ctrl + C</i> ) y ejec√∫telo nuevamente de esta forma: <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762</code> </pre> <br>  Con el par√°metro adicional <i>--out = tcpin: 0.0.0.0: 5762,</i> MAVProxy escuchar√° en el puerto 5762 las conexiones TCP entrantes de GCS.  Tan pronto como el GCS se conecte, los paquetes de datos comenzar√°n a moverse entre el dron y el GCS.  Intentemos conectarnos desde una PC: <br><br><img src="https://habrastorage.org/webt/8e/zz/eb/8ezzebgztbjr6nkllbyefkdots0.png" alt="imagen"><br><br>  Si la conexi√≥n es exitosa, GCS mostrar√° un mont√≥n de mensajes con una solicitud para calibrar los sensores y cargar los par√°metros a bordo con sus valores actuales: <br><br><img src="https://habrastorage.org/webt/mz/gy/co/mzgycobpds-e3bk7i5szgplvvey.png" alt="imagen"><br><br><img src="https://habrastorage.org/webt/i1/bx/ms/i1bxms-du1v9tbqpemtfv-sgodw.png" alt="imagen"><br><br><h3>  Calibraci√≥n de sensores y ajuste de los par√°metros del piloto autom√°tico. </h3><br>  La calibraci√≥n del piloto autom√°tico se puede hacer en casi cualquier GCS.  La documentaci√≥n de Ardupilot lo describe con todo detalle.  En primer lugar, establecemos el tipo de marco.  Tengo un dise√±o est√°ndar de 4 motores, as√≠ que este es <i>Quad X.</i> <br><br><img src="https://habrastorage.org/webt/mv/gc/bi/mvgcbi8augohhzhrcfrnosuia-s.png" alt="imagen"><br><br>  El primer vuelo a√∫n se hace mejor en modo manual.  Conectamos y calibramos el control de radio (receptor y transmisor). <br><br><img src="https://habrastorage.org/webt/dj/ay/xw/djayxw3ulzuaabk4ubn3qavp0d4.png" alt="imagen"><br><br>  Queda por calibrar el aceler√≥metro y la br√∫jula. <br><br><img src="https://habrastorage.org/webt/bm/rs/1r/bmrs1rhiwgxu2udg11td3t8slak.png" alt="imagen"><br><br>  Para que Ardupilot vea y tenga en cuenta los datos de sensores externos, configure los par√°metros necesarios: <br><br>  Para <u>PX4Flow</u> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">calibraci√≥n del sensor en s√≠ y actualizaci√≥n del firmware</a> ) <br><br> <code>FLOW_ENABLE = 1 (Enabled) <br> FLOW_ADDR = 0 (0 =     042)</code> <br> <br>  Para alt√≠metro l√°ser <u>VL53L0X</u> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucci√≥n</a> ) <br><br> <code>RNGFND_TYPE = 16 (VL53L0X) <br> RNGFND_ORIENT = 25 (  ) <br> RNGFND_ADDR = 41 (I2C-   ).   - 0x29,     = 41. <br> RNGFND_SCALING = 1 <br> RNGFND_MIN_CM = 5 <br> RNGFND_MAX_CM = 120 <br> RNGFND_GNDCLEAR = 15 (    ,     )</code> <br> <br>  Para <u>IRLock</u> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones detalladas</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki IR-Lock</a> ) <br><br> <code>PLND_ENABLED = 1 <br> PLND_TYPE = 2 <br> PLND_BUS = 1</code> <br> <br>  Para sonar de vista frontal ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucci√≥n</a> ) <br><br> <code>RNGFND2_TYPE = 2 (MaxbotixI2C sonar) <br> RNGFND2_ORIENT = 0 (  ) <br> RNGFND2_MAX_CM = 700 (   )</code> <br> <br>  Lista <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">completa de opciones de</a> Ardupilot. <br><br>  Ahora reinicie Ardupilot desde el men√∫ GCS, vuelva a conectarse a la placa y abra la ventana del Inspector MAVLink para ver los datos de los sensores. <br><br><img src="https://habrastorage.org/webt/6z/x_/8z/6zx_8zmfbc4nflyaxyz-h2yv8zs.png" alt="imagen"><br><br>  Desafortunadamente, las lecturas de IR-Lock no son visibles aqu√≠, para el an√°lisis de su trabajo tendr√° que mirar los registros a bordo.  C√≥mo hacer esto se describe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Queda por configurar los ajustes de seguridad y puede iniciar el dron: <br><br><img src="https://habrastorage.org/webt/ex/jp/x-/exjpx-pjkbvzmugdr-r1ujqpziw.png" alt="imagen"><br><br>  C√≥mo configurar la suspensi√≥n girosc√≥pica y controlar la c√°mara principal en detalle Escribir√© en uno de los siguientes art√≠culos, los puntos principales se describen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h3>  Transmisi√≥n de video </h3><br>  Veamos c√≥mo funciona la transmisi√≥n de video en la red WiFi.  Con este comando, puede ejecutar video en un puerto TCP en Raspberry usando la utilidad raspivid nativa para la c√°mara Raspicam: <br><br><pre> <code class="bash hljs">raspivid -t 0 -hf -fps 25 -w 640 -h 480 -o - | gst-launch-1.0 fdsrc ! h264parse ! rtph264pay config-interval=1 pt=96 ! gdppay ! tcpserversink host=0.0.0.0 port=5001</code> </pre> <br>  Pero este comando hace lo mismo, solo usa el contenedor rpi-camsrc compilado previamente para gstreamer: <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc sensor-mode=4 ! h264parse ! rtph264pay config-interval=1 pt=96 ! gdppay ! tcpserversink host=0.0.0.0 port=5001</code> </pre> <br>  En ambos casos, la transmisi√≥n h264 est√° disponible en la direcci√≥n IP de Raspberry en el puerto 5001. <br><br>  Puede verlo ejecutando dicho comando en su PC ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gstreamer</a> debe estar instalado), en lugar de <i>RPI_ADDRESS,</i> especifique la direcci√≥n Raspberry en la red: <br><br><pre> <code class="bash hljs">gst-launch-1.0 -v tcpclientsrc host=RPI_ADDRESS port=5001 ! gdpdepay ! rtph264depay ! avdec_h264 ! videoconvert ! autovideosink sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  Como resultado, la ventana con el video deber√≠a abrirse. <br><br>  Casi cualquier GCS tiene un reproductor de video incorporado que puede mostrar una transmisi√≥n de video RTSP.  Para hacer un servidor RTSP desde una Raspberry, puede usar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reproductor de</a> consola <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VLC</a> .  Instalaci√≥n: <br><br><pre> <code class="bash hljs">sudo apt-get install vlc</code> </pre> <br>  La transmisi√≥n de video comienza de la siguiente manera: <br><br><pre> <code class="bash hljs">raspivid -o - -t 0 -n -w 320 -h 240 -fps 25 | cvlc -vvv stream:///dev/stdin --sout <span class="hljs-string"><span class="hljs-string">'#rtp{sdp=rtsp://:8554/live}'</span></span> :demux=h264</code> </pre> <br>  El video est√° disponible en (en lugar de <i>RPI_ADDRESS</i> , direcci√≥n de frambuesa): <br><br> <code>rtsp://RPI_ADDRESS:8554/live</code> <br> <br>  Configuraci√≥n de GCS: <br><br><img src="https://habrastorage.org/webt/uk/x8/hu/ukx8huklwh9kxu5glz289xkzenq.png" alt="imagen"><br><br><img src="https://habrastorage.org/webt/7r/og/gw/7roggwghpf_arhxggulllplkr6i.png" alt="imagen"><br><br>  La direcci√≥n de transmisi√≥n se puede usar para conectar varios reproductores en diferentes dispositivos, pero dado que la captura y transmisi√≥n de video para Raspberry es un proceso que consume mucho tiempo, es mejor que varios consumidores de video usen un servidor externo (descripci√≥n a continuaci√≥n). <br><br><h3>  Telemetr√≠a por internet </h3><br>  Para que GCS se conecte a trav√©s de Internet a un dron con una direcci√≥n IP din√°mica, se requiere un servidor intermedio con una IP est√°tica en el que se lanzar√° el script MAVProxy.  Para estos fines, aprovech√© el alquiler de un servidor en la nube de uno de los proveedores m√°s conocidos.  Para MAVProxy, la configuraci√≥n m√≠nima es adecuada, pero como usar√© el mismo servidor para retransmitir video, eleg√≠ la opci√≥n con un poco m√°s de memoria (un n√∫cleo y 1 GB de memoria, Ubuntu 18.04).  Para el retraso m√≠nimo en el paso de datos entre la placa y el GCS, el servidor debe ubicarse en la m√°xima proximidad geogr√°fica al dron y al GCS. <br><br><img src="https://habrastorage.org/webt/eu/yl/3i/euyl3i1m1s5zjyjl5suhj0gw4sg.png" alt="imagen"><br><br>  Instale MAVProxy en el servidor.  Primeras dependencias: <br><br><pre> <code class="bash hljs">sudo apt-get install python-dev python-opencv python-wxgtk3.0 python-pip python-matplotlib python-pygame python-lxml python-yaml</code> </pre> <br>  y luego el script en s√≠ a trav√©s de PIP: <br><br><pre> <code class="bash hljs">sudo pip install MAVProxy</code> </pre> <br>  escribe el camino: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"export PATH=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.local/bin"</span></span> &gt;&gt; ~/.bashrc</code> </pre> <br>  y ejecute el script con los siguientes par√°metros: <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:0.0.0.0:15001 --out=tcpin:0.0.0.0:15002</code> </pre> <br>  MAVProxy escucha en el puerto 15001 los paquetes de telemetr√≠a entrantes del dron a trav√©s de UDP, y el puerto 15002 para la conexi√≥n TCP entrante desde GCS. <br><br>  Ejecute MAVProxy en Raspberry con un par√°metro m√°s, de modo que la telemetr√≠a tambi√©n se transmita al servidor (en lugar de <i>SERVER_IP la</i> direcci√≥n de su servidor): <br><br><pre> <code class="bash hljs">mavproxy.py --master=udp:127.0.0.1:14550 --out=tcpin:0.0.0.0:5762 --out=udpout:SERVER_IP:15001</code> </pre> <br>  Despu√©s de iniciar el script en la computadora de a bordo, aparecer√°n mensajes del piloto autom√°tico en la consola del servidor.  Como se mencion√≥ anteriormente, MAVProxy es un GCS completo con una interfaz de texto y en este estado ya es posible editar par√°metros y controlar el dron a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comandos</a> en la consola del servidor. <br><br>  Conecte el GCS en la PC o tableta al servidor.  La configuraci√≥n de conexi√≥n es la misma que para la red local, solo que en lugar de la direcci√≥n IP de Raspberry, especificamos la direcci√≥n del servidor y el puerto 15002. <br><br><img src="https://habrastorage.org/webt/8m/ed/rc/8medrcfonj1lsyr1wvufdi2elom.png" alt="imagen"><br><br>  Ahora puede conectar un m√≥dem USB 4G a Raspberry y evaluar el retraso con el que reacciona el horizonte en la pantalla. <br><br><h3>  Video de internet </h3><br><img src="https://habrastorage.org/webt/7i/w2/ow/7iw2owafcz4bjjmwu116q9tr65i.png" alt="imagen"><br><br>  Para retransmitir el video, instale el reproductor VLC en el servidor: <br><br><pre> <code class="bash hljs">sudo apt-get install vlc</code> </pre> <br>  Despu√©s de la instalaci√≥n, ejec√∫telo como un rel√© desde el puerto UDP 5001 en el canal RTSP <i><b>SERVER_IP: 8554 / live</b></i> : <br><br><pre> <code class="bash hljs">cvlc -vvv udp://@:5001 --sout <span class="hljs-string"><span class="hljs-string">'#rtp{sdp=rtsp://:8554/live}'</span></span> :demux=h264</code> </pre> <br>  A bordo, comenzaremos la transmisi√≥n de video desde la c√°mara al servidor a trav√©s de UDP (en lugar de la direcci√≥n del servidor <i>SERVER_IP</i> ): <br><br><pre> <code class="bash hljs">gst-launch-1.0 rpicamsrc bitrate=1000000 ! video/x-h264,width=640,height=480,framerate=25/1 ! h264parse ! udpsink host=SERVER_IP port=5001</code> </pre> <br>  La direcci√≥n de transmisi√≥n ahora se puede usar como fuente de video en la configuraci√≥n de GCS o se puede abrir en cualquier reproductor que admita este protocolo. <br><br>  Ahora puede planificar la ruta del vuelo e iniciar el dron a trav√©s de Internet, habi√©ndolo encendido previamente, por ejemplo, utilizando el asistente telef√≥nico. <br><br>  Obviamente, debido al tiempo de viaje relativamente largo de video y telemetr√≠a a trav√©s de la red, este m√©todo no es adecuado para vuelos FPV en modo manual entre obst√°culos. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/43rqRE9f1hA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Temas para publicaciones posteriores: <br><br><ul><li>  Opciones para cargar autom√°ticamente el dron en mi casita para p√°jaros y en cu√°l me detuve. </li><li>  Implementando GCS basado en la web usando MAVProxy, NodeJS, socket.io y un servidor de medios para administrar m√∫ltiples drones simult√°neamente. </li><li>  Canales de comunicaci√≥n redundantes y sistemas de rescate con drones. </li><li>  Visi√≥n artificial y lidares para evitar colisiones con obst√°culos. </li></ul><br>  Continuar√° ... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414587/">https://habr.com/ru/post/es414587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414577/index.html">Devilution: proyecto de ingenier√≠a inversa de Diablo</a></li>
<li><a href="../es414579/index.html">Google AI ha aprendido a predecir cu√°ndo morir√° un paciente (pero no todo es tan sombr√≠o)</a></li>
<li><a href="../es414581/index.html">¬øD√≥nde est√° su bot√≥n? ¬øC√≥mo puede una persona simple descargar datos de Kibana y Elasticsearch y no forzar a los desarrolladores?</a></li>
<li><a href="../es414583/index.html">RIT ++, Tech RaDarts y todo-todo-todo</a></li>
<li><a href="../es414585/index.html">C√≥mo se rompi√≥ mi String.getBytes (UTF_8) y qu√© hice con √©l</a></li>
<li><a href="../es414589/index.html">Rob√≥tica colaborativa de Sberbank: ¬øqu√© tipo de robot podemos hacer con usted?</a></li>
<li><a href="../es414593/index.html">Comparaci√≥n de C # y JavaScript. Los fundamentos</a></li>
<li><a href="../es414597/index.html">Preg√∫ntele a Ethan: ¬øQu√© tan cerca pueden unirse las civilizaciones alien√≠genas?</a></li>
<li><a href="../es414601/index.html">Cuando las monta√±as eran altas y las computadoras port√°tiles grandes: un poco m√°s de historia de TI</a></li>
<li><a href="../es414605/index.html">Mini imperios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>