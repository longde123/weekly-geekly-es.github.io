<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöê üë©üèº‚Äçü§ù‚Äçüë®üèΩ üíÑ Das neue iOS Mobile Enterprise. Teil 1: Codegenerierung f√ºr Ressourcen üßíüèº üëÖ üíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 


 Ich hei√üe Dmitry. So kam es, dass ich in den letzten zwei Jahren Teamleiter in einem Team von 13 iOS-Entwicklern bin. Und gemein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das neue iOS Mobile Enterprise. Teil 1: Codegenerierung f√ºr Ressourcen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/431148/"><h4 id="vsem-privet">  Hallo allerseits! </h4><br><p>  Ich hei√üe Dmitry.  So kam es, dass ich in den letzten zwei Jahren Teamleiter in einem Team von 13 iOS-Entwicklern bin.  Und gemeinsam arbeiten wir an der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tinkoff Business-</a> Anwendung. </p><br><p>  Ich m√∂chte Ihnen unsere Erfahrungen dar√ºber mitteilen, wie Sie die Anwendung zu einem unerwarteten Zeitpunkt mit maximaler Anzahl von Funktionen oder Fehlerkorrekturen ver√∂ffentlichen k√∂nnen und trotzdem nicht grau werden. </p><br><p>  Ich erz√§hle Ihnen von den Praktiken und Ans√§tzen, die dem Team geholfen haben, die Entwicklung und das Testen erheblich zu beschleunigen und die Menge an Stress, Fehlern und Problemen mit einer au√üerplanm√§√üigen oder dringenden Ver√∂ffentlichung erheblich zu reduzieren.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">#MakeReleaseWithoutStress</a> . </p><br><h4 id="poehali">  Lass uns gehen! </h4><a name="habracut"></a><br><h2 id="opisanie-problemy">  Problembeschreibung </h2><br><p>  Stellen Sie sich die folgende Situation vor. </p><br><p>  Es gibt eine andere Version.  Dem gingen Regressionstests voraus. Die Tester fanden erneut eine Stelle, an der anstelle von Text in der Anwendung die Zeilen-ID angezeigt wird. </p><br><img src="https://habrastorage.org/webt/s6/-u/qv/s6-uqv5rwcnqkxwlyzdhrphfamu.png" alt="Lokalisierungsfehler" width="100%"><br><p>  Dies war eines unserer h√§ufigsten Probleme. </p><br><p>  Dieses Problem tritt m√∂glicherweise nicht auf, wenn die Anwendung nicht in einer anderen Sprache lokalisiert ist oder die gesamte Lokalisierung in Zeilen direkt im Code geschrieben ist, ohne die Datei Localizable.strings zu verwenden. </p><br><p>  M√∂glicherweise sto√üen Sie jedoch auf andere Probleme, die wir Ihnen bei der L√∂sung helfen: </p><br><ul><li>  Die Anwendung st√ºrzt ab, weil Sie den Namen des Bildes falsch angegeben und das Entpacken erzwungen haben <br><pre><code class="plaintext hljs">UIImage(named: "NotExist")!</code> </pre> </li><li>  Die Anwendung st√ºrzt ab, wenn dem Ziel kein Storyboard hinzugef√ºgt wird </li><li>  Die Anwendung st√ºrzt ab, wenn Sie einen Controller aus einem Storyboard mit einer nicht vorhandenen ID erstellt haben </li><li>  Die Anwendung st√ºrzt ab, wenn Sie einen Controller aus dem Storyboard mit einer vorhandenen ID erstellt, aber in die falsche Klasse umgewandelt haben </li><li>  Unvorhersehbares Verhalten, wenn Sie eine Schriftart in Code verwenden, der nicht zu info.plist hinzugef√ºgt wurde, oder wenn die Schriftartdatei nicht mit target gekennzeichnet ist: Absturz ist m√∂glich, oder es ist m√∂glich, einfach eine Standardschrift anstelle der von Ihnen ben√∂tigten zu erhalten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwickler Apple: Benutzerdefinierte Schriftarten</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stackoverflow: Absturz</a> </li><li>  Die Anwendung st√ºrzt ab, wenn die Storyboards dem Controller eine Klasse anzeigen, die nicht vorhanden ist </li><li>  Eine Reihe von eint√∂nigem Code, der Symbole, Schriftarten, Controller und Ansichten erstellt </li><li>  Es gibt keine Bilder, Symbole zur Laufzeit, obwohl sich der Name des Bildes im Storyboard befindet, jedoch nicht in Assets </li><li>  Das Storyboard verwendet eine Schriftart, die nicht in info.plist enthalten ist </li><li>  Zeilen-IDs werden in der Anwendung angezeigt, anstatt an unerwarteten Stellen lokalisiert zu werden, da Zeilen in Localizable.strings gel√∂scht werden (obwohl sie nicht verwendet wurden). </li><li>  Etwas anderes, das ich vergessen habe zu erw√§hnen, oder dem wir noch nicht begegnet sind. </li></ul><br><h2 id="prichina--sledstvie">  Grund ‚Üí Wirkung </h2><br><p>  Warum passiert das alles? </p><br><p>  Es gibt Programmcode, der kompiliert wird.  Wenn Sie etwas falsch geschrieben haben (syntaktisch oder wenn der Funktionsname beim Aufruf falsch ist), wird Ihr Projekt einfach nicht zusammengestellt.  Das ist verst√§ndlich, offensichtlich und logisch. </p><br><p>  Aber was ist mit Dingen wie Ressourcen? </p><br><p>  Sie werden nicht kompiliert, sondern nach dem Kompilieren des Codes einfach zum Bundle hinzugef√ºgt.  In dieser Hinsicht kann zur Laufzeit eine gro√üe Anzahl von Problemen auftreten, beispielsweise der oben beschriebene Fall - mit Zeichenfolgen in der Lokalisierung. </p><br><h2 id="poisk-resheniya">  Suche nach einer L√∂sung </h2><br><p>  Wir haben dar√ºber nachgedacht, wie solche Probleme im Allgemeinen gel√∂st werden und wie wir dies beheben k√∂nnen.  Ich erinnerte mich an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine der Cocoaheads-Konferenzen auf mail.ru.</a>  Es wurde √ºber den Vergleich von Tools zur Codegenerierung gesprochen. </p><br><p>  Nachdem wir noch einmal gesehen hatten, worum es bei diesen Tools (Bibliotheken / Frameworks) geht, fanden wir endlich heraus, was ben√∂tigt wurde. </p><br><p>  Gleichzeitig verwenden Entwickler f√ºr Android seit Jahren einen √§hnlichen Ansatz.  Google hat √ºber sie nachgedacht und sie zu einem sofort einsatzbereiten Tool gemacht.  Aber Apple, selbst stabiler Xcode, kann uns nicht ... </p><br><p>  Es blieb nur herauszufinden, welches Instrument zu w√§hlen war: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Natalie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SwiftGen</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R.swift</a> ? </p><br><p>  Natalie hatte keine Lokalisierungsunterst√ºtzung, es wurde beschlossen, sie sofort aufzugeben.  SwiftGen und R.swift hatten sehr √§hnliche F√§higkeiten.  Wir haben uns f√ºr R.swift entschieden, einfach basierend auf der Anzahl der Sterne, da wir wussten, dass wir jederzeit zu SwiftGen wechseln k√∂nnen. </p><br><h2 id="kak-rabotaet-rswift">  Wie R.swift funktioniert </h2><br><p>  Ein Skript f√ºr die Erstellungsphase vor der Kompilierung wird gestartet, durchl√§uft die Projektstruktur und generiert eine Datei mit dem Namen <code>R.generated.swift</code> , die dem Projekt hinzugef√ºgt werden muss (wir werden Ihnen am Ende mehr dar√ºber erz√§hlen). </p><br><p>  Die Datei hat folgende Struktur: </p><br><pre> <code class="plaintext hljs">import Foundation import Rswift import UIKit /// This `R` struct is generated and contains references to static resources. struct R: Rswift.Validatable { fileprivate static let applicationLocale = hostingBundle.preferredLocalizations.first.flatMap(Locale.init) ?? Locale.current fileprivate static let hostingBundle = Bundle(for: R.Class.self) static func validate() throws { try intern.validate() } // ... /// This `R.string` struct is generated, and contains static references to 2 localization tables. struct string { /// This `R.string.localizable` struct is generated, and contains static references to 1196 localization keys. struct localizable { /// en translation:  Apple Pay /// /// Locales: en, ru static let card_actions_activate_apple_pay = Rswift.StringResource(key: "card_actions_activate_apple_pay", tableName: "Localizable", bundle: R.hostingBundle, locales: ["en", "ru"], comment: nil) // ... /// en translation:  Apple Pay /// /// Locales: en, ru static func card_actions_activate_apple_pay(_: Void = ()) -&gt; String { return NSLocalizedString("card_actions_activate_apple_pay", bundle: R.hostingBundle, comment: "") } } } }</code> </pre> <br><p>  Verwendung: </p><br><pre> <code class="plaintext hljs">let str = R.string.localizable.card_actions_activate_apple_pay() print(str) &gt;  Apple Pay</code> </pre> <br><p>  "Warum brauchen <code>Rswift.StringResource</code> ?", Fragen Sie.  Ich selbst verstehe nicht, warum ich es generieren soll, aber wie die Autoren erkl√§ren, wird es f√ºr Folgendes ben√∂tigt: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> . </p><br><h2 id="primenenie-v-realnyh-usloviyah">  Reale Anwendung </h2><br><p>  Eine kleine Erkl√§rung des Inhalts unten: </p><br><p>  * Es war - sie benutzten den Ansatz f√ºr eine Weile, am Ende verlie√üen sie ihn <br>  * Es ist - der Ansatz, den wir beim Schreiben von neuem Code verwenden <br>  * War es nicht, aber Sie k√∂nnen es haben - ein Ansatz, den es in unserer Anwendung nie gab, aber ich habe ihn in verschiedenen Projekten kennengelernt, als ich noch nicht bei Tinkoff.ru gearbeitet habe. </p><br><h4 id="localization">  Lokalisierung </h4><br><p>  Wir haben angefangen, <code>R.swift</code> f√ºr die Lokalisierung zu verwenden. Das hat uns vor den Problemen <code>R.swift</code> √ºber die wir am Anfang geschrieben haben.  Wenn sich die ID in der Lokalisierung ge√§ndert hat, wird das Projekt nicht zusammengestellt. </p><br><p>  * Dies funktioniert nur, wenn Sie die ID in allen Lokalisierungen in eine andere √§ndern.  Wenn eine Zeichenfolge in einer der Lokalisierungen verbleibt, wird beim Kompilieren eine Warnung angezeigt, dass diese ID nicht in allen Sprachen lokalisiert ist. </p><br><img src="https://habrastorage.org/webt/b4/ab/mh/b4abmhdhewhco-azpem4ab-ochy.png" alt="Warnung" width="40%"><br><br><div class="spoiler">  <b class="spoiler_title">Nicht da, aber Sie k√∂nnten haben:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">final class NewsViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() titleLabel.text = NSLocalizedString("news_title", comment: "News title") } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Es war:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">extension String { public func localized(in bundle: Bundle = .main, value: String = "", comment: String = "") -&gt; String { return NSLocalizedString(self, tableName: nil, bundle: bundle, value: value, comment: comment) } } final class NewsViewController: UIViewController { private enum Localized { static let newsTitle = "news_title".localized() } override func viewDidLoad() { super.viewDidLoad() titleLabel.text = Localized.newsTitle } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Es wurde:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">titleLabel.text = R.string.localizable.newsTitle()</code> </pre> </div></div><br><h4 id="images">  Bilder </h4><br><p>  Wenn wir nun etwas in * .xcassets umbenannt haben und den Code nicht ge√§ndert haben, wird das Projekt einfach nicht zusammengestellt. </p><br><div class="spoiler">  <b class="spoiler_title">Es war:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">imageView.image = UIImage(named: "NotExist") //     imageView.image = UIImage(named: "NotExist")! // crash imageView.image = #imageLiteral(resourceName: "NotExist") // crash</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Es wurde:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">imageView.image = R.image.tinkoffLogo() //    </code> </pre> </div></div><br><h4 id="storyboards">  Storyboards </h4><br><div class="spoiler">  <b class="spoiler_title">Es war:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">let someStoryboardName = "SomeStoryboard" // Change to something else (eg: "somestoryboard") - get nil or crash in else let someVCIdentifier = "SomeViewController" // Change to something else (eg: "someviewcontroller") - get nil or crash in else let storyboard = UIStoryboard(name: someStoryboardName, bundle: .main) let _vc = storyboard.instantiateViewController(withIdentifier: someVCIdentifier) guard let vc = _vc as? SomeViewController else { //    -  ,  Fabric  Firebase //    fatalError() ¬Ø\_(„ÉÑ)_/¬Ø}</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Es wurde:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">guard let vc = R.storyboard.someStoryboard.someViewController() else { //    -  ,  Fabric  Firebase //    fatalError() ¬Ø\_(„ÉÑ)_/¬Ø }</code> </pre> </div></div><br><p>  Usw. </p><br><h4 id="validaciya-storyboard">  Validierungs-Storyboard </h4><br><p>  <a href="">R.validate ()</a> ist ein wunderbares Tool, das H√§nde schl√§gt (oder vielmehr nur einen Fehler in einen Catch-Block wirft), wenn Sie im Storyboard oder in den XIB-Dateien etwas falsch gemacht haben. <br>  Zum Beispiel: </p><br><ul><li>  Gibt den Namen des Bildes an, das nicht im Projekt enthalten ist </li><li>  Sie gaben die Schriftart an, verwendeten sie dann nicht mehr und l√∂schten sie aus dem Projekt (aus info.plist). </li></ul><br><p>  Verwendung: </p><br><pre> <code class="plaintext hljs">final class AppDelegate: UIResponder { func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]? = nil) -&gt; Bool { #if DEBUG do { try R.validate() } catch { //   fatalError      //        debug        //  -   ,                 production fatalError(error.localizedDescription) } #endif return true } }</code> </pre> <br><h4 id="i-vot-vy-uzhe-gotovy-kupit-dva">  Und jetzt k√∂nnen Sie zwei kaufen! </h4><br><img src="https://habrastorage.org/webt/7x/m3/4q/7xm34quvznbr0zo761iqdhs7jgu.jpeg" alt="Halt die Klappe und nimm mein Geld!" width="40%"><br><br><h2 id="kak-vnedryat">  Wie zu implementieren? </h2><br><p>  * Komponentenbasiertes System - ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> , ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Codeentwicklungskonzept</a> , bei dem Komponenten (eine Reihe von miteinander verbundenen Bildschirmen / Modulen) in einer geschlossenen Umgebung (in unserem Fall in lokalen Pods) entwickelt werden, um die Koh√§renz der Codebasis zu verringern.  Viele Leute kennen den Ansatz im Backend, der auf diesem Konzept basiert - Microservices. </p><br><p>  * Monolith - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> , das Konzept der Codeentwicklung, bei dem die gesamte Codebasis in einem Repository liegt und der Code eng miteinander verbunden ist.  Dieses Konzept eignet sich f√ºr kleine Projekte mit einem begrenzten Funktionsumfang. </p><br><p>  Wenn Sie eine monolithische Anwendung entwickeln oder nur Abh√§ngigkeiten von Drittanbietern verwenden, haben Sie Gl√ºck (dies ist jedoch nicht korrekt).  Nehmen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tutorial</a> und machen Sie alles streng darauf. </p><br><p>  Dies war nicht unser Fall.  Wir haben uns engagiert.  Da wir ein komponentenbasiertes System verwenden und R.swift nicht nur in die Hauptanwendung einbetten, haben wir uns entschlossen, es in lokale Pods (die Komponenten sind) einzubetten. </p><br><p>  Aufgrund der st√§ndigen Aktualisierung von Lokalisierungen, Bildern und allen Elementen, die sich auf die Datei R.generated.swift auswirken, treten beim Zusammenf√ºhren mit dem gemeinsamen Zweig viele Konflikte in der generierten Datei auf.  Und um dies zu vermeiden, sollten Sie R.generated.swift aus dem Git-Repository entfernen.  Der Autor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">empfiehlt dies ebenfalls</a> . </p><br><p>  F√ºgen Sie die folgenden Zeilen zu <code>.gitignore</code> . </p><br><pre> <code class="plaintext hljs"># R.Swift generated files *.generated.swift</code> </pre> <br><p>  Wenn Sie f√ºr einige Ressourcen keinen Code generieren m√∂chten, k√∂nnen Sie immer einzelne Dateien oder ganze Ordner ignorieren: </p><br><pre> <code class="plaintext hljs">"${PODS_ROOT}/R.swift/rswift" generate "${SRCROOT}/Example" "--rswiftignore" "Example/.rswiftignore"</code> </pre> <br><p>  <a href="">Beschreibung von .rswiftignore</a> </p><br><p>  Wie im Hauptprojekt war es f√ºr uns wichtig, keine R.generated.swift-Dateien aus lokalen Pods zum Git-Repository hinzuzuf√ºgen.  Wir begannen dar√ºber nachzudenken, wie dies getan werden k√∂nnte: </p><br><ul><li>  Alias ‚Äã‚Äãf√ºr R.generated.swift, sodass die Datei (Alias, zum Beispiel: R.swift) zum Projekt hinzugef√ºgt wird und beim Kompilieren anhand der Referenz die reale Datei verf√ºgbar ist.  Aber Cocoapods sind schlau und d√ºrfen das nicht </li><li>  F√ºgen Sie in podspec in der Vorkompilierungsphase die Datei R.generated.swift mithilfe von Skripten zum Projekt selbst hinzu. Anschlie√üend wird sie einfach als Datei im Dateisystem hinzugef√ºgt, und die Datei wird nicht im Projekt angezeigt </li><li>  andere mehr oder weniger nette Optionen </li><li><p>  Magie in Podfile </p><br><div class="spoiler">  <b class="spoiler_title">Magie</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jk/fg/lt/jkfgltwqbhucchythactmnyrnrk.jpeg" alt="Magie" width="40%"><br><br><pre> <code class="ruby hljs">pre_install <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|installer|</span></span> installer.pod_targets.flat_map <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|pod_target|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pod_target.pod_target_srcroot.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>? <span class="hljs-string"><span class="hljs-string">'LocalPods'</span></span> <span class="hljs-comment"><span class="hljs-comment">#           LocalPods,     ,   pod_target_srcroot = pod_target.pod_target_srcroot #   pod_target_path = pod_target_srcroot.sub('${PODS_ROOT}/..', '.') #       pod_target_sources_path = pod_target_path + '/' + pod_target.name + '/Sources' #     Sources generated_file_path = pod_target_sources_path + '/R.generated.swift' #     R.generated.swift File.new(generated_file_path, 'w') #    R.generated.swift      end end end</span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li>  und eine andere Option ... f√ºge immer noch R.generated.swift zu git hinzu </li></ul><br><p>  Wir haben uns vor√ºbergehend f√ºr die Option "Magie im Podfile" entschieden, obwohl sie eine Reihe von M√§ngeln aufwies: </p><br><ul><li>  Es konnte nur vom Projektstamm aus gestartet werden (obwohl Cocoapods von fast jedem Ordner im Projekt aus gestartet werden k√∂nnen). </li><li>  Alle Pods sollten einen Ordner namens Sources haben (obwohl dies nicht kritisch ist, wenn die Pods in Ordnung sind). </li><li>  Er war seltsam und unverst√§ndlich, aber fr√ºher oder sp√§ter musste er unterst√ºtzen (dies ist immer noch eine Kr√ºcke) </li><li>  Befindet sich eine Bibliothek eines Drittanbieters in einem Ordner mit "LocalPods" im Pfad, wird versucht, die Datei "R.generated.swift" dort hinzuzuf√ºgen, oder es st√ºrzt mit einem Fehler ab </li></ul><br><h4 id="prepare_command">  prepare_command </h4><br><p>  Nachdem ich einige Zeit mit einem Drehbuch und Leiden gelebt hatte, beschloss ich, dieses Thema weiter zu studieren und fand eine andere Option. <br>  In Podspec gibt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">prepare_command</a> , der nur zum Erstellen und √Ñndern der Quellen vorgesehen ist, die dann dem Projekt hinzugef√ºgt werden. </p><br><p>  * News - Der Name des Pods, der durch den Namen Ihres lokalen Pods ersetzt werden muss <br>  * touch - Befehl zum Erstellen einer Datei.  Das Argument ist der relative Pfad zur Datei (einschlie√ülich des Namens der Datei mit der Erweiterung). </p><br><p>  Als n√§chstes werden wir mit News.podspec Betrug begehen </p><br><p>  Dieses Skript wird beim ersten Ausf√ºhren der <code>pod install</code> aufgerufen und f√ºgt die ben√∂tigte Datei dem Quellordner im Herd hinzu. </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... generated_file_path = "News/Sources/R.generated.swift" s.prepare_command = &lt;&lt;-CMD touch "#{generated_file_path}" CMD # ... end</span></span></code> </pre> <br><p>  Als n√§chstes kommt eine weitere "Finte mit Ohren" - wir m√ºssen das Skript R.swift f√ºr lokale Herde anrufen. </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... s.dependency 'R.swift' r_swift_script = '"${PODS_ROOT}/R.swift/rswift" generate "${PODS_TARGET_SRCROOT}/News/Sources"' s.script_phases = [ { :name =&gt; 'R.swift', :script =&gt; r_swift_script, :execution_position =&gt; :before_compile } ] end</span></span></code> </pre> <br><p>  Es stimmt, es gibt ein "aber".  <code>prepare_command</code> funktioniert nicht mit lokalen Pods oder besser gesagt, aber in einigen besonderen F√§llen.  Es gibt eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Diskussion zu diesem Thema auf Github</a> . </p><br><h4 id="fatality">  Todesfall </h4><br><p>  * Fatality - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> , der letzte Hit in Mortal Kombat. </p><br><p>  Nach ein wenig mehr Recherche fand ich eine andere L√∂sung - eine Mischung aus Ans√§tzen c <code>prepare_command</code> und <code>pre_install</code> . </p><br><p>  Eine kleine Modifikation der Magie aus dem Podfile: </p><br><pre> <code class="ruby hljs">pre_install <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|installer|</span></span> <span class="hljs-comment"><span class="hljs-comment"># map development pods installer.development_pod_targets.each do |target| # get only main spec and exclude subspecs spec = target.non_test_specs.first # get full podspec file path podspec_file_path = spec.defined_in_file # get podspec dir path pod_directory = podspec_file_path.parent # check if path contains local pods directory # exclude development but non local pods local_pods_directory_name = "LocalPods" if pod_directory.to_s.include? local_pods_directory_name # go to pod root directorty and run prepare command in sub-shell system("cd \"#{pod_directory}\"; #{spec.prepare_command}") end end end</span></span></code> </pre> <br><p>  Und das gleiche Skript, das nicht f√ºr lokale Herde ausgef√ºhrt wurde </p><br><pre> <code class="ruby hljs">Pod::Spec.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... s.dependency 'R.swift' generated_file_path = "News/Sources/R.generated.swift" s.prepare_command = &lt;&lt;-CMD touch "#{generated_file_path}" CMD r_swift_script = '"${PODS_ROOT}/R.swift/rswift" generate "${PODS_TARGET_SRCROOT}/News/Sources"' s.script_phases = [ { :name =&gt; 'R.swift', :script =&gt; r_swift_script, :execution_position =&gt; :before_compile } ] end</span></span></code> </pre> <br><p>  Am Ende funktioniert es wie erwartet. </p><br><p>  Endlich! </p><br><p>  PS: </p><br><p>  Ich habe versucht, einen anderen benutzerdefinierten Befehl anstelle von <code>prepare_command</code> , aber <code>pod lib lint</code> (ein Befehl zum √úberpr√ºfen des Podspec-Inhalts und des Herdes selbst) schw√∂rt auf zus√§tzliche Variablen und wird nicht √ºbergeben. </p><br><h4 id="nelokalnye-pody">  Nicht lokale Herde </h4><br><p>  In Remote-Pods (die sich jeweils in einem eigenen Repository befinden) ben√∂tigen Sie nicht all diese oben beschriebene Skriptmagie, da dort die Codebasis streng an die Abh√§ngigkeitsversion gebunden ist. </p><br><p>  Es reicht aus, einfach das R.swift-Skript Example (ein Projekt, das nach dem Befehl pod lib create &lt;Name&gt; generiert wurde) selbst einzubetten und R.generated.swift zum Bibliothekspaket hinzuzuf√ºgen (unten).  Wenn das Projekt kein Beispiel hat, m√ºssen Sie Skripte schreiben, die denen √§hneln, die ich zitiert habe. </p><br><p>  PS: </p><br><p>  Es gibt eine kleine Klarstellung: <br>  R.swift + Xcode 10 + neues Build-System + inkrementeller Build! = &lt;3 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weitere Informationen zum Problem finden Sie auf der Hauptseite der Bibliothek</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> <br>  R.swift v4.0.0 funktioniert nicht mit Cocoapods 1.6.0 :( <br>  Ich denke, bald werden alle Probleme behoben sein. </p><br><h2 id="vyvod">  Fazit </h2><br><p>  Sie m√ºssen den Qualit√§tsbalken immer so hoch wie m√∂glich halten.  Dies ist besonders wichtig f√ºr Anwendungen, die mit Finanzen arbeiten. </p><br><p>  In diesem Fall m√ºssen Sie die Tests nicht √ºberladen und Fehler so fr√ºh wie m√∂glich finden.  In unserem Fall ist dies entweder zum Zeitpunkt der Kompilierung des Codes durch den Entwickler oder beim Testlauf f√ºr Pull-Anforderungen.  Daher finden wir den Mangel an Lokalisierung nicht durch den aufmerksamen Blick der Tester oder durch automatisierte Tests, sondern durch den √ºblichen Prozess der Erstellung der Anwendung. </p><br><p>  Sie m√ºssen auch die Tatsache ber√ºcksichtigen, dass dies ein Drittanbieter-Tool ist, das an die Projektstruktur gebunden ist und deren Inhalt analysiert.  Wenn sich die Struktur der Projektdatei √§ndert, muss das Tool ge√§ndert werden. <br>  Wir sind dieses Risiko eingegangen und sind in diesem Fall immer bereit, dieses Tool in ein anderes zu √§ndern oder Ihr eigenes zu schreiben. </p><br><p>  Und der Gewinn von R.swift ist eine gro√üe Anzahl von Arbeitsstunden, die das Team f√ºr viel wichtigere Dinge aufwenden kann: neue Funktionen, neue technische L√∂sungen, Qualit√§tsverbesserungen und so weiter.  R.swift hat den Zeitaufwand f√ºr die Integration vollst√§ndig zur√ºckgegeben, auch unter Ber√ºcksichtigung des m√∂glichen zuk√ºnftigen Ersatzes durch eine andere √§hnliche L√∂sung. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">R.swift</a> </p><br><h2 id="bonus">  Bonus </h2><br><p>  Sie k√∂nnen mit einem Beispiel herumspielen, um den Gewinn aus der Codegenerierung f√ºr Ressourcen sofort mit eigenen Augen zu sehen.  Der Quellcode des Projekts "herumspielen": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> . </p><br><h4 id="spasibo-ogromnoe-chto-prochitali-statyu-ili-zhe-prosto-dolistali-do-etogo-mesta-mne-v-lyubom-sluchae-priyatno">  Vielen Dank, dass Sie den Artikel gelesen haben oder einfach nur zu diesem Ort gebl√§ttert haben. Ich freue mich auf jeden Fall.) </h4><br><h4 id="thats-all">  Das ist alles </h4></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431148/">https://habr.com/ru/post/de431148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431138/index.html">Biometrie mit dem Rostelecom-Schl√ºssel: Wie der FSB die russische Kryptographie erstmals in Anwendungsgesch√§ften einf√ºhrte</a></li>
<li><a href="../de431140/index.html">Bericht aus der Go in Production-Metapa: Videos, Fotos, Pr√§sentationen</a></li>
<li><a href="../de431142/index.html">Wie kann SQL Profiler Trace nachts zu einer bestimmten Zeit ausgef√ºhrt werden?</a></li>
<li><a href="../de431144/index.html">Far Fields mic (Mic array) - unauff√§lliger Held in einer intelligenten S√§ule</a></li>
<li><a href="../de431146/index.html">1. Check Point Log Analysis: Die offizielle Check Point App f√ºr Splunk</a></li>
<li><a href="../de431152/index.html">Metro 4 ist eine 6-j√§hrige Reise. Eine kurze Geschichte von Metro UI CSS</a></li>
<li><a href="../de431154/index.html">M√§ngel in Fallout 76-Quests erm√∂glichten es den Spielern, die nukleare H√∂lle zu machen</a></li>
<li><a href="../de431156/index.html">SCHOCK! Neue Phishing-Software gewinnt den zweiten Faktor</a></li>
<li><a href="../de431158/index.html">Mehr Kaffee, weniger Koffein: Intel 9th ‚Äã‚ÄãGen (Teil 2)</a></li>
<li><a href="../de431160/index.html">Keine einzige Chance f√ºr den Gegner - wir verwenden die ultraschnelle HyperX Alloy FPS RGB-Tastatur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>