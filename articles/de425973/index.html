<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖌️ 👨🏿‍🏭 🍒 Wie wir S3 DataLine-Speicher erstellt haben. Experimente, Tests und ein wenig über Flusspferde 🙇🏾 🌀 💔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo nochmal, Alexey Pristavko ist in Kontakt und dies ist der zweite Teil meiner Geschichte über die S3-Objektspeicher-DataLine, die auf Cloudian Hy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir S3 DataLine-Speicher erstellt haben. Experimente, Tests und ein wenig über Flusspferde</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/425973/"><img src="https://habrastorage.org/webt/0k/od/i7/0kodi796iwhoi16frktb7mytx_4.png"><br><br>  Hallo nochmal, Alexey Pristavko ist in Kontakt und dies ist der zweite Teil meiner Geschichte über die S3-Objektspeicher-DataLine, die auf Cloudian HyperStore basiert. <br><br>  Heute werde ich ausführlich darüber sprechen, wie unser S3-Speicher angeordnet ist und auf welche Schwierigkeiten wir bei der Erstellung gestoßen sind.  Berühren Sie unbedingt das Thema „Eisen“ und analysieren Sie die Ausrüstung, auf der wir uns aufgehalten haben. <br><br>  Lass uns gehen! <br><a name="habracut"></a><br>  Wenn Sie während des Lesens die Anwendungsarchitektur der Cloudian-Lösung kennenlernen möchten, finden Sie deren detaillierte Analyse im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel</a> .  Dort haben wir das Cloudian-interne Gerät, die Fehlertoleranz und die Logik des eingebauten Sicherheitsdatenblatts ausführlich besprochen. <br><br><h2>  Das endgültige Schema der physischen Ausrüstung </h2><br>  Da wir später über unsere "Qual der Wahl" sprechen werden, werde ich sofort die endgültige Liste der Eisen geben, zu denen wir gekommen sind.  Kleiner Haftungsausschluss: Die Wahl der Netzwerkausrüstung war größtenteils auf die Präsenz in unserem (übrigens sehr soliden) Lager zurückzuführen. <br><br>  Auf der physischen Ebene des Speichers verfügen wir also über die folgenden Geräte: <br><table><tbody><tr><td>  <b>Name</b> <br></td><td>  <b>Funktion</b> <br></td><td>  <b>Konfiguration</b> <br></td><td>  <b>Menge</b> <br></td></tr><tr><td>  Lenovo System x3650 M5 Server <br></td><td>  Arbeitsknoten <br></td><td>  1x Xeon E5-2630v4 2,2 GHz, <br>  4x 16 GB DDR4, <br>  14 x 10 TB 7,2 K 6 Gbit / s SATA 3,5 ", <br>  2x 480 GB SSD, <br>  Intel x520 Dual Port 10 GbE SFP +, <br>  2x750W HS-Netzteil <br></td><td>  4 <br></td></tr><tr><td>  HP ProLiant DL360 G9 Server <br></td><td>  Load Balancer-Knoten <br></td><td>  2 E5-2620 v3, <br>  128 G RAM, <br>  2 600 GB SSD, <br>  4 SAS-Festplatte, <br>  Intel x520 Dual Port 10 GbE SFP + <br></td><td>  2 <br></td></tr><tr><td>  Cisco C4500 Switch <br></td><td>  Grenztor <br></td><td>  Katalysator WS-C4500X-16SFP + <br></td><td>  2 <br></td></tr><tr><td>  Cisco C3750 Switch <br></td><td>  Port Extender <br></td><td>  Katalysator WS-C3750X-24T mit C3KX-NM-10G <br></td><td>  2 <br></td></tr><tr><td>  Cisco C2960 Switch <br></td><td>  Steuerebene <br></td><td>  Katalysator WS-C2960 + 48PST-L <br></td><td>  1 <br></td></tr></tbody></table><br>  Zum besseren Verständnis der Architektur werden wir uns nacheinander alle Elemente ansehen und über ihre Merkmale und Aufgaben sprechen. <br><br>  Beginnen wir mit den Servern.  Lenovo Server verfügen über eine spezielle Konfiguration, die gemeinsam und in voller Übereinstimmung mit den Empfehlungen und Spezifikationen von Cloudian implementiert wird.  Beispielsweise verwenden sie einen Controller mit direktem Festplattenzugriff.  Da in unserem Fall RAID auf der Ebene der Anwendungssoftware organisiert ist, erhöht dieser Modus die Zuverlässigkeit und beschleunigt das Festplattensubsystem.  Genau die gleichen Server können zusammen mit allen Lizenzen als Cloudian Appliance erworben werden. <br><br>  Lastausgleichsserver mit Nginx für CentOS gewährleisten eine gleichmäßige Lastverteilung auf Arbeitsknoten und abstrahieren den Benutzer von der internen Verkehrsorganisation.  Und als angenehmer Bonus - bei Bedarf können Sie einen Cache darauf organisieren. <br><br>  Das Cisco 4500X 16 10 GB SFP + -Paar dient als Kern und Grenze unseres kleinen, aber stolzen Speichernetzwerks.  Natürlich ist Eisen ein wenig altmodisch, aber es ist dem „Neuen“ in Sachen Zuverlässigkeit nicht unterlegen, es hat interne Redundanz und seine Funktionalität erfüllt alle unsere Anforderungen.  C3750 spielt die Rolle des Factory-Extenders. Es ist nicht erforderlich, 1G-Transceiver in 10G-Steckplätze zu schieben.  Und komplett auf 10GB Links umzusteigen macht auch noch nicht viel Sinn.  Wie Tests gezeigt haben, stoßen wir früher auf den Prozessor und die Festplatten. <br><br>  Das folgende Diagramm zeigt die von mir beschriebene physische Organisation hinreichend detailliert: <br><br><img src="https://habrastorage.org/webt/jj/cs/mr/jjcsmrwqvzkqrder_z9zv3pr4ca.jpeg">  <i>1. Schema der physischen Speicherorganisation</i> <br><br>  Lassen Sie uns das Schema durchgehen.  Wie Sie sehen können, wird die Fehlertoleranz auf physikalischer Ebene durch Duplizieren und Verbinden jedes Geräts mit mindestens zwei optischen Verbindungen realisiert, eine für jedes Gerät in einem Paar.  Dies gibt uns die Garantie, die physische Konnektivität in der Schaltung während eines Unfalls eines Netzwerkgeräts oder zweier Geräte aus verschiedenen Paaren gleichzeitig aufrechtzuerhalten. <br><br>  Wir gehen unter das Schema.  Beide Cisco-Paare (4500/4500, 3750/3750) werden mithilfe von Stack und VSS zu einem einzigen logischen Gerät kombiniert.  Der Stapel wird mit zwei Stapelkabeln VSS über drei optische 10G-Verbindungen zusammengebaut.  Auf diese Weise können Sie sicherstellen, dass beide Geräte in jedem Paar als Ganzes interagieren.  Ein solches Clustering ermöglicht es uns, im Rahmen eines transparenten L2-Segments über beide Geräte eines Paares zu arbeiten und eine allgemeine Link-Aggregation mithilfe von LACP durchzuführen, da diese Technologie sowohl vom Server-Betriebssystem als auch von Cisco IOS nativ unterstützt wird.  Auf der Serverseite sieht es so aus, als würde es mit einem Switch statt mit zwei arbeiten, und über der Anwendung befindet sich ein aggregierter Kanal mit doppelter Kapazität. <br><br>  Alle Netzwerkgeräte, die zwischen sich und den eingehenden Kanälen umschalten, werden über optische 10G-Verbindungen umgeschaltet. Die Servergeräte werden über 10G Twinax Cisco-Kabel und 1G Kupfer angeschlossen. <br><br>  BGP wird für die Fehlertoleranz des eingehenden Kanals verwendet, und Round Robin DNS wird zum Ausgleichen zwischen externen IP-Adressen verwendet.  Externe Adressen selbst werden auf Lastausgleichsservern geparkt und bei Bedarf mithilfe des Pacemaker / Corosync-Bundles zwischen Knoten migriert. <br><br>  Die Überwachung und Steuerung über IPMI erfolgt über eine direkte interne Verbindung.  Alle Verwaltungsschnittstellen (sowohl Server als auch Cisco) sind über separate Switches auf der Steuerebene verbunden.  Sie sind wiederum im Steuerungsnetzwerk des Rechenzentrums enthalten.  Dies garantiert uns die Unmöglichkeit, die Kommunikation mit Geräten während der Arbeit oder infolge eines Unfalls in einem externen Netzwerk zu verlieren.  Für den extremsten Fall gibt es Begleiter bei KVM. <br><br><h2>  Logisches Netzwerk </h2><br>  Um zu verstehen, wie das logische S3-Netzwerk des DataLine-Speichers funktioniert, wenden wir uns einem anderen Schema zu: <br><br><img src="https://habrastorage.org/webt/lp/zn/ub/lpznubpzqosgkhzts8tm7sp0ssi.png"><br>  <i>2. Logisches Netzwerkdiagramm für den Speicher</i> <br><br>  Wie Sie sehen können, besteht die Netzwerklogik aus mehreren Segmenten. <br><br>  Ein externes Netzwerk (Q) mit einer Gesamtkapazität von 20 G ist direkt mit Provider Edge verbunden.  Darauf folgen der Cisco 4500 und Balancer. <br><br>  Der nächste logische Block (X) ist das VLAN zwischen den Balancern und den Arbeitsknoten.  Die Balancer verwenden dieselbe Verbindung wie für eingehenden Datenverkehr.  Arbeitsknoten sind über den 3750-Stapel mit 4 1G-Verbindungen verbunden (zwei für jede 3750).  Alle physischen Verbindungen werden auch mit LACP zu einer einzigen logischen Verbindung zusammengefügt.  Dieses Netzwerk wird nur zur Verarbeitung des Clientverkehrs verwendet. <br><br>  Alle Verbindungen innerhalb des Cloudian (Y) -Clusters durchlaufen ein drittes logisches Segment, das auf 10G basiert.  Eine solche Organisation hilft, Probleme auf dem externen Kanal aufgrund des internen Datenverkehrs zu vermeiden und umgekehrt.  Dies ist ein extrem belastetes und wichtiges Segment für den Betrieb des Clusters.  Dadurch werden Daten und Metadaten repliziert, sie werden von allen Neuausgleichsverfahren usw. verwendet. Daher haben wir ihre „Unsinkbarkeit“ als separate Aufgabe unterschieden. <br><br><h2>  Ein bisschen Schönheit </h2><br>  So sieht alles aus: <br><br><img src="https://habrastorage.org/webt/_m/_1/sd/_m_1sd2pvc2h5nbt2wco5bdkl4s.png"><br>  <i>3. Netzwerkgeräte und Balancer mit vollem Gesicht</i> <br><br><img src="https://habrastorage.org/webt/xo/q0/e4/xoq0e4outgmbcgswdzb4uzs4bsg.png"><br>  <i>4. Die gleiche Rückansicht</i> <br><br>  Achten Sie auf das Umschalten.  In früheren Artikeln haben meine Kollegen über die Bedeutung von Farbmarkierungskabeln geschrieben, aber es wird nicht unangebracht sein, dieses Thema hier anzusprechen. <br><br>  Wir verwenden die Farbumschaltung nicht nur für das Netzwerk, sondern auch für die Stromversorgung.  Dies ermöglicht unseren Ingenieuren eine schnelle Navigation im Rack und reduziert den Einfluss des menschlichen Faktors beim Umschalten. <br><br><img src="https://habrastorage.org/webt/uu/8x/tw/uu8xtwvqpdcvw45xlugyfysq5is.png"><br>  <i>5. Arbeitsknoten</i> <br><br><img src="https://habrastorage.org/webt/wl/gn/5g/wlgn5gc7cttpbkra7cpmnza_pdo.png"><br>  <i>6. Rückansicht</i> <br><br>  Auf diesem Foto können Sie deutlich sehen, wie dicht die Arbeitsserver mit Festplatten gefüllt sind - selbst auf der Rückseite befinden sich praktisch keine leeren Steckplätze.  Übrigens erfüllt eine solche Organisation von Kabeln zu kompakten Bündeln nicht nur eine ästhetische Funktion, sondern vermeidet auch überlappende Lüfter von Netzteilen, wodurch Eisen vor Überhitzung geschützt wird. <br><br><h3>  Whitelisting </h3><br>  In den Kommentaren zum letzten Artikel habe ich versprochen, mehr über das Whitelisting-Gerät zu sprechen. <br><br>  Wenn wir uns aus irgendeinem Grund mit dem Kunden darauf geeinigt haben, alle Arbeiten mit dem Speicher von der Innenseite des Rechenzentrums oder über direkte Kanäle zu seinen Geräten auszuschließen, müssen wir eine private Verbindung zum Speicher herstellen. <br><br>  Erinnern Sie sich, im ersten Diagramm gab es einen Zweig auf DIST und Cloud?  Zusätzlich zum Haupt-Internetkanal mit 20 GB verwenden wir einen aggregierten Kanal für Switches, mit dem wir alle Clients auf Rechenzentrumsebene verbinden.  Wenn der Client eine direkte Verbindung zum Speicher wünscht, können wir das VLAN vom Client zu unserem 4500X mit der Erstellung einer separaten Route (oder ohne diese) konfigurieren und L3 starten.  Danach wird die Bindung an den Tarifplan an die Adressen des Kunden konfiguriert, die bereits in Cloudian selbst vorhanden sind.  Für alle, die mit diesem Tarif verbunden sind, wird die Verwendung von S3 aus Whitelist-Adressen nicht berücksichtigt. <br><br><img src="https://habrastorage.org/webt/mr/nc/yd/mrncyda-0oquwo4kpos3snsyp2e.png"><br>  <i>7. Und hier ist eine spezielle Oberfläche in Cloudian.</i> <br><br>  Jetzt haben wir keinen solchen Tarif im Netz, aber wenn Sie es wirklich wollen, können wir ihn bereitstellen. <br><br><h2>  Baugeschichte </h2><br>  Wir nähern uns allmählich dem interessantesten Teil der Geschichte - dem Bau eines Lagers.  Es wird viele Fotos geben, bis zu drei Versuche, den Verkehrsausgleich zu organisieren, und einige schlechte Tipps.  Ich hoffe, dass die Analyse der Probleme, auf die wir unterwegs gestoßen sind, für diejenigen nützlich sein wird, die sich darauf vorbereiten, mit einer Geschwindigkeit von 10 Gbit + im Web zu arbeiten. <br><br><h3>  Experimentieren mit 10G </h3><br>  Bevor ich direkt zum Kern dieses Abschnitts gehe, erlaube ich mir, einen weiteren kleinen Haftungsausschluss zu machen. <br><br>  Nach einer etablierten Tradition gehen wir vor dem Kauf neuer Zusatzgeräte ins Lager und wählen mehr oder weniger geeignete Komponenten aus.  So können Sie schnell Tests durchführen und sich für eine zukünftige Einkaufsliste entscheiden.  Obwohl wir kein 100% zuverlässiges Ergebnis erzielen, wird natürlich nichts für die Produktivität ausgegeben. <br><br>  So war es diesmal.  Und wenn Cisco keine Überraschungen warf, dann hat uns die „Gier“ der Load Balancer fast ruiniert. <br><br><h4>  Die erste Erfahrung.  Supermicro Server </h4><br>  Hier hat uns der Wunsch enttäuscht, einen Schnelltest mit minimalen Kosten durchzuführen.  Im Lager fanden wir Supermicro-Server, auf denen bis auf das Fehlen von SFP-Schnittstellen alles in Ordnung war.  Wir haben uns entschlossen, unseren geliebten Intel 520DA2 auf ihnen zu installieren, und standen sofort vor dem ersten Problem: Die Maschinen sind Einzelgeräte, aber es gibt keine Riser.  Gleichzeitig war unser Korps aus irgendeinem Grund nicht in den Kompatibilitätslisten enthalten, aber es gab viele einheimische Riser. <br><br>  Auf Anraten des Direktors für innovative Entwicklung, Misha Solovyov, haben wir alles mit flexiblen Steigleitungen für Bergbaubetriebe verbunden.  Das Ergebnis war so ein "Kadaver": <br><br><img src="https://habrastorage.org/webt/lf/wx/t6/lfwxt6csco5ndrm--6qzy4kqfhi.png"><br>  <i>8. Prototyp Nr. 1</i> <br><br>  Ich musste an einigen Stellen das berühmte blaue Isolierband verwenden, um, Gott bewahre, etwas Kurzes zu tun.  Ja, die Kollektivfarm.  Ja, beschämt.  Eine solche „Konfiguration“ ist jedoch für den Zeitraum des Experiments durchaus akzeptabel. <br><br><img src="https://habrastorage.org/webt/sp/to/af/sptoaf-lv4w_imfhvnro9i12f1y.png"><br>  <i>9. Rückansicht</i> <br><br>  Was dabei herauskam, ist im Screenshot des iperf deutlich zu sehen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/494/311/900/494311900ac9a09852f260ebbfb4e4b8.png"><br>  <i>10. Eigentlich ist das kein Screenshot :)</i> <br><br>  Die Metriken sind sehr interessant, oder?  Wir waren also traurig.  Zuerst haben wir an Spionage-Chips gedacht, wir haben alles auseinander genommen und begradigt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/bb2/6ac/082bb26ac22d6de01f22f464b778314b.png"><br>  <i>11. Auf den ersten Blick gibt es hier keine Spionagechips</i> <br><br>  Sie erinnerten an den Verlauf der Physik: elektromagnetische Interferenzen, hochfrequente Signale usw. ... Natürlich machte es keinen Sinn, das Experiment mit einer solchen Quantität und Qualität der "Kollektivfarm" fortzusetzen.  Also haben wir endlich das System auseinander genommen und die Server wieder installiert. <br><br><h4>  Die zweite Erfahrung.  Citrix Netscaler MPX8005 </h4><br>  Bei der Rückkehr der Server an den Ort haben wir neue Helden gefunden: Citrix Netscaler MPX8005.  Dies ist ein wunderbares Markeneisen, das außerdem fast nie verwendet wird.  Sie sehen so aus: <br><br><img src="https://habrastorage.org/webt/dq/v1/va/dqv1vawcvfgpmmijwrie29ewkgy.png"><br>  <i>12. Der Schlitten im Rack passte nicht in die Länge, aber wir Visionär beschlossen, ihn auf später zu verschieben</i> <br><br>  Geräte in ein Rack stellen, umschalten und konfigurieren.  Dies sind wirklich ausgezeichnete "erwachsene" Eisenstücke, 2 SFP-Steckplätze für jeweils 10 GB, HA, fortschrittliche Algorithmen, es gibt sogar L7.  Zwar bis zu 5 Gigabit unter Lizenz, aber wir haben immer noch L3 verwendet, aber es gibt keine solchen Einschränkungen. <br><br>  Daumen drücken, testen.  Es gibt keine Geschwindigkeit.  Auf den Schnittstellen - solide Fehler bei ungeeigneten Transceivern, Geschwindigkeit von ca. 5 Gigabit, konstante Abfälle.  Sie erinnerten sich an die flexiblen Tragegurte und waren wieder traurig.  Auch dort war die Geschwindigkeit höher und weniger Fehler.  Wir beginnen zu verstehen: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> channel LA/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface LA/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">802.3</span></span>ad Link <span class="hljs-keyword"><span class="hljs-keyword">Aggregate</span></span>) #<span class="hljs-number"><span class="hljs-number">10</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x4100c020</span></span> &lt;ENABLED, UP, <span class="hljs-keyword"><span class="hljs-keyword">AGGREGATE</span></span>, UP, HAMON, HEARTBEAT, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, native vlan=<span class="hljs-number"><span class="hljs-number">1</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h03m23s  Requested: media <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, speed AUTO, duplex <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">160000</span></span>  Link Redundancy Throughput <span class="hljs-number"><span class="hljs-number">80000</span></span>  Actual: throughput <span class="hljs-number"><span class="hljs-number">20000</span></span>  LLDP Mode: <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">9388</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">557582</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">1225</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10514</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">574232</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  bandwidthHigh: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec, bandwidthNormal: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec.  LA mode: AUTO &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">1</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m44s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8921</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">517626</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">585</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">9884</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">545408</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>. &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">0</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m58s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8944</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">530975</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">911</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10819</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">785347</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.</code> </pre> <br><br>  Wir haben native Cisco-Transceiver verwendet, mit denen theoretisch keine Probleme auftreten sollten.  Sie überprüften sogar die Optik und wechselten für alle Fälle die Transceiver - das gleiche Bild.  Unser Auto fährt nicht und das wars!  Wir schauen genauer hin. <br><br>  "Schöne" Cisco-Transceiver: <br><br><pre> <code class="hljs vhdl">ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI-Express Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>xe000-<span class="hljs-number"><span class="hljs-number">0</span></span>xe01f mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf781ffff,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf7843fff irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pci1 ix1: ixgbe <span class="hljs-keyword"><span class="hljs-keyword">bus</span></span> speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> PCIe lane <span class="hljs-literal"><span class="hljs-literal">width</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CISCO-AVAGO , part number XXX , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x00 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 *** Unsupported SFP+/SFP <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>!</code> </pre> <br><br>  Transceiver werden nicht normal erkannt, nicht unterstützt! <br><br>  Ich musste die meisten "Verwandten" finden: <br><br><img src="https://habrastorage.org/webt/wi/-i/sw/wi-iswj9672s8q0skvpw4s3s2xw.png"><br>  <i>13. Die heimischsten Transceiver im Wilden Westen</i> <br><br><pre> <code class="hljs powershell">ix0: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe020<span class="hljs-literal"><span class="hljs-literal">-0xe03f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7820000<span class="hljs-literal"><span class="hljs-literal">-0xf783ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7844000<span class="hljs-literal"><span class="hljs-literal">-0xf7847fff</span></span> irq <span class="hljs-number"><span class="hljs-number">16</span></span> at device <span class="hljs-number"><span class="hljs-number">0.0</span></span> on pci1 platform: Manufacturer Citrix Inc. platform: NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> <span class="hljs-number"><span class="hljs-number">675320</span></span> (<span class="hljs-number"><span class="hljs-number">28</span></span>), manufactured at <span class="hljs-number"><span class="hljs-number">8</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> platform: serial <span class="hljs-number"><span class="hljs-number">4</span></span>NP602H7H0 platform: sysid <span class="hljs-number"><span class="hljs-number">675320</span></span> - NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> ix0: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX   , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 ix0: [<span class="hljs-type"><span class="hljs-type">ITHREAD</span></span>] <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>: Ethernet address: <span class="hljs-number"><span class="hljs-number">00</span></span>:e0:ed:<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:f8 ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe000<span class="hljs-literal"><span class="hljs-literal">-0xe01f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000<span class="hljs-literal"><span class="hljs-literal">-0xf781ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000<span class="hljs-literal"><span class="hljs-literal">-0xf7843fff</span></span> irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> on pci1 ix1: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX  , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00</code> </pre> <br><br>  Diese Transceiver wurden ohne Probleme bestimmt, aber dies rettete die Situation nicht.  Firmware aktualisiert - das Gleiche.  Der Citrix-Support hat beschlossen, taktvoll still zu bleiben (nein, nicht wegen des Stammbaums des Transceivers). <br><br>  Wir holten tief Luft und vergruben uns in Hardware-Spezifikationen.  Es stellte sich heraus, dass die Antwort die ganze Zeit vor unseren Augen lag: <i><b>ixgbe Busgeschwindigkeit = 5,0 Gbit / s und PCIe-Fahrspurbreite = 8.</b></i> Dies ist ein Problem mit der Karte.  Ihr selbst fehlt die PCIe-Geschwindigkeit.  Unser Citrix hat die maximale Leistung des PCI-e-Steckplatzes für eine Karte mit Transceivern von <i><b>5,0 Gbit / s,</b></i> die er uns die ganze Zeit gerufen hat.  Wie Citrix auf MPX8015 (es ist genau das gleiche in der Hardware!) Sie wollten 15 Gigabit ausgeben, es ist nicht klar.  Aber wir haben verstanden, warum solche "coolen" Balancer die ganze Zeit in einem Lagerhaus lagen.  Sie können mit 10G-Links im Prinzip nicht richtig funktionieren. <br><br><h4>  Die letzte Erfahrung.  Wir verwenden das richtige Eisen und machen es schön </h4><br>  Hier endete unsere Geduld mit unserem Vertrauen in die Menschlichkeit, und wir mussten die "Ersatz" -Technologie verwenden, um die normale Hardware in Form des HP ProLiant DL360 G9 aus den obigen Fotos zu erhalten.  Sie haben keine Überraschungen für uns arrangiert, sie laden 10G herunter und beschweren sich nicht.  :) :) <br><br><h2>  Lasttest </h2><br>  Da wir den Hujak-Hujak-and-Production-Ansatz nicht akzeptieren und aus Erfahrung wissen, dass ein nicht getestetes System nach der Montage mit einer fast 100% igen Garantie nicht funktionsfähig ist, haben wir beschlossen, Lasttests durchzuführen.  Darüber hinaus können Sie mit seiner Hilfe einige Optimierungen für die Zukunft vornehmen. <br><br>  Um die Last zu erzeugen, wurde das übliche Werkzeug gewählt - Apache Jmetr.  Es allein ist ziemlich gut, da ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vor ein</a> paar Artikeln geschrieben habe, und dies ist eine der flexibelsten Lösungen auf dem Markt, obwohl Java gerne isst.  Für die Arbeit mit S3 haben wir ein selbstgeschriebenes Modul mit dem AWS SDK verwendet, ebenfalls in Java.  In den Tests konnten wir eine Geschwindigkeit von 12,5 Gbit / s für das Schreiben von Dateien über 250 Megabyte bei parallelem Laden durch Blöcke von 5 Megabyte und für Dateien von weniger als 5 Megabyte erreichen - bei der Verarbeitung von etwa 3000 HTTP-Anforderungen pro Sekunde.  Wenn beide Tests parallel ausgeführt wurden, stellte sich heraus, dass etwa 11 Gigabit und 2200 Anforderungen pro Sekunde erforderlich waren.  Gleichzeitig besteht die Möglichkeit, die Arbeit mit einer gemischten Last und mit kleinen Gegenständen zu verbessern.  Wir haben in der CPU "vergraben" und der zweite Sockel ist frei.  Auf dem Lastgenerator wurden Testdateien aus dem RAM entnommen, um den Einfluss auf die Ergebnisse des Platten-Subsystems des Generators selbst auszuschließen.  Für Tests haben wir den HP DL980 g7-Server als Generator verwendet, um uns an die Liebe zu Java für RAM und die Notwendigkeit zu erinnern, beim parallelen Laden mit einer großen Anzahl von Threads zu arbeiten.  Dies ist ein Server mit acht Einheiten, 8 Intel E7-4870-Prozessoren und 512 GB RAM an Bord. <br><br>  Innerhalb des Teams blieb ihm der liebevolle Spitzname Behemoth erhalten. <br><br><img src="https://habrastorage.org/webt/yl/ef/wb/ylefwbgvc4ypecxwot1jtcr7yrc.png"><br>  <i>14. Unser Nilpferd.</i>  <i>Stimmt etwas Ähnliches?</i> <br><br><img src="https://habrastorage.org/webt/b8/ql/an/b8qlan70ud31dkucw7dt252sbxi.png"><br>  <i>15. Rückansicht.</i>  <i>Die beängstigenden Kabel in der unteren Mitte sind eine Querverbindung des internen Brückenbusses</i> <br><br><img src="https://habrastorage.org/webt/6c/xe/ni/6cxeniwbbzfcuh7e06brn-ko7pe.png"><br>  <i>16. Dies ist eines der beiden Serverziele.</i>  <i>Jeder hat 4 Prozessoren und 16 Steckplätze mit 16 Gigabyte RAM</i> <br><br><img src="https://habrastorage.org/webt/wx/vt/p9/wxvtp91ap3cdeu0y0kmn9komqwo.png"><br>  <i>17. Um Htop bequem in der Konsole eines solchen Servers verwenden zu können, benötigen Sie einen großen Monitor :)</i> <br><br>  In der Praxis hat ein gemischter Test sogar einen so leistungsstarken Server spürbar belastet. <br>  Um zu den erzielten Leistungsergebnissen zu gelangen, mussten wir das interne Netzwerk des Clusters auf 9k Jumbo-Frames übertragen und den Netzwerkstapel aus Balancern und Arbeitsknoten (wir verwenden CentOS Linux) leicht optimieren sowie eine Reihe anderer Kernelparameter auf Arbeitsknoten optimieren: <br><br><pre> <code class="hljs dos">cat /etc/sysctl.conf … kernel.printk = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> read_ahead_kb = <span class="hljs-number"><span class="hljs-number">1024</span></span> write_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> read_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> fifo_batch = <span class="hljs-number"><span class="hljs-number">128</span></span> front_merges = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.somaxconn = <span class="hljs-number"><span class="hljs-number">5120</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.netdev_max_backlog = <span class="hljs-number"><span class="hljs-number">50000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_tw_reuse = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_rmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">87380</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_wmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_slow_start_after_idle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_syn_backlog = <span class="hljs-number"><span class="hljs-number">30000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_tw_buckets = <span class="hljs-number"><span class="hljs-number">2000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fs</span></span>.file-max = <span class="hljs-number"><span class="hljs-number">196608</span></span> vm.overcommit_memory = <span class="hljs-number"><span class="hljs-number">1</span></span> vm.overcommit_ratio = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.max_map_count = <span class="hljs-number"><span class="hljs-number">65536</span></span> vm.dirty_ratio = <span class="hljs-number"><span class="hljs-number">40</span></span> vm.dirty_background_ratio = <span class="hljs-number"><span class="hljs-number">5</span></span> vm.dirty_expire_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.dirty_writeback_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_fin_timeout=<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_congestion_control=htcp <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.netfilter.ip_conntrack_max=<span class="hljs-number"><span class="hljs-number">1048576</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.ip_local_port_range=<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">65535</span></span></code> </pre> <br><br>  Die wichtigsten Einstellungen, die optimiert wurden, sind die Größe der Puffer, die Anzahl der Netzwerkverbindungen, die Anzahl der Verbindungen zum Port und die von Firewalls überwachten Verbindungen sowie Zeitüberschreitungen. <br><br>  <b>Cisco C3750 + LACP = Schmerz</b> <br>  Ein weiterer Nachteil der Netzwerkleistung ist der Lastausgleich bei Verwendung von LACP / LAGp.  Leider kann der Cisco 3750 die Last nicht über Ports verteilen, sondern nur an Quell- und Zieladressen.  Um den richtigen Verkehrsausgleich zu erreichen, musste ich 12 IP-Adressen an die Bond-Schnittstellen der Arbeitsknoten hängen und auf die Clients "schauen".  Bedingt 3 für jede physische Verbindung.  Mit dieser Konfiguration war es möglich, auf LACP auf den „externen“ Schnittstellen der Arbeitsknoten zu verzichten, da alle Adressen in der Nginx-Konfiguration angegeben sind. Wenn jedoch die Verbindung verloren geht, wird das Gewicht des Knotens beim Ausgleich automatisch reduziert.  Mit dem "Dump" können Sie über die LACP-Verbindung den vollständigen Zugriff auf alle Adressen aufrechterhalten. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2390824140</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">frame</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:947068357</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">carrier</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">collisions</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">txqueuelen</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18794424755066</span></span> (17<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TiB</span></span>)  <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:246433289523</span></span> (229<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">GiB</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XXMask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span></code> </pre> <br><br><br><h2>  Funktionsprüfung </h2><br>  Nachdem wir die Arbeit am Repository beendet hatten, trafen wir uns mit dem Dienst flexify.io.  Sie erleichtern die Migration zwischen verschiedenen Objektspeichern.  Um jedoch ein Flexify-Partner zu werden, müssen Sie ernsthafte Tests bestehen.  "Warum nicht?"  - Wir dachten.  Tests von Drittanbietern sind immer eine lohnende Erfahrung. <br><br>  Die Hauptaufgabe der Tests besteht darin, die Funktionsweise der S3-Protokollmethoden über ihre Proxys in Bezug auf verschiedene Konfigurationen zu überprüfen, unter denen sich jeder Satz von S3-kompatiblen Buckets befinden kann, die vom Dienstanbieter unterstützt werden. <br><br>  Zunächst werden Methoden überprüft, die mit Objekten im Bucket arbeiten.  Unser Speicher wurde unter Verwendung einer Vielzahl von Testdaten getestet. Das Verhalten der Methoden wurde für Objekte unterschiedlicher Größe und Inhalt sowie für Schlüssel getestet, die alle Arten von Kombinationen von Unicode-Zeichen enthalten. <br><br>  In negativen Tests haben sie versucht, ungültige Daten zu übertragen, wo immer dies möglich war.  Besonderes Augenmerk wurde dabei auf die Sicherheit der Daten gelegt. <br><br>  Methoden, die mit Eimern arbeiten, wurden ebenfalls getestet, jedoch hauptsächlich in positiven Szenarien.  Ziel dieser Tests war es zu überprüfen, ob die Verwendung von Methoden über einen Proxy keine ernsthaften Probleme mit sich bringt, z. B. Datenkorruption oder Abstürze. <br><br>  Die Breite der Abdeckung kann anhand der Tests beurteilt werden, die sowohl über Proxies als auch direkt durchgeführt wurden.  Die meisten Tests, insbesondere diejenigen, die mit Objekten arbeiten, sind parametrisiert und testen eine große Anzahl verschiedener Objekte, Bereiche usw. <br><br><div class="spoiler">  <b class="spoiler_title">Implementierte Tests für Objekte</b> <div class="spoiler_text">  <i>GET Objektanforderung ohne optionale Parameter</i> <i><br></i>  <i>GET Objektanforderungs-Multithread</i> <i><br></i>  <i>GET-Objektanforderung an ein verschlüsseltes Objekt mit den angegebenen sse-Parametern</i> <i><br></i>  <i>GET-Objektanforderung an ein verschlüsseltes Objekt ohne angegebene sse-Parameter</i> <i><br></i>  <i>GET-Objektanforderung mit einem Bereich, der den Bytebereich der Datei schneidet</i> <i><br></i>  <i>GET Objektanforderung mit einem Bereich außerhalb des Bereichs des Bytebereichs der Datei</i> <i><br></i>  <i>GET Objektanforderung mit einem Suffixbereichsparameter</i> <i><br></i>  <i>GET-Objektanforderung mit einem Suffixbereichsparameter außerhalb des Bereichs des Bytebereichs der Datei</i> <i><br></i>  <i>GET Objektanforderung mit ungültigem Bereichsparameter</i> <i><br></i>  <i>Kopfobjektanforderung an ein vorhandenes Objekt</i> <i><br></i>  <i>Kopfobjektanforderung an ein kürzlich gelöschtes Objekt</i> <i><br></i>  <i>Kopfobjektanforderung mit einem Schlüssel, der in einem Bucket nie vorhanden war</i> <i><br></i>  <i>Kopfobjektanforderung an ein verschlüsseltes Objekt mit den angegebenen sse-Parametern</i> <i><br></i>  <i>Kopfobjektanforderung an ein verschlüsseltes Objekt ohne angegebene sse-Parameter</i> <i><br></i>  <i>Objektanforderung auflisten</i> <i><br></i>  <i>List Objects v2-Anforderung</i> <i><br></i>  <i>Listenobjektanforderung mit dem angegebenen Marker-Parameter</i> <i><br></i>  <i>Listenobjektanforderung mit angegebenem Präfixparameter</i> <i><br></i>  <i>Listenobjektanforderung mit den angegebenen Markierungs- und Präfixparametern</i> <i><br></i>  <i>Empfangen Sie alle Objekte auf dem Endpunkt mit Listenobjekten mit den angegebenen Markierungs- und Präfixparametern</i> <i><br></i>  <i>Listenobjektanforderung mit übersprungenem Begrenzerparameter</i> <i><br></i>  <i>Listenobjektanforderung mit übergebenem Marker-Parameter, jedoch mit übersprungenem Delimiter-Parameter</i> <i><br></i>  <i>Listenobjektanforderung mit übergebenem nicht vorhandenem Präfix</i> <i><br></i>  <i>Listenobjektanforderung mit übergebenem nicht vorhandenem Marker</i> <i><br></i>  <i>Mehrteiliger Upload mit der nativen Methode upload_file ()</i> <i><br></i>  <i>Mehrteiliger Upload mit der nativen Methode upload_fileobj ()</i> <i><br></i>  <i>Mehrteiliger Upload mit benutzerdefinierter Methode</i> <i><br></i>  <i>Stoppen des mehrteiligen Uploads mit der Methode abort_multipart_upload ()</i> <i><br></i>  <i>Durchführen der Methode abort_multipart_upload () mit falscher uploadId</i> <i><br></i>  <i>Durchführen der Methode abort_multipart_upload () mit falschem Schlüssel und falscher uploadId</i> <i><br></i>  <i>Mehrteiliger Upload von 2 Dateien mit demselben Schlüssel gleichzeitig.</i>  <i>2. Datei vor dem 1. hochgeladen</i> <i><br></i>  <i>Mehrteiliger Upload von 2 Dateien mit demselben Schlüssel gleichzeitig.</i>  <i>1. Datei vor dem 2. hochgeladen</i> <i><br></i>  <i>Mehrteiliges Hochladen von 2 Dateien mit unterschiedlichen Schlüsseln gleichzeitig.</i>  <i>1. Datei vor dem 2. hochgeladen</i> <i><br></i>  <i>Mehrteiliger Upload mit einer Teilegröße von 512 KB</i> <i><br></i>  <i>Mehrteiliger Upload mit einer Teilegröße, die größer als die maximal zulässige Größe ist</i> <i><br></i>  <i>Mehrteiliger Upload einer Datei mit Teilen unterschiedlicher Größe</i> <i><br></i>  <i>Mehrteilige Upload-Anfrage auflisten</i> <i><br></i>  <i>ACL-Anforderung für PUT-Objekt an ein Objekt mit der angegebenen Berechtigungsnachweis-ID</i> <i><br></i>  <i>GET Object ACL-Anforderung an ein Objekt mit gewährten zusätzlichen Zugriffsberechtigungen</i> <i><br></i>  <i>PUT Object Tagging-Methode</i> <i><br></i>  <i>GET Object Tagging-Methode</i> <i><br></i>  <i>DELETE Object Tagging-Methode</i> <i><br></i>  <i>PUT-Objektanforderung ohne optionale Parameter</i> <i><br></i>  <i>PUT-Objekt fordert Multithread an</i> <i><br></i>  <i>PUT-Objektanforderungen mit übergebenen optionalen Verschlüsselungsparametern</i> <i><br></i>  <i>PUT-Objektanforderungen mit übergebenem leeren Body-Parameter</i> <i><br></i>  <i>GET-Objekt mit nativer Methode download_file ()</i> <i><br></i>  <i>GET-Objekt mit der nativen Methode download_fileobj ()</i> <i><br></i>  <i>GET-Objekt mit benutzerdefinierter Methode unter Verwendung von Bereichen</i> <i><br></i>  <i>GET-Objekt mit Präfix mit der nativen Methode download_file ()</i> <i><br></i>  <i>GET-Objekt mit Präfix mit der nativen Methode download_fileobj ()</i> <i><br></i>  <i>GET Objekt mit Präfix mit benutzerdefinierter Methode unter Verwendung von Bereichen</i> <i><br></i>  <i>DELETE Objektanforderung an ein vorhandenes Objekt</i> <i><br></i>  <i>DELETE Objektanforderung an ein nicht vorhandenes Objekt</i> <i><br></i>  <i>DELETE-Objektanforderung an eine Gruppe mit vorhandenen Objekten</i> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Realisierte Tests für Eimer</b> <div class="spoiler_text">  <i>Setzen Sie die Bucket-Verschlüsselung ein</i> <i><br></i>  <i>GET Bucket-Verschlüsselung</i> <i><br></i>  <i>Bucket-Verschlüsselung LÖSCHEN</i> <i><br></i>  <i>PUT-Bucket-Richtlinienanforderung</i> <i><br></i>  <i>GET Bucket Policy-Anforderung an einen Bucket mit Policy</i> <i><br></i>  <i>DELETE Bucket Policy-Anforderung an einen Bucket mit Policy</i> <i><br></i>  <i>GET Bucket-Richtlinienanforderung an einen Bucket ohne Richtlinie</i> <i><br></i>  <i>Löschen der Bucket-Richtlinienanforderung an einen Bucket ohne Richtlinie</i> <i><br></i>  <i>Setzen Sie die Eimerkennzeichnung</i> <i><br></i>  <i>Holen Sie sich Bucket Tagging</i> <i><br></i>  <i>Eimer-Markierung LÖSCHEN</i> <i><br></i>  <i>Erstellen Sie eine Bucket-Anfrage mit dem vorhandenen Bucket-Namen</i> <i><br></i>  <i>Erstellen Sie eine Bucket-Anfrage mit einem eindeutigen Bucket-Namen</i> <i><br></i>  <i>Bucket-Anfrage mit vorhandenem Bucket-Namen löschen</i> <i><br></i>  <i>Löschen Sie die Bucket-Anfrage mit dem eindeutigen Bucket-Namen</i> <i><br></i>  <i>ACL-Anforderung für PUT-Bucket an einen Bucket mit der angegebenen ID des Berechtigten</i> <i><br></i>  <i>GET Object ACL-Anforderung an ein Objekt mit gewährten zusätzlichen Zugriffsberechtigungen</i> <br></div></div><br><br>  Wie Sie vielleicht erraten haben, ist dies ein ziemlich harter Test, aber wir haben ihn im Allgemeinen positiv bestanden.  Einige Probleme ergaben sich aus der mangelnden Unterstützung für SSE und kleine Schulen mit Unicode-Unterstützung zu diesem Zeitpunkt: <br><br>  Fehler beim Laden mit Schlüsseln, die Folgendes enthalten: <br><br><ul><li>  U + 0000-U + 001F - die ersten 32 unlesbaren Steuerzeichen.  Bei Amazon wird beispielsweise nur das erste U + 0000 nicht direkt gegossen. <br></li></ul><br><ul><li>  Und auch U + 18D7C, U + 18DA8, U + 18DB4, U + 18DBA, U + 18DC4, U + 18DCE.  Dies sind ebenfalls unlesbare Zeichen, aber Amazon akzeptiert sie als Schlüssel.  Es gab keine Probleme mit allen anderen Charakteren. <br></li></ul><br>  Beim Lesen des Bucket-Inhalts tritt ein Problem mit dem 66.675-Schlüssel auf, der das Symbol U + FFFE enthält.  Es ist nicht möglich, eine vollständige Liste der Schlüssel in einem Bucket zu erhalten, der ein Objekt mit einem solchen Schlüssel enthält. <br><br>  Ansonsten waren die Tests erfolgreich und Ende September erschienen wir in der Liste der verfügbaren Lieferanten! <br><br><h2>  Ein kurzes Nachwort und ein Bonus für die Leser </h2><br>  Zuvor habe ich geschrieben, dass Cloudian HyperStore trotz seiner vielen Vorteile im russischsprachigen Segment des Internets praktisch nicht behandelt wird. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der erste Artikel</a> befasste sich mit den Grundlagen der Arbeit mit Cloudian.  Wir haben die interne Struktur und die architektonischen Nuancen zerlegt und die Übersetzung der offiziellen Dokumentation gelesen. <br><br>  Heute habe ich erzählt, wie wir unser eigenes Lager gebaut haben und auf welche Nuancen und Fallstricke wir gestoßen sind. <br><br>  Diejenigen unter Ihnen, die mit Stiften fühlen möchten, worüber wir in zwei Artikeln hintereinander sprechen, können das Feedback-Formular <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf dieser Seite verwenden</a> und persönlich herausfinden, was das Salz ist.  Standardmäßig geben wir 15 GB für 2 Wochen kostenlos, natürlich mit Benutzerzugriff.  Wenn Sie Ihre Eindrücke von der Arbeit mit dem Repository teilen möchten, schreiben Sie mir in PM.  :) :) <br><br>  Und für diejenigen, die nicht genug 15 GB für 2 Wochen sind, haben wir eine <b>kleine Suche!</b>  Auf den Fotos im Artikel haben wir drei Flusspferde platziert.  Die ersten 50 Personen, die sie finden, erhalten 4 Wochen lang 30 GB.  Um einen vergrößerten Test zu erhalten, schreiben Sie in die Kommentare die Nummern der Bilder, auf denen sich die Flusspferde versteckt haben, und beantragen Sie den obigen Link.  Vergessen Sie nicht, einen Link zu Ihrem Kommentar in die Anwendung aufzunehmen. <br><br>  Wenn Sie Fragen haben, stellen Sie diese traditionell in den Kommentaren. <br>  Ich werde sie gerne beantworten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de425973/">https://habr.com/ru/post/de425973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de425963/index.html">Wetterstation auf Arduino von A bis Z. Teil 4</a></li>
<li><a href="../de425965/index.html">SAP Data Management Suite als Komplex für die Arbeit mit Big Data in Unternehmen</a></li>
<li><a href="../de425967/index.html">Kettensägen-Silizium-Massaker</a></li>
<li><a href="../de425969/index.html">Wie werde ich Webentwickler ... und werde ich?</a></li>
<li><a href="../de425971/index.html">Es gibt Hinweise auf das Vorhandensein von Spionagechips in Supermicro-Servern</a></li>
<li><a href="../de425975/index.html">Konvertieren Sie Wörter und Phrasen in Anagramme</a></li>
<li><a href="../de425977/index.html">Flexbox: Wie groß ist diese flexible Box?</a></li>
<li><a href="../de425981/index.html">Newbies Karriere bei LK: Springt und springt langsam vorwärts</a></li>
<li><a href="../de425983/index.html">Flugsicherheit</a></li>
<li><a href="../de425985/index.html">Benutzerdefinierte Codeausführung auf GO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>