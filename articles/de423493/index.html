<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍💻 🤾🏼 👇🏻 Android Go ist die zukünftige Milliarde Geräte und ein Limit von 50 MB. Yandex Vortrag 👩🏾‍🌾 🥉 🤴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neue Wege für die Entwicklung einer bereits bekannten Plattform - es ist immer interessant. Einerseits erweitern Sie den Kundenstamm, andererseits inv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android Go ist die zukünftige Milliarde Geräte und ein Limit von 50 MB. Yandex Vortrag</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/423493/">  Neue Wege für die Entwicklung einer bereits bekannten Plattform - es ist immer interessant.  Einerseits erweitern Sie den Kundenstamm, andererseits investieren Sie nicht in die Erstellung von Software von Grund auf neu, sondern nutzen vorhandene Entwicklungen.  Aber wenn die Richtung wirklich neu ist, mit ihren eigenen Besonderheiten, dann wird es nicht möglich sein, mit sehr wenig Blut auszukommen.  Beim nächsten Treffen der Mosdroid-Community in unserem Büro sprach der Entwickler Arthur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Vasilov Arturka</a> über die Anpassung der Yandex-Anwendung an das Android Go-System. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VYcLRPoA4Bk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><blockquote>  Wenn Sie keinen Taschenrechner, keinen Wecker usw. schreiben, sind Sie im Durchschnitt entweder sehr cool, gut gemacht und haben alles gut gemacht, oder Ihre Anwendung benötigt 150 bis 170 Megabyte. </blockquote><br><a name="habracut"></a>  - Mein Name ist Arthur, ich bin ein Android-Entwickler und arbeite an der Yandex-Anwendung.  Heute werde ich Ihnen eine Geschichte darüber erzählen, wie wir uns an Android Go angepasst haben.  Ich werde Ihnen sagen, auf welche Art von Rechen wir gestoßen sind, was für uns nicht funktioniert hat und wie alles funktioniert, warum es benötigt wird. <br><br>  Ein kleiner Exkurs darüber, worum es geht.  Android Go ist eine spezielle Version von Android für kostengünstige Geräte.  Sie kosten 60-100 Dollar und sind daher sehr schwach, langsam und verlangsamt.  Deshalb hat Google beschlossen, ein eigenes System zu erstellen, damit sie zumindest irgendwie normal funktionieren.  Es wurde 2017 bei Google I / O angekündigt, dh ein Jahr und mehrere Monate sind vergangen.  Als der Mitap angekündigt wurde, wurde daher eine logische Frage aufgeworfen: "Lebst du noch oder was?"  Ich sagte dann, dass alles in Ordnung ist, alles in Ordnung ist, werde ich sagen.  Und jetzt, als typischer Internet-Held, werde ich nachträglich antworten, warum es passiert ist. <br><br><img src="https://habrastorage.org/webt/h2/qw/6g/h2qw6gttth_hx-niydwklvvcb8u.jpeg"><br>  Was genau ist passiert?  Google sagte: "Wir machen ein solches System."  Dann sagte er: "Okay, wir brauchen Zeit, um fertig zu werden" und das alles.  Danach haben Anbieter immer eine gewisse Verzögerung bei der Anpassung dieser Version für sich.  Und die neue Version bei uns wird bereits frühestens ein Jahr später veröffentlicht, daher gibt es hier nichts Überraschendes.  Außerdem mussten sie sich entscheiden, ob sie so etwas tun sollten: Sie sprechen von billigen Geräten, und es ist nicht klar, ob sie davon profitieren werden oder nicht.  Darüber hinaus muss dieses Gerät neu sein, es muss gemacht werden, lernen, wie man verkauft, verstehen, wie es funktionieren wird. <br><br>  Das erste Smartphone mit Android Go erschien vor nicht allzu langer Zeit.  Irgendwann im April begannen die Verkäufe wahrscheinlich oder vielleicht im Mai.  Dies ist Nokia 1, es wird überall verkauft.  Ich liege hier herum.  Meiner Meinung nach gibt es derzeit nur neun solcher Smartphones auf dem Markt, aber bis Ende des Jahres versprechen sie mehr als hundert.  Und im Prinzip hat keiner der großen Player wie Huawei, Samsung und andere sein Wort gesagt, also werden sie noch etwas hinzufügen, sie werden sich nicht von einem so großen Markt fernhalten können. <br><br>  Vor dem Bericht ging ich zur Android Go-Seite und sah, dass sie die Android Pie Go Edition erstellt haben.  Aber sie haben dort nichts getan, sie haben einfach die Anzahl der installierten Anwendungen und ihr Gewicht im Voraus reduziert.  Sie sagten: "Sie haben jetzt doppelt so viel freien Speicherplatz."  Und die Standardausreden: Fehlerbehebung, Leistungsverbesserung, alles.  Aber zumindest haben sie angerufen, was bedeutet, dass sie nicht vergessen haben. <br><br>  Was sind speziell die Einschränkungen dieser Geräte?  Erstens haben sie 512 Megabyte oder 1 Gigabyte RAM, 8 oder 16 Gigabyte Speicher.  Es ist klar, dass sie unter solchen Bedingungen extrem gehemmt sind und alle normalen Anwendungen auf ihnen ungefähr auf die gleiche Weise funktionieren.  Damit Anwendungen mit minimaler Angemessenheit funktionieren, sagte Google: "Lassen Sie uns die folgenden Anforderungen einführen."  Sie sind ziemlich logisch, folgen Sie dem, was auf der vorherigen Folie war. <br><br><img src="https://habrastorage.org/webt/ci/xm/ht/cixmhtwrdwbu_gkczbo0vk3-k8e.jpeg"><br><br>  Zuallererst ist es abstrakt gute Leistung.  Ihre Anwendung sollte auf einem solchen Gerät gut und schnell ausgeführt werden können.  Wir sind: „Großartig.  Wir arbeiten. “ <br><br>  Darüber hinaus gibt es bereits bestimmte Zahlen, denen wir entsprechen müssen.  Der belegte Speicherplatz nach dem Auspacken und Installieren des APK beträgt nicht mehr als 40 Megabyte.  Manchmal ist dies ein Problem, weil jemand und die APK alle 80 Megabyte wiegen.  Es wird weh tun.  Darüber hinaus kann dies nicht angemessen erfasst und gemessen werden.  Das heißt, Sie können nicht sagen: "Ich weiß, dass meine APK so viel wiegt, sodass die Anwendung nach der Installation so viel kostet."  All dies hängt sehr stark vom Hersteller, der Version des Geräts, Android usw. ab. Wenn Ihre APK jedoch 10 Megabyte benötigt, ist im Prinzip alles in Ordnung und Sie werden diese Anzahl niemals überschreiten. <br><br>  Und jetzt die unterhaltsamste und coolste Anforderung: Der verbrauchte Arbeitsspeicher während der Arbeit mit der Anwendung sollte 50 Megabyte nicht überschreiten. <br><br>  Wer weiß, wie viel RAM seine Anwendung während des Betriebs durchschnittlich benötigt?  Wer hat sich jemals über dieses Problem gewundert?  Gibt es jemanden mit weniger als 100 Megabyte?  Schön.  Aber vielleicht lügst du.  Wenn Sie im Durchschnitt keinen Taschenrechner, keinen Wecker usw. schreiben, sind Sie entweder sehr cool, gut gemacht und haben alles gut gemacht, oder Ihre Anwendung benötigt 150-170 Megabyte.  Es ist sehr schwierig, es auf 50 Megabyte zu bringen.  Daher werden wir den Rest der Zeit darüber sprechen, wie man den Globus in eine Eule verwandelt usw. <br><br><img src="https://habrastorage.org/webt/6k/el/g1/6kelg1qxjmzqgltficsia2dk1p0.jpeg"><br>  Was beinhaltet unser Erinnerungsgespräch?  Es ist direkt notwendig zu verstehen, was genau wir messen und wie es am besten gemessen werden kann.  Auch für Android Go-Geräte gibt es eine Besonderheit, die berücksichtigt werden muss, und wir werden auch darüber sprechen.  Und ich werde Ihnen auch einige allgemeine Dinge erzählen, allgemeine Tipps, die Sie vielleicht nicht erraten haben, die aber wirklich viel Gedächtnis von Ihnen essen können. <br><br>  Im Jahr 2018, nachdem Google I / O durchlaufen wurde, müssen Sie die Geschichte über das Gedächtnis mit einem Verweis auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen Bericht beginnen</a> .  Wer hat es gesehen? <br><br>  Großartig.  Alle verbleibenden 180 Personen wissen, was in naher Zukunft zu tun ist.  Meiner Meinung nach ist dies einer der besten Berichte bei Google I / O.  Dude sagte unglaublich coole Dinge.  Er erzählte alles in den Regalen, gut und mit vielen tiefen Details.  Diejenigen, die es gesehen haben und sich gut daran erinnern, werden wahrscheinlich bemerken, dass ich einige Dinge von dort kopiert habe, weil es sonst unmöglich ist, er hat alles erzählt, also werde ich es wiederholen. <br><br>  Was messen wir?  Es gab so etwas wie PSS (Proportional Set Size).  Das heißt, der RAM in Android wird durch etwa 40-Kilobyte-Blöcke dargestellt, und diese Blöcke können entweder vollständig zur Anwendung gehören oder zwischen Prozessen und Anwendungen stöbern. <br><br>  Und die Frage ist: Wie genau kann man verstehen, auf welche Anwendung dieser gemeinsame Speicher bezogen werden soll?  Es gibt verschiedene Ansätze, sie sind ziemlich logisch.  PSS sagt, wenn Speicher zwischen N Prozessen fummelt, gehen wir davon aus, dass Ihre Anwendung 1 / N dieses Speichers besitzt.  Und genau so gibt es die Residential Set Size und die Unique Set Size, die besagen, dass „keiner der gemeinsam genutzten Speicher mir gehört“ und „Alles gehört“.  Im Prinzip ist PSS hier am logischsten. <br><br>  Wie genau können Sie den verbrauchten Speicher messen?  Hier ist alles einfach.  Entweder ist es ein Profiler in Android Studio oder es ist dumpsys.  Es gibt natürlich auch andere Tools.  Sie können Ihnen detailliertere Ergebnisse liefern, etwas komplizierteres, aber das Problem ist, dass es sehr, sehr schwierig ist, ihre Ergebnisse zu verstehen und sie alle zu verwenden.  Oft benötigen Sie entweder root oder einen benutzerdefinierten Build von Android.  Und im Großen und Ganzen brauchen Sie sie nicht, die ersten beiden Werkzeuge reichen aus. <br><br><img src="https://habrastorage.org/webt/0r/--/pr/0r--prgyak0-hltivshg-dxeuqc.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Ich werde nicht über den Profiler in Android Studio sprechen, ich denke, viele Leute haben ihn verwendet.  Wer nicht benutzt hat, muss unbedingt stupsen.  Insbesondere habe ich den folgenden Link bereitgestellt - nur ein guter Artikel aus der Dokumentation mit Video, wie man es benutzt, mit Demos.  Und im Prinzip ist alles klar.  Es zeigt, wohin Ihr Gedächtnis geht, zeigt es in Echtzeit.  Das Einzige, woran man sich erinnern muss, ist, dass es dennoch bestimmte Fehler auferlegt, die sich aus der Tatsache ergeben, dass wir dieses Gedächtnis ständig messen.  Sie liegen jedoch innerhalb akzeptabler Grenzen. <br><br><img src="https://habrastorage.org/webt/gb/fv/wn/gbfvwnjxm6fcggr66eoyzmcvnni.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Dumpsys ist eine einfache Konsolensache, die nichts von Ihnen erfordert, nur ein verbundenes Telefon und ADB.  Und Sie können diesen Befehl ausführen: Rufen Sie dumpsys meminfo auf, übergeben Sie das Paket an es, und es gibt Ihnen so etwas zurück.  Und wenn wir daran interessiert sind, wie viel unsere Anwendung verbraucht, können wir uns speziell TOTAL ansehen, das besagt, dass "Ihre Anwendung ungefähr 168 Megabyte verbraucht".  Viel, aber was tun? <br><br><img src="https://habrastorage.org/webt/lm/yo/xw/lmyoxwiahsbeey_ru-3zvdtd8y0.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Es zeigt Ihnen auch eine genaue Aufschlüsselung, wie viel Speicher in diesem Speicher benötigt wird.  Es gibt hier verschiedene Abschnitte, sie sind komplex, wir werden weiter darüber sprechen, aber jetzt können wir die Hauptsache bemerken - dies sind Java Heap, unsere Java-Objekte, und alles weitere ist komplizierter. <br><br>  Was ist sonst noch wichtig?  Das Gedächtnis ist eine sehr empfindliche Sache für alle Arten von Tests und alle Arten von äußeren Bedingungen.  Das heißt, alle Tests müssen Sie so oft wie möglich unter den gleichen Bedingungen durchführen.  Es ist klar, dass dies idealerweise ein Gerät sein sollte, da der Speicher von der Version von Android abhängt.  Es reicht aus, sich an die Unterschiede zwischen den Vieren und Fünfern zu erinnern.  Dies hängt von der Größe oder Auflösung des Bildschirms ab. Je größer der Bildschirm, desto mehr Inhalte werden eingebrochen, desto mehr Speicher wird benötigt, um alles zu zeichnen.  Je größer die Auflösung, desto mehr Pixel belegt Ihre Bitmap und desto mehr Speicher wird zum Speichern benötigt. <br><br>  Das Anwendungsszenario wirkt sich auch auf die Tests aus.  Sie können den Text lesen oder mit einer Reihe von Bildern durch die Galerie scrollen.  Und es ist klar, wo es mehr Speicher geben wird. <br><br>  Ein weiterer wichtiger Punkt ist die Belastung des Geräts.  Das heißt, Sie können alles gleich haben, aber in einem Fall ist Ihre Anwendung die einzige, die für Sie funktioniert, und in dem anderen Fall haben Sie eine Reihe von Anwendungen, die etwas im Hintergrund tun, etwas herunterladen, löschen, im Vordergrund arbeiten Gleichzeitig wird Ihr Speicher einfach gelöscht, da Sie ihn anderen Anwendungen zur Verfügung stellen müssen.  Daher ist es im Idealfall besser, alle anderen funktionierenden Anwendungen zu übernehmen und zuerst zu beenden, nicht Ihre.  Alles, was Sie erreichen und dann töten können.  Nur in diesem Fall, und PSS wird es Ihnen auf jeden Fall danken, da es nicht erforderlich ist, den Speicher zwischen den Prozessen zu durchsuchen. <br><br><img src="https://habrastorage.org/webt/lm/yo/xw/lmyoxwiahsbeey_ru-3zvdtd8y0.jpeg"><br>  Sie können beispielsweise die aktuellen Informationen zum freien Speicherplatz und zum belegten Speicher abrufen und anzeigen.  Er wird Ihnen so etwas wie ein Schild bringen, auf dem steht: "Hier habe ich so viel freien Speicher, so viel zwischengespeicherten Speicher, so viel belegten Speicher."  Und wenn Sie 200-250 Megabyte freien Speicher für Ihre Geliebte dort haben, dann ist dies wahrscheinlich gut, dann wird nichts Ihre Tests beeinflussen. <br><br>  Vielleicht hat jetzt jemand die Frage "Warum brauche ich das alles?"  Dies ist so ein Breaker, in dem ich zusätzlich die Motivation für all das sagen werde. <br><br>  Erstens, selbst wenn Sie unter Android Go jetzt nichts unternehmen und denken, dass es tot ist, kann es sich durchaus entwickeln, zu Ihnen kommen, und irgendwann müssen Sie sich mit all dem befassen. <br><br>  Das zweite, was ich für sehr wichtig halte, ist, dass Sie nur Regressionstests aus dem Gedächtnis durchführen können.  Das heißt, Sie können einfach ein Skript schreiben, das die Anwendung ausführt, dumpsys ausführt, solche Messungen durchführt und beobachtet, wie sich diese Indikatoren zwischen den Releases ändern.  Ein solches Skript kann in ein paar Stunden geschrieben werden, die Infrastruktur kann für eine längere Zeit konfiguriert werden, aber es scheint mir, dass dies eine gute Sache ist. <br><br>  Wenn wir über die Besonderheiten von Android Go sprechen - unseren dritten Punkt im Kampf gegen das Gedächtnis - dann gibt es einige gute Neuigkeiten.  Erstens verlangt niemand wirklich, dass Sie diese Einschränkungen befolgen.  Das heißt, Sie können die Anwendung so verwenden, wie sie ist, sie mit Android Go auf das Gerät stellen und alles ist in Ordnung.  Das Problem ist, dass der Benutzer Sie sehr wahrscheinlich entfernt, weil Sie viel Platz beanspruchen.  Auch Ihre Anwendung läuft möglicherweise langsam und hat eine Menge Speicher, ja.  Aber bisher hat es niemand verboten, denn sonst hätte es auf Android Go keine andere Anwendung als Google Apps gegeben.  Aber wenn sich dieses Ding weiterentwickelt, werden sich viele an solche Bedingungen anpassen, und am Ende kann Ihre Anwendung einfach in der Android Go-Ausgabe gesenkt werden oder sagen, wie der Benutzer die Anwendung auf seinem Android Go-Smartphone installiert, sie können ihm Alarm anzeigen : "Alter, die App funktioniert nicht gut mit Android Go.  Vielleicht wirst du es nicht sagen? " <br><br>  Es gibt noch einen weiteren Punkt: Sie können Android Go-Geräte manuell von Google Play ausschließen, dh, die Anwendung kann nicht auf Android Go-Geräten installiert werden.  Es erschien vor nicht allzu langer Zeit. <br><br>  Google ist auch schlau genug, und die 50 Megabyte, die im Titel des Berichts erklangen, sind keine feste Zahl, sondern hängen von der Auflösung des Geräts, der Bildschirmgröße und darüber hinaus von der Art der Anwendung ab.  Zum Beispiel werden Spiele meiner Meinung nach mehr als 115 Megabyte zugewiesen.  Dies ist grundsätzlich verständlich. <br><br><img src="https://habrastorage.org/webt/gu/yj/0s/guyj0sbre79wfwrlzgupt009xn0.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Was ist, wenn wir direkt über diesen Test sprechen?  Es gibt noch einen Punkt, der uns besonders beschäftigt - die Arbeit mit Presets.  Wenn Anbieter ein neues Telefon herstellen, stellen sie häufig einige vorinstallierte Anwendungen bereit.  Insbesondere sind wir sehr daran beteiligt, und das Problem ist, dass dort Dinge wie die Compatibility Test Suite ausgeführt werden.  Dies sind Google-Tests, sie führen sie aus.  Und dort, wenn Ihre Anwendung nicht diesen 50 Megabyte entspricht, ist alles schlecht und Ihre Anwendung kann auf einem solchen Gerät nicht vorinstalliert werden. <br><br>  Leider stammen die Tests, die Google durchführt, nicht aus Open Source. Ich kann ihnen nicht sagen, dass sie unter der NDA stehen, aber gute Entwickler von Google haben einen solchen Artikel über Android Go geschrieben, und dort gibt es im Prinzip Empfehlungen, die gut genug sind <br><br>  Das heißt, alles ist banal.  Wir starten die Anwendung.  Wir warten 5 Sekunden, bis alles geladen ist.  Wir machen dumpsys, schreiben den TOTAL-Wert, führen einige Male aus, wir erhalten das Ergebnis.  Alles ist sehr einfach und alltäglich. <br><br><img src="https://habrastorage.org/webt/zq/ma/de/zqmadexusg3whja0-dsz0d4w7gk.jpeg"><br>  Das einzige ist, dass sie ein so kleines Merkmal in ihrem Artikel nicht berücksichtigt oder vielleicht auch nicht darüber gesprochen haben - es gibt so etwas wie die Arbeit in einem anderen Prozess, und sie tun es oft, um zu kämpfen, einschließlich des Speicherverbrauchs. <br><br>  Wer glaubt, dass dies gut für Android Go ist?  Und wer findet das schlecht?  Tapfer. <br><br><img src="https://habrastorage.org/webt/_c/4p/h5/_c4ph5f7gcnhakefypwspum8d_y.jpeg"><br>  Das Problem ist, dass dies schlecht ist, da am Ende Ihr verbrauchter Anwendungsspeicher über alle Prozesse hinweg gezählt wird.  Wenn wir einen solchen leeren Prozess ohne irgendetwas machen und dumpsys von diesem bestimmten Prozess nehmen, werden wir sehen, dass es 7 Megabyte dauert.  5-8 Megabyte - dies ist ein solcher Aufwand bei der Erstellung des Prozesses.  Wenn wir also um jedes Megabyte kämpfen, um alles auf 50 zu bringen, wird uns so etwas sehr schlecht gegeben.  Nehmen wir insbesondere an, Yandex hat die beliebteste Yandex.Metrica-Bibliothek, sie funktioniert auch in einem anderen Prozess, und dies kann uns auch Schmerzen bereiten. <br><br><img src="https://habrastorage.org/webt/qu/os/fu/quosfu3kccdztjv7cp6ujn4rxhg.jpeg"><br>  Wenn zum Beispiel einige externe Bibliotheken zu Ihnen kommen, können Sie einfach sagen: „Alter, bitte arbeiten Sie im Hauptprozess.  Ich bin damit einverstanden, dass dies zwar langsamer ist, aber keinen unnötigen Speicherplatz verbraucht. “  Das ist also auch ein subtiler Punkt. <br><br><img src="https://habrastorage.org/webt/ci/6b/9c/ci6b9cbpebgounzlbc87xids-xi.jpeg"><br><br>  Wenn wir über den Speicherverbrauch sprechen, gehen wir zu dieser Platte über, die dort ist.  Wir nehmen ein leeres Projekt und führen dieses Dumpsys aus, starten dieses Geschäft und sehen, dass 23 Megabyte von 50 bereits vergeben sind.  Leere "Hallo Welt!"  ohne irgendetwas einfach mit dem text aktivieren.  Es wird ziemlich traurig.  Es wird noch trauriger, wenn wir erkennen, dass wir einen Parameter wie Java Heap direkt beeinflussen können, dh wir können direkt unsere Java-Objekte explizit verfolgen, die wir löschen, reduzieren und zumindest irgendwie interagieren können. <br><br>  Und es ist schwierig, normal mit dieser ganzen Sache zu interagieren, da dies ein beliebiger Framework-Code ist und Sie direkt aus Java einfach keine normalen Tools haben, um zu verstehen, wie all dies verwendet wird.  Aber die gute Nachricht ist, dass wir diese ganze Sache indirekt beeinflussen können, also lassen Sie uns darüber sprechen, was da ist. <br><br><img src="https://habrastorage.org/webt/pa/p_/qp/pap_qprhxuqhr59pnjx8kxrqwos.jpeg"><br>  Was ist Java Heap ist verständlich.  Was Native Heap ist, ist auch ziemlich logisch anzunehmen.  Dies sind die gleichen Zuweisungen, nur positive.  Sie stammen aus dem Framework und aus Ihren nativen Bibliotheken, .so-Dateien und mehr. <br><br>  Code steht in direktem Zusammenhang mit der Codespeicherung.  Dies ist die Größe Ihrer .dex, dies ist Ihre .so, dies sind die Ressourcen, mmap-Dateien und all das.  Das heißt, je weniger Code, desto besser.  Die einfachste Wahrheit, die im Allgemeinen über alles funktioniert. <br><br>  Stapel ist ein Stapel von Java / C ++ - Threads.  Das heißt, jeder Thread hat seinen eigenen Aufrufstapel, sodass jeder Thread einen bestimmten Speicherbereich erstellt, um das Ganze zu speichern. <br><br>  Grafik ist ein UI-Rendering.  Es werden teilweise gespeicherte Bitmaps gezeichnet und was damit verbunden ist. <br><br>  Private andere, System - das ist etwas, das wir überhaupt nicht beeinflussen können, und in der Tat alles andere, was nicht sehr kategorisierbar ist. <br><br><img src="https://habrastorage.org/webt/ut/mv/ft/utmvfteatf-vvzdda5_a8f-iyvi.jpeg"><br><br>  Wenn wir über native Bibliotheken sprechen, nehmen wir an, Sie können eine leere Anwendung verwenden ... Sie können die übliche Anwendung verwenden, die wir haben, und dumpsys daraus entnehmen, um festzustellen, dass 146 Megabyte erforderlich sind.  Und wenn Sie etwas schneiden ... insbesondere habe ich die beiden größten nativen Bibliotheken, die wir insgesamt 15 Megabyte haben, genommen und gesägt und danach Dumpsys genommen. Sie können leicht erkennen, dass wir den Verbrauch aus dem Native Heap und verloren haben vom Code.  Das heißt, mit einer so einfachen Geste haben wir uns etwa 35 Megabyte gespart.  Nicht schlimm genug. <br><br><img src="https://habrastorage.org/webt/zn/9r/9v/zn9r9v35dja5ndfyz4nwinzshys.jpeg"><br><br>  Streams.  Lassen Sie uns den einfachsten Test machen.  Es gibt eine leere Anwendung, und es gibt dieselbe leere Anwendung, in der wir eine Schleife erstellen, die einen neuen Thread () ausführt, fünf Sekunden darin schläft und diesen Thread startet.  Sie können sehen, dass in diesem Fall der Stapel stark aufgefüllt wird.  Das heißt, wir können diese ganze Sache beeinflussen, aber indirekt, indem wir die Anzahl der Threads im Java-Code reduzieren.  Das heißt, durch Java-Objekte, einschließlich der Beeinflussung all dieser Positionen, die sich in anderen Elementen befinden. <br><br><img src="https://habrastorage.org/webt/4i/ed/mo/4iedmo77bys7vs6hv-f65oiuta0.jpeg"><br><br>  Wenn Sie weiterhin über Threads sprechen, können Sie leicht sehen, was Sie für Threads haben und was sie in der Anwendung tun.  Es gibt verschiedene Werkzeuge.  Sie können dieselbe Systrace verwenden. Sie können einfach die Konsole verwenden, um die ID Ihres Prozesses zu ermitteln und ps anhand der Threads im System abzurufen. <br><br>  Wenn Sie gut abschneiden und alle Arten von ThreadFactory verwenden, um Ihre Threads zu benennen, können Sie verstehen, was Sie haben sollten, was nicht, und so das Ganze reduzieren, da es besonders bedeutungslos ist, 100 Threads in der Anwendung zu haben. <br><br>  Was kann man noch tun?  Es gibt eine Reihe bekannter Akkordeon-Tipps: Achten Sie auf Lecks, verwenden Sie Pools, erstellen Sie keine Objekte, wenn Sie dies nicht benötigen, und all dieser Unsinn, all dies gilt.  Großartig. <br><br>  Es besteht eine gute Korrelation zwischen dem Speicherbedarf Ihrer Anwendung und ihrer Größe.  Das heißt, je größer Ihre Anwendung ist, desto mehr Speicher wird verbraucht. Reduzieren Sie also auf einfache Weise das Gewicht der APK, reduzieren Sie das Gewicht von .dex, reduzieren Sie .so, entfernen Sie alles, was entfernt werden kann. <br><br>       . ,      ,     ,    .      ,     ?   —         —    ,      .   ,     ,        .       .   —   . <br><br><img src="https://habrastorage.org/webt/3s/mv/wk/3smvwkzryvrsm1klctrsmnxtx4i.jpeg"><br>    dumpsys,   ,      ,    . ,   ,   View,  WebView,  Assets,    . <br><br><img src="https://habrastorage.org/webt/yd/m_/92/ydm_92wzagxi-1a9zpwzkeqbe8o.jpeg"><br>  ,      , , ,     ,    SharedPreference  SQLite  - , , ,   . <br><br><img src="https://habrastorage.org/webt/1f/fs/ct/1ffsctcvhhohxpwiysekmopqwzk.jpeg"><br><br> , ,      Assets.  ,  ,    – .     1,5 . -,      ,         .    . <br><br><img src="https://habrastorage.org/webt/q5/7g/ki/q57gkiv47412jj1q9_aye3k_4e8.jpeg"><br>    —  WebView.    ,  WebView,   ,  dumpsys,  100 ,  .  , , - ,   ,  300  — .    ,  WebView ,    . -. <br><br><img src="https://habrastorage.org/webt/o9/pj/z8/o9pjz8exyayhtg1varn-wtsmw8i.jpeg"><br><br> Google   .    .      WebView,     Google,    - .     WebView. . <br><br><img src="https://habrastorage.org/webt/nt/lp/-q/ntlp-qwbjnysaljhmmahewkcdeq.jpeg"><br><br>    Google Go,    Android Go-.       ,     - layout    ,      .  ,      ,      ,   Chrome Tabs,  Chrome    .   . <br><br>       Android Go,    ?    ,      Android Go,      . <br><br><img src="https://habrastorage.org/webt/rm/jz/cf/rmjzcfwjkfponuuzuljvu0r088q.jpeg"><br>  Es gibt verschiedene Möglichkeiten. -,      ,    ,       Android Go   .     ,    , .         ,   , ,  - build ,  - ,    ,  - .        APK,       ,  —  uses-feature «low-memory»,      APK. <br><br>       ,     ,      Android Go.   Google. ,  ,  Go-   . <br><br>   ,   ?  ,      ,      -       ,   : «,  -  .   ».           .   ,     ,    ,      ,   ,    - ,      ,  -    .     , ,  ,    ,    Google,    Google     ,      .        ,      ,  ,   Android Go  ,       ,       . <br><br>   ,       ,       ,  -.   . <br><br><img src="https://habrastorage.org/webt/6r/wd/i-/6rwdi-8mzeuwfvvw00dh0nmdf48.jpeg"><br><h5> <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a></sup></sub> </h5><br>       ,    Google I/O:   ,          -    . ,      ,    ,  ,   ,    - ,        .    ,  «       ,      .  ».     .        ,  .    ,  . <br><br>    ? ,      .  —  ,    ,     98% .  ,         , ,    . .       -    Android Go-.  ,  YouTube Go       .    YouTube   , ,  ,   .  .   ,    Android Go    , , ,     —    .     — Facebook Lite, Twitter Lite,   . Lite,      -   . -,  ,      .    Facebook,    .       ,      ,    . ,    —   ,     Android Go. <br><br>    ?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>  Stack Overflow,    1000 .      .  ,    ,    ,     . ,  ,    —  dumpsys. <br><br>      ,  Android    ,   512   ,    Android 4.4.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> API</a>     ,     . <br><br>     ,    .    ,        .   —   ,    . <br><br>     , : « ».  : «».  .  —  ,  .  - 170 .  .  -  .    ?      , ,  ,     ,    - .     -  —   .  105 .  . <br><br><img src="https://habrastorage.org/webt/mv/qk/gj/mvqkgjfuippyzhhhcv0tmkosqzw.jpeg"><br>     .   build-   -.  densitySplit,     , resConfig,       .   ,  ,    — . ProGuard   .  ,  ProGuard  ,     ,  , ,  ,       stacktraces. <br><br>      .     ,      ,      Android Go-       . <br><br>    - 64 .  : «,   ».  14 ,  4 ,  60 .     ,   .  .  ,     .         —    ,  ,  ,     ,    .     , ,  ,     Android Go,    . 10 , APK     ,  , .   ,    ,      . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die beste Lösung ist also die zweite Anwendung. </font><font style="vertical-align: inherit;">Allerdings werden nur wenige Menschen Ressourcen dafür ausgeben, während der tatsächliche Gewinn nicht klar ist. </font><font style="vertical-align: inherit;">Vielleicht wird deine Geschichte nicht so traurig sein, denn ich hätte noch ein wenig Mühe, ich wäre geklettert, aber ich war schon unerträglich. </font><font style="vertical-align: inherit;">Aber so eine Geschichte. </font><font style="vertical-align: inherit;">In diesem relativ positiven Sinne können Sie es wahrscheinlich beenden. </font><font style="vertical-align: inherit;">Danke an alle.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de423493/">https://habr.com/ru/post/de423493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de423483/index.html">Finden des richtigen Weges zum Trennen von Website-Inhalten mithilfe von Webpack</a></li>
<li><a href="../de423485/index.html">Faules Laden von Bildern mit IntersectionObserver</a></li>
<li><a href="../de423487/index.html">Node.js ohne node_modules</a></li>
<li><a href="../de423489/index.html">Ich bin Notarzt und möchte über das neue Apple Watch-Elektrokardiogramm sprechen</a></li>
<li><a href="../de423491/index.html">PHP Digest Nr. 139 (3. - 17. September 2018)</a></li>
<li><a href="../de423495/index.html">Was ist in XGBoost enthalten und was hat Go damit zu tun?</a></li>
<li><a href="../de423497/index.html">Lassen Sie uns versuchen, über hierarchische Zustandsmaschinen im Allgemeinen und deren Unterstützung in SObjectizer-5 im Besonderen zu sprechen</a></li>
<li><a href="../de423499/index.html">DevBoy - wie ich ein Open Source-Geräteprojekt erstellt und ein Projekt auf Kickstarter gestartet habe</a></li>
<li><a href="../de423503/index.html">Meine Erfahrung in Deutschland zu bewegen, zu leben und zu studieren</a></li>
<li><a href="../de423505/index.html">Zuckerberg verkauft Facebook-Aktien für 13 Milliarden US-Dollar, damit „unsere Kinder nie krank werden müssen“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>