<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§›ğŸ» ğŸ“Š ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ Arduino MegaæœåŠ¡å™¨å’Œå®æ—¶æ—¶é’Ÿ ğŸ‘¨ ğŸ˜¡ ğŸ¤™ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†äº†è§£Arduino Mega Serveréšç€æ—¶é—´çš„æ¨ç§»å¦‚ä½•å·¥ä½œï¼Œä»¥åŠå¦‚ä½•åœ¨Arduinoä¸Šåˆ›å»ºå®æ—¶é“¾æ¥çš„é¡¹ç›®ï¼Œè€Œä¸ç®¡å®ƒä»¬æ˜¯å¦å®‰è£…äº†â€œé“â€ RTCæ¨¡å—ã€‚å°†è¯¦ç»†è®¨è®ºåœ¨Arduinoä¸Šå®æ—¶å·¥ä½œçš„æ‰€æœ‰é—®é¢˜ï¼Œé˜…è¯»æœ¬æ–‡åï¼Œæ‚¨å°†æˆä¸ºçœŸæ­£çš„â€œé’Ÿè¡¨åŒ â€ã€‚
 
 
 é—®é¢˜çš„å®è´¨
 Arduinoä¸Šçš„ä»»ä½•...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino MegaæœåŠ¡å™¨å’Œå®æ—¶æ—¶é’Ÿ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/385349/"><img src="https://habrastorage.org/files/ce4/e16/81f/ce4e1681f98841af80ec3eeef2fce455.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†äº†è§£Arduino Mega Serveréšç€æ—¶é—´çš„æ¨ç§»å¦‚ä½•å·¥ä½œï¼Œä»¥åŠå¦‚ä½•åœ¨Arduinoä¸Šåˆ›å»ºå®æ—¶é“¾æ¥çš„é¡¹ç›®ï¼Œè€Œä¸ç®¡å®ƒä»¬æ˜¯å¦å®‰è£…äº†â€œé“â€ RTCæ¨¡å—ã€‚</font><font style="vertical-align: inherit;">å°†è¯¦ç»†è®¨è®ºåœ¨Arduinoä¸Šå®æ—¶å·¥ä½œçš„æ‰€æœ‰é—®é¢˜ï¼Œé˜…è¯»æœ¬æ–‡åï¼Œæ‚¨å°†æˆä¸ºçœŸæ­£çš„â€œé’Ÿè¡¨åŒ â€ã€‚</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜çš„å®è´¨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arduinoä¸Šçš„ä»»ä½•æˆ–å¤šæˆ–å°‘ä¸¥è‚ƒçš„é¡¹ç›®éƒ½åº”è¯¥å¯¹å½“å‰çš„å®æ—¶æ€§æœ‰æ‰€äº†è§£ã€‚ä¾‹å¦‚ï¼Œä¼ æ„Ÿå™¨è¯»æ•°åº”æœ‰æ—¶é—´é™åˆ¶ï¼ˆå¦åˆ™å°†æ— æ³•å»ºç«‹ä»»ä½•ç»Ÿè®¡ä¿¡æ¯ç”šè‡³æ˜¯åŸºæœ¬å›¾ï¼‰ï¼Œæ§åˆ¶å™¨åº”æ ¹æ®ä¸€å¤©ä¸­çš„å½“å‰æ—¶é—´ï¼Œå‘¨æœ«ï¼ŒèŠ‚å‡æ—¥ç­‰æ‰§è¡ŒæŸäº›æ“ä½œã€‚å¦‚æœæ‚¨çš„æ§åˆ¶å™¨ä¸çŸ¥é“å‡ ä¹æ˜¯å®æ—¶çš„ï¼Œå®ƒå˜æˆäº†ä¸€å°ç®€å•çš„æœºå™¨ï¼Œåªèƒ½å¯¹ä¸¥æ ¼å®šä¹‰çš„ç¨‹åºæ‰§è¡ŒåŸºæœ¬æ“ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Serverå¼€å§‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å·²å¼€å‘çš„ç³»ç»Ÿï¼Œå› æ­¤è¿™ç§äº‹åŠ¡çŠ¶æ€ï¼ˆç¼ºä¹å®æ—¶å·¥ä½œï¼‰ä¸é€‚åˆæˆ‘ä»¥åŠè¯¥ç³»ç»Ÿçš„æ‰€æœ‰å…¶ä»–ç”¨æˆ·ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ•´åˆåˆ°RTCç³»ç»Ÿä¸­çš„é—®é¢˜æ˜¯è®®ç¨‹ä¸Šçš„ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è™šæ‹Ÿå®æ—¶æ—¶é’Ÿ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘å’Œå¤§å¤šæ•°AMSç”¨æˆ·éƒ½æ²¡æœ‰ç›¸åŒçš„â€œé“â€ RTCæ¨¡å—ï¼Œå› æ­¤å†³å®šè¿›è¡Œä¸€æ¬¡â€œéª‘é©¬â€æ´»åŠ¨ï¼Œå¹¶ä½œä¸ºä¸´æ—¶æªæ–½ï¼Œåœ¨ç³»ç»Ÿå†…éƒ¨ç»„ç»‡å®æ—¶æ—¶é’Ÿï¼Œè€Œæ— éœ€å®é™…çš„ç‰©ç†æ¨¡å—ã€‚</font><font style="vertical-align: inherit;">å·²æˆåŠŸå®æ–½ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œå¦‚ä½•åœ¨æ²¡æœ‰å®é™…æ¨¡å—çš„æƒ…å†µä¸‹ç»„ç»‡è™šæ‹ŸRTCã€‚</font><font style="vertical-align: inherit;">æœ‰ä¸€ä¸ªå¾ˆæ£’çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¶é—´åº“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›å‡†ç¡®çš„æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">è¦å¼€å§‹ä½¿ç”¨å®ƒï¼Œæ‚¨éœ€è¦ä¸‹è½½ï¼Œè§£å‹ç¼©å¹¶å°†å…¶æ”¾åœ¨Arduinoç¯å¢ƒçš„æ‰€æœ‰åº“çš„æ ‡å‡†ä½ç½®ï¼Œå³æ–‡ä»¶å¤¹ä¸­ï¼š</font></font><br>
<br>
<pre><code class="java hljs">\rduino\libraries\
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæä¾›çš„æ‰€æœ‰æ—¶é—´è¿›è¡Œå·¥ä½œã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€ä¹ˆè¿è¡Œçš„</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸç†å¾ˆç®€å•ã€‚è¯¥åº“å¯åœ¨æ§åˆ¶å™¨å†…éƒ¨â€œå¯åŠ¨â€è™šæ‹Ÿæ—¶é’Ÿï¼Œå¹¶æä¾›ä»¥å¤šç§æ–¹å¼åŒæ­¥è™šæ‹Ÿæ—¶é’Ÿçš„åŠŸèƒ½ï¼Œä¾›æ‚¨é€‰æ‹©ã€‚æ‚¨å¯ä»¥é€‰æ‹©æœ€é€‚åˆæ‚¨çš„æ–¹æ³•ã€‚ç”±äºArduino Mega Serveræ˜¯ç½‘ç»œè®¾å¤‡ï¼Œå› æ­¤é€‰æ‹©äº†é€šè¿‡ç½‘ç»œä¸ç²¾ç¡®æ—¶é—´æœåŠ¡å™¨åŒæ­¥æ—¶é’Ÿçš„é€‰é¡¹ã€‚è¿™äº›å¯ä»¥æ˜¯Internetä¸Šçš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿è¡Œç›¸åº”æœåŠ¡çš„æœ¬åœ°ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œåœ¨AMSçš„åŸºæœ¬ç‰ˆæœ¬ä¸­ï¼Œæ—¶é’Ÿä¸</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœåŠ¡å™¨åŒæ­¥</font><font style="vertical-align: inherit;">ï¼Œå¹¶ä¸”æ‚¨ä¸éœ€è¦ä¸ºæ­¤è¿›è¡Œä»»ä½•é…ç½®ï¼Œä¸€åˆ‡éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œä¸ºäº†ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦åœ¨è‰å›¾çš„å¼€å¤´è¿æ¥é€‚å½“çš„åº“ã€‚</font></font><br>
<br>
<pre><code class="java hljs">#include &lt;SPI.h&gt;<font></font>
#include &lt;Ethernet.h&gt;<font></font>
#include &lt;EthernetUdp.h&gt;<font></font>
#include &lt;Time.h&gt; <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Time.hæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æ—¶é—´çš„åº“ï¼Œå…¶ä½™æ–‡ä»¶å¯¹äºä½¿ç”¨NTPåè®®è¿›è¡Œç½‘ç»œå·¥ä½œå’ŒåŒæ­¥æ—¶é—´æ˜¯å¿…éœ€çš„ï¼ˆè¿˜å¿…é¡»å®‰è£…ä»¥å¤ªç½‘åº“ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦æŒ‡å®šè¦ä¸ä¹‹åŒæ­¥æ—¶é—´çš„æœåŠ¡å™¨çš„IPåœ°å€</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">IPAddress <span class="hljs-title">timeServer</span><span class="hljs-params">(<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>)</span></span>; <span class="hljs-comment">//   MajorDoMo  </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å’Œç›¸åº”çš„ç«¯å£</font></font><br>
<br>
<pre><code class="java hljs">unsigned <span class="hljs-keyword">int</span> localPort = <span class="hljs-number">8888</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯æœ‰ä¸€ç‚¹ï¼šç«¯å£8888é€‚åˆåœ¨æœ¬åœ°ç½‘ç»œä¸ŠåŒæ­¥ï¼Œå¹¶ä¸”Internetä¸Šçš„å¤§å¤šæ•°æœåŠ¡å™¨éƒ½ä¸å“åº”å®ƒï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æ‰“ç®—ä¸Internetä¸Šçš„ç²¾ç¡®æ—¶é—´æœåŠ¡å™¨åŒæ­¥æ—¶é—´ï¼Œæœ€å¥½è®¾ç½®ç«¯å£123ï¼š</font></font><br>
<br>
<pre><code class="java hljs">unsigned <span class="hljs-keyword">int</span> localPort = <span class="hljs-number">123</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒä»…è¡¨ç¤ºæ—¶åŒº</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> timeZone = <span class="hljs-number">4</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶åˆ›å»ºä¸€ä¸ªEthernetUDPå¯¹è±¡</font></font><br>
<br>
<pre><code class="java hljs">EthernetUDP Udp;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ ·ï¼Œå‡†å¤‡æ“ä½œå°±å¯ä»¥è§†ä¸ºå®Œæˆäº†ï¼Œæ‚¨å¯ä»¥æè¿°é•¿æ—¶é—´ä½¿ç”¨æ‰€éœ€çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">åˆå§‹åŒ–åŠŸèƒ½ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rtcInit</span><span class="hljs-params">()</span> </span>{<font></font>
  Udp.begin(localPort);<font></font>
  Serial.println(<span class="hljs-string">"Waiting for NTP sync..."</span>);<font></font>
  setSyncProvider(getNtpTime);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™é‡Œéœ€è¦æ³¨æ„çš„åŠŸèƒ½</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(getNtpTime);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤åŠŸèƒ½è®¾ç½®æ—¶é—´åŒæ­¥æºï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯é€šè¿‡ç½‘ç»œçš„NTPåŒæ­¥ï¼‰ã€‚ä½†è¿™å¯ä»¥æ˜¯ä»»ä½•å…¶ä»–æ¥æºï¼Œä¾‹å¦‚ç‰©ç†RTCæ¨¡å—ã€‚æ­¤åŠŸèƒ½çš„æ‰§è¡Œå¯¼è‡´ï¼ˆå°†æ¥ï¼‰å®‰è£…åŒæ­¥æºï¼Œå¹¶åŒæ—¶é€šè¿‡æ­¤æºå®ç°æ—¶é—´çš„é«˜åº¦åŒæ­¥ã€‚æ­£æ˜¯åœ¨æ‰§è¡Œæ­¤åŠŸèƒ½æ—¶ï¼Œç¡®åˆ‡çš„æ—¶é—´â€œå‡ºç°â€åœ¨ç³»ç»Ÿä¸­ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥åº“æœ¬èº«è¿˜æœ‰å¦ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½ï¼Œ</font></font><br>
<br>
<pre><code class="java hljs">setSyncInterval(interval);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ ·æ‚¨å°±å¯ä»¥è®¾ç½®æ‰€éœ€çš„ä¸¤æ¬¡åŒæ­¥é—´éš”ï¼ˆä»¥ç§’ä¸ºå•ä½è®¾ç½®ï¼ŒåŒæ­¥æœ¬èº«ä¼šè‡ªåŠ¨å‘ç”Ÿï¼Œè€Œæ— éœ€æ‚¨çš„ä»»ä½•å‚ä¸ï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/994/655/c68/994655c686114b5c897a038f300e1e61.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨Arduinoè‰å›¾ä¸­ä½¿ç”¨ç¡®åˆ‡çš„æ—¶é—´ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸²è¡Œç›‘è§†å™¨ä¸­æ˜¾ç¤ºäº‹ä»¶å¹¶ä¸å®¹æ˜“ï¼Œä½†æ˜¯ä¸ç‰¹å®šçš„ç¡®åˆ‡æ—¶é—´ç›¸å…³ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä½¿ç”¨timeStampï¼ˆï¼‰å‡½æ•°å®Œæˆçš„ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">timeStamp</span><span class="hljs-params">()</span> </span>{<font></font>
  serialRTC();<font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯serialRTCï¼ˆï¼‰å‡½æ•°çš„åŒ…è£…å™¨ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serialRTC</span><span class="hljs-params">()</span> </span>{<font></font>
  Serial.print(year()); <font></font>
  Serial.print(<span class="hljs-string">"-"</span>);<font></font>
  printDigits(month());<font></font>
  Serial.print(<span class="hljs-string">"-"</span>);<font></font>
  printDigits(day());<font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  printDigits(hour());<font></font>
  Serial.print(<span class="hljs-string">":"</span>);<font></font>
  printDigits(minute());<font></font>
  Serial.print(<span class="hljs-string">":"</span>);<font></font>
  printDigits(second());<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨AMS Webç•Œé¢ä¸­ä¼ è¾“å’Œæ˜¾ç¤ºæ—¶é—´çš„æœºåˆ¶çš„åˆ†æè¶…å‡ºäº†æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ï¼Œå€¼å¾—å•ç‹¬æ’°å†™ï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ç»­é›†å¹¶è¯¦ç»†è§£é‡ŠArduino Mega Webç•Œé¢ä¸­æ—¶é—´æ˜¾ç¤ºçš„â€œé­”åŠ›â€æœåŠ¡å™¨ </font></font><br>
<br>
<img src="https://habrastorage.org/files/ca9/d1c/bec/ca9d1cbec3084d169566dbaa1cf2cf99.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œä»…æ­¤è€Œå·²ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯åœ¨AMSä¹‹å‰ï¼ˆå«0.12ç‰ˆï¼‰ä¸­å¦‚ä½•ç»„ç»‡è™šæ‹Ÿå®æ—¶æ—¶é’Ÿçš„æ–¹å¼ï¼Œå³ä½¿æ‚¨æ²¡æœ‰ç”¨äºå®æ—¶æ—¶é’Ÿçš„ç‰©ç†æ¨¡å—ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ä¸­ä»¥å‡†ç¡®çš„æ—¶é—´æ¥ç»„ç»‡å·¥ä½œã€‚</font><font style="vertical-align: inherit;">ä½†è¿™ä¸æ˜¯æ•…äº‹çš„ç»“å±€ï¼Œè€Œä»…ä»…æ˜¯å¼€å§‹ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥è‡ªArduino Mega Server 0.12çš„å®Œæ•´RTCæ¨¡å—ä»£ç </font></font></b><div class="spoiler_text">/*<br>
 Modul Virtual RTC<br>
 part of Arduino Mega Server project<br>
*/<br>
<br>
// Virtual RTC<br>
<br>
IPAddress timeServer(192, 168, 2, 8);<br>
unsigned int localPort = 8888; // local port to listen for UDP packets<br>
EthernetUDP Udp;<br>
<br>
const int timeZone = 4;<br>
time_t prevDisplay = 0; // when the digital clock was displayed<br>
<br>
void rtcInit() {<br>
 Udp.begin(localPort);<br>
 Serialprint(Â«Waiting for NTP syncâ€¦ \nÂ»);<br>
 setSyncProvider(getNtpTime);<br>
 modulRtc = 1;<br>
}<br>
<br>
void rtcWorks() {<br>
 if (timeStatus() != timeNotSet) {<br>
 if (now() != prevDisplay) { // update the display only if time has changed<br>
 setLifer();<br>
 prevDisplay = now();<br>
 //digitalClockDisplay(); <br>
 }<br>
 }<br>
}<br>
<br>
void printDigits(int digits) {<br>
 if(digits &lt; 10) {<br>
 Serial.print('0');<br>
 }<br>
 Serial.print(digits);<br>
}<br>
<br>
void serialRTC() {<br>
 Serial.print(year()); <br>
 Serial.print("-");<br>
 printDigits(month());<br>
 Serial.print("-");<br>
 printDigits(day());<br>
 Serial.print(" ");<br>
 printDigits(hour());<br>
 Serial.print(":");<br>
 printDigits(minute());<br>
 Serial.print(":");<br>
 printDigits(second());<br>
}<br>
<br>
void timeStamp() {<br>
 serialRTC();<br>
 Serial.print(" ");<br>
}<br>
<br>
void printRTC(){<br>
 serialRTC();<br>
 Serial.println();<br>
}<br>
<br>
// NTP code<br>
<br>
const int NTP_PACKET_SIZE = 48; // NTP time is in the first 48 bytes of message<br>
byte packetBuffer[NTP_PACKET_SIZE]; //buffer to hold incoming &amp; outgoing packets<br>
<br>
#ifdef RTC_FEATURE<br>
<br>
time_t getNtpTime() {<br>
 while (Udp.parsePacket() &gt; 0); // discard any previously received packets<br>
 Serialprint(Â«Transmit NTP request\nÂ»);<br>
 sendNTPpacket(timeServer);<br>
 uint32_t beginWait = millis();<br>
 while (millis() â€” beginWait &lt; 1500) {<br>
 int size = Udp.parsePacket();<br>
 if (size &gt;= NTP_PACKET_SIZE) {<br>
 Serialprint(Â«Receive NTP response\nÂ»);<br>
 Udp.read(packetBuffer, NTP_PACKET_SIZE); // read packet into the buffer<br>
 unsigned long secsSince1900;<br>
 // convert four bytes starting at location 40 to a long integer<br>
 secsSince1900 = (unsigned long)packetBuffer[40] &lt;&lt; 24;<br>
 secsSince1900 |= (unsigned long)packetBuffer[41] &lt;&lt; 16;<br>
 secsSince1900 |= (unsigned long)packetBuffer[42] &lt;&lt; 8;<br>
 secsSince1900 |= (unsigned long)packetBuffer[43];<br>
 return secsSince1900 â€” 2208988800UL + timeZone * SECS_PER_HOUR;<br>
 }<br>
 }<br>
 Serialprint(Â«No NTP response\nÂ»);<br>
 return 0; // return 0 if unable to get the time<br>
}<br>
<br>
// send an NTP request to the time server at the given address<br>
void sendNTPpacket(IPAddress &amp;address) {<br>
 // set all bytes in the buffer to 0<br>
 memset(packetBuffer, 0, NTP_PACKET_SIZE);<br>
 // Initialize values needed to form NTP request<br>
 // (see URL above for details on the packets)<br>
 packetBuffer[0] = 0b11100011; // LI, Version, Mode<br>
 packetBuffer[1] = 0; // Stratum, or type of clock<br>
 packetBuffer[2] = 6; // Polling Interval<br>
 packetBuffer[3] = 0xEC; // Peer Clock Precision<br>
 // 8 bytes of zero for Root Delay &amp; Root Dispersion<br>
 packetBuffer[12] = 49;<br>
 packetBuffer[13] = 0x4E;<br>
 packetBuffer[14] = 49;<br>
 packetBuffer[15] = 52;<br>
 // all NTP fields have been given values, now<br>
 // you can send a packet requesting a timestamp: <br>
 Udp.beginPacket(address, 123); //NTP requests are to port 123<br>
 Udp.write(packetBuffer, NTP_PACKET_SIZE);<br>
 Udp.endPacket();<br>
}<br>
<br>
#endif<br>
<br>
// Duration<br>
<br>
void showDuration(time_t duration) {<br>
 // prints the duration in days, hours, minutes and seconds<br>
 Serialprint(" (duration ");<br>
 if(duration &gt;= SECS_PER_DAY){<br>
 Serial.print(duration / SECS_PER_DAY);<br>
 Serialprint(" day "); <br>
 duration = duration % SECS_PER_DAY; <br>
 }<br>
 if(duration &gt;= SECS_PER_HOUR){<br>
 Serial.print(duration / SECS_PER_HOUR);<br>
 Serialprint(" hour "); <br>
 duration = duration % SECS_PER_HOUR; <br>
 }<br>
 if(duration &gt;= SECS_PER_MIN){<br>
 Serial.print(duration / SECS_PER_MIN);<br>
 Serialprint(" min "); <br>
 duration = duration % SECS_PER_MIN; <br>
 }<br>
 Serial.print(duration);<br>
 Serialprint(" sec) \n"); <br>
}<br>
<br>
void checkEvent(time_t* prevEvent) {<br>
 time_t duration = 0;<br>
 time_t timeNow = now();<br>
 <br>
 if (*prevEvent &gt; 0) {<br>
 duration = timeNow â€” *prevEvent;<br>
 } <br>
 if (duration &gt; 0) {<br>
 showDuration(duration);<br>
 } <br>
 *prevEvent = timeNow;<br>
}<br>
<br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€ä¸ªæƒŠå–œ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä¸ä¼šé•¿æ—¶é—´å¿™äºå°†RTCæ¨¡å—é›†æˆåˆ°ç³»ç»Ÿä¸­ï¼ˆè¿˜æœ‰å…¶ä»–ç´§è¿«çš„ä»»åŠ¡ï¼‰ï¼Œä½†æ˜¯åœ¨è¿™é‡Œï¼Œåœ¨ä¸æˆ‘ä»¬é¡¹ç›®çš„æŠ€æœ¯åˆä½œæ¡†æ¶ä¸­ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSTER</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æä¾›äº†ç”¨äºæµ‹è¯•å’Œé›†æˆåˆ°AMSçš„è®¾å¤‡ï¼Œå…¶ä¸­åŒ…æ‹¬åŸºäº</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W5500</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èŠ¯ç‰‡çš„ä»¥å¤ªç½‘æ¨¡å—</font><font style="vertical-align: inherit;">å’Œ... </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DS3231</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èŠ¯ç‰‡ä¸Šçš„å®æ—¶æ—¶é’Ÿæ¨¡å—</font><font style="vertical-align: inherit;">ï¼Œè¿™æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ï¼Œå¹¶ä¸”æ˜¯å°†RTCæ¨¡å—é›†æˆåˆ°ç³»ç»Ÿä¸­çš„åŠ¨åŠ›ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹å®è¯æ˜ï¼ŒCHIPSTERå…¬å¸ä¸ä»…é”€å”®ç”µå­è®¾å¤‡ï¼Œè€Œä¸”è¿˜ä»¥</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Geegrow</font></a><font style="vertical-align: inherit;">å“ç‰Œå‘½åä¸ºArduinoå’Œè‡ªåŠ¨åŒ–å¼€å‘è‡ªå·±çš„äº§å“ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶åœ¨è¿™ä¸ªæ–¹å‘ä¸Šä¸ºæœªæ¥åˆ¶å®šäº†å®ä¼Ÿçš„è®¡åˆ’ï¼Œç‰¹åˆ«æ˜¯ï¼Œå¥¹æœ‰ä¸€ä¸ªè®¡åˆ’å‘å¸ƒå…·æœ‰é«˜çº§åŠŸèƒ½å¹¶ä¸“é—¨é’ˆå¯¹Arduino Mega Serverè¿›è¡Œâ€œé”åŒ–â€çš„Arduino Mega 2560çš„ä¸“ç”¨ç‰ˆæœ¬ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œå¦‚æœè¯¥æ¿å‘å¸ƒï¼Œè¿™å°†æ˜¯éå¸¸æœ‰è¶£çš„äº‹ä»¶ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å›åˆ°å®æ—¶æ—¶é’Ÿã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®æ—¶æ—¶é’Ÿ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºRTCæ¨¡å—è§¦æ‰‹å¯åŠï¼Œå› æ­¤ä¸å°†å…¶é›†æˆåˆ°ç³»ç»Ÿä¸­å°†æ˜¯ä¸€ä¸ªç½ªè¿‡ã€‚å¹¸è¿çš„æ˜¯ï¼Œç”±äºæœ‰äº†ç›¸åŒçš„æ—¶é—´åº“ï¼Œäº‹å®è¯æ˜è¿™å¾ˆç®€å•ã€‚ä½†æ˜¯é¦–å…ˆæ˜¯ç¬¬ä¸€ä»¶äº‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºé‚£äº›ä¸çŸ¥é“çš„äººï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å®æ—¶æ¨¡å—-â€œæ™®é€šâ€ï¼ˆé€šå¸¸åœ¨DS1307èŠ¯ç‰‡ä¸Šï¼‰å’Œâ€œé«˜çº§â€ï¼ˆåœ¨æˆ‘çš„DS3231èŠ¯ç‰‡ä¸Šï¼‰ã€‚ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œç¬¬ä¸€åªæ‰‹è¡¨çš„å‡†ç¡®æ€§ä¸é«˜ï¼Œå¯ä»¥éå¸¸å¿«é€Ÿï¼Œéå¸¸å¼ºåŠ²åœ°â€œé€ƒè·‘â€ï¼Œç¬¬äºŒåªæ‰‹è¡¨æ˜¯ä¸€æ¬¾é«˜ç²¾åº¦æ‰‹è¡¨ï¼Œæ¯å¹´çš„æŠ¤ç†æ—¶é—´ä¸è¶…è¿‡ä¸¤åˆ†é’Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸Šå¯ä»¥å®é™…ä½¿ç”¨ã€‚æ›´åŠ å¤æ‚çš„ç”µè·¯è®¾è®¡å’Œå†…ç½®çš„çƒ­è¡¥å¿åŠŸèƒ½å¯å®ç°ç²¾åº¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯é€šè¿‡ç¼–ç¨‹ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—çš„ç‰ˆæœ¬éƒ½æ˜¯å…¼å®¹çš„ï¼Œå¹¶ä¸”éƒ½å¯ä»¥ä¸åº“å’Œä»£ç ä¸€èµ·ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">åŒºåˆ«ä»…åœ¨äºå‡†ç¡®æ€§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“ç„¶ï¼Œç”±äºå†…ç½®ç”µæ± çš„å­˜åœ¨ï¼Œå› æ­¤å®æ—¶æ—¶é’Ÿçš„ä¸»è¦ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯åœ¨ç”µæºå…³é—­æ—¶èƒ½å¤Ÿå·¥ä½œçš„èƒ½åŠ›ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©ç†è¿æ¥</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºå¦‚ä½•å°†RTCæ¨¡å—ç‰©ç†è¿æ¥åˆ°Arduino Mega Serveræˆ–æ‚¨çš„Arduinoé¡¹ç›®ã€‚æˆ‘å¿…é¡»è¯´ï¼Œè¿™éå¸¸ç®€å•ï¼Œæ‚¨å°†åªéœ€è¦ä¸¤ä¸ªç”µé˜»å’Œå‡ æ ¹ç”µçº¿ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿æ¥å¾ˆç®€å•ï¼šæ‚¨éœ€è¦åœ¨æ¨¡å—ä¸Šæ‰¾åˆ°å››ä¸ªè§¦ç‚¹-GNDï¼ˆæ¥åœ°ï¼‰ï¼ŒVCCï¼ˆç”µæºç”µå‹ï¼‰ï¼ŒSCLï¼ˆæ—¶é’Ÿä¿¡å·ï¼‰ï¼ŒSDAï¼ˆæ•°æ®ï¼‰ã€‚å…¶ä»–è”ç³»äººä»…åœ¨æå°‘æ•°æƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/7ec/49a/566/7ec49a56688f40f2a824adef2f625774.jpg" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæˆ‘ä»¬å°†GNDå¼•è„šæ¥åœ°ï¼Œå°†VCCå¼•è„šè¿æ¥è‡³æ§åˆ¶å™¨çš„ç”µæºç”µå‹ã€‚è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¶ä½™ç»“è®ºå¹¶ä¸å¤æ‚ã€‚</font><font style="vertical-align: inherit;">RTCæ¨¡å—é€šè¿‡I2Cæ¥å£ä¸æ§åˆ¶å™¨é€šä¿¡ï¼Œè¯¥æ¥å£åªæœ‰ä¸¤æ¡çº¿ï¼šåŒæ­¥å’Œæ•°æ®ï¼Œè€ŒArduinoæ§åˆ¶å™¨å·²ç»å…·æœ‰ç”¨äºè¿æ¥æ­¤æ¥å£çš„è§¦ç‚¹ã€‚</font><font style="vertical-align: inherit;">Arduino Unoæ˜¯A4ï¼ˆSDAï¼‰å’ŒA5ï¼ˆSCLï¼‰ï¼Œè€Œarduino Megaæ˜¯D20ï¼ˆSDAï¼‰å’ŒD21ï¼ˆSCLï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å”¯ä¸€çš„å¦™å¤„æ˜¯ï¼Œéœ€è¦é€šè¿‡4.7kÎ©ç”µé˜»å°†SCLå’ŒSDAå¼•è„šâ€œæ‹‰â€åˆ°ç”µæºã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰ç¡®åˆ‡çš„é¢å®šå€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨2 KOhm-10 KOhmèŒƒå›´å†…çš„ç”µé˜»ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/490/875/26d/49087526d1544d56947ee66ed7b19150.jpg" alt="å›¾ç‰‡"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¯ä»¶æ”¯æ´</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œä»…éœ€åœ¨AMSä»£ç æˆ–æ‚¨çš„é¡¹ç›®ä¸­æ·»åŠ å¯¹æ¨¡å—çš„æ”¯æŒå³å¯ã€‚</font><font style="vertical-align: inherit;">å¦‚æˆ‘æ‰€è¯´ï¼Œè¿™å°†éå¸¸ç®€å•ï¼Œå› ä¸ºåŒä¸€æ—¶é—´åº“å°†ä¸è¯¥æ¨¡å—ä¸€èµ·ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">ç¡®å®ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å¦ä¸€ä¸ªåº“ï¼Œå³</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DS1307RTCåº“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¹Ÿå°†å…¶è§£å‹ç¼©å¹¶æ”¾å…¥åº“çš„æ ‡å‡†æ–‡ä»¶å¤¹ä¸­ï¼š</font></font><br>
<br>
<pre><code class="java hljs">\rduino\libraries\
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°æ‚¨çš„è‰å›¾ä»£ç ä¸­</font></font><br>
<br>
<pre><code class="java hljs">#include &lt;Wire.h&gt;<font></font>
#include &lt;DS1307RTC.h&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬å·²ç»é…å¤‡é½å…¨ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹ä½¿ç”¨RTCç‰©ç†æ¨¡å—ç¼–å†™è‰å›¾æœ¬èº«çš„ä»£ç ã€‚</font><font style="vertical-align: inherit;">åœ¨åŠŸèƒ½ä¸Š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rtcInit</span><span class="hljs-params">()</span> </span>{<font></font>
  Udp.begin(localPort);<font></font>
  Serial.println(<span class="hljs-string">"Waiting for NTP sync..."</span>);<font></font>
  setSyncProvider(getNtpTime);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ›¿æ¢å­—ç¬¦ä¸²</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(getNtpTime);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(RTC.get);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶ä¸”Arduino Mega Serverï¼ˆæˆ–æ‚¨çš„æ§åˆ¶å™¨ï¼‰çš„å†…éƒ¨æ—¶é—´å°†ä¸â€œé“â€ RTCæ§åˆ¶å™¨åŒæ­¥ï¼Œè€Œä¸ä¸Internetæˆ–æœ¬åœ°ç½‘ç»œä¸Šçš„æœåŠ¡å™¨åŒæ­¥ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œé€šè¿‡è°ƒç”¨å‡½æ•°setSyncProviderï¼ˆgetNtpTimeï¼‰å’ŒsetSyncProviderï¼ˆRTC.getï¼‰ï¼Œå¯ä»¥æ ¹æ®å„ç§æ¡ä»¶æ¥æ“çºµæ—¶é—´åŒæ­¥æºå¹¶æ ¹æ®éœ€è¦åŒæ­¥æ—¶é—´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨éœ€è¦äº†è§£çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (timeStatus() != timeNotSet) {<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ ·æ‚¨å°±å¯ä»¥ç¡®å®šæ—¶é—´æ˜¯å¦åŒæ­¥ï¼Œå¹¶æ ¹æ®è¿™ç§æƒ…å†µé‡‡å–å¿…è¦çš„æªæ–½ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾®å¦™çš„æ—¶åˆ»</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨éœ€è¦åŒºåˆ†ä¸¤ä»¶äº‹ï¼šâ€œé“â€ RTCæ¨¡å—ä¸­èŠ±è´¹çš„æ—¶é—´å’Œæ§åˆ¶å™¨ä¸­æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚è¿™ä¸æ˜¯åŒä¸€å›äº‹ã€‚å¯¹æ‚¨æ¥è¯´ï¼Œâ€œä¸»è¦â€æ˜¯æ§åˆ¶å™¨ä¸­çš„æ—¶é—´ï¼Œè€Œæ¨¡å—ä¸­çš„æ—¶é—´åªæ˜¯åŒæ­¥çš„æ¥æºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†ï¼ç”±äºç‰©ç†RTCä¸­çš„æ—¶é—´ä¹Ÿåœ¨é€æ¸â€œè€—å°½â€ï¼Œå› æ­¤è¿˜éœ€è¦é€šè¿‡ä¸æ›´ç²¾ç¡®çš„èµ„æºï¼ˆä¾‹å¦‚Internetä¸Šçš„æœåŠ¡å™¨ï¼‰åŒæ­¥æ¥è¿›è¡Œè°ƒæ•´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæœ€ä½³ç®—æ³•åº”è¯¥æ˜¯è¿™æ ·çš„ï¼šå¦‚æœå¯èƒ½ï¼Œç„¶åå°†æ‰€æœ‰æ—¶é’Ÿä¸Internetä¸Šçš„æœåŠ¡å™¨åŒæ­¥ï¼Œå¦‚æœç½‘ç»œä¸å¯ç”¨ï¼Œåˆ™æˆ‘ä»¬å¼€å§‹å°†æ§åˆ¶å™¨ä¸­çš„æ—¶é—´ä¸RTCæ¨¡å—åŒæ­¥ï¼Œä¸€æ—¦ç½‘ç»œå‡ºç°ï¼Œä¾¿ç«‹å³é€šè¿‡Internetè¿”å›åˆ°åŒæ­¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨å¤„äºæç«¯æ¡ä»¶ä¸‹ï¼Œè€Œæ— æ³•è®¿é—®ä»»ä½•åŒæ­¥æºï¼Œåˆ™å¯ä»¥ä¸æ—¶æ‰‹åŠ¨è°ƒæ•´ç†¨æ–—æ—¶é’Ÿçš„è¿›ç¨‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬è€ƒè™‘é€šè¿‡ç½‘ç»œçš„æ§åˆ¶å™¨å’ŒRTCæ¨¡å—çš„å†…éƒ¨æ—¶é’Ÿçš„åŒæ­¥åŠŸèƒ½ï¼š</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rtcSync</span><span class="hljs-params">()</span> </span>{<font></font>
  setSyncProvider(getNtpTime);<font></font>
  Serial.println(<span class="hljs-string">"...getNtpTime..."</span>);
  <span class="hljs-keyword">if</span> (timeStatus() != timeNotSet) {<font></font>
    Serial.println(<span class="hljs-string">"...set!..."</span>);<font></font>
    time_t t = getNtpTime();<font></font>
    RTC.set(t);<font></font>
    setSyncProvider(RTC.get);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆè·å¾—é€šè¿‡ç½‘ç»œçš„ç¡®åˆ‡æ—¶é—´ã€‚</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(getNtpTime);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™å°†å…¶å®‰è£…åœ¨RTCæ¨¡å—ä¸­</font></font><br>
<br>
<pre><code class="java hljs">RTC.set(t);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åä»è¯¥æ¨¡å—ä¸­è®¾ç½®æ§åˆ¶å™¨æ—¶é—´</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(RTC.get);
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆæ¬¡å‘å¸ƒ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ã€‚</font><font style="vertical-align: inherit;">å½“ä»…è¿æ¥RTCæ¨¡å—ä½†æœªè®¾ç½®å…¶æ—¶é—´æ—¶ï¼Œè¿˜å­˜åœ¨åˆå§‹å¯åŠ¨çš„é—®é¢˜ï¼Œå› æ­¤æ— æ³•ä¸ä¹‹åŒæ­¥ã€‚</font><font style="vertical-align: inherit;">æ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼åœ¨å…¶ä¸­è®¾ç½®æ­£ç¡®çš„æ—¶é—´ã€‚</font><font style="vertical-align: inherit;">æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³Arduino Mega Serverä¸­çš„æ­¤é—®é¢˜ï¼šæ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œï¼ˆå¦‚æœæœ‰ç¡®åˆ‡çš„æ—¶é—´æœåŠ¡å™¨ï¼‰åŒæ­¥ç‰©ç†RTCï¼ˆæˆ–ä½¿ç”¨Arduino Serial Commanderå®ç”¨ç¨‹åºï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦åœ¨RTCæ¨¡å—ä¸­è®¾ç½®æ—¶é—´ï¼Œåªéœ€...å•å‡»æŒ‰é’®ã€‚</font><font style="vertical-align: inherit;">å…¶ä»–ä¸€åˆ‡å°†ç”±ä¸¤ååå«Arduino Mega Serverå’ŒArduino Serial Commanderçš„å¹´è½»äººä¸ºæ‚¨å®Œæˆã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨ä¸ä½¿ç”¨AMSï¼Œè€Œæ˜¯åœ¨å¼€å‘è‡ªå·±çš„é¡¹ç›®ï¼Œåˆ™å¯ä»¥ä»Arduino Mega Serveråˆ†å‘å·¥å…·åŒ…ä¸­è·å–ä»£ç ï¼ˆè¯¥ä»£ç å¯ç”¨å¹¶ä¸”å®Œå…¨å…è´¹ï¼‰ï¼Œæˆ–è€…åœ¨Internetä¸Šå¯»æ‰¾é’ˆå¯¹æ­¤é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼ˆæœ‰å‡ ç§è§£å†³æ–¹æ¡ˆï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/files/df7/2b1/c4b/df72b1c4b4594bd082d9a0b8c7cdc6c6.png" alt="å›¾ç‰‡"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰å®é™…RTCæ”¯æŒçš„ç‰ˆæœ¬</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»0.13ç‰ˆå¼€å§‹çš„Arduino Mega Serveræ”¯æŒâ€œé“â€ RTCã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä»</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¡¹ç›®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">å®˜æ–¹ç½‘ç«™ä¸Š</font></a><font style="vertical-align: inherit;">ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</font><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">ä¹Ÿå¯ä»¥</font><font style="vertical-align: inherit;">åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®ºå›</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šæé—®</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶ä¸”ï¼Œå½“ç„¶ï¼Œæˆ‘è¦æ„Ÿè°¢</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSTER</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„åˆä½œä»¥åŠä¸ºæµ‹è¯•å’Œé›†æˆæä¾›çš„è®¾å¤‡ï¼ˆæˆ‘å°†åœ¨ä»¥ä¸‹æ–‡ç« ä¹‹ä¸€ä¸­å‘æ‚¨ä»‹ç»W5500æ¨¡å—å’ŒAMSç½‘ç»œè¿è¡Œçš„åŠ é€Ÿï¼‰ã€‚</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ æ³•</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¸ªYoutubeé¢‘é“å·²æ‰“å¼€ï¼Œè¿™æ˜¯</font><font style="vertical-align: inherit;">Arduino Mega Server </font><font style="vertical-align: inherit;">çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿ƒé”€è§†é¢‘</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨å®é™…ç³»â€‹â€‹ç»Ÿä¸Šå·¥ä½œã€‚</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN385349/">https://habr.com/ru/post/zh-CN385349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN385339/index.html">è‹±ç‰¹å°”æ¨å‡ºæœ€å¿«çš„SSD</a></li>
<li><a href="../zh-CN385341/index.html">åœ¨æœªæ¥5å¹´å†…ï¼Œå°†åœ¨å®éªŒå®¤ä¸­äººå·¥ç§æ¤è‚‰ç±»</a></li>
<li><a href="../zh-CN385343/index.html">è‹¹æœçš„ä¸€ç‚¹é­”åŠ›-æ–°çš„é­”åŠ›é”®ç›˜ï¼Œè§¦æ§æ¿ï¼Œé¼ æ ‡å’ŒiMac</a></li>
<li><a href="../zh-CN385345/index.html">ç°å®ç”Ÿæ´»ä¸­çš„é›·ç¥ä¹‹é”¤ï¼šç£é“å’ŒæŒ‡çº¹æ‰«æä»ª</a></li>
<li><a href="../zh-CN385347/index.html">æ¯”ç‰¹å¸è®¡ç®—æœºåˆ¶é€ å•†21æ¯”ç‰¹å¸å¯åŠ¨å¼€å‘äººå‘˜è¯¾ç¨‹</a></li>
<li><a href="../zh-CN385351/index.html">Ğ’ ĞĞĞ¡Ğ Ğ¾Ñ‚Ğ²ĞµÑ€Ğ³Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ Ğ¾Ñ€Ğ±Ğ¸Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ³Ñ€ÑƒĞ·Ğ¾Ğ² Ğ¾Ñ‚ Lockheed Martin ĞºĞ°Ğº ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ Ğ¸ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹</a></li>
<li><a href="../zh-CN385353/index.html">åˆ›å»ºäº†é•¿åº¦ä¸º1.5å˜ç±³çš„å¾®ç²’åŠ é€Ÿå™¨æ¨¡å—çš„å·¥ä½œåŸå‹</a></li>
<li><a href="../zh-CN385355/index.html">NetflixåŠ©åŠ›æ¾³å¤§åˆ©äºšçš„åœ¨çº¿ç›—ç‰ˆç‡ä¸‹é™</a></li>
<li><a href="../zh-CN385361/index.html">Windows 10ç§»åŠ¨ç‰ˆ-å†…éƒ¨ç‰ˆæœ¬10549</a></li>
<li><a href="../zh-CN385363/index.html">ç‰¹æ–¯æ‹‰åŸå¸‚äº¤é€šè‡ªåŠ¨é©¾é©¶è§†é¢‘</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>