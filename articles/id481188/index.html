<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜüèæ üë¥ üí© 10 Bug Top Ditemukan di Proyek C ++ pada 2019 üéì ü¶ñ üßëüèø‚Äçü§ù‚Äçüßëüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Satu tahun lagi akan berakhir, dan ini adalah waktu yang tepat untuk membuat diri Anda secangkir kopi dan membaca kembali ulasan bug yang dikumpulkan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>10 Bug Top Ditemukan di Proyek C ++ pada 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/481188/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a8/cc3/539/7a8cc3539721631b68ce36c56f5471bf.png" alt="Gambar 7"></div><br>  Satu tahun lagi akan berakhir, dan ini adalah waktu yang tepat untuk membuat diri Anda secangkir kopi dan membaca kembali ulasan bug yang dikumpulkan di proyek-proyek open-source selama tahun ini.  Ini akan memakan waktu cukup lama, tentu saja, jadi kami menyiapkan artikel ini untuk memudahkan Anda.  Hari ini kita akan mengingat titik-titik gelap paling menarik yang kita temui dalam proyek-proyek C / C ++ open-source pada tahun 2019. <br><a name="habracut"></a><br><h2>  Tidak.  10. Sistem operasi apa yang kita jalankan? </h2><br>  <a href="https://www.viva64.com/en/w/v1040/">V1040</a> Kemungkinan salah ketik dalam ejaan nama makro yang telah ditentukan sebelumnya.  Makro '__MINGW32_' mirip dengan '__MINGW32__'.  winapi.h 4112 <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> !defined(__UNICODE_STRING_DEFINED) &amp;&amp; defined(__MINGW32_) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __UNICODE_STRING_DEFINED #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  Ada kesalahan ketik atas nama <i>__MINGW32</i> _ macro (MINGW32 sebenarnya dideklarasikan oleh __MINGW32__).  Di tempat lain dalam proyek ini, cek ditulis dengan benar: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed5/ad7/425/ed5ad7425145902765d728287ab5f2fa.png" alt="Gambar 3"></div><br><br>  Ngomong-ngomong, bug ini bukan hanya yang pertama kali dijelaskan dalam artikel " <a href="https://www.viva64.com/en/b/0658/">CMake: Kasus ketika Kualitas Proyek Tidak Terampuni</a> " tetapi bug asli pertama yang ditemukan oleh diagnostik V1040 dalam proyek sumber terbuka nyata (19 Agustus , 2019). <br><br><h2>  Tidak.  9. Siapa yang pertama? </h2><br>  <a href="https://www.viva64.com/en/w/v502/">V502</a> Mungkin <a href="https://www.viva64.com/en/w/v502/">operator</a> '?:' Bekerja dengan cara yang berbeda dari yang diharapkan.  Operator '?:' Memiliki prioritas lebih rendah daripada operator '=='.  mir_parser.cpp 884 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Opcode : uint8 { kOpUndef, .... OP_intrinsiccall, OP_intrinsiccallassigned, .... kOpLast, }; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> MIRParser::ParseStmtIntrinsiccall(StmtNodePtr &amp;stmt, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isAssigned) { Opcode o = !isAssigned ? (....) : (....); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> *intrnCallNode = mod.CurFuncCodeMemPool()-&gt;New&lt;IntrinsiccallNode&gt;(....); lexer.NextToken(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == !isAssigned ? OP_intrinsiccall : OP_intrinsiccallassigned) { intrnCallNode-&gt;SetIntrinsic(GetIntrinsicID(lexer.GetTokenKind())); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { intrnCallNode-&gt;SetIntrinsic(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;MIRIntrinsicID&gt;(....)); } .... }</code> </pre> <br>  Kami tertarik pada bagian berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == !isAssigned ? OP_intrinsiccall : OP_intrinsiccallassigned) { .... }</code> </pre> <br>  Diutamakan operator '==' lebih tinggi daripada operator ternary (? :).  Oleh karena itu, ekspresi kondisional dievaluasi dalam urutan yang salah dan setara dengan kode berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((o == !isAssigned) ? OP_intrinsiccall : OP_intrinsiccallassigned) { .... }</code> </pre> <br>  Karena konstanta <i>OP_intrinsiccall</i> dan <i>OP_intrinsiccallassigned</i> non-null, kondisi akan kembali <i>benar</i> setiap saat, yang berarti tubuh cabang <i>lain</i> adalah kode yang tidak dapat dijangkau. <br><br>  Bug ini dideskripsikan dalam artikel " <a href="https://www.viva64.com/en/b/0690/">Memeriksa Kompresor Tabut Baru-Baru Ini Dibuat Open-Source oleh Huawei</a> ." <br><br><h2>  Tidak.  8. Operasi bitwise berbahaya </h2><br>  <a href="https://www.viva64.com/en/w/v1046/">V1046</a> Penggunaan bool 'dan' int 'yang tidak aman secara bersamaan dalam operasi' &amp; = '.  GSLMultiRootFinder.h 175 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ROOT::Math::IMultiGenFunction &amp; func)</span></span></span><span class="hljs-function"> </span></span>{ ROOT::Math::IMultiGenFunction * f = func.Clone(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!f) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; fFunctions.push_back(f); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fFunctions.size(); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncIterator</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SetFunctionList</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncIterator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">begin</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FuncIterator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ret = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (FuncIterator itr = begin; itr != end; ++itr) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ROOT::Math::IMultiGenFunction * f = *itr; ret &amp;= AddFunction(*f); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br>  Kode menunjukkan bahwa fungsi <i>SetFunctionList</i> melintasi daftar iterator.  Jika setidaknya satu iterator tidak valid, fungsi mengembalikan <i>false</i> , atau <i>true</i> sebaliknya. <br><br>  Namun, fungsi <i>SetFunctionList</i> dapat mengembalikan <i>false</i> bahkan untuk iterator yang valid.  Mari kita mencari tahu <i>alasannya.</i> Fungsi <i>AddFunction</i> mengembalikan jumlah iterator yang valid pada daftar <i>fungsi</i> .  Artinya, menambahkan iterator non-nol akan menyebabkan daftar semakin bertambah ukurannya: 1, 2, 3, 4, dan seterusnya.  Di sinilah bug berperan: <br><br><pre> <code class="cpp hljs">ret &amp;= AddFunction(*f);</code> </pre> <br>  Karena fungsi mengembalikan nilai tipe <i>int</i> daripada <i>bool</i> , operasi '&amp; =' akan mengembalikan <i>false</i> untuk nilai genap karena bit paling tidak signifikan dari angka genap selalu disetel ke nol.  Ini adalah bagaimana satu bug halus dapat mematahkan nilai balik <i>SetFunctionsList</i> bahkan ketika argumennya valid. <br><br>  Jika Anda membaca cuplikan dengan hati-hati (dan ternyata benar, bukan?), Anda dapat memperhatikan bahwa itu berasal dari ROOT proyek.  Ya, kami memeriksanya juga: " <a href="https://www.viva64.com/en/b/0682/">Menganalisis Kode ROOT, Kerangka Analisis Data Ilmiah</a> ." <br><br><h2>  Tidak.  7. Variabel tercampur </h2><br>  <a href="https://www.viva64.com/en/w/v1001/">V1001</a> [CWE-563] Variabel 'Mode' ditugaskan tetapi tidak digunakan pada akhir fungsi.  SIModeRegister.cpp 48 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Status</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode; Status() : Mask(<span class="hljs-number"><span class="hljs-number">0</span></span>), Mode(<span class="hljs-number"><span class="hljs-number">0</span></span>){}; Status(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode) : Mask(Mask), Mode(Mode) { Mode &amp;= Mask; }; .... };</code> </pre> <br>  Sangat berbahaya menggunakan nama yang sama untuk argumen fungsi seperti untuk anggota kelas karena Anda berisiko mencampurnya.  Dan itulah yang terjadi di sini.  Ungkapan berikut tidak masuk akal: <br><br><pre> <code class="cpp hljs">Mode &amp;= Mask;</code> </pre> <br>  Argumen fungsi berubah, dan hanya itu.  Argumen ini tidak digunakan dengan cara apa pun setelah itu.  Apa yang benar-benar ingin ditulis oleh programmer adalah sebagai berikut: <br><br><pre> <code class="cpp hljs">Status(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mask, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> Mode) : Mask(Mask), Mode(Mode) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Mode &amp;= Mask; };</code> </pre> <br>  Bug ini ditemukan di <a href="http://llvm.org/">LLVM</a> .  Kami memiliki tradisi untuk memeriksa proyek ini sesekali.  Tahun ini kami <a href="https://www.viva64.com/en/b/0629/">memeriksanya</a> sekali lagi. <br><br><h2>  Tidak.  6. C ++ memiliki hukumnya sendiri </h2><br>  Bug ini berasal dari kenyataan bahwa aturan C ++ tidak selalu mengikuti aturan matematika atau "akal sehat".  Lihatlah potongan kecil di bawah ini dan coba temukan sendiri bug tersebut. <br><br>  <a href="https://www.viva64.com/en/w/v709/">V709</a> Perbandingan mencurigakan ditemukan: 'f0 == f1 == m_fractureBodies.size ()'.  Ingat bahwa 'a == b == c' tidak sama dengan 'a == b &amp;&amp; b == c'.  btFractureDynamicsWorld.cpp 483 <br><br><pre> <code class="cpp hljs">btAlignedObjectArray&lt;btFractureBody*&gt; m_fractureBodies; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> btFractureDynamicsWorld::fractureCallback() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numManifolds; i++) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> f0 = m_fractureBodies.findLinearSearch(....); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> f1 = m_fractureBodies.findLinearSearch(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f0 == f1 == m_fractureBodies.size()) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... } .... }</code> </pre> <br>  Kondisi ini tampaknya memeriksa bahwa <i>f0</i> sama dengan <i>f1</i> dan sama dengan jumlah elemen di <i>m_fractureBodies</i> .  Itu mungkin dimaksudkan untuk memeriksa apakah <i>f0</i> dan <i>f1</i> terletak di akhir array <i>m_fractureBodies</i> karena mengandung posisi objek yang ditemukan oleh metode <i>findLinearSearch ()</i> .  Tetapi pada kenyataannya, ekspresi kondisional ini memeriksa apakah <i>f0</i> sama dengan <i>f1</i> dan kemudian jika <i>m_fractureBodies.size ()</i> sama dengan hasil dari ekspresi <i>f0 == f1</i> .  Artinya, operan ketiga di sini diperiksa terhadap 0 atau 1. <br><br>  Itu bug yang bagus!  Dan, untungnya, yang cukup langka.  Sejauh ini kita telah <a href="https://www.viva64.com/en/examples/v709/">melihatnya</a> hanya dalam tiga proyek open-source, dan, yang menarik, ketiganya adalah mesin game.  Ini bukan satu-satunya bug yang ditemukan di Bullet;  yang paling menarik dijelaskan dalam artikel " <a href="https://www.viva64.com/en/b/0647/">PVS-Studio Melihat ke dalam Mesin Peluru Red Dead Redemption's</a> ". <br><br><h2>  Tidak.  5. Apa yang ada di akhir baris? </h2><br>  Ini mudah jika Anda tahu satu detail rumit. <br><br>  <a href="https://www.viva64.com/en/w/v739/">V739</a> EOF tidak boleh dibandingkan dengan nilai tipe 'char'.  'Ch' harus dari tipe 'int'.  json.cpp 762 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> JsonIn::skip_separator() { <span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">','</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ate_separator ) { .... } .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == EOF) { .... }</code> </pre> <br>  Ini adalah salah satu bug yang tidak mudah Anda temui jika Anda tidak tahu bahwa <i>EOF</i> didefinisikan sebagai -1.  Jadi, jika Anda mencoba membandingkannya dengan variabel tipe <i>char yang ditandatangani</i> , kondisinya akan hampir selalu <i>salah</i> .  Satu-satunya pengecualian adalah karakter yang dikodekan sebagai 0xFF (255).  Jika dibandingkan dengan <i>EOF</i> , karakter ini akan berubah menjadi -1, sehingga membuat kondisi ini benar. <br><br>  Banyak bug di Top 10 tahun ini ditemukan dalam perangkat lunak game komputer: mesin atau game open-source.  Seperti yang sudah Anda tebak, yang ini juga berasal dari daerah itu.  Lebih banyak kesalahan dijelaskan dalam artikel " <a href="https://www.viva64.com/en/b/0628/">Hari-Hari Kegelapan Bencana: Analisis Statis dan Permainan Roguelike</a> ". <br><br><h2>  Tidak.  4. Konstanta ajaib Pi </h2><br>  <a href="https://www.viva64.com/en/w/v624/">V624</a> Mungkin ada kesalahan cetak dalam konstanta '3.141592538'.  Pertimbangkan untuk menggunakan konstanta M_PI dari &lt;math.h&gt;.  PhysicsClientC_API.cpp 4109 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">B3_SHARED_API </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b3ComputeProjectionMatrixFOV</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fov, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> yScale = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-built_in"><span class="hljs-built_in">tan</span></span>((<span class="hljs-number"><span class="hljs-number">3.141592538</span></span> / <span class="hljs-number"><span class="hljs-number">180.0</span></span>) * fov / <span class="hljs-number"><span class="hljs-number">2</span></span>); .... }</code> </pre> <br><br>  Ada kesalahan ketik kecil pada nomor Pi (3,141592653 ...): angka "6" tidak ada di tempat desimal ke-7. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f83/42b/62f/f8342b62f2250ce927675fbbc1f40af7.png" alt="Gambar 4"></div>  Digit desimal sepersejuta tidak akan menyebabkan kerusakan yang nyata, tetapi masih lebih baik untuk menggunakan konstanta yang ada dari perpustakaan, yang kebenarannya dijamin.  Nomor Pi, misalnya, diwakili oleh M_PI konstan dari header math.h. <br><br>  Anda sudah membaca tentang bug ini di artikel " <a href="https://www.viva64.com/en/b/0647/">PVS-Studio Melihat ke dalam Mesin Peluru Red Dead Redemption</a> ", di mana ia ditempatkan keenam.  Jika Anda belum membacanya, ini adalah kesempatan terakhir Anda. <br><br><h2>  Pengalihan kecil </h2><br>  Kami mendekati 3 bug paling menarik teratas.  Seperti yang mungkin telah Anda perhatikan, saya menyortir bug bukan berdasarkan dampaknya, tetapi dengan upaya yang dilakukan pemeriksa manusia untuk menemukannya.  Bagaimanapun, keuntungan dari analisis statis atas ulasan kode pada dasarnya adalah ketidakmampuan alat perangkat lunak untuk lelah atau melupakan hal-hal.  :) <br><br>  Sekarang, mari kita lihat apa yang kita miliki di Top 3 kita. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ff/519/18d/2ff51918d95a06eaf72aa7037aa66732.png" alt="Gambar 8"></div><br><br><h2>  Tidak.  3. Pengecualian yang sulit dipahami </h2><br>  Kelas <a href="https://www.viva64.com/en/w/v702/">V702</a> harus selalu diturunkan dari std :: exception (dan yang sama) sebagai 'publik' (tidak ada kata kunci yang ditentukan, jadi kompiler secara default ke 'private').  CalcManager CalcException.h 4 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalcException</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CalcException(HRESULT hr) { m_hr = hr; } <span class="hljs-function"><span class="hljs-function">HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_hr; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: HRESULT m_hr; };</code> </pre> <br>  Penganalisis telah mendeteksi kelas yang berasal dari kelas <i>std :: exception</i> menggunakan pengubah <i>pribadi</i> (yang digunakan secara default jika tidak ditentukan sebaliknya).  Masalah dengan kode ini adalah bahwa upaya untuk menangkap <i>std :: exception</i> generik akan menyebabkan program kehilangan pengecualian dari tipe <i>CalcException</i> .  Perilaku ini berasal dari kenyataan bahwa warisan pribadi melarang konversi tipe implisit. <br><br>  Anda pasti tidak ingin melihat program Anda macet karena pengubah <i>publik yang</i> terlewat.  Omong-omong, saya yakin Anda telah menggunakan aplikasi ini setidaknya sekali dalam hidup Anda karena ini adalah <a href="https://github.com/Microsoft/calculator">Kalkulator Windows</a> lama yang baik, yang kami juga <a href="https://www.viva64.com/en/b/0615/">periksa</a> awal tahun ini. <br><br><h2>  Tidak.  2. Tag HTML tidak tertutup </h2><br>  <a href="https://www.viva64.com/en/w/v735/">V735</a> Mungkin HTML yang salah.  Tag penutup "&lt;/body&gt;" ditemukan, sedangkan tag "&lt;/div&gt;" diharapkan.  book.cpp 127 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeAlgebraLogBaseConversionPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BEGIN INDEX_LINK TITLE(Book::tr(<span class="hljs-string"><span class="hljs-string">"Logarithmic Base Conversion"</span></span>)) FORMULA(y = <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(x) / <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(a), <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>&lt;sub&gt;a&lt;/sub&gt;x = <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(x) / <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(a)) END; }</code> </pre> <br>  Seperti yang sering terjadi, kode sumber C / C ++ tidak berbicara banyak dengan sendirinya, jadi mari kita lihat kode preprocessed yang dihasilkan dari snippet di atas: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19a/7cf/4d4/19a7cf4d4da73085a677db2eceede962.png" alt="Gambar 6"></div><br><br>  Penganalisis telah menemukan tag <i>&lt;div&gt; yang</i> tidak tertutup.  Ada banyak fragmen kode html di sini, jadi penulis perlu merevisinya. <br><br>  Terkejut kita dapat mendiagnosis bug semacam ini?  Saya juga terkesan ketika saya melihat itu untuk pertama kalinya.  Jadi, ya, kami tahu sesuatu tentang menganalisis kode html.  Yah, hanya jika itu dalam kode C ++.  :) <br><br>  Tidak hanya bug ini ditempatkan di urutan kedua, tetapi ini adalah kalkulator kedua dalam daftar Top 10 kami.  Untuk mempelajari bug lain apa yang kami temukan dalam proyek ini, lihat artikel " <a href="https://www.viva64.com/en/b/0618/">Mengikuti Jejak Kalkulator: SpeedCrunch</a> ". <br><br><h2>  Tidak.  1. Fungsi standar yang sulit dipahami </h2><br>  Inilah bug yang ditempatkan terlebih dahulu.  Yang ini adalah bug yang sangat aneh, yang berhasil membuatnya melalui ulasan kode. <br><br>  Cobalah untuk menemukannya sendiri: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EatWhitespace</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE * InFile)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/* ----------------------------------------------------------------------- ** * Scan past whitespace (see ctype(3C)) and return the first non-whitespace * character, or newline, or EOF. * * Input: InFile - Input source. * * Output: The next non-whitespace character in the input stream. * * Notes: Because the config files use a line-oriented grammar, we * explicitly exclude the newline character from the list of * whitespace characters. * - Note that both EOF (-1) and the nul character ('\0') are * considered end-of-file markers. * * ----------------------------------------------------------------------- ** */</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (c = getc (InFile); <span class="hljs-built_in"><span class="hljs-built_in">isspace</span></span> (c) &amp;&amp; (<span class="hljs-string"><span class="hljs-string">'\n'</span></span> != c); c = getc (InFile)) ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (c); } <span class="hljs-comment"><span class="hljs-comment">/* EatWhitespace */</span></span></code> </pre> <br>  Sekarang mari kita lihat apa yang dikatakan oleh penganalisa: <br><br>  <a href="https://www.viva64.com/en/w/v560/">V560</a> Bagian dari ekspresi kondisional selalu benar: ('\ n'! = C).  params.c 136. <br><br>  Aneh, bukan?  Mari kita lihat beberapa tempat aneh lainnya tetapi dalam file yang berbeda (charset.h): <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> isspace #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> isspace #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> .... #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> isspace(c) ((c)==</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">' '</span></span></span><span class="hljs-meta"> || (c) == </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\t'</span></span></span><span class="hljs-meta">)</span></span></code> </pre> <br>  Hm, ini memang aneh ... Jadi, jika variabel <i>c</i> sama dengan <i>'\ n',</i> maka fungsi yang tampaknya tidak berbahaya adalah <i>spasi (c) akan kembali</i> <i>salah</i> , sehingga mencegah bagian kedua dari cek dari mengeksekusi karena evaluasi hubung singkat.  Dan jika <i>isspace (c)</i> dijalankan, variabel <i>c</i> akan sama dengan <i>''</i> atau <i>'\ t',</i> yang jelas tidak sama dengan <i>'\ n'</i> . <br><br>  Anda bisa berargumen bahwa makro ini mirip dengan <i>#define true false</i> dan kode seperti itu tidak akan pernah berhasil melalui tinjauan kode.  Tetapi potongan khusus ini melakukannya - dan sedang duduk di repositori menunggu untuk ditemukan. <br><br>  Untuk komentar lebih rinci tentang bug ini, lihat artikel " <a href="https://www.viva64.com/en/b/0610/">Ingin Bermain Detektif? Temukan Bug dalam Fungsi dari Komandan Midnight</a> ". <br><br><h2>  Kesimpulan </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a63/2b1/196/a632b119620f61c1a553a02c998b1509.png" alt="Gambar 9"></div><br><br>  Kami telah menemukan banyak bug selama tahun ini.  Itu adalah kesalahan umum salin-tempel, konstanta yang tidak akurat, tag tidak tertutup, dan banyak cacat lainnya.  Tetapi penganalisa kami terus berkembang dan <a href="https://www.viva64.com/en/b/0632/">belajar</a> untuk mendiagnosis lebih banyak jenis masalah, jadi kami tentu tidak akan melambat dan akan menerbitkan artikel baru tentang bug yang ditemukan dalam proyek sama rutinnya seperti sebelumnya. <br><br>  Jika Anda belum pernah membaca artikel kami sebelumnya, semua bug ini ditemukan menggunakan penganalisa statis PVS-Studio kami, yang dapat Anda <a href="https://www.viva64.com/en/pvs-studio-download/">unduh</a> dan coba pada proyek Anda sendiri.  Ini mendeteksi bug dalam program yang ditulis dalam C, C ++, C #, dan Java. <br><br>  Anda akhirnya sampai ke garis finish!  Jika Anda melewatkan dua level pertama, saya sarankan Anda menggunakan kesempatan ini dan selesaikan level ini bersama kami: <a href="https://habr.com/en/company/pvs-studio/blog/481174/">C #</a> dan <a href="https://habr.com/en/company/pvs-studio/blog/481184/">Java</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481188/">https://habr.com/ru/post/id481188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481178/index.html">10 bug teratas dalam proyek C # untuk 2019</a></li>
<li><a href="../id481180/index.html">Apakah pengembang perlu menerima saran dari pengguna?</a></li>
<li><a href="../id481182/index.html">Seri Posting Layanan Istio</a></li>
<li><a href="../id481184/index.html">Top 10 Bug Ditemukan di Proyek Java pada tahun 2019</a></li>
<li><a href="../id481186/index.html">10 bug terbaik di proyek Java untuk 2019</a></li>
<li><a href="../id481190/index.html">10 bug teratas dalam proyek C ++ untuk 2019</a></li>
<li><a href="../id481200/index.html">Kontrol Suara dan VoiceOver: cara menyesuaikan aplikasi untuk orang buta atau diam</a></li>
<li><a href="../id481202/index.html">Antiquities: prinsip pengumpulan sampah dan hasil 2019</a></li>
<li><a href="../id481204/index.html">Rilis Tech Mail.ru Group, musim dingin 2019</a></li>
<li><a href="../id481206/index.html">Bagaimana Amerika menempatkan musang hidup di collider</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>