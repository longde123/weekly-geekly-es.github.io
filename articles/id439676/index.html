<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçò üè¥‚Äç‚ò†Ô∏è üë©‚Äçüëß Bereaksi Integrasi Asli dan C ++ untuk iOS dan Android üßëüèø‚Äçü§ù‚Äçüßëüèø ‚õ©Ô∏è üåµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, saya ditawari untuk mengerjakan satu proyek yang menarik. Itu diperlukan untuk mengembangkan aplikasi mobile untuk startup Amerika di i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bereaksi Integrasi Asli dan C ++ untuk iOS dan Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439676/">  Baru-baru ini, saya ditawari untuk mengerjakan satu proyek yang menarik.  Itu diperlukan untuk mengembangkan aplikasi mobile untuk startup Amerika di iOS dan Android menggunakan React Native.  Fitur teknis utama dan faktor yang secara unik memutuskan partisipasi saya dalam proyek ini adalah tugas mengintegrasikan perpustakaan yang ditulis dalam C ++.  Bagi saya, ini bisa menjadi pengalaman baru dan ujian profesional baru. <br><br><h4>  Mengapa perlu mengintegrasikan perpustakaan C ++ </h4><br>  Aplikasi ini diperlukan untuk otentikasi dua faktor menggunakan protokol FIDO UAF dan U2F, menggunakan data biometrik, seperti ID Wajah dan ID Sentuh, dan teknologi serupa untuk platform Android.  Klien untuk otentikasi sudah siap.  Itu adalah perpustakaan yang ditulis dalam C ++ dan digunakan oleh beberapa klien lain sebagai tambahan untuk aplikasi seluler.  Jadi saya diminta untuk mengintegrasikannya dengan cara yang mirip ke dalam aplikasi seluler di React Native. <br><a name="habracut"></a><br><h4>  Bagaimana saya melakukannya </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ada pendekatan</a> untuk mengintegrasikan C ++ ke dalam aplikasi React Native Facebook.  Namun, masalahnya adalah ini hanya berfungsi untuk platform iOS, dan tidak jelas apa yang harus dilakukan dengan Android dalam kasus ini.  Saya ingin menyelesaikan masalah untuk dua platform sekaligus. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Garpu dari alat Dropbox Djinni</a> yang memungkinkan Anda untuk membuat deklarasi tipe cross-platform  Pada dasarnya, ini adalah aplikasi seluler React Native sederhana dengan koneksi khusus ke Djinni.  Saya menganggapnya sebagai dasar. <br><br>  Untuk kenyamanan, kode aplikasi dibagi menjadi dua repositori git.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Yang pertama</a> menyimpan kode sumber aplikasi Bereaksi Asli, dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">yang kedua</a> berisi Djinni dan dependensi yang diperlukan. <br><br><h4>  Langkah selanjutnya </h4><br>  Pertama, Anda perlu mendeklarasikan antarmuka untuk interaksi C ++ dan React Native code.  Di Djinni, ini dilakukan menggunakan file .idl.  Buka file <i>react-native-cpp-support / idl / main.Djinni</i> dalam proyek dan berkenalan dengan strukturnya. <br><br>  Untuk kenyamanan kami, beberapa tipe data JavaScript dan binding untuk mereka telah dideklarasikan dalam proyek.  Dengan demikian, kita dapat bekerja dengan tipe String, Array, Map, Promise dan lainnya tanpa deskripsi tambahan. <br><br>  Dalam contoh ini, file ini terlihat seperti ini: <br><br><pre><code class="javascript hljs">DemoModule = interface +r { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EVENT_NAME: string = <span class="hljs-string"><span class="hljs-string">"DEMO_MODULE_EVENT"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STRING_CONSTANT: string = <span class="hljs-string"><span class="hljs-string">"STRING"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INT_CONSTANT: i32 = <span class="hljs-number"><span class="hljs-number">13</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DOUBLE_CONSTANT: f64 = <span class="hljs-number"><span class="hljs-number">13.123</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BOOL_CONSTANT: bool = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; testPromise(promise: JavascriptPromise); testCallback(callback: JavascriptCallback); testMap(map: JavascriptMap, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: JavascriptPromise); testArray(array: JavascriptArray, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: JavascriptCallback); testBool(value: bool, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: JavascriptPromise); testPrimitives(i: i32, <span class="hljs-attr"><span class="hljs-attr">d</span></span>: f64, <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: JavascriptCallback); testString(value: string, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: JavascriptPromise); testEventWithArray(value: JavascriptArray); testEventWithMap(value: JavascriptMap); }</code> </pre> <br>  Setelah membuat perubahan pada file antarmuka, Anda harus membuat ulang antarmuka Java / Objective-C / C ++.  Ini mudah dilakukan dengan menjalankan skrip <i>generate_wrappers.sh</i> dari folder <i>react-native-cpp-support / idl /</i> .  Script ini akan mengumpulkan semua iklan dari file idl kami dan membuat antarmuka yang sesuai untuk mereka, sangat nyaman. <br><br>  Dalam contoh ini, ada dua file C ++ yang menarik bagi kami.  Yang pertama berisi deskripsi, dan implementasi kedua metode C ++ sederhana: <br><br>  <i>react-asli-cpp / cpp / DemoModuleImpl.hpp</i> <i><br></i>  <i>react-asli-cpp / cpp / DemoModuleImpl.cpp</i> <br><br>  Pertimbangkan kode salah satu metode sebagai contoh: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DemoModuleImpl::testString(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::string &amp;value, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::shared_ptr&lt;::JavascriptPromise&gt; &amp;promise) { promise-&gt;resolveObject(JavascriptObject::fromString(<span class="hljs-string"><span class="hljs-string">"Success!"</span></span>)); }</code> </pre><br>  Harap perhatikan bahwa hasilnya dikembalikan tidak menggunakan <i>kata kunci kembali</i> , tetapi menggunakan objek <i>JavaScriptPromise yang</i> dilewati oleh parameter terakhir, seperti yang dijelaskan dalam file <i>idl</i> . <br><br>  Sekarang menjadi jelas bagaimana menggambarkan kode yang diperlukan dalam C ++.  Tetapi bagaimana cara berinteraksi dengan ini dalam aplikasi React Native?  Untuk memahami, cukup buka file dari folder <i>react-native-cpp / index.js</i> , di mana semua fungsi yang dijelaskan dalam contoh dipanggil. <br><br>  Fungsi dari contoh kami disebut dalam JavaScript sebagai berikut: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NativeAppEventEmitter, NativeModules... } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-native'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DemoModule = NativeModules.DemoModule; .... async promiseTest() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendLine(<span class="hljs-string"><span class="hljs-string">"testPromise: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.testPromise()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendLine(<span class="hljs-string"><span class="hljs-string">"testMap: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.testMap({<span class="hljs-attr"><span class="hljs-attr">a</span></span>: DemoModule.INT_CONSTANT, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}))); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.appendLine(<span class="hljs-string"><span class="hljs-string">"testBool: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.testBool(DemoModule.BOOL_CONSTANT)); <span class="hljs-comment"><span class="hljs-comment">// our sample function this.appendLine("testString: " + await DemoModule.testString(DemoModule.STRING_CONSTANT)); }</span></span></code> </pre><br>  Sekarang sudah jelas bagaimana fungsi pengujian bekerja di sisi C ++ dan JavaScript.  Demikian pula, Anda dapat menambahkan kode fungsi lainnya.  Lebih lanjut saya akan mempertimbangkan bagaimana proyek Android dan iOS bekerja sama dengan C ++. <br><br><h4>  Bereaksi Asli dan C ++ untuk Android </h4><br>  Untuk interaksi Android dan C ++, Anda harus menginstal NDK.  Petunjuk terperinci tentang cara melakukan ini tersedia di <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">developer.android.com/ndk/guides</a></i> <br>  Kemudian, di dalam file <i>react-native-cpp / android / app / build.gradle,</i> Anda perlu menambahkan pengaturan berikut: <br><br><pre> <code class="javascript hljs">android { ... defaultConfig { ... ndk { abiFilters <span class="hljs-string"><span class="hljs-string">"armeabi-v7a"</span></span>, <span class="hljs-string"><span class="hljs-string">"x86"</span></span> } externalNativeBuild { cmake { cppFlags <span class="hljs-string"><span class="hljs-string">"-std=c++14 -frtti -fexceptions"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span> <span class="hljs-string"><span class="hljs-string">"-DANDROID_TOOLCHAIN=clang"</span></span>, <span class="hljs-string"><span class="hljs-string">"-DANDROID_STL=c++_static"</span></span> } } } externalNativeBuild { cmake { path <span class="hljs-string"><span class="hljs-string">"CMakeLists.txt"</span></span> } } sourceSets { main { java.srcDirs <span class="hljs-string"><span class="hljs-string">'src/main/java'</span></span>, <span class="hljs-string"><span class="hljs-string">'../../../react-native-cpp-support/support-lib/java'</span></span> } } splits { abi { reset() enable enableSeparateBuildPerCPUArchitecture universalApk <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-comment"><span class="hljs-comment">// If true, also generate a universal APK include "armeabi-v7a", "x86" } } ... }</span></span></code> </pre><br>  Kami baru saja mengkonfigurasi gradle untuk membangun aplikasi untuk arsitektur yang digunakan dan menambahkan flag build yang diperlukan untuk cmake, menentukan file <i>CMAkeLists</i> , yang akan kami jelaskan di masa depan, dan juga menambahkan kelas java dari Djinni yang akan kami gunakan. <br>  Langkah selanjutnya dalam menyiapkan proyek Android adalah deskripsi file <i>CMakeLists.txt</i> .  Dalam bentuk yang sudah jadi, ini dapat dilihat di sepanjang jalur <i>react-native-cpp / android / app / CMakeLists.txt</i> . <br><br><pre> <code class="javascript hljs">cmake_minimum_required(VERSION <span class="hljs-number"><span class="hljs-number">3.4</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>) set( PROJECT_ROOT <span class="hljs-string"><span class="hljs-string">"${CMAKE_SOURCE_DIR}/../.."</span></span> ) set( SUPPORT_LIB_ROOT <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/../react-native-cpp-support/support-lib"</span></span> ) file( GLOB JNI_CODE <span class="hljs-string"><span class="hljs-string">"src/main/cpp/*.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"src/main/cpp/gen/*.cpp"</span></span> ) file( GLOB PROJECT_CODE <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/*.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen/*.cpp"</span></span> ) file( GLOB PROJECT_HEADERS <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/*.hpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen/*.hpp"</span></span> ) file( GLOB DJINNI_CODE <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp/*.cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni/*.cpp"</span></span> ) file( GLOB DJINNI_HEADERS <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp/*.hpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni/*.hpp"</span></span> ) include_directories( <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen"</span></span> ) add_library( # Sets the name <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the library. native-lib # Sets the library <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a shared library. SHARED ${JNI_CODE} ${DJINNI_CODE} ${DJINNI_HEADERS} ${PROJECT_CODE} ${PROJECT_HEADERS} )</code> </pre><br>  Di sini kami menunjukkan jalur relatif ke perpustakaan dukungan, menambahkan direktori dengan kode C ++ dan JNI yang diperlukan. <br><br>  Langkah penting lainnya adalah menambahkan <i>DjinniModulesPackage</i> ke proyek kami.  Untuk melakukan ini, dalam file <i>react-native-cpp / android / app / src / main / java / com / rncpp / jni / DjinniModulesPackage.java</i> kita tentukan: <br><br><pre> <code class="javascript hljs">... import com.rncpp.jni.DjinniModulesPackage; ... public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactApplication</span></span></span><span class="hljs-class"> </span></span>{ ... @Override protected List&lt;ReactPackage&gt; getPackages() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Arrays.&lt;ReactPackage&gt;asList( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainReactPackage(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DjinniModulesPackage() ); } ... }</code> </pre><br>  Detail penting terakhir adalah deskripsi kelas <i>DjinniModulesPackage</i> yang baru saja kita gunakan di kelas utama aplikasi kita.  Itu terletak di <i>jalan reaksi-asli-cpp / android / app / src / main / java / com / rncpp / jni / DjinniModulesPackage.java</i> dan berisi kode berikut: <br><br><pre> <code class="javascript hljs">package com.rncpp.jni; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.ReactPackage; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.bridge.NativeModule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.bridge.ReactApplicationContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.facebook.react.uimanager.ViewManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collections; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DjinniModulesPackage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactPackage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"native-lib"</span></span>); } @Override public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.emptyList(); } @Override public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) { List&lt;NativeModule&gt; modules = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); modules.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DemoModule(reactContext)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> modules; } }</code> </pre><br>  Yang paling menarik di kelas di atas adalah baris <i>System.loadLibrary ("native-lib");</i>  Berkat itu kami memuat pustaka dengan kode asli kami dan kode Djinni ke dalam aplikasi Android. <br><br>  Untuk memahami bagaimana ini bekerja, saya menyarankan Anda untuk membiasakan diri dengan kode jni dari <a href="">folder</a> , yang merupakan pembungkus jni untuk bekerja dengan fungsionalitas modul kami, dan antarmuka dijelaskan dalam file idl. <br><br>  Akibatnya, jika lingkungan pengembangan Android dan React Native dikonfigurasikan, Anda dapat membangun dan menjalankan proyek React Native di Android.  Untuk melakukan ini, jalankan dua perintah di terminal: <br><br>  <i>npm instal</i> <i><br></i>  <i>NPM menjalankan Android</i> <br><br>  Hore!  Proyek kami berhasil! <br><br>  Dan kita melihat gambar berikut di layar emulator Android (dapat diklik): <br><br> <a href=""><img width="100" src="https://habrastorage.org/webt/d2/_b/ku/d2_bkuu0d7wftpkmekwbpgxyod8.png"></a> <br><br>  Sekarang mari kita lihat bagaimana iOS dan React Native bekerja dengan C ++. <br><br><h4>  Bereaksi Asli dan C ++ untuk iOS </h4><br>  Buka proyek reaksi-asli-cpp di Xcode. <br><br>  Pertama, tambahkan tautan ke kode yang digunakan dalam proyek Objective-C dan C ++ dari perpustakaan dukungan.  Untuk melakukan ini, transfer isi folder <i>react-native-cpp-support / support-lib / objc /</i> dan <i>react-native-cpp-support / support-lib / cpp /</i> ke proyek <i>Xcode</i> .  Akibatnya, folder dengan pustaka dukungan kode akan ditampilkan di struktur pohon proyek (gambar dapat diklik): <br><br> <a href=""><img width="200" src="https://habrastorage.org/webt/wc/yv/lw/wcyvlw_dev544my3-t0jebtkxkg.png"></a> <br><br> <a href=""><img width="200" src="https://habrastorage.org/webt/ym/da/_l/ymda_l6b2aypzuh6diwqgzkk624.png"></a> <br><br>  Jadi, kami menambahkan deskripsi tipe JavaScript dari perpustakaan dukungan ke proyek. <br><br>  Langkah selanjutnya adalah menambahkan pembungkus objektif-c yang dihasilkan untuk modul uji C ++ kami.  Kita perlu mentransfer kode dari folder <i>react-native-cpp / ios / rncpp / Generated /</i> ke proyek. <br><br>  Masih menambahkan kode C ++ dari modul kami, untuk itu kami mentransfer kode dari folder <i>react-native-cpp / cpp /</i> dan <i>react-native-cpp / cpp / gen /</i> ke proyek. <br><br>  Akibatnya, struktur pohon proyek akan terlihat sebagai berikut (gambar dapat diklik): <br><br> <a href=""><img width="200" src="https://habrastorage.org/webt/d9/ki/3i/d9ki3i1ni92_hjp2ez4bytyv5eq.png"></a> <br><br>  Anda perlu memastikan bahwa file yang ditambahkan muncul di daftar Sumber Kompilasi di dalam tab Bangun Fase. <br><br> <a href=""><img src="https://habrastorage.org/webt/29/hy/db/29hydbdi23jo_zntc8coqjpx5n0.png"><br></a> <br>  (gambar dapat diklik) <br><br>  Langkah terakhir adalah mengubah kode file AppDelegate.m untuk mulai menginisialisasi modul Djinni ketika aplikasi dimulai.  Dan untuk ini, Anda perlu mengubah baris kode berikut: <br><br><pre> <code class="javascript hljs">... #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"RCDjinniModulesInitializer.h"</span></span> ... @implementation AppDelegate - (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions { ... id&lt;RCTBridgeDelegate&gt; moduleInitialiser = [[RCDjinniModulesInitializer alloc] initWithURL:jsCodeLocation]; RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:moduleInitialiser launchOptions:nil]; RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge moduleName:@<span class="hljs-string"><span class="hljs-string">"rncpp"</span></span> initialProperties: nil]; ... }</code> </pre><br>  Sekarang luncurkan aplikasi kami di iOS.  (gambar dapat diklik) <br><br> <a href=""><img width="100" src="https://habrastorage.org/webt/pz/lm/fc/pzlmfc65__a1eomgafobtt1z87y.png"><br></a> <br><br>  Aplikasi sedang bekerja! <br><br><h4>  Menambahkan pustaka C ++ ke proyek kami. </h4><br>  Sebagai contoh, kami menggunakan pustaka OpenSSL yang populer. <br><br>  Dan mari kita mulai dengan Android. <br><br>  Kami mengkloning <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori</a> dengan pustaka OpenSSL yang sudah dibangun untuk Android. <br><br>  Sertakan pustaka OpenSSL dalam file CMakeLists.txt: <br><br><pre> <code class="javascript hljs">.... SET(OPENSSL_ROOT_DIR /Users/andreysaleba/projects/OpenSSL-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-Android-Prebuilt/openssl<span class="hljs-number"><span class="hljs-number">-1.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>) SET(OPENSSL_LIBRARIES_DIR <span class="hljs-string"><span class="hljs-string">"${OPENSSL_ROOT_DIR}/${ANDROID_ABI}/lib"</span></span>) SET(OPENSSL_INCLUDE_DIR ${OPENSSL_ROOT_DIR}/include) SET(OPENSSL_LIBRARIES <span class="hljs-string"><span class="hljs-string">"ssl"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto"</span></span>) ... LINK_DIRECTORIES(${OPENSSL_LIBRARIES_DIR} ${ZLIB_LIBRARIES_DIR}) include_directories( <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${SUPPORT_LIB_ROOT}/jni"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp"</span></span> <span class="hljs-string"><span class="hljs-string">"${PROJECT_ROOT}/cpp/gen"</span></span> <span class="hljs-string"><span class="hljs-string">"${OPENSSL_INCLUDE_DIR}"</span></span> ) add_library(libssl STATIC IMPORTED) add_library(libcrypto STATIC IMPORTED) ... set_target_properties( libssl PROPERTIES IMPORTED_LOCATION ${OPENSSL_LIBRARIES_DIR}/libssl.a ) set_target_properties( libcrypto PROPERTIES IMPORTED_LOCATION ${OPENSSL_LIBRARIES_DIR}/libcrypto.a ) target_link_libraries(native-lib PRIVATE libssl libcrypto)</code> </pre><br>  Kemudian kami menambahkan ke modul C ++ kami kode fungsi sederhana yang mengembalikan versi pustaka OpenSSL. <br><br>  Dalam file <i>react-native-cpp / cpp / DemoModuleImpl.hpp</i> tambahkan: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> getOpenSSLVersion(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::shared_ptr&lt;::JavascriptPromise&gt; &amp; promise) override;</code> </pre><br>  Dalam file <i>react-native-cpp / cpp / DemoModuleImpl.cpp</i> tambahkan: <br><br><pre> <code class="javascript hljs">#include &lt;openssl/crypto.h&gt; ... void DemoModuleImpl::getOpenSSLVersion(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> std::shared_ptr&lt;::JavascriptPromise&gt; &amp;promise) { promise-&gt;resolveString(SSLeay_version(<span class="hljs-number"><span class="hljs-number">1</span></span>)); }</code> </pre><br>  Masih menjelaskan antarmuka fungsi baru di file idl <i>`react-native-cpp-support / idl / main.djinni`</i> : <br><br><pre> <code class="javascript hljs"> getOpenSSLVersion(promise: JavascriptPromise);</code> </pre><br>  Kami <i>memanggil</i> skrip <i>`generate_wrappers.sh`</i> dari <i>folder` react-native-cpp-support / idl /`</i> . <br><br>  Kemudian, dalam JavaScript, kami memanggil fungsi yang baru dibuat: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> promiseTest() { ... this.appendLine(<span class="hljs-string"><span class="hljs-string">"openSSL version: "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DemoModule.getOpenSSLVersion()); }</code> </pre><br>  Semuanya siap untuk Android. <br>  Mari beralih ke iOS. <br><br>  Kami mengkloning <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori</a> dengan versi yang dirakit dari perpustakaan OpenSSL untuk iOS. <br><br>  Buka proyek iOS dalam Xcode dan dalam pengaturan di tab Build Settings tambahkan path ke perpustakaan openssl di bidang Other C Flags (contoh jalur di komputer saya di bawah): <br>  <i>-I / Pengguna / andreysaleba / proyek / prebuilt-openssl / dist / openssl-1.0.2d-ios / termasuk</i> <br><br>  Di bidang Bendera Tautan Lainnya, tambahkan baris berikut: <br><br><pre> <code class="javascript hljs">-L/Users/andreysaleba/projects/prebuilt-openssl/dist/openssl<span class="hljs-number"><span class="hljs-number">-1.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>d-ios/lib -lcrypto -lssl</code> </pre><br>  Semuanya sudah siap.  Pustaka OpenSSL ditambahkan untuk kedua platform. <br><br>  Terima kasih telah menonton! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439676/">https://habr.com/ru/post/id439676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439664/index.html">C ++ Kompatibilitas Biner dan Peningkatan Tanpa Rasa Sakit ke Visual Studio 2019</a></li>
<li><a href="../id439668/index.html">Menskala Newsletter Teknologi ke 700 ribu Pelanggan di 300 Kota: Sejarah Techstars Startup Digest</a></li>
<li><a href="../id439670/index.html">Sistem AI Rusia untuk diagnosis kanker Botkin.AI. Sekarang di Azure Marketplace</a></li>
<li><a href="../id439672/index.html">Dasar-Dasar PowerShell: Mendeteksi jika String Berakhir dengan Karakter Tertentu</a></li>
<li><a href="../id439674/index.html">Penguatan pembelajaran dalam: ping pixel pong mentah</a></li>
<li><a href="../id439678/index.html">Kirim ke Tantangan F # Terapan</a></li>
<li><a href="../id439680/index.html">Sekitar 50% orang Rusia bersedia menjual data pribadi mereka</a></li>
<li><a href="../id439682/index.html">Pelatihan Cisco 200-125 CCNA v3.0. Cisco Certified Network Specialist (CCNA). Hari 4. Perangkat Gateway</a></li>
<li><a href="../id439684/index.html">Terapkan untuk Tantangan F # Terapan</a></li>
<li><a href="../id439688/index.html">Ikhtisar solusi AI & ML pada 2018 dan perkiraan untuk 2019: Bagian 1 - NLP, Computer Vision</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>