<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüíº ‚òÇÔ∏è üì∫ Firma calificada de MacOS üë©üèø‚Äçüé§ üñäÔ∏è üë∞üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seg√∫n RBC y Tensor , en 2019, se emitir√°n 4.6 millones de certificados de firmas electr√≥nicas calificadas (CEP) en Rusia que cumplen con los requisito...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Firma calificada de MacOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450516/"><img src="https://habrastorage.org/webt/ex/qt/fa/exqtfaem0qdki9aiaggndkwcpsc.png" align="left"><br><p>  Seg√∫n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RBC</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tensor</a> , en 2019, se emitir√°n 4.6 millones de certificados de firmas electr√≥nicas calificadas (CEP) en Rusia que cumplen con los requisitos de 63-FZ.  Resulta que de los 8 millones de IP y LLC registradas, cada segundo empresario utiliza la firma electr√≥nica.  Adem√°s de los CEP para EGAIS y los CEP basados ‚Äã‚Äãen la nube para presentar informes emitidos por bancos y servicios de contabilidad, los CEP universales con tokens seguros son de particular inter√©s.  Dichos certificados le permiten iniciar sesi√≥n en portales estatales y firmar cualquier documento, haci√©ndolos legalmente significativos. </p><br><p>  Gracias al certificado CEP en un token USB, puede concluir remotamente un contrato con una contraparte o un empleado remoto, enviar documentos a la corte;  registre una caja registradora en l√≠nea, liquide los atrasos de impuestos y presente una declaraci√≥n en su cuenta en nalog.ru;  Inf√≥rmese sobre las deudas y los pr√≥ximos controles de los servicios p√∫blicos. </p><br><p>  El siguiente manual lo ayudar√° a <strong>trabajar con CEP para macOS</strong> , sin estudiar los foros de CryptoPro e instalar una m√°quina virtual con Windows. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Contenido</b> <div class="spoiler_text"><p>  <strong>Lo que necesita para trabajar con CEP para macOS:</strong> </p><br><p>  <strong>Instalar y configurar CEP para macOS</strong> </p><br><ol><li>  Instalar CryptoPro CSP </li><li>  Instalar controladores Rootoken </li><li>  Instalar certificados <br>  3.1.  Eliminamos todos los certificados GOST antiguos <br>  3.2.  Instalar certificados ra√≠z <br>  3.3.  Descargar certificados del centro de certificaci√≥n <br>  3.4.  Instale el certificado con Rutoken </li><li>  Instale el navegador especial Chromium-GOST </li><li>  Instalar extensiones de navegador <br>  5.1 Complemento del navegador CryptoPro EDS <br>  5.2.  Complemento para servicios gubernamentales <br>  5.3.  Configurar un complemento para servicios p√∫blicos <br>  5.4.  Activar extensiones <br>  5.5.  Configuramos la extensi√≥n CryptoPro EDS Browser plug-in </li><li>  Comprueba que todo funciona. <br>  6.1.  Vamos a la p√°gina de prueba CryptoPro <br>  6.2.  Entramos en la cuenta personal en nalog.ru <br>  6.3.  Vamos a servicios publicos </li><li>  Qu√© hacer si deja de funcionar </li></ol><br><p>  <strong>Cambiar PIN del contenedor</strong> </p><br><ol><li>  Descubrimos el nombre del contenedor CEP </li><li>  Cambiar comando PIN desde terminal </li></ol><br><p>  <strong>Firmando archivos en macOS</strong> </p><br><ol><li>  Descubra el hash del certificado CEP </li><li>  Firmar un archivo con un comando desde la terminal </li><li>  Instalar Apple Automator Script </li></ol><br><p>  <strong>Verifique la firma en el documento</strong> </p></div></div><br><p>  Toda la informaci√≥n a continuaci√≥n se obtiene de fuentes acreditadas (CryptoPro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="># 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="># 2</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="># 3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rutoken</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Corus-Consulting</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ministerio de Comunicaciones del Distrito Federal de los Urales</a> ), y se propone descargar software de sitios confiables.  El autor es un consultor independiente y no est√° afiliado a ninguna de las compa√±√≠as mencionadas.  Siguiendo estas instrucciones, usted asume toda la responsabilidad por cualquier acci√≥n y consecuencia. </p><br><h2 id="chto-nuzhno-dlya-raboty-s-kep-pod-macos">  Lo que necesita para trabajar con CEP para macOS: </h2><br><ol><li>  CEP <strong>en token USB Rutoken Lite</strong> o <strong>Rutoken EDS</strong> </li><li>  <strong>Cryptocontainer en formato CryptoPro</strong> </li><li>  con <strong>licencia incorporada para CryptoPro CSP</strong> </li><li>  el certificado p√∫blico debe almacenarse en el contenedor de clave privada </li></ol><br><p>  Los medios EToken y JaCarta junto con CryptoPro para macOS no son compatibles.  Carrier Rutoken Lite es la mejor opci√≥n, cuesta 500..1000 = rublos, funciona de manera inteligente y le permite almacenar hasta 15 llaves. </p><br><p>  Los proveedores criptogr√°ficos VipNet, Signal-COM y LISSI no son compatibles con macOS.  Convertir contenedores no funciona.  CryptoPro es la mejor opci√≥n, el costo del certificado debe ser de aproximadamente 1300 = rublos.  para SP y 1600 = frotar.  por Yul. </p><br><p>  Por lo general, la licencia anual para CryptoPro CSP ya est√° conectada al certificado y muchas AC se proporcionan de forma gratuita.  Si esto no es as√≠, debe comprar y activar una licencia perpetua para CryptoPro CSP estrictamente versi√≥n 4 por valor de 2700 =.  CryptoPro CSP versi√≥n 5 para macOS no funciona actualmente. </p><br><p>  Por lo general, un certificado p√∫blico se almacena en un contenedor de clave privada, pero esto debe aclararse al emitir el CEP y solicitar que se haga seg√∫n sea necesario.  Si no funciona, puede importar la clave p√∫blica en el contenedor cerrado usted mismo usando CryptoPro CSP para Windows. </p><br><h2 id="ustanavlivaem-i-nastraivaem-kep-pod-macos">  Instalar y configurar CEP para macOS </h2><br><div class="spoiler">  <b class="spoiler_title">Cosas obvias</b> <div class="spoiler_text"><ul><li>  todos los archivos descargados se descargan en el directorio predeterminado: ~ / Downloads /; </li><li>  no cambiamos nada en todos los instaladores, dejamos todo por defecto; </li><li>  Si macOS muestra una advertencia de que el software que se inicia es de un desarrollador desinstalado, debe confirmar el inicio en la configuraci√≥n del sistema: <em>Preferencias del sistema -&gt; Seguridad y privacidad -&gt; Abrir de todos modos</em> ; </li><li>  Si macOS solicita una contrase√±a de usuario y un permiso para controlar la computadora, debe ingresar una contrase√±a y aceptar todo. </li></ul></div></div><br><h3 id="1-ustanavlivaem-kriptopro-csp">  1. Instalar CryptoPro CSP </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nos registramos</a> en el sitio web de CryptoPro y descargamos e instalamos la versi√≥n de <em>CryptoPro CSP <strong>4.0 R4</strong></em> para <em>macOS</em> desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina de</a> <strong><a href="">descarga</a></strong> - <strong><a href="">descargar</a></strong> . </p><br><h3 id="2-ustanavlivaem-drayvery-rutoken">  2. Instale los controladores Rootoken </h3><br><p>  El sitio dice que es opcional, pero es mejor entregarlo.  Desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina de descarga</a> en el sitio web de Rutoken, descargue e instale el <em>M√≥dulo de soporte de KeyChain</em> - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descargar</a></strong> . </p><br><p>  A continuaci√≥n, conecte el token usb, ejecute el terminal y ejecute el comando: </p><br><pre><code class="bash hljs">/opt/cprocsp/bin/csptest -card -enum</code> </pre> <br><p>  La respuesta deber√≠a ser: </p><br><blockquote>  Aktiv Rutoken ... <br>  Tarjeta presente ... <br>  [C√≥digo de error: 0x00000000] </blockquote><br><h3 id="3-ustanavlivaem-sertifikaty">  3. Instalar certificados </h3><br><h4 id="31-udalyaem-vse-starye-gostovskie-sertifikaty">  3.1.  Eliminamos todos los certificados GOST antiguos </h4><br><p>  Si anteriormente hubo intentos de ejecutar CEP en macOS, debe limpiar todos los certificados instalados previamente.  Estos comandos en la terminal solo eliminar√°n los certificados CryptoPro y no afectar√°n a los certificados ordinarios de Keychain en macOS. </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store mroot</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store uroot</code> </pre> <br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -delete -all</code> </pre> <br><p>  La respuesta de cada comando debe ser: </p><br><blockquote>  No hay certificado que coincida con los criterios. </blockquote><p>  o </p><br><blockquote>  Eliminaci√≥n completa </blockquote><br><h4 id="32-ustanavlivaem-kornevye-sertifikaty">  3.2.  Instalar certificados ra√≠z </h4><br><p>  Los certificados ra√≠z son comunes a todos los CEP emitidos por cualquier autoridad de certificaci√≥n.  Descargue desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina de descargas del</a> Ministerio de Comunicaciones del Distrito Federal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de los Urales</a> : </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=4BC6DC14D97010C41A26E058AD851F81C842415A</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=8CAE88BBFD404A7A53630864F9033606E1DC45E2</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=0408435EB90E5C8796A160E69E4BFAC453435D1D</a> </li></ul><br><p>  Instale los siguientes comandos en la terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/4BC6DC14D97010C41A26E058AD851F81C842415A.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/8CAE88BBFD404A7A53630864F9033606E1DC45E2.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/0408435EB90E5C8796A160E69E4BFAC453435D1D.cer</code> </pre> <br><p>  Cada equipo debe devolver: </p><br><blockquote>  Instalando: <br>  ... <br>  [C√≥digo de error: 0x00000000] </blockquote><br><h4 id="33-skachivaem-sertifikaty-udostoveryayuschego-centra">  3.3.  Descargar certificados del centro de certificaci√≥n </h4><br><p>  A continuaci√≥n, debe instalar los certificados de la autoridad de certificaci√≥n donde emiti√≥ el CEP.  Por lo general, los certificados ra√≠z de cada CA se encuentran en su sitio web en la secci√≥n de descargas. </p><br><p>  Alternativamente, los certificados de cualquier CA pueden descargarse del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web del Distrito Federal de los Urales del Ministerio de Comunicaciones</a> .  Para hacer esto, en el formulario de b√∫squeda, debe buscar la CA por nombre, ir a la p√°gina con certificados y descargar todos <strong>los</strong> certificados <strong>v√°lidos</strong> , es decir, aquellos cuya segunda fecha a√∫n no ha llegado al campo <em>'V√°lido'</em> .  Descargue el enlace del campo <em>'Impresi√≥n'</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Capturas de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k6/xx/q4/k6xxq4czjusuqkbsqols_hbliei.png"></p><br><p><img src="https://habrastorage.org/webt/dt/oc/tw/dtoctw3qxq3qr6sbusinltnei2y.png"></p></div></div><br><p>  En el ejemplo de CA Corus Consulting: debe descargar 4 certificados de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina de descarga</a> : </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=15EB064ABCB96C5AFCE22B9FEA52A1964637D101</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=B9F1D3F78971D48C34AA73786CDCD138477FEE3F</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=55EC48193B6716D38E80BD9D1D2D827BC8A07DE3</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF</a> </li></ul><br><p>  Instalamos los certificados de CA descargados con los comandos del terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/B9F1D3F78971D48C34AA73786CDCD138477FEE3F.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/55EC48193B6716D38E80BD9D1D2D827BC8A07DE3.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/15EB064ABCB96C5AFCE22B9FEA52A1964637D101.cer</code> </pre> <br><p>  donde despu√©s de <em>~ / Downloads /</em> son los nombres de los archivos descargados, para cada CA ser√°n diferentes. </p><br><p>  Cada equipo debe devolver: </p><br><blockquote>  Instalando: <br>  ... <br>  [C√≥digo de error: 0x00000000] </blockquote><br><h4 id="34-ustanavlivaem-sertifikat-s-rutoken">  3.4.  Instale el certificado con Rutoken </h4><br><p>  Comando en terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br><p>  El equipo debe devolver: </p><br><blockquote>  Ok <br>  [C√≥digo de error: 0x00000000] </blockquote><br><h4 id="35-konfiguriruem-cryptopro-dlya-raboty-ssertifikatami-gost-r-3410-2012">  3.5.  Configure CryptoPro para trabajar con certificados GOST R 34.10-2012 </h4><br><p>  Para funcionar correctamente en nalog.ru con certificados emitidos desde 2019, las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> en el sitio web de CryptoPro recomiendan: </p><br><p>  Comandos en terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.1!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 256 bit'</span></span></code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.2!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 512 bit'</span></span></code> </pre> <br><p>  Los equipos no devuelven nada. </p><br><h3 id="4-ustanavlivaem-specialnyy-brauzer-chromium-gost">  4. Instale el navegador especial Chromium-GOST </h3><br><p>  Para trabajar con portales gubernamentales, necesita un ensamblaje especial del navegador de cromo: <strong>Chromium-GOST</strong> .  El c√≥digo fuente del proyecto est√° abierto, se proporciona un enlace al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio en GitHub</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el sitio web de CryptoPro</a> .  Seg√∫n la experiencia, otros navegadores <em>CryptoFox</em> y <em>Yandex.Browser</em> no son adecuados para trabajar con portales gubernamentales para macOS.  Vale la pena considerar que en algunos ensambles de Chromium-GOST la cuenta personal en nalog.ru puede congelarse o el desplazamiento deja de funcionar por completo, por lo tanto, se <strong>propone</strong> el antiguo <strong>ensamblaje</strong> probado <strong>71.0.3578.98</strong> - <strong><a href="">descargar</a></strong> . </p><br><p>  Descargue y descomprima el archivo, instale el navegador copiando o arrastre y suelte en el directorio de Aplicaciones.  Despu√©s de la instalaci√≥n, cierre con fuerza Chromium-Gost con un comando desde la terminal y no lo abra todav√≠a (trabajamos desde Safari): </p><br><pre> <code class="bash hljs">killall Chromium-Gost</code> </pre> <br><h3 id="5-ustanavlivaem-rasshireniya-dlya-brauzera">  5. Instalar extensiones del navegador </h3><br><h4 id="51-kriptopro-ecp-browser-plug-in">  5.1 Complemento del navegador CryptoPro EDS </h4><br><p>  Desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina de descarga</a> en el sitio web de CryptoPro, descargue e instale la <em>versi√≥n 2.0 del complemento CryptoPro EDS Browser para los usuarios</em> : <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desc√°rguelo</a></strong> . </p><br><h4 id="52-plagin-dlya-gosuslug">  5.2.  Complemento para servicios gubernamentales </h4><br><p>  Desde la <a href="">p√°gina de descarga</a> en el portal Gosuslug, descargue e instale el <em>complemento para trabajar con el portal de servicios del gobierno (versi√≥n para macOS)</em> - <strong><a href="">descargue</a></strong> . </p><br><h4 id="53-nastraivaem-plagin-dlya-gosuslug">  5.3.  Configurar un complemento para servicios p√∫blicos </h4><br><p>  Descargue el archivo de configuraci√≥n correcto para la extensi√≥n de los servicios gubernamentales para admitir macOS y las nuevas firmas digitales en el est√°ndar GOST2012: <strong><a href="">descargue</a></strong> . </p><br><p>  Ejecutamos comandos en la terminal: </p><br><pre> <code class="bash hljs">sudo rm /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents/ifc.cfg</code> </pre> <br><pre> <code class="bash hljs">sudo cp ~/Downloads/ifc.cfg /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents</code> </pre> <br><pre> <code class="bash hljs">sudo cp /Library/Google/Chrome/NativeMessagingHosts/ru.rtlabs.ifcplugin.json /Library/Application\ Support/Chromium/NativeMessagingHosts</code> </pre> <br><h4 id="54-aktiviruem-rasshireniya">  5.4.  Activar extensiones </h4><br><p>  Lanzamos el navegador Chromium-Gost y en la barra de direcciones escribimos: </p><br><pre> <code class="plaintext hljs">chrome://extensions/</code> </pre> <br><p>  Incluimos ambas extensiones instaladas: </p><br><ul><li>  Extensi√≥n CryptoPro para el complemento del navegador CAdES </li><li>  Extensi√≥n para plugin de servicios p√∫blicos </li></ul><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7b/qz/0-/7bqz0-z9zmnua0q7xs9qdcr63ak.png"></p></div></div><br><h4 id="55-nastraivaem-rasshirenie-kriptopro-ecp-browser-plug-in">  5.5.  Configuramos la extensi√≥n CryptoPro EDS Browser plug-in </h4><br><p>  En la barra de direcciones de Chromium-Gost escribimos: </p><br><pre> <code class="plaintext hljs">/etc/opt/cprocsp/trusted_sites.html</code> </pre> <br><p>  En la p√°gina que aparece, agregamos los sitios a la lista de sitios de confianza a su vez: </p><br><pre> <code class="plaintext hljs">https://*.cryptopro.ru https://*.nalog.ru https://*.gosuslugi.ru</code> </pre> <br><p>  Haga clic en "Guardar".  Deber√≠a aparecer un dado verde: </p><br><blockquote>  La lista de sitios de confianza se ha guardado correctamente. </blockquote><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wy/xx/5h/wyxx5hsubwkvcxtw-luvoregeng.png"></p></div></div><br><h3 id="6-proveryaem-chto-vse-rabotaet">  6. Comprueba que todo funciona </h3><br><h4 id="61-zahodim-na-testovuyu-stranicu-kriptopro">  6.1.  Vamos a la p√°gina de prueba CryptoPro </h4><br><p>  En la barra de direcciones de Chromium-Gost escribimos: </p><br><pre> <code class="plaintext hljs">https://www.cryptopro.ru/sites/default/files/products/cades/demopage/cades_bes_sample.html</code> </pre> <br><p>  Se debe mostrar "Plugin cargado" y su certificado debe estar en la lista a continuaci√≥n. <br>  Seleccione un certificado de la lista y haga clic en "Firmar".  Se solicitar√° el PIN del certificado.  El resultado debe mostrarse </p><br><blockquote>  Firma generada con √©xito </blockquote><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/v9/id/m_/v9idm_5w3mnwdcucyt5edpyhceo.png"></p></div></div><br><h4 id="62-zahodim-v-lichnyy-kabinet-na-nalogru">  6.2.  Entramos en la cuenta personal en nalog.ru </h4><br><p>  Puede que no sea posible seguir los enlaces del sitio nalog.ru, porque  los cheques no ser√°n aprobados.  Necesitas ir a enlaces directos: </p><br><ul><li>  Cuenta personal de <strong>IP</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://lkipgost.nalog.ru/lk</a> </li><li>  Cuenta personal de la <strong>entidad jur√≠dica</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://lkul.nalog.ru</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fn/2f/gf/fn2fgfejidrtpokh3xdlap4j0ny.png"></p></div></div><br><h4 id="63-zahodim-na-gosuslugi">  6.3.  Vamos a servicios publicos </h4><br><p>  Durante la autorizaci√≥n, seleccione "Iniciar sesi√≥n con una firma electr√≥nica".  En la lista que aparece, "Seleccione un certificado para una clave de verificaci√≥n de firma electr√≥nica", se mostrar√°n todos los certificados, incluidos la ra√≠z y CA, debe seleccionar el suyo desde el token usb e ingresar el PIN. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k1/il/ie/k1iliepylyukk20xl-e_ooj4ab0.png"></p><br><p><img src="https://habrastorage.org/webt/gi/ex/hf/giexhftwmegvxgj_k4bahsn7sz4.png"></p></div></div><br><h3 id="7-chto-delat-esli-perestalo-rabotat">  7. Qu√© hacer si deja de funcionar </h3><br><ol><li><p>  Reconectamos el token usb y verificamos que sea visible usando el comando en la terminal: </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/csptest -card -enum</code> </pre> <br></li><li><p>  Limpiamos el cach√© del navegador todo el tiempo, para lo cual escribimos en la barra de direcciones de Chromium-Gost: </p><br><pre> <code class="plaintext hljs"> chrome://settings/clearBrowserData</code> </pre> <br></li><li><p>  Vuelva a instalar el certificado CEP con el comando en la terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br></li></ol><br><h2 id="smena-pin-koda-konteynera">  Cambiar PIN del contenedor </h2><br><p>  El c√≥digo PIN predeterminado para Rutoken es <em>12345678</em> , y no puede dejarlo como tal.  Requisitos para el c√≥digo PIN de Rootoken: 16 caracteres como m√°ximo, puede contener letras y n√∫meros latinos. </p><br><h3 id="1-vyyasnyaem-nazvanie-konteynera-kep">  1. Averig√ºe el nombre del contenedor CEP </h3><br><p>  En el token usb y en otros almacenes se pueden almacenar varios certificados, y debe elegir el correcto.  Con el token usb insertado, obtenemos una lista de todos los contenedores en el sistema con el comando en la terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -keyset -enum_cont -fqcn -verifycontext</code> </pre> <br><p>  El equipo debe sacar al menos 1 contenedor y devolver </p><br><blockquote>  [C√≥digo de error: 0x00000000] </blockquote><p>  El contenedor que necesitamos es de la forma </p><br><blockquote>  \. \ Aktiv Rutoken lite \ XXXXXXXX </blockquote><p>  Si hay varios contenedores de este tipo, significa que hay varios certificados escritos en el token y usted sabe cu√°l necesita.  El valor <em>XXXXXXXX</em> despu√©s de la barra debe copiarse y sustituirse en el siguiente comando. </p><br><h3 id="2-smena-pin-komandoy-iz-terminal">  2. Cambiar el comando PIN desde la terminal </h3><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -passwd -qchange -container <span class="hljs-string"><span class="hljs-string">"XXXXXXXX"</span></span></code> </pre> <br><p>  donde <em>XXXXXXXX</em> es el nombre del contenedor obtenido en el paso 1 (requerido entre comillas). </p><br><p>  Aparecer√° un cuadro de di√°logo CryptoPro pidiendo el c√≥digo PIN anterior para acceder al certificado, luego otro cuadro de di√°logo para ingresar un nuevo c√≥digo PIN.  Listo </p><br><div class="spoiler">  <b class="spoiler_title">Captura de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xh/fr/9i/xhfr9imuu1gh-uxgvekeqleptyw.png"></p></div></div><br><h2 id="podpis-faylov-v-macos">  Firmando archivos en macOS </h2><br><p>  En macOS, los archivos se pueden firmar en el software <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CryptoArm</a> (costo de licencia 2500 = rublos), o con un simple comando a trav√©s del terminal, de forma gratuita. </p><br><h3 id="1-vyyasnyaem-hesh-sertifikata-kep">  1. Descubra el hash del certificado CEP </h3><br><p>  Puede haber varios certificados en el token y en otros almacenes.  Es necesario identificar de manera √∫nica a la persona con quien continuaremos firmando documentos.  Se hace una vez. <br>  Se debe insertar el token.  Obtenemos la lista de certificados en los repositorios usando el comando desde la terminal: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -list</code> </pre> <br><p>  El equipo debe mostrar al menos 1 certificado del formulario: </p><br><blockquote>  Certmgr 1.1 ¬© "Crypto-Pro", 2007-2018. <br>  programa para administrar certificados, CRL y tiendas <br>  = = = = = = = = = = = = = = = = = = = = <br>  1 ------- <br>  Emisor: E = help @ esphere.ru, ... CN = KORUS Consulting CIS LLC ... <br>  Asunto: E = sergzah @ gmail.com, ... CN = Zakharov Sergey Anatolyevich ... <br>  Serie: 0x000000000000000000000000000000000000 <br>  Hash SHA1: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX <br>  ... <br>  Contenedor: SCARD \ rutoken_lt_00000000 \ 0000 \ 0000 <br>  ... <br>  = = = = = = = = = = = = = = = = = = = = <br>  [C√≥digo de error: 0x00000000] </blockquote><p>  El certificado que necesitamos en el par√°metro Contenedor debe tener un valor de la forma <em>SCARD \ rutoken ...</em>  Si hay varios certificados con tales valores, significa que hay varios certificados escritos en el token, y usted sabe cu√°l necesita.  El valor del par√°metro <em>SHA1 Hash</em> (40 caracteres) debe copiarse y sustituirse en el siguiente comando. </p><br><h3 id="2-podpis-fayla-komandoy-iz-terminal">  2. Firmando un archivo con un comando desde la terminal </h3><br><p>  En la terminal, vaya al directorio con el archivo para firmar y ejecute el comando: </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/cryptcp -signf -detach -cert -der -strict -thumbprint  FILE</code> </pre> <br><p>  donde <em> ...</em> es el hash del certificado obtenido en el paso 1, y <em>FILE</em> es el nombre del archivo que se firmar√° (con todas las extensiones, pero sin una ruta). </p><br><p>  El equipo debe devolver: </p><br><blockquote>  Se crea el mensaje firmado. <br>  [C√≥digo de error: 0x00000000] </blockquote><p>  Se crear√° un archivo de firma electr√≥nica con la extensi√≥n * .sgn; se trata de una firma desconectada en formato CMS con codificaci√≥n DER. </p><br><h3 id="3-ustanovka-apple-automator-script">  3. Instalar Apple Automator Script </h3><br><p>  Para no trabajar con el terminal cada vez, puede instalar Automator Script una vez, con lo cual puede firmar documentos desde el men√∫ contextual del Finder.  Para hacer esto, descargue el archivo - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descargar</a></strong> . </p><br><ol><li>  Descomprima el archivo <em>'Firmar con CryptoPro.zip'</em> </li><li>  Iniciar <em>Automator</em> </li><li>  Busque y abra el archivo desempaquetado <em>'Iniciar sesi√≥n con CryptoPro.workflow'</em> </li><li>  En el bloque <em>Run Shell Script</em> cambiamos el texto <em></em> al valor del par√°metro <em>SHA1 Hash</em> del certificado CEP obtenido anteriormente. </li><li>  Guarde el script: ‚åòCommand + S </li><li>  Ejecute el archivo <em>'Firmar con CryptoPro.workflow'</em> y confirme la instalaci√≥n. </li><li>  Vaya a <em>Preferencias del</em> sistema <em>-&gt; Extensiones -&gt; Finder</em> y verifique que la acci√≥n r√°pida <em>Iniciar sesi√≥n con CryptoPro</em> est√© marcada. </li><li>  En Finder, llame al men√∫ contextual de cualquier archivo, y en la secci√≥n <em>Acciones r√°pidas</em> y / o <em>Servicios</em> , seleccione <strong>Iniciar sesi√≥n con CryptoPro</strong> </li><li>  En el cuadro de di√°logo CryptoPro que apareci√≥, ingrese el PIN de usuario del CEP </li><li>  Aparecer√° un archivo con la extensi√≥n * .sgn en el directorio actual: una firma desconectada en formato CMS con codificaci√≥n DER. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Capturas de pantalla</b> <div class="spoiler_text"><p>  Ventana de Apple Automator: <br><img src="https://habrastorage.org/webt/ci/md/am/cimdamgbcmuwupqnikoxm4zlr0u.png"></p><br><p>  Preferencias del sistema: <br><img src="https://habrastorage.org/webt/ds/aj/4y/dsaj4ybkjxfuc72-ujruj0jor1c.png"></p><br><p>  Buscador del men√∫ contextual: </p><br><p><img src="https://habrastorage.org/webt/n5/sz/8y/n5sz8ylptnlud2tdd3o4pvkvqk4.png"></p></div></div><br><h2 id="proverit-podpis-na-dokumente">  Verifique la firma en el documento </h2><br><p>  Si el contenido del documento no contiene secretos y secretos, entonces la forma m√°s f√°cil es utilizar el servicio web en el portal Gosuslug: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.gosuslugi.ru/pgu/eds</a> .  Por lo tanto, puede tomar una captura de pantalla de un recurso autorizado y asegurarse de que todo est√© bien con una firma. </p><br><div class="spoiler">  <b class="spoiler_title">Capturas de pantalla</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8u/8m/rk/8u8mrkglxf7z5nzdxmo4f7nj66k.png"></p><br><p><img src="https://habrastorage.org/webt/63/7p/od/637pod0rngetfm1nudyyse-3h2q.png"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450516/">https://habr.com/ru/post/450516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450504/index.html">C√≥mo hacer una aplicaci√≥n desde el sitio y ponerla en Google Play en unas pocas horas. Parte 1/2: Aplicaci√≥n web progresiva</a></li>
<li><a href="../450506/index.html">C√≥mo hacer una aplicaci√≥n desde el sitio y ponerla en Google Play en unas pocas horas. Parte 2/2: Actividad web confiable</a></li>
<li><a href="../450508/index.html">Joe Armstrong sobre Elixir, Erlang, FP y OOP</a></li>
<li><a href="../450510/index.html">Cinco problemas en los procesos de operaci√≥n y soporte de los sistemas Highload IT</a></li>
<li><a href="../450514/index.html">CVT vs estado</a></li>
<li><a href="../450518/index.html">Arduino y Procesamiento. C√≥mo controlar un microcontrolador a trav√©s de un puerto COM. Comunicaci√≥n bidireccional</a></li>
<li><a href="../450520/index.html">Creaci√≥n de una IA confiable y verificada: cumplimiento de especificaciones, capacitaci√≥n confiable y verificaci√≥n formal</a></li>
<li><a href="../450522/index.html">Historia de Internet: decadencia, parte 1</a></li>
<li><a href="../450524/index.html">Control por computadora a trav√©s de Telegram</a></li>
<li><a href="../450526/index.html">10. Check Point Getting Started R80.20. Conciencia de identidad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>