<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💵 👨🏼 📠 Erleben Sie 2 Millionen kopflose Sitzungen 👩‍👧 👩🏻‍🚒 🕒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Veröffentlicht am 4. Juni 2018 im browserlosen Unternehmensblog. 

 Wir freuen uns, Ihnen mitteilen zu können, dass wir kürzlich die Grenze von zwei M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erleben Sie 2 Millionen kopflose Sitzungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413547/">  <font color="gray">Veröffentlicht am 4. Juni 2018 im browserlosen Unternehmensblog.</font> <br><br>  Wir freuen uns, Ihnen mitteilen zu können, dass wir kürzlich die Grenze von <b>zwei Millionen Sitzungen</b> überschritten haben!  Dies sind <i>Millionen von</i> generierten Screenshots, gedruckten PDFs und getesteten Websites.  Wir haben fast alles getan, was Sie sich mit einem kopflosen Browser vorstellen können. <br><br>  Es ist zwar schön, einen solchen Meilenstein zu erreichen, aber auf dem Weg gab es eindeutig <i>viele</i> Überschneidungen und Probleme.  Aufgrund des enormen Verkehrsaufkommens möchte ich einen Schritt zurücktreten und allgemeine Empfehlungen für den Start von Headless-Browsern (und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Puppenspielern</a> ) in der Produktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">abgeben</a> . <br><br>  Hier sind einige Tipps. <br><a name="habracut"></a><br><h1>  1. Verwenden Sie überhaupt keinen kopflosen Browser </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/85f/438/cae85f438e0037a0f87f1ae6619cfc33.png"><br><br><h3>  Headless Chrome-Ressourcenverbrauch </h3><br>  <i>Starten Sie den Browser nach</i> Möglichkeit <i>keinesfalls im Headless-Modus</i> .  Insbesondere auf derselben Infrastruktur wie Ihre Anwendung (siehe oben).  Der kopflose Browser ist unvorhersehbar, gefräßig und züchtet wie Mr. Misix von Rick und Morty.  Fast alles, was ein Browser tun kann (außer das Interpolieren und Ausführen von JavaScript), kann mit einfachen Linux-Tools ausgeführt werden.  Die Cheerio-Bibliotheken und andere bieten eine elegante Node-API zum Abrufen von Daten mit HTTP-Anforderungen und zum Scraping, wenn dies Ihr Ziel ist. <br><br>  Sie können beispielsweise eine Seite aufnehmen (vorausgesetzt, es handelt sich um eine Art HTML) und sie mit einfachen Befehlen wie den folgenden verschrotten: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cheerio <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'cheerio'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fetch'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(url); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> html = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> res.test(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $ = cheerio.load(html); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $(<span class="hljs-string"><span class="hljs-string">'buy-now.price'</span></span>).text(); } getPrice(<span class="hljs-string"><span class="hljs-string">'https://my-cool-website.com/'</span></span>);</code> </pre> <br>  Offensichtlich deckt das Skript nicht alle Anwendungsfälle ab. Wenn Sie diesen Artikel lesen, müssen Sie höchstwahrscheinlich einen kopflosen Browser verwenden.  Also fangen wir an. <br><br><h1>  2. Starten Sie einen Headless-Browser nicht unnötig </h1><br>  Wir haben zahlreiche Benutzer getroffen, die versuchen, den Browser auch dann am Laufen zu halten, wenn er nicht verwendet wird (mit offenen Verbindungen).  Obwohl dies eine gute Strategie ist, um eine Sitzung zu beschleunigen, stürzt sie in wenigen Stunden ab.  Vor allem, weil Browser <i>gerne</i> alles hintereinander zwischenspeichern und nach und nach Speicherplatz verbrauchen.  Sobald Sie den Browser nicht mehr intensiv nutzen, schließen Sie ihn sofort! <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> puppeteer.launch(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> page = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> browser.newPage(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://www.example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// More stuff ...page.click() page.type() browser.close(); // &lt;- Always do this! }</span></span></code> </pre> <br>  In browserless beheben wir diesen Fehler normalerweise für Benutzer selbst, indem wir immer einen Timer für die Sitzung einstellen und den Browser schließen, wenn WebSocket getrennt wird.  Wenn Sie jedoch unseren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Service</a> oder das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Backup-Docker-Image</a> nicht nutzen, stellen Sie sicher, dass Sie den Browser <i>automatisch</i> schließen, da dies unangenehm ist, wenn alles mitten in der Nacht fällt. <br><br><h1>  3. Ihre Freundeseite </h1><br><blockquote>  Seien Sie vorsichtig mit Transpilern wie Babel oder Typoskript, da sie gerne Hilfsfunktionen erstellen und davon ausgehen, dass sie mit Verschlüssen zugänglich sind.  Das heißt, der .evaluate-Rückruf funktioniert <i>möglicherweise nicht</i> richtig. </blockquote><br>  Puppenspieler hat viele nette Methoden, wie das Speichern von DOM-Selektoren und anderen Dingen in einer Knotenumgebung.  Obwohl dies sehr praktisch ist, können Sie sich leicht in den Fuß schießen, wenn etwas auf der Seite diesen DOM-Knoten zur <i>Mutation</i> zwingt.  Das mag nicht so cool sein, aber in Wirklichkeit ist es besser, die gesamte Arbeit auf der Browserseite <i>im Kontext des Browsers</i> zu erledigen.  Dies bedeutet normalerweise, dass <code>page.evaulate</code> für alle zu erledigenden Arbeiten <code>page.evaulate</code> . <br><br>  Zum Beispiel anstelle von so etwas ( <i>drei</i> asynchrone Aktionen): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.$(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> link = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.getProperty(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.click(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> link;</code> </pre> <br>  Es ist besser, dies zu tun (eine asynchrone Aktion): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.evaluate(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = $anchor.href; $anchor.click(); });</code> </pre> <br>  Ein weiterer Vorteil beim Umschließen von Aktionen in einen <code>evaluate</code> ist die Portabilität: Dieser Code kann in einem Browser ausgeführt werden, um zu überprüfen, anstatt zu versuchen, den Knotencode neu zu schreiben.  Natürlich wird immer empfohlen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Debugger</a> zu verwenden, um die Entwicklungszeit zu verkürzen. <br><br>  Eine einfache Faustregel ist, die Anzahl der <code>await</code> oder <code>then</code> im Code zu zählen.  Wenn es mehr als eine gibt, ist es wahrscheinlich am besten, den Code innerhalb des Aufrufs <code>page.evaluate</code> .  Der Grund dafür ist, dass alle asynchronen Aktionen zwischen der Node-Laufzeit und dem Browser hin und her gehen, was eine konstante JSON-Serialisierung und -Deserialisierung bedeutet.  Obwohl nicht so viel analysiert wird (da alles von WebSockets unterstützt wird), nimmt es dennoch Zeit in Anspruch, die besser für etwas anderes ausgegeben wird. <br><br><h1>  4. Parallelisieren Sie Browser, nicht Webseiten </h1><br>  Wir haben festgestellt, dass das Starten eines Browsers nicht gut ist und wir dies nur im Notfall tun müssen.  Der nächste Tipp ist, nur eine Sitzung pro Browser auszuführen.  In der Realität ist es zwar möglich, Ressourcen durch Parallelisierung der Arbeit durch <code>pages</code> zu sparen, aber wenn eine Seite ausfällt, kann der gesamte Browser abstürzen.  Darüber hinaus kann nicht garantiert werden, dass jede Seite perfekt sauber ist (Cookies und Speicher können, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie wir sehen,</a> zu Kopfschmerzen führen). <br><br>  Stattdessen: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Launch one browser and capture the promise const launch = puppeteer.launch(); const runJob = async (url) { // Re-use the browser here const browser = await launch; const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Mach das besser: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> runJob = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (url) { <span class="hljs-comment"><span class="hljs-comment">// Launch a clean browser for every "job" const browser = puppeteer.launch(); const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Jede neue Browserinstanz erhält ein sauberes <code>--user-data-dir</code> ( <a href="">sofern nicht anders angegeben</a> ).  Das heißt, es wird vollständig als neue Sitzung verarbeitet.  Wenn Chrome aus irgendeinem Grund abstürzt, werden keine anderen Sitzungen damit abgerufen. <br><br><h1>  5. Begrenzung der Warteschlange und der Parallelität </h1><br>  Eines der Hauptmerkmale von browserless ist die Möglichkeit, Parallelisierung und Warteschlange sauber einzuschränken.  Client-Anwendungen führen also nur <code>puppeteer.connect</code> , denken jedoch nicht an die Implementierung der Warteschlange.  Dies verhindert eine Vielzahl von Problemen, vor allem bei gleichzeitigen Chrome-Instanzen, die alle verfügbaren Ressourcen Ihrer Anwendung verschlingen. <br><br>  Der beste und einfachste Weg ist, unser Docker-Image mit den erforderlichen Parametern auszuführen: <br><br><pre> <code class="hljs pgsql"># Pull <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Puppeteer@<span class="hljs-number"><span class="hljs-number">1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> support $ docker pull browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> $ docker run -e "MAX_CONCURRENT_SESSIONS=10" browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  Dies begrenzt die Anzahl gleichzeitiger Anforderungen auf zehn (einschließlich Debugging-Sitzungen und mehr).  Die Warteschlange wird durch die Variable <code>MAX_QUEUE_LENGTH</code> .  In der Regel können Sie ungefähr 10 gleichzeitige Anforderungen pro Gigabyte Speicher ausführen.  Der Prozentsatz der CPU-Auslastung kann für verschiedene Aufgaben variieren, aber im Grunde benötigen Sie viel und viel RAM. <br><br><h1>  6. Vergessen Sie nicht <code>page.waitForNavigation</code> </h1><br>  Eines der häufigsten Probleme, auf die wir gestoßen sind, sind die Aktionen, die das Laden von Seiten mit der anschließenden plötzlichen Beendigung von Skripten starten.  Dies liegt daran, dass die Aktionen, die das <code>pageload</code> von <code>pageload</code> auslösen, häufig zum Verschlucken nachfolgender Arbeiten führen.  Um das Problem zu umgehen, müssen Sie normalerweise die Aktion zum Laden von Seiten aufrufen - und unmittelbar danach auf das Laden warten. <br><br>  Zum Beispiel funktioniert eine solche <code>console.log</code> nicht an einem Ort ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">siehe Demo</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Aber es <i>funktioniert</i> in einem anderen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">siehe Demo</a> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.waitForNavigation(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Weitere Informationen zu waitForNavigation finden Sie <a href="">hier</a> .  Diese Funktion hat ungefähr die gleichen Schnittstellenparameter wie <code>page.goto</code> , jedoch nur mit dem Teil "wait". <br><br><h1>  7. Verwenden Sie Docker für alles, was Sie brauchen. </h1><br>  Chrome benötigt viele Abhängigkeiten, um ordnungsgemäß zu funktionieren.  Wirklich viel.  Auch nach der Installation müssen Sie sich um Dinge wie Schriftarten und Phantomprozesse kümmern.  Daher ist es ideal, einen Behälter zu verwenden, um alles dort hinein zu stellen.  Docker wurde fast speziell für diese Aufgabe entwickelt, da Sie die Menge der verfügbaren Ressourcen begrenzen und isolieren können.  Wenn Sie eine eigene <code>Dockerfile</code> erstellen <code>Dockerfile</code> , überprüfen Sie unten alle erforderlichen Abhängigkeiten: <br><br><pre> <code class="hljs tex"># Dependencies needed for packages downstream RUN apt-get update &amp;&amp; apt-get install -y <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>unzip <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fontconfig <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>locales <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>gconf-service <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libasound2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libatk1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libc6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcairo2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcups2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libdbus-1-3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libexpat1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libfontconfig1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgcc1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgconf-2-4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgdk-pixbuf2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libglib2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgtk-3-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnspr4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpango-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpangocairo-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libstdc++6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-xcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcomposite1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcursor1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxdamage1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxext6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxfixes3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxi6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrandr2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrender1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxss1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxtst6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>ca-certificates <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fonts-liberation <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libappindicator1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnss3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>lsb-release <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>xdg-utils <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>wget</code> </pre> <br>  Und um Zombie-Prozesse zu vermeiden (eine häufige Sache in Chrome), ist es besser, etwas wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dummes Init</a> zu verwenden, um richtig zu laufen: <br><br><pre> <code class="hljs powershell">ADD https://github.com/Yelp/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span>/releases/download/v1.<span class="hljs-number"><span class="hljs-number">2.0</span></span>/dumb<span class="hljs-literal"><span class="hljs-literal">-init_1</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>_amd64 /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span> RUN chmod +x /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span></code> </pre> <br>  Wenn Sie mehr wissen möchten, schauen Sie sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unsere Docker-Datei an</a> . <br><br><h1>  8. Denken Sie an zwei verschiedene Laufzeiten. </h1><br>  Beachten Sie, dass es <i>zwei</i> JavaScript-Laufzeiten gibt (Knoten und Browser).  Dies ist ideal für die Trennung von Aufgaben, aber es kommt unweigerlich zu Verwirrung, da einige Methoden eine explizite Verbindungsübergabe anstelle von Hebevorgängen erfordern. <br><br>  Nehmen <code>page.evaluate</code> zum Beispiel <code>page.evaluate</code> .  Tief im <a href="">Inneren des</a> Protokolls gibt es eine <a href=""><i>wörtliche</i> Stringifizierung der Funktion und ihrer Übertragung auf Chrome</a> .  Daher <i>funktionieren</i> Dinge wie Verschlüsse und Aufzüge überhaupt <i>nicht</i> .  Wenn Sie einige Referenzen oder Werte an den Evaluierungsaufruf übergeben müssen, fügen Sie sie einfach als Argumente hinzu, die korrekt verarbeitet werden. <br><br>  Anstatt den <code>selector</code> über Verschlüsse zu referenzieren: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// `selector` here is `undefined` since we're in the browser context const clicked = await page.evaluate(() =&gt; document.querySelector(anchor).click());</span></span></code> </pre> <br>  Besserer Parameter übergeben: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Here we add a `selector` arg and pass in the reference in `evaluate` const clicked = await page.evaluate((selector) =&gt; document.querySelector(selector).click(), anchor);</span></span></code> </pre> <br>  <code>page.evaluate</code> können der Funktion <code>page.evaluate</code> ein oder mehrere Argumente <code>page.evaluate</code> , da diese hier variabel ist.  Nutzen Sie dies unbedingt! <br><br><h1>  Die Zukunft </h1><br>  Wir sind unglaublich optimistisch in Bezug auf die Zukunft von Headless-Browsern und die Automatisierung, die sie erreichen können.  Mit leistungsstarken Tools wie Puppenspieler und browserlos hoffen wir, dass das Debuggen und Ausführen der kopflosen Automatisierung in der Produktion einfacher und schneller wird.  In Kürze werden wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine Abrechnung für Konten</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Funktionen durchführen</a> , mit denen Sie Ihre kopflose Arbeit besser bewältigen können! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413547/">https://habr.com/ru/post/de413547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413529/index.html">Warum neue i-SENSYS-Geräte als revolutionär bezeichnet werden können</a></li>
<li><a href="../de413531/index.html">Das Buch "Einheit für den Entwickler. Mobile Multi-Plattform-Spiele »</a></li>
<li><a href="../de413539/index.html">Eine einfache Steuerung basierend auf Fuzzy-Logik. Erstellung und Anpassung</a></li>
<li><a href="../de413543/index.html">Angular Cli 6: Warum Sie es brauchen und wie Sie es verwenden</a></li>
<li><a href="../de413545/index.html">Humor im Branding - warum es nicht immer gut ist</a></li>
<li><a href="../de413549/index.html">Web Development Lecture Course</a></li>
<li><a href="../de413551/index.html">Scrollen und Aufmerksamkeit (Studie 2018)</a></li>
<li><a href="../de413553/index.html">Der Registrar REG.RU beraubte den Partner des Zugriffs auf 70.000 Domains und nahm deren Service für sich</a></li>
<li><a href="../de413555/index.html">Sichere Interoperabilität in verteilten Systemen</a></li>
<li><a href="../de413557/index.html">NewSQL: SQL geht nirgendwo hin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>