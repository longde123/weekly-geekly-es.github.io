<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☪️ 🙏🏼 🧛🏿 Portage de Lode Runner de la Colombie-Britannique à UKNC 🌄 🔐 👩🏼‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En mars-mai de cette année, j'ai passé plusieurs semaines (le soir et le week-end) à porter le jouet Lode Runner du BK-0010 au UKSC. 
 Capture d'écran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Portage de Lode Runner de la Colombie-Britannique à UKNC</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383497/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mars-mai de cette année, j'ai passé plusieurs semaines (le soir et le week-end) à porter le jouet Lode Runner du BK-0010 au UKSC. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capture d'écran du menu porté:</font></font><br>
<img src="https://habrastorage.org/files/1d3/d35/f41/1d3d35f4111c4f4c9e4324d8e285ea26.png"><br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Écran de jeu de la version portée: </font></font><br>
<img src="https://habrastorage.org/files/4f0/798/b1f/4f0798b1ff524bcab9d1a8039ccd8473.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BK-0010 est un ordinateur domestique de la fin des années 1980 et du début des années 1990, et en partie un ordinateur scolaire (classes KUVT-86). </font><font style="vertical-align: inherit;">UKSC est un ordinateur scolaire des années 1990. </font><font style="vertical-align: inherit;">BC et UKSC sont partiellement compatibles dans l'architecture et le système de commande - les deux ordinateurs remontent à la famille PDP-11.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sélection de jeux</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'à cette année, je n'avais rien écrit de sérieux sous UKSC, mais je devais comprendre le code machine. </font><font style="vertical-align: inherit;">Il y avait un désir d'écrire quelque chose, mais généralement j'ai de gros problèmes avec le temps libre, donc ça ne marcherait pas à partir de zéro. </font><font style="vertical-align: inherit;">Et pour commencer, il vaut mieux prendre la tâche plus facilement. </font><font style="vertical-align: inherit;">Lors du portage, la quantité de travail est généralement beaucoup moins importante que lors de l'écriture à partir de zéro - vous rencontrez principalement des problèmes d'incompatibilité entre les deux systèmes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le forum zx.pk.ru (l'un des sites où les fans de rétrocomputing en général et de machines compatibles PDP-11 en particulier se retrouvent), le participant hobot a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salué la mise en œuvre de Lode Runner sur la Colombie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Britannique</font></a><font style="vertical-align: inherit;"> - c'était en fait la raison, pour commencer j'ai essayé de «regarder» le code du jouet , eh bien, je me suis impliqué. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menu de la version originale:</font></font><br>
<img src="https://habrastorage.org/files/8ba/13b/271/8ba13b271f1c441e9f561d6dd4998e0b.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'écran de jeu de la version originale (sur le moniteur couleur):</font></font><br>
<img src="https://habrastorage.org/files/e7a/798/d50/e7a798d5016f47129bc81b51ddfa59bb.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rétro-ingénierie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques semaines le soir et le week-end, j'ai passé du temps à analyser et à démonter. </font><font style="vertical-align: inherit;">Dans l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">émulateur, BKBTL a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ajouté la possibilité de collecter </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">une trace</font></a><font style="vertical-align: inherit;"> , c'est-à-dire que chaque instruction est démontée et enregistrée dans un fichier texte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je fais un tour de la section qui m'intéresse avec l'enregistrement de la trace, puis je désactive la trace (sort &amp; uniq) - j'obtiens des fragments de la logique. </font><font style="vertical-align: inherit;">J'ajoute des commentaires à cela, j'obtiens progressivement un fichier commun.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble simple, mais en fait c'est un travail assez compliqué basé sur des conjectures et leur confirmation ou réfutation. Par exemple, on regarde que l'adresse 001756 avant le début du jeu reçoit la valeur 10, puis elle est décrémentée, lorsqu'elle atteint 0, le jeu se termine - apparemment c'est le nombre de vies. Nous en trouvons la confirmation, nous plaçons des commentaires sur le texte où se trouve cette adresse. Ceci est un exemple assez simple, dans des cas plus complexes, j'ai passé beaucoup de temps à comprendre ce qui se passait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque le volume reçu est devenu assez important (plus de 40 Ko de texte, plus de 1500 lignes) et j'ai compris au moins en termes généraux ce qui se passait, comment il était stocké et affiché - j'ai commencé à réfléchir à la façon de le traduire au UKSC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous pouvez consulter la liste finale résultant du démontage:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/nzeemin/uknc-loderunner/blob/master/original/loderunner.lst</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Labyrinthe</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque labyrinthe est composé de 20 lignes de 30 blocs, soit un total de 600 blocs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le type de bloc est codé par un nombre de 0 à 7 - trois bits, triplet. </font><font style="vertical-align: inherit;">Pour un mot de 16 bits, 5 triplets complets sont obtenus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous travaillez avec des machines de type PDP-11, un système à 8 décimales est largement utilisé, il est donc très pratique d'utiliser des triplets. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, chaque labyrinthe tient dans 240 octets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Types de blocs:</font></font><br>
<pre><code class="hljs haskell">;	<span class="hljs-number">0</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">1</span> <span class="hljs-comment">--  </span>
;	<span class="hljs-number">2</span> <span class="hljs-comment">--  </span>
;	<span class="hljs-number">3</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">4</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">5</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">6</span> <span class="hljs-comment">-- </span>
;	<span class="hljs-number">7</span> <span class="hljs-comment">-- </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sprites de ces objets sont classés dans l'ordre de numérotation des types de blocs. </font><font style="vertical-align: inherit;">Lorsqu'un labyrinthe est décodé, en même temps une «image de labyrinthe» est créée dans la mémoire (par octet par bloc), et l'état initial du labyrinthe est dessiné à l'écran.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation de l'écran</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le BC, l'écran est adressé directement en accédant à la mémoire, les lignes vont les unes après les autres, en fait c'est un "framebuffer", et je dirais que ça va - c'est très pratique pour programmer des graphiques. Ligne BC - 256 pixels couleur, 64 octets par ligne. Mais le nombre de pixels dans une rangée dépend de la façon dont vous avez connecté le moniteur: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
s'il est en noir et blanc, il s'agit de 512 pixels n / b dans une rangée (1 bit par pixel, 8 pixels par octet), </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et s'il s'agit de la sortie couleur , il s'agit alors de 256 pixels couleur par ligne (2 bits par pixel, 4 pixels par octet).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'UKSC, l'organisation de l'écran est complètement différente et beaucoup plus compliquée. </font><font style="vertical-align: inherit;">L'écran repose sur trois blocs de mémoire, trois «plans». </font><font style="vertical-align: inherit;">Et chaque pixel est de trois bits, un peu dans chaque plan - nous obtenons 8 couleurs. </font><font style="vertical-align: inherit;">Au UKSC, nous avons plusieurs modes vidéo - 640 × 288, 320 × 288, 160 × 288, plus précisément, nous avons toujours exactement 288 lignes et vous pouvez appliquer votre propre diviseur à chaque ligne individuelle, en obtenant différentes résolutions horizontales. </font><font style="vertical-align: inherit;">Pour l'unité centrale de traitement (CPU), les plans d'écran ne sont pas directement accessibles, uniquement via l'accès aux ports. </font><font style="vertical-align: inherit;">De plus, seuls deux plans sur trois sont disponibles pour le CPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, le mode 320 × 288 me convenait bien - la ligne est obtenue en 320 pixels couleur de 80 octets de long dans chacun des trois plans. </font><font style="vertical-align: inherit;">Si vous utilisez deux plans, les pixels sont également en quadrichromie - presque comme sur un BC.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synthèse</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a commencé à écrire des exemples en assembleur de l'UKSC et était un peu déprimé - car le cycle «compilé - lié - lancé» est assez lent. Le problème est dans les outils. Il existe un assembleur croisé MACRO11, bien qu'il soit quelque peu bogué. Mais il n'y a pas de réticulant. Mais heureusement, il n'y a pas si longtemps, Patron a publié la console RT-11: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zx-pk.ru/showthread.php?t=24755</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - en fait, c'est un émulateur d'une machine compatible PDP11 qui interagit avec la ligne de commande du système d'exploitation comme avec un terminal. Ainsi, il est devenu possible de compiler et de lier les moyens natifs de RT-11. Je considère cela comme une véritable percée, accélérant considérablement le travail.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, les choses se sont bien passées, j'ai fait un dessin du cadre du terrain de jeu, dessiné des sprites, compris comment mélanger les bits dans les sprites (j'ai écrit un programme C # pour les mélanger), puis j'ai commencé à transférer les blocs du fichier partagé avec disasma vers les nouvelles sources en blocs. J'ai pris un vidage de mémoire du BC, alloué un bloc où se trouvent les niveaux, l'utilitaire RT11 DUMP a fait un manuel pour les niveaux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, j'ai transféré un bloc de code qui affiche le niveau, sur ce j'ai débogué la sortie des sprites. Puis il a commencé à transférer la logique du jeu. Ceux. en général, le transfert est presque un à un, à l'exception des endroits où passe l'écran. Par conséquent, il y a des endroits dans la logique où je ne comprends pas comment ils fonctionnent (le même enfer de l'IA), mais cela n'a pas d'importance - l'essentiel est qu'ils fonctionnent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, au début du mois de mai (lorsque le travail principal m'a absorbé à nouveau), une option de travail a été obtenue, bien que sans son.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Photo d'un jeu de travail sur une vraie machine (merci hobot):</font></font><br>
<img src="https://habrastorage.org/files/08e/a17/867/08ea17867ee7451794d3f5c7d099c698.jpg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Références</font></font></h3><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zx-pk.ru/showthread.php?t=24886</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fil sur ce sujet sur zx.pk.ru</font></font></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr383497/">https://habr.com/ru/post/fr383497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr383485/index.html">The Void: un parc d'attractions en réalité virtuelle</a></li>
<li><a href="../fr383489/index.html">La plateforme musicale SoundCloud attaquée par les détenteurs de droits d'auteur</a></li>
<li><a href="../fr383491/index.html">Un serveur cloud aux Pays-Bas et aux États-Unis jusqu'à 2 mois est gratuit pour les utilisateurs enregistrés</a></li>
<li><a href="../fr383493/index.html">Pétition sur l'octroi aux citoyens du droit de distribuer indépendamment leurs propres impôts</a></li>
<li><a href="../fr383495/index.html">Survie en Russie. «Huskies, reposts, tweets: comment ne pas violer la législation anti-extrémiste»</a></li>
<li><a href="../fr383499/index.html">Notch traverse des moments difficiles</a></li>
<li><a href="../fr383501/index.html">Aux États-Unis, a lancé une expérience pour simuler un vol vers Mars d'une durée de 365 jours</a></li>
<li><a href="../fr383503/index.html">Фотоэлементы из перовскита: пять граммов на квадратный метр</a></li>
<li><a href="../fr383505/index.html">EJTAG: аттракцион для хакеров-2</a></li>
<li><a href="../fr383507/index.html">Projets de la base lunaire: histoire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>