<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§˜ğŸ¾ ğŸ ğŸ“ L'Ã©volution de la recherche - comment acheter un piano en trois clics ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘ŒğŸ¿ ğŸ˜°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Auparavant, sur Avito, vous pouviez trouver le bon produit en utilisant le filtrage par mots clÃ©s ou la navigation dans l'arborescence des catÃ©gories....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'Ã©volution de la recherche - comment acheter un piano en trois clics</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/429076/"><p>  Auparavant, sur Avito, vous pouviez trouver le bon produit en utilisant le filtrage par mots clÃ©s ou la navigation dans l'arborescence des catÃ©gories.  Cette mÃ©thode, bien qu'elle paraisse familiÃ¨re, n'Ã©tait pas toujours pratique - pour trouver un produit ou un service, il fallait faire un grand nombre de clics.  Il y a plus d'un an, nous avons gagnÃ© en pertinence, grÃ¢ce Ã  quoi la recherche s'est amÃ©liorÃ©e, et maintenant il est plus facile et plus pratique de trouver un produit ou un service mÃªme sur la page principale.  Avec cette innovation, des marchandises inadaptÃ©es et franchement Â«poubellesÂ» ont cessÃ© de tomber dans le problÃ¨me.  Et ce n'est lÃ  qu'une des Ã©tapes pour amÃ©liorer votre recherche.  Nous modifions progressivement l'infrastructure, ce qui nous permet de travailler plus intensÃ©ment sur la qualitÃ© de la recherche, de l'amÃ©liorer plus rapidement et de dÃ©ployer de nouvelles fonctionnalitÃ©s qui profitent aux vendeurs et aux acheteurs sur Avito. </p><br><p>  Dans l'article, je vais vous dire comment la recherche sur Avito a changÃ©: comment nous avons commencÃ© et comment nous nous dirigeons maintenant vers l'amÃ©lioration de la vie de nos utilisateurs, et partagerai nos innovations Ã  la fois dans le produit et dans son remplissage - la partie technique.  Il n'y aura pas de viande hardcore ici, mais j'espÃ¨re que vous l'apprÃ©cierez. </p><br><img src="https://habrastorage.org/webt/19/zx/he/19zxhesvegeiygbo4haapoe4mic.png"><a name="habracut"></a><br><p>  Quelques notes d'introduction: Avito est le service publicitaire le plus populaire en Russie.  Nous avons plus de 450 000 annonces par jour et le nombre mensuel de visiteurs uniques atteint 35 millions, ce qui fait plus de 140 millions de recherches par jour. </p><br><h1 id="tipichnyy-scenariy-poiska-ranshe">  ScÃ©nario de recherche typique avant </h1><br><p>  Regardons un exemple simple du fonctionnement d'une recherche il y a plus d'un an.  Supposons que vous ayez besoin d'un piano (enfin, pourquoi pas?).  On va Ã  la page principale, on tape Â«pianoÂ». </p><br><img src="https://habrastorage.org/webt/yh/jq/di/yhjqdiamdihyfnkermrcwkhwzpq.png"><br><p>  Dans le cadre de l'extradition, vous recevrez trÃ¨s probablement des dÃ©mÃ©nageurs, des services de transport de piano ou quelque chose de similaire, mais pas un instrument de musique. </p><br><img src="https://habrastorage.org/webt/wy/dp/rm/wydprmf6to16xbqxq6mfkpfqlno.png"><br><p>  Cela se produit car nous aurons un tri par date de placement - et ces services sont placÃ©s le plus souvent. </p><br><img src="https://habrastorage.org/webt/bt/m8/rz/btm8rzqberfol38jrn2uln1ipju.jpeg"><br><p>  Pour voir le piano, vous devez spÃ©cifier la catÃ©gorie.  On clique sur la rubrique "Hobbies et loisirs", on descend l'arborescence des catÃ©gories jusqu'Ã  "Instruments de musique", puis "Instruments Ã  clavier". </p><br><img src="https://habrastorage.org/webt/d1/h2/oq/d1h2oqqqz5gv9snlihpiu51yzau.png"><br><img src="https://habrastorage.org/webt/be/c2/zf/bec2zflrha8wktusuudqo1w3o08.png"><br><p>  Et seulement aprÃ¨s cela, nous voyons le piano que nous recherchions. </p><br><img src="https://habrastorage.org/webt/-c/wz/71/-cwz71ifodfnrcda86qj03u__5y.png"><br><p>  Il s'avÃ¨re que pour trouver l'annonce souhaitÃ©e, il y avait les options suivantes: </p><br><ul><li>  affinement de la catÃ©gorie lors de la recherche par mots-clÃ©s, </li><li>  tri par fraÃ®cheur et prix, </li><li>  filtres </li><li>  rechercher uniquement par nom. </li></ul><br><h1 id="chto-izmenilos-blagodarya-relevantnosti">  Ce qui a changÃ© en raison de la pertinence </h1><br><p>  En raison de leur pertinence, les annonces qui ne correspondent pas du tout ont cessÃ© d'Ãªtre incluses dans l'Ã©mission.  Maintenant, si vous cherchez un piano sur la page principale, vous ne verrez probablement pas les services de chargeurs qui vous aideront Ã  le transporter, mais vous verrez immÃ©diatement l'instrument de musique que vous voulez.  Dans le mÃªme temps, un nouveau tri a Ã©tÃ© ajoutÃ© - Â«Par dÃ©fautÂ».  Il est formÃ© de deux indicateurs: la pertinence de l'annonce par rapport Ã  la requÃªte de texte et la fraÃ®cheur. </p><br><img src="https://habrastorage.org/webt/oc/p_/ry/ocp_rycbztfxg1fdvec-3usu0cm.png"><br><p>  En haut, vous voyez le plus rÃ©cent des plus pertinents. </p><br><img src="https://habrastorage.org/webt/cg/md/pq/cgmdpq3ogawjuoqf4cr66l17gr0.png"><br><p>  Sur Avito, moyennant des frais supplÃ©mentaires, vous pouvez augmenter votre annonce.  Et avec l'introduction de la pertinence, les augmentations rÃ©munÃ©rÃ©es fonctionnent plus efficacement.  Ils fonctionneront, tout d'abord, si votre annonce est pertinente pour la requÃªte textuelle. </p><br><p>  L'introduction de la pertinence ne signifie pas que nous avons complÃ¨tement abandonnÃ© les transitions vers l'arbre des catÃ©gories.  Dans la plupart des cas, nous avons rÃ©duit le nombre de clics vers l'annonce souhaitÃ©e lors de la recherche Ã  partir de la page principale.  Si vous avez encore besoin de services de transport, mÃªme si vous venez de taper Â«pianoÂ» dans la recherche, parcourez l'arborescence des catÃ©gories et vous trouverez ces annonces.  La recherche a Ã©galement commencÃ© Ã  fonctionner plus efficacement et dans la catÃ©gorie, par exemple, Â«Articles personnelsÂ» et Â«Appareils mÃ©nagersÂ». </p><br><h1 id="kak-nayti-nuzhnyy-tovar-v-tri-klika">  Comment trouver le bon produit en trois clics </h1><br><p>  La recherche devient plus pratique pour les utilisateurs, non seulement en raison de la qualitÃ© des rÃ©sultats de la recherche.  Il existe d'autres moyens de l'amÃ©liorer.  L'un d'eux transmet Ã  la catÃ©gorie.  Par exemple, nous recherchons Lamborghini Gayardo (oui, vous aimez jouer du piano et vous voulez monter Lamborghini).  Pour entrer dans la catÃ©gorie d'une voiture d'un modÃ¨le particulier, vous devez faire deux clics supplÃ©mentaires.  Avec pertinence, vous obtiendrez trÃ¨s probablement ce que vous voulez. </p><br><img src="https://habrastorage.org/webt/vd/d0/-y/vdd0-ymtzuq15oeaxe_bdikffne.png"><br><p>  Mais il existe une mÃ©thode supplÃ©mentaire qui vous mettra immÃ©diatement dans les voitures.  L'Ã©mission sera restreinte, la bonne voiture sera sÃ©lectionnÃ©e dans les filtres et vous recevrez vraiment des voitures dans l'Ã©mission. </p><br><img src="https://habrastorage.org/webt/xq/b_/7v/xqb_7v4xa6vmvo4rtt88h8yvttk.png"><br><img src="https://habrastorage.org/webt/vo/lk/yo/volkyo_aktkx5cemgpd9fvy2hp4.png"><br><p>  Une autre faÃ§on est d'Ã©tendre les balises.  Par exemple, lorsque vous entrez le mot Â«vesteÂ», vous obtiendrez des indices. </p><br><img src="https://habrastorage.org/webt/mv/7q/si/mv7qsiygsxehsjbl0pkctnhykjo.png"><br><p>  La capture d'Ã©cran ci-dessus montre les conseils: le type de vestes - femme, homme, pour filles, pour garÃ§ons.  Si vous cliquez sur Â«Pour les fillesÂ», vous tomberez immÃ©diatement dans la catÃ©gorie oÃ¹ les filtres appropriÃ©s seront sÃ©lectionnÃ©s.  Un ensemble de balises supplÃ©mentaires supplÃ©mentaires apparaÃ®tra Ã©galement ici: veste d'hiver, cuir, neuf et ainsi de suite.  Si vous descendez manuellement l'arborescence des catÃ©gories jusqu'au produit souhaitÃ©, vous devez effectuer plus d'actions. </p><br><img src="https://habrastorage.org/webt/4k/hq/vg/4khqvgdpjs1sgxhb_icjrxl__v0.png"><br><h1 id="v-chem-raznica-mezhdu-poiskom-i-filtrami">  Quelle est la diffÃ©rence entre la recherche et les filtres </h1><br><p>  Lorsque j'ai parlÃ© Ã  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RIT ++</a> , le public avait une question: quelle est la diffÃ©rence entre la recherche de texte et les filtres?  Tout est assez simple.  Vous pouvez Ã©galement trouver l'annonce souhaitÃ©e sans demande de texte en descendant dans l'arborescence des catÃ©gories.  Dans ce cas, la recherche trouvera toujours des biens et services, non pas par le texte donnÃ©, mais par l'ensemble de paramÃ¨tres transmis Ã  partir des filtres correspondants de la catÃ©gorie sÃ©lectionnÃ©e. </p><br><p>  Chaque catÃ©gorie a son propre ensemble de filtres.  Par exemple, dans la catÃ©gorie Â«VoituresÂ» - certains filtres, dans la catÃ©gorie Â«Objets personnelsÂ» - d'autres filtres.  Autrement dit, les filtres sont liÃ©s de maniÃ¨re rigide Ã  une catÃ©gorie. </p><br><h1 id="razmeschenie-obyavleniya-za-dve-minuty">  Placement de l'annonce en deux minutes </h1><br><p>  Une innovation importante est apparue pour les vendeurs qu'ils ressentent lors de la soumission de leur annonce.  Si votre annonce ne contient aucun "interdit" ou n'est pas un doublon - la bonne annonce habituelle - vous la verrez dans l'Ã©mission presque immÃ©diatement.  En fait, ce dÃ©lai dure environ deux minutes, mais dans de rares cas, il peut Ãªtre prolongÃ© jusqu'Ã  30 minutes.  Auparavant, une annonce n'apparaissait toujours sur le site qu'aprÃ¨s une demi-heure. </p><br><h1 id="avito-pomoschnik">  Assistant Avito </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avito Helper</a> est une extension pour Chrome qui affiche le prix d'un produit similaire sur Avito sur des sites tiers.  Dans l'extension, vous pouvez comparer les prix dans de nombreuses boutiques en ligne avec les prix d'Avito, ou simplement rechercher les produits et services nÃ©cessaires dans notre service, sans aller directement sur le site Web ou l'application.  Nous avons pu implÃ©menter l 'Â«AssistantÂ», notamment grÃ¢ce aux nouveaux changements d'infrastructure. </p><br><img src="https://habrastorage.org/webt/d5/hv/cw/d5hvcwkpl7-npnqilrei9wfcz80.png"><br><h1 id="arhitektura">  L'architecture </h1><br><h2 id="pilim-monolit">  Scier un monolithe </h2><br><p>  Avito a un monolithe en PHP.  Il y a un an, toutes les fonctionnalitÃ©s de recherche qui fonctionnent dans Avito se trouvaient dans ce monolithe.  La recherche dans le monolithe a fonctionnÃ© avec quatre plates-formes: Android, iOS, la version mobile dans le navigateur et le bureau.  Pour donner la sortie, les requÃªtes SQL correspondantes ont Ã©tÃ© gÃ©nÃ©rÃ©es dans Sphinx Ã  l'intÃ©rieur de ce code, le traitement Ã©tait en cours et la sortie a Ã©tÃ© envoyÃ©e au format JSON ou HTML.  Ensuite, les utilisateurs ont vu ce qu'ils cherchaient. </p><br><img src="https://habrastorage.org/webt/cw/l_/rn/cwl_rnema8zlhzfu4gnrrgrz1jq.jpeg"><br><h2 id="chto-u-nas-seychas">  Ce que nous avons maintenant </h2><br><p>  Si vous implÃ©mentez de nouvelles fonctionnalitÃ©s, il est trÃ¨s difficile de l'intÃ©grer Ã  ce monolithe.  Par consÃ©quent, nous avons dÃ©cidÃ© de dÃ©velopper un service de recherche, que nous avons appelÃ© Â«recherchÃ©Â».  Maintenant, le monolithe va Ã  ce service de recherche et le service va Ã  Sphinx. </p><br><img src="https://habrastorage.org/webt/wk/rf/up/wkrfupfza_kexfbo_yiafhq-lz4.jpeg"><br><h2 id="prichiny-sozdaniya-poiskovogo-servisa">  Raisons de crÃ©er un service de recherche </h2><br><p>  Lors du dÃ©veloppement de services, vous devez toujours comprendre pourquoi vous faites cela.  Le premier avantage Ã©vident est la suppression de la logique de bas niveau.  Dans notre cas, cela cache la cuisine pour le traitement des requÃªtes SphinxQL.  De plus, nous pouvons fournir plus facilement des fonctionnalitÃ©s de recherche aux systÃ¨mes tiers. </p><br><p>  ExÃ©cution de requÃªte asynchrone.  Cet avantage est assez Ã©vident et selon la mise en Å“uvre, l'un ou l'autre succÃ¨s peut Ãªtre obtenu.  Notre service a Ã©tÃ© implÃ©mentÃ© sur Golang, et il y avait des fonctionnalitÃ©s qui pouvaient Ãªtre parallÃ©lisÃ©es - trois demandes dans Sphinx, ce qui a donnÃ© de bons rÃ©sultats. </p><br><p>  DÃ©ploiement rapide.  Nous avons identifiÃ© une fonctionnalitÃ© distincte avec moins de code, des tests supplÃ©mentaires (le monolithe a beaucoup de tests, pas seulement des fonctionnalitÃ©s de recherche), et il est plus facile Ã  dÃ©ployer.  Plus important encore, grÃ¢ce Ã  une approche rÃ©ussie de la mise en Å“uvre de ce service, nous avons pu rÃ©duire des choses intÃ©ressantes et implÃ©menter des algorithmes de classement avancÃ©s - pour effectuer un traitement assez compliquÃ© que nous ne pouvions pas faire dans un monolithe.  Cela nous fournit une trÃ¨s bonne base pour expÃ©rimenter la qualitÃ© de la recherche. </p><br><p>  En prime, nous avons la possibilitÃ© de passer de Sphinx Ã  Elastic, car la logique de bas niveau est dÃ©sormais masquÃ©e. </p><br><p>  Ce diagramme montre dÃ©jÃ  le cas oÃ¹ il existe un monolithe, le service "Recherche" et le service tiers "Avito Assistant". </p><br><img src="https://habrastorage.org/webt/ed/3s/ws/ed3swsgnqulgqx9lokpg6l4po8g.jpeg"><br><h2 id="kak-rabotaet-poiskovyy-servis">  Comment fonctionne un service de recherche? </h2><br><p>  Il dispose d'un ensemble d'agrÃ©gateurs.  Chaque agrÃ©gateur exÃ©cute une certaine logique mÃ©tier liÃ©e au traitement de l'Ã©mission.  Il peut former ce problÃ¨me d'une certaine maniÃ¨re. </p><br><p>  La demande arrive au planificateur.  L'ordonnanceur sÃ©lectionne l'agrÃ©gateur en fonction des critÃ¨res de requÃªte en fonction de ses paramÃ¨tres (ou si l'agrÃ©gateur souhaitÃ© est spÃ©cifiÃ© dans la demande elle-mÃªme).  L'agrÃ©gateur va Ã  Sphinx.  Ayant reÃ§u une rÃ©ponse de Sphinx, il gÃ©nÃ¨re une sortie et donne la rÃ©ponse au client. </p><br><img src="https://habrastorage.org/webt/f9/56/lj/f956ljoot6y6pas3k94vkb8bo3k.gif"><br><p>  Dans ce cas, la demande Ã©tait Ã  l'extÃ©rieur, pas Ã  partir du cloud dans lequel notre service de recherche fonctionne.  Mais une autre option est Ã©galement possible: certains autres de nos services, Ã  l'intÃ©rieur du cloud, par exemple, Avito Assistant, se tournent vers un service de recherche.  Cette demande va dÃ©jÃ  Ã  un autre agrÃ©gateur - il existe une autre logique mÃ©tier.  Voici comment cela fonctionne: </p><br><img src="https://habrastorage.org/webt/vb/gb/yu/vbgbyukk8a5yynkv5kupow23s6y.gif"><br><h2 id="kak-rabotaet-asinhronnoe-vypolnenie-zaprosov-na-agregatore">  Fonctionnement de l'exÃ©cution de requÃªtes asynchrones sur l'agrÃ©gateur </h2><br><p>  L'agrÃ©gateur se compose de plusieurs profils.  Un profil est, en gros, une entitÃ© dans laquelle vous pouvez obtenir une annonce d'un certain type ou d'une maniÃ¨re spÃ©cifique.  Par exemple, cela peut s'expliquer par une analogie: il y a des publicitÃ©s Â«PremiumÂ», Â«VIPÂ» et rÃ©guliÃ¨res sur Avito.  L'agrÃ©gateur reÃ§oit une demande de l'ordonnanceur, tandis que des demandes parallÃ¨les sont exÃ©cutÃ©es pour l'ensemble de profils connus dans l'agrÃ©gateur.  Le profil contient un pilote qui accÃ¨de physiquement au niveau sous-jacent, dans ce cas dans Sphinx, mais il peut s'agir de n'importe quelle autre source de donnÃ©es </p><br><img src="https://habrastorage.org/webt/la/np/ic/lanpiclts0oo-uhfktoxszkxl3g.jpeg"><br><p>  L'agrÃ©gateur peut simplement donner au planificateur les rÃ©sultats des requÃªtes sur les profils, et il peut Ã©galement effectuer des actions plus complexes, par exemple, mÃ©langer ces rÃ©sultats en utilisant l'un ou l'autre algorithme. </p><br><img src="https://habrastorage.org/webt/zy/_o/ji/zy_ojiffyfpbt4h9vmkcyciqsuy.jpeg"><br><h2 id="hranenie-poiskovogo-indeksa">  Stockage d'index de recherche </h2><br><p>  Ã‰tant donnÃ© que nous utilisons Kubernetes dans l'architecture, au RIT ++, on m'a posÃ© une question sur le stockage de l'index de recherche - est-il stockÃ© dans Kubernetes?  Non, nous avons Sphinx vivant sur des machines physiques.  Chez Kubernetes, nous dÃ©ployons un service de recherche qui traite la logique de recherche.  Le cloud contient Ã©galement un exemple d'index de recherche pour l'environnement de dÃ©veloppement sur lequel les tests sont exÃ©cutÃ©s, mais il n'est pas souhaitable d'y mettre un index de combat, car les services qui fonctionnent dans Kubernetes sont, tout d'abord, des services sans Ã©tat. </p><br><h2 id="nagruzka-na-poiskovyy-servis">  Charge de service de recherche </h2><br><p>  Maintenant que ce service est en bataille, il sert 100% de la charge Ã  quelques exceptions prÃ¨s.  La charge qu'il dÃ©tient est d'environ 200 krpm.  DÃ©lai: mÃ©diane - jusqu'Ã  17 ms, 95 centile - jusqu'Ã  120 ms, 99 centile - jusqu'Ã  320 ms. </p><br><img src="https://habrastorage.org/webt/bt/46/ny/bt46nyowpcuqysikxjcpp2weov8.png"><br><img src="https://habrastorage.org/webt/bn/fj/hx/bnfjhx1hqse5b4lfok8cgv3ez04.png"><br><h2 id="itogo-po-poiskovomu-servisu">  Service de recherche totale </h2><br><p>  Le service de recherche est Ã©crit en Golang, dÃ©ployÃ© sur Kubernetes, l'agrÃ©gateur fonctionne de maniÃ¨re asynchrone avec plusieurs profils.  Le profil fonctionne avec le pilote spÃ©cifiÃ©, le pilote accÃ¨de Ã  la source de donnÃ©es spÃ©cifiÃ©e, par exemple, Sphinx.  Le nombre de demandes que notre service dessert est jusqu'Ã  200 krpm pour le moment.  DÃ©lai: mÃ©diane - jusqu'Ã  17 ms, 95 centile - jusqu'Ã  120 ms, 99 centile - jusqu'Ã  320 ms. </p><br><h2 id="vnedrenie-servisa-v-rabochuyu-sistemu">  ImplÃ©mentation du service dans un systÃ¨me fonctionnel </h2><br><p>  Le problÃ¨me de la double fonctionnalitÃ© est assez Ã©vident, nous devons prendre en charge deux bases de code qui doivent effectuer la mÃªme tÃ¢che.  Nous avons besoin d'un repli.  Nous l'avons appelÃ© Â«paillesÂ» - nous nous sommes souvenus de Â«jeter des paillesÂ».  De plus, nous avons besoin d'un contrÃ´le du trafic, il est souhaitable qu'il soit rapide, via un tableau de bord. </p><br><h2 id="kak-rabotaet-solomka">  Comment fonctionne la "paille" </h2><br><p>  La requÃªte de recherche concerne la Â«PailleÂ», qui fonctionne Ã  l'intÃ©rieur du monolithe et peut effectuer un nouvel appel Ã  une nouvelle recherche ou Ã  une ancienne.  Elle appelle une nouvelle recherche, il la remplit et si elle rÃ©ussit, nous obtenons simplement le rÃ©sultat d'une nouvelle recherche. </p><br><img src="https://habrastorage.org/webt/y1/xa/wm/y1xawmqms1bxqtotevfsl7bfatu.gif"><br><p>  Il y a des situations oÃ¹ certaines requÃªtes au service de recherche Ã©chouent: par exemple, et jusqu'Ã  ce qu'une sorte de fonctionnalitÃ© soit implÃ©mentÃ©e Ã  l'intÃ©rieur du service de recherche.  Ensuite, nous engageons nÃ©cessairement une telle demande - "The Straw" l'exÃ©cutera dans l'ancienne recherche.  L'ancienne recherche du monolithe se tournera vers Sphinx, et la rÃ©ponse ira au client.  Le client ne ressentira rien. </p><br><img src="https://habrastorage.org/webt/cr/zu/za/crzuzaufpka6dvpjsjy_m5qq0jc.gif"><br><p>  Un schÃ©ma assez fiable, et il est toujours intÃ©ressant de voir ce qui se passe dans la pratique.  Le dÃ©partement d'architecture d'Avito amÃ©liore constamment notre cloud, l'optimisant, le rendant plus fiable et plus productif.  Ã€ un certain stade, il y avait des problÃ¨mes lors de l'entretien d'un des nÅ“uds avec une intensitÃ© suffisamment Ã©levÃ©e, des erreurs provenaient du monolithe (100 erreurs par seconde). </p><br><img src="https://habrastorage.org/webt/tu/zv/wm/tuzvwmgmpzid5objz-4bmvl157y.png"><br><p>  Dans le mÃªme temps, le dÃ©lai de service a fortement augmentÃ© - dans l'image ci-dessous, vous pouvez voir des pics. </p><br><img src="https://habrastorage.org/webt/pq/of/z5/pqofz5fynz2bsibynewd3gro2cw.png"><br><p>  La Â«pailleÂ» a remarquablement rÃ©solu cette situation, et les erreurs HTTP rÃ©sultantes Ã©taient au mÃªme niveau - une unitÃ© d'erreurs pour l'ensemble de l'Avito.  Nos visiteurs n'ont rien remarquÃ©. </p><br><img src="https://habrastorage.org/webt/wx/ya/ij/wxyaij2xka5dhghoa74ovncverq.png"><br><h2 id="avtomatizaciya-eksperimentov">  Automatisation des expÃ©riences </h2><br><p>  Nous voulons que la recherche se dÃ©veloppe rapidement et que le dÃ©ploiement de nouvelles fonctionnalitÃ©s soit plus facile.  Pour cela, une infrastructure appropriÃ©e est nÃ©cessaire.  Nous avons configurÃ© l'automatisation des tests A / B.  Ã€ l'aide du tableau de bord, nous pouvons dÃ©marrer de nouvelles expÃ©riences, les configurer en fonction des innovations ajoutÃ©es et, par consÃ©quent, exÃ©cuter des expÃ©riences sans faire rouler le monolithe. </p><br><p>  Dans l'Ã©tat initial, lorsqu'aucune expÃ©rience n'Ã©tait lancÃ©e, tous les visiteurs voient la fonctionnalitÃ© de recherche habituelle. </p><br><img src="https://habrastorage.org/webt/go/rz/qp/gorzqpca1whra33-df1c6ss18yk.jpeg"><br><p>  Dans une expÃ©rience typique, les utilisateurs sont divisÃ©s en groupes.  Le groupe de contrÃ´le - avec les fonctionnalitÃ©s habituelles pour nos visiteurs.  Il existe plusieurs groupes de tests - avec des innovations.  Lorsque nous devons crÃ©er une nouvelle expÃ©rience, dans le service de recherche, nous implÃ©mentons une nouvelle fonctionnalitÃ© de recherche (ajouter de nouveaux agrÃ©gateurs) et via le tableau de bord, nous configurons l'expÃ©rience avec les groupes nÃ©cessaires, en les reliant Ã  de nouveaux agrÃ©gateurs. </p><br><p>  Lors de l'analyse des expÃ©riences, nous comparons le comportement des visiteurs du groupe tÃ©moin avec ceux du test et, sur cette base, nous tirons des conclusions sur le succÃ¨s de l'expÃ©rience. </p><br><img src="https://habrastorage.org/webt/gd/g5/r2/gdg5r20saoh4inq46d5jggjcxee.gif"><br><p>  Supposons que nous ayons dÃ©veloppÃ© une nouvelle formule de classement.  Que devons-nous faire pour l'expÃ©rimenter? </p><br><ol><li>  Dans le service de recherche, dÃ©ployez l'agrÃ©gateur appropriÃ© (que ce soit Â«Aggregator 2Â»). </li><li>  CrÃ©ez une expÃ©rience via un tableau de bord et connectez l'un des groupes de cette expÃ©rience Ã  cet agrÃ©gateur. </li><li>  Maintenant, si une requÃªte arrive dans la recherche qui tombe dans le groupe de test, elle va au service de recherche sur Â«Aggregator 2Â». </li></ol><br><p>  Nous pouvons continuer Ã  crÃ©er de nouvelles expÃ©riences et associer leurs groupes de tests Ã  de nouveaux agrÃ©gateurs. </p><br><h1 id="itogo-po-infrastrukture-poiska">  Infrastructure de recherche totale </h1><br><p>  Il existe un cluster de serveurs Sphinx 3. Il contient 13 krps de requÃªtes SphinxQL et contient plus de 45 millions d'annonces actives. </p><br><p>  Sphinx 3.0 est stable et satisfait de ses performances.  Soit dit en passant, les binaires sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le domaine public</a> .  De plus, grÃ¢ce Ã  Avito, de nouvelles fonctionnalitÃ©s sont filmÃ©es dans Sphinx 3, par exemple, le fonctionnement du produit scalaire des vecteurs, et les bugs trouvÃ©s sont corrigÃ©s. </p><br><p>  Nous utilisons une architecture de service.  Nous avons le service de recherche "Iskalo" et le service "Avito Assistant".  Une partie de la fonctionnalitÃ© est restÃ©e dans le monolithe, mais nous continuons Ã  travailler sur sa dÃ©coupe. </p><br><h1 id="vyvody">  Conclusions </h1><br><p>  Au cours de la derniÃ¨re annÃ©e, un systÃ¨me de dÃ©veloppement de fonctionnalitÃ©s de recherche avancÃ©es a Ã©tÃ© reÃ§u.  Nous avons eu l'opportunitÃ© de mener des expÃ©riences rapides et flexibles.  Et maintenant, la recherche d'utilisateurs est devenue plus pratique, plus rapide et permet de mieux rÃ©soudre leurs problÃ¨mes. </p><br><h1 id="chto-dalshe">  Et ensuite </h1><br><p>  De plus, nous continuerons Ã  retirer du monolithe ce qui reste: rendu, filtres.  Nous travaillerons pour amÃ©liorer la qualitÃ© de la recherche, continuerons Ã  ravir nos visiteurs.  J'espÃ¨re aussi. </p><br><p>  Si vous avez des questions sur le travail de notre recherche, nous aimerions en savoir plus de dÃ©tails techniques, Ã©crivez dans les commentaires.  Je rÃ©pondrai avec plaisir.  Ã€ propos, rÃ©cemment, Andrey Drozdov a parlÃ© Ã  Highload ++ 2018 avec un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport sur l'optimisation multicritÃ¨re des rÃ©sultats de recherche</a> , voici sa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prÃ©sentation</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429076/">https://habr.com/ru/post/fr429076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429066/index.html">Comment l'Ã©quipage de l'aÃ©ronef se prÃ©pare au dÃ©part</a></li>
<li><a href="../fr429068/index.html">Un poste trÃ¨s corporate: ouverture Ã  Moscou ou pourquoi les 10 et 11 novembre sont de bons jours pour acheter de l'Ã©lectronique</a></li>
<li><a href="../fr429070/index.html">Linux ne peut pas Ãªtre chargÃ© sur de nouveaux MacBook en raison de la puce T2</a></li>
<li><a href="../fr429072/index.html">Pourquoi Kodak est mort et Fujifilm s'est Ã©panoui: l'histoire de deux cinÃ©astes</a></li>
<li><a href="../fr429074/index.html">Bonnes actions pour Google Money: nouveau dÃ©fi d'impact sur l'IA</a></li>
<li><a href="../fr429078/index.html">Comment crÃ©er de l'art procÃ©dural en moins de 100 lignes de code</a></li>
<li><a href="../fr429082/index.html">La ThaÃ¯lande sans stÃ©rÃ©otypes</a></li>
<li><a href="../fr429084/index.html">La deuxiÃ¨me vie du four Ã©lectrique "Kharkov"</a></li>
<li><a href="../fr429086/index.html">FÃªte de la biÃ¨re de sauvegarde</a></li>
<li><a href="../fr429088/index.html">ExÃ©cution de requÃªtes GraphQL avec OdataToEntity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>