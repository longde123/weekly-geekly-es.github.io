<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤸 🤠 🔤 Eine einfache und sichere Möglichkeit, die Bereitstellung von Kanarienvögeln mit Helm zu automatisieren 🤙🏿 💵 👶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die kanarische Bereitstellung ist eine sehr effektive Methode, um neuen Code für eine Untergruppe von Benutzern zu testen. Dadurch wird die Verkehrsla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine einfache und sichere Möglichkeit, die Bereitstellung von Kanarienvögeln mit Helm zu automatisieren</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/468013/"><img src="https://habrastorage.org/webt/im/p5/dz/imp5dzjfim9tzj6fs7iafpetfl0.jpeg"><br><br>  Die kanarische Bereitstellung ist eine sehr effektive Methode, um neuen Code für eine Untergruppe von Benutzern zu testen.  Dadurch wird die Verkehrslast erheblich reduziert, was während des Bereitstellungsprozesses zu Problemen führen kann, da sie nur innerhalb einer bestimmten Untergruppe auftritt.  Dieser Artikel befasst sich mit der Organisation einer ähnlichen Bereitstellung mithilfe von Kubernetes und der Bereitstellungsautomatisierung.  <i>Es wird davon ausgegangen, dass Sie etwas über die Ressourcen von Helm und Kubernetes wissen</i> . <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/uw/wf/lc/uwwflcg7sk94dwvjgec0ksjr8ca.png"><br><br>  Die einfache kanarische Bereitstellung von Kubernetes umfasst zwei wichtige Ressourcen: den Dienst selbst und das Bereitstellungstool.  Die kanarische Bereitstellung erfolgt über einen Dienst, der mit zwei verschiedenen Ressourcen interagiert, die den Aktualisierungsverkehr bedienen.  Eine dieser Ressourcen funktioniert mit der "kanarischen" Version und die zweite mit der stabilen.  In dieser Situation können wir die Anzahl der kanarischen Versionen anpassen, um den für die Wartung erforderlichen Datenverkehr zu reduzieren.  Wenn Sie beispielsweise Yaml bevorzugen, sieht dies in Kubernetes folgendermaßen aus: <br><br><pre><code class="xml hljs">kind: Deployment metadata: name: app-canary labels: app: app spec: replicas: 1 ... image: myapp:canary --- kind: Deployment metadata: name: app labels: app: app spec: replicas: 5 ... image: myapp:stable --- kind: Service selector: app: app # Selector will route traffic to both deployments.</code> </pre> <br>  Es ist noch einfacher, sich eine solche Option in kubectl vorzustellen, und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes-Dokumentation enthält</a> sogar ein vollständiges Tutorial zu diesem Szenario.  Die Hauptfrage dieses Beitrags ist jedoch, wie wir diesen Prozess mit Helm automatisieren können. <br><br><h3>  Automatisierung eines kanarischen Einsatzes </h3><br>  Zunächst benötigen wir die Helmkartenkarte, die bereits die von uns oben diskutierten Ressourcen enthält.  Es sollte ungefähr so ​​aussehen: <br><br><pre> <code class="xml hljs">~/charts/app ├── Chart.yaml ├── README.md ├── templates │ ├── NOTES.txt │ ├── _helpers.tpl │ ├── deployment.yaml │ └── service.yaml └── values.yaml</code> </pre> <br>  Grundlage des Helm-Konzepts ist die Verwaltung von Versionen mit mehreren Versionen.  Die stabile Version ist unser stabiler Hauptzweig des Projektcodes.  Aber mit Helm können wir mit unserem experimentellen Code eine kanarische Version bereitstellen.  Die Hauptsache ist, den Verkehrsaustausch zwischen der stabilen Version und der kanarischen Version aufrechtzuerhalten.  Wir werden dies alles mit einem speziellen Selektor verwalten: <br><br><pre> <code class="xml hljs">selector: app.kubernetes.io/name: myapp</code> </pre> <br>  Unsere "kanarischen" und stabilen Bereitstellungsressourcen geben dieses Etikett auf den Modulen an.  Wenn alles richtig eingerichtet ist, werden wir während der Bereitstellung der kanarischen Version unserer Helmkarte sehen, dass der Datenverkehr zu frisch bereitgestellten Modulen geleitet wird.  Eine stabile Version dieses Befehls sieht folgendermaßen aus: <br><br><pre> <code class="xml hljs">helm upgrade --install myapp \ --namespace default \ --set app.name=myapp \ # Goes into app.kubernetes.io/name --set app.version=v1 \ # Goes into app.kubernetes.io/version --set image.tag=stable \ --set replicaCount=5</code> </pre> <br>  Schauen wir uns jetzt unsere kanarische Veröffentlichung an.  Um die kanarische Version bereitzustellen, müssen wir uns zwei Dinge merken.  Der Versionsname muss unterschiedlich sein, damit das Update für die aktuelle stabile Version nicht aufgerollt wird.  Die Version und das Tag müssen auch unterschiedlich sein, damit wir unterschiedlichen Code bereitstellen und Unterschiede anhand von Ressourcenbezeichnungen identifizieren können. <br><br><pre> <code class="xml hljs">helm upgrade --install myapp-canary \ --namespace default \ --set app.name=myapp \ # Goes into app.kubernetes.io/name --set app.version=v2 \ # Goes into app.kubernetes.io/version --set image.tag=canary \ --set replicaCount=1</code> </pre> <br>  Das ist eigentlich alles!  Wenn Sie den Dienst anpingen, können Sie sehen, dass das kanarische Update den Verkehr nur teilweise weiterleitet. <br><br><hr><br>  Wenn Sie nach Tools für die Bereitstellungsautomatisierung suchen, die die beschriebene Logik enthalten, lesen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Deliverybot</a> und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Helm-Automatisierungstools auf GitHub</a> .  Die Helm-Diagramme, die zur Implementierung der oben beschriebenen Methode verwendet wurden, befinden sich hier auf Github.  Im Allgemeinen war dies ein theoretischer Überblick über die praktische Umsetzung des Einsatzes kanarischer Versionen mit spezifischen Konzepten und Beispielen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468013/">https://habr.com/ru/post/de468013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468001/index.html">Denken Sie nicht: Programme sind wirklich teurer geworden</a></li>
<li><a href="../de468003/index.html">5-GHz-Eisen: Eine Geschichte zum Erstellen eines superschnellen VDS</a></li>
<li><a href="../de468005/index.html">Sagen Sie ein Wort über glorreiche Unterstützung (24. September, Moskau)</a></li>
<li><a href="../de468007/index.html">Aber mache ich nicht wieder Bullshit? Wie und warum werden Qualitätsmetriken implementiert?</a></li>
<li><a href="../de468011/index.html">Die Geschichte eines hypothetischen Roboters</a></li>
<li><a href="../de468015/index.html">Was ist derzeit über ITIL 4 bekannt und wer nutzt die neue Bibliothek bereits?</a></li>
<li><a href="../de468017/index.html">Die Vielleicht-Monade über Async / Warten in C # (ohne Aufgabe ov!)</a></li>
<li><a href="../de468019/index.html">Website-Entwicklung in WebAssembly mit NetCore 3 und Blazor</a></li>
<li><a href="../de468021/index.html">PHP, wie viel Abstraktion für die Menschen?</a></li>
<li><a href="../de468023/index.html">Künstliche Intelligenz im Kampfspiel Shadow Fight 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>