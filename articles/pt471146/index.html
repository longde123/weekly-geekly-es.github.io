<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí´ üå∏ ‚úÖ Servi√ßos √≥rf√£os: o lado oposto da (micro) arquitetura de servi√ßo ‚õπüèª ‚ö™Ô∏è üñï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na confer√™ncia do ano passado, DevOpsDays Moscow, o diretor de opera√ß√µes do portal Banki.ru, Andrei Nikolsky, falou sobre servi√ßos √≥rf√£os: como identi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servi√ßos √≥rf√£os: o lado oposto da (micro) arquitetura de servi√ßo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/scienceman_events/blog/471146/">  Na confer√™ncia do ano passado, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DevOpsDays Moscow, o</a> diretor de opera√ß√µes do portal Banki.ru, Andrei Nikolsky, falou sobre servi√ßos √≥rf√£os: como identificar um √≥rf√£o na infraestrutura, quais s√£o os maus servi√ßos √≥rf√£os, o que fazer com eles e como ser, se nada ajudar. <br><br>  Abaixo do corte, est√° a vers√£o em texto do relat√≥rio. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/j9I4oeEXBO8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  Ol√° colegas!  Meu nome √© Andrey, lidero a opera√ß√£o no Banki.ru. <br><br>  Temos √≥timos servi√ßos, s√£o servi√ßos monol√≠ticos, existem servi√ßos em um sentido mais cl√°ssico, existem muito pequenos.  Na terminologia de meu trabalhador e campon√™s, digo que se o servi√ßo √© simples e pequeno, ent√£o √© micro, e se n√£o √© muito simples e n√£o √© pequeno, √© apenas um servi√ßo. <br><br><h3>  <b>Profissionais de servi√ßo</b> </h3><br>  Analisarei rapidamente as vantagens dos servi√ßos. <br><br><img src="https://habrastorage.org/webt/ji/xj/_u/jixj_uxelvtokkt54xoul15fsnu.png"><br><br>  A primeira √© a escala.  Voc√™ pode fazer algo rapidamente no servi√ßo e iniciar a produ√ß√£o.  Voc√™ chegou ao tr√¢nsito, clonou o servi√ßo.  Voc√™ ainda tem tr√°fego, ainda clonou e vive com ele.  Este √© um bom b√¥nus e, em princ√≠pio, quando come√ßamos, era considerado o mais importante entre n√≥s, por que fazemos tudo isso. <br><br><img src="https://habrastorage.org/webt/lc/oq/d3/lcoqd397ppryaemtruvd7awdoxe.png"><br><br>  Em segundo lugar, desenvolvimento isolado, quando voc√™ tem v√°rias equipes de desenvolvimento, v√°rios desenvolvedores diferentes em cada equipe e cada equipe v√™ algum tipo de servi√ßo. <br><br>  H√° uma nuance com as equipes.  Os desenvolvedores s√£o diferentes.  E h√°, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pessoas-flocos de neve</a> .  Vi pela primeira vez isso com Maxim Dorofeev.  √Äs vezes, as pessoas t√™m flocos de neve em algumas equipes e outras n√£o.  Isso torna os diferentes servi√ßos usados ‚Äã‚Äãna empresa um pouco desiguais. <br><br><img src="https://habrastorage.org/webt/_k/nk/ml/_knkmlyetdgucwl7bkuxuvtpahe.png"><br><br>  Olhe para a foto: ele √© um bom desenvolvedor, ele tem grandes m√£os, ele pode fazer muito.  O principal problema √© de onde essas m√£os crescem. <br><br><img src="https://habrastorage.org/webt/-6/li/zn/-6liznhfxdjynboqueccoayiat8.png"><br><br>  Os servi√ßos possibilitam o uso de diferentes linguagens de programa√ß√£o mais adequadas para diferentes tarefas.  Alguns servi√ßos no Go, outros no Erlang, outros no Ruby, outros no PHP, outros no Python.  Em geral, voc√™ pode se virar muito amplamente.  Tamb√©m h√° nuances aqui. <br><br><img src="https://habrastorage.org/webt/7h/ob/ka/7hobkajsj1y7nsdqr1sfoqt7ljo.jpeg"><br><br>  A arquitetura orientada a servi√ßos √© principalmente sobre devops.  Ou seja, se voc√™ n√£o possui automa√ß√£o, n√£o h√° processo de implanta√ß√£o; se voc√™ configurar com as m√£os, suas configura√ß√µes podem mudar de uma inst√¢ncia de servi√ßo para uma inst√¢ncia e voc√™ precisa ir l√° para fazer alguma coisa, ent√£o est√° no inferno. <br><br>  Por exemplo, voc√™ tem 20 servi√ßos e precisa implantar com as m√£os, 20 consoles e simultaneamente pressiona ‚Äúenter‚Äù, como um ninja.  Isso n√£o √© muito bom. <br><br>  Se voc√™ tiver um servi√ßo ap√≥s o teste (se houver, √© claro) e tamb√©m precisar√° finaliz√°-lo com um arquivo para que ele funcione na produ√ß√£o, tamb√©m tenho m√°s not√≠cias para voc√™. <br><br>  Se voc√™ confia nos servi√ßos espec√≠ficos da Amazon e trabalha na R√∫ssia, h√° dois meses voc√™ tamb√©m tinha "Tudo est√° pegando fogo, estou bem, tudo √© legal". <br><br><img src="https://habrastorage.org/webt/vu/z0/u6/vuz0u6eenpfaob592_jtdrnpp8e.png"><br><br>  Usamos Ansible para automa√ß√£o de implanta√ß√£o, Puppet para converg√™ncia, Bamboo para automa√ß√£o de implanta√ß√£o, Confluence para descrever tudo de alguma forma. <br><br>  N√£o vou me debru√ßar sobre isso em detalhes, porque o relat√≥rio √© mais sobre a pr√°tica de intera√ß√µes e n√£o sobre implementa√ß√£o t√©cnica. <br><br><img src="https://habrastorage.org/webt/dg/c5/cz/dgc5cz_nevmer6hzgcxjj1tqe5g.png"><br><br>  Por exemplo, tivemos problemas com o Puppet no servidor que trabalha com o Ruby 2, e alguns aplicativos foram escritos no Ruby 1.8, e juntos eles n√£o funcionam.  Existe algum tipo de batente.  E quando voc√™ precisa manter v√°rias vers√µes do Ruby na mesma m√°quina, geralmente tem problemas. <br><br>  Por exemplo, damos a cada desenvolvedor uma plataforma na qual h√° praticamente tudo o que temos, todos os servi√ßos que podem ser desenvolvidos para que ele tenha um ambiente isolado, ele pode decomp√¥-lo e constru√≠-lo como quiser. <br><br>  Acontece que voc√™ precisa de algum tipo de pacote especialmente compilado com suporte para algo l√°.  Isso √© dif√≠cil o suficiente.  Ouvi um relat√≥rio em que a imagem do docker pesa 45 GB.  No Linux, √© claro, √© mais simples, tudo √© menor l√°, mas, de qualquer forma, n√£o haver√° lugares suficientes. <br><br>  Bem, existem depend√™ncias conflitantes quando voc√™ tem uma parte de um projeto, dependendo da biblioteca de uma vers√£o, outra parte do projeto em uma vers√£o diferente e as bibliotecas n√£o s√£o reunidas. <br><br><img src="https://habrastorage.org/webt/9m/dr/vn/9mdrvnnkajxl_8cxfmj79ukk8dk.png"><br><br>  Temos sites e servi√ßos no PHP 5.6, temos vergonha deles, mas o que fazer.  Este √© o nosso site.  Existem sites e servi√ßos no PHP 7, h√° mais deles, n√£o temos vergonha deles.  E cada desenvolvedor tem sua pr√≥pria base, onde ele pode ser feliz. <br><br>  Se voc√™ escreve na empresa em um idioma, tr√™s m√°quinas virtuais por desenvolvedor - parece normal.  Se voc√™ tiver diferentes linguagens de programa√ß√£o, a situa√ß√£o se agrava. <br><br><img src="https://habrastorage.org/webt/mp/np/b0/mpnpb0q-gcmneomvazzs_1gd4-w.jpeg"><br><br>  Voc√™ tem sites e servi√ßos nisto, nisto, ent√£o outra plataforma para Go, uma plataforma para Ruby, outro Redis ao lado.  Como resultado, tudo isso se transforma em um grande campo de suporte e, durante todo o tempo, parte disso pode ser interrompida. <br><br><img src="https://habrastorage.org/webt/cb/cq/u_/cbcqu_ynjcnffa0fepuvln_gib8.png"><br><br>  Portanto, substitu√≠mos os p√£es da linguagem de programa√ß√£o pelo uso de diferentes estruturas, uma vez que as estruturas em PHP s√£o bem diferentes, elas t√™m capacidades diferentes, comunidades diferentes, suporte diferente.  E voc√™ pode escrever um servi√ßo para que voc√™ j√° tenha algo pronto para ele. <br><br><h3>  <b>Cada servi√ßo tem sua pr√≥pria equipe.</b> </h3><br><img src="https://habrastorage.org/webt/zp/nc/6m/zpnc6mlp098fx0xriegr8mwn1jm.png"><br><br>  Nossa principal vantagem, que se cristalizou ao longo de v√°rios anos, √© que cada servi√ßo tem sua pr√≥pria equipe.  Isso √© conveniente para um projeto grande, voc√™ pode economizar tempo com documenta√ß√£o, os gerentes est√£o bem cientes de seu projeto. <br><br>  Tarefas do suporte podem ser executadas perfeitamente.  Por exemplo, o servi√ßo de seguros quebrou.  E imediatamente a equipe de seguros vai reparar. <br><br>  Novos recursos s√£o criados rapidamente, porque quando voc√™ tem um servi√ßo at√¥mico, pode rapidamente estragar algo nele. <br><br>  E quando voc√™ interrompeu seu servi√ßo, e isso inevitavelmente acontece, voc√™ n√£o prejudicou os servi√ßos de outra pessoa, e os desenvolvedores com partes de outras equipes n√£o recorrem a voc√™ e eles n√£o dizem: "Ah, n√£o fa√ßa isso. <br><br><img src="https://habrastorage.org/webt/34/hw/ro/34hwroxdvr056crrpgakpbk2f1g.png"><br><br>  Como sempre, existem nuances.  Temos equipes est√°veis, os gerentes s√£o acertados na equipe.  Existem documentos claros, os gerentes monitoram tudo isso de perto.  Cada equipe com um gerente possui v√°rios servi√ßos e h√° um ponto espec√≠fico de compet√™ncia. <br><br>  Se as equipes est√£o flutuando (isso √†s vezes tamb√©m √© usado conosco), existe um bom m√©todo chamado mapa estelar. <br><br><img src="https://habrastorage.org/webt/lu/01/uq/lu01uqtz9m1qqsp-dndyetupouq.png"><br><br>  Voc√™ tem uma lista de servi√ßos e pessoas.  Um asterisco significa que uma pessoa √© especialista neste servi√ßo, um livro significa que uma pessoa est√° estudando esse servi√ßo.  A tarefa do homem √© trocar um livrinho por um asterisco.  E se nada estiver escrito em frente ao servi√ßo, come√ßam os problemas, sobre os quais continuarei falando. <br><br><h3>  <b>Como os servi√ßos √≥rf√£os aparecem?</b> </h3><br><img src="https://habrastorage.org/webt/eh/rx/97/ehrx971egg-nuycxtteb8q824wo.jpeg"><br><br>  O primeiro problema, a primeira maneira, de tornar um servi√ßo √≥rf√£o em sua infraestrutura √© demitir pessoas.  Algu√©m j√° aconteceu quando os prazos chegam das empresas antes de avaliar as tarefas?  √Äs vezes acontece que os prazos s√£o apertados e simplesmente n√£o h√° tempo suficiente para a documenta√ß√£o.  "Devemos entregar o servi√ßo √† produ√ß√£o e depois o adicionaremos." <br><br>  Se a equipe √© pequena, acontece que h√° um desenvolvedor que escreve tudo, o resto est√° nas asas.  "Eu escrevi a arquitetura b√°sica, voc√™ me deu as interfaces."  Ent√£o, em algum momento, o gerente, por exemplo, sai.  E durante esse per√≠odo, quando o gerente foi embora e um novo ainda n√£o foi nomeado, os pr√≥prios desenvolvedores decidem para onde o servi√ßo est√° se movendo, o que est√° acontecendo l√°.  E como sabemos (vamos voltar alguns slides), em algumas equipes existem pessoas-flocos de neve, √†s vezes um floco de neve-timlid.  Ent√£o ele sai, e temos um servi√ßo √≥rf√£o. <br><br><img src="https://habrastorage.org/webt/rh/ro/qw/rhroqwez4ltwh8a5petmhcvszi4.png"><br><br>  Ao mesmo tempo, as tarefas de suporte e de neg√≥cios n√£o desaparecem, elas s√£o liquidadas na lista de pend√™ncias.  Se houver algum erro de arquitetura durante o desenvolvimento do servi√ßo, eles tamb√©m ser√£o resolvidos no backlog.  O servi√ßo est√° se degradando lentamente. <br><br><h3>  <b>Como identificar um √≥rf√£o?</b> </h3><br>  Esta lista descreve bem a situa√ß√£o.  Quem aprendeu alguma coisa na infraestrutura? <br><br><img src="https://habrastorage.org/webt/4r/gy/nv/4rgynviquavl_b6pmfr85mhzybo.png"><br><br>  Sobre as solu√ß√µes alternativas documentadas: existe um servi√ßo e, em geral, funciona, possui um manual de duas p√°ginas, como trabalhar com ele, mas ningu√©m sabe como funciona por dentro. <br><br>  Ou, por exemplo, h√° algum tipo de encurtador de link.  Por exemplo, agora usamos tr√™s encurtadores de link para diferentes prop√≥sitos em diferentes servi√ßos.  Essas s√£o as consequ√™ncias. <br><br><img src="https://habrastorage.org/webt/sm/ka/0f/smka0fa5trizu6rxhzit6e-6fj0.png"><br><br>  Agora serei o capit√£o da evid√™ncia.  O que precisa ser feito?  Primeiro, voc√™ precisa transferir o servi√ßo para outro gerente, outra equipe.  Se o l√≠der da sua equipe ainda n√£o desistiu, nessa outra equipe, quando voc√™ entender que o servi√ßo √© como um √≥rf√£o, precisar√° incluir algu√©m que entenda pelo menos algo sobre ele. <br><br>  O principal: voc√™ deve ter procedimentos de transmiss√£o por sangue.  No nosso caso, geralmente sigo isso, porque preciso que isso funcione.  Os gerentes precisam que isso seja entregue rapidamente, e o que acontecer√° com ele mais tarde n√£o √© t√£o importante para eles. <br><br><img src="https://habrastorage.org/webt/6b/wy/5p/6bwy5pd9qqzaki4jfyo0qimq8tk.png"><br><br>  A pr√≥xima maneira de tornar um √≥rf√£o √© "Vamos fazer a terceiriza√ß√£o, ser√° mais r√°pido e depois a transferiremos para a equipe".  √â claro que todo mundo tem alguns planos na equipe, na fila.  Freq√ºentemente, um cliente comercial pensa que um terceirizado far√° o mesmo que o departamento t√©cnico que est√° na empresa.  Embora seus motivadores sejam diferentes.  A terceiriza√ß√£o tem solu√ß√µes tecnol√≥gicas estranhas e solu√ß√µes algor√≠tmicas estranhas. <br><br><img src="https://habrastorage.org/webt/3o/iv/zg/3oivzgpkzi_5akenrhhsfl9r8h8.png"><br><br>  Por exemplo, tivemos um servi√ßo em que o Sphinx estava em v√°rios lugares inesperados.  Eu vou te dizer mais tarde o que eu tinha que fazer. <br><br>  Os terceirizados t√™m estruturas auto-escritas.  Este √© apenas PHP nu com copiar e colar do projeto anterior, onde voc√™ pode encontrar tudo.  Muletas grandes nos scripts de implanta√ß√£o, quando voc√™ precisa alterar v√°rias linhas em algum arquivo com alguns scripts Bash complexos, enquanto esses scripts de implanta√ß√£o s√£o chamados por algum terceiro script.  Como resultado, voc√™ altera o sistema de implanta√ß√£o, escolhe outra coisa, pula e seu servi√ßo n√£o funciona.  Porque havia mais 8 links para colocar entre pastas diferentes.  Ou acontece que mil registros funcionam, mas cem mil se foram. <br><br>  Vou continuar a capit√£o.  Aceitar um servi√ßo de terceiriza√ß√£o √© um procedimento necess√°rio.  Quem aconteceu que um servi√ßo de um contratador chega, mas n√£o √© aceito em lugar algum?  Obviamente, isso n√£o √© t√£o popular quanto um √≥rf√£o de servi√ßo, mas ainda assim. <br><br><img src="https://habrastorage.org/webt/ak/8j/lh/ak8jlhfoevrsvkv4d-y1rfu8gri.png"><br><br>  O servi√ßo deve ser verificado, o servi√ßo deve ser revisado, as senhas devem ser alteradas.  Tivemos um caso quando o servi√ßo nos lan√ßou, o painel de administra√ß√£o "se login == 'admin' &amp;&amp; password == 'admin' ..." est√° escrito diretamente no c√≥digo.  Sentamos e pensamos, e as pessoas escrevem isso em 2018? <br><br>  Testar o volume de armazenamento tamb√©m √© obrigat√≥rio.  Voc√™ precisa observar o que acontecer√° em cem mil registros, mesmo antes de iniciar esse servi√ßo em algum lugar da produ√ß√£o. <br><br><img src="https://habrastorage.org/webt/mc/k2/qa/mck2qagxhsslsxcojjpekfludq4.png"><br><br>  Enviar o servi√ßo para revis√£o n√£o deve ter vergonha.  Quando voc√™ diz: "N√£o aceitaremos este servi√ßo, temos 20 tarefas, execute-as e depois aceitaremos", isso √© normal.  A consci√™ncia n√£o deve prejudicar o fato de voc√™ substituir um gerente ou de uma empresa gastar dinheiro.  A empresa gastar√° mais. <br><br>  Tivemos um caso quando decidimos fazer um projeto piloto de terceiriza√ß√£o. <br><br><img src="https://habrastorage.org/webt/fo/cm/be/focmbesdalmj5fa1ia9_lkpxss4.png"><br><br>  Foi entregue dentro do prazo e esse foi o √∫nico crit√©rio de qualidade.  Portanto, eles fizeram outro projeto piloto, nem mesmo um projeto piloto.  Esses servi√ßos foram aceitos, disseram de maneira administrativa: aqui est√° o seu c√≥digo, aqui est√° uma equipe, aqui est√° o seu gerente.  Os servi√ßos realmente j√° come√ßaram a ter lucro.  Al√©m disso, na verdade, eles permaneceram √≥rf√£os, ningu√©m entende como eles funcionam e os gerentes de todas as maneiras poss√≠veis negam suas tarefas. <br><br><img src="https://habrastorage.org/webt/z6/lo/mn/z6lomn7i2eknkjah0pquashtywu.png"><br><br>  H√° outro excelente conceito - desenvolvimento partid√°rio.  Quando um departamento, em regra, √© um departamento de marketing, eles querem testar uma hip√≥tese e solicitar todo o servi√ßo terceirizado.  O tr√°fego come√ßa a cair nele, eles fecham documentos, assinam atos com o contratado, entram em opera√ß√£o e dizem: ‚ÄúCara, a gente tem um servi√ßo aqui, ele j√° tem tr√°fego, nos traz dinheiro, nos traz dinheiro, vamos levar‚Äù  N√≥s somos: "Oppa, como assim." <br><br><img src="https://habrastorage.org/webt/bw/g-/vj/bwg-vjk4-tvz3574ib3mbjw18ue.png"><br><br>  E mais uma maneira de obter um servi√ßo √≥rf√£o: quando uma equipe √© subitamente carregada, a ger√™ncia diz: "Vamos transferir o servi√ßo dessa equipe para outra equipe, ela tem menos carga".  E ent√£o iremos transferir para a terceira equipe e mudaremos de gerente.  E no final, novamente temos um √≥rf√£o. <br><br><h3>  <b>Qual √© o problema com os √≥rf√£os?</b> </h3><br><img src="https://habrastorage.org/webt/_o/-3/ux/_o-3uxqtu_lh_cmgfg8mf6pousc.png"><br><br>  Quem n√£o sabe, este foi o navio da linha Wasa criada na Su√©cia, famosa pelo fato de ter afundado 5 minutos ap√≥s o lan√ßamento.  E o rei da Su√©cia, ali√°s, n√£o executou ningu√©m por isso.  Foi constru√≠do por duas gera√ß√µes de engenheiros que n√£o podiam construir tais navios.  O efeito natural. <br><br>  A prop√≥sito, o navio poderia afundar, muito pior, por exemplo, quando o rei o montaria em algum lugar durante uma tempestade.  E assim, ele se afogou imediatamente, de acordo com a pris√£o, √© bom falhar cedo. <br><br>  Se falharmos cedo, geralmente n√£o h√° problemas.  Por exemplo, durante a aceita√ß√£o, eles enviaram para revis√£o.  E se j√° falhamos na produ√ß√£o, quando o dinheiro √© investido, pode haver problemas.  As consequ√™ncias, como s√£o chamadas nos neg√≥cios. <br><br>  Por que servi√ßos √≥rf√£os perigosos: <br><br><ul><li>  O servi√ßo pode quebrar repentinamente. </li><li>  O servi√ßo √© reparado por um longo per√≠odo ou n√£o √© reparado. </li><li>  Quest√µes de seguran√ßa. </li><li>  Problemas com melhorias e atualiza√ß√µes. </li><li>  Se um servi√ßo importante falha, a reputa√ß√£o da empresa sofre. </li></ul><br><h3>  <b>O que fazer com os servi√ßos √≥rf√£os?</b> </h3><br><img src="https://habrastorage.org/webt/3k/ex/8v/3kex8vjbf7clzd9jbktsfzjclby.png"><br><br>  Mais uma vez, o que fazer.  Em primeiro lugar, deve haver documenta√ß√£o.  Durante 7 anos no Banki.ru, fui ensinado que os testadores n√£o devem ter uma palavra para os desenvolvedores e a opera√ß√£o n√£o deve ter uma palavra para todos.  √â necess√°rio verificar. <br><br><img src="https://habrastorage.org/webt/dx/rc/ub/dxrcubcmw-ybkov8kdag3cz2rzs.png"><br><br>  Em segundo lugar, √© necess√°rio escrever esquemas de intera√ß√£o, porque acontece que servi√ßos que n√£o s√£o bem recebidos cont√™m depend√™ncias sobre as quais ningu√©m falou.  Por exemplo, os desenvolvedores colocam o servi√ßo na chave para alguns Yandex.Maps ou Dadata.  Voc√™ ficou sem um limite gratuito, tudo quebrou e n√£o sabe o que aconteceu.  Todos esses ancinhos devem ser descritos: o servi√ßo usa Dadata, Sms, outra coisa. <br><br><img src="https://habrastorage.org/webt/hy/6o/ki/hy6okizhuhhwibejacdgchvoo68.png"><br><br>  Em terceiro lugar, trabalhe com a d√≠vida t√©cnica.  Quando voc√™ faz muletas ou aceita o servi√ßo e diz que algo precisa ser feito, voc√™ precisa garantir que eles o fa√ßam.  Porque ent√£o pode acontecer que o pequeno buraco n√£o seja t√£o pequeno e voc√™ caia l√°. <br><br>  Com tarefas de arquitetura, tivemos uma hist√≥ria sobre o Sphinx.  Em um dos servi√ßos, o Sphinx foi usado para inserir listas.  Apenas uma lista de pagina√ß√£o, mas era reindexada todas as noites.  Foi compilado a partir de dois √≠ndices: um foi indexado todas as noites, e ainda havia um pequeno √≠ndice aparafusado a ele.  Todos os dias, com uma probabilidade de 50%, bombardear√° ou n√£o, durante o c√°lculo, o √≠ndice estava batendo e as not√≠cias pararam de ser atualizadas na p√°gina principal.  No in√≠cio, eram 5 minutos, enquanto o √≠ndice era re-indexado, depois o √≠ndice aumentava e, em algum momento, come√ßou a re-indexar 40 minutos.  Quando cortamos, soltamos um suspiro de al√≠vio, porque estava claro que um pouco mais de tempo passaria e nosso √≠ndice seria reindexado em tempo integral.  Ser√° um arquivo para o nosso portal, oito horas sem novidades - √© isso, o neg√≥cio se levantou. <br><br><h3>  <b>Plano de trabalho com um servi√ßo √≥rf√£o</b> </h3><br><img src="https://habrastorage.org/webt/ox/ny/wq/oxnywqk2gpyoczjewhrt_ngsiz0.png"><br><br>  De fato, √© muito dif√≠cil, porque o devops √© sobre comunica√ß√£o.  Quero ter boas rela√ß√µes com meus colegas e, quando voc√™ bate em colegas e gerentes com regulamentos na cabe√ßa, eles podem ter sentimentos conflitantes por aquelas pessoas que fazem isso. <br><br>  Al√©m de todos esses pontos, h√° outra coisa importante: para cada servi√ßo espec√≠fico, para cada se√ß√£o espec√≠fica do procedimento de implanta√ß√£o, pessoas espec√≠ficas devem ser respons√°veis.  Quando n√£o h√° pessoas e voc√™ precisa atrair outras pessoas, para estudar a coisa toda, fica dif√≠cil. <br><br><img src="https://habrastorage.org/webt/6o/-d/co/6o-dcolwznowrvatclrcvbvau0a.png"><br><br>  Se tudo isso n√£o ajudar, e o √≥rf√£o do servi√ßo ainda √© √≥rf√£o, ningu√©m quer lev√°-lo para voc√™, a documenta√ß√£o n√£o est√° escrita, a equipe que foi chamada para esse servi√ßo se recusa a fazer algo, h√° uma maneira f√°cil de refazer tudo . <br><br>  Ou seja, voc√™ pega os requisitos de servi√ßo novamente e escreve um novo servi√ßo, melhor, em uma plataforma melhor, sem solu√ß√µes tecnol√≥gicas estranhas.  E migre para ele na batalha. <br><br><img src="https://habrastorage.org/webt/_j/f2/wk/_jf2wkfeybtdq4xty4syofgx1ei.png"><br><br>  Tivemos uma situa√ß√£o em que pegamos o servi√ßo no Yii 1 e percebemos que n√£o pod√≠amos desenvolv√™-lo mais, porque t√≠nhamos acabado os desenvolvedores que podem escrever bem no Yii 1. Todos os desenvolvedores escrevem bem no terceiro Symfony.  O que fazer  Levamos um tempo, alocamos a equipe, alocamos o gerente, reescrevemos o projeto e mudamos o tr√°fego suavemente para ele. <br><br>  Depois disso, o servi√ßo antigo pode ser exclu√≠do.  Esse √© o meu procedimento favorito, quando voc√™ precisa retirar e limpar algum servi√ßo do sistema de gerenciamento de configura√ß√£o e depois verificar se todos os carros da produ√ß√£o foram reembolsados ‚Äã‚Äãpara que os desenvolvedores n√£o tenham mais vest√≠gios.  O reposit√≥rio no git permanece. <br><br>  Isso √© tudo sobre o que eu queria falar, estou pronto para discutir, o t√≥pico √© hol√≠stico, muitos flutuaram nele. <br><br>  <b>Nos slides, tratava-se de voc√™ unificar idiomas.</b>  <b>Um exemplo foi o redimensionamento de imagens.</b>  <b>Mas √© realmente necess√°rio ter um idioma dif√≠cil?</b>  <b>Como redimensionar imagens em PHP, bem, voc√™ realmente pode fazer isso em Golang.</b> <br><br>  De fato, isso n√£o √© necess√°rio, como todas as pr√°ticas.  Talvez, em alguns casos, at√© indesej√°vel.  Mas voc√™ precisa entender que, se voc√™ tem 50 pessoas no departamento t√©cnico, 45 delas s√£o desenvolvedores de PHP, outras 3 s√£o devops que podem fazer Python, Ansible, Puppet e algo assim, e apenas uma delas escreve em alguns V√° ao servi√ßo para redimensionar as fotos e, quando ele sair, o exame sair√° com ele.  E, ao mesmo tempo, voc√™ precisar√° procurar um desenvolvedor espec√≠fico do mercado que conhe√ßa esse idioma, especialmente se for raro.  Ou seja, do ponto de vista organizacional, isso √© problem√°tico.  Do ponto de vista dos devops, voc√™ precisar√° n√£o apenas clonar alguns conjuntos prontos de playbooks que voc√™ usa para implantar servi√ßos, mas tamb√©m precisar√° escrev√™-los novamente. <br><br>  Agora estamos vendo o servi√ßo no Node.js, e ele ser√° apenas uma plataforma pr√≥xima para cada desenvolvedor com um idioma separado.  Mas ficamos pensando que o jogo valia a pena.  Ou seja, a quest√£o aqui √© sentar e pensar. <br><br>  <b>Como voc√™ monitora seus servi√ßos?</b>  <b>Como voc√™ coleta e rastreia logs?</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coletamos logs no Elasticsearch e colocamos no Kibana e, dependendo dos ambientes de produ√ß√£o ou teste, diferentes coletores s√£o usados ‚Äã‚Äãl√°. Em algum lugar lenhador, em algum outro lugar, n√£o me lembro mais. E ainda existem alguns lugares em certos servi√ßos onde colocamos o Telegraf e o bullet em outro lugar separadamente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como viver com o Puppet e o Ansible em um ambiente?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, agora temos dois ambientes, um √© Puppet, o outro √© Ansible. Estamos trabalhando para hibrid√°-los. O Ansible √© um bom ambiente para a configura√ß√£o inicial, o Puppet √© uma coisa ruim para a configura√ß√£o inicial, porque requer m√£os para trabalhar diretamente com o site, e o Puppet fornece converg√™ncia de configura√ß√£o. Isso significa que o site em si √© mantido atualizado e, para que a m√°quina ansiblizada seja mantida atualizada, voc√™ precisa constantemente jogar com ele com alguma frequ√™ncia. Aqui est√° essa diferen√ßa. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ mant√©m a compatibilidade? Voc√™ tem configura√ß√µes no Ansible e no Puppet?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa √© a nossa grande dor, mantemos a compatibilidade com as m√£os e pensamos, como se agora, mudar tudo isso para algum lugar. Acontece que o Puppet lan√ßa pacotes e suporta alguns links l√°, enquanto o Ansible, por exemplo, rola o c√≥digo e direciona novas configura√ß√µes de aplicativos para l√°. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A apresenta√ß√£o foi sobre diferentes vers√µes do Ruby. Qual √© a solu√ß√£o?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somos confrontados com isso em um s√≥ lugar, e temos que manter isso em mente o tempo todo. Acabamos de desativar a parte que trabalhava no Ruby, que era incompat√≠vel com os aplicativos, e a mantivemos separada.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este ano, a confer√™ncia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsDays Moscow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° realizada em 7 de dezembro em Technopolis. </font><font style="vertical-align: inherit;">At√© 11 de novembro, aceitamos solicita√ß√µes de relat√≥rios. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos se voc√™ quiser falar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As inscri√ß√µes para os participantes est√£o abertas, participe!</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471146/">https://habr.com/ru/post/pt471146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471134/index.html">Python vs JavaScript: Qual deles pode te beneficiar mais?</a></li>
<li><a href="../pt471136/index.html">A primeira grande reuni√£o de tubos da comunidade Scala na R√∫ssia - como foi</a></li>
<li><a href="../pt471138/index.html">Programa√ß√£o em par em Vineti</a></li>
<li><a href="../pt471140/index.html">Preparando-se para a certifica√ß√£o profissional da Spring. Descanso de primavera</a></li>
<li><a href="../pt471142/index.html">12 recursos do ES10 em 12 exemplos simples</a></li>
<li><a href="../pt471150/index.html">‚ÄúComo gerenciar intelectuais. I, nerds e geeks "(vers√£o eletr√¥nica gratuita do livro)</a></li>
<li><a href="../pt471154/index.html">De volta √† escola: como treinar testadores port√°teis para lidar com testes autom√°ticos</a></li>
<li><a href="../pt471158/index.html">ID @ Xbox na R√∫ssia: expandindo os horizontes dos jogos</a></li>
<li><a href="../pt471160/index.html">Problema ao instalar o Ruby on Rails no final de 2019</a></li>
<li><a href="../pt471162/index.html">Anunciando suporte para edi√ß√£o nativa de notebooks Jupyter no c√≥digo VS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>