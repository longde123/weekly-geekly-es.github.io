<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🚀 🌰 👪 VVVVVV ؟؟ VVVVVV !!! :) 📹 🏠 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="إذا قرأت هذا النص ، فهذا يعني أنك إما فكرت أن هناك خطأ ما في عنوان المقال ، أو أنك رأيت اسم لعبة كمبيوتر مألوفة فيه. VVVVVV هي لعبة منهاج مستقل فازت ب...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VVVVVV ؟؟ VVVVVV !!! :)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/484166/" style=";text-align:right;direction:rtl">  إذا قرأت هذا النص ، فهذا يعني أنك إما فكرت أن هناك خطأ ما في عنوان المقال ، أو أنك رأيت اسم لعبة كمبيوتر مألوفة فيه.  VVVVVV هي لعبة منهاج مستقل فازت بقلوب العديد من اللاعبين ببساطتها الخارجية اللطيفة وتعقيدها الداخلي اللطيف.  قبل بضعة أيام ، بلغ عمر VVVVVV 10 أعوام ، واحتفل مؤلف اللعبة - Terry Cavanagh - بهذا العيد بنشر الكود المصدر.  ما هو "لذيذ" يمكن العثور عليها في ذلك؟  اقرأ الإجابة في هذا المقال. <br><br><p style=";text-align:right;direction:rtl"></p><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/i1/ij/g8/i1ijg8lekultgdxwi426mbnaers.png" alt="الشكل 1"></div><br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  مقدمة </h2><br>  أوه ، VVVVVV ... أتذكر كيف صادفتها بعد فترة وجيزة من الإصدار ، ولكني معجبًا كبيرًا بألعاب البيكسل الرجعية ، قمت بتثبيتها بسعادة على جهاز الكمبيوتر الخاص بي.  أتذكر انطباعاتي الأولى: "وهكذا ، هل هذا كل شيء؟  مجرد الركض حول الغرف المربعة؟ "فكرت بعد بضع دقائق من اللعبة.  لم أعرف حتى الآن ما الذي ينتظرني.  حالما غادرت موقع البداية ، وجدت نفسي في عالم صغير ولكنه مرتبك ومزخرف ثنائي الأبعاد ومليء بالمناظر الطبيعية غير المعتادة والتحف بكسل غير المعروفة بالنسبة لي. <br><br>  هذه اللعبة جرني على.  على الرغم من التعقيد العالي ، الذي تغلب عليه بمهارة التحكم غير الاعتيادي في ذلك الوقت (الشخصية الرئيسية لا تعرف كيف تقفز ، لكنها قادرة على قلب اتجاه ناقل الجاذبية بنفسي) ، إلا أنني نجحت في ذلك.  ليس لدي أي فكرة عن عدد مرات وفاة شخصيتي في ذلك الوقت ، لكنني متأكد من أن عدد الوفيات يقاس بعشرات المئات.  لا يزال ، هناك بعض السحر الفريد في هذه اللعبة :) <br><br>  دعنا نعود إلى شفرة المصدر <a href="https://habr.com/ru/post/483518/">المبينة تكريما لذكرى اللعبة</a> . <br><br>  في الوقت الحالي ، أنا C ++ - المطور في فريق PVS-Studio - محلل أكواد ثابت لـ C و C ++ و C # و Java.  بالإضافة إلى التطوير نفسه ، فإننا نشارك أيضًا في الترويج لمنتجاتنا.  بالنسبة لنا ، واحدة من أفضل الطرق للقيام بذلك هي كتابة مقالات حول التحقق من المشاريع مفتوحة المصدر.  يتلقى قراءنا مقالات مثيرة حول مواضيع البرمجة ، ونحصل على فرصة لإظهار قدرات PVS-Studio بوضوح.  لذلك ، عندما علمت عن فتح شفرة المصدر VVVVVV ، لم أستطع المرور. <br><br>  في هذه المقالة ، سننظر في بعض الأخطاء المهمة التي وجدها محلل PVS-Studio في رمز VVVVVV ، بالإضافة إلى إجراء تحليل مفصل لهذه الأخطاء.  أعد متجه الجاذبية إلى الوضع "لأسفل" والجلوس: لقد بدأنا! <br><br><h2 style=";text-align:right;direction:rtl">  نظرة عامة على التنبيهات الصادرة عن محلل </h2><br><h3 style=";text-align:right;direction:rtl">  تحذير 1 </h3><br>  <a href="https://www.viva64.com/ru/w/v512/">V512 سيؤدي</a> استدعاء وظيفة 'sprintf' إلى تجاوز سعة 'searchSearch' العازلة.  FileSystemUtils.cpp 307 <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_PATH 260 .... void PLATFORM_migrateSaveData(char *output) { char oldLocation[MAX_PATH]; char newLocation[MAX_PATH]; char oldDirectory[MAX_PATH]; char fileSearch[MAX_PATH]; .... </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Same place, different layout. */</span></span></span><span class="hljs-meta"> strcpy(oldDirectory, output); sprintf(fileSearch, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s\\*.vvvvvv"</span></span></span><span class="hljs-meta">, oldDirectory); .... }</span></span></code> </pre> <br>  كما ترون ، <i>خطوط البحث</i> و <i>oldDirectory</i> هي بنفس الحجم: 260 حرفًا.  سلسلة التنسيق (الوسيطة الثالثة <i>sprintf</i> ) بعد استبدال محتويات السلسلة <i>oldDirectory</i> به ستبدو كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">&lt;i&gt;_oldDirectory\*.vvvvvv&lt;/i&gt;</code> </pre> <br>  هذه السلسلة أطول من 9 أحرف من <i>oldDirectory</i> الأصلي.  هذا هو تسلسل الأحرف الذي سيتم كتابته كذلك إلى <i>fileSearch</i> .  ماذا يحدث إذا كانت السلسلة <i>oldDirectory</i> أطول من 251؟  ستكون السلسلة الناتجة أطول مما يمكن أن <i>يستوعبه الملف</i> ، مما سيؤدي إلى الكتابة خارج الصفيف.  أي نوع من البيانات في ذاكرة الوصول العشوائي قد يكون معطوبًا والنتيجة التي سيؤدي إليها هو سؤال بلاغي :) <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 2 </h3><br>  <a href="https://www.viva64.com/ru/w/v519/">V519</a> يتم تعيين قيم "الخلفية" مرتين على التوالي.  ربما هذا خطأ.  خطوط التحقق: 1367 ، 1373. Map.cpp 1373 <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> mapclass::loadlevel(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-comment"><span class="hljs-comment">//The Warpzone tmap = warplevel.loadlevel(rx, ry, game, obj); fillcontent(tmap); roomname = warplevel.roomname; tileset = 1; background = 3; // &lt;= dwgfx.rcol = warplevel.rcol; dwgfx.backgrounddrawn = false; warpx = warplevel.warpx; warpy = warplevel.warpy; background = 5; // &lt;= if (warpy) background = 4; if (warpx) background = 3; if (warpx &amp;&amp; warpy) background = 5; break; .... }</span></span></code> </pre> <br>  يتم تعيين قيمة واحدة ونفس المتغير مرتين على التوالي.  علاوة على ذلك ، بين المهام لا يستخدم هذا المتغير في أي مكان.  غريب ... ربما لا ينتهك هذا التسلسل منطق البرنامج ، ولكن هذه الواجبات بحد ذاتها تتحدث عن بعض الالتباس عند كتابة التعليمات البرمجية.  إذا كان هذا هو في الواقع خطأ لا يمكن إلا أن يقال من قبل المؤلف.  على الرغم من وجود أمثلة أكثر إشراقًا لهذا الخطأ في التعليمات البرمجية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Game::loadquick(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"frames"</span></span>) { frames = atoi(pText); frames = <span class="hljs-number"><span class="hljs-number">0</span></span>; } .... }</code> </pre> <br>  من الواضح بالفعل هنا أنه يوجد في مكان ما إما خطأ في المنطق أو مهمة غير ضرورية على الأقل.  ربما تم كتابة السطر الثاني مؤقتًا لتصحيح الأخطاء ، ثم نسوا حذفه.  في المجموع ، أصدر PVS-Studio 8 تحذيرات حول مثل هذه الحالات. <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 3 </h3><br>  تم إنشاء كائن <a href="https://www.viva64.com/ru/w/v808/">V808</a> "pKey" من النوع "basic_string" ولكن لم يتم استخدامه.  editor.cpp 1866 <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> editorclass::load(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;_path) { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pElem-&gt;Value())</span></span></span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"edEntities"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (TiXmlElement *edEntityEl = pElem-&gt;FirstChildElement(); edEntityEl; edEntityEl = edEntityEl-&gt;NextSiblingElement()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(edEntityEl-&gt;Value())</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= //const char* pText = edEntityEl-&gt;GetText() ; if (edEntityEl-&gt;GetText() != NULL) { edentity[i].scriptname = std::string(edEntityEl-&gt;GetText()); } edEntityEl-&gt;QueryIntAttribute("x", &amp;edentity[i].x); edEntityEl-&gt;QueryIntAttribute("y", &amp;edentity[i].y); edEntityEl-&gt;QueryIntAttribute("t", &amp;edentity[i].t); edEntityEl-&gt;QueryIntAttribute("p1", &amp;edentity[i].p1); edEntityEl-&gt;QueryIntAttribute("p2", &amp;edentity[i].p2); edEntityEl-&gt;QueryIntAttribute("p3", &amp;edentity[i].p3); edEntityEl-&gt;QueryIntAttribute("p4", &amp;edentity[i].p4); edEntityEl-&gt;QueryIntAttribute("p5", &amp;edentity[i].p5); edEntityEl-&gt;QueryIntAttribute("p6", &amp;edentity[i].p6); i++; } EditorData::GetInstance().numedentities = i; } .... }</span></span></code> </pre> <br>  كود غريب جدا.  يحذر المحلل من المتغير <i>pKey الذي</i> تم إنشاؤه ولكنه لم يستخدم ، ولكن في الواقع تبين أن المشكلة أكثر إثارة للاهتمام.  قمت على وجه التحديد <i>بتمييز</i> سهم في السطر الذي تم إصدار التحذير عليه ، لأن هذه الوظيفة تحتوي على أكثر من سطر تعريف يحمل اسم <i>pKey</i> .  نعم ، يتم الإعلان عن متغير آخر داخل الحلقة <i>for</i> ، وباسمه يتداخل مع المتغير المعلن خارج الحلقة. <br><br>  وبالتالي ، إذا <i>نظرت</i> إلى قيمة سلسلة <i>pKey</i> خارج حلقة <i>for</i> ، فستحصل على قيمة مساوية لـ <i>pElem-&gt; Value ()</i> ، ولكن إذا فعلت الشيء نفسه داخل الحلقة ، فستحصل على قيمة مساوية لـ <i>edEntityEl-&gt; Value ()</i> .  تعد الأسماء المتداخلة خطأً فادحًا إلى حد ما ، وقد يكون من الصعب جدًا العثور عليها بنفسك أثناء مراجعة التعليمات البرمجية. <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 4 </h3><br>  <a href="https://www.viva64.com/ru/w/v805/">V805</a> انخفاض الأداء.  من غير الفعال تحديد سلسلة فارغة باستخدام بناء 'strlen (str)&gt; 0'.  الطريقة الأكثر فعالية هي التحقق من: str [0]! = '\ 0'.  physfs.c 1604 <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *prefDir = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PHYSFS_getPrefDir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *org, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *app)</span></span></span><span class="hljs-function"> </span></span>{ .... assert(<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(prefDir) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prefDir; } <span class="hljs-comment"><span class="hljs-comment">/* PHYSFS_getPrefDir */</span></span></code> </pre> <br>  العثور على محلل مكان ل microoptimization المحتملة.  يستخدم الدالة <i>strlen</i> للتحقق من سلسلة نمط C لإلغاء الفراغ.  تعمل هذه الوظيفة على "تشغيل" جميع عناصر السلسلة وتتحقق من كل عنصر من هذه العناصر لتحقيق المساواة في نقطة الصفر ('\ 0').  إذا تم إدخال سلسلة كبيرة ، فسيظل كل حرف من الأحرف مقارنًا بسلسلة صفر. <br><br>  لكننا نحتاج فقط إلى التحقق من أن السلسلة غير فارغة!  للقيام بذلك ، فقط معرفة ما إذا كان الحرف الأول من السلسلة هو صفر محطة.  لذلك ، لتحسين عملية التحقق هذه داخل التأكيد ، يجب عليك كتابة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">str[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">'\0'</span></span></code> </pre> <br>  هذه هي التوصية التي يقدمها لنا المحلل.  بالطبع ، استدعاء دالة strlen في حالة <i>تأكيد</i> الماكرو ، لذلك سيتم تنفيذه فقط في إصدار تصحيح الأخطاء حيث السرعة ليست مهمة جدًا.  في نسخة الإصدار ، ستختفي استدعاء الوظيفة وسيعمل الرمز بسرعة.  ومع ذلك ، أردت أن أظهر قدرات محلل في اقتراح microoptimizations. <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 5 </h3><br>  لإظهار الخطأ التالي ، أحتاج إلى إرفاق قسمين من التعليمات البرمجية هنا: إعلان فئة <i>entclass ومنشئها</i> .  لنبدأ بالإعلان: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entclass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: entclass(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outside</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">//Fundamentals bool active, invis; int type, size, tile, rule; int state, statedelay; int behave, animate; float para; int life, colour; //Position and velocity int oldxp, oldyp; float ax, ay, vx, vy; int cx, cy, w, h; float newxp, newyp; bool isplatform; int x1, y1, x2, y2; //Collision Rules int onentity; bool harmful; int onwall, onxwall, onywall; //Platforming specific bool jumping; bool gravity; int onground, onroof; int jumpframe; //Animation int framedelay, drawframe, walkingframe, dir, actionframe; int yp; int xp; };</span></span></code> </pre> <br>  منشئ هذه الفئة يشبه هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">entclass::entclass() { clear(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> entclass::clear() { <span class="hljs-comment"><span class="hljs-comment">// Set all values to a default, // required for creating a new entity active = false; invis = false; type = 0; size = 0; tile = 0; rule = 0; state = 0; statedelay = 0; life = 0; colour = 0; para = 0; behave = 0; animate = 0; xp = 0; yp = 0; ax = 0; ay = 0; vx = 0; vy = 0; w = 16; h = 16; cx = 0; cy = 0; newxp = 0; newyp = 0; x1 = 0; y1 = 0; x2 = 320; y2 = 240; jumping = false; gravity = false; onground = 0; onroof = 0; jumpframe = 0; onentity = 0; harmful = false; onwall = 0; onxwall = 0; onywall = 0; isplatform = false; framedelay = 0; drawframe = 0; walkingframe = 0; dir = 0; actionframe = 0; }</span></span></code> </pre> <br>  حقول كافية ، أليس كذلك؟  ليس من المستغرب أن يحدث خطأ هنا ، وأصدرت PVS-Studio تحذيراً: <br><br>  <a href="https://www.viva64.com/ru/w/v730/">V730 من</a> الممكن عدم تهيئة جميع أعضاء الفصل داخل المنشئ.  النظر في التفتيش: oldxp ، oldyp.  Ent.cpp 3 <br><br>  كما ترون ، في مثل هذه القائمة الكبيرة ، فقد تم تهيئة حقلين من الفصل.  وهكذا ، بقيت قيمهم غير محددة ، وبسبب ذلك ، في مكان آخر في البرنامج ، يمكن قراءة قيمة غير معروفة واستخدامها منهم.  من الصعب للغاية اكتشاف مثل هذا الخطأ من خلال العيون. <br><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mi/8n/du/mi8nduqzzi75r1jhntbsqwarlns.png" alt="الشكل 2"></p><br><br><h3 style=";text-align:right;direction:rtl">  تحذير 6 </h3><br>  النظر في الكود: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> mapclass::loadlevel(....) { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; tmap; .... tmap = otherlevel.loadlevel(rx, ry, game, obj); fillcontent(tmap); .... <span class="hljs-comment"><span class="hljs-comment">//  tmap    . }</span></span></code> </pre> <br>  تحذير PVS-studio: <a href="https://www.viva64.com/ru/w/v688/">V688</a> يمتلك المتغير المحلي "tmap" نفس اسم أحد أعضاء الفصل ، مما قد يؤدي إلى حدوث تشويش.  Map.cpp 1192 <br><br>  في الواقع ، إذا نظرت داخل فئة <i>mapclass</i> ، يمكنك أن تجد هناك نفس المتجه بنفس الاسم: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapclass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; roomdeaths; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; roomdeathsfinal; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; areamap; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; contents; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; explored; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; vmult; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; tmap; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... };</span></span></code> </pre> <br>  لسوء الحظ ، فإن إعلان المتجه بنفس الاسم داخل إحدى الوظائف يجعل المتجه المعلن في الفصل غير مرئي.  اتضح أنه خلال وظيفة <i>loadlevel ،</i> يتغير ناقل <i>tmap</i> داخل الوظيفة فقط.  المتجهات المعلنة في الفصل تظل كما هي! <br><br>  ومن المثير للاهتمام ، اكتشف PVS-Studio ما يصل إلى 20 جزءًا من هذا الرمز!  بالنسبة للجزء الأكبر ، فإنها ترتبط مع المتغيرات المؤقتة ، والتي ، للراحة ، تم إعلانها كأعضاء في الفصل.  كتب مؤلف اللعبة (ومطورها الوحيد) نفسه أنه كان لديه هذه العادة السيئة.  يمكنك أن تقرأ عن هذا في منشور قمت بربطه في بداية هذا المقال. <br><br>  كما يلاحظ أن مثل هذه التسمية أدت إلى ضرر يصعب التقاط الأخطاء.  حسنًا ، قد تكون هذه الأخطاء ضارة حقًا ، ولكن استخدام التحليل الثابت للقبض عليها لن يكون أمرًا صعبًا :) <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 7 </h3><br>  <a href="https://www.viva64.com/ru/w/v601/">V601</a> نوع العدد الصحيح يتم ضمنيًا إلى نوع char.  Game.cpp 4997 <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Game::loadquick(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"totalflips"</span></span>) { totalflips = atoi(pText); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"hardestroom"</span></span>) { hardestroom = atoi(pText); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else if (pKey == "hardestroomdeaths") { hardestroomdeaths = atoi(pText); } .... }</span></span></code> </pre> <br>  لفهم الأمر ، دعونا نلقي نظرة على تعريفات المتغيرات من قسم معين من الكود: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//Some stats: int totalflips; std::string hardestroom; int hardestroomdeaths;</span></span></code> </pre> <br>  تكون المتغيرات <i>الإجمالية والوفيات</i> <i>القاسية</i> من النوع الصحيح ، وبالتالي فإن تعيين النتيجة إلى وظيفة <i>atoi</i> فيها أمر طبيعي تمامًا.  ولكن ماذا يحدث إذا قمت بتعيين قيمة عدد صحيح إلى <i>std :: string</i> ؟  اتضح أنه من وجهة نظر اللغة ، فإن مثل هذه المهمة صالحة تمامًا.  نتيجة لذلك ، سيتم كتابة بعض القيمة غير المفهومة في متغير <i>hardestroom</i> ! <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 8 </h3><br>  <a href="https://www.viva64.com/ru/w/v1004/">V1004</a> تم استخدام مؤشر 'pElem' بطريقة غير آمنة بعد التحقق من عدم وجود nullptr.  خطوط التحقق: 1739 ، 1744. editor.cpp 1744 <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> editorclass::load(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;_path) { .... <span class="hljs-function"><span class="hljs-function">TiXmlHandle </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hDoc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;doc)</span></span></span></span>; TiXmlElement *pElem; <span class="hljs-function"><span class="hljs-function">TiXmlHandle </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hRoot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; version = <span class="hljs-number"><span class="hljs-number">0</span></span>; { pElem = hDoc.FirstChildElement().Element(); <span class="hljs-comment"><span class="hljs-comment">// should always have a valid root // but handle gracefully if it does if (!pElem) { printf("No valid root! Corrupt level file?\n"); } pElem-&gt;QueryIntAttribute("version", &amp;version); // &lt;= // save this for later hRoot = TiXmlHandle(pElem); } .... }</span></span></code> </pre> <br>  يحذر المحلل من أن مؤشر <i>pElem</i> يستخدم بشكل غير آمن فور التحقق من <i>وجوده</i> .  للتأكد من صحة المحلل ، ألقِ نظرة على تعريف الدالة <i>Element ()</i> ، حيث تقوم قيمة الإرجاع بتهيئة مؤشر <i>pElem</i> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/** @deprecated use ToElement. Return the handle as a TiXmlElement. This may return null. */</span></span> <span class="hljs-function"><span class="hljs-function">TiXmlElement *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Element</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ToElement(); }</code> </pre> <br>  كما ترون من التعليق ، هذه الوظيفة يمكن أن تعود <i>خالية</i> . <br><br>  الآن تخيل أن هذا حدث بالفعل.  ماذا سيحدث في هذه الحالة؟  الحقيقة هي أن مثل هذا الموقف لن يتم التعامل معه بأي شكل من الأشكال.  نعم ، سيتم عرض رسالة تفيد بحدوث خطأ ما ، ولكن حرفيًا ، سيتم إلغاء خط أسفل المؤشر غير الصحيح.  هذا التأجيل ، بدوره ، سيؤدي إلى تعطل البرنامج أو سلوك غير محدد.  هذا خطأ خطير جدا. <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 9 </h3><br>  في القسم التالي من التعليمات البرمجية ، أصدر PVS-Studio أربعة تحذيرات: <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://www.viva64.com/ru/w/v560/">V560</a> جزء من التعبير الشرطي صحيح دائمًا: x&gt; = 0. editor.cpp 1137 </li><li style=";text-align:right;direction:rtl">  <a href="https://www.viva64.com/ru/w/v560/">V560</a> جزء من التعبير الشرطي صحيح دائمًا: y&gt; = 0. editor.cpp 1137 </li><li style=";text-align:right;direction:rtl">  <a href="https://www.viva64.com/ru/w/v560/">V560</a> جزء من التعبير الشرطي صحيح دائمًا: x &lt;40. editor.cpp 1137 </li><li style=";text-align:right;direction:rtl">  <a href="https://www.viva64.com/ru/w/v560/">V560</a> جزء من التعبير الشرطي صحيح دائمًا: y &lt;30. editor.cpp 1137 </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> editorclass::at( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(<span class="hljs-number"><span class="hljs-number">0</span></span>,y); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(y&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&gt;=<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(<span class="hljs-number"><span class="hljs-number">39</span></span>,y); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(y&gt;=<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(x,<span class="hljs-number"><span class="hljs-number">29</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; y&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; x&lt;<span class="hljs-number"><span class="hljs-number">40</span></span> &amp;&amp; y&lt;<span class="hljs-number"><span class="hljs-number">30</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contents[x+(levx*<span class="hljs-number"><span class="hljs-number">40</span></span>)+vmult[y+(levy*<span class="hljs-number"><span class="hljs-number">30</span></span>)]]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  جميع التحذيرات تنطبق على البيان الأخير <i>إذا</i> .  المشكلة هي أن الشيكات الأربعة التي يتم إجراؤها عليها ستعود دائمًا إلى <i>حقيقة</i> .  لن أقول إن هذا خطأ خطير ، لكن اتضح أنه مضحك للغاية.  قرر المؤلف أن يأخذ هذه الوظيفة على محمل الجد ، وفقط في حالة فحص كل متغير مرة أخرى :) <br><br>  يمكن إزالة هذا الاختيار لأن  لن يصل مؤشر تنفيذ التنفيذ إلى التعبير " <i>return 0؛</i> " على أي حال.  على الرغم من أن هذا لا يغير من منطق البرنامج ، إلا أنه سيحرره من الفحوصات غير الضرورية ومن الكود الميت. <br><br><h3 style=";text-align:right;direction:rtl">  تحذير 10 </h3><br>  في مقالته عن ذكرى اللعبة ، يقول تيري بسخرية أن أحد العناصر التي تتحكم في منطق اللعبة كان عبارة عن تحول كبير من وظيفة <i>اللعبة :: updatestate ()</i> ، المسؤولة مباشرةً عن عدد كبير من حالات اللعبة المختلفة.  وكان من المتوقع أن أجد التحذير التالي: <br><br>  <a href="https://www.viva64.com/ru/w/v2008/">V2008</a> التعقيد السيكلومي: 548. فكر في إعادة بيع وظيفة "Game :: updatestate".  Game.cpp 612 <br><br>  نعم ، فهمت بشكل صحيح: قدرت PVS-Studio التعقيد السيكلومي للوظيفة عند 548 وحدة.  خمسمائة وثمانية واربعون !!!  هذا أفهم - "رمز أنيق".  وهذا على الرغم من حقيقة أنه ، في الواقع ، لا يوجد شيء أكثر من تعبير التبديل في وظيفة.  في التبديل نفسه ، أحصيت أكثر من 300 تعبيرات حالة. <br><br>  في مكتبنا هناك منافسة صغيرة بين المؤلفين لأطول مقال.  سأحضر بكل سرور رمز الوظيفة هنا (3450 سطرًا) ، لكن هذا النصر سيكون غير أمين ، لذلك سأقتصر على <a href="">الإشارة</a> ببساطة إلى التبديل الضخم.  أوصي بمتابعته وتقييم المقياس بأكمله بنفسك!  بالمناسبة ، بالإضافة إلى <i>Game :: updatestate ()</i> ، وجد PVS-Studio ما يصل إلى 44 وظيفة مع تعقيد سيكلوماتي مفرط ، 10 منها لها تعقيد أكثر من 200. <br><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pu/s9/a2/pus9a2tqqeyzmdkg90auf5r2d0q.png" alt="الشكل 3"></p><br><br><h2 style=";text-align:right;direction:rtl">  استنتاج </h2><br>  أعتقد أن الأخطاء المكتوبة تكفي للمقال.  نعم ، كان هناك الكثير من الأخطاء في المشروع ، لكن هذه بالضبط هي الحيلة: بعد أن وضع الكود ، أوضح تيري كافاناغ أنه ليس من الضروري أن يكون مبرمجًا جيدًا لصنع لعبة جيدة.  الآن ، بعد 10 سنوات ، يتذكر تيري تلك الأوقات بسخرية.  التعلم من أخطائك أمر مهم ، والممارسة هي أفضل طريقة للقيام بذلك.  وإذا كانت ممارستك لا تزال تؤدي إلى لعبة مثل VVVVVVV ، فهذا رائع بشكل عام!  إيه ... سأذهب وسأقوم على الأرجح بتشغيلها مرة أخرى :) <br><br>  لم تكن كل هذه الأخطاء موجودة في كود اللعبة.  إذا كنت تريد أن ترى بنفسك ماذا يمكنك أن تجد ، أقترح <a href="https://www.viva64.com/ru/pvs-studio-download/">تنزيل وتجربة PVS-Studio</a> !  كما لا تنسَ أنه بالنسبة لمشاريع المصادر المفتوحة ، فإننا <a href="https://www.viva64.com/ru/b/0614/">نوفر</a> ترخيصًا مجانيًا. <br><br><p style=";text-align:right;direction:rtl"> <a href="https://habr.com/en/company/pvs-studio/blog/484388/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  إذا كنت ترغب في مشاركة هذا المقال مع جمهور ناطق باللغة الإنجليزية ، فيرجى استخدام الرابط الخاص بالترجمة: George Gribkov.  <a href="https://habr.com/en/company/pvs-studio/blog/484388/">VVVVVV ؟؟</a>  <a href="https://habr.com/en/company/pvs-studio/blog/484388/">VVVVVV !!!</a>  <a href="https://habr.com/en/company/pvs-studio/blog/484388/">:)</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar484166/">https://habr.com/ru/post/ar484166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar484150/index.html">5 أدوات جديدة لإنشاء محتوى ممتع</a></li>
<li><a href="../ar484152/index.html">تحكم PAC عالي السرعة WISE-5580</a></li>
<li><a href="../ar484154/index.html">طريقة لحل نظام المعادلات ديوفانتاين</a></li>
<li><a href="../ar484160/index.html">بعيد المنال المواهب: روسيا تخسر أفضل محترفي تكنولوجيا المعلومات</a></li>
<li><a href="../ar484164/index.html">تاريخ الكتب ومستقبل المكتبات</a></li>
<li><a href="../ar484168/index.html">نكتب استراتيجيتنا للتمرير الظاهري من Angular CDK</a></li>
<li><a href="../ar484170/index.html">تحديث نقطة التحقق من R77.30 إلى 80.20</a></li>
<li><a href="../ar484172/index.html">التكامل المستمر في الوحدة: كيفية تقليل وقت التجميع وتوفير الموارد + payline كهدية</a></li>
<li><a href="../ar484174/index.html">تشرب القلعة في ظروف "قاسية" أو كيف شاركنا في عرض "DOZOR"</a></li>
<li><a href="../ar484176/index.html">تطبيق قالب الحالة في الوحدة</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>