<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙎🏼 🍡 😀 Render teks modern di Linux: bagian 1 🚴🏾 🐄 💕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat datang di bagian pertama Rendering Teks Linux Modern. Di setiap artikel dalam seri ini, kami akan mengembangkan program C mandiri untuk memvis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Render teks modern di Linux: bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461497/">  Selamat datang di bagian pertama Rendering Teks Linux Modern.  Di setiap artikel dalam seri ini, kami akan mengembangkan program C mandiri untuk memvisualisasikan karakter atau urutan karakter.  Setiap program ini akan mengimplementasikan fungsi yang saya anggap perlu untuk rendering teks modern. <br><br>  Pada bagian pertama kita akan mengkonfigurasi FreeType dan menulis renderer simbol sederhana di konsol. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1d/f91/24b/f1df9124b08622215c74018b9dafe1d7.png"><br><br>  Inilah yang akan kami tulis.  Dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> kodenya. <br><a name="habracut"></a><br><h1>  Pengaturan sistem </h1><br><ul><li> Sistem operasi saya: <code>Ubuntu 18.04.2 LTS (bionic)</code> <br></li><li>  C compiler: <code>clang version 6.0.0-1ubuntu2</code> </li></ul><br><h3>  Instal FreeType </h3><br>  Di Ubuntu, Anda perlu menginstal FreeType dan libpng. <br><br><pre> <code class="bash hljs">$ sudo apt install libfreetype6 libfreetype6-dev $ sudo apt install libpng16-16 libpng-dev</code> </pre> <br><ul><li>  Saya memiliki FreeType versi <code>2.8.1-2ubuntu2</code> , walaupun pada saat penulisan, <code>FreeType-2.10.1</code> versi terbaru <code>FreeType-2.10.1</code> , ia juga berfungsi. <br></li><li>  versi libpng <code>(1.6.34-1ubuntu0.18.04.2)</code> </li></ul><br><h1>  Penyaji konsol </h1><br><h4>  Buat file C ( <code>main.c</code> dalam kasus saya) </h4><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; int main() { printf("Hello, world\n"); return 0; }</span></span></span></span></code> </pre> <br><pre> <code class="bash hljs">$ clang -Wall -Werror -o main main.c $ ./main Hello, world</code> </pre> <br><h4>  Kami menghubungkan pustaka FreeType </h4><br>  Untuk mencari jalur sertakan (mis., Direktori yang dilewati kompiler saat mencari file di <code>#include</code> ) untuk FreeType, jalankan: <br><br><pre> <code class="bash hljs">$ pkg-config --cflags freetype2 -I/usr/include/freetype2 -I/usr/include/libpng16</code> </pre> <br>  Baris <code>-I/usr/include/freetype2 -I/usr/include/libpng16</code> berisi flag kompilasi yang diperlukan untuk mengaktifkan FreeType dalam program C. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;freetype2/ft2build.h&gt; #include FT_FREETYPE_H int main() { printf("Hello, world\n"); return 0; }</span></span></span></span></code> </pre> <br><pre> <code class="bash hljs">$ clang -I/usr/include/freetype2 \ -I/usr/include/libpng16 \ -Wall -Werror \ -o main \ main.c $ ./main Hello, world</code> </pre> <br><h3>  Kami mencetak versi FreeType </h3><br>  Di dalam <code>main()</code> inisialisasi FreeType dengan <code>FT_Init_FreeType(&amp;ft)</code> dan periksa kesalahan (fungsi FreeType mengembalikan 0 jika berhasil). <br><br>  (Mulai sekarang, semua fungsi yang akan saya gunakan diambil dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bantuan untuk API FreeType</a> ). <br><br><pre> <code class="cpp hljs">FT_Library ft; FT_Error err = FT_Init_FreeType(&amp;ft); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Failed to initialize FreeType\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(EXIT_FAILURE); }</code> </pre> <br>  Kemudian menggunakan FT_Library_Version kita mendapatkan nomor versi. <br><br><pre> <code class="plaintext hljs">FT_Int major, minor, patch; FT_Library_Version(ft, &amp;major, &amp;minor, &amp;patch); printf("FreeType's version is %d.%d.%d\n", major, minor, patch);</code> </pre> <br>  Jika dikompilasi menggunakan perintah terakhir, kesalahan tautan akan muncul: <br><br><pre> <code class="plaintext hljs">/tmp/main-d41304.o: In function `main': main.c:(.text+0x14): undefined reference to `FT_Init_FreeType' main.c:(.text+0x54): undefined reference to `FT_Library_Version' clang: error: linker command failed with exit code 1 (use -v to see invocation)</code> </pre> <br>  Untuk memperbaikinya, tambahkan <code>-lfreetype</code> . <br><br><pre> <code class="bash hljs">$ clang -I/usr/include/freetype2 \ -I/usr/include/libpng16 \ -Wall -Werror \ -o main \ -lfreetype \ main.c $ ./main FreeType<span class="hljs-string"><span class="hljs-string">'s version is 2.8.1</span></span></code> </pre> <br><h3>  Unduh Font </h3><br>  Langkah pertama untuk merender karakter adalah mengunduh file font.  Saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ubuntu mono</a> . <br><br>  Untuk memahami perbedaan yang tepat antara konstruksi wajah font, keluarga font, dan font tersendiri, lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi FreeType</a> . <br><br>  Argumen ketiga disebut <i>indeks wajah</i> .  Ini dirancang untuk memungkinkan pembuat font untuk memasukkan beberapa wajah ke dalam ukuran font yang sama.  Karena setiap font memiliki setidaknya satu wajah, nilai 0 akan selalu berfungsi, memilih opsi pertama. <br><br><pre> <code class="cpp hljs"> FT_Face face; err = FT_New_Face(ft, <span class="hljs-string"><span class="hljs-string">"./UbuntuMono.ttf"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;face); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Failed to load face\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(EXIT_FAILURE); }</code> </pre> <br><h3>  Tetapkan ukuran piksel untuk wajah </h3><br>  Dengan menggunakan instruksi ini, kami memberi tahu FreeType lebar dan tinggi yang diinginkan untuk karakter yang ditampilkan. <br><br>  Jika Anda melewati nol untuk lebar, FreeType mengartikan ini sebagai "sama seperti yang lain," dalam hal ini 32px.  Ini dapat digunakan untuk menampilkan karakter, misalnya, dengan lebar 10px dan tinggi 16px. <br><br>  Operasi ini mungkin gagal pada font berukuran tetap, seperti dalam kasus emoji. <br><br><pre> <code class="cpp hljs">err = FT_Set_Pixel_Sizes(face, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Failed to set pixel size\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(EXIT_FAILURE); }</code> </pre> <br><h3>  Mendapatkan indeks untuk karakter </h3><br>  Pertama-tama, kembali ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi FreeType</a> dan buat konvensi penamaan.  Simbol tidak sama dengan <i>mesin terbang</i> .  Karakter adalah apa yang dikatakan <code>char</code> , dan mesin terbang adalah gambar yang entah bagaimana terkait dengan karakter itu.  Hubungan ini agak rumit karena char dapat berhubungan dengan beberapa mesin terbang: yaitu aksen.  Mesin terbang dapat berhubungan dengan banyak karakter: yaitu, ligatur, di mana -&gt; direpresentasikan sebagai gambar tunggal. <br><br>  Untuk mendapatkan indeks mesin terbang yang sesuai dengan karakter, kami menggunakan <code>FT_Get_Char_Index</code> .  Seperti yang dapat Anda pahami, ini melibatkan karakter yang cocok dan mesin terbang hanya satu lawan satu.  Dalam artikel mendatang di seri ini, kami akan menyelesaikan masalah menggunakan perpustakaan <i>HarfBuzz</i> . <br><br><pre> <code class="cpp hljs"> FT_UInt glyph_index = FT_Get_Char_Index(face, <span class="hljs-string"><span class="hljs-string">'a'</span></span>);</code> </pre> <br><h3>  Memuat mesin terbang dari wajah </h3><br>  Setelah menerima glyph_index, kita dapat memuat glyph yang sesuai dari wajah kita. <br><br>  Dalam angsuran di masa mendatang, kami akan membahas secara rinci berbagai flag unduhan dan bagaimana mereka memungkinkan Anda untuk menggunakan fitur-fitur seperti petunjuk dan font bitmap. <br><br><pre> <code class="cpp hljs">FT_Int32 load_flags = FT_LOAD_DEFAULT; err = FT_Load_Glyph(face, glyph_index, load_flags); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Failed to load glyph\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(EXIT_FAILURE); }</code> </pre> <br><h3>  Tampilkan mesin terbang dalam wadahnya (slot mesin terbang) </h3><br>  Sekarang kita akhirnya dapat menampilkan mesin terbang kami dalam wadahnya (slot) yang ditentukan di <code>face-&gt;glyph</code> . <br><br>  Kami juga akan membahas render flag di masa depan, karena mereka memungkinkan kami untuk menggunakan rendering LCD (atau sub-pixel) dan antialiasing grayscale. <br><br><pre> <code class="cpp hljs">FT_Int32 render_flags = FT_RENDER_MODE_NORMAL; err = FT_Render_Glyph(face-&gt;glyph, render_flags); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Failed to render the glyph\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(EXIT_FAILURE); }</code> </pre> <br><h3>  Output karakter ke konsol </h3><br>  Bitmap dari glyph yang diberikan dapat diperoleh dari <code>face-&gt;glyph-&gt;bitmap.buffer</code> , di mana ia disajikan sebagai array nilai char yang tidak ditandatangani, sehingga nilainya berkisar dari 0 hingga 255. <br><br>  Buffer dikembalikan sebagai array satu dimensi, tetapi merupakan gambar 2D.  Untuk mengakses baris ke-i dari kolom ke-j, kita menghitung <code>column * row_width + row</code> , seperti dalam <code>bitmap.buffer[i * face-&gt;glyph-&gt;bitmap.pitch + j]</code> . <br><br>  Anda dapat melihat bahwa ketika mengakses array kami menggunakan <code>bitmap.width</code> dalam satu loop dan <code>bitmap.pitch</code> , karena panjang setiap baris piksel sama dengan <code>bitmap.width</code> , tetapi "lebar" buffer adalah <code>bitmap.pitch</code> . <br><br>  Dalam kode berikut, semua baris dan kolom diurutkan, dan karakter yang berbeda diambil tergantung pada kecerahan piksel. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; face-&gt;glyph-&gt;bitmap.rows; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; face-&gt;glyph-&gt;bitmap.width; j++) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> pixel_brightness = face-&gt;glyph-&gt;bitmap.buffer[i * face-&gt;glyph-&gt;bitmap.pitch + j]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pixel_brightness &gt; <span class="hljs-number"><span class="hljs-number">169</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"*"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pixel_brightness &gt; <span class="hljs-number"><span class="hljs-number">84</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); } } <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); }</code> </pre> <br>  Output konsol. <br><br><pre> <code class="bash hljs">$ clang -I/usr/include/freetype2 \ -I/usr/include/libpng16 \ -Wall -Werror \ -o main \ -lfreetype \ main.c &amp;&amp; ./main FreeType<span class="hljs-string"><span class="hljs-string">'s version is 2.8.1 .*****. .********. .********* . ***. *** *** .******** *********** .**. *** *** *** *** *** ***. *** .*********** *********** .*******..</span></span></code> </pre> <br>  → Kode lengkap dapat dilihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> <br><br><h1>  Kesimpulan </h1><br>  Kami telah membuat renderer karakter dasar di konsol.  Contoh ini dapat (dan akan) diperluas untuk membuat karakter menjadi tekstur OpenGL untuk mendukung emoji, rendering sub-pixel, pengikat, dan banyak lagi.  Pada bagian selanjutnya, kita akan berbicara tentang smoothing subpixel LCD dibandingkan dengan gradasi abu-abu, pro dan kontra mereka. <br><br>  Sampai ketemu lagi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461497/">https://habr.com/ru/post/id461497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461473/index.html">Algoritma debugging pada grafik - sekarang dengan gambar</a></li>
<li><a href="../id461475/index.html">AMA dengan Habr. 1011</a></li>
<li><a href="../id461483/index.html">Openstack Load Balancing</a></li>
<li><a href="../id461487/index.html">Tugas CTF Mini</a></li>
<li><a href="../id461493/index.html">Django 3.0 akan tidak sinkron</a></li>
<li><a href="../id461499/index.html">Bahasa apa yang akan diterjemahkan gim Anda di 2019</a></li>
<li><a href="../id461501/index.html">Mengapa di AS mereka sedang menyelidiki pekerjaan perusahaan IT besar</a></li>
<li><a href="../id461503/index.html">Membuat database tersedia untuk koneksi jarak jauh</a></li>
<li><a href="../id461505/index.html">8 bug dari pengembang JavaScript pemula yang mencegah Anda menjadi profesional</a></li>
<li><a href="../id461507/index.html">Mengapa kami memutuskan untuk meluncurkan StartupDrive akselerator perusahaan Gazprom Neft, dan siapa yang sudah melewatinya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>