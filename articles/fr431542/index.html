<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ•Ô∏è üé† üòÆ D√©veloppement et maintenance efficaces des r√¥les Ansible ü§ù üïµÔ∏è üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ansible est un syst√®me qui r√©sout diverses t√¢ches d'automatisation, y compris les projets de configuration, de sauvegarde et de d√©ploiement. Il est ag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement et maintenance efficaces des r√¥les Ansible</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/431542/">  Ansible est un syst√®me qui r√©sout diverses t√¢ches d'automatisation, y compris les projets de configuration, de sauvegarde et de d√©ploiement.  Il est agr√©able d'utiliser le syst√®me pour √©crire des scripts d'automatisation d'un environnement simple √† un grand projet.  Dans les scripts, les playbooks jouent un r√¥le important et les playbooks structur√©s jouent des r√¥les. <br><br>  <b>Ansible n'est pas une pilule magique</b> et n'aide que dans un premier temps.  Lorsqu'un projet se d√©veloppe, il devient difficile de maintenir un nombre accru de r√¥les.  Le m√©canisme de distribution continue des r√¥les aide √† r√©soudre le probl√®me. <br><br>  √Ä peu pr√®s √† ce sujet, le d√©codage du rapport d' <b>Alexander Kharkevich</b> √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOps Conf Russia</a> .  Dans le rapport: d√©veloppement de r√¥les Ansible via CI, un m√©canisme pour d√©velopper des r√¥les publics et des r√¥les publics avec des tests dans une infrastructure priv√©e.  Et il n'y a aucune conclusion dans le rapport. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IzJsBUPXfkE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  <strong>√Ä propos de l'orateur</strong> : Alexander Kharkevich ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">kharkevich</a> ) ing√©nieur syst√®me senior chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EPAM Systems</a> . <br><br>  Commen√ßons par un bref aper√ßu. <br><br><h2>  √Ä propos d'Ansible </h2><br>  Ansible est un syst√®me de gestion de configuration.  Il est √©crit en Python, bas√© sur des mod√®les par Junja, et YAML est utilis√© comme DSL.  G√©r√© via Ansible Tower - WebUI pour g√©rer et surveiller les performances du syst√®me. <br><br>  Ansible est apparu en 2012, apr√®s 3 ans que Red Hat a achet√© l'ensemble du projet, et deux ans plus tard, a pr√©sent√© AWX - Project Open Source version d'Ansible Tower. <br><br><h3>  L'installation <br></h3><br>  Pour utiliser Ansible, vous devez faire deux choses simples. <br><br>  Dans un premier temps, compilez un fichier d'inventaire en cas d'infrastructure statique. <br><br><img src="https://habrastorage.org/webt/aq/je/io/aqjeioemtokyygau_kxfiil-zt8.png"><br><br>  La seconde consiste √† √©crire un Playbook qui am√®nera le syst√®me √† l'√©tat attendu. <br><br><img src="https://habrastorage.org/webt/ul/hs/cy/ulhscyxyzzl9198e7lqq_ykm7sm.png"><br><br>  Nous avons souvent un d√©sir irr√©sistible d'√©crire l'automatisation, qui peut √™tre r√©utilis√©e √† nouveau.  L'automatisation est un bon d√©sir, et les gars d'Ansible ont propos√© un concept sympa - le r√¥le. <br><br><h3>  R√¥le <br></h3><br>  Il s'agit d'une entit√© structur√©e qui am√®nera le syst√®me √† son √©tat attendu avec la possibilit√© de r√©utiliser l'automatisation. <br><br><img src="https://habrastorage.org/webt/gj/sx/ra/gjsxrakzsho--s_ireyx8_isiqc.png"><br><br>  Par exemple, nous pouvons √©crire un r√¥le pour Oracle Java: prendre un Playbook, mettre un r√¥le et l'appliquer au syst√®me cible.  La sortie obtiendra Java install√©. <br><br><img src="https://habrastorage.org/webt/tz/9k/us/tz9kuse6fl9sljuokqkmmljbgd4.png"><br><br><h3>  Comment nous avons imagin√© travailler avec des r√¥les <br></h3><br>  √âtant donn√© qu'Ansible a une chose aussi merveilleuse que les r√¥les, nous pensions que maintenant nous prendrions et √©cririons de tr√®s nombreux r√¥les pour toutes les occasions, nous amuserions et les r√©utiliserions pour r√©duire la quantit√© de travail. <br><img src="https://habrastorage.org/webt/va/vb/1v/vavb1vsgfwficbv2gop8l_hepoe.png"><br><br>  Nous pensions que nous √©cririons des r√¥les beaux et intelligents ... <br><br><img src="https://habrastorage.org/webt/rh/hn/sb/rhhnsb_hqwfb-fg3rcdonuzoaqq.png"><br><br>  Mais la vie s'est av√©r√©e plus compliqu√©e. <br><br><h3>  Il s'est av√©r√© qu'en fait <br></h3><br>  Lorsque plus d'une personne travaille √† √©crire un r√¥le ou √† l'am√©liorer, alors tout le monde √©crit au m√™me endroit et des surprises d√©sagr√©ables surviennent: le r√¥le se comporte diff√©remment de ce que l'auteur avait initialement pr√©vu. <br><br>  C'est bien quand c'est appliqu√© √† la fin, mais √ßa n'arrive pas toujours.  Parfois, un r√¥le est ex√©cut√© avec succ√®s, mais sur le syst√®me cible, cela n'affecte pas du tout comme souhait√© √† l'origine. <br><img src="https://habrastorage.org/webt/am/nb/3p/amnb3pp-ggmxzah5glc96ih-npk.png"><br><br>  En cons√©quence, de terribles constructions surviennent, des tentatives de transfert de bash vers Ansible et de soumettre tout cela sous la sauce de gestion de configuration.  Nous avons rencontr√© ce ph√©nom√®ne et √©tions tristes. <br><br><img src="https://habrastorage.org/webt/-s/j0/zl/-sj0zlcvwj2-hrx2oc57cobvefs.png"><br><br>  En r√©fl√©chissant, nous avons constat√© que dans notre gestion de configuration, il existe une sorte de code, ce qui signifie que les pratiques qui s'appliquent √† la gestion de code dans le cycle de vie de d√©veloppement des syst√®mes sont √©galement applicables dans Ansible. <br><br><ul><li>  Recueillir les meilleures pratiques. </li><li>  Appliquer une analyse statique, des peluches. </li><li>  Pour tester. </li><li>  Pour overclocker, entrer dans la gestion des versions. </li></ul><br>  Nous avons d√©cid√© de mettre en ≈ìuvre la pratique √† la maison et sommes imm√©diatement all√©s chercher des outils adapt√©s. <br><br><h3>  Les outils </h3><br>  Du point de vue des syst√®mes de contr√¥le de version et de l'int√©gration continue, il existe des dizaines de solutions disponibles et un zoo de test ramifi√©. <br><br><img src="https://habrastorage.org/webt/xf/u4/2j/xfu42jvysu1pqqzfvext2fdrtxe.png"><br><br>  Du point de vue de la gestion des versions dans Ansible, il n'y a pas tellement de solutions: √©tiqueter dans Git, ou √©tiqueter dans Git et t√©l√©charger sur Galaxy. <br><br>  Il existe de nombreuses approches pour tester les outils, chacune utilisant ce qu'elle aime.  Solutions populaires utilisant KitchenCI, InSpec, Serverspec. <br><br>  Notre √¢me n'a pas menti pour prendre Ansible √©crit en Python, et y m√©langer des outils du monde Ruby.  Par cons√©quent, apr√®s avoir jet√© tout ce qui n'est pas natif du monde Python, nous avons obtenu l'image suivante. <br><br><img src="https://habrastorage.org/webt/xm/qp/1a/xmqp1afvaqz-cggr3as5_w6dzpq.png"><br><br>  Nous utilisons: <br><br><ul><li>  Pour la gestion de la configuration - GitHub et GitLab.  GitLab regarde directement sur GitHub.  Pourquoi cela, je le dirai plus tard. </li><li>  Pour CI, nous avons pris Travis pour la partie publique et GitLab Runner pour la partie priv√©e. </li><li>  Test de mol√©cule. </li><li>  Lancez-vous dans GitHub et ajoutez-le √† Ansible Galaxy. </li></ul><br>  Notre cycle de d√©veloppement avec ces outils est devenu plus amusant. <br><img src="https://habrastorage.org/webt/ho/o0/un/hoo0unaafdbv6-hp46qvbkt3hyi.png"><br><br><h2>  Mol√©cule <br></h2><br>  Cet outil permet de tester pleinement le r√¥le ansible.  Pour ce faire, il a tout: <br><br><ul><li>  Int√©gration avec YAML lint et Ansible lint pour v√©rifier la conformit√© des r√¥les avec nos exigences. </li><li>  Infrastructure de test pour l'ex√©cution de tests fonctionnels. </li><li>  Molecule drivers est l'endroit o√π Molecule d√©ploie notre banc de test.  Tout est pris en charge: Azure, Delegated, Docker, EC2, GCE, LXC, LXD, Openstack, Vagrant. </li><li>  Il y a encore une chose utile et simple - la d√©l√©gation.  Cela signifie que Molecule n'est pas responsable du d√©ploiement du banc de test et que le d√©veloppeur doit √©crire un Playbook pour √©lever le banc de test.  Si vous avez un cloud super priv√©, d√©l√©guez la cr√©ation et la suppression de machines de test, et Molecule elle-m√™me ajoutera tout √† l'int√©rieur. </li></ul><br><img src="https://habrastorage.org/webt/l6/b0/ke/l6b0ke6b7sthgz-xxbuqgoqzvlw.png"><br><br><h3>  Matrice de test <br></h3><br>  Consid√©rez la matrice de test par √©tapes.  Il y a 11 √©tapes au total, mais je serai bref. <br><br><h4>  No. 1. Lint <br></h4><br>  Ils ex√©cutent les peluches YAML et les peluches Ansible et trouvent quelque chose. <br><br><img src="https://habrastorage.org/webt/g_/e6/hx/g_e6hxlk44ca411fabcnbamtkmy.png"><br><br>  Dans l'exemple ci-dessus, lint jure que le shell ne doit pas √™tre simplement appel√© dans Ansible, mais doit √™tre fix√©, li√© √† quelque chose. <br><br><h4>  No. 2. D√©truisez </h4><br>  La mol√©cule se d√©barrasse de tout ce qui reste apr√®s les tests pr√©c√©dents. <br><br>  Il y a des moments o√π une course est pass√©e, un terrain d'entra√Ænement s'est ouvert et les tests sont termin√©s.  Le stand doit √™tre nettoy√© √† la fin, mais un cas de force majeure est intervenu et il n'y a pas eu de nettoyage.  Dans de telles situations, Molecule s'enfuit, d√©truit et nettoie l'environnement des r√©sidus. <br><br><img src="https://habrastorage.org/webt/j2/j2/cn/j2j2cnjnsheyah-w-lbspdbtq1w.png"><br><br><h4>  No. 3. D√©pendance <br></h4><br>  Nous prenons le fichier requirements.yml et ajoutons les d√©pendances de notre r√¥le √† d'autres r√¥les.  Par exemple, une r√©f√©rence au fait que le r√¥le ne d√©collera pas sans Java install√© sur le syst√®me: <br><br><pre><code class="xml hljs">--- - src: lean_delivery.java version: 1.4</code> </pre> <br>  Molecule comprend cela et ex√©cutera le script: <br><br><ul><li>  Goes Galaxy ou Git </li><li>  reconna√Æt que les d√©pendances doivent √™tre trait√©es; </li><li>  Va √† nouveau sur Galaxy; </li><li>  t√©l√©chargements; </li><li>  va se d√©velopper. </li></ul><br><img src="https://habrastorage.org/webt/w1/lc/i1/w1lci1qzqoqsvtqgkutu0ukxmyy.png"><br><br><h4>  N ¬∞ 4. Syntaxe <br></h4><br>  La prochaine √©tape est la v√©rification de la syntaxe.  mais pas votre r√¥le, mais le Playbook de test que vous ajoutez √† Molecule.  Il y a aussi des erreurs de syntaxe dans cette √©tape. <br><br>  La diapositive montre que le r√¥le ansible est appel√© ¬´kibana¬ª, et dans le Playbook de test, il est appel√© ansible-role-kibana.  Le syst√®me dit: "Tout irait bien et vous pouvez le cr√©er ici, mais je ne le ferai pas parce que les noms ne correspondent pas!" <br><br><img src="https://habrastorage.org/webt/_l/sk/ze/_lskze2oxulkdibbjzvlqftvmtu.png"><br><br><h4>  No. 5. Cr√©er <br></h4><br>  √Ä ce stade, nous indiquons le pilote avec lequel le site de test est d√©ploy√©.  Pointez Google - cela augmentera les machines de test dans Google Cloud. <br><br>  Nous pouvons √©crire dans le fichier mol√©cule.yml ce que nous voulons.  Voyons √† quoi cela ressemble sur un exemple pour Docker. <br><br><img src="https://habrastorage.org/webt/y5/se/vh/y5sevh4mpxt6gxsvkwbvhkvc7ry.png"><br><br><ul><li>  Je sp√©cifie les images de docker √† tirer vers le haut. </li><li>  J'indique comment les regrouper pour former un fichier d'inventaire. </li></ul><br>  Je veux avoir deux images de docker: une pour RHEL-like, la seconde pour Debian-like, pour √™tre s√ªr que pendant le test, tout ira bien avec RHEL et Debian. <br><br><h4>  No. 6. Pr√©parez <br></h4><br>  Il s'agit d'une √©tape de pr√©paration de l'environnement d'ex√©cution des tests. <br><br>  Il semble que tout a augment√©, mais vous devez parfois effectuer des r√©glages suppl√©mentaires.  Dans le cas de tests √† l'int√©rieur d'un Docker sur Debian ou Ubuntu, vous devez installer un deuxi√®me Python, ce qui arrive souvent. <br><br><h4>  No. 7. Converge <br></h4><br>  L'√©tape de la premi√®re grande ex√©cution du r√¥le √† l'int√©rieur de l'instance, pour s'assurer qu'il atteint la fin, est ex√©cut√©e et Ansible confirme que tout va bien. <br><br><img src="https://habrastorage.org/webt/7v/my/du/7vmydu7hzixdur-0yvrxv7t_oqa.png"><br><br><ul><li>  Mol√©cule fait r√©f√©rence √† Ansible. </li><li>  Ansible d√©ploy√© sur un site de test. </li><li>  √áa marche. </li><li>  Tout va bien! </li></ul><br><h4>  No. 8. Idempotence <br></h4><br>  Le test d'idempotence est simple et ressemble √† ceci. <br><br><img src="https://habrastorage.org/webt/nc/yi/kd/ncyikd7lhq6ojlpm_rg9fbv581k.png"><br><br><ul><li>  La premi√®re fois que le r√¥le s'ex√©cute √† l'√©tape pr√©c√©dente. </li><li>  Ansible indique combien de modifications ont √©t√© apport√©es. </li><li>  Relance le m√™me r√¥le. </li><li>  V√©rifie que le syst√®me a √©t√© ramen√© √† l'√©tat attendu, mais il n'y a aucun changement lors de la deuxi√®me location. </li></ul><br>  En cons√©quence, nous comprenons que notre r√¥le n'agit pas de mani√®re destructrice. <br><br>  Cette √©tape a caus√© de la douleur aux gars avec qui je travaille.  Ils ont essay√© de contourner pour vaincre le test d'idempotence.  La mol√©cule peut contr√¥ler les √©tapes qu'elle traverse, et la premi√®re chose qu'ils ont faite a √©t√© de d√©sactiver le contr√¥le d'idempotence. <br><br><img src="https://habrastorage.org/webt/0k/wg/jn/0kwgjnxvnxh7aekrwrahmoj3w2a.png"><br><br>  Nous avons pris des pannes d'√©lectricit√© et nous avons battus pour cela, mais les ing√©nieurs sont intelligents et sont all√©s plus loin.  Les d√©veloppeurs ont d√©cid√© de dire que cette √©tape dans Ansible ne change rien. <br><br>  Bien qu'en fait, une sorte d'√©quipe apparaisse ici.  Ansible prendra directement et <br>  va √©craser le fichier, mais en m√™me temps, tout semble idempotent. <br><br><img src="https://habrastorage.org/webt/2j/x4/ay/2jx4aycosp5ster62dawq2xzzfg.png"><br><br>  Lorsque cette astuce a √©galement √©t√© d√©tect√©e, l'image a commenc√© √† ressembler √† ceci. <br><br><img src="https://habrastorage.org/webt/bf/sp/ia/bfspiakbmggjxuxn-hsblzntjzu.png"><br><br>  Bon - le script s'ex√©cutait sous le nom par d√©faut, et il est idempotent. <br><br><h4>  No. 9. Side_effect <br></h4><br>  √Ä l'√©tape suivante, les effets secondaires sont superpos√©s.  Cela n'est pas n√©cessaire, mais c'est pratique lorsque vous testez des r√¥les de diffusion complexes qui d√©pendent les uns des autres. <br><br>  Par exemple, soulevez la pile ELK, puis Elasticsearch dans un cluster.  √Ä l'√©tape side_effect, ajoutez des donn√©es de test et supprimez quelques n≈ìuds du cluster.  Le site de test est pr√™t pour les tests fonctionnels qui ont lieu √† l'√©tape suivante. <br><br><h4>  Num√©ro 10. V√©rifier <br></h4><br>  Test de l'infrastructure. <br><br><img src="https://habrastorage.org/webt/xe/uu/qj/xeuuqjywe_arafmkfl3tu0nmdte.png"><br><br>  Ci-dessus est un exemple de test tr√®s simple.  Nous v√©rifions que le package Docker Community Edition est install√© si Ubuntu est install√©, il a la bonne version et le service est en cours d'ex√©cution. <br><br>  A ce stade du lancement des tests fonctionnels, tout peut √™tre tr√®s compliqu√©. <br><br>  Le meilleur exemple serait probablement, dans le cas de la pile ELK, si nous faisons une demande dans une demande Elasticsearch pour certaines donn√©es de test, et puisque nous connaissons les donn√©es de test, il nous r√©pondra.  Nous ne v√©rifierons pas que tous les composants install√©s sont assembl√©s, mais nous verrons qu'Elasticsearch est op√©rationnel, et donne exactement ce dont vous avez besoin lors de la recherche. <br><br><img src="https://habrastorage.org/webt/--/bl/_v/--bl_vqbdgl6raurbgf0of-hkly.png"><br><br>  Lorsque les tests fonctionnels s'ex√©cutent, cela semble beau, monte et descend tout au long de l'inventaire, et le syst√®me nous dit que tout va bien pour nous.  Encore une fois, les tests s'ex√©cuteront si nous les √©crivons. <br><br><h4>  No. 11. D√©truisez <br></h4><br>  Nous avons effectu√© des tests, il y a un rapport de test sous une forme quelconque, et maintenant nous enlevons toutes les ordures derri√®re nous. <br><br><h3>  Automatisation <br></h3><br>  La mol√©cule est un excellent outil.  Maintenant, la chose la plus simple reste - de lui connecter un syst√®me d'int√©gration continue afin de profiter du test automatique de nos r√¥les, ce que nous avons fait. <br><br><img src="https://habrastorage.org/webt/hx/f6/w8/hxf6w8ahonr80pjg-d1-oquzqcm.png"><br><br>  Comme ailleurs, il existe plusieurs fonctionnalit√©s. <br><br>  Certains des r√¥les que nous √©crivons pour automatiser quelque chose sont bons, mais nous ne pouvons pas tester le syst√®me √† l'aide de Travis, car les r√¥les d√©ploient des produits que nous ne pouvons pas partager pour des raisons de licence. <br><br>  Par exemple, vous disposez d'un d√©ploiement automatis√© d'une base de donn√©es Oracle.  Si vous mettez la base de l'installateur dans un dossier, les avocats de l'entreprise viendront √† vous et jureront grandement.  Pour que tout le monde vive en paix et ne jure pas, nous avons d√©cid√© de faire ce qui suit. <br><br><ul><li>  GitLab, dans l'une de ses derni√®res versions, a appris √† faire du CI pour les r√©f√©rentiels tiers. </li><li>  Le r√¥le r√©side dans le GitHub public, le m√™me GitLab.com public y est connect√©, dans lequel nous avons indiqu√©: ¬´Cher GitLab, r√©cup√®re-nous le CI pour le r√©f√©rentiel externe¬ª. </li><li>  Les coureurs priv√©s sont boulonn√©s √† GitLab, dans un p√©rim√®tre ferm√©, et ils ont d√©j√† acc√®s au binaire, qu'ils peuvent d√©ployer. </li></ul><br>  En fait, le r√¥le est public, les donn√©es aussi, et nous ne trompons personne - nous ex√©cutons de vrais tests avec de vrais outils. <br><br>  Jetons un coup d'≈ìil aux √©tapes de ce √† quoi il ressemble √† Travis. <br><br><h4>  Travis <br></h4><br><img src="https://habrastorage.org/webt/s4/86/d6/s486d6rvzntt55xkmllygy5db5i.png"><br><br>  Les √©tapes: <br><br><ul><li>  √Ä la premi√®re √©tape, la 8e ligne, nous disons √† Travis que nous ne voulons pas seulement le lancer, mais aussi utiliser le service Docker pour que Docker soit disponible √† l'int√©rieur de Travis. </li><li>  Ensuite, la 10√®me ligne, nous prenons nos r√®gles de charpie.  Nous utilisons non seulement les r√®gles par d√©faut des peluches Ansible, mais nous √©crivons √©galement les n√¥tres. </li><li>  Sur la ligne 15, nous appelons d'abord lint pour gagner du temps lors de l'ex√©cution de la matrice de test.  Si quelque chose n'est pas √©crit selon les r√®gles et que les peluches ne le trouvent pas, il revient au d√©but et laisse un rapport.  Un d√©veloppeur qui valide, r√©pare sa validation ou annule les modifications.  Une fois r√©par√©, laissez-le venir, et nous continuerons le test. </li></ul><br><h4>  CI public <br></h4><br>  CI public semble √©l√©mentaire. <br><br><img src="https://habrastorage.org/webt/tc/am/vt/tcamvta_zifwuzwes75yw5tnk64.png"><br><br>  De GitHub, une fl√®che √† Travis, √† l'int√©rieur de laquelle vivent Molecule et Docker. <br><br><h4>  CI priv√© <br></h4><br>  Pour la partie priv√©e de GitLab, tout est pareil. <br><br><img src="https://habrastorage.org/webt/zs/3_/zc/zs3_zc-hg2mkaitiuji_cquv9yg.png"><br><br>  Dans le p√©rim√®tre priv√©, nous courons un coureur, et l'image semble plus amusante. <br><br><img src="https://habrastorage.org/webt/jj/t4/yq/jjt4yq5oizqkseowdueobidaato.png"><br><br>  Le code passe de GitHub √† GitLab, quelque part o√π un runner priv√© s'ex√©cute, qui peut extraire des services externes, par exemple, ex√©cuter quelque chose sur Amazon. <br><br>  Une petite digression.  Le d√©marrage et le d√©ploiement d'un environnement de test sur Amazon ne veulent pas √™tre port√©s, car vous avez besoin de cl√©s.  Trouver des m√©canismes pour les rendre publics, mais en m√™me temps ne pas devenir la prochaine plate-forme de d√©marrage pour l'exploitation mini√®re - c'est une t√¢che non triviale.  Par cons√©quent, nous ne l'avons pas r√©solu, mais avons pris le coureur en priv√© afin de ne pas exploiter les bitcoins Amazon. <br><br>  M√™me ici, nous √©tions un peu paresseux et avons fait ce qui suit.  Chez EPAM, nous avons notre propre cloud priv√© et il est hybride.  Cela signifie que de nombreux clouds publics sont accessibles depuis le cloud interne, comme les r√©gions.  Vous ne pouvez pas √©crire mille tests, mais jouer avec les r√©gions et dire: ¬´Maintenant, testez selon ce sc√©nario de test pour AWS, EPAM Cloud, r√©gion Azure¬ª. <br><br><h3>  Galaxie Ansible <br></h3><br>  Nous sommes arriv√©s √† la finale, notre r√¥le est vert, beau, nous le publierons dans Galaxy. <br><br><img src="https://habrastorage.org/webt/0q/zw/tw/0qzwtww1t3m0qoyvlgkzgpptg9u.png"><br><br>  C'est une op√©ration simple: <br><br><ul><li>  L'appel de webhook qui se trouve √† Travis. </li><li>  Dans ce cas, Travis se d√©clenchera, CI s'ex√©cutera √† nouveau. </li><li>  Appelez le webhook. </li><li>  La nouvelle version se d√©veloppera avec succ√®s dans Galaxy. </li></ul><br>  Il y a une fonctionnalit√© - si vous ne marquez pas un r√¥le, ne marquez pas, ne lui attribuez pas de version, alors dans Galaxy, il sera toujours sans version.  D√®s qu'un autre d√©veloppeur souhaite l'installer lui-m√™me via l'installation Ansible Galaxy, il supprime le r√¥le qui se trouve dans la branche principale, ou dans une autre branche par d√©faut.  Par d√©faut, la branche n'est pas toujours stable, ce qui n'est pas pratique. <br><br><blockquote>  Si vous publiez quelque chose sur Galaxy, n'oubliez pas de le taguer, juste pour qu'il y ait des versions, et tout √©tait cool. <br></blockquote><br><h3>  Patterns <br></h3><br>  Je partage une petite astuce: afin de ne pas copier-coller √† chaque fois lors de l'√©criture d'un nouveau r√¥le, nous avons d√©cid√© de cr√©er des mod√®les et un r√©f√©rentiel s√©par√© dans lequel nous pla√ßons le mod√®le afin d'√©crire rapidement des r√¥les √† partir de z√©ro. <br><br>  Le mod√®le a des param√®tres par d√©faut pour Ansible lint et GitHub issue_template.  Tout est dans le domaine public, donc issue_template dans une belle forme √©tait aussi beau pour nous d'√©mettre des demandes de pull ou des rapports de bugs.  Nous ajoutons des mod√®les pour Gitignore, Gitlab-ci et une licence au m√™me r√©f√©rentiel. <br><br><img src="https://habrastorage.org/webt/eb/4m/ta/eb4mta07gv_dgxqszmdkpobnfzq.png"><br><br>  Par d√©faut, nous publions sous la licence Apache 2.0.  Si vous souhaitez venir chez nous et r√©utiliser les mod√®les, vous pouvez tout emporter, cr√©er un r√©f√©rentiel ferm√© et ne rien expliquer √† personne.  Merci Apache. <br><br>  Nous avons plusieurs options de test pour que vous puissiez rapidement d√©marrer et tout d√©marrer. <br><br><h2>  R√©sum√© <br></h2><br>  Il n'y aura aucune conclusion, mais des liens vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mon GitHub</a> , mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">profil Galaxy</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub Lean Delivery</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ansible Galaxy</a> .  En utilisant les liens, vous pouvez voir comment tout fonctionne.  Tous les exemples sont disponibles gratuitement. <br><br><blockquote>  La prochaine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conf√©rence DevOps</a> se tiendra en mai. <br><br>  En attendant l'√©v√©nement, abonnez-vous √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cha√Æne YouTube</a> et √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">newsletter</a> .  La cha√Æne sera r√©approvisionn√©e avec les enregistrements des meilleurs rapports, et dans la liste de diffusion, il y aura des s√©lections de documents utiles, des transcriptions et des nouvelles DevOps. <br><br>  Abonnez-vous, ce sera int√©ressant :) <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431542/">https://habr.com/ru/post/fr431542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431532/index.html">Memristors constitu√©s de pi√®ces de 2 nm d'√©paisseur</a></li>
<li><a href="../fr431534/index.html">Identit√©s des probl√®mes parmi les d√©veloppeurs</a></li>
<li><a href="../fr431536/index.html">Ceph. Anatomie de catastrophe</a></li>
<li><a href="../fr431538/index.html">Case Rate & Goods et Mobio: augmentation progressive de tous les indicateurs</a></li>
<li><a href="../fr431540/index.html">Packages et gestionnaires de packages pour k8s</a></li>
<li><a href="../fr431544/index.html">Portez DevOps aux masses</a></li>
<li><a href="../fr431546/index.html">Pourquoi disons-nous OK?</a></li>
<li><a href="../fr431548/index.html">Solar Dozor - Qu'est-ce qui se cache derri√®re les √©toiles?</a></li>
<li><a href="../fr431550/index.html">Moulage par injection de film (IMD): comment cela fonctionne</a></li>
<li><a href="../fr431554/index.html">Facebook comme le compteur d'un vieux compteur √©lectrique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>