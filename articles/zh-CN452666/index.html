<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍀 👎🏾 ⚰️ 如何在您的应用中进行小额付款 🐵 📴 🔭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本周，我花了我的第一个基于Telegram聊天机器人的公共宠物应用程序的编码，该机器人充当了比特币钱包，并允许在Telegram用户和其他所谓的“ Lightning Apps”之间发送和接收提示。 我认为您通常对比特币和电报很熟悉，我会尽量简短而又不深入地介绍细节。 关于比特币的更多资源可以在这里...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何在您的应用中进行小额付款</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452666/"><p> 本周，我花了我的第一个基于Telegram聊天机器人的公共宠物应用程序的编码，该机器人充当了比特币钱包，并允许在Telegram用户和其他所谓的“ Lightning Apps”之间发送和接收提示。 我认为您通常对比特币和电报很熟悉，我会尽量简短而又不深入地介绍细节。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关于比特币的</a>更多<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">资源可以在这里找到</a> ，Telegram只是一个即时通讯工具，使您可以使用其平台创建自定义应用程序（聊天机器人）。 </p><br><h3> 这种应用程序的重点是什么？ </h3><br><ul><li> 允许给其他用户的想法和答案打分，而不是实际价值 <br>  “虚拟喜欢”。 这使在线对话达到了一个全新的水平 </li><li> 可以与其他实体合作的小额支付应用程序的实际示例 <br> 通过互联网使用开放协议 </li><li> 所有模块都是开源项目，可以轻松重用和调整 <br> 为您自己的项目。 应用程序不会中继第三方商业服务。 <br> 该应用程序甚至属于电子商务领域（目前几乎已关闭） <br> 基于开放式解决方案。 </li></ul><br><h3> 用例是什么？ </h3><br><p> 像这样的东西... <br></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="图片"></div><a name="habracut"></a><br> 或那样 <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="图片"></div><br><p> 数字是什么意思？ 这些是<b>比特币单位-satoshis</b> 。 至于2019年中期，1000 satoshis的价值为$ 0.06。 您可以在线使用它，也可以使用许多可用服务将其兑换成当地货币。 因此，这不仅是另一个<i>“数据库中的号码”</i>或<i>“您可以在我们的合作伙伴商店中使用的优惠券”</i> ，而且是一笔<b>真正的互联网资金</b> 。 </p><br><p> 如果您在应用程序中没有要使用的比特币，您可能会问该怎么办。 您只需从现有应用程序用户处获得小费，或者在各种交易所或手机或PC上的比特币钱包中购买少量的比特币。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="图片"></p><br><p> 收到比特币后，您可以启动<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@atomic_tipbot</a>并进行存款。 </p><br><p> 您会看到一张发票​​，您可以选择首选的付款方式并仅扫描QR码或按发票上的按钮（ <i>“在钱包中打开”</i> ）就可以汇款。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="图片"></p><br><p> 在您的手机钱包中确认付款，您几乎会立即在Telegram中看到一个确认屏幕。 </p><br><p> 到目前为止，我们接触了应用程序的两个独立部分：电报bot后端和付款处理系统（实际上更像是前端）。 </p><br><p> 为了创建这个Telegram机器人，我使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python Telegram Bot</a> 。 当然，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">机器人是开源的</a> 。 </p><br><p> 作为生成发票，检查状态，发送通知和处理UX的付款处理系统，使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BTCPayServer</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">可以在此处找到相关文档</a> 。 </p><br><p> 如果您正在查看如何直接处理付款事件，则可以查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Electrum CLI手册页</a>上的链上付款，并查看链下（Lightning）付款（如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lightning-charge</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sparko</a> ）的解决方案。 </p><br><h3> 您说“没有第三方”和“没有云服务”！ </h3><br><p> 是的，是的。 在我的应用程序中，我正在使用BTCPayServer实例的免费共享托管<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-BTCPayJungle</a> ，但是甚至可以在自己的专用服务器上启动。 只需记住您当时需要大约500GB的空间来存储比特币和Litecoin区块链。  BTCPayServer不持有任何可能使黑客控制您钱包中资金的私钥或敏感信息。 对于链上（标准）付款，您需要提供从钱包到BTCPayServer的xpub密钥，以便它能够生成公共地址。 这样，BTCPay体系结构甚至可以在共享环境上以不信任的方式处理付款。 如果使用经过验证的钱包（例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Electrum）</a> ，则配置非常简单。 </p><br><h3> 什么是闪电网络？ </h3><br><p> 这就像是比特币的附件，它增加了额外的抽象层，并允许进行即时和几乎免费的比特币交易。 所有这些东西都可以归功于密码多重签名魔术，这通常被称为<em>智能合约</em> 。  LN协议有多种实现。 我正在使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">c-lightning</a> C实现。 </p><br><p> 链上和链外（闪电）付款之间的主要区别在于交易的存储方式。 所有<b>链上</b>交易都会广播到整个网络，因此，如果将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">挖掘</a>包含该交易的区块，则每个运行中的比特币节点会将该交易记录到区块链中。 嘿， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">BitFury</a> ，对吗？  ;）这就是为什么我们称此类交易<b>为链上</b>交易的原因。 此类交易将存储在区块链中，直到其存亡。 可以通过网络公开跟踪，分析和监视任何此类交易。 </p><br><p> 在<b>链</b>下交易（闪电）的情况下，事情会以其他方式发生。 每个闪电节点都有<i>（可能很多）</i>链上地址，所有地址都从此开始。 当在这样的地址上收到资金时，使用加密技术的节点可以打开通往另一个节点的所谓的<i>闪电通道</i> ，这意味着这两个节点就它们之间的资金可用性达成了协议。 后来，所有通过通道进行的事务（自己的事务，或者可能是来自另一个节点的路由事务）都仅存储在这两个节点上（如果存在，则存储在中间节点上）。 存储在网络区块链中的唯一交易是渠道开放和关闭交易。 这就是为什么我们将闪电交易称为<b>脱链</b>交易的原因。 通常，它们仅存在于节点数据库文件中。 </p><br><h3> 整个图都可视化 </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="图片"><br><p> 短篇小说： </p><br><p>  1）用户发送消息并要求在<b>电报</b>上向机器人存入<b>资金</b> </p><br><p>  2）Telegram触发bot的<b>python应用</b> </p><br><p>  3） <b>python应用程序</b>将请求发送到<b>BTCPayServer</b> </p><br><p>  4）BTCPayServer生成BTC和LTC的传入地址，并与<b>lightning-charge联系</b> ，后者从<b>c-lightning</b>守护程序获取数据。 结果，我们得到了处理良好的HTML框架用于付款处理 </p><br><p>  5）用户支付发票并看到确认 </p><br><p>  6） <b>BTCPayServer</b>将<b>发票</b> <i>付款通知</i> （IPN）发送到指定的回调URL，在本例中为 <br> 将转到<b>callbacks.py</b> （另一个用于监听回调的python应用） </p><br><p>  7）根据完整的付款明细，更改用户余额并获得通知 </p><br><p>  <i>...如果用户决定提取资金（收到的小费）...</i> </p><br><p>  8） <b>Bot的python应用程序</b>侦听QR的文本或图像，当它获取发票数据（长字符串）时，它向另一个python应用程序<b>paylightning.py *</b>发送付款请求，该应用程序使用c-lightning初始化付款RPC </p><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="图片"><br><p>  <i>*公平地说，我需要提到我的付款包装人paylightning.py不完整，在某些特定情况下可能返回假阴性。</i>  <i>如果<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用于</a>生产用途，则应使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">经过良好测试的付款包装纸进行c-lightning</a> 。</i> </p><br><p> 用户可以在群聊中相互发送提示，并可以不受限制地发送/接收<b>值</b> 。 但这还不是全部。 借助Lightning Network协议（在某种统一和简化的支付网络中），您可以将相同的余额硬币发送到完全不同的应用程序。 电报上还有另一个比特币小费机器人-@lntxbot。 用户可以向该机器人请求存款 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="图片"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="图片"></p><br><p> 只需将数据从@lntxbot转发到@atomic_tipbot即可！ </p><br><p> 这不再是“数据库中的号码交换”，而是两个独立的，不相关的“数据库”之间的付款。  Bot已经集成了很少的“ LApps”： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sat2.io</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">lnsms.world</a> 。 </p><br><p>  <b>您可能会问， <i>LApp集成</i>到底意味着什么？</b> </p><br><p> 每个<i>闪电网络</i>节点都充当比特币钱包。 它具有链上和链下的平衡。 在短节点维护任务中，链上余额通常用于打开渠道并从关闭的渠道存储资金。 链外余额恰好用于在节点之间交换资金。 每个节点的核心功能是发送或接收资金的能力，因此节点作为一种软件提供<i><b>付款</b></i>和<i><b>发票</b></i>方式。 我将简短说明它是如何发生的： </p><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br><p> 在这种情况下，将生成<a href="">BOLT11发票</a> ，这是针对比特币（以及Litecoin）网络中的付款请求的统一格式。 此字符串包括有关发票收件人，金额，时间戳，到期时间等的数据。 要解码此字符串，c-lightning提供了definepay方法： </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> 闪电-CLI decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre> <br><p> 如果需要支付发票，则应使用c-lightning的支付方式： </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> 闪电CLI工资lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre> <br><p> 所有付款状态均由整个网络和您自己的节点处理。 您根本不需要（但有可能这样做）与接收方应用程序开发人员或其API，某些卡处理提供商或任何银行进行通信，以获取有关您付款的确认信息或从您自己的资金中释放资金帐户。 您的帐户余额没有任何退款或其他任何外部影响。 您需要的只是一个根据分散的网络规则运行的软件。 这是一种通过Internet交换价值的解决方案，而无需中间任何仲裁者来决定您的付款是否符合某些规则，有时甚至是各方以前都不知道的。 比特币中没有“内部”规则，您的应用程序需要完成的所有规则都是公开的。 </p><br><p> 这使得人们之间甚至软件本身之间以真正自治的方式<b>直接</b> ， <b>几乎免费</b>和<b>即时地</b>通过互联网进行价值交换成为可能。 </p><br><p> 如果有一种方法可以从其他应用程序中获取付款数据，那么您就可以在财务上采取行动。 在我们的示例中，lnsms.world是一个网络应用程序，可让您将短信发送至任意数量并用比特币付款。 要将此类选项集成到我们的应用中，我们只需要将所需数据从Web表单传递到lnsms.world： </p><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre> <br><p> 我不知道是什么原因，但是lnsms会以201 HTTP状态代码进行响应并返回BOLT11发票。 好了，足够支付这张发票，我们的用户将在收到付款后不久发送短信。 我们可以免费收取一些费用，这是我们的免费选择。 </p><br><p> 现在，想象一下，您的机器人实际上是一个更有用的应用程序，并且无需支付给另一个机器人，而要支付连接到Internet的其他实体。 或者，这些可能是软件，机器，商店，服务提供商之间的付款，每隔几秒钟定期重复一次？ 您觉得小额付款的力量吗？ 这就是物联网的样子。 现在已经有了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://althea.org/</a>这样的项目，并且在不久的将来，我们将在所谓的电子商务领域面临巨大的变化。 </p><br><p> 如果您喜欢这篇文章，并且自己尝试使用比特币付款，可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在我的小费页面上给我一些小费</a> 。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN452666/">https://habr.com/ru/post/zh-CN452666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN452648/index.html">PHP：如何解析复杂的XML文件而不会淹没在本机代码中</a></li>
<li><a href="../zh-CN452652/index.html">安全周21：Whatsapp漏洞，英特尔处理器中的新漏洞，Windows中的零日漏洞</a></li>
<li><a href="../zh-CN452656/index.html">为Redd中安装的FPGA开发最简单的“固件”，并以内存测试为例进行调试</a></li>
<li><a href="../zh-CN452662/index.html">Selectel中的HPE服务器</a></li>
<li><a href="../zh-CN452664/index.html">我为一个静态网页收取了$ 18,000的费用...</a></li>
<li><a href="../zh-CN452668/index.html">如何检查Cookie是否符合GDPR要求-新的开放工具将为您提供帮助</a></li>
<li><a href="../zh-CN452670/index.html">谁是数据工程师，他们将如何发展？</a></li>
<li><a href="../zh-CN452672/index.html">每周哈伯。 认识Habrapodcast试点版本</a></li>
<li><a href="../zh-CN452674/index.html">5月21日至5月26日在莫斯科举行的数字活动</a></li>
<li><a href="../zh-CN452682/index.html">预测与讨论：混合存储系统将让位给全闪存</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>