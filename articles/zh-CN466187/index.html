<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ« ğŸ‘¨ğŸ¿â€âš•ï¸ â­ï¸ Unity3dçš„å¯è§†é€»è¾‘ç¼–è¾‘å™¨ã€‚ ç¬¬äºŒéƒ¨åˆ† ğŸ˜ ğŸ”¹ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 å°Šæ•¬çš„è¯»è€…æ‚¨å¥½ï¼Œåœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³é‡ç‚¹ä»‹ç»Unity3dçš„å¯è§†é€»è¾‘ç¼–è¾‘å™¨å†…æ ¸çš„ä½“ç³»ç»“æ„ä¸»é¢˜ã€‚ è¿™æ˜¯æœ¬ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ æ‚¨å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ä¸Šä¸€ç¯‡ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦è°ˆä»€ä¹ˆå‘¢ï¼Ÿ å¯è§†ç¼–è¾‘å™¨åŸºäºæ ¸å¿ƒå†…æ ¸ï¼Œè¯¥å†…æ ¸ä½¿æ‚¨å¯ä»¥è¿è¡Œï¼ŒåŠ è½½å’Œå­˜å‚¨é€»è¾‘æ•°æ®ã€‚ åè¿‡æ¥ï¼Œå¦‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€è¿°ï¼Œå†…æ ¸ä½¿ç”¨Scriptable...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unity3dçš„å¯è§†é€»è¾‘ç¼–è¾‘å™¨ã€‚ ç¬¬äºŒéƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466187/"><h2> å¼•è¨€ </h2><br> å°Šæ•¬çš„è¯»è€…æ‚¨å¥½ï¼Œåœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³é‡ç‚¹ä»‹ç»<b>Unity3d</b>çš„å¯è§†é€»è¾‘ç¼–è¾‘å™¨å†…æ ¸çš„ä½“ç³»ç»“æ„ä¸»é¢˜ã€‚ è¿™æ˜¯æœ¬ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>é˜…è¯»ä¸Šä¸€ç¯‡ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦è°ˆä»€ä¹ˆå‘¢ï¼Ÿ å¯è§†ç¼–è¾‘å™¨åŸºäºæ ¸å¿ƒå†…æ ¸ï¼Œè¯¥å†…æ ¸ä½¿æ‚¨å¯ä»¥è¿è¡Œï¼ŒåŠ è½½å’Œå­˜å‚¨é€»è¾‘æ•°æ®ã€‚ åè¿‡æ¥ï¼Œå¦‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€è¿°ï¼Œå†…æ ¸ä½¿ç”¨<b>ScriptableObject</b>ä½œä¸ºä½¿ç”¨é€»è¾‘ç»„ä»¶çš„åŸºç±»ã€‚ è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘æ‰€æœ‰è¿™äº›æ–¹é¢ã€‚ <br><br> è¯¥ç³»åˆ—æ–‡ç« ï¼š <br><br>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Unity3dçš„å¯è§†é€»è¾‘ç¼–è¾‘å™¨ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> <br><a name="habracut"></a><br><h2> ä¸ºä»€ä¹ˆæ˜¯ScriptableObjectï¼Ÿ </h2><br> åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œæˆ‘è€ƒè™‘äº†å¾ˆé•¿æ—¶é—´æ¥æ„å»ºç³»ç»Ÿã€‚ åœ¨ç¬¬ä¸€ç§å½¢å¼ä¸­-å®ƒæ˜¯<b>MonoBehaviour</b> ï¼Œä½†æ˜¯æˆ‘ä¸å¾—ä¸æ”¾å¼ƒè¿™ä¸ªæƒ³æ³•ï¼Œå› ä¸ºè¿™äº›è„šæœ¬åº”è¯¥ä½œä¸ºç»„ä»¶æŒ‚åœ¨<b>GameObjectä¸Š</b> ã€‚ ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨æ‚¨è‡ªå·±çš„ç±»çš„æƒ³æ³•ï¼Œè¯¥ç±»ä¸æ˜¯<b>UnityEngine.Object</b>çš„åä»£ã€‚ ä½†æ˜¯æ­¤é€‰é¡¹è™½ç„¶èµ·ä½œç”¨ï¼Œä½†å¹¶æœªæ‰æ ¹ï¼Œä½†å®ƒä¸€ç›´æ‹–å»¶ç€ç¼–å†™å…¶åºåˆ—åŒ–ç¨‹åºï¼Œæ£€æŸ¥å™¨ï¼Œåƒåœ¾æ”¶é›†å™¨ç­‰ã€‚ç»“æœï¼Œå”¯ä¸€åˆç†çš„æ–¹æ³•æ˜¯ä½¿ç”¨<b>ScriptableObject</b> ï¼Œå¦‚æœåˆ›å»ºï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç±»ä¼¼äº<b>MonoBehaviour</b> ã€‚ <b>åœ¨</b>åº”ç”¨ç¨‹åºé€šè¿‡<b>ScriptableObject.CreateInstance</b>è¿è¡Œæ—¶å‘ç”Ÿã€‚ æ­¤å¤–ï¼Œä½¿ç”¨<b>JsonUtility</b> ï¼ˆå°½ç®¡ç°åœ¨ä¸å†æ˜¯é—®é¢˜ï¼‰å’Œ<b>Unity</b>æ£€æŸ¥å™¨å¯ä»¥è‡ªåŠ¨è§£å†³æ­¤é—®é¢˜ã€‚ <br><br><h2> å»ºç­‘å­¦ </h2><br> ä¸‹é¢æ˜¯<b>uViLEd</b>æ ¸å¿ƒ<b>ç»„æˆçš„</b>ä¸€èˆ¬ç¤ºæ„å›¾ã€‚ <br><br><img src="https://habrastorage.org/webt/xd/o-/kp/xdo-kp-skmrrvbfw0jy33l3r02o.png" alt="å›¾ç‰‡"><br><br> è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘æ¯ä¸ªå…ƒç´ ã€‚ <br><br><h3> æ§åˆ¶è€… </h3><br> æ§åˆ¶å™¨æ˜¯å†…æ ¸çš„ä¸»è¦å…ƒç´ ï¼Œå®ƒæ˜¯<b>MonoBehavior</b>è„šæœ¬ï¼ˆæ•´ä¸ªç³»ç»Ÿä¸­å”¯ä¸€çš„è„šæœ¬ï¼‰ã€‚ æ§åˆ¶å™¨ç±»æ˜¯å•ä¾‹ï¼Œå¹¶ä¸”é€»è¾‘çš„æ‰€æœ‰ç»„ä»¶å‡å¯è®¿é—®ã€‚ æ­¤ç±»çš„ä½œç”¨ï¼š <br><br><ol><li> å­˜å‚¨<b>Unity</b>å¯¹è±¡é“¾æ¥ </li><li> åœ¨åœºæ™¯å¼€å§‹æ—¶å¼€å§‹é€»è¾‘ </li><li> è¡¨ç¤ºå¯¹ä»å¤–éƒ¨æºè¿è¡Œé€»è¾‘çš„æ–¹æ³•çš„è®¿é—® </li><li> æä¾›ç»„ä»¶ä¸­<b>Mono</b>æ–¹æ³•çš„å·¥ä½œ </li></ol><br><div class="spoiler">  <b class="spoiler_title">æ§åˆ¶å™¨ç±»åŸºæœ¬ä»£ç </b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LogicController _instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LogicController Instance { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { _instance = _instance ?? FindObjectOfType&lt;LogicController&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } } [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SceneLogicData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TextAsset BinaryData =&gt; _data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextAsset _data; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SceneLogicData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, TextAsset binaryData</span></span></span><span class="hljs-function">)</span></span> { _id = id; _data = binaryData; Name = name; } } [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;SceneLogicData&gt; SceneLogicList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;SceneLogicData&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sceneLogic <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SceneLogicList) { RunLogicInternal(LogicStorage.Load(sceneLogic.BinaryData)); } } } }</code> </pre> <br></div></div><br>  <b>æ³¨æ„</b> ï¼šæ¯ä¸ªåœºæ™¯éƒ½æœ‰è‡ªå·±çš„æ§åˆ¶å™¨å’Œé€»è¾‘é›†ã€‚ <br>  <b>æ³¨æ„</b> ï¼šæœ‰å…³åŠ è½½é€»è¾‘æ•°æ®åŠå…¶å¯åŠ¨çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå°†å¦è¡Œè®¨è®ºã€‚ <br><br><h3>  uViLEdå†…æ ¸çš„æ ¸å¿ƒå…ƒç´  </h3><br><h4> ç»„æˆéƒ¨åˆ† </h4><br> åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å·²ç»è¯´è¿‡è¯¥ç»„ä»¶æ˜¯<b>ScriptableObject</b> ã€‚ æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯<b>LogicComponent</b>ç±»çš„åä»£ï¼Œè€Œ<b>LogicComponent</b>ç±»<b>åˆå¾ˆ</b>ç®€å•ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> MonoBehaviour coroutineHost =&gt; _logicHost; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MonoBehaviour _logicHost; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } }</code> </pre><br> åœ¨è¿™é‡Œï¼Œ <b>coroutineHost</b>æ˜¯åˆ°é€»è¾‘æ§åˆ¶å™¨çš„é“¾æ¥ï¼Œä»…ä¸ºæ–¹ä¾¿èµ·è§è€Œå¼•å…¥ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒç”¨äºä¸åç¨‹ä¸€èµ·å·¥ä½œã€‚ ä¸ºäº†å°†ç»„ä»¶ä¸<b>Unity</b>é¡¹ç›®ä¸­å­˜åœ¨çš„å…¶ä»–ä»£ç åˆ†å¼€ï¼Œå¿…é¡»ä½¿ç”¨è¿™ç§æŠ½è±¡ã€‚ <br><br><h4> å˜æ•° </h4><br> å¦‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€è¿°ï¼Œå˜é‡æ˜¯ç”¨äºå­˜å‚¨æ•°æ®çš„ä¸“ç”¨ç»„ä»¶ï¼Œå…¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¯å˜æ‰§è¡Œä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Variable</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">Variable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Changed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T newValue</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Changed OnChanged; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Set OnSet; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _value; }<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> changed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_value == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span> || (_value != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !_value.Equals(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>))) { changed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } _value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (changed) { OnChanged?.Invoke(); } OnSet?.Invoke(_value); } } [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OnSet != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventHandler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OnSet.GetInvocationList()) { OnSet -= (Set)eventHandler; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OnChanged != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventHandler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OnChanged.GetInvocationList()) { OnChanged -= (Changed)eventHandler; } } } } }</code> </pre><br></div></div><br> è¿™é‡Œï¼Œ <b>å˜é‡</b>æ˜¯æ‰€æœ‰å˜é‡çš„åŸºæœ¬æŠ½è±¡ç±»ï¼Œå¿…é¡»å°†å®ƒä»¬ä¸æ™®é€šç»„ä»¶åˆ†å¼€ã€‚ ä¸»ç±»æ˜¯<b>é€šç”¨</b>ç±»ï¼Œå®ƒå­˜å‚¨æ•°æ®æœ¬èº«å¹¶æä¾›ç”¨äºè®¾ç½®å€¼å’Œæ›´æ”¹å€¼çš„äº‹ä»¶ã€‚ <br><br><h4> é€šè®¯æŠ€æœ¯ </h4><br> æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å‘Šè¯‰è¿‡ä»€ä¹ˆå…³ç³»ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿå®ä½“ï¼Œå®ƒå…è®¸ç»„ä»¶ä½¿ç”¨å½¼æ­¤çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿˜å¼•ç”¨é€»è¾‘å˜é‡ã€‚ å¯¹äºç¨‹åºå‘˜è€Œè¨€ï¼Œæ­¤è¿æ¥æ˜¯è½¯è¿æ¥ï¼Œå¹¶ä¸”åœ¨ä»£ç ä¸­ä¸å¯è§ã€‚ æ‰€æœ‰é€šä¿¡éƒ½æ˜¯åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­å½¢æˆçš„ï¼ˆè¯·åœ¨ä¸‹é¢é˜…è¯»ï¼‰ã€‚ è€ƒè™‘å…è®¸æ‚¨å½¢æˆå…³ç³»çš„ç±»ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å…¥å£ç‚¹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">INPUT_POINT</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;T&gt; Handler; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">INPUT_POINT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action Handler; } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">å‡ºå£ç‚¹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OUTPUT_POINT</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Action&lt;T&gt;&gt; _linkedInputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&lt;T&gt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T param</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _linkedInputPoints) { handler(param); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OUTPUT_POINT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Action&gt; _linkedInputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _linkedInputPoints) { handler(); } } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">å¯å˜å‚è€ƒ</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VARIABLE_LINK</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; _variable.Value; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; _variable.Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt; _variableProperty { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; _variable; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _variable = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; VariableWasSet = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; InitializeEventHandlers(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> VariableWasSet { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt; _variable; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt;.Set _automaticSetHandler; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt;.Changed _automaticChangedHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSetEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Set handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnSet += handler; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _automaticSetHandler = handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveSetEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Set handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnSet -= handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddChangedEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Changed handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnChanged += handler; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _automaticChangedHandler = handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveChangedEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Changed handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnChanged -= handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeEventHandlers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_automaticSetHandler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _variable.OnSet += _automaticSetHandler; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_automaticChangedHandler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _variable.OnChanged += _automaticChangedHandler; } } } }</code> </pre><br></div></div><br>  <b>æ³¨æ„</b> ï¼šè¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦è¯´æ˜ï¼Œç”¨äºè®¾ç½®äº‹ä»¶å’Œæ›´æ”¹å˜é‡å€¼çš„è‡ªåŠ¨å¤„ç†ç¨‹åºä»…åœ¨<b>Constructor</b>æ–¹æ³•ä¸­è®¾ç½®åæ‰ä½¿ç”¨ï¼Œå› ä¸ºé‚£æ—¶å°šæœªè®¾ç½®å¯¹å˜é‡çš„å¼•ç”¨ã€‚ <br><br><h3> ä½¿ç”¨é€»è¾‘ </h3><br><h4> è´®è— </h4><br> åœ¨å…³äºå¯è§†é€»è¾‘ç¼–è¾‘å™¨çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæåˆ°äº†é€»è¾‘æ˜¯ä¸€ç»„å˜é‡ï¼Œç»„ä»¶ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SceneName = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentsStorage Components = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentsStorage(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LinksStorage Links = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinksStorage(); } }</code> </pre><br> è¯¥ç±»æ˜¾ç„¶æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œä½†æ˜¯<b>Unityçš„</b> <b>JsonUtility</b>ä¸ç”¨äºåºåˆ—åŒ–ã€‚ è€Œæ˜¯ä½¿ç”¨äºŒè¿›åˆ¶é€‰é¡¹ï¼Œå…¶ç»“æœä¿å­˜ä¸ºå¸¦æœ‰<b>å­—èŠ‚</b>æ‰©å±•åçš„æ–‡ä»¶ã€‚ ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ é€šå¸¸ï¼Œä¸»è¦åŸå› æ˜¯å®‰å…¨æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€‰æ‹©ä»å¤–éƒ¨æºåŠ è½½é€»è¾‘ï¼Œä»è€Œå¯ä»¥åŠ å¯†æ•°æ®ï¼Œå¹¶ä¸”é€šå¸¸ï¼Œååºåˆ—åŒ–å­—èŠ‚æ•°ç»„æ¯”æ‰“å¼€<b>json</b>å›°éš¾ã€‚ <br><br> è®©æˆ‘ä»¬ä»”ç»†<b>çœ‹ä¸€ä¸‹</b> <b>ComponentsStrorage</b>å’Œ<b>LinksStorageç±»</b> ã€‚ ç³»ç»Ÿä½¿ç”¨<b>GUID</b>è¿›è¡Œå…¨å±€æ•°æ®è¯†åˆ«ã€‚ ä¸‹é¢æ˜¯ç±»ä»£ç ï¼Œå®ƒæ˜¯æ•°æ®å®¹å™¨çš„åŸºç¡€ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Identifier</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Id)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Id = System.Guid.NewGuid().ToString(); } } }</code> </pre><br> ç°åœ¨è€ƒè™‘<b>ComponentsStorage</b>ç±»çš„ä»£ç ï¼Œé¡¾åæ€ä¹‰ï¼Œè¯¥ä»£ç å­˜å‚¨æœ‰å…³é€»è¾‘ç»„ä»¶çš„æ•°æ®ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentsStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentData</span></span> : <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Assembly = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JsonData = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;ComponentData&gt; Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ComponentData&gt;(); } }</code> </pre><br> è¯¥ç±»éå¸¸ç®€å•ã€‚ ä¸ºæ¯ä¸ªç»„ä»¶å­˜å‚¨ä»¥ä¸‹ä¿¡æ¯ï¼š <br><br><ol><li> åœ¨<b>æ ‡è¯†ç¬¦ä¸­</b>æ‰¾åˆ°çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆ <b>GUID</b>å­—ç¬¦ä¸²ï¼‰ </li><li> ç±»å‹åç§° </li><li> é›¶éƒ¨ä»¶ç±»å‹æ‰€åœ¨çš„è£…é…ä½“çš„åç§° </li><li> å¸¦æœ‰åºåˆ—åŒ–æ•°æ®çš„Jsonå­—ç¬¦ä¸²ï¼ˆ <b>JsonUtility.ToJsonçš„</b>ç»“æœï¼‰ </li><li> ç»„ä»¶æ´»åŠ¨ï¼ˆçŠ¶æ€ï¼‰æ ‡å¿— </li></ol><br> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<b>LinksStorage</b>ç±»ã€‚ æ­¤ç±»å­˜å‚¨æœ‰å…³ç»„ä»¶ä¹‹é—´çš„å…³ç³»ä»¥åŠæœ‰å…³å˜é‡çš„å¼•ç”¨çš„ä¿¡æ¯ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinksStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinkData</span></span> : <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVariable; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SourceComponent = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TargetComponent = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> OutputPoint = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> InputPoint = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> VariableName = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CallOrder = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;LinkData&gt; Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LinkData&gt;(); } }</code> </pre><br> åŸåˆ™ä¸Šï¼Œæ­¤ç±»ä¹Ÿä¸å¤æ‚ã€‚ æ¯ä¸ªé“¾æ¥åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š <br><br><ol><li> æŒ‡ç¤ºæ­¤é“¾æ¥æ˜¯å¯¹å˜é‡çš„å¼•ç”¨çš„æ ‡å¿— </li><li> é“¾æ¥æ´»åŠ¨æ ‡å¿— </li><li> å…·æœ‰è¾“å‡ºç‚¹çš„ç»„ä»¶çš„æ ‡è¯†ç¬¦ï¼ˆ <b>GUID</b>å­—ç¬¦ä¸²ï¼‰ </li><li> å…¥å£ç‚¹ç»„ä»¶çš„æ ‡è¯†ç¬¦ï¼ˆ <b>GUID</b>å­—ç¬¦ä¸²ï¼‰ </li><li> é€šä¿¡æºç»„ä»¶çš„è¾“å‡ºç‚¹åç§° </li><li> ç›®æ ‡é€šä¿¡ç»„ä»¶çš„è¾“å…¥ç‚¹åç§° </li><li> ç”¨äºè®¾ç½®å˜é‡å¼•ç”¨çš„ç±»å­—æ®µåç§° </li><li> é€šè®¯é€šè¯å• </li></ol><br><h4> ä»å­˜å‚¨åº“è¿è¡Œ </h4><br> åœ¨æ·±å…¥ç ”ç©¶ä»£ç ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆè¦è¯¦ç»†ä»‹ç»æ§åˆ¶å™¨å¦‚ä½•å¯åŠ¨é€»è¾‘çš„é¡ºåºï¼š <br><br><ol><li> åˆå§‹åŒ–ä»æ§åˆ¶å™¨çš„Awakeæ–¹æ³•å¼€å§‹ </li><li> åœºæ™¯é€»è¾‘åˆ—è¡¨ä»äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ <b>TextAsset</b> ï¼‰åŠ è½½å’Œååºåˆ—åŒ–é€»è¾‘æ•°æ® </li><li> å¯¹äºæ¯ç§é€»è¾‘å‘ç”Ÿï¼š <br><ul><li> ç»„ä»¶åˆ›å»º </li><li> æŒ‰<b>CallOrder</b>æ’åºé“¾æ¥ </li><li> è®¾ç½®é“¾æ¥å’Œå˜é‡å¼•ç”¨ </li><li> æŒ‰<b>ExecuteOrder</b>å¯¹<b>Mono</b> Component <b>æ–¹æ³•</b>æ’åº </li></ul><br></li></ol><br> è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘è¯¥é“¾çš„å„ä¸ªæ–¹é¢ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">äºŒè¿›åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Serialization</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binaryFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Directory.Exists(path)) { Directory.CreateDirectory(path); } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(Path.Combine(path, fileName), FileMode.OpenOrCreate)) { binaryFormatter.Serialize(fs, data); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Deserialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextAsset textAsset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binaryFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> memoryStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(textAsset.bytes)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binaryFormatter.Deserialize(memoryStream); } } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ä»æ–‡æœ¬èµ„äº§ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰åŠ è½½é€»è¾‘æ•°æ®</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LogicStorage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextAsset textAsset</span></span></span><span class="hljs-function">)</span></span> =&gt; Serialization.Deserialize(textAsset) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> LogicStorage; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">é€»è¾‘å¯åŠ¨</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ç»„ä»¶åˆ›å»º</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage.ComponentsStorage.ComponentData componentData, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, LogicComponent&gt; instances, IList&lt;IDisposable&gt; disposableInstance, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;MonoMethodData&gt;&gt; monoMethods</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!componentData.IsActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentType = AssemblyHelper.GetAssemblyType(componentData.Assembly, componentData.Type); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInstance = ScriptableObject.CreateInstance(componentType) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> LogicComponent; JsonUtility.FromJsonOverwrite(componentData.JsonData, componentInstance); componentInstance.name = componentData.InstanceName; componentType.GetFieldRecursive(_LOGIC_HOST_STR).SetValue(componentInstance, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MonoBehaviour); componentInstance.Constructor(); instances.Add(componentData.Id, componentInstance); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(componentInstance <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IDisposable) { disposableInstance.Add((IDisposable)componentInstance); } SearchMonoBehaviourMethod(componentInstance, monoMethods); }</code> </pre><br> é‚£ä¹ˆæ­¤å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼š <br><br><ol><li> æ£€æŸ¥ç»„ä»¶æ´»åŠ¨æ ‡å¿— </li><li> ä»è£…é…ä½“ä¸­è·å–é›¶éƒ¨ä»¶çš„ç±»å‹ </li><li> ç»„ä»¶å®ä¾‹æ˜¯æŒ‰ç±»å‹åˆ›å»ºçš„ </li><li>  <b>JSONçš„</b>ç»„ä»¶å‚æ•°ååºåˆ—åŒ– </li><li> é“¾æ¥åœ¨<b>coroutineHostä¸­</b>è®¾ç½® </li><li>  <b>æ„é€ </b>æ–¹æ³•ç§°ä¸º </li><li> ä¸´æ—¶å‰¯æœ¬å°†ä¿å­˜åˆ°ç»„ä»¶å®ä¾‹ </li><li> å¦‚æœç»„ä»¶å®ç°äº†IDisposableæ¥å£ï¼Œåˆ™æŒ‡å‘å®ƒçš„é“¾æ¥å­˜å‚¨åœ¨ç›¸åº”çš„åˆ—è¡¨ä¸­ </li><li> åœ¨ç»„ä»¶ä¸­æœç´¢<b>Mono</b>æ–¹æ³• </li></ol><br></div></div><br><div class="spoiler">  <b class="spoiler_title">å»ºç«‹è¿ç»“</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage.LinksStorage.LinkData linkData, Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, LogicComponent&gt; instances</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!linkData.IsActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceComponent = instances.ContainsKey(linkData.SourceComponent) ? instances[linkData.SourceComponent] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sourceComponent == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> targetComponent = instances.ContainsKey(linkData.TargetComponent) ? instances[linkData.TargetComponent] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetComponent == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (linkData.IsVariable) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkFieldInfo = sourceComponent.GetType().GetField(linkData.variableName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (variableLinkFieldInfo != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkFieldValue = variableLinkFieldInfo.GetValue(sourceComponent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkVariablePropertyInfo = variableLinkFieldInfo.FieldType.GetProperty(_VARIABLE_PROPERTY_STR, BindingFlags.NonPublic | BindingFlags.Instance); variableLinkVariablePropertyInfo.SetValue(variableLinkFieldValue, targetComponent, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> handlerValue; MethodInfo methodListAdd; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> linkedInputPointsFieldValue; Type outputPointType; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> outputPoint; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointParse = sourceComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IOutputPointParse; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointParse = targetComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IInputPointParse; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPointParse != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPoints = outputPointParse.GetOutputPoints(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoints.ContainsKey(linkData.OutputPoint)) { outputPoint = outputPoints[linkData.OutputPoint]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FieldInfo) { outputPoint = sourceComponent.GetType().GetField(linkData.OutputPoint).GetValue(sourceComponent); } outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkedInputPointsFieldInfo = outputPointType.GetField(_LINKED_INPUT_POINTS_STR, BindingFlags.NonPublic | BindingFlags.Instance); linkedInputPointsFieldValue = linkedInputPointsFieldInfo.GetValue(outputPoint); methodListAdd = linkedInputPointsFieldInfo.FieldType.GetMethod(_ADD_STR); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointFieldInfo = sourceComponent.GetType().GetField(linkData.OutputPoint); outputPoint = outputPointFieldInfo.GetValue(sourceComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoint != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkedInputPointsFieldInfo = outputPointFieldInfo.FieldType.GetField(_LINKED_INPUT_POINTS_STR, BindingFlags.NonPublic | BindingFlags.Instance); linkedInputPointsFieldValue = linkedInputPointsFieldInfo.GetValue(outputPoint); methodListAdd = linkedInputPointsFieldInfo.FieldType.GetMethod(_ADD_STR); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointParse != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPoints = inputPointParse.GetInputPoints(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPoints.ContainsKey(linkData.InputPoint)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPoint = inputPoints[linkData.InputPoint]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPoint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FieldInfo) { inputPoint = targetComponent.GetType().GetField(linkData.InputPoint).GetValue(targetComponent); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointType = inputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointHandlerFieldInfo = inputPointType.GetField(_HANDLER_STR); handlerValue = inputPointHandlerFieldInfo.GetValue(inputPoint); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointFieldInfo = targetComponent.GetType().GetField(linkData.InputPoint); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointFieldValue = inputPointFieldInfo.GetValue(targetComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointFieldValue != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointHandlerFieldInfo = inputPointFieldInfo.FieldType.GetField(_HANDLER_STR); handlerValue = inputPointHandlerFieldInfo.GetValue(inputPointFieldValue); } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlerParsedAction = GetParsedHandler(handlerValue, outputPoint); methodListAdd.Invoke(linkedInputPointsFieldValue, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerParsedAction }); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetParsedHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> handlerValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputPoint</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointType = handlerValue.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paramType = inputPointType.GetGenericArguments()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramType == <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>) &amp;&amp; outputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsingActionMethod = outputPointType.GetMethod(_PARSING_ACTION_OBJECT_STR, BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsingActionMethod.Invoke(outputPoint, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerValue }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handlerValue; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsingActionMethod = outputPointType.GetMethod(_PARSING_ACTION_EMPTY_STR, BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsingActionMethod.Invoke(outputPoint, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerValue }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handlerValue; } } }</code> </pre> <br> åˆ›å»ºè¿æ¥æ˜¯æ•´ä¸ªç³»ç»Ÿå†…åœ¨æœ€å›°éš¾çš„æ—¶åˆ»ä¹‹ä¸€ï¼Œæˆ‘ä»¬å°†è€ƒè™‘æ¯ä¸ªé˜¶æ®µï¼š <br><br><ol><li> æ£€æŸ¥é€šè®¯æ´»åŠ¨æ ‡å¿— </li><li> åœ¨åˆ›å»ºçš„ç»„ä»¶çš„ä¸´æ—¶åˆ—è¡¨ä¸­æœç´¢è¿æ¥çš„æºç»„ä»¶å’Œç›®æ ‡ç»„ä»¶ </li><li> æ£€æŸ¥è¿æ¥ç±»å‹ï¼š <br><ul><li> å¦‚æœè¿æ¥ç±»å‹æ˜¯å¯¹å˜é‡çš„å¼•ç”¨ï¼Œåˆ™ä½¿ç”¨åå°„è®¾ç½®å¿…è¦çš„å€¼ </li><li> å¦‚æœè¿æ¥æ­£å¸¸ï¼Œåˆ™è¿˜å¯ä»¥ä½¿ç”¨åå°„æ¥è®¾ç½®è¾“å‡ºç‚¹å’Œè¾“å…¥ç‚¹æ–¹æ³•çš„å¿…è¦å€¼ </li></ul><br></li><li> å¯¹äºæ­£å¸¸é€šä¿¡ï¼Œè¯·é¦–å…ˆæ£€æŸ¥ç»„ä»¶æ˜¯å¦ç»§æ‰¿<b>IInputPointParse</b>å’Œ<b>IOutputPointParseæ¥å£</b> ã€‚ </li><li> æ ¹æ®ä¸Šä¸€æ®µçš„ç»“æœï¼Œé€šè¿‡åå°„è·å¾—æºç»„ä»¶ä¸­çš„<b>LinkedInputPoints</b>å­—æ®µå’Œç›®æ ‡ç»„ä»¶ä¸­çš„handleræ–¹æ³•ã€‚ </li><li> é€šè¿‡å°†ç»•è¿‡<b>MethodInfo.Invoke</b>çš„æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸ºç®€å•çš„<code>Action&lt;T&gt;</code>è°ƒç”¨ï¼Œå¯ä»¥<b>è·å–</b>æ–¹æ³•å¤„ç†ç¨‹åºã€‚ ä½†æ˜¯ï¼Œé€šè¿‡åå°„è·å¾—è¿™æ ·çš„é“¾æ¥å¤ªå¤æ‚äº†ï¼Œå› æ­¤ï¼Œåœ¨<code>OUTPUT_POINT&lt;T&gt;</code>ç±»ä¸­<code>OUTPUT_POINT&lt;T&gt;</code>äº†å…è®¸è¿™æ ·åšçš„ç‰¹æ®Šæ–¹æ³•ã€‚ å¯¹äºæ­¤ç±»çš„é<b>é€šç”¨</b>ç‰ˆæœ¬ï¼Œæ— éœ€æ‰§è¡Œæ­¤ç±»æ“ä½œã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Action&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParsingActionEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action action</span></span></span><span class="hljs-function">)</span></span> { Action&lt;T&gt; parsedAction = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; action(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedAction; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Action&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParsingActionObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; action</span></span></span><span class="hljs-function">)</span></span> { Action&lt;T&gt; parsedAction = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; action(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedAction; } }</code> </pre> <br> å½“è¾“å…¥ç‚¹ä¸æ¥å—ä»»ä½•å‚æ•°æ—¶ï¼Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ã€‚ ç¬¬äºŒç§æ–¹æ³•åˆ†åˆ«ä¸ºå¸¦æœ‰å‚æ•°çš„è¾“å…¥ç‚¹ã€‚ <br><br></li><li> é€šè¿‡åå°„ï¼Œå°†åˆ°<b>Action</b>å¤„ç†ç¨‹åºçš„é“¾æ¥æ·»åŠ åˆ°<b>LinkedInputPoints</b>å­—æ®µï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼‰ </li></ol><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨Monoæ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchMonoBehaviourMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicComponent component, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;MonoMethodData&gt;&gt; monoBehaviourMethods</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type = component.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methods = type.GetMethods(BindingFlags.Public | BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> methods) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_monoMethods.Keys.Contains(method.Name)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> priorityAttributes = method.GetCustomAttributes(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ExecuteOrderAttribute), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> priority = (priorityAttributes.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ((ExecuteOrderAttribute)priorityAttributes[<span class="hljs-number"><span class="hljs-number">0</span></span>]).Order : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; monoBehaviourMethods[method.Name].Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MonoMethodData(method, component, priority, _monoMethods[method.Name])); } } }</code> </pre> <br> æ¯ä¸ªæ–¹æ³•éƒ½é€šè¿‡æŒ‡å‘ç‰¹æ®Šç±»çš„é“¾æ¥å­˜å‚¨åœ¨å­—å…¸ä¸­ï¼Œé€šè¿‡è¯¥ç±»å¯ä»¥è¿›è¡Œè°ƒç”¨ã€‚ æ­¤ç±»è‡ªåŠ¨å°†æ–¹æ³•è½¬æ¢ä¸ºå¯¹<b>Action</b>çš„å¼•ç”¨ã€‚ å› æ­¤ï¼Œä¸é€šå¸¸çš„<b>MethodInfo.Invoke</b>ç›¸æ¯”ï¼Œå¯¹<b>Mono</b>æ–¹æ³•çš„è°ƒç”¨æœ‰äº†æ˜æ˜¾çš„åŠ é€Ÿã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MonoMethodData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Order { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _monoMethodWrapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; _monoMethodParamWrapper; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MonoMethodData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MethodInfo method, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> target, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!withParam) { _monoMethodWrapper = (Action)Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Action), target, method.Name); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _monoMethodParamWrapper = (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;)Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;), target, method.Name); } Order = order; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt;_monoMethodWrapper(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param</span></span></span><span class="hljs-function">)</span></span> =&gt; _monoMethodParamWrapper(param); }</code> </pre> <br>  <b>æ³¨æ„</b> ï¼šç”¨<b>bool</b>å‚æ•°é‡è½½<b>Call</b>æ–¹æ³•ç”¨äº<b>Mono</b>æ–¹æ³•ï¼Œä¾‹å¦‚<b>ApplicationPause</b>ç­‰ã€‚ <br></div></div><br><h4> å¤–éƒ¨è§¦å‘é€»è¾‘ </h4><br> é€»è¾‘çš„å¤–éƒ¨å¯åŠ¨æ˜¯åœ¨åº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´å¯åŠ¨çš„é€»è¾‘ï¼Œæ­¤ç±»é€»è¾‘æœªåœ¨åœºæ™¯ä¸­è®¾ç½®ï¼Œå¹¶ä¸”æ²¡æœ‰é“¾æ¥ã€‚ å¯ä»¥ä»æ†ç»‘è½¯ä»¶æˆ–èµ„æºä¸­ä¸‹è½½ã€‚ é€šå¸¸ï¼Œä»å¤–éƒ¨å¼€å§‹ä¸ä»åœºæ™¯å¼€å§‹å¤„å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œé™¤äº†ä½¿ç”¨<b>Mono</b>æ–¹æ³•ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¤–éƒ¨ï¼ˆå»¶è¿Ÿï¼‰é€»è¾‘æ‰§è¡Œçš„æ–¹æ³•ä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicExternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> runMonoMethods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethodName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoMethods.Keys) { runMonoMethods.Add(monoMethodName, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;MonoMethodData&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances, _disposableInstances, runMonoMethods); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> runMonoMethods.Values) { monoMethods.Sort(SortingMonoMethods); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runMonoMethods.ContainsKey(_START_STR)) { CallMonoBehaviourMethod(_START_STR, runMonoMethods, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethodName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> runMonoMethods.Keys) { _monoBehaviourMethods[monoMethodName].AddRange(runMonoMethods[monoMethodName]); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } }</code> </pre> <br></div></div><br> å¦‚æ‚¨æ‰€è§ï¼Œå¯¹<b>Mono</b>æ–¹æ³•çš„æ‰€æœ‰å¼•ç”¨éƒ½ä¿å­˜åœ¨æœ¬åœ°å­—å…¸ä¸­ï¼Œç„¶åå¯åŠ¨Startæ–¹æ³•ï¼Œç„¶åå°†æ‰€æœ‰å…¶ä»–æ–¹æ³•æ·»åŠ åˆ°é€šç”¨å­—å…¸ä¸­ã€‚ <br><br><h4> ä½œä¸ºå®ä¾‹è¿è¡Œé€»è¾‘ </h4><br> åœ¨åº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¯èƒ½æœ‰å¿…è¦åœ¨ä¸€å®šæ—¶é—´å†…è¿è¡ŒæŸç§é€»è¾‘ï¼Œæˆ–è€…ç›´åˆ°å®ƒæ‰§è¡Œå…¶ä»»åŠ¡ä¸ºæ­¢ã€‚ ä¸å…è®¸ä½¿ç”¨ä»¥å‰çš„é€»è¾‘è§¦å‘é€‰é¡¹æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºåœ¨åœºæ™¯çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¼šè§¦å‘é€»è¾‘ã€‚ <br><br> ä¸ºäº†å°†é€»è¾‘ä½œä¸ºå®ä¾‹è¿è¡Œï¼Œå°†ä¿å­˜åˆ°ç»„ä»¶ç­‰æ‰€æœ‰å®ä¾‹çš„é“¾æ¥ï¼Œåœ¨å·¥ä½œå®Œæˆåå¯ä»¥å°†å…¶åˆ é™¤ï¼Œä»è€Œæ¸…é™¤å†…å­˜ã€‚ <br><br> é€»è¾‘å®ä¾‹æ•°æ®ä»“åº“ç±»ä»£ç ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InstanceLogicData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IList&lt;LogicComponent&gt; ComponentInstances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt; MonoBehaviourMethods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IList&lt;IDisposable&gt; DisposableInstances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IDisposable&gt;(); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">é€»è¾‘å¯åŠ¨æœ¬èº«ç±»ä¼¼äºå‰é¢æè¿°çš„å¤–éƒ¨å¯åŠ¨ã€‚</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = Guid.NewGuid().ToString(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstanceData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InstanceLogicData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); _logicInstances.Add(id, logicInstanceData); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances, logicInstanceData.DisposableInstances, logicInstanceData.MonoBehaviourMethods); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstanceData.MonoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; }</code> </pre> <br></div></div><br> ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆ›å»ºé€»è¾‘ä¹‹åï¼Œæœ‰å…³é€»è¾‘çš„æ•°æ®å­˜å‚¨åœ¨ä¸“é—¨ç±»çš„å®ä¾‹ä¸­ï¼Œå¹¶ä¸”åœ¨å¯åŠ¨åï¼Œå°†è¿”å›é€»è¾‘å®ä¾‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">éœ€è¦æ­¤æ ‡è¯†ç¬¦æ‰èƒ½è°ƒç”¨åœæ­¢å’Œæ¸…é™¤å†…å­˜åŠŸèƒ½ã€‚</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopLogicInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> instanceId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_logicInstances.ContainsKey(instanceId)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstance = _logicInstances[instanceId]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposableInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.DisposableInstances) { disposableInstance.Dispose(); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.ComponentInstances) { Destroy(componentInstance); } logicInstance.ComponentInstances.Clear(); logicInstance.DisposableInstances.Clear(); logicInstance.MonoBehaviourMethods.Clear(); _logicInstances.Remove(instanceId); }</code> </pre> <br></div></div><br><h4> å…³é—­åœºæ™¯å¹¶æ¸…é™¤å†…å­˜ </h4><br> é€šè¿‡<b>ScriptableObject.CreateInstance</b>åœ¨è¿è¡Œçš„åœºæ™¯ä¸­åˆ›å»º<b>ScriptableObjectæ—¶</b> ï¼Œå®ä¾‹çš„è¡Œä¸ºä¸<b>MonoBehaviour</b>ç›¸åŒï¼Œå³ï¼Œä»åœºæ™¯ä¸­å¸è½½æ—¶ï¼Œå°†ä¸ºæ¯ä¸ªå®ä¾‹è°ƒç”¨<b>OnDestroy</b>å¹¶å°†å…¶ä»å†…å­˜ä¸­åˆ é™¤ã€‚ ä½†æ˜¯ï¼Œå¦‚å‰ä¸€ç¯‡æ–‡ç« æ‰€è¿°ï¼Œç»„ä»¶å¯ä»¥ç»§æ‰¿<b>IDisposable</b> ï¼Œå› æ­¤æˆ‘ä½¿ç”¨<b>OnDisable</b>æ–¹æ³•å¯¹å…¶è¿›è¡Œäº†<b>æ¸…ç†</b> ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDisable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _disposableInstances) { disposable.Dispose(); } _disposableInstances.Clear(); _monoBehaviourMethods.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _logicInstances.Values) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposableInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.DisposableInstances) { disposableInstance.Dispose(); } logicInstance.DisposableInstances.Clear(); logicInstance.ComponentInstances.Clear(); logicInstance.MonoBehaviourMethods.Clear(); } _logicInstances.Clear(); _instance = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  <b>æ³¨æ„</b> ï¼šå¦‚æ‚¨æ‰€è§ï¼Œå¦‚æœåœ¨å¸è½½åœºæ™¯æ—¶å­˜åœ¨é€»è¾‘å®ä¾‹ï¼Œåˆ™å°†åœ¨å…¶ä¸­è¿›è¡Œæ¸…ç†ã€‚ <br><br><h3>  Unityå¯¹è±¡çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ </h3><br> åœ¨æœ‰å…³å¯è§†åŒ–ç¼–è¾‘å™¨çš„æ–‡ç« çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘æåˆ°äº†ç»´æŠ¤ä¸åœºæ™¯å¯¹è±¡çš„é“¾æ¥çš„é—®é¢˜ï¼Œè¿™ä¸æ— æ³•è¿˜åŸåºåˆ—åŒ–æ•°æ®æœ‰å…³ã€‚ è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šæ¯æ¬¡å¯åŠ¨åœºæ™¯æ—¶ï¼Œåœºæ™¯å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦éƒ½ä¸åŒã€‚ è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•æ˜¯å”¯ä¸€çš„é€‰æ‹©-è¿™æ˜¯è½¬ç§»åœºæ™¯ä¸­é“¾æ¥çš„å­˜å‚¨ã€‚ ä¸ºæ­¤ï¼Œåœ¨é€»è¾‘æ§åˆ¶å™¨ä¸­æ·»åŠ äº†ä¸“é—¨çš„å­˜å‚¨åº“å’ŒåŒ…è£…å™¨ç±»ï¼Œé€»è¾‘ç»„ä»¶å¯é€šè¿‡è¯¥ç±»æ¥æ¥æ”¶å¯¹<b>Unity</b>å¯¹è±¡çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬èµ„æºï¼Œé¢„åˆ¶ä»¶å’Œå…¶ä»–èµ„äº§ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å­˜å‚¨ä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ObjectLinkData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.Object Obj =&gt; _obj; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnityEngine.Object _obj; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ObjectLinkData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, UnityEngine.Object obj</span></span></span><span class="hljs-function">)</span></span> { _id = id; _obj = obj; } } [SerializeField] [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ObjectLinkData&gt; _objectLinks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ObjectLinkData&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.<span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData = _objectLinks.Find(link =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Compare(link.Id, id, StringComparison.Ordinal) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linkData?.Obj; }</code> </pre><br> : <br><br><ol><li> <b>Id</b> â€“       </li><li> <b>Obj</b> â€“       </li></ol><br></div></div><br>    ,  . <br><br><div class="spoiler"> <b class="spoiler_title">  -   Unity</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VLObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.Object Obj { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !_objNotFound) { _obj = Core.LogicController.Instance.GetObject(Id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _objNotFound = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _obj; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnityEngine.Object _obj; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _objNotFound; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VLObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VLObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnityEngine.Object obj</span></span></span><span class="hljs-function">)</span></span> { _obj = obj; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Get&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityEngine.Object { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T; } }</code> </pre><br> <b></b> :  <b>_objNotFound</b> ,        ,     . <br></div></div><br><h2>  </h2><br> ,  ,       .       ,   ,           , ..       <b>Unity</b> .   <b>Update</b>  <b>MonoBehaviour</b>   <b>uViLEd</b>      - ,     ,      1000   .    â€”    ,          ,    (  <b>Android</b>  <b>iOS</b> )  .    70    150  (   )   : <br><br><ol><li> <b>Android</b> (  MediaTek 8-) <br> â€”    â€” ~750 <br> â€”      ~250 <br></li><li> <b>iOS</b> (iPhone 5s) <br> â€”    â€” ~100 <br> â€”      ~50 <br></li></ol><br><h2> ç»“è®º </h2><br>    <b>uViLEd</b> -   ,        ,   ,  -   -  .            ,       .        ,    . <br><br> PS:    ,    .        ,     Unity 3d,    (   )   . <br><br> â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Unity3d.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466187/">https://habr.com/ru/post/zh-CN466187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466169/index.html">JetBrainsåœ¨èŒå­¦ç”Ÿçš„ç‰¹åˆ«ä¼˜æƒ </a></li>
<li><a href="../zh-CN466171/index.html">é€‰æ‹©JUG.EKBçš„äº”ä¸ªç†ç”±</a></li>
<li><a href="../zh-CN466179/index.html">fformï¼šReactï¼†JSONSchema-æœ€å¤§çš„çµæ´»æ€§</a></li>
<li><a href="../zh-CN466181/index.html">Cè¯­è¨€çš„Pythonï¼ˆC APIï¼‰</a></li>
<li><a href="../zh-CN466183/index.html">ClickHouseä¸­çš„æ™ºèƒ½å­—ç¬¦ä¸²å¤„ç†ç®—æ³•</a></li>
<li><a href="../zh-CN466191/index.html">ç¾å›½ç½‘ç»œä¸­ç«‹ä¹‹æˆ˜çš„ä¸»è¦å†…å®¹æ˜¯äº‹ä»¶çš„æ—¶é—´é¡ºåºå’Œå½“å‰çš„äº‹åŠ¡çŠ¶æ€</a></li>
<li><a href="../zh-CN466193/index.html">ä»RSSæè¦è‡ªå®šä¹‰MailChimpè‡ªåŠ¨æè¦</a></li>
<li><a href="../zh-CN466195/index.html">PVS-Studio 7.04</a></li>
<li><a href="../zh-CN466197/index.html">PVS-Studio 7.04</a></li>
<li><a href="../zh-CN466199/index.html">PostgreSQLä¸­çš„é”ï¼š4.å†…å­˜ä¸­çš„é”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>