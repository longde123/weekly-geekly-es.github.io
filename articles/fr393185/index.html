<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍⚖️ 👩🏽‍🔬 🎊 Nouveau module récepteur nooLite MR1132 pour Arduino 🤙🏼 👨🏼‍✈️ 🈹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="nooLite . ? nooLite , , USB .
 
 , MR1132, , , nooLite , , nooLite - , .
 
 Dans cet article je vais vous parler du fonctionnement de ce module et vou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nouveau module récepteur nooLite MR1132 pour Arduino</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/393185/"><img src="https://habrastorage.org/files/24c/ab6/dab/24cab6dab74e4e778cd238d261be0b69.jpg" alt="image"><br>
<br>
           nooLite    .     ?                    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nooLite</a>    ,      ,    USB .<br>
<br>
,    MR1132,      , ,           nooLite     ,    ,    nooLite -     ,    .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article je vais vous parler du fonctionnement de ce module et vous donner un schéma de travail, à partir duquel vous pourrez facilement créer vos appareils sur le MR1132. </font><font style="vertical-align: inherit;">Dans les articles suivants, je parlerai de l'intégration de ce module avec le système populaire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et des merveilleuses fonctionnalités qui apparaîtront en lien avec cette intégration.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module</font></font></h2><br>
 MR1132     ,  MT1132 (        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>).    ,   MT1132  ,   MR1132           .<br>
<br>
      ,   MT1132       3,3 ,     5  (     3,3-    5-),   —   5 .              .<br>
<br>
<img src="https://habrastorage.org/files/36e/50c/816/36e50c816d1b4859b7a56eb2ae4f4996.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion est aussi simple que le module MT1132 - tension d'alimentation, masse et deux contacts RX et TX. </font><font style="vertical-align: inherit;">Le RTS peut être tiré jusqu'à la tension d'alimentation, mais tout a fonctionné pour moi même sans connecter cette sortie.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le module fonctionne via une interface série à une vitesse de 9600. Le module reçoit les commandes du contrôleur et, à son tour, émet les données reçues de l'air (des capteurs et des télécommandes nooLite). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons de plus près ce point, afin que vous compreniez bien le fonctionnement de ce module.</font></font><br>
<br>
 ,        ,   «»  «»  nooLite,       .         . ,     nooLite PT112    (  32,     )                 (    «»     ).<br>
<br>
    -     ,       (     )           .<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant aux informations reçues par le module MR1132 des appareils nooLite, il existe un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">document</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> séparé </font><font style="vertical-align: inherit;">qui décrit le format de toutes les commandes possibles. </font><font style="vertical-align: inherit;">Nous, dans le cadre de ce récit, de cette longue liste nous intéresserons aux équipes de capteurs de température, d'humidité et de mouvement. </font><font style="vertical-align: inherit;">Ces commandes seront décrites en détail ci-dessous, en utilisant l'esquisse comme exemple.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans nos expériences, trois capteurs seront utilisés. </font></font><br>
<br>
<img src="https://habrastorage.org/files/3f9/ca8/0d4/3f9ca80d49e04e228406018485a56439.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capteur de température PT112 et capteur de température et d'humidité PT111. </font><font style="vertical-align: inherit;">Ils se ressemblent et fonctionnent exactement de la même manière, la différence est que PT112 ne donne que des informations sur la température et PT111 donne des informations sur la température et l'humidité. </font><font style="vertical-align: inherit;">Ces capteurs peuvent fonctionner soit en mode capteur simple, soit en mode thermostat et hygrostat, mais nous serons intéressés par un mode capteur simple. </font></font><br>
<br>
<img src="https://habrastorage.org/files/faa/396/a15/faa396a152b5477b9bdfd91d722c9ca3.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisième capteur est le PM111. </font><font style="vertical-align: inherit;">Il s'agit d'un capteur de mouvement qui peut contrôler directement les unités d'alimentation nooLite, mais nous ne nous intéresserons qu'à nous en tant que source d'informations sur les mouvements et la présence de personnes dans la pièce.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrôleur</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'Arduino Mega 2560 sera utilisé comme contrôleur de contrôle et ses deux interfaces série - Serial (pour le contrôle visuel des informations) Serial2 (pour la communication avec le module récepteur). </font><font style="vertical-align: inherit;">Serial1 est réservé au module émetteur MT1132.</font></font><br>
<br>
<img src="https://habrastorage.org/files/464/661/a69/464661a69db6436da29c14c265c92996.jpg" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la section setup (), deux interfaces sont lancées, un message d'information sur le début de l'esquisse s'affiche et une commande est émise pour relier les appareils nooLite sur le canal zéro. </font><font style="vertical-align: inherit;">Il s'agit d'une commande de test et vous pouvez la commenter ou la remplacer par une autre commande (par exemple, des liaisons sur un autre canal ou un déliement).</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  Serial2.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"*** Start sketch ***"</span></span>);<font></font>
  mrBind(<span class="hljs-number"><span class="hljs-number">0</span></span>);
  <span class="hljs-comment"><span class="hljs-comment">//mrUnbind(0);</span></span><font></font>
}<font></font>
</code></pre><br>
         ,  ,        :<br>
<br>
<strong>PT112</strong> —  <br>
<strong>PT111</strong> —  <br>
<strong>PM111</strong> —  <br>
<br>
       ,   <br>
<br>
<pre><code class="java hljs">mrBind(<span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
mrBind(<span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
mrBind(<span class="hljs-number"><span class="hljs-number">2</span></span>);
</code></pre><br>
       .      ,     .            .<br>
<br>
  loop()     mrCheck(),   «»   MR1132    Serial2.<br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mrCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Serial2.available() == <span class="hljs-number"><span class="hljs-number">8</span></span>) {<font></font>
    mrBuf[<span class="hljs-number"><span class="hljs-number">0</span></span>] = Serial2.read();<font></font>
    mrBuf[<span class="hljs-number"><span class="hljs-number">1</span></span>] = Serial2.read();<font></font>
    mrBuf[<span class="hljs-number"><span class="hljs-number">2</span></span>] = Serial2.read();<font></font>
    mrBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] = Serial2.read();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mrBuf[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">79</span></span> &amp;&amp; mrBuf[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">75</span></span> &amp;&amp; mrBuf[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-number"><span class="hljs-number">13</span></span> &amp;&amp; mrBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] == <span class="hljs-number"><span class="hljs-number">10</span></span>) {<font></font>
      Serial.println(<span class="hljs-string"><span class="hljs-string">"OK"</span></span>);<font></font>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
        mrBuf[<span class="hljs-number"><span class="hljs-number">4</span></span>] = Serial2.read();<font></font>
        mrBuf[<span class="hljs-number"><span class="hljs-number">5</span></span>] = Serial2.read();<font></font>
        mrBuf[<span class="hljs-number"><span class="hljs-number">6</span></span>] = Serial2.read();<font></font>
        mrBuf[<span class="hljs-number"><span class="hljs-number">7</span></span>] = Serial2.read();<font></font>
        mrNewData();<font></font>
      }<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fonction remplit le tableau mrBuf [8] avec des données provenant du module ou transmet au message série «OK», émis par le module MR1132. En outre, le contenu du tableau mrBuf [8] est analysé conformément au format de données des commandes du système nooLite, et les fonctions d'esquisse correspondantes y sont impliquées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction mrNewData () extrait les données principales de la matrice mrBuf [8] et, en fonction de la commande entrante, envoie les informations nécessaires à Serial (canal, commande, température, humidité, état de la batterie du capteur, etc.).</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mrNewData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  mrClearData();<font></font>
  mrPrintHeader();<font></font>
  <font></font>
  mrSetBindState();<font></font>
  mrPrintBindState();<font></font>
  mrSetChannel();<font></font>
  mrPrintChannel();<font></font>
<font></font>
  mrSetCommand();<font></font>
  mrSetDatas();<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mrCommand) {
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>:<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"PIR command: "</span></span>);Serial.println(<span class="hljs-string"><span class="hljs-string">"OFF"</span></span>);
      <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"PIR command: "</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"ON"</span></span>);
      <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>:<font></font>
      mrSetDeviceType();<font></font>
      mrPrintDeviceType();<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mrDeviceType == <span class="hljs-number"><span class="hljs-number">1</span></span>) {<font></font>
        mrSetTemperature();<font></font>
        mrPrintTemperature();<font></font>
      }<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mrDeviceType == <span class="hljs-number"><span class="hljs-number">2</span></span>) {<font></font>
        mrSetTemperature();<font></font>
        mrPrintTemperature();<font></font>
        mrSetHumidity();<font></font>
        mrPrintHumidity();<font></font>
      }<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <font></font>
      ;<font></font>
  } <span class="hljs-comment"><span class="hljs-comment">// switch</span></span><font></font>
  mrSetBatteryState();<font></font>
} <span class="hljs-comment"><span class="hljs-comment">// newData()</span></span>
</code></pre><br>
,      Print,     Serial    .<br>
<br>
    ,    mrBuf[8],         nooLite:<br>
<br>
<strong>mrSetTogl()</strong> —    <br>
<strong>mrSetBindState()</strong> —   (/)<br>
<strong>mrSetReceiveBit()</strong> —     <br>
<strong>mrSetChannel()</strong> —  <br>
<strong>mrSetCommand()</strong> — <br>
<strong>mrSetFormat()</strong> —  <br>
<strong>mrSetDeviceType()</strong> —  <br>
<strong>mrSetDatas()</strong> —    <br>
<strong>mrSetTemperature()</strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- obtenir la valeur de température </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mrSetHumidity ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - obtenir la valeur d'humidité </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mrSetBrightness ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - obtenir la valeur d'éclairage </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mrSetBatteryState ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'état de la batterie du capteur </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez voir les détails de la mise en œuvre de ces fonctions dans le code d'esquisse complet ci-dessous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le croquis complet.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code d'esquisse complet</font></font></b><div class="spoiler_text">// TX2 16<br>
// RX2 17<br>
// TX1 18<br>
// RX1 19<br>
<br>
// nooLite MR1132 data<br>
byte mrBuf[8];<br>
int mrTogl = -1;<br>
int mrBindState = -1;<br>
int mrReceiveBit = -1;<br>
int mrChannel = -1;<br>
int mrCommand = -1;<br>
int mrFormat = -1;<br>
int mrData0 = -1;<br>
int mrData1 = -1;<br>
int mrData2 = -1;<br>
int mrData3 = -1;<br>
int mrDeviceType = -1;<br>
int mrBatteryState = -1;<br>
int mrHumidity = -1;<br>
int mrBrightness = -1;<br>
float mrTemp = -1.0;<br>
<br>
// nooLite MR1132 bind/unbind<br>
<br>
void mrSerialChannel(byte ch) {<br>
 switch (ch) {<br>
 case 0: Serial.println («0»); break;<br>
 case 1: Serial.println («1»); break;<br>
 case 2: Serial.println («2»); break;<br>
 case 3: Serial.println («3»); break;<br>
 case 4: Serial.println («4»); break;<br>
 case 5: Serial.println («5»); break;<br>
 case 6: Serial.println («6»); break;<br>
 case 7: Serial.println («7»); break;<br>
 case 8: Serial.println («8»); break;<br>
 case 9: Serial.println («9»); break;<br>
 case 10: Serial.println(«10»); break;<br>
 case 11: Serial.println(«11»); break;<br>
 case 12: Serial.println(«12»); break;<br>
 case 13: Serial.println(«13»); break;<br>
 case 14: Serial.println(«14»); break;<br>
 case 15: Serial.println(«15»); break;<br>
 case 16: Serial.println(«16»); break;<br>
 case 17: Serial.println(«17»); break;<br>
 case 18: Serial.println(«18»); break;<br>
 case 19: Serial.println(«19»); break;<br>
 case 20: Serial.println(«20»); break;<br>
 case 21: Serial.println(«21»); break;<br>
 case 22: Serial.println(«22»); break;<br>
 case 23: Serial.println(«23»); break;<br>
 case 24: Serial.println(«24»); break;<br>
 case 25: Serial.println(«25»); break;<br>
 case 26: Serial.println(«26»); break;<br>
 case 27: Serial.println(«27»); break;<br>
 case 28: Serial.println(«28»); break;<br>
 case 29: Serial.println(«29»); break;<br>
 case 30: Serial.println(«30»); break;<br>
 case 31: Serial.println(«31»); break;<br>
 } // switch<br>
} // mrSerialChannel( )<br>
<br>
void mrSerial2Channel(byte ch) {<br>
 switch (ch) {<br>
 case 0: Serial2.print(«00»); break;<br>
 case 1: Serial2.print(«01»); break;<br>
 case 2: Serial2.print(«02»); break;<br>
 case 3: Serial2.print(«03»); break;<br>
 case 4: Serial2.print(«04»); break;<br>
 case 5: Serial2.print(«05»); break;<br>
 case 6: Serial2.print(«06»); break;<br>
 case 7: Serial2.print(«07»); break;<br>
 case 8: Serial2.print(«08»); break;<br>
 case 9: Serial2.print(«09»); break;<br>
 case 10: Serial2.print(«10»); break;<br>
 case 11: Serial2.print(«11»); break;<br>
 case 12: Serial2.print(«12»); break;<br>
 case 13: Serial2.print(«13»); break;<br>
 case 14: Serial2.print(«14»); break;<br>
 case 15: Serial2.print(«15»); break;<br>
 case 16: Serial2.print(«16»); break;<br>
 case 17: Serial2.print(«17»); break;<br>
 case 18: Serial2.print(«18»); break;<br>
 case 19: Serial2.print(«19»); break;<br>
 case 20: Serial2.print(«20»); break;<br>
 case 21: Serial2.print(«21»); break;<br>
 case 22: Serial2.print(«22»); break;<br>
 case 23: Serial2.print(«23»); break;<br>
 case 24: Serial2.print(«24»); break;<br>
 case 25: Serial2.print(«25»); break;<br>
 case 26: Serial2.print(«26»); break;<br>
 case 27: Serial2.print(«27»); break;<br>
 case 28: Serial2.print(«28»); break;<br>
 case 29: Serial2.print(«29»); break;<br>
 case 30: Serial2.print(«30»); break;<br>
 case 31: Serial2.print(«31»); break;<br>
 } // switch<br>
} // mrSerial2Channel( )<br>
<br>
void mrPrintBind(byte ch) {<br>
 Serial.print(«Bind on channel „);<br>
 mrSerialChannel(ch);<br>
}<br>
<br>
void mrBind(byte ch) {<br>
 mrPrintBind(ch);<br>
 Serial2.print(“bind_mode_cell_»);<br>
 mrSerial2Channel(ch);<br>
 Serial2.write(3); // End of Text — B00000011(BIN)<br>
}<br>
<br>
void mrPrintUnbind(byte ch) {<br>
 Serial.println(«Unbind on channel „);<br>
 mrSerialChannel(ch);<br>
}<br>
<br>
void mrUnbind(byte ch) {<br>
 mrPrintUnbind(ch);<br>
 Serial2.print(“clear_one_cell_»);<br>
 mrSerial2Channel(ch);<br>
 Serial2.write(3);<br>
}<br>
<br>
void mrBindStop() {<br>
 Serial.println(«Bind mode off»);<br>
 Serial2.print(«bind_mode_off»);<br>
 Serial2.write(3);<br>
}<br>
<br>
void mrClearAll() {<br>
 Serial.println(«Clear all cell»);<br>
 Serial2.print(«clear_all_cell»);<br>
 Serial2.write(3);<br>
}<br>
<br>
// nooLite MR1132 print works<br>
<br>
void mrPrintHeader() {<br>
 Serial.println();<br>
}<br>
<br>
void mrPrintDeviceType() {<br>
 Serial.print(«Device: „); <br>
 if (mrDeviceType == 1) {<br>
 Serial.println(“PT112»);<br>
 }<br>
 if (mrDeviceType == 2) {<br>
 Serial.println(«PT111»);<br>
 }<br>
}<br>
<br>
void mrPrintBindState() {<br>
 if (mrBindState == 1) {<br>
 Serial.print(«Bind State: „);<br>
 Serial.println(“ON»);<br>
 }<br>
}<br>
<br>
void mrPrintBatteryState() {<br>
 if (mrBatteryState == 1) {<br>
 Serial.print(«Battery State: „);<br>
 Serial.println(“LOW!»);<br>
 }<br>
}<br>
<br>
void mrPrintChannel() {<br>
 Serial.print(«Channel: „);<br>
 Serial.println(mrChannel);<br>
}<br>
<br>
void mrPrintTemperature() {<br>
 Serial.print(“Temp: „);<br>
 Serial.println(mrTemp);<br>
}<br>
<br>
void mrPrintHumidity() {<br>
 Serial.print(“Humidity: „);<br>
 Serial.println(mrHumidity);<br>
}<br>
<br>
// nooLite MR1132 data works<br>
<br>
void mrClearData() {<br>
 mrTogl = -1;<br>
 mrBindState = -1;<br>
 mrReceiveBit = -1;<br>
 mrChannel = -1;<br>
 mrCommand = -1;<br>
 mrFormat = -1;<br>
 mrData0 = -1;<br>
 mrData1 = -1;<br>
 mrData2 = -1;<br>
 mrData3 = -1;<br>
 mrDeviceType = -1;<br>
 mrBatteryState = -1;<br>
 mrHumidity = -1;<br>
 mrBrightness = -1;<br>
 mrTemp = -1.0;<br>
}<br>
<br>
void mrSetTogl() {<br>
 byte b0 = bitRead(mrBuf[0], 0);<br>
 byte b1 = bitRead(mrBuf[0], 1);<br>
 byte b2 = bitRead(mrBuf[0], 2);<br>
 byte b3 = bitRead(mrBuf[0], 3);<br>
 byte b4 = bitRead(mrBuf[0], 4);<br>
 byte b5 = bitRead(mrBuf[0], 5);<br>
 mrTogl = 32*b5 + 16*b4 + 8*b3 + 4*b2 + 2*b1 + b0;<br>
}<br>
<br>
void mrSetBindState() {<br>
 mrBindState = bitRead(mrBuf[0], 6);<br>
}<br>
<br>
void mrSetReceiveBit() {<br>
 mrReceiveBit = bitRead(mrBuf[0], 7);<br>
}<br>
<br>
void mrSetChannel() {<br>
 mrChannel = mrBuf[1];<br>
}<br>
<br>
void mrSetCommand() {<br>
 mrCommand = mrBuf[2];<br>
}<br>
<br>
void mrSetFormat() {<br>
 mrFormat = mrBuf[3];<br>
}<br>
<br>
void mrSetDeviceType() {<br>
 byte tp1 = bitRead(mrBuf[5], 4);<br>
 byte tp2 = bitRead(mrBuf[5], 5);<br>
 byte tp3 = bitRead(mrBuf[5], 6);<br>
 mrDeviceType = 4*tp3 + 2*tp2 + tp1;<br>
}<br>
<br>
void mrSetDatas() {<br>
 mrData0 = mrBuf[4];<br>
 mrData1 = mrBuf[5];<br>
 mrData2 = mrBuf[6];<br>
 mrData3 = mrBuf[7];<br>
}<br>
<br>
void mrSetTemperature() {<br>
 byte t8 = bitRead(mrData1, 0);<br>
 byte t9 = bitRead(mrData1, 1);<br>
 byte t10= bitRead(mrData1, 2);<br>
 int temp2 = 1024*t10 + 512*t9 + 256*t8;<br>
<br>
int temp = mrData0 + temp2;<br>
<br>
byte t11 = bitRead(mrData1, 3);<br>
 if (t11 == 1) {<br>
 temp = (4096 — temp) * -1;<br>
 }<br>
 mrTemp = (float)temp / 10.0;<br>
}<br>
<br>
void mrSetBatteryState() {<br>
 mrBatteryState = bitRead(mrBuf[5], 7);<br>
}<br>
<br>
void mrSetHumidity() {<br>
 mrHumidity = mrData2;<br>
}<br>
<br>
void mrSetBrightness() {<br>
 mrBrightness = mrData3;<br>
}<br>
<br>
void mrNewData() {<br>
 mrClearData();<br>
 mrPrintHeader();<br>
 <br>
 mrSetBindState();<br>
 mrPrintBindState();<br>
 mrSetChannel();<br>
 mrPrintChannel();<br>
<br>
mrSetCommand();<br>
 mrSetDatas();<br>
<br>
switch (mrCommand) {<br>
 case 0:<br>
 Serial.print(“PIR command: „); Serial.println(“OFF»);<br>
 break;<br>
 case 2:<br>
 Serial.print(«PIR command: „); Serial.println(“ON»);<br>
 break;<br>
 case 21:<br>
 mrSetDeviceType();<br>
 mrPrintDeviceType();<br>
 if (mrDeviceType == 1) {<br>
 mrSetTemperature();<br>
 mrPrintTemperature();<br>
 }<br>
 if (mrDeviceType == 2) {<br>
 mrSetTemperature();<br>
 mrPrintTemperature();<br>
 mrSetHumidity();<br>
 mrPrintHumidity();<br>
 }<br>
 break;<br>
 default: <br>
;<br>
 } // switch<br>
 mrSetBatteryState();<br>
} // newData()<br>
<br>
void mrCheck() {<br>
 if (Serial2.available() == 8) {<br>
 mrBuf[0] = Serial2.read();<br>
 mrBuf[1] = Serial2.read();<br>
 mrBuf[2] = Serial2.read();<br>
 mrBuf[3] = Serial2.read();<br>
 if (mrBuf[0] == 79 &amp;&amp; mrBuf[1] == 75 &amp;&amp; mrBuf[2] == 13 &amp;&amp; mrBuf[3] == 10) {<br>
 Serial.println(«OK»);<br>
 } else {<br>
 mrBuf[4] = Serial2.read();<br>
 mrBuf[5] = Serial2.read();<br>
 mrBuf[6] = Serial2.read();<br>
 mrBuf[7] = Serial2.read();<br>
 mrNewData();<br>
 }<br>
 }<br>
}<br>
<br>
void setup() {<br>
 Serial.begin(9600);<br>
 Serial2.begin(9600);<br>
 Serial.println("*** Start sketch ***");<br>
 mrBind(0);<br>
 //mrUnbind(0);<br>
}<br>
<br>
void loop() {<br>
 mrCheck();<br>
} // loop()<br>
<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br>
, ,  ,   ,      MR1132        .            nooLite                  .<br>
<br>
   0.15    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Arduino Mega Server</a>         MR1132       -     .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr393185/">https://habr.com/ru/post/fr393185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr393171/index.html">Selon le compte de Vilnius: comment la Lituanie aide les crypto-monnaies et les chaînes de blocs à changer le monde</a></li>
<li><a href="../fr393175/index.html">Nouvelle initiative Microsoft OpenT2T: «L'interface de tout»</a></li>
<li><a href="../fr393177/index.html">Quarante-deux secondes</a></li>
<li><a href="../fr393179/index.html">Intel Compute Stick a obtenu des processeurs Intel Core et des caméras Realsense</a></li>
<li><a href="../fr393181/index.html">Une puce radio a été créée qui émet et reçoit simultanément à l'aide d'une seule antenne</a></li>
<li><a href="../fr393187/index.html">Рогозин: нужна коллективная разработка ПО по примеру Китая, с участием государства</a></li>
<li><a href="../fr393189/index.html">Oscar, corps modulaire</a></li>
<li><a href="../fr393191/index.html">Combien coûte l'armure de Dark Vador</a></li>
<li><a href="../fr393193/index.html">«Une tentative sans précédent d'inviolabilité de la vie personnelle des citoyens»</a></li>
<li><a href="../fr393195/index.html">La MPAA veut que les fournisseurs déconnectent les pirates récurrents d'Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>