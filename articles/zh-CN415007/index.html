<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌪️ 🧘🏿 👸🏻 如何以复杂的方式在Linux上设置蓝牙 🍛 👐🏻 🔻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在筹备年度IT论坛时，提出了创建一个由无线游戏手柄控制的简单操纵器的想法，以演示微控制器和单板计算机的功能。 在论坛开始前一个月，手边有一个TRIC控制器，几个伺服电机，一个铁结构构造器。 


 “一切都按计划进行，”但在这种情况下并非如此。 
 阶段1.准备 


 Linux上的TRIC对于这...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何以复杂的方式在Linux上设置蓝牙</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415007/"><p><img src="https://habrastorage.org/webt/wq/9u/sv/wq9usvb7w6-8_c5p_dhrrkom_qa.jpeg"></p><br><p>在筹备年度IT论坛时，提出了创建一个由无线游戏手柄控制的简单操纵器的想法，以演示微控制器和单板计算机的功能。 在论坛开始前一个月，手边有一个TRIC控制器，几个伺服电机，一个铁结构构造器。 </p><br><p>  “一切都按计划进行，”但在这种情况下并非如此。 </p><a name="habracut"></a><br><h1 id="etap-1-podgotovka"> 阶段1.准备 </h1><br><p>  Linux上的TRIC对于这样的操纵器来说是一个破灭，但是“问题是过时的可用性和维护性”（关于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">智能对讲机中</a> Linux的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">ClusterM</a>引用）。 </p><br><p> 阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规范后</a> ，发现它具有蓝牙。 如果您使用此控制器，那么您将知道程序是通过Wi-Fi进行传输的，并且没有其他便捷的通讯方式。 菜单中没有提到蓝牙。 但是，如何呢？ </p><br><p> 带着SSH，螺丝起子和好奇心，我开始寻找蓝牙。 该系统包括hcitool，hciconfig和bluetoothd守护程序。 他们所有人都说他不在那儿。 </p><br><pre><code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># hcitool dev Devices:</span></span></code> </pre> <br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># hciconfig hci0 Can't get device info: No such device</span></span></code> </pre> <br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># bluetoothd -n &amp; [1] 5449 root@trik-7dda93:~# bluetoothd[5449]: Bluetooth daemon 4.101 bluetoothd[5449]: Starting SDP server bluetoothd[5449]: Bluetooth Management interface initialized</span></span></code> </pre> <br><p> 我继续打电话寻找外部USB模块的朋友。 </p><br><p> 拆卸控制器后，找到了Jorjin WG7311-0A模块。 该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">规范</a>指出，确实存在Wi-Fi，蓝牙甚至FM收音机。 与蓝牙通信的接口是UART，并且已通过BT_EN打开。 </p><br><p><img src="https://habrastorage.org/webt/de/5d/qh/de5dqhz_nocaef_cwt0fh_d5umc.jpeg"></p><br><p> 在阅读了如何通过hcitool通过UART连接蓝牙模块后，我一无所获。 三个空闲UART端口中的两个处于静默状态。 </p><br><p> 但是我们已经联系BT_EN！ 可能只是简单地关闭了模块并且不响应请求。 在检查用于ARM设备的Linux内核设备后，找到了一个文件，在该文件中注册了SoC使用的所有联系人。 通过在内核源代码中打开<code>arch/arm/mach-davinci/board-da850-trik.c</code> ，实际上找到了用于蓝牙的GPIO触点。 胜利了！ 我以为 </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> da850_trik_bluetooth_pins[] __initconst = { DA850_GPIO6_11, <span class="hljs-comment"><span class="hljs-comment">/*BT_EN_33 */</span></span> DA850_GPIO6_10, <span class="hljs-comment"><span class="hljs-comment">/*BT_WU_33*/</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> };</code> </pre> <br><h1 id="etap-2-nastuplenie"> 第二阶段。进攻 </h1><br><p> 要通过GPIO启用联系人，您需要找到其端到端的序列号。 我们在内核代码中找到以下行，其中包含初始化<code>arch/arm/mach-davinci/board-da850-trik.c</code> ： </p><br><pre> <code class="hljs lisp">ret = gpio_request_one(<span class="hljs-name"><span class="hljs-name">GPIO_TO_PIN</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>), GPIOF_OUT_INIT_LOW, <span class="hljs-string"><span class="hljs-string">"BT_EN_33"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><p> 它使用宏GPIO_TO_PIN。 请参阅<code>arch/arm/mach-davinci/include/mach/gpio-davinci.h</code>的宏描述： </p><br><pre> <code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/* Convert GPIO signal to GPIO pin number */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GPIO_TO_PIN(bank, gpio) (16 * (bank) + (gpio))</span></span></code> </pre> <br><p> 使用它，您可以找到端到端的联系电话。 我们得到的是16 * 6 + 11 =107。现在我们转到包含联系。 </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 1 &gt;&gt; /sys/devices/virtual/gpio/gpio107/value</code> </pre> <br><p>  echo命令中的0或1是接触状态。 </p><br><p> 运行命令进行连接并... </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># hciattach /dev/ttyS0 texas Found a Texas Instruments' chip! Firmware file : /lib/firmware/TIInit_7.6.15.bts can't open firmware file: No such file or directory Warning: cannot find BTS file: /lib/firmware/TIInit_7.6.15.bts Device setup complete</span></span></code> </pre> <br><p> 我们目前无法理解的错误消息。 我们尝试通过hcitool配置设备： </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># hcitool dev Devices:</span></span></code> </pre> <br><p> 尽管据称初始化已通过，但没有设备。 我们尝试使用不同类型的适配器进行第二次连接： </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># hciattach /dev/ttyS0 texasalt Texas module LMP version : 0x06 Texas module LMP sub-version : 0x1f0f internal version freeze: 15 software version: 6 chip: wl1271 (7) Opening firmware file: /etc/firmware/wl1271.bin Could not open firmware file /etc/firmware/wl1271.bin: No such file or directory (2). Device setup complete</span></span></code> </pre> <br><p> 再说一遍，什么都没有。 让我们回到第一个错误，运用英语知识： </p><br><pre> <code class="bash hljs">Warning: cannot find BTS file: /lib/firmware/TIInit_7.6.15.bts</code> </pre> <br><p> 我们使用固件打开文件夹/ lib / firmware，但找不到所需的文件。 在Internet上进行长时间搜索后，我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在TI存储库中</a>找到了所需的文件并下载了该文件。 同一文件的其他版本拒绝工作。 </p><br><pre> <code class="bash hljs">curl -k https://git.ti.com/wilink8-bt/ti-bt-firmware/blobs/raw/45897a170bc30afb841b1491642e774f0c89b584/TIInit_7.6.15.bts &gt; TIInit_7.6.15.bts cp TIInit_7.6.15.bts /lib/firmware/TIInit_7.6.15.bts</code> </pre> <br><p> 我们重新启动控制器并重新连接： </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># echo 1 &gt;&gt; /sys/devices/virtual/gpio/gpio107/value root@trik-7dda93:~# hciattach /dev/ttyS0 texas Found a Texas Instruments' chip! Firmware file : /lib/firmware/TIInit_7.6.15.bts Loaded BTS script version 1 Device setup complete</span></span></code> </pre> <br><p> 万岁！ 固件已启动。 检查hciconfig： </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># hciconfig hci0: Type: BR/EDR Bus: UART BD Address: 78:**:**:**:**:B3 ACL MTU: 1021:4 SCO MTU: 180:4 DOWN RX bytes:509 acl:0 sco:0 events:21 errors:0 TX bytes:388 acl:0 sco:0 commands:21 errors:0</span></span></code> </pre> <br><p> 我们启动蓝牙服务，扫描设备并检测我们的模块： </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># bluetoothd -n &amp; [1] 4689 bluetoothd[4689]: Bluetooth daemon 4.101 bluetoothd[4689]: Starting SDP server bluetoothd[4689]: Bluetooth Management interface initialized bluetoothd[4689]: Parsing /etc/bluetooth/serial.conf failed: No such file or directory bluetoothd[4689]: Could not get the contents of DMI chassis type bluetoothd[4689]: Adapter /org/bluez/4689/hci0 has been enabled root@trik-7dda93:~# hciconfig hci0 piscan</span></span></code> </pre> <br><p> 计算机搜索找到设备： </p><br><p><img src="https://habrastorage.org/webt/vs/bz/mb/vsbzmb32vz8tbechhhpuroku9qs.png"></p><br><p> 要启用蓝牙，您可以创建一个脚本： </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash case "$1" in start) echo 1 &gt;&gt; /sys/devices/virtual/gpio/gpio107/value bluetoothd -n &amp; hciattach /dev/ttyS0 texas hciconfig hci0 piscan ;; stop) ;; restart) ;; status) ;; *) ;;</span></span></code> </pre> <br><p> 并将其添加到自动运行： </p><br><pre> <code class="bash hljs">cp init-bluetooth /etc/init.d/init-bluetooth update-rc.d init-bluetooth <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> 99</code> </pre> <br><p> 模块的重启和关机行为异常，因此stop和restart选项没有命令。 </p><br><h1 id="etap-3-proverka-svyazi"> 第三阶段。沟通检查 </h1><br><p> 双向验证通讯的最简单方法是COM端口服务。 使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一些命令，</a>将其打开： </p><br><pre> <code class="bash hljs">root@trik-7dda93:~<span class="hljs-comment"><span class="hljs-comment"># sdptool add --channel=3 SP Serial Port service registered root@trik-7dda93:~# mknod -m 666 /dev/rfcomm0 c 216 0 root@trik-7dda93:~# rfcomm watch /dev/rfcomm0 3 /sbin/getty rfcomm0 115200 linux Waiting for connection on channel 3</span></span></code> </pre> <br><p> 我们通过电话连接，并看到进入系统的邀请： </p><br><p><img src="https://habrastorage.org/webt/0i/lw/p9/0ilwp9kassasp_xfmvc3xhcwvl8.png"></p><br><p> 没有一个经过测试的终端允许输入空的用户密码，因此我不得不在SSH会话中使用线程重定向发送登录信息。 </p><br><h1 id="etap-4-configure--make"> 阶段4. ./configure &amp;&amp; make </h1><br><p> 按照将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">游戏手柄连接到Linux</a>的说明<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">进行</a>操作<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>我们遇到以下问题： </p><br><ul><li> 发行版中的BlueZ已过时，无法理解来自Sixad守护程序的命令，该守护程序与游戏手柄建立了连接 </li><li> 由于许多依赖性，源中的新BlueZ版本拒绝编译 </li><li>  Fresh Debian的BlueZ需要udev和systemd，这是当前发行版中所缺少的 </li></ul><br><p> 唯一可以满足的依赖性是uinput内核模块。 </p><br><p> 为此： </p><br><ul><li> 获取设备上当前内核的配置 </li></ul><br><pre> <code class="bash hljs">cp /proc/config.gz config.gz gunzip config.gz</code> </pre> <br><ul><li> 下载<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">内核代码</a> </li><li> 下载并安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具链</a> </li><li> 将内核配置复制到包含内核代码的文件夹中 </li><li> 将uinput模块添加到配置中 </li></ul><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONFIG_INPUT_UINPUT=m"</span></span> &gt;&gt; config</code> </pre> <br><ul><li> 首先打开工具链开始组装 </li></ul><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> /opt/trik-sdk/environment-setup-arm926ejste-oe-linux-gnueabi make</code> </pre> <br><ul><li> 将内核模块复制到存储卡 </li></ul><br><pre> <code class="bash hljs">make INSTALL_MOD_PATH=/mnt/trik-sd modules_install</code> </pre> <br><ul><li> 构建uBoot映像并将其复制到/ boot </li></ul><br><pre> <code class="bash hljs">make uImage cp arch/arm/boot/uImage /mnt/trik-sd/boot/uImage-3.6.7</code> </pre> <br><p> 现在程序不会因为缺少内核模块而发誓，但是我们什么也做不了。 游戏手柄的说明将在以后派上用场。 </p><br><h1 id="etap-5-varim-kashu-iz-topora"> 阶段5.从斧头煮粥 </h1><br><p> 进入计划“窃贼”。 由于没有方便的方法将必要的程序放在原始发行版中，因此我们将流行一些。 该处理器具有ARMv5TE架构，这意味着它具有发行版。 </p><br><p> 我们尝试解压缩并运行适用于ARM的通用Arch Linux，并在将其加载到控制台中时发现systemd需要更新的内核版本，而我们没有。 尝试转移4.16内核失败，并且花费了太多时间。 </p><br><p> 我们转到另一个选项-Debian。 存在一个带有用于ARM的已安装系统的磁盘映像，但是最好为我们提供一个具有必要程序包和设置的干净系统。 </p><br><h2 id="ustanovka-v-qemu"> 在QEMU中安装 </h2><br><p> 下载安装映像（链接到<a href="">.iso</a> ）并安装QEMU。 <br> 我们还需要内核和initrd映像来启动安装，可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从此处</a>下载。 </p><br><p> 创建具有实际存储卡大小（在本例中为4 GB）的存储卡映像： </p><br><pre> <code class="bash hljs">qemu-img create -f raw debian.img 4G</code> </pre> <br><p> 我们开始安装： </p><br><pre> <code class="bash hljs">qemu-system-arm -M versatilepb -kernel vmlinuz-3.2.0-4-versatile -initrd initrd.gz -hda debian.img -cdrom debian-7.11.0-armel-CD-1.iso</code> </pre> <br><p> 如果要使用非标准相对原始发行版进行磁盘布局，请先保留根分区，否则必须在uBoot中更改内核启动参数。 根文件系统所在的分区号。 </p><br><p> 标准标记包含： </p><br><ol><li>  ≈1.3 GB根文件系统的EXT4分区 </li><li>  FAT32分区，用于存储≈500 MB的用户数据 </li></ol><br><p> 原始发行版映像的fdisk输出： </p><br><pre> <code class="hljs powershell">Disk: trik<span class="hljs-literal"><span class="hljs-literal">-distro</span></span>.img geometry: <span class="hljs-number"><span class="hljs-number">893</span></span>/<span class="hljs-number"><span class="hljs-number">64</span></span>/<span class="hljs-number"><span class="hljs-number">63</span></span> [<span class="hljs-number"><span class="hljs-number">3604478</span></span> <span class="hljs-type"><span class="hljs-type">sectors</span></span>] Signature: <span class="hljs-number"><span class="hljs-number">0</span></span>xAA55 Starting Ending <span class="hljs-comment"><span class="hljs-comment">#: id cyl hd sec - cyl hd sec [ start - size] ------------------------------------------------------------------------ 1: 83 1023 3 32 - 1023 3 32 [ 1040382 - 2564096] Linux files* 2: 0C 64 0 1 - 1023 3 32 [ 8192 - 1032190] Win95 FAT32L 3: 00 0 0 0 - 0 0 0 [ 0 - 0] unused 4: 00 0 0 0 - 0 0 0 [ 0 - 0] unused</span></span></code> </pre><br><p> 设置完参数后，我们离开去喝几杯茶，因为 仿真器并不比真正的ARM处理器快多少。 </p><br><p> 要启动已安装的系统，您需要另一个initrd映像，可<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从此处获取</a> 。 </p><br><p> 我们启动系统： </p><br><pre> <code class="bash hljs">qemu-system-arm -M versatilepb -kernel vmlinuz-3.2.0-4-versatile -initrd initrd.img-3.2.0-4-versatile -hda debian.img -append <span class="hljs-string"><span class="hljs-string">"root=/dev/sda1"</span></span></code> </pre> <br><h2 id="nastroyka-sistemy"> 系统设定 </h2><br><p> 启动后，我们输入超级用户，检查与Internet的连接，更新存储库和系统，放入最少的程序集： </p><br><pre> <code class="bash hljs">apt-get update apt-get upgrade apt-get install curl git mc htop joystick</code> </pre> <br><h3 id="terminaly"> 码头 </h3><br><p> 我们编辑<code>/etc/inittab</code> ，删除不必要的端子，打开我们需要的UART并为正确的用户添加自动输入（仅在调试时使用root）。 如果您打算运行外壳程序以在控制器上进行控制，则自动输入很有用。 </p><br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">2345</span></span><span class="hljs-symbol"><span class="hljs-symbol">:respawn</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/sbin/getty</span></span> <span class="hljs-number"><span class="hljs-number">38400</span></span> tty1 --autologin root <span class="hljs-comment"><span class="hljs-comment">#2:23:respawn:/sbin/getty 38400 tty2 #3:23:respawn:/sbin/getty 38400 tty3 #4:23:respawn:/sbin/getty 38400 tty4 #5:23:respawn:/sbin/getty 38400 tty5 #6:23:respawn:/sbin/getty 38400 tty6 uart:12345:respawn:/sbin/getty -L 115200 ttyS1</span></span></code> </pre> <br><h3 id="bluetooth-i-wi-fi"> 蓝牙和WiFi </h3><br><p> 安装bluez-utils和wpasupplicant以访问Wi-Fi和蓝牙。 </p><br><pre> <code class="bash hljs">apt-get install bluez-utils wpasupplicant</code> </pre> <br><p> 我们禁用eth0接口，并在<code>/etc/network/interfaces</code>配置wlan1 <code>/etc/network/interfaces</code> ： </p><br><pre> <code class="hljs kotlin"># /etc/network/interfaces -- configuration file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ifup(<span class="hljs-number"><span class="hljs-number">8</span></span>), ifdown(<span class="hljs-number"><span class="hljs-number">8</span></span>) # The loopback <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inet</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loopback</span></span></span><span class="hljs-class"> # </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wireless</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interfaces</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wlan1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wlan1</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inet</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dhcp</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wireless_mode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">managed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wireless_essid</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wpa</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">driver</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wext</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wpa</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conf</span></span></span><span class="hljs-class"> /</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">etc</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wpa_supplicant</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conf</span></span></span></span></code> </pre> <br><p> 预先将网络添加到<code>/etc/wpa_supplicant.conf</code> ，因为 在控制器本身上执行此操作不太方便： </p><br><pre> <code class="bash hljs">wpa_passphrase ssid password &gt;&gt; /etc/wpa_supplicant.conf</code> </pre> <br><p> 如果您没有Wi-Fi访问权限，则可以使用UART进行进一步的配置，但是请记住，默认情况下，内核会向该终端显示所有错误。 因此，在运行期间，来自内核或服务的突然消息可能会打扰您。 </p><br><p> 添加脚本以启用蓝牙。 这次，修改<code>/etc/init.d/bluetooth</code> ： </p><br><pre> <code class="bash hljs"> 139: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> start) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 1 &gt;&gt; /sys/devices/virtual/gpio/gpio107/value  168: hciattach /dev/ttyS0 texas log_end_msg 0 ;;</code> </pre><br><p> 因此，所有需要蓝牙服务的服务都将运行必要的命令以进行初始化。 </p><br><h3 id="vzmah-vlevo-vzmah-vpravo"> 向左滑动，向右滑动 </h3><br><p> 我们删除了可以使用htop查看的不必要的程序和服务，因为它们在RAM中占据了宝贵的位置： </p><br><p><img src="https://habrastorage.org/webt/4e/rg/av/4ergavw2trhiiyvvlnmdtc1luhk.png"></p><br><p> 在这种情况下，ConsoleKit服务具有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">许多进程</a> 。 如果恢复，请将此服务的文件移动到根文件夹： </p><br><pre> <code class="bash hljs">mv /usr/share/dbus-1/system-services/org.freedesktop.ConsoleKit.service /root/</code> </pre> <br><p> 关闭服务之前，RAM消耗为19 MB，之后为16 MB。 </p><br><h3 id="razdely-sistemy"> 系统部分 </h3><br><p> 尽管uBoot将根分区所在的设备转移到内核，但是值得一提的是将其写入<code>/etc/fstab</code>以提高可靠性。 我们更改负责根部分的第一行： </p><br><pre> <code class="hljs mel">/dev/mmcblk0p1 / auto defaults <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> defaults <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> devpts /dev/pts devpts mode=<span class="hljs-number"><span class="hljs-number">0620</span></span>,gid=<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> usbdevfs /<span class="hljs-keyword"><span class="hljs-keyword">proc</span></span>/bus/usb usbdevfs noauto <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> tmpfs /run tmpfs mode=<span class="hljs-number"><span class="hljs-number">0755</span></span>,nodev,nosuid,strictatime <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> tmpfs /var/volatile tmpfs defaults <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p> 如果您没有将根分区设为第一个分区，请不要忘记指定所需的分区号。 </p><br><p> 如果您将第二个FAT分区留给用户数据，则需要创建一个文件夹来将分区挂载到其中 </p><br><pre> <code class="bash hljs">mkdir /usr/share/trik</code> </pre> <br><p> 并在<code>/etc/fstab</code>编写该部分： </p><br><pre> <code class="bash hljs">/dev/mmcblk0p2 /usr/share/trik vfat defaults 0 0</code> </pre> <br><h1 id="etap-6-probuem-nashu-kashu"> 第六阶段，我们尝试粥 </h1><br><p> 配置系统映像之后，必须将其挂载以安装内核模块和内核本身： </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,     (start) fdisk -l debian.img mount -o loop,offset=NNNN debian.img /mnt/debian</span></span></code> </pre> <br><p> 其中，NNNN =扇区大小*部分的开头。 默认扇区大小为512字节。 </p><br><p> 我们还安装了原始发行版： </p><br><pre> <code class="bash hljs">fdisk -l trik-distro.img mount -o loop,offset=NNNN trik-distro.img /mnt/trik-clean</code> </pre> <br><p> 我们删除了QEMU及其模块的内核，如下所示： 它们不适用于我们的平台。 我们复制新的内核和模块，就像在原始发行版上一样。 </p><br><pre> <code class="hljs powershell">rm <span class="hljs-literal"><span class="hljs-literal">-rf</span></span> /mnt/debian/boot/ rm <span class="hljs-literal"><span class="hljs-literal">-rf</span></span> /mnt/debian/lib/modules/<span class="hljs-number"><span class="hljs-number">3.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-literal"><span class="hljs-literal">-4</span></span><span class="hljs-literal"><span class="hljs-literal">-versatile</span></span> rm <span class="hljs-literal"><span class="hljs-literal">-rf</span></span> /mnt/debian/lib/modules/<span class="hljs-number"><span class="hljs-number">3.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-versatile</span></span> mkdir /mnt/debian/boot/ cp arch/arm/boot/uImage /mnt/debian/boot/ make INSTALL_MOD_PATH=/mnt/debian modules_install</code> </pre> <br><p> 我们将需要用于Wi-Fi模块的固件，该固件位于/ lib /固件文件夹中的原始发行版中，以及我们之前找到的Bluetooth固件。 </p><br><pre> <code class="hljs ruby">cp /mnt/trik-clean/lib/firmware/* <span class="hljs-regexp"><span class="hljs-regexp">/mnt/debian</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lib/firmware</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ cp TIInit_7.6.15.bts /mnt</span></span><span class="hljs-regexp"><span class="hljs-regexp">/debian/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/firmware/</span></span></code> </pre> <br><p> 断开磁盘映像： </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">umount</span></span> /mnt/trik-clean umount /mnt/debian</code> </pre> <br><p> 然后开始使用dd将映像复制到存储卡： </p><br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#    ( ) lsblk dd </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">=debian.img of=/dev/sdX bs=4M</span></span></code> </pre> <br><h1 id="etap-7-finishnaya-pryamaya"> 阶段7.终点线 </h1><br><p> 我们在新系统上编译用于连接游戏手柄的程序，并安装sixad守护程序。 </p><br><p> 我们通过USB将游戏手柄连接到控制器，然后运行程序以创建一个配对： </p><br><pre> <code class="bash hljs">root@trik:~/bt<span class="hljs-comment"><span class="hljs-comment"># ./sixpair Current Bluetooth master: 78:**:**:**:**:b9 Setting master bd_addr to 78:**:**:**:**:b9</span></span></code> </pre> <br><p> 连接游戏手柄后，什么也没有发生，并且Sixad服务处于静默状态： </p><br><pre> <code class="bash hljs">sixad-bin[2675]: started sixad-bin[2675]: sixad started, press the PS button now sixad-bin[2675]: unable to connect to sdp session</code> </pre> <br><p> 但是Raspberry Pi社区已经做出了“拐杖”来修复<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">连接</a> 。 </p><br><p> 我们重建程序并欣喜。 </p><br><pre> <code class="hljs powershell">sixad<span class="hljs-literal"><span class="hljs-literal">-bin</span></span>[<span class="hljs-number"><span class="hljs-number">2833</span></span>]: started sixad<span class="hljs-literal"><span class="hljs-literal">-bin</span></span>[<span class="hljs-number"><span class="hljs-number">2833</span></span>]: sixad started, press the PS button now sixad<span class="hljs-literal"><span class="hljs-literal">-bin</span></span>[<span class="hljs-number"><span class="hljs-number">2833</span></span>]: unable to connect to sdp session sixad<span class="hljs-literal"><span class="hljs-literal">-sixaxis</span></span>[<span class="hljs-number"><span class="hljs-number">2836</span></span>]: started sixad<span class="hljs-literal"><span class="hljs-literal">-sixaxis</span></span>[<span class="hljs-number"><span class="hljs-number">2836</span></span>]: Connected <span class="hljs-string"><span class="hljs-string">'PLAYSTATION(R)3 Controller (00:**:**:**:**:09)'</span></span> [<span class="hljs-type"><span class="hljs-type">Battery</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>]</code> </pre> <br><p> 现在游戏手柄可以作为输入设备供系统使用，并且jstest程序将显示所有按钮和模拟传感器的状态： </p><br><pre> <code class="hljs apache"><span class="hljs-attribute"><span class="hljs-attribute">root</span></span>@trik:~# ls /dev/input/ by-path event0 event1 event2 event3 js0 js1 js2 mice root@trik:~# jstest --normal /dev/input/jsX Driver version is 2.1.0. Joystick (PLAYSTATION(R)3 Controller (00:**:**:**:**:09)) has 29 axes (X, Y, Z, Rx, Ry, Rz, Throttle, Rudder, Wheel, Gas, Brake, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, (null), (null), (null), (null), (null), (null), (null), (null)) and 17 buttons (Trigger, ThumbBtn, ThumbBtn2, TopBtn, TopBtn2, PinkieBtn, BaseBtn, BaseBtn2, BaseBtn3, BaseBtn4, BaseBtn5, BaseBtn6, BtnDead, BtnA, BtnB, BtnC, BtnX). Testing ... (interrupt to exit) Axes: 0: 0 1: 0 2: 0 3: 0 4: -7150 5: -7746 6:-32767 7: 0 8: 0 9: 0 10: 0 11: 0 12: 0 13: 0 14: 0 15: 0 16: 0 17: 0 18: 0 19: 0 20: 0 21: 0 22: 0 23: 0 24: 0 25: 0 26: 0 27: 0 28: 0 Buttons: 0:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 1:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 2:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 3:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 4:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 5:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 6:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 7:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 8:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 9:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 10:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 11:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 12:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 13:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 14:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 15:<span class="hljs-literal"><span class="hljs-literal">off</span></span> 16:<span class="hljs-literal"><span class="hljs-literal">off</span></span></code> </pre> <br><p> 其中X是系统中的设备编号，默认为-2。可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>查看按钮和轴的数量。 </p><br><h1 id="ispolzuem-na-praktike"> 实际使用 </h1><br><p> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">YouTube上</a>显示游戏手柄的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视频</a> 。 </p><br><div class="spoiler">  <b class="spoiler_title">发行照片</b> <div class="spoiler_text"><p> 内核加载： <br><img src="https://habrastorage.org/webt/aj/mx/xt/ajmxxtarcapbe4hwfefj5-v83ws.jpeg"><br> 在X11上运行的终端： <br><img src="https://habrastorage.org/webt/bi/gn/vk/bignvkyajckcuobz8rzgyf5priw.jpeg"></p><br><p><img src="https://habrastorage.org/webt/cp/6k/pu/cp6kpumd7uxcxnlyc3jg7mpmn2m.jpeg"><br> 并根据传统： <br><img src="https://habrastorage.org/webt/9f/et/xk/9fetxkfu74mdacfatuwnaodrmj8.jpeg"></p><br><p><img src="https://habrastorage.org/webt/qw/mi/1h/qwmi1hncq77acchz8dfjfpzs334.jpeg"></p></div></div><br><h3 id="poleznye-ssylki"> 有用的链接 </h3><br><p> 连接<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dualshock</a> 3游戏手柄<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Sixpair</a>和<a href="">Sixad的程序</a> 。 </p><br><p> 对于游戏手柄和其他输入设备，有一个轻量级的C库<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-libenjoy</a> 。 </p><br><p> 用于控制伺服电动机和电动机的程序的源代码是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub存储库</a> 。 </p><br><p> 临时分发工具包文章中的所有配置文件都是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub存储库</a> 。 </p><br><p> 内核源是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub存储库</a> 。 </p><br><h1 id="interesnye-fakty-o-kontrollere"> 关于控制器的有趣事实 </h1><br><ul><li> 规范指出RAM为256 MB。 但是，如果运行htop，您将看到只有128 MB可用。 这受可在uBoot控制台中查看的内核选项的限制： </li></ul><br><pre> <code class="bash hljs">mem=128M console=ttyS1,115200n8 rw noinitrd rootwait root=/dev/mmcblk0p1 vt.global_cursor_default=0 consoleblank=0</code> </pre> <br><p> 该存储芯片标有Micron生产的3PC22 D9MTD。 无法找到有关其当前数量的信息。 </p><br><ul><li>  uBoot存储在也连接了内核的SPI闪存中，因此不使用。 您可以尝试使用该位置执行任务，或者复制新内核并重新配置uBoot，以便它使用它。 </li></ul><br><p> 来自dmesg的图像地址： </p><br><pre> <code class="bash hljs">[ 11.598170] 0x000000000000-0x000000040000 : <span class="hljs-string"><span class="hljs-string">"uboot"</span></span> [ 11.642985] 0x000000040000-0x000000080000 : <span class="hljs-string"><span class="hljs-string">"uboot-env1"</span></span> [ 11.706256] 0x000000080000-0x0000000c0000 : <span class="hljs-string"><span class="hljs-string">"uboot-env2"</span></span> [ 11.761827] 0x0000000c0000-0x000000100000 : <span class="hljs-string"><span class="hljs-string">"config-periph"</span></span> [ 11.805129] 0x000000100000-0x000000400000 : <span class="hljs-string"><span class="hljs-string">"kernel"</span></span> [ 11.861864] 0x000000400000-0x000001000000 : <span class="hljs-string"><span class="hljs-string">"RootFS"</span></span></code> </pre> <br><ul><li> 控制器的屏幕虽然很小，但实际上有一个电阻传感器。 传感器本身是否已连接尚不清楚。 </li><li>  Dualshock 3在USB连接器上具有LED，这些LED显示游戏手柄/操纵杆的编号。 视频中只有一个游戏手柄，但数量为3。这不是错误，因为 系统中还有两个“操纵杆”：一个加速度计和一个陀螺仪。 </li></ul><br><h1 id="problemy-voznikshie-pri-ispolzovanii"> 使用中遇到的问题 </h1><br><ul><li> 机器人有时会挂得很紧，而没有关闭伺服电机，这使它们可以根据数据线上的噪声来改变位置。 即使在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">标准发行版中</a>也可以看到这一点。 </li><li>  PWM控制器的内容与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a>中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">内容</a>有所不同。 至少在纯C中这是行不通的。 </li><li>  USB有时会在Debian上停止工作。 </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN415007/">https://habr.com/ru/post/zh-CN415007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414997/index.html">ML-Blitz：第一轮资格赛的任务分析</a></li>
<li><a href="../zh-CN414999/index.html">3D Watchman和热敏电阻测试仪</a></li>
<li><a href="../zh-CN415001/index.html">撞倒骑车人的Uber机器人车的操作员在撞车时观看了语音节目</a></li>
<li><a href="../zh-CN415003/index.html">在Apple.com上不受限制地上传文件</a></li>
<li><a href="../zh-CN415005/index.html">太阳能电池板，语音命令和越野赛车：电动自行车的现在和未来</a></li>
<li><a href="../zh-CN415009/index.html">北美招聘中的谁-第1部分</a></li>
<li><a href="../zh-CN415011/index.html">《 2018年罗马俱乐部报告》第3.10章：“节拍税”</a></li>
<li><a href="../zh-CN415015/index.html">下诺夫哥罗德的IT雇主评级：技术专业学生的偏好研究</a></li>
<li><a href="../zh-CN415017/index.html">拯救生命的.NET产品</a></li>
<li><a href="../zh-CN415019/index.html">行销 只是复杂</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>