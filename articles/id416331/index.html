<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤦🏽 💆 🕉️ Sejarah refactoring aplikasi Citimobil 📼 🍍 👌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sekitar setahun yang lalu, saya bergabung dengan tim CityMobil sebagai pengembang Android. Saya terbiasa dengan proyek baru untuk diri saya sendiri, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sejarah refactoring aplikasi Citimobil</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/416331/"><img src="https://habrastorage.org/webt/0x/uf/e0/0xufe0ffghyddfihpobtxjywqpe.jpeg"><br><br>  Sekitar setahun yang lalu, saya bergabung dengan tim CityMobil sebagai pengembang Android.  Saya terbiasa dengan proyek baru untuk diri saya sendiri, pendekatan dan teknologi baru.  Pada saat itu, Citimobil sudah memiliki sejarah yang agak panjang, seperti proyek yang saya adopsi, aplikasi Android untuk memesan taksi.  Namun, seperti yang sering terjadi dalam kasus seperti itu, kode membawa jejak karakteristik dari solusi lama.  Dan sekarang, setelah berhasil refactoring kode, saya ingin berbagi ide yang, menurut pendapat saya, dapat bermanfaat bagi mereka yang harus memperbaiki proyek yang sudah ada.  Dan di atas semua itu, ini dapat berguna untuk perusahaan kecil dengan tim pengembangan kecil. <br><a name="habracut"></a><br>  Suatu bisnis sering menguji ide-idenya, mengarahkan sumber daya yang terbatas padanya, dan mencoba untuk mendapatkan umpan balik, menguji hipotesisnya secepat mungkin.  Pada saat-saat seperti itu, sebagai suatu peraturan, pemikiran berkualitas tinggi dan implementasi arsitektur proyek, dengan mempertimbangkan masa depan, mulai menghilang.  Secara bertahap, proyek memperoleh fungsionalitas baru, persyaratan bisnis baru muncul, dan semua ini memengaruhi basis kode.  "CityMobil" dalam hal ini tidak terkecuali.  Proyek ini dikembangkan secara berurutan oleh beberapa tim di kantor lama, kemudian, selama perpindahan, didukung dan sebagian terkait dengan outsourcing.  Kemudian mereka mulai membentuk tim baru, dan mereka menyerahkan saya mengerjakan proyek. <br><br>  Pada waktu itu, "pengembangan" pindah ke kantor Moskow, pekerjaan berjalan lancar - tugas-tugas baru yang menarik dan ambisius muncul.  Namun, warisan semakin banyak memasukkan tongkat ke roda, dan begitu kami menyadari bahwa saatnya telah tiba untuk perubahan besar.  Sayangnya, tidak banyak literatur yang berguna ditemukan saat itu.  Dapat dimengerti, diketahui dari pengalaman, hampir tidak mungkin untuk menemukan atau menemukan resep sempurna yang bekerja pada 100% kasus. <br><br>  Hal pertama yang harus dilakukan adalah memahami jika Anda benar-benar membutuhkan refactoring?  Ini harus dipertimbangkan jika: <br><br><ol><li>  Kecepatan memperkenalkan fitur-fitur baru tidak masuk akal rendah, meskipun spesialis tingkat tinggi dalam tim. </li><li>  Perubahan kode di satu bagian program dapat menyebabkan perilaku yang tidak terduga di bagian lain. </li><li>  Adaptasi anggota tim baru tertunda. </li><li>  Pengujian kode terhalang oleh konektivitas yang kuat. </li></ol><br>  Setelah menyadari adanya masalah, seseorang harus menemukan jawaban untuk pertanyaan-pertanyaan berikut: <br><br><ol><li>  Sebenarnya apa yang salah? </li><li>  Apa yang menyebabkan ini? </li><li>  Apa yang perlu dilakukan untuk mencegah hal ini terjadi lagi? </li><li>  Bagaimana cara memperbaiki situasi? </li></ol><br>  Hampir mustahil untuk membangun proyek lama yang bagus tanpa meletakkan arsitektur tertentu.  Dalam proyek kami, kami memutuskan untuk memperkenalkan arsitektur "berlapis", yang telah terbukti dengan baik. <br><br>  Awalnya, proyek ini ditulis terutama dengan bantuan alat yang disediakan oleh Android SDK itu sendiri.  Pendekatan ini tidak diragukan lagi berhasil, tetapi memaksa Anda untuk menulis banyak kode boilerplate, yang sangat menghambat pengembangan.  Dan mengingat bahwa saat ini banyak digunakan untuk tumpukan teknologi tertentu, adaptasi dari pengembang baru membutuhkan waktu lebih lama.  Secara bertahap, kami sampai pada teknologi yang lebih nyaman yang banyak diketahui dan dihargai, dan yang telah membuktikan keandalan dan konsistensi mereka: <br><br><ul><li>  MVP - Pola Desain Antarmuka Pengguna (Model-View-Presenter). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Belati 2</a> adalah kerangka kerja untuk menerapkan dependensi. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RxJava2</a> adalah implementasi dari ReactiveX - sebuah pustaka untuk membuat program berbasis asinkron dan event menggunakan pola Observer untuk JVM. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cicerone</a> adalah perpustakaan yang memungkinkan Anda untuk menyederhanakan navigasi di aplikasi. </li><li>  Sejumlah perpustakaan khusus untuk bekerja dengan peta dan lokasi. </li></ul><br>  Sangat penting untuk mengadopsi gaya kode umum untuk tim, untuk mengembangkan serangkaian praktik terbaik.  Anda juga harus menjaga infrastruktur dan prosesnya.  Lebih baik menulis tes untuk kode baru segera, karena ada banyak informasi mengenai hal ini. <br><br>  Di dalam tim, kami mulai melakukan peninjauan kode tanpa gagal, tidak butuh banyak waktu, tetapi kualitas kode menjadi jauh lebih tinggi.  Bahkan jika Anda sendirian di tim, saya sarankan bekerja pada Git Flow, membuat permintaan penggabungan dan setidaknya memeriksanya sendiri. <br><br>  Semua pekerjaan "kotor" dapat didelegasikan ke CI - dalam kasus kami, ini adalah TeamCity menggunakan fastlane.  Kami mengkonfigurasinya untuk membangun cabang fitur, menjalankan tes, dan mengeluarkan tes internal.  Di tempat kami, kami secara terpisah mengkonfigurasi majelis untuk lingkungan produksi / pementasan, fitur- (kami memanggil mereka dengan nomor tugas dengan templat TASK # task_number) dan melepaskan cabang.  Ini membuat pengujian lebih mudah, dan jika terjadi kesalahan, kami segera tahu apa yang perlu diperbaiki dan di mana. <br><br>  Setelah melakukan semua tindakan pendahuluan, kami mulai bekerja.  Kami memulai kehidupan baru di proyek lama dengan membuat paket (cleanarchitecture).  Penting untuk tidak melupakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">aktivitas-alias</a> saat memindahkan titik masuk ke aplikasi (a-la ActivitySplash).  Jika Anda mengabaikan ini, maka, dalam kasus terbaik, Anda akan kehilangan ikon di peluncur, dan dalam kasus terburuk, kompatibilitas dengan aplikasi lain akan dilanggar. <br><br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- android:name=".SplashActivity" - old launcher activity --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- android:targetActivity=".cleanarchitecture.presentation.SplashActivity" - new launcher activity --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity-alias</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".SplashActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetActivity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".cleanarchitecture.presentation.SplashActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity-alias</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Seperti yang ditunjukkan oleh pengalaman, lebih baik memulai refactoring dengan layar kecil kecil dan sebagian aplikasi.  Dan pada saat tiba saatnya untuk memproses bagian yang paling kompleks dan produktif dari program ini, sebagian besar kode sudah akan ditulis untuk modul lain dan dapat digunakan kembali. <br><br>  Selain itu, kami memiliki tugas besar untuk mendesain ulang aplikasi sepenuhnya, yang, terkadang, menghasilkan penulisan ulang layar secara lengkap.  Kami mulai dengan meningkatkan layar bantu, bersiap untuk melanjutkan ke hal utama. <br><br>  Setelah menulis ulang bagian selanjutnya dari aplikasi, kami mencari bagian-bagian kode di bagian lama aplikasi dan ditandai dengan penjelasan dan analog @Deprecated dari ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/VitalyNikonorov/UsefulAnnotation</a> .  Di dalamnya kami menunjukkan apa yang harus dilakukan ketika menulis ulang bagian dari program ini, fungsionalitas apa dan di mana ia diterapkan. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * This class deprecated, you have to use * com.project.company.cleanarchitecture.utils.ResourceUtils * for new refactored classes */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Deprecated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceHelper</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br>  Setelah semuanya siap untuk bekerja di layar utama, mereka memutuskan untuk tidak merilis fitur baru selama 6-8 minggu.  Kami melakukan penulisan ulang global di cabang kami sendiri, yang kemudian kami tambahkan permintaan penggabungan.  Pada akhir refactoring, mereka menerima permintaan tarik yang didambakan dan aplikasi yang hampir sepenuhnya diperbarui. <br><img src="https://habrastorage.org/getpro/habr/post_images/1eb/062/3a2/1eb0623a2c56f5c26cc0d67925541049.png" width="500"><br>  Setelah refactoring, perubahan fungsi aplikasi menjadi lebih mudah.  Jadi, baru-baru ini kami kembali terlibat dalam pemrosesan layar otorisasi. <br><br>  Awalnya, mereka terlihat sebagai berikut: <br><br><img src="https://habrastorage.org/webt/1o/c1/7c/1oc17clds4-xv0qli25p5c8klqo.png"><br><br>  Setelah pemrosesan dan refactoring pertama, mereka mulai terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/cn/xn/00/cnxn00lr34u_gaj889l2uyzwwgi.png"><br><br>  Sekarang mereka terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/x-/bi/wc/x-biwc7n6mtpg4y2jj5gdfpfpkg.png"><br><br>  Akibatnya, iterasi pertama memakan waktu dua kali lebih banyak daripada yang kedua.  Karena selain memproses UI, saya juga harus memahami kode logika bisnis yang terletak di tempat yang sama, meskipun ini tidak perlu, tetapi cacatnya dihilangkan, yang mengurangi waktu yang dihabiskan untuk tugas dalam iterasi kedua. <br><br>  Apa yang kita miliki saat ini? <br><br>  Untuk membuat kode ini nyaman untuk digunakan dan dikembangkan di masa mendatang, kami mematuhi prinsip "arsitektur bersih".  Saya tidak akan mengatakan bahwa kami memiliki Clean kanonik, tetapi kami mengadopsi banyak pendekatan.  Lapisan presentasi ditulis menggunakan pola MVP (Model-View-Presenter). <br><br><ul><li>  Sebelumnya, kami harus mendiskusikan setiap langkah tanpa henti satu sama lain, untuk mengklarifikasi apakah perubahan dalam satu modul mempengaruhi fungsi yang lain.  Dan sekarang overhead melalui korespondensi telah turun secara signifikan. </li><li>  Karena penyatuan komponen dan fragmen individual, volume basis kode telah sangat menurun. </li><li>  Sebagai hasil dari penyatuan dan pemrosesan arsitektur yang sama, ada lebih banyak kelas, tetapi sekarang ada pembagian tanggung jawab yang jelas di dalamnya, yang menyederhanakan pemahaman proyek. </li><li>  Basis kode dibagi menjadi beberapa lapisan, untuk pemisahan dan interaksinya, digunakan kerangka kerja injeksi ketergantungan Belati 2. Hal ini mengurangi koherensi kode dan meningkatkan kecepatan pengujian. </li></ul><br>  Ada banyak lagi poin menarik terkait dengan refactoring kode lama.  Jika pembaca akan tertarik, saya akan menulis lebih banyak tentang mereka nanti.  Saya juga akan senang jika Anda juga membagikan pengalaman Anda. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id416331/">https://habr.com/ru/post/id416331/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id416319/index.html">Latar belakang: daftar putih IMEI dan Rossvyaz</a></li>
<li><a href="../id416321/index.html">Bagaimana menjadi pembicara dalam konferensi IT internasional</a></li>
<li><a href="../id416323/index.html">Opsi akses acak ke pengaturan dan rekaman registrar mobil dari mana saja di Internet</a></li>
<li><a href="../id416327/index.html">802.11ax standar baru (High Efficiency WLAN), apa yang baru di dalamnya dan kapan harus menunggu?</a></li>
<li><a href="../id416329/index.html">Kembalinya stasiun antarplanet Soviet. Prakiraan awal</a></li>
<li><a href="../id416333/index.html">Gelombang Baru: mengapa pendinginan air di pusat data semakin populer</a></li>
<li><a href="../id416335/index.html">Ulasan kecil QCon 2018</a></li>
<li><a href="../id416339/index.html">Akun Kepemilikan Ethereum dan Panduan Kontrak</a></li>
<li><a href="../id416341/index.html">Bagaimana kami melindungi ulasan, pembelian, dan perjalanan dari penipu</a></li>
<li><a href="../id416343/index.html">Dari mana jaringan saraf berasal dan apa yang terjadi sekarang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>