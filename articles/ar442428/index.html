<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ ๐๏ธ ๐๐ฟ ุฃุจุณุท ุณุทุฑ ุงูุฃูุงูุฑ ุนูู NASM ู QEMU ๐ฅช ๐๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฐูู ุ ุงูุญู ูู ูุฐู ุงูููุทุฉ. ุณููุชุจ ุชุญุช Linux ุ ุนูู NASM ูุจุงุณุชุฎุฏุงู QEMU. ูุฐุง ุณูู ุงูุชุซุจูุช ุ ูุฐูู ุชุฎุทู ูุฐู ุงูุฎุทูุฉ. 


 ูู ุงูููููู ุฃู ุงููุงุฑุฆ ุนูู ุฏุฑุงูุฉ ุจุฌููุฉ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุจุณุท ุณุทุฑ ุงูุฃูุงูุฑ ุนูู NASM ู QEMU</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442428/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/-m/3u/a3/-m3ua33_7vl-xeb4pg1o8qacclg.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุงูุญู ูู ูุฐู ุงูููุทุฉ.  ุณููุชุจ ุชุญุช Linux ุ ุนูู NASM ูุจุงุณุชุฎุฏุงู QEMU.  ูุฐุง ุณูู ุงูุชุซุจูุช ุ ูุฐูู ุชุฎุทู ูุฐู ุงูุฎุทูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููููู ุฃู ุงููุงุฑุฆ ุนูู ุฏุฑุงูุฉ ุจุฌููุฉ NASM ุนูู ุงูุฃูู ูู ุงููุณุชูู ุงูุฃุณุงุณู (ููุน ุฐูู ุ ูู ูููู ููุงู ุฃู ุดูุก ูุนูุฏ ุจุดูู ุฎุงุต ููุง) ููููู ูุงููุฉ ุงูุณุฌูุงุช. </p><a name="habracut"></a><br><h2 id="bazovaya-teoriya" style=";text-align:right;direction:rtl">  ุงููุธุฑูุฉ ุงูุฃุณุงุณูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุฃูู ุดูุก ูุจุฏุฃ ุชุดุบูู ุงููุนุงูุฌ ุนูุฏ ุชุดุบูู ุงูููุจููุชุฑ ูู ุฑูุฒ BIOS (ุฃู UEFI ุ ููู ููุง ุณุฃุชุญุฏุซ ููุท ุนู BIOS) ุ ููู "ุณููู" ูู ุฐุงูุฑุฉ ุงูููุญุฉ ุงูุฃู (ุนูู ูุฌู ุงูุชุญุฏูุฏ ุ ุนูุฏ 0xFFFFFFF0). </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุดุบูู BIOS ูุจุงุดุฑุฉ ุ ูุจุฏุฃ ุงูุงุฎุชุจุงุฑ ุงูุฐุงุชู ูุจุฏุก ุงูุชุดุบูู (POST) - ุงูุงุฎุชุจุงุฑ ุงูุฐุงุชู ุจุนุฏ ุงูุชุดุบูู.  ูููู ูุธุงู BIOS ุจุงูุชุญูู ูู ุตุญุฉ ุงูุฐุงูุฑุฉ ุ ูุงููุดู ุนู ุงูุฃุฌูุฒุฉ ุงููุชุตูุฉ ูุชููุฆุชูุง ุ ูุงูุชุญูู ูู ุงูุณุฌูุงุช ุ ูุชุญุฏูุฏ ุญุฌู ุงูุฐุงูุฑุฉ ุ ููุง ุฅูู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชุญุฏูุฏ ูุฑุต ุงูุชูููุฏ ุงูุฐู ููููู ููู ุชุดุบูู ูุธุงู ุงูุชุดุบูู.  ูุฑุต ุงูุชูููุฏ ูู ูุฑุต (ุฃู ุฃู ูุญุฑู ุฃูุฑุงุต ุขุฎุฑ) ูุญุชูู ุนูู ุขุฎุฑ 2 ุจุงูุช ูู ุงููุทุงุน ุงูุฃูู (ุงููุทุงุน ุงูุฃูู ูุนูู ุฃูู 512 ุจุงูุช ูู ูุญุฑู ุงูุฃูุฑุงุต ุ ูุฃู ูุทุงุน ูุงุญุฏ = 512 ุจุงูุช) ูู 55 ู AA (ุจุชูุณูู ุณุฏุงุณู ุนุดุฑู).  ุจูุฌุฑุฏ ุงูุนุซูุฑ ุนูู ูุฑุต ุชูููุฏ ุ ุณูููู BIOS ุจุชุญููู ุฃูู 512 ุจุงูุช ูู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุนูู ุงูุนููุงู 0x7c00 ูููู ุงูุชุญูู ุฅูู ุงููุนุงูุฌ ุนูู ูุฐุง ุงูุนููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ูู ูุฐู 512 ุจุงูุช ูู ุชุนูู ูุชูุงุณุจ ูุธุงู ุงูุชุดุบูู ูุงูู.  ูุฐูู ุ ุนุงุฏุฉู ูุง ูุชู ูู ูุฐุง ุงููุทุงุน ูุถุน ุงูููุญูู ุงูุฃุณุงุณู ุ ุงูุฐู ูููู ุจุชุญููู ุฑูุฒ ูุธุงู ุงูุชุดุบูู ุงูุฑุฆูุณู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููููู ุงูุชุญูู ููู. </p><br><p style=";text-align:right;direction:rtl">  ููุฐ ุงูุจุฏุงูุฉ ุ ูุงู ุงููุนุงูุฌ ูุนูู ูู ุงููุถุน ุงูุญูููู (= ูุถุน 16 ุจุช).  ูุฐุง ูุนูู ุฃูู ูุง ููููู ุงูุนูู ุฅูุง ูุน ุงูุจูุงูุงุช ุฐุงุช 16 ุจุช ููุณุชุฎุฏู ุนูููุฉ ุงูุฐุงูุฑุฉ ุงูููุณูุฉ ุ ูููููู ููุท ูุนุงูุฌุฉ 1 ููุบุงุจุงูุช ูู ุงูุฐุงูุฑุฉ.  ููููุง ูู ูุณุชุฎุฏู ุงูุซุงููุฉ ููุง.  ุชูุถุญ ุงูุตูุฑุฉ ุฃุฏูุงู ุญุงูุฉ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู (RAM) ุนูุฏ ููู ุงูุชุญูู ุฅูู ุงูุฑูุฒ ุงูุฎุงุต ุจูุง (ูุชู ุงูุชูุงุท ุงูุตูุฑุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุง</a> ). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qs/xb/jr/qsxbjr6em-78cr7d6xj7_nh86bg.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ุขุฎุฑ ูุง ุฃูููู ูุจู ุงูุฌุฒุก ุงูุนููู ูู ุงูุงููุทุงุนุงุช.  ุงูููุงุทุนุฉ ูู ุฅุดุงุฑุฉ ุฎุงุตุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฌูุงุฒ ุฅุฏุฎุงู ุ ูุซู ููุญุฉ ุงูููุงุชูุญ ุฃู ุงููุงูุณ) ุฅูู ูุนุงูุฌ ูููู ุฅูู ูู ุงูุถุฑูุฑู ููุงุทุนุฉ ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุญุงููุฉ ุนูู ุงูููุฑ ูุชูููุฐ ุฑูุฒ ูุนุงูุฌ ุงูููุงุทุนุฉ.  ุชูุฌุฏ ุฌููุน ุนูุงููู ูุนุงูุฌุงุช ุงูููุงุทุนุฉ ูู ุฌุฏูู ูุงุตู ุงูููุงุทุนุฉ (IDT) ูู ุงูุฐุงูุฑุฉ ุงูุฑุฆูุณูุฉ.  ูู ููุงุทุนุฉ ููุง ูุนุงูุฌ ุงูููุงุทุนุฉ ุงูุฎุงุตุฉ ุจูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ุงูุถุบุท ุนูู ููุชุงุญ ููุญุฉ ุงูููุงุชูุญ ุ ูุชู ุงุณุชุฏุนุงุก ุงูููุงุทุนุฉ ุ ููุชููู ุงููุนุงูุฌ ุ ููุชุฐูุฑ ุนููุงู ุงูุชุนูููุฉ ุงูุชู ุชูุช ููุงุทุนุชูุง ุ ููุญูุธ ุฌููุน ููู ุณุฌูุงุชู (ูู ุงูุญุฒูุฉ) ุ ููุณุชูุฑ ูู ุชูููุฐ ูุนุงูุฌ ุงูููุงุทุนุฉ.  ุจูุฌุฑุฏ ุงูุชูุงุก ุงูุชูููุฐ ุ ูุณุชุนูุฏ ุงููุนุงูุฌ ููู ุงูุณุฌูุงุช ููุนูุฏ ุฅูู ุงูุชุนูููุงุช ุงูุชู ุชูุช ููุงุทุนุชูุง ููุณุชูุฑ ูู ุงูุชูููุฐ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฃุฌู ุนุฑุถ ุดูุก ูุง ุนูู ุงูุดุงุดุฉ ุ ูุณุชุฎุฏู BIOS ุงูููุงุทุนุฉ 0x10 (ุงูุชูุณูู ุงูุณุฏุงุณู ุงูุนุดุฑู) ุ ูุงูููุงุทุนุฉ 0x16 ูุงูุชุธุงุฑ ุงูุถุบุท ุนูู ุงูููุชุงุญ.  ูู ุงููุงูุน ุ ูู ูุฐู ุงูููุงุทุนุงุช ุงูุชู ุณูุญุชุงุฌูุง ููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุถูุง ุ ููู ููุงุทุนุฉ ูุธููุชูุง ุงููุฑุนูุฉ ุงูุชู ุชุญุฏุฏ ุฎุตูุตูุฉ ุณููููุง.  ูุนุฑุถ ุดูุก ูุง ูู ุชูุณูู ุงููุต (!) ุ ุชุญุชุงุฌ ุฅูู ุฅุฏุฎุงู ุงููููุฉ 0x0e ูู ุณุฌู AH.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุงูููุงุทุนุงุช ููุง ุงููุนููุงุช ุงูุฎุงุตุฉ ุจูุง.  ูุฃุฎุฐ 0x10 ุงูููู ูู ah (ูุญุฏุฏ ูุธููุฉ ูุฑุนูุฉ ูุญุฏุฏุฉ) ู al (ุงูุญุฑู ุงูุฐู ุณูุชู ุทุจุงุนุชู).  ุจูุฐู ุงูุทุฑููุฉ </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">mov ah, 0x0e mov al, 'x' int 0x10</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนุฑุถ ุงูุญุฑู "ุณ".  ุชุฃุฎุฐ 0x16 ุงููููุฉ ูู ah (ุฏุงูุฉ ูุฑุนูุฉ ูุญุฏุฏุฉ) ูุชุญูู ูููุฉ ุงูููุชุงุญ ุงูุฐู ุชู ุฅุฏุฎุงูู ูู ุงูุชุณุฌูู al.  ุณูู ูุณุชุฎุฏู ุงูุฏุงูุฉ 0x0. </p><br><h2 id="prakticheskaya-chast" style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุนููู </h2><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจุฑูุฒ ุงููุณุงุนุฏ.  ุณูุญุชุงุฌ ุฅูู ูุธููุฉ ููุงุฑูุฉ ุณุทุฑูู ููุธููุฉ ุนุฑุถ ุฎุท ุนูู ุงูุดุงุดุฉ.  ุญุงููุช ูุตู ุชุดุบูู ูุฐู ุงููุธุงุฆู ูู ุงูุชุนูููุงุช ุจุดูู ูุงุถุญ ูุฏุฑ ุงูุฅููุงู. </p><br><p style=";text-align:right;direction:rtl">  str_compare.asm: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">compare_strs_si_bx: push si ;         push bx push ax comp: mov ah, [bx] ;     , cmp [si], ah ;      ah jne not_equal ;    ,     cmp byte [si], 0 ;    ,    je first_zero ;    inc si ;     bx  si inc bx jmp comp ;   first_zero: cmp byte [bx], 0 ;    bx != 0,  ,   jne not_equal ;  ,    not_equal mov cx, 1 ;     ,  cx = 1 pop si ;     pop bx pop ax ret ;     not_equal: mov cx, 0 ;  ,  cx = 0 pop si ;    pop bx pop ax ret ;    </code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูุจู ุงูุฏุงูุฉ ุณุฌูุงุช SI ู BX ููุนููุงุช.  ุฅุฐุง ูุงูุช ุงูุฎุทูุท ูุชุณุงููุฉ ุ ูุณูุชู ุชุนููู CX ุนูู 1 ุ ูุฅูุง 0. </p><br><p style=";text-align:right;direction:rtl">  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุฃู ุงูุณุฌูุงุช AX ู BX ู CX ู DX ููุณูุฉ ุฅูู ุฌุฒุฃูู ุฃุญุงุฏู ุงูุจุงูุชุชูู: AH ู BH ู CH ู DH ููุจุงูุช ุงูุนุงููุฉ ู AL ู BL ู CL ู DL ููุจุงูุชุงุช ุงูููุฎูุถุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ูู ุงูููุชุฑุถ ุฃู ูู bx ู si ููุงู ูุคุดุฑุงุช (!) (ุฃู ุ ูุฎุฒู ุงูุนููุงู ูู ุงูุฐุงูุฑุฉ) ุฅูู ุจุนุถ ุงูุนูุงููู ูู ุงูุฐุงูุฑุฉ ุงูุชู ุชูุฌุฏ ูููุง ุจุฏุงูุฉ ุงูุณุทุฑ.  ุณุชุฃุฎุฐ ุงูุนูููุฉ [bx] ูุคุดุฑูุง ูู bx ุ ูุณุชูุชูู ุฅูู ูุฐุง ุงูุนููุงู ูุณุชุฃุฎุฐ ุจุนุถ ุงููููุฉ ูู ููุงู.  ูุนูู inc bx ุฃู ุงููุคุดุฑ ุงูุขู ุณูู ูุดูุฑ ุฅูู ุงูุนููุงู ูุจุงุดุฑุฉ ุจุนุฏ ุงูุนููุงู ุงูุฃุตูู. </p><br><p style=";text-align:right;direction:rtl">  print_string.asm: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">print_string_si: push ax ;  ax   mov ah, 0x0e ;  ah  0x0e,    call print_next_char ;  pop ax ;  ax ret ;   print_next_char: mov al, [si] ;    cmp al, 0 ;  si  jz if_zero ;     int 0x10 ;     al inc si ;    jmp print_next_char ;   ... if_zero: ret</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุนููุฉ ุ ุชุฃุฎุฐ ุงูุฏุงูุฉ ุชุณุฌูู SI ูุชุทุจุน ุงูุจุงูุช ุจุงูุช ุณูุณูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนูุง ููุชูู ุฅูู ุงูุฑูุฒ ุงูุฑุฆูุณู.  ุฃููุงู ุ ุฏุนููุง ูุญุฏุฏ ุฌููุน ุงููุชุบูุฑุงุช (ุณูููู ูุฐุง ุงูุฑูุฒ ูู ููุงูุฉ ุงูููู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">; 0x0d -   , 0xa -    wrong_command: db "Wrong command!", 0x0d, 0xa, 0 greetings: db "The OS is on. Type 'help' for commands", 0x0d, 0xa, 0xa, 0 help_desc: db "Here's nothing to show yet. But soon...", 0x0d, 0xa, 0 goodbye: db 0x0d, 0xa, "Goodbye!", 0x0d, 0xa, 0 prompt: db "&gt;", 0 new_line: db 0x0d, 0xa, 0 help_command: db "help", 0 input: times 64 db 0 ;   - 64  times 510 - ($-$$) db 0 dw 0xaa55</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ุญุฑู ุงูุฅุฑุฌุงุน ุญุฑู ุงูููู ุฅูู ุงูุญุงูุฉ ุงููุณุฑู ูู ุงูุดุงุดุฉ ุ ุฃู ุฅูู ุจุฏุงูุฉ ุงูุณุทุฑ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">input: times 64 db 0</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนูู ุฃููุง ูุฎุตุต 64 ุจุงูุช ุชุญุช ุงููุฎุฒู ุงููุคูุช ููุฅุฏุฎุงู ููููุฃูุง ุจุงูุฃุตูุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุญุงุฌุฉ ูุจููุฉ ุงููุชุบูุฑุงุช ูุนุฑุถ ุจุนุถ ุงููุนูููุงุช ุ ูููู ุงูููุฏ ุงูุฐู ุณุชูููู ุฌููุนูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">times 510 - ($-$$) db 0 dw 0xaa55</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนูู ุฃููุง ุญุฏุฏูุง ุญุฌู ููู ุงูุฅุฎุฑุงุฌ (ูุน ุงูุงูุชุฏุงุฏ .bin) ุจุดูู ุตุฑูุญ ุฅูู 512 ุจุงูุช ุ ูููุก ุฃูู 510 ุจุงูุช ุจุงูุฃุตูุงุฑ (ูุจุทุจูุนุฉ ุงูุญุงู ุ ุชูุชูุฆ ูุจู ุชูููุฐ ุงูุดูุฑุฉ ุจุฃููููุง) ุ ูุงุซููู ูู ุงูุจุงูุชุงุช ุงูุฃุฎูุฑุชูู ุจููุณ ุงูุจุงูุช "ุงูุณุญุฑู" 55 ู AA .  $ ุชุนูู ุนููุงู ุงูุชุนูููุฉ ุงูุญุงููุฉ ุ ู $ ูู ุนููุงู ุงูุชุนูููุฉ ุงูุฃููู ูู ุงูููุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ููุชูู ุฅูู ุงูุฑูุฒ ุงููุนูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">org 0x7c00 ; (1) bits 16 ; (2) jmp start ;    start %include "print_string.asm" ;     %include "str_compare.asm" ; ==================================================== start: mov ah, 0x00 ;   (3) mov al, 0x03 int 0x10 mov sp, 0x7c00 ;   (4) mov si, greetings ;    call print_string_si ;      mainloop</code> </pre> <br><p style=";text-align:right;direction:rtl">  (1).  ููุถุญ ูุฐุง ุงูุฃูุฑ ูู NASM ุฃููุง ูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุฏุกูุง ูู 0x7c00.  ูุฐุง ูุณูุญ ููุง ุจุงูุชุญูุฒ ุงูุชููุงุฆู ูุฌููุน ุงูุนูุงููู ุงููุชุนููุฉ ุจูุฐุง ุงูุนููุงู ุญุชู ูุง ูููู ุจุฐูู ุตุฑุงุญุฉ. <br>  (2).  ูุฑุดุฏ ูุฐุง ุงูุฃูุฑ NASM ุจุฃููุง ูุนูู ูู ูุถุน 16 ุจุช. <br>  (3).  ุนูุฏ ุฅุทูุงููุง ุ ุชููู QEMU ุจุทุจุงุนุฉ ุงููุซูุฑ ูู ุงููุนูููุงุช ุงูุชู ูุง ูุญุชุงุฌ ุฅูููุง.  ููููุงู ุจุฐูู ุ ูู ุจุชุนููู ah 0x00 ุ ุนูู al 0x03 ูุงุชุตู ุจุงูุฑูู 0x10 ููุณุญ ุดุงุดุฉ ูู ุดูุก. <br>  (4).  ูุญูุธ ุงูุณุฌูุงุช ุนูู ุงูููุฏุณ ุ ูุฌุจ ุนููู ุชุญุฏูุฏ ุงูุนููุงู ุงูุฐู ุณูุชู ุชุญุฏูุฏ ูููุน ุฑุฃุณู ุจุงุณุชุฎุฏุงู ูุคุดุฑ ููุฏุณ SP.  ุณูู ูุดูุฑ SP ุฅูู ุงููุณุงุญุฉ ูู ุงูุฐุงูุฑุฉ ุงูุชู ุณูุชู ูููุง ูุชุงุจุฉ ุงููููุฉ ุงูุชุงููุฉ.  ุฃุถู ุงููููุฉ ุฅูู ุงูููุฏุณ - ุชูุฎูุถ SP ุงูุฐุงูุฑุฉ ุจููุฏุงุฑ 2 ุจุงูุช (ูุธุฑูุง ูุฃููุง ูู ุงููุถุน ุงููุนูู ุ ุญูุซ ุชููู ุฌููุน ูุนุงููุงุช ุงูุชุณุฌูู 16 ุจุช ุ ุฃู ุจุงูุช ูุฒุฏูุฌ ุ).  ุญุฏุฏูุง 0x7c00 ุ ูุจุงูุชุงูู ุณูุชู ุชุฎุฒูู ุงูููู ุงูููุฌูุฏุฉ ูู ุงููุฌููุนุฉ ุจุฌูุงุฑ ุฑูุฒูุง ูู ุงูุฐุงูุฑุฉ.  ูุฑุฉ ุฃุฎุฑู - ุงูููุฏุณ ูููู (!).  ูุฐุง ูุนูู ุฃูู ูููุง ุฒุงุฏุช ุงูููู ุงูููุฌูุฏุฉ ุนูู ุงูููุฏุณ ุ ูู ูุคุดุฑ ุงูุฐุงูุฑุฉ ูู ููุฏุณ SP. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">mainloop: mov si, prompt ;   call print_string_si call get_input ;     jmp mainloop ;  mainloop...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุญููุฉ ุงูุฑุฆูุณูุฉ.  ููุง ุ ูุน ูู ุชูุฑุงุฑ ุ ูุทุจุน ุงูุญุฑู "&gt;" ุ ูุจุนุฏ ุฐูู ูุณูููุง ุงูุฏุงูุฉ get_input ุ ูุงูุชู ุชููุฐ ุงูุนูู ูุน ููุงุทุนุฉ ููุญุฉ ุงูููุงุชูุญ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">get_input: mov bx, 0 ;  bx      input_processing: mov ah, 0x0 ;    0x16 int 0x16 ;  ASCII  cmp al, 0x0d ;   enter je check_the_input ;   ,   ,  ;    cmp al, 0x8 ;   backspace je backspace_pressed cmp al, 0x3 ;   ctrl+c je stop_cpu mov ah, 0x0e ;     -   ;     int 0x10 mov [input+bx], al ;       inc bx ;   cmp bx, 64 ;  input  je check_the_input ;    ,    enter jmp input_processing ;   </code> </pre> <br><p style=";text-align:right;direction:rtl">  (1) ูุนูู [input + bx] ุฃููุง ูุฃุฎุฐ ุนููุงู ุจุฏุงูุฉ ุฅุฏุฎุงู ูุฎุฒู ุงูุฅุฏุฎุงู ุงููุคูุช ููุถููู ุฅูู bx ุ ุฃู ุฃููุง ูุตู ุฅูู bx + ุงูุนูุตุฑ ุงูุฃูู ูู ุงููุฎุฒู ุงููุคูุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">stop_cpu: mov si, goodbye ;   call print_string_si jmp $ ;    ; $    </code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ุจุณูุท ููุง - ุฅุฐุง ุถุบุทุช ุนูู Ctrl + C ุ ูุฅู ุงูููุจููุชุฑ ูุคุฏู ูุธููุฉ jmp $ ุฅูู ูุง ูุง ููุงูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">backspace_pressed: cmp bx, 0 ;  backspace ,  input ,  je input_processing ;    mov ah, 0x0e ;  backspace.  ,   int 0x10 ;   ,      mov al, ' ' ;      ,  int 0x10 ;   mov al, 0x8 ;       int 0x10 ;     backspace dec bx mov byte [input+bx], 0 ;    input   jmp input_processing ;   </code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุชู ูุง ุชูุญู ุงูุญุฑู "&gt;" ุนูุฏ ุงูุถุบุท ุนูู ูุณุงูุฉ ููุฎูู ุ ูุชุญูู ููุง ุฅุฐุง ูุงู ุงูุฅุฏุฎุงู ูุงุฑุบูุง.  ุฅุฐุง ูู ููู ูุฐูู ุ ููุง ุชูุนู ุดูุฆูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">check_the_input: inc bx mov byte [input+bx], 0 ;     ,   ;  (  '\0'  ) mov si, new_line ;     call print_string_si mov si, help_command ;  si     help mov bx, input ;   bx -   call compare_strs_si_bx ;  si  bx (  help) cmp cx, 1 ; compare_strs_si_bx   cx 1,  ;     je equal_help ;  =&gt;    ;  help jmp equal_to_nothing ;   ,   "Wrong command!"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุ ุฃุนุชูุฏ ุฃู ูู ุดูุก ูุงุถุญ ูู ุงูุชุนูููุงุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">equal_help: mov si, help_desc call print_string_si jmp done equal_to_nothing: mov si, wrong_command call print_string_si jmp done</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจูุงุกู ุนูู ูุง ุชู ุฅุฏุฎุงูู ุ ูุนุฑุถ ุฅูุง ูุต ุงููุชุบูุฑ help_desc ุฃู ูุต ุงููุชุบูุฑ wrong_command. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">; done    input done: cmp bx, 0 ;     input   je exit ;   ,    mainloop dec bx ;  ,      mov byte [input+bx], 0 jmp done ;       exit: ret</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ุงูููุฏ ููู ูู: </p><br><p style=";text-align:right;direction:rtl">  ุงูููุฑู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">org 0x7c00 bits 16 jmp start ;    start %include "print_string.asm" %include "str_compare.asm" ; ==================================================== start: cli ;  ,    ;     mov ah, 0x00 ;   mov al, 0x03 int 0x10 mov sp, 0x7c00 ;   mov si, greetings ;    call print_string_si ;      mainloop mainloop: mov si, prompt ;   call print_string_si call get_input ;     jmp mainloop ;  mainloop... get_input: mov bx, 0 ;  bx      input_processing: mov ah, 0x0 ;    0x16 int 0x16 ;  ASCII  cmp al, 0x0d ;   enter je check_the_input ;   ,   ,  ;    cmp al, 0x8 ;   backspace je backspace_pressed cmp al, 0x3 ;   ctrl+c je stop_cpu mov ah, 0x0e ;     -   ;     int 0x10 mov [input+bx], al ;       inc bx ;   cmp bx, 64 ;  input  je check_the_input ;    ,    enter jmp input_processing ;    stop_cpu: mov si, goodbye ;   call print_string_si jmp $ ;    ; $     backspace_pressed: cmp bx, 0 ;  backspace ,  input ,  je input_processing ;    mov ah, 0x0e ;  backspace.  ,   int 0x10 ;   ,      mov al, ' ' ;      ,  int 0x10 ;   mov al, 0x8 ;       int 0x10 ;     backspace dec bx mov byte [input+bx], 0 ;    input   jmp input_processing ;    check_the_input: inc bx mov byte [input+bx], 0 ;     ,   ;  (  '\0'  ) mov si, new_line ;     call print_string_si mov si, help_command ;  si     help mov bx, input ;   bx -   call compare_strs_si_bx ;  si  bx (  help) cmp cx, 1 ; compare_strs_si_bx   cx 1,  ;     je equal_help ;  =&gt;    ;  help jmp equal_to_nothing ;   ,   "Wrong command!" equal_help: mov si, help_desc call print_string_si jmp done equal_to_nothing: mov si, wrong_command call print_string_si jmp done ; done    input done: cmp bx, 0 ;     input   je exit ;   ,    mainloop dec bx ;  ,      mov byte [input+bx], 0 jmp done ;       exit: ret ; 0x0d -   , 0xa -    wrong_command: db "Wrong command!", 0x0d, 0xa, 0 greetings: db "The OS is on. Type 'help' for commands", 0x0d, 0xa, 0xa, 0 help_desc: db "Here's nothing to show yet. But soon...", 0x0d, 0xa, 0 goodbye: db 0x0d, 0xa, "Goodbye!", 0x0d, 0xa, 0 prompt: db "&gt;", 0 new_line: db 0x0d, 0xa, 0 help_command: db "help", 0 input: times 64 db 0 ;   - 64  times 510 - ($-$$) db 0 dw 0xaa55</code> </pre><br><p style=";text-align:right;direction:rtl">  ูุชุฌููุน ูู ูุฐุง ุ ุฃุฏุฎู ุงูุฃูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">nasm -f bin prompt.asm -o bootloader.bin</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุญู ูุญุตู ุนูู ุซูุงุฆู ูุน ุฑูุฒ ูุฏููุง ูู ุงูุฅุฎุฑุงุฌ.  ุงูุขู ูู ุจุชุดุบูู ูุญุงูู QEMU ุจุงุณุชุฎุฏุงู ูุฐุง ุงูููู (- ูุณูุญ ูู stdio -monitor ุจุนุฑุถ ูููุฉ ุงูุชุณุฌูู ูู ุฃู ููุช ุจุงุณุชุฎุฏุงู ุฃูุฑ print $ reg): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">qemu-system-i386 bootloader.bin -monitor stdio</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุญู ูุญุตู ุนูู ุงูุฅุฎุฑุงุฌ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fq/h2/_7/fqh2_7m_r8mnne4pfo7x4sqvc4k.png" alt="ุงูุตูุฑุฉ"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar442428/">https://habr.com/ru/post/ar442428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar442406/index.html">Fintech ูุถู: ุงูุชุญูููุงุช ุงููุฌุงููุฉ ูู ูุธุงู SBP ุ ุชุนุฑุถ ุงูุจููู ูููุฌูุงุช ูุบูุฑูุง ูู ุงูุฃุฎุจุงุฑ</a></li>
<li><a href="../ar442408/index.html">ุงูุฌูุงุฒ ุงูุนุงููู ูุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช DIY ุ ุงูุฌุฒุก 1</a></li>
<li><a href="../ar442414/index.html">ุงูุฏุฑุงุณุฉ ูู ุฌุงูุนุฉ ุฃุฌูุจูุฉ ูู ุฃูู ุดุฎุต</a></li>
<li><a href="../ar442416/index.html">ููุฎุต ุจุญุซ ูุชุทููุฑ ุฌุงูุนุฉ ITMO: ููุงูุดุฉ ุงูุงุชุฌุงูุงุช ูุงูุฅูุฌุงุฒุงุช ุงูุฌุฏูุฏุฉ ููุนููุงุก</a></li>
<li><a href="../ar442422/index.html">ูุงู Enthusiast ุจุฅุนุงุฏุฉ ุฅูุดุงุก ุจุทุงูุฉ ุงูุตูุช Sound Blaster 1.0 - ุฃุฎุจุฑูุง ุจูุฏู ุฑูุนุฉ ุงููุดุฑูุน</a></li>
<li><a href="../ar442430/index.html">ููุฎุต ุงูููุงุฏ ุงููุซูุฑุฉ ููุงูุชูุงู ููุทูุฑ ุงููุงุชู ุงููุญููู ุฑูู 288 (24 ูุจุฑุงูุฑ - 3 ูุงุฑุณ)</a></li>
<li><a href="../ar442432/index.html">[ุจูุงุณุทุฉ ุงูุงุญูุงุถ] ุงูุฑูุฑูุฉ. ุงูุฌุฒุก 1. ููุทูุฑู ุฃูุฏุฑููุฏ</a></li>
<li><a href="../ar442434/index.html">7 ุชูุตูุงุช ูุชุญููู ุฃูุถู 70 ูุนููุฉ ูููู ุงูููุงูุน ูู ุนุงู 2019 ูู ูุงูุฏูุณ</a></li>
<li><a href="../ar442440/index.html">ุฅูุดุงุก ุชุทุจูู Android ุจุงุณุชุฎุฏุงู Anko Layouts ู Anko Coroutines</a></li>
<li><a href="../ar442442/index.html">ูููุฏุณ ูุจูุฑ ูู ุงูุจุญุซ ุนู ุนูู. ุญูู ุงูููุงู ูู ุงูููุงุจูุงุช ุงููููุฉ ูุงูุฃุณุฆูุฉ ุงููุธุฑูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>