<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèπ üë®üèæ‚Äçü§ù‚Äçüë®üèº üåá √âcrire une application Android dans l'assembleur üëèüèæ üë®üèº‚Äç‚öïÔ∏è üîØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette histoire concerne une approche non standard du d√©veloppement d'applications Android. C'est une chose d'installer Android Studio et d'√©crire "Hel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âcrire une application Android dans l'assembleur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/441798/"><img src="https://habrastorage.org/getpro/habr/post_images/6c7/141/a4b/6c7141a4b2db319c5f4dcbd6f432bc81.jpg" alt="image"><br><br>  Cette histoire concerne une approche non standard du d√©veloppement d'applications Android.  C'est une chose d'installer Android Studio et d'√©crire "Hello, World" en Java ou Kotlin.  Mais je vais montrer comment la m√™me t√¢che peut √™tre ex√©cut√©e diff√©remment. <br><a name="habracut"></a><br><blockquote>  <b>Nous vous rappelons:</b> <i>pour tous les lecteurs de ¬´Habr¬ª - une remise de 10 000 roubles lors de l'inscription √† un cours Skillbox en utilisant le code promo ¬´Habr¬ª.</i> <br><br>  <b>Skillbox recommande:</b> Le cours √©ducatif en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Profession Java-developer"</a> . <br><br></blockquote><h3>  Comment fonctionne mon smartphone avec Android OS? </h3><br>  Tout d'abord, un peu d'histoire.  Un soir, un ami appel√© Ariella m'a appel√©.  Elle m'a demand√©: ¬´√âcoutez, comment fonctionne mon smartphone?  Qu'y a-t-il √† l'int√©rieur?  Comment l'√©nergie √©lectrique et les unit√©s et z√©ros ordinaires font-ils fonctionner tout cela? ¬ª <br><br>  Mon amie n'est pas une noob en d√©veloppement, elle a cr√©√© plusieurs projets sur Arduino, qui comprenaient √† la fois des logiciels et du mat√©riel.  C'est peut-√™tre pour √ßa qu'elle voulait en savoir plus.  J'ai r√©ussi √† r√©pondre gr√¢ce aux connaissances acquises dans l'un des cours d'informatique suivis √† l'universit√©. <br><br>  Ensuite, nous avons travaill√© quelques semaines ensemble, car Ariella voulait savoir comment fonctionnent les briques de la technologie √©lectronique, c'est-√†-dire les √©l√©ments semi-conducteurs, y compris les transistors.  Ensuite, nous sommes all√©s √† un niveau sup√©rieur: je lui ai montr√© comment cr√©er des portes logiques, par exemple, NAND (ET logique) plus NOR (OU logique) en utilisant une combinaison sp√©cifique de transistors. <br><br>  Nous avons √©tudi√© des √©l√©ments logiques de diff√©rents types, les avons combin√©s pour effectuer des calculs (par exemple, en ajoutant deux nombres binaires) et des cellules de m√©moire (d√©clencheurs).  Lorsque tout est devenu clair, ils ont commenc√© √† d√©velopper un processeur simple (imaginaire), dans lequel il y avait deux registres √† usage g√©n√©ral et deux instructions simples (en ajoutant ces registres).  Nous avons m√™me √©crit un programme simple qui multiplie ces deux nombres. <br><br>  Soit dit en passant, si vous √™tes int√©ress√© par cette rubrique, lisez les instructions pour cr√©er un ordinateur 8 bits √† partir de z√©ro.  Cela explique presque tout, depuis les bases.  J'aurais aim√© le lire plus t√¥t! <br><br><h3>  Bonjour Android! </h3><br>  Apr√®s avoir termin√© toutes les √©tapes de l'√©tude, il me semblait qu'Ariella avait suffisamment de connaissances pour comprendre le fonctionnement du processeur du smartphone.  Son smartphone est le Galaxy S6 Edge, dont la base est l'architecture ARM (comme, en fait, avec la plupart des smartphones).  Nous avons d√©cid√© d'√©crire une application ¬´Hello, World¬ª pour Android, mais en langage assembleur. <br><br><pre><code class="plaintext hljs">.text .globl _start _start: mov %r0, $1 // file descriptor number 1 (stdout) ldr %r1, =message mov %r2, $message_len mov %r7, $4 // syscall 4 (write) swi $0 mov %r0, $0 // exit status 0 (ok) mov %r7, $1 // syscall 1 (exit) swi $0 .data message: .ascii "Hello, World\n" message_len = . - message</code> </pre> <br>  Si vous n'avez jamais rencontr√© de code assembleur auparavant, ce bloc peut vous faire peur.  Mais √ßa va, analysons le code ensemble. <br><br>  Donc, notre programme se compose de deux parties.  Le premier est un texte avec des instructions de code machine, et le second est des variables, des lignes et d'autres informations (en commen√ßant par la ligne 15).  La section .text est g√©n√©ralement en lecture seule et .data est √©galement accessible en √©criture. <br><br>  √Ä la ligne 2, nous d√©finissons une fonction globale appel√©e _start.  C'est le point d'entr√©e de l'application.  Le syst√®me d'exploitation commence √† ex√©cuter le code √† partir de ce point.  La d√©finition de la fonction est d√©clar√©e √† la ligne 4. <br><br>  De plus, la fonction fait deux autres choses.  Aux lignes 5 √† 9, le message s'affiche √† l'√©cran; aux lignes 11 √† 13, le programme se termine.  M√™me si vous supprimez les lignes 11 √† 13, le programme affichera notre ligne ¬´Hello, World¬ª et quittera.  Cependant, la sortie ne sera pas correcte, car le programme se terminera par une erreur.  Sans les lignes 11 √† 13, l'application essaiera d'ex√©cuter une instruction non valide. <br><br>  L'impression est affich√©e √† l'aide de la fonction syst√®me "Appel syst√®me" du syst√®me d'exploitation.  Dans l'application, nous appelons la fonction write ().  Nous l'indiquons lorsque nous chargeons la valeur 4 dans le registre du processeur avec le nom r7 (ligne 8).  Ensuite, l'instruction swi $ = 0 (ligne 9) est ex√©cut√©e, o√π il y a une transition directe vers le noyau Linux, qui est la base d'Android. <br><br>  Quant aux param√®tres de l'appel syst√®me, ils sont transmis via d'autres registres.  Par exemple, r0 indique le num√©ro du descripteur de fichier que nous devons imprimer.  Nous y mettons la valeur 1 (ligne 5), indiquant la sortie standard (stdout), c'est-√†-dire la sortie √† l'√©cran. <br><br>  r1 indique l'adresse m√©moire des donn√©es que nous voulons √©crire, nous chargeons donc simplement l'adresse de la cha√Æne "Hello, World" (ligne 6) dans cette zone, et le registre r2 montre combien d'octets nous voulons √©crire.  Dans notre programme, il est d√©fini sur message_len (ligne 7), calcul√© sur la ligne 18 en utilisant une syntaxe sp√©ciale: le symbole de point indique l'adresse m√©moire actuelle.  Pour cette raison.  - le message indique l'adresse m√©moire actuelle moins l'adresse du message.  Eh bien, puisque nous d√©clarons message_len imm√©diatement apr√®s le message, tout cela est calcul√© comme la longueur du message. <br><br>  Si vous √©crivez le code des lignes 5 √† 9 √† l'aide de C, vous obtenez les informations suivantes: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> message "Hello, World\n" write(1, message, strlen(message));</span></span></code> </pre> <br>  Arr√™ter le programme est un peu plus facile.  Pour ce faire, nous enregistrons simplement le code de sortie dans le registre r0 (ligne 11), apr√®s quoi nous ajoutons la valeur 1, qui est le num√©ro de l'appel de fonction syst√®me exit (), √† r7 (ligne 12), puis appelons √† nouveau le noyau (ligne 13). <br><br>  Une liste compl√®te des appels syst√®me Android et de leurs num√©ros se trouve dans le <a href="">code</a> source <a href="">du syst√®me d'exploitation</a> .  Il existe √©galement une impl√©mentation de <a href="">write ()</a> et <a href="">exit ()</a> qui appellent les fonctions syst√®me correspondantes. <br><br><h3>  Assembler le programme </h3><br>  Afin de compiler notre projet, vous aurez besoin d'Android NDK (Native Development Kit).  Il contient un ensemble de compilateurs et d'outils de construction pour la plate-forme ARM.  Vous pouvez le t√©l√©charger sur le site officiel, l'installer, par exemple, via Android Studio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b0f/ad0/963/b0fad09631cb9904cc9288563b294db1.png"><br><br>  Une fois le NDK install√©, nous avons besoin du fichier arm-linux-androideabi-as, c'est l'assembleur pour ARM.  Si vous avez t√©l√©charg√© via Android Studio, recherchez-le dans le dossier Android SDK.  Son emplacement est g√©n√©ralement <br><br>  <i>ndk-bundle \ toolchains \ arm-linux-androideabi-4.9 \ prebuilt \ windows-x86_64 \ bin.</i> <br><br>  Une fois l'assembleur trouv√©, enregistrez ce qui est √©crit dans un fichier appel√© hello.s, puis ex√©cutez la commande suivante pour le convertir en code machine: <br><br>  <i>arm-linux-androideabi-as -o hello.o hello.s</i> <br><br>  Cette op√©ration cr√©e un fichier objet ELF appel√© hello.o.  Afin de le convertir en un fichier binaire qui peut fonctionner sur votre appareil, appelez l'√©diteur de liens: <br><br>  <i>arm-linux-androideabi-ld -o bonjour bonjour.o</i> <br><br>  Nous avons maintenant un fichier bonjour qui contient un programme pr√™t √† l'emploi. <br><br><h3>  Lancez l'application sur votre appareil </h3><br>  Les applications Android sont g√©n√©ralement distribu√©es au format .apk.  Il s'agit d'un type sp√©cial de fichier compress√© qui inclut des classes Java (oui, vous pouvez √©crire en C / C ++, mais Java doit √™tre le point d'entr√©e). <br><br>  Afin d'√©viter les probl√®mes lors du d√©marrage de l'application, adb a √©t√© utilis√© dans l'exemple, ce qui nous a permis de le copier dans le dossier temporaire de notre appareil Android.  Apr√®s cela, nous lan√ßons le shell adb afin de lancer l'application et d'√©valuer le r√©sultat: <br><br>  <i>adb push bonjour / data / local / tmp / bonjour</i> <i><br></i>  <i>adb shell chmod + x / data / local / tmp / hello</i> <br><br>  Et enfin, lancez l'application: <br><br>  <i>shell adb / data / local / tmp / bonjour</i> <br><br><h3>  Qu'√©crivez-vous? </h3><br>  Vous avez maintenant un environnement de travail similaire √† celui qu'Ariella avait.  Elle a pass√© plusieurs jours √† √©tudier l'assembleur ARM, puis a propos√© un projet simple - c'est le jeu Sven Boom (une variation de Fizz Buzz originaire d'Isra√´l).  Les joueurs comptent √† leur tour et chaque fois que le nombre est divis√© par 7 ou contient le nombre 7, ils doivent dire ¬´boom¬ª (d'o√π le nom du jeu). <br><br>  Il convient de noter que le programme de jeu n'est pas une t√¢che aussi facile.  Ariella a √©crit toute une m√©thode qui affiche les chiffres, un chiffre √† la fois.  Puisqu'elle a tout √©crit en assembleur sans appeler les fonctions standard de la biblioth√®que C, cela a pris plusieurs jours √† r√©soudre. <br><br>  Le premier programme Ariella pour Adnroid est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Soit dit en passant, certains identificateurs de code dans l'application sont en fait des mots h√©breux (par exemple, _sifra_ahrona). <br><br>  L'√©criture d'une application Android dans l'assembleur est un bon moyen de mieux conna√Ætre l'architecture ARM et de mieux comprendre la cuisine int√©rieure du gadget que vous utilisez quotidiennement.  Je vous sugg√®re de faire cela de pr√®s et d'essayer de cr√©er une petite application d'assemblage pour votre appareil.  Ce pourrait √™tre un jeu simple ou autre chose. <br><br><blockquote>  <b>Skillbox recommande:</b> <br><br><ul><li>  Cours pratique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Mobile Developer PRO"</a> . </li><li>  Cours en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"D√©veloppeur C # √† partir de z√©ro</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li><li>  Cours pratique de deux ans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Je suis un d√©veloppeur web PRO</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441798/">https://habr.com/ru/post/fr441798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441784/index.html">Le point de vue d'un biologiste sur la th√©orie mutationnelle du vieillissement</a></li>
<li><a href="../fr441788/index.html">Fonctionnement du syst√®me de vid√©osurveillance Ivideon: aper√ßu du compte personnel de l'utilisateur</a></li>
<li><a href="../fr441790/index.html">Cr√©ation de composants efficace avec syst√®me stylis√©</a></li>
<li><a href="../fr441794/index.html">10 choses sur le r√©f√©rencement technique que chaque propri√©taire de site WordPress doit savoir</a></li>
<li><a href="../fr441796/index.html">Trois points de croissance de conversion, ou comment augmenter la s√©curit√© et augmenter les ventes sur le site</a></li>
<li><a href="../fr441800/index.html">Conversations sur C ++: WP 21, Boost, Conf√©rences</a></li>
<li><a href="../fr441802/index.html">Cadre juridique de la biom√©trie</a></li>
<li><a href="../fr441804/index.html">O√π enseigner la programmation aux enfants?</a></li>
<li><a href="../fr441806/index.html">VPN sans VPN ou une histoire sur l'utilisation non conventionnelle de SSH</a></li>
<li><a href="../fr441808/index.html">Nous vous invitons le 6 mars au ElixirLangMoscow Meetup # 9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>