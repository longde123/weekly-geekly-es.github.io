<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏹 👨🏾‍🤝‍👨🏼 🌇 Écrire une application Android dans l'assembleur 👏🏾 👨🏼‍⚕️ 🔯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette histoire concerne une approche non standard du développement d'applications Android. C'est une chose d'installer Android Studio et d'écrire "Hel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Écrire une application Android dans l'assembleur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/441798/"><img src="https://habrastorage.org/getpro/habr/post_images/6c7/141/a4b/6c7141a4b2db319c5f4dcbd6f432bc81.jpg" alt="image"><br><br>  Cette histoire concerne une approche non standard du développement d'applications Android.  C'est une chose d'installer Android Studio et d'écrire "Hello, World" en Java ou Kotlin.  Mais je vais montrer comment la même tâche peut être exécutée différemment. <br><a name="habracut"></a><br><blockquote>  <b>Nous vous rappelons:</b> <i>pour tous les lecteurs de «Habr» - une remise de 10 000 roubles lors de l'inscription à un cours Skillbox en utilisant le code promo «Habr».</i> <br><br>  <b>Skillbox recommande:</b> Le cours éducatif en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Profession Java-developer"</a> . <br><br></blockquote><h3>  Comment fonctionne mon smartphone avec Android OS? </h3><br>  Tout d'abord, un peu d'histoire.  Un soir, un ami appelé Ariella m'a appelé.  Elle m'a demandé: «Écoutez, comment fonctionne mon smartphone?  Qu'y a-t-il à l'intérieur?  Comment l'énergie électrique et les unités et zéros ordinaires font-ils fonctionner tout cela? » <br><br>  Mon amie n'est pas une noob en développement, elle a créé plusieurs projets sur Arduino, qui comprenaient à la fois des logiciels et du matériel.  C'est peut-être pour ça qu'elle voulait en savoir plus.  J'ai réussi à répondre grâce aux connaissances acquises dans l'un des cours d'informatique suivis à l'université. <br><br>  Ensuite, nous avons travaillé quelques semaines ensemble, car Ariella voulait savoir comment fonctionnent les briques de la technologie électronique, c'est-à-dire les éléments semi-conducteurs, y compris les transistors.  Ensuite, nous sommes allés à un niveau supérieur: je lui ai montré comment créer des portes logiques, par exemple, NAND (ET logique) plus NOR (OU logique) en utilisant une combinaison spécifique de transistors. <br><br>  Nous avons étudié des éléments logiques de différents types, les avons combinés pour effectuer des calculs (par exemple, en ajoutant deux nombres binaires) et des cellules de mémoire (déclencheurs).  Lorsque tout est devenu clair, ils ont commencé à développer un processeur simple (imaginaire), dans lequel il y avait deux registres à usage général et deux instructions simples (en ajoutant ces registres).  Nous avons même écrit un programme simple qui multiplie ces deux nombres. <br><br>  Soit dit en passant, si vous êtes intéressé par cette rubrique, lisez les instructions pour créer un ordinateur 8 bits à partir de zéro.  Cela explique presque tout, depuis les bases.  J'aurais aimé le lire plus tôt! <br><br><h3>  Bonjour Android! </h3><br>  Après avoir terminé toutes les étapes de l'étude, il me semblait qu'Ariella avait suffisamment de connaissances pour comprendre le fonctionnement du processeur du smartphone.  Son smartphone est le Galaxy S6 Edge, dont la base est l'architecture ARM (comme, en fait, avec la plupart des smartphones).  Nous avons décidé d'écrire une application «Hello, World» pour Android, mais en langage assembleur. <br><br><pre><code class="plaintext hljs">.text .globl _start _start: mov %r0, $1 // file descriptor number 1 (stdout) ldr %r1, =message mov %r2, $message_len mov %r7, $4 // syscall 4 (write) swi $0 mov %r0, $0 // exit status 0 (ok) mov %r7, $1 // syscall 1 (exit) swi $0 .data message: .ascii "Hello, World\n" message_len = . - message</code> </pre> <br>  Si vous n'avez jamais rencontré de code assembleur auparavant, ce bloc peut vous faire peur.  Mais ça va, analysons le code ensemble. <br><br>  Donc, notre programme se compose de deux parties.  Le premier est un texte avec des instructions de code machine, et le second est des variables, des lignes et d'autres informations (en commençant par la ligne 15).  La section .text est généralement en lecture seule et .data est également accessible en écriture. <br><br>  À la ligne 2, nous définissons une fonction globale appelée _start.  C'est le point d'entrée de l'application.  Le système d'exploitation commence à exécuter le code à partir de ce point.  La définition de la fonction est déclarée à la ligne 4. <br><br>  De plus, la fonction fait deux autres choses.  Aux lignes 5 à 9, le message s'affiche à l'écran; aux lignes 11 à 13, le programme se termine.  Même si vous supprimez les lignes 11 à 13, le programme affichera notre ligne «Hello, World» et quittera.  Cependant, la sortie ne sera pas correcte, car le programme se terminera par une erreur.  Sans les lignes 11 à 13, l'application essaiera d'exécuter une instruction non valide. <br><br>  L'impression est affichée à l'aide de la fonction système "Appel système" du système d'exploitation.  Dans l'application, nous appelons la fonction write ().  Nous l'indiquons lorsque nous chargeons la valeur 4 dans le registre du processeur avec le nom r7 (ligne 8).  Ensuite, l'instruction swi $ = 0 (ligne 9) est exécutée, où il y a une transition directe vers le noyau Linux, qui est la base d'Android. <br><br>  Quant aux paramètres de l'appel système, ils sont transmis via d'autres registres.  Par exemple, r0 indique le numéro du descripteur de fichier que nous devons imprimer.  Nous y mettons la valeur 1 (ligne 5), indiquant la sortie standard (stdout), c'est-à-dire la sortie à l'écran. <br><br>  r1 indique l'adresse mémoire des données que nous voulons écrire, nous chargeons donc simplement l'adresse de la chaîne "Hello, World" (ligne 6) dans cette zone, et le registre r2 montre combien d'octets nous voulons écrire.  Dans notre programme, il est défini sur message_len (ligne 7), calculé sur la ligne 18 en utilisant une syntaxe spéciale: le symbole de point indique l'adresse mémoire actuelle.  Pour cette raison.  - le message indique l'adresse mémoire actuelle moins l'adresse du message.  Eh bien, puisque nous déclarons message_len immédiatement après le message, tout cela est calculé comme la longueur du message. <br><br>  Si vous écrivez le code des lignes 5 à 9 à l'aide de C, vous obtenez les informations suivantes: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> message "Hello, World\n" write(1, message, strlen(message));</span></span></code> </pre> <br>  Arrêter le programme est un peu plus facile.  Pour ce faire, nous enregistrons simplement le code de sortie dans le registre r0 (ligne 11), après quoi nous ajoutons la valeur 1, qui est le numéro de l'appel de fonction système exit (), à r7 (ligne 12), puis appelons à nouveau le noyau (ligne 13). <br><br>  Une liste complète des appels système Android et de leurs numéros se trouve dans le <a href="">code</a> source <a href="">du système d'exploitation</a> .  Il existe également une implémentation de <a href="">write ()</a> et <a href="">exit ()</a> qui appellent les fonctions système correspondantes. <br><br><h3>  Assembler le programme </h3><br>  Afin de compiler notre projet, vous aurez besoin d'Android NDK (Native Development Kit).  Il contient un ensemble de compilateurs et d'outils de construction pour la plate-forme ARM.  Vous pouvez le télécharger sur le site officiel, l'installer, par exemple, via Android Studio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b0f/ad0/963/b0fad09631cb9904cc9288563b294db1.png"><br><br>  Une fois le NDK installé, nous avons besoin du fichier arm-linux-androideabi-as, c'est l'assembleur pour ARM.  Si vous avez téléchargé via Android Studio, recherchez-le dans le dossier Android SDK.  Son emplacement est généralement <br><br>  <i>ndk-bundle \ toolchains \ arm-linux-androideabi-4.9 \ prebuilt \ windows-x86_64 \ bin.</i> <br><br>  Une fois l'assembleur trouvé, enregistrez ce qui est écrit dans un fichier appelé hello.s, puis exécutez la commande suivante pour le convertir en code machine: <br><br>  <i>arm-linux-androideabi-as -o hello.o hello.s</i> <br><br>  Cette opération crée un fichier objet ELF appelé hello.o.  Afin de le convertir en un fichier binaire qui peut fonctionner sur votre appareil, appelez l'éditeur de liens: <br><br>  <i>arm-linux-androideabi-ld -o bonjour bonjour.o</i> <br><br>  Nous avons maintenant un fichier bonjour qui contient un programme prêt à l'emploi. <br><br><h3>  Lancez l'application sur votre appareil </h3><br>  Les applications Android sont généralement distribuées au format .apk.  Il s'agit d'un type spécial de fichier compressé qui inclut des classes Java (oui, vous pouvez écrire en C / C ++, mais Java doit être le point d'entrée). <br><br>  Afin d'éviter les problèmes lors du démarrage de l'application, adb a été utilisé dans l'exemple, ce qui nous a permis de le copier dans le dossier temporaire de notre appareil Android.  Après cela, nous lançons le shell adb afin de lancer l'application et d'évaluer le résultat: <br><br>  <i>adb push bonjour / data / local / tmp / bonjour</i> <i><br></i>  <i>adb shell chmod + x / data / local / tmp / hello</i> <br><br>  Et enfin, lancez l'application: <br><br>  <i>shell adb / data / local / tmp / bonjour</i> <br><br><h3>  Qu'écrivez-vous? </h3><br>  Vous avez maintenant un environnement de travail similaire à celui qu'Ariella avait.  Elle a passé plusieurs jours à étudier l'assembleur ARM, puis a proposé un projet simple - c'est le jeu Sven Boom (une variation de Fizz Buzz originaire d'Israël).  Les joueurs comptent à leur tour et chaque fois que le nombre est divisé par 7 ou contient le nombre 7, ils doivent dire «boom» (d'où le nom du jeu). <br><br>  Il convient de noter que le programme de jeu n'est pas une tâche aussi facile.  Ariella a écrit toute une méthode qui affiche les chiffres, un chiffre à la fois.  Puisqu'elle a tout écrit en assembleur sans appeler les fonctions standard de la bibliothèque C, cela a pris plusieurs jours à résoudre. <br><br>  Le premier programme Ariella pour Adnroid est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Soit dit en passant, certains identificateurs de code dans l'application sont en fait des mots hébreux (par exemple, _sifra_ahrona). <br><br>  L'écriture d'une application Android dans l'assembleur est un bon moyen de mieux connaître l'architecture ARM et de mieux comprendre la cuisine intérieure du gadget que vous utilisez quotidiennement.  Je vous suggère de faire cela de près et d'essayer de créer une petite application d'assemblage pour votre appareil.  Ce pourrait être un jeu simple ou autre chose. <br><br><blockquote>  <b>Skillbox recommande:</b> <br><br><ul><li>  Cours pratique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Mobile Developer PRO"</a> . </li><li>  Cours en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Développeur C # à partir de zéro</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li><li>  Cours pratique de deux ans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Je suis un développeur web PRO</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441798/">https://habr.com/ru/post/fr441798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441784/index.html">Le point de vue d'un biologiste sur la théorie mutationnelle du vieillissement</a></li>
<li><a href="../fr441788/index.html">Fonctionnement du système de vidéosurveillance Ivideon: aperçu du compte personnel de l'utilisateur</a></li>
<li><a href="../fr441790/index.html">Création de composants efficace avec système stylisé</a></li>
<li><a href="../fr441794/index.html">10 choses sur le référencement technique que chaque propriétaire de site WordPress doit savoir</a></li>
<li><a href="../fr441796/index.html">Trois points de croissance de conversion, ou comment augmenter la sécurité et augmenter les ventes sur le site</a></li>
<li><a href="../fr441800/index.html">Conversations sur C ++: WP 21, Boost, Conférences</a></li>
<li><a href="../fr441802/index.html">Cadre juridique de la biométrie</a></li>
<li><a href="../fr441804/index.html">Où enseigner la programmation aux enfants?</a></li>
<li><a href="../fr441806/index.html">VPN sans VPN ou une histoire sur l'utilisation non conventionnelle de SSH</a></li>
<li><a href="../fr441808/index.html">Nous vous invitons le 6 mars au ElixirLangMoscow Meetup # 9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>