<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüé® üë≤üèº üë©üèø‚Äçüî¨ Escribir una serpiente en ipad (pythonista) ‚ö±Ô∏è üê© ü§î</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... o c√≥mo matar el tiempo con un ipad y nada m√°s ... 

 Hola 

 De que estas hablando 
 Desafortunadamente, las tabletas a√∫n no reemplazan a las comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribir una serpiente en ipad (pythonista)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464805/">  <i>... o c√≥mo matar el tiempo con un ipad y nada m√°s ...</i> <br><br>  Hola <br><br><h3>  De que estas hablando </h3><br>  Desafortunadamente, las tabletas a√∫n no reemplazan a las computadoras.  Pero tener un viaje / vuelo es vital.  Por lo tanto, busqu√© qu√© ides est√°n debajo del ipad, y en realidad hoy har√© el juego en Pythonista. <br><br><h3>  Que haremos </h3><br>  Los programas m√°s simples, como los cristales (s√≠, s√≠, los mismos que juegas en el metro).  Tetris, serpiente, relleno: cualquier reci√©n llegado que tenga un poco de comprensi√≥n los escribir√° en 30 minutos.  Debajo de la escena: capturas de pantalla, tutorial, c√≥digo. <br><a name="habracut"></a><br>  Aqu√≠ hay algunas capturas de pantalla de lo que he estropeado: <br><br><div class="spoiler">  <b class="spoiler_title">Muchas capturas de pantalla</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/n5/t-/0l/n5t-0lksjmfrqpvj-hphcjrqgv4.png"><br><br><img src="https://habrastorage.org/webt/lv/a0/ay/lva0ay1p6xghjzuh60hbewak8-i.png"><br><br><img src="https://habrastorage.org/webt/az/ow/zh/azowzhphjmi5xju-ynvluvhot48.png"><br><br><img src="https://habrastorage.org/webt/pf/vq/yj/pfvqyj1em0bsun4ozseqvjl6458.png"><br><br><img src="https://habrastorage.org/webt/4k/lo/w9/4klow9qq74gspnkh888hsksgk7c.png"><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Descargo de responsabilidad</b> <div class="spoiler_text">  Este art√≠culo no solo es exclusivo para principiantes (sino que conoce Python) y no le permitir√° crear World of Tanks en diez minutos o cualquier aplicaci√≥n preparada en general, sino que el autor no garantiza un c√≥digo absolutamente hermoso y correcto desde el punto de vista de la programaci√≥n de religi√≥n (aunque lo intenta) .  Y tambi√©n algo es robado de ejemplos y documentaci√≥n de pythonista. <br></div></div><br>  <i>Todo el c√≥digo se dar√° al final.</i> <br><br><h3>  Conozca los gr√°ficos en pythonista </h3><br><div class="spoiler">  <b class="spoiler_title">Importar</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scene <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random</code> </pre> <br></div></div><br>  Inmediatamente crea una escena: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.background_color = <span class="hljs-string"><span class="hljs-string">"green"</span></span> run(Game(), LANDSCAPE)</code> </pre><br>  Bueno, comencemos de inmediato.  Deber√≠as tener una pantalla verde.  Hagamos algunas cosas interesantes agregando el m√©todo de actualizaci√≥n (que el propio sistema llama) a la clase Game y cambiando el color de fondo. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    def update(self): self.background_color = (1.0, 1.0, (math.sin(self.t) + 1) / 2)</span></span></code> </pre><br>  Ahora nuestra pantalla cambia suavemente de amarillo a blanco y viceversa. <br><br><img src="https://habrastorage.org/webt/-h/h_/vu/-hh_vuqntwuqqpno4h_jtu0944m.png"><br><br>  Ahora crea alg√∫n objeto.  Tambi√©n lo creamos en el m√©todo de configuraci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.background_color = <span class="hljs-string"><span class="hljs-string">"white"</span></span> mypath = ui.Path.rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>) self.obj = ShapeNode(mypath) self.obj.color = <span class="hljs-string"><span class="hljs-string">"purple"</span></span> <span class="hljs-comment"><span class="hljs-comment">#      html,  #FF00FF.   tuple,   (1.0, 0.0, 1.0).       alpha,    self.add_child(self.obj) def update(self): self.obj.position = (500 + 200 * math.sin(self.t), 500 + 200 * math.cos(self.t))</span></span></code> </pre><br>  Establecimos la l√≠nea (mypath), creamos un ShapeNode en √©l, lo apuntamos a un color y luego especificamos un padre (esencialmente lo mismo: especifique un padre al crear, es decir, ShapeNode (* ..., parent = self) o self.add_child (obj)). <br><br>  Bueno, en Game.update () cambiamos la posici√≥n del objeto (tupla), y est√° en p√≠xeles y se considera desde la esquina inferior izquierda. <br><blockquote>  Tenga en cuenta que no necesitamos volver a dibujar la escena (aunque es posible).  Los objetos y nodos cuyo padre es la escena (o algunos de sus objetos hijos) se vuelven a dibujar <br></blockquote>  Lo √∫ltimo que veremos en esta secci√≥n es touch_began (as√≠ como touch_moved y touch_ended).  Es f√°cil de adivinar, el m√©todo captura clics en la pantalla.  Prob√©moslo: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touch_began</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> mypath = ui.Path.oval(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>) obj = ShapeNode(mypath) obj.color = (<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.add_child(obj) obj.position = touch.location</code> </pre><br><img src="https://habrastorage.org/webt/gp/1m/mu/gp1mmunnpgr5y6_c0ge8hpzqn8q.png"><br><br>  Cada vez que hace clic en la pantalla, creamos un c√≠rculo, el lugar del clic es touch.location. <br><br><h3>  Listo para escribir una serpiente </h3><br><div class="spoiler">  <b class="spoiler_title">Mecanismo de juego</b> <div class="spoiler_text">  Una serpiente es un conjunto de cuadrados, cuando la cabeza se mueve - la segunda pieza se mueve al lugar de la primera, la tercera - al lugar de la segunda, etc. Para averiguar la intersecci√≥n de la cabeza con la cola, la compararemos con cada pieza de cola <br></div></div><br>  Eliminamos todo el c√≥digo escrito, porque queremos hacerlo m√°s o menos bellamente (pero, por supuesto, haremos bicicletas). <br><br>  Primero, creemos la clase PhyObj: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhyObj</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, path, color, parent)</span></span></span><span class="hljs-function">:</span></span> self.graph_obj = ShapeNode(path, parent=parent) self.parent = parent self.graph_obj.color = color <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setpos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.graph_obj.position = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getpos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.graph_obj.position <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.graph_obj.position += (x, y)</code> </pre><br>  Creo que todo es trivial aqu√≠.  Dentro de la clase en s√≠, creamos un nodo y tambi√©n describimos algunos m√©todos que har√°n que nuestro c√≥digo sea m√°s legible. <br><br><div class="spoiler">  <b class="spoiler_title">Holivario</b> <div class="spoiler_text">  Personalmente, prefiero crear primero clases de bajo nivel que tengan muchos m√©todos y propiedades duplicados, pero luego el c√≥digo en los de nivel superior se vuelve muy hermoso y legible. <br></div></div><br>  PhyObj es el objeto de nivel m√°s bajo en nuestro juego, de hecho es un objeto f√≠sico abstracto. <br><br><h4>  Descripci√≥n de la serpiente </h4><br>  Ahora tenemos que describir la serpiente, y dado que consta de piezas, primero describiremos una: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tile</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(PhyObj)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__(ui.Path.rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - margin, size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - margin), <span class="hljs-string"><span class="hljs-string">"#66FF66"</span></span>, parent) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">die</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graph_obj.color = <span class="hljs-string"><span class="hljs-string">"red"</span></span></code> </pre><br>  En el constructor, llamamos al m√©todo padre de la clase y nos damos forma y color.  se necesita un margen para que los cuadrados no se peguen y creen alg√∫n tipo de malla. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.tile = Tile(self, (<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>)) self.tile.setpos(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)</code> </pre><br>  Deber√≠a haber resultado: <br><br><img src="https://habrastorage.org/webt/dg/yl/tf/dgyltfilompjygqnrriiio1mhv8.png"><br><br>  Pero, por ejemplo, ¬øpor qu√© necesitamos margen? <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> tile1 = Tile(self, (<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>)) tile1.setpos(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) tile2 = Tile(self, (<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>)) tile2.setpos(<span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)</code> </pre><br><img src="https://habrastorage.org/webt/0n/p8/i0/0np8i041mbo7udct2rsi3twsj18.png"><br><br>  Bueno, ahora de estas piezas necesitas pegar la serpiente.  Necesitamos un m√©todo de inicializaci√≥n y un m√©todo de movimiento. <br><br>  Primero, cree la inicializaci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Snake</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, length, width, initpos, parent)</span></span></span><span class="hljs-function">:</span></span> self.width = width <span class="hljs-comment"><span class="hljs-comment">#     self.tiles = [Tile(parent, (width, width)) for i in range(length)] #        for i, tile in enumerate(self.tiles): tile.setpos(initpos[0] + i * self.width, initpos[1]) #       </span></span></code> </pre><br>  Intentemos dibujarlo de inmediato: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.snake = Snake(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), self)</code> </pre><br><img src="https://habrastorage.org/webt/gv/kl/gg/gvklgg1stltccf2hxsyyuae_rsu.png"><br><br>  Bueno, agregue el m√©todo de movimiento. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Snake</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.tiles) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.tiles[i].setpos(*self.tiles[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].getpos()) self.tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>].move(x * self.width, y * self.width)</code> </pre><br>  Primero movemos el √∫ltimo al pen√∫ltimo, luego el pen√∫ltimo al pen√∫ltimo ... luego el segundo al primero.  Y el primero en (x, y). <br><br>  En realidad, nuestra serpiente se mueve bien recta.  Probemos <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(self)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def update(self): self.snake.move(0, 1)</span></span></code> </pre><br>  Si lograste ver, entonces ella se arrastr√≥ como deber√≠a.  El hecho es que la actualizaci√≥n se llama con mucha frecuencia (y, por cierto, opcionalmente con el mismo intervalo), por lo que debemos considerar cu√°nto tiempo ha pasado desde la √∫ltima llamada y esperar hasta que se "acumule" lo suficiente. <br><br>  En resumen, hacemos: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_reset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.last_time = self.t <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_gone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, t)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.t - self.last_time &gt; t: res = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.time_reset() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: res = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.snake = Snake(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), self) self.time_reset() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.time_gone(<span class="hljs-number"><span class="hljs-number">0.3</span></span>): self.snake.move(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  time_gone devuelve True si ha pasado m√°s tiempo que t.  Ahora la serpiente se mover√° cada 0.3 segundos.  ¬øFuncion√≥? <br><br><img src="https://habrastorage.org/webt/it/ew/cn/itewcnxtf37hx-bkj2-_tnrjnug.png"><br><br><h4>  Gesti√≥n </h4><br>  Ahora necesita hacer el control, es decir, un giro en las cuatro direcciones: <br><br><img src="https://habrastorage.org/webt/5l/hw/mo/5lhwmoxex5c_lfafmihwivyw1ym.png"><br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def setup(self): # &lt;...&gt; self.dir = (0, 1) #     def update(self): if self.time_gone(0.3): self.snake.move(*self.dir)</span></span></code> </pre><br>  Y ahora tenemos que hacer un procesamiento touch_began para comprender en qu√© √°rea se asom√≥ el usuario.  En realidad, result√≥ no ser tan interesante como pensaba, as√≠ que aqu√≠ puedes simplemente copiar: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def touch_began(self, touch): ws = touch.location[0] / self.size.w hs = touch.location[1] / self.size.h aws = 1 - ws if ws &gt; hs and aws &gt; hs: self.dir = (0, -1) elif ws &gt; hs and aws &lt;= hs: self.dir = (1, 0) elif ws &lt;= hs and aws &gt; hs: self.dir = (-1, 0) else: self.dir = (0, 1)</span></span></code> </pre><br>  Bueno, intenta girar ahora <br><br><img src="https://habrastorage.org/webt/-a/s5/8p/-as58pqevh1gfcxx4a556pttljo.png"><br><br>  El mecanismo principal est√° resuelto, queda por hacer una verificaci√≥n de colisiones y manzanas. <br><br><h4>  Colisi√≥n de cola </h4><br>  Comencemos por verificar y agregar el m√©todo find_collisions a la serpiente <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Snake</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def find_collisions(self): for i in range(1, len(self.tiles)): if self.tiles[i].getpos() == self.tiles[0].getpos(): return self.tiles[i], self.tiles[0] return False</span></span></code> </pre><br>  Ahora podemos obtener un par de celdas que se cruzan.  Me gustar√≠a colorearlos de rojo, agregar el m√©todo de troquel a Tile: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tile</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(PhyObj)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def die(self): self.graph_obj.color = "red"</span></span></code> </pre><br>  Agregue una marca de verificaci√≥n para actualizar y cambiar la configuraci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def setup(self): self.snake = Snake(30, 40, (200, 200), self) #   self.time_reset() self.dir = (0, 1) self.game_on = True #   ? def update(self): if not self.game_on: #  ,  return col = self.snake.find_collisions() #  ? if col: for tile in col: tile.die() #     self.game_on = False #   if self.time_gone(0.3): self.snake.move(*self.dir)</span></span></code> </pre><br>  Lo que me paso <br><br><img src="https://habrastorage.org/webt/zu/gx/n2/zugxn2bxvlbhj6cagawcjy-qsdi.png"><br><br>  Queda por hacer manzanas. <br><br><h4>  Alargamiento y manzanas </h4><br>  Vamos a alargar la serpiente, y para que se vea hermosa, se agregar√° un nuevo enlace de acuerdo con los dos √∫ltimos, es decir: <br><br><img src="https://habrastorage.org/webt/kl/sg/uv/klsguvpmusyky4y78dvdmk_nvdu.png"><br><br>  Agregue los m√©todos a la serpiente: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Snake</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def find_dir(self, x1, y1, x2, y2): if x1 == x2 and y1 &gt; y2: return (0, 1) elif x1 == x2 and y1 &lt; y2: return (0, -1) elif y1 == y2 and x1 &gt; x2: return (1, 0) elif y1 == y2 and x1 &lt; x2: return (-1, 0) else: assert False, "Error!" def append(self): if len(self.tiles) &gt; 1: lastdir = self.find_dir(*self.tiles[-1].getpos(), *self.tiles[-2].getpos()) else: lastdir = (-self.parent.dir[0], -self.parent.dir[1]) self.tiles.append(Tile(self.parent, (self.width, self.width))) x_prev, y_prev = self.tiles[-2].getpos() self.tiles[-1].setpos(x_prev + lastdir[0] * self.width, y_prev + lastdir[1] * self.width)</span></span></code> </pre><br>  find_dir encuentra la direcci√≥n en la que se dirige la punta de la cola de nuestra hero√≠na.  agregar, es f√°cil de adivinar, agrega una celda.  Agregue otro m√©todo snake_lengthen al juego: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def snake_lengthen(self): self.snake.append() self.time_reset()</span></span></code> </pre><br>  Se necesita la √∫ltima l√≠nea para que la serpiente espere un poco, y el usuario logr√≥ ver que se agreg√≥ la pieza. <br><br>  Para saber si algo se cruza con la serpiente, agregue el m√©todo de intersecci√≥n. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Snake</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def getpos(self): return self.tiles[0].getpos() def intersect(self, x, y): return self.getpos() == (x, y)</span></span></code> </pre><br>  Hurra, solo queda crear una manzana.  En realidad, describimos la manzana de una vez: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Apple</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(PhyObj)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, width, size, parent)</span></span></span><span class="hljs-function">:</span></span> super().__init__(ui.Path.oval(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, size[<span class="hljs-number"><span class="hljs-number">0</span></span>], size[<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-string"><span class="hljs-string">"#55AAFF"</span></span>, parent) self.parent = parent self.width = width self.dislocate() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> a = random.randint(<span class="hljs-number"><span class="hljs-number">2</span></span>, int(self.parent.size.w / self.width) - <span class="hljs-number"><span class="hljs-number">2</span></span>) b = random.randint(<span class="hljs-number"><span class="hljs-number">2</span></span>, int(self.parent.size.h / self.width) - <span class="hljs-number"><span class="hljs-number">2</span></span>) self.setpos(a * self.width, b * self.width)</code> </pre><br>  Se necesita una aleatoriedad tan extra√±a para encajar en nuestra cuadr√≠cula.  Entonces no ser√° necesario buscar la distancia entre el hocico y la manzana y comparar su pira-pyr.  Solo en ifas.  Vamos a actualizar y agregar l√≠neas muy simples al final de esta funci√≥n: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def setup(self): self.apple = Apple(40, (50, 50), self) # 40 -  ,       Snake() # &lt;...&gt; def update(self): # &lt;...&gt; if self.snake.intersect(*self.apple.getpos()): self.snake_lengthen() self.apple.dislocate()</span></span></code> </pre><br>  Bueno, todo parece ser, ahora la serpiente se alarga si golpea una manzana y muere si se golpea a s√≠ misma. <br><br><img src="https://habrastorage.org/webt/0r/de/gw/0rdegw0knuwccnbh6jz5oy5hova.png"><br><br><h4>  Bono </h4><br>  Puedes hacer efectos de sonido: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sound <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def snake_lengthen(self): self.snake.append() self.time_reset() sound.play_effect('arcade:Powerup_1', 0.25, 0.8)</span></span></code> </pre><br>  Haz un movimiento suave: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def setup(self): self.game_on = False self.GLOBAL_TIMING = 0.2 self.GLOBAL_WIDTH = 40 self.apple = Apple(self.GLOBAL_WIDTH, (50, 50), self) self.snake = Snake(10, self.GLOBAL_WIDTH, (200, 200), self) self.time_reset() self.dir = (0, 1) self.game_on = True class Snake: # &lt;...&gt; def move(self, x, y): for i in range(len(self.tiles) - 1, 0, -1): self.tiles[i].setpos(*self.tiles[i - 1].getpos(), self.parent.GLOBAL_TIMING) self.tiles[0].move(x * self.width, y * self.width, self.parent.GLOBAL_TIMING) class PhyObj: def __init__(self, path, color, parent): self.graph_obj = ShapeNode(path, parent=parent) self.parent = parent self.graph_obj.color = color self.pos = self.graph_obj.position def setpos(self, x, y, t=0.0): self.pos = (x, y) self.graph_obj.run_action(Action.move_to(x, y, t)) #    x, y    t def getpos(self): return self.pos def move(self, x, y, t=0.0): self.pos = (self.pos[0] + x, self.pos[1] + y) self.graph_obj.run_action(Action.move_by(x, y, t))</span></span></code> </pre><br>  En otras palabras, cambiamos la l√≥gica de la posici√≥n PhyObj.  Anteriormente, nos centramos en la posici√≥n del elemento gr√°fico, y ahora hay un campo separado para la posici√≥n l√≥gica (es decir, el que se usa para la l√≥gica del juego), y la posici√≥n del elemento gr√°fico ahora es libre y se puede cambiar de alguna manera a su manera.  Es decir, usando Acci√≥n, le dejamos una corriente paralela, donde se mueve. <br><br>  Una serpiente tan suave result√≥: <br><br><img src="https://habrastorage.org/webt/8g/ma/4x/8gma4xndidknidevmnr49pleuyc.png"><br><br>  Y finalmente, una etiqueta con una longitud de serpiente: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;...&gt; def setup(self): self.game_on = False self.GLOBAL_TIMING = 0.2 self.GLOBAL_WIDTH = 40 self.apple = Apple(self.GLOBAL_WIDTH, (50, 50), self) self.snake = Snake(30, self.GLOBAL_WIDTH, (200, 200), self) self.time_reset() self.dir = (0, 1) self.label = LabelNode("", font=("Chalkduster", 20), parent=self, position=(self.size.w / 2, self.size.h - 100)) #    self.update_labels() self.game_on = True def update_labels(self): self.label.text = "Length: " + str(len(self.snake.tiles)) def update(self): if not self.game_on: return col = self.snake.find_collisions() if col: for tile in col: tile.die() self.game_on = False if self.time_gone(self.GLOBAL_TIMING): self.snake.move(*self.dir) if self.snake.intersect(*self.apple.getpos()): self.snake_lengthen() self.apple.dislocate() self.update_labels() # </span></span></code> </pre><br><img src="https://habrastorage.org/webt/pu/vk/s5/puvks5yyrimbzdvzfbt4kwysml4.png"><br><br>  Amigos, gracias por su atenci√≥n!  Si algo no est√° claro, pregunte.  Y si ser√° interesante, continuar√©, todav√≠a hay algo que contar (pero este art√≠culo ya es bastante largo). <br><br><div class="spoiler">  <b class="spoiler_title">Todo el c√≥digo de la serpiente</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scene <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sound <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PhyObj</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, path, color, parent)</span></span></span><span class="hljs-function">:</span></span> self.graph_obj = ShapeNode(path, parent=parent) self.parent = parent self.graph_obj.color = color self.pos = self.graph_obj.position <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setpos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, t=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.pos = (x, y) self.graph_obj.run_action(Action.move_to(x, y, t)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getpos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, t=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.pos = (self.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y) self.graph_obj.run_action(Action.move_by(x, y, t)) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tile</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(PhyObj)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__(ui.Path.rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - margin, size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - margin), <span class="hljs-string"><span class="hljs-string">"#66FF66"</span></span>, parent) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">die</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graph_obj.color = <span class="hljs-string"><span class="hljs-string">"red"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Snake</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, length, width, initpos, parent)</span></span></span><span class="hljs-function">:</span></span> self.width = width self.tiles = [Tile(parent, (width, width)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(length)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, tile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(self.tiles): tile.setpos(initpos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + i * self.width, initpos[<span class="hljs-number"><span class="hljs-number">1</span></span>]) self.parent = parent <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.tiles) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.tiles[i].setpos(*self.tiles[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].getpos(), self.parent.GLOBAL_TIMING) self.tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>].move(x * self.width, y * self.width, self.parent.GLOBAL_TIMING) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_collisions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, len(self.tiles)): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.tiles[i].getpos() == self.tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>].getpos(): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.tiles[i], self.tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_dir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x1, y1, x2, y2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x1 == x2 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> y1 &gt; y2: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> x1 == x2 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> y1 &lt; y2: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> y1 == y2 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> x1 &gt; x2: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> y1 == y2 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> x1 &lt; x2: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"Error!"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.tiles) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: lastdir = self.find_dir(*self.tiles[<span class="hljs-number"><span class="hljs-number">-1</span></span>].getpos(), *self.tiles[<span class="hljs-number"><span class="hljs-number">-2</span></span>].getpos()) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: lastdir = (-self.parent.dir[<span class="hljs-number"><span class="hljs-number">0</span></span>], -self.parent.dir[<span class="hljs-number"><span class="hljs-number">1</span></span>]) self.tiles.append(Tile(self.parent, (self.width, self.width))) x_prev, y_prev = self.tiles[<span class="hljs-number"><span class="hljs-number">-2</span></span>].getpos() self.tiles[<span class="hljs-number"><span class="hljs-number">-1</span></span>].setpos(x_prev + lastdir[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.width, y_prev + lastdir[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.width) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getpos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>].getpos() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.getpos() == (x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Apple</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(PhyObj)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, width, size, parent)</span></span></span><span class="hljs-function">:</span></span> super().__init__(ui.Path.oval(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, size[<span class="hljs-number"><span class="hljs-number">0</span></span>], size[<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-string"><span class="hljs-string">"#55AAFF"</span></span>, parent) self.parent = parent self.width = width self.dislocate() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> a = random.randint(<span class="hljs-number"><span class="hljs-number">2</span></span>, int(self.parent.size.w / self.width) - <span class="hljs-number"><span class="hljs-number">2</span></span>) b = random.randint(<span class="hljs-number"><span class="hljs-number">2</span></span>, int(self.parent.size.h / self.width) - <span class="hljs-number"><span class="hljs-number">2</span></span>) self.setpos(a * self.width, b * self.width) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snake_lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.snake.append() self.time_reset() sound.play_effect(<span class="hljs-string"><span class="hljs-string">'arcade:Powerup_1'</span></span>, <span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">0.8</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_reset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.last_time = self.t <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_gone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, t)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.t - self.last_time &gt; t: res = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.time_reset() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: res = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.GLOBAL_TIMING = <span class="hljs-number"><span class="hljs-number">0.2</span></span> self.GLOBAL_WIDTH = <span class="hljs-number"><span class="hljs-number">40</span></span> self.apple = Apple(self.GLOBAL_WIDTH, (<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>), self) self.snake = Snake(<span class="hljs-number"><span class="hljs-number">30</span></span>, self.GLOBAL_WIDTH, (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), self) self.time_reset() self.dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.label = LabelNode(<span class="hljs-string"><span class="hljs-string">""</span></span>, font=(<span class="hljs-string"><span class="hljs-string">"Chalkduster"</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), parent=self, position=(self.size.w / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size.h - <span class="hljs-number"><span class="hljs-number">100</span></span>)) self.update_labels() self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.label.text = <span class="hljs-string"><span class="hljs-string">"Length: "</span></span> + str(len(self.snake.tiles)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> col = self.snake.find_collisions() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> col: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> col: tile.die() self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.time_gone(self.GLOBAL_TIMING): self.snake.move(*self.dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.snake.intersect(*self.apple.getpos()): self.snake_lengthen() self.apple.dislocate() self.update_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touch_began</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> ws = touch.location[<span class="hljs-number"><span class="hljs-number">0</span></span>] / self.size.w hs = touch.location[<span class="hljs-number"><span class="hljs-number">1</span></span>] / self.size.h aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: self.dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &lt;= hs: self.dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: self.dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) run(Game(), LANDSCAPE)</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de cristal WhiteBlackGoose edition</b> <div class="spoiler_text">  Es curioso que despu√©s de haberlo hecho, encontr√© algo MUY similar en los ejemplos del propio pythonista.  Pero tengo un poco m√°s de caracter√≠sticas :) <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scene <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pi <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uniform <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rnd, choice, randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random A = Action sys.setrecursionlimit(<span class="hljs-number"><span class="hljs-number">1000000</span></span>) colors = [<span class="hljs-string"><span class="hljs-string">'pzl:Green5'</span></span>, <span class="hljs-string"><span class="hljs-string">"pzl:Red5"</span></span>, <span class="hljs-string"><span class="hljs-string">"pzl:Blue5"</span></span>] + [<span class="hljs-string"><span class="hljs-string">"pzl:Purple5"</span></span>, <span class="hljs-string"><span class="hljs-string">"pzl:Button2"</span></span>] + [<span class="hljs-string"><span class="hljs-string">"plf:Item_CoinGold"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> inited inited = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Explosion</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Node)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, brick, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> Node.__init__(self, *args, **kwargs) self.position = brick.position <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dx, dy <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ((<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)): p = SpriteNode(brick.texture, scale=<span class="hljs-number"><span class="hljs-number">0.5</span></span>, parent=self) p.position = brick.size.w/<span class="hljs-number"><span class="hljs-number">4</span></span> * dx, brick.size.h/<span class="hljs-number"><span class="hljs-number">4</span></span> * dy p.size = brick.size d = <span class="hljs-number"><span class="hljs-number">0.6</span></span> r = <span class="hljs-number"><span class="hljs-number">30</span></span> p.run_action(A.move_to(rnd(-r, r), rnd(-r, r), d)) p.run_action(A.scale_to(<span class="hljs-number"><span class="hljs-number">0</span></span>, d)) p.run_action(A.rotate_to(rnd(-pi/<span class="hljs-number"><span class="hljs-number">2</span></span>, pi/<span class="hljs-number"><span class="hljs-number">2</span></span>), d)) self.run_action(A.sequence(A.wait(d), A.remove())) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Brick</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(SpriteNode)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, brick_type, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> img = colors[brick_type] SpriteNode.__init__(self, img, *args, **kwargs) self.brick_type = brick_type self.is_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.lf = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.enabled = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.remove_from_parent() self.is_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mark</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.lf = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demark</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.lf = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Scene)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brickgetpos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, i, j)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (self.Woff + j * self.W, self.Hoff + i * self.H) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, ty, i, j)</span></span></span><span class="hljs-function">:</span></span> b = Brick(ty, size=(self.W, self.H), position=self.brickgetpos(i, j), parent=self.game_node) b.rotation = random.random() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_brick_type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> random.random() &lt; <span class="hljs-number"><span class="hljs-number">0.992</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> random.random() &lt; <span class="hljs-number"><span class="hljs-number">0.8</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> FONT = (<span class="hljs-string"><span class="hljs-string">'Chalkduster'</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>) self.score_label = LabelNode(<span class="hljs-string"><span class="hljs-string">'Score: 0'</span></span>, font=FONT, position=(self.size.w/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-100</span></span>, self.size.h<span class="hljs-number"><span class="hljs-number">-40</span></span>), parent=self) self.score = <span class="hljs-number"><span class="hljs-number">0</span></span> self.last_score_label = LabelNode(<span class="hljs-string"><span class="hljs-string">'Delta: +0'</span></span>, font=FONT, position=(self.size.w/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-300</span></span>, self.size.h<span class="hljs-number"><span class="hljs-number">-40</span></span>), parent=self) self.last_score = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">#self.avg_label = LabelNode('Speed: +0/s', font=FONT, position=(self.size.w/2+100, self.size.h-40), parent=self) #self.max_label = LabelNode('Peak: +0/s', font=FONT, position=(self.size.w/2+300, self.size.h-40), parent=self) #self.max_speed = 0 self.game_time = 120 self.timel = LabelNode('Time: ' + str(self.game_time) + "s", font=FONT, position=(self.size.w/2+300, self.size.h-40), parent=self) self.gems = [0 for i in colors] self.effect_node = EffectNode(parent=self) self.game_node = Node(parent=self.effect_node) self.l = [0 for i in colors] self.lt = [0 for i in colors] for i in range(len(colors)): R = 50 if i == 6 else 35 self.l[i] = Brick(i, size=(R, R), position=(40, self.size.h-100-i*40), parent=self.game_node) self.lt[i] = LabelNode(": 0", font=FONT, position=(self.l[i].position[0] + 40, self.l[i].position[1]), parent=self) self.WB = 30 self.HB = 30 self.W = 900 // self.WB self.H = 900 // self.HB self.colcount = 4 self.Woff = (int(self.size.w) - self.W * self.WB + self.W) // 2 self.Hoff = self.H + 10 self.net = [[self.brick(self.random_brick_type(), i, j) for i in range(self.HB)] for j in range(self.WB)] #self.touch_moved = self.touch_began self.start_time = self.t self.game_on = True global inited inited = True def demark(self): for bricks in self.net: for brick in bricks: brick.demark() def howfar(self, x, y): alt = 0 for i in range(y): if not self.net[x][i].is_on: alt += 1 return alt def update(self): global inited if not inited: return self.game_on = self.t - self.start_time &lt; self.game_time if self.game_on: self.timel.text = "Time: " + str(round(self.game_time - (self.t - self.start_time))) + "s" else: self.timel.text = "Game over" #if speed &gt; self.max_speed: # self.max_speed = speed # self.max_label.text = "Peak: +" + str(round(self.max_speed)) + "/s" def gravity(self, x, y): alt = self.howfar(x, y) if alt == 0: return self.net[x][y].destroy() self.net[x][y - alt] = self.brick(self.net[x][y].brick_type, y, x) self.net[x][y - alt].position = self.net[x][y].position self.net[x][y - alt].rotation = self.net[x][y].rotation self.net[x][y - alt].enabled = False self.net[x][y - alt].run_action(A.sequence(A.move_to(*self.brickgetpos(y - alt, x), 0.2 * alt ** 0.5, TIMING_EASE_IN_2), A.call(lambda: self.enable_cell(x, y - alt)))) def enable_cell(self, x, y): self.net[x][y].enabled = True def fall(self): for x in range(self.WB): for y in range(self.HB): if self.net[x][y].is_on: self.gravity(x, y) def update_scores(self): self.score += self.last_score self.score_label.text = "Score: " + str(self.score) self.last_score_label.text = "Delta: +" + str(self.last_score) self.last_score = 0 def update_cells(self): for i in range(self.WB): for j in range(self.HB): if not self.net[i][j].is_on: self.net[i][j] = self.brick(self.random_brick_type(), j + self.HB, i) self.net[i][j].enabled = True self.net[i][j].run_action(A.sequence(A.move_to(*self.brickgetpos(j, i), 0.2 * self.HB ** 0.5, TIMING_EASE_IN_2), A.call(lambda: self.enable_cell(i, j)))) def inbounds(self, x, y): return (x &gt;= 0) and (y &gt;= 0) and (x &lt; self.WB) and (y &lt; self.HB) def bomb(self, x, y, radius): score = 0 bc = 0 for i in range(round(4 * radius ** 2)): rad = random.random() * radius ang = random.random() * 2 * pi xp, yp = x + sin(ang) * rad, y + cos(ang) * rad xp, yp = int(xp), int(yp) if self.inbounds(xp, yp): score += self.explode(xp, yp) self.fall() self.give_score(round(score / 1.7), self.brickgetpos(y, x)) def laser(self, x, y): score = 0 coords = [] for i in range(self.HB): for j in range(-1, 1 + 1, 1): coords.append((x + j, i)) for i in range(self.WB): coords.append((i, y)) for i in range(-self.HB, self.HB): coords.append((x + i, y + i)) for i in range(-self.WB, self.WB): coords.append((x - i, y + i)) bc = 0 for x, y in coords: if not self.inbounds(x, y): continue score += self.explode(x, y) self.fall() self.give_score(score, self.brickgetpos(y, x)) def getty(self, x, y): if not self.inbounds(x, y) or not self.net[x][y].is_on: return -1 else: return self.net[x][y].brick_type def popupt(self, text, position_, font_=("Arial", 30), color_="white"): label = LabelNode(text, font=font_, color=color_, parent=self, position=position_) label.run_action(A.sequence(A.wait(1), A.call(label.remove_from_parent))) def give_score(self, count, xy): self.last_score = int(count ** 2.5) size = 10 if self.last_score &gt; 50000: size = 60 elif self.last_score &gt; 20000: size = 40 elif self.last_score &gt; 10000: size = 30 elif self.last_score &gt; 5000: size = 25 elif self.last_score &gt; 2000: size = 20 elif self.last_score &gt; 1000: size = 15 if self.last_score &gt; 0: self.popupt("+" + str(self.last_score), xy, font_=("Chalkduster", int(size * 1.5))) self.update_scores() def touch_began(self, touch): if not self.game_on: return x, y = touch.location x, y = x + self.W / 2, y + self.H / 2 W, H = get_screen_size() x, y = x, y x, y = int(x), int(y) x, y = x - self.Woff, y - self.Hoff x, y = x // self.W, y // self.H if not self.inbounds(x, y): return count = self.react(self.net[x][y].brick_type, x, y, True) self.demark() if self.getty(x, y) in [0, 1, 2, 3]: if count &gt;= 2: self.react(self.net[x][y].brick_type, x, y) self.fall() self.give_score(count, touch.location) elif self.getty(x, y) == 4: self.bomb(x, y, 5 * count) elif self.getty(x, y) == 5: self.explode(x, y) self.fall() self.update_cells() def explode(self, x, y): if self.net[x][y].is_on: self.net[x][y].destroy() self.gems[self.net[x][y].brick_type] += 1 s = str(self.gems[self.net[x][y].brick_type]) self.lt[self.net[x][y].brick_type].text = " " * len(s) + ": " + s self.game_node.add_child(Explosion(self.net[x][y])) return True else: return False def react(self, col, x, y, ignore=False): if self.inbounds(x, y) and self.net[x][y].brick_type == col and self.net[x][y].is_on and self.net[x][y].lf and self.net[x][y].enabled: if not ignore: self.explode(x, y) else: self.net[x][y].mark() r = 1 r += self.react(col, x + 1, y + 0, ignore) r += self.react(col, x - 1, y - 0, ignore) r += self.react(col, x + 0, y + 1, ignore) r += self.react(col, x - 0, y - 1, ignore) return r else: return 0 def destroy_brick(self, x, y): self.net[x][y].destroy() run(Game(), LANDSCAPE, show_fps=True)</span></span></code> </pre><br></div></div><br>  Demostraci√≥n del trabajo de los cristales: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/PLTlEe3xsaU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464805/">https://habr.com/ru/post/464805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464781/index.html">Televisores inteligentes: CRT a HDR</a></li>
<li><a href="../464785/index.html">Beneficios no competitivos de Beeline</a></li>
<li><a href="../464791/index.html">Kubernetes para el autom√≥vil: c√≥mo abrir el acceso del desarrollador a la computadora de a bordo y hacerla segura</a></li>
<li><a href="../464795/index.html">Merry Quartusel, o c√≥mo el procesador ha llegado a tal vida</a></li>
<li><a href="../464803/index.html">"Ocultar www": por qu√© los desarrolladores de navegador convencionales se negaron nuevamente a mostrar el subdominio</a></li>
<li><a href="../464809/index.html">C√≥mo probamos la tecnolog√≠a de reconocimiento facial y qu√© result√≥ de ella</a></li>
<li><a href="../464811/index.html">Apple Music para el desarrollador</a></li>
<li><a href="../464813/index.html">Reemplazando los dise√±os de Punto Switcher, Birman con un script en autohotkey</a></li>
<li><a href="../464823/index.html">Consideramos el salario promedio de un "cient√≠fico de datos". Parsim hh.ru usando pandas / python</a></li>
<li><a href="../464825/index.html">Preparaci√≥n de la aplicaci√≥n para Android Q. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>