<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖐🏽 🚆 👈🏻 Para penulis game 0 AD - dilakukan dengan baik 🔼 🏴‍☠️ ⏯️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0 AD adalah permainan tiga dimensi dalam genre strategi historis secara real time, yang dikembangkan oleh komunitas sukarelawan. Ukuran basis kode kec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Para penulis game 0 AD - dilakukan dengan baik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/420267/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c5/b41/bfb/6c5b41bfb68b23ef10d61f6ecd1a6665.png" alt="PVS-Studio &amp; 0 A.D."></div><br>  0 AD adalah permainan tiga dimensi dalam genre strategi historis secara real time, yang dikembangkan oleh komunitas sukarelawan.  Ukuran basis kode kecil dan saya memutuskan untuk mengecek permainan sebagai istirahat dari proyek-proyek besar seperti Android dan XNU Kernel.  Jadi, sebelum kita adalah proyek yang berisi 165.000 baris kode dalam C ++.  Mari kita lihat apa yang menarik di dalamnya yang dapat ditemukan menggunakan analisa statis PVS-Studio. <br><a name="habracut"></a><br><h2>  0 AD </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0 AD</a> (0 A.D.) adalah game tiga dimensi gratis dalam genre strategi historis secara real time, dikembangkan oleh komunitas sukarelawan (pengembang utama dipersatukan dalam tim Wildfire Games).  Permainan ini memungkinkan Anda untuk mengontrol peradaban yang ada pada periode 500 SM.  e. - 1 tahun SM.  e.  Pada musim panas 2018, proyek ini dalam versi alpha.  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Keterangan</a> diambil dari Wikipedia]. <br><br>  Kenapa tepatnya 0 AD? <br><br>  Saya meminta seorang rekan dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Egor Bredikhin</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">EgorBredikhin</a> ) untuk memilih dan memeriksa saya beberapa proyek terbuka kecil yang dengannya saya dapat mengerjakan di antara tugas-tugas lain.  Dia mengirimi saya log untuk proyek 0 M. Untuk pertanyaan: "Mengapa proyek ini?"  - ada jawaban: "Ya, saya baru saja memainkan game ini, strategi real-time yang bagus."  Ok, maka itu akan menjadi 0 AD :). <br><br><h2>  Kerapatan kesalahan </h2><br>  Saya ingin memuji penulis 0 AD untuk kualitas yang baik dari kode C ++.  Bagus sekali, Anda jarang berhasil memenuhi kepadatan kesalahan yang begitu rendah.  Tentu saja, ini bukan semua kesalahan, tetapi yang bisa dideteksi menggunakan PVS-Studio.  Seperti yang saya katakan, meskipun PVS-Studio tidak menemukan semua kesalahan, namun demikian, kita dapat dengan aman berbicara tentang hubungan antara kepadatan kesalahan dan kualitas kode secara keseluruhan. <br><br>  Beberapa angka.  Jumlah total baris kode yang tidak kosong adalah 231270. Dari jumlah tersebut, 28,7% adalah komentar.  Secara total, 165.000 baris kode C ++ murni. <br><br>  Jumlah pesan yang dikeluarkan oleh penganalisa kecil, dan setelah melihat semuanya, saya menulis 19 kesalahan.  Saya akan mempertimbangkan semua kesalahan ini nanti di artikel.  Mungkin saya melewatkan sesuatu, menganggap kesalahan itu sebagai kode ceroboh yang tidak berbahaya.  Namun, secara umum, ini tidak mengubah gambar. <br><br>  Jadi, saya menemukan 19 kesalahan pada 165.000 baris kode.  Kami menghitung kepadatan kesalahan: 19 * 1000/165000 = 0,115. <br><br>  Untuk kesederhanaan, kami membulatkan dan menganggap bahwa penganalisa PVS-Studio mendeteksi 0,1 kesalahan per 1000 baris kode dalam kode permainan. <br><br>  Hasil yang bagus!  Sebagai perbandingan, dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> saya yang terbaru <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tentang Android,</a> saya menghitung bahwa saya mendeteksi setidaknya 0,25 kesalahan per 1000 baris kode.  Bahkan, kepadatan kesalahan bahkan lebih besar, saya hanya tidak menemukan kekuatan untuk menganalisis seluruh laporan dengan cermat. <br><br>  Atau ambil EFL Core Libraries sebagai contoh, yang saya teliti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pelajari</a> dan hitung jumlah cacatnya.  Di dalamnya, PVS-Studio mendeteksi 0,71 kesalahan per 1000 baris kode. <br><br>  Jadi, penulis 0 AD adalah orang yang baik, namun, demi keadilan, harus dicatat bahwa sejumlah kecil kode yang ditulis dalam C ++ membantu mereka.  Sayangnya, semakin besar proyek, semakin cepat kompleksitasnya tumbuh, dan kepadatan kesalahan meningkat secara non-linear ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lebih</a> ). <br><br><h2>  Kesalahan </h2><br>  Sekarang mari kita lihat 19 kesalahan yang saya temukan di game.  Untuk menganalisis proyek, saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio</a> versi 6.24.  Saya sarankan Anda mencoba mengunduh versi demo dan memeriksa proyek yang sedang Anda kerjakan. <br><br>  <b>Catatan</b>  Kami memposisikan PVS-Studio sebagai solusi B2B.  Untuk proyek kecil dan pengembang individual, kami memiliki opsi lisensi gratis: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cara menggunakan PVS-Studio gratis</a> ." <br><br>  <b>Kesalahan N1</b> <br><br>  Mari kita mulai dengan melihat kesalahan kompleks.  Sebenarnya, ini tidak rumit, tetapi Anda harus membiasakan diri dengan sepotong kode yang cukup besar. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> WaterManager::CreateWaveMeshes() { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbNeighb = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> found = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; nbNeighb = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> p = <span class="hljs-number"><span class="hljs-number">0</span></span>; p &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; ++p) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CoastalPointsSet.count(xx+around[p][<span class="hljs-number"><span class="hljs-number">0</span></span>] + (yy + around[p][<span class="hljs-number"><span class="hljs-number">1</span></span>])*SideSize)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nbNeighb &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span>) { CoastalPointsSet.erase(xx + yy*SideSize); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } ++nbNeighb; <span class="hljs-comment"><span class="hljs-comment">// We've found a new point around us. // Move there xx = xx + around[p][0]; yy = yy + around[p][1]; indexx = xx + yy*SideSize; if (i == 0) Chain.push_back(CoastalPoint(indexx,CVector2D(xx*2,yy*2))); else Chain.push_front(CoastalPoint(indexx,CVector2D(xx*2,yy*2))); CoastalPointsSet.erase(xx + yy*SideSize); found = true; break; } } if (!found) endedChain = true; .... }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Peringatan</a> PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V547</a> CWE-570 Ekspresi 'nbNeighb&gt; = 2' selalu salah.  WaterManager.cpp 581 <br><br>  Sekilas, pesan penganalisa tampak aneh.  Mengapa kondisi <i>nbNeighb&gt; = 2</i> selalu salah?  Memang, dalam tubuh loop ada peningkatan variabel <i>nbNeighb</i> ! <br><br>  Lihat di bawah dan Anda akan melihat pernyataan <i>break</i> yang mengganggu eksekusi loop.  Oleh karena itu, jika variabel <i>nbNeighb</i> ditingkatkan, siklus akan dihentikan.  Dengan demikian, nilai variabel <i>nbNeighb</i> tidak akan pernah mencapai nilai lebih dari 1. <br><br>  Kode jelas mengandung beberapa jenis kesalahan logis. <br><br>  <b>Kesalahan N2</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CmpRallyPointRenderer::MergeVisibilitySegments( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">deque</span></span>&lt;SVisibilitySegment&gt;&amp; segments) { .... segments.erase(segments.end()); .... }</code> </pre> <br>  PVS-Studio Peringatan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V783</a> CWE-119 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dereferencing</a> iterator yang tidak valid ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">segment.end</a> ()' mungkin terjadi.  CCmpRallyPointRenderer.cpp 1290 <br><br>  Kode yang sangat, sangat aneh.  Mungkin programmer ingin menghapus elemen terakhir dari wadah.  Dalam hal ini, kode harus seperti ini: <br><br><pre> <code class="cpp hljs">segments.erase(segments.end() - <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  Meskipun, maka akan lebih mudah untuk menulis: <br><br><pre> <code class="cpp hljs">segments.pop_back();</code> </pre> <br>  Sejujurnya, tidak sepenuhnya jelas bagi saya apa yang seharusnya ditulis di sini. <br><br>  <b>Kesalahan N3, N4</b> <br><br>  Saya memutuskan untuk mempertimbangkan dua kesalahan bersama-sama, karena terkait dengan kebocoran sumber daya dan mengharuskan terlebih dahulu untuk menunjukkan apa itu makro <i>WARN_RETURN</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WARN_RETURN(status)\ do\ {\ DEBUG_WARN_ERR(status);\ return status;\ }\ while(0)</span></span></code> </pre> <br>  Jadi, seperti yang Anda lihat, makro <i>WARN_RETURN</i> menyebabkan fungsi untuk keluar dari tubuh.  Sekarang mari kita lihat cara yang tidak akurat untuk menggunakan makro ini. <br><br>  Fragmen pertama. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Status </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sys_generate_random_bytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u8* buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span></span>{ FILE* f = fopen(<span class="hljs-string"><span class="hljs-string">"/dev/urandom"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!f) WARN_RETURN(ERR::FAIL); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (count) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> numread = fread(buf, <span class="hljs-number"><span class="hljs-number">1</span></span>, count, f); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (numread == <span class="hljs-number"><span class="hljs-number">0</span></span>) WARN_RETURN(ERR::FAIL); buf += numread; count -= numread; } fclose(f); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> INFO::OK; }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V773</a> CWE-401 Fungsi ini keluar tanpa melepaskan pegangan 'f'.  Kebocoran sumber daya mungkin terjadi.  unix.cpp 332 <br><br>  Jika fungsi <i>ketakutan</i> tidak dapat membaca data, maka fungsi <i>sys_generate_random_bytes</i> akan keluar tanpa melepaskan deskriptor file.  Dalam praktiknya, ini hampir tidak mungkin.  Sangat diragukan bahwa Anda tidak akan dapat membaca data dari "/ dev / urandom".  Namun, kode itu ceroboh. <br><br>  Fragmen kedua. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Status </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sys_cursor_create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... sys_cursor_impl* impl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> sys_cursor_impl; impl-&gt;image = image; impl-&gt;cursor = XcursorImageLoadCursor(wminfo.info.x11.display, image); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(impl-&gt;cursor == None) WARN_RETURN(ERR::FAIL); *cursor = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;sys_cursor&gt;(impl); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> INFO::OK; }</code> </pre> <br>  Peringatan PVS-Studio: V773 CWE-401 Fungsi ini keluar tanpa melepaskan pointer 'impl'.  Kebocoran memori dimungkinkan.  x.cpp 421 <br><br>  Jika kursor gagal dimuat, kebocoran memori terjadi. <br><br>  <b>Kesalahan N5</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Status </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadHeightmapImageOs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;u8&gt; fileData = <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;u8&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> u8[fileSize]); .... }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V554</a> CWE-762 Penggunaan shared_ptr salah.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '.  MapIO.cpp 54 <br><br>  Opsi yang benar: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;u8[]&gt; fileData = <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;u8&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> u8[fileSize]);</code> </pre> <br>  <b>Kesalahan N6</b> <br><br><pre> <code class="cpp hljs">FUTrackedPtr(ObjectClass* _ptr = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) : ptr(_ptr) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ptr != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) FUTracker::TrackObject((FUTrackable*) ptr); ptr = ptr; }</code> </pre> <br>  PVS-Studio Warning: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V570</a> Variabel 'ptr' ditugaskan untuk dirinya sendiri.  FUTracker.h 122 <br><br>  <b>Kesalahan N7, N8</b> <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::wstring TraceEntry::EncodeAsText() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span> action = (<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>)m_action; <span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span> buf[<span class="hljs-number"><span class="hljs-number">1000</span></span>]; swprintf_s(buf, ARRAY_SIZE(buf), <span class="hljs-string"><span class="hljs-string">L"%#010f: %c \"%ls\" %lu\n"</span></span>, m_timestamp, action, m_pathname.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>().c_str(), (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)m_size); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf; }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V576</a> CWE-628 Format salah.  Pertimbangkan untuk memeriksa argumen aktual kelima dari fungsi 'swprintf_s'.  Argumen tipe char diharapkan.  trace.cpp 93 <br><br>  Di sini kita menemukan sejarah yang bingung dan tidak jelas implementasi alternatif dari fungsi <i>swprintf</i> dalam Visual C ++.  Saya tidak akan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menceritakannya kembali</a> , tetapi merujuk pada dokumentasi untuk diagnostik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V576</a> (lihat bagian "Garis lebar"). <br><br>  Dalam hal ini, kemungkinan besar, kode ini akan berfungsi dengan benar ketika dikompilasi dalam Visual C ++ untuk Windows dan salah ketika membangun untuk Linux atau macOS. <br><br>  Kesalahan serupa: V576 CWE-628 Format salah.  Pertimbangkan untuk memeriksa argumen aktual keempat dari fungsi 'swprintf_s'.  Argumen tipe char diharapkan.  vfs_tree.cpp 211 <br><br>  <b>Kesalahan N9, N10, N11</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Klasik</a>  Pada awalnya, pointer digunakan, dan baru dicentang. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TEST_CAT2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* dst, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span>(dst, dst_val); <span class="hljs-comment"><span class="hljs-comment">// &lt;= int ret = strcat_s(dst, max_dst_chars, src); TS_ASSERT_EQUALS(ret, expected_ret); if(dst != 0) // &lt;= TS_ASSERT(!strcmp(dst, expected_dst)); }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V595</a> CWE-476 Pointer 'dst' digunakan sebelum diverifikasi terhadap nullptr.  Periksa baris: 140, 143. test_secure_crt.h 140 <br><br>  Saya pikir kesalahan tidak memerlukan penjelasan.  Peringatan serupa: <br><br><ul><li>  V595 CWE-476 Pointer 'dst' digunakan sebelum diverifikasi terhadap nullptr.  Periksa baris: 150, 153. test_secure_crt.h 150 </li><li>  V595 CWE-476 Pointer 'dst' digunakan sebelum diverifikasi terhadap nullptr.  Periksa baris: 314, 317. test_secure_crt.h 314 </li></ul><br>  <b>Kesalahan N12</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tbool; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MikkTSpace::setTSpace(...., <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tbool bIsOrientationPreserving, ....) { .... m_NewVertices.push_back(bIsOrientationPreserving &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? <span class="hljs-number"><span class="hljs-number">1.0f</span></span> : (<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>)); .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V674</a> CWE-682 '0,5' literal dari tipe 'ganda' dibandingkan dengan nilai dari tipe 'int'.  Pertimbangkan untuk memeriksa ekspresi 'bIsOrientationPreservasi&gt; 0,5'.  MikktspaceWrap.cpp 137 <br><br>  Tidak masuk akal untuk membandingkan variabel tipe <i>int</i> dengan konstanta 0,5.  Selain itu, dari segi makna, ini umumnya merupakan variabel dari tipe boolean, yang berarti membandingkannya dengan 0,5 terlihat sangat aneh.  Asumsikan bahwa alih-alih <i>bIsOrientationPreserving</i> variabel lain harus digunakan di sini. <br><br>  <b>Kesalahan N13</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Status </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReplaceFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> VfsPath&amp; pathname, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">shared_ptr</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;u8&gt;&amp; fileContents, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ ScopedLock s; VfsDirectory* directory; VfsFile* file; Status st; st = vfs_Lookup(pathname, &amp;m_rootDirectory, directory, &amp;file, VFS_LOOKUP_ADD|VFS_LOOKUP_CREATE); <span class="hljs-comment"><span class="hljs-comment">// There is no such file, create it. if (st == ERR::VFS_FILE_NOT_FOUND) { s.~ScopedLock(); return CreateFile(pathname, fileContents, size); } .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V749</a> CWE-675 Destructor dari objek 's' akan dipanggil untuk kedua kalinya setelah meninggalkan ruang lingkup objek.  vfs.cpp 165 <br><br>  Sebelum membuat file, diperlukan objek bertipe <i>ScopedLock</i> "membuka" objek.  Untuk ini, sebuah destructor secara eksplisit disebut.  Masalahnya adalah destruktor untuk objek <i>s</i> akan dipanggil secara otomatis lagi ketika fungsi keluar.  Yaitu  destructor akan dipanggil dua kali.  Saya belum mempelajari perangkat kelas <i>ScopedLock</i> , tetapi dalam hal apa pun, Anda sebaiknya tidak melakukan ini.  Seringkali, panggilan ganda kepada destruktor menyebabkan perilaku yang tidak terdefinisi atau kesalahan tidak menyenangkan lainnya.  Bahkan jika kodenya berfungsi dengan baik sekarang, sangat mudah untuk memecahkan semuanya dengan mengubah implementasi kelas <i>ScopedLock</i> . <br><br>  <b>Kesalahan N14, N15, N16, N17</b> <br><br><pre> <code class="cpp hljs">CFsmEvent* CFsm::AddEvent( <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> eventType ) { .... pEvent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CFsmEvent( eventType ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !pEvent ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V668</a> CWE-570 Tidak ada gunanya menguji pointer 'pEvent' terhadap null, karena memori dialokasikan menggunakan operator 'baru'.  Pengecualian akan dihasilkan jika terjadi kesalahan alokasi memori.  fsm.cpp 259 <br><br>  Memeriksa pointer tidak masuk akal, karena jika terjadi kesalahan alokasi memori, pengecualian <i>std :: bad_alloc</i> akan <i>dibuang</i> . <br><br>  Jadi, pemeriksaannya berlebihan, tetapi kesalahannya tidak serius.  Namun, semuanya jauh lebih buruk ketika beberapa logika dieksekusi di tubuh <i>pernyataan if</i> .  Pertimbangkan kasus berikut: <br><br><pre> <code class="cpp hljs">CFsmTransition* CFsm::AddTransition(....) { .... CFsmEvent* pEvent = AddEvent( eventType ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !pEvent ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Create new transition CFsmTransition* pNewTransition = new CFsmTransition( state ); if ( !pNewTransition ) { delete pEvent; return NULL; } .... }</span></span></code> </pre> <br>  Peringatan Analyzer: V668 CWE-570 Tidak ada gunanya menguji pointer 'pNewTransition' terhadap nol, karena memori dialokasikan menggunakan operator 'baru'.  Pengecualian akan dihasilkan jika terjadi kesalahan alokasi memori.  fsm.cpp 289 <br><br>  Suatu upaya dilakukan untuk membebaskan memori yang alamatnya disimpan dalam pointer <i>pEvent</i> .  Secara alami, ini tidak akan terjadi dan kebocoran memori akan terjadi. <br><br>  Bahkan, ketika saya mulai berurusan dengan kode ini, ternyata semuanya lebih rumit dan mungkin tidak ada satu kesalahan, tetapi dua.  Sekarang saya akan menjelaskan apa yang salah dengan kode ini.  Untuk melakukan ini, kita perlu membiasakan diri dengan perangkat fungsi <i>AddEvent</i> . <br><br><pre> <code class="cpp hljs">CFsmEvent* CFsm::AddEvent( <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> eventType ) { CFsmEvent* pEvent = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Lookup event by type EventMap::iterator it = m_Events.find( eventType ); if ( it != m_Events.end() ) { pEvent = it-&gt;second; } else { pEvent = new CFsmEvent( eventType ); if ( !pEvent ) return NULL; // Store new event into internal map m_Events[ eventType ] = pEvent; } return pEvent; }</span></span></code> </pre> <br>  Perhatikan bahwa fungsi tidak selalu mengembalikan pointer ke objek baru yang dibuat menggunakan operator <i>baru</i> .  Terkadang mengambil objek yang sudah ada dari wadah <i>m_Events</i> .  Dan penunjuk ke objek yang baru dibuat, omong-omong, juga akan ditempatkan di <i>m_Events</i> . <br><br>  Dan di sini muncul pertanyaan: siapa yang memiliki dan harus menghancurkan benda-benda yang petunjuknya disimpan dalam wadah <i>m_Events</i> ?  Saya tidak terbiasa dengan proyek, tetapi kemungkinan besar di suatu tempat ada kode yang menghancurkan semua objek ini.  Kemudian menghapus objek di dalam fungsi <i>CFsm :: AddTransition</i> umumnya berlebihan. <br><br>  Saya mendapat kesan bahwa Anda cukup menghapus fragmen kode berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !pNewTransition ) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> pEvent; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; }</code> </pre> <br>  Kesalahan lain: <br><br><ul><li>  V668 CWE-571 Tidak ada gunanya menguji pointer 'ret' terhadap null, karena memori dialokasikan menggunakan operator 'baru'.  Pengecualian akan dihasilkan jika terjadi kesalahan alokasi memori.  TerrainTextureEntry.cpp 120 </li><li>  V668 CWE-571 Tidak ada gunanya menguji pointer 'answer' terhadap null, karena memori dialokasikan menggunakan operator 'baru'.  Pengecualian akan dihasilkan jika terjadi kesalahan alokasi memori.  SoundManager.cpp 542 </li></ul><br>  <b>Kesalahan N18, N19</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dir_scan_callback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct de *de, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dir_scan_data</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dsd</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dir_scan_data</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dsd-&gt;entries == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || dsd-&gt;num_entries &gt;= dsd-&gt;arr_size) { dsd-&gt;arr_size *= <span class="hljs-number"><span class="hljs-number">2</span></span>; dsd-&gt;entries = (struct de *) <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(dsd-&gt;entries, dsd-&gt;arr_size * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(dsd-&gt;entries[<span class="hljs-number"><span class="hljs-number">0</span></span>])); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dsd-&gt;entries == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// TODO(lsm): propagate an error to the caller dsd-&gt;num_entries = 0; } else { dsd-&gt;entries[dsd-&gt;num_entries].file_name = mg_strdup(de-&gt;file_name); dsd-&gt;entries[dsd-&gt;num_entries].st = de-&gt;st; dsd-&gt;entries[dsd-&gt;num_entries].conn = de-&gt;conn; dsd-&gt;num_entries++; } }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Peringatan</a> PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V701</a> CWE-401 realloc () kemungkinan kebocoran: ketika realloc () gagal mengalokasikan memori, pointer asli 'dsd-&gt; entri' hilang.  Pertimbangkan untuk menetapkan realloc () ke pointer sementara.  mongoose.cpp 2462 <br><br>  Jika ukuran array menjadi tidak mencukupi, maka memori dialokasikan menggunakan fungsi <i>realloc</i> .  Kesalahannya adalah bahwa nilai pointer ke blok memori asli segera ditimpa dengan nilai baru yang dikembalikan oleh fungsi <i>realokasi</i> . <br><br>  Jika alokasi memori gagal, fungsi <i>realloc</i> akan mengembalikan NULL, dan NULL ini akan ditulis ke variabel <i>entri dsd-&gt;</i> .  Setelah itu tidak mungkin untuk membebaskan blok memori yang alamatnya sebelumnya disimpan dalam <i>entri dsd-&gt;</i> .  Kebocoran memori akan terjadi. <br><br>  Kesalahan lain: V701 CWE-401 realloc () kemungkinan kebocoran: ketika realloc () gagal mengalokasikan memori, penunjuk asli 'Buffer' hilang.  Pertimbangkan untuk menetapkan realloc () ke pointer sementara.  Preprocessor.cpp 84 <br><br><h2>  Kesimpulan </h2><br>  Saya tidak bisa mengatakan bahwa kali ini artikelnya ternyata menarik, atau saya berhasil menunjukkan banyak kesalahan besar.  Apa yang harus dilakukan, sekali waktu tidak perlu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apa yang saya lihat, kemudian saya menulis</a> . <br><br>  Terima kasih atas perhatian anda  Untuk perubahan, saya akan mengakhiri artikel dengan undangan untuk mengikuti saya di Instagram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@pvs_studio_unicorn</a> dan di Twitter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">@Code_Analysis</a> . <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Andrey Karpov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kerja bagus, penulis game 0 AD!</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420267/">https://habr.com/ru/post/id420267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420257/index.html">Apakah Anda masih menginstal Windows 2008? Aku juga, dan itu sebabnya</a></li>
<li><a href="../id420259/index.html">Panel diagnostik penuaan Singapura</a></li>
<li><a href="../id420261/index.html">Apa yang akan kita ukur? Cara memilih metrik ML yang tepat untuk tugas bisnis</a></li>
<li><a href="../id420263/index.html">ServiceNow-conference "Knowledge18"</a></li>
<li><a href="../id420265/index.html">Tujuh Masalah Implementasi Scrum Yang Kami Tidak Ketahui</a></li>
<li><a href="../id420269/index.html">Uang sia-sia: mengapa antiphishing Anda tidak mendeteksi situs phishing dan bagaimana Ilmu Data membuatnya berfungsi?</a></li>
<li><a href="../id420271/index.html">Pelatihan Empati: Merangsang Koneksi Saraf Otak Melalui Video Game</a></li>
<li><a href="../id420273/index.html">Bagaimana mobil penumpang jarak jauh diatur</a></li>
<li><a href="../id420275/index.html">Konferensi besar di Internet tentang hal-hal pada 2018-2019. Rusia dan dunia</a></li>
<li><a href="../id420277/index.html">Setelah Demam Emas: Prospek Teknologi Blockchain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>