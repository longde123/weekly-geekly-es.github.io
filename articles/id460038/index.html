<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛅️ ⚱️ 🛎️ Generasi Bawah Tanah di Diablo 1 🏼 👩🏿‍🏫 👩🏽‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Diablo 1 adalah roguelike hack and slash klasik tahun 1996. Ini adalah salah satu upaya pertama yang berhasil untuk memperkenalkan massa kepada roguel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Generasi Bawah Tanah di Diablo 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460038/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ac/daa/380/7acdaa38058e3058ff1a6ba9a7ca0ce2.png" alt="gambar"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Diablo 1</a> adalah roguelike hack and slash klasik tahun 1996.  Ini adalah salah satu upaya pertama yang berhasil untuk memperkenalkan massa kepada roguelike, yang sampai saat itu memiliki grafik khusus dalam bentuk seni ASCII.  Gim ini menelurkan beberapa sekuel dan banyak simulasi.  Dia dikenal karena suasananya yang gelap dan suram, menebal saat pemain turun ke ruang bawah tanah yang terletak di bawah kota Tristram.  Itu adalah salah satu game pertama dengan pembuatan peta prosedural untuk saya, dan kemungkinan menghasilkan level yang dapat dipercaya seperti itu mengejutkan saya. <br><br>  Baru-baru ini saya menemukan bahwa, karena ditemukannya berbagai file dengan simbol debugging, beberapa penggemar permainan mengambil tugas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rekayasa balik kode sumber</a> untuk membersihkannya dan mencari tahu seperti apa bentuk kode yang ditulis oleh pengembang.  Maka mulailah perjalanan saya selama seminggu ke dalam studi tentang bagaimana pengembang utama David Brevik menciptakan level-level ini.  Mungkin karena ini, keajaiban permainan bagi saya sebagian runtuh, tetapi saya belajar banyak teknik yang akan berguna bagi pengembang game yang serupa, jadi dalam artikel ini saya akan membagikannya. <br><br>  Terima kasih kepada David Brevik dan tim Blizard North yang telah menciptakan game yang luar biasa, serta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">galaxyhaxz</a> dan tim Devilution atas kerja luar biasa mereka dalam memulihkan kode sumber proyek yang dapat dibaca. <br><a name="habracut"></a><br><h1>  Pendahuluan </h1><br>  Diablo adalah game yang terdiri dari ubin isometrik.  Permainan ini terdiri dari 4 tahap, yang masing-masing memiliki 4 level.  Tahapan permainan: Katedral, Katakombe, Gua dan Neraka.  Ada juga beberapa tingkat tetap, misalnya, kota Tristram, yang tidak akan saya pertimbangkan dalam artikel ini.  Diablo memiliki prosedur pembuatan level terpisah untuk masing-masing dari 4 tahap, jadi saya pertama-tama akan berbicara tentang fitur mereka, dan kemudian mempertimbangkan secara terpisah pengoperasian masing-masing tahap. <br><br>  Saya hanya tertarik pada bagaimana level dihasilkan.  Untuk mempelajari tentang pencarian, monster, dll.  Saya sarankan membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jarulf's Guide To Diablo dan Hellfire</a> , yang menjelaskan aspek-aspek ini secara rinci. <br><br><h1>  Fitur Umum </h1><br>  Meskipun setiap tahap memiliki generator level sendiri, mereka semua memiliki fitur umum. <br><br><h2>  Dungeons and Tiles </h2><br>  Setiap level permainan dihasilkan untuk mengisi kotak 40 x 40 ubin.  Sumbu X sesuai dengan tenggara, dan sumbu Y sesuai dengan barat daya. <br><br>  Ubin ini hanya digunakan untuk tugas pembuatan level.  Setelah membuat level, setiap ubin dibagi menjadi 4 "fragmen penjara bawah tanah", yang ditampilkan di layar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aac/af2/49b/aacaf249b2356c104c27fb93a053b87a.png"></div><br>  Kisi yang lebih detail ini digunakan untuk menentukan ubin yang dilalui dan juga menyediakan penggunaan kembali memori grafis yang lebih efisien.  Sebelumnya, saya menulis tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skema pemisahan ubin</a> . <br><br>  Ini berarti bahwa kartu Diablo standar terdiri dari lebih dari seratus ubin, banyak di antaranya merupakan variasi kecil dari yang lain, untuk memperhitungkan semua cara yang memungkinkan untuk menghubungkannya.  Kami akan membicarakan ini nanti. <br><br>  Yang mengejutkan saya, tidak seperti game lain dalam seri ini, peta penjara bawah tanah tidak terdiri dari blok yang dibuat sebelumnya.  Hampir semuanya dibuat dengan menggunakan algoritma. <br><br><h2>  Proses multi-tahap </h2><br>  Setiap prosedur pembuatan dungeon dibagi menjadi dua tahap.  Pra-generasi tidak berurusan dengan pilihan ubin sama sekali.  Ini hanya menghasilkan array di mana ubin lumayan, ubin di mana ada pintu, dan beberapa detail tingkat tinggi lainnya ditandai.  Pada tahap kedua, ruang bawah tanah kosong ini diubah menjadi array ubin, setelah generasi dilakukan dan perubahan dilakukan dengan memperhitungkan ubin ini. <br><br>  Ini harusnya sangat nyaman bagi perancang.  Anda dapat bereksperimen dengan denah lantai yang sepenuhnya independen dari pilihan ubin dan gaya.  Tetapi dalam banyak kasus, mereka saling berhubungan, memberikan rasa tingkat yang lebih holistik. <br><br>  Semua tahap menciptakan ruang bawah tanah kosong dimulai dengan tingkat yang diisi dengan "kekerasan" yang solid, setelah itu masing-masing bagian tingkat secara rekursif berubah menjadi ubin lantai.  Saya akan membahas ini secara lebih rinci di bawah ini. <br><br><h2>  Fragmen Selesai </h2><br>  Fragmen yang sudah jadi adalah blok level yang dibuat sebelumnya yang hanya disisipkan ke level yang dibuat secara acak.  Mereka digunakan untuk sebagian besar pencarian gim.  Di setiap level hanya ada satu fragmen yang sudah jadi, lokasi yang pada setiap tahap dipilih secara terpisah. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/c34/5c5/fefc345c546569296a0e1059c6a2bbbb.gif"></div><br>  <i>Butcher Den adalah salah satu cuplikan pra-dibuat pertama yang ditemukan dalam permainan.</i> <br><br><h2>  Set mini </h2><br>  Mini-kit adalah cara lain untuk menyisipkan konten ke tingkat konten yang dibuat sebelumnya.  Ini adalah potongan-potongan kecil, biasanya berukuran sekitar 3 × 3, dimasukkan secara acak ke dalam penjara bawah tanah.  Ada skema pencocokan pola yang sederhana, karena hanya muncul di tempat yang “benar”.  Seringkali mereka dikodekan dengan persyaratan tambahan, misalnya, mini-set tidak dapat ditempatkan berdekatan satu sama lain, mereka tidak dapat tumpang tindih dengan fragmen yang sudah jadi, dan sebagainya.  Beberapa mini-kit selalu mencari dan mengganti, sementara yang lain melakukan ini dengan probabilitas tetap. <br><br>  Kit mini Diablo digunakan untuk berbagai tujuan.  Mereka digunakan untuk menempatkan benda besar dari ubin, seperti tangga, untuk memperbaiki kombinasi ubin yang tidak terhubung dengan baik satu sama lain, dan untuk menambahkan variasi acak ke ubin. <br><br><h2>  Kamar tematik </h2><br>  Kamar bertema adalah ruang kecil yang dibatasi oleh dinding dan pintu.  Biasanya di dalamnya secara acak benda-benda tertentu yang telah ditentukan berada.  Sebagai contoh, perpustakaan selalu memiliki rak buku dengan dua lilin di setiap sisi, beberapa rak buku dan monster acak.  Monster Lairs berisi banyak monster dan item acak, dan sebagainya. <br><br>  Pada tingkat tahap athedral, generator menciptakan ruangan yang cocok yang dikenali dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengisi</a> dan digunakan kembali.  Pada tahap lain, algoritma menemukan ruang terbuka di mana dinding dan pintu digambar untuk membuat kamar. <br><br>  Setiap jenis ruang tematik memiliki persyaratan tertentu untuk ukuran dan tahap pembuatannya. <br><br><h2>  Penggantian ubin </h2><br>  Beberapa kartu memiliki adaptasi khusus ubin, tetapi semuanya memiliki fitur umum: beberapa ubin dapat diganti dengan variasi yang serupa.  Ubin paling standar (misalnya, lantai dan dinding datar) memiliki berbagai variasi, yang mengurangi monoton tingkat.  Penggantian ubin tidak pernah digunakan kembali berdampingan. <br><br><h2>  Perbandingan pola dan "koreksi" </h2><br>  Seperti disebutkan di atas, mini-set digunakan sebagai mekanisme pencarian dan penggantian yang memperbaiki kekurangan generator.  Tetapi pada sebagian besar tahapan, ada prosedur yang mendeteksi dan memperbaiki masalah yang lebih spesifik.  Saya tidak akan merinci, karena hanya ada banyak dari mereka.  Cukuplah untuk mengatakan bahwa Diablo cukup buggy, dan lebih dekat dengan rilis itu menjadi jelas bahwa akan lebih mudah untuk menambahkan pengakuan masalah spesifik daripada menghilangkan penyebab mendasar mereka. <br><br>  Salah satu "perbaikan" yang paling umum adalah "penguncian": itu memeriksa apakah mungkin untuk melewati seluruh ruang bawah tanah, dan memulai generasi lagi jika tidak. <br><br><h2>  Quests </h2><br>  Sebagian besar pencarian dibuat menggunakan fragmen siap pakai, tetapi beberapa menggunakan logika mereka sendiri.  Misalnya, Zhar the Mad membuat ruang perpustakaan tematik, pintu masuk ke Poisoned Water dihasilkan oleh panggilan mini, dan Anvil of Fury memiliki kode generasi level tertentu.  Saya tidak akan merinci, tetapi kode ini penuh dengan pemeriksaan serupa untuk pencarian. <br><br><h1>  Katedral </h1><br>  Katedral mungkin adalah yang paling ikonik dari tahapan Diablo.  Ini ditandai dengan barisan panjang lengkungan Gothic, kamar sempit dan banyak kemacetan dalam bentuk pintu.  Mari kita lihat bagaimana itu dibuat. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68a/04e/c56/68a04ec568d05dac4c8f8c2040d68680.png" alt="gambar"></div><br><h2>  Ruang bawah tanah kosong </h2><br>  Hal pertama yang dilakukan algoritma adalah menggambar inti kartu.  Dia secara acak memilih hingga tiga kamar 10 × 10 dalam posisi yang telah ditentukan di sepanjang sumbu pusat X atau Y. Sebuah koridor lebar yang menghubungkan kamar-kamar juga digambar di sepanjang sumbu.  Jika ada bagian yang selesai pada tingkat, maka selalu terletak di tengah salah satu kamar ini.  Kamar-kamar bawah tanah pusat ini ditandai sebagai tidak cocok untuk dinding baru, sehingga mereka selalu tetap ruang terbuka yang besar. <br><br>  Semua kamar lain dihasilkan oleh teknik tunas rekursif dalam fungsi yang disebut <code>L5roomGen</code> , yang dipicu di masing-masing kamar ini, dan dengan memilih sumbu. <br><br><h3>  Fungsi L5roomGen </h3><br><ul><li>  Dia melewati persegi panjang ruang asli, dari mana Anda harus mulai bertunas, serta sumbu yang disukai. </li><li>  Dengan probabilitas 1/4, sumbu yang diinginkan berubah. </li><li>  Ukuran acak dari ruangan baru dipilih, dengan 2, 4 atau 6 ubin di setiap sisi. </li><li>  Untuk setiap sisi ruang asli sepanjang sumbu yang dipilih (mis. SE / NS untuk X, SW / NE untuk Y): <br><ul><li>  Persegi panjang ruangan baru sejajar dengan pusat tepi ruang asli </li><li>  Cek dilakukan sebelum ada tidak ada yang ditarik dan kami tidak mencapai akhir peta.  Dinding membutuhkan batas satu ubin. </li><li>  Jika cek berhasil, sebuah kamar ditarik. </li></ul></li><li>  Untuk setiap kamar yang akan <code>L5roomGen</code> , <code>L5roomGen</code> secara rekursif disebut, yang melewati ruang baru dan sumbu yang berlawanan dengan yang digunakan sebelumnya. </li></ul><br>  Pada akhirnya, prosedur ini dimulai dengan beberapa ruangan terpotong di dalam ubin "solid", dan kemudian berulang kali menempel persegi panjang baru untuk memotong area lumayan baru.  Pada tahap ini, semua "kamar" terbuka di satu sisi, karena setiap kamar baru terletak tepat di sebelah yang sebelumnya, tanpa melewati untuk menempatkan dinding. <br><br>  Kemudian generator menghitung jumlah ubin yang dilalui yang dihasilkan.  Jika di bawah ambang minimum, yang meningkat dengan setiap level, penjara bawah tanah dihancurkan dan upaya generasi dilakukan lagi. <br><br><h2>  Penjara bawah tanah </h2><br>  Sejauh ini, algoritme hanya memiliki ubin "solid" dan gender.  Kita harus menggantinya dengan ubin dinding asli.  Untuk ini, Diablo menggunakan algoritma kotak marching, yang saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jelaskan di artikel sebelumnya</a> . <br><br>  Namun, gim ini menggunakan variasi yang tidak biasa.  Ubin katedral berisi dinding, tetapi selalu terletak di ujung ubin.  Oleh karena itu, ada ubin dengan dinding di tepi timur laut, tetapi tidak ada ubin dengan dinding di tepi tenggara.  Untuk membuat dinding di sisi lain, Anda perlu menemukan ubin "solid" yang memiliki dinding tambahan yang memanjang keluar dari perbatasan ubin.  Kedengarannya aneh, tetapi sebenarnya sangat nyaman untuk menyortir dinding dengan kedalaman. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b65/14b/193/b6514b19377666d0c7b06bf76002dd08.svg"></div><br>  Untuk mengatasinya, Diablo melompati beberapa dinding selama fase kubus berbaris: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/553/284/1c2/5532841c2542510b979e4dae6dee2183.svg"></div><br>  Dinding tambahan ditambahkan kemudian, pada tahap "perbaikan".  Saya pikir prosedur sederhana ini paling memengaruhi "gaya" katedral.  Karena dinding yang berlawanan melekat pada ubin padat, dalam hal dua kamar dipisahkan oleh satu ubin dinding, dinding yang berlawanan tidak akan dibuat.  Ini berarti bahwa pembagi antara kamar "lebih tipis" daripada yang biasanya Anda dapatkan dalam resolusi di mana kotak marching dieksekusi. <br><br>  Setelah menempatkan dinding utama, generator menambahkan empat kolom yang berdiri bebas untuk masing-masing kamar pusat dan barisan tiang lengkung untuk koridor tengah.  Ini memungkinkan Anda memberi katedral rasa desain yang lebih serius daripada level lain, dan juga membantu pemain menavigasi. <br><br>  Generator kemudian secara acak menambahkan dinding pemisah.  Dinding pemisah selalu lurus sepanjang sumbu dari satu dinding ke dinding lainnya.  Mereka mulai dari sudut, sehingga area indah dibagi menjadi kamar.  Dalam 25% kasus, dinding adalah serangkaian lengkungan, dalam 25% kasus itu adalah serangkaian lengkungan dengan kisi-kisi yang menghalangi pintu masuk, dan dalam semua kasus lainnya adalah dinding yang kokoh.  Dalam kasus kisi-kisi dan dinding kokoh, di suatu tempat di sepanjang dinding pemisah, sebuah pintu atau lengkungan ditambahkan secara acak untuk membuat ruang tersebut bisa dilewati. <br><br>  Prosedur pengisian mendeteksi ruangan bertema potensial. <br><br>  Tangga ditempatkan untuk terhubung ke level lain.  Jika tidak mungkin untuk menempatkan mereka, maka upaya untuk menghasilkan penjara bawah tanah dimulai lagi. <br><br>  Adapun pengaturan mini-set, "perbaikan" dan penggantian, saya tidak akan mempertimbangkannya secara rinci.  Yang terpenting, saya suka mini-kit PANCREAS1, yang memiliki peluang 1% untuk menaruh tumpukan daging berdarah di ubin lantai.  Pada akhirnya, 5-10 benda lampu ditempatkan di atasnya untuk menghias penjara bawah tanah. <br><br><h1>  Katakombe </h1><br>  Berbeda dengan Katedral, yang tampaknya merupakan bangunan yang dirancang, Catacombs terasa jauh lebih spontan.  Mereka ditandai oleh kamar-kamar persegi yang saling terhubung oleh banyak koridor berliku.  Di banyak tempat, bukannya pintu, bukaan lebar berada.  meningkatkan kemungkinan bahwa pemain akan dikelilingi oleh banyak musuh. <br><br>  Algoritma generasi paling kompleks dalam game digunakan untuk menghasilkan katakombe.  Saya menduga bahwa kurangnya waktu telah memaksa pengembang untuk menerapkan solusi yang lebih sederhana di tahap selanjutnya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/086/22d/49e/08622d49e3f39ea4fca7d81a67393183.jpg" alt="gambar"></div><br><h2>  Ruang bawah tanah kosong </h2><br>  Prosedur untuk membuat ruang bawah tanah kosong untuk katakombe cukup unik.  Pada semua tahap lain, ada nilai Boolean tunggal yang menunjukkan ada atau tidak adanya jenis kelamin (ditambah satu set bit untuk detail tambahan).  Catacombs menyimpan ruang bawah tanah kosong dalam bentuk kartu ASCII, hampir seperti roguelike klasik.  Dan ini tidak terlalu mengejutkan mengingat pengakuan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">David Brevik bahwa ia mendapatkan inspirasi untuk Diablo dari Angband</a> . <br><br>  Generator ruang utama lagi adalah algoritma rekursif, tetapi kali ini partisi rekursif.  Fungsi <code>CreateRoom</code> dipanggil untuk seluruh area penjara bawah tanah 40 × 40 minus 1 ubin perbatasan. <br><br><h3>  Fungsi CreateRoom </h3><br><ul><li>  Fungsi <code>CreateRoom</code> dilewatkan persegi panjang yang menunjukkan area di mana Anda ingin menghasilkan kamar.  Detail juga diteruskan ke fungsi tentang ruang asli (awalnya nol) </li><li>  Jika area terlalu sempit, fungsi keluar. </li><li>  Ukuran acak dipilih untuk ruangan dari 4 hingga 9 ubin di setiap sisi, dengan mempertimbangkan ukuran maksimum area di mana Anda ingin menempatkan ruangan. </li><li>  Di area tersebut, posisi acak dipilih untuk menempatkan ruangan. </li><li>  Ruangan dirender pada peta ASCII.  Dalam gambar, simbol <code>'.'</code>  ubin lantai ditunjukkan, simbol <code>'#'</code> adalah dinding di sekitarnya, dan huruf <code>'A'</code> , <code>'B'</code> , <code>'C'</code> dan <code>'E'</code> adalah empat sudutnya. </li><li>  Jika kamar memiliki ruang sumber: <br><ul><li>  Ubin acak dipilih di tepi terdekat ruang asli dan baru. </li><li>  Informasi ini dicatat dalam daftar koridor, yang akan digunakan nanti. </li></ul></li><li>  Bagian yang tersisa dari daerah itu, dengan pengecualian ruangan saat ini, dipotong, menciptakan empat persegi panjang. </li><li>  Ukuran setiap persegi panjang dikurangi oleh dua ubin untuk membuat ruang antara kamar, dan kemudian fungsi <code>CreateRoom</code> disebut secara rekursif, wilayah yang digunakan persegi panjang ini, dan ruang yang dibuat sebagai sumber. </li></ul><br>  Jika ada fragmen yang selesai pada peta, itu akan selalu berada di ruang pertama yang dibuat oleh CreateRoom, dan dimensinya dibuat sehingga fragmen ini ditempatkan di dalamnya. <br><br>  Setelah memanggil <code>CreateRoom</code> mendapatkan larik ASCII yang mirip dengan yang ditunjukkan di bawah ini (terima kasih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nomdenom</a> untuk mengekstraksinya dari kode): <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>#<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #..# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #..# #....# #..# #....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>#<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#EA</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.....# #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>#######<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.....# #........# #.....# #........# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #........# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #........# #.# #........# #.# #........# #.# #........# #.# #........# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>#######<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#BC</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.# #....# #.# #....# #.# #....# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>###<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.# #.# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#BC</span></span><span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span>##<span class="hljs-selector-id"><span class="hljs-selector-id">#B</span></span> #.....# #...# #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>##<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span> #.....# <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>####<span class="hljs-selector-id"><span class="hljs-selector-id">#E</span></span></code> </pre><br>  Dalam hal ini, ruang "root", awalnya dibuat, adalah yang terendah. <br><br>  Kemudian informasi koridor yang dikumpulkan sebelumnya diterapkan.  Garis digambar di antara setiap pasangan poin yang direkam.  Ketika melintasi dinding, <code>'D'</code> ditulis, dan ketika melintasi ubin padat, <code>','</code> .  Koridor memiliki lebar acak: 1, 2 atau 3. Ubin sudut digunakan untuk membantu navigasi. <br><br>  Jika pintu berdekatan dengan pintu lain, maka mereka dilewati, dan koridor dapat saling tumpang tindih, yang memungkinkan Anda untuk menyembunyikan kesederhanaan generator. <br><br>  Setelah merekam semua koridor, kartu ASCII dihapus.  Ubin sudut menjadi ubin dinding, dan ubin <code>' '</code> sebelah <code>','</code> juga menjadi dinding.  Akhirnya, karakter <code>','</code> diganti oleh karakter <code>'.'</code>  .  Jadi kita mendapatkan rencana penjara bawah tanah yang ditunjukkan di bawah ini. <br><br><pre> <code class="hljs css">#### #..# ###### #..# #....# #..# #....# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## #....# #.# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #..# #.....# #..# ###.....# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>######## #<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....# #........# #.#.....# #........# ### #.#<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #........# #.### #.##...# #........###<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.##...# #........##..#.# #.##...# #........##..#.# #.##...# #........##..#.# #.##...# #........##..#.# #.##...# ##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#######..#.# #.##...# #.......#..#.# #.##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## ###.....#..### #.# #.# ######<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>##.# #.# #.# #....#.# #.# #.# #...<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.# #.# #....###### #.# #.# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####....## #.# #.# #...........# #.# #.# ####....##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####.# ### ######.....##.# #####<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....##.# #..<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.#....<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>..# #####.#.....#### #########</code> </pre><br>  Seperti yang Anda lihat, prosedur ini dapat menyisakan cukup banyak ruang kosong di peta.  Oleh karena itu, langkah selanjutnya dari generator adalah "mengisi rongga".  Dia mencari setiap bagian dinding yang berdekatan dengan lantai persegi tambahan yang dapat direkatkan.  Persegi panjang bisa berukuran setidaknya 5 × 5 dan tidak lebih dari 12 × 14. <br><br>  Pengisian batal berlanjut hingga minimal 700 ubin diperoleh, atau batas coba lagi tercapai.  Jika generator gagal mencapai 700 ubin, maka generasi dungeon dimulai dari nol. <br><br>  Ini memberi kami ruang bawah tanah kosong yang ditunjukkan di bawah ini. <br><br><pre> <code class="hljs css"> ########## #........# ########### #........# #.........# #........# #.........# #........# #.........# #### #........# #.........# #..# #######..###.........# #..# #..............# #..# #..............# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## #..............# #.# <span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####.........# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #..# ########### #.....# #..# ###.....# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>######## #<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....# #........# #.#.....# ########........# ### #.#<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#### #...............# #.### #.##...# #...............###<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.##...# #...............##..#.# #.##...# #...............##..#.# #.##...# #...............##..#.# #.##...# #...............##..#.# #.##...# #......##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>#######..#.# #.##...# #......# #.......#..#.# #.##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>## #......# ###.....#..### #.# #.# #......########<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>##.# #.# #.# #.........# #....#.# #.# #.# #.........# #...<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.# #.# #.# #.........# #....###### #.# #.# #.........# #<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####....## #.# #.# #.........# #...........# #.# #.# #.........# ####....##<span class="hljs-selector-id"><span class="hljs-selector-id">#D</span></span>####.# ### #.........# ######.....##.# #.........# #####<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.....##.# #.........# #..<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>.#....<span class="hljs-selector-class"><span class="hljs-selector-class">.D</span></span>..# ########### #####.#.....#### #########</code> </pre><br><h2>  Penjara bawah tanah </h2><br>  Sekali lagi, katakombe berbeda dari rumus tingkat standar.  Alih-alih algoritma kotak marching (yang menetapkan ubin berdasarkan kotak 2x2 dari ruang bawah tanah kosong), ia menggunakan prosedur pencocokan pola sendiri, yang memeriksa masing-masing dari 3 × 3 persegi panjang dari ruang kosong dan memilih ubin yang sesuai untuk ruang bawah tanah.  Pola menentukan apa yang harus setiap ubin penjara bawah tanah: dinding, lantai, pintu, ubin padat, atau kombinasi daripadanya.  Saya tidak mengerti mengapa. <br><br>  Sisa dari fungsi tersebut akan terasa akrab bagi Anda dari Katedral.  Tangga naik dan turun ditempatkan di peta, penjara bawah tanah diperiksa untuk kemungkinan bagian yang lengkap, dan berbagai koreksi juga dilakukan.  Seperti dijelaskan di bagian Fitur Umum, kamar dimasukkan, diikuti oleh banyak set mini dan penggantian ubin. <br><br>  Saya pikir bahwa mini-set entah bagaimana mempengaruhi pintu, tetapi mereka cukup membosankan untuk dibaca tanpa alat, jadi saya tidak mempelajari topik ini. <br><br><h1>  Gua </h1><br>  Tingkat gua dipenuhi dengan ruang terbuka yang luas dan sungai lava.  Dinding area ini kasar dan bergelombang.  Satu-satunya komponen persegi panjang di sini adalah perancah kayu, yang tampaknya muncul lebih lambat dari gua itu sendiri. <br><br>  Tahap ini adalah salah satu yang paling indah di dalam gim ini berkat animasi lava.  Orang merasa bahwa itu sangat berbeda dari lantai sebelumnya yang terdiri dari kamar.  Oleh karena itu, saya sangat terkejut bahwa bagian utama dari generasi ini dimodelkan sesuai dengan prinsip-prinsip panggung Katedral, dan kartu diberi tampilan yang lebih "gua" menggunakan trik rumit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9b6/b2c/a41/9b6b2ca41b1a48ad9aebcd9be48ee162.jpg" alt="gambar"></div><br><h2>  Ruang bawah tanah kosong </h2><br>  Membuat level gua dimulai dengan satu ruangan 2 × 2 acak yang terletak di suatu tempat dekat dengan pusat peta.  Generator kemudian memanggil prosedur <code>DRLG_L3CreateBlock</code> untuk setiap tepi blok ini. <br><br>  Saat menggambar persegi panjang pada level ini, isian normal tidak digunakan.  Interior selalu solid, tetapi setiap ubin di perbatasan memiliki peluang 50% untuk menjadi lantai, jika tidak tetap solid. <br><br><h3>  Prosedur DRLG_L3CreateBlock </h3><br><ul><li>  Fungsi ini mendapatkan tepi kotak, mis.  titik awal, arah dan panjang. </li><li>  Ukuran blok yang baru dibuat dipilih dalam kisaran 3-4 untuk setiap sisi. </li><li>  Blok baru ditempatkan secara acak relatif ke tepi input. </li><li>  Jika tidak ada cukup ruang untuk menggambar blok, maka keluar dilakukan. </li><li>  Blok ditarik. </li><li>  Dengan probabilitas 1/4, output dieksekusi. </li><li>  <code>DRLG_L3CreateBlock</code> disebut <code>DRLG_L3CreateBlock</code> untuk tiga sisi, selain yang kami <code>DRLG_L3CreateBlock</code> . </li></ul><br>  Meskipun prosedur ini mirip dengan <code>L5roomGen</code> , menggunakan ukuran blok yang jauh lebih kecil dan menggambar batas kasar memberikannya tampilan yang jauh lebih organik.  Selain itu, itu tidak termasuk perbatasan 1 ubin untuk dinding, oleh karena itu, tidak seperti generator sebelumnya, dapat membuat loop. <br><br>  Setelah membuat sketsa kasar bentuk dungeon, generator menerapkan prosedur erosi: <br><br><ul><li>  Pertama, ia menemukan area 2 × 2 ubin dengan ubin padat diagonal berlawanan.  Seringkali sulit untuk bekerja dengan formasi seperti itu ketika melakukan pawai, sehingga salah satu ubin padat diganti secara acak berdasarkan gender. </li><li>  Semua ubin tunggal solid yang dikelilingi oleh 8 ubin lantai diganti dengan ubin lantai. </li><li>  Semua bagian dinding yang panjang dan lurus dikasar secara acak dengan mengganti 50% dinding dengan ubin lantai. </li><li>  Diagonal dari ubin terus menerus dihilangkan berulang kali. </li></ul><br>  Semua prosedur ini menambahkan lebih banyak ubin lantai, sehingga peta menjadi lebih terbuka. <br><br>  Jika memiliki kurang dari 600 ubin lantai, maka peta dibuat ulang. <br><br><h2>  Penjara bawah tanah </h2><br>  Kosong penjara bawah tanah dikonversi ke ubin menggunakan kotak marching.  Tidak seperti Cathedral dan Catacombs, tileset jauh lebih nyaman di sini, dan berisi hampir semua kombinasi yang diperlukan untuk marching square.  Tidak ada ubin untuk dinding diagonal berlawanan di dalamnya, tetapi mereka dihilangkan dalam fase benda kerja, sehingga mereka tidak pernah muncul. <br><br>  Lalu, seperti biasa, ada banyak set mini.  Kode memiliki beberapa set mini yang menentukan bagian dinding yang terpisah dan menggantinya dengan stalagmit dan lantai, yang meningkatkan keterbukaan ruang. <br><br>  Danau lava ditambahkan.  Algoritma mencari bagian dinding yang berdekatan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">isian</a> .  Jika ia berhasil menemukan bagian dinding / ubin padat kurang dari 40 ubin yang sepenuhnya dikelilingi oleh ubin lantai, maka mereka diganti dengan lava.  Jika danau lava tidak dapat ditemukan, maka generasi dungeon mulai lagi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/282/8a4/716/2828a4716c9319b5399e76ccb04b11a9.png"></div><br>  <i>Dinding 3 × 3 berubah menjadi danau lava</i> <br><br>  Kemudian ditambahkan beberapa sungai lava.  Generator membuat beberapa upaya untuk menggambar sungai mulai dari danau lava dan berakhir di dinding.  Persyaratan berikut diberlakukan pada sungai: tidak boleh menyeberang sendiri, sungai memiliki panjang 7-100 ubin, dan harus ada tempat yang cocok untuk jembatan di atasnya.  Ubin jembatan memastikan bahwa seluruh peta tetap bisa dilewati.  Jika ada ruang di peta, dapat ditambahkan hingga empat sungai. <br><br>  Kemudian ditempatkan kamar bertema.  Pada tahap ini, dinding kamar tematik adalah pagar kayu, yang melaluinya Anda tidak bisa melewatinya, tetapi Anda bisa menyaksikannya.  Pagar kayu juga digunakan dalam dua prosedur berikut.  Yang pertama menempatkan pagar di semua bagian dinding yang tersisa, memiliki bagian lurus yang cukup panjang.  Yang kedua menggambar garis pagar di peta, dari satu dinding ke seberang, dan kemudian menyisipkan pintu.  Berbeda dengan prosedur untuk membuat katedral, ia tidak mencari sudut untuk mulai membuat dinding ini. <br><br><h1>  Neraka </h1><br>  Neraka adalah tahap terakhir dari Diablo.  Di dalamnya, penekanan utama sudah pada monster, dan desain level berjalan di pinggir jalan.  Tahap ini memiliki tileset terkecil dari semua, dan sebagian besar digunakan untuk tangga besar dan pentagram.  Tingkat neraka biasanya terdiri dari beberapa kamar persegi dan memiliki tata letak simetris. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/180/9a3/804/1809a38040316bde51bb114a03f10f99.png" alt="gambar"></div><br><h2>  Ruang bawah tanah kosong </h2><br>  Generasi neraka dimulai dengan ruang acak 5-6 ubin di setiap sisi (lebih jika ada fragmen siap pakai untuk pencarian di dalamnya), dan kemudian penanaman rekursif yang sama diterapkan seperti di Katedral.  Namun, generasi dibatasi hingga 20 × 20. <br><br>  Koridor vertikal dan horizontal ditambahkan, membentang ke tepi area 20 × 20. <br><br>  Kemudian ruang bawah tanah kosong dicerminkan secara horizontal dan vertikal untuk mendapatkan ukuran penuh. <br><br><h2>  Penjara bawah tanah </h2><br>  Kosong penjara bawah tanah dikonversi kembali ke ubin menggunakan kotak marching.  Kemudian, mirip dengan penciptaan Katedral, dinding ditambahkan, seperti di Catacombs dan Gua. <br><br><h1>  Kesimpulan </h1><br>  Saya sangat menikmati membaca kode ini.  Meskipun jelas ada bug di dalamnya, nama-nama tersebut ditetapkan secara acak, dan beberapa bagian tidak dapat dibuat ulang dalam kode sumber berkualitas tinggi, jelas terlihat bahwa kode ini lulus ujian serius melalui pertempuran dan penuh dengan ide-ide cerdas. <br><br>  Inilah pelajaran paling penting bagi saya: <br><br><ul><li>  Iblis ada dalam perinciannya: komponen-komponen individual tidaklah rumit, tetapi ketika digabungkan, mereka memberikan sesuatu yang luar biasa.  Saya bisa membayangkan bagaimana para pengembang meneliti peningkatan kualitas sampai tingkat berubah dari hanya baik menjadi luar biasa.  Jumlah ubin dan kompleksitas kombinatorial dari tileset juga sangat tinggi - tidak mungkin untuk menerapkan ini tanpa memperhatikan bagaimana elemen-elemen terhubung. </li><li>  Cari dan ganti untuk pencocokan pola adalah alat yang sangat ampuh yang dengannya Anda dapat menerapkan banyak efek berbeda.  Ini memperbaiki bug generasi, menambahkan variabilitas, menyisipkan konten yang dibuat sebelumnya, mengelola erosi dan banyak lagi. </li><li>  Membagi generasi penjara bawah tanah menjadi peta kelaikan (persiapan penjara bawah tanah) dan generasi ubin juga merupakan teknik yang sangat mudah, baik dari segi desain dan debugging. </li><li>       ,       .      ,         . </li><li>   ,      . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460038/">https://habr.com/ru/post/id460038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460020/index.html">Apa Deno dan bagaimana proyek ini berbeda dari Node.js?</a></li>
<li><a href="../id460022/index.html">PHP Digest No. 160 (1 - 15 Juli 2019)</a></li>
<li><a href="../id460028/index.html">Pemecahan masalah dengan pwnable.kr 04 - flag. File Eksekusi yang Dikemas</a></li>
<li><a href="../id460030/index.html">Pengembangan asli, React Native and Flutter: kriteria pemilihan</a></li>
<li><a href="../id460036/index.html">Keterampilan B2B Alice: dari prototipe hingga rubel pertama disimpan</a></li>
<li><a href="../id460040/index.html">Dapatkan pernyataan USRN dari Rosreestr menggunakan python, mem-bypass api</a></li>
<li><a href="../id460044/index.html">Kontrol suhu pemanas oven, dengan timer pada Arduino</a></li>
<li><a href="../id460046/index.html">Python BDD Framework Framework Perbandingan: Pro dan Kontra</a></li>
<li><a href="../id460048/index.html">Bagaimana kami membangun manajemen kerentanan</a></li>
<li><a href="../id460050/index.html">NeoQUEST 2019 tatap muka: di dunia cybersecurity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>