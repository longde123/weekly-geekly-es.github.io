<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍💼 🔋 👩‍👩‍👧‍👦 جهاز RS232 3 في 1 لخادم Linux منزلي: الجزء 1 (الأجهزة) Ⓜ️ 🙋🏽 🙎🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- الجزء 1 (الأجهزة) مخطط الدائرة لوحة الدوائر البرمجيات 
- مخطط الدائرة
- لوحة الدوائر
- البرمجيات
- الجزء 2 (الخادم)
 

, , . . . , Linux , : , .
 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>جهاز RS232 3 في 1 لخادم Linux منزلي: الجزء 1 (الأجهزة)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/394261/"><ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء 1 (الأجهزة)</font></font></strong><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مخطط الدائرة</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لوحة الدوائر</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">البرمجيات</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء 2 (الخادم)</font></font></a></li>
</ul><br>
<p>,        ,    .              .         .    ,   Linux       ,  :  ,     .</p><br>
<p>         ,    Wi-Fi,      .</p><br>
<p>   ,         ,        .  ,      3--1   RS232 (COM) .    :</p><br>
<ul>
<li>  ,       <code>watchdog</code>;</li>
<li>          p-n ;</li>
<li> nRF24L01+      .</li>
</ul><br>
<p>     WRN     : WDT (WatchDog Timer), RNG (Random Number Generator), nRF24L01+.</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/6b0/170/387/6b017038743ee2a7d30af616d240e3e6.png" alt="جهاز WRN"></p><a name="habracut"></a><br>
<p>  ,  ,         ,   <code>rngd</code>   <code>--rng-device=/dev/urandom</code>.   <code>/dev/urandom</code>    ,     RNG,    ,  .</p><br>
<a name="wrn_schematic"></a> <br>
<h2 id="principialnaya-shema"> </h2><br>
<p><em>(  )</em><br>
<a href=""><img src="https://habrastorage.org/getpro/habr/post_images/874/9d0/126/8749d01261e2d18a49bb4067dcc89f56.png" alt="مخطط الدائرة"></a></p><br>
<p>     ATmega328P      20MHz.  ,  ,      32MHz    ,     .            ,    , .       ,  ,            .</p><br>
<p>      SPI   USB-UART ,    ,       RS232   .    ,     ,    .     ,   KiCAD   GitHub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">alexcustos/wrn-project</a>   <strong>pcb</strong>.</p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><ul>
<li><strong>C12</strong> –   ,    - ;</li>
<li><strong>Y1, C3, C4</strong> –    ;</li>
<li><strong>D1, R11</strong> –        ,  ,      ;</li>
<li><strong>PB1, R2</strong> –  RESET   (pull-up)            ;</li>
<li><strong>U1, C1, C2</strong> –       ,   800mA    , 100mA   ;</li>
<li><strong>U2, R1</strong> –   ,    20mA   ;</li>
<li><strong>U3, C5, C6, C9, C10</strong> –   RS232-TTL   ;</li>
<li><strong>P3, C11</strong> –  +5  +12V   FDD     12V;</li>
<li><strong>P4</strong> –    ;</li>
<li><strong>P1</strong> – ISP      ,    ;</li>
<li><strong>P2</strong> –      RS232 ;</li>
<li><strong>P5</strong> –       RESET       ;</li>
<li><strong>P7</strong> –     USB-UART.</li>
</ul></div></div><br>
<h3 id="preobrazovatel-urovney-rs232-ttl">  RS232-TTL</h3><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/c90/a78/d63/c90a78d63fa67853f75e63d888e9a29d.png" alt="محول المستوى RS232-TTL"></p><br>
<p>   ADM202EANZ  Analog Devices  ,      MAX232ACPE    .              Maxim.</p><br>
<p> <strong>R3, R4, R12</strong>      USB-UART .        ,      .      1kΩ,         ,     <strong>U3</strong>    .</p><br>
<p>  SPI     ,        .     SPI  ,       .</p><br>
<p>    ,    .    DTR (Data Terminal Ready)    ,         .</p><br>
<p>    ,     <strong>Q4</strong>       DTR    .    ,     .  <strong>R6</strong> ,      ;  <strong>C7</strong> –    RESET.</p><br>
<p>         ,      ,      <strong>JP1</strong>.      ,   USB-UART .</p><br>
<h3 id="generator-shuma-na-effekte-lavinnogo-proboya-p-n-perehoda">      p-n </h3><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/8f8/f84/2d4/8f8f842d4c68c83349503a02d7677dc5.png" alt="مولد الضجيج"></p><br>
<p>     p-n   <strong>Q1</strong>.   Vebo=6V,        ( ) .            ,   ,     12V.     p-n        ,     .     ,         p-n ,     .     ,        ,    1N4148,  100V.</p><br>
<p>     : <strong>Q2</strong>    <strong>Q1</strong>; <strong>R5</strong>     - <strong>Q2</strong>; <strong>C8</strong>      <strong>Q2</strong>,   ; (<strong>R7+R8</strong>)     - <strong>Q3</strong>        <strong>C8</strong>; <strong>Q3</strong>     <strong>C8</strong>  (<strong>R7+R8</strong>); <strong>R9, R10</strong> ,    5V   .</p><br>
<a name="wrn_pcb"></a> <br>
<h2 id="pechatnaya-plata"> </h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>   ,        KiCAD.    ,     . </p><br>
<p>      ,          .      <strong>Edge.Cuts</strong>  <img src="https://habrastorage.org/getpro/habr/post_images/e92/dc9/287/e92dc928723b7a38183d4b7c80b6096d.png" alt="إضافة خط رسومي أو مضلع">   ,        .</p><br>
<p>      (<strong>Pads</strong>)  .   ,          .       ,      ,        .</p><br>
<p>    ,    <code>pcbnew</code>    ,         .       .      ,      1,      .      ,      ,             .</p><br>
<p>    (<strong>Pad</strong>)        E,        <img src="https://habrastorage.org/getpro/habr/post_images/913/6e4/58b/9136e458b1150d93429b64902d21a110.png" alt="وسادة">,  <img src="https://habrastorage.org/getpro/habr/post_images/f99/389/b60/f99389b60f7c04ec04dfd05ade486b26.png" alt="تحرير لوحة">.   ,      ,   <img src="https://habrastorage.org/getpro/habr/post_images/7a1/439/2a8/7a14392a84812a92e76b8b84f288a24f.png" alt="انسخ الإعدادات الحالية إلى هذه اللوحة">,        <img src="https://habrastorage.org/getpro/habr/post_images/925/73d/49a/92573d49a6dcf24fc8b4cc68346feeec.png" alt="تحرير جميع الوسادات">.     ,        (<strong>Footprint</strong>)   .        ,    .</p><br>
<p>      <strong>Perform design rules check</strong> <img src="https://habrastorage.org/getpro/habr/post_images/310/d0f/f15/310d0ff15d9c4c0995f6139fd25535d3.png" alt="إجراء فحص قواعد التصميم"> → <strong>Start DRC</strong>   <strong>Problems / Markers</strong>  <strong>Unconnected</strong>   .</p><br>
<p>    ,    .        <strong>View</strong> → <strong>3D Viewer</strong>.      Gerber  (-  PDF  ) <strong>File</strong> → <strong>Plot</strong> → <strong>Gerber</strong> (Plot format),    ,   : <strong>B.Cu</strong>, <strong>Edge.Cuts</strong>   <strong>Plot</strong>,      <strong>Generate Drill File</strong> → <strong>Drill File</strong>,    .</p><br>
<p> KiCAD    GerbView <img src="https://habrastorage.org/getpro/habr/post_images/3b5/a2a/890/3b5a2a890d2efafb7e71a0ec7e5193ab.png" alt="جيربفيو">,      .    ,     <strong>File</strong> → <strong>Print</strong>     .    <strong>B.Cu</strong>,    <strong>Print frame ref</strong>      .    <strong>Real drill</strong>     ,    ,     <strong>Small mark</strong>    ( )  .   , ,   .</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><ul>
<li>  — <strong>Real drill</strong>  ,   Dremel 0.8,  -  3/4,   1.0,  :      ,    , DIP    ;</li>
<li>  — <strong>Real drill</strong>  ,   1.0,    ,  ;</li>
<li>  — <strong>Small mark</strong>,     ,  1.0  ,     1.0   0.9,   1.1,  ;</li>
<li>  — <strong>Real drill</strong>  ,      ,  3  1.0,  ,      .</li>
</ul></div></div><br>
<p>     «».   ,       .          . ,  ,  .</p><br>
<div class="spoiler"><b class="spoiler_title"> (- )</b><div class="spoiler_text"><p>              .      .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/716/e30/86c/716e3086c4ba660a79ed2a5d7989ed13.png" alt=""></p><br>
<p>    180°C ( ) ,   .        , ,       ,     .        ,  - .       .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/acd/b76/4a0/acdb764a007ef227ccd7c71e7b5ae405.png" alt=" "></p><br>
<p>  ,  ,     .     ,    ,    .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/713/6c6/2fa/7136c62fa19e7dc5d02c1fd3009de52c.png" alt=" "></p><br>
<p>      :</p><br>
<ul>
<li>100  ;</li>
<li>6  ;</li>
<li>50   ;</li>
<li>20  (  )  .</li>
</ul><br>
<p>    100  3%  ,     ,   .</p><br>
<p>     ,    <strong> </strong>      .   ,    :      .      ,      ,  ,   , .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/d7e/959/eca/d7e959ecacdc67a4320fd517c6869899.png" alt="  "></p><br>
<p>     .         .       ,   ,   . ,  30°C      ,       23°C,     .               .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/881/962/925/881962925ca20f38ac138b17cafa4bb4.png" alt=" "></p><br>
<p>  ,       ,       2-3 .   ,  ,     .    40-50 .      ,   ,        .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/818/7f2/be0/8187f2be00c935b450057ce0a5621ce4.png" alt=" "></p><br>
<p>      .    .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/2f9/fb8/478/2f9fb8478a7bc73045d23f63e864eaa8.png" alt="  "></p><br>
<p>   ,         .      .      ( <strong> </strong>     ),  ,      5 ,       (    )  -   .       ,                   .      ,    ,     .        - ,    .</p><br>
<p>,     ,      ,     ,          .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/0a1/c83/f22/0a1c83f2265c4f4786e30dcd7928fa39.png" alt=" "></p><br>
<p>     ,    ,      .</p><br>
<p><em>(  )</em><br>
<a href=""><img src="https://habrastorage.org/getpro/habr/post_images/181/b5e/f51/181b5ef51c26c9422a622e09a4dfdefd.png" alt="  "></a></p></div></div><br>
<p>    :</p><br>
<p><em>(  )</em><br>
<a href=""><img src="https://habrastorage.org/getpro/habr/post_images/546/ac0/005/546ac0005e5ee5c18ca78d048fc9f300.png" alt="منتج ملحوم"></a></p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/183/a12/0e6/183a120e6fdc8370b895a81b636b0be8.png" alt="المنتج المثبت"></p><br>
<a name="wrn_firmware"></a> <br>
<h2 id="programmnoe-obespechenie"> </h2><br>
<p>   C++  AtmelStudio,      GitHub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">alexcustos/wrn-project</a>   <strong>wrn</strong>.      Arduino IDE             Arduino.       ,     .       GitHub    :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">alexcustos/RF24</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">alexcustos/RF24Network</a></li>
</ul><br>
<p>      ,      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ATtiny85:   </a>.</p><br>
<h3 id="zagruzchik"></h3><br>
<p>       . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Optiboot</a> —  ,   Atmel AVR .      ,            ,   ,  ,      .</p><br>
<p>  , ,   ,    SPI   .       ,  ,   ,  .</p><br>
<p>    ,   Ubuntu   :</p><br>
<pre><code class="bash hljs">sudo apt-get install git gcc-avr binutils-avr gdb-avr avr-libc avrdude</code></pre><br>
<p> :</p><br>
<pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Optiboot/optiboot.git
<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> optiboot/optiboot/bootloaders/optiboot<font></font>
make atmega328_isp AVR_FREQ=20000000L BAUD_RATE=115200 LED=C0 EFUSE=FD HFUSE=DE LFUSE=F7 ISPTOOL=stk500v1 ISPPORT=/dev/ttyACM0</code></pre><br>
<p>      ,  ,       .      :</p><br>
<pre><code class="html hljs xml">BAUD RATE CHECK: Desired: 115200, Real: 113636, UBRRL = 21, Error=-1.3%</code></pre><br>
<p> <strong>Real</strong>   ,   ,     USB-UART       ,   RS232-TTL   .  <strong>Error</strong>  0.0%   ,    1-2     ,    —  .</p><br>
<p>    20MHz     BAUD_RATE  250000.       RS232-TTL ,  ADM202EANZ    230000,      57600.   115200  ,    ,   .     ,  <code>avrdude</code>  ,  ,     .</p><br>
<p>FUSE-:</p><br>
<ul>
<li>EFUSE=<strong>FD</strong> –      EEPROM     2.7V,   <strong>FC</strong> (4.3V),        USB  2.7V .</li>
<li>HFUSE=<strong>DE</strong> – 512  ,   SPI ;</li>
<li>LFUSE=<strong>F7</strong> –  full-swing     ,    ,         XTAL2.</li>
</ul><br>
<p>   (ISPTOOL, ISPPORT)  arduino  ,   ,  -    .</p><br>
<p>         : <a href="">optiboot_atmega328p_20MHz.hex</a>.       <code>avrdude</code>   :</p><br>
<pre><code class="bash hljs">avrdude -C/etc/avrdude.conf -v -patmega328p -cstk500v1 -P/dev/ttyACM0 -b19200 \<font></font>
    -e -Ulock:w:0x3F:m -Uefuse:w:0xFD:m -Uhfuse:w:0xDE:m -Ulfuse:w:0xF7:m \<font></font>
    -Uflash:w:<span class="hljs-string"><span class="hljs-string">"optiboot_atmega328p_20MHz.hex"</span></span>:i -Ulock:w:0x2F:m</code></pre><br>
<p>     ,   ,  :  ,   ,  FUSE-,        .</p><br>
<p>   ,        ,   Optiboot   ,     .</p><br>
<h3 id="mikroprogramma"></h3><br>
<p>     ,        .    ,     .</p><br>
<p>  SPI      F_CPU.           <code>-DF_CPU=20000000L</code>.      ,            F_CPU.</p><br>
<p> main()      ,      :</p><br>
<ul>
<li>   ;</li>
<li>   ;</li>
<li>   ;</li>
<li>    ;</li>
<li>    ;</li>
<li>       .</li>
</ul><br>
<p>        <code>[C|W|R|N][0-99]:[1]:[2]</code>,   ,   ,       —  ,   .       .</p><br>
<p>   (struct)   .     ,     ,    .     ,      .   ,      <code>-fpack-struct</code>,  AtmelStudio     .</p><br>
<p>       ,     ,         ,   .     ,      .      ,  — . </p><br>
<p>       .       ,    .      ,        .</p><br>
<p>         ,    EEPROM .              .</p><br>
<p>                 (uptime).    uptime    .          .</p><br>
<p>      - ,  ,      ,    .         uint16_t (~12.5 ).</p><br>
<h3 id="programmnye-chasy"> </h3><br>
<p>       8  .      RF24/RF24Network,      .      ,     1000   , 64  : <code>20000000 () / 256 (8 ) / 64 () ~= 1220</code>,      <code>256 * 64 * 1000 / 20000000 = 8192/10000 = 512/625</code> .   TIMER0_OVF         :</p><br>
<pre><code class="cpp hljs">m += MILLIS_INC;  <span class="hljs-comment"><span class="hljs-comment">// = 0,    ,    () </span></span>
f += FRACT_INC;  <span class="hljs-comment"><span class="hljs-comment">// = 512,   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f &gt;= FRACT_MAX) {  <span class="hljs-comment"><span class="hljs-comment">// = 625,      </span></span>
    f -= FRACT_MAX;  <span class="hljs-comment"><span class="hljs-comment">// </span></span>
    m += <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
}</code></pre><br>
<p>,            ,   ,        .</p><br>
<h3 id="generator-istinno-sluchaynyh-chisel">   </h3><br>
<p>,       p-n ,        p-n  -    .                .  ,        .</p><br>
<p>         ,   ,               .</p><br>
<p>,    ,  ,    ,    ,    ,      ,     .</p><br>
<pre><code class="cpp hljs">measure = read_measure();  <span class="hljs-comment"><span class="hljs-comment">//   8   10 ( )</span></span>
num_measures++;  <span class="hljs-comment"><span class="hljs-comment">//      (  )</span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">// measure_limit &gt; 0    </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num_measures == measure_limit) {<font></font>
    balance = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pan_left &gt; pan_right) fault = pan_left - pan_right;
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fault = pan_right — pan_left;
    <span class="hljs-comment"><span class="hljs-comment">//     measure_limit,       </span></span>
    acceptable_fault = ((measure_limit - <span class="hljs-number"><span class="hljs-number">1</span></span>) / <span class="hljs-number"><span class="hljs-number">256</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span>;<font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fault &gt; acceptable_fault) {
        <span class="hljs-comment"><span class="hljs-comment">//    ,</span></span>
        <span class="hljs-comment"><span class="hljs-comment">//  ,     ,   </span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pan_right &gt; pan_left &amp;&amp; threshold &lt; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>(<span class="hljs-number"><span class="hljs-number">-1</span></span>)) threshold++;
        <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pan_left &gt;= pan_right &amp;&amp; threshold &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) threshold--;<font></font>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> balance = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
<font></font>
    ... <span class="hljs-comment"><span class="hljs-comment">//  pan_left, pan_right, num_measures ( )</span></span>
    ... <span class="hljs-comment"><span class="hljs-comment">//      (  )</span></span><font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (balance &amp;&amp; measure_limit) {  <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
        measure_limit = <span class="hljs-number"><span class="hljs-number">0</span></span>;  <span class="hljs-comment"><span class="hljs-comment">// ,    </span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;  <span class="hljs-comment"><span class="hljs-comment">//  ,       </span></span><font></font>
    }<font></font>
} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {  <span class="hljs-comment"><span class="hljs-comment">//   ,     </span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (measure &lt;= threshold) pan_left++;
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pan_right++;<font></font>
}</code></pre><br>
<p> :</p><br>
<pre><code class="cpp hljs">byte &lt;&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>;  <span class="hljs-comment"><span class="hljs-comment">//   ,     num_measures % 8 == 0</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (measure &gt; threshold) byte |= <span class="hljs-number"><span class="hljs-number">0b00000001</span></span>;</code></pre><br>
<p>   <code>rngtest</code>   rngd      monobit .        ,  ,      ADC  «»,       .     ,    :</p><br>
<pre><code class="cpp hljs">byte ^= bit_flip;  <span class="hljs-comment"><span class="hljs-comment">// XOR     </span></span>
bit_flip = !bit_flip;</code></pre><br>
<p>     ,       ,     monobit .            .   636 /         <code>dieharder</code>    .        -    500MB.   ,     .           <code>/dev/urandom</code>.   <code>dieharder</code>     .</p><br>
<div class="spoiler"><b class="spoiler_title">rngtest</b><div class="spoiler_text"><pre>rngtest: bits received from input: 4195417088<font></font>
rngtest: FIPS 140-2 successes: 209549<font></font>
rngtest: FIPS 140-2 failures: 221<font></font>
rngtest: FIPS 140-2(2001-10-10) Monobit: 21<font></font>
rngtest: FIPS 140-2(2001-10-10) Poker: 70<font></font>
rngtest: FIPS 140-2(2001-10-10) Runs: 59<font></font>
rngtest: FIPS 140-2(2001-10-10) Long run: 72<font></font>
rngtest: FIPS 140-2(2001-10-10) Continuous run: 0<font></font>
</pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">rngtest (/dev/urandom)</b><div class="spoiler_text"><pre>rngtest: bits received from input: 4181721088<font></font>
rngtest: FIPS 140-2 successes: 208937<font></font>
rngtest: FIPS 140-2 failures: 149<font></font>
rngtest: FIPS 140-2(2001-10-10) Monobit: 20<font></font>
rngtest: FIPS 140-2(2001-10-10) Poker: 21<font></font>
rngtest: FIPS 140-2(2001-10-10) Runs: 57<font></font>
rngtest: FIPS 140-2(2001-10-10) Long run: 52<font></font>
rngtest: FIPS 140-2(2001-10-10) Continuous run: 0<font></font>
</pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">dieharder</b><div class="spoiler_text"><pre>#=============================================================================#<font></font>
#            dieharder version 3.31.1 Copyright 2003 Robert G. Brown          #<font></font>
#=============================================================================#<font></font>
   rng_name    |rands/second|   Seed   |<font></font>
stdin_input_raw|  1.99e+07  | 871678203|<font></font>
#=============================================================================#<font></font>
             test_name   |ntup| tsamples |psamples|  p-value |Assessment<font></font>
#=============================================================================#<font></font>
  0:    diehard_birthdays|   0|       100|     100|0.23013568|  PASSED<font></font>
  1:       diehard_operm5|   0|   1000000|     100|0.41464749|  PASSED<font></font>
  3:     diehard_rank_6x8|   0|    100000|     100|0.83194246|  PASSED<font></font>
  4:    diehard_bitstream|   0|   2097152|     100|0.98469009|  PASSED<font></font>
  7:          diehard_dna|   0|   2097152|     100|0.82184561|  PASSED<font></font>
  8: diehard_count_1s_str|   0|    256000|     100|0.63516902|  PASSED<font></font>
 10:  diehard_parking_lot|   0|     12000|     100|0.15579947|  PASSED<font></font>
 11:     diehard_2dsphere|   2|      8000|     100|0.94799044|  PASSED<font></font>
 12:     diehard_3dsphere|   3|      4000|     100|0.16755480|  PASSED<font></font>
 14:         diehard_sums|   0|       100|     100|0.00420819|   WEAK<font></font>
 15:         diehard_runs|   0|    100000|     100|0.58812798|  PASSED<font></font>
 15:         diehard_runs|   0|    100000|     100|0.23381862|  PASSED<font></font>
100:          sts_monobit|   1|    100000|     100|0.11747720|  PASSED<font></font>
101:             sts_runs|   2|    100000|     100|0.12598371|  PASSED<font></font>
102:           sts_serial|   1|    100000|     100|0.11747720|  PASSED<font></font>
102:           sts_serial|   2|    100000|     100|0.98806196|  PASSED<font></font>
102:           sts_serial|   3|    100000|     100|0.93420112|  PASSED<font></font>
102:           sts_serial|   3|    100000|     100|0.88625906|  PASSED<font></font>
102:           sts_serial|   4|    100000|     100|0.81837353|  PASSED<font></font>
102:           sts_serial|   4|    100000|     100|0.44680983|  PASSED<font></font>
102:           sts_serial|   5|    100000|     100|0.30069422|  PASSED<font></font>
102:           sts_serial|   5|    100000|     100|0.59918415|  PASSED<font></font>
102:           sts_serial|   6|    100000|     100|0.94111872|  PASSED<font></font>
102:           sts_serial|   6|    100000|     100|0.97775411|  PASSED<font></font>
102:           sts_serial|   7|    100000|     100|0.71034876|  PASSED<font></font>
102:           sts_serial|   7|    100000|     100|0.37205549|  PASSED<font></font>
102:           sts_serial|   8|    100000|     100|0.62281679|  PASSED<font></font>
102:           sts_serial|   8|    100000|     100|0.61865217|  PASSED<font></font>
102:           sts_serial|   9|    100000|     100|0.12357283|  PASSED<font></font>
102:           sts_serial|   9|    100000|     100|0.62028539|  PASSED<font></font>
102:           sts_serial|  10|    100000|     100|0.70302730|  PASSED<font></font>
102:           sts_serial|  10|    100000|     100|0.36150774|  PASSED<font></font>
102:           sts_serial|  11|    100000|     100|0.02416524|  PASSED<font></font>
102:           sts_serial|  11|    100000|     100|0.00210157|   WEAK<font></font>
102:           sts_serial|  12|    100000|     100|0.15545193|  PASSED<font></font>
102:           sts_serial|  12|    100000|     100|0.25167693|  PASSED<font></font>
102:           sts_serial|  13|    100000|     100|0.19659046|  PASSED<font></font>
102:           sts_serial|  13|    100000|     100|0.56538654|  PASSED<font></font>
102:           sts_serial|  14|    100000|     100|0.15529368|  PASSED<font></font>
102:           sts_serial|  14|    100000|     100|0.99005364|  PASSED<font></font>
102:           sts_serial|  15|    100000|     100|0.15517199|  PASSED<font></font>
102:           sts_serial|  15|    100000|     100|0.91135159|  PASSED<font></font>
102:           sts_serial|  16|    100000|     100|0.70484328|  PASSED<font></font>
102:           sts_serial|  16|    100000|     100|0.71149544|  PASSED<font></font>
201: rgb_minimum_distance|   0|     10000|    1000|0.00000000|  FAILED<font></font>
202:     rgb_permutations|   5|    100000|     100|0.72724154|  PASSED<font></font>
203:       rgb_lagged_sum|   0|   1000000|     100|0.79186771|  PASSED<font></font>
204:      rgb_kstest_test|   0|     10000|    1000|0.46365770|  PASSED<font></font>
206:              dab_dct| 256|     50000|       1|0.53224869|  PASSED<font></font>
207:         dab_filltree|  32|  15000000|       1|0.87205525|  PASSED<font></font>
207:         dab_filltree|  32|  15000000|       1|0.28341671|  PASSED<font></font>
208:        dab_filltree2|   0|   5000000|       1|0.69766563|  PASSED<font></font>
208:        dab_filltree2|   1|   5000000|       1|0.68877816|  PASSED<font></font>
209:         dab_monobit2|  12|  65000000|       1|0.99154840|  PASSED<font></font>
</pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">dieharder (/dev/urandom)</b><div class="spoiler_text"><pre>#=============================================================================#<font></font>
#            dieharder version 3.31.1 Copyright 2003 Robert G. Brown          #<font></font>
#=============================================================================#<font></font>
   rng_name    |rands/second|   Seed   |<font></font>
stdin_input_raw|  2.09e+07  |2043744116|<font></font>
#=============================================================================#<font></font>
             test_name   |ntup| tsamples |psamples|  p-value |Assessment<font></font>
#=============================================================================#<font></font>
  0:    diehard_birthdays|   0|       100|     100|0.04140546|  PASSED<font></font>
  1:       diehard_operm5|   0|   1000000|     100|0.37860771|  PASSED<font></font>
  3:     diehard_rank_6x8|   0|    100000|     100|0.51810908|  PASSED<font></font>
  4:    diehard_bitstream|   0|   2097152|     100|0.87265669|  PASSED<font></font>
  7:          diehard_dna|   0|   2097152|     100|0.28188785|  PASSED<font></font>
  8: diehard_count_1s_str|   0|    256000|     100|0.01571303|  PASSED<font></font>
 10:  diehard_parking_lot|   0|     12000|     100|0.27155245|  PASSED<font></font>
 11:     diehard_2dsphere|   2|      8000|     100|0.56675436|  PASSED<font></font>
 12:     diehard_3dsphere|   3|      4000|     100|0.95480977|  PASSED<font></font>
 14:         diehard_sums|   0|       100|     100|0.00076186|   WEAK<font></font>
 15:         diehard_runs|   0|    100000|     100|0.62119123|  PASSED<font></font>
 15:         diehard_runs|   0|    100000|     100|0.79241488|  PASSED<font></font>
100:          sts_monobit|   1|    100000|     100|0.76618520|  PASSED<font></font>
101:             sts_runs|   2|    100000|     100|0.89128426|  PASSED<font></font>
102:           sts_serial|   1|    100000|     100|0.76618520|  PASSED<font></font>
102:           sts_serial|   2|    100000|     100|0.51804588|  PASSED<font></font>
102:           sts_serial|   3|    100000|     100|0.54076681|  PASSED<font></font>
102:           sts_serial|   3|    100000|     100|0.51414389|  PASSED<font></font>
102:           sts_serial|   4|    100000|     100|0.18600760|  PASSED<font></font>
102:           sts_serial|   4|    100000|     100|0.22984905|  PASSED<font></font>
102:           sts_serial|   5|    100000|     100|0.25883020|  PASSED<font></font>
102:           sts_serial|   5|    100000|     100|0.99315299|  PASSED<font></font>
102:           sts_serial|   6|    100000|     100|0.40048642|  PASSED<font></font>
102:           sts_serial|   6|    100000|     100|0.73022511|  PASSED<font></font>
102:           sts_serial|   7|    100000|     100|0.79035813|  PASSED<font></font>
102:           sts_serial|   7|    100000|     100|0.91930371|  PASSED<font></font>
102:           sts_serial|   8|    100000|     100|0.51635740|  PASSED<font></font>
102:           sts_serial|   8|    100000|     100|0.87010763|  PASSED<font></font>
102:           sts_serial|   9|    100000|     100|0.95493347|  PASSED<font></font>
102:           sts_serial|   9|    100000|     100|0.15935465|  PASSED<font></font>
102:           sts_serial|  10|    100000|     100|0.32276697|  PASSED<font></font>
102:           sts_serial|  10|    100000|     100|0.67645664|  PASSED<font></font>
102:           sts_serial|  11|    100000|     100|0.64714937|  PASSED<font></font>
102:           sts_serial|  11|    100000|     100|0.83931114|  PASSED<font></font>
102:           sts_serial|  12|    100000|     100|0.98898429|  PASSED<font></font>
102:           sts_serial|  12|    100000|     100|0.98306183|  PASSED<font></font>
102:           sts_serial|  13|    100000|     100|0.73353342|  PASSED<font></font>
102:           sts_serial|  13|    100000|     100|0.75717141|  PASSED<font></font>
102:           sts_serial|  14|    100000|     100|0.18283051|  PASSED<font></font>
102:           sts_serial|  14|    100000|     100|0.52874060|  PASSED<font></font>
102:           sts_serial|  15|    100000|     100|0.35740156|  PASSED<font></font>
102:           sts_serial|  15|    100000|     100|0.83391413|  PASSED<font></font>
102:           sts_serial|  16|    100000|     100|0.61391208|  PASSED<font></font>
102:           sts_serial|  16|    100000|     100|0.83537094|  PASSED<font></font>
201: rgb_minimum_distance|   0|     10000|    1000|0.00000000|  FAILED<font></font>
202:     rgb_permutations|   5|    100000|     100|0.85828591|  PASSED<font></font>
203:       rgb_lagged_sum|   0|   1000000|     100|0.84986413|  PASSED<font></font>
204:      rgb_kstest_test|   0|     10000|    1000|0.25942548|  PASSED<font></font>
206:              dab_dct| 256|     50000|       1|0.62442278|  PASSED<font></font>
207:         dab_filltree|  32|  15000000|       1|0.39920277|  PASSED<font></font>
207:         dab_filltree|  32|  15000000|       1|0.57982406|  PASSED<font></font>
208:        dab_filltree2|   0|   5000000|       1|0.90094772|  PASSED<font></font>
208:        dab_filltree2|   1|   5000000|       1|0.58950861|  PASSED<font></font>
209:         dab_monobit2|  12|  65000000|       1|0.94848945|  PASSED<font></font>
</pre></div></div><br>
<p>   201  - ,    .    :</p><br>
<pre><code class="bash hljs">cat /dev/urandom | dieharder -g 200 -d 201</code></pre><br>
<p>    ,     :</p><br>
<pre><code class="bash hljs">cat /dev/urandom | dieharder -g 200 -a</code></pre><br>
<p>  :</p><br>
<pre>rgb_minimum_distance|   2|     10000|    1000|0.20617106|  PASSED<font></font>
rgb_minimum_distance|   3|     10000|    1000|0.00275459|   WEAK<font></font>
rgb_minimum_distance|   4|     10000|    1000|0.47683577|  PASSED<font></font>
rgb_minimum_distance|   5|     10000|    1000|0.92418653|  PASSED<font></font>
</pre><br>
<p>  dieharder,   p-value (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">P-</a>).     ,       [0, 1]     .   ≤ 0.01  ≥ 0.99    1% ,    [0.3, 0.4)  10%    .       0  1,         .</p><br>
<p>        FIPS  ,     ( 1:1250),     ,   <code>rngd</code>     .     ,     ,   ,  ,  ,        .</p><br>
<p><strong>Updated:</strong>          1324 /,      :</p><br>
<div class="spoiler"><b class="spoiler_title">rngtest ( )</b><div class="spoiler_text"><pre>rngtest: bits received from input: 724458496<font></font>
rngtest: FIPS 140-2 successes: 36199<font></font>
rngtest: FIPS 140-2 failures: 23<font></font>
rngtest: FIPS 140-2(2001-10-10) Monobit: 2<font></font>
rngtest: FIPS 140-2(2001-10-10) Poker: 2<font></font>
rngtest: FIPS 140-2(2001-10-10) Runs: 10<font></font>
rngtest: FIPS 140-2(2001-10-10) Long run: 9<font></font>
rngtest: FIPS 140-2(2001-10-10) Continuous run: 0<font></font>
</pre></div></div><br>
<p>       ,      .        (acceptable_fault).     ,         (threshold),   ,       threshold.       .</p><br>
<p>    AtmelStudio   <strong>Tools</strong> → <strong>External Tools...</strong>:</p><br>
<pre><code class="html hljs xml">Title: Deploy<font></font>
Command: D:\UTILS\avrdude\avrdude.exe<font></font>
Arguments: -CD:\UTILS\avrdude\avrdude.conf -v -patmega328p -carduino -PCOM5 -b113636 -D -Uflash:w:"$(BinDir)\$(TargetName).hex":i<font></font>
Use Output window ()</code></pre><br>
<p>       USB-UART .     113636,       .    ,     $(BinDir),       ,     ,       <strong>wrn</strong> .</p><br>
<p>  ,    : <a href="">wrn_atmega328p_20MHz.hex</a>.    USB-UART  Linux       :</p><br>
<pre><code class="bash hljs">avrdude -C/etc/avrdude.conf -v -patmega328p -carduino -P/dev/ttyUSB0 -b113636 -D -Uflash:w:<span class="hljs-string"><span class="hljs-string">"wrn_atmega328p_20MHz.hex"</span></span>:i</code></pre><br>
<p> ,    RS232,     , ,    ,  DTR  :</p><br>
<pre><code class="bash hljs">wrnctrl flash wrn_atmega328p_20MHz.hex</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اقرأ المزيد عن برنامج خادم Linux في المقالة التالية المتاحة على Habrahabr على: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء 2 (الخادم)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar394261/">https://habr.com/ru/post/ar394261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar394249/index.html">تعلن Coinbase عن دعم Ethereum</a></li>
<li><a href="../ar394251/index.html">Dell XPS 12: Когда не надо выбирать между ноутбуком и планшетом</a></li>
<li><a href="../ar394255/index.html">شرح علمي لسبب عدم تمكنك من التقاط فاتورة بالدولار بإصبعين</a></li>
<li><a href="../ar394257/index.html">64٪ من الأوروبيين يؤيدون فكرة الدخل الأساسي غير المشروط</a></li>
<li><a href="../ar394259/index.html">نقود مثالية</a></li>
<li><a href="../ar394263/index.html">حذف أو عدم حذف المجموعات في VK؟ .. هذا هو السؤال</a></li>
<li><a href="../ar394265/index.html">البرمجة هي لغة بين الناس والآلات يجب أن يمتلكها الجميع.</a></li>
<li><a href="../ar394267/index.html">مبيعات B2B عبر الإنترنت</a></li>
<li><a href="../ar394271/index.html">أدوات تبسيط العطلة في الدولة وفي الدولة</a></li>
<li><a href="../ar394273/index.html">26-летний мужчина получил протез руки с зарядкой для телефона, фонариком и дроном</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>