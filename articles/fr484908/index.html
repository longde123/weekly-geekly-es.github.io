<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ ğŸ¦ HighLoad ++, Eugene Kuzovlev (EcommPay IT): que faire quand une minute d'arrÃªt coÃ»te 100 000 $ ğŸ‘©ğŸ¾â€ğŸ« ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ‘©ğŸ¾â€ğŸš€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tout le monde parle des processus de dÃ©veloppement et de test, de formation du personnel, de motivation croissante, mais ces processus sont rares lors...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Eugene Kuzovlev (EcommPay IT): que faire quand une minute d'arrÃªt coÃ»te 100 000 $</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484908/"> Tout le monde parle des processus de dÃ©veloppement et de test, de formation du personnel, de motivation croissante, mais ces processus sont rares lorsqu'une minute d'arrÃªt de service coÃ»te de l'argent.  Que faire lorsque vous effectuez des transactions financiÃ¨res dans le cadre d'un SLA strict?  Comment augmenter la fiabilitÃ© et la tolÃ©rance aux pannes de vos systÃ¨mes, en dÃ©crivant le dÃ©veloppement et les tests? <br><br><img src="https://habrastorage.org/webt/dz/-p/tn/dz-ptnygkaqhxsm07hgsfil2fxq.jpeg"><br><br>  La prochaine confÃ©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 Ã  Saint-PÃ©tersbourg.  DÃ©tails et billets <a href="http://bit.ly/2sSxgBx">ici</a> .  9 novembre, 18h00.  HighLoad ++ Moscou 2018, Delhi + Calcutta Hall.  RÃ©sumÃ©s et <a href="http://www.highload.ru/moscow/2018/abstracts/4226">prÃ©sentation</a> . <a name="habracut"></a><br><br>  <b>Evgeny Kuzovlev (ci-aprÃ¨s dÃ©nommÃ©e la CE):</b> - Amis, bonjour!  Je m'appelle Kuzovlev Evgeny.  Je viens d'EcommPay, une division spÃ©cifique est EcommPay IT, une division informatique d'un groupe de sociÃ©tÃ©s.  Et aujourd'hui, nous allons parler des temps d'arrÃªt - comment les Ã©viter, comment minimiser leurs consÃ©quences, si vous ne pouvez pas les Ã©viter.  Le thÃ¨me est: "Que faire quand une minute d'arrÃªt coÃ»te 100 000 $?"  Pour nous, pour l'avenir, les chiffres sont comparables. <br><br><h3>  Que fait EcommPay IT? </h3><br>  Qui sommes nous  Pourquoi suis-je debout devant toi?  Pourquoi ai-je le droit de vous dire quelque chose ici?  Et de quoi parlerons-nous plus en dÃ©tail ici? <br><br><img src="https://habrastorage.org/webt/id/bv/so/idbvsod8gah5mhw25b4pnidb8d4.jpeg"><br><br>  EcommPay Group of Companies est un acquÃ©reur international.  Nous traitons les paiements dans le monde entier - en Russie, en Europe, en Asie du Sud-Est (partout dans le monde).  Nous avons 9 bureaux, 500 employÃ©s au total et environ un peu moins de la moitiÃ© d'entre eux sont des informaticiens.  Tout ce que nous faisons, tout ce sur quoi nous gagnons de l'argent, nous l'avons fait nous-mÃªmes. <br><br>  Nous avons tous nos produits (et nous en avons beaucoup - dans la gamme des grands produits informatiques, nous avons environ 16 composants diffÃ©rents), nous nous sommes Ã©crits;  nous nous Ã©crivons, nous nous dÃ©veloppons.  Et en ce moment, nous effectuons environ un million de transactions par jour (des millions - il sera probablement juste de le dire).  Nous sommes une entreprise assez jeune - nous n'avons que six ans environ. <br><br>  Il y a 6 ans, c'Ã©tait une telle startup lorsque les gars sont venus avec l'entreprise.  Ils Ã©taient unis par une idÃ©e (il n'y avait rien d'autre qu'une idÃ©e), et nous avons couru.  Comme toute startup, nous avons couru plus vite ... Pour nous, la vitesse Ã©tait plus importante que la qualitÃ©. <br><br>  Ã€ un moment donnÃ©, nous nous sommes arrÃªtÃ©s: nous avons rÃ©alisÃ© que nous ne pouvions plus vivre Ã  cette vitesse et avec cette qualitÃ©, et nous devions en premier lieu faire de la qualitÃ©.  Ã€ ce stade, nous avons dÃ©cidÃ© d'Ã©crire une nouvelle plateforme qui sera juste, Ã©volutive, fiable.  Ils ont commencÃ© Ã  Ã©crire cette plate-forme (ils ont commencÃ© Ã  investir, Ã  dÃ©velopper le dÃ©veloppement, les tests), mais Ã  un moment donnÃ©, ils ont rÃ©alisÃ© que le dÃ©veloppement et les tests ne permettaient pas d'atteindre un nouveau niveau de qualitÃ© de service. <br><br>  Vous fabriquez un nouveau produit, vous le mettez en production, mais quelque part, quelque chose ne va pas.  Et aujourd'hui, nous allons parler de la faÃ§on d'atteindre un nouveau niveau qualitatif (comment nous l'avons obtenu, de notre expÃ©rience), en retirant le dÃ©veloppement et les tests de l'image;  nous allons parler de ce qui est disponible pour l'exploitation - ce que l'exploitation peut faire d'elle-mÃªme, ce qu'elle peut offrir des tests afin d'affecter la qualitÃ©. <br><br><h3>  Temps d'arrÃªt.  Les commandements de l'exploitation. </h3><br>  La principale pierre angulaire, dont nous allons rÃ©ellement parler aujourd'hui, est toujours les temps d'arrÃªt.  Mot effrayant.  Si nous avions un temps d'arrÃªt, tout va mal avec nous.  Nous courons pour augmenter, les administrateurs tiennent le serveur - Dieu ne plaise, il ne tombe pas, comme dans cette chanson.  Câ€™est ce dont nous allons parler aujourdâ€™hui. <br><br><img src="https://habrastorage.org/webt/7w/nd/t8/7wndt8zz0lal9gvkglnu8zcc-fw.jpeg"><br><br>  Lorsque nous avons commencÃ© Ã  changer nos approches, nous avons formÃ© 4 commandements.  Ils sont prÃ©sentÃ©s sur mes slides: <br><br>  Ces commandements sont assez simples: <br><br><img src="https://habrastorage.org/webt/kr/vd/zr/krvdzr268yzpyvwaf3_4fgatwrg.jpeg"><br><br><ul><li>  Identifiez rapidement le problÃ¨me. </li><li>  DÃ©barrassez-vous encore plus rapidement. </li><li>  Aidez Ã  comprendre la raison (plus tard, pour les dÃ©veloppeurs). </li><li>  Et standardiser les approches. </li></ul><br>  J'attire votre attention sur le point numÃ©ro 2. Nous nous dÃ©barrassons du problÃ¨me, mais ne le rÃ©solvons pas.  DÃ©cider est la deuxiÃ¨me fois.  La principale chose pour nous est que l'utilisateur est protÃ©gÃ© contre ce problÃ¨me.  Il existera dans un certain environnement isolÃ©, mais cet environnement n'entrera pas en contact avec lui.  En fait, nous allons passer en revue ces quatre groupes de problÃ¨mes (pour certains plus en dÃ©tail, pour certains moins en dÃ©tail), je vais vous dire ce que nous utilisons, quel type d'expÃ©rience nous avons dans la rÃ©solution. <br><br><h3>  DÃ©pannage: quand ils se produisent et que faire avec eux? </h3><br>  Mais nous allons commencer dans le dÃ©sordre, nous commenÃ§ons par le point numÃ©ro 2 - comment se dÃ©barrasser rapidement du problÃ¨me?  Il y a un problÃ¨me - nous devons le rÃ©soudre.  Â«Que devons-nous faire avec cela?Â» Est la question principale.  Et lorsque nous avons commencÃ© Ã  rÃ©flÃ©chir Ã  la faÃ§on de rÃ©soudre le problÃ¨me, nous avons dÃ©veloppÃ© pour nous-mÃªmes certaines exigences que le dÃ©pannage devrait suivre. <br><br><img src="https://habrastorage.org/webt/oq/ch/1z/oqch1zstieolkejut_t01rbzokw.jpeg"><br><br>  Pour formuler ces exigences, nous avons dÃ©cidÃ© de nous poser la question: Â«Et quand avons-nous des problÃ¨mesÂ»?  Et les problÃ¨mes, comme il s'est avÃ©rÃ©, se trouvent dans quatre cas: <br><br><img src="https://habrastorage.org/webt/ks/kw/zm/kskwzmylqshsejm96u-bxngu1uq.jpeg"><br><br><ul><li>  Dysfonctionnement matÃ©riel. </li><li>  DÃ©faillance des services externes. </li><li>  Changement de version logicielle (mÃªme dÃ©ploiement). </li><li>  Croissance de la charge explosive. </li></ul><br>  Nous ne parlerons pas des deux premiers.  Un dysfonctionnement matÃ©riel est rÃ©solu tout simplement: vous devez tout faire dupliquer.  S'il s'agit de disques - les disques doivent Ãªtre assemblÃ©s en RAID, s'il s'agit d'un serveur - le serveur doit Ãªtre dupliquÃ©, si vous avez une infrastructure rÃ©seau - vous devez mettre une deuxiÃ¨me copie de l'infrastructure rÃ©seau, c'est-Ã -dire que vous prenez et dupliquez.  Et si quelque chose Ã©choue, vous passez Ã  des capacitÃ©s de rÃ©serve.  Il est difficile d'en dire plus ici. <br><br>  Le second est l'Ã©chec des services externes.  Pour la plupart, le systÃ¨me n'est pas du tout un problÃ¨me, mais pas pour nous.  Ã‰tant donnÃ© que nous traitons les paiements, nous sommes un tel agrÃ©gateur qui se situe entre l'utilisateur (qui saisit les dÃ©tails de sa carte) et les banques, les systÃ¨mes de paiement ("Visa", "MasterCard", "World" du mÃªme).  Nos services externes (systÃ¨mes de paiement, banques) ont tendance Ã  Ã©chouer.  Ni nous ni vous (si vous avez de tels services) ne pouvons influencer cela. <br><br>  Que faire alors?  Il y a deux options.  Tout d'abord, si vous le pouvez, vous devez dupliquer ce service d'une maniÃ¨re ou d'une autre.  Par exemple, si nous le pouvons, nous transfÃ©rons le trafic d'un service Ã  un autre: nous traitons, par exemple, les cartes via Sberbank, Sberbank a des problÃ¨mes - nous transfÃ©rons le trafic [conditionnellement] vers Raiffeisen.  La deuxiÃ¨me chose que nous pouvons faire est de constater rapidement l'Ã©chec des services externes, et nous parlerons donc de la vitesse de rÃ©action dans la prochaine partie du rapport. <br><br>  En fait, de ces quatre, nous pouvons spÃ©cifiquement affecter le changement de versions logicielles - pour prendre des mesures qui mÃ¨neront Ã  une amÃ©lioration dans le contexte des dÃ©ploiements et dans le contexte de la croissance de la charge explosive.  En fait, nous l'avons fait.  Ici encore, une petite remarque ... <br><br>  Sur ces quatre problÃ¨mes, plusieurs sont rÃ©solus immÃ©diatement si vous disposez d'un cloud.  Si vous Ãªtes dans les nuages â€‹â€‹Microsoft Azhur, Ozone, utilisez nos nuages, de Yandex ou Mail, alors au moins un dysfonctionnement matÃ©riel devient leur problÃ¨me et tout devient immÃ©diatement correct dans le contexte d'un dysfonctionnement matÃ©riel. <br><br>  Nous sommes une petite entreprise non standard.  Ici, tout le monde parle de Kubernets, de nuages â€‹â€‹- nous n'avons ni Kubernets, ni nuages.  Mais nous avons des racks avec du fer dans de nombreux centres de donnÃ©es, et nous sommes obligÃ©s de vivre avec ce fer, nous sommes obligÃ©s de rÃ©pondre de tout.  Par consÃ©quent, dans ce contexte, nous parlerons.  Alors, sur les problÃ¨mes.  Les deux premiers sont hors crochets. <br><br><h3>  Changer la version du logiciel.  Bases </h3><br>  Nos dÃ©veloppeurs n'ont pas accÃ¨s Ã  la production.  Pourquoi  Mais nous sommes simplement certifiÃ©s par PCI DSS, et nos dÃ©veloppeurs n'ont tout simplement pas le droit de grimper dans le "prod".  VoilÃ , point final.  Absolument.  Par consÃ©quent, la responsabilitÃ© du dÃ©veloppement se termine exactement au moment oÃ¹ le dÃ©veloppement a transmis la version Ã  la version. <br><br><img src="https://habrastorage.org/webt/ze/bp/su/zebpsueilk7pvkhrsqwn-0nrfko.jpeg"><br><br>  Notre deuxiÃ¨me base, que nous avons, qui nous aide Ã©galement beaucoup, est le manque de connaissances uniques et sans papiers.  J'espÃ¨re que vous en ferez de mÃªme.  Parce que si ce n'est pas le cas, vous aurez des problÃ¨mes.  Des problÃ¨mes surgiront lorsque cette connaissance unique et non documentÃ©e n'est pas prÃ©sente au bon moment au bon endroit.  Supposons que vous ayez une personne qui sache dÃ©ployer un composant spÃ©cifique - il n'y a personne, il est en vacances ou est tombÃ© malade - c'est tout, vous avez des problÃ¨mes. <br><br>  Et la troisiÃ¨me base Ã  laquelle nous sommes arrivÃ©s.  Nous sommes venus Ã  lui Ã  travers la douleur, le sang, les larmes - nous sommes arrivÃ©s Ã  la conclusion que n'importe quelle de nos versions contient des erreurs, mÃªme si elle est sans erreurs.  Nous avons dÃ©cidÃ© cela par nous-mÃªmes: lorsque nous dÃ©ployons quelque chose, lorsque nous roulons quelque chose dans la prod - nous avons une construction avec des erreurs.  Nous avons formÃ© les exigences que notre systÃ¨me doit satisfaire. <br><br><h3>  Exigences de changement de version du logiciel </h3><br>  Il existe trois de ces exigences: <br><br><img src="https://habrastorage.org/webt/ou/qm/ma/ouqmmajckkplivqpqoiuwsvs3hs.jpeg"><br><br><ul><li>  Nous devons rapidement annuler le dÃ©ploiement. </li><li>  Nous devons minimiser l'impact d'un dÃ©ploiement infructueux. </li><li>  Et nous devons pouvoir nous coincer rapidement en parallÃ¨le. <br>  Dans cet ordre!  Pourquoi?  Parce que, tout d'abord, lors du dÃ©ploiement de la nouvelle version, la vitesse n'a pas d'importance, mais il est important pour vous, si quelque chose ne va pas, de revenir rapidement en arriÃ¨re et d'avoir un impact minimal.  Mais si vous avez un ensemble de versions sur la production, pour lesquelles il s'est avÃ©rÃ© qu'il y a une erreur (comme de la neige sur la tÃªte, il n'y a pas eu de dÃ©ploiement, mais l'erreur est contenue) - la vitesse du dÃ©ploiement suivant est importante pour vous.  Qu'avons-nous fait pour rÃ©pondre Ã  ces exigences?  Nous avons recouru Ã  une telle mÃ©thodologie: <br><br><img src="https://habrastorage.org/webt/bx/xn/9h/bxxn9hd10bckeqbycqanabweery.jpeg"><br><br>  C'est bien connu, nous n'avons pas inventÃ© une seule fois - c'est le dÃ©ploiement Blue / Green.  Qu'est ce que c'est  Vous devez avoir une copie pour chaque groupe de serveurs sur lesquels vos applications sont installÃ©es.  La copie est Â«chaudeÂ»: il n'y a pas de trafic dessus, mais Ã  tout moment ce trafic peut Ãªtre envoyÃ© Ã  cette copie.  Cette copie contient la version prÃ©cÃ©dente.  Et au moment du dÃ©ploiement, vous dÃ©ployez le code sur une copie inactive.  Basculez ensuite une partie du trafic (ou la totalitÃ©) vers la nouvelle version.  Ainsi, pour changer le flux de trafic de l'ancienne version vers la nouvelle, vous n'avez qu'Ã  effectuer une seule action: vous devez changer l'Ã©quilibreur en amont, changer la direction - d'une en amont Ã  une autre.  Ceci est trÃ¨s pratique et rÃ©sout le problÃ¨me de la commutation rapide, de la restauration rapide. <br><br>  Ici, la solution Ã  la deuxiÃ¨me question est la minimisation: vous ne pouvez mettre sur une nouvelle ligne, sur une ligne avec un nouveau code qu'une partie de votre trafic (soit, par exemple, 2%).  Et ces 2% - ils ne sont pas Ã  100%!  Si vous avez perdu 100% du trafic lors d'un dÃ©ploiement infructueux - c'est effrayant, si vous avez perdu 2% du trafic - c'est dÃ©sagrÃ©able, mais ce n'est pas effrayant.  De plus, les utilisateurs ne le remarqueront probablement mÃªme pas, car dans certains cas (pas tous) le mÃªme utilisateur, en appuyant sur F5, il sera redirigÃ© vers une autre version de travail. <br><br><h3>  DÃ©ploiement bleu / vert.  Acheminement </h3><br>  De plus, tout n'est pas si simple Â«Blue / Green DeployÂ» ... Tous nos composants peuvent Ãªtre divisÃ©s en trois groupes: <br><br><ul><li>  Il s'agit de l'interface (pages de paiement que nos clients voient); </li><li>  noyau de traitement; </li><li>  un adaptateur pour travailler avec les systÃ¨mes de paiement (banques, MasterCard, Visa ...). </li></ul><br>  Et il y a une nuance - la nuance est le routage entre les lignes.  Si vous changez simplement 100% du trafic, vous n'avez pas ces problÃ¨mes.  Mais si vous voulez changer de 2%, les questions commencent: "Comment faire?" La chose la plus simple sur le front: vous pouvez sÃ©lectionner au hasard Round Robin dans nginx, et il vous reste 2%, 98% - Ã  droite.  Mais cela ne convient pas toujours. <br><br>  Ici, par exemple, l'utilisateur interagit avec le systÃ¨me dans plus d'une demande.  C'est normal: 2, 3, 4, 5 requÃªtes - vos systÃ¨mes peuvent Ãªtre les mÃªmes.  Et s'il est important pour vous que toutes les demandes des utilisateurs arrivent sur la mÃªme ligne que la premiÃ¨re demande, ou (deuxiÃ¨me moment) toutes les demandes des utilisateurs arrivent sur une nouvelle ligne aprÃ¨s le changement (il pourrait commencer Ã  travailler plus tÃ´t avec le systÃ¨me, avant le changement), - alors cette distribution alÃ©atoire ne vous convient pas.  Ensuite, il y a les options suivantes: <br><br><img src="https://habrastorage.org/webt/hs/3f/fq/hs3ffqgbcy8wu3lzopom58r6tlm.jpeg"><br><br>  La premiÃ¨re option, la plus simple - basÃ©e sur les paramÃ¨tres de base du client (IP Hash).  Vous avez une adresse IP et vous partagez de droite Ã  gauche par IP.  Ensuite, le deuxiÃ¨me cas dÃ©crit par moi fonctionnera pour vous lorsqu'il y a eu un dÃ©ploiement, l'utilisateur peut dÃ©jÃ  commencer Ã  travailler avec votre systÃ¨me, et Ã  partir du moment du dÃ©ploiement, toutes les demandes iront sur une nouvelle ligne (sur la mÃªme, disons). <br><br>  Si pour une raison quelconque, cela ne vous convient pas et que vous devez envoyer des demandes Ã  la ligne oÃ¹ la demande principale et intime de l'utilisateur est arrivÃ©e, vous avez deux options ... <br>  La premiÃ¨re option: vous pouvez prendre nginx + payÃ©.  Il existe un mÃ©canisme de sessions persistantes qui, Ã  la demande initiale de l'utilisateur, expose une session Ã  l'utilisateur et la lie Ã  un amont en particulier.  Toutes les demandes d'utilisateurs ultÃ©rieures au cours de la durÃ©e de la session iront au mÃªme en amont oÃ¹ la session a Ã©tÃ© dÃ©finie. <br><br>  Cela ne nous convenait pas, car nous avions dÃ©jÃ  un nginx normal.  Changer de nginx + n'est pas que c'est cher, c'Ã©tait juste un peu pÃ©nible pour nous et pas trÃ¨s juste.  Par exemple, Â«Sticks SessionsÂ» n'a pas fonctionnÃ© pour nous pour la simple raison que Â«Sticks SessionsÂ» ne donne pas la possibilitÃ© de suivre l'itinÃ©raire sur la base de Â«Eli-orÂ».  Vous pouvez y spÃ©cifier ce que nous faisons Â«Sticky SessionsÂ», par exemple, par IP ou par IP et par cookie ou par paramÃ¨tre de publication, mais Â«Eli-orÂ» est dÃ©jÃ  plus compliquÃ© lÃ -bas. <br><br>  Par consÃ©quent, nous sommes arrivÃ©s Ã  la quatriÃ¨me option.  Nous avons pris nginx sur les "stÃ©roÃ¯des" (c'est openresty) - c'est le mÃªme nginx qui supporte en outre l'inclusion des derniers scripts.  Vous pouvez Ã©crire un dernier script, glisser ce Â«ouvertÂ», et ce dernier script sera exÃ©cutÃ© quand une demande d'utilisateur arrivera. <br><br>  Et nous avons Ã©crit, en fait, un tel script, nous nous sommes mis Â«openrestÂ» et dans ce script, nous trions 6 paramÃ¨tres diffÃ©rents pour la concatÃ©nation de Â«OrÂ».  Selon la disponibilitÃ© de tel ou tel paramÃ¨tre, on sait que l'utilisateur est venu sur une page ou sur une autre, sur une ligne ou sur une autre. <br><br><h3>  DÃ©ploiement bleu / vert.  Avantages et inconvÃ©nients </h3><br>  Bien sÃ»r, nous pourrions probablement le rendre un peu plus facile (utiliser les mÃªmes Â«Sticky SessionsÂ»), mais nous avons encore une telle nuance que non seulement l'utilisateur interagit avec nous dans le cadre d'un traitement d'une transaction ... Mais les systÃ¨mes de paiement interagissent Ã©galement avec nous: nous, aprÃ¨s avoir traitÃ© la transaction (en envoyant une demande au systÃ¨me de paiement), nous recevons un rappel. <br>  Et supposons que si Ã  l'intÃ©rieur de notre circuit, nous pouvons exÃ©cuter l'adresse IP de l'utilisateur dans toutes les demandes et sÃ©parer les utilisateurs en fonction de l'adresse IP, alors nous ne dirons pas le mÃªme Â«VisaÂ»: Â«Mec, nous sommes une telle entreprise rÃ©tro, nous sommes une sorte d'international (sur le site et dans De la Russie) ... Et s'il vous plaÃ®t donnez-nous un coup d'oeil Ã  l'adresse IP de l'utilisateur dans un champ supplÃ©mentaire, votre protocole est standardisÃ©! "  Des affaires claires, ils ne seront pas d'accord. <br><br><img src="https://habrastorage.org/webt/he/5o/-w/he5o-wivis5fucv4e7_1wn1qz3y.jpeg"><br><br>  Par consÃ©quent, pour nous, cela ne convenait pas - nous avons fait ouvertement.  En consÃ©quence, avec le routage, nous avons obtenu comme ceci: <br><br>  Le Blue / Green Deploy a, respectivement, les avantages dont j'ai parlÃ© et les inconvÃ©nients. <br><br>  InconvÃ©nient deux: <br><br><ul><li>  vous devez vous soucier du routage; </li><li>  le deuxiÃ¨me inconvÃ©nient principal est le coÃ»t. </li></ul><br>  Vous avez besoin de deux fois plus de serveurs, vous avez besoin de deux fois plus de ressources opÃ©rationnelles, vous devez dÃ©penser deux fois plus d'efforts pour maintenir tout ce zoo. <br><br>  Soit dit en passant, parmi les avantages se trouve une autre chose que je n'ai pas mentionnÃ©e auparavant: vous avez une rÃ©serve en cas d'augmentation de la charge.  Si vous avez une croissance explosive de la charge, un grand nombre d'utilisateurs vous sont tombÃ©s dessus, alors vous incluez simplement la deuxiÃ¨me ligne dans la distribution de 50 Ã  50 - et vous avez immÃ©diatement 2 serveurs dans votre cluster jusqu'Ã  ce que vous rÃ©solviez le problÃ¨me d'avoir des serveurs. <br><br><h3>  Comment faire un dÃ©ploiement rapide? </h3><br>  Nous avons parlÃ© de la faÃ§on de rÃ©soudre le problÃ¨me de la minimisation et de la restauration rapide, mais la question demeure: "Comment dÃ©ployer rapidement?" <br><br><img src="https://habrastorage.org/webt/vy/8l/xo/vy8lxokper6luvftog4okdvgbh4.jpeg"><br><br>  Voici bref et simple. <br><br><ul><li>  Vous devez avoir un systÃ¨me de CD (livraison continue) - sans lui, nulle part.  Si vous avez un serveur, vous pouvez vous retrouver avec des stylos.  Nous avons environ un millier et demi de serveurs et 1 500 poignÃ©es, bien sÃ»r - nous pouvons planter un dÃ©partement de la taille de cette salle, uniquement pour le dÃ©ployer. </li><li>  Le dÃ©ploiement doit Ãªtre parallÃ¨le.  Si vous avez un dÃ©ploiement cohÃ©rent, alors tout va mal.  Un serveur est normal, vous dÃ©ploierez un millier et demi de serveurs toute la journÃ©e. </li><li>  Encore une fois, pour accÃ©lÃ©rer, ce n'est plus nÃ©cessaire, probablement.  Lorsque desploey construire gÃ©nÃ©ralement le projet.  Vous avez un projet web, il y a une partie front-end (vous faites un pack web lÃ -bas, npm collecte quelque chose comme Ã§a), et ce processus, en principe, est de courte durÃ©e - 5 minutes, mais ces 5 minutes peuvent Ãªtre critiques.  Par consÃ©quent, par exemple, nous ne faisons pas cela: nous avons supprimÃ© ces 5 minutes, nous dÃ©ployons des artefacts. <br><br>  Qu'est-ce qu'un artefact?  Un artefact est une construction assemblÃ©e dans laquelle la totalitÃ© de la piÃ¨ce d'assemblage est dÃ©jÃ  terminÃ©e.  Nous stockons cet artefact dans le stockage d'artefacts.  Nous avons utilisÃ© deux de ces stockages Ã  la fois - c'Ã©tait Nexus et maintenant jFrog Artifactory.) Nous avons d'abord utilisÃ© le Nexus parce que nous avons commencÃ© Ã  pratiquer cette approche dans les applications java (cela lui convenait bien).  Ensuite, ils y ont mis la partie des applications Ã©crites par PHP;  et le Nexus ne convenait plus, et nous avons donc choisi jFrog Artefactory, qui peut produire presque tout.  Nous sommes mÃªme venus au fait que dans ce stockage d'artefacts, nous stockons nos propres packages binaires, que nous collectons pour les serveurs. </li></ul><br><h3>  Croissance de la charge explosive </h3><br>  Nous avons parlÃ© de changer la version du logiciel.  La prochaine chose que nous avons est une croissance explosive de la charge.  Ici, je comprends probablement que la croissance explosive de la charge n'est pas tout Ã  fait la bonne chose ... <br><br>  Nous avons Ã©crit un nouveau systÃ¨me - il est orientÃ© services, Ã  la mode, partout, les travailleurs, partout les files d'attente, partout l'asynchronie.  Et dans de tels systÃ¨mes, les donnÃ©es peuvent suivre un flux diffÃ©rent.  Pour la premiÃ¨re transaction, le 1er, 3Ã¨me, 10Ã¨me travailleur peut Ãªtre impliquÃ©, pour la deuxiÃ¨me transaction - 2Ã¨me, 4Ã¨me, 5Ã¨me.  Et aujourd'hui, disons, le matin, vous avez un flux de donnÃ©es qui utilise les trois premiers travailleurs, et le soir, il change radicalement, et tout utilise les trois autres travailleurs. <br><br>  Et ici, il s'avÃ¨re que vous devez en quelque sorte faire Ã©voluer les travailleurs, vous devez en quelque sorte faire Ã©voluer vos services, mais en mÃªme temps empÃªcher le gonflement des ressources. <br><br><img src="https://habrastorage.org/webt/wg/1t/kr/wg1tkrnswlv954eaws3dj1ije_a.jpeg"><br><br>  Nous avons dÃ©terminÃ© les exigences pour nous-mÃªmes.    :    Service discovery,  â€“       ,    â€“   .  ,      ,    .   Â«Â»,   Â«Â»,    . <br><br>     ?    .       70  .      Â«Â»,  Â«Â» ,  ,        .    100   Â«Â»,        100     .         .  ,    â€“  24/7   ,      ,    ,  70   ,  . <br><br>     Â«Â»,     IP     Scale-Nomad â€“ ScaleNo,    :                 .  ,  : Â«  ?Â»     â€“  ,   . <br><br>        ,       ,  ,     ,    ,       â€“  , .     3-5  â€“   . <br><br><img src="https://habrastorage.org/webt/8z/ja/m0/8zjam0uickgtjt67yl6grtzfmao.jpeg"><br><br>  Comment Ã§a marche?  !  :       :   ,  â€“   ,   â€“  ,  â€“  . <br><br>  ,     .         45  â€“     .       2         ,     (    â€“ ,   ).     â€“    ,  5-10 ,    . <br><br>     Â«Â»,      ,  Â«Â»      .  ,    ,    â€“       .     .    â„– 2 â€“ Â«    Â». <br><br><h3> .    ? </h3><br>    â€“ Â«   ?Â» !      .      ? <br><br><img src="https://habrastorage.org/webt/md/xm/op/mdxmopdox-kznqvid9b4uesleeg.jpeg"><br><br>  ! <br><br><ul><li>           . </li><li>       ,   ,     . </li><li>   â€“   .      ,     ,   -  . </li></ul><br>  , ,     .   .  ,    .    Â« Â».       : <br><br><img src="https://habrastorage.org/webt/8w/1z/w4/8w1zw4dq1rwsz7e7dg7tp53wbke.jpeg"><br><br>   Â«Â»    Â«Â»,     . Â«Â»     . Â«Â»  Â«Â»      ,      ,   â€“  Â«Â»  Â«Â»,  â€“ Â«Â»  Â«Â»  Telegraf. <br><br>      New Relic.  ,   .     ,    .       1,5  ,    , : Â«     Â».    ,  ,     .    Â«-Â» ,    15     Â«-Â».    . <br><br>    ,     â€“  Debugger.     Â«Â»,       ,  ,    Â«Â».  Qu'est ce que c'est  ,     15-30    ,  Â« Â» ,      . <br><br> ,    ( ) â€“      ,    .   ,    Â«Â» â€“ ,   Â«Â» .       â€“     ,  ,  ,     . <br><br><h3>     ? </h3><br>     ?     ? <br><br><img src="https://habrastorage.org/webt/8c/qe/tn/8cqetn3kfyedayuv9fwc8qpx4vq.jpeg"><br><br><ul><li> Response time / RPS   â€“   .   ,    -  . </li><li>      . </li><li>  . </li><li>   . </li></ul><br>   â€“ Â«Â», Â«Â» .       ,    - ,      .     â€“   (        ).    -    5-10-15  â€“ ,     (  ). <br><br>      â€“     : <br><br><img src="https://habrastorage.org/webt/73/xa/jg/73xajgyfx9xahrr_9hl3ysaapgw.jpeg"><br><br>    â€“ 6 ,     â€“       .    â€“ RPS, RTS.  â€“    Â«Â».   Â«Â»     ,  -       â€¦      ,    . <br><br> ,      â€“       .    OpenTracing â€“ , , ,     ;    .  OpenTracing-   ,       .     ,       , .  ,      ,   . <br><br><img src="https://habrastorage.org/webt/42/nw/5h/42nw5hrsai8-i8t3bnsclajtklw.jpeg"><br><br>   ,         3  â€“    .     ,   ,    20-30 . <br><br>     ,   â€“   . <br><br>  ,  ,     ,        ,   .   ,    . <br><br><img src="https://habrastorage.org/webt/d8/pz/1v/d8pz1vfzv9otccv6dsa-crqiuuu.jpeg"><br><br>      ? ,  :     (,  Â«Â»);   , .         ,   ,  â€¦      â€“        -.   ,   : Â«        Â»? <br><br>   â€¦       -,   ( )    ,      .    :       â€“ ,      ,     ( ).    ,    -        .     !      .         . <br><br>      ,    . <br><br><h3>     </h3><br>   ,    â€“   ,    ,  ,     ,      ,    -   . ,   ,   . <br><br><img src="https://habrastorage.org/webt/e2/kb/jz/e2kbjzy9w7wvv6kicbniocak4ac.jpeg"><br><br>      (  â€“ ),       ELK Stack â€“    .  -, ,   ELK,      ,       ELK.    . <br><br><img src="https://habrastorage.org/webt/_f/8a/3i/_f8a3ibc2i7os5pp3xot6m9_gxo.jpeg"><br><br>   .  ,    ,  ,     ,   Â«Â»,   id-       ( ).        .  Pourquoi?    ,      ,      .      ,     â€“   OpenTracing,    . <br><br>     ,      ,      â€“  Â«Â» (Zipkin)  Â«Â» (Jaeger). Â«Â» â€“      ,   Â«Â».  Â«Â»  ,  ,     ,      ,   .  Â«Â»  . <br><br>   Â«Â»:   ,    Api ( Api  PHP   , ,    â€“   ,    ),     . Â«Â», â€“  ,    .    ?     : <br><br><img src="https://habrastorage.org/webt/uq/x2/mu/uqx2muumblbudpbjnuittfrsdkk.jpeg"><br><br>  Â«Â»     span'.  ,    ,           (1-2-3 â€“      ,   ).      ,        . ,          Error.     Error    ,      .    ,    span: <br><br><img src="https://habrastorage.org/webt/3e/is/fk/3eisfkpsc9mkuipyg-5iaob2d-y.jpeg"><br><br>     .       ,       ,   .        :    â€“  ,   ,            . <br><br> ,    .    ,    .      ,      Â«Â»   PHP â€“   , welcome to use,  : <br><br><img src="https://habrastorage.org/webt/q7/vi/pc/q7vipcgfujbggn_zt64r3h7foay.jpeg"><br><br>     â€“     OpenTracing Api,   php-extention,          .      .     ,   .   :     ,    extention up to you. <br><br><h3>   </h3><br>    .   â€“   .   ?    : <br><br><img src="https://habrastorage.org/webt/3h/ka/zo/3hkazonrypgjcuakfff1yrutxlc.jpeg"><br><br>    Â«Â»?        , !  Â«Â»       ,    ,        ,      .     ? <br><br><img src="https://habrastorage.org/webt/b7/h6/qa/b7h6qavqwtn9fm9bam0jbg07nym.jpeg"><br><br><ul><li>     .      ,  .    60   ,        .     , ,         â€“ ,   . </li><li>    .          ,     ,        RnD-.       ,      (,    ) ,    ,   . </li><li>     ,   â€“ ,     .       . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons des tolÃ©rances. </font><font style="vertical-align: inherit;">Par exemple, nous ne considÃ©rons pas les temps d'arrÃªt si nous avons perdu 2% du trafic en deux minutes. </font><font style="vertical-align: inherit;">Cela, en principe, ne rentre pas dans nos statistiques. </font><font style="vertical-align: inherit;">Si plus en pourcentage ou en temps, on compte dÃ©jÃ .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et nous Ã©crivons toujours post-mortem. </font><font style="vertical-align: inherit;">Quoi qu'il nous arrive, toute situation oÃ¹ elle se comporte de maniÃ¨re inappropriÃ©e sur le site de production se reflÃ©tera dans le potsortem. </font><font style="vertical-align: inherit;">Un post-mortem est un document dans lequel vous Ã©crivez ce qui vous est arrivÃ©, le calendrier dÃ©taillÃ© de ce que vous avez fait pour le rÃ©parer et (c'est un bloc obligatoire!) Ce que vous ferez pour Ã©viter que cela ne se reproduise Ã  l'avenir. </font><font style="vertical-align: inherit;">Cela est nÃ©cessaire, nÃ©cessaire pour une analyse ultÃ©rieure.</font></font></li></ul><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Que considÃ©rer les temps d'arrÃªt? </font></font></h3><br><img src="https://habrastorage.org/webt/ad/8v/ye/ad8vyesevuqquvkj4rtf15hggd8.jpeg"><br><br>  Ã€ quoi tout cela a-t-il conduit? <br><br>  Cela a conduit au fait que (nous avons eu certains problÃ¨mes de stabilitÃ©, cela ne nous convenait ni aux clients ni Ã  nous) au cours des 6 derniers mois, notre indicateur de stabilitÃ© s'est Ã©levÃ© Ã  99,97.  On peut dire que ce n'est pas beaucoup.  Oui, nous avons quelque chose Ã  rechercher.  Environ la moitiÃ© de cet indicateur est la stabilitÃ©, pour ainsi dire, pas la nÃ´tre, mais notre pare-feu d'application Web, qui se tient devant nous et est utilisÃ© comme service, mais cela n'a pas d'importance pour les clients. <br><br>  Nous avons appris Ã  dormir la nuit.  Enfin!  Il y a six mois, nous ne savions pas comment.  Et sur cette note avec les rÃ©sultats, je veux faire une remarque.  Hier soir, il y a eu un merveilleux rapport sur un systÃ¨me de contrÃ´le de rÃ©acteur nuclÃ©aire.  Si les personnes qui ont Ã©crit ce systÃ¨me m'entendent, veuillez oublier ce que j'ai dit Ã  propos de Â«2% n'est pas un temps d'arrÃªtÂ».  Pour vous, 2% est un temps d'arrÃªt, mÃªme si cela dure deux minutes "! <br><br>  Câ€™est tout!  Vos questions. <br><br><img src="https://habrastorage.org/webt/us/ih/xg/usihxgshbsygnv59b5detm4js5m.jpeg"><br><br><h3>  Ã€ propos des Ã©quilibreurs et de la migration de base de donnÃ©es </h3><br>  Question du public (ci-aprÃ¨s - B): - Bonsoir.  Merci beaucoup pour un tel rapport administrateur!  La question est courte au sujet de vos Ã©quilibreurs.  Vous avez mentionnÃ© que vous avez WAF, c'est-Ã -dire, si je comprends bien, vous utilisez une sorte d'Ã©quilibreur externe ... <br><br>  <b>:</b> - Non, nous utilisons nos services comme Ã©quilibreur.  Dans ce cas, WAF est pour nous uniquement un outil de protection DDoS. <br><br>  <b>Q:</b> - Pourriez-vous dire quelques mots sur les Ã©quilibreurs? <br><br>  <b>EK:</b> - Comme je l'ai dit, c'est un groupe de serveurs en openresty.  Nous avons maintenant 5 groupes de serveurs redondants qui rÃ©pondent exclusivement ... c'est-Ã -dire, un serveur sur lequel est exclusivement ouvert, il ne fait que proxy du trafic.  Par consÃ©quent, pour comprendre combien nous dÃ©tenons: nous avons maintenant un flux de trafic rÃ©gulier - c'est plusieurs centaines de mÃ©gabits.  Ils se dÃ©brouillent, ils se sentent bien, ils ne se fatiguent mÃªme pas. <br><br>  <b>Q:</b> - Aussi une question simple.  Il y a un dÃ©ploiement bleu / vert.  Et que faites-vous, par exemple, avec les migrations Ã  partir de la base de donnÃ©es? <br><br>  <b>EK:</b> - Bonne question!  Regardez, nous dans le dÃ©ploiement bleu / vert avons des lignes distinctes pour chaque ligne.  Autrement dit, si nous parlons des lignes d'Ã©vÃ©nements qui sont transmises du travailleur au travailleur, il existe des lignes distinctes pour la ligne bleue et la ligne verte.  Si nous parlons de la base de donnÃ©es elle-mÃªme, nous l'avons dÃ©libÃ©rÃ©ment rÃ©duite, car nous pourrions tout mettre presque en ligne, nous n'avons qu'une pile de transactions dans la base de donnÃ©es.  Et nous avons une seule pile de transactions pour toutes les lignes.  Avec une base de donnÃ©es dans ce contexte: nous ne la partageons pas avec le bleu et le vert, car les deux versions du code devraient savoir ce qui se passe avec la transaction. <br><br>  Mes amis, j'ai encore un si petit prix pour vous stimuler - un livre.  Et je dois lui donner la meilleure question. <br><br>  <b>Q:</b> - Bonjour.  Merci pour le rapport.  La question est la suivante.  Vous surveillez les paiements, vous surveillez les services avec lesquels vous communiquez ... Mais comment surveillez-vous pour qu'une personne vienne d'une maniÃ¨re ou d'une autre sur votre page de paiement, effectue un paiement et que le projet lui attribue de l'argent?  Autrement dit, comment contrÃ´lez-vous que le marchant est disponible et avez acceptÃ© votre rappel? <br><br>  <b>:</b> - Â«MarchandÂ» pour nous dans ce cas est exactement le mÃªme service externe que le systÃ¨me de paiement.  Nous surveillons la vitesse de rÃ©ponse du "marchand". <br><br><h3>  Ã€ propos du chiffrement de la base de donnÃ©es </h3><br>  <b>Q:</b> - Bonjour.  J'ai une petite question.  Vous disposez de donnÃ©es PCI DSS sensibles.  Je voulais savoir comment vous stockez des PAN dans des files d'attente dans lesquelles vous devez placer?  Utilisez-vous un cryptage?  Et Ã  partir de lÃ , la deuxiÃ¨me question suivante se pose: sur PCI DSS, il est nÃ©cessaire de rechiffrer pÃ©riodiquement la base de donnÃ©es en cas de changements (licenciement des administrateurs, etc.) - comment cela se produit-il avec l'accessibilitÃ©? <br><br><img src="https://habrastorage.org/webt/0z/oh/29/0zoh293lif-ioxouzt79ui9j98a.jpeg"><br><br>  <b>EK:</b> - Magnifique question!  PremiÃ¨rement, nous ne stockons pas de PAN dans les files d'attente.  Nous n'avons pas le droit de stocker PAN n'importe oÃ¹ en clair, donc en principe, nous utilisons un service spÃ©cial (nous l'appelons "Kademon") - c'est un service qui ne fait qu'une chose: il reÃ§oit un message et envoie un message cryptÃ©.  Et nous stockons tout avec ce message cryptÃ©.  En consÃ©quence, la longueur clÃ© pour nous est infÃ©rieure Ã  kilo-octets, de sorte qu'elle soit directe sÃ©rieusement et fiable. <br><br>  <b>Q:</b> - Avez-vous besoin de 2 kilo-octets maintenant? <br><br>  <b>EK:</b> - On dirait qu'hier c'Ã©tait 256 ... Eh bien, oÃ¹ d'autre?! <br><br>  C'est donc le premier.  Et deuxiÃ¨mement, la solution qui existe, elle prend en charge la procÃ©dure de recryptage - il y a deux paires de Â«gÃ¢teauxÂ» (clÃ©s) qui donnent des Â«decksÂ» qui cryptent (les clÃ©s sont des clÃ©s, dek sont des dÃ©rivÃ©s des clÃ©s qui cryptent).  Et dans le cas de l'initiation de la procÃ©dure (elle a lieu rÃ©guliÃ¨rement, de 3 mois Ã  Â± certains), nous tÃ©lÃ©chargeons une nouvelle paire de Â«gÃ¢teauxÂ», et nous faisons rechiffrer les donnÃ©es.  Nous avons des services sÃ©parÃ©s qui arrachent toutes les donnÃ©es, les cryptent d'une nouvelle maniÃ¨re;  les donnÃ©es sont stockÃ©es Ã  cÃ´tÃ© de l'identifiant de clÃ© avec lequel elles sont cryptÃ©es.  En consÃ©quence, dÃ¨s que nos donnÃ©es sont cryptÃ©es avec de nouvelles clÃ©s, nous supprimons l'ancienne clÃ©. <br><br><h3>  Parfois, vous devez effectuer des paiements manuellement ... </h3><br>  <b>Q:</b> - Autrement dit, si un retour est venu pour une opÃ©ration, alors le dÃ©chiffrer avec l'ancienne clÃ©? <br><br>  <b>CE:</b> - Oui. <br><br>  <b>Q:</b> - Puis une autre petite question.  En cas d'Ã©chec, de chute, d'incident, il est nÃ©cessaire de pousser la transaction en mode manuel.  Il y a une telle situation. <br><br>  <b>EK:</b> - Oui, c'est vrai. <br><br>  <b>Q:</b> - OÃ¹ obtenez-vous ces donnÃ©es?  Ou allez-vous vous-mÃªme avec des stylos dans ce magasin? <br><br>  <b>EK:</b> - Non, bien sÃ»r - nous avons une sorte de systÃ¨me de back-office qui contient une interface pour notre support.  Si nous ne savons pas dans quel Ã©tat se trouve la transaction (par exemple, alors que le systÃ¨me de paiement n'a pas rÃ©pondu avec un dÃ©lai), nous ne savons pas a priori, c'est-Ã -dire que nous attribuons le statut final uniquement en toute confiance.  Dans ce cas, nous transfÃ©rons la transaction dans un statut spÃ©cial pour le traitement manuel.  Le matin, le lendemain, dÃ¨s que le support reÃ§oit des informations indiquant que de telles transactions restent dans le systÃ¨me de paiement, il les traite manuellement dans cette interface. <br><br><img src="https://habrastorage.org/webt/um/1e/qe/um1eqefsegdtcvv8gczvx2qe54o.jpeg"><br><br>  <b>Q:</b> - J'ai quelques questions.  L'un d'eux est la continuation de la zone PCI DSS: comment obtenir leurs journaux de boucle?  Une telle question car le dÃ©veloppeur pourrait mettre n'importe quoi dans les journaux!  DeuxiÃ¨me question: comment dÃ©ployer les correctifs?  Les stylos dans la base de donnÃ©es sont une option, mais il peut y avoir des correctifs logiciels gratuits - quelle est la procÃ©dure lÃ -bas?  Et la troisiÃ¨me question est probablement liÃ©e Ã  RTO, RPO.  Votre disponibilitÃ© Ã©tait de 99,97, presque quatre neuf, mais si je comprends bien, vous avez un deuxiÃ¨me centre de donnÃ©es, un troisiÃ¨me centre de donnÃ©es et un cinquiÃ¨me centre de donnÃ©es ... Comment gÃ©rez-vous leur synchronisation, leur rÃ©plication, tout le reste? <br><br>  <b>EK:</b> - CommenÃ§ons par le premier.  La premiÃ¨re question sur les journaux Ã©tait?  Lorsque nous Ã©crivons des journaux, nous avons une couche qui masque toutes les donnÃ©es sensibles.  Elle regarde le masque et les champs supplÃ©mentaires.  En consÃ©quence, nos journaux contiennent des donnÃ©es dÃ©jÃ  masquÃ©es et une boucle PCI DSS.  C'est l'une des tÃ¢ches rÃ©guliÃ¨res assignÃ©es au dÃ©partement de test.  Ils sont obligÃ©s de vÃ©rifier chaque tÃ¢che, y compris les journaux qu'ils Ã©crivent, et c'est l'une des tÃ¢ches rÃ©guliÃ¨res de la revue de code, afin de contrÃ´ler que le dÃ©veloppeur n'a pas Ã©crit quelque chose.  Une vÃ©rification ultÃ©rieure est effectuÃ©e rÃ©guliÃ¨rement par le service de la sÃ©curitÃ© de l'information environ une fois par semaine: les journaux sont pris de maniÃ¨re sÃ©lective pour le dernier jour, et ils sont exÃ©cutÃ©s Ã  travers un analyseur-scanner spÃ©cial Ã  partir de serveurs de test pour vÃ©rifier tout cela. <br>  Ã€ propos des correctifs.  Cela est inclus dans notre calendrier de dÃ©ploiement.  Nous avons un Ã©lÃ©ment distinct sur les correctifs.  Nous pensons que nous dÃ©ployons des correctifs 24h / 24 lorsque nous en avons besoin.  DÃ¨s que la version est assemblÃ©e, dÃ¨s qu'elle est exÃ©cutÃ©e, dÃ¨s que nous avons l'artefact, nous obtenons l'administrateur systÃ¨me sur appel du support, et il le dÃ©ploiera au moment oÃ¹ cela sera nÃ©cessaire. <br><br>  Ã€ propos des Â«quatre neufÂ».  Le nombre que nous avons maintenant, il a vraiment Ã©tÃ© atteint, et nous l'avons cherchÃ© dans un autre centre de donnÃ©es.  Nous avons maintenant un deuxiÃ¨me centre de donnÃ©es, et nous commenÃ§ons Ã  faire le trajet entre eux, et la question du centre de rÃ©plication inter-donnÃ©es est vraiment une question non triviale.  Nous avons essayÃ© de le rÃ©soudre en temps voulu par diffÃ©rents moyens: nous avons essayÃ© d'utiliser la mÃªme "Tarentule" - cela n'a pas fonctionnÃ© pour nous, je dis tout de suite.  Par consÃ©quent, nous sommes arrivÃ©s au fait que nous faisons manuellement l'ordre de la "sensation".  Nous avons en effet toutes les applications en mode asynchrone des synchronisations nÃ©cessaires "change - done" entre les centres de donnÃ©es. <br><br>  <b>Q:</b> - Si vous en avez un deuxiÃ¨me, alors pourquoi pas un troisiÃ¨me?  Parce que personne n'a encore le cerveau divisÃ© ... <br><br>  <b>:</b> - Et nous n'avons pas de cerveau divisÃ©.  Ã‰tant donnÃ© que chaque application pilote un multimaÃ®tre, peu importe le centre auquel la demande est adressÃ©e.  Nous sommes prÃªts pour le fait que, dans le cas oÃ¹ un centre de donnÃ©es tombe en panne (nous sommes sur lui) et au milieu de la demande d'un utilisateur transfÃ©rÃ© vers un deuxiÃ¨me centre de donnÃ©es, nous sommes prÃªts Ã  perdre cet utilisateur, vraiment;  mais ce seront des unitÃ©s, des unitÃ©s absolues. <br><br>  <b>Q:</b> - Bonsoir.  Merci pour le rapport.  Vous avez parlÃ© de votre dÃ©bogueur, qui entraÃ®ne certaines transactions de test en production.  Mais parlez-nous des transactions de test!  Jusqu'oÃ¹ va-t-il? <br><br>  <b>EC:</b> - Il passe par le cycle complet de l'ensemble du composant.  Il n'y a aucune diffÃ©rence entre la transaction de test et celle de combat pour le composant.  Et du point de vue de la logique, ce n'est qu'un projet distinct dans le systÃ¨me, sur lequel seules les transactions de test sont poursuivies. <br><br>  <b>Q:</b> - Et oÃ¹ le coupez-vous?  Alors Core a envoyÃ© ... <br><br>  <b>:</b> - Nous sommes derriÃ¨re "Kor" dans ce cas pour les transactions de test ... Nous avons une chose telle que le routage: "Kor" sait Ã  quel systÃ¨me de paiement envoyer - nous envoyons Ã  un faux systÃ¨me de paiement, qui donne simplement une rÃ©ponse http et c'est tout . <br><br>  <b>Q:</b> - Dites-moi s'il vous plaÃ®t, avez-vous Ã©crit l'application dans un Ã©norme monolithe, ou l'avez-vous coupÃ© Ã  certains services ou mÃªme microservices? <br><br>  <b>:</b> - Nous n'avons pas de monolithe, bien sÃ»r, nous avons une application orientÃ©e services.  Nous avons une blague que nous avons un service de monolithes - ils sont vraiment assez grands.  Appeler des microservices dans ce langage ne dÃ©rive pas du tout du mot, mais ce sont les services au sein desquels travaillent les travailleurs de machines distribuÃ©es. <br><br><h3>  Si le service sur le serveur est compromis ... </h3><br>  <b>Q:</b> - Alors j'ai la question suivante.  MÃªme s'il s'agissait d'un monolithe, vous avez quand mÃªme dit que vous avez beaucoup de ces serveurs instantanÃ©s, ils traitent tous les donnÃ©es en principe, et la question est: Â«Si l'un des serveurs instantanÃ©s ou de l'application, n'importe quel lien particulier est compromis Ont-ils un contrÃ´le d'accÃ¨s?  Lequel d'entre eux peut faire quoi?  Qui contacter, pour quelles donnÃ©es? <br><br><img src="https://habrastorage.org/webt/3j/qn/pt/3jqnpt1dfzhas9kn5de1qb6x1lq.jpeg"><br><br>  <b>EK:</b> - Oui, bien sÃ»r.  Les exigences de sÃ©curitÃ© sont assez sÃ©rieuses.  PremiÃ¨rement, nous avons un trafic de donnÃ©es ouvert, et les ports ne sont que ceux sur lesquels nous anticipons le trafic Ã  l'avance.  Si le composant communique avec la base de donnÃ©es (par exemple, Â«MuskulÂ») sur 5-4-3-2, seuls 5-4-3-2 et d'autres ports seront ouverts pour lui, les autres directions de trafic ne seront pas disponibles.  De plus, nous devons comprendre qu'en production, nous avons environ 10 boucles de sÃ©curitÃ© diffÃ©rentes.  Et mÃªme si l'application a Ã©tÃ© compromise d'une maniÃ¨re ou d'une autre, Dieu ne plaise, un attaquant ne pourra pas accÃ©der Ã  la console de gestion du serveur, car il s'agit d'une autre zone de sÃ©curitÃ© rÃ©seau. <br><br>  <b>Q:</b> - Et dans ce contexte, je suis plus intÃ©ressÃ© par le moment oÃ¹ vous avez des contrats avec des services - que peuvent-ils faire, par quelles Â«actionsÂ» ils peuvent se contacter ... Et dans le flux normal, certains services spÃ©cifiques demandent quels une sÃ©rie, une liste "d'action" sur une autre.  Ils ne semblent pas se tourner vers les autres dans une situation normale, et ils ont d'autres domaines de responsabilitÃ©.  Si l'un d'entre eux est compromis, pourra-t-il tirer "l'action" de ce service? .. <br><br>  <b>EK:</b> - Je comprends.  Si dans une situation normale avec un autre serveur, la communication Ã©tait gÃ©nÃ©ralement autorisÃ©e, alors oui.  Dans le cadre du contrat SLA, nous ne contrÃ´lons pas que vous n'Ãªtes autorisÃ© que les 3 premiÃ¨res Â«actionsÂ», et 4 Â«actionsÂ» ne vous sont pas autorisÃ©es.  C'est probablement redondant pour nous, car nous avons en principe un systÃ¨me de protection Ã  4 niveaux pour les circuits.  Nous prÃ©fÃ©rons dÃ©fendre avec des contours plutÃ´t qu'au niveau de l'intÃ©rieur. <br><br><h3>  Comment fonctionnent Visa, MasterCard et Sberbank </h3><br>  <b>Q:</b> - Je veux clarifier un instant sur le passage d'un utilisateur d'un centre de donnÃ©es Ã  un autre.  Pour autant que je sache, "Visa" et "MasterCard" fonctionnent sur le protocole synchrone binaire 8583, il existe des mixages.  Et je voulais savoir, maintenant je veux dire passer - est-ce directement Â«VisaÂ» et Â«MasterCardÂ» ou vers des systÃ¨mes de paiement, vers des traitements? <br><br>  <b>EK:</b> - C'est aux mixes.  MÃ©langes que nous avons dans un centre de donnÃ©es. <br><br>  <b>Q:</b> - En gros, avez-vous un point de connexion? <br><br>  <b>:</b> - "Vise" et "MasterCard" - oui.  Tout simplement parce que Â«VisaÂ» et Â«MasterCardÂ» nÃ©cessitent des investissements assez importants dans les infrastructures pour conclure des contrats sÃ©parÃ©s pour recevoir une deuxiÃ¨me paire de mixages, par exemple.  Ils sont rÃ©servÃ©s dans le cadre d'un centre de donnÃ©es, mais si, Ã  Dieu ne plaise, le centre de donnÃ©es oÃ¹ les mÃ©langes pour se connecter au "Visa" et "MasterCard" sont morts, alors nous aurons une connexion avec le "Visa" et "MasterCard" perdu ... <br><br>  <b>Q:</b> - Comment peuvent-ils Ãªtre rÃ©servÃ©s?  Je sais que "Visa" ne permet en principe qu'une seule connexion! <br><br>  <b>EK:</b> - Ils fournissent eux-mÃªmes du matÃ©riel.  Dans tous les cas, nous avons reÃ§u des Ã©quipements redondants en interne. <br><br>  <b>Q:</b> - Autrement dit, le rack de leur Connects Orange? .. <br><br>  <b>CE:</b> - Oui. <br><br>  <b>Q:</b> - Mais comme dans ce cas: si votre centre de donnÃ©es disparaÃ®t, devez-vous l'utiliser davantage?  Ou s'agit-il simplement d'un arrÃªt du trafic? <br><br>  <b>CE:</b> - Non.  Dans ce cas, nous transfÃ©rons simplement le trafic vers un autre canal, qui, bien sÃ»r, sera plus cher pour nous, plus cher pour les clients.  Mais le trafic ne passera pas par notre connexion directe Ã  la "Visa", "MasterCard", mais par la "Sberbank" conventionnelle (trÃ¨s exagÃ©rÃ©e). <br><br>  Je suis extrÃªmement dÃ©solÃ© si j'ai blessÃ© des employÃ©s de Sberbank.  Mais selon nos statistiques, la Sberbank tombe le plus souvent des banques russes.  En moins d'un mois, quelque chose n'est pas tombÃ© chez Sberbank. <br><br><img src="https://habrastorage.org/webt/u2/pm/rp/u2pmrpkbplsfx65dstp-lsstwcw.jpeg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6YB1kMnzyRs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Un peu de publicitÃ© :) </h3><br>  Merci de rester avec nous.  Aimez-vous nos articles?  Vous voulez voir des matÃ©riaux plus intÃ©ressants?  Soutenez-nous en passant une commande ou en recommandant Ã  vos amis <a href="https://ua-hosting.company/cloudvps/nl">des VPS basÃ©s sur le cloud pour les dÃ©veloppeurs Ã  partir de 4,99 $</a> , un <b>analogue unique de serveurs d'entrÃ©e de gamme que nous avons inventÃ©s pour vous:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">Toute la vÃ©ritÃ© sur les VPS (KVM) E5-2697 v3 (6 cÅ“urs) 10 Go DDR4 480 Go SSD 1 Gbit / s Ã  partir de 19 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'Ã  24 cÅ“urs et jusqu'Ã  40 Go de DDR4). <br><br>  <b>Dell R730xd 2 fois moins cher au centre de donnÃ©es Equinix Tier IV Ã  Amsterdam?</b>  Nous avons seulement <b><a href="https://ua-hosting.company/serversnl">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV Ã  partir de 199 $</a> aux Pays-Bas!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - Ã  partir de 99 $!</b></b>  Pour en savoir plus sur la <a href="https://habr.com/company/ua-hosting/blog/329618/">crÃ©ation d'un bÃ¢timent d'infrastructure.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">classe utilisant des serveurs Dell R730xd E5-2650 v4 coÃ»tant 9 000 euros pour un sou?</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484908/">https://habr.com/ru/post/fr484908/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484898/index.html">Une bonne raison de tester vos dÃ©pendances: Ã©dition AGPL</a></li>
<li><a href="../fr484900/index.html">Rendu de site Web 101</a></li>
<li><a href="../fr484902/index.html">Sur les Ã©quations de degrÃ©s supÃ©rieurs</a></li>
<li><a href="../fr484904/index.html">Une annÃ©e sans Splunk - comment une entreprise amÃ©ricaine a changÃ© le marchÃ© de l'analyse des donnÃ©es machine en Russie et qu'elle a laissÃ© derriÃ¨re</a></li>
<li><a href="../fr484906/index.html">Ã‰quipe distribuÃ©e et chef d'Ã©quipe Ã  distance</a></li>
<li><a href="../fr484910/index.html">Paul Graham: Haters</a></li>
<li><a href="../fr484918/index.html">Processus d'annotation incrÃ©mentielle pour accÃ©lÃ©rer les constructions Gradle</a></li>
<li><a href="../fr484920/index.html">Comment comprendre que vous Ãªtes opÃ©rateur de fraiseuse?</a></li>
<li><a href="../fr484930/index.html">Faisons du fastcode comme des professionnels</a></li>
<li><a href="../fr484932/index.html">La double nature des exigences logicielles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>