<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏻 🔅 🤸🏾 School of Magic PHP 👂🏽 ☃️ 👩🏽‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apa itu sihir dalam PHP? Ini biasanya berarti metode seperti _construct() atau __get() . Metode ajaib dalam PHP adalah celah yang membantu pengembang ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>School of Magic PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/478618/"> Apa itu sihir dalam PHP?  Ini biasanya berarti metode seperti <code>_construct()</code> atau <code>__get()</code> .  Metode ajaib dalam PHP adalah celah yang membantu pengembang melakukan hal-hal menakjubkan.  Jaringan ini penuh dengan instruksi untuk menggunakannya, yang mungkin Anda kenal.  Tetapi bagaimana jika kita mengatakan bahwa Anda bahkan belum melihat keajaiban yang sebenarnya?  Lagi pula, semakin Anda tahu bahwa Anda tahu segalanya, semakin banyak sihir yang menghindar dari Anda. <br><br><img src="https://habrastorage.org/webt/kd/xp/vm/kdxpvmeklgs6av1hp8ldzbnq4vc.jpeg"><br><br>  Mari kita jatuhkan kerangka aturan OOP yang sudah ada dan buat yang tidak mungkin dilakukan di sekolah sihir PHP.  Guru magis utama dan pertama sekolah adalah <b>Alexander Lisachenko</b> ( <a href="https://habr.com/ru/users/nighttiger/" class="user_link">NightTiger</a> ).  Dia akan mengajarkan pemikiran sulap dan mungkin Anda akan menyukai metode sulap, cara non-standar mengakses properti, mengubah konteks, pemrograman berorientasi aspek, dan filter aliran. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1W3UR7v3sAo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Alexander Lisachenko</b> adalah kepala departemen pengembangan web dan arsitektur di Alpari.  Penulis dan pengembang utama kerangka kerja berorientasi aspek <a href="http://go.aopphp.com/">Go!</a>  <a href="http://go.aopphp.com/">Aop</a> .  Pembicara di konferensi internasional tentang PHP. <br><br>  Dalam film bagus "The Illusion of Deception" ada ungkapan: <br><blockquote>  "Semakin dekat kamu, semakin sedikit kamu melihat." </blockquote><br>  Hal yang sama dapat dikatakan tentang PHP, sebagai trik sulap yang memungkinkan Anda melakukan hal-hal yang tidak biasa.  Tapi pertama-tama, itu dibuat untuk menipu Anda: "... tindakan yang dimaksudkan untuk menipu, baik sebagai cara menipu seseorang, atau sebagai lelucon atau bentuk hiburan." <br><br>  Jika kami menggabungkan PHP dan mencoba menulis sesuatu yang ajaib di dalamnya, kemungkinan besar saya akan menipu Anda.  Saya akan melakukan beberapa trik, dan Anda akan lama bertanya-tanya mengapa ini terjadi.  Itu karena PHP adalah bahasa pemrograman yang dikenal karena hal-hal yang tidak biasa. <br><br><h2>  Peralatan sulap </h2><br>  Apa yang kita butuhkan dari peralatan sulap?  Metode yang sangat familiar. <br><br> <code>__construct(), __destruct(), __clone(), <br> __call(), __callStatic(), <br> __get(), __set(), __isset(), __unset(), <br> __sleep(), __wakeup(), <br> __toString(), __invoke(), __set_state(), <br> __debugInfo()</code> <br> <br>  Saya akan mencatat metode terakhir secara terpisah - dengan itu Anda dapat memutar hal-hal yang tidak biasa.  Tapi itu belum semuanya. <br><br><ul><li>  <code>declare(ticks=1)</code> . <br></li><li>  <code>debug_backtrace()</code> .  Ini adalah teman kita untuk memahami di mana kita berada dalam kode saat ini, untuk melihat siapa yang memanggil kita dan mengapa, dengan argumen apa.  Berguna untuk memutuskan untuk tidak mengikuti semua logika. <br></li><li>  <code>unset(), isset()</code> .  Tampaknya tidak ada yang istimewa, tetapi desain ini menyembunyikan banyak trik, yang akan kami pertimbangkan lebih lanjut. <br></li><li>  <code>by-reference passing</code> .  Ketika kami melewati beberapa objek atau variabel dengan referensi, kami harus berharap bahwa beberapa sihir pasti akan terjadi pada Anda. <br></li><li>  <code>bound closures</code> .  Pada penutupan dan fakta bahwa mereka dapat mengikat, Anda dapat membangun banyak trik. <br></li><li>  API Refleksi membantu membawa refleksi ke tingkat yang baru. <br></li><li>  API StreamWrapper. <br></li></ul><br>  Peralatan sudah siap - saya akan mengingatkan aturan sihir pertama. <br><br><blockquote>  Selalu menjadi pria terpintar di ruangan itu. </blockquote><br><h2>  Trik # 1.  Perbandingan yang tidak mungkin </h2><br>  Mari kita mulai dengan trik pertama, yang saya sebut Impossible Comparison. <br>  Perhatikan kode ini dan lihat apakah ini bisa terjadi di PHP. <br><br><img src="https://habrastorage.org/webt/ji/sd/8i/jisd8ip2pzz7kx9otvdxq8_c-k4.png"><br><br>  Ada variabel, kami menyatakan nilainya, dan kemudian tiba-tiba tidak sama dengan dirinya sendiri. <br><br><h3>  Bukan angka </h3><br>  Ada artefak magis seperti NaN - Bukan-nomor. <br><br><img src="https://habrastorage.org/webt/gf/fw/3b/gffw3bl5rfz8xz1br3ut9ocmhnw.jpeg"><br><br>  Fitur luar biasa adalah bahwa itu tidak sama dengan dirinya sendiri.  Dan ini trik pertama kami: gunakan NaN untuk mengacaukan teman.  Tetapi NaN bukan satu-satunya solusi untuk tugas ini. <br><br><h3>  Kami menggunakan konstanta </h3><br><img src="https://habrastorage.org/webt/7c/hd/l1/7chdl1uranfz-cg9lbhc078ipnq.jpeg"><br><br>  Kuncinya adalah kita dapat mendeklarasikan <code>false</code> sebagai <code>true</code> untuk <code>namespace</code> dan membandingkan.  Pengembang yang tidak beruntung akan bertanya-tanya untuk waktu lama mengapa ada yang <code>true</code> dan tidak <code>false</code> . <br><br><h3>  Handler </h3><br>  Trik berikutnya adalah artileri yang lebih kuat dari dua opsi sebelumnya.  Mari kita lihat cara kerjanya. <br><br><img src="https://habrastorage.org/webt/xj/3g/5j/xj3g5jvenlytadytgnqth9yb47c.jpeg"><br><br>  Triknya didasarkan pada <code>tick_function</code> dan, seperti yang saya sebutkan, <code>declare(ticks=1)</code> . <br><br>  Bagaimana semuanya bekerja di luar kotak?  Pertama, kami mendeklarasikan beberapa fungsi, dan dengan referensi dibutuhkan parameter <code>isMagic</code> , dan kemudian mencoba mengubah nilai ini menjadi <code>true</code> .  Setelah kami mendeklarasikan <code>declare(ticks=1)</code> , penerjemah PHP memanggil <code>register_tick_function</code> - callback setelah setiap operasi dasar.  Dalam panggilan balik ini, kita dapat mengubah nilai yang sebelumnya <code>false</code> menjadi <code>true</code> .  Keajaiban! <br><br><h2>  Trik # 2.  Ekspresi ajaib </h2><br>  Ambil contoh di mana dua variabel dideklarasikan.  Salah satunya <code>false</code> , yang lain <code>true</code> .  Kami <code>isBlack</code> dan <code>isWhite</code> dan var_dump hasilnya.  Menurut Anda apa hasilnya? <br><br><img src="https://habrastorage.org/webt/yy/5r/kx/yy5rkxfp5zdicpodqjrutq1diri.png"><br><br>  <b>Operator prioritas</b> .  Jawaban yang benar <code>false</code> , karena dalam PHP ada yang namanya "operator didahulukan". <br><br><img src="https://habrastorage.org/webt/tm/8e/uf/tm8eufef1fi8j46c3fc3xbgl1z8.jpeg"><br><br>  Anehnya, operator logis <code>or</code> prioritas kurang dari operasi penugasan.  Oleh karena itu, hanya menetapkan <code>false</code> terjadi.  Di <code>isWhite</code> bisa ada ekspresi lain yang akan dijalankan jika bagian pertama gagal. <br><br><h3>  Ekspresi ajaib </h3><br>  Lihatlah kode di bawah ini.  Ada beberapa kelas yang berisi konstruktor, dan beberapa pabrik, kodenya akan lebih jauh. <br><br><img src="https://habrastorage.org/webt/bk/md/w5/bkmdw5zdb6bxcpml7jzygu9vjhs.jpeg"><br><br>  Perhatikan baris terakhir. <br><br><pre> <code class="php hljs">$value = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $factory-&gt;build(Foo::class);</code> </pre> <br>  Ada beberapa opsi yang bisa terjadi. <br><br><ul><li>  <code>$factory</code> akan digunakan sebagai nama kelas yang <code>new</code> ; <br></li><li>  akan ada kesalahan penguraian; <br></li><li>  panggilan <code>$factory-&gt;build()</code> akan digunakan, nilai fungsi ini akan kembali, hasilnya akan <code>new</code> ; <br></li><li>  nilai properti <code>$factory-&gt;build</code> akan digunakan untuk membangun kelas. <br></li></ul><br>  Mari kita periksa ide terakhir.  Di kelas <code>$factory</code> , kami mendeklarasikan serangkaian fungsi ajaib.  Mereka akan menulis apa yang kita lakukan: memanggil properti, memanggil metode, atau bahkan mencoba memanggil <code>invoke</code> pada objek. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Getting property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $arg)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Calling method {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Invoking {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} }</code> </pre> <br>  Jawaban yang benar: kami tidak memanggil metode, tetapi properti.  Setelah <code>$factory-&gt;build</code> ada parameter untuk konstruktor, yang akan kami sampaikan ke kelas ini. <br><br>  Omong-omong, dalam kerangka ini saya telah menerapkan fitur yang disebut "mencegat penciptaan objek baru" - Anda dapat "mengunci" desain ini. <br><br><h3>  Celah Parser </h3><br>  Contoh berikut adalah untuk parser PHP itu sendiri.  Pernahkah Anda mencoba fungsi panggilan atau menetapkan variabel di dalam kurung kurawal? <br><br><img src="https://habrastorage.org/webt/wi/b5/kb/wib5kbzb1j_0gzdurptouztvb7u.jpeg"><br><br>  Saya mendapatkan trik ini di Twitter, ini berfungsi sangat tidak standar. <br><br><pre> <code class="php hljs">$result = ${<span class="hljs-string"><span class="hljs-string">'_'</span></span> . !$_=getCallback()}(); $_=getCallback(); <span class="hljs-comment"><span class="hljs-comment">// string(5) "hello" !$_=getCallback()}(); // bool(false) '_'.!$_=getCallback()}(); // string(1) "_" ${'_'.!$_=getCallback()}(); // string(5) "hello"</span></span></code> </pre> <br>  Pertama, kami menetapkan nilai ekspresi ke variabel bernama <code>_</code> (garis bawah).  Kami sudah memiliki variabel, kami mencoba untuk membalikkan nilainya secara logis, dan kami mendapatkan <code>false</code> - garis dicor seolah-olah menjadi <code>true</code> .  Kemudian kami merekatkan semuanya menjadi satu dalam nama variabel, yang kemudian kami masukkan ke dalam kurung keriting. <br><br><blockquote>  Apa itu sihir?  Ini adalah hiburan yang memungkinkan kita untuk merasa terinspirasi, tidak biasa, katakan: “Apa?  Jadi itu mungkin?! ” </blockquote><br><h2>  Trik # 3.  Melanggar aturan </h2><br>  Yang saya sukai tentang PHP adalah Anda bisa melanggar aturan yang dibuat semua orang dalam upaya untuk menjadi super aman.  Ada desain yang disebut "kelas tertutup" yang memiliki konstruktor pribadi.  Tugas Anda sebagai murid pesulap adalah membuat instance kelas ini. <br><br><img src="https://habrastorage.org/webt/rt/uw/h4/rtuwh49inyhecfbsbea1hvb6kq4.jpeg"><br><br>  Pertimbangkan tiga opsi untuk bagaimana melakukan ini. <br><br><h3>  Penanganan masalah </h3><br>  Cara pertama adalah yang paling jelas.  Itu harus akrab bagi setiap pengembang - ini adalah API standar yang ditawarkan oleh bahasa tersebut kepada kami. <br><br><img src="https://habrastorage.org/webt/w2/or/df/w2ordfmqdhs3qg-nnzbff9yiilc.png"><br><br>  Konstruk <code>newInstanceWithoutConstructor</code> memungkinkan Anda untuk melewati batasan bahasa bahwa konstruktor bersifat pribadi dan membuat turunan kelas dengan melewati semua deklarasi konstruktor pribadi kami. <br><br>  Opsi ini berfungsi, sederhana, tidak memerlukan penjelasan apa pun. <br><br><h3>  Hubungan pendek </h3><br>  Opsi kedua membutuhkan lebih banyak perhatian dan keterampilan.  Fungsi anonim dibuat, yang kemudian mengikat osprey kelas itu. <br><br><img src="https://habrastorage.org/webt/2z/6k/lz/2z6klzhpzlkbcglexaslmiu9ezo.png"><br><br>  Di sini kita berada di dalam kelas dan dapat memanggil metode pribadi dengan aman.  Kami menggunakan ini dengan memanggil <code>new static</code> dari konteks kelas kami. <br><br><img src="https://habrastorage.org/webt/fn/v5/ul/fnv5ulkueuayx56vd07u7tfk128.png"><br><br><h3>  Deserialisasi </h3><br>  Opsi ketiga adalah yang paling maju, menurut saya. <br><br><img src="https://habrastorage.org/webt/ky/qi/xb/kyqixbfapmoxxaisd6g3mlypuny.png"><br><br>  Jika Anda menulis baris tertentu dalam format tertentu, gantikan nilai-nilai tertentu di sana - kelas kami akan berubah. <br><br><img src="https://habrastorage.org/webt/d2/0k/fi/d20kfibw1fnqmmovhc90_mqb1sy.png"><br><br>  Setelah deserialisasi, kita mendapatkan <code>instance</code> kita. <br><br><h3>  paket doktrin / instantiator </h3><br>  Sihir sering menjadi kerangka atau perpustakaan yang terdokumentasi - misalnya, dalam <b>doktrin / instantiator</b> semua ini diterapkan.  Kita dapat membuat objek apa pun dengan kode apa pun. <br><br><pre> <code class="plaintext hljs">composer show doctrine/instantiator --all name : doctrine/instantiator descrip. : A small, lightweight utility to instantiate objects in PHP without invoking their constructors keywords : constructor, instantiate type : library license : MIT License (MIT)</code> </pre> <br><h2>  Trik # 4.  Mencegah akses properti </h2><br>  Awan berkumpul: kelas adalah rahasia, properti dan konstruktor bersifat pribadi, dan juga callback. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Secret</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $secret = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Secret is: '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;secret; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPropAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Accessing property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">100500</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// How to create a secret instance and intercept the secret value?</span></span></code> </pre> <br>  Tugas kita, sebagai penyihir, entah bagaimana untuk memanggil panggilan balik. <br><br><h3>  Menambahkan keajaiban ... pengambil </h3><br>  Tambahkan sejumput sihir untuk membuatnya bekerja. <br><br><img src="https://habrastorage.org/webt/p7/ut/2w/p7ut2w699vysx99jnvmxvr0akfy.png"><br><br>  Sejumput sihir ini adalah <code>getter</code> sihir.  Itu memanggil fungsi, dan sejauh ini tidak ada hal buruk yang terjadi.  Tapi kita akan menggunakan trik sebelumnya dan membuat instance dari objek ini melewati konstruk pribadi. <br><br><img src="https://habrastorage.org/webt/b0/oy/gu/b0oyguiksznuw3rzfn19rsz1s4y.jpeg"><br><br>  Sekarang kita perlu entah bagaimana memanggil panggilan balik. <br><br><h3>  "Tidak disetel" di dalam sirkuit </h3><br>  Untuk melakukan ini, buat penutupan.  Di dalam penutupan yang ada dalam ruang lingkup kelas, kami menghapus variabel ini dengan fungsi <code>unset()</code> . <br><br><img src="https://habrastorage.org/webt/-n/2l/md/-n2lmdkswrc0cgk6tcobilajlgk.jpeg"><br><br>  <code>unset</code> memungkinkan Anda untuk sementara mengecualikan variabel, yang akan memungkinkan metode sulap kami dipanggil. <br><br><h3>  Kami memanggil konstruktor pribadi </h3><br>  Karena kami memiliki konstruktor pribadi yang menampilkan <code>echo</code> , Anda bisa mendapatkan konstruktor ini, membuatnya dapat diakses dengan memanggilnya. <br><br><img src="https://habrastorage.org/webt/1z/-g/vo/1z-gvohztwjnrbeujkiwecxdowi.jpeg"><br><br>  Jadi kelas rahasia kami hancur berkeping-keping. <br><br><img src="https://habrastorage.org/webt/om/cv/ef/omcvefwmkjdrmnvuepdf3mmvf5k.png"><br><br>  Kami menerima pesan bahwa kami: <br><br><ul><li>  dicegat; <br></li><li>  mengembalikan sesuatu yang sama sekali berbeda. <br></li></ul><br><h3>  paket leedavis / altr-ego </h3><br>  Banyak sihir sudah didokumentasikan.  Paket <b>altr-ego</b> hanya berpura-pura menjadi komponen Anda. <br><br><pre> <code class="plaintext hljs">composer show leedavis81/altr-ego --all name : leedavis81/altr-ego descrip. : Access an objects protected / private properties and methods keywords : php, break scope versions : dev-master, v1.0.2, v1.0.1, v1.0.0 type : library license : MIT License (MIT)</code> </pre> <br>  Anda dapat membuat salah satu objek dan menempelkannya sebentar.  Ini akan memungkinkan perubahan pada fasilitas.  Dia akan berubah dengan patuh dan memenuhi semua keinginan Anda. <br><br><h2>  Trik # 5.  Objek tidak berubah dalam PHP </h2><br>  Apakah ada objek yang tidak dapat diubah dalam PHP?  Ya, dan waktu yang sangat, sangat lama. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Magic</span></span> { $<span class="hljs-title"><span class="hljs-title">object</span></span> = (<span class="hljs-title"><span class="hljs-title">object</span></span>) [ "\0<span class="hljs-title"><span class="hljs-title">Secret</span></span>\0<span class="hljs-title"><span class="hljs-title">property</span></span>" =&gt; '<span class="hljs-title"><span class="hljs-title">test</span></span>' ]; var_dump($object); }</code> </pre> <br>  Dapatkan mereka dengan cara yang menarik.  Yang menarik adalah kita membuat array yang memiliki <b>kunci khusus</b> .  Dimulai dengan konstruksi <code>\0</code> - ini adalah karakter byte nol, dan setelah <code>Secret</code> kita juga melihat <code>\0</code> . <br><br>  Konstruk digunakan dalam PHP untuk mendeklarasikan properti pribadi di dalam kelas.  Jika kita mencoba untuk melemparkan objek ke array, kita akan melihat kunci yang sama.  Kami tidak memiliki apa-apa selain <code>stdClass</code> .  Ini berisi properti pribadi dari kelas <code>Secret</code> , yang setara dengan <code>test</code> . <br><br><pre> <code class="php hljs">object(stdClass) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-string"><span class="hljs-string">'property'</span></span> (Secret) =&gt; string <span class="hljs-string"><span class="hljs-string">'test'</span></span> (length=<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br>  Satu-satunya masalah adalah - maka Anda tidak bisa mendapatkan properti ini dari sana.  Itu dibuat, tetapi tidak tersedia. <br><br>  Saya pikir itu agak merepotkan - kita memiliki benda yang tidak dapat diubah, tetapi Anda tidak dapat menggunakannya.  Karena itu, saya memutuskan bahwa sudah waktunya untuk mengajukan keputusan saya.  Saya menggunakan semua pengetahuan dan sihir saya yang tersedia di PHP untuk membuat konstruksi berdasarkan semua trik sulap kami. <br><br>  <b>Mari kita mulai dengan yang sederhana - buat DTO</b> dan coba untuk mencegat semua properti di dalamnya (lihat trik sebelumnya). <br><br>  <b>Kami menyimpan di tempat yang aman nilai-nilai</b> yang kami tangkap dari sana.  Mereka tidak akan dapat diakses dengan metode apa pun: baik <code>reflection</code> , maupun penutupan, atau sihir lainnya.  Tetapi ada ketidakpastian - apakah ada tempat seperti itu di PHP yang akan menjamin untuk menyimpan beberapa variabel sehingga tidak ada programmer muda yang licik bisa sampai di sana? <br><br>  <b>Kami menyediakan metode ajaib</b> sehingga Anda dapat membaca nilai ini.  Untuk melakukan ini, kami memiliki <code>getters</code> sihir, metode <code>isset</code> sihir yang memungkinkan kami untuk menyediakan API. <br><br>  Mari kita kembali ke tempat yang dapat diandalkan dan mencoba mencari. <br><br><ul><li>  <code>Global variables</code> dibatalkan - siapa pun dapat mengubahnya. <br></li><li>  <code>Public properties</code> juga tidak cocok. <br></li><li>  <code>Protected properties</code> begitu-begitu saja, karena kelas anak akan melewati. <br></li><li>  <code>Private properties</code> .  Tidak ada kepercayaan, karena melalui penutupan atau melalui <code>reflection</code> dapat diubah. <br></li><li>  <code>Private static properties</code> dapat dicoba, tetapi <code>reflection</code> juga pecah. <br></li></ul><br>  Tampaknya tidak ada tempat untuk menyembunyikan nilai-nilai variabel.  Tapi ada hal ajaib - <code>Static variables in functions</code> - ini adalah variabel yang ada di dalam fungsi. <br><br><h3>  Penyimpanan nilai yang aman </h3><br>  Saya bertanya kepada <b>Nikita Popov</b> dan <b>Jay Watkins</b> tentang hal itu di saluran Stack Overflow khusus. <br><br><img src="https://habrastorage.org/webt/dz/lg/ev/dzlgevsl3qi9lwbi91sjwladbpu.png"><br><br>  Ini adalah fungsi di mana variabel statis dideklarasikan.  Apakah mungkin untuk keluar dari itu, mengubahnya?  Jawabannya adalah tidak. <br><br>  Kami telah menemukan celah kecil di dunia variabel terlindungi lainnya dan kami ingin menggunakannya. <br><br><h3>  Melewati Nilai oleh Tautan </h3><br>  Kami akan menggunakannya secara non-standar sebagai properti objek.  Tetapi Anda tidak dapat melewati properti, jadi kami menggunakan transfer nilai klasik dengan referensi. <br><br><img src="https://habrastorage.org/webt/xr/qe/vn/xrqevnya2a0a8mizylf8gbimfb8.jpeg"><br><br>  Ternyata ada kelas di mana ada metode <code>callStatic</code> ajaib, dan variabel <code>Static</code> dideklarasikan di dalamnya.  Dalam setiap panggilan ke beberapa fungsi, kami meneruskan nilai variabel dari objek yang tidak dapat diubah dengan merujuk ke semua metode bersarang kami.  Jadi kami menyediakan konteks. <br><br><h3>  Simpan status </h3><br>  Mari kita lihat bagaimana negara diselamatkan. <br><br><img src="https://habrastorage.org/webt/ef/5j/tm/ef5jtmjn0yuws-_nkbegq0neqag.png"><br><br>  Sederhana saja.  Untuk objek yang ditransfer, kami menggunakan fungsi <code>spl_object_id</code> , yang mengembalikan pengenal terpisah untuk setiap instance.  <code>State</code> yang sudah kita dapatkan dari objek mencoba menyelamatkan di sana.  Tidak ada yang istimewa. <br><br><h3>  Terapkan status objek </h3><br>  Di sini sekali lagi ada konstruksi untuk meneruskan nilai dengan referensi dan properti <code>unset</code> .  Kami menghapus semua properti saat ini, setelah sebelumnya menyimpannya dalam variabel Status, dan mengatur konteks ini untuk objek.  Objek tidak lagi berisi properti apa pun, tetapi hanya pengenalnya, yang dideklarasikan menggunakan <code>spl_object_id</code> dan dilampirkan ke objek ini saat masih hidup. <br><br><img src="https://habrastorage.org/webt/tl/gp/b9/tlgpb9z5yi8ibnwqmod_kifacrq.jpeg"><br><br><h3>  Dapatkan Negara </h3><br>  Maka semuanya sederhana. <br><br><img src="https://habrastorage.org/webt/2n/om/aq/2nomaqdui4jxeusbrlzucow9dck.png"><br><br>  Kami mendapatkan konteks ini pada <code>getter</code> sihir dan memanggil properti kami darinya.  Sekarang tidak ada seorang pun dan tidak ada yang dapat mengubah nilai setelah <code>Trait</code> terhubung. <br><br><img src="https://habrastorage.org/webt/m7/iu/_y/m7iu_yazwpqoc4hxhlg6rv4srbo.png"><br><br>  Semua metode ajaib ditimpa dan menerapkan kekekalan objek. <br><br><img src="https://habrastorage.org/webt/jy/he/ht/jyheht4ncrsuwsh7ngerdnd5x4m.jpeg"><br><br><h3>  lisachenko / objek-abadi </h3><br>  Seperti yang diharapkan, semuanya langsung diformalkan di perpustakaan dan siap digunakan. <br><br><pre> <code class="plaintext hljs">composer show /immutable-object --all name : /immutable-object descrip. : Immutable object library keywords : versions : * dev-master type : library license : MIT License (MIT)</code> </pre> <br>  Perpustakaannya terlihat sangat sederhana.  Kami menghubungkannya dan membuat kelas kami.  Ini memiliki sifat yang berbeda: pribadi, dilindungi dan publik.  Kami menghubungkan <code>ImmutableTrait</code> . <br><br><img src="https://habrastorage.org/webt/xj/gt/pe/xjgtpettshurwn257f51iaj5u78.jpeg"><br><br>  Setelah itu, Anda dapat memulai objek sekali - lihat nilainya.  Itu benar-benar disimpan di sana dan bahkan terlihat seperti DTO nyata. <br><br><pre> <code class="php hljs">object (MagicObject) [<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; int <span class="hljs-number"><span class="hljs-number">200</span></span></code> </pre> <br>  Tetapi jika kita mencoba mengubahnya, misalnya, seperti ini ... <br><br><img src="https://habrastorage.org/webt/su/s2/dh/sus2dhhps9ts4gwpx5nxk9301m4.jpeg"><br><br>  ... maka segera dapatkan <code>fatal exception</code> .  Kami tidak dapat mengubah properti karena properti itu tidak dapat diubah.  Bagaimana bisa begitu? <br><br><img src="https://habrastorage.org/webt/sh/iy/1c/shiy1cl8vmbfmwzbmah8whsbnyu.png"><br><br>  Jika Anda terlibat dalam tantangan yang menarik dan mencoba merendahkannya, Anda mendapatkan yang berikut ini. <br><br><img src="https://habrastorage.org/webt/ga/ym/l6/gayml6qurl3mr1o6qpvhzk1_rgi.png"><br><br>  Ini hadiah saya.  Segera setelah Anda mencoba untuk gagal di dalam PHPStorm di dalam kelas ini, itu akan langsung menghentikan eksekusi perintah Anda.  Saya tidak ingin Anda mempelajari kode ini - terlalu berbahaya.  Dia akan memperingatkan bahwa tidak ada yang bisa dilakukan. <br><br><h2>  Trik # 6.  Pengolahan benang </h2><br>  Pertimbangkan desainnya. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'php://filter/read=string.toupper/resource=magic.php'</span></span>;</code> </pre> <br>  Ada sesuatu yang ajaib: filter PHP, <code>read</code> , pada akhirnya semacam <b>file</b> magic.php <b>terhubung</b> .  File ini terlihat sangat sederhana. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Hello, world!'</span></span></code> </pre> <br>  Perhatikan bahwa kasingnya berbeda.  Namun, jika kami "mengisi" file melalui desain kami, maka kami mendapatkan ini: <br><br><pre> <code class="php hljs">HELLO, WORLD!</code> </pre> <br>  Apa yang terjadi pada saat itu?  Menggunakan konstruksi filter PHP di <code>include</code> memungkinkan Anda untuk menghubungkan filter apa pun, termasuk milik Anda, untuk menganalisis kode sumber.  Anda mengelola semuanya dalam kode sumber ini.  Anda dapat menghapus <code>final</code> dari kelas dan metode, membuat properti publik - apa pun yang Anda bisa crank melalui hal ini <br><br>  Bagian dari kerangka aspek saya didasarkan pada ini.  Ketika kelas Anda terhubung, itu menganalisis dan mengubahnya menjadi apa yang akan dieksekusi. <br><br>  Di luar kotak di PHP sudah ada sejumlah filter siap pakai. <br><br><pre> <code class="php hljs">var_dump(stream_get_filters()); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (size=<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'zlib.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'bzip2.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.iconv.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">' string.rotl3'</span></span> (length=<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.toupper'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.tolower'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.strip_tags'</span></span> (length=<span class="hljs-number"><span class="hljs-number">17</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'consumed'</span></span> (length=<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'dechunk'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br>  Mereka memungkinkan Anda untuk "zip" konten, menerjemahkannya ke huruf besar atau kecil. <br><br>  Trik utama yang ingin saya tampilkan sudah berakhir.  Sekarang mari kita beralih ke intisari dari semua yang bisa saya lakukan - pemrograman berorientasi aspek. <br><br><h2>  Trik # 7.  Pemrograman Berorientasi Aspek </h2><br>  Lihatlah kode ini dan pikirkan apakah itu baik atau buruk dari sudut pandang Anda. <br><br><img src="https://habrastorage.org/webt/xx/za/wa/xxzawap4whyavczg4g5ptvsx6q0.jpeg"><br><br>  Kode tampaknya cukup memadai.  Ia memeriksa hak akses, melakukan pencatatan, membuat pengguna, tetap ada, mencoba menangkap <code>exception</code> . <br><br>  Jika Anda melihat semua mie ini, mie ini diulang dalam setiap metode kami, dan satu-satunya hal yang berharga di sini adalah mie itu ditandai dengan warna hijau. <br><br><img src="https://habrastorage.org/webt/uk/za/mo/ukzamorqli1-u6wijf7d7knpwu4.jpeg"><br><br>  Yang lainnya: "keprihatinan sekunder" atau "keprihatinan lintas sektoral" adalah fungsi lintas sektoral. <br><br>  OOP konvensional membuat tidak mungkin untuk menyalin semua struktur ini dengan copy-paste, menghapusnya, dan mengeluarkannya di suatu tempat.  Ini buruk karena Anda harus mengulanginya.  Saya berharap kode selalu terlihat bersih dan rapi. <br><br><img src="https://habrastorage.org/webt/hg/vw/pm/hgvwpmdhsbhaeeh0uj5tdngunqo.jpeg"><br><br>  Sehingga tidak mengandung logging (biarkan diterapkan entah bagaimana) dan tidak mengandung <code>security</code> . <br><br><img src="https://habrastorage.org/webt/yz/-4/i2/yz-4i2yxrju_ti0839xg7idj5ua.jpeg"><br><br>  Jadi itu saja, termasuk masuk ... <br><br><img src="https://habrastorage.org/webt/sb/g1/8u/sbg18ud79gi4fg2dhc4h__ojxie.jpeg"><br><br>  ... dan pemeriksaan keamanan, ... <br><br><img src="https://habrastorage.org/webt/3p/-s/07/3p-s07k5zl65ze55vxs4iddkia8.jpeg"><br><br>  ... dilakukan dengan sendirinya. <br><br>  Dan itu mungkin. <br><br><h3>  Glosarium "Aspek" </h3><br>  Ada hal yang disebut Aspect.  Ini adalah contoh sederhana yang memeriksa izin.  Berkat dia, Anda dapat melihat beberapa anotasi, yang juga disorot oleh plugin untuk PhpStorm.  "Aspect" menyatakan ekspresi SQL yang menunjukkan kode untuk menerapkan kondisi ini.  Di bawah, misalnya, kami ingin menerapkan penutupan untuk semua metode publik dari kelas <code>UserService</code> . <br><br><img src="https://habrastorage.org/webt/jx/y_/g4/jxy_g4pvoli4gjezfp3w1vqpkpi.jpeg"><br><br>  Kami mendapatkan penutupan menggunakan metode <code>$invocation</code> . <br><br><img src="https://habrastorage.org/webt/ym/ju/mp/ymjump3eozldipcvntd-lpo9zbi.jpeg"><br><br>  Ini adalah semacam pembungkus di atas metode <code>reflection</code> , yang berisi lebih banyak argumen. <br><br>  Lebih lanjut dalam panggilan balik ini untuk setiap metode, Anda dapat memeriksa hak akses yang diperlukan, ini disebut "Saran". <br><br><img src="https://habrastorage.org/webt/i8/zz/pq/i8zzpqsvck05an3amyc8hihxj00.jpeg"><br><br>  Kami agak mengatakan bahasanya: "PHP yang terhormat, mohon terapkan metode ini sebelum setiap panggilan ke metode publik dari kelas <code>UserService</code> "  Hanya satu baris, tetapi banyak yang bermanfaat. <br><br><h3>  Aspek vs Pendengar Acara </h3><br>  Untuk membuatnya lebih jelas, saya membuat perbandingan Aspect dengan Event Listener.  Banyak yang bekerja di Symfony dan tahu apa itu Event Dispatcher. <br><br><img src="https://habrastorage.org/webt/5v/8o/ge/5v8oge0pczc4pteufmb0bvxf-da.jpeg"><br><br>  Mereka serupa di mana kita melewati semacam ketergantungan, misalnya, <code>AutorizationChecker</code> , dan menyatakan di mana harus diterapkan dalam kasus ini.  Dalam kasus Listener, ini adalah <code>SubscrabingEvent</code> disebut <code>UserCreate</code> , dan dalam kasus <code>Aspect</code> kami berlangganan semua panggilan ke metode publik dari <code>UserService</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada saat yang sama, isi dari penangan panggilan balik itu sendiri kira-kira sama: kami hanya memeriksa sesuatu dan bereaksi sesuai. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertimbangkan cara kerjanya di bawah tenda. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Langkah pertama</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang membutuhkan kerangka aspek adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pendaftaran</font></font></b> <code>Aspects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/-i/ae/iy/-iaeiyqqw4oar3tyxzbe4au38n8.jpeg"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap kedua</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Untuk menangani ini, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebelumnya </font><b><font style="vertical-align: inherit;">dengan filter PHP</font></b><font style="vertical-align: inherit;"> digunakan lagi </font><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/webt/6z/sq/da/6zsqda5rxa9alxpilq57s0wyspc.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini adalah komponen khusus yang mengubah kode sumber. </font><font style="vertical-align: inherit;">Dia melakukan ini secara diam-diam, tetapi dia akan bekerja dengan baik dalam produksi, karena dia terintegrasi dengan OPcache. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tahap ketiga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Semuanya terintegrasi pada level </font></font><code>Composer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Setelah Go diinstal! </font><font style="vertical-align: inherit;">AOP, dia mulai berkomunikasi dengan dekat</font></font><code>Composer</code>    ,    . <br><br><img src="https://habrastorage.org/webt/or/v8/l9/orv8l9yh9swl-mxtzowmrzoomm4.jpeg"><br><br>         <code>Aspects</code> ,   <code>Aspects</code> .       . <br><br>     . <br><br> <b>PHP-Parser</b> .     ,   ,      <b></b> . ,      <b> </b> ,  <a href="https://github.com/nikic/PHP-Parser">PHP-Parser</a> .           . <br><br><img src="https://habrastorage.org/webt/eg/ys/dm/egysdmlqf0bbvkmnacewmrrx-bw.jpeg"><br><br> <b> </b> .     ,   <b>goaop/parser-reflection</b> . <br><br><img src="https://habrastorage.org/webt/b_/oc/6d/b_oc6dfphlk-dtq3jxoijxzmn3i.jpeg"><br><br>    AST-      ,     .    ,        ,       ,       . <br><br>      . <br><br><img src="https://habrastorage.org/webt/9p/lu/an/9pluanmjyprlie0muf8sndyudba.jpeg"><br><br> ,         ,     <code>Aspect</code> . <br><br><img src="https://habrastorage.org/webt/3u/36/3z/3u363ztvggoi6ugvvsunvuilvuy.jpeg"><br><br>            ,     . <br><br><img src="https://habrastorage.org/webt/7z/tv/8p/7ztv8pyc8zti-wlpidlp3fm2zqk.jpeg"><br><br>    ,             ,       .      —     ,   -   ,      . <br><br><img src="https://habrastorage.org/webt/ea/o9/zn/eao9znftd3ywdjzd14acr-9w-fe.png"><br><br>      ,    .      ,   . <br><br>      Aspect MOCK.   «»,      ,   .     . <br><br>       —   <code>joinPoint</code> .   -    <code>joinPoint</code> :  ,   ,    . <br><br><h3>  Apa selanjutnya </h3><br>    . <br><br> <b>OPcache preloading for AOP Core</b> .  AOP-      .          10   . Bootstrapping     ,       PHP. <br><br> <b>FFI integration to modify binary opcodes</b> . ,    ,    .     PHP-opcodes,        <code>.bin</code> .   FFI  . <br><br> <b>Modifying PHP engine internal callbacks</b>   PHP-   userland.  PHP   .   FFI  PHP     userland,       , , .     . <br><br>    ,   . <br><br><h2>  #8. goaop/framework </h2><br>   ,   <a href="https://github.com/goaop/framework"> GitHub</a>       . <br><br><pre> <code class="plaintext hljs">composer show goaop/framework --all name : goaop/framework descrip. : Framework for aspect-oriented programming in PHP. keywords : php, aop, library, aspect versions : dev-master, 3.0.x-dev, 2.x-dev, 2.3.1, … type : library license : MIT License</code> </pre> <br>    ,        PhpStorm. <br><br><img src="https://habrastorage.org/webt/ut/ah/rp/utahrp4yrgxj7ch2d0brjr_p7fk.jpeg"><br><br>   ,     Pointcuts.  ,    ,  .     —    ,   ,     . <br><br><h2> Trick #9.   </h2><br>          . ,    . <br><br>   :  ,   -    .           <code>fastcgi_finish_request</code> .    ,      ,   , - callback  —   . <br><br>         ? <br><br>   ,   <code>Deffered</code> ,  ,       . <br><br><img src="https://habrastorage.org/webt/yy/zh/7d/yyzh7dcpvv14sd3r75kroe07xky.jpeg"><br><br>    <code>Aspect</code> ,  ,    ,   <code>Deffered</code> ,    . <br><br><img src="https://habrastorage.org/webt/cc/y5/zj/ccy5zjad0olfwzemsxmnmo8mi_c.png"><br><br>   <code>Aspect</code>    :  ,  , ,      callback,  ,     callback.      . <br><br>  React ,     <code>promise</code> .     ,  -    ,  -     ,   . <br><br> ,       . <br><br><img src="https://habrastorage.org/webt/yp/zl/zp/ypzlzpf5k7tmuiculbcntozf0ga.png"><br><br>  <code>shutdown_function</code>   <code>Aspect</code> .     ,    callback,  ,   ,   ,   callback <code>onPhpTerminate</code> .     <code>fastcgi_finish_request</code>  : «, , ,   ,  ».         . <br><br>   ,          <code>sendPushNotification</code> . <br><br><img src="https://habrastorage.org/webt/z4/4g/g0/z44gg0rpyaguh-rs8xge_tf6ync.jpeg"><br><br> , -       —   2 . <br><br><img src="https://habrastorage.org/webt/v9/oa/rr/v9oarrwwsrifqgxpfpldsbezd4s.jpeg"><br><br>   ,  ,      ,  2   . <br><br>    ,  <code>Deferred</code> . <br><br><img src="https://habrastorage.org/webt/62/um/gw/62umgw3pjrqokgzk462oyhtlcpu.jpeg"><br><br>   ,    . -       ,  ,      . <br><br>  Itu saja. ,          - .  ,   . <br><br><blockquote>    <a href="https://phprussia.ru/moscow/2020">PHP Russia 2020</a>   .        — <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dpc2020"> </a> .   <a href="http://eepurl.com/VYVaf"></a>  <a href="https://t.me/PHPRussiaConfChannel">telegram-</a> ,       PHP Russia 2020. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id478618/">https://habr.com/ru/post/id478618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id478596/index.html">Fungsi Anonim PHP: Mengekspos Sesi Sihir Hitam</a></li>
<li><a href="../id478602/index.html">MVC dalam Persatuan dengan Objek Skrip. Bagian 2</a></li>
<li><a href="../id478604/index.html">Dari buruh ke pemrogram php. Karir pengembangan yang tidak biasa</a></li>
<li><a href="../id478606/index.html">"Selamat malam" - bagaimana gadget pintar membuat orang tidak bisa tidur</a></li>
<li><a href="../id478616/index.html">Windows UAC tidak pernah berhenti memukau, atau Cara mendeteksi orang dalam</a></li>
<li><a href="../id478620/index.html">Mengapa Anda mencoba FastAPI?</a></li>
<li><a href="../id478622/index.html">Pengujian A / B, saluran pipa dan ritel: kuartal bermerek untuk Big Data dari GeekBrains dan X5 Retail Group</a></li>
<li><a href="../id478626/index.html">Penerapan debug perangkat lunak dengan strace</a></li>
<li><a href="../id478628/index.html">CRI tinggi dalam bahasa Cina</a></li>
<li><a href="../id478630/index.html">Pascal memainkan Go. Implementasi metode dan antarmuka dalam kompiler amatir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>