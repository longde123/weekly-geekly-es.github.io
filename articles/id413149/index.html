<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏿 👊 💿 Gudang data terdistribusi dalam konsep Danau Data: mulai dari mana 👊🏽 🥚 🥔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam dunia perusahaan, ada kejenuhan dengan sistem front-end, data bus, dan sistem klasik lainnya yang telah diterapkan oleh semua orang selama 10-15...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gudang data terdistribusi dalam konsep Danau Data: mulai dari mana</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neoflex/blog/413149/">  Dalam dunia perusahaan, ada kejenuhan dengan sistem front-end, data bus, dan sistem klasik lainnya yang telah diterapkan oleh semua orang selama 10-15 tahun terakhir.  Tetapi ada satu segmen, yang sampai saat ini berada dalam status "semua orang inginkan, tetapi tidak ada yang tahu apa itu."  Dan ini adalah Big Data.  Kedengarannya indah, dipromosikan oleh perusahaan-perusahaan top Barat - bagaimana tidak menjadi berita gembira? <br><br><img src="https://habrastorage.org/webt/im/vq/jd/imvqjd41airg83tkthvkawlnlgw.png"><br><br>  Tetapi sementara sebagian besar hanya menonton dan bertanya, beberapa perusahaan telah mulai secara aktif menerapkan solusi berdasarkan tumpukan teknologi ini ke lanskap TI mereka.  Peran penting dalam hal ini dimainkan oleh kemunculan distribusi Apache Hadoop komersial, yang pengembangnya memberikan dukungan teknis kepada pelanggan mereka.  Merasakan perlunya solusi seperti itu, salah satu pelanggan kami memutuskan untuk mengatur data warehouse terdistribusi dalam konsep Data Lake berdasarkan Apache Hadoop. <br><a name="habracut"></a><br><h2>  Tujuan proyek </h2><br><p>  Pertama, optimalkan kerja departemen manajemen risiko.  Sebelum mulai bekerja, seluruh departemen terlibat dalam penghitungan faktor risiko kredit (FCR), dan semua perhitungan dilakukan secara manual.  Penghitungan ulang memakan waktu sekitar satu bulan setiap kali, dan data yang mendasari itu punya waktu untuk menjadi usang.  Oleh karena itu, tugas solusi termasuk pemuatan harian dari delta data ke dalam repositori, menghitung ulang PCF dan membangun data mart di alat BI (fungsi SpagoBI cukup untuk tugas ini) untuk memvisualisasikannya. </p><br><p>  Kedua, untuk menyediakan alat Penambangan Data kinerja tinggi untuk karyawan bank yang terlibat dalam Ilmu Data.  Alat-alat ini, seperti Jupyter dan Apache Zeppelin, dapat diinstal secara lokal dan juga dapat digunakan untuk mengeksplorasi data dan membangun model.  Tetapi integrasi mereka dengan cluster Cloudera memungkinkan penggunaan sumber daya perangkat keras dari node sistem yang paling produktif untuk perhitungan, yang mempercepat tugas analisis data hingga puluhan atau bahkan ratusan kali. </p><br><p>  Rak Oracle Big Data Appliance dipilih sebagai solusi perangkat keras target, jadi distribusi Clachede dari Apache Hadoop diambil sebagai dasarnya.  Rak tersebut bepergian untuk beberapa waktu, dan untuk mempercepat prosesnya, server di cloud pribadi pelanggan dialokasikan untuk proyek ini.  Solusinya masuk akal, tetapi ada sejumlah masalah, yang akan saya bahas di bawah ini. </p><br><p>  Tugas-tugas berikut ini direncanakan dalam proyek: <br><br></p><ol><li>  Menyebarkan CDH Cloudera (Distribusi Cloudera termasuk Apache Hadoop) dan layanan tambahan yang diperlukan untuk bekerja. </li><li>  Konfigurasikan perangkat lunak yang diinstal. </li><li>  Siapkan integrasi berkesinambungan untuk mempercepat proses pengembangan (akan dibahas dalam artikel terpisah). </li><li>  Instal BI-tools untuk membangun pelaporan dan alat-alat Penemuan Data untuk memastikan pekerjaan pusat data (akan dibahas dalam pos terpisah). </li><li>  Untuk mengembangkan aplikasi untuk mengunduh data yang diperlukan dari sistem akhir, serta pembaruan rutin mereka. </li><li>  Kembangkan formulir pelaporan untuk memvisualisasikan data dalam alat BI. </li></ol><br><p> Ini bukan tahun pertama Neoflex mengembangkan dan mengimplementasikan sistem berbasis Apache Hadoop dan bahkan memiliki produk sendiri untuk pengembangan visual proses ETL - Neoflex Datagram.  Untuk waktu yang lama saya ingin mengambil bagian dalam salah satu proyek kelas ini dan dengan senang hati mengelola sistem ini.  Pengalaman itu ternyata sangat berharga dan memotivasi untuk mempelajari lebih lanjut topik ini, jadi saya segera membaginya dengan Anda.  Semoga ini akan menarik. </p><br><h2>  Sumber daya </h2><br><p>  Sebelum memulai instalasi, Anda disarankan untuk menyiapkan semua yang Anda butuhkan. <br>  Jumlah dan kekuatan zat besi secara langsung tergantung pada berapa banyak dan media mana yang perlu disebarkan.  Untuk tujuan pengembangan, Anda dapat menginstal semua komponen pada setidaknya satu mesin virtual lemah, tetapi pendekatan ini tidak diterima. </p><br><p>  Pada tahap uji coba proyek dan pengembangan aktif, ketika jumlah pengguna sistem minimal, hanya satu lingkungan utama sudah cukup - ini memungkinkan untuk mempercepat dengan mengurangi waktu memuat data dari sistem akhir (prosedur yang paling sering dan panjang untuk mengembangkan gudang data).  Sekarang sistem telah stabil, kita telah sampai pada konfigurasi dengan tiga lingkungan - test, preprod dan prod (main). </p><br><p>  Di cloud pribadi, server dialokasikan untuk mengatur 2 lingkungan - lingkungan utama dan pengujian.  Spesifikasi media ditunjukkan pada tabel di bawah ini: <br></p><table><tbody><tr><th>  Janji temu </th><th>  Jumlah </th><th>  vCPU </th><th>  vRAM, Gb </th><th>  Disk, Gb </th></tr><tr><td>  Lingkungan utama, layanan Cloudera </td><td>  3 </td><td>  8 </td><td>  64 </td><td>  2.200 </td></tr><tr><td>  Lingkungan primer, HDFS </td><td>  3 </td><td>  22 </td><td>  288 </td><td>  5000 </td></tr><tr><td>  Lingkungan Inti, Alat Penemuan Data </td><td>  1 </td><td>  16 </td><td>  128 </td><td>  2200 </td></tr><tr><td>  Lingkungan uji, layanan Cloudera </td><td>  1 </td><td>  8 </td><td>  64 </td><td>  2200 </td></tr><tr><td>  Lingkungan uji, HDFS </td><td>  2 </td><td>  22 </td><td>  256 </td><td>  4000 </td></tr><tr><td>  Lingkungan Inti, Alat Penemuan Data </td><td>  1 </td><td>  16 </td><td>  128 </td><td>  2200 </td></tr><tr><td>  Ci </td><td>  2 </td><td>  6 </td><td>  48 </td><td>  1000 </td></tr></tbody></table><br><p>  Kemudian, lingkungan utama bermigrasi ke Oracle BDA, dan server digunakan untuk mengatur lingkungan preprod. </p><br><p>  Keputusan tentang migrasi dibenarkan - sumber daya yang dialokasikan untuk server HDFS secara objektif kurang.  Kemacetan adalah disk kecil (apa 5 Tb untuk Data Besar?) Dan prosesor yang tidak cukup kuat, yang dimuat secara stabil pada 95% selama pekerjaan rutin tugas pemuatan data.  Dengan server lain, situasinya sebaliknya - hampir sepanjang waktu mereka menganggur dan sumber daya mereka dapat digunakan untuk keuntungan besar pada proyek lain. </p><br><p>  Dengan perangkat lunak, semuanya tidak mudah - karena fakta bahwa pengembangan dilakukan di cloud pribadi tanpa akses ke Internet, semua file harus ditransfer melalui layanan keamanan dan hanya dengan persetujuan.  Dalam hal ini, saya harus memuat semua distribusi, paket, dan dependensi yang diperlukan. </p><br><p>  Mengatur keepcache = 1 di file /etc/yum.conf (RHEL 7.3 digunakan sebagai OS) banyak membantu dalam tugas yang sulit ini - menginstal perangkat lunak yang diperlukan pada mesin dengan akses jaringan jauh lebih mudah daripada mengunduhnya secara manual dari repositori bersama dengan dependensi;) <br><br>  Apa yang Anda perlu gunakan: <br><br></p><ol><li>  Oracle JDK (tidak ada Java di mana pun). </li><li>  Database untuk menyimpan informasi yang dibuat dan digunakan oleh layanan CDH (misalnya, Hive Metastore).  Dalam kasus kami, PostgreSQL versi 9.2.18 diinstal, tetapi salah satu layanan Cloudera yang didukung dapat digunakan (daftar berbeda untuk versi distribusi yang berbeda, lihat bagian Persyaratan dan Versi yang Didukung di situs web resmi).  Di sini harus dicatat bahwa pilihan database tidak sepenuhnya berhasil - Oracle BDA datang dengan database MySQL (salah satu produk mereka, yang pergi ke mereka dengan pembelian Sun) dan akan lebih logis untuk menggunakan database yang sama untuk lingkungan lain, yang akan menyederhanakan proses migrasi.  Disarankan untuk memilih distribusi berdasarkan solusi perangkat keras target. </li><li>  Daemon Chrony untuk sinkronisasi waktu di server. </li><li>  Server Manajer Cloudera. </li><li>  Demons Cloudera Manager. </li></ol><br><h2>  Persiapan untuk instalasi </h2><br><p>  Sebelum memulai instalasi CDH, sejumlah pekerjaan persiapan harus dilakukan.  Satu bagian berguna selama instalasi, yang lain akan menyederhanakan operasi. </p><br><h2>  Instalasi dan pengaturan OS </h2><br><p>  Pertama-tama, ada baiknya menyiapkan mesin virtual (dan nyata) yang akan meng-host sistem: instal versi yang didukung pada masing-masing (daftar berbeda untuk versi distribusi yang berbeda, lihat bagian "Persyaratan dan Versi yang Didukung" dari situs web resmi), tetapkan nama host adalah nama yang dapat dimengerti (misalnya, &lt;system_name&gt; master1,2,3 ..., &lt;system_name&gt; slave1,2,3 ...), serta menandai disk untuk penyimpanan file dan file sementara yang dibuat selama operasi sistem. </p><br><p>  Rekomendasi markup adalah sebagai berikut: <br><br></p><ul><li>  Pada server dengan HDFS, buat volume setidaknya 500 Gb untuk file yang dibuat YARN selama bekerja dan tempatkan di direktori / yarn (di mana volume ini harus dipasang setelah menginstal CDH).  Volume kecil (sekitar 100 Gb) harus dialokasikan untuk OS, layanan Cloudera, log, dan fasilitas lainnya.  Semua ruang kosong yang akan tersisa setelah manipulasi ini harus digabungkan menjadi satu volume besar dan dipasang ke direktori / dfs sebelum memuat data ke dalam penyimpanan.  HDFS menyimpan data dalam bentuk blok yang agak kecil dan lebih baik untuk tidak terlibat dalam transfer mereka sekali lagi.  Juga, untuk kenyamanan menambahkan disk nanti, disarankan untuk menggunakan LVM - akan lebih mudah untuk memperluas penyimpanan (terutama ketika itu menjadi sangat BESAR). </li><li>  Pada server dengan layanan Cloudera, Anda dapat me-mount semua ruang yang tersedia di direktori root - seharusnya tidak ada masalah dengan volume file yang besar, terutama jika Anda secara teratur membersihkan log.  Satu-satunya pengecualian adalah server dengan basis data, yang digunakan layanan Cloudera untuk kebutuhan mereka - pada server ini masuk akal untuk menandai volume terpisah di bawah direktori di mana file-file dari basis data ini disimpan (akan tergantung pada distribusi yang dipilih).  Layanan menulis cukup dan 500 Gb seharusnya lebih dari cukup.  Untuk keamanan, Anda juga dapat menggunakan LVM. </li></ul><br><h2>  Menyiapkan server http dan instalasi offline paket yum dan CDH </h2><br><p>  Karena perangkat lunak diinstal tanpa akses ke Internet, untuk menyederhanakan instalasi paket, disarankan untuk menaikkan server HTTP dan menggunakannya untuk membuat repositori lokal yang dapat diakses melalui jaringan.  Anda dapat menginstal semua perangkat lunak secara lokal menggunakan, misalnya, rpm, tetapi dengan sejumlah besar server dan penampilan beberapa lingkungan, nyaman untuk memiliki repositori tunggal dari mana Anda dapat menginstal paket tanpa harus mentransfernya secara manual dari mesin ke mesin. </p><br><p>  Instalasi dilakukan pada OS Red Hat 7.3, oleh karena itu, artikel akan berisi perintah khusus untuk itu dan sistem operasi berbasis CentOS lainnya.  Ketika diinstal pada sistem operasi lain, urutannya akan serupa, hanya manajer paket yang akan berbeda. <br>  Agar tidak menulis di mana-mana sudo, kami menganggap bahwa instalasi berasal dari root. </p><br><p>  <b>Inilah yang perlu Anda lakukan:</b> <br>  <b>1.</b> Mesin di mana server HTTP dan distribusi akan ditempatkan dipilih. <br>  <b>2.</b> Pada mesin dengan OS serupa, tetapi terhubung ke Internet, atur flag keepcache = 1 pada file /etc/yum.conf dan httpd dengan semua dependensi diinstal: <br><br></p><pre><code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> httpd</code> </pre> <br>  Jika perintah ini tidak berhasil, maka Anda perlu menambahkan ke repositori yum repositori yang berisi paket-paket ini, misalnya, yang ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">centos.excellmedia.net/7/os/x86_64</a> : <br><br><pre> <code class="hljs tex">echo -e "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[centos.excellmedia.net]</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nname</span></span></span><span class="hljs-tag">=</span></span>excellmedia<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nbaseurl</span></span></span><span class="hljs-tag">=</span></span>http://centos.excellmedia.net/7/os/x86_64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nenabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">1</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ngpgcheck</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">0</span></span></span></span>" &gt; /etc/yum.repos.d/excell.repo</code> </pre> <br>  Setelah itu, <b>menggunakan</b> perintah <b>repositori yum</b> , <b>kami</b> memverifikasi bahwa repositori diperketat - repositori tambahan akan muncul dalam daftar repositori (repo id - centos.excellmedia.net; nama repo - excellmedia). <br>  Sekarang periksa apakah Anda melihat paket yang kami butuhkan: <br><br><pre> <code class="hljs perl">yum list | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> httpd</code> </pre> <br>  Jika output berisi paket yang diperlukan, maka Anda dapat menginstalnya dengan perintah di atas. <br><br>  <b>3.</b> Untuk membuat repositori yum, kita memerlukan paket createrepo.  Itu juga ada di repositori di atas dan diatur dengan cara yang sama: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> createrepo</code> </pre> <br>  <b>4.</b> Seperti yang saya katakan sebelumnya, layanan CDH membutuhkan database untuk berfungsi.  Instal PostgreSQL untuk keperluan ini: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> postgresql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br>  <b>5.</b> Salah satu prasyarat untuk operasi CDH yang benar adalah sinkronisasi waktu pada semua server yang termasuk dalam cluster.  Untuk keperluan ini, paket <b>chronyd digunakan</b> (pada OS-OS di mana saya harus menggunakan CDH, itu diinstal secara default).  Periksa ketersediaannya: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">chronyd</span></span> -v</code> </pre> <br>  Jika tidak diinstal, maka instal: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> chrony</code> </pre> <br>  Jika diinstal, maka unduh saja: <br><br><pre> <code class="hljs javascript">yumdownloader --destdir=<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>cache/yum/x86_64/<span class="hljs-number"><span class="hljs-number">7</span></span>Server/<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">repo</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">/packages chrony</span></span></code> </pre> <br>  <b>6.</b> Pada saat yang sama, segera unduh paket yang diperlukan untuk menginstal CDH.  Mereka tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">archive.cloudera.com</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">archive.cloudera.com/cm</a> &lt;versi utama CDH&gt; / &lt;nama OS Anda&gt; / &lt;versi OS Anda&gt; / x86_64 / cm / &lt;versi lengkap CDH&gt; / RPMS / x86_64 /.  Anda dapat mengunduh paket secara manual (cloudera-manager-server dan cloudera-manager-daemon), atau menambahkan repositori dengan analogi dan menginstalnya: <br><br><pre> <code class="hljs powershell">yum install cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-daemons</span></span> cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span></code> </pre> <br>  <b>7.</b> Setelah instalasi, paket dan dependensinya di-cache di folder / var / cache / yum / x86_64 / 7Server / \ &lt;repo id \&gt; / paket.  Kami mentransfernya ke mesin yang dipilih untuk server dan distribusi HTTP, dan menginstal: <br><br><pre> <code class="hljs xml">rpm -ivh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre> <br>  <b>8.</b> Jalankan httpd, membuatnya terlihat dari host lain di cluster kami, dan juga menambahkannya ke daftar layanan yang mulai secara otomatis setelah memuat: <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> httpd systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> httpd systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> firewalld <span class="hljs-comment"><span class="hljs-comment">#       systemctl disable firewalld #       setenforce 0</span></span></code> </pre> <br>  <b>9.</b> Sekarang kami memiliki server HTTP yang berfungsi.  Direktori kerjanya adalah <b>/ var / www / html</b> .  Buat 2 folder di dalamnya - satu untuk repositori yum, yang lain untuk parser Cloudera (lebih lanjut tentang itu nanti): <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www/html <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> yum_repo parcels</code> </pre> <br>  <b>10.</b> Untuk layanan Cloudera kita membutuhkan <b>Java</b> .  Semua mesin memerlukan versi JDK yang sama diinstal; Cloudera merekomendasikan Hot Spot Oracle.  Unduh paket distribusi dari situs web resmi (http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) dan transfer ke folder <b>yum_repo</b> . <br><br>  <b>11.</b> Buat repositori yum di folder yum_repo menggunakan utilitas createrepo sehingga paket JDK tersedia untuk instalasi dari mesin cluster: <br><br><pre> <code class="hljs swift">createrepo -v /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/html/yum_repo/</code> </pre> <br>  <b>12.</b> Setelah membuat repositori lokal kami di setiap host, Anda perlu menambahkan deskripsinya, mirip dengan paragraf 2: <br><br><pre> <code class="hljs tex">echo -e "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">n</span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[yum.local.repo]</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nname</span></span></span><span class="hljs-tag">=</span></span>yum_repo<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nbaseurl</span></span></span><span class="hljs-tag">=</span></span>http://&lt;   httpd&gt;/yum_repo/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nenabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">1</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ngpgcheck</span></span></span><span class="hljs-tag">=</span><span class="hljs-number"><span class="hljs-tag"><span class="hljs-number">0</span></span></span></span>" &gt; /etc/yum.repos.d/yum_repo.repo</code> </pre> <br>  Anda juga dapat melakukan pemeriksaan yang mirip dengan paragraf 2. <br><br>  <b>13.</b> JDK tersedia, instal: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">yum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jdk1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0_161</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span></code> </pre> <br>  Untuk menggunakan Java, Anda perlu mengatur variabel JAVA_HOME.  Saya sarankan Anda mengekspornya segera setelah instalasi, serta menulisnya ke file <b>/ etc / environment</b> dan <b>/ etc / default / bigtop-utils</b> sehingga secara otomatis diekspor setelah me-restart server dan lokasinya disediakan ke layanan CDH: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> JAVA_HOME=<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>java/jdk1<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>_161 echo <span class="hljs-string"><span class="hljs-string">"JAVA_HOME=/usr/java/jdk1.8.0_161"</span></span> &gt;&gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>environment <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> JAVA_HOME=<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>java/jdk1<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>_144 &gt;&gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span><span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/bigtop-utils</code> </pre> <br>  <b>14.</b> Dengan cara yang sama, instal chronyd pada semua mesin di cluster (kecuali, tentu saja, tidak ada): <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> chrony</code> </pre> <br>  <b>15.</b> Pilih host tempat PostgreSQL akan bekerja, dan instal: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> postgresql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br>  <b>16.</b> Demikian pula, pilih host di mana Cloudera Manager akan berjalan, dan instal: <br><br><pre> <code class="hljs powershell">yum install cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-daemons</span></span> cloudera<span class="hljs-literal"><span class="hljs-literal">-manager</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span></code> </pre> <br>  <b>17.</b> Paket-paket diinstal, Anda dapat mulai mengkonfigurasi perangkat lunak sebelum instalasi. <br><br><h3>  Tambahan: </h3><br><p>  Selama pengembangan dan pengoperasian sistem, Anda perlu menambahkan paket ke repositori yum untuk menginstalnya pada host cluster (misalnya, distribusi Anaconda).  Untuk melakukan ini, selain mentransfer file ke folder yum_repo, Anda perlu melakukan tindakan berikut: <br><br></p><ul><li>  pada mesin dengan httpd, jalankan perintah pembaruan repositori yum: <br><br><pre> <code class="hljs powershell">createrepo <span class="hljs-literal"><span class="hljs-literal">-v</span></span> -<span class="hljs-literal"><span class="hljs-literal">-update</span></span> /var/www/html/yum_repo/</code> </pre> </li><li>  Pada semua mesin tempat Anda ingin menginstal paket, lakukan flush cache yum: </li><li><pre> <code class="hljs pgsql">yum clean <span class="hljs-keyword"><span class="hljs-keyword">all</span></span></code> </pre> </li><li><pre> <code class="hljs swift">rm -rf /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/cache/yum</code> </pre> </li></ul><br><h2>  Mengkonfigurasi perangkat lunak tambahan </h2><br><p>  Inilah saatnya untuk mengkonfigurasi PostgreSQL dan membuat basis data untuk layanan kami di masa depan.  Pengaturan ini relevan untuk CDH versi 5.12.1, ketika menginstal versi distribusi lainnya, Anda disarankan untuk membaca bagian "Cloudera Manager dan Managed Service Datastores" di situs web resmi. </p><br><p>  Untuk memulai, mari inisialisasi basis data: </p><br><pre> <code class="hljs powershell">postgresql<span class="hljs-literal"><span class="hljs-literal">-setup</span></span> initdb</code> </pre> <br>  Sekarang kami mengatur interaksi jaringan dengan database.  Di file <b>/var/lib/pgsql/data/pg_hba.conf</b> di bagian koneksi lokal IPv4, ubah metode untuk alamat 127.0.0.1/32 ke metode md5, tambahkan metode trust dan tambahkan subnet cluster dengan metode trust : <br><br><pre> <code class="hljs pgsql">vi /var/lib/pgsql/data/pg_hba.conf pg_hba.conf: <span class="hljs-comment"><span class="hljs-comment">----------------------------------------------------------------------- # TYPE DATABASE USER ADDRESS METHOD # "local" is for Unix domain socket connections only local all all peer # IPv4 local connections: host all all 127.0.0.1/32 md5 host all all 127.0.0.1/32 trust host all all &lt;cluster_subnet&gt; trust -----------------------------------------------------------------------</span></span></code> </pre> <br><p>  Kemudian kita akan membuat beberapa penyesuaian pada file <b>/var/lib/pgsql/data/postgres.conf</b> (Saya hanya akan memberikan baris yang perlu diubah atau diperiksa untuk kepatuhan: <br><br></p><pre> <code class="hljs cs">vi /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/pgsql/data/postgres.conf postgres.conf: ----------------------------------------------------------------------- listen_addresses = <span class="hljs-string"><span class="hljs-string">'*'</span></span> max_connections = <span class="hljs-number"><span class="hljs-number">100</span></span> shared_buffers = <span class="hljs-number"><span class="hljs-number">256</span></span>MB checkpoint_segments = <span class="hljs-number"><span class="hljs-number">16</span></span> checkpoint_completion_target = <span class="hljs-number"><span class="hljs-number">0.9</span></span> logging_collector = <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> log_filename = <span class="hljs-string"><span class="hljs-string">'postgresql-%a.log'</span></span> log_truncate_on_rotation = <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> log_rotation_age = <span class="hljs-number"><span class="hljs-number">1</span></span>d log_rotation_size = <span class="hljs-number"><span class="hljs-number">0</span></span> log_timezone = <span class="hljs-string"><span class="hljs-string">'W-SU'</span></span> datestyle = <span class="hljs-string"><span class="hljs-string">'iso, mdy'</span></span> timezone = <span class="hljs-string"><span class="hljs-string">'W-SU'</span></span> lc_messages = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> lc_monetary = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> lc_numeric = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> lc_time = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> default_text_search_config = <span class="hljs-string"><span class="hljs-string">'pg_catalog.english'</span></span> -----------------------------------------------------------------------</code> </pre> <br><p>  Setelah konfigurasi selesai, Anda perlu membuat basis data (bagi mereka yang lebih dekat dengan terminologi Oracle - skema) untuk layanan yang akan kami instal.  Dalam kasus kami, layanan berikut dipasang: Layanan Manajemen Cloudera, HDFS, Hive, Hue, Impala, Oozie, Benang dan ZooKeeper.  Dari semua ini, Hive, Hue, dan Oozie membutuhkan basis data, dan 2 pangkalan diperlukan untuk kebutuhan layanan Cloudera - satu untuk server Cloudera Manager, yang lain untuk manajer laporan, yang merupakan bagian dari Layanan Manajemen Cloudera.  Luncurkan PostgreSQL dan tambahkan ke autoload: <br><br></p><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> postgresql systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> postgresql</code> </pre> <br><p>  Sekarang kita dapat terhubung dan membuat database yang diperlukan: <br><br></p><pre> <code class="hljs pgsql">sudo -u postgres psql &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> scm <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> scm <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> scm <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #    Cloudera Manager &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> rman <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> rman <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> rman <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #      &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> hive <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> metastore <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> hive <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #    Hive Metastore &gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> metastore <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> standard_conforming_strings = <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; #   PostgreSQL   <span class="hljs-number"><span class="hljs-number">8.2</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> hue_u <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> hue_d <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> hue_u <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span>; #    Hue &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROLE</span></span> oozie <span class="hljs-keyword"><span class="hljs-keyword">LOGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENCRYPTED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;password&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOSUPERUSER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INHERIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATEDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOCREATEROLE</span></span>; &gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> "oozie" <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> OWNER = oozie ENCODING = <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span> TABLESPACE = pg_default LC_COLLATE = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> LC_CTYPE = <span class="hljs-string"><span class="hljs-string">'en_US.UTF-8'</span></span> CONNECTION LIMIT = <span class="hljs-number"><span class="hljs-number">-1</span></span>; #    Oozie    : &gt; \q</code> </pre> <br><p>  Untuk layanan lain, basis data dibuat dengan cara yang sama. </p><br><p>  Jangan lupa untuk menjalankan skrip untuk menyiapkan database server Cloudera Manager, berikan data input untuk dihubungkan ke database yang dibuat untuknya: <br><br></p><pre> <code class="hljs pgsql">. /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/cmf/<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>/scm_prepare_database.sh postgresql scm scm &lt;<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>&gt;</code> </pre> <br><h2>  Membuat repositori dengan file CDH </h2><br><p>  Cloudera menyediakan 2 cara untuk menginstal paket menggunakan CDH dan menggunakan paket.  Opsi pertama melibatkan mengunduh satu set paket dengan layanan dari versi yang diperlukan dan instalasi selanjutnya.  Metode ini memberikan fleksibilitas besar dalam konfigurasi cluster, tetapi Cloudera tidak menjamin kompatibilitasnya.  Oleh karena itu, versi kedua instalasi menggunakan parsel lebih populer - paket paket versi yang telah dibentuk sebelumnya.  Versi terbaru tersedia di tautan berikut: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">archive.cloudera.com/cdh5/parcels/latest</a> .  Sebelumnya dapat ditemukan level yang lebih tinggi.  Selain parsel dari CDH, Anda perlu mengunduh manifest.json dari direktori repositori yang sama. </p><br><p>  Untuk menggunakan fungsionalitas yang dikembangkan, kami juga membutuhkan Spark 2.2, yang tidak termasuk dalam paket CDH (versi pertama dari layanan ini tersedia di sana).  Untuk menginstalnya, Anda perlu mengunduh paket terpisah dengan layanan ini dan manifest.json yang sesuai, juga tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">arsip Cloudera</a> . </p><br><p>  Setelah memuat parsel dan manifest.json, Anda perlu mentransfernya ke folder yang sesuai di repositori kami.  Buat folder terpisah untuk file CDH dan Spark: <br><br></p><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www/html/parcels <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> cdh spark</code> </pre> <br><p>  Transfer file parsel dan manifest.json ke folder yang dibuat.  Untuk membuatnya tersedia untuk instalasi melalui jaringan, kami mengeluarkan folder izin akses yang sesuai dengan parsel: <br><br></p><pre> <code class="hljs swift">chmod -<span class="hljs-type"><span class="hljs-type">R</span></span> ugo+rX /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/html/parcels</code> </pre> <br><p>  Anda dapat mulai menginstal CDH, yang akan saya bahas di posting berikutnya. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413149/">https://habr.com/ru/post/id413149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413139/index.html">Mobil listrik: revolusi akan datang</a></li>
<li><a href="../id413141/index.html">Klasifikasi sejumlah besar data pada Apache Spark menggunakan model pembelajaran mesin sewenang-wenang</a></li>
<li><a href="../id413143/index.html">Bobby Urban Lite: New Urban Backpack XD Design</a></li>
<li><a href="../id413145/index.html">Analis membantu bisnis menghasilkan uang</a></li>
<li><a href="../id413147/index.html">Apakah mungkin menggunakan Tibero alih-alih Oracle. Dan apakah itu perlu</a></li>
<li><a href="../id413151/index.html">NSA mengusulkan standar enkripsi untuk perangkat IoT, tetapi ISO menolaknya</a></li>
<li><a href="../id413155/index.html">Panduan Gaya Shell Google (dalam bahasa Rusia)</a></li>
<li><a href="../id413157/index.html">Tentang menyimpan kata sandi dalam basis data</a></li>
<li><a href="../id413159/index.html">UI gelap atau terang? Kiat untuk memilih skema warna untuk antarmuka Anda</a></li>
<li><a href="../id413161/index.html">Git puisi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>