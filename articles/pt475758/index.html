<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüç≥ üë∂ üë©‚Äç‚ù§Ô∏è‚Äçüë© N√≠veis de assinatura renov√°veis ‚Äã‚Äãautomaticamente no aplicativo iOS üÖ∞Ô∏è üèº üéÖüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, aqui √© o Renat do Apphud . Neste artigo, informaremos quais s√£o os n√≠veis de assinaturas renov√°veis ‚Äã‚Äãautomaticamente, como configur√°-las correta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>N√≠veis de assinatura renov√°veis ‚Äã‚Äãautomaticamente no aplicativo iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/475758/"><p><img src="https://habrastorage.org/webt/ak/pz/18/akpz184-wzln3efdt6el6whs19o.png" alt="imagem"></p><br><p> Ol√°, aqui √© o Renat do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apphud</a> .  Neste artigo, informaremos quais s√£o os n√≠veis de assinaturas renov√°veis ‚Äã‚Äãautomaticamente, como configur√°-las corretamente e em que casos o usu√°rio √© reembolsado por um per√≠odo pago n√£o utilizado. <a name="habracut"></a></p><br><h2 id="chto-takoe-uroven-podpiski">  Qual √© o n√≠vel de assinatura? </h2><br><p>  Essa √© a designa√ß√£o da classe de assinatura, dependendo do n√≠vel de servi√ßo que ela oferece.  Assinatura da primeira classe significa o n√≠vel mais alto de servi√ßo, a segunda classe - mais baixa e assim por diante.  De fato, raramente em qual aplicativo voc√™ pode encontrar dois n√≠veis de assinaturas, sem mencionar tr√™s ou mais. </p><br><img src="https://habrastorage.org/webt/ek/ow/4r/ekow4rj6bw6nunu1yi078dzat1c.png"><br><p>  <em>Dois n√≠veis de assinatura no aplicativo de jornal The New York Times.</em> </p><br><h2 id="kak-nastroit-urovni-podpiski">  Como configurar os n√≠veis de assinatura? </h2><br><p>  Para configurar seus n√≠veis de assinatura, acesse o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">App Store Connect</a> , selecione seu aplicativo e v√° para a guia <em>Recursos</em> .  Na se√ß√£o de compras no aplicativo, mova sua assinatura um n√≠vel para cima ou para baixo.  Para fazer isso, selecione a assinatura desejada pressionando e segurando o √≠cone de arrastar e soltar e mova a assinatura para o n√≠vel desejado. </p><br><img src="https://habrastorage.org/webt/mq/aq/8v/mqaq8vvrm_z0hkqsn8gvqso9fdc.gif"><br><p>  <em>Arraste e solte uma assinatura para um n√≠vel superior.</em> </p><br><p>  A assinatura n√∫mero 1 deve oferecer o mais alto n√≠vel de servi√ßo, por exemplo, assinatura para todas as categorias de revistas.  N√£o h√° depend√™ncia entre a dura√ß√£o da assinatura e seu n√≠vel.  Portanto, a assinatura mais alta pode ser anual e uma assinatura em n√≠vel inferior a um m√™s. </p><br><h2 id="izmenenie-podpiski">  Alterar assinatura </h2><br><p>  O usu√°rio pode alterar a assinatura no aplicativo App Store ap√≥s seu registro.  Pode aumentar (atualizar), diminuir (rebaixar) um n√≠vel ou alterar uma assinatura em um n√≠vel (classifica√ß√£o cruzada). </p><br><h4 id="povyshenie-urovnya-podpiski-apgreyd">  Atualiza√ß√£o do n√≠vel de assinatura (atualiza√ß√£o) </h4><br><p>  Se a assinatura atual do usu√°rio estiver ativa, ele mudar√° imediatamente para uma nova tarifa e a parte n√£o utilizada do per√≠odo pago ser√° devolvida ao cart√£o. </p><br><img src="https://habrastorage.org/webt/y-/fl/7d/y-fl7dwabjscib2zi6wwkwnwmdq.png"><br><p>  <em>Notifica√ß√£o de que parte dos fundos ser√° reembolsada ao atualizar a assinatura.</em> </p><br><p>  No final do artigo, veremos como capturar o aumento no n√≠vel de assinatura e calcular a quantidade de retorno. </p><br><h4 id="ponizhenie-urovnya-podpiski-daungreyd">  Downgrade de assinatura (downgrade) </h4><br><p>  Ao baixar o n√≠vel, o usu√°rio muda para um novo no final do per√≠odo pago atual.  Os fundos n√£o s√£o reembolsados ‚Äã‚Äãe o custo de uma nova assinatura √© debitado na ativa√ß√£o. </p><br><h4 id="smena-podpiski-v-ramkah-odnogo-urovnya-krossgreyd">  Altera√ß√£o da assinatura no mesmo n√≠vel (classifica√ß√£o cruzada) </h4><br><p>  Essa √© uma situa√ß√£o comum, est√° dividida em dois tipos: uma altera√ß√£o de assinatura de uma dura√ß√£o e diferente.  Ao alterar uma assinatura com uma dura√ß√£o diferente, o mesmo ocorrer√° com um downgrade: a assinatura ser√° aplicada no final do per√≠odo pago atual. </p><br><p>  Se as dura√ß√µes corresponderem, a assinatura atual ser√° cancelada e uma nova ser√° iniciada imediatamente.  O dinheiro ser√° debitado pela nova assinatura e a parte n√£o utilizada da assinatura antiga ser√° devolvida ao usu√°rio. </p><br><h2 id="kak-uznat-o-smene-podpiski-na-servere">  Como descobrir como alterar a assinatura no servidor? </h2><br><p>  Voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">validar a verifica√ß√£o da App Store</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ouvir as notifica√ß√µes do servidor</a> Apple. </p><br><p>  Ao verificar cada nova transa√ß√£o, voc√™ precisa verificar se <em>product_id</em> mudou.  Alterar <em>product_id</em> significa que o usu√°rio alterou sua assinatura nas configura√ß√µes da App Store. </p><br><p> Al√©m disso, voc√™ pode ver o valor de <code>auto_renew_product_id</code> em <code>pending_renewal_info</code> .  Isso ajudar√° voc√™ a aprender sobre uma altera√ß√£o no <em>product_id</em> antes que uma nova assinatura entre em vigor. </p><br><p>  Se voc√™ tiver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">notifica√ß√µes de servidor</a> configuradas, ou√ßa a notifica√ß√£o <em>DID_CHANGE_RENEWAL_PREF</em> que √© chamada quando um produto √© <em>alterado</em> .  Voc√™ pode limitar-se a esta notifica√ß√£o e obter o novo <em>product_id a</em> partir dos par√¢metros de solicita√ß√£o ou pode verificar novamente o recibo da App Store.  Neste √∫ltimo caso, as notifica√ß√µes do servidor Apple servir√£o apenas como gatilho para uma verifica√ß√£o n√£o programada. </p><br><h2 id="kak-vychislit-summu-vozvrata-pri-apgreydah">  Como calcular a quantidade de retorno para atualiza√ß√µes? </h2><br><p>  Para entender se houve uma atualiza√ß√£o, √© necess√°rio verificar o valor do campo <code>is_upgraded</code> .  Um valor <code>true</code> significa que a pr√≥xima transa√ß√£o j√° est√° na nova assinatura. </p><br><p>  Observe que <code>is_upgraded</code> ser√° <code>true</code> mesmo ao alterar uma assinatura com a mesma dura√ß√£o no mesmo n√≠vel.  Ou seja, <code>is_upgraded = true</code> n√£o significa um aumento de n√≠vel, mas o fato de uma altera√ß√£o na assinatura ter sido feita com um reembolso. </p><br><p>  Al√©m do campo <code>is_upgraded</code> , o campo <code>cancellation_date</code> aparecer√° nesta transa√ß√£o, o que indica a hora do cancelamento.  √â igual ou quase coincide com a data de in√≠cio da pr√≥xima transa√ß√£o. </p><br><p>  Acontece que o campo <code>cancellation_date</code> aparece <strong>n√£o apenas quando a assinatura √© retornada</strong> , mas tamb√©m durante a atualiza√ß√£o. </p><br><p>  Observe que, <strong>ao atualizar as assinaturas do Sandbox, o campo <code>cancellation_date</code> est√° ausente</strong> .  Portanto, ao testar no Sandbox, voc√™ precisa usar a data de <code>purchase_date</code> pr√≥xima transa√ß√£o em vez de data de <code>cancellation_date</code> .  Leia mais sobre a data de cancelamento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">na documenta√ß√£o da Apple</a> . </p><br><p>  Para calcular a quantia que deve ser devolvida ao usu√°rio, √© necess√°rio dividir o per√≠odo n√£o utilizado pelo per√≠odo completo da assinatura anterior e multiplicar pelo custo: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># upgrade_date is `cancellation_date` in prodiction or `purchase_date` of new transaction in sandbox # to_f converts date to float timestamp value prorate_amount = price * (upgrade_date.to_f - cancellation_date.to_f) / (expires_date.to_f - purchase_date.to_f)</span></span></code> </pre> <br><h2 id="kak-eto-realizovano-v-apphud">  Como isso √© implementado no Apphud? </h2><br><p>  O Apphud rastreia automaticamente as altera√ß√µes nas assinaturas e calcula o retorno de pe√ßas n√£o utilizadas. </p><br><img src="https://habrastorage.org/webt/i-/ni/wk/i-niwkapdw5jjoaztapmznegq-c.png"><br><p>  <em>Um exemplo de altera√ß√£o de assinatura no mesmo n√≠vel com o retorno de parte dos fundos no Apphud.</em> </p><br><p>  Um desenvolvedor iOS n√£o √© necess√°rio para lidar com essas situa√ß√µes.  Voc√™ s√≥ precisa integrar o SDK, o resto ser√° feito pelo Apphud. </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  Acontece que apenas atualizar o valor de <code>product_id</code> n√£o <code>product_id</code> suficiente: voc√™ tamb√©m precisa considerar o reembolso de atualiza√ß√µes.  Trabalhar com assinaturas requer a manipula√ß√£o de muitas situa√ß√µes lim√≠trofes.  N√≥s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">criamos o Apphud</a> - um servi√ßo que simplifica bastante o trabalho com assinaturas.  Voc√™ pode come√ßar a us√°-lo gratuitamente.  Registro - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste link</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt475758/">https://habr.com/ru/post/pt475758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt475744/index.html">Modelo de Administrador do Sistema em Quatro N√≠veis</a></li>
<li><a href="../pt475746/index.html">Anatomia de Sistemas Ac√∫sticos: Cermetos e Comp√≥sitos - Sobre os Difusores de √Åudio do Monitor</a></li>
<li><a href="../pt475748/index.html">22 de novembro de Moscou - AnalyzeIT MeetUp No. 3</a></li>
<li><a href="../pt475750/index.html">Transfer√™ncia de Conhecimento e Tradu√ß√£o Autom√°tica Neural na Pr√°tica</a></li>
<li><a href="../pt475754/index.html">Shorts sobre Scrum</a></li>
<li><a href="../pt475760/index.html">Desenvolvedores juniores - por que os contratamos e como trabalhamos com eles</a></li>
<li><a href="../pt475762/index.html">Um curr√≠culo com uma fotografia voa para uma urna. Caracter√≠sticas da procura de emprego nos EUA</a></li>
<li><a href="../pt475764/index.html">Cadeias de Markov para gera√ß√£o processual de edif√≠cios</a></li>
<li><a href="../pt475768/index.html">Kotlin: Como √© uma √≥tima op√ß√£o para o desenvolvimento de aplicativos Android?</a></li>
<li><a href="../pt475770/index.html">Universidade de Stanford - visita e revis√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>