<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧜🏻 👨🏽‍🚒 🖊️ Kontrol lampu pada ZigBee ♨️ 👩🏽‍✈️ 🤾🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo teman-teman! Hari ini saya ingin memberi tahu Anda tentang satu pengembangan yang menarik dari sistem kontrol pencahayaan jarak jauh. 



 Sebuah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kontrol lampu pada ZigBee</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460637/">  Halo teman-teman!  Hari ini saya ingin memberi tahu Anda tentang satu pengembangan yang menarik dari sistem kontrol pencahayaan jarak jauh. <br><br><img src="https://habrastorage.org/webt/ro/yx/l6/royxl62-z2oqpfn6hwt5izou3_y.jpeg" alt="gambar"><br><br>  Sebuah rumah modern adalah sejumlah besar kabel untuk setidaknya mengurangi dan merampingkan jumlah radio mereka untuk menyelamatkan.  Pada kenyataannya, sistem semacam itu bukanlah hal baru, tetapi dalam konteks anggaran yang terbatas, ia sepenuhnya membenarkan dirinya. <br><br>  Ke depan, saya ingin segera menampilkan diagram fungsional dari sistem kontrol. <br><br><img src="https://habrastorage.org/webt/fh/ey/gj/fheygj8s-fn_phg3oqnva6ajrye.jpeg" alt="gambar"><br>  <i>Fig.</i>  <i>1</i> <br><br>  Saya tertarik pada seseorang di bawah kucing. <br><a name="habracut"></a><br>  Pertanyaan logisnya adalah mengapa semua ini diperlukan?  Penggunaan sistem kontrol lampu nirkabel memberikan: <br><br><ul><li>  Mengurangi jumlah kabel yang pergi dari setiap sakelar ke kotak persimpangan di ruangan. </li><li>  Kemungkinan menerapkan sakelar walk-through. </li><li>  Fleksibilitas untuk mengontrol setiap beban dari sakelar apa pun serta penggunaan tombol yang biasanya tertutup biasanya terbuka. </li><li>  Kemampuan untuk mengimplementasikan penundaan waktu untuk operasi on / off. </li></ul><br>  Tugas teknis, pada mulanya, hanya dalam kata-kata dan terlihat sangat berlumpur dan tidak dapat dipahami.  Intinya adalah bahwa di sebuah pondok berlantai dua dengan luas 208 sq.m perlu untuk mengontrol on / off pencahayaan internal, sistem harus diaktifkan dari 220v dan beralih 21-23pcs.  beban (lampu) dengan kapasitas tidak lebih dari 200W.  Pada saat inspeksi objek pertama, semuanya tampak seperti ini <br><br><img src="https://habrastorage.org/webt/cz/bi/_b/czbi_bdenvipzshelqjbmh0himq.jpeg"><br>  <i>Fig.</i>  <i>2. Bagian utama dari komunikasi diletakkan di lantai, kemudian dituangkan dengan screed beton</i> <br><br><img src="https://habrastorage.org/webt/sh/h-/7m/shh-7mxsspyefbi-nlti3wisn8m.jpeg"><br>  <i>Fig.</i>  <i>3. Tempat untuk memasang kabinet distribusi di lantai dua</i> <br><br>  Rekomendasi kuat adalah menggunakan kabel sesedikit mungkin.  Idealnya, hanya yang sudah diletakkan di lantai, dinding, dan langit-langit, mereka beralih dari lokasi pemasangan switchboard ke setiap bola lampu.  Karena kompatibilitas elektromagnetik dari semua perangkat di rumah, tidak disarankan untuk menggunakan wi-fi biasa karena  ada banyak perangkat seperti itu dan pelanggan di akun ini memiliki mode di kepalanya bahwa perangkat di rumah akan mulai menjalani kehidupan mereka sendiri dan slow cooker yang dimasukkan akan mempengaruhi cahaya di kamar mandi atau toilet.  Hal pertama yang saya lakukan adalah menguraikan diagram blok, karena saya membayangkan solusi untuk masalah ini.  Pada fig_4 opsi ini. <br><br><img src="https://habrastorage.org/webt/80/wk/x2/80wkx2kcoelxunryvcivzi8n7e8.jpeg"><br>  <i>Fig.</i>  <i>4. Diagram fungsional kontrol pencahayaan.</i> <br><br>  Dasar diambil oleh modul radio Texas Instruments CC2530 yang mendukung teknologi ZiegBee dan cukup sederhana diprogram dalam C ++ menggunakan IAR-studio 5.5.  Langsung mengalihkan beban dilakukan menggunakan modul relai WB-MR6 (wirenboard), saya memilih elemen ini karena dalam kasing pada rel din, enam relai dengan saluran independen dipasang pada kontrol 16A, semua fitur switching beban daya untuk keperluan umum diperhitungkan dalam t. h  dengan arus awal yang tinggi: kontrol lampu LED, lampu pijar, switching catu daya.  Plus, setiap kontak relai dilindungi terhadap tegangan lebih oleh varistor.  Enam dari modul ini harus dipasang untuk mengatur jumlah muatan dengan tenang.  Semua WB-MR6 terhubung melalui antarmuka ModBus ke dalam satu jaringan.  Setiap modul relai diatur ke alamat yang sesuai dengan diagram koneksi, dan seluruh sistem dengan blok input, sekering, pemutus sirkuit dipasang cukup erat di dua switchboards SHCHMP2-1 500x400x450.  Untuk penempatan ringkas kabel input 46 3x1.5 (tembaga inti tunggal), perlu mengubah posisi din-rel tradisional menjadi vertikal. <br><br><img src="https://habrastorage.org/webt/xv/fx/mn/xvfxmnadqjpt8l0wy8jtzxmaopo.jpeg"><br>  <i>Fig.</i>  <i>5. Switchboard dengan penempatan perangkat kontrol pencahayaan.</i> <br><br>  Perlu dicatat bahwa fungsi WB-MR6 yang sangat berguna ternyata adalah kemampuan untuk mengontrol output relai dengan hanya menghubungkan tombol yang biasanya terbuka ke blok terminal bawah, ini adalah apa yang Anda butuhkan untuk diagram kabel sementara.  T.K.  Kontrol ModBus muncul lima bulan kemudian, setelah perakitan dan pemasangan switchboards.  Selama waktu ini, semua kabel yang menuju ke masing-masing beban diuji dan diberi nomor penuh.  Dan skema switching terperinci telah disusun, dengan logika kontrol sakelar - bola lampu di Fig_6. <br><br><img src="https://habrastorage.org/webt/59/ca/lj/59caljsa6bx9fv1bkzm6x9cgz2g.jpeg"><br>  <i>Fig.</i>  <i>6. Skema kontrol pencahayaan dan modul penempatan dan pemungutan muatan.</i> <br><br>  Adapun modul survei, saya bisa mengatakan yang berikut, diagram fungsional yang ditunjukkan pada Fig_7 ternyata cukup fungsional.  Praktis tidak perlu mengulang apa pun, modul RF ss2530 memungkinkan Anda untuk menetapkan input apa pun ke output apa pun.  Satu-satunya pengecualian adalah UART (pin20-Tx, pin21-Rx). Sebagian besar daftar elemen dibeli di ali. Papan sirkuit tercetak dipesan dengan resonansi. Saya menyolder semua dua puluh buah dengan tangan saya, sulit, butuh waktu seminggu, tidak langsung berfungsi, segera perlu.  Tetapi memperoleh pengalaman yang sangat berharga dalam memasang komponen SMD. <br><br><img src="https://habrastorage.org/webt/vv/a3/d6/vva3d686ixu6dxa3rh-fxmemqig.jpeg"><br>  <i>Fig.</i>  <i>7. Diagram fungsional dari modul polling tombol</i> <br><br>  Proses debugging sistem dan membawanya ke keadaan operasional penuh membutuhkan waktu lebih dari tiga bulan.  Langkah pertama setelah merakit papan Rice_8, memeriksa daya dan menghubungkan ke programmer, adalah menulis program polling tombol dan menghasilkan perintah kontrol untuk modul relay WB-MR6 melalui bus ModBus. <br><br><img src="https://habrastorage.org/webt/zj/qq/cg/zjqqcgo-dewjpy6dpqvydmmjpu4.jpeg"><br>  <i>Fig.</i>  <i>8. Modul polling tombol</i> <br><br>  Ternyata cukup cepat dan mudah.  Modul polling satu tombol terhubung ke satu modul relay melalui RS485 sejauh ini tanpa antarmuka jaringan.  Segera berhasil menerapkan keberhasilan yang diperoleh pada objek pic_9, twisted pair UTP, dari tombol yang terletak di kamar tidur, diletakkan di muka.  Dengan pengikatan modul, saya tidak menjadi terlalu pintar, bantalan berperekat dan klem plastik sangat membantu. <br><br><img src="https://habrastorage.org/webt/qq/2m/f2/qq2mf2-bsvhphquu_bb_bikcajw.jpeg"><br>  <i>Fig.</i>  <i>9. Melampirkan modul polling tombol.</i> <br><br>  Kemudian dia secara terprogram menambahkan alamat setiap modul, yang diatur menggunakan dip-switch dan kartu switching yang sesuai, mode operasi master / slave dan transmisi perintah oleh radio.  Langkah maju serius dan karena itu ada banyak kesulitan dalam debugging.  Yang paling serius adalah transfer informasi tentang tombol yang ditekan ke modul master yang terhubung ke bus Modbus segera setelah protokol transfer data zig-bee diaktifkan, semuanya ternyata berkali-kali lebih rumit.  Bagi mereka yang telah membaca sampai di sini, saya dapat mengatakan bahwa masalahnya adalah bahwa penghitung waktu dalam inti prosesor bekerja tanpa dapat diprediksi, lebih tepatnya di kompiler IAR, Anda harus terus-menerus menentukan pengaturannya saat memanggil prosedur penghitungan waktu.  Untuk menemukan cara mengatasi masalah ini, fungsi pemantauan dan kontrol data yang dikirim oleh radio ditambahkan.  Kontrol menekan tombol dalam mode layanan langsung ditampilkan di terminal komputer, yang terhubung melalui adaptor RS485-USB ke modul polling.  Masalah serius lain dalam mengatur jaringan kontrol pencahayaan adalah jangkauan antarmuka radio yang tidak memadai.  Kurang lebih, dengan percaya diri semuanya beralih hanya dalam batas-batas tabel tempat tata letak dipasang.  Ini adalah konsekuensi dari fitur mode hemat energi dari SS2530, standarnya adalah fungsi mengurangi daya radiasi, setelah tautan terbentuk, saya tidak tahu mengapa ini dilakukan, tetapi ditemukan melalui jtag dalam mode debugging langkah-demi-langkah.  Setelah mematikan mode ini, jaringan mulai bekerja hanya dalam satu lantai di pondok, pada kenyataannya, perintah lampu on / off diproses oleh server, hanya dari modul polling yang terletak dalam radius 12-14 m.  Asalkan tidak ada dinding.  Untuk mengatasi masalah ini, kami memilih cara untuk mengganti modul CC2530 dengan antena planar dengan modul dengan antena eksternal (dengan konektor IPEX), terlebih lagi karena sangat sukses untuk membeli tiga modul dalam versi E18-MSI-IPX plus antena dan kabel di salah satu St. Petersburg toko online.  Semua ini dengan cepat disolder, sudut-sudut untuk memasang antena dibuat dan disekrup ke pelat adaptor Fig_10. <br><br><img src="https://habrastorage.org/webt/es/20/je/es20jewxb7gxff5iefdsr9uzmbu.jpeg"><br>  <i>Fig.</i>  <i>10. Penggunaan antena eksternal</i> <br><br>  Hasil dari upgrade semacam itu sangat membingungkan bagi saya - karena jangkauannya tidak banyak berubah, saya bahkan akan mengatakan bahwa itu sedikit menurun.  Saya mulai mencari jalan keluar dari situasi ini dalam mengoptimalkan algoritma program, pengaturan awal SS2530 harus membaca kembali mobil lembar data dan forum tentang topik ini.  Tujuannya adalah untuk membuat setiap modul di jaringan berfungsi sebagai pengulang, terutama karena fungsi tersebut diaktifkan secara default dan didukung oleh perangkat apa pun yang menjalankan protokol Zig-Bee.  Tetapi dalam kasus saya itu tidak jelas.  Sebagai hasilnya, saya memutuskan untuk memperkenalkan modul tambahan ke dalam sistem, yang akan mengaktifkan firmware unik dengan hanya menaikkan pin_6 pada dip-switch.  Dia harus, berada di langit-langit lantai pertama dan hanya menyiarkan perintah yang diterima, yaitu  menjadi penguat sinyal. <br><br>  Saya akan segera mengatakan bahwa ini adalah jalan buntu.  Tetapi selama implementasi ide ini, saya tidak sengaja mengukur parameter antena "hitam", yang saya jual di toko online bersama dengan CC2530 dan kabel.  Penganalisa jaringan menunjukkan SWR 1.9 pada frekuensi 2,4 GHz - komentar tidak perlu, Anda perlu membuat antena sendiri.  Permintaan ke mesin pencari segera memberikan jawaban yang benar, antena Clover dan instruksi pembuatan terperinci. <br><br><img src="https://habrastorage.org/webt/8f/fo/2s/8ffo2soyaf4iikrhcw75ymoxwwi.jpeg"><br>  <i>Fig.</i>  <i>11. Antena dan perangkat untuk pembuatannya.</i> <br><br>  Secara harfiah di malam hari saya membuat tiga buah antena ini, memeriksa SWR mereka untuk tidak lebih dari 1.2.  Saya tidak bisa mengatakan tentang karakteristik lain, pola radiasi dan penguatan.  Tetapi kenyataannya adalah bahwa jangkauan penerimaan yang dapat diandalkan dan pengiriman perintah telah dua kali lipat.  Fig_12 <br><br><img src="https://habrastorage.org/webt/ye/ba/bd/yebabdzcf80hy4yoaoilnapxxz4.jpeg"><br>  <i>Fig.</i>  <i>12. Pengukuran antena</i> <br><br>  Sebagai hasilnya, kami berhasil mencapai penerimaan sinyal server normal pada semua 12 modul polling yang dipasang di pondok.  T.O.  persyaratan untuk TK sepenuhnya dipenuhi tepat waktu, saya praktis memenuhi tenggat waktu.  Pelanggan puas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460637/">https://habr.com/ru/post/id460637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460627/index.html">vGPU - penggunaan tidak dapat diabaikan</a></li>
<li><a href="../id460629/index.html">Probabilitas bahwa 2 penambang memiliki dunia yang sama</a></li>
<li><a href="../id460631/index.html">Sekitar lencana dalam 80 hari: di sisi lain OFFZONE</a></li>
<li><a href="../id460633/index.html">Detail Implementasi untuk RSTP dan Redundansi Perpanjangan Cincin Kepemilikan</a></li>
<li><a href="../id460635/index.html">CLRium # 6: Concurrency & Parallelism. Dua hari: dari prosesor ke async / menunggu</a></li>
<li><a href="../id460641/index.html">YouTokenToMe: alat untuk tokenisasi cepat teks dari Tim VKontakte</a></li>
<li><a href="../id460643/index.html">Distribusi titik-titik pada bola yang seragam</a></li>
<li><a href="../id460645/index.html">Berbuat baik berbuat jahat: menulis kode jahat dengan Go, Bagian 1</a></li>
<li><a href="../id460647/index.html">Memecahkan pekerjaan dengan pwnable.kr 05 - passcode. Tabel tautan prosedur penulisan ulang melalui kerentanan format string</a></li>
<li><a href="../id460651/index.html">Pertemuan Society of Anonymous Testers: TMS, pemantauan pemantauan, penilaian kualitas pencarian dan tes iOS asli</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>