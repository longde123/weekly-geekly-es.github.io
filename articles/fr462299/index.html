<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☹️ ♥️ 🎿 Arrondi à l'ensemble dans .NET 🎐 👩‍👦‍👦 👐🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tous barbus ku, camarades! 

 Nous savons tous ce qu'est l'arrondi. Si quelqu'un a oublié, l'arrondi est le remplacement d'un nombre avec sa valeur ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arrondi à l'ensemble dans .NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462299/">  Tous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">barbus</a> ku, camarades! <br><br>  Nous savons tous ce qu'est l'arrondi.  Si quelqu'un a oublié, l'arrondi est le remplacement d'un nombre avec sa valeur approximative, écrit avec moins de chiffres significatifs.  Si vous demandez à une personne à la volée ce qui se passe lorsque vous arrondissez 6,5 à des nombres entiers, elle répondra «7» sans hésitation.  L'école nous a appris que les nombres sont arrondis à l'entier le plus proche, qui est plus grand en valeur absolue.  Autrement dit, si dans le nombre arrondi la partie fractionnaire est égale ou supérieure à la moitié de la décharge de la partie entière, alors nous arrondissons le nombre d'origine à la plus grande plus proche. <br><br><a name="habracut"></a>  Autrement dit: <br><pre><code class="cs hljs"><span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span> = <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span> = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span> = <span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre>  etc. <br><br>  Et donc, en quittant l'école et en devenant programmeurs, nous attendons souvent le même comportement de nos puissants langages de programmation.  Oubliant complètement qu'à l'école on nous a enseigné «l'arrondi mathématique», mais en fait il y a beaucoup plus de types d'arrondi.  Sur Wikipedia uniquement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez creuser</a> le nombre d'options d'arrondi de 0,5 à l'entier le plus proche: <br><br><ul><li>  Arrondi mathématique </li><li>  Arrondi aléatoire </li><li>  Arrondi alterné </li><li>  Arrondi bancaire </li></ul><br>  Le premier type, «l'arrondissement mathématique», nous avons tous appris de l'école.  Vous pouvez lire sur les deuxième et troisième types à votre guise, ils ne m'intéressent pas dans cet article aujourd'hui. <br><br>  Mais «l'arrondi bancaire» est déjà intéressant.  "Pourquoi?"  - demandez-vous.  Dans le sous-réseau, nous utilisons souvent la classe <b>Convert</b> , qui fournit de nombreuses méthodes pour convertir un type de données en un autre (à ne pas confondre avec le cast, elle sera décrite ci-dessous).  Et maintenant, il s'avère que lors de la conversion de nombres à virgule flottante ( <i>double, flottant, décimal</i> ) en un type entier entier via la méthode <b>Convert.ToInt32, l'</b> arrondi «bancaire» fonctionne sous le capot.  Il est utilisé ici par défaut! <br><br>  Et il semble que l'ignorance de cette bagatelle n'affecte pas grandement votre travail, mais dès que vous devrez travailler avec des statistiques et des indicateurs de calcul basés sur un tas de toutes sortes d'enregistrements et de chiffres, cette chose sortira latéralement.  Parce que nous nous attendons (par ignorance) à ce que toutes nos conversions / arrondis dans les calculs fonctionnent selon les règles d'arrondis "mathématiques".  Et nous ressemblons à un bélier sur une nouvelle porte pour le résultat de l'arrondi <b>6.5</b> , qui est <b>6</b> . <br><br>  La première pensée du programmeur qui voit cela est: "Peut-être que l'arrondi fonctionne dans la direction opposée, et selon les règles, il arrondit au plus petit nombre?", "Peut-être que j'ai oublié quelque chose des mathématiques de l'école?".  Puis il va sur Google et comprend qu'ils n'ont rien oublié et qu'une sorte de mob se poursuit.  À cette étape, le développeur paresseux décidera qu'il s'agit du comportement standard de la méthode <b>Convert.ToInt32</b> , arrondi au plus petit entier et <b>notant</b> pour une recherche ultérieure.  Et il pensera que si <i>Convert.ToInt32 (6,5)</i> = <b>6</b> , alors par analogie <i>Convert.ToInt32 (7,5)</i> = <b>7</b> .  Mais ça y était.  À l'avenir, ces développeurs seront frappés à la tête avec un tas de bugs du département QA. <br><br>  Le fait est que l'arrondi «bancaire» fonctionne un peu plus délicat - il arrondit un nombre à l'entier pair le plus proche, et non au module entier le plus proche.  Ce type d'arrondi est censé être plus honnête en cas d'application dans les opérations bancaires - les banques ne se priveront pas ni ne se priveront des clients, en supposant qu'il y a autant d'opérations avec une partie entière paire qu'il y a d'opérations avec une partie entière impaire.  Mais pour moi - ce n'est pas encore clair :) C'est pourquoi <i>Convert.ToInt32 (6.5)</i> donnera un résultat de <b>6</b> , et le résultat de <i>Convert.ToInt32 (7.5)</i> sera <b>8</b> , pas 7 :) <br><br>  Que faire pour que tout le monde connaisse l'arrondi «mathématique»?  Les méthodes de classe <i>Convert</i> n'ont pas d'options d'arrondi supplémentaires.  C'est vrai, car cette classe sert principalement non pas à l'arrondi, mais à la conversion de type.  La merveilleuse classe de <b>Math</b> avec sa méthode <b>Round</b> vient à la rescousse.  Mais ici aussi soyez prudent, car par défaut cette méthode fonctionne de la même manière que l'arrondi dans <i>Convert.ToInt32 ()</i> - selon la règle "bancaire".  Toutefois, ce comportement peut être modifié à l'aide du deuxième argument, qui fait partie de la méthode <i>Round</i> .  Ainsi, <i>Math.Round (someNumber, <b>MidpointRounding.ToEven</b> )</i> nous donnera l'arrondi "bancaire" par défaut.  Mais <i>Math.Round (someNumber, <b>MidpointRounding.AwayFromZero</b> )</i> fonctionnera selon les règles habituelles d'arrondi "mathématique". <br><br>  Et d'ailleurs, <i>Convert.ToInt32 ()</i> n'utilise pas <i>System.Math.Round ()</i> sous le capot.  Le déterrage particulier de la <a href="">mise en œuvre de</a> cette méthode sur github - arrondi est envisagé en fonction des résidus: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToInt32</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2147483647.5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dif = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> - result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dif &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> || dif == <span class="hljs-number"><span class="hljs-number">0.5</span></span> &amp;&amp; (result &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) result++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">-2147483648.5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dif = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> - result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dif &lt; <span class="hljs-number"><span class="hljs-number">-0.5</span></span> || dif == <span class="hljs-number"><span class="hljs-number">-0.5</span></span> &amp;&amp; (result &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) result--; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowException(Environment.GetResourceString(<span class="hljs-string"><span class="hljs-string">"Overflow_Int32"</span></span>)); }</code> </pre><br>  Et enfin, quelques mots sur le <b>casting de caractères</b> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> number = <span class="hljs-number"><span class="hljs-number">6.9</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intNumber = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)number;</code> </pre><br>  Dans cet exemple, j'ai converti un type à virgule flottante ( <i>double</i> dans ce cas) en un entier entier.  Ainsi, lors de la conversion en types entiers, la partie non entière entière est <b>simplement tronquée</b> .  Par conséquent, dans cet exemple, la variable " <i>intNumber</i> " <i>contiendra le</i> nombre <b>6</b> .  Il n'y a pas de règles d'arrondi ici, juste couper tout ce qui vient après le point décimal.  N'oubliez pas cela! <br><br>  Liens connexes: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">À propos de l'arrondi sur wikipedia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">À propos du problème de conversion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">À propos de l'arrondissement des mathématiques.</a> </li><li>  <a href="">Implémentation de Convert.ToInt32</a> </li></ul><br>  <b>PS</b> Merci à Maxim Yakushkin d'avoir attiré l'attention sur ce moment implicite. <br><br>  <b>PPS</b> Soit dit en passant, en <b>python, l'</b> arrondi par défaut fonctionne de la même manière sur une base «bancaire».  Peut-être que la même chose est dans votre langue, faites attention aux chiffres :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462299/">https://habr.com/ru/post/fr462299/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462279/index.html">Construction d'entonnoirs comportementaux en langage R, basés sur les données obtenues à partir de l'API Yandex.Metrica Logs</a></li>
<li><a href="../fr462283/index.html">Jouet GAZ-66 sur le panneau de commande. Partie 1</a></li>
<li><a href="../fr462293/index.html">Comment les technologies de développement rapide peuvent devenir une source de vulnérabilités désagréables</a></li>
<li><a href="../fr462295/index.html">La taille du répertoire ne vaut pas la peine</a></li>
<li><a href="../fr462297/index.html">Habr Weekly # 12 / OneWeb, stations contre les agrégateurs, salaires dans l'informatique, «cher, nous tuons Internet» n'étaient pas autorisés dans la Fédération de Russie</a></li>
<li><a href="../fr462301/index.html">Secrets, trucs et astuces: comment créer une action sympa pour Google Assistant</a></li>
<li><a href="../fr462303/index.html">Mémoire de cluster avec approximation</a></li>
<li><a href="../fr462307/index.html">Enregistrement de l'état de routage sur le disque dans une application GUI .NET Core multiplateforme avec ReactiveUI et Avalonia</a></li>
<li><a href="../fr462311/index.html">@Pythonetc compilation, juillet 2019</a></li>
<li><a href="../fr462313/index.html">Trucs et astuces de ma chaîne Telegram @pythonetc, juillet 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>