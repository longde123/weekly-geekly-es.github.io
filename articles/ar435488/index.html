<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👈🏾 😕 📠 يتزوج ، بذرة والجواسيس في إطار سبوك 👎🏿 🙉 🙇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="يوفر Spock 3 أدوات قوية (ولكن مختلفة في جوهرها) تعمل على تبسيط اختبارات الكتابة: Mock و Stub و Spy. 



 في كثير من الأحيان ، يحتاج الرمز الذي يجب اخت...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>يتزوج ، بذرة والجواسيس في إطار سبوك</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/435488/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  يوفر Spock 3 أدوات قوية (ولكن مختلفة في جوهرها) تعمل على تبسيط اختبارات الكتابة: Mock و Stub و Spy. </p><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mp/b1/16/mpb116loygy7rcfeicuihzm8oym.jpeg"></div><br><p style=";text-align:right;direction:rtl">  في كثير من الأحيان ، يحتاج الرمز الذي يجب اختباره إلى التفاعل مع الوحدات الخارجية التي تسمى التبعيات (تستخدم المقالة الأصلية مصطلح المتعاونين ، وهو أمر غير شائع جدًا في بيئة اللغة الروسية). </p><br><p style=";text-align:right;direction:rtl">  غالبًا ما يتم تصميم اختبارات الوحدة لاختبار فئة معزولة واحدة باستخدام أشكال مختلفة من mok: Mock و Stub و Spy.  لذلك ستكون الاختبارات أكثر موثوقية وأقل عرضة للانهيار مع تطور رمز التبعية. </p><br><p style=";text-align:right;direction:rtl">  مثل هذه الاختبارات المعزولة أقل عرضة للمشاكل عند تغيير التفاصيل الداخلية لتطبيق التبعية. </p><br><p style=";text-align:right;direction:rtl">  <em>من أحد المترجمين: في</em> كل مرة أستخدم فيها Spock Framework لكتابة الاختبارات ، أشعر أنني أستطيع ارتكاب خطأ عند اختيار طريقة لاستبدال التبعيات.  تحتوي هذه المقالة على أقصر ورقة خداع ممكنة لاختيار آلية لإنشاء mokas. </p><a name="habracut"></a><br><h2 id="tldr" style=";text-align:right;direction:rtl">  TL ؛ د </h2><br><h3 id="mocks" style=";text-align:right;direction:rtl">  يسخر </h3><br><p style=";text-align:right;direction:rtl">  استخدام وهمية ل: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الشيكات العقد بين رمز الاختبار والتبعيات </li><li style=";text-align:right;direction:rtl">  التحقق من أن أساليب التبعية تسمى العدد الصحيح من المرات </li><li style=";text-align:right;direction:rtl">  التحقق من صحة المعلمات التي يتم استدعاء رمز التبعية </li></ul><br><h3 id="stubs" style=";text-align:right;direction:rtl">  بذرة </h3><br><p style=";text-align:right;direction:rtl">  استخدم كعب الروتين إلى: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تقديم نتائج مكالمة محددة مسبقا </li><li style=";text-align:right;direction:rtl">  تنفيذ الإجراءات المحددة مسبقًا المتوقعة من التبعيات ، مثل رمي الاستثناءات </li></ul><br><h3 id="spies" style=";text-align:right;direction:rtl">  جواسيس </h3><br><p style=";text-align:right;direction:rtl">  جواسيس الخوف.  كما تقول وثائق سبوك: </p><br><blockquote style=";text-align:right;direction:rtl">  فكر مرتين قبل استخدام هذه الآلية.  ربما يجب عليك إعادة تصميم الحل الخاص بك وإعادة تنظيم التعليمات البرمجية الخاصة بك. </blockquote><p style=";text-align:right;direction:rtl">  لكن يحدث فقط أنه توجد مواقف عندما يتعين علينا التعامل مع الشفرة القديمة.  قد يكون من الصعب اختبار الكود القديم أو حتى من المستحيل اختباره مع الغوغاء والكعبين.  في هذه الحالة ، يوجد حل واحد فقط: استخدم Spy. </p><br><p style=";text-align:right;direction:rtl">  من الأفضل أن تكون الشفرة القديمة مغطاة بالاختبارات التي تستخدم الجاسوس بدلاً من امتلاك الاختبارات القديمة على الإطلاق. </p><br><p style=";text-align:right;direction:rtl">  استخدام الجاسوس ل: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  اختبار الكود القديم الذي لا يمكن اختباره بطرق أخرى </li><li style=";text-align:right;direction:rtl">  التحقق من أن أساليب التبعية تسمى العدد الصحيح من المرات </li><li style=";text-align:right;direction:rtl">  التحقق من صحة المعلمات التي تم تمريرها </li><li style=";text-align:right;direction:rtl">  توفير استجابة التبعية محددة مسبقا </li><li style=";text-align:right;direction:rtl">  تنفيذ إجراءات محددة مسبقًا استجابةً لنداءات أساليب التبعية </li></ul><br><h2 id="mocks-1" style=";text-align:right;direction:rtl">  يسخر </h2><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zi/3q/vj/zi3qvjii7ug7tkq4bczo5f-jo7u.jpeg"></div><br><p style=";text-align:right;direction:rtl"> تتجلى كل قوة الموكساس عندما تكون مهمة اختبار الوحدة هي التحقق من العقد بين الشفرة المختبرة والتبعيات.  دعونا نلقي نظرة على المثال التالي ، حيث لدينا وحدة تحكم <code>FooService</code> تستخدم <code>FooService</code> كجهة تبعية ، <code>FooService</code> هذه الوظيفة باستخدام الغوغاء. </p><br><p style=";text-align:right;direction:rtl"> <code>FooController.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p style=";text-align:right;direction:rtl"> <code>FooService.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  في هذا السيناريو ، نريد أن نكتب اختبارًا سيختبر: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  العقد بين <code>FooController</code> و <code>FooService</code> </li><li style=";text-align:right;direction:rtl">  <code>FooService.doSomething(name)</code> بالعدد الصحيح من المرات </li><li style=";text-align:right;direction:rtl">  <code>FooService.doSomething(name)</code> مع المعلمة الصحيحة </li></ul><br><p style=";text-align:right;direction:rtl">  ألقِ نظرة على الاختبار: </p><br><p style=";text-align:right;direction:rtl"> <code>MockSpec.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Mock FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"  "</span></span> def fooService = Mock(FooService) and: <span class="hljs-string"><span class="hljs-string">"    "</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"  "</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"         "</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) and: <span class="hljs-string"><span class="hljs-string">"  ''    - 'null'"</span></span> response.text == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>.toString() } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  الاختبار أعلاه يخلق خدمة وهمية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">def fooService = Mock(FooService)</code> </pre> <br><p style=";text-align:right;direction:rtl">  يتحقق الاختبار أيضًا من <code>FooService.doSomething(name)</code> مرة واحدة ، والمعلمة التي تم تمريرها إليه تطابق السلسلة <code>"Sally"</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  الكود أعلاه يحل 4 مشاكل مهمة: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يخلق وهمية ل <code>FooService</code> </li><li style=";text-align:right;direction:rtl">  يتحقق من <code>FooService.doSomething(String name)</code> مرة واحدة تمامًا باستخدام المعلمة <code>String</code> والقيمة <code>"Sally"</code> </li><li style=";text-align:right;direction:rtl">  عزل رمز الاختبار ، لتحل محل تنفيذ التبعية </li></ul><br><h2 id="stubs-1" style=";text-align:right;direction:rtl">  بذرة </h2><br><p style=";text-align:right;direction:rtl">  هل تستخدم الشفرة المختبرة التبعيات؟  هل الغرض من الاختبار هو التأكد من أن الشفرة قيد الاختبار تعمل بشكل صحيح عند التفاعل مع التبعيات؟  هل نتائج مكالمات أساليب التبعية هي قيم إدخال الكود قيد الاختبار؟ </p><br><p style=";text-align:right;direction:rtl">  إذا تغير سلوك الشفرة المختبرة اعتمادًا على سلوك التبعيات ، فأنت بحاجة إلى استخدام كعب الروتين (كعب الروتين). </p><br><p style=";text-align:right;direction:rtl">  دعونا نلقي نظرة على المثال التالي مع <code>FooController</code> و <code>FooService</code> واختبار وظيفة وحدة التحكم باستخدام <code>FooService</code> الروتين. </p><br><p style=";text-align:right;direction:rtl"> <code>FooController.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p style=";text-align:right;direction:rtl"> <code>FooService.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  كود الاختبار: </p><br><p style=";text-align:right;direction:rtl"> <code>StubSpec.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StubSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Stub FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"  "</span></span> def fooService = Stub(FooService) { doSomething(_) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"Stub did something"</span></span> } and: <span class="hljs-string"><span class="hljs-string">"    "</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"  "</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"   "</span></span> <span class="hljs-comment"><span class="hljs-comment">// 1 * fooService.doSomething() //        response.text == "Stub did something" } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكنك إنشاء كعب روتين مثل هذا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">def fooService = Stub(FooService) { doSomething(_) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"Stub did something"</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  الكود أعلاه يحل 4 مشاكل مهمة: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يخلق كعب <code>FooService</code> </li><li style=";text-align:right;direction:rtl">  يتأكد من أن <code>FooService.doSomething(String name)</code> سيعود السلسلة <code>"Stub did something"</code> بغض النظر عن المعلمة التي تم تمريرها (لذلك استخدمنا الحرف <code>_</code> ) </li><li style=";text-align:right;direction:rtl">  عزل الكود الذي تم اختباره ، واستبدال تطبيق التبعية بنقرة </li></ul><br><h2 id="spies-1" style=";text-align:right;direction:rtl">  جواسيس </h2><br><p style=";text-align:right;direction:rtl">  من فضلك لا تقرأ هذا القسم. </p><br><p style=";text-align:right;direction:rtl">  لا تنظر. </p><br><p style=";text-align:right;direction:rtl">  انتقل إلى المرحلة التالية. </p><br><p style=";text-align:right;direction:rtl">  هل ما زلت تقرأ؟  حسنًا ، حسنًا ، دعنا نتعامل مع Spy. </p><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/b9/sj/lk/b9sjlk13izmu8rbtb4yv4zncwvm.jpeg"></div><br><p style=";text-align:right;direction:rtl">  لا تستخدم الجاسوس.  كما تقول وثائق سبوك: </p><br><blockquote style=";text-align:right;direction:rtl">  فكر مرتين قبل استخدام هذه الآلية.  ربما يجب عليك إعادة تصميم الحل الخاص بك وإعادة تنظيم التعليمات البرمجية الخاصة بك. </blockquote><p style=";text-align:right;direction:rtl">  في هذه الحالة ، هناك مواقف عندما يتعين علينا التعامل مع الشفرة القديمة.  لا يمكن اختبار الرمز القديم باستخدام الغوغاء أو الرهانات.  في هذه الحالة ، يبقى الجاسوس هو الخيار الوحيد القابل للتطبيق. </p><br><p style=";text-align:right;direction:rtl">  الجواسيس مختلفون عن mokas أو بذرة العنب لأنها لا تعمل مثل العقب. </p><br><p style=";text-align:right;direction:rtl">  عندما يتم استبدال التبعية بـ mok أو كعب الروتين ، يتم إنشاء كائن اختبار ، ولا يتم تنفيذ التعليمات البرمجية المصدر الحقيقي للتبعية. </p><br><p style=";text-align:right;direction:rtl">  من ناحية أخرى ، سوف يقوم الجاسوس بتنفيذ الكود المصدر الرئيسي للاعتماد الذي أنشئ من أجله الجاسوس ، لكن الجاسوس سيسمح لك بتغيير ما تعيده الجاسوس والتحقق من استدعاءات الطريقة ، مثل mokas و stubs.  (ومن هنا جاء اسم الجاسوس). </p><br><p style=";text-align:right;direction:rtl">  لنلقِ نظرة على مثال <code>FooController</code> التالي ، والذي يستخدم <code>FooService</code> ، ثم اختبر الوظيفة باستخدام جاسوس. </p><br><p style=";text-align:right;direction:rtl"> <code>FooController.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p style=";text-align:right;direction:rtl"> <code>FooService.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  كود الاختبار: </p><br><p style=";text-align:right;direction:rtl"> <code>SpySpec.groovy</code> </p> <br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpySpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Spy FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">" -"</span></span> def fooService = Spy(FooService) and: <span class="hljs-string"><span class="hljs-string">"   "</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"  "</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"     "</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span> and: <span class="hljs-string"><span class="hljs-string">'     '</span></span> response.text == <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  إنشاء مثيل تجسس بسيط جدًا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">def fooService = Spy(FooService)</code> </pre> <br><p style=";text-align:right;direction:rtl">  في الكود أعلاه ، يسمح لنا الجاسوس بالتحقق من الاتصال بـ <code>FooService.doSomething(name)</code> ، وعدد المكالمات وقيم المعلمة.  علاوة على ذلك ، يغير الجاسوس تطبيق الطريقة لإرجاع قيمة مختلفة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  الكود أعلاه يحل 4 مشاكل مهمة: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يخلق مثيل تجسس ل <code>FooService</code> </li><li style=";text-align:right;direction:rtl">  يتحقق التفاعل التبعية </li><li style=";text-align:right;direction:rtl">  يتحقق من كيفية عمل التطبيق وفقًا لبعض نتائج استدعاءات طريقة التبعية </li><li style=";text-align:right;direction:rtl">  عزل الكود الذي تم اختباره ، واستبدال تطبيق التبعية بنقرة </li></ul><br><h2 id="faq" style=";text-align:right;direction:rtl">  التعليمات </h2><br><p style=";text-align:right;direction:rtl">  <strong>أي خيار لاستخدام: وهمية ، كعب رقيق أو جاسوس؟</strong> </p><br><p style=";text-align:right;direction:rtl">  هذا هو السؤال الذي يواجهه العديد من المطورين.  يمكن أن تساعد الأسئلة الشائعة إذا لم تكن متأكدًا من الطريقة التي يجب استخدامها. </p><br><p style=";text-align:right;direction:rtl">  <strong>س:</strong> هل الغرض من اختبار التحقق من العقد بين الكود الذي تم اختباره والتبعيات؟ </p><br><p style=";text-align:right;direction:rtl">  <strong>ج:</strong> إذا أجبت بنعم ، استخدم Mock </p><br><p style=";text-align:right;direction:rtl">  <strong>س:</strong> هل الغرض من الاختبار هو التأكد من أن الشفرة قيد الاختبار تعمل بشكل صحيح عند التفاعل مع التبعيات؟ </p><br><p style=";text-align:right;direction:rtl">  <strong>ج:</strong> إذا أجبت بنعم ، استخدم Stub </p><br><p style=";text-align:right;direction:rtl">  <strong>س:</strong> هل نتائج استدعاء أساليب التبعية قيم إدخال الكود قيد الاختبار؟ </p><br><p style=";text-align:right;direction:rtl">  <strong>ج:</strong> إذا أجبت بنعم ، استخدم Stub </p><br><p style=";text-align:right;direction:rtl">  <strong>س:</strong> هل تتعامل مع الشفرة القديمة ، والتي يصعب اختبارها للغاية ، وليس لديك أي خيارات متبقية؟ </p><br><p style=";text-align:right;direction:rtl">  <strong>ج:</strong> حاول استخدام الجاسوس </p><br><h2 id="kod-primerov" style=";text-align:right;direction:rtl">  مثال رمز </h2><br><p style=";text-align:right;direction:rtl">  يمكنك العثور على الكود لجميع الأمثلة في هذه المقالة على: </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/ddelponte/mock-stub-spy</a> </p><br><h2 id="poleznye-ssylki" style=";text-align:right;direction:rtl">  روابط مفيدة </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://spockframework.org/spock/docs/1.1/all_in_one.html#_interaction_based_testing</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://martinfowler.com/bliki/UnitTest.html</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://martinfowler.com/articles/mocksArentStubs.html</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435488/">https://habr.com/ru/post/ar435488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435470/index.html">رد فعل البرنامج التعليمي ، الجزء 8: العمل المستمر على تطبيق TODO ، وإدخال خصائص المكونات</a></li>
<li><a href="../ar435476/index.html">Mkcert: شهادات HTTPS صالحة للمضيف المحلي</a></li>
<li><a href="../ar435480/index.html">مايكروسوفت وكروجر ستمنح الأمازون معركة في هذا المجال ... تجارة المواد الغذائية</a></li>
<li><a href="../ar435482/index.html">تسليط الضوء على الزركون: vDSO (كائن ديناميكي مشترك افتراضي)</a></li>
<li><a href="../ar435484/index.html">أسلوب مدهش 1989</a></li>
<li><a href="../ar435490/index.html">تغييرات ضريبة Google في عام 2019</a></li>
<li><a href="../ar435494/index.html">خادم عميل سلس</a></li>
<li><a href="../ar435496/index.html">دعوى قضائية ضد تسلا عن حادث قتل فيه سائق وراكب من طراز S</a></li>
<li><a href="../ar435498/index.html">vCloud Director Extender: Migration</a></li>
<li><a href="../ar435500/index.html">القفازات البيومترية في رياضة السيارات</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>