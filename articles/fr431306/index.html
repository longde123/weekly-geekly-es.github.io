<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåå üë©üèº‚Äçü§ù‚Äçüë®üèª üèì Comment cr√©er une pyramide dans le tronc ou les applications de d√©veloppement pilot√© par les tests sur Spring Boot üé∑ üà≤ üê™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le framework Spring est souvent cit√© comme exemple du framework Cloud Native , con√ßu pour fonctionner dans le cloud, d√©velopper des applications √† dou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment cr√©er une pyramide dans le tronc ou les applications de d√©veloppement pilot√© par les tests sur Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431306/"><p> <em>Le framework Spring est</em> souvent cit√© comme exemple du framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cloud Native</a> , con√ßu pour fonctionner dans le cloud, d√©velopper <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des applications √† douze facteurs</a> , des microservices et l'un des produits les plus stables, mais en m√™me temps innovants.  Mais dans cet article, je voudrais m'attarder sur un autre aspect fort de Spring: c'est son support au <em>d√©veloppement par le biais de tests</em> (capacit√© TDD?).  Malgr√© la connectivit√© TDD, j'ai souvent remarqu√© que les projets Spring ignoraient certaines des meilleures pratiques pour les tests, inventaient leurs propres v√©los ou n'√©crivaient pas du tout parce qu'ils √©taient "lents" ou "peu fiables".  Et je vais vous dire exactement comment √©crire <strong>des</strong> tests <strong>rapides</strong> et <strong>fiables</strong> pour les applications sur Spring Framework et effectuer le d√©veloppement par le biais de tests.  Donc, si vous utilisez Spring (ou voulez commencer), comprenez quels sont les tests en g√©n√©ral (ou voulez comprendre), ou pensez que <code>contextLoads</code> est le niveau n√©cessaire et suffisant de test d'int√©gration - ce sera int√©ressant! </p><a name="habracut"></a><br><p>  La capacit√© TDD est tr√®s ambigu√´ et mal mesurable, mais Spring a n√©anmoins beaucoup de choses qui, par conception, aident √† √©crire l'int√©gration et les tests unitaires avec un minimum d'effort.  Par exemple: </p><br><ul><li>  Test d'int√©gration - vous pouvez facilement lancer l'application, verrouiller les composants, red√©finir les param√®tres, etc. </li><li>  Concentrez les tests d'int√©gration - uniquement l'acc√®s aux donn√©es, uniquement le Web, etc. </li><li>  Support pr√™t √† l'emploi - bases de donn√©es en m√©moire, files d'attente de messages, authentification et autorisation dans les tests </li><li>  Test via des contrats (Spring Cloud Contract) </li><li>  Prise en charge des tests de l'interface utilisateur Web √† l'aide de HtmlUnit </li><li>  Flexibilit√© de la configuration de l'application - profils, configurations de test, composants, etc. </li><li>  Et bien plus </li></ul><br><p>  Pour commencer, une petite mais n√©cessaire introduction sur TDD et les tests en g√©n√©ral. </p><br><h1 id="test-driven-development">  D√©veloppement pilot√© par les tests </h1><br><p>  TDD est bas√© sur une id√©e tr√®s simple - nous √©crivons des tests <strong>avant d'</strong> √©crire du code.  En th√©orie, cela semble effrayant, mais apr√®s un certain temps, une compr√©hension des pratiques et des techniques vient, et la possibilit√© de passer des tests <em>par la suite</em> provoque un inconfort tangible.  L'une des pratiques cl√©s est l' <em>it√©ration</em> , c'est-√†-dire  faire tout petit, des it√©rations cibl√©es, dont chacune est d√©crite comme un <strong>Red-Green-Refactor</strong> . </p><br><p>  Dans la phase <strong>rouge</strong> , nous √©crivons un test qui tombe, et il est tr√®s important qu'il tombe avec une raison et une description claires et compr√©hensibles, et que le test lui-m√™me soit complet et r√©ussit lorsque le code est √©crit.  Le test doit v√©rifier le <em>comportement</em> , pas l' <em>impl√©mentation</em> , c'est-√†-dire  suivez l'approche de la bo√Æte noire, puis je vais vous expliquer pourquoi. </p><br><p>  Dans la phase <strong>verte</strong> , nous √©crivons le <em>code minimum n√©cessaire</em> pour r√©ussir le test.  Parfois, il est int√©ressant de s'entra√Æner et de le rendre aussi fou que possible (m√™me s'il vaut mieux ne pas s'emballer) et lorsqu'une fonction retourne un bool√©en selon l'√©tat du syst√®me, le premier "pass" peut simplement √™tre <code>return true</code> . </p><br><p>  Dans la phase de <strong>refactoring</strong> , qui ne <em>peut</em> √™tre lanc√©e que <em>lorsque tous les tests sont verts</em> , nous allons refactoriser le code et le remettre en bon √©tat.  Ce n'est m√™me pas n√©cessaire pour un morceau de code que nous avons √©crit, il est donc important de commencer la refactorisation sur un syst√®me stable.  L'approche de la ¬´bo√Æte noire¬ª aidera simplement √† refactoriser, √† changer l'impl√©mentation, mais sans toucher au comportement. </p><br><p>  Je parlerai des diff√©rents aspects du TDD √† l'avenir, apr√®s tout, c'est l'id√©e d'une s√©rie d'articles, donc maintenant je ne m'attarderai pas particuli√®rement sur les d√©tails.  Mais avant de r√©pondre aux critiques standard de TDD, je mentionnerai quelques mythes que j'entends souvent. </p><br><ul><li>  <em>"TDD repr√©sente une couverture √† 100% du code, mais il ne donne aucune garantie"</em> - le d√©veloppement par le biais de tests n'a aucun rapport avec une couverture √† 100%.  Dans de nombreuses √©quipes o√π je travaillais, cette m√©trique n'√©tait m√™me pas mesur√©e et √©tait class√©e comme m√©trique de vanit√©.  Et oui, une couverture de test √† 100% ne veut rien dire. </li><li>  <em>"TDD ne fonctionne que pour des fonctions simples, une vraie application avec une base de donn√©es et un √©tat difficile ne peut pas √™tre cr√©√© avec elle"</em> est une excuse tr√®s populaire, g√©n√©ralement compl√©t√©e par "Nous avons une application tellement compliqu√©e que nous n'√©crivons pas du tout les tests, c'est impossible".  J'ai vu une approche TDD fonctionnelle sur des applications compl√®tement diff√©rentes - Web (avec et sans SPA), mobile, API, microservices, monolithes, syst√®mes bancaires complexes, plateformes cloud, frameworks, plateformes de vente au d√©tail √©crites dans diff√©rents langages et technologies.  Ainsi, le mythe populaire ¬´Nous sommes uniques, tout est diff√©rent¬ª est le plus souvent une excuse pour ne pas investir des efforts et de l'argent dans les tests, mais pas une vraie raison (bien qu'il puisse √©galement y avoir de vraies raisons). </li><li>  <em>¬´Il y aura toujours des bogues avec TDD¬ª</em> - bien s√ªr, comme dans tout autre logiciel.  TDD ne concerne pas les bugs ou leur absence, c'est un outil de d√©veloppement.  Comme le d√©bogage.  Comme un IDE.  Comme la documentation.  Aucun de ces outils ne garantit l'absence de bogues, ils aident seulement √† faire face √† la complexit√© croissante du syst√®me. </li></ul><br><blockquote>  L'objectif principal du TDD et des tests en g√©n√©ral est de donner √† l'√©quipe l' <strong>assurance</strong> que le syst√®me fonctionne de mani√®re stable.  Par cons√©quent, aucune des pratiques de test ne d√©termine le nombre et les tests √† √©crire.  √âcrivez combien vous pensez n√©cessaire, combien vous devez √™tre s√ªr que le code <em>peut √™tre mis en production</em> d√®s maintenant <em>et qu'il fonctionnera</em> .  Il y a des gens qui consid√®rent les tests d'int√©gration rapide comme une bo√Æte noire ultimative n√©cessaire et suffisante, et les tests unitaires facultatifs.  Quelqu'un dit que les tests e2e avec la possibilit√© d'un retour rapide √† la version pr√©c√©dente et la pr√©sence de versions canaries ne sont pas si critiques.  Combien d'√©quipes - tant d'approches, il est important de trouver la v√¥tre. </blockquote><p>  L'un de mes objectifs est de m'√©loigner du format <em>¬´d√©veloppement en testant une fonction qui ajoute deux nombres¬ª</em> dans l'histoire de TDD et de regarder une application r√©elle, une sorte de pratique de test qui a √©t√© √©vapor√©e en une application minimale, collect√©e sur des projets r√©els.  En tant qu'exemple semi-r√©el, je vais utiliser une petite application Web que j'ai moi-m√™me invent√©e pour l'abstrait <del>  usines </del>  Boulangerie - <strong>P√¢tisserie</strong> .  Je pr√©vois d'√©crire de petits articles, en me concentrant √† chaque fois sur un √©l√©ment distinct des fonctionnalit√©s de l'application et en montrant √† travers TDD que vous pouvez concevoir des API, la structure interne de l'application et maintenir une refactorisation constante. </p><br><p>  Voici un exemple de plan pour une s√©rie d'articles, tel que je le vois actuellement: </p><br><ol><li>  Walking skeleton - cadre d'application o√π vous pouvez ex√©cuter le cycle Red-Green-Refactor </li><li>  Test d'interface utilisateur et conception bas√©e sur le comportement </li><li>  Test d'acc√®s aux donn√©es (Spring Data) </li><li>  Tests d'autorisation et d'authentification (Spring Security) </li><li>  Jet Stack (WebFlux + Project Reactor) </li><li>  Interop√©rabilit√© des (micro) services et contrats (Spring Cloud) </li><li>  Test de Message Queuing (Spring Cloud) </li></ol><br><p>  Cet article d'introduction portera sur les points 1 et 2 - je vais cr√©er un cadre d'application et un test d'interface utilisateur de base en utilisant le BDD - ou <strong>une</strong> approche de <strong>d√©veloppement ax√©e sur le comportement</strong> .  Chaque article d√©butera par une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">user story</a> , mais je ne parlerai pas de la partie ¬´produit¬ª pour gagner du temps.  La user story sera √©crite en anglais, il sera bient√¥t clair pourquoi.  Tous les exemples de code peuvent √™tre trouv√©s sur GitHub, donc je n'analyserai pas tout le code, seulement les parties importantes. </p><br><blockquote>  La user story est une description d'une caract√©ristique d'une application en langage naturel qui est g√©n√©ralement √©crite au nom d'un utilisateur du syst√®me. </blockquote><br><h1 id="user-story-1-polzovatel-vidit-stranicu-privetstviya">  User story 1: L'utilisateur voit la page d'accueil </h1><br><blockquote>  <strong>Comme</strong> Alice, un nouvel utilisateur <br>  <strong>Je veux</strong> voir une page d'accueil lors de la visite du site Web de Cake Factory <br>  <strong>Pour que</strong> je sache quand Cake Factory est sur le point de se lancer <br><br>  Crit√®res d'acceptation: <br>  Sc√©nario: un utilisateur visitant le site Web avant la date de lancement <br>  √âtant donn√© que je suis un nouvel utilisateur <br>  Quand je visite le site Web de Cake Factory <br>  Ensuite, je vois un message ¬´Merci pour votre int√©r√™t¬ª <br>  Et je vois un message "Le site Web arrive bient√¥t ..." </blockquote><p>  Il faudra des connaissances: qu'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-ce que le d√©veloppement</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bas√© sur</a> le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comportement</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cucumber</a> , les bases du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spring Boot Testing</a> . </p><br><p>  La premi√®re user story est assez basique, mais l'objectif n'est pas encore dans la complexit√©, mais dans la cr√©ation d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un squelette ambulant</a> - une application minimale pour d√©marrer le <strong>cycle TDD</strong> . </p><br><p>  Apr√®s avoir cr√©√© un nouveau projet sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spring Initializr</a> avec des modules Web et Moustache, pour commencer, j'aurai besoin de quelques modifications suppl√©mentaires pour <code>build.gradle</code> : </p><br><ul><li>  ajoutez HtmlUnit <code>testImplementation('net.sourceforge.htmlunit:htmlunit')</code> .  Vous n'avez pas besoin de sp√©cifier la version, le plugin de gestion des d√©pendances Spring Boot pour Gradle s√©lectionnera automatiquement la version n√©cessaire et compatible </li><li>  migrer un projet de JUnit 4 vers JUnit 5 (car 2018 est dans la cour) </li><li>  ajouter des d√©pendances √† Cucumber - une biblioth√®que que j'utiliserai pour √©crire les sp√©cifications BDD </li><li>  supprimer cr√©√© par d√©faut <code>CakeFactoryApplicationTests</code> avec in√©vitable <code>contextLoads</code> </li></ul><br><p>  En gros, c'est le "squelette" de base de l'application, vous pouvez d√©j√† √©crire le premier test. </p><br><p>  Pour faciliter la navigation dans le code, je parlerai bri√®vement des technologies utilis√©es. </p><br><h2 id="cucumber">  Concombre </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cucumber</a> est un cadre de <strong>d√©veloppement ax√© sur le comportement</strong> qui aide √† cr√©er des "sp√©cifications ex√©cutables", c'est-√†-dire  ex√©cuter des tests (sp√©cifications) √©crits en langage naturel.  Le plugin Cucumber analyse le code source en Java (et dans de nombreux autres langages) et utilise des <em>d√©finitions d'√©tapes</em> pour ex√©cuter du code r√©el.  Les d√©finitions d'√©tape sont des m√©thodes de classe annot√©es par <code>@Given</code> , <code>@When</code> , <code>@Then</code> et d'autres annotations. </p><br><h2 id="htmlunit">  Htmlunit </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La page d'accueil du</a> projet appelle HtmlUnit "un navigateur sans interface graphique pour les applications Java".  Contrairement √† Selenium, HtmlUnit ne lance pas de v√©ritable navigateur et, surtout, ne rend pas la page du tout, en travaillant directement avec le DOM.  JavaScript est pris en charge via le moteur Mozilla Rhino.  HtmlUnit est bien adapt√© aux applications classiques, mais pas tr√®s convivial avec les applications √† page unique.  Pour commencer, ce sera suffisant, puis j'essaierai de montrer que m√™me des choses comme un framework de test peuvent faire partie de l'impl√©mentation, et non le fondement de l'application. </p><br><h1 id="pervyy-test">  Premier test </h1><br><p>  Maintenant, une histoire d'utilisateur √©crite en anglais me sera utile.  Le meilleur d√©clencheur pour d√©marrer la prochaine it√©ration TDD est des crit√®res d'acceptation √©crits de telle mani√®re qu'ils peuvent √™tre transform√©s en une sp√©cification ex√©cutable avec un minimum de gestes. </p><br><blockquote>  Id√©alement, les user stories doivent √™tre √©crites de mani√®re √† pouvoir √™tre simplement copi√©es dans la sp√©cification BDD et ex√©cut√©es.  C'est loin d'√™tre toujours simple et pas toujours possible, mais cela devrait √™tre l'objectif du propri√©taire du produit et de toute l'√©quipe, bien qu'il ne soit pas toujours r√©alisable. </blockquote><p>  Donc, ma premi√®re fonctionnalit√©. </p><br><pre> <code class="plaintext hljs">Feature: Welcome page Scenario: a user visiting the web-site visit before the launch date Given a new user, Alice When she visits Cake Factory web-site Then she sees a message 'Thank you for your interest' And she sees a message 'The web-site is coming in December!'</code> </pre> <br><p>  Si vous g√©n√©rez des descriptions d'√©tapes (le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin Intellij IDEA</a> aide √† prendre en charge Gherkin aide beaucoup) et ex√©cutez le test, alors, bien s√ªr, il sera vert - il ne teste encore rien.  Et voici la phase importante du travail sur le test - <em>vous devez √©crire un test, comme si le code principal avait √©t√© √©crit</em> . </p><br><p>  Souvent, pour ceux qui commencent √† bannir le TDD, une stupeur s'installe ici - il est difficile de mettre en t√™te les algorithmes et la logique de quelque chose qui n'existe pas encore.  Et par cons√©quent, il est tr√®s important d'avoir des <em>it√©rations</em> aussi <em>petites et cibl√©es</em> que possible, en commen√ßant par la user story et en descendant jusqu'au niveau de l'int√©gration et de l'unit√©.  Il est important de se concentrer <strong>sur un test √† la fois</strong> et d'essayer de se mouiller et d'ignorer les d√©pendances qui ne sont pas encore importantes.  J'ai parfois remarqu√© √† quel point les gens s'√©cartent facilement - cr√©er une interface ou une classe pour une d√©pendance, g√©n√©rer imm√©diatement une classe de test vide pour elle, une d√©pendance suppl√©mentaire y est ajout√©e, une autre interface est cr√©√©e et ainsi de suite. </p><br><blockquote>  Si l'histoire est "il serait n√©cessaire de rafra√Æchir le statut lors de l'enregistrement", il est tr√®s difficile d'automatiser et de formaliser.  Dans mon exemple, chaque √©tape peut √™tre clairement pr√©sent√©e dans une s√©quence d'√©tapes qui peuvent √™tre d√©crites par code.  Il est clair que c'est l'exemple le plus simple et il ne montre pas grand-chose, mais j'esp√®re que, avec une complexit√© croissante, il sera plus int√©ressant. </blockquote><br><h2 id="red">  Rouge </h2><br><p>  Donc, pour ma premi√®re fonctionnalit√©, j'ai cr√©√© les descriptions d'√©tapes suivantes: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span>(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WelcomePage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> WebClient webClient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HtmlPage page; <span class="hljs-meta"><span class="hljs-meta">@LocalServerPort</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String baseUrl; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ webClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); baseUrl = <span class="hljs-string"><span class="hljs-string">"http://localhost:"</span></span> + port; } <span class="hljs-meta"><span class="hljs-meta">@Given</span></span>(<span class="hljs-string"><span class="hljs-string">"a new user, Alice"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aNewUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// nothing here, every user is new by default } @When("she visits Cake Factory web-site") public void sheVisitsCakeFactoryWebSite() throws IOException { page = webClient.getPage(baseUrl); } @Then("she sees a message {string}") public void sheSeesAMessageThanksForYourInterest(String expectedMessage) { assertThat(page.getBody().asText()).contains(expectedMessage); } }</span></span></code> </pre> <br><p>  Quelques points √† prendre en compte: </p><br><ul><li>  les fonctionnalit√©s sont lanc√©es par un autre fichier, <code>Features.java</code> utilisant l'annotation <code>RunWith</code> de JUnit 4, Cucumber ne prend pas en charge la version 5, h√©las </li><li>  <code>@SpringBootTest</code> annotation <code>@SpringBootTest</code> est ajout√©e √† la description des √©tapes, <code>cucumber-spring</code> r√©cup√®re √† partir de l√† et configure le contexte de test (c.-√†-d. Lance l'application) </li><li>  L'application Spring pour le test commence par <code>webEnvironment = RANDOM_PORT</code> et ce port al√©atoire est transmis au test √† l'aide de <code>@LocalServerPort</code> , Spring trouvera cette annotation et d√©finira la valeur du champ sur le port du serveur </li></ul><br><p>  Et le test, comme pr√©vu, se bloque avec l'erreur <code>404 for http://localhost:51517</code> . </p><br><blockquote>  Les erreurs avec lesquelles le test se bloque sont extr√™mement importantes, en particulier en ce qui concerne les tests unitaires ou d'int√©gration, et ces erreurs font partie de l'API.  Si le test se bloque avec une <code>NullPointerException</code> ce n'est pas trop bon, mais la <code>BaseUrl configuration property is not set</code> - bien mieux. </blockquote><br><h2 id="green">  Vert </h2><br><p>  Pour rendre le test vert, j'ai ajout√© un contr√¥leur de base et une vue avec un minimum de HTML: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"index"</span></span>; } }</code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Cake Factory<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Thank you for your interest<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>The web-site is coming in December!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Le test est vert, l'application fonctionne, bien qu'elle soit faite dans la tradition d'une conception technique s√©v√®re. </p><br><blockquote>  Sur un vrai projet et dans une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©quipe √©quilibr√©e</a> , bien s√ªr, je m'asseyais avec le designer et nous transformions le HTML nu en quelque chose de beaucoup plus beau.  Mais dans le cadre de l'article, un miracle ne se produira pas, la princesse restera une grenouille. </blockquote><p>  La question ¬´quelle partie de TDD est la conception¬ª n'est pas si simple.  L'une des pratiques que j'ai trouv√©es utiles est au d√©but de ne m√™me pas regarder du tout l'interface utilisateur (pas m√™me d'ex√©cuter l'application pour sauver vos nerfs), d'√©crire un test, de le rendre vert - puis, ayant une base stable, de travailler sur le front-end, de red√©marrer constamment les tests . </p><br><h2 id="refactor">  Refactor </h2><br><p>  Dans la premi√®re it√©ration, il n'y a pas de refactoring particulier, mais bien que j'ai pass√© les 10 derni√®res minutes √† choisir un mod√®le pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bulma</a> , qui peut √™tre consid√©r√© comme du refactoring! </p><br><h1 id="v-zaklyuchenie">  En conclusion </h1><br><p>  Alors que l'application n'a ni travail de s√©curit√©, ni base de donn√©es, ni API, les tests et TDD semblent assez simples.  Et en g√©n√©ral, √† partir de la pyramide des tests, je n'ai touch√© qu'au sommet, le test de l'interface utilisateur.  Mais en cela, en partie, le secret de l'approche Lean est de tout faire en petites it√©rations, un composant √† la fois.  Cela permet de se concentrer sur les tests, de les rendre simples et de contr√¥ler la qualit√© du code.  J'esp√®re que dans les articles suivants il y aura plus d'int√©ressant. </p><br><h1 id="ssylki">  Les r√©f√©rences </h1><br><ul><li>  Projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Concourse ci</a> </li></ul><br><p>  <em>PS Le titre de l'article n'est pas aussi fou que cela puisse para√Ætre au d√©but, je pense que beaucoup l'ont d√©j√† devin√©.</em>  <em>"Comment construire une pyramide dans votre d√©marrage" est une r√©f√©rence √† la pyramide de test (je vous en dirai plus √† ce sujet plus tard) et √† Spring Boot, o√π d√©marrage en anglais britannique signifie √©galement "tronc".</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431306/">https://habr.com/ru/post/fr431306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431296/index.html">R√¥les √©motionnels dans les jeux. Narration comp√©tente et implication dans le flux</a></li>
<li><a href="../fr431298/index.html">Validation de l'unicit√© v√©ritable</a></li>
<li><a href="../fr431300/index.html">Trois ans de certification sans dirigeants - vol normal</a></li>
<li><a href="../fr431302/index.html">Faire une simple antenne sonar √† la poubelle</a></li>
<li><a href="../fr431304/index.html">√Ä la recherche d'ombres prometteuses pour roguelike</a></li>
<li><a href="../fr431308/index.html">Innotrans 2018: quel type de transport ferroviaire sera demain?</a></li>
<li><a href="../fr431310/index.html">Configurer Firefox / Chrome pour un Internet tr√®s lent et limit√©</a></li>
<li><a href="../fr431312/index.html">DeezLoader + PlexMediaServer. Cr√©er un portail de musique √† domicile</a></li>
<li><a href="../fr431316/index.html">Vote sur la deuxi√®me version b√™ta du rapport r√©vis√© 7 sur le sch√©ma de langage algorithmique (grand langage)</a></li>
<li><a href="../fr431318/index.html">Cha√Æne de transcripteur Python ‚Üí 11l ‚Üí C ++ [pour acc√©l√©rer le code Python et plus]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>