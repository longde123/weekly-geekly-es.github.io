<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Å üö≥ üé® C√≥mo NO escane√© el internet bielorruso üëπ üì™ ü§≤üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√≥logo 
 Este art√≠culo no es muy similar a los que se publicaron anteriormente sobre el escaneo de Internet de ciertos pa√≠ses, porque no persegu√≠ los...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo NO escane√© el internet bielorruso</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446022/"><h2>  Pr√≥logo </h2><br>  Este art√≠culo no es muy similar a los que se publicaron anteriormente sobre el escaneo de Internet de ciertos pa√≠ses, porque no persegu√≠ los objetivos de escanear en masa un segmento espec√≠fico de Internet en busca de puertos abiertos y la presencia de las vulnerabilidades m√°s populares porque es ilegal. <br><br>  Prefiero tener un inter√©s ligeramente diferente: tratar de identificar todos los sitios relevantes en la zona de dominio BY utilizando diferentes m√©todos, determinar la pila de tecnolog√≠as utilizadas, a trav√©s de servicios como Shodan, VirusTotal, etc. para realizar un reconocimiento pasivo sobre IP y puertos abiertos y, en el ap√©ndice, para recopilar un poco m√°s de utilidad informaci√≥n para la formaci√≥n de algunas estad√≠sticas generales sobre el nivel de seguridad con respecto a los sitios y usuarios. <br><a name="habracut"></a><br><h2>  Introductorio y nuestro kit de herramientas </h2><br>  El plan al principio era simple: comun√≠quese con su registrador local para obtener una lista de los dominios registrados actuales, luego verifique la disponibilidad de todo y comience a explorar los sitios que funcionan.  En realidad, todo result√≥ ser mucho m√°s complicado: este tipo de informaci√≥n era natural, nadie quer√≠a proporcionarla, con la excepci√≥n de la p√°gina oficial de estad√≠sticas de los nombres de dominio registrados reales en la zona BY (alrededor de 130 mil dominios).  Si no existe dicha informaci√≥n, debe recopilarla usted mismo. <br><br><img src="https://habrastorage.org/webt/yh/pz/4w/yhpz4wvpvleq-f25o5fp5wwt_2u.png"><br><br>  En t√©rminos de herramientas, de hecho, todo es bastante simple: miramos hacia el c√≥digo abierto, siempre puede agregar algo, terminar algunas muletas m√≠nimas.  De las m√°s populares, se utilizaron las siguientes herramientas: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Whatweb</a> </li><li>  rizo </li><li>  cavar </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wafw00f</a> </li><li>  API de terceros ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VirusTotal</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Google SafeBrwosing</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Shodan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vulners</a> ) </li></ul><br><br><h2>  Inicio de actividades: punto de partida </h2><br>  Como introducci√≥n, como dije antes, idealmente los nombres de dominio eran adecuados, pero ¬ød√≥nde puedo obtenerlos?  Necesitamos comenzar desde algo m√°s simple, en este caso las direcciones IP son adecuadas para nosotros, pero nuevamente, con b√∫squedas inversas no siempre es posible capturar todos los dominios, y al recopilar nombres de host, no siempre es el dominio correcto.  En esta etapa, comenc√© a pensar en posibles escenarios para recopilar este tipo de informaci√≥n, una vez m√°s: se tuvo en cuenta el hecho de que nuestro presupuesto era de $ 5 para el alquiler de VPS, todo lo dem√°s deber√≠a ser gratuito. <br><br><h3>  Nuestras posibles fuentes de informaci√≥n: </h3><br><ul><li>  Direcciones IP (sitio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ubicaci√≥n ip2</a> ) </li><li>  B√∫squeda de dominio por la segunda parte de la direcci√≥n de correo electr√≥nico (¬øpero d√≥nde conseguirlos? Vamos a averiguarlo un poco m√°s abajo) </li><li>  Algunos registradores / proveedores de alojamiento pueden proporcionarnos dicha informaci√≥n en forma de subdominios </li><li>  Subdominios y su posterior inversi√≥n (Sublist3r y Aquatone pueden ayudar aqu√≠) </li><li>  Fuerza bruta y entrada manual (larga, triste, pero posible, aunque no utilic√© esta opci√≥n) </li></ul><br>  Me adelantar√© un poco y dir√© que con este enfoque logr√© recopilar alrededor de 50 mil dominios y sitios √∫nicos, respectivamente (no logr√© procesar todo).  Si √©l continuara recolectando informaci√≥n activamente, entonces seguramente en menos de un mes de trabajo mi transportador habr√≠a dominado toda la base de datos, o la mayor parte. <br><br><h3>  Empecemos a trabajar </h3><br>  En art√≠culos anteriores, la informaci√≥n sobre las direcciones IP se tom√≥ del sitio IP2LOCATION, por razones obvias, no encontr√© estos art√≠culos (ya que todas las acciones tuvieron lugar mucho antes), sino que tambi√©n llegu√© a este recurso.  Es cierto, en mi caso, el enfoque fue diferente: decid√≠ no tomar la base de datos localmente para m√≠ y no extraer informaci√≥n del CSV, pero decid√≠ monitorear los cambios directamente en el sitio, de manera continua y como la base principal desde donde todos los scripts posteriores tendr√°n objetivos, hice una tabla con Direcciones IP en diferentes formatos: CIDR, lista "desde" y "hasta", marca de pa√≠s (por si acaso), n√∫mero AS, descripci√≥n AS. <br><br><img src="https://habrastorage.org/webt/mx/s4/wj/mxs4wjpxueytkcd15srf7alswf8.png"><br><br>  El formato no es el m√°s √≥ptimo, pero estaba muy contento con la demostraci√≥n y la promoci√≥n √∫nica, y para no buscar constantemente informaci√≥n adicional como ASN, decid√≠ registrarla por mi cuenta.  Para obtener esta informaci√≥n, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recurr√≠ al</a> servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IpToASN</a> , tienen una API conveniente (con restricciones), que de hecho solo necesita integrarse en usted mismo. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de an√°lisis de IP</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ipList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, <span class="hljs-string"><span class="hljs-string">"https://lite.ip2location.com/belarus-ip-address-ranges"</span></span>); curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number"><span class="hljs-number">0</span></span>); curl_setopt($ch, CURLOPT_USERAGENT,<span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13'</span></span>); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $ipList = curl_exec($ch); curl_close ($ch); preg_match_all(<span class="hljs-string"><span class="hljs-string">"/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\&lt;\/td\&gt;\s+\&lt;td\&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/"</span></span>, $ipList, $matches); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $matches[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iprange2cidr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ipStart, $ipEnd)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_string($ipStart) || is_string($ipEnd)){ $start = ip2long($ipStart); $end = ip2long($ipEnd); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ $start = $ipStart; $end = $ipEnd; } $result = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($end &gt;= $start){ $maxSize = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($maxSize &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ $mask = hexdec(iMask($maxSize - <span class="hljs-number"><span class="hljs-number">1</span></span>)); $maskBase = $start &amp; $mask; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($maskBase != $start) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; $maxSize--; } $x = log($end - $start + <span class="hljs-number"><span class="hljs-number">1</span></span>)/log(<span class="hljs-number"><span class="hljs-number">2</span></span>); $maxDiff = floor(<span class="hljs-number"><span class="hljs-number">32</span></span> - floor($x)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($maxSize &lt; $maxDiff){ $maxSize = $maxDiff; } $ip = long2ip($start); array_push($result, <span class="hljs-string"><span class="hljs-string">"$ip/$maxSize"</span></span>); $start += pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, (<span class="hljs-number"><span class="hljs-number">32</span></span>-$maxSize)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } $getIpList = ipList(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($getIpList <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { $cidr = iprange2cidr($ip[<span class="hljs-number"><span class="hljs-number">0</span></span>], $ip[<span class="hljs-number"><span class="hljs-number">1</span></span>]); }</code> </pre> <br></div></div><br>  Despu√©s de descubrir la IP, necesitamos ejecutar toda nuestra base de datos a trav√©s de los servicios de b√∫squeda inversa, por desgracia, sin restricciones, esto es imposible, excepto por el dinero. <br><br>  De los servicios que son excelentes para esto y convenientes de usar, quiero mencionar dos: <br><br><ol><li>  VirusTotal: l√≠mite de frecuencia de llamadas desde una clave API </li><li>  Hackertarget.com (su API): limite el n√∫mero de visitas desde una IP </li></ol><br>  Sin pasar por los l√≠mites, se obtuvieron las siguientes opciones: <br><br><ul><li>  En el primer caso, uno de los escenarios es soportar tiempos de espera de 15 segundos, en total tendremos 4 llamadas por minuto, lo que puede afectar en gran medida nuestra velocidad y en esta situaci√≥n ser√° √∫til usar 2-3 de esas teclas, y recomendar√≠a recurrir a las mismas proxy y cambiar usuario-agente. </li><li>  En el segundo caso, escrib√≠ un script para el an√°lisis autom√°tico de la base de datos proxy en base a informaci√≥n disponible p√∫blicamente, su validaci√≥n y uso posterior (pero m√°s tarde dej√© esta opci√≥n porque VirusTotal tambi√©n era suficiente en esencia) </li></ul><br>  Vamos m√°s all√° y sin problemas vamos a las direcciones de correo electr√≥nico.  Tambi√©n pueden ser una fuente de informaci√≥n √∫til, pero ¬ød√≥nde recolectarlos?  No tuve que buscar una soluci√≥n por mucho tiempo, porque  los usuarios ocupan poco en nuestro segmento de sitios personales, y la mayor√≠a de ellos son organizaciones: los sitios web de perfil como directorios de tiendas en l√≠nea, foros y mercados condicionales se adaptar√°n a nosotros. <br><br>  Por ejemplo, una inspecci√≥n r√°pida de uno de estos sitios mostr√≥ que muchos usuarios agregan su correo electr√≥nico directamente a su perfil p√∫blico y, en consecuencia, este negocio puede analizarse cuidadosamente para su uso futuro. <br><br><div class="spoiler">  <b class="spoiler_title">Uno de los analizadores</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 import sys, threading, time, os, urllib, re, requests, pymysql from html.parser import HTMLParser from urllib import request from bs4 import BeautifulSoup # HEADERS CONFIG headers = { 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 11.9; rv:42.0) Gecko/20200202 Firefox/41.0' } file = open('dat.html', 'w') def parseMails(uid): page = 'https://profile.onliner.by/user/'+str(uid)+'' cookie = {'onl_session': 'YOUR_SESSION_COOOKIE_HERE'} r = requests.get(page, headers = headers, cookies = cookie) data = BeautifulSoup(r.text) userinfo = data.find_all('dl', {'class': 'uprofile-info'}) find_email = [] for item in userinfo: find_email += str(item.find('a')) get_mail = ''.join(find_email) detect_email = re.compile(".+?&gt;(.+@.+?)&lt;/a&gt;").search(get_mail) file.write("&lt;li&gt;('"+detect_email.group(1)+"'),&lt;/li&gt;") for uid in range(1, 10000): t = threading.Thread(target=parseMails, args=(uid,)) t.start() time.sleep(0.3)</span></span></code> </pre><br></div></div><br>  No entrar√© en los detalles de analizar cada sitio, en alg√∫n lugar es m√°s conveniente adivinar la identificaci√≥n del usuario por fuerza bruta, en alg√∫n lugar es m√°s f√°cil analizar un mapa del sitio, obtener informaci√≥n sobre las p√°ginas de la compa√±√≠a y luego recopilar direcciones de ellos.  Despu√©s de recopilar las direcciones, nos queda por realizar varias operaciones simples, inmediatamente clasific√°ndolas por la zona de dominio, preservando las "colas" y ejecut√°ndolas para excluir duplicados de la base de datos existente. <br><br>  En esta etapa, creo que con la formaci√≥n del alcance, podemos terminar y pasar a la inteligencia.  La inteligencia, como ya sabemos, puede ser de dos tipos: activa y pasiva, en nuestro caso, el enfoque pasivo ser√° m√°s relevante.  Pero, de nuevo, solo acceder al sitio en el puerto 80 o 443 sin carga maliciosa y explotar vulnerabilidades es una acci√≥n bastante leg√≠tima.  Nuestro inter√©s son las respuestas del servidor a una sola solicitud, en algunos casos puede haber dos solicitudes (redireccionar de http a https), en casos m√°s raros, hasta tres (cuando se usa www). <br><br><h2>  Inteligencia </h2><br>  Usando dicha informaci√≥n como un dominio, podemos recopilar los siguientes datos: <br><br><ul><li>  Registros DNS (NS, MX, TXT) </li><li>  Encabezados de respuesta </li><li>  Identificar la pila tecnol√≥gica utilizada </li><li>  Comprenda por qu√© protocolo funciona el sitio. </li><li>  Intente identificar puertos abiertos (basados ‚Äã‚Äãen la base de datos Shodan / Censys) sin escaneo directo </li><li>  Intente identificar vulnerabilidades basadas en la correlaci√≥n de informaci√≥n de Shodan / Censys con la base de datos de Vulners </li><li>  ¬øEst√° en la base de datos de malware de Navegaci√≥n segura de Google? </li><li>  Recopile las direcciones de correo electr√≥nico por dominio, as√≠ como las coincidencias ya encontradas y verifique por Have I Been Pwned, adem√°s, enlace a las redes sociales </li><li>  En algunos casos, un dominio no solo es la cara de la empresa, sino tambi√©n el producto de sus actividades, direcciones de correo electr√≥nico para el registro de servicios, etc., respectivamente: puede buscar informaci√≥n asociada con ellos en recursos como GitHub, Pastebin, Google Dorks (Google CSE ) </li></ul><br>  Siempre puede continuar y usar masscan o nmap, zmap como una opci√≥n, configur√°ndolos primero a trav√©s de Tor con el lanzamiento al azar o incluso desde varias instancias, pero tenemos otros objetivos y el nombre implica que no hice escaneos directos. <br><br>  Recopilamos registros DNS, verificamos la posibilidad de amplificaci√≥n de solicitudes y errores de configuraci√≥n como AXFR: <br><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de recopilaci√≥n de registros del servidor NS</b> <div class="spoiler_text"><pre> <code class="bash hljs">dig ns +short <span class="hljs-variable"><span class="hljs-variable">$domain</span></span> | sed <span class="hljs-string"><span class="hljs-string">'s/\.$//g'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span></code> </pre> <br></div></div><br>  Ejemplo de recopilaci√≥n de registros MX (vea NS, simplemente reemplace 'ns' con 'mx' <br><br><div class="spoiler">  <b class="spoiler_title">Verifique si hay AXFR (aqu√≠ hay muchas soluciones, aqu√≠ hay otra muleta, pero no seguridad, que se usa para ver las salidas)</b> <div class="spoiler_text"><pre> <code class="php hljs"> $digNs = trim(shell_exec(<span class="hljs-string"><span class="hljs-string">"dig ns +short $domain | sed 's/\.$//g' | awk '{print $1}'"</span></span>)); $ns = explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, $digNs); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($ns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $target) { $axfr = trim(shell_exec(<span class="hljs-string"><span class="hljs-string">"dig -t axfr $domain @$target | awk '{print $1}' | sed 's/\.$//g'"</span></span>)); $axfr = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\;/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, $axfr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(trim($axfr))) { $axfr = preg_replace(<span class="hljs-string"><span class="hljs-string">"/\;/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, $axfr); $res = json_encode(explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, trim($axfr)));</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Verifique la amplificaci√≥n de DNS</b> <div class="spoiler_text"><pre> <code class="bash hljs">dig +short test.openresolver.com TXT @<span class="hljs-variable"><span class="hljs-variable">$dns</span></span></code> </pre> <br>  En mi caso, los servidores NS se tomaron de la base de datos, por lo que al final de la variable, puede sustituir cualquier servidor de hecho.  Con respecto a la exactitud de los resultados de este servicio, no puedo estar seguro de que todo funcione sin problemas all√≠ y que los resultados siempre sean v√°lidos, pero espero que la mayor√≠a de los resultados sean reales. <br></div></div><br>  Si por alg√∫n motivo necesitamos mantener una URL final completa del sitio, para esto utilic√© cURL: <br><br><pre> <code class="bash hljs">curl -I -L <span class="hljs-variable"><span class="hljs-variable">$target</span></span> | awk <span class="hljs-string"><span class="hljs-string">'/Location/{print $2}'</span></span></code> </pre> <br>  √âl mismo realizar√° la redirecci√≥n completa y mostrar√° la √∫ltima, es decir  URL actual del sitio.  En mi caso, fue extremadamente √∫til para el uso posterior de herramientas como WhatWeb. <br><br>  ¬øPor qu√© deber√≠amos usarlo?  Para determinar el sistema operativo, el servidor web, el sitio CMS utilizado, algunos encabezados, m√≥dulos adicionales como bibliotecas / frameworks JS / HTML, as√≠ como el t√≠tulo del sitio por el que luego puede intentar filtrar por el mismo campo de actividad. <br><br>  Una opci√≥n muy conveniente en este caso es exportar los resultados de la operaci√≥n de la herramienta en formato XML para su posterior an√°lisis e importarlos a la base de datos si hay un objetivo para procesarlo m√°s tarde. <br><br><pre> <code class="bash hljs">whatweb --no-errors https://www.mywebsite.com --<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-xml=results.xml</code> </pre> <br>  Para m√≠, hice JSON como resultado de la salida y ya lo puse en la base de datos. <br><br>  Hablando de encabezados, puede hacer casi lo mismo con cURL ordinario ejecutando una consulta del formulario: <br><br><pre> <code class="bash hljs">curl -I https://www.mywebsite.com</code> </pre> <br>  En los encabezados, obtenga informaci√≥n sobre CMS y servidores web utilizando expresiones regulares, por ejemplo. <br><br>  Adem√°s del √∫til, tambi√©n podemos resaltar la posibilidad de recopilar informaci√≥n sobre puertos abiertos usando Shodan y luego usar los datos ya obtenidos, verificar la base de datos de Vulners usando su API (los enlaces a los servicios se dan en el encabezado).  Por supuesto, puede haber problemas con la precisi√≥n en este escenario, pero esto no es un escaneo directo con validaci√≥n manual, sino un "malabarismo" banal de datos de fuentes de terceros, pero al menos es mejor que nada. <br><br><div class="spoiler">  <b class="spoiler_title">Funci√≥n PHP para Shodan</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shodanHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($host)</span></span></span><span class="hljs-function"> </span></span>{ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, <span class="hljs-string"><span class="hljs-string">"https://api.shodan.io/shodan/host/"</span></span>.$host.<span class="hljs-string"><span class="hljs-string">"?key=&lt;YOUR_API_KEY&gt;"</span></span>); curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number"><span class="hljs-number">0</span></span>); curl_setopt($ch, CURLOPT_USERAGENT,<span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13'</span></span>); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $shodanResponse = curl_exec($ch); curl_close ($ch); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json_decode($shodanResponse); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de tal an√°lisis comparativo # 1</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ha/fv/7q/hafv7qlzupcsueqn_qwe_0qyo7y.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ejemplo # 2</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9x/0c/jx/9x0cjxkltuscladnh9rd4nshsga.png"><br></div></div><br>  S√≠, desde que comenzaron a hablar sobre la API, los Vulners tienen limitaciones y la soluci√≥n m√°s √≥ptima ser√≠a usar su script Python, todo funcionar√° bien sin torsiones, en el caso de PHP, encontr√© algunas peque√±as dificultades (nuevamente, agregue. los tiempos de espera salvaron la situaci√≥n). <br><br>  Una de las √∫ltimas pruebas: estudiaremos la informaci√≥n sobre el firewall que se utiliza con un script como "wafw00f".  Al probar esta maravillosa herramienta, not√© una cosa interesante: no siempre era la primera vez que era posible determinar el tipo de firewall utilizado. <br><br>  Para ver qu√© tipos de firewalls puede detectar potencialmente wafw00f, puede ingresar el siguiente comando: <br><br><pre> <code class="bash hljs">wafw00f -l</code> </pre> <br>  Para determinar el tipo de firewall, wafw00f analiza los encabezados de respuesta del servidor despu√©s de enviar una solicitud est√°ndar al sitio, si este intento no es suficiente, genera una solicitud de prueba simple adicional y, si esto no es suficiente nuevamente, el tercer m√©todo funciona con los datos despu√©s de los primeros dos intentos. . <br><br>  Porque  para las estad√≠sticas, de hecho, no necesitamos la respuesta completa, cortamos todo el exceso con una expresi√≥n regular y dejamos solo el firewall de nombre: <br><br><pre> <code class="php hljs">/is\sbehind\sa\s(.+?)\n/</code> </pre> <br>  Bueno, como escrib√≠ anteriormente, adem√°s de la informaci√≥n sobre el dominio y el sitio, la informaci√≥n sobre las direcciones de correo electr√≥nico y las redes sociales tambi√©n se actualiz√≥ en modo pasivo: <br><br><div class="spoiler">  <b class="spoiler_title">Estad√≠sticas por correo electr√≥nico definidas en funci√≥n del dominio</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/f-/lq/fj/f-lqfjqylimkrb3l8ham2yxo8f4.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de determinaci√≥n del enlace de las redes sociales a la direcci√≥n de correo electr√≥nico</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/an/pw/dq/anpwdqniobeopkdhnyq5pd5ejgk.png"><br></div></div><br>  La forma m√°s f√°cil fue lidiar con la validaci√≥n de direcciones en Twitter (2 formas), con Facebook (1 forma) en este sentido result√≥ ser un poco m√°s complicado debido a un sistema un poco m√°s complejo para generar una sesi√≥n de usuario real. <br><br><h2>  Pasemos a las estad√≠sticas secas. </h2><br><h4>  Estad√≠sticas DNS </h4><br><img src="https://habrastorage.org/webt/uk/md/m1/ukmdm1eoizu6sjvxaf7nld8kdgi.png"><br><br>  <b>Proveedor: cu√°ntos sitios</b> <br>  ns1.tutby.com: 10899 <br>  ns2.tutby.com: 10899 <br>  ns1.neolocation.com: 4877 <br>  ns2.neolocation.com: 4873 <br>  ns3.neolocation.com: 4572 <br>  ns1.activeby.net: 4231 <br>  ns2.activeby.net: 4229 <br>  u1.hoster.by: 3382 <br>  u2.hoster.by: 3378 <br><br>  DNS √∫nico encontrado: 2462 <br>  Servidores √∫nicos de MX (correo): 9175 (adem√°s de los servicios populares, hay un n√∫mero suficiente de administradores que usan sus propios servicios de correo) <br>  Afectado por la transferencia de zona DNS: 1011 <br>  Afectados por la amplificaci√≥n de DNS: 531 <br>  Pocos fan√°ticos de CloudFlare: 375 (seg√∫n los registros NS usados) <br><br><h4>  Estad√≠sticas de CMS </h4><br><img src="https://habrastorage.org/webt/oz/zp/0k/ozzp0kkl6kof-gomjiesmgoju_y.png"><br><br>  <b>CMS - Cantidad</b> <br>  WordPress: 5118 <br>  Joomla: 2722 <br>  Bitrix: 1757 <br>  Drupal: 898 <br>  OpenCart: 235 <br>  DataLife: 133 <br>  Magento: 32 <br><br><ul><li>  Instalaciones de WordPress potencialmente vulnerables: 2977 </li><li>  Instalaciones potencialmente vulnerables de Joomla: 212 </li><li>  Utilizando el servicio Google SafeBrowsing, fue posible identificar sitios potencialmente peligrosos o infectados: alrededor de 10,000 (en diferentes momentos, alguien repar√≥, alguien aparentemente rompi√≥, las estad√≠sticas no son completamente objetivas) </li><li>  Acerca de HTTP y HTTPS: menos de la mitad de los sitios del volumen encontrado utilizan este √∫ltimo, pero teniendo en cuenta el hecho de que mi base de datos no est√° completa, pero solo el 40% del n√∫mero total, es bastante posible que la mayor√≠a de la segunda mitad de los sitios puedan comunicarse a trav√©s de HTTPS . </li></ul><br><h4>  Estad√≠sticas de firewall: </h4><br><img src="https://habrastorage.org/webt/1o/pf/qc/1opfqck9bluf4aa2xvjt2aivaks.png"><br><br>  <b>Cortafuegos - N√∫mero</b> <br>  ModSecurity: 4354 <br>  Seguridad de la aplicaci√≥n web de IBM: 126 <br>  Mejor seguridad de WP: 110 <br>  CloudFlare: 104 <br>  Imperva SecureSphere: 45 <br>  Juniper WebApp Secure: 45 <br><br><h4>  Estad√≠sticas del servidor web </h4><br><img src="https://habrastorage.org/webt/k1/ru/ut/k1ruutqumvvmoism9bafmdp8oko.png"><br><br>  <b>Servidor web: n√∫mero</b> <br>  Nginx: 31752 <br>  Apache: 4042 <br>  IIS: 959 <br><br>  Instalaciones desactualizadas y potencialmente vulnerables de Nginx: 20966 <br>  Instalaciones obsoletas y potencialmente vulnerables de Apache: 995 <br><br>  A pesar de que hoster.by es el l√≠der en dominios y hosting, por ejemplo, en general, Open Contact tambi√©n se distingui√≥, pero la verdad est√° en la cantidad de sitios en una IP: <br><br><img src="https://habrastorage.org/webt/mq/gu/wj/mqguwjm8_1ggvfo_o5vam20tjto.png"><br><br>  <b>IP - Sitios</b> <br>  93.84.119.243: 556 <br>  93.125.99.83: 399 <br>  193.232.92.25: 386 <br><br><img src="https://habrastorage.org/webt/h0/us/nk/h0usnka_tsv0yqqa5jb8vd5wy_k.png"><br><br>  Por correo electr√≥nico, las estad√≠sticas detalladas realmente decidieron no ser extra√≠das, no ordenadas por la zona de dominio, m√°s bien, fue interesante ver la ubicaci√≥n de los usuarios a proveedores espec√≠ficos: <br><br><ul><li>  En el servicio TUT.BY: 38282 </li><li>  En el servicio Yandex (por | ru): 28127 </li><li>  En el servicio de Gmail: 33452 </li><li>  Atado a Facebook: 866 </li><li>  Atado a Twitter: 652 </li><li>  Destacado en fugas seg√∫n HIBP: 7844 </li><li>  La inteligencia pasiva ayud√≥ a identificar m√°s de 13 mil direcciones de correo electr√≥nico. </li></ul><br>  Como puede ver, la imagen general es bastante positiva, especialmente el uso activo de nginx por parte de los proveedores de alojamiento.  Quiz√°s esto se deba en gran parte a la popularidad entre los usuarios comunes: el tipo de alojamiento compartido. <br><br>  Por el hecho de que realmente no me gust√≥, hay un n√∫mero suficiente de proveedores de hosting de la mano media que han notado errores como AXFR, han usado versiones desactualizadas de SSH y Apache y algunos otros problemas menores.  Aqu√≠, por supuesto, la fase activa podr√≠a arrojar m√°s luz sobre la situaci√≥n, pero en este momento, en virtud de nuestra legislaci√≥n, me parece imposible, y realmente no me gustar√≠a alistarme en las filas de plagas para tales asuntos. <br><br>  La imagen del correo electr√≥nico es generalmente bastante rosada, si puede llamarlo as√≠.  Ah, s√≠, donde se indica el proveedor TUT.BY, esto significaba usar el dominio, porque  Este servicio funciona sobre la base de Yandex. <br><br><h2>  Conclusi√≥n </h2><br>  Como conclusi√≥n, puedo decir una cosa: incluso con los resultados disponibles, puede comprender r√°pidamente que hay una gran cantidad de trabajo para los especialistas que est√°n involucrados en la limpieza de sitios de virus, la configuraci√≥n de WAF y la configuraci√≥n / adici√≥n de diferentes CMS. <br><br>  Bueno, en serio, como en los dos art√≠culos anteriores, vemos que existen problemas en niveles absolutamente diferentes en absolutamente todos los segmentos de Internet y pa√≠ses, y algunos de ellos incluso realizan un estudio remoto del problema, sin utilizar m√©todos ofensivos, etc. e.  utilizando informaci√≥n disponible p√∫blicamente para recopilar qu√© habilidades especiales no se requieren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446022/">https://habr.com/ru/post/446022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445992/index.html">Nauchpop como m√≠nimo: ilusiones √≥pticas</a></li>
<li><a href="../445998/index.html">C√≥mo hacer amigos Progress OpenEdge y Oracle DBMS</a></li>
<li><a href="../446000/index.html">¬øQu√© le pasa a Yandex.Music? An√°lisis UX / UI</a></li>
<li><a href="../446006/index.html">Intel - suena nuevo</a></li>
<li><a href="../446008/index.html">Herramienta de c√≥digo abierto para la validaci√≥n de calidad de b√∫squeda basada en la intenci√≥n</a></li>
<li><a href="../446024/index.html">Instalar y configurar un nodo Ripple</a></li>
<li><a href="../446026/index.html">¬øPor qu√© SvelteJS es posiblemente el mejor marco para nuevos desarrolladores web?</a></li>
<li><a href="../446028/index.html">Bloques de construcci√≥n de aplicaciones distribuidas. Aproximaci√≥n cero</a></li>
<li><a href="../446030/index.html">Startups en el campo de la biotecnolog√≠a antienvejecimiento, que ser√°n relevantes en 2019</a></li>
<li><a href="../446032/index.html">Zoom de video 1080P a 4K, o C√≥mo aprend√≠ a no preocuparme y me encant√≥ el exclusivo uso de redes neuronales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>