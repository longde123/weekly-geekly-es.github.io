<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💀 🧕🏼 🕳️ React应用程序的分析和优化 👻 🈂️ 👩‍👩‍👧‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="像我这样为高性能网站而奋斗的人经常在此上花费很多时间。 因此，现在我将一劳永逸地解决其接口是用React编写的低速Web资源的问题。 也就是说，我建议阅读此书的每个人今天都应该停止使用React。 

  

 材料的作者，我们今天出版的翻译，当然是在开玩笑。 在这里，我们将讨论如何优化React应...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>React应用程序的分析和优化</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/442650/"> 像我这样为高性能网站而奋斗的人经常在此上花费很多时间。 因此，现在我将一劳永逸地解决其接口是用React编写的低速Web资源的问题。 也就是说，我建议阅读此书的每个人今天都应该停止使用React。 <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/m0/ji/2l/m0ji2ls0tz9mjrwiegrnz2kbg3s.png"></a> <br><br> 材料的作者，我们今天出版的翻译，当然是在开玩笑。 在这里，我们将讨论如何优化React应用程序的性能。 顺便说一下，在开始之前，让我们考虑一下为什么通常需要网站优化。 也许可以说，与优化之前相比，有更多的人可以使用该网站。 <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">引言</font> </h2><br> 如何优化网站？ 您如何评估优化对站点用户的好处？ 以及为什么您需要考虑这些指标？ <br><br> 我们将尝试通过使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">create-react-app</a> （CRA） <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具</a>来查看创建React应用程序的最简单方法，以回答这些问题。 使用此工具创建的新项目具有以下依赖性： <br><br><ul><li>主要的React库，它允许您使用React组件：2.5 Kb。 </li><li>  <code>react-dom</code>库允许将组件显示在页面上，并将它们转换为适合插入DOM树的结构：30.7 Kb。 </li><li> 少量代码，其中包括第一个组件的模板：大约3 Kb。 </li></ul><br> 此数据是从React 16.6.3获得的。 <br><br> 为了确定在Moto G4手机上下载新的CRA应用程序将花费多长时间，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WebPageTest</a>服务。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75f/096/280/75f096280533f0b9e45c15cce831265f.png"></div><br>  <i><font color="#999999">使用不同的网络在Moto G4上的网站加载时间</font></i> <br><br> 此应用程序是“ Hello，World”的变体，托管在Firebase托管上，正在研究使用三种类型的连接将其加载到Chrome浏览器中： <br><br><ul><li>  4G（9 Mbps） </li><li>  3G（1.6 Mbps） </li><li> 慢速3G连接（400 Kbps） </li></ul><br> 在这里，您需要考虑网络延迟。 <br><br> 为什么在实验中使用Moto G4？ 这是一款简单的廉价电话，类似于发展中国家许多人使用的基本设备形式的电话。 在4G网络上，应用程序在2秒内加载完毕。 在速度较慢的3G网络中，页面在线花费了超过4秒的时间。 <br><br> 尽管这些指标非常有趣，但是如果您不知道用户是谁，它们就不是特别有用。 您所定义的“慢”可能与我或其他人认为“慢”的完全不同。 使用的设备和网络连接可能会扭曲您对网站“快速”加载的看法。 如果在此实验中包括台式计算机，该台式计算机通过有线连接连接到Internet，则可以看到“快速”和“慢速”加载站点之间的巨大区别。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/835/6eb/cfd8356ebf46c554a552415775339fbc.png"></div><br>  <i><font color="#999999">在台式机和Moto G4上的网站加载时间</font></i> <br><br> 为了提高使用React库构建的React应用程序的性能，正如他们所说的那样，它们是现成的，概述了React DOM的改进，旨在简化某些事情。 因此，事件系统包含许多polyfill，对于许多新的浏览器而言，这些不需要，并且开发团队正在考虑选择删除或简化它们的选项。 您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a>观看。 <br><br><h2>  <font color="#3AC1EF">我可以衡量当前的网站性能水平吗？</font> </h2><br> 一个典型的React应用程序可以包含许多第三方组件和库。 这意味着“ Hello，World”应用程序的性能不能为我们提供有关实际应用程序如何加载的特别有价值的信息。 有没有办法找出使用某些技术（例如React）构建的大多数站点的高性能？ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://">HTTP存档</a>资源可以帮助我们回答这个问题。 这是一个开放源代码平台，专注于观察Web的构建方式。 这是通过每月爬网数百万个站点，使用WebPageTest分析它们并记录有关它们的信息来完成的。 该信息包括查询的数量，有关数据加载的度量，传输的数据的大小以及其他指示符。 <br><br> 这是另一个有趣的工具-Chrome的扩展程序，称为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Library-Detector-for-Chrome</a> 。 它使您能够确定页面上使用了哪些JavaScript库。 最近，它已被<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">包含</a>在Lighthouse中作为页面审核工具。 这表明可以为许多站点（其信息存储在HTTP存档中）获取此扩展提供的信息。 这可以帮助那些想要分析使用特定JavaScript库的数千个站点的测试结果的人（确定React的机制<a href="">在此处</a> ）。 <br><br> 完整的HTTP Archive数据集是公开可用的，可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BigQuery</a>上找到。 在使用React研究了140,000个站点并将其加载到人工模拟的移动环境中之后（数据集<code>2019_01_01</code> ），我们设法找到了以下内容： <br><br><ul><li>  “第一个有意义的绘制”指示器的中位数（第一个有效显示，绘制重要元素的时间）为6.9 s。 </li><li> 互动时间指示器的中位数（互动时间，互动元素的加载时间）为19.7 s。 </li></ul><br> 您可以自己<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">浏览</a>这些数据。 <br><br> 用户开始与该站点进行交互大约需要20秒钟。 总的来说，这似乎正在发生，尽管现在看来似乎难以置信。 在大型站点上，通过慢速通信线路上的弱设备与它们合作时，可以看到这一点。 另外，现在我想提出几个理由，为什么应该对这些数据表示怀疑。 <br><br><ul><li> 有许多因素会影响站点性能。 其中包括-发送给用户的JavaScript代码数量，页面上显示的图像和其他资料的数量，等等。 如果不考虑其他因素，它将错误地将任何基于React的站点的性能与标记为“ Hello，World”的页面的性能进行比较。 </li><li> 如果您尝试通过替换React请求中其他某个库的名称来获取数据，则会得到非常相似的数字。 </li></ul><br> 为了获得有关使用某种库实际演示的站点性能的准确数据，需要完成许多工作。 <br><br><h2>  <font color="#3AC1EF">JavaScript代码增长</font> </h2><br> 现代网站的常见问题（不限于特定的库）与客户端浏览时通常必须加载的JavaScript代码量有关。  HTTP存档已经对此做了很好的说明。 简而言之，以下是从不同年份从网站下载的JavaScript量的中位数： <br><br><ul><li>  74.7 Kb-移动网页，2011年12月15日。 </li><li>  384.4 Kb-移动网页，2018年12月15日。 </li></ul><br> 应该记住的是，该数据是在处理数百万页后获得的。 可能有成千上万的非典型站点使该指标失真。 这是一个可行的想法。 因此，我们将尝试找出该指标如何查找Alexa排名中的前10,000个网站： <br><br><ul><li>  381.5 Kb-移动网页，2018年12月15日（此处是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请求</a> ）。 </li></ul><br> 所有这些使我们得出的结论是，如今创建的网站比几年前创建的网站包含更多的JS代码。 这是一个重要的观察。 网站的规模越来越大，它们的互动性和复杂性也越来越高，并且这些网站的JS代码的数量每年都在逐渐增长。 您可能已经听说过这一点，但是发送给浏览器的JavaScript代码越多，解析，编译和执行它所花费的时间就越多。 结果，这使站点变慢。 <br><br> 重要的是要注意，每个站点以及每个站点的用户群都是唯一的。 许多开发人员的站点包含超过300 KB的JS代码，他们没有面对大多数用户都遇到性能问题的事实，这是完全正常的。 但是，如果您担心用户可能难以查看您的React网站，为了评估实际情况，最好从分析开始。 <br><br><h2>  <font color="#3AC1EF">页面分析和分析</font> </h2><br> 可以从两个角度查看分析和分析React应用程序： <br><br><ul><li> 首先，它是关于评估组件的性能。 这会影响用户与网站的交互方式。 例如，如果通过单击按钮显示列表，则应快速完成此操作，但如果在此操作过程中重新渲染了数百个组件，即使没有必要，则该操作将被认为很慢。 </li><li> 其次，我们正在讨论应用程序要多久才能进入工作状态。 也就是说，在开始加载网站后有多少时间，用户将能够与他进行交互。 在网站首页加载期间发送给用户的代码量是影响用户可以开始使用应用程序的速度的一个因素示例。 </li></ul><br><h2>  <font color="#3AC1EF">性能评估和组件优化</font> </h2><br> 让我们尝试用一句话来表达React对帐算法的含义，或所谓的“虚拟DOM”的本质。 它看起来像这样：“ React采取步骤在新的DOM树和旧的树之间进行区分，以便了解当组件中的数据发生更改时应在用户界面中准确更新的内容。” 与每次状态或属性更改时重新呈现整个应用程序相比，这给系统带来的负载要小得多（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a>您可以了解O（n <sup>3</sup> ）和O（n）之间的差异）。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这是</a> Dan Abramov的文章，您可以在其中找到有关和解的说明。 <br><br> 即使考虑到这些优化都已内置在React的内部机制中这一事实，当应用程序中的组件在不应该发生的情况下重复呈现时，总会遇到问题。 在小型应用程序中，这可能不会引起注意，但会严重影响在页面上显示数百个组件的应用程序的性能。 <br><br> 出于许多原因，进行了不必要的组件重新渲染。 例如，在组件内部工作的功能可能没有达到预期的效果，或者当仅将一个新元素添加到此列表时，可能会重绘整个组件列表。 您可以使用一些工具来找出哪些组件树已经渲染太长时间了。 其中，应注意以下几点： <br><br><ul><li>  Chrome开发者工具仪表板。 </li><li>  React开发人员工具探查器。 </li></ul><br><h3>  <font color="#3AC1EF">using使用Chrome Developer Tools性能面板进行性能分析</font> </h3><br>  React使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用户计时API</a>来衡量组件生命周期每一步所花费的时间。 可以使用Chrome开发者工具收集和分析React应用程序的性能信息。 这使您能够了解在用户与页面交互或重新加载组件时，组件在页面上的连接，显示和断开的效率如何。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc1/1d6/849/fc11d68496f548bc496bf5be55313d45.png"></div><br>  <i><font color="#999999">组件性能分析</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这是</a>有关此主题的一些很好的资料，致力于研究使用Chrome开发人员工具使用React 16编写的应用程序的性能。 <br><br> 用户计时API仅在开发期间使用。 生产中将其关闭。 在这种情况下，可以使用这种机制的更快实现，而不会严重影响性能。 对这种机制的需求成为开发较新的API Profiler的原因之一。 <br><br><h3>  <font color="#3AC1EF">using使用React开发人员工具中的事件探查器进行性能分析</font> </h3><br> 随着React开发人员工具中<code>react-dom</code> 16.5库的发布，可以使用一个名为Profiler的新面板。 它使您可以分析组件渲染的性能。 这是使用Profiler API完成的，该API收集有关重新渲染的所有组件的操作执行时间的信息。 <br><br>  Profiler面板是React开发人员<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具中</a>的独立选项卡。 在这里，与“ Chrome开发者工具”工具栏的“性能”面板一样，您可以记录有关用户操作和页面重新加载的信息，以收集用于分析组件性能的数据。 <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="https://houssein.me/assets/progressive-react/fetch-profiler.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="#999999">使用React Developer Tools收集数据</font></i> <br><br> 数据收集完成后，将显示所谓的“火热图”，显示在页面上呈现组件所需的时间。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc0/7fc/f3f/fc07fcf3f6199121dfebadb8d6786af1.png"></div><br>  <i><font color="#999999">火焰分析器时间表</font></i> <br><br> 在这里，您可以在添加，删除或更新DOM节点时在不同的提交或状态之间进行切换。 这使您可以获得有关在组件的各种操作上花费了多少时间的更多信息。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aec/a31/45a/aeca3145a4b8ce2ab3e03a428deca840.png"></div><br>  <i><font color="#999999">在事件探查器中查看提交信息</font></i> <br><br> 此处显示的屏幕快照表示通过记录在简单应用程序中执行的用户操作而获得的数据。 单击按钮后，该应用程序将下载趋势GitHub存储库的列表。 如您所见，这里只有两个提交： <br><br><ul><li> 一个是用于加载指示符，在加载项目列表时显示。 </li><li> 另一个表示对API的调用完成且列表显示在DOM中的时刻。 </li></ul><br> 右侧的图显示了有用的元数据，其中包括提交信息或组件数据，例如属性和状态。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/757/ddd/227/757ddd22779bd83b3f1b05cc95dbf58e.png"></div><br>  <i><font color="#999999">元数据</font></i> <br><br> 使用React Profiler时，您还可以查看由各种图形表示的其他数据。 您可以从React博客的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这篇</a>文章中了解有关React Profiler的更多信息。 <br><br> 为了使我们的示例复杂一点，请考虑类似的情况，但是现在我们将执行许多API调用，以使用不同的编程语言（例如Golang，JavaScript等）下载趋向于存储库。 如您所料，采用这种方法，我们可以处理更多的事务。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15b/224/7a7/15b2247a76e2bb127a4068ca31345431.png"></div><br>  <i><font color="#999999">增加提交次数，同时使应用程序的使用方案复杂化</font></i> <br><br> 以后的提交以更长的时间表为特色，它们的颜色更多。 这意味着随着页面上元素列表的大小增加，所有组件完成渲染所需的时间也增加。 这是由于以下事实：列表中的每个组件都会随着对API的每次新调用而重新呈现。 这有助于确定可以很容易解决的问题。 解决方案是，将新项目添加到列表时，无需再次呈现列表中的项目。 <br><br><h3>  <font color="#3AC1EF">▍尽量减少不必要的组件重新渲染操作</font> </h3><br> 有很多方法可以消除不必要的操作来重新渲染React组件，或者至少可以减少此类操作的数量。 让我们考虑其中的一些。 <br><br><ul><li> 您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">shouldComponentUpdate（）</a>的组件生命周期方法： <br><br><pre> <code class="plaintext hljs">shouldComponentUpdate(nextProps, nextState) { // true        }</code> </pre> </li><li> 您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PureComponent</a>构造基于类的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">组件</a> ： <br><br><pre> <code class="plaintext hljs">import React, { PureComponent } from 'react'; class AvatarComponent extends PureComponent { }</code> </pre> </li><li> 对于功能组件，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">memo</a> ： <br><br><pre> <code class="plaintext hljs">import React, { memo } from 'react'; const AvatarComponent = memo(props =&gt; { });</code> </pre> </li><li> 您可以记住Redux选择器（例如，使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">reselect</a> ）。 </li><li> 您可以使用虚拟化（例如，使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">react-window</a> ）来优化很长列表的输出。 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">那里</a> -几个有用的视频，讨论了使用React Profiler查找应用程序瓶颈的方法。 <br><br><h2>  <font color="#3AC1EF">性能评估和应用优化</font> </h2><br> 除了分析DOM突变和组件重新渲染操作外，还有其他更高层次的现象值得探索。 要全面评估站点性能，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lighthouse</a> 。 <br><br> 使用Lighthouse可以通过三种方法来测试网页： <br><br><ul><li> 使用Node.js命令行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">界面</a> </li><li> 使用Chrome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">扩展程序</a> 。 </li><li> 使用Chrome开发者工具的“审核”工具栏。 </li></ul><br> 这是“审计”面板中Lighthouse的外观。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e2/80f/349/7e280f349065be85c3f2590c773bcaaf.png"></div><br>  <i><font color="#999999">审核面板上的灯塔</font></i> <br><br>  Lighthouse通常不需要大量时间从页面收集他需要的所有数据并对该数据执行许多检查。 这些操作完成后，Lighthouse将显示一个包含摘要信息的报告。 <br><br> 为了了解将页面加载到浏览器中会涉及到加载太多的JavaScript代码，并得出减少该代码量的结论，您需要注意报告中的以下短语： <br><br><ul><li> 消除渲染阻止资源 </li><li>  JavaScript启动时间太长 </li><li> 避免大量的网络负载 </li></ul><br> 如果Lighthouse因为页面使用了太大的JS捆绑软件而报告了这些问题，则作为解决问题的一种方法，首先值得考虑的是拆分捆绑软件。 事实是，如果可以将代码分为多个片段，而某些片段仅在处理网站的某些页面时才需要，那么我们没有理由不使用此机会。 <br><br><h3>  <font color="#3AC1EF">▍JS包分离</font> </h3><br> 将代码分成几部分的一种方法是使用动态导入： <br><br><pre> <code class="plaintext hljs">  import('lodash.sortby')   .then(module =&gt; module.default)   .then(module =&gt; doSomethingCool(module))</code> </pre> <br> 导入语法看起来像一个函数调用，但是它允许您使用promises机制异步导入任何模块。 在此示例中，首先从<code>lodash</code>库中导入<code>sortby</code>方法，然后执行<code>doSomethingCool()</code>方法。 <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="https://houssein.me/assets/progressive-react/magic-sorter.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="#999999">申请号码排序</font></i> <br><br> 在此的示例发生以下情况： <br><br><ol><li> 用户单击按钮以对三个数字进行排序。 </li><li> 导入<code>lodash.sortby</code> 。 </li><li>  <code>doSomethingCool()</code>方法，该方法对数字进行排序并将其显示在新的DOM节点中。 </li></ol><br> 这是一个非常简单的人工示例，因为如果某人需要对网页上的数字进行排序，那么他可能只会使用<code>Array.prototype.sort()</code>方法。   ,       ,            . <br><br>      ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>     JavaScript  TC39.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Chrome   Safari</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Webpack</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rollup</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Parcel</a> . <br>    React,    ,              .       — <code>React.lazy</code> : <br><br><pre> <code class="plaintext hljs">import React, { lazy } from 'react'; const AvatarComponent = lazy(() =&gt; import('./AvatarComponent'));</code> </pre> <br>    ,       ,       ,     .     <code>Suspense</code> ,      ,  «»      .      <code>React.lazy</code> , ,       ,    : <br><br><pre> <code class="plaintext hljs">import React, { lazy, Suspense } from 'react'; import LoadingComponent from './LoadingComponent'; const AvatarComponent = lazy(() =&gt; import('./AvatarComponent')); const PageComponent = () =&gt; ( &lt;Suspense fallback={LoadingComponent}&gt;   &lt;SomeComponent /&gt; &lt;/Suspense&gt; )</code> </pre> <br>  <code>Suspense</code>        .         React-,    , ,  ,    React,   <code>loadable-components</code> . <br><br><pre> <code class="plaintext hljs">import React from 'react'; import loadable from '@loadable/component' import LoadingComponent from './LoadingComponent'; const AvatarComponent = loadable(() =&gt; import('./AvatarComponent'), {   LoadingComponent: () =&gt; LoadingComponent });</code> </pre> <br> <code>LoadingComponent</code>     <code>loadable-component</code>       . <br><br>    ,   ,    <code>loadable-components</code>   ,  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br><br>   ,         . ,    ,   .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> React    ,        React  <code>Suspense</code> . <br><br><h3> <font color="#3AC1EF">▍    ,     ?</font> </h3><br>        , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">react-loadable-visibility</a> ,      <code>loadable-components</code>  -API Intersection Observer.         ,       . <br><br><pre> <code class="plaintext hljs">import React from 'react'; import loadableVisibility from 'react-loadable-visibility/loadable-components' const AvatarComponent = loadableVisibility(() =&gt; import('./AvatarComponent'), { LoadingComponent: Loading, })</code> </pre> <br><h3> <font color="#3AC1EF">▍  ,   </font> </h3><br> - —  -,         .   -   ,      ,             .     ,    ,      ,    -,   -,    ,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4d/c1f/7e8/c4dc1f7e82e82d722c9ef66a0f0f1fb3.png"></div><br> <i><font color="#999999">      <br></font> <br><br> Workbox</i> —   ,      -,          .   CRA 2.0  ,    ,        <code>src/index.js</code> .       -     . <br><br><pre> <code class="plaintext hljs">  import React from 'react'; //... //   ,          //    ,     // unregister()  register().    ,     - //    . //     : http://bit.ly/CRA-PWA serviceWorker.unregister();</code> </pre> <br>   -    <code>Workbox</code>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br><br><h3> <font color="#3AC1EF">▍     </font> </h3><br>      -              HTML-,   ,   ,            .    ,        ,    ,  ,   ,     JS-,      . <br><br>        ,       ,    DOM-,   ,  ,     (,    <code>hydrate()</code>  React).    ,    ,     ,   ,       . <br><br>   React 16,          .      <code>renderToString()</code>   HTML-,    <code>renderToNodeStream()</code>   Readable- Node. <br><br>               HTML-  ,     .      ,        ,        . <br><br>    React    , ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">renderToStaticNodeStream</a> . <br><br><h3> <font color="#3AC1EF">▍     ,    </font> </h3><br>      - ,      ,    ,     ,  -  ,   ,        .       ,      ,   . <br><br>  ,   ,                ,     .      HTML-              ,        . <br><br>         ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">react-snap</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Puppeteer</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  ,      . <br><br><h3> <font color="#3AC1EF">▍   ,    CSS-in-JS</font> </h3><br>  React-,   ,  CSS-in-JS-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">emotion</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">styled-components</a> .        ,     ,   ,   ,  ,  .     CSS-in-JS    ,    ,    ,         .  ,       ,  JavaScript-   ,    ,         .        ,  ,      ,             . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c41/d5e/e75/c41d5ee755948040cd9b584d7f7b523c.png"></div><br> <i><font color="#999999">,          ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> )</font></i> <br><br>       -   ,           .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">emotion</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">styled-components</a>   .     Readable- Node.  Glamor   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> ,      . <br><br>         ,         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/760/d03/d3a/760d03d3a1f5dba72a2845c8b5e50dfc.png"></div><br> <i><font color="#999999">  Preact-,          ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> )</font></i> <br><br>  ,      CSS-in-JS —   ,     ,         ,    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">astroturf</a> .  ,     ,      ,           ,             . <br><br><h3> <font color="#3AC1EF">▍ </font> </h3><br>     «»,  ,                   .           ,  ,      . <br><br>         ,   Lighthouse.   ,   React-,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">React A11y</a> . <br><br>  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">react-axe</a>    ,  ,     JSX-. <br><br><h3> <font color="#3AC1EF">▍       </font> </h3><br>        ?     -,    ,         ?      ,                ? <br><br>        ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> -</a> .           «»    .     ,    —  ,     . <br><br>   create-react-app        -: <br><br><pre> <code class="plaintext hljs">{ "short_name": "React App", "name": "Create React App Sample", "icons": [   {     "src": "favicon.ico",     "sizes": "64x64 32x32 24x24 16x16",     "type": "image/x-icon"   } ], "start_url": ".", "display": "standalone", "theme_color": "#000000", "background_color": "#ffffff" }</code> </pre> <br><h2> <font color="#3AC1EF"></font> </h2><br>   ,      .  ,  ,      .      —  . 为什么会这样呢？   ,      ,                . <br><br><h3> <font color="#3AC1EF">▍Atomic CSS</font> </h3><br>    CSS- (Atomic CSS)   ,        . ,        ,     : <br><br><pre> <code class="plaintext hljs">&lt;button class="bg-blue"&gt;Click Me&lt;/button&gt;</code> </pre> <br>        <code>padding</code> : <br><br><pre> <code class="plaintext hljs">&lt;button class="bg-blue pa2"&gt;Click Me&lt;/button&gt;</code> </pre> <br> 依此类推。             <code>class</code>   DOM,   ,   ,       CSS-,  .      ,     .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Tachyons</a> . <br><br>                .    <code>tachyon-components</code>        API,   API <code>styled-components</code> : <br><br><pre> <code class="plaintext hljs">import styled from 'tachyons-components' const Button = styled('button')` bg-blue pa2 ` &lt;Button&gt;Click Me&lt;/Button&gt;</code> </pre> <br>        ,          ,      CSS-     «»  ,   CSS-,   ,    . <br><br><h3> <font color="#3AC1EF">▍</font> </h3><br>         ,         ,   .     —     : <br><br><pre> <code class="plaintext hljs">import { useState } from 'react'; function AvatarComponent() { const [name, setName] = useState('Houssein'); return (   &lt;React.Fragment&gt;     &lt;div&gt;       &lt;p&gt;This is a picture of {name}&lt;/p&gt;       &lt;img align="center" src="avatar.png" /&gt;     &lt;/div&gt;     &lt;button onClick={() =&gt; setName('a banana')}&gt;       Fix name     &lt;/button&gt;   &lt;/React.Fragment&gt; ); }</code> </pre> <br>       : <br><br><ul><li>       ,    ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">useState</a> ). </li><li>        ,    ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">useEffect</a> ). </li><li>              . </li></ul><br>       ,         .     ,      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">recompose</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>    React Conf,         . <br><br>             ,  ,            JavaScript- .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  ,      React      ,     1.5  (   ).   ,        - ,  ,    , ,  ,    ,   ,  . <br><br><h2>  <font color="#3AC1EF">总结</font> </h2><br>     ,    React-.      ,    ,      : <br><br><ol><li>    ,     : <br><br><ul><li>  Performance   Chrome. </li><li>    React. </li></ul></li><li>        <br><br><ul><li> ,   ,      <code>shouldComponentUpdate()</code> . </li><li>  ,   ,  <code>PureComponent</code> . </li><li>     <code>React.memo</code> . </li><li>     Redux (,   <code>reselect</code> ). </li><li>         (,   <code>react-window</code> ). </li></ul></li><li>       Lighthouse. </li><li>    ,     : <br><br><ul><li>       —        <code>React.lazy</code> . </li><li>      —        <code>loadable-components</code> . </li><li>  -   ,   .       <code>Workbox</code> . </li><li>      —     (  <code>renderToNodeStream</code>  <code>renderToStaticNodeStream</code> ). </li><li>     ?         <code>react-snap</code> . </li><li>       ,     CSS-in-JS. </li><li>   ,            .     <code>React A11y</code>  <code>react-axe</code> . </li><li>     -   ,  ,        ,       . </li></ul></li></ol><br>   ,  React,   ,      : <br><br><ul><li>   API,    ,   . </li><li>    , ,  ,   . </li></ul><br>  «  »     .      -,         . <br><br>  <b>亲爱的读者们！</b>     React-? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442650/">https://habr.com/ru/post/zh-CN442650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN442640/index.html">完美的错误：在Flash中使用类型混淆。 第一部分</a></li>
<li><a href="../zh-CN442642/index.html">三月份阅读内容：针对营销人员，管理人员，开发人员和设计师的22本新书</a></li>
<li><a href="../zh-CN442644/index.html">大多数非编程技能可提高开发人员价值</a></li>
<li><a href="../zh-CN442646/index.html">Kubernetes网络：入口</a></li>
<li><a href="../zh-CN442648/index.html">去分配机制</a></li>
<li><a href="../zh-CN442652/index.html">使用Fastify和Preact快速原型化Web应用程序</a></li>
<li><a href="../zh-CN442654/index.html">切换到Next.js并加快歧管网站首页的加载7.5倍</a></li>
<li><a href="../zh-CN442658/index.html">使用CSS的8个技巧：视差，粘页脚等</a></li>
<li><a href="../zh-CN442660/index.html">调和牛顿与量子世界的数学</a></li>
<li><a href="../zh-CN442662/index.html">如何观看SDDL而不看分号</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>