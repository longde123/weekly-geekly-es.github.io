<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüé§ üëí ü§µüèΩ Anatomie und Klonen des USB-Adapters f√ºr die SD-Karte ‚ùì üë©üèæ‚Äçüéì ü§ôüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... oder wie Sie Ihr DIY-Projekt mit MIPS oder leichtem ARM mit einer schnellen Micro-SD-Karte versorgen. 
 Guten Tag an alle angesehenen Communitys. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anatomie und Klonen des USB-Adapters f√ºr die SD-Karte</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403199/"><div style="text-align:center;"><img src="https://habrastorage.org/files/f54/e21/451/f54e21451bfa4ed38bb087e1641cdf12.jpg"></div><br>  ... oder wie Sie Ihr DIY-Projekt mit MIPS oder leichtem ARM mit einer schnellen Micro-SD-Karte versorgen. <br>  Guten Tag an alle angesehenen Communitys.  Ich m√∂chte meine Geschichte √ºber das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Box-Ger√§t fortsetzen</a> , n√§mlich dar√ºber, wie sie es geschafft hat, eine Micro-SD-Karte an den USB 2-Anschluss anzuschlie√üen. <br><a name="habracut"></a><br>  Die Wurzel des gesamten Problems war, dass USB 2 und nicht nur eines sein Prozessormodul hat, sondern leider kein QSPI (QuadSPI) oder eine Kartenschnittstelle.  Wie h√§ngt diese traurige Tatsache mit SD-Karten zusammen?  Sehr einfach, jede SD-Karte in der physischen Basis ihrer Verbindung verf√ºgt √ºber eine SPI-Schnittstelle (SerialPeripheral).  Das klassische SPI verwendet eine physische Leitung zum Senden und Empfangen von seriellen Daten.  Einfach und wirtschaftlich, sowohl in Geld als auch in Milliampere.  Wie Sie wissen, sind die Nachteile jedoch eine Fortsetzung der Vorteile, und f√ºr SPI wurden sie in erster Linie zu einem relativ niedrigen Datenaustauschkurs.  Um dieses Problem zu l√∂sen, wurde ein Vier-Bit-Datenaustauschmodus mit einer SD-Karte erfunden, der ein enger Verwandter des QSPI-Protokolls ist.  Wenn Sie diesen Modus verwenden, vereinbaren der Host-Controller und die Karte zuerst die Austauschparameter im Einzelbitmodus und wechseln dann in den Vierbitmodus, wenn sie nicht eine Leitung zum Empfangen und Senden verwenden, sondern vier f√ºr alles (plus eine weitere zum Anzeigen des Befehls). <br><br>  Was tun, wenn das Ger√§t das Vier-Bit-Protokoll nicht direkt unterst√ºtzt, aber dennoch einen schnellen Austausch ben√∂tigt?  Die offensichtliche Antwort besteht darin, dem Projekt eine Br√ºcke mit ‚Äûschneller Schnittstelle‚Äú zur Verf√ºgung zu stellen - eine ‚ÄûVier-Bit-SD-Karte‚Äú. <br><br>  Um dieses Problem zu l√∂sen, wurden einige USB-SD-Adapter gekauft und vorbereitet (Vivisektion wurde nicht verwendet - wir sind keine Monster).  Vor dem Aufw√§rmen des L√∂tkolbens und des Haartrockners wurde eine sehr wichtige √úberpr√ºfung durchgef√ºhrt, um festzustellen, ob das Debian-Prozessormodul die ihm angebotene Adapterpfeife sieht.  Der Test war ein gro√üer Erfolg, willkommen im Operationssaal.  Die gekaufte Pfeife sieht folgenderma√üen aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/899/740/5e7/8997405e7cdc4981aac38d2aad8b1c35.jpg"></div><br>  Und so: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a70/962/4bf/a709624bf49a44a1ac3ab97c63049c1c.jpg"></div><br>  Nach dem Zerlegen des Geh√§uses konnte die Leiterplatte (von allen beiden Seiten) erkannt werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/140/a2f/164/140a2f16457b41a6be2902e9dca08a5d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2d9/48f/33d/2d948f33d59f4afc8fff7b97ebcb5a7e.png"></div><br>  Die Schaltung ist einfach, ihre Basis ist der IC GL823F - ein Mikrocontroller mit einem 8051-Befehlssystem und einem Maskenspeicher, ausgestattet mit einer USB 2-Hardwareschnittstelleneinheit, anscheinend nicht von sehr hoher Qualit√§t (warum ich das sage - ich sehe den genauen Vorspannungswiderstand des analogen Teils und des Quarzoszillators nicht Dies bedeutet, dass die Frequenz aus dem empfangenen Signal basierend auf dem internen kalibrierten Generator wiederhergestellt wird.  Wird funktionieren, aber nicht HiFi, nein.  Alles andere ist ein minimales Bodykit: Blockierkondensatoren, Pull-up- und Strombegrenzungswiderst√§nde, LEDs und Steckverbinder - das ist alles Technik. <br><br>  Wir blasen die Komponenten mit einem Haartrockner ab und untersuchen die Leiterplatte.  In vielerlei Hinsicht ist die Platte doppelseitig mit Beschichtungsl√∂chern versehen.  Nach einer kurzen Untersuchung der Platine in einem Mikroskop, Skizzieren des Anschlussdiagramms und Vergleich mit dem Datenblatt der GL-bezogenen ICs stellen wir den Schaltplan wieder her. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d96/74e/a6e/d9674ea6ed584e8aa5566554642f4f18.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/454/79e/797/45479e797ffd47a5966944d5a3e4b88d.jpg"></div><br>  Und hier fangen wir jetzt an, einen kleinen √Ñrger zu sehen.  Was genau?  Unsere Box wird mit einer garantierten Spannung von 3,3 V betrieben, und der Stromkreis des GL823 ben√∂tigt 5 Volt.  Nun, je nach Bedarf - sie ist so daran gew√∂hnt, weil USB ihr so ‚Äã‚Äãviel gibt.  Micro SD selbst wird mit 3,3 V betrieben, daher wird dem GL823 der integrierte LDO-Stabilisator hinzugef√ºgt.  Daher die Frage - und wenn der Stromkreis mit 3,3 V betrieben wird, kann er funktionieren?  Wenn es LDO gelingt, nicht zu viel Spannung abzusenken, kann dies, aber nicht alle LDOs sind gleicherma√üen n√ºtzlich.  Das Datenblatt gibt einen kleinen Hinweis - die Ausgabe, die die SD-Karte speist, hei√üt PMOS.  Diese Abk√ºrzung kann sich nur freuen - es kann angenommen werden, dass das HighSide-PMOS-Schema verwendet wird, bei dem der Spannungsabfall √ºber dem Steuerelement sehr klein sein kann.  All dies ist jedoch eine Argumentation, und das einzige entscheidende Argument ist die Erfahrung. Er ist der Sohn schwieriger Fehler. <br><br>  Welche Art von Erfahrung werden wir also liefern?  Versuchen wir, den IC mit zwei geschalteten Spannungen zu versorgen - von 5 V USB oder von 3,3 V, die von einem separaten Stabilisator erhalten werden.  Jetzt haben wir genug Wissen, um ein schematisches Diagramm zu zeichnen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fb7/4bc/a0b/fb74bca0b27545c192d85f552f89d9f9.gif"></div><br>  Die Nummerierung der Komponenten auf der Schaltung ist etwas seltsam, da beim Hersteller der Leiterplatten eine Mehrfachbestellung mit mehreren weiteren Testschaltungen bestellt wurde und alle die Nummerierung der Komponenten durch hatten.  W√§hrend der Vorbereitung des Artikels brachte ich den Schaltplan in √úbereinstimmung mit dem Foto, und es stellte sich heraus, was passiert ist. <br><br>  Was sehen wir im Diagramm?  Der Kern ist eindeutig GL823F.  Der Micro-SD-Anschluss ist offensichtlich damit verbunden.  Das einzige, was beachtet werden sollte - Pin 9 am Anschluss ist der Gleitkontakt der Karte im Steckplatz. Wenn die Karte eingesetzt ist, ist sie mit Masse kurzgeschlossen.  C7-C10 - Sperrkondensatoren in den Stromkreisen.  Wenn Sie die St√∂rfestigkeit geringf√ºgig erh√∂hen m√∂chten, k√∂nnen die Stifte 2 und 16 DD1 √ºber eine Ferritdrossel angeschlossen werden.  R4 begrenzt den Strom durch HL1, R5 zieht die GPIO-Leitung auf eins, wenn keine Karte im Steckplatz vorhanden ist.  DA2, C11 und C12 bilden einen linearen Spannungsregler mit 3,3 V. <br><br>  Da zu dem Zeitpunkt, als die Schaltung gezeichnet wurde, einerseits nicht klar war, wie viel sie verbrauchen w√ºrde, und andererseits eine unangenehme Erfahrung bei der Verwendung einiger USB-Flash-Laufwerke (die nicht mit einem Finger zeigen w√ºrden), die bei der Aufnahme 400 mA verbrauchten, wurde beschlossen, diese hinzuzuf√ºgen R6.  Im Allgemeinen ist dies eine Standardtechnik - mit einem sp√ºrbaren Verbrauch an linearem LDO in der Schaltung (die Schl√ºsselw√∂rter hier sind LowDropout), setzen Sie einen niederohmigen Widerstand mit erh√∂hter Leistung am Eingang und leiten Sie einen Teil der W√§rme darauf und nicht auf den Stabilisator ab.  Die Erfahrung hat jedoch gezeigt, dass R6 nicht ben√∂tigt wird, und Sie werden es immer noch auf dem Foto der Tafel sehen. <br><br>  XS4 wurde nur f√ºr die Durchf√ºhrung eines Experiments entwickelt - Schaltleistung DD1 zwischen 5 und 3,3 Volt.  XS2 ist ein Standard-USBB-Anschluss, mit dem Sie ihn vor sich platzieren und nicht auf freie USB-Anschl√ºsse unter dem Tisch zum PC klettern k√∂nnen. <br><br>  Folgendes geschah nach der R√ºckverfolgung, Herstellung der Software und Installation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f54/e21/451/f54e21451bfa4ed38bb087e1641cdf12.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d3d/efa/490/d3defa4908c8471181c4c5a177f66a5a.jpg"></div><br>  Wie Sie sehen k√∂nnen, ist die Unterseite der Platine v√∂llig unkompliziert und die Oberseite ist nicht viel komplizierter. <br><br>  Ich werde das Ende der Handlung nicht verz√∂gern. Ich werde sofort sagen, dass die Erfahrung gezeigt hat, dass es m√∂glich ist, den GL823F √ºber eine 3,3-V-Quelle mit Strom zu versorgen. Das Umschalten von XS4 hat nur Auswirkungen auf den Stromverbrauch (nicht auf den Strom). <br><br>  Um sicherzustellen, dass die hergestellte Karte ordnungsgem√§√ü funktioniert, haben wir die Aufnahmegeschwindigkeit und den gleichzeitig verbrauchten Strom f√ºr drei verschiedene Micro-SD-Karten gemessen.  Fotokandidaten - im Studio! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5d0/b44/93f/5d0b4493fa7b4383bf2209d97733a56f.jpg"></div><br>  Die Bewertung des Stromverbrauchs (Messung dessen, was getan wurde, meine Zunge kann nicht genannt werden) wurde unter Verwendung eines solchen kombinierten Strom-Spannungs-Batterie-Messger√§ts durchgef√ºhrt.  Ehrlich gesagt stellte sich heraus, dass er auch USB-Daten √ºbertr√§gt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ccb/1ec/e7f/ccb1ece7f12d4f14b50c78a014df4dfc.jpg"></div><br>  Wir haben nur die Angabe des verbrauchten Stroms verwendet, der Teilungspreis f√ºr dieses Instrument betr√§gt sozusagen 0,01 A, plus mindestens ein Abtastfehler von 1 Einheit der niedrigstwertigen Ziffer betr√§gt immer noch 0,01 A.  Daher zeigt die Tabelle nur die Anzeigebereiche, zwischen denen die Zahl des verbrauchten Stroms sprang.  Ich hoffe jedoch, dass es f√ºr diejenigen, die daran interessiert sind, GL823 in ihren Entscheidungen anzuwenden, weiterhin m√∂glich sein wird, den oberen Verbrauchsbalken zu bewerten. <br><br>  Zus√§tzlich zum Testen der Karte wurden zur Erh√∂hung der Objektivit√§t einige Kontrollmessungen mit einem anderen SD-Kartenleser durchgef√ºhrt.  Hier ist einer: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bb6/65a/79d/bb665a79dcfa41269e29baf219bb7977.jpg"></div><br>  Diese Probe wurde nicht vorbereitet, ich habe sie 5 Minuten lang von meiner Tochter ausgeliehen, und wenn ich sie entkernt h√§tte, h√§tten sie mich sofort entkernt.  Eines ist sicher - der darin enthaltene Chip geh√∂rt nicht zur GL823-Familie, deren Mitglieder so viel mit dem SD-Standard arbeiten k√∂nnen, ein Multi-Standard ist ihnen zu schwer. <br><br>  Die Lese- und Schreibgeschwindigkeiten wurden auf einfachste Weise gemessen: Dieselbe Datei mit einer Gr√∂√üe von 1.058.268 kB wurde auf die Testkarte geschrieben und von dieser gelesen.  Das Kontrollexperiment (auf einem anderen Leseger√§t) wurde nur durchgef√ºhrt, um Systemfehler um die eine oder andere Dezimalreihenfolge auszuschlie√üen. Die Daten wurden nicht verarbeitet. Ich war nur davon √ºberzeugt, dass ungef√§hr die Zeiten und Str√∂me des Verbrauchs die in der vorherigen Stufe erhaltenen √ºbertrafen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3c9/44d/ea0/3c944dea089342df93633cb585f542fa.png"></div><br>  Wenn Sie die beschriebene Schaltung in Ihrem Projekt anwenden m√∂chten, korrigieren Sie bei der Sch√§tzung des Verbrauchs die Tatsache, dass der Versorgungsstrom von einer USB-Spannung von 5 Volt stammt, der GL823 jedoch von einer Spannung von 3,3 V gespeist wurde und die Differenz 5-3,3 = 1,7 betr√§gt (und dies ist 50) % von 3,3) ging gerade bei DA2 verloren.  Wenn wir von einer zentralen (und hoffentlich gepulsten) Quelle mit 3,3 Volt gespeist werden, erzielen wir ordentliche Einsparungen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de403199/">https://habr.com/ru/post/de403199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de403185/index.html">Wie Uber Menschen manipuliert</a></li>
<li><a href="../de403189/index.html">Wie man verr√ºckt behandelt. 1.1 - Pharmakotherapie: Grundlagen und Schizophrenie</a></li>
<li><a href="../de403191/index.html">Anmeldung im ROS-Programm</a></li>
<li><a href="../de403193/index.html">Wie wir unsere Audio-Show und unseren Showroom gemacht haben</a></li>
<li><a href="../de403197/index.html">Warum Physiker so besorgt √ºber das Paradox des Verschwindens von Informationen in einem Schwarzen Loch sind</a></li>
<li><a href="../de403201/index.html">Kolonie. Kapitel 9: Ein unerwarteter Angriff</a></li>
<li><a href="../de403203/index.html">VacuumTechExpo 2017</a></li>
<li><a href="../de403209/index.html">So er√∂ffnen Sie Ihre Bank in Europa: W√§hlen Sie ein Land f√ºr die Polybius-Residenz</a></li>
<li><a href="../de403213/index.html">Hobbys + Gesch√§ft oder wie man sich in die Lage eines Kunden versetzt</a></li>
<li><a href="../de403215/index.html">Sie k√∂nnen nicht mehr bei Uber ausleihen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>