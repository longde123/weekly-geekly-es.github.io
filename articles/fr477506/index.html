<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòæ ‚ÑπÔ∏è üêó D√©veloppement d'une application mobile sans serveur üòê üë∞üèæ ü§≥üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tr√®s souvent lors du d√©veloppement d'applications mobiles (peut-√™tre le m√™me probl√®me avec les applications web), les d√©veloppeurs se retrouvent dans ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement d'une application mobile sans serveur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/477506/">  Tr√®s souvent lors du d√©veloppement d'applications mobiles (peut-√™tre le m√™me probl√®me avec les applications web), les d√©veloppeurs se retrouvent dans une situation o√π le backend ne fonctionne pas ou ne fournit pas les m√©thodes n√©cessaires. <br><br>  Cette situation peut se produire pour diverses raisons.  Cependant, le plus souvent au d√©but du d√©veloppement, le backend n'est tout simplement pas √©crit et le client d√©marre sans lui.  Dans ce cas, le d√©but du d√©veloppement est retard√© de 2 √† 4 mois <br><br>  Parfois, le serveur s'arr√™te simplement (plante), parfois il n'a pas le temps de d√©ployer les m√©thodes n√©cessaires, parfois il y a des probl√®mes de donn√©es, etc.  Tous ces probl√®mes nous ont amen√©s √† √©crire un petit service Mocker qui vous permet de remplacer le vrai backend. <br><br><img src="https://habrastorage.org/webt/xj/8e/it/xj8eitbqje5bpz5trubpbzav_qa.png"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Comment en suis-je arriv√© l√†</b> <div class="spoiler_text"> Comment en suis-je arriv√© l√†?  Ma premi√®re ann√©e dans l'entreprise se terminait et ils m'ont mis sur un tout nouveau projet de commerce √©lectronique.  Le gestionnaire a d√©clar√© que le projet doit √™tre achev√© en 4 mois, mais l'√©quipe backend (c√¥t√© client) ne commencera le d√©veloppement qu'apr√®s 1,5 mois.  Et pendant ce temps, nous devons d√©j√† lancer de nombreuses fonctionnalit√©s d'interface utilisateur. <br><br>  J'ai sugg√©r√© d'√©crire un backend moch (avant de devenir d√©veloppeur iOS, j'ai jou√© avec .NET √† l'uni).  L'id√©e d'impl√©mentation √©tait simple: selon une sp√©cification donn√©e, il √©tait n√©cessaire d'√©crire des m√©thodes de stub qui prendraient des donn√©es √† partir de fichiers JSON pr√©-pr√©par√©s.  Ils ont d√©cid√© de cela. <br><br>  Apr√®s 2 semaines, je suis parti en vacances et j'ai pens√©: "Pourquoi ne g√©n√®re-t-il pas automatiquement tout cela?"  Donc, pendant 2 semaines de vacances, j'ai √©crit un semblant d'interpr√®te qui prend la sp√©cification APIBlueprint et en g√©n√®re l'application Web .NET (code C #). <br><br>  En cons√©quence, la premi√®re version de cette chose est apparue et nous l'avons v√©cu pendant pr√®s de 2,5 mois.  Je ne peux pas donner de vrais chiffres, combien cela nous a aid√©s, mais je me souviens comment ils ont dit r√©trospectivement que sans ce syst√®me, il n'y aurait pas de version. <br><br>  Maintenant, apr√®s plusieurs ann√©es, j'ai pris en compte les erreurs que j'ai commises (et il y en avait beaucoup) et j'ai compl√®tement r√©√©crit l'instrument. <br><br>  Profitant de cette opportunit√© - merci beaucoup √† des coll√®gues qui nous ont aid√©s √† nous faire part de leurs commentaires et de leurs conseils.  Et aussi aux dirigeants qui ont endur√© tout mon ¬´arbitraire d'ing√©nierie¬ª. <br></div></div><br><h3>  Pr√©sentation </h3><br>  En r√®gle g√©n√©rale, toute application client-serveur ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/fs/bh/xa/fsbhxawsxnmbtygz0pxuc7-nbri.png"><br><br>  Chaque √©cran contient au moins 1 requ√™te (et souvent plus).  En p√©n√©trant profond√©ment dans les √©crans, nous devons faire de plus en plus de demandes.  Parfois, nous ne pouvons m√™me pas effectuer la transition avant que le serveur ne nous dise "Afficher le bouton".  Autrement dit, l'application mobile est tr√®s li√©e au serveur, non seulement pendant son travail imm√©diat, mais aussi au stade du d√©veloppement.  Consid√©rez le cycle de d√©veloppement de produit abstrait: <br><br><img src="https://habrastorage.org/webt/xc/o6/pm/xco6pm2ekp91qzev1lgowrriyle.png"><br><br><ol><li>  Nous concevons d'abord.  Nous d√©composons, d√©crivons et discutons. </li><li>  Apr√®s avoir re√ßu les t√¢ches et les exigences, nous commen√ßons le d√©veloppement.  Nous √©crivons le code, la composition, etc. </li><li>  Apr√®s avoir mis en ≈ìuvre quelque chose, un assemblage est en cours de pr√©paration, qui passe en test manuel, o√π l'application est v√©rifi√©e pour diff√©rents cas. </li><li>  Si tout va bien pour nous, et que les testeurs testent le montage, cela revient au client qui effectue la r√©ception. </li></ol><br>  Chacun de ces processus est tr√®s important.  Surtout ce dernier, car le client doit comprendre √† quel stade nous en sommes r√©ellement, et parfois il doit rendre compte des r√©sultats √† la direction ou aux investisseurs.  En r√®gle g√©n√©rale, ces rapports se produisent, y compris sous la forme d'une d√©monstration d'une application mobile.  Dans ma pratique, il y a eu un cas o√π un client a d√©montr√© seulement la moiti√© du MVP, qui ne fonctionnait que sur les mokas.  L'application mok ressemble au pr√©sent et les charlatans au pr√©sent.  C'est donc r√©el (: <br>  Cependant, c'est un r√™ve rose.  Voyons ce qui se passe vraiment si nous n'avons pas de serveur. <br><br><img src="https://habrastorage.org/webt/v6/gp/vp/v6gpvpbngkjv_mk4mnalkbxulpe.png"><br><br><ol><li>  Le processus de d√©veloppement sera plus lent et plus p√©nible, car nous ne pouvons pas √©crire de services normalement, nous ne pouvons pas non plus v√©rifier tous les cas, nous devons √©crire des talons qui devront √™tre supprim√©s plus tard. </li><li>  Apr√®s avoir fait le montage en deux avec chagrin, il arrive aux testeurs qui le regardent et ne comprennent pas quoi en faire.  Vous ne pouvez rien v√©rifier, la moiti√© ne fonctionne pas du tout, car il n'y a pas de serveur.  En cons√©quence, ils manquent de nombreux bugs: √† la fois logiques et visuels. </li><li>  Eh bien, apr√®s "√† quoi ils auraient pu ressembler", vous devez donner l'assemblage au client, puis le plus d√©sagr√©able commence.  Le client ne peut pas vraiment √©valuer le travail, il voit 1-2 cas sur tous les possibles et ne peut certainement pas le montrer √† ses investisseurs. </li></ol><br>  En g√©n√©ral, tout va en descendant.  Et malheureusement, de telles situations se produisent presque toujours: parfois il n'y a pas de serveur pendant quelques mois, parfois six mois, parfois juste dans le processus, le serveur est tr√®s en retard ou vous devez v√©rifier rapidement les cas limites qui peuvent √™tre reproduits en utilisant des manipulations de donn√©es sur un vrai serveur. <br><br>  Par exemple, nous voulons v√©rifier le comportement de l'application si le paiement de l'utilisateur est sup√©rieur √† la date d'√©ch√©ance.  Il est tr√®s difficile (et long) de reproduire une telle situation sur le serveur et nous devons le faire artificiellement. <br><br>  Par cons√©quent, il existe les probl√®mes suivants: <br><br><ol><li>  Le serveur est compl√®tement manquant.  Pour cette raison, il est impossible de concevoir, tester et pr√©senter. </li><li>  Le serveur n'a pas le temps, ce qui interf√®re avec le d√©veloppement et peut interf√©rer avec les tests. </li><li>  Nous voulons tester les cas limites, et le serveur ne peut pas le permettre sans de longs gestes. </li><li>  Affectez les tests et les pr√©sentations mena√ßantes. </li><li>  Le serveur plante (une fois, pendant le d√©veloppement stable, nous avons perdu le serveur pendant 3,5 jours). </li></ol><br>  Pour lutter contre ces probl√®mes, Mocker a √©t√© cr√©√©. <br><br><h3>  Principe de fonctionnement </h3><br>  Mocker est un petit service Web qui est h√©berg√© quelque part, √©coute le trafic sur un port sp√©cifique et peut r√©pondre avec des donn√©es pr√©d√©finies √† des demandes r√©seau sp√©cifiques. <br><br>  La s√©quence est la suivante: <br><br>  1. Le client envoie une demande. <br>  2. Mocker re√ßoit la demande. <br>  3. Mocker trouve la maquette souhait√©e. <br>  4. Mocker renvoie la maquette souhait√©e. <br><br>  Si tout est clair avec les points 1, 2 et 4, alors 3 soul√®ve des questions. <br><br>  Afin de comprendre comment le service trouve la maquette n√©cessaire pour le client, nous consid√©rons d'abord la structure de la maquette elle-m√™me. <br><br>  Mock est un fichier JSON au format suivant: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-string"><span class="hljs-string">"number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span> }</code> </pre> <br>  Analysons chaque champ s√©par√©ment. <br><br><h4>  url </h4><br>  Ce param√®tre est utilis√© pour sp√©cifier l'URL de la demande √† laquelle le client acc√®de. <br><br>  Par exemple, si une application mobile fait une demande d'url <code>host.dom/path/to/endpoint</code> , alors dans le champ <code>url</code> nous devons √©crire <code>/path/to/endpoint</code> . <br>  Autrement dit, ce champ stocke le <b>chemin d'acc√®s relatif au point de terminaison</b> . <br><br>  Ce champ doit √™tre format√© au format de mod√®le d'URL, c'est-√†-dire que les formats suivants sont autoris√©s: <br><br><ol><li>  <code>/path/to/endpoint</code> - adresse URL normale.  Lorsque la demande est re√ßue, le service compare les lignes caract√®re par caract√®re. </li><li>  <code>/path/to/endpoint/{number}</code> - url avec motif de chemin.  Une maquette avec une telle URL r√©pondra √† toute demande qui correspond √† ce mod√®le. </li><li>  <code>/path/to/endpoint/data?param={value}</code> - url avec param√®tre-mod√®le.  Mock avec une telle URL d√©clenchera une requ√™te contenant les param√®tres donn√©s.  De plus, si l'un des param√®tres ne figure pas dans la demande, il ne correspondra pas au mod√®le. </li></ol><br>  Ainsi, en contr√¥lant les param√®tres d'URL, vous pouvez clairement d√©terminer qu'un certain mock reviendra √† une URL sp√©cifique. <br><br><h4>  m√©thode </h4><br>  Il s'agit de la m√©thode http attendue.  Par exemple, <code>POST</code> ou <code>GET</code> . <br>  La cha√Æne doit contenir uniquement des majuscules. <br><br><h4>  statusCode </h4><br>  Il s'agit du code d'√©tat http pour la r√©ponse.  Autrement dit, en demandant cette maquette, le client recevra une r√©ponse avec le statut enregistr√© dans le champ statusCode. <br><br><h4>  r√©ponse </h4><br>  Ce champ contient l'objet JSON qui sera envoy√© au client dans le corps de la r√©ponse √† sa demande. <br><br><h4>  demande </h4><br>  Il s'agit du corps de la demande qui devrait √™tre re√ßu du client. Il sera utilis√© pour donner la r√©ponse souhait√©e en fonction du corps de la demande.  Par exemple, si nous voulons changer les r√©ponses en fonction des param√®tres de la demande. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/auth"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"cbshbg52rebfzdghj123dsfsfasd"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Valid"</span></span> } }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/auth"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bad credentials"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Invalid"</span></span> } }</code> </pre><br>  Si le client envoie une demande au corps: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Valid"</span></span> }</code> </pre><br>  Puis en r√©ponse, il recevra: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"cbshbg52rebfzdghj123dsfsfasd"</span></span> }</code> </pre><br>  Et dans le cas o√π nous voulons v√©rifier le fonctionnement de l'application si le mot de passe n'est pas entr√© correctement, une demande sera envoy√©e avec le corps: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Invalid"</span></span> }</code> </pre><br>  Puis en r√©ponse, il recevra: <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bad credentials"</span></span> }</code> </pre><br>  Et nous pouvons v√©rifier le cas avec le mauvais mot de passe.  Et donc pour tous les autres cas. <br><br>  Et maintenant, nous allons voir comment le regroupement et la recherche du moq souhait√© fonctionnent. <br><br><img src="https://habrastorage.org/webt/3g/r4/yj/3gr4yj1z0c4pamlfipuvnoculhg.png"><br><br>  Afin de rechercher rapidement et facilement le mok souhait√©, le serveur charge tous les mokas en m√©moire et les regroupe de la bonne mani√®re.  L'image ci-dessus montre un exemple de regroupement. <br><br>  Le serveur combine diff√©rents mokas par <b>URL</b> et <b>m√©thode</b> .  Ceci est n√©cessaire, entre autres, pour que nous puissions cr√©er de nombreux moks diff√©rents sur une seule URL. <br><br>  Par exemple, nous voulons qu'en tirant constamment Pull-To-Refresh, diff√©rentes r√©ponses arrivent et l'√©tat de l'√©cran change tout le temps (pour v√©rifier tous les cas limites). <br><br>  Ensuite, nous pouvons cr√©er de nombreux moks diff√©rents avec les m√™mes param√®tres de <b>m√©thode</b> et d' <b>URL</b> , et le serveur nous les renverra de mani√®re it√©rative (√† son tour). <br>  Par exemple, ayons de tels mokas: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"product"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> } }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"gdshfjshhkfhsdgfhshdjgfhjkshdjkfsfgbjsfgskdf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">100000000000</span></span> } }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br>  Ensuite, lorsque nous appellerons la m√©thode GET / products pour la premi√®re fois, nous obtiendrons d'abord la r√©ponse: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"product"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> }</code> </pre><br>  Lorsque nous appelons la deuxi√®me fois, le pointeur de l'it√©rateur passera √† l'√©l√©ment suivant et nous reviendra: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"gdshfjshhkfhsdgfhshdjgfhjkshdjkfsfgbjsfgskdf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">100000000000</span></span> }</code> </pre><br>  Et nous pouvons v√©rifier le comportement de l'application si nous obtenons de grandes valeurs.  Et ainsi de suite. <br><br>  Eh bien, et lorsque nous arrivons au dernier √©l√©ment et appelons √† nouveau la m√©thode, le premier √©l√©ment nous reviendra, car l'it√©rateur reviendra au premier √©l√©ment. <br><br><h3>  Proxy de mise en cache </h3><br>  Mocker peut fonctionner en mode cache de proxy.  Cela signifie que lorsqu'un service re√ßoit une demande d'un client, il supprime l'adresse de l'h√¥te sur lequel se trouve le serveur r√©el et le sch√©ma (pour d√©terminer le protocole).  Ensuite, il prend la demande re√ßue (avec tous ses en-t√™tes, donc si la m√©thode n√©cessite une authentification, alors tout va bien, votre <code>Authorization: Bearer ...</code> transf√©r√©e) et supprime les informations de service (le m√™me <code>host</code> et le m√™me <code>scheme</code> ) et envoie la demande au vrai serveur. <br><br>  Apr√®s avoir re√ßu la r√©ponse avec le 200e code, Mocker enregistre la r√©ponse dans le fichier Mock (oui, vous pouvez ensuite le copier ou le modifier) ‚Äã‚Äãet retourne au client ce qu'il a re√ßu du vrai serveur.  De plus, il n'enregistre pas seulement le fichier √† un endroit al√©atoire, mais organise les fichiers de sorte que vous puissiez ensuite les utiliser manuellement. Par exemple, Mocker envoie une demande √† l'URL suivante: <code>hostname.dom/main/products/loans/info</code> .  Ensuite, il cr√©era un dossier <code>hostname.dom</code> , puis √† l'int√©rieur il cr√©era un dossier <code>main</code> , √† l'int√©rieur un dossier <code>products</code> ... <br><br>  Afin d'√©viter les doublons, le nom est form√© sur la base de la <b>m√©thode http</b> (GET, PUT ...) et d'un <b>hachage du corps de r√©ponse du serveur r√©el</b> .  Dans ce cas, s'il existe d√©j√† une maquette sur une r√©ponse sp√©cifique, elle sera simplement remplac√©e. <br><br>  Cette fonction peut √™tre activ√©e individuellement pour chaque demande.  Pour ce faire, ajoutez trois en-t√™tes √† la demande: <br><br><pre> <code class="plaintext hljs">X-Mocker-Redirect-Is-On: "true", X-Mocker-Redirect-Host: "hostaname.ex:1234", X-Mocker-Redirect-Scheme: "http"</code> </pre><br><h3>  Indication explicite du chemin vers les simulacres </h3><br>  Parfois, vous voulez que Mocker ne retourne que les mokas que nous voulons, et pas tous ceux qui sont dans le projet. <br><br>  Particuli√®rement pertinent pour les testeurs.  Il serait pratique pour eux d'avoir une sorte de jeu de mokas pr√©par√© pour chacun des cas de test.  Et puis, pendant les tests, QA s√©lectionne simplement le dossier dont il a besoin et fonctionne silencieusement, car il n'y a plus de bruit provenant de simulations tierces. <br><br>  Maintenant c'est possible.  Pour activer cette fonction, vous devez utiliser un en-t√™te sp√©cial: <br><br><pre> <code class="plaintext hljs">X-Mocker-Specific-Path: path</code> </pre><br>  Par exemple, laissez Mocker avoir une telle structure de dossiers √† la racine <br><br><pre> <code class="plaintext hljs">root/ block_card_test_case/ mocks.... main_test_case/ blocked_test_case/ mocks...</code> </pre><br>  Si vous devez ex√©cuter un sc√©nario de test sur les cartes bloqu√©es, <br> <b><code>X-Mocker-Specific-Path: block_card_test_case</code></b> <br>  Si vous devez ex√©cuter un sc√©nario de test associ√© au verrouillage de l'√©cran principal, <br> <b><code>X-Mocker-Specific-Path: main_test_case/blocked_test_case</code></b> <br> <br><h3>  Interface </h3><br>  Au d√©but, nous avons travaill√© avec les mokas directement via ssh, mais avec une augmentation du nombre de mokas et d'utilisateurs, nous sommes pass√©s √† une option plus pratique.  Maintenant, nous utilisons CloudCommander. <br>  Dans l'exemple docker-compose, il se lie au conteneur Mocker. <br><br>  Cela ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/g8/ix/y2/g8ixy2mxaomzvo7zwknzhjf33jw.png"><br><br>  Eh bien, le bonus est un √©diteur Web, qui vous permet d'ajouter / modifier des moki directement depuis le navigateur. <br><br><img src="https://habrastorage.org/webt/2o/_d/ut/2o_dutkmga1j_dkuwor2isr4jxq.png"><br><br>  Il s'agit √©galement d'une solution temporaire.  Dans les plans pour sortir du travail avec les moks via le syst√®me de fichiers vers une base de donn√©es.  Et en cons√©quence, il sera possible de contr√¥ler les mokas eux-m√™mes depuis l'interface graphique vers cette base de donn√©es. <br><br><h3>  D√©ploiement </h3><br>  La fa√ßon la plus simple de d√©ployer Mocker est d'utiliser Docker.  De plus, le d√©ploiement du service √† partir du docker d√©ploiera automatiquement une interface Web √† travers laquelle il est plus pratique de travailler avec des mokas.  Les fichiers n√©cessaires au d√©ploiement via Docker se trouvent dans le r√©f√©rentiel. <br><br>  Cependant, si cette option ne vous convient pas, vous pouvez assembler ind√©pendamment le service √† partir de la source.  Assez pour cela: <br><br><pre> <code class="plaintext hljs">git clone https://github.com/LastSprint/mocker.git cd mocker go build .</code> </pre><br>  Ensuite, vous devez √©crire un fichier de configuration ( <a href="">exemple</a> ) et d√©marrer le service: <br><br><pre> <code class="plaintext hljs">mocker config.json</code> </pre><br><h3>  Probl√®mes connus </h3><br><ul><li>  Apr√®s chaque nouveau fichier, vous devez effectuer <code>curl mockerhost.dom/update_models</code> pour que le service <code>curl mockerhost.dom/update_models</code> les fichiers.  Je n'ai pas trouv√© de moyen rapide et √©l√©gant de le mettre √† jour sinon </li><li>  Parfois, des bugs CloudCommander (ou j'ai fait quelque chose de mal) et cela ne permet pas de modifier les moki qui ont √©t√© cr√©√©s via l'interface Web.  Il est trait√© en effa√ßant le cache du navigateur. </li><li>  Le service fonctionne uniquement avec <code>application/json</code> .  Les plans prennent en charge le <code>form-url-encoding</code> . </li></ul><br><h3>  R√©sum√© </h3><br>  Mocker est un service Web qui r√©sout les probl√®mes de d√©veloppement d'applications client-serveur lorsque le serveur n'est pas pr√™t pour une raison quelconque. <br><br>  Le service vous permet de cr√©er de nombreuses simulations diff√©rentes sur une seule URL, vous permet de connecter la demande et la r√©ponse entre elles en sp√©cifiant explicitement les param√®tres dans l'URL, ou directement en d√©finissant le corps de la demande attendu.  Le service poss√®de une interface Web qui simplifie consid√©rablement la vie des utilisateurs. <br><br>  Chaque utilisateur du service peut ajouter ind√©pendamment le point de terminaison n√©cessaire et la demande dont il a besoin.  Dans ce cas, sur le client, pour passer √† un vrai serveur, il suffit de remplacer simplement la constante par l'adresse de l'h√¥te. <br><br>  J'esp√®re que cet article aidera les personnes qui souffrent de probl√®mes similaires et, peut-√™tre, nous travaillerons ensemble pour d√©velopper cet outil. <br><br>  <a href="https://github.com/LastSprint/mocker">D√©p√¥t GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477506/">https://habr.com/ru/post/fr477506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477494/index.html">1. Analyse des logiciels malveillants √† l'aide de Check Point forensics. R√©seau de sablage</a></li>
<li><a href="../fr477498/index.html">Nous collectons les journaux de Nginx √† l'aide de nginx-clickhouse, les envoyons √† Clickhouse et les affichons √† Grafana</a></li>
<li><a href="../fr477500/index.html">Mod√®le d'application (Avalanche - cadre d'application pour Java)</a></li>
<li><a href="../fr477502/index.html">Travail √† distance d'un employeur sain</a></li>
<li><a href="../fr477504/index.html">Meilleures pratiques de d√©veloppement d'applications √† suivre en 2020</a></li>
<li><a href="../fr477508/index.html">D√©tecteurs de radar: quelques mots de plus sur l'√©thique et beaucoup de mots sur les lois</a></li>
<li><a href="../fr477510/index.html">Sauvegarde et r√©cup√©ration automatiques des listes d'adresses dynamiques sur Mikrotik</a></li>
<li><a href="../fr477512/index.html">Bataille de L2TP, RRAS vs SoftEther</a></li>
<li><a href="../fr477514/index.html">Automatisation du test mat√©riel des syst√®mes embarqu√©s</a></li>
<li><a href="../fr477518/index.html">La microarchitecture osseuse comme base de mat√©riaux ultral√©gers et durables</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>