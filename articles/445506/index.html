<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèæ üë©‚Äçüë©‚Äçüëß‚Äçüë¶ ‚ìÇÔ∏è OS1: n√∫cleo primitivo en Rust para x86 ü•ä üÜë üèõÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decid√≠ escribir un art√≠culo y, si es posible, una serie de art√≠culos para compartir mi experiencia de investigaci√≥n independiente tanto del dispositiv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OS1: n√∫cleo primitivo en Rust para x86</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445506/"><p>  Decid√≠ escribir un art√≠culo y, si es posible, una serie de art√≠culos para compartir mi experiencia de investigaci√≥n independiente tanto del dispositivo Bare Bone x86 como de la organizaci√≥n de los sistemas operativos.  Por el momento, mi pirateo ni siquiera puede llamarse un sistema operativo: es un kernel peque√±o que puede arrancar desde Multiboot (GRUB), administrar memoria real y virtual, y tambi√©n realizar varias funciones in√∫tiles en modo multitarea en un procesador. </p><br><p>  Durante el desarrollo, no me propuse el objetivo de escribir un nuevo Linux (aunque, lo admito, lo so√±√© hace unos 5 a√±os) o impresionar a alguien, por lo que le pido que no parezca particularmente impresionado.  Lo que realmente quer√≠a hacer era descubrir c√≥mo funciona la arquitectura i386 en el nivel m√°s b√°sico, y c√≥mo exactamente los sistemas operativos hacen su magia, y desenterrar la exageraci√≥n Rust. </p><br><p> En mis notas intentar√© compartir no solo los textos fuente (se pueden encontrar en GitLab) y la teor√≠a b√°sica (se puede encontrar en muchos recursos), sino tambi√©n el camino que segu√≠ para encontrar respuestas no obvias.  Espec√≠ficamente, en este art√≠culo hablar√© sobre la <strong>construcci√≥n de un archivo kernel, su carga e inicializaci√≥n</strong> . </p><br><p>  Mis objetivos son estructurar la informaci√≥n en mi cabeza, as√≠ como ayudar a aquellos que siguen un camino similar.  Entiendo que materiales y blogs similares ya est√°n en la red, pero para llegar a mi situaci√≥n actual, tuve que reunirlos durante mucho tiempo.  Todas las fuentes (en cualquier caso, que recuerdo), compartir√© ahora mismo. </p><a name="habracut"></a><br><h1 id="literatura-i-istochniki">  Literatura y Fuentes </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Por</a> supuesto, obtuve la mayor parte del excelente recurso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OSDev</a> , tanto de la wiki como del foro.  En segundo lugar, nombrar√© a Philip Opperman con su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">blog</a> , mucha informaci√≥n sobre el mont√≥n de √≥xido y hierro. </p><br><p>  Algunos puntos se esp√≠an en el kernel de Linux, Minix no carece de la ayuda de literatura especial, como el libro de Tanenbaum " <em>Sistemas operativos</em> " <em>.</em>  <em>Dise√±o e implementaci√≥n</em> " <em>,</em> libro de Robert Love" <em>The Linux Kernel.</em>  <em>Descripci√≥n del proceso de desarrollo</em> ".  Las preguntas dif√≠ciles sobre la organizaci√≥n de la arquitectura x86 se resolvieron utilizando el manual ‚Äú <em>Intel 64 y el Manual del desarrollador de software de arquitecturas IA-32, volumen 3 (3A, 3B, 3C y 3D): Gu√≠a de programaci√≥n del sistema</em> ‚Äù.  En la comprensi√≥n del formato de los binarios, los dise√±os son gu√≠as para ld, llvm, nm, nasm, make. <br>  UPD  Gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">CoreTeamTech</a> por recordarme el maravilloso sistema Redox OS.  No sal√≠ de su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuente</a> .  Desafortunadamente, el sistema oficial de GitLab no est√° disponible desde IP de Rusia, por lo que puede ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . </p><br><h1 id="esche-odno-predislovie">  Otro prefacio </h1><br><p>  Me doy cuenta de que no soy un buen programador en Rust, adem√°s, este es mi primer proyecto en este idioma (no es la mejor manera de empezar a salir, ¬øverdad?).  Por lo tanto, la implementaci√≥n puede parecerle completamente incorrecta: de antemano quiero pedir clemencia a mi c√≥digo y me complacer√° comentarlo y hacer sugerencias.  Si un lector respetado puede decirme d√≥nde y c√≥mo seguir adelante, tambi√©n estar√© muy agradecido.  Algunos fragmentos de c√≥digo pueden copiarse de los tutoriales tal como est√°n y modificarse ligeramente, pero intentar√© dar explicaciones tan claras como sea posible a dichas secciones para que no tenga las mismas preguntas que ten√≠a al analizarlas.  Tampoco pretendo utilizar los enfoques correctos en el dise√±o, por lo que si mi administrador de memoria te hace querer escribir comentarios enojados, entiendo por qu√©. </p><br><h1 id="instrumentariy">  Kit de herramientas </h1><br><p>  Entonces, comenzar√© sumergi√©ndome en las herramientas de desarrollo que utilic√©.  Como entorno, eleg√≠ un editor VS Code bueno y conveniente con complementos para Rust y un depurador GDB.  VS Code a veces no es muy bueno con RLS, especialmente al redefinirlo en un directorio espec√≠fico, por lo que despu√©s de cada actualizaci√≥n nocturna de Rust tuve que reinstalar RLS. </p><br><p>  Rust fue elegido por varias razones.  En primer lugar, su creciente popularidad y filosof√≠a agradable.  En segundo lugar, su capacidad para trabajar con un nivel bajo pero con una probabilidad menor de "dispararse en el pie".  En tercer lugar, como amante de Java y Maven, soy muy adicto a construir sistemas y gesti√≥n de dependencias, y la carga ya est√° integrada en el lenguaje de la cadena de herramientas.  Cuarto, solo quer√≠a algo nuevo, no como C. </p><br><p>  Para el c√≥digo de bajo nivel, tom√© NASM, como  Me siento confiado en la sintaxis de Intel, y tambi√©n me siento c√≥modo trabajando con sus directivas.  Abandon√© deliberadamente los insertos de ensamblador en Rust para separar expl√≠citamente el trabajo con hierro y l√≥gica de alto nivel. <br>  Make y el enlazador del suministro LLVM LLD (como un enlazador m√°s r√°pido y mejor) se usaron como un ensamblaje general y dise√±o, esto es cuesti√≥n de gustos.  Fue posible hacer con scripts de construcci√≥n para carga. </p><br><p>  Qemu se us√≥ para lanzar: me gusta su velocidad, modo interactivo y la capacidad de conectar GDB.  Para arrancar e inmediatamente tener toda la informaci√≥n del hardware, por supuesto GRUB (Legacy es m√°s f√°cil de organizar el encabezado, as√≠ que t√≥malo). </p><br><h1 id="linkovka-i-komponovka">  Vinculaci√≥n y dise√±o </h1><br><p>  Por extra√±o que parezca, para m√≠ result√≥ ser uno de los temas m√°s dif√≠ciles.  Despu√©s de largas pruebas con registros de segmentos x86, fue extremadamente dif√≠cil darse cuenta de que los segmentos y las secciones no son lo mismo.  En la programaci√≥n para el entorno existente, no es necesario pensar en c√≥mo colocar el programa en la memoria: para cada plataforma y formato, el enlazador ya tiene una receta preparada, por lo que no es necesario escribir un script de enlazador. </p><br><p>  Para el hierro desnudo, por el contrario, es necesario indicar c√≥mo colocar y direccionar el c√≥digo del programa en la memoria.  Aqu√≠ quiero enfatizar que estamos hablando de una direcci√≥n lineal (virtual) usando el mecanismo de p√°gina.  OS1 usa un mecanismo de p√°gina, pero me detendr√© en √©l por separado en la secci√≥n correspondiente del art√≠culo. </p><br><div class="spoiler">  <b class="spoiler_title">L√≥gico, lineal, virtual, f√≠sico ...</b> <div class="spoiler_text"><p>  Direcciones l√≥gicas, lineales, virtuales, f√≠sicas.  Me romp√≠ la cabeza con esta pregunta, as√≠ que para los detalles que quiero abordar en este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">excelente art√≠culo</a> </p></div></div><br><p>  Para los sistemas operativos que utilizan paginaci√≥n, en un entorno de 32 bits, cada tarea tiene 4 GB de espacio de direcciones de memoria, incluso si tiene 128 MB de RAM instalada.  Esto sucede solo debido a la organizaci√≥n de la memoria de paginaci√≥n; la ausencia de p√°ginas en la memoria principal se maneja en consecuencia. </p><br><p>  Sin embargo, en realidad, las aplicaciones suelen estar disponibles un poco menos de 4 GB.  Esto se debe a que el sistema operativo debe manejar las interrupciones, las llamadas al sistema, lo que significa que al menos sus manejadores deben estar en este espacio de direcciones.  Nos enfrentamos a la pregunta: ¬ød√≥nde exactamente en estos 4 GB se deben colocar las direcciones del n√∫cleo para que los programas puedan funcionar correctamente? </p><br><p>  En el mundo moderno de los programas, se utiliza dicho concepto: cada tarea cree que reina sobre el procesador y es el √∫nico programa que se ejecuta en la computadora (en este momento no estamos hablando de comunicaci√≥n entre procesos).  Si observa exactamente c√≥mo los compiladores recopilan programas en la etapa de vinculaci√≥n, resulta que comienzan con una direcci√≥n lineal de cero o casi cero.  Esto significa que si la imagen del kernel ocupa un espacio de memoria cercano a cero, los programas ensamblados de esta manera no se pueden ejecutar, cualquier instrucci√≥n jmp en el programa conducir√° a la entrada en la memoria protegida del kernel y a un error de protecci√≥n.  Por lo tanto, si queremos utilizar no solo programas autoescritos en el futuro, es razonable darle a la aplicaci√≥n tanta memoria como sea posible cerca de cero, y colocar la imagen del n√∫cleo m√°s arriba. </p><br><p>  Este concepto se llama Kernel de mitad superior (aqu√≠ me remito a osdev.org, si desea informaci√≥n relacionada).  Qu√© recuerdo elegir solo depende de tus apetitos.  512 MB es suficiente para alguien, pero decid√≠ obtener 1 GB, por lo que mi kernel se encuentra en 3 GB + 1 MB (se necesita + 1 MB para cumplir con los l√≠mites de memoria m√°s bajos, GRUB nos carga en la memoria f√≠sica despu√©s de 1 MB) . <br>  Tambi√©n es importante para nosotros especificar el punto de entrada a nuestro archivo ejecutable.  Para mi ejecutable, esta ser√° la funci√≥n _loader escrita en ensamblador, en la que me detendr√© con m√°s detalle en la siguiente secci√≥n. </p><br><div class="spoiler">  <b class="spoiler_title">Sobre el punto de entrada</b> <div class="spoiler_text"><p>  ¬øSab√≠a que ha estado mintiendo toda su vida sobre el hecho de que main () es el punto de entrada al programa?  De hecho, main () es una convenci√≥n del lenguaje C y los lenguajes generados por √©l.  Si cavas, resulta algo como lo siguiente. </p><br><p>  En primer lugar, cada plataforma tiene su propia especificaci√≥n y nombre de punto de entrada: para Linux generalmente es _start, para Windows es mainCRTStartup.  En segundo lugar, estos puntos se pueden redefinir, pero no funcionar√° usar las delicias de libc.  En tercer lugar, el compilador proporciona estos puntos de entrada de forma predeterminada y est√°n en los archivos crt0..crtN (CRT - C RunTime, N - n√∫mero de argumentos principales). </p><br><p>  En realidad, qu√© hacen los compiladores como gcc o vc: seleccionan un script de enlace espec√≠fico de la plataforma que define un punto de entrada est√°ndar, seleccionan el archivo de objeto deseado con la funci√≥n de inicializaci√≥n de C preparada y llaman a la funci√≥n principal y se vinculan a la salida en forma de un archivo del formato deseado con un punto de entrada est√°ndar. </p><br><p>  Entonces, para nuestros prop√≥sitos, el punto de entrada est√°ndar y la inicializaci√≥n de CRT deben estar desactivados, ya que no tenemos absolutamente nada m√°s que hierro desnudo. </p></div></div><br><p>  ¬øQu√© m√°s necesitas saber para vincular?  ¬øC√≥mo se ubicar√°n las secciones de datos (.rodata, .data), las variables no inicializadas (.bss, com√∫n), y tambi√©n recuerde que GRUB requiere la ubicaci√≥n de encabezados de arranque m√∫ltiple en los primeros 8 KB del binario. </p><br><p>  ¬°As√≠ que ahora podemos escribir un script vinculador! </p><br><pre><code class="plaintext hljs">ENTRY(_loader) OUTPUT_FORMAT(elf32-i386) SECTIONS { . = 0xC0100000; .text ALIGN(4K) : AT(ADDR(.text) - 0xC0000000) { *(.multiboot1) *(.multiboot2) *(.text) } .rodata ALIGN(4K) : AT(ADDR(.rodata) - 0xC0000000) { *(.rodata*) } .data ALIGN (4K) : AT(ADDR(.data) - 0xC0000000) { *(.data) } .bss : AT(ADDR(.bss) - 0xC0000000) { _sbss = .; *(COMMON) *(.bss) _ebss = .; } }</code> </pre> <br><h1 id="zagruzka-posle-grub">  Descargar despu√©s de GRUB </h1><br><p>  Como se mencion√≥ anteriormente, la especificaci√≥n de arranque m√∫ltiple requiere que el encabezado est√© en los primeros 8 KB de la imagen de arranque.  La especificaci√≥n completa se puede ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , pero me detendr√© solo en los detalles de inter√©s. </p><br><ul><li>  Se debe respetar la alineaci√≥n de 32 bits (4 bytes) </li><li>  Debe haber un n√∫mero m√°gico 0x1BADB002 </li><li>  Es necesario decirle al multibooter qu√© informaci√≥n queremos obtener y c√≥mo colocar los m√≥dulos (en mi caso, quiero que el m√≥dulo del n√∫cleo est√© alineado con una p√°gina de 4 KB, y tambi√©n obtener una tarjeta de memoria para ahorrar tiempo y esfuerzo) </li><li>  Proporcione una suma de verificaci√≥n (suma de verificaci√≥n + n√∫mero m√°gico + banderas deber√≠a dar cero) </li></ul><br><pre> <code class="plaintext hljs">MB1_MODULEALIGN equ 1&lt;&lt;0 MB1_MEMINFO equ 1&lt;&lt;1 MB1_FLAGS equ MB1_MODULEALIGN | MB1_MEMINFO MB1_MAGIC equ 0x1BADB002 MB1_CHECKSUM equ -(MB1_MAGIC + MB1_FLAGS) section .multiboot1 align 4 dd MB1_MAGIC dd MB1_FLAGS dd MB1_CHECKSUM</code> </pre> <br><p>  Despu√©s del arranque, Multiboot garantiza algunas condiciones que debemos tener en cuenta. </p><br><ul><li>  El registro EAX contiene el n√∫mero m√°gico 0x2BADB002, que dice que la descarga fue exitosa </li><li>  El registro EBX contiene la direcci√≥n f√≠sica de la estructura con informaci√≥n sobre los resultados de la carga (hablaremos de eso mucho m√°s tarde) </li><li>  El procesador est√° en modo protegido, la memoria de p√°gina est√° apagada, los registros de segmento y la pila est√°n en un estado indefinido (para nosotros), GRUB los us√≥ para sus necesidades y necesita redefinirse lo antes posible. </li></ul><br><p>  Lo primero que debemos hacer es habilitar la paginaci√≥n, ajustar la pila y finalmente transferir el control al c√≥digo Rust de alto nivel. <br>  No me detendr√© en detalle en la organizaci√≥n de la p√°gina de la memoria, el Directorio de p√°ginas y la Tabla de p√°ginas, porque se han escrito excelentes art√≠culos sobre esto ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uno de ellos</a> ).  ¬°Lo principal que quiero compartir es que las p√°ginas no son segmentos!  ¬°No repita mi error y no cargue la direcci√≥n de la tabla de p√°ginas en GDTR!  Para la tabla de p√°ginas es CR3!  La p√°gina puede tener un tama√±o diferente en diferentes arquitecturas, por simplicidad de trabajo (para tener solo una tabla de p√°ginas), eleg√≠ un tama√±o de 4 MB debido a la inclusi√≥n de PSE. </p><br><p>  Entonces, queremos habilitar la memoria de p√°gina virtual.  Para hacer esto, necesitamos una tabla de p√°ginas, y su direcci√≥n f√≠sica, cargada en CR3.  Al mismo tiempo, nuestro archivo binario estaba vinculado al trabajo en un espacio de direcciones virtual con un desplazamiento de 3 GB.  Esto significa que todas las direcciones y etiquetas variables tienen un desplazamiento de 3 GB.  La tabla de p√°ginas es solo una matriz en la que la direcci√≥n de la p√°gina contiene su direcci√≥n real, alineada con el tama√±o de la p√°gina, as√≠ como los indicadores de acceso y estado.  Como uso p√°ginas de 4 MB, solo necesito una tabla de p√°ginas PD con 1024 entradas: </p><br><pre> <code class="plaintext hljs">section .data align 0x1000 BootPageDirectory: dd 0x00000083 times (KERNEL_PAGE_NUMBER - 1) dd 0 dd 0x00000083 times (1024 - KERNEL_PAGE_NUMBER - 1) dd 0</code> </pre> <br><p>  ¬øQu√© hay en la mesa? </p><br><ol><li>  La primera p√°gina debe conducir a la secci√≥n actual de c√≥digo (0-4 MB de memoria f√≠sica), ya que todas las direcciones en el procesador son f√≠sicas y la traducci√≥n a virtual a√∫n no se realiza.  La ausencia de este descriptor de p√°gina dar√° lugar a un bloqueo inmediato, ya que el procesador no podr√° tomar la siguiente instrucci√≥n despu√©s de pasar las p√°ginas.  Banderas: bit 0 - la tabla est√° presente, bit 1 - la p√°gina est√° escrita, bit 7 - tama√±o de p√°gina 4 MB.  Despu√©s de pasar las p√°ginas, el registro se restablece. </li><li>  Omita hasta 3 GB: los ceros aseguran que la p√°gina no est√© en la memoria </li><li>  La marca de 3 GB es nuestro n√∫cleo en la memoria virtual, haciendo referencia a 0 en la memoria f√≠sica.  Despu√©s de pasar las p√°ginas, trabajaremos aqu√≠.  Las banderas son similares al primer registro. </li><li>  Salta hasta 4 GB. </li></ol><br><p>  Entonces, declaramos la tabla y ahora queremos cargar su direcci√≥n f√≠sica en CR3.  No se olvide del desplazamiento de la direcci√≥n de 3 GB en la etapa de enlace.  Intentar cargar la direcci√≥n tal como est√° nos enviar√° a la direcci√≥n real de 3 GB + desplazamiento variable y dar√° lugar a un bloqueo inmediato.  Por lo tanto, tomamos la direcci√≥n de BootPageDirectory y le restamos 3 GB, lo ponemos en CR3.  Activamos el PSE en el registro CR4, activamos el trabajo con p√°ginas en el registro CR0: </p><br><pre> <code class="plaintext hljs"> mov ecx, (BootPageDirectory - KERNEL_VIRTUAL_BASE) mov cr3, ecx mov ecx, cr4 or ecx, 0x00000010 mov cr4, ecx mov ecx, cr0 or ecx, 0x80000000 mov cr0, ecx</code> </pre> <br><p>  Hasta ahora, todo va bien, pero tan pronto como restablezcamos la primera p√°gina para finalmente pasar a la mitad superior de 3 GB, todo colapsar√°, ya que el registro EIP todav√≠a tiene una direcci√≥n f√≠sica en la regi√≥n del primer megabyte.  Para solucionar esto, realizamos una manipulaci√≥n simple: coloque una marca en el lugar m√°s cercano, cargue su direcci√≥n (ya est√° con un desplazamiento de 3 GB, recu√©rdelo) y realice un salto incondicional a trav√©s de ella.  Despu√©s de eso, se puede restablecer una p√°gina innecesaria para futuras aplicaciones. </p><br><pre> <code class="plaintext hljs"> lea ecx, [StartInHigherHalf] jmp ecx StartInHigherHalf: mov dword [BootPageDirectory], 0 invlpg [0]</code> </pre> <br><p>  Ahora se trata de lo muy peque√±o: inicializar la pila, pasar la estructura GRUB y el ensamblador es suficiente. </p><br><pre> <code class="plaintext hljs"> mov esp, stack+STACKSIZE push eax push ebx lea ecx, [BootPageDirectory] push ecx call kmain hlt section .bss align 32 stack: resb STACKSIZE</code> </pre> <br><p>  Lo que necesita saber sobre este c√≥digo: </p><br><ol><li>  De acuerdo con la convenci√≥n C de llamadas (tambi√©n es aplicable a Rust), las variables se transfieren a la funci√≥n a trav√©s de la pila en el orden inverso.  Todas las variables est√°n alineadas por 4 bytes en x86. </li><li>  La pila crece desde el final, por lo que el puntero a la pila debe conducir al final de la pila (agregue STACKSIZE a la direcci√≥n).  El tama√±o de la pila que tom√© fue de 16 KB, deber√≠a ser suficiente. </li><li>  Lo siguiente se transfiere al kernel: el n√∫mero m√°gico de arranque m√∫ltiple, la direcci√≥n f√≠sica de la estructura del cargador de arranque (hay una valiosa tarjeta de memoria para nosotros), la direcci√≥n virtual de la tabla de p√°ginas (en alg√∫n lugar en el espacio de 3 GB) </li></ol><br><p>  Adem√°s, no olvide declarar que kmain es externo y _loader es global. </p><br><h1 id="dalneyshie-shagi">  Pasos adicionales </h1><br><p>  En las siguientes notas, hablar√© sobre la configuraci√≥n de registros de segmentos, repasar√© brevemente la salida de informaci√≥n a trav√©s de un b√∫fer VGA, te dir√© c√≥mo organic√© el trabajo con interrupciones, administraci√≥n de p√°ginas y lo m√°s dulce es la multitarea: lo dejar√© para el postre. </p><br><p>  El c√≥digo completo del proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√° disponible en GitLab</a> . </p><br><p>  Gracias por su atencion! </p><br><p>  UPD2: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> <br>  UPD2: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445506/">https://habr.com/ru/post/445506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445494/index.html">C√≥mo el fragmento de marcado CSS rompi√≥ el compilador de C ++</a></li>
<li><a href="../445496/index.html">C√≥mo el fragmento de marcado CSS rompi√≥ el compilador de C ++</a></li>
<li><a href="../445500/index.html">Acerca de Open Distros, Open Source y Elastic</a></li>
<li><a href="../445502/index.html">Vivaldi 2.4 - Mueve los botones con las dos manos</a></li>
<li><a href="../445504/index.html">La gesti√≥n de servicios de TI (ITSM) se hizo m√°s eficiente con las herramientas de aprendizaje autom√°tico</a></li>
<li><a href="../445512/index.html">C√≥mo creamos PHP 7 el doble de r√°pido que PHP 5. Parte 2: optimizaci√≥n de bytecode en PHP 7.1</a></li>
<li><a href="../445514/index.html">Lo m√°s interesante en la exposici√≥n Securika Mosc√∫ 2019</a></li>
<li><a href="../445516/index.html">Estados cu√°nticos neuronales: representaci√≥n de una funci√≥n de onda por una red neuronal</a></li>
<li><a href="../445518/index.html">Hierro viejo: herramientas electr√≥nicas que se pierden en las profundidades de la historia.</a></li>
<li><a href="../445520/index.html">Extensiones para Visual Studio Code que lo ayudan a trabajar con Git</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>