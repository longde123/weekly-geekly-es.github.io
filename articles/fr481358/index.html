<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèº üßúüèæ ‚ÄºÔ∏è C ++ Russie: comment c'√©tait üï∫üèª üññüèª üë©‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si au d√©but de la pi√®ce vous dites que le code C ++ est accroch√© au mur, alors √† la fin il devrait certainement vous tirer dans le pied. 

 Bjarne Str...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ Russie: comment c'√©tait</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hsespb/blog/481358/">  <i>Si au d√©but de la pi√®ce vous dites que le code C ++ est accroch√© au mur, alors √† la fin il devrait certainement vous tirer dans le pied.</i> <i><br><br></i>  <i>Bjarne Stroustrup</i> <i><br></i> <br>  Du 31 octobre au 1er novembre, Saint-P√©tersbourg a accueilli la conf√©rence C ++ Russia Piter, l'une des plus grandes conf√©rences de programmation en Russie organis√©e par le groupe JUG Ru.  Parmi les conf√©renciers invit√©s figurent des membres du comit√© de normalisation C ++, des conf√©renciers de CppCon, des auteurs de livres de O'Reilly, ainsi que des responsables de projets tels que LLVM, libc ++ et Boost.  La conf√©rence s'adresse aux d√©veloppeurs C ++ exp√©riment√©s qui souhaitent approfondir leur expertise et √©changer leurs exp√©riences en communication en direct.  Les √©tudiants, √©tudiants dipl√¥m√©s et professeurs d'universit√© b√©n√©ficient de remises tr√®s agr√©ables. <br><br>  L'√©dition de Moscou de la conf√©rence peut √™tre visit√©e d√®s avril de l'ann√©e prochaine, mais pour l'instant nos √©tudiants vous diront quelles choses int√©ressantes ils ont apprises lors du dernier √©v√©nement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a73/7bf/78f/a737bf78fa7a626dc60d87aae2d2ce88.png"><br><a name="habracut"></a><br>  <i>Photo de <a href="https://vk.com/album-77278886_270140987">l'album</a> de <a href="https://vk.com/album-77278886_270140987">la conf√©rence</a></i> <br><br><h2>  √Ä propos de nous </h2><br>  Deux √©tudiants de l'√âcole sup√©rieure d'√©conomie de Saint-P√©tersbourg ont travaill√© sur ce poste: <br><br><ul><li>  Lisa Vasilenko est une √©tudiante de premier cycle de 4e ann√©e qui √©tudie la direction des ¬´langages de programmation¬ª dans le cadre du programme ¬´Math√©matiques appliqu√©es et informatique¬ª.  Connaissant le langage C ++ en premi√®re ann√©e d'universit√©, il a par la suite acquis une exp√©rience de travail avec lui lors de stages dans l'industrie.  La passion des langages de programmation en g√©n√©ral et de la programmation fonctionnelle en particulier a marqu√© le choix des rapports lors de la conf√©rence. <br></li><li>  Danya Smirnov est une √©tudiante de premi√®re ann√©e du programme de ma√Ætrise ¬´Programmation et analyse des donn√©es¬ª.  Alors qu'il √©tait encore √† l'√©cole, il a √©crit les probl√®mes de l'Olympiade en C ++, puis il est arriv√© que le langage apparaissait constamment dans les activit√©s √©ducatives et devenait par cons√©quent le principal outil de travail.  J'ai d√©cid√© de participer √† la conf√©rence afin d'enrichir mes connaissances et de d√©couvrir de nouvelles opportunit√©s. <br></li></ul><br>  Dans le bulletin d'information, les professeurs partagent souvent des informations sur les √©v√©nements √©ducatifs li√©s √† notre sp√©cialit√©.  En septembre, nous avons vu des informations sur C ++ Russia et avons d√©cid√© de nous inscrire comme auditeurs.  Il s'agit de notre premi√®re exp√©rience de participation √† de telles conf√©rences. <br><br><h2>  Structure de la conf√©rence </h2><br><ul><li><h3>  Rapports </h3></li></ul><br>  Au cours de deux jours, les experts ont lu 30 rapports mettant en √©vidence de nombreux sujets d'actualit√©: applications pleines d'esprit des fonctionnalit√©s du langage pour r√©soudre les probl√®mes appliqu√©s, mises √† jour linguistiques √† venir en raison de la nouvelle norme, compromis dans la conception C ++ et pr√©cautions lors de l'utilisation de leurs cons√©quences, exemples d'architecture de projet int√©ressante, ainsi que certaines parties du moteur de l'infrastructure linguistique.  Dans le m√™me temps, 3 repr√©sentations ont eu lieu, le plus souvent deux en russe et une en anglais. <br><br><ul><li><h3>  Zones de discussion </h3></li></ul><br>  Apr√®s le discours, toutes les questions sans r√©ponse et les discussions incompl√®tes ont √©t√© transf√©r√©es dans des zones de communication sp√©cialement d√©sign√©es avec des conf√©renciers √©quip√©s de panneaux de signalisation.  Un bon moyen de passer la pause entre les performances pour une conversation agr√©able. <br><br><ul><li><h3>  Lightning Talks et discussions informelles </h3></li></ul><br>  Si vous souhaitez r√©diger un court rapport, vous pouvez vous inscrire √† une soir√©e Lightning Talk sur un tableau indicateur et disposer de cinq minutes pour parler de tout ce qui concerne le sujet de la conf√©rence.  Par exemple, une introduction rapide aux d√©sinfectants pour C ++ (qui s'est av√©r√© √™tre nouveau pour certains) ou une histoire sur un bug dans la g√©n√©ration d'une sinuso√Øde que vous pouvez seulement entendre mais pas voir. <br><br>  Un autre format est la table ronde ¬´Avec le comit√© de l'√¢me¬ª.  Sur la sc√®ne, il y a des membres du comit√© de normalisation, sur le projecteur - une chemin√©e (officiellement - pour cr√©er une atmosph√®re √©mouvante, mais la raison ¬´parce que tout est en feu¬ª semble plus dr√¥le), des questions - sur la vision standard et g√©n√©rale du C ++, sans discussions techniques passionn√©es et holivars.  Il s'est av√©r√© que des personnes vivantes si√®gent √©galement au comit√©, qui ne sont peut-√™tre pas compl√®tement s√ªres de quelque chose ou peuvent ne pas savoir quelque chose. <br><br>  Pour les passionn√©s d'Holivar, le troisi√®me √©v√©nement est rest√©: la session BOF ¬´Go Again C ++¬ª.  Nous prenons un amoureux de Go, un amoureux de C ++, avant le d√©but de la session, ils pr√©parent ensemble 100500 diapositives sur le sujet (comme des probl√®mes avec les packages en C ++ ou le manque de g√©n√©riques en Go), puis ils discutent avec eux-m√™mes et le public, et le public essaie de comprendre deux points de vue √† la fois .  Si l'holivar ne d√©marre pas, le mod√©rateur intervient et r√©concilie les parties.  Ce format cr√©e une d√©pendance: quelques heures apr√®s le d√©but, seulement la moiti√© des diapositives ont √©t√© achev√©es.  La fin a d√ª √™tre fortement acc√©l√©r√©e. <br><br><ul><li><h3>  Stands partenaires </h3></li></ul><br>  Les partenaires de la conf√©rence √©taient repr√©sent√©s dans les halls - ils ont parl√© des projets en cours sur les stands, propos√© des stages et des emplois, organis√© des quiz et de petits concours, et ont √©galement jou√© de beaux prix.  Cependant, certaines entreprises ont m√™me propos√© de passer par les premi√®res √©tapes des entretiens, ce qui peut √™tre utile pour ceux qui ne sont pas seulement venus √©couter les reportages. <br><br><h2>  D√©tails techniques des rapports </h2><br>  Nous avons √©cout√© les rapports les deux jours.  Parfois, il √©tait difficile de choisir un rapport parmi ceux qui fonctionnaient en parall√®le - nous avons convenu de partager et d'√©changer les connaissances acquises pendant les pauses.  Et m√™me ainsi, il semble que beaucoup a √©t√© perdu.  Ici, nous aimerions parler du contenu de certains rapports qui nous ont sembl√© les plus int√©ressants <br><br><h3>  Exceptions en C ++ √† travers le prisme des optimisations du compilateur, Roman Rusyaev </h3><br><br><img src="https://habrastorage.org/webt/dc/0q/rl/dc0qrlgt1peqimzact93fvh8zb0.png"><br>  <i><a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">Diapositive de pr√©sentation</a></i> <br><br>  Comme son nom l'indique, Roman a envisag√© de travailler avec des exceptions en utilisant le LLVM comme exemple.  Dans le m√™me temps, pour ceux qui n'utilisent pas Clang dans leur travail, le rapport peut toujours donner une id√©e de la fa√ßon dont le code peut potentiellement √™tre optimis√©.  En effet, les d√©veloppeurs de compilateurs et des biblioth√®ques standard correspondantes communiquent entre eux et de nombreuses solutions r√©ussies peuvent co√Øncider. <br><br>  Ainsi, pour g√©rer l'exception, vous devez effectuer de nombreuses actions: appeler le code de traitement (le cas √©ch√©ant) ou lib√©rer des ressources au niveau actuel et d√©rouler la pile plus haut.  Tout cela conduit au fait que le compilateur ajoute des instructions suppl√©mentaires pour potentiellement lancer des appels.  Par cons√©quent, si une exception n'est en fait pas provoqu√©e, le programme commencera toujours √† effectuer des actions inutiles.  Afin de r√©duire en quelque sorte les frais g√©n√©raux, LLVM a plusieurs heuristiques pour d√©terminer les situations o√π vous n'avez pas besoin d'ajouter un code de gestion des exceptions ou vous pouvez r√©duire le nombre d'instructions "inutiles". <br><br>  L'orateur en examine une dizaine et montre √† la fois les situations o√π elles permettent d'acc√©l√©rer l'ex√©cution du programme, et celles o√π ces m√©thodes ne sont pas applicables. <br><br>  Ainsi, Roman Rusyaev conduit l'auditoire √† la conclusion que le code contenant du travail avec des exceptions ne peut en aucun cas toujours √™tre ex√©cut√© avec une surcharge z√©ro, et donne les conseils suivants: <br><br><ul><li>  lors du d√©veloppement de biblioth√®ques, vous devez abandonner les exceptions en principe; </li><li>  si vous avez encore besoin d'exceptions, dans la mesure du possible, cela vaut la peine d'ajouter des modificateurs noexcept (et const) afin que le compilateur optimise autant que possible. </li></ul><br>  De mani√®re g√©n√©rale, l'orateur a r√©it√©r√© le point de vue selon lequel il vaut mieux utiliser les exceptions au minimum, voire les abandonner. <br><br>  Les diapositives du rapport sont disponibles sur: <a href="https://assets.ctfassets.net/oxjq45e8ilak/6Q09SPvX2Rsveiayc1VkcC/ce9e2b8eb22d6693eb4c3b06968bedc0/100693_477384438_Roman_Rusyayev_Isklyucheniya_C_cherez_prizmu_kompilyatornykh_optimizatsiy.pdf">[¬´Exceptions C ++ via le prisme de l'optimisation du compilateur LLVM¬ª]</a> <br><br><h3>  G√©n√©rateurs, coroutines et autres douceurs c√©r√©brales, Adi Shavit </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/d20/0c4/4a6/d200c44a65058c3b50a29d0b551a9cc0.png"><br>  <i><a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">Diapositive de pr√©sentation</a></i> <br><br>  L'un des nombreux rapports de cette conf√©rence consacr√©e aux innovations du C ++ 20 a √©t√© retenu non seulement par sa pr√©sentation color√©e, mais aussi par sa d√©signation claire des probl√®mes avec la logique de traitement de la collection (pour, boucle de rappel). <br><br>  Adi Shavit souligne les points suivants: les m√©thodes actuellement disponibles parcourent toute la collection et ne donnent pas acc√®s √† un √©tat interm√©diaire interne (ou donnent dans le cas des rappels, mais avec beaucoup d'effets secondaires d√©sagr√©ables, comme le m√™me Callback Hell).  Il semblerait qu'il y ait des it√©rateurs, mais tout ne va pas si bien avec eux: il n'y a pas de points d'entr√©e et de sortie communs (d√©but ‚Üí fin versus rbegin ‚Üí rend et ainsi de suite), on ne sait pas combien allons-nous r√©p√©ter?  √Ä partir de C ++ 20, ces probl√®mes sont r√©solus! <br><br>  La premi√®re option: les plages.  En raison du wrapper au-dessus des it√©rateurs, nous obtenons une interface commune pour le d√©but et la fin de l'it√©ration, ainsi que la possibilit√© de composition.  Tout cela facilite la construction de pipelines de traitement de donn√©es √† part enti√®re.  Mais tout n'est pas si fluide: une partie de la logique des calculs se trouve √† l'int√©rieur de l'impl√©mentation d'un it√©rateur sp√©cifique, ce qui peut compliquer le code de perception et de d√©bogage. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f41/a7d/09d/f41a7d09d24a823a3397aa27a552f254.png"><br>  <i><a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">Diapositive de pr√©sentation</a></i> <br><br>  Eh bien, dans ce cas, des coroutines ont √©t√© ajout√©es en C ++ 20 (fonctions dont le comportement est similaire aux g√©n√©rateurs en Python): l'ex√©cution peut √™tre retard√©e en renvoyant une valeur courante tout en conservant un √©tat interm√©diaire.  Ainsi, nous r√©alisons non seulement le travail avec les donn√©es telles qu'elles apparaissent, mais nous encapsulons √©galement toute la logique √† l'int√©rieur d'une coroutine particuli√®re. <br><br>  Mais il y a une mouche dans la pommade: pour le moment, ils ne sont que partiellement pris en charge par les compilateurs existants, et ils ne sont pas non plus impl√©ment√©s aussi pr√©cis√©ment que nous le souhaiterions: par exemple, les liens et les objets temporaires ne devraient pas √™tre utilis√©s dans les coroutines.  De plus, il existe certaines restrictions sur ce qui peut √™tre des coroutines, et les fonctions constexpr, les constructeurs / destructeurs et les principaux ne sont pas inclus dans cette liste. <br><br>  Ainsi, les coroutines r√©solvent une partie importante des probl√®mes de simplicit√© de la logique de traitement des donn√©es, mais leurs impl√©mentations actuelles n√©cessitent un raffinement. <br><br>  Mat√©riaux: <br><br><ul><li>  Slides with C ++ Russia - <a href="https://assets.ctfassets.net/oxjq45e8ilak/3zTOtMpTyFdmP3vxsQ9xoc/40e5a0892609b16f822120813f5f0823/100554_1921552449_Adi_Shavit_Generators_coroutines_and_other_brain-unrolling_sweetness.pdf">["G√©n√©rateurs, coroutines et autres douceurs c√©r√©brales"]</a> </li><li>  <a href="https://youtu.be/qYHDERleSL8">Reportage vid√©o de CppCon 2019</a> </li></ul><br><h3>  Astuces C ++ de Yandex.Taxi, Anton Polukhin </h3><br>  Dans son activit√© professionnelle, il faut parfois impl√©menter des choses purement auxiliaires: un wrapper entre l'interface interne et l'API d'une biblioth√®que, la journalisation ou l'analyse.  Cependant, il n'y a g√©n√©ralement pas besoin d'optimisation suppl√©mentaire.  Mais que faire si ces composants sont utilis√©s dans certains des services les plus populaires de Runet?  Dans une telle situation, vous devrez traiter des t√©raoctets par heure de journaux seuls!  Ensuite, chaque milliseconde compte et vous devez donc recourir √† diverses astuces - Anton Polukhin en a parl√©. <br><br>  L'exemple le plus int√©ressant est peut-√™tre l'impl√©mentation du mod√®le pointeur vers impl√©mentation (pimpl). <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;third_party/json.hpp&gt; //PROBLEMS! struct Value { Value() = default; Value(Value&amp;&amp; other) = default; Value&amp; operator=(Value&amp;&amp; other) = default; ~Value() = default; std::size_t Size() const { return data_.size(); } private: third_party::Json data_; };</span></span></span></span></code> </pre> <br>  Dans cet exemple, vous voulez d'abord vous d√©barrasser des fichiers d'en-t√™te des biblioth√®ques externes - il se compilera plus rapidement et vous pourrez vous prot√©ger contre d'√©ventuels conflits de noms et d'autres erreurs similaires. <br><br>  Ok, d√©plac√© #include dans le fichier .cpp: vous avez besoin de la d√©claration directe de l'API encapsul√©e, ainsi que de std :: unique_ptr.  Nous avons maintenant des allocations dynamiques et d'autres choses d√©sagr√©ables, comme des donn√©es dispers√©es sur un tas et des garanties r√©duites.  Avec tout cela, std :: align√©_storage peut vous aider. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Value</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... private: using JsonNative = third_party::Json; const JsonNative* Ptr() const noexcept; JsonNative* Ptr() noexcept; constexpr std::size_t kImplSize = 32; constexpr std::size_t kImplAlign = 8; std::aligned_storage_t&lt;kImplSize, kImplAlign&gt; data_; };</span></span></code> </pre> <br>  Le seul probl√®me: nous devons d√©finir la taille et l'alignement de chaque wrapper - nous allons cr√©er notre mod√®le de bouton avec les param√®tres &lt;T, SizeT, AlignmentT&gt;, utiliser des valeurs arbitraires et ajouter au destructeur une v√©rification que nous avons tout devin√©: <br><br><pre> <code class="cpp hljs">~FastPimpl() <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { validate&lt;<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T), <span class="hljs-keyword"><span class="hljs-keyword">alignof</span></span>(T)&gt;(); Ptr()-&gt;~T(); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> ActualSize, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> ActualAlignment&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>( Size == ActualSize, <span class="hljs-string"><span class="hljs-string">"Size and sizeof(T) mismatch"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>( Alignment == ActualAlignment, <span class="hljs-string"><span class="hljs-string">"Alignment and alignof(T) mismatch"</span></span> ); }</code> </pre> <br>  Puisque T a d√©j√† √©t√© d√©termin√© lors du traitement du destructeur, ce code sera d√©mont√© correctement et au stade de la compilation sous forme d'erreurs, il affichera la taille n√©cessaire et les valeurs d'alignement qui doivent √™tre saisies.  Ainsi, au prix d'un d√©but de compilation suppl√©mentaire, nous nous d√©barrassons de l'allocation dynamique des classes encapsul√©es, masquons l'API dans un fichier .cpp avec l'impl√©mentation, et obtenons √©galement une conception plus adapt√©e √† la mise en cache par le processeur. <br><br>  La journalisation et l'analyse semblaient moins impressionnantes et ne seront donc pas mentionn√©es dans cette revue. <br><br>  Les diapositives du rapport sont disponibles sur le lien: <a href="https://assets.ctfassets.net/oxjq45e8ilak/4rkoaQV6ancsfvzYx1fOCF/087dda7d63101cc225d706d03d7c5075/100566_2093066332_Anton_Polukhin_C_tryuki_iz_Taksi.pdf">[¬´Trucs de taxi C ++¬ª]</a> <br><br><h3>  Techniques modernes pour garder votre code SEC, Bj√∂rn Fahller </h3><br>  Dans cet expos√©, Bj√∂rn Fahller montre plusieurs fa√ßons diff√©rentes de traiter les d√©fauts stylistiques tels que les v√©rifications conditionnelles r√©p√©t√©es: <br><br><pre> <code class="cpp hljs">assert(a == IDLE || a == CONNECTED || a == DISCONNECTED);</code> </pre> <br>  Est-ce familier?  En utilisant plusieurs techniques C ++ puissantes qui sont apparues dans les normes r√©centes, vous pouvez impl√©menter gracieusement la m√™me fonctionnalit√© sans la moindre perte de performances.  Comparez: <br><br><pre> <code class="cpp hljs">assert(a == any_of(IDLE, CONNECTED, DISCONNECTED));</code> </pre> <br>  Pour traiter un nombre illimit√© de v√©rifications, vous √™tes imm√©diatement invit√© √† utiliser des mod√®les variadiques et des expressions de repli.  Supposons que nous voulons v√©rifier l'√©galit√© de plusieurs variables avec l'√©l√©ment enum'a state_type.  La premi√®re chose qui me vient √† l'esprit est d'√©crire la fonction d'assistance is_any_of: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> state_type { IDLE, CONNECTED, DISCONNECTED }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ... Ts&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_any_of</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state_type s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Ts&amp; ... ts)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((s == ts) || ...); }</code> </pre><br>  Un tel r√©sultat interm√©diaire est d√©cevant.  Jusqu'√† pr√©sent, le code ne devient pas lisible: <br><br><pre> <code class="cpp hljs">assert(is_any_of(state, IDLE, DISCONNECTING, DISCONNECTED));</code> </pre> <br>  Les param√®tres de mod√®le non-type aideront √† am√©liorer un peu la situation.  Avec leur aide, nous transf√©rons les √©l√©ments √©num√©r√©s enum vers la liste des param√®tres du mod√®le: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;state_type ... states&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_any_of</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state_type t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((t == states) | ...); } assert(is_any_of&lt;IDLE, DISCONNECTING, DISCONNECTED&gt;(state));</code> </pre> <br>  En utilisant auto dans un param√®tre de mod√®le non typique (C ++ 17), l'approche est simplement g√©n√©ralis√©e aux comparaisons non seulement avec les √©l√©ments state_type, mais aussi avec les types primitifs qui peuvent √™tre utilis√©s comme param√®tres de mod√®le non-type: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ... alternatives, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_any_of</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((t == alternatives) | ...); }</code> </pre> <br>  Gr√¢ce √† ces am√©liorations incr√©mentielles, la syntaxe superficielle souhait√©e pour la v√©rification est obtenue: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> ... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any_of</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::tuple&lt;Ts ...&gt; { <span class="hljs-comment"><span class="hljs-comment">//      tuple        using std::tuple&lt;Ts ...&gt;::tuple;        template &lt;typename T&gt;        bool operator ==(const T&amp; t) const {                return std::apply(                        [&amp;t](const auto&amp; ... ts) {                                return ((ts == t) || ...);                        },                        static_cast&lt;const std::tuple&lt;Ts ...&gt;&amp;&gt;(*this));        } }; template &lt;class ... Ts&gt; any_of(Ts ...) -&gt; any_of&lt;Ts ... &gt;; assert(any_of(IDLE, DISCONNECTING, DISCONNECTED) == state);</span></span></code> </pre><br>  Dans cet exemple, le guide de d√©duction sert √† inviter les param√®tres de structure de mod√®le souhait√©s √† un compilateur qui conna√Æt les types d'arguments du constructeur. <br><br>  Plus int√©ressant.  Bjorn apprend √† g√©n√©raliser le code r√©sultant pour les op√©rateurs de comparaison en plus de ==, puis pour les op√©rations arbitraires.  Avec l'exemple d'utilisation, des fonctionnalit√©s telles que l'attribut no_unique_address (C ++ 20) et les param√®tres de mod√®le dans les fonctions lambda (C ++ 20) sont expliqu√©es.  (Oui, maintenant la syntaxe lambd est encore plus facile √† retenir - ce sont quatre paires cons√©cutives de parenth√®ses de toutes sortes.) La solution finale utilisant des fonctions comme parties constructeurs me r√©chauffe vraiment l'√¢me, sans parler de l'expression de tuple dans les meilleures traditions du calcul lambda. <br><br>  Au final, n'oubliez pas de mettre un gloss: <br><br><ul><li>  Rappelez-vous que les lambdas sont constexpr gratuitement; </li><li>  Ajoutez une transmission parfaite et regardez sa syntaxe laide appliqu√©e au pack de param√®tres dans la fermeture lambda; </li><li>  Donnons au compilateur plus d'options pour les optimisations avec noexcept conditionnel; </li><li>  Nous nous occuperons d'une sortie d'erreur plus claire dans les mod√®les en raison des valeurs de retour explicites des lambdas.  Cela obligera le compilateur √† effectuer plus de v√©rifications avant d'appeler r√©ellement la fonction de mod√®le - au stade de la v√©rification de type. </li></ul><br>  Pour plus de d√©tails, reportez-vous aux supports de cours: <br><br><ul><li>  Diapositives de rapport: <a href="https://assets.ctfassets.net/oxjq45e8ilak/7lP3ueTFEJnmdVjGGjrgHI/e30dfcbff0630fb63389f3f3e734a1a3/100644_2039674689_Bjrn_Fahller_Modern_techniques_for_keeping_your_code_dry.pdf">[Techniques modernes pour garder votre code au sec]</a> </li><li>  <a href="https://github.com/rollbear/dry-comparisons">Code source Github</a> </li><li>  <a href="https://playfulprogramming.blogspot.com/2018/07/dry-multicomparisons.html">Article de blog de l'auteur</a> </li></ul><br><h2>  Nos impressions </h2><br>  Notre premi√®re participation √† C ++ Russia √©tait connue pour sa richesse.  Il y avait une impression de C ++ Russia comme un √©v√©nement √©motionnel, o√π la fronti√®re entre l'apprentissage et la communication en direct n'est presque pas perceptible.  Tout, de l'humeur des intervenants aux comp√©titions des partenaires de l'√©v√©nement, est propice √† des discussions anim√©es.  Le contenu de la conf√©rence, qui se compose de rapports, couvre un assez large √©ventail de sujets, y compris les innovations C ++, des exemples tir√©s de la pratique de grands projets et des consid√©rations architecturales id√©ologiques.  Mais il serait injuste de priver l'attention de la composante sociale de l'√©v√©nement, ce qui aide √† surmonter les barri√®res linguistiques par rapport non seulement au C ++. <br><br>  Nous remercions les organisateurs de la conf√©rence de l'opportunit√© de participer √† un tel √©v√©nement! <br>  Vous pouvez voir le post des organisateurs sur le pass√©, le pr√©sent et l'avenir de C ++ Russia <a href="https://habr.com/ru/company/jugru/blog/480584/">sur le blog JUG Ru</a> . <br><br>  Merci d'avoir lu, et nous esp√©rons que notre r√©cit des √©v√©nements s'est av√©r√© utile! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481358/">https://habr.com/ru/post/fr481358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481348/index.html">Pentest Active Directory. Partie 1</a></li>
<li><a href="../fr481350/index.html">Qui travaille au cosmodrome de Plesetsk</a></li>
<li><a href="../fr481352/index.html">DBA: effacement des enregistrements de clone d'une table sans PK</a></li>
<li><a href="../fr481354/index.html">TelegramBot. La fonctionnalit√© de base. Mouches s√©par√©ment, c√¥telettes s√©par√©ment. (2e partie)</a></li>
<li><a href="../fr481356/index.html">Merci, 2019</a></li>
<li><a href="../fr481360/index.html">Les r√©sultats de la semaine: Rambler et Twitch ont convenu, le travail √©lectronique sera introduit en F√©d√©ration de Russie et Facebook cr√©era son propre syst√®me d'exploitation</a></li>
<li><a href="../fr481362/index.html">Certificat SSL pour l'application web Docker</a></li>
<li><a href="../fr481364/index.html">La maison sensible remplace les maisons intelligentes</a></li>
<li><a href="../fr481366/index.html">RICE: Priorisation facile pour les chefs de produit</a></li>
<li><a href="../fr481368/index.html">Test aveugle de l'appareil photo: iPhone, Pixel, Samsung et Huawei</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>