<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂ ‚òéÔ∏è üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© Aprendizado de m√°quina como assistente de monitoramento inteligente üôãüèæ ‚ô†Ô∏è üíâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Habr! 

 O cr√©dito √† habita√ß√£o √© um sistema grande e muito din√¢mico, que √†s vezes √© dif√≠cil de acompanhar. Para ajudar os funcion√°rios a acompanhar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendizado de m√°quina como assistente de monitoramento inteligente</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/homecredit/blog/479712/">  Oi Habr! <br><br>  O cr√©dito √† habita√ß√£o √© um sistema grande e muito din√¢mico, que √†s vezes √© dif√≠cil de acompanhar.  Para ajudar os funcion√°rios a acompanhar todas as novidades e mudan√ßas e acompanhar o ritmo em todos os lugares, estamos introduzindo ativamente algoritmos de aprendizado de m√°quina.  Em nosso banco, os bots de bate-papo j√° fazem parte do trabalho dos operadores, as an√°lises de clientes s√£o analisadas n√£o apenas por especialistas, mas tamb√©m por algoritmos inteligentes para o processamento de linguagem natural. <br><br>  Hoje vou contar como ajudamos os especialistas na opera√ß√£o de servi√ßos banc√°rios a se livrarem da necessidade de olhar constantemente para os pain√©is dos sistemas de monitoramento, ou seja, eles pediram que o aprendizado de m√°quina o ajudasse.  Foi o que conseguimos. <br><br><img src="https://habrastorage.org/webt/jd/w9/xp/jdw9xpbwninwrbz9e8p6heid8o0.png" alt="imagem"><br><a name="habracut"></a><br><h2>  Como funciona o monitoramento manual? </h2><br>  O local de trabalho t√≠pico de um especialista em opera√ß√µes √© semelhante √† figura acima e ele passa a maior parte do tempo olhando para pain√©is.  Qualquer atividade suspeita no sistema, por exemplo, quando a rede cair ou chover uma NullPointerException, atrair√° imediatamente a aten√ß√£o - uma investiga√ß√£o come√ßar√° imediatamente. <br><br>  O homem n√£o √© uma m√°quina.  Ele pode se distrair, ir jantar, atender o telefone.  E quando o n√∫mero de gr√°ficos excede cem, torna-se dif√≠cil amarr√°-los todos e chegar ao fundo da ess√™ncia. <br><br>  Outro problema √© que h√° uma fam√≠lia de erros que ocorrem constantemente, mas n√£o afetam seriamente o comportamento do sistema.  Por exemplo, um microsservi√ßo de terceiros caiu e os pain√©is tremeram notavelmente, mas, na verdade, o sistema est√° fora de perigo.  √Ä primeira vista, nem sempre √© claro como o comportamento anormal √© cr√≠tico e o que est√° por tr√°s dele.  Para estabelecer os motivos em detalhes, voc√™ precisa ir ao servidor e aprofundar-se nos logs.  Essa opera√ß√£o deve ser realizada dezenas de vezes ao dia.  Vamos pelo menos confi√°-la parcialmente no carro. <br><br><h2>  Aprendizado de m√°quina como um assistente inteligente </h2><br>  Existem tr√™s fontes principais de dados: Zabbix, ElasticSearch e um sistema interno de monitoramento de m√©tricas de neg√≥cios.  Usamos o Zabbix para monitorar o hardware, a rede e a disponibilidade de v√°rios pontos de entrada nos sistemas.  Usando o ElasticSearch, analise e extraia o log de mensagens.  V√°rios erros, execu√ß√µes e consultas s√£o usados ‚Äã‚Äãcomo m√©tricas.  Os analistas de neg√≥cios, no entanto, monitoram o desempenho dos usu√°rios: o n√∫mero de transfer√™ncias, vendas e outras atividades de neg√≥cios.  Os dados s√£o coletados com uma frequ√™ncia de uma vez por minuto e adicionados ao banco de dados.  Bem, como os dados s√£o coletados, √© hora de escrever um monte de ifs para colocar o aprendizado de m√°quina em batalha. <br><br>  Formulamos o problema da seguinte maneira: tendo as m√©tricas do sistema na entrada, classificaremos o estado final do sistema: regular ou anormal.  Nesse cen√°rio, o problema se encaixa perfeitamente no paradigma da aprendizagem com um professor.  Isso significa que todo o conjunto de dados de treinamento deve ser rotulado.  Em outras palavras, cada minuto da opera√ß√£o do sistema deve ter um r√≥tulo de 0 (comportamento normal) ou -1 (comportamento an√¥malo). <br><br>  Na vida, acontece que nem tudo √© t√£o r√≥seo quanto gostar√≠amos.  Como regra, nem todos os incidentes s√£o registrados no JIRA, muito permanece no correio e n√£o vai al√©m, e √†s vezes os prazos da anomalia s√£o borrados ou imprecisos.  Acontece que criar um conjunto de dados de alta qualidade no campo de dados hist√≥ricos n√£o √© uma tarefa trivial. <br><br>  Enquanto os novos dados est√£o apenas come√ßando a ser definidos, vamos tentar extrair os benef√≠cios do que j√° temos.  Nos casos em que os dados n√£o possuem uma marca√ß√£o, s√£o utilizados algoritmos de aprendizado sem um professor.  Prosseguiremos com o fato de que na maioria das vezes o sistema funciona corretamente, mas ocasionalmente acontecem imprevistos: bugs (onde sem eles), a base caiu, ou, por exemplo, a escavadeira Petr atingiu o cabo do data center.  Portanto, reduzimos nossa tarefa √† busca de anomalias, a saber, a busca de um novo comportamento do sistema (Novelty Detection). <br>  Para fazer isso, use o algoritmo Floresta isolada.  Ele j√° est√° implementado na biblioteca sklearn.  Usaremos m√©tricas dos sistemas de monitoramento como recursos. <br><br><pre><code class="python hljs">clf = IsolationForest(behaviour=<span class="hljs-string"><span class="hljs-string">'new'</span></span>, max_samples=<span class="hljs-number"><span class="hljs-number">100</span></span>, random_state=rng, contamination=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>)</code> </pre> <br>  Treinaremos Floresta Isolada em dados hist√≥ricos e usaremos os novos dados que j√° conseguimos marcar para avaliar a qualidade.  Portanto, resta escolher os hiperpar√¢metros do modelo e o tamanho do conjunto de dados para treinamento. <br><br>  Agora, os dados de status, coletados a cada minuto, s√£o inseridos no modelo treinado e obt√™m o r√≥tulo 0 ou -1. <br><br><img src="https://habrastorage.org/webt/2j/wi/ly/2jwilytbwxdl-guvfftwujzbsjs.png" alt="imagem"><br><br>  Um operador pode rastrear apenas uma programa√ß√£o.  No eixo X - tempo, no escore da anomalia Y, isto √©, com que intensidade o modelo considerou o estado do sistema neste minuto anormal.  Se o valor da velocidade passou pelo compartimento do lixo (que o modelo seleciona por si mesmo), o ponto √© colorido em vermelho e uma anomalia √© registrada. <br><br>  Agora aprendemos que o sistema opera em um modo incomum ou que uma situa√ß√£o de emerg√™ncia aconteceu quase em tempo real.  Isso √© muito bom, mas e o operador na hora de receber o sinal sobre a anomalia?  Qual painel olhar?  Vamos tentar abrir a ‚Äúcaixa preta‚Äù do nosso modelo e entender como ele toma decis√µes. <br><br><h2>  Interpretando um modelo usando LIME </h2><br><br>  Existem diferentes abordagens sobre como abrir a caixa preta de um modelo treinado e entender o que est√° na mente da m√°quina.  Com uma regress√£o log√≠stica ou uma √°rvore de decis√£o, tudo fica claro, n√£o √© dif√≠cil entender com base na qual a decis√£o foi tomada.  Com a Floresta Isolada, as coisas s√£o mais complicadas.  Primeiro, h√° um acidente dentro do algoritmo e, segundo, √© um algoritmo de aprendizado sem professor. <br><br>  O primeiro candidato foi a biblioteca LIME, que utiliza a abordagem agn√≥stica do modelo, que ajuda a interpretar qualquer modelo, o principal √© que a sa√≠da do modelo tem uma distribui√ß√£o probabil√≠stica entre as classes.  Ok, √© claro, o resultado n√£o √© probabilidade, mas em breve, mas vamos tentar normaliz√°-los no intervalo de 0 a 1 e trat√°-lo como probabilidade.  Assim, conseguimos fornecer um formato de entrada compat√≠vel com o LIME. <br>  A maneira como o LIME interpretou os resultados foi decepcionante.  Em primeiro lugar, como interpreta√ß√£o, havia v√°rios sinais mais importantes na sa√≠da e, na maioria dos casos, apenas um deles realmente refletia adequadamente a ess√™ncia da decis√£o, e o restante acrescentava ru√≠do.  A segunda desvantagem era que a interpreta√ß√£o era inst√°vel e frequentemente produzia diferentes listas de sinais de uma corrida para outra.  Para obter resultados mais est√°veis, era necess√°rio executar a interpreta√ß√£o v√°rias vezes e, de alguma forma, calcular a m√©dia dos resultados.  Eu realmente n√£o queria fazer isso. <br><br><h2>  SHAP - ponte de pessoa para carro </h2><br>  Depois disso, nossos olhos se voltaram para outra biblioteca para a interpreta√ß√£o de modelos - SHAP.  A id√©ia por tr√°s da biblioteca veio da teoria dos jogos.  A biblioteca tamb√©m tem uma bela visualiza√ß√£o.  Depois de examinar os exemplos, percebemos com frustra√ß√£o que o SHAP n√£o conseguia interpretar a Floresta Isolada, e realmente quer√≠amos!  Mas, por outro lado, o SHAP pode dissecar o XGBoost com confian√ßa.  Pensamos: e se formos ensinados a fazer o XGBoost a mesma coisa que a Floresta Isolada pode fazer?  Para fazer isso, pegamos todo o conjunto de dados e o marcamos com Floresta isolada.  Al√©m disso, como alvo, eles n√£o tiveram uma aula, mas uma pontua√ß√£o, que foi atribu√≠da √† Floresta Isolada.  Vamos prever por todas as m√©tricas a velocidade que a Floresta Isolada daria, mas apenas com o XGBoot!  Mal disse o que fez.  Executaremos nosso conjunto de dados marcado atrav√©s do XGBoost.  E agora, agora ele sabe prever a velocidade da mesma maneira que a Floresta Isolada.  Viva, agora podemos usar o SHAP! <br><br>  A primeira etapa √© criar um objeto TreeExplainer, passando o pr√≥prio modelo como par√¢metro.  Em seguida, os valores de shap s√£o calculados, o que nos permite dar uma explica√ß√£o de como o modelo tomou essa ou aquela decis√£o. <br><br><pre> <code class="python hljs">explainer = shap.TreeExplainer(model) shap_values = explainer.shap_values(X)</code> </pre> <br>  O SHAP permite interpretar o modelo como um todo e os resultados para exemplos espec√≠ficos.  Por exemplo, voc√™ pode obter uma explica√ß√£o para um exemplo espec√≠fico usando o m√©todo force_plot (), que recebe os valores de entrada e os valores do pr√≥prio exemplo. <br><br><pre> <code class="python hljs">shap.force_plot(explainer.expected_value,shap_values[<span class="hljs-number"><span class="hljs-number">0</span></span>,:], X.iloc[<span class="hljs-number"><span class="hljs-number">0</span></span>,:])</code> </pre> <br>  O gr√°fico a seguir mostra quais recursos do modelo e o quanto influenciaram a decis√£o. <br><br><img src="https://habrastorage.org/webt/k4/he/-u/k4he-ucq5b7zsyjnyc-rwbpmrtg.png" alt="imagem"><br><br><h2>  Ajudamos os neg√≥cios </h2><br>  Agora, sabendo quais m√©tricas contribu√≠ram significativamente para a taxa geral de anormalidade, torna-se poss√≠vel estabelecer em que n√≠vel o problema surgiu e, o mais importante, se afetou os usu√°rios finais do sistema. <br><br><img src="https://habrastorage.org/webt/wp/rp/6g/wprp6gc-gzbjzotptcjvb6hlj9a.png" alt="imagem"><br><br>  Cada vez que uma anomalia √© detectada, √© obtida uma lista de m√©tricas que t√™m maior impacto na decis√£o.  Se a lista incluir m√©tricas que rastreiam diretamente indicadores relacionados aos neg√≥cios, isso √© mencionado no alerta de uma maneira especial, aumentando automaticamente a prioridade da anomalia. <br><br>  Este √© apenas o primeiro, mas importante, passo para fortalecer e automatizar o sistema de monitoramento usando o aprendizado de m√°quina, o que pode aumentar significativamente a velocidade de identifica√ß√£o das causas e influ√™ncia do comportamento anormal do sistema. <br><br>  <b>Refer√™ncias:</b> <br><br>  <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html</a> <br>  <a href="https://github.com/marcotcr/lime">github.com/marcotcr/lime</a> <br>  <a href="https://github.com/slundberg/shap">github.com/slundberg/shap</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479712/">https://habr.com/ru/post/pt479712/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479696/index.html">Algumas palavras sobre Alter Table, ou como n√£o faz√™-lo</a></li>
<li><a href="../pt479700/index.html">CIMON-2: (des) Doomsday, ou como o IBM Watson subiu acima das nuvens</a></li>
<li><a href="../pt479702/index.html">Torradeira, Meu c√≠rculo e Freelansim se tornam parte da Habr</a></li>
<li><a href="../pt479704/index.html">Escalonamento de privil√©gios no cliente EA Origin Windows (CVE-2019-19247 e CVE-2019-19248)</a></li>
<li><a href="../pt479708/index.html">Postagem n√£o oficial sobre a rebranding da Habr + Competition</a></li>
<li><a href="../pt479714/index.html">Unifica√ß√£o de componentes visuais. Parte 1. Estilos</a></li>
<li><a href="../pt479716/index.html">Outro SuperApp "primeiro do mundo"</a></li>
<li><a href="../pt479718/index.html">Construindo um aplicativo de ambiente arduino usando o CI github</a></li>
<li><a href="../pt479724/index.html">Verdadeiros hackers acabaram</a></li>
<li><a href="../pt479726/index.html">Vladimir aka wowik: ‚ÄúO OpenStreetMap precisa de id√©ias que n√£o s√£o realiz√°veis ‚Äã‚Äãem outros sistemas‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>