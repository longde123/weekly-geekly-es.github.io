<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”Ÿ ğŸ§›ğŸ¾ ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¾ Goä¸­çš„å“ˆå¸Œè¡¨ã€‚ å®æ–½ç»†èŠ‚ ğŸ‘¾ ã€½ï¸ ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å°†è®¨è®ºä¸ä½¿ç”¨æ³›å‹çš„è¯­è¨€ä¸­Mapçš„å®ç°ï¼Œè€ƒè™‘ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Œå¦‚ä½•åœ¨Goä¸­è¿›è¡Œæ’åˆ—ï¼Œæ­¤å®ç°çš„åˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Œä»¥åŠåœ¨ä½¿ç”¨æ­¤ç»“æ„æ—¶åº”æ³¨æ„çš„äº‹é¡¹ã€‚ 

 ç»†èŠ‚å‰ªä¸‹ã€‚ 


 æ³¨æ„ï¼ å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰Goä¸­çš„å“ˆå¸Œè¡¨ï¼Œå»ºè®®æ‚¨è·³è¿‡åŸºç¡€çŸ¥è¯†ï¼Œç„¶åè½¬åˆ°æ­¤å¤„ ï¼Œå¦åˆ™å¯èƒ½ä¼šåŒå€¦æœ€æœ‰è¶£çš„æ—¶åˆ»ã€‚ 

 ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ 
 é¦–å…ˆï¼Œæˆ‘ä¼š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Goä¸­çš„å“ˆå¸Œè¡¨ã€‚ å®æ–½ç»†èŠ‚</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457728/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb1/923/9cc/eb19239cc91d38445932da1ade5a5e7d.png" alt="å›¾ç‰‡" width="400" height="400"></div><br><br> æˆ‘ä»¬å°†è®¨è®ºä¸ä½¿ç”¨æ³›å‹çš„è¯­è¨€ä¸­Mapçš„å®ç°ï¼Œè€ƒè™‘ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Œå¦‚ä½•åœ¨Goä¸­è¿›è¡Œæ’åˆ—ï¼Œæ­¤å®ç°çš„åˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Œä»¥åŠåœ¨ä½¿ç”¨æ­¤ç»“æ„æ—¶åº”æ³¨æ„çš„äº‹é¡¹ã€‚ <br><br> ç»†èŠ‚å‰ªä¸‹ã€‚ <br><a name="habracut"></a><br><hr><br> æ³¨æ„ï¼ å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰Goä¸­çš„å“ˆå¸Œè¡¨ï¼Œå»ºè®®æ‚¨è·³è¿‡åŸºç¡€çŸ¥è¯†ï¼Œç„¶åè½¬åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a> ï¼Œå¦åˆ™å¯èƒ½ä¼šåŒå€¦æœ€æœ‰è¶£çš„æ—¶åˆ»ã€‚ <br><br><h4> ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ </h4><br> é¦–å…ˆï¼Œæˆ‘ä¼šæé†’æ‚¨ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ã€‚ è¿™æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå…è®¸æ‚¨å­˜å‚¨é”®å€¼å¯¹ï¼Œå¹¶ä¸”é€šå¸¸å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š <br><br><ul><li> æ˜ å°„ï¼š <code>map(key) â†’ value</code> <br></li><li> æ’å…¥ï¼š <code>insert(map, key, value)</code> <br></li><li> åˆ é™¤ï¼š <code>delete(map, key)</code> <br></li><li> æœç´¢ï¼š <code>lookup(key) â†’ value</code> <br></li></ul><br><h4>  Goè¯­è¨€ä¸­çš„å“ˆå¸Œè¡¨ </h4><br>  goè¯­è¨€çš„å“ˆå¸Œè¡¨ç”±mapå…³é”®å­—è¡¨ç¤ºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€è¿›è¡Œå£°æ˜ï¼ˆç¨åä¼šè¯¦ç»†ä»‹ç»ï¼‰ï¼š <br><br><pre> <code class="go hljs"> m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[key_type]value_type) m := <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[key_type]value_type) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[key_type]value_type m := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[key_type]value_type{key1: val1, key2: val2}</code> </pre><br> ä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š <br><br><ul><li> æ’å…¥ï¼š <br><br><pre> <code class="go hljs">m[key] = value</code> </pre> <br></li><li> å»é™¤ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-built_in"><span class="hljs-built_in">delete</span></span>(m, key)</code> </pre> <br></li><li> æœç´¢ï¼š <br><br><pre> <code class="go hljs">value = m[key]</code> </pre> <br> æˆ– <br><br><pre> <code class="go hljs">value, ok = m[key]</code> </pre> </li></ul><br><h4> å›´ç€æ¡Œå­èµ° </h4><br> è€ƒè™‘ä»¥ä¸‹ç¨‹åºï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { m := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++ { m[i] = ((i % <span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> m { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"key: %d, value: %t\n"</span></span>, k, v) } }</code> </pre><br> å‘å°„1ï¼š <br><br><pre> <code class="plaintext hljs">key: 3, value: false key: 4, value: true key: 0, value: true key: 1, value: false key: 2, value: true</code> </pre><br> è¿è¡Œ2ï¼š <br><br><pre> <code class="plaintext hljs">key: 4, value: true key: 0, value: true key: 1, value: false key: 2, value: true key: 3, value: false</code> </pre><br> å¦‚æ‚¨æ‰€è§ï¼Œè¾“å‡ºåœ¨æ¯æ¬¡è¿è¡Œä¸­éƒ½ä¸åŒã€‚ æ‰€æœ‰è¿™äº›éƒ½æ˜¯å› ä¸ºGoä¸­çš„åœ°å›¾æ˜¯æ— åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯æ— åºçš„ã€‚ è¿™æ„å‘³ç€æ‚¨åœ¨èµ°åŠ¨æ—¶ä¸éœ€è¦ä¾èµ–é¡ºåºã€‚ åŸå› å¯ä»¥åœ¨è¯­è¨€è¿è¡Œæ—¶çš„æºä»£ç ä¸­æ‰¾åˆ°ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// mapiterinit initializes the hiter struct used for ranging over maps. func mapiterinit(t *maptype, h *hmap, it *hiter) {... // decide where to start r := uintptr(fastrand()) ... it.startBucket = r &amp; bucketMask(hB)...}</span></span></code> </pre><br> æœç´¢ä½ç½®æ˜¯<b>éšæœº</b>ç¡®å®šçš„ï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼ æœ‰ä¼ è¨€è¯´è¿è¡Œæ—¶å¼€å‘äººå‘˜å¼ºè¿«ç”¨æˆ·ä¸è¦ä¾èµ–é¡ºåºã€‚ <br><br><h4> å»è¡¨æœç´¢ </h4><br> è®©æˆ‘ä»¬å†æ¬¡çœ‹ä¸€æ®µä»£ç ã€‚ å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºâ€œæ•°å­—â€-â€œæ•°å­—ä¹˜ä»¥10â€å¯¹ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { m := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>{<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>} fmt.Println(m, m[<span class="hljs-number"><span class="hljs-number">0</span></span>], m[<span class="hljs-number"><span class="hljs-number">1</span></span>], m[<span class="hljs-number"><span class="hljs-number">2</span></span>]) }</code> </pre><br> æˆ‘ä»¬æ¨å‡ºï¼š <br><br><pre> <code class="plaintext hljs">map[0:0 1:10] 0 10 0</code> </pre><br> è€Œä¸”æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬å°è¯•è·å–2çš„å€¼ï¼ˆæˆ‘ä»¬å¿˜è®°æ”¾ç½®ï¼‰æ—¶ï¼Œå¾—åˆ°0ã€‚æˆ‘ä»¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>æ‰¾åˆ°è§£é‡Šæ­¤è¡Œä¸ºçš„è¡Œï¼šâ€œå°è¯•ä½¿ç”¨æ˜ å°„ä¸­ä¸å­˜åœ¨çš„é”®æ¥è·å–æ˜ å°„å€¼å°†è¿”å›é›¶å€¼ã€‚ â€ï¼Œä½†ç¿»è¯‘æˆä¿„è¯­ï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬å°è¯•ä»åœ°å›¾ä¸­è·å–å€¼ï¼Œä½†ä¸å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°â€œé›¶ç±»å‹å€¼â€ï¼Œå¦‚æœæ˜¯æ•°å­—0ï¼Œè¯¥å€¼ï¼Œè¯¥æ€ä¹ˆåšï¼Œæˆ‘ä»¬æ˜¯å¦è¦åŒºåˆ†æ¡ˆä¾‹0å’Œç¼ºå¸­2ï¼Ÿ ä¸ºæ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç‰¹æ®Šçš„â€œå¤šé‡åˆ†é…â€å½¢å¼-æ˜ å°„è¿”å›ä¸€ä¸ªå¯¹ï¼Œè€Œä¸æ˜¯é€šå¸¸çš„å•ä¸ªå€¼ï¼šè¯¥å€¼æœ¬èº«å’Œå¦ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºå›ç­”æ˜ å°„ä¸­æ˜¯å¦å­˜åœ¨æ‰€è¯·æ±‚çš„é”®çš„é—®é¢˜â€œ <br><br> æ­£ç¡®åœ°ï¼Œå‰é¢çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { m := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>{<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>} m2, ok := m[<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !ok { <span class="hljs-comment"><span class="hljs-comment">// somehow process this case m2 = 20 } fmt.Println(m, m[0], m[1], m2) }</span></span></code> </pre><br> åœ¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š <br><br> <code>map[0:0 1:10] 0 10 20 <br></code> <br><h4> åœ¨Goä¸­åˆ›å»ºä¸€ä¸ªè¡¨ã€‚ </h4><br> å‡è®¾æˆ‘ä»¬è¦è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯çš„å‡ºç°æ¬¡æ•°ï¼Œä¸ºæ­¤å¯åŠ¨ä¸€ä¸ªå­—å…¸å¹¶éå†å®ƒã€‚ <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, word := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{<span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span>, <span class="hljs-string"><span class="hljs-string">"from"</span></span>, <span class="hljs-string"><span class="hljs-string">"the"</span></span>, <span class="hljs-string"><span class="hljs-string">"best"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>, <span class="hljs-string"><span class="hljs-string">"in"</span></span>, <span class="hljs-string"><span class="hljs-string">"the"</span></span>, <span class="hljs-string"><span class="hljs-string">"world"</span></span>} { m[word]++ } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> m { <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(k, v) } }</code> </pre><br> ä½ çœ‹åˆ°<s>åœ°é¼ äº†</s>å—ï¼Ÿ  -ä»–æ˜¯ï¼ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c02/89f/536/c0289f53662657b012659f89d71add02.png" alt="å›¾ç‰‡" width="200" height="400"></div><br> å½“æˆ‘ä»¬å°è¯•å¯åŠ¨è¿™æ ·çš„ç¨‹åºæ—¶ï¼Œä¼šå‡ºç°ææ…Œå’Œæ¶ˆæ¯â€œåˆ†é…ç»™nil mapä¸­çš„æ¡ç›®â€ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ˜¯å› ä¸ºmapaæ˜¯å¼•ç”¨ç±»å‹ï¼Œè€Œä¸”è¿˜ä¸è¶³ä»¥å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå› æ­¤æ‚¨éœ€è¦å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼š <br><br><pre> <code class="go hljs">m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)</code> </pre><br> ç¨å¾®é™ä½ä¸€ç‚¹ï¼Œå°±å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆè¿™æ ·åšä¼šå¦‚æ­¤ã€‚ æœ€åˆï¼Œå·²ç»ä»‹ç»äº†åˆ›å»ºæ˜ å°„çš„4ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å…¶ä¸­çš„ä¸¤ç§æ–¹æ³•-å°†å…¶å£°æ˜ä¸ºå˜é‡å¹¶é€šè¿‡makeè¿›è¡Œåˆ›å»ºã€‚ æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤åˆæ–‡å­—</a> â€è®¾è®¡è¿›è¡Œåˆ›å»º <br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[key_type]value_type{}</code> </pre> <br> å¦‚æœæ„¿æ„ï¼Œå³ä½¿ç«‹å³ä½¿ç”¨å€¼è¿›è¡Œåˆå§‹åŒ–ï¼Œæ­¤æ–¹æ³•ä¹Ÿæœ‰æ•ˆã€‚ è‡³äºä½¿ç”¨newçš„åˆ›å»º-æˆ‘è®¤ä¸ºè¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæ­¤å‡½æ•°ä¸ºå˜é‡åˆ†é…å†…å­˜å¹¶è¿”å›æŒ‡å‘å®ƒçš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆå¡«å……æœ‰é›¶å€¼ç±»å‹ï¼Œåœ¨mapçš„æƒ…å†µä¸‹ï¼Œè¯¥å€¼å°†ä¸ºnilï¼ˆæˆ‘ä»¬å¾—åˆ°çš„ç»“æœä¸åœ¨varä¸­ï¼Œæ›´ç¡®åˆ‡åœ°è¯´æ˜¯æŒ‡å‘å®ƒçš„æŒ‡é’ˆï¼‰ã€‚ <br><a name="GoMap"></a><br><h4> æ˜ å°„å¦‚ä½•ä¼ é€’ç»™å‡½æ•°ï¼Ÿ </h4><br> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°è¯•å›¾æ›´æ”¹ä¼ é€’ç»™å®ƒçš„æ•°å­—ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹é€šè¯å‰åä¼šå‘ç”Ÿä»€ä¹ˆï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { n = <span class="hljs-number"><span class="hljs-number">10</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { n := <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"n before foo ="</span></span>, n) foo(n) <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"n after foo ="</span></span>, n) }</code> </pre><br> æˆ‘è®¤ä¸ºä¸€ä¸ªä¾‹å­æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½†ä»ç„¶åŒ…æ‹¬ç»“è®ºï¼š <br><br><pre> <code class="plaintext hljs">n before foo = 15 n after foo = 15</code> </pre><br> æ‚¨å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œnå‡½æ•°æ˜¯é€šè¿‡å€¼è€Œä¸æ˜¯é€šè¿‡å¼•ç”¨æ¥å®ç°çš„ï¼Œå› æ­¤åŸå§‹å˜é‡æ²¡æœ‰æ›´æ”¹ã€‚ <br><br> è®©æˆ‘ä»¬åšä¸€ä¸ªç±»ä¼¼çš„mapaæŠ€å·§ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { m[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">10</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) m[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"m[10] before foo ="</span></span>, m[<span class="hljs-number"><span class="hljs-number">10</span></span>]) foo(m) <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"m[10] after foo ="</span></span>, m[<span class="hljs-number"><span class="hljs-number">10</span></span>]) }</code> </pre><br> ç§ç§ï¼š <br><br><pre> <code class="go hljs">m[<span class="hljs-number"><span class="hljs-number">10</span></span>] before foo = <span class="hljs-number"><span class="hljs-number">15</span></span> m[<span class="hljs-number"><span class="hljs-number">10</span></span>] after foo = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br> è¯¥å€¼å·²æ›´æ”¹ã€‚  â€œå¥½å§ï¼ŒMapaæ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’çš„ï¼Ÿâ€ï¼Œæ‚¨é—®ã€‚  <b>ä¸è¡Œ</b>  Goä¸­æ²¡æœ‰é“¾æ¥ã€‚ ä¾‹å¦‚ï¼Œåœ¨C ++ä¸­ï¼Œä¸å¯èƒ½ç”¨1ä¸ªåœ°å€åˆ›å»º2ä¸ªå˜é‡ã€‚ ä½†æ˜¯ç„¶åæ‚¨å¯ä»¥åˆ›å»º2ä¸ªæŒ‡å‘ç›¸åŒåœ°å€çš„å˜é‡ï¼ˆä½†æ˜¯å®ƒä»¬æ˜¯æŒ‡é’ˆï¼Œå¹¶ä¸”åœ¨Goä¸­ï¼‰ã€‚ <br><br> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°fnåˆå§‹åŒ–æ˜ å°„mã€‚ åœ¨mainå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä»…å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå°†å…¶å‘é€ä»¥è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åæŸ¥çœ‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚ <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { m = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) fmt.Println(<span class="hljs-string"><span class="hljs-string">"m == nil in fn?:"</span></span>, m == <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fn(m) fmt.Println(<span class="hljs-string"><span class="hljs-string">"m == nil in main?:"</span></span>, m == <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre><br> ç»“è®ºï¼š <br><br> <code>m == nil in fn?: false <br> m == nil in main?: true <br></code> <br> å› æ­¤ï¼Œå˜é‡mæ˜¯é€šè¿‡<b>value</b>ä¼ é€’<b>çš„</b> ï¼Œå› æ­¤ï¼Œå°±åƒå°†å¸¸è§„intä¼ é€’ç»™å‡½æ•°çš„æƒ…å†µä¸€æ ·ï¼Œå®ƒæ²¡æœ‰æ”¹å˜ï¼ˆfnä¸­å€¼çš„æœ¬åœ°å‰¯æœ¬å·²æ”¹å˜ï¼‰ã€‚ é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆmæœ¬èº«çš„å€¼ä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿ è¦å›ç­”æ­¤é—®é¢˜ï¼Œè¯·è€ƒè™‘è¯­è¨€è¿è¡Œæ—¶ä¸­çš„ä»£ç ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// A header for a Go map. type hmap struct { // Note: the format of the hmap is also encoded in cmd/compile/internal/gc/reflect.go. // Make sure this stays in sync with the compiler's definition. count int // # live cells == size of map. Must be first (used by len() builtin) flags uint8 B uint8 // log_2 of # of buckets (can hold up to loadFactor * 2^B items) noverflow uint16 // approximate number of overflow buckets; see incrnoverflow for details hash0 uint32 // hash seed buckets unsafe.Pointer // array of 2^B Buckets. may be nil if count==0. oldbuckets unsafe.Pointer // previous bucket array of half the size, non-nil only when growing nevacuate uintptr // progress counter for evacuation (buckets less than this have been evacuated) extra *mapextra // optional fields }</span></span></code> </pre><br>  Goä¸­çš„Mapåªæ˜¯æŒ‡å‘hmapç»“æ„çš„æŒ‡é’ˆã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå°½ç®¡äº‹å®ä¸Šæ˜ å°„æ˜¯é€šè¿‡å€¼ä¼ é€’ç»™å‡½æ•°çš„ï¼Œä½†å…¶ä¸­çš„å€¼æœ¬èº«å´å‘ç”Ÿäº†å˜åŒ–-è¿™å…¨éƒ½ä¸æŒ‡é’ˆæœ‰å…³ã€‚  hmapç»“æ„è¿˜åŒ…å«ä»¥ä¸‹å†…å®¹ï¼šå…ƒç´ æ•°é‡ï¼Œâ€œå­˜å‚¨æ¡¶â€æ•°é‡ï¼ˆä»¥å¯¹æ•°å½¢å¼è¡¨ç¤ºï¼Œä»¥åŠ å¿«è®¡ç®—é€Ÿåº¦ï¼‰ï¼Œç”¨äºéšæœºæ•£åˆ—çš„ç§å­ï¼ˆä½¿å…¶éš¾ä»¥æ·»åŠ -å°è¯•æ‹¾å–é”®ï¼Œä»¥ä¾¿å‡ºç°è¿ç»­å†²çªï¼‰ï¼Œå„ç§æœåŠ¡å­—æ®µæœ€é‡è¦çš„æ˜¯æŒ‡å‘å­˜å‚¨å€¼çš„å­˜å‚¨æ¡¶çš„æŒ‡é’ˆ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å›¾ç‰‡ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/979/e11/792/979e11792b1b87cc2a2548ebd3bd1743.png" alt="å›¾ç‰‡"><br><br> å›¾ç‰‡æ˜¾ç¤ºäº†å†…å­˜ä¸­ç»“æ„çš„ç¤ºæ„å›¾-æœ‰ä¸€ä¸ªhmapå¤´ï¼Œè¯¥æŒ‡é’ˆæ˜¯Goä¸­çš„ä¸€ä¸ªæ˜ å°„ï¼ˆä½¿ç”¨varå£°æ˜æ—¶åˆ›å»ºï¼Œä½†æœªåˆå§‹åŒ–ï¼Œè¿™å¯¼è‡´ç¨‹åºåœ¨å°è¯•æ’å…¥æ—¶å´©æºƒï¼‰ã€‚  bucketså­—æ®µæ˜¯é”®-å€¼å¯¹çš„å­˜å‚¨åº“ï¼Œæœ‰å‡ ä¸ªè¿™æ ·çš„bucketï¼Œæ¯ä¸ªbucketåŒ…å«8å¯¹ã€‚  â€œå­˜å‚¨æ¡¶â€ä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ç”¨äºå…¶ä»–å“ˆå¸Œä½çš„æ’æ§½ï¼ˆe0..e7è¢«ç§°ä¸ºe-å› ä¸º<i>é¢å¤–çš„</i>å“ˆå¸Œä½ï¼‰ã€‚ æ¥ä¸‹æ¥æ˜¯é”®å’Œå€¼ï¼Œé¦–å…ˆæ˜¯æ‰€æœ‰é”®çš„åˆ—è¡¨ï¼Œç„¶åæ˜¯æ‰€æœ‰å€¼çš„åˆ—è¡¨ã€‚ <br><br> æ ¹æ®å‡½æ•°çš„å“ˆå¸Œå€¼ï¼Œç¡®å®šæˆ‘ä»¬å°†å€¼æ”¾å…¥å“ªä¸ªâ€œ bucketâ€ä¸­ï¼Œæ¯ä¸ªâ€œ bucketâ€å†…éƒ¨æœ€å¤šå¯ä»¥æœ‰8ä¸ªå†²çªï¼Œå¦‚æœå‰ä¸€ä¸ªæº¢å‡ºï¼Œåˆ™åœ¨æ¯ä¸ªâ€œ bucketâ€çš„æœ«å°¾éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªæŒ‡é’ˆçš„æŒ‡é’ˆã€‚ <br><br><h4> åœ°å›¾å¦‚ä½•æˆé•¿ï¼Ÿ </h4><br> åœ¨æºä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š <br><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">// Maximum average load of a bucket that triggers growth is 6.5.</span></span></code> </pre> <br> ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ¯ä¸ªå­˜å‚¨æ¡¶ä¸­å¹³å‡æœ‰6.5ä¸ªä»¥ä¸Šçš„å…ƒç´ ï¼Œåˆ™å­˜å‚¨æ¡¶æ•°ç»„å°†å¢åŠ ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æ•°ç»„çš„åˆ†é…é‡æ˜¯åŸæ¥çš„2å€ï¼Œå¹¶ä¸”æ¯æ¬¡æ’å…¥æˆ–åˆ é™¤æ—¶ï¼Œæ—§æ•°æ®éƒ½ä¼šä¸€å°éƒ¨åˆ†å¤åˆ¶åˆ°è¯¥æ•°ç»„ä¸­ï¼Œä»¥å…é€ æˆå¾ˆå¤§çš„å»¶è¿Ÿã€‚ å› æ­¤ï¼Œåœ¨ç–æ•£æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šç¨æ…¢ä¸€äº›ï¼ˆæœç´¢æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åœ¨ä¸¤ä¸ªåœ°æ–¹æœç´¢ï¼‰ã€‚ ç–æ•£æˆåŠŸåï¼Œæ–°æ•°æ®å°†å¼€å§‹ä½¿ç”¨ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f00/c06/2aa/f00c062aa458e48d0475635e06a3697a.jpg" alt="å›¾ç‰‡" width="300" height="300"></div><br><h4> è·å–åœ°å›¾å…ƒç´ çš„åœ°å€ã€‚ </h4><br> å¦ä¸€ä¸ªæœ‰è¶£çš„è§‚ç‚¹-åœ¨ä½¿ç”¨è¯¥è¯­è¨€çš„ä¸€å¼€å§‹ï¼Œæˆ‘æƒ³è¿™æ ·åšï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) m[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">10</span></span> a := &amp;m[<span class="hljs-number"><span class="hljs-number">1</span></span>] fmt.Println(m[<span class="hljs-number"><span class="hljs-number">1</span></span>], *a) }</code> </pre><br> ä½†æ˜¯Goè¡¨ç¤ºï¼šâ€œæ— æ³•é‡‡ç”¨m [1]çš„åœ°å€â€ã€‚ ä¸ºä½•æ— æ³•å–å€¼çš„åœ°å€çš„è§£é‡Šåœ¨äºæ•°æ®æ’¤ç¦»ç¨‹åºã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬è·å–äº†å€¼çš„åœ°å€ï¼Œç„¶åmapaå¢é•¿äº†ï¼Œåˆ†é…äº†æ–°çš„å†…å­˜ï¼Œæ’¤å‡ºäº†æ•°æ®ï¼Œåˆ é™¤äº†æ—§çš„æ•°æ®ï¼ŒæŒ‡é’ˆå˜å¾—ä¸æ­£ç¡®ï¼Œå› æ­¤ç¦æ­¢äº†æ­¤ç±»æ“ä½œã€‚ <br><br><h4> æ²¡æœ‰æ³›å‹çš„åœ°å›¾å¦‚ä½•å®ç°ï¼Ÿ </h4><br> ç©ºæ¥å£å’Œä»£ç ç”Ÿæˆéƒ½ä¸å®ƒæ— å…³ï¼›æ•´ä¸ªäº‹æƒ…æ˜¯åœ¨ç¼–è¯‘æ—¶æ›¿æ¢å®ƒã€‚ è€ƒè™‘ä¸€ä¸‹Goç†Ÿæ‚‰çš„åŠŸèƒ½å˜æˆäº†ä»€ä¹ˆï¼š <br><br><pre> <code class="plaintext hljs">v := m["k"] â†’ func mapaccess1(t *maptype, h *hmap, key unsafe.Pointer) unsafe.Pointer v, ok := m["k"] â†’ func mapaccess2(t *maptype, h *hmap, key unsafe.Pointer) (unsafe.Pointer, bool) m["k"] = 9001 â†’ func mapassign(t *maptype, h *hmap, key unsafe.Pointer) unsafe.Pointer delete(m, "k") â†’ func mapdelete(t *maptype, h *hmap, key unsafe.Pointer)</code> </pre><br> æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ‰ç”¨äºè®¿é—®çš„mapaccesså‡½æ•°ï¼Œåˆ†åˆ«ç”¨äºå†™å…¥å’Œåˆ é™¤mapassignå’Œmapdeleteã€‚ æ‰€æœ‰æ“ä½œéƒ½ä½¿ç”¨unsafe.Pointerï¼Œå®ƒä¸å…³å¿ƒå®ƒæŒ‡å‘çš„ç±»å‹ï¼Œå¹¶ä¸”æœ‰å…³æ¯ä¸ªå€¼çš„ä¿¡æ¯ç”±<b>ç±»å‹æè¿°ç¬¦æè¿°</b> ã€‚ <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> mapType <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { key *_type elem *_type ...} <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> _type <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { size <span class="hljs-keyword"><span class="hljs-keyword">uintptr</span></span> alg *typeAlg ...} <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> typeAlg <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { hash <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(unsafe.Pointer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uintptr</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uintptr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(unsafe.Pointer, unsafe.Pointer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function">...}</span></span></code> </pre><br>  MapTypeå­˜å‚¨é”®å’Œå€¼çš„æè¿°ç¬¦ï¼ˆ_typeï¼‰ã€‚ å¯¹äºç±»å‹æè¿°ç¬¦ï¼Œå®šä¹‰äº†æ¯”è¾ƒæ“ä½œï¼ˆtypeAlgï¼‰ï¼Œé‡‡ç”¨å“ˆå¸Œï¼Œå¤§å°ç­‰ï¼Œå› æ­¤æˆ‘ä»¬å§‹ç»ˆçŸ¥é“å¦‚ä½•äº§ç”Ÿå®ƒä»¬ã€‚ <br><br> æœ‰å…³å…¶å·¥ä½œåŸç†çš„æ›´å¤šä¿¡æ¯ã€‚ å½“æˆ‘ä»¬å†™v = m [k]ï¼ˆè¯•å›¾ä»é”®kè·å¾—vçš„å€¼ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨å°†ç”Ÿæˆå¦‚ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="go hljs">kPointer := unsafe.Pointer(&amp;k) vPointer := mapaccess1(typeOf(m), m, kPointer) v = *(*typeOfvalue)vPointer</code> </pre><br> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨æŒ‡å‘é”®çš„æŒ‡é’ˆmapTypeç»“æ„ï¼Œä»ä¸­æ‰¾å‡ºé”®å’Œå€¼çš„å“ªäº›æè¿°ç¬¦ï¼ŒæŒ‡å‘hmapæœ¬èº«çš„æŒ‡é’ˆï¼ˆå³mapï¼‰ï¼Œå¹¶å°†å…¶å…¨éƒ¨ä¼ é€’ç»™mapaccess1ï¼Œåè€…å°†è¿”å›æŒ‡å‘å€¼çš„æŒ‡é’ˆã€‚ æˆ‘ä»¬å°†æŒ‡é’ˆè½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹ï¼Œå–æ¶ˆå¼•ç”¨å¹¶è·å–å€¼ã€‚ <br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿è¡Œæ—¶çš„æœç´¢ä»£ç ï¼ˆç•¥å¾®é€‚åˆé˜…è¯»ï¼‰ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *mapType, m *mapHeader, key unsafe.Pointer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unsafe</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pointer</span></span></span></span> {</code> </pre><br> è¯¥å‡½æ•°åœ¨æ˜ å°„ä¸­æœç´¢é”®å¹¶è¿”å›æŒ‡å‘ç›¸åº”å€¼çš„æŒ‡é’ˆï¼Œè¿™äº›å‚æ•°å·²ç»ä¸ºæˆ‘ä»¬æ‰€ç†Ÿæ‚‰-è¿™æ˜¯mapTypeï¼Œå®ƒå­˜å‚¨é”®ç±»å‹å’Œå€¼çš„æè¿°ç¬¦ï¼Œæ˜ å°„æœ¬èº«ï¼ˆmapHeaderï¼‰å’ŒæŒ‡å‘å­˜å‚¨é”®çš„å†…å­˜çš„æŒ‡é’ˆã€‚ æˆ‘ä»¬è¿”å›ä¸€ä¸ªæŒ‡å‘å­˜å‚¨è¯¥å€¼çš„å†…å­˜çš„æŒ‡é’ˆã€‚ <br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> m == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> || m.count == <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> zero }</code> </pre><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜ å°„å¤´çš„æŒ‡é’ˆæ˜¯å¦ä¸ä¸ºnullï¼Œé‚£é‡Œæ˜¯å¦æœ‰0ä¸ªå…ƒç´ ï¼Œå¦‚æœä¸ºé›¶ï¼Œåˆ™è¿”å›nullå€¼ã€‚ <br><br><pre> <code class="go hljs"> hash := t.key.hash(key, m.seed) <span class="hljs-comment"><span class="hljs-comment">// hash := hashfn(key) bucket := hash &amp; (1&lt;&lt;m.logB-1) // bucket := hash % nbuckets extra := byte(hash &gt;&gt; 56) // extra := top 8 bits of hash b := (*bucket)(add(m.buckets, bucket*t.bucketsize)) // b := &amp;m.buckets[bucket]</span></span></code> </pre><br> æˆ‘ä»¬è®¡ç®—é”®å“ˆå¸Œå€¼ï¼ˆæˆ‘ä»¬çŸ¥é“å¦‚ä½•ä»ç±»å‹æè¿°ç¬¦ä¸­è®¡ç®—ç»™å®šé”®ï¼‰ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°è¯•äº†è§£æ‚¨éœ€è¦å»æŸ¥çœ‹å“ªä¸ªâ€œå­˜å‚¨æ¡¶â€ï¼ˆé™¤ä»¥â€œå­˜å‚¨æ¡¶â€çš„æ•°é‡çš„å‰©ä½™éƒ¨åˆ†ï¼Œè®¡ç®—ä¼šç•¥æœ‰åŠ å¿«ï¼‰ã€‚ ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—é¢å¤–çš„å“ˆå¸Œï¼ˆæˆ‘ä»¬é‡‡ç”¨å“ˆå¸Œçš„8ä¸ªæœ€é«˜æœ‰æ•ˆä½ï¼‰ï¼Œå¹¶ç¡®å®šâ€œå­˜å‚¨æ¡¶â€åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼ˆåœ°å€ç®—æœ¯ï¼‰ã€‚ <br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++ { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.extra[i] != extra { <span class="hljs-comment"><span class="hljs-comment">// check 8 extra hash bits continue } k := add(b, dataOffset+i*t.key.size) // pointer to ki in bucket if t.key.equal(key, k) { // return pointer to vi return add(b, dataOffset+8*t.key.size+i*t.value.size) } } b = b.overflow if b == nil { return zero } }</span></span></code> </pre><br> å¦‚æœæ‚¨çœ‹çš„è¯ï¼Œæœç´¢å¹¶ä¸æ˜¯é‚£ä¹ˆå¤æ‚ï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæˆ‘ä»¬ä¼šéå†â€œå­˜å‚¨æ¡¶â€çš„é“¾ï¼Œç„¶åè½¬åˆ°ä¸‹ä¸€ä¸ªå­˜å‚¨æ¡¶ã€‚ åœ¨â€œå­˜å‚¨æ¡¶â€ä¸­çš„æœç´¢é¦–å…ˆæ˜¯å¯¹å…¶ä»–æ•£åˆ—çš„å¿«é€Ÿæ¯”è¾ƒï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ªe0 ... e7å¼€å¤´éƒ½æ˜¯è¯¥å¯¹çš„â€œè¿·ä½ â€æ•£åˆ—ï¼Œä»¥ä¾¿è¿›è¡Œå¿«é€Ÿæ¯”è¾ƒçš„åŸå› ï¼‰ã€‚ å¦‚æœä¸åŒ¹é…ï¼Œè¯·è¿›ä¸€æ­¥æ£€æŸ¥ï¼ˆå¦‚æœåŒ¹é…ï¼‰ï¼Œç„¶åæˆ‘ä»¬è¿›è¡Œæ›´ä»”ç»†çš„æ£€æŸ¥-ç¡®å®šæ€€ç–‘è¦æœç´¢çš„å¯†é’¥åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œå¹¶æ¯”è¾ƒè¯¥å¯†é’¥æ˜¯å¦ä¸è¯·æ±‚çš„å¯†é’¥ç›¸ç­‰ã€‚ å¦‚æœç›¸ç­‰ï¼Œè¯·ç¡®å®šè¯¥å€¼åœ¨å†…å­˜ä¸­çš„ä½ç½®å¹¶è¿”å›ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæ²¡æœ‰ä»€ä¹ˆè¶…è‡ªç„¶çš„ã€‚ <br><br><h4> ç»“è®º </h4><br> ä½¿ç”¨åœ°å›¾ï¼Œä½†çŸ¥é“å¹¶äº†è§£å®ƒä»¬çš„å·¥ä½œåŸç†ï¼ æ‚¨å¯ä»¥é€šè¿‡äº†è§£ä¸€äº›ç»†å¾®å·®åˆ«æ¥é¿å…é™·å…¥å›°å¢ƒ-ä¸ºä»€ä¹ˆæ— æ³•è·å–å€¼çš„åœ°å€ï¼Œä¸ºä»€ä¹ˆåœ¨åˆå§‹åŒ–æœŸé—´æ‰€æœ‰å†…å®¹éƒ½è½åœ¨æ²¡æœ‰åˆå§‹åŒ–çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆæœ€å¥½äº‹å…ˆåˆ†é…å†…å­˜ï¼Œå¦‚æœçŸ¥é“å…ƒç´ çš„æ•°é‡ï¼ˆæˆ‘ä»¬å°†é¿å…ç–æ•£ï¼‰ç­‰ç­‰ã€‚ <br><br><hr><br> å‚è€ƒæ–‡çŒ®ï¼š <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œè¡ŒåŠ¨ä¸­çš„åœ°å›¾â€ï¼Œå®‰å¾·é²Â·æ ¼æœ—å¾·</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ Goè¿è¡Œæ—¶å¦‚ä½•æœ‰æ•ˆåœ°å®ç°åœ°å›¾â€ï¼ŒDave Cheney</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¨å»‰Â·è‚¯å°¼è¿ªï¼šâ€œäº†è§£ç±»å‹â€</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…éƒ¨åœ°å›¾å®ç°ï¼ŒKeith Randall</a> <br>  <a href="">åœ°å›¾æºä»£ç ï¼Œè¿è¡Œæ—¶</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é«˜æœ—è§„æ ¼</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰æ•ˆçš„å»</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ°é¼ å›¾ç‰‡</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457728/">https://habr.com/ru/post/zh-CN457728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457714/index.html">è‹±è¯­ä¸­çš„å †æ ˆæº¢å‡ºï¼šç¤¾åŒºç»ˆæ­¢æŒ‡å—</a></li>
<li><a href="../zh-CN457718/index.html">HyperCardï¼ŒWebæ¼”è¿›ä¸­ä¸¢å¤±çš„é“¾æ¥</a></li>
<li><a href="../zh-CN457720/index.html">Autodesk Mayaï¼šå¤„ç†3Dæ¨¡å‹çš„æœ‰ç”¨çš„åŸºæœ¬åŠŸèƒ½</a></li>
<li><a href="../zh-CN457722/index.html">SQLï¼šè€ƒå‹¤é—®é¢˜ï¼šæ±‡æŠ¥</a></li>
<li><a href="../zh-CN457724/index.html">STM32F7ä¸Šçš„OpenCV-å‘ç°</a></li>
<li><a href="../zh-CN457730/index.html">åœ¨åŠå…¬å®¤é‡Œæœ‰ä¸€ç§æ§åˆ¶çš„é”™è§‰-å®ƒä¸åœ¨è¿œç¨‹æ§åˆ¶ä¸­ã€‚ ä¸Devhabçš„å¯¹è¯</a></li>
<li><a href="../zh-CN457734/index.html">æ„å¤§åˆ©å¼€æºé©å‘½å¼€å§‹</a></li>
<li><a href="../zh-CN457736/index.html">â€œå·¥å…·ä¸å¦‚è€ƒè™‘å…¶åˆ›å»ºçš„ç³»ç»Ÿçš„èƒ½åŠ›é‡è¦ã€‚â€ é©¬ä¸Â·å…‹è±æ™®æ›¼ä¸“è®¿</a></li>
<li><a href="../zh-CN457738/index.html">æˆ‘ä»¬å¦‚ä½•å®ç°SD-Accessï¼Œä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
<li><a href="../zh-CN457742/index.html">Kuberneteså’ŒPrometheusç‚‰åºŠçš„æ°´å¹³è‡ªåŠ¨æ‰©å±•ï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§å’ŒåŸºç¡€æ¶æ„çš„å¯ç”¨æ€§</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>