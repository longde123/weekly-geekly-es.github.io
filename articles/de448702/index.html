<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äç‚öïÔ∏è üï∫üèø üë©üèΩ MicroPython-Beschleunigung üõí üòä üóÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MicroPython ist eine Implementierung der Programmiersprache Python f√ºr Mikrocontroller, mit der das Publikum dieser Sprache unter Verwendung der bekan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MicroPython-Beschleunigung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448702/">  MicroPython ist eine Implementierung der Programmiersprache Python f√ºr Mikrocontroller, mit der das Publikum dieser Sprache unter Verwendung der bekannten Syntax und Programmierprinzipien mit kleinen Computerger√§ten arbeiten kann. <br><br>  In meiner Arbeit verwende ich MicroPython, um Prototypen zu erstellen, Ideen schnell zu testen und kleine St√§nde zu erstellen.  Dank REPL und einfacher Syntax eignet sich MicroPython auch hervorragend f√ºr DIY-Projekte und zum Unterrichten von Programmierung. <br><br>  Wenn es um die Interaktion von Computern mit der realen Welt geht, interessiert mich immer die Geschwindigkeit ihrer Interaktion.  In einigen F√§llen ist beim Einsatz von Mikroprozessortechnologie, beispielsweise im Bereich des Internet der Dinge, die Reaktionsgeschwindigkeit des Ger√§tes nicht so wichtig.  Es gibt keinen gro√üen Unterschied, wenn die Alarmsirene eingeschaltet wird: 10 Mikrosekunden nach Bewegungserkennung oder 10 Millisekunden. <br><br>  In einigen Aspekten ist jedoch die Geschwindigkeit und Reaktionszeit wichtig, und es stellt sich die Frage, ob die Verwendung von MicroPython angemessen ist.  Also habe ich ein wenig recherchiert, inspiriert von dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video aus der Rede des</a> Sch√∂pfers von MicroPython Damien George.  Ich fragte mich, wie schnell ein in Micropython geschriebenes Programm auf Eingabeeffekte reagieren w√ºrde. <br><br>  Das experimentelle Ger√§t wird der Mikrocontroller ESP8266 auf der NodeMcu-Karte mit der integrierten MicroPython-Version esp8266-2018511-v1.9.4 sein. <br><br><img src="https://habrastorage.org/webt/ek/gh/ty/ekghtyzn5edrtuirgq52wbxv0tq.jpeg"><br><a name="habracut"></a><br>  Ich dr√ºcke die Taste und registriere auf dem Oszilloskop den Zeitunterschied zwischen dem Dr√ºcken und dem Auftreten von 3,3 V am anderen Bein des Mikroprozessors.  Jede Messung wird 15 Mal durchgef√ºhrt, der Durchschnitt wird genommen (in den Diagrammen dargestellt) und die Standardabweichung berechnet (schwarzer Balken in den Diagrammen). <br><br><h1>  Test Nummer 1. </h1><br>  Wenn Sie dieses Problem "frontal" l√∂sen, sieht das Programm ziemlich trivial aus: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> machine <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time o = machine.Pin(<span class="hljs-number"><span class="hljs-number">5</span></span>, machine.Pin.OUT) <span class="hljs-comment"><span class="hljs-comment">#D1 out i = machine.Pin(4, machine.Pin.IN) #D2 in while 1: if i.value(): o.value(1) time.sleep(0.1) o.value(0)</span></span></code> </pre> <br>  Eine typische Wellenform mit einem solchen Programm sieht folgenderma√üen aus: <br><br><img src="https://habrastorage.org/webt/po/i4/5y/poi45yqujz977zm7m-vlkpnmsxq.jpeg"><br><br>  Hier und bei anderen Wellenformen ist das ‚Äûblaue‚Äú Signal der Pin mit der Taste, der ‚Äûgr√ºne‚Äú Antwort-Pin.  Mit 15 Wiederholungen wird folgendes Bild erhalten: <br><br><img src="https://habrastorage.org/webt/41/ma/dx/41madxekq5mo0vt9wikjlizfjve.jpeg"><br><br>  Im Durchschnitt betr√§gt die Reaktionszeit etwa 310 Mikrosekunden, das Maximum betr√§gt 356 Œºs, nicht sehr schnell, aber f√ºr einige Anwendungen ist es durchaus akzeptabel. <br><br><h1>  Test Nummer 2 </h1><br>  Sie k√∂nnen den Standardcode "sofort einsatzbereit" durch Interrupt-Behandlung beschleunigen. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> machine <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time o = machine.Pin(<span class="hljs-number"><span class="hljs-number">5</span></span>, machine.Pin.OUT) <span class="hljs-comment"><span class="hljs-comment">#D1 out i = machine.Pin(4, machine.Pin.IN) #D2 in def f(_): o.value(1) time.sleep(0.1) o.value(0) i.irq(trigger=machine.Pin.IRQ_RISING, handler=f)</span></span></code> </pre><br>  Und das Bild ist wie folgt: <br><br><img src="https://habrastorage.org/webt/jx/cw/q8/jxcwq8w_hlpmw-lh9mexjnzqktm.jpeg"><br><br><img src="https://habrastorage.org/webt/kq/az/co/kqazcodws6x6nkulmbtgtzzeuec.jpeg"><br>  und die maximale Reaktionszeit betr√§gt 306 Œºs. <br><br>  Die Verwendung von Interrupts f√ºhrt zu einer Geschwindigkeitssteigerung von etwa 20%, gleichzeitig jedoch zu einer relativ gro√üen Streuung der Reaktionszeit. <br><br><h1>  Test Nummer 3 </h1><br>  Wenn die erhaltenen Geschwindigkeiten nicht ausreichen, besteht der n√§chste Schritt darin, die @ micropython.native-Konstruktion zu verwenden, mit der der Python-Code in nativen Maschinencode konvertiert werden kann.  Es gibt jedoch einige <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einschr√§nkungen</a> . <br><br>  Code-Option: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> machine <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time o = machine.Pin(<span class="hljs-number"><span class="hljs-number">5</span></span>, machine.Pin.OUT) <span class="hljs-comment"><span class="hljs-comment">#D1 out i = machine.Pin(4, machine.Pin.IN) #D2 in @micropython.native def f(): while 1: if i.value(): o.value(1) time.sleep(0.1) o.value(0) f()</span></span></code> </pre> <br>  Typisches Antwortmuster auf der Wellenform: <br><br><img src="https://habrastorage.org/webt/qg/pg/rs/qgpgrsnxhrbtp7qjvuiwnwoy7fk.jpeg"><br><br>  Im Vergleich zur vorherigen Methode hat sich die Beschleunigung fast verdoppelt: <br><br><img src="https://habrastorage.org/webt/b5/ye/su/b5yesu2o8yimrhxtfb6tah0ypbk.jpeg"><br><br>  Die l√§ngste Reaktionszeit betr√§gt 128 Œºs. <br><br><h1>  Test Nummer 4 </h1><br>  Der n√§chste Schritt bei der Suche nach einem ‚Äûschnellen‚Äú MicroPython besteht darin, das Konstrukt @ micropython.viper zu verwenden und direkt auf die Mikroprozessorregister zuzugreifen (Registeradressen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time @micropython.viper <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> O = ptr32(<span class="hljs-number"><span class="hljs-number">0x60000300</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  GPIO ESP8266 while 1: s = ((O[6] &amp; 0x10) &gt;&gt; 4) #    4  if s: O[1] = 0x20 # 5  time.sleep(0.1) O[2] = 0x20 # 5  f()</span></span></code> </pre> <br>  Infolgedessen beschleunigte sich die Reaktion sp√ºrbar: <br><br><img src="https://habrastorage.org/webt/vp/hd/mp/vphdmpmaxqzdoxsfxt55k6h1gxu.jpeg"><br><br>  Die Reaktionszeit ist sehr klein und kann nicht mit anderen Methoden verglichen werden (maximal 820 ns): <br><br><img src="https://habrastorage.org/webt/gd/rx/v1/gdrxv10ogb2qm3evbpmqvwj989k.jpeg"><br><br><img src="https://habrastorage.org/webt/hg/vj/vx/hgvjvxuvc9cqwnvdnsq0i-wzoqi.jpeg"><br><br>  Wenn dies nicht ausreicht, k√∂nnen Sie Assembler-Einf√ºgungen √ºber den Dekorator @ micropython.asm_thumb verwenden.  Bei dieser Methode bleibt Python nicht besonders erhalten (und die Vorteile von Python auf hoher Ebene gehen verloren). Wenn h√∂here Geschwindigkeiten erforderlich sind, ist es besser, andere Hardware zu verwenden, z. B. FPGA (wo Python auch n√ºtzlich sein kann, siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ). <br><br><h1>  UART </h1><br>  Wenn nach einem Ereignis viele Informationen √ºbertragen werden m√ºssen, k√∂nnen Sie die serielle UART-Schnittstelle verwenden. <br><br>  Nehmen Sie zum Beispiel zwei Implementierungsoptionen. <br><br>  Das erste ist durch Interrupt-Behandlung: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> machine i = machine.Pin(<span class="hljs-number"><span class="hljs-number">4</span></span>, machine.Pin.IN) <span class="hljs-comment"><span class="hljs-comment">#D2 in ua = machine.UART(1) ua.init(1000000) def f(_): ua.write(b'\x01') i.irq(trigger=machine.Pin.IRQ_RISING, handler=f)</span></span></code> </pre> <br>  Und die Antwortwellenform: <br><br><img src="https://habrastorage.org/webt/fb/71/xp/fb71xp-3idw9gkx69fc0puh8ox0.jpeg"><br><br>  Die maximale Reaktionszeit betr√§gt 248 Œºs. <br>  Und der zweite Test durch Viper: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> machine <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time i = machine.Pin(<span class="hljs-number"><span class="hljs-number">4</span></span>, machine.Pin.IN) <span class="hljs-comment"><span class="hljs-comment">#D2 in ua = machine.UART(1) ua.init(1000000) @micropython.viper def f(): O = ptr32(0x60000300) while 1: if ((O[6] &amp; 0x10) &gt;&gt; 4): ua.write(b'\x01') time.sleep(0.1) f()</span></span></code> </pre> <br>  Und die Wellenform im zweiten Test: <br><br><img src="https://habrastorage.org/webt/qh/ic/dh/qhicdhda3yvclrdnenn8gwvnpme.jpeg"><br><br>  Die maximale Antwortzeit mit diesem Code betr√§gt 71 Œºs. <br>  Die durchschnittliche Reaktionszeit in zwei Tests: <br><br><img src="https://habrastorage.org/webt/0v/es/m5/0vesm54u70gfsetq9pg1-_ura-w.jpeg"><br><br>  Die Beschleunigung der Reaktion wird durch eine schnellere Erfassung des Eingangseffekts im zweiten Test erreicht. <br><br><h1>  Fazit </h1><br>  Mit MicroPython k√∂nnen Sie beim Programmieren von Mikrocontrollern Dinge verwenden, die f√ºr Hochsprachen charakteristisch sind (OOP, Ausnahmebehandlung, Listen- und Diktatvergleiche usw.), und bei Bedarf den "klassischen" Python-Code erheblich beschleunigen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448702/">https://habr.com/ru/post/de448702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448688/index.html">Benchmark-Ergebnisse f√ºr Kubernetes Network Plug-Ins (CNI) √ºber ein 10-Gbit / s-Netzwerk (aktualisiert: April 2019)</a></li>
<li><a href="../de448692/index.html">Drei nicht offensichtliche Merkmale von Zimbra, die die Effizienz von Mitarbeitern in Unternehmen steigern k√∂nnen</a></li>
<li><a href="../de448694/index.html">Die Geschichte, wie wir nicht im Fernsehen waren</a></li>
<li><a href="../de448696/index.html">Webinar Group-IB ‚ÄûEin neuer Blick auf die Bedrohungssuche: Technologien zur Erkennung von Angriffsinfrastrukturen‚Äú</a></li>
<li><a href="../de448700/index.html">DjangoCon Europe 2019. Ist Ihr Pony tot?</a></li>
<li><a href="../de448704/index.html">Sicherheitskrippen: Docker</a></li>
<li><a href="../de448706/index.html">Die Aktien von Zoom Technologies stiegen nach dem B√∂rsengang Zoom um 47.000%. Viele Investoren haben sie versehentlich gekauft.</a></li>
<li><a href="../de448708/index.html">Wenn die Verschl√ºsselung nicht hilft: Sprechen Sie √ºber den physischen Zugriff auf das Ger√§t</a></li>
<li><a href="../de448710/index.html">USV und Stromr√ºckgewinnung: Wie √ºberquere ich einen Igel mit einer Schlange?</a></li>
<li><a href="../de448712/index.html">Die formale "Request-Response" -Logik beim Englischlernen: die Vorteile von Programmierern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>