<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜ üëû üêº EJTAG: atracci√≥n para hackers-2 üßîüèø üèáüèæ üêΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En mis publicaciones anteriores de EJTAG: una atracci√≥n para los hackers y Black Swift: usando EJTAG , se consider√≥ la forma m√°s f√°cil de usar EJTAG: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>EJTAG: atracci√≥n para hackers-2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383505/"><img src="https://habrastorage.org/files/ac4/ecc/125/ac4ecc125c314e7682edb1a9e0fb99ed.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mis publicaciones anteriores de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EJTAG: una atracci√≥n para los hackers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black Swift: usando EJTAG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se consider√≥ la forma m√°s f√°cil de usar EJTAG: cargar en RAM e iniciar un programa de usuario. </font><font style="vertical-align: inherit;">Sin embargo, las capacidades de EJTAG no se limitan a esto. </font><font style="vertical-align: inherit;">La publicaci√≥n describe c√≥mo organizar la depuraci√≥n de c√≥digo simple usando EJTAG, usando herramientas gratuitas de openocd y GDB.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se me solicit√≥ que escribiera esta publicaci√≥n mediante una carta de un lector que me pidi√≥ permanecer en el anonimato y que me pidi√≥ ayuda, un dispositivo basado en AR9344 no se inicia (se cuelga en la etapa de inicializaci√≥n de U-boot), ¬øc√≥mo puedo averiguar cu√°l es el problema con EJTAG? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que no ten√≠a un dispositivo basado en el AR9344 a mano, pero la placa Black Swift Pro basada en el chip AR9331 relacionado result√≥ ser la narrativa con la vista puesta. Creo que los cambios que deben hacerse para el AR9344 no son significativos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pasemos a la declaraci√≥n del problema: hay </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
una placa Black Swift Pro, a la que nos conectamos usando openocd a trav√©s de EJTAG y ponemos el procesador en modo de parada.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SE REQUIERE ejecutar varias decenas de instrucciones de procesador secuencialmente, deteni√©ndose despu√©s de que se ejecute cada instrucci√≥n y, si es necesario, verificando el contenido de RAM, ROM de arranque, registros de controlador perif√©rico o registros de procesador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver el problema, veo al menos dos enfoques:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple - solo usando openocd - la funcionalidad b√°sica para realizar las acciones requeridas ya est√° en openocd. </font><font style="vertical-align: inherit;">Solo es necesario para poder usarlo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">complejo - usando el paquete openocd + GDB - el usuario controlar√° el proceso de ejecuci√≥n de instrucciones del procesador a trav√©s de GDB, y openocd convertir√° las solicitudes GDB en comandos EJTAG.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora considere ambas soluciones con m√°s detalle.</font></font><br>
<blockquote>    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Black Swift:  EJTAG</a>.<br>
</blockquote><br>
<br>
<h3> 1:   openocd</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quienes lean mis publicaciones anteriores sobre EJTAG deben recordar que openocd aparece en ellos como un ejecutor de script tonto (archivos de configuraci√≥n), que parece funcionar en modo por lotes y no proporciona la interacci√≥n del usuario. Sin embargo, no lo es. De hecho, mientras el software openocd se est√° ejecutando, es posible "pedirle" que ejecute un comando usando la interfaz de l√≠nea de comando. Para acceder a la interfaz de l√≠nea de comandos, openocd inicia un servidor telnet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De manera predeterminada, se utilizar√° el puerto TCP 4444 para el servidor telnet. Si es necesario, el n√∫mero de puerto TCP se puede cambiar mediante la opci√≥n </font></font><code>telnet_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(consulte el ejemplo a continuaci√≥n). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentemos rastrear el gestor de arranque de la placa Black Swift con openocd. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo de archivo de configuraci√≥n</font></font><code>black-swift-trace.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para openocd, que obliga a openocd para que el servidor telnet use el puerto 4455:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fuente [buscar interfaz / ftdi / tumpa.cfg]</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 adapter_khz 6000</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 fuente [encontrar black-swift.cfg]</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 telnet_port 4455</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 en eso</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 detener</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecutando openocd 0.9.0 como root se ve as√≠:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f black-swift-trace.cfg</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Open On-Chip Debugger 0.9.0 (2015-05-28-17: 08)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Licenciado bajo GNU GPL v2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para informes de errores, lea</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         http://openocd.org/doc/doxygen/bugs.html</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ninguno separado</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 velocidad del adaptador: 6000 kHz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Informaci√≥n: auto-seleccionando el primer transporte de sesi√≥n disponible "jtag". </font><font style="vertical-align: inherit;">Para anular el uso de 'transporte, seleccione &lt;transport&gt;'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Error: no se encontr√≥ ning√∫n dispositivo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Error: no se puede abrir el dispositivo ftdi con vid 0403, pid 8a98, descripci√≥n '*' y serial '*'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Informaci√≥n: velocidad de reloj 6000 kHz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Informaci√≥n: JTAG tap: ar9331.cpu tap / dispositivo encontrado: 0x00000001 (mfg: 0x000, parte: 0x0000, ver: 0x0)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado objetivo: detenido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 objetivo detenido en modo MIPS32 debido a solicitud de depuraci√≥n, pc: 0xbfc00000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado objetivo: detenido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 objetivo detenido en modo MIPS32 debido a un solo paso, pc: 0xbfc00404</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora podemos abrir otra ventana de terminal y conectarnos al servidor telnet openocd usando el programa </font></font><code>telnet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ telnet localhost 4455</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Intentando :: 1 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Intentando 127.0.0.1 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Conectado a localhost.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 El car√°cter de escape es '^]'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Abrir depurador en chip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt;</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una lista de todos los comandos de openocd es f√°cil de obtener con el comando </font></font><code>help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la ejecuci√≥n paso a paso de las instrucciones del procesador, el </font></font><code>step</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siguiente </font><font style="vertical-align: inherit;">comando es √∫til para nosotros </font><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> paso [direcci√≥n]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ejecutar una instrucci√≥n en la direcci√≥n especificada por el registro</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       contador de comandos (PC). </font><font style="vertical-align: inherit;">Si se especifica el par√°metro de direcci√≥n, entonces</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       La instrucci√≥n se ejecutar√° comenzando con la direcci√≥n de la direcci√≥n.</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ejecuci√≥n paso a paso de las instrucciones del procesador en la consola se ve as√≠:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; paso 0xbfc00400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado objetivo: detenido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 objetivo detenido en modo MIPS32 debido a un solo paso, pc: 0xbfc00404</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; paso</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado objetivo: detenido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 objetivo detenido en modo MIPS32 debido a un solo paso, pc: 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; paso</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado objetivo: detenido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 objetivo detenido en modo MIPS32 debido a un solo paso, pc: 0xbfc0040c</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los siguientes comandos de openocd tambi√©n pueden ser √∫tiles:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reg [(n√∫mero_registro | nombre_registro) [(valor | 'fuerza')]]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       leer o escribir el valor del registro del procesador.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Llamar a reg sin par√°metros da como resultado la salida de todos los registros.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Si se usa el par√°metro 'force', forzado</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       restando el registro del procesador (en lugar de emitir un cach√©</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       valores).</font></font><font></font>
 <font></font>
 mwb ['phys'] address value [count]<font></font>
          address ,     value.<font></font>
          phys,   address ‚Äî  ,<font></font>
          ‚Äî .<font></font>
          count    address  <font></font>
           count,    <font></font>
         value.<font></font>
 <font></font>
 mwh ['phys'] address value [count]<font></font>
         mwb,     16- .<font></font>
 <font></font>
 mww ['phys'] address value [count]<font></font>
         mwb,     32- .<font></font>
 <font></font>
 mdb ['phys'] address [count]<font></font>
               address.<font></font>
          phys,   address ‚Äî  ,<font></font>
          ‚Äî .<font></font>
          count        <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       matriz en la direcci√≥n direcci√≥n longitud recuento bytes.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mdh ['phys'] direcci√≥n [cuenta]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       el comando es similar a mdb, pero se lee una palabra de 16 bits en lugar de un byte.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mdw ['phys'] direcci√≥n [cuenta]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       el comando es similar a mdb, pero se lee una palabra de 32 bits en lugar de un byte.</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, desafortunadamente, la √∫ltima versi√≥n (al momento de escribir este art√≠culo) de openocd 0.9.0 no puede desarmar las instrucciones del procesador con la arquitectura MIPS, aunque </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">existe un desensamblador para procesadores con arquitectura ARM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La falta de un desensamblador hace que la ejecuci√≥n paso a paso de las instrucciones del procesador directamente con openocd no sea muy c√≥moda. </font><font style="vertical-align: inherit;">Puede aumentar el nivel de comodidad si usa GDB.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluci√≥n 2: use el paquete openocd + GDB</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el paquete openocd + GDB, los roles se distribuyen de la siguiente manera: el usuario se comunica con GDB, que proporciona una interfaz conveniente para la depuraci√≥n, abstracci√≥n del mecanismo mediante el cual se lleva a cabo la ejecuci√≥n de instrucciones, y openocd asume la tarea de controlar directamente el procesador de acuerdo con las instrucciones de GDB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usar GDB para controlar la ejecuci√≥n de instrucciones en un procesador MIPS a trav√©s de EJTAG tiene varias ventajas sobre openocd:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como se mencion√≥ anteriormente, un desensamblador para la arquitectura MIPS est√° integrado en GDB;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es posible usar informaci√≥n de depuraci√≥n de la fuente; </font><font style="vertical-align: inherit;">por ejemplo, si est√° depurando su propio programa C, entonces GDB podr√° mostrar qu√© l√≠nea de c√≥digo C se est√° ejecutando actualmente y detallar el estado de las variables del programa, y ‚Äã‚Äãno las celdas de memoria con direcciones misteriosas;</font></font></li>
<li>   openocd  GDB   GDB Remote Serial Protocol;  qemu    ,                ,              ‚Äî GDB;</li>
<li>,    GDB      TAB.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debe tenerse en cuenta que GDB opera con conceptos de alto nivel, y openocd se ve obligado a trabajar con el equipo que es y no siempre GDB Wishlist puede implementarse de manera efectiva usando EJTAG. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, el usuario le indica a GDB que establezca un punto de interrupci√≥n en la direcci√≥n especificada, esta instrucci√≥n va a openocd, pero para los procesadores MIPS, openocd tiene al menos dos formas de establecer un punto de interrupci√≥n:</font></font><br>
<ul>
<li>        sdbbp,        , openocd  sdbbp   ,    sdbbp     ,   .    software breakpoint.  ,          .</li>
<li>         .          .     , hardware breakpoint, .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque dentro del Protocolo serie remoto GDB existe una distinci√≥n entre el punto de interrupci√≥n de hardware y el punto de interrupci√≥n de software (consulte los paquetes z y z0 en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descripci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">protocolo</font></a><font style="vertical-align: inherit;"> ), y GDB proporciona las opciones apropiadas para elegir el tipo de puntos de interrupci√≥n, puede resultar que haya restricciones en el uso de puntos en un procesador en particular desglose de un tipo u otro. En consecuencia, openocd tiene una opci√≥n </font></font><code>gdb_breakpoint_override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que le permite forzar uno de los dos m√©todos descritos para organizar los puntos de interrupci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para conectar el depurador GDB, openocd implementa un servidor GDB, que por defecto usa el puerto TCP 3333. Si es necesario, el n√∫mero de puerto TCP se puede cambiar usando la opci√≥n </font></font><code>gdb_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para conectarnos al servidor GDB openocd que controla el procesador MIPS, necesitamos una versi√≥n especial de GDB con soporte MIPS. </font><font style="vertical-align: inherit;">Supongo que el lector usa computadoras basadas en x86 / amd64 que ejecutan Debian Linux para ejecutar openocd y GDB, usando mips-linux-gnu-gdb del paquete Sourcery CodeBench. </font><font style="vertical-align: inherit;">Sobre c√≥mo instalar este paquete est√° escrito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , solo necesita introducir la enmienda, que al momento de escribir estas l√≠neas, la √∫ltima es la versi√≥n de Sourcery CodeBench mips-2015.05-18, lanzada en mayo de 2015, puede descargar el archivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠ usando este enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentemos usar el paquete openocd + GDB en la pr√°ctica. </font><font style="vertical-align: inherit;">Ejecute openocd:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f run-u-boot_mod-trace.cfg \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; -c "gdb_breakpoint_override hard" -c "paso 0xbfc00400"</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los dos √∫ltimos comandos para openocd proporcionar√°n lo siguiente:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se utilizar√°n puntos de interrupci√≥n de hardware, independientemente de lo que GDB imagine all√≠ (las direcciones 0xbfc0xxxx corresponden a ROM, por lo que los puntos de interrupci√≥n de software no funcionar√°n);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ejecutar√° una instrucci√≥n desde la direcci√≥n 0xbfc00400, despu√©s de lo cual el procesador se detendr√° nuevamente.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra otra ventana de terminal e inicie GDB:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ /opt/mips-2015.05/bin/mips-linux-gnu-gdb</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 GNU gdb (Sourcery CodeBench Lite 2015.05-18) 7.7.50.20140217-cvs</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Copyright (C) 2014 Free Software Foundation, Inc.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Licencia GPLv3 +: GNU GPL versi√≥n 3 o posterior &lt;http://gnu.org/licenses/gpl.html&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Esto es software libre: usted es libre de cambiarlo y redistribuirlo.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 NO HAY GARANT√çA, en la medida permitida por la ley. </font><font style="vertical-align: inherit;">Escriba "mostrar copia"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 y "mostrar garant√≠a" para m√°s detalles.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Este GDB se configur√≥ como "--host = i686-pc-linux-gnu --target = mips-linux-gnu".</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Escriba "show configuration" para obtener detalles de la configuraci√≥n.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para obtener instrucciones de informe de errores, consulte:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;https://sourcery.mentor.com/GNUToolchain/&gt;.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Encuentre el manual de GDB y otros recursos de documentaci√≥n en l√≠nea en:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para obtener ayuda, escriba "ayuda".</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Escriba "apropos word" para buscar comandos relacionados con "word".</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora le explicamos a GDB el tipo de procesador con el que trabajaremos, le pedimos que desarme la siguiente instrucci√≥n ejecutable del procesador y finalmente nos conectemos al servidor GDB de openocd:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) establecer mips de arquitectura: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Se supone que la arquitectura de destino es mips: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) establecer endian grande</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Se supone que el objetivo es big endian</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) establezca desmontar-siguiente-l√≠nea en</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) control remoto objetivo: 3333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Depuraci√≥n remota utilizando: 3333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00404 en ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00404: 40 80 08 00 mtc0 cero, c0_random</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ejecutar una instrucci√≥n de procesador en GDB, se utiliza un comando </font></font><code>stepi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Intentemos seguir algunas instrucciones del procesador y no permita que GDB le advierta sobre la falta de informaci√≥n de depuraci√≥n (no puede encontrar el inicio de la funci√≥n), tome esta informaci√≥n de la nada.</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 advertencia: GDB no puede encontrar el inicio de la funci√≥n en 0xbfc00408.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     GDB no puede encontrar el inicio de la funci√≥n en 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 y por lo tanto no puede determinar el tama√±o del marco de la pila de esa funci√≥n.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Esto significa que GDB puede no poder acceder a ese marco de pila, o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Los marcos debajo de √©l.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Este problema probablemente sea causado por un contador de programa no v√°lido o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 puntero de pila.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Sin embargo, si cree que GDB deber√≠a simplemente buscar m√°s atr√°s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 de 0xbfc00408 para c√≥digo que parece el comienzo de un</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 funci√≥n, puede aumentar el rango de b√∫squeda usando el `set</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 comando 'heuristic-fence-post'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00408 en ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00408: 40 80 10 00 mtc0 cero, c0_entrylo0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 advertencia: GDB no puede encontrar el inicio de la funci√≥n en 0xbfc0040c.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc0040c en ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc0040c: 40 80 18 00 mtc0 cero, c0_entrylo1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 advertencia: GDB no puede encontrar el inicio de la funci√≥n en 0xbfc00410.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00410 en ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00410: 40 80 20 00 mtc0 cero, c0_context</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora lea la palabra de 32 bits en 0xbfc00408:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) p / x * 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 $ 1 = 0x40801000</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para imprimir el estado de los registros del procesador, use el comando </font></font><code>info registers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) registros de informaci√≥n</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           cero en v0 v1 a0 a1 a2 a3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R0 00000000 37c688e2 22b15a00 28252198 0c12d319 4193c014 84e49102 06193640</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             t0 t1 t2 t3 t4 t5 t6 t7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R8 00000002 9f003bc0 92061301 1201c163 31d004a0 92944911 ac031248 b806001c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             s0 s1 s2 s3 s4 s5 s6 s7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R16 8bc81985 402da011 c94d2454 88d5a554 81808e0d cc445151 4401a826 50020402</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             t8 t9 k0 k1 gp sp s8 ra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R24 01c06b30 01000000 10000004 fffffffe 9f003bc0 54854eab 329d626b bfc004b4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         estado lo hola badvaddr causa pc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       00400004 00244309 b9ca872c ed6a1f00 60808350 bfc00410</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           abeto fcsr</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       00000000 00000000</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GDB es una herramienta avanzada con una gran cantidad de comandos y opciones; </font><font style="vertical-align: inherit;">Para conocer mejor a GDB, remito al lector a la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentaci√≥n oficial de GDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicializando el Controlador RAM AR9331</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos c√≥mo GDB puede resolver un problema espec√≠fico: al rastrear la ejecuci√≥n de U-boot en el tablero Black Swift, identificaremos una secuencia de entradas en los registros del controlador RAM, lo que conduce a su inicializaci√≥n. </font><font style="vertical-align: inherit;">La detecci√≥n de dicha secuencia es extremadamente √∫til si queremos ejecutar programas en Black Swift usando openocd sin pasar por U-boot. </font><font style="vertical-align: inherit;">Adem√°s, esta secuencia de inicializaci√≥n es √∫til al crear un gestor de arranque alternativo para Black Swift. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute openocd (como en la secci√≥n anterior):</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f run-u-boot_mod-trace.cfg \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; -c "gdb_breakpoint_override hard" -c "paso 0xbfc00400"</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ejecutar GDB, redacte un script </font></font><code>bs-u-boot-trace-gdb.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> establecer mips de arquitectura: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 establecer endian grande</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 establecer desmonte-next-line en</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 control remoto objetivo: 3333</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desactivar la paginaci√≥n</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 establecer el archivo de registro bs_gdb.log</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 establecer inicio de sesi√≥n</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 while $ pc! = (void (*) ()) 0x9f002ab0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         registros de informaci√≥n</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 final</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 despegar</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 dejar</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En comparaci√≥n con el ejemplo de la secci√≥n anterior, esta secuencia de comandos hace que GDB duplique la salida en un archivo </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y deshabilita la paginaci√≥n (confirmaci√≥n del cambio de p√°gina por parte del usuario), y luego comienza a ejecutar c√≠clicamente las instrucciones del procesador y muestra el estado de los registros del procesador despu√©s de cada instrucci√≥n. </font><font style="vertical-align: inherit;">Cuando el registro de PC (registro de direcci√≥n de las siguientes instrucciones) alcanza 0x9f002ab0, GDB se desconecta de openocd y deja de funcionar. </font><font style="vertical-align: inherit;">Por lo tanto, al final de GDB, se crear√° un archivo </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con un seguimiento completo de la ejecuci√≥n de las instrucciones del procesador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El lanzamiento de GDB ser√° el siguiente:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ /opt/mips-2015.05/bin/mips-linux-gnu-gdb -x bs-u-boot-trace-gdb.conf</font></font></pre></blockquote><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: lo </font></font><code>bs-u-boot-trace-gdb.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°s probable es que </font><font style="vertical-align: inherit;">la secuencia de comandos </font><font style="vertical-align: inherit;">no funcione inmediatamente despu√©s de aplicar la alimentaci√≥n a la placa, ya que u-boot_mod tambi√©n restablecer√° los errores anti-misterio AR9331, lo que har√° que la secuencia de comandos deje de ejecutarse. </font><font style="vertical-align: inherit;">En este caso, detenga openocd y GDB, y luego ejecute openocd y GDB nuevamente.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora se trata de lo peque√±o: debe seleccionar </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todas las instrucciones de escritura </font><font style="vertical-align: inherit;">del archivo </font></font><code>sw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(almacenar palabra, es decir, escribir un valor de 32 bits). </font><font style="vertical-align: inherit;">Los registros del controlador de memoria AR9331 son de 32 bits, por lo que otras instrucciones de la familia de tiendas se pueden ignorar de forma segura. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el desensamblador produce solo los nombres de los registros de argumentos de la instrucci√≥n</font></font><code>sw</code><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =&gt; 0xbfc004ec: ad f9 00 00 sw t9,0 (t7)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pero no sus valores, no es suficiente </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seleccionar todas las l√≠neas que contienen la declaraci√≥n sw </font><font style="vertical-align: inherit;">del archivo </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para determinar qu√© valor se escribi√≥ en qu√© direcci√≥n utilizando sw, el archivo debe estar sujeto a </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un procesamiento adicional. </font><font style="vertical-align: inherit;">El procesamiento se puede hacer usando el script parse_gdb_output.pl:</font></font><br>
<pre><code class="perl hljs"> <span class="hljs-comment">#!/usr/bin/perl -w</span><font></font>
 <font></font>
 <span class="hljs-keyword">my</span> %r;<font></font>
 <font></font>
 <span class="hljs-keyword">foreach</span> $i (<span class="hljs-string">qw(zero at v0 v1 a0 a1 a2 a3 t0 t1 t2 t3 t4 t5 t6 t7</span><font></font><span class="hljs-string">
        s0 s1 s2 s3 s4 s5 s6 s7 t8 t9 k0 k1 gp sp s8 ra)</span>) {<font></font>
    $r{$i} = <span class="hljs-string">"none"</span>;<font></font>
 }<font></font>
 <font></font>
 <span class="hljs-function"><span class="hljs-keyword">sub</span> <span class="hljs-title">parse_reg</span>($)</span><font></font><span class="hljs-function">
 </span>{<font></font>
    $_ = $_[<span class="hljs-number">0</span>];<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R/</span>) {<font></font>
        <span class="hljs-keyword">my</span> @fields = <span class="hljs-keyword">split</span> <span class="hljs-keyword">m</span><span class="hljs-string">'\s+'</span>;<font></font>
        <span class="hljs-keyword">my</span> $f = <span class="hljs-number">2</span>;<font></font>
        <span class="hljs-keyword">my</span> @rgs;<font></font>
 <font></font>
        @rgs = <span class="hljs-string">qw(zero at v0 v1 a0 a1 a2 a3)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R0/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(t0 t1 t2 t3 t4 t5 t6 t7)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R8/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(s0 s1 s2 s3 s4 s5 s6 s7)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R1/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(t8 t9 k0 k1 gp sp s8 ra)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R2/</span>);<font></font>
 <font></font>
        <span class="hljs-keyword">foreach</span> $i (@rgs) {<font></font>
            $r{$i} = $fields[$f];<font></font>
            $f = $f + <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
 }<font></font>
 <font></font>
 <span class="hljs-keyword">while</span> (&lt;&gt;) {<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^=&gt;([^s]*)\tsw\t([^,]*),(\d+)\(([^)]*)\)/</span>) {<font></font>
        <span class="hljs-keyword">my</span> $rs = $2;<font></font>
        <span class="hljs-keyword">my</span> $offset = $3;<font></font>
        <span class="hljs-keyword">my</span> $rd = $4;<font></font>
 <font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
 <font></font>
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"$1    sw $rs={0x$r{$rs}}, $offset($rd={0x$r{$rd}})\n"</span>);<font></font>
    }<font></font>
 }</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El lanzamiento </font></font><code>parse_gdb_output.pl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es el siguiente:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ grep "^ = \ | ^ R" bs_gdb.log | </font><font style="vertical-align: inherit;">./parse_gdb_output.pl</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay un fragmento de salida </font></font><code>parse_gdb_output.pl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(las marcas ' </font></font><code>&lt;&lt;&lt; PLL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' y ' </font></font><code>&lt;&lt;&lt; DDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' se ingresaron manualmente m√°s tarde):</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f002700: ad cf 00 00 sw t7 = {0x00dicsoft60}, 0 (t6 = {0xb8116248})</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f00271c: ad f9 00 00 sw t9 = {0x000fffff}, 0 (t7 = {0xb800009c})</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f0027a0: ad f9 00 00 sw t9 = {0x00018004}, 0 (t7 = {0xb8050008}) &lt;&lt;&lt; PLL</font></font><font></font>
  0x9f0027dc:   ad f9 00 00    sw t9={0x00000352}, 0(t7={0xb8050004}) &lt;&lt;&lt;<font></font>
  0x9f002840:   ad f9 00 00    sw t9={0x40818000}, 0(t7={0xb8050000}) &lt;&lt;&lt;<font></font>
  0x9f002898:   ad f9 00 00    sw t9={0x001003e8}, 0(t7={0xb8050010}) &lt;&lt;&lt;<font></font>
  0x9f0028f4:   ad f9 00 00    sw t9={0x00818000}, 0(t7={0xb8050000}) &lt;&lt;&lt;<font></font>
  0x9f002970:   ad cf 00 00    sw t7={0x00800000}, 0(t6={0xb8116248})<font></font>
 ...<font></font>
  0x9f002994:   ad cf 00 00    sw t7={0x40800700}, 0(t6={0xb8116248})<font></font>
  0x9f002a54:   ad f9 00 00    sw t9={0x00008000}, 0(t7={0xb8050008})<font></font>
  0x9f00309c:   af 38 00 00    sw t8={0x7fbc8cd0}, 0(t9={0xb8000000}) &lt;&lt;&lt; DDR<font></font>
  0x9f0030b0:   af 38 00 00    sw t8={0x9dd0e6a8}, 0(t9={0xb8000004}) &lt;&lt;&lt;<font></font>
  0x9f0030dc:   af 38 00 00    sw t8={0x00000a59}, 0(t9={0xb800008c}) &lt;&lt;&lt;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f0030ec: af 38 00 00 sw t8 = {0x00000008}, 0 (t9 = {0xb8000010}) &lt;&lt;&lt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ...</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que se conocen las direcciones de los registros del generador de se√±al de reloj (PLL) y las direcciones de los registros del controlador de memoria del tipo DDR, es f√°cil averiguar qu√© n√∫meros deben escribirse en qu√© direcciones para inicializar correctamente el controlador RAM.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, la depuraci√≥n a trav√©s de JTAG usando openocd y GDB no es nada dif√≠cil, y los m√©todos de trabajo descritos son adecuados no solo para AR9331, sino, despu√©s de algunas adaptaciones, e incluso para procesadores con una arquitectura diferente, para la cual hay soporte en openocd y GDB.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es383505/">https://habr.com/ru/post/es383505/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es383495/index.html">La supervivencia en Rusia. "Perros esquimales, reposts, tweets: c√≥mo no violar la legislaci√≥n anti-extremista"</a></li>
<li><a href="../es383497/index.html">Portar Lode Runner de BC a UKNC</a></li>
<li><a href="../es383499/index.html">Notch est√° pasando por tiempos dif√≠ciles</a></li>
<li><a href="../es383501/index.html">En los Estados Unidos lanz√≥ un experimento para simular un vuelo a Marte que dura 365 d√≠as</a></li>
<li><a href="../es383503/index.html">Fotoc√©lulas de perovskita: cinco gramos por metro cuadrado</a></li>
<li><a href="../es383507/index.html">Proyectos de la base lunar: historia</a></li>
<li><a href="../es383509/index.html">Fundador de Pirate Bay arrestado inmediatamente al salir</a></li>
<li><a href="../es383511/index.html">Los primeros momentos de la fotos√≠ntesis calculados en una supercomputadora</a></li>
<li><a href="../es383513/index.html">El suministro de medicamentos en l√≠nea aumenta incluso despu√©s del cierre de la Ruta de la Seda</a></li>
<li><a href="../es383517/index.html">RAICamp 2015 - D√≠a uno</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>