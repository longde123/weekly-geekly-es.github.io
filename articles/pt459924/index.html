<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìç üë®üèæ üçï Ciclo de teste de rea√ß√£o completa. Relat√≥rio Auto.ru üìä üö¥üèΩ üíå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O desejo de se afastar dos testes de regress√£o manual √© uma boa raz√£o para introduzir autotestes. A quest√£o √© quais? Os desenvolvedores de interface N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ciclo de teste de rea√ß√£o completa. Relat√≥rio Auto.ru</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/459924/"> O desejo de se afastar dos testes de regress√£o manual √© uma boa raz√£o para introduzir autotestes.  A quest√£o √© quais?  Os desenvolvedores de interface Natalya Stus e Aleksey Androsov lembraram como sua equipe passou por v√°rias itera√ß√µes e construiu testes de front-end no Auto.ru com base em Jest e Puppeteer: testes de unidade, testes de componentes individuais do React, testes de integra√ß√£o.  O mais interessante dessa experi√™ncia √© o teste isolado dos componentes React em um navegador sem o Selenium Grid, Java e outras coisas. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/yr/np/zo/yrnpzon4-5momllzoy0bg1zz-ie.jpeg"></a> <br><br>  Alexey: <br>  - Primeiro voc√™ precisa contar um pouco o que √© Automotive News.  Este √© um site de venda de carros.  H√° uma pesquisa, conta pessoal, servi√ßos de autom√≥veis, pe√ßas de reposi√ß√£o, revis√µes, concession√°rias e muito mais.  O Auto.ru √© um projeto muito grande, muito c√≥digo.  Escrevemos todo o c√≥digo em um grande monorepe, porque est√° tudo misturado.  As mesmas pessoas realizam tarefas semelhantes, por exemplo, para dispositivos m√≥veis e computadores.  Acontece muito c√≥digo, e a monorepa √© vital para n√≥s.  A quest√£o √© como test√°-lo? <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/vn/qv/qf/vnqvqfbci0v-wlfceczgd5snhgi.jpeg"><br><br>  Temos o React e o Node.js, que executam a renderiza√ß√£o do lado do servidor e solicitam dados do back-end.  Pe√ßas remanescentes e pequenas no BEM. <br><br><img src="https://habrastorage.org/webt/xb/1p/_b/xb1p_b-9j8huy-rle317mtp5sjc.jpeg"><br><br>  Natalya: <br>  - Come√ßamos a pensar em automa√ß√£o.  O ciclo de lan√ßamento de nossos aplicativos individuais incluiu v√°rias etapas.  Primeiro, o recurso √© desenvolvido pelo programador em um ramo separado.  Depois disso, no mesmo ramo separado, o recurso √© testado por testadores manuais.  Se tudo estiver bem, a tarefa cai no candidato √† libera√ß√£o.  Caso contr√°rio, retorne √† itera√ß√£o de desenvolvimento novamente, teste novamente.  At√© que o testador diga que est√° tudo bem nesse recurso, ele n√£o cair√° no candidato a lan√ßamento. <br><br>  Depois de montar o candidato a lan√ßamento, h√° uma regress√£o manual - n√£o apenas o Auto.ru, mas apenas o pacote que lan√ßaremos.  Por exemplo, se vamos rolar a Web da √°rea de trabalho, h√° uma regress√£o manual da Web da √°rea de trabalho.  Esses s√£o muitos casos de teste manuais.  Essa regress√£o levou cerca de um dia √∫til de um testador manual. <br><br>  Quando a regress√£o √© conclu√≠da, ocorre uma libera√ß√£o.  Depois disso, o ramo de libera√ß√£o √© mesclado no mestre.  Nesse ponto, podemos apenas injetar o c√≥digo mestre, que testamos apenas para a Web para desktop, e esse c√≥digo pode quebrar a Web para dispositivos m√≥veis, por exemplo.  Isso n√£o √© verificado imediatamente, mas apenas na pr√≥xima regress√£o manual - a Web para dispositivos m√≥veis. <br><br><img src="https://habrastorage.org/webt/uc/pp/f6/ucppf6mqcfn6rcjayzc7mzgzzwe.jpeg"><br><br>  Naturalmente, o lugar mais doloroso nesse processo foi a regress√£o manual, que levou muito tempo.  Todos os testadores manuais, naturalmente, est√£o cansados ‚Äã‚Äãde fazer a mesma coisa todos os dias.  Portanto, decidimos automatizar tudo.  A primeira solu√ß√£o que foi executada foi os autotestes Selenium e Java, escritos por uma equipe separada.  Estes foram os testes de ponta a ponta, e2e, que testaram todo o aplicativo.  Eles escreveram cerca de 5 mil desses testes.  Com o que acabamos? <br><br>  Naturalmente, aceleramos a regress√£o.  Os testes autom√°ticos passam muito mais r√°pido do que um testador manual, cerca de 10 vezes mais r√°pido do que o esperado.  Consequentemente, as a√ß√µes de rotina que eles executavam todos os dias foram removidas dos testadores manuais.  Os erros encontrados nos autotestes s√£o mais f√°ceis de reproduzir.  Apenas reinicie este teste ou observe as etapas que ele executa - ao contr√°rio do testador manual, que dir√°: "Cliquei em algo e tudo quebrou". <br><br>  Forneceu estabilidade do revestimento.  Sempre executamos os mesmos testes de execu√ß√£o - em contraste, novamente, a partir de testes manuais, quando o testador pode considerar que n√£o tocamos nesse lugar e n√£o vou verific√°-lo desta vez.  Adicionamos testes para comparar capturas de tela, melhoramos a precis√£o dos testes na interface do usu√°rio - agora verificamos a discrep√¢ncia em alguns pixels que o testador n√£o v√™ com os olhos.  Tudo gra√ßas a testes de captura de tela. <br><br>  Mas havia contras.  O maior deles - para testes do e2e, precisamos de um ambiente de teste totalmente consistente com o produto.  Ele deve sempre ser atualizado e operacional.  Isso requer quase tanta for√ßa quanto vender suporte de estabilidade.  Naturalmente, nem sempre podemos pagar.  Portanto, geralmente tivemos situa√ß√µes em que o ambiente de teste est√° em algum lugar ou algo est√° quebrado e os testes falham, embora n√£o haja problemas no pacote mais avan√ßado. <br><br>  Esses testes tamb√©m est√£o sendo desenvolvidos por uma equipe separada, que tem suas pr√≥prias tarefas, sua pr√≥pria vez no rastreador de tarefas e novos recursos s√£o cobertos com algum atraso.  Eles n√£o podem vir imediatamente ap√≥s o lan√ßamento de um novo recurso e escrever imediatamente autotestes nele.  Como os testes s√£o caros e dif√≠ceis de escrever e manter, n√£o cobrimos todos os cen√°rios com eles, mas apenas os mais cr√≠ticos.  Ao mesmo tempo, √© necess√°ria uma equipe separada e ela ter√° ferramentas separadas, uma infraestrutura separada e toda sua.  E a an√°lise dos testes reprovados tamb√©m √© uma tarefa n√£o trivial para testadores manuais ou para desenvolvedores.  Vou mostrar alguns exemplos. <br><br><img src="https://habrastorage.org/webt/gn/ix/c6/gnixc6p8h1phrdhcjlosttb0ai8.jpeg"><br><br>  N√≥s executamos testes.  500 testes passaram, dos quais alguns ca√≠ram.  Podemos ver isso no relat√≥rio.  Aqui o teste simplesmente n√£o come√ßou, e n√£o est√° claro se tudo est√° bom l√° ou n√£o. <br><br><img src="https://habrastorage.org/webt/40/70/6p/40706pwn5i1vfzfpl4ekmfhpeom.jpeg"><br><br>  Outro exemplo - o teste come√ßou, mas caiu com esse erro.  Ele n√£o conseguiu encontrar nenhum elemento na p√°gina, mas por que - n√£o sabemos.  Esse elemento simplesmente n√£o apareceu, ou acabou na p√°gina errada ou o localizador foi alterado.  Tudo o que voc√™ precisa para ir e debilitar as m√£os. <br><br><img src="https://habrastorage.org/webt/vh/_f/xd/vh_fxdrktlr3llkbrcloced22ks.jpeg"><br><br>  Os testes de captura de tela tamb√©m nem sempre oferecem uma boa precis√£o.  Aqui carregamos algum tipo de cart√£o, ele se moveu levemente, nosso teste caiu. <br><br><img src="https://habrastorage.org/webt/_r/1y/dm/_r1ydm4pdscdlxgdse5focstyje.jpeg"><br><br>  Tentamos resolver v√°rios desses problemas.  Come√ßamos a executar parte dos testes no produto - aqueles que n√£o afetam os dados do usu√°rio n√£o alteram nada no banco de dados.  Ou seja, na prod fabricamos uma m√°quina separada que examina o ambiente da prod.  Apenas instalamos um novo pacote de front-end e executamos testes l√°.  O produto √© pelo menos est√°vel. <br><br>  Transferimos alguns dos testes para os mokeys, mas temos v√°rios back-ends, APIs diferentes, e bloquear tudo isso √© uma tarefa muito dif√≠cil, especialmente para 5 mil testes.  Para isso, foi criado um servi√ßo especial chamado mockritsa, que ajuda a fazer os mokas necess√°rios para o frontend com bastante facilidade e √© bastante f√°cil procur√°-los. <br><br>  Tamb√©m tivemos que comprar um monte de ferro para que nossa grade de dispositivos Selenium, a partir da qual esses testes s√£o lan√ßados, fosse maior para que n√£o ca√≠ssem, porque n√£o podiam elevar o navegador e, consequentemente, iriam mais r√°pido.  Mesmo depois de tentarmos resolver esses problemas, ainda chegamos √† conclus√£o de que esses testes n√£o s√£o adequados para o IC, eles demoram muito tempo.  N√£o podemos execut√°-los em todas as solicita√ß√µes de pool.  Simplesmente, nunca em nossa vida analisaremos posteriormente esses relat√≥rios, que ser√£o gerados para cada solicita√ß√£o de pool. <br><br><img src="https://habrastorage.org/webt/od/0z/rl/od0zrladzvsshl04e52vipgtcvo.jpeg"><br><br>  Portanto, para o IC, precisamos de testes r√°pidos e est√°veis ‚Äã‚Äãque n√£o falhem por alguns motivos aleat√≥rios.  Queremos executar testes para solicita√ß√£o de pool sem qualquer teste, back-end, banco de dados, sem nenhum caso de usu√°rio complicado. <br><br>  Queremos que esses testes sejam gravados simultaneamente com o c√≥digo e que os resultados dos testes deixem imediatamente claro em qual arquivo algo deu errado. <br><br>  Alexey: <br>  - Sim, e decidimos tentar tudo o que queremos, arrumar tudo do come√ßo ao fim na mesma infraestrutura Jest.  Por que escolhemos Jest?  J√° escrevemos testes de unidade no Jest, gostamos.  Esta √© uma ferramenta popular e suportada, que j√° possui v√°rias integra√ß√µes prontas: React render render test, Enzyme.  Tudo funciona imediatamente, nada precisa ser constru√≠do, tudo √© simples. <br><br><img src="https://habrastorage.org/webt/js/bo/sa/jsbosapwtytq_x6a8zkvxl6gdv0.jpeg"><br><br>  E Jest ganhou pessoalmente por mim, ao contr√°rio de qualquer moka, √© dif√≠cil filmar o efeito colateral de algum tipo de teste de terceiros em sua perna se eu me esqueci de limp√°-lo ou de qualquer outra coisa.  No moka, isso √© feito uma ou duas vezes, mas no Jest √© dif√≠cil faz√™-lo: √© constantemente lan√ßado em threads separados.  √â poss√≠vel, mas dif√≠cil.  E para o e2e lan√ßado Puppeteer, tamb√©m decidimos experiment√°-lo.  Foi o que conseguimos. <br><br><img src="https://habrastorage.org/webt/ab/ph/oa/abphoap_rzksxw_spwh4t_0nfra.jpeg"><br><br>  Natalya: <br>  "Eu tamb√©m vou come√ßar com um exemplo de testes de unidade."  Quando escrevemos testes simplesmente para alguma fun√ß√£o, n√£o h√° problemas especiais.  Chamamos essa fun√ß√£o, passamos alguns argumentos, comparamos o que aconteceu com o que deveria ter acontecido. <br><br>  Se estamos falando sobre componentes React, tudo se torna um pouco mais complicado.  Precisamos de alguma forma renderiz√°-los.  Existe um renderizador de teste React, mas n√£o √© muito conveniente para testes de unidade, porque n√£o nos permitir√° testar componentes isoladamente.  Ele renderizar√° o componente completamente at√© o final, para o layout. <br><br>  E quero mostrar como com o Enzyme √© poss√≠vel escrever testes de unidade para componentes React usando um exemplo de um componente em que temos um determinado MyComponent.  Ele recebe algum tipo de suporte, ele tem algum tipo de l√≥gica.  Ent√£o ele retorna o componente Foo, que, por sua vez, retornar√° o componente bar, que j√° no componente bar retorna para n√≥s, de fato, o layout. <br><br><img src="https://habrastorage.org/webt/h2/1e/e6/h21ee6qkeeucwkgnvye6ewsgxog.jpeg"><br><br>  Podemos usar uma ferramenta de enzima como renderiza√ß√£o superficial.  √â exatamente isso que precisamos para testar o componente MyComponent isoladamente.  E esses testes n√£o depender√£o do que os componentes foo e bar conter√£o dentro de si.  Apenas testaremos a l√≥gica do componente MyComponent. <br><br>  Jest tem algo como Instant√¢neo, e eles tamb√©m podem nos ajudar aqui.  ‚ÄúEsperar algo para o MatchSnapshot‚Äù criar√° essa estrutura para n√≥s, apenas um arquivo de texto que armazena, de fato, o que esper√°vamos, o que acontece e, quando esses testes s√£o executados pela primeira vez, esse arquivo √© gravado.  Com outras execu√ß√µes dos testes, o que for obtido ser√° comparado com o padr√£o contido no arquivo MyComponent.test.js.snap. <br><br>  Aqui vemos apenas que toda a renderiza√ß√£o retorna exatamente o que o m√©todo render do MyComponent retorna e o que √© foo, em geral, n√£o se importa.  Podemos escrever esses dois testes para nossos dois casos, para nossos dois casos para o componente MyComponent. <br><br><img src="https://habrastorage.org/webt/wu/b3/iw/wub3iwlwsatz7ytgzpeim8vsbqs.jpeg"><br><br>  Em princ√≠pio, podemos testar a mesma coisa sem um instant√¢neo, apenas verificando os scripts necess√°rios, por exemplo, verificando qual prop √© passada para o componente foo.  Mas essa abordagem tem um sinal de menos.  Se adicionarmos outro elemento ao MyComponent, nosso novo teste, isso n√£o ser√° exibido de forma alguma. <br><br><img src="https://habrastorage.org/webt/pd/9e/vy/pd9evyrhuh7kfzrqcukvwpbudaq.jpeg"><br><br>  Portanto, afinal, os testes de instant√¢neo s√£o aqueles que nos mostrar√£o quase todas as altera√ß√µes dentro do componente.  Mas se escrevermos os dois testes no Snapshot e fizermos as mesmas altera√ß√µes no componente, veremos que os dois testes cair√£o.  Em princ√≠pio, os resultados desses testes falados nos dir√£o a mesma coisa: adicionamos algum tipo de "al√¥" l√°. <br><br><img src="https://habrastorage.org/webt/gv/c1/dc/gvc1dcwq9aw2m3owq6c-esulpsg.jpeg"><br><br>  E isso tamb√©m √© redundante, portanto, acredito que √© melhor usar um teste de instant√¢neo para a mesma estrutura.  Verifique o restante da l√≥gica de alguma maneira diferente, sem o Snapshot, porque o Snapshot n√£o √© muito indicativo.  Quando voc√™ v√™ o Instant√¢neo, v√™ que algo foi renderizado, mas n√£o est√° claro qual l√≥gica voc√™ testou aqui.  Isso √© completamente inadequado para o TDD, se voc√™ quiser us√°-lo.  E n√£o funcionar√° como documenta√ß√£o.  Ou seja, quando voc√™ examinar esse componente, ver√° que sim, o Instant√¢neo corresponde a alguma coisa, mas que tipo de l√≥gica existia n√£o √© muito claro. <br><br><img src="https://habrastorage.org/webt/wa/yc/ia/wayciagk2zoa51amkq8bb9xcqic.jpeg"><br><br><img src="https://habrastorage.org/webt/zk/mj/sa/zkmjsaoqa-34pqk2flku7_n7nsy.jpeg"><br><br>  Da mesma forma, escreveremos testes de unidade no componente foo, no componente bar, por exemplo, Snapshot. <br><br><img src="https://habrastorage.org/webt/bg/eu/lk/bgeulklgkyqg-woog9tkqhkkpco.jpeg"><br><br>  Temos 100% de cobertura para esses tr√™s componentes.  Acreditamos que verificamos tudo, estamos bem. <br><br>  Mas digamos que mudamos algo no componente da barra, adicionamos um novo suporte a ele e fizemos um teste para o componente da barra, obviamente.  Corrigimos o teste e todos os tr√™s testes foram aprovados conosco. <br><br><img src="https://habrastorage.org/webt/4i/pe/xc/4ipexciijx7ss998ugl84hr6smi.jpeg"><br><br>  Mas, de fato, se coletarmos toda essa hist√≥ria, nada funcionar√°, porque o MyComponent n√£o se unir√° a esse erro.  Na verdade, n√£o passamos o suporte que ele espera para o componente bar.  Portanto, estamos falando do fato de que, neste caso, tamb√©m precisamos de testes de integra√ß√£o que verifiquem, incluindo se chamamos corretamente seu componente filho do nosso componente. <br><br><img src="https://habrastorage.org/webt/8e/aa/zk/8eaazkltwuurjeh7fhef39ovblq.jpeg"><br><br>  Tendo esses componentes e alterando um deles, voc√™ v√™ imediatamente quais altera√ß√µes nesse componente afetaram. <br><br>  Que oportunidades temos na Enzyme para realizar testes de integra√ß√£o?  A renderiza√ß√£o rasa em si retorna essa estrutura.  Possui um m√©todo de mergulho, se for chamado em algum componente React, falhar√° nele.  Conseq√ºentemente, chamando-o de componente foo, obtemos o que o componente foo renderiza, isso √© bar; se fizermos o mergulho novamente, obteremos, de fato, o layout que o componente bar retorna para n√≥s.  Este ser√° apenas um teste de integra√ß√£o. <br><br><img src="https://habrastorage.org/webt/oo/jm/af/oojmafj91rsbbpprnhyqf868qoy.jpeg"><br><br>  Ou voc√™ pode renderizar tudo de uma vez usando o m√©todo mount, que implementa a renderiza√ß√£o completa do DOM.  Mas eu n√£o aconselho fazer isso, porque ser√° um instant√¢neo muito dif√≠cil.  E, como regra, voc√™ n√£o precisa verificar toda a estrutura.  Voc√™ s√≥ precisa verificar a integra√ß√£o entre o componente pai e o filho em cada caso. <br><br><img src="https://habrastorage.org/webt/q9/ud/i-/q9udi-03qar0hjqhxe6th8an6zc.jpeg"><br><br>  E para o MyComponent, adicionamos um teste de integra√ß√£o; portanto, no primeiro teste, adiciono apenas mergulho, e verifica-se que testamos n√£o apenas a l√≥gica do pr√≥prio componente, mas tamb√©m sua integra√ß√£o com o componente foo.  Da mesma forma, adicionamos o teste de integra√ß√£o para o componente foo que ele chama corretamente de componente bar e, em seguida, verificamos toda essa cadeia e temos certeza de que nenhuma altera√ß√£o nos interromper√°, de fato, a renderiza√ß√£o do MyComponent <br><br><img src="https://habrastorage.org/webt/ff/zu/fq/ffzufq_vcw5lmuygnztd0lycvao.jpeg"><br><br>  Outro exemplo, j√° de um projeto real.  Apenas brevemente sobre o que mais Jest e Enzyme podem fazer.  Jest pode fazer moki.  Voc√™ pode, se voc√™ usar alguma fun√ß√£o externa em seu componente, poder√° bloque√°-lo.  Por exemplo, neste exemplo, chamamos algum tipo de API, naturalmente n√£o queremos entrar em nenhuma API no teste de unidade; portanto, apenas limpamos a fun√ß√£o getResource com algum objeto jest.fn.  De fato, a fun√ß√£o simulada.  Depois, podemos verificar se foi chamado ou n√£o, quantas vezes foi chamado, com quais argumentos.  Tudo isso permite que voc√™ fa√ßa Jest. <br><br><img src="https://habrastorage.org/webt/z8/lb/ap/z8lbapgq_qzer-1vz3yazx9wo-o.jpeg"><br><br>  Na renderiza√ß√£o superficial, voc√™ pode passar o armazenamento para um componente.  Se voc√™ precisar de uma loja, basta transferi-la para l√° e ela funcionar√°. <br><br><img src="https://habrastorage.org/webt/y2/tl/ih/y2tlihjjqqwogsbftvcirxe_njc.jpeg"><br><br>  Voc√™ tamb√©m pode alterar State e prop em um componente j√° renderizado. <br><br><img src="https://habrastorage.org/webt/ew/8g/hc/ew8ghcc6gtv3347yt8ik6o9v6s4.jpeg"><br><br>  Voc√™ pode chamar o m√©todo simular em algum componente.  Apenas chama o manipulador.  Por exemplo, se voc√™ simular o clique, ele chamar√° o Clique aqui para o componente do bot√£o.  Tudo isso pode ser lido, √© claro, na documenta√ß√£o da enzima, muitas pe√ßas √∫teis.  Estes s√£o apenas alguns exemplos de um projeto real. <br><br><img src="https://habrastorage.org/webt/tw/kn/9t/twkn9txihstmq5pdpc9yqgc1nnw.jpeg"><br><br>  Alexey: <br>  - Chegamos √† pergunta mais interessante.  Podemos testar o Jest, podemos escrever testes de unidade, verificar componentes, verificar quais elementos respondem incorretamente a um clique.  Podemos verificar o html deles.  Agora precisamos verificar o layout do componente, css. <br><br><img src="https://habrastorage.org/webt/fw/dj/8p/fwdj8pbfn6ywa4he7ejwjnq6hs4.jpeg"><br><br>  E √© aconselh√°vel fazer isso para que o princ√≠pio do teste n√£o seja diferente do que eu descrevi anteriormente.  Se eu verificar o html, chamei a renderiza√ß√£o superficial, ela pegou e processou o html para mim.  Quero verificar css, basta chamar algum tipo de renderiza√ß√£o e apenas verificar - sem levantar nada, sem configurar nenhuma ferramenta. <br><br><img src="https://habrastorage.org/webt/mz/u-/p2/mzu-p2y3eiblryntol0eelzghtc.jpeg"><br><br>  Comecei a procur√°-lo e, em quase todos os lugares, a mesma resposta foi dada a essa coisa toda chamada Puppeteer, ou grade Selenium.  Voc√™ abre uma aba, acessa alguma p√°gina html, tira uma captura de tela e a compara com a op√ß√£o anterior.  Se n√£o mudou, est√° tudo bem. <br><br>  A quest√£o √©: o que √© html de p√°gina se eu apenas quiser verificar um componente isoladamente?  √â desej√°vel - em diferentes condi√ß√µes. <br><br><img src="https://habrastorage.org/webt/w2/t0/vn/w2t0vni_fdskrtopftgiigmxows.jpeg"><br><h5>  <sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sub></sup> </h5><br>  N√£o quero escrever um monte desses html de p√°gina para cada componente, para cada estado.  Avito tem uma boa corrida.  Roma Dvornov publicou um artigo sobre Habr√©, e ele, ali√°s, fez um discurso.  O que eles fizeram?  Eles pegam componentes, montam html atrav√©s de uma renderiza√ß√£o padr√£o.  Ent√£o, com a ajuda de plugins e todo tipo de truque, eles coletam todos os ativos que possuem - fotos, css.  Insira tudo no html e eles obter√£o o html certo. <br><br><img src="https://habrastorage.org/webt/0j/yr/zk/0jyrzkzvwzebsx36hos2vvi1uvs.jpeg"><br><h5>  <sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sub></sup> </h5><br>  E ent√£o eles criaram um servidor especial, enviam html para l√°, renderizam e retornam algum resultado.  Um artigo muito interessante, leia, no entanto, voc√™ pode desenhar muitas id√©ias interessantes a partir da√≠. <br><br><img src="https://habrastorage.org/webt/z5/xp/gb/z5xpgbasgyr6gooqi_dt-p4_mxw.jpeg"><br><br>  O que eu n√£o gosto l√°.  A montagem de um componente √© diferente de como vai para a produ√ß√£o.  Por exemplo, temos o webpack, e l√° ele ser√° coletado por alguns ativos da babel, e ser√° retirado de uma maneira diferente.  N√£o posso garantir que testei o que vou baixar agora. <br><br>  E, novamente, um servi√ßo separado para capturas de tela.  Eu quero fazer isso de alguma forma mais f√°cil.  E havia, de fato, a ideia de que, vamos colecion√°-lo exatamente da mesma maneira que iremos colecion√°-lo.  E tente usar algo como o Docker, porque √© uma coisa dessas, pode ser colocado em um computador, localmente, ser√° simples, isolado, n√£o toca em nada, est√° tudo bem. <br><br><img src="https://habrastorage.org/webt/9k/nz/hm/9knzhmk3-qivjt6peujxtmjnovw.jpeg"><br><br>  Mas esse problema √© com o html da p√°gina, ele permanece o mesmo que realmente √©.  E uma ideia nasceu.  Voc√™ tem um webpack.conf t√£o simplificado e, a partir dele, existe algum EntryPoint para o cliente js.  Os m√≥dulos s√£o descritos, como mont√°-los, o arquivo de sa√≠da, todos os plugins que voc√™ descreveu, tudo est√° configurado, tudo est√° bem. <br><br><img src="https://habrastorage.org/webt/3f/km/ha/3fkmhal86lf6s38oq8rnnhchsdg.jpeg"><br><br>  E se eu fizer assim?  Ele entrar√° no meu componente e o coletar√° isoladamente.  E haver√° exatamente um componente.  Se eu adicionar o webpack html l√°, ele tamb√©m fornecer√° html, e esses recursos ser√£o coletados l√°, e isso, no entanto, j√° poder√° ser testado automaticamente. <br><br>  E eu estava prestes a escrever tudo isso, mas descobri. <br><br><img src="https://habrastorage.org/webt/hq/ju/0s/hqju0sbemjp1z3ryufas0pk0tfu.jpeg"><br><br>  Jest-puppeteer-React, um jovem plugin.  E comecei a contribuir ativamente para isso.  Se voc√™ quiser experimentar de repente, pode, por exemplo, me procurar, de alguma forma posso ajudar.  O projeto, de fato, n√£o √© meu. <br><br>  Voc√™ escreve um arquivo regular como test.js e esses arquivos precisam ser escritos um pouco separadamente para ajudar a encontr√°-los, para n√£o compilar todo o projeto, mas compilar apenas os componentes necess√°rios.  De fato, voc√™ aceita a configura√ß√£o do webpack.  E os pontos de entrada mudam para esses arquivos browser.js, ou seja, exatamente o que queremos testar ser√° empacotado em html, e com a ajuda do Puppeteer, ser√£o exibidas capturas de tela. <br><br><img src="https://habrastorage.org/webt/3e/jh/fr/3ejhfrfte3ucybs-vvl6ncw28vo.jpeg"><br><br>  O que ele pode fazer?    ,         jest-image-snapshot.    .     ,     ,  js,   media-query, ,  . <br><br>    headless-,  ,    ,  ,   ,  headless-,     Chrome   .  web-,    , , ,   . <br><br>       Docker.          .  .  ,  Docker,  .   .  Docker     ,         , ,     Linux,   -   ,      -  .  Docker   ,            . <br><br><img src="https://habrastorage.org/webt/gt/26/zc/gt26zcwy-madcquchbm37l89lwo.jpeg"><br><br>      ?   ,       . ,  .    before-after,     ,  .   ,    .   ,         Chrome,       Firefox.    . <br><br>       .    pixelmatch.  ,   looksame,    ¬´¬ª,    .   ,         . <br><br><img src="https://habrastorage.org/webt/ep/zg/ov/epzgovfoqseh2bj5r7jcr8z0lr0.jpeg"><br><br>  ‚Äî   .   ,  ,     .  ,    :    - ,             ‚Äî    Enzyme.      Redux   store .  .    viewport,  ,      .   , ,     . <br><br><img src="https://habrastorage.org/webt/ln/wh/qu/lnwhqusfy-4mqef59zw0lmnoaus.jpeg"><br><br>      .  ,   .  ?     ,     . <br><br><img src="https://habrastorage.org/webt/ut/l6/xb/utl6xb7objmhjnhozdlamgwzjyk.jpeg"><br><br>   :       5-10        . Selenium    .    ,  , ,           .        . <br><br><img src="https://habrastorage.org/webt/md/qr/rf/mdqrrf6ueg73uu25m6wqfihyo3q.jpeg"><br><br>      Puppeteer,    e2e-.      ,          e2e- ‚Äî   ,    Selenium. <br><br> : <br> ‚Äî ,         Selenium Java ,    .     - JS   Puppeteer,    ,         . <br><br>     ,       .     ,           ,    . <br><br><img src="https://habrastorage.org/webt/0s/7u/ns/0s7uns7oaxi3dcwuejuhk5kwuoy.jpeg"><br><br>   ‚Äî  Selenium  Java,   ‚Äî  JS Puppeteer.   .   18  .          ,   ,    Java.  ,           ,       Java  Selenium. <br><br><img src="https://habrastorage.org/webt/kk/us/pj/kkuspjg5dwwz6h2tuhkwfkssth0.jpeg"><br><br> : <br> ‚Äî     ?       .    , html-,    css   .   e2e. .  ,       . <br><br><img src="https://habrastorage.org/webt/sj/wg/58/sjwg58se3lov3vvrskvjjh2pw90.jpeg"><br><br>     ,    ,  .        . ,   , ‚Äî  , .        ,     . -    , ,      :     ,     . <br><br>   ,         ,     .     git hook,  -,      .    green master ‚Äî   ,   ,  ,      .  Obrigada </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459924/">https://habr.com/ru/post/pt459924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459906/index.html">Tic Tac Toe, parte 3: Desfazer / Refazer com armazenamento de comando</a></li>
<li><a href="../pt459910/index.html">Situa√ß√£o: as empresas n√£o t√™m pressa em desenvolver servi√ßos para assistentes de voz - quais s√£o os riscos</a></li>
<li><a href="../pt459914/index.html">SQL Index Manager - uma ferramenta gratuita para desfragmentar e manter √≠ndices</a></li>
<li><a href="../pt459918/index.html">Solu√ß√£o de problemas com pwnable.kr 03 - bof. Estouro de buffer na pilha</a></li>
<li><a href="../pt459922/index.html">Remo√ß√£o de ru√≠do de alta frequ√™ncia dos sinais dos sensores de vibra√ß√£o durante o diagn√≥stico de vibra√ß√£o dos rolamentos</a></li>
<li><a href="../pt459928/index.html">Caminho do aluno para o desenvolvimento de aplicativos para dispositivos m√≥veis</a></li>
<li><a href="../pt459930/index.html">Automa√ß√£o de importa√ß√£o Python</a></li>
<li><a href="../pt459934/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel 306 (de 8 a 14 de julho)</a></li>
<li><a href="../pt459936/index.html">Mais 9 truques para trabalhar com o Visual Studio</a></li>
<li><a href="../pt459948/index.html">Implementando nuvens volum√©tricas fisicamente corretas como no Horizon Zero Dawn</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>