<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂ üå®Ô∏è üåÉ Confus√£o no in√≠cio: post-mortem na velocidade de lan√ßamento de um aplicativo iOS üë©üèΩ‚Äçüéì üßùüèΩ üë®üèΩ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um aplicativo moderno possui muitos requisitos n√£o funcionais: tamanho do aplicativo, tr√°fego consumido, acessibilidade para pessoas com defici√™ncia, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Confus√£o no in√≠cio: post-mortem na velocidade de lan√ßamento de um aplicativo iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/485200/">  Um aplicativo moderno possui muitos requisitos n√£o funcionais: tamanho do aplicativo, tr√°fego consumido, acessibilidade para pessoas com defici√™ncia, estabilidade, inicializa√ß√£o e velocidade de opera√ß√£o.  Nosso aplicativo foi iniciado por muito tempo, dezenas de segundos.  Hoje foi lan√ßada uma atualiza√ß√£o na qual o aplicativo iOS come√ßou a rodar muitas vezes mais r√°pido.  Eu digo a voc√™ como aconteceu e por que apenas agora. <br><br><img src="https://habrastorage.org/webt/rp/l8/mm/rpl8mmcgx6utai5ynvd6ibdpfk8.png"><br><br><a name="habracut"></a><h2>  Come√ßa por um longo tempo </h2><br>  O aplicativo tem muito c√≥digo, muitas classes e elas est√£o de alguma forma conectadas.  Para gerenciar esses relacionamentos, usamos <a href="https://github.com/AliSoftware/Dip">Dip</a> (leia-se: Swinject ou qualquer outra estrutura de DI sem gera√ß√£o de c√≥digo). <br><br>  Funciona assim: no in√≠cio do aplicativo, todas as depend√™ncias s√£o amontoadas no "cont√™iner" e, em seguida, a classe desejada √© extra√≠da dele com todas as depend√™ncias descartadas.  Leva tempo para come√ßar, leva tempo para abrir qualquer tela. <br><br><h4>  Mas as fotos s√£o lindas </h4><br>  Durante muito tempo, nem nos assustou: acabamos de desenhar belos protetores de tela com novas pizzas e n√£o cozinhamos a vapor.  Os protetores de tela para pizza tiveram que ser removidos quando come√ßamos em v√°rios pa√≠ses, porque a variedade √© diferente em todos os lugares.  A imagem n√£o se tornou t√£o interessante, esperar o lan√ßamento se tornou mais chato, mas perdemos esse ponto. <br><br>  Aqui est√£o nossos salpicos.  Bonito, mas escondendo um problema que nem tentamos resolver. <br><br><img src="https://habrastorage.org/webt/yl/tm/-a/yltm-a2vg8jywyaf1fkyfeefnhu.png"><br><br>  Ap√≥s o pr√≥ximo lan√ßamento, come√ßamos a desacelerar a troca de cart√µes no controlador de p√°gina.  O perfilador de tempo mostrou que as depend√™ncias s√£o removidas por um longo tempo quando uma nova tela aparece.  Porque  √â imposs√≠vel entender.  √â muito dif√≠cil depurar o Dip devido √†s mesmas chamadas abstratas.  Tentamos dividir um cont√™iner comum em muitos pequenos, mas s√≥ piorou.  Como resultado, desligamos os cart√µes invertidos e continuamos as atualiza√ß√µes de Ano Novo. <br><br>  √â assim que o Dip se parece no criador de perfil.  No final da lista, √© atingido o limite da pilha de chamadas.  √â imposs√≠vel fazer algo razo√°vel com isso. <br><br><img src="https://habrastorage.org/webt/xk/5z/ox/xk5zoxxwsagxqktskc7juvmtxpc.png"><br><br><h4>  Voa para 4S?  Corrigir mais tarde </h4><br>  No momento, o bug "n√£o iniciou a compila√ß√£o do lan√ßamento no 4S" estava no backlog, embora os de depura√ß√£o tivessem sido lan√ßados.  Ningu√©m notou a conex√£o dos problemas, elevou a vers√£o m√≠nima do iOS para 10 e tamb√©m adiou as altera√ß√µes.  Existem poucos usu√°rios no 4S, certo? <br><br><h2>  Vimos Dip: n√£o no come√ßo, mas na compila√ß√£o </h2><br>  No entanto, ficou claro que Dip precisava ser cortado.  E o que mudar?  Em tempo h√°bil, vimos o artigo <a href="https://medium.com/makingtuenti/dependency-injection-in-swift-part-1-236fddad144a">Inje√ß√£o de Depend√™ncia em Swift</a> . <br><br>  Funciona simplesmente: escrevemos v√°rias fun√ß√µes <code>resolve()</code> com um tipo diferente (o compilador descobrir√° isso).  Portanto, as comunica√ß√µes deixar√£o de ser calculadas no in√≠cio e o compilador poder√° otimizar o c√≥digo.  Isso tamb√©m √© √∫til para o desenvolvimento: se voc√™ descreveu as depend√™ncias incorretamente, descobrir√° sobre isso na inicializa√ß√£o, e n√£o quando abrir a tela.  Obviamente, existem problemas: se a fun√ß√£o <code>resolve()</code> n√£o entender o tipo, produzir√° um erro t√£o in√∫til com cem candidatos: <br><br><img src="https://habrastorage.org/webt/va/9l/-c/va9l-cdpj0cdofdn4x-qafaa3r0.png"><br><br>  Fizemos isso em novembro.  Houve MUITAS mudan√ßas, e naquele momento lan√ßamos o novo produto Combo e nos preparamos para as altera√ß√µes mais recentes antes do Ano Novo.  O novo c√≥digo apareceu no projeto antes do Ano Novo, mas n√£o o liberamos at√© janeiro devido ao congelamento de c√≥digo antes do feriado.  Por isso, por tr√™s semanas, usamos o programa no modo de teste, encontramos problemas e os corrigimos. <br><br>  √â assim que o c√≥digo de depend√™ncia parece agora.  Sujo, mas trabalhando.  450 lugares com registro e 1400 lugares com extra√ß√£o. <br><br><img src="https://habrastorage.org/webt/mg/ms/iu/mgmsiu-nrms194srkp013hzvc0m.png"><br><br>  Funcionalmente, o c√≥digo √© o mesmo, apenas a maneira de trabalhar com ele √© diferente.  A diferen√ßa de velocidade √© vis√≠vel em todos os modelos.  No XS - duas vezes mais r√°pido, e no SE, veja voc√™ mesmo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/hP9B8UEC9NA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Por isso, aceleramos n√£o apenas o in√≠cio, mas tamb√©m a abertura das telas.  Antes das altera√ß√µes, cada tela levava de 0,3 a 1 segundos apenas na depend√™ncia. <br><br><h2>  Ano novo sem pizza </h2><br>  Em dezembro, eles come√ßaram a escrever para n√≥s que o aplicativo falha na inicializa√ß√£o, n√£o inicia e, ap√≥s reiniciar, a reinstala√ß√£o n√£o ajuda.  Anteriormente, havia apenas uma raz√£o para isso - migra√ß√µes de banco de dados, mas nos livramos disso e n√£o vimos novas partidas no Crashlytics.  O que deu errado? <br><br><img src="https://habrastorage.org/webt/a6/ib/zv/a6ibzvy5rksgcqvtmph8g3tdg7g.png"><br>  Hip√≥tese: esse iOS descarta os aplicativos se eles forem executados por um longo per√≠odo de tempo.  A vers√£o foi confirmada pelo fato de que todas as an√°lises eram de dispositivos antigos: 5, 5S, 6. O n√∫mero dessas an√°lises aumentou significativamente, porque a pizza √© um feriado, as pessoas costumam pedir no Ano Novo.  A equipe est√° preocupada, o produto est√° preocupado, mas estamos lan√ßando a nova vers√£o somente em janeiro. <br><br>  Tivemos a sorte de que a solu√ß√£o foi escrita e s√≥ p√¥de ser testada.  Em outro cen√°rio, meses podem ser gastos procurando causas e corrigindo-as. <br><br><hr><br>  √Äs vezes, √© dif√≠cil transmitir a import√¢ncia de uma tarefa t√©cnica para uma empresa: n√£o h√° m√©tricas, a import√¢ncia n√£o √© clara, o perigo n√£o √© previsto.  As empresas podem resolver o problema de diferentes maneiras: √© assim que pintamos belas imagens, em vez de acelerar o aplicativo.  Mas o desempenho √© importante para todos os usu√°rios.  Isso afeta muito: <br><br><ul><li>  Esperando.  Se o aplicativo iniciar por um longo tempo, quanto tempo eles levar√£o pizza? </li><li>  O prazer de usar.  Por que est√∫pido em todas as telas? </li><li>  E mesmo para estabilidade.  ‚ÄúO aplicativo n√£o est√° sendo executado !!!  Desenvolvedores, voc√™s testam a√≠? ‚Äù(C). </li></ul><br>  E ignore o Dip, o Swinject e outras estruturas que funcionam com cont√™ineres em tempo real se voc√™ tiver um projeto grande e muitas depend√™ncias. <br><blockquote>  Para n√£o perder o pr√≥ximo artigo, assine o canal <a href="https://telegram.im/dodomobile">Dodo Pizza Mobile.</a> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485200/">https://habr.com/ru/post/pt485200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485186/index.html">Startup de trilh√µes de d√≥lares ou como nasceram as empresas Valley de maior sucesso</a></li>
<li><a href="../pt485190/index.html">Andrew Eun "Paix√£o pelo aprendizado de m√°quina". Tradu√ß√£o dos cap√≠tulos 47-58</a></li>
<li><a href="../pt485194/index.html">√Årvore de segmentos: r√°pido e f√°cil</a></li>
<li><a href="../pt485196/index.html">AvitoTech On Tour: V√° e participe de reuni√µes em Kazan</a></li>
<li><a href="../pt485198/index.html">Outra maneira de medir o desempenho dos m√©todos de aplicativo .NET</a></li>
<li><a href="../pt485202/index.html">Sistema de Supress√£o</a></li>
<li><a href="../pt485204/index.html">Retornar ao topo: por que a capitaliza√ß√£o da Amazon em breve exceder√° US $ 1 trilh√£o</a></li>
<li><a href="../pt485206/index.html">Como o Typecript me decepcionou e vale a pena?</a></li>
<li><a href="../pt485208/index.html">Cria√ß√£o de infraestrutura de TI tolerante a falhas. Parte 2. Instalando e configurando o cluster oVirt 4.3</a></li>
<li><a href="../pt485210/index.html">Atirador de zumbis simples no Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>