<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë©üèª üèñÔ∏è üìª Faire un prototype de robot pour les batailles dans Clash Royale üìü üöÆ ‚ôèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous est-il arriv√© de vous en tenir √† une sorte de jeu simple, en pensant que l'intelligence artificielle pouvait tout √† fait y faire face? J'avais l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Faire un prototype de robot pour les batailles dans Clash Royale</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/binarydistrict/blog/439352/">  Vous est-il arriv√© de vous en tenir √† une sorte de jeu simple, en pensant que l'intelligence artificielle pouvait tout √† fait y faire face?  J'avais l'habitude de le faire et j'ai d√©cid√© d'essayer de cr√©er un tel joueur de bot.  De plus, il existe d√©sormais de nombreux outils de vision par ordinateur et d'apprentissage automatique qui vous permettent de cr√©er des mod√®les sans une compr√©hension approfondie des d√©tails de mise en ≈ìuvre.  Les mortels ordinaires peuvent faire un prototype sans construire de r√©seaux de neurones pendant des mois. <br><br><img src="https://habrastorage.org/webt/fs/7g/yb/fs7gyb9v-o6bessxnliwetns8u0.png"><br><br>  Sous la coupe, vous trouverez le processus de cr√©ation d'un bot de preuve de concept pour le jeu Clash Royale, dans lequel j'ai utilis√© des biblioth√®ques Scala, Python et CV.  En utilisant la vision par ordinateur et l'apprentissage automatique, j'ai essay√© de cr√©er un bot pour un jeu qui interagit comme un joueur en direct. <br><a name="habracut"></a><br>  Je m'appelle Sergey Tolmachev, je suis d√©veloppeur principal Scala sur la plate-forme Waves et enseigne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un cours Scala</a> dans le quartier binaire, et pendant mon temps libre, j'√©tudie d'autres technologies, telles que l'IA.  Et je voulais renforcer les comp√©tences acquises avec une certaine exp√©rience pratique.  Contrairement aux comp√©titions d'IA, o√π votre bot joue contre les bots d'autres utilisateurs, Clash Royale peut jouer contre des gens, ce qui semble dr√¥le.  Votre bot peut apprendre √† battre de vrais joueurs! <br><br><h2>  M√©canique du jeu dans Clash Royale </h2><br>  La m√©canique du jeu est assez simple.  Vous et votre adversaire avez trois b√¢timents: une forteresse et deux tours.  Les joueurs avant le jeu collectent des decks - 8 unit√©s disponibles, qui sont ensuite utilis√©es au combat.  Ils ont diff√©rents niveaux et peuvent √™tre pomp√©s, collectant plus de cartes de ces unit√©s et achetant des mises √† jour. <br>  Apr√®s le d√©but du jeu, vous pouvez placer les unit√©s disponibles √† une distance de s√©curit√© des tours ennemies, tout en d√©pensant des unit√©s de mana, qui sont lentement restaur√©es pendant le jeu.  Les unit√©s sont envoy√©es dans les b√¢timents ennemis et distraites par les ennemis rencontr√©s en cours de route.  Le joueur ne peut contr√¥ler que la position initiale des unit√©s - il ne peut affecter leur mouvement et leurs d√©g√¢ts ult√©rieurs qu'en r√©glant d'autres unit√©s. <br><br>  Il y a encore des sorts qui peuvent √™tre jou√©s n'importe o√π sur le terrain, ils causent g√©n√©ralement des d√©g√¢ts aux unit√©s de diff√©rentes mani√®res.  Les sorts peuvent cloner, geler ou acc√©l√©rer des unit√©s dans une zone. <br><br><img src="https://habrastorage.org/webt/bk/xs/s2/bkxss2pfmjmvheqvnex86yy2wdk.png"><br><br>  Le but du jeu est de d√©truire les b√¢timents ennemis.  Pour une victoire compl√®te, vous devez d√©truire la forteresse ou apr√®s deux minutes de jeu d√©truire plus de b√¢timents (les r√®gles d√©pendent des modes de jeu, mais en g√©n√©ral elles sonnent comme √ßa). <br><br>  Pendant le jeu, vous devez prendre en compte le mouvement des unit√©s, le nombre possible de mana et les cartes ennemies actuelles.  Vous devez √©galement consid√©rer comment l'installation de l'unit√© affecte le terrain de jeu. <br><br><h2>  Construire une solution </h2><br>  Clash Royale est un jeu mobile, j'ai donc d√©cid√© de l'ex√©cuter sur Android et d'interagir avec lui via ADB.  Cela prendrait en charge le travail avec le simulateur ou avec un v√©ritable appareil. <br><br>  J'ai d√©cid√© que le bot, comme beaucoup d'autres IA de jeu, devrait travailler sur l'algorithme Perception-Analysis-Action.  L'environnement entier du jeu est affich√© √† l'√©cran et l'interaction avec celui-ci se produit en cliquant sur l'√©cran.  Par cons√©quent, le bot doit √™tre un programme dont l'entr√©e d√©crit l'√©tat actuel du jeu: l'emplacement et les caract√©ristiques des unit√©s et des b√¢timents, les cartes possibles actuelles et la quantit√© de mana.  √Ä la sortie, le bot doit donner un tableau de coordonn√©es o√π l'unit√© doit √™tre enregistr√©e. <br><br>  Mais avant de cr√©er le bot lui-m√™me, il √©tait n√©cessaire de r√©soudre le probl√®me d'extraction d'informations sur l'√©tat actuel du jeu √† partir de la capture d'√©cran.  Dans l'ensemble, le contenu suppl√©mentaire de l'article est consacr√© √† cette t√¢che. <br><br>  Pour r√©soudre ce probl√®me, j'ai d√©cid√© d'utiliser la vision par ordinateur.  Ce n'est peut-√™tre pas la meilleure solution: un CV sans beaucoup d'exp√©rience et de ressources a clairement des limites et ne peut pas tout reconna√Ætre au niveau humain. <br><br>  Il serait plus pr√©cis de prendre des donn√©es de la m√©moire, mais je n'avais pas une telle exp√©rience.  La racine est requise et dans l'ensemble, cette solution semble plus compliqu√©e.  Il est √©galement difficile de savoir si la vitesse en temps r√©el peut √™tre atteinte ici si vous recherchez des objets avec une pile JVM √† l'int√©rieur du p√©riph√©rique.  De plus, je voulais r√©soudre le probl√®me du CV plus que cela. <br>  En th√©orie, on pourrait cr√©er un serveur proxy et en tirer des informations.  Mais le protocole r√©seau du jeu change souvent, des proxys sur Internet se rencontrent, mais deviennent rapidement obsol√®tes et ne sont pas pris en charge. <br><br><h2>  Ressources de jeu disponibles </h2><br>  Pour commencer, j'ai d√©cid√© de me familiariser avec les mat√©riaux disponibles du jeu.  J'ai trouv√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">club d'artisans</a> qui sortait des ressources de jeu emball√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[1]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[2]</a> .  Tout d'abord, je me suis int√©ress√© aux images d'unit√©s, mais dans le jeu non emball√©, elles sont pr√©sent√©es sous la forme d'une carte de tuiles (pi√®ces dont une unit√© est constitu√©e). <br><br>  J'ai √©galement trouv√© des scripts coll√©s (mais pas parfaits) de cadres d'animation d'unit√© - ils √©taient utiles pour former le mod√®le de reconnaissance. <br><br><img src="https://habrastorage.org/webt/b_/bp/zm/b_bpzm14pv9snavxmruq0k5q0cm.png"><br><br>  De plus, dans les ressources, vous pouvez trouver des csv avec diverses donn√©es de jeu - la quantit√© de HP, les dommages aux unit√©s de diff√©rents niveaux, etc. Ceci est utile lors de la cr√©ation de la logique du bot.  Par exemple, √† partir des donn√©es, il est devenu clair que le champ √©tait divis√© en 18 x 29 cellules et que des unit√©s ne pouvaient √™tre plac√©es que sur elles.  Il y avait aussi toutes les images des cartes des unit√©s, qui nous seront utiles plus tard. <br><br><h2>  Vision par ordinateur pour les paresseux </h2><br>  Apr√®s avoir recherch√© les solutions de CV disponibles, il est devenu clair que dans tous les cas, ils devraient √™tre form√©s sur un ensemble de donn√©es √©tiquet√©.  J'ai pris des captures d'√©cran et j'√©tais d√©j√† pr√™t √† marquer un certain nombre de captures d'√©cran avec mes mains.  Cela s'est av√©r√© √™tre une t√¢che intimidante. <br><br>  Trouver les programmes de reconnaissance disponibles a pris du temps.  Je me suis install√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">labelImg</a> .  Toutes les applications d'annotation que j'ai trouv√©es √©taient assez primitives: beaucoup ne prenaient pas en charge les raccourcis clavier, la s√©lection des objets et de leurs types √©tait rendue beaucoup moins pratique que dans labelImg. <br><br>  Lors du balisage, il s'est av√©r√© utile d'avoir le code source de l'application.  J'ai pris des captures d'√©cran toutes les deux secondes du match.  Il y a beaucoup d'objets dans les captures d'√©cran (par exemple, une arm√©e de squelettes), et j'ai fait une modification dans labelImg - par d√©faut, lors du marquage de l'image suivante, les √©tiquettes de la pr√©c√©dente ont √©t√© prises.  Souvent, ils devaient simplement √™tre d√©plac√©s vers une nouvelle position des unit√©s, retirer les unit√©s mortes et en ajouter quelques-unes apparues, et ne pas marquer √† partir de z√©ro. <br><br><img src="https://habrastorage.org/webt/cx/dh/rf/cxdhrf-uctqed-l84x2mg_9j4u8.png"><br><br>  Le processus s'est av√©r√© √™tre gourmand en ressources - en deux jours en mode silencieux, j'ai post√© environ 200 captures d'√©cran.  L'√©chantillon semble tr√®s petit, mais j'ai d√©cid√© de commencer √† exp√©rimenter.  Vous pouvez toujours ajouter plus d'exemples et am√©liorer la qualit√© du mod√®le. <br><br>  Au moment du balisage, je ne savais pas quel outil de formation j'utiliserais, j'ai donc d√©cid√© d'enregistrer les r√©sultats du balisage au format COV - l'un des plus conservateurs et apparemment universel. <br><br>  La question peut se poser: pourquoi ne pas simplement rechercher des images pixel par pixel des unit√©s par pure co√Øncidence?  Le probl√®me est que pour cela, il faudrait rechercher un grand nombre d'images d'animation diff√©rentes d'unit√©s diff√©rentes.  Cela ne marcherait gu√®re.  Je voulais cr√©er une solution universelle prenant en charge diff√©rentes autorisations.  De plus, les unit√©s peuvent avoir une couleur diff√©rente en fonction de l'effet qui leur est appliqu√© - gel, acc√©l√©ration. <br><br><h2>  Pourquoi ai-je choisi YOLO </h2><br>  J'ai commenc√© √† explorer des solutions possibles de reconnaissance d'image.  J'ai regard√© l'application de diff√©rents algorithmes: OpenCV, TensorFlow, Torch.  Je voulais rendre la reconnaissance aussi rapide que possible, m√™me en sacrifiant la pr√©cision, et obtenir le POC d√®s que possible. <br><br>  Apr√®s avoir lu les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">articles</a> , j'ai r√©alis√© que ma t√¢che ne correspond pas aux classificateurs HOG / LBP / SVM / HAAR / ....  Bien qu'ils soient rapides, ils devraient √™tre appliqu√©s plusieurs fois - selon le classificateur de chaque unit√© - puis un par un pour les appliquer √† l'image √† rechercher.  De plus, leur principe de fonctionnement en th√©orie donnerait de mauvais r√©sultats: les unit√©s peuvent avoir une forme diff√©rente, par exemple, en se d√©pla√ßant vers la gauche et vers le haut. <br><br>  Th√©oriquement, en utilisant un r√©seau neuronal, vous pouvez l'appliquer une fois √† une image et obtenir toutes les unit√©s de types diff√©rents avec leur position, alors j'ai commenc√© √† creuser vers les r√©seaux neuronaux.  TensorFlow a trouv√© un support pour les r√©seaux de neurones convolutifs (CNN).  Il s'est av√©r√© qu'il n'est pas n√©cessaire de former les r√©seaux de neurones √† partir de z√©ro - vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recycler le puissant r√©seau existant</a> . <br><br>  Ensuite, j'ai trouv√© un algorithme YOLO plus pratique qui promet moins de complexit√© et, par cons√©quent, a d√ª fournir un algorithme de recherche √† haute vitesse sans sacrifier beaucoup de pr√©cision (et dans certains cas, surpasser les autres mod√®les). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le site Web YOLO</a> promet une √©norme diff√©rence de vitesse en utilisant le petit mod√®le et un r√©seau optimis√© plus petit.  YOLO vous permet √©galement de recycler le r√©seau de neurones fini pour votre t√¢che, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">darknet</a> - un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">framework open</a> source pour utiliser divers neurones dont les cr√©ateurs ont d√©velopp√© YOLO - est une simple application C native, et tout le travail se fait via ses appels de param√®tres. <br><br>  TensorFlow, √©crit en Python, est en fait une biblioth√®que Python et est utilis√© √† l'aide de scripts auto-√©crits dont vous avez besoin pour les comprendre ou les affiner en fonction de vos besoins.  Pour certains, la flexibilit√© de TensorFlow est probablement un plus, mais sans entrer dans les d√©tails, il n'est gu√®re possible de le prendre rapidement et de l'utiliser.  Par cons√©quent, dans mon projet, le choix s'est port√© sur YOLO. <br><br><h2>  Construction de mod√®les </h2><br>  Pour travailler sur la formation des mod√®les, j'ai install√© Ubuntu 18.10, livr√© des packages d'assemblage, le package OpenCL de NVIDIA et d'autres d√©pendances, et construit darknet. <br><br>  Github a une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">section avec des √©tapes simples pour recycler le mod√®le YOLO</a> : vous devez t√©l√©charger le mod√®le et les configurations, les changer et commencer √† recycler. <br><br>  Je voulais d'abord essayer de recycler un mod√®le YOLO simple, puis Tiny et les comparer.  Cependant, il s'est av√©r√© que pour la formation de mod√®les simples, vous avez besoin de 4 Go de m√©moire de carte vid√©o et je n'avais qu'une carte graphique NVIDIA GeForce GTX 1060 de 3 Go achet√©e pour les jeux.  Par cons√©quent, j'ai pu imm√©diatement former uniquement le mod√®le Tiny. <br><br>  Le balisage des unit√©s sur les images que j'avais √©tait au format VOC, et YOLO a travaill√© avec son propre format, j'ai donc utilis√© l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">convert2Yolo</a> pour convertir les fichiers d'annotation. <br><br>  Apr√®s une nuit d'entra√Ænement sur mes 200 captures d'√©cran, j'ai obtenu les premiers r√©sultats, et ils m'ont surpris - le mod√®le a vraiment pu reconna√Ætre quelque chose correctement!  J'ai r√©alis√© que j'allais dans la bonne direction et j'ai d√©cid√© de faire plus d'exemples d'enseignement. <br><br><img src="https://habrastorage.org/webt/ek/rh/ik/ekrhikfcntuxljeawh09ikegnp0.png"><br><br>  Je ne voulais pas continuer √† disposer de captures d'√©cran, et je me souvenais des images des animations d'unit√©.  J'ai marqu√© toutes les petites images avec leurs classes et j'ai essay√© de former le r√©seau sur cet ensemble.  Le r√©sultat a √©t√© tr√®s mauvais.  Je suppose que le mod√®le n'a pas pu s√©lectionner les bons motifs √† partir de petites images pour les utiliser dans de grandes images. <br><br>  Apr√®s cela, j'ai d√©cid√© de les placer sur des arri√®re-plans pr√™ts √† l'emploi des ar√®nes de combat et de cr√©er par programme un fichier de marquage VOC.  Il s'est av√©r√© une telle capture d'√©cran synth√©tique avec une mise en page 100% pr√©cise et automatique. <br><br>  J'ai √©crit un script dans Scala qui divise la capture d'√©cran en 16 carr√©s 4x4 et d√©finit les unit√©s en leur centre afin qu'elles ne se croisent pas.  Le script m'a √©galement permis de personnaliser la cr√©ation d'exemples de formation - lors de la prise de d√©g√¢ts, les unit√©s sont peintes dans la couleur de leur √©quipe (rouge / bleu), et lors de la classification, je reconnais s√©par√©ment les unit√©s de diff√©rentes couleurs.  En plus de la coloration, les unit√©s de diff√©rentes √©quipes qui ont subi des dommages pr√©sentent de l√©g√®res diff√©rences de v√™tements.  De plus, j'ai augment√© et diminu√© un peu les unit√©s au hasard, de sorte que le mod√®le a appris √† ne pas d√©pendre beaucoup de la taille de l'unit√©.  En cons√©quence, j'ai appris √† cr√©er des dizaines de milliers d'exemples de formation qui sont approximativement similaires √† de vraies captures d'√©cran. <br><br><img src="https://habrastorage.org/webt/uv/zi/_u/uvzi_uwhmohzcx0a7ylmpbyjady.png"><br><br>  La g√©n√©ration n'√©tait pas parfaite.  Souvent, les unit√©s √©taient plac√©es au-dessus des b√¢timents, bien que dans le jeu elles soient derri√®re elles;  il n'y avait aucun exemple de parties qui se chevauchent de l'unit√©, bien que ce ne soit pas une situation rare dans le jeu.  Mais jusqu'√† pr√©sent, j'ai d√©cid√© de le n√©gliger. <br><br><img src="https://habrastorage.org/webt/zo/wk/uq/zowkuqkijfqocemk7_qflhhgavg.png"><br><br>  Le mod√®le obtenu apr√®s plusieurs nuits de formation sur un m√©lange de 200 captures d'√©cran r√©elles et 5000 images g√©n√©r√©es qui ont √©t√© recr√©√©es au cours du processus de formation une fois par jour, lorsqu'il a √©t√© test√© sur ces captures d'√©cran, a donn√© de mauvais r√©sultats.  Ce n'est pas surprenant, car les images g√©n√©r√©es ont beaucoup de diff√©rences avec les vraies. <br><br>  Par cons√©quent, j'ai mis le mod√®le r√©sultant √† recycler sur un √©chantillon moyen, dans lequel il n'y avait que 200 de mes captures d'√©cran.  Apr√®s cela, elle a commenc√© √† travailler beaucoup mieux. <br><br><div class="spoiler">  <b class="spoiler_title">Quelle honte</b> <div class="spoiler_text">  Je m'excuse d'avoir trait√© de telles mesures non scientifiques comme ¬´beaucoup mieux¬ª, mais je ne sais pas comment valider rapidement les images, j'ai donc essay√© plusieurs captures d'√©cran √† partir d'un ensemble non destin√© √† la formation et j'ai cherch√© √† voir si les r√©sultats me satisfaisaient.  C‚Äôest la chose la plus importante.  Nous sommes paresseux et nous faisons un prototype, non? <br><br>  Les √©tapes suivantes pour am√©liorer le mod√®le √©taient compr√©hensibles - marquez avec vos mains plus de ces captures d'√©cran et entra√Ænez-les sur le mod√®le, form√© sur les captures d'√©cran g√©n√©r√©es. <br></div></div><br><h2>  Descendons au bot </h2><br>  J'ai d√©cid√© d'√©crire un bot en Python - il a de nombreux outils disponibles pour ML.  J'ai d√©cid√© d'utiliser mon mod√®le avec OpenCV, qui √† partir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.5 a appris √† utiliser des mod√®les de r√©seaux neuronaux</a> , et j'ai m√™me trouv√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple simple</a> .  Apr√®s avoir essay√© plusieurs biblioth√®ques pour travailler avec ADB, j'ai choisi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pure-python-adb</a> - tout ce dont j'ai besoin y est simplement impl√©ment√©: la fonction de capture d'√©cran et l'op√©ration sur le p√©riph√©rique shell;  Je tape en utilisant le ¬´tap d'entr√©e¬ª. <br><br>  Donc, apr√®s avoir re√ßu une capture d'√©cran du jeu, en reconnaissant les unit√©s et en le poussant sur l'√©cran, j'ai continu√© √† travailler sur la reconnaissance de l'√©tat du jeu.  En plus des unit√©s, je devais reconna√Ætre le niveau de mana actuel et les cartes disponibles pour le joueur. <br><br>  Le niveau de mana dans le jeu est affich√© sous forme de barre de progression et de chiffres.  Sans r√©fl√©chir √† deux fois, j'ai commenc√© √† d√©couper le nombre, √† inverser et √† reconna√Ætre en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pytesseract</a> . <br><br>  Pour d√©terminer les cartes disponibles et leur position, j'ai utilis√© le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©tecteur de points KAZE d'OpenCV</a> .  Jusqu'√† pr√©sent, je ne voulais pas recommencer √† apprendre le r√©seau neuronal, et j'ai choisi une m√©thode plus rapide et plus facile, bien qu'au final, elle se soit av√©r√©e avoir la pr√©cision minimale suffisante dans le cas o√π vous devez rechercher de nombreux objets. <br><br>  Lors du d√©marrage du bot, j'ai compt√© les points cl√©s pour toutes les images de la carte (il y en a plusieurs dizaines au total), et pendant le jeu, j'ai cherch√© des correspondances de toutes les cartes avec la zone de carte du joueur pour r√©duire le nombre d'erreurs et augmenter la vitesse.  Ils ont √©t√© tri√©s par pr√©cision et par la coordonn√©e <i>x</i> pour obtenir l'ordre des cartes - des informations sur leur localisation √† l'√©cran. <br><br>  Ayant un peu jou√© avec les param√®tres, en pratique j'ai eu beaucoup d'erreurs, bien que certaines images complexes de cartes, qui ont parfois √©t√© confondues avec d'autres par l'algorithme, aient √©t√© reconnues avec une grande pr√©cision.  J'ai d√ª ajouter un tampon de trois √©l√©ments: si trois reconnaissances cons√©cutives nous obtenons les m√™mes valeurs, alors nous croyons conditionnellement que nous pouvons leur faire confiance. <br><br><img src="https://habrastorage.org/webt/vr/8a/mj/vr8amjw6_mpuh8kzethfk0zbkya.png"><br><br>  Apr√®s avoir re√ßu toutes les informations n√©cessaires (unit√©s et leur position approximative, mana et cartes disponibles), vous pouvez prendre certaines d√©cisions. <br><br>  Pour commencer, j'ai d√©cid√© de prendre quelque chose de simple: par exemple, s'il y a suffisamment de mana sur une carte accessible, jouez-la sur le terrain.  Mais le bot ne sait toujours pas comment "jouer" les cartes - il sait quelles cartes nous avons, o√π est le champ, vous devez cliquer sur la carte souhait√©e, puis sur la cellule souhait√©e dans le champ. <br><br>  Connaissant la r√©solution de la capture d'√©cran, vous pouvez comprendre les coordonn√©es de la carte et la cellule de champ souhait√©e.  Maintenant, je suis li√© √† la r√©solution d'√©cran exacte, mais si n√©cessaire, je peux ignorer cela.  La fonction de d√©cision renverra un tableau de prises qui doivent √™tre effectu√©es dans un proche avenir.  En g√©n√©ral, notre bot sera une boucle infinie (simplifi√©e): <br><br><pre><code class="plaintext hljs">:     =        :         ( )               :         =  ()         =  ()         =  ()         += (, , , )</code> </pre> <br><br>  Jusqu'√† pr√©sent, le bot ne peut mettre des unit√©s qu'√† un moment donn√©, mais dispose d√©j√† de suffisamment d'informations pour construire une strat√©gie plus complexe. <br><br><h3>  Premiers probl√®mes </h3><br>  En r√©alit√©, j'ai rencontr√© un probl√®me inattendu et tr√®s d√©sagr√©able.  La cr√©ation d'une capture d'√©cran via ADB prend environ 100 ms, ce qui introduit un retard important - je m'attendais √† un tel retard maximum, en tenant compte de tous les calculs et du choix d'action, mais pas √† une √©tape de la cr√©ation d'une capture d'√©cran.  Une solution simple et rapide n'a pas pu √™tre trouv√©e.  En th√©orie, en utilisant l'√©mulateur Android, vous pouvez prendre des captures d'√©cran directement depuis la fen√™tre de l'application, ou vous pouvez cr√©er un utilitaire pour diffuser des images √† partir d'un t√©l√©phone avec compression via UDP et y connecter le bot, mais je n'ai pas non plus trouv√© de solutions rapides ici. <br><br><h2>  Alors </h2><br>  Ayant √©valu√© sobrement l'√©tat de mon projet, j'ai d√©cid√© de m'attarder sur ce mod√®le pour l'instant.  J'ai pass√© plusieurs semaines de mon temps libre √† le faire, et la reconnaissance des unit√©s n'est qu'une partie du gameplay. <br><br>  J'ai d√©cid√© de d√©velopper progressivement les parties du bot - pour faire la logique de base de la perception, puis la logique simple du jeu et l'interaction avec le jeu, et ensuite il sera possible d'am√©liorer les parties individuelles du bot.  Lorsque le niveau du mod√®le de reconnaissance d'unit√© devient suffisant, l'ajout d'informations sur HP et le niveau d'unit√©s peut amener le d√©veloppement du bot de jeu √† une toute nouvelle √©tape.  Ce sera peut-√™tre le prochain objectif, mais pour l'instant, cela ne vaut vraiment pas la peine de se concentrer sur cette t√¢che. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©p√¥t de projets Github</a> <br><br>  J'ai pass√© beaucoup de temps sur le projet et, franchement, j'en ai marre, mais je ne le regrette pas un peu - j'ai acquis une nouvelle exp√©rience en ML / CV. <br><br>  Peut-√™tre que je reviendrai vers lui plus tard - je serai heureux si quelqu'un me rejoint.  Si vous √™tes int√©ress√©, rejoignez le groupe sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Telegram</a> , et venez √©galement √† mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours Scala</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439352/">https://habr.com/ru/post/fr439352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439342/index.html">DIYorDIE Winter Meetup 17 f√©vrier</a></li>
<li><a href="../fr439344/index.html">Comme un troll: comment les monopoles gouvernent les brevets</a></li>
<li><a href="../fr439346/index.html">Laravel + Docker: notre exp√©rience r√©ussie</a></li>
<li><a href="../fr439348/index.html">La vision baisse apr√®s la correction de la vue au laser - que faire? Ou, docteur, faites-moi une am√©lioration</a></li>
<li><a href="../fr439350/index.html">L'intelligence artificielle comme machine d'invention</a></li>
<li><a href="../fr439354/index.html">Rust News # 5 (janvier 2019)</a></li>
<li><a href="../fr439356/index.html">Mesures non triviales de l'efficacit√© des campagnes publicitaires</a></li>
<li><a href="../fr439358/index.html">M√©tadonn√©es des fichiers Excel</a></li>
<li><a href="../fr439360/index.html">Formation Cisco 200-125 CCNA v3.0. Sp√©cialiste r√©seau certifi√© Cisco (CCNA). Jour 3. Sous-r√©seaux</a></li>
<li><a href="../fr439362/index.html">Comment enseigner le g√©nie logiciel au HSE de Saint-P√©tersbourg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>