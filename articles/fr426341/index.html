<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛈️ 🏠 🧑🏿‍🤝‍🧑🏿 Mémorisation du kwarg par défaut en Python 🐑 👨🏿‍⚕️ 👨🏻‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voici comment vous pouvez mémoriser une fonction Python: 



def memo_square(a, cache={}): if a not in cache: cache[a] = a*a return cache[a]  
 L'accu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mémorisation du kwarg par défaut en Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426341/">  Voici comment vous pouvez mémoriser une fonction Python: <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">memo_square</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, cache={})</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cache: cache[a] = a*a <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache[a]</code> </pre> <br>  L'accueil est à juste titre peu connu, donc sous la coupe, nous analyserons comment cela fonctionne et à quoi il sert. <br><a name="habracut"></a><br>  Tout d'abord, comment et pourquoi cela fonctionne.  <code>memo_square</code> (comme toute autre fonction) est un objet de la classe de fonction, qui, entre autres attributs, a un <code>memo_square.__defaults__</code> rempli lors de la création de l'objet.  Tout d'abord, il contient un dictionnaire vide, comme indiqué dans l'en-tête de la fonction: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>memo_square.__defaults__ ({},)</code> </pre> <br>  <code>__defaults__</code> est un tuple régulier et vous ne pouvez pas modifier ses éléments.  Certes, vous pouvez remplacer l'ensemble des valeurs par défaut en une seule fois, mais uniquement par un autre tuple: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, b=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> ... print(a, b) ... &gt;&gt;&gt; test.__defaults__ (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) &gt;&gt;&gt; test() <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> &gt;&gt;&gt; test.__defaults__ = (<span class="hljs-string"><span class="hljs-string">', '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) &gt;&gt;&gt; test() ,  &gt;&gt;&gt; test.__defaults__[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span> Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; TypeError: <span class="hljs-string"><span class="hljs-string">'tuple'</span></span> object does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support item assignment &gt;&gt;&gt; test.__defaults__ = {<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-string"><span class="hljs-string">', '</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>} Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; TypeError: __defaults__ must be set to a tuple object</code> </pre> <br>  Soryan, cet article n'arrivera pas à Picaba.  Eh bien, ce n'est pas important.  L'important est qu'à l'exception du code très délicat, <code>func.__defaults__</code> est créé une fois pendant la durée du programme avec tous ses éléments.  Un tuple et ses éléments ne seront pas recréés à chaque appel de fonction, ils seront utilisés tant que la fonction existera.  Mais pour changer, si les éléments eux-mêmes sont mutables, personne ne les interdit.  L'incapacité à travailler avec de tels éléments est l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une des façons les plus courantes de se tirer une balle dans le python</a> .  Mais la sauvegarde de valeurs entre les appels de fonction peut être très utile.  Après plusieurs appels, <code>memo_square.__defaults__</code> ressemblera à ceci: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>memo_square(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt;&gt; memo_square.__defaults__ ({<span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>},) &gt;&gt;&gt; memo_square(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">25</span></span> &gt;&gt;&gt; memo_square.__defaults__ ({<span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>},) &gt;&gt;&gt; memo_square(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt;&gt; memo_square.__defaults__ ({<span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>},)</code> </pre> <br>  Si la fonction a déjà été appelée pour la même valeur, la valeur est calculée et, par conséquent, le cache n'est pas réapprovisionné.  Pour un carré, l'avantage est faible (à proprement parler, pour un carré, l'avantage est négatif, car la recherche dans un dictionnaire est plus coûteuse que la multiplication de deux nombres), mais pour des fonctions vraiment chères, la mémorisation / mise en cache peut être utile.  Bien sûr, vous pouvez le fournir en python de plusieurs manières.  Voici les alternatives que nous avons: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ functools.lru_cache</a> .  Un décorateur du module functools qui se souvient des derniers appels de fonction.  Il est fiable et simple, mais il utilise tous les paramètres de la fonction comme clés, ce qui signifie qu'il nécessite une capacité de hachage et ne peut pas remarquer que deux valeurs de paramètres formellement différentes sont équivalentes.  Avec la première exigence, tout est clair, sur les fonctions des ensembles, par exemple, vous pouvez oublier.  Eh bien, ou lorsque vous appelez, convertissez-les en frozenset.  Quant au second, par exemple, j'ai une fonction qui accepte une connexion à la base de données SQL et un numéro en entrée, et effectue quelques manipulations avec les données associées à ce numéro.  La connexion peut très bien être déconnectée et rétablie pendant le fonctionnement du programme, et le cache lru_cache s'envolera alors.  Mais il sait mettre en cache seulement un nombre limité d'appels (en évitant les fuites de mémoire) et est bien documenté. </li><li>  Cache en dehors de la fonction: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">square</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a**a cache = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> values: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cache: cache[x] = x**x <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> cache[x]</code> </pre> <br>  Le sens est le même, mais beaucoup plus lourd.  De plus, la variable de cache est visible en dehors de la fonction, bien qu'elle ne soit pas utilisée pour autre chose que sa mémorisation.  Le cache pendant la mémorisation avec l'argument par défaut est accessible en externe uniquement via <code>func.__defaults__</code> , qui sont assez difficiles d'accès par erreur. </li><li>  Videz un objet à part entière avec un cache et faites de sa fonction une méthode.  Bon en termes d'architecture et de testabilité, il vous permet de maintenir une logique de mise en cache arbitrairement complexe, mais encore plus encombrante en raison du passe-partout dans le code objet.  De plus, il n'est pas clair de quoi hériter et s'il faut hériter de quoi que ce soit, s'il y a plus d'une fonction mémorisable. </li></ul><br>  La principale chose que cette méthode de mémorisation perd, c'est qu'elle n'est pas très idiomatique.  Personnellement, lorsque je suis tombé sur cette décision pour la première fois, j'ai réfléchi quelques minutes à ce qui se passait ici et pourquoi.  D'un autre côté, au cours de ces quelques minutes, j'ai commencé à mieux comprendre comment les fonctions Python et leurs arguments sont organisés.  Donc, même si vous n'utilisez pas les arguments par défaut (pour la mémorisation ou, par exemple, pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">accélérer la résolution de noms</a> ), connaître cette technique est toujours utile pour tout nutritionniste. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426341/">https://habr.com/ru/post/fr426341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426327/index.html">Nouveautés de la mise à jour d'octobre 2018 de Windows 10</a></li>
<li><a href="../fr426331/index.html">Vulnérabilité dans PlayStation 4 - le jeu de caractères dans le message pour l'utilisateur transforme à distance la console en presque une "brique"</a></li>
<li><a href="../fr426333/index.html">Microsoft a publié le code MS-DOS 1.25 et 2.0 sous la licence MIT</a></li>
<li><a href="../fr426335/index.html">«Technologie martienne»: pourquoi les centres de données passent aux piles à combustible</a></li>
<li><a href="../fr426339/index.html">25 octobre 2018 Réunion du groupe d'utilisateurs Atlassian à Raiffeisenbank</a></li>
<li><a href="../fr426343/index.html">Règles de comportement gentleman en informatique: l'histoire d'ITIL</a></li>
<li><a href="../fr426345/index.html">Des puzzles intéressants issus d'entretiens techniques</a></li>
<li><a href="../fr426347/index.html">ITMO University Digest: Nouvelles études, expérience des anciens et projets internationaux</a></li>
<li><a href="../fr426349/index.html">Nous créons une station de radio Internet simple, compacte et bon marché</a></li>
<li><a href="../fr426351/index.html">Modifications apportées aux certifications et examens Microsoft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>