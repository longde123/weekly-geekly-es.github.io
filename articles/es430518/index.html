<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê© üö¥ ‚èèÔ∏è C√≥mo renderizar el marco de la Tierra Media: Shadow of Mordor üíí ‚õ™Ô∏è üßíüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Middle Earth: Shadow of Mordor se lanz√≥ en 2014. El juego en s√≠ fue una gran sorpresa, y el hecho de que fuera un spin-off de la historia del universo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo renderizar el marco de la Tierra Media: Shadow of Mordor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430518/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ow/br/se/owbrsedfx4zll9o8sxbxx2fbnza.gif"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Middle Earth: Shadow of Mordor</a> se lanz√≥ en 2014.  El juego en s√≠ fue una gran sorpresa, y el hecho de que fuera un spin-off de la historia del universo del Se√±or del Anillo fue bastante inesperado.  El juego obtuvo un gran √©xito y, al momento de escribir, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Monolith</a> ya lanz√≥ una secuela: Shadow of War.  Los gr√°ficos del juego son muy hermosos, especialmente teniendo en cuenta que fue lanzado para diferentes generaciones de consolas, incluidas la Xbox 360 y la PS3.  La versi√≥n para PC est√° bastante bien pulida, contiene opciones de gr√°ficos adicionales y paquetes de texturas de alta resoluci√≥n que revelan completamente el potencial del juego. <br><br>  El juego utiliza el renderizador diferido DX11 relativamente nuevo.  Utilic√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Renderdoc</a> para aprender profundamente las t√©cnicas de renderizado del juego.  Al trabajar, se utilizaron los par√°metros gr√°ficos m√°ximos posibles (ultra) y se incluyeron todas las "lociones" posibles, como la transparencia independiente del orden, la teselaci√≥n, la oclusi√≥n en el espacio de la pantalla y varios desenfoques de movimiento. <br><a name="habracut"></a><br><h2>  Marco </h2><br>  Aqu√≠ hay un marco que analizaremos.  El jugador est√° ubicado en una plataforma de madera en la regi√≥n de Udun.  Shadow of Mordor usa una mec√°nica similar a la mec√°nica de juegos como Assassin's Creed, donde puedes escalar edificios y torres, y luego disfrutar del paisaje digital circundante desde los tejados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73d/325/3e0/73d3253e0323327f95babf989f060f93.jpg" alt="imagen"></div><br><h2>  Pasaje de profundidad </h2><br>  Las aproximadamente 140 primeras llamadas de renderizado hacen un pase preliminar r√°pido para renderizar los elementos y edificios de elevaci√≥n m√°s grandes al b√∫fer de profundidad.  La mayor√≠a de los objetos no entran en este pase preliminar, pero ayuda cuando el juego tiene una gran cantidad de llamadas de empate y puedes mirar a lo lejos.  Curiosamente, un personaje que siempre est√° en el centro de la pantalla y ocupa una fracci√≥n decente del espacio de la pantalla no entra en este pasaje.  Como en muchos otros juegos de mundo abierto, el motor utiliza los valores z inversos.  Esta t√©cnica une el plano cercano a 1.0 y el plano lejano a 0.0 para aumentar la precisi√≥n a grandes distancias y evitar conflictos z.  Lea m√°s sobre la precisi√≥n del z-buffer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/181/ba6/57d/181ba657ddc430ee3a892e852cc276e9.png" alt="imagen"></div><br><h4>  G-buffer </h4><br>  Inmediatamente despu√©s de esto, comienza el pase G-buffer, que se realiza en aproximadamente 2700 llamadas de extracci√≥n.  Si ley√≥ mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">an√°lisis anterior de Castlevania: Lords of Shadow 2</a> o estudi√≥ otros art√≠culos similares, entonces este pasaje deber√≠a serle familiar.  La propiedad de las superficies se registra en un conjunto de memorias intermedias, que luego se leen en los pasos del c√°lculo de la iluminaci√≥n para calcular las reacciones de las superficies a la luz.  Shadow of Mordor utiliza un cl√°sico renderizador diferido, pero se utiliza un n√∫mero relativamente peque√±o de objetivos de renderizado del G-buffer para lograr este objetivo (3).  A modo de comparaci√≥n: Unreal Engine en este pasaje usa 5-6 buffers.  G-buffer tiene el siguiente esquema: <br><br><h5>  Tamp√≥n normal </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Un</strong> </td></tr><tr><td>  <strong>Normal.x</strong> </td><td>  <strong>Normal.y</strong> </td><td>  <strong>Normal.z</strong> </td><td>  <strong>ID</strong> </td></tr></tbody></table><br>  El buffer de normales almacena las normales en el espacio mundial en el formato de "8 bits por canal".  Esto es apenas suficiente, y a veces nada, para describir superficies planas que var√≠an suavemente.  Si te fijas bien, esto se puede ver en algunos charcos en el juego.  El canal alfa se usa como una ID que marca varios tipos de objetos.  Por ejemplo, descubr√≠ que 255 se refiere al personaje, 128 a la parte animada de la bandera, y el cielo est√° marcado con ID 1, porque m√°s tarde estos identificadores se usan para filtrarlo en la etapa de adici√≥n (el cielo obtiene su propia floraci√≥n radial). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/jf/y8/zajfy84cg-abqarjiybgm3qcztw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9k/aq/4v/9kaq4vempyj-n14_kdfte3d51ss.png"></div><br>  <i>En el art√≠culo original, estas y muchas otras im√°genes est√°n animadas para mayor claridad, por lo que recomiendo mirar all√≠.</i> <br><br><h5>  Buffer Albedo </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Un</strong> </td></tr><tr><td>  <strong>Albedo.r</strong> </td><td>  <strong>Albedo.g</strong> </td><td>  <strong>Albedo.b</strong> </td><td>  <b>Oclusi√≥n de la cavidad</b> </td></tr></tbody></table><br>  El b√∫fer de albedo almacena los tres componentes de albedo y una oclusi√≥n a peque√±a escala (a veces llamada oclusi√≥n de cavidad), que se utiliza para sombrear peque√±os detalles que no pueden ser alcanzados por un mapa de sombras o un procesamiento posterior en el espacio de la pantalla.  Se utiliza principalmente para fines decorativos, por ejemplo, agujeros y arrugas en la ropa, peque√±as grietas en un √°rbol, peque√±os patrones en la ropa de Talion, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t6/ul/bz/t6ulbzqtlw3ncodrlnd49uxtmwa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/28/52/lr/2852lrdq75bxtqpkywvutfsm4se.png"></div><br>  Al procesar enemigos en el sombreador, albedo tiene en cuenta la textura de la sangre (curiosamente, Talion nunca recibe heridas visibles).  La textura de la sangre es la entrada para la fase de renderizado de la ropa y el cuerpo de los enemigos, pero no especifica el color de la sangre, que es la entrada en el b√∫fer constante, pero determina los factores / niveles de sangre para controlar la cantidad de sangre mostrada.  Adem√°s, la orientaci√≥n normal se utiliza para escalar el efecto, lo que le permite controlar la direcci√≥n de las salpicaduras de sangre.  Luego, el albedo esencialmente se sombrea con el brillo de las heridas recibidas por el enemigo, tomadas del lugar apropiado en el mapa de sangre, y tambi√©n modifica otras propiedades, como la especular, para obtener un efecto sangu√≠neo convincente.  No pude encontrar la parte del marco en la que se representa el mapa, pero supongo que se registran justo al comienzo del marco cuando se expone la espada, y luego se usan aqu√≠. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1y/_r/rt/1y_rrtgi8bsuryvjmqmpdvzwpfk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mi/tv/nu/mitvnumojb0zx4qhzohrgrj810e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qp/wx/t7/qpwxt7y4r-k3ugakdasysx1vtvm.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6d/-r/lz/6d-rlzgi7fvdep6xrxnakmjp9yg.png"></div><br><h5>  Tamp√≥n especular </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Un</strong> </td></tr><tr><td>  <b>Aspereza</b> </td><td>  <b>Intensidad especular</b> </td><td>  <b>Fresnel</b> </td><td>  <b>Factor de dispersi√≥n subsuperficial</b> </td></tr></tbody></table><br>  El b√∫fer especular contiene otras propiedades de la superficie que se pueden ver en los juegos, como la rugosidad (esto no es del todo rugosidad, sino un grado especular escalado, pero se puede interpretar de esta manera), la intensidad especular (brillo especular) que escala albedo para obtener el color correcto especular, factor de reflectividad (com√∫nmente conocido en la literatura como F0, porque es la entrada a la respuesta del espejo de Fresnel) y el componente de dispersi√≥n subsuperficial (dispersi√≥n subsuperficial).  El √∫ltimo componente se utiliza para iluminar materiales transl√∫cidos como tejidos finos, plantas y piel.  Si luego nos sumergimos en el estudio del sombreador de iluminaci√≥n, encontramos que aqu√≠ usamos la variaci√≥n del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo especular normalizado seg√∫n Blinn-Fong</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/rv/8c/qxrv8c9xk-4-akibiogsgnvxszw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/xw/_f/wvxw_f6h-5vgmu6cvlucuum3sei.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/f3/v1/fbf3v1y8ardyfkjtshlv8zf5ld8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ql/zq/lz/qlzqlzbbxwy_mlx05pwxwpxmrga.png"></div><br><h5>  Calcoman√≠as diferidas </h5><br>  Como vimos anteriormente, Shadow of Mordor muestra rastros de sangre bastante detallados en los personajes heridos.  Cuando Talion agita su espada, el medio ambiente tambi√©n recibe su parte de sangre oscura de orco.  Sin embargo, otra t√©cnica se utiliza para entornos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">calcoman√≠as diferidas</a> .  Esta t√©cnica consiste en proyectar un conjunto de texturas planas sobre la superficie de lo que se renderiz√≥ anteriormente.  De esta forma, el contenido del G-buffer se reemplaza con este nuevo contenido antes de realizar el pase de iluminaci√≥n.  En el caso de la sangre, solo es suficiente un roc√≠o sangriento, y cuando se generan muchas calcoman√≠as, se crea r√°pidamente un paisaje bastante sombr√≠o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8_/zo/no/8_zonoux0rx6h_cemftpprebcke.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/sc/qn/pkscqng3m2s0c2hj-e-fs1eonis.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/uf/rs/a4ufrsgki8blucgm4g8zq3n95ha.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/jl/3c/djjl3c5s2dsimxwtoim-c5vk3rg.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/hj/cb/wjhjcbcfdu0ts1kpnmh_2_tvhdq.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8r/tk/fi/8rtkfinzlyym0jweyx0gpizv4zs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uh/ns/pw/uhnspwmomqsrlnoctsokx8q878a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/di/7m/70/di7m700h63pqtmaiydgrezyt0w4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8t/ky/sz/8tkyszkhinic56jqebsteeudram.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0a/tu/kj/0atukjo4vjzv3djehm6sttjhqps.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-5/vm/ja/-5vmjatrsxyfdjhqm5nhsmu_vxw.png"></div><br>  Lo √∫ltimo que se representa en el pasaje G-buffer es el cielo, la textura del cielo es de muy alta resoluci√≥n (8192 √ó 2048) en formato HDR BC6H.  Tuve que hacer una peque√±a correcci√≥n de tono, porque en HDR todos los colores son demasiado oscuros. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95a/6b2/dda/95a6b2dda3a632aebe8fc902f143232d.jpg" alt="imagen"></div><br><h3>  Teselaci√≥n </h3><br>  Una "caracter√≠stica" muy interesante del juego (si est√° activada) es la teselaci√≥n.  Se utiliza para muchas cosas diferentes, desde el terreno hasta la representaci√≥n de personajes (as√≠ como accesorios y objetos de personajes).  Aqu√≠, la teselaci√≥n no subdivide la malla de polietileno baja, sino que crea pol√≠gonos a partir de una nube de puntos, utilizando el grado de subdivisi√≥n necesario, seg√∫n los criterios para el nivel de detalle, por ejemplo, la distancia a la c√°mara.  Un ejemplo interesante es la capa de Talion, que se transmite a la GPU como una nube de puntos (despu√©s de la simulaci√≥n f√≠sica), y el sombreador de teselaci√≥n recrea los pol√≠gonos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/jf/3i/1ijf3ikncscrhyvhjyyan6kdx80.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/fp/il/wjfpil_rw7_t1z7pxrfntobcrse.png"></div><br><h3>  Transparencia independiente del orden </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b78/f09/897/b78f09897b7ed45f990f51f91291c967.png"></div><br>  Una de las primeras cosas que me sorprendi√≥ con su extra√±eza es el pase de tratamiento capilar, ya que realiza un sombreador especial muy complejo.  En las opciones de gr√°ficos, se menciona la opci√≥n OIT (Transparencia independiente del orden) para el cabello, es decir, deber√≠a serlo.  Primero, realiza la salida a un b√∫fer separado y calcula el n√∫mero total de p√≠xeles transparentes superpuestos entre s√≠, al tiempo que guarda las propiedades en una estructura "profunda" similar a un b√∫fer G.  M√°s tarde, otro sombreador clasifica fragmentos individuales individuales de acuerdo con su profundidad.  Parece que las flechas tambi√©n se muestran de esta manera (probablemente, su plumaje requiere una clasificaci√≥n adecuada).  Este es un efecto muy sutil que no agrega ninguna diferencia gr√°fica especial, pero sigue siendo un detalle interesante.  Aqu√≠ hay un ejemplo simple: la imagen de arriba muestra el n√∫mero de fragmentos superpuestos (cuanto m√°s rojos, m√°s fragmentos).  La transparencia regular sigue ordenada por la CPU y se representa como alfa tradicional.  Solo las entidades individuales caen en el pase OIT. <br><br><h3>  Sombras de Mordor </h3><br>  SoM tiene muchas fuentes de sombra.  Adem√°s de los mapas de sombras tradicionales de fuentes de luz din√°micas, SoM utiliza una oclusi√≥n ambiental de dos canales en el espacio de la pantalla, una oclusi√≥n a microescala creada para casi todos los objetos en el juego y una textura de oclusi√≥n similar a un mapa de altura con una vista superior. <br><br><h5>  Oclusi√≥n en el espacio de la pantalla. </h5><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2cb/58c/fc5/2cb58cfc57777d65a15af4813977c962.png"></div><br>  El primer paso se procesa utilizando el buffer G ambiental y la oclusi√≥n especular en el espacio de la pantalla.  El sombreador en s√≠ mismo es un gran ciclo desplegado que muestrea tanto el mapa de profundidad de tama√±o completo como el mapa de profundidad promedio previamente reducido, buscando muestras vecinas en un patr√≥n dado.  Utiliza una textura cuadrada de 4x4 para seleccionar vectores pseudoaleatorios en busca de fuentes de oclusi√≥n.  Representa un b√∫fer de oclusi√≥n ruidoso, que luego se suaviza con un simple desenfoque en dos pasadas.  La caracter√≠stica m√°s interesante aqu√≠ es que hay dos canales de oclusi√≥n diferentes: uno de ellos se utiliza como oclusi√≥n especular y el otro como oclusi√≥n difusa.  En implementaciones SSAO est√°ndar, se calcula un canal que se aplica a toda la iluminaci√≥n horneada.  Aqu√≠, la tarjeta SSAO tambi√©n se lee para su transmisi√≥n al paso de iluminaci√≥n direccional, donde se utiliza. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/re/xf/kj/rexfkjx49htyufzecfeg2n7lsau.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/va/nz/dlvanzzg8bpcqughsrout8kaxlg.png"></div><br><h5>  Cartas de sombra </h5><br>  El siguiente evento es la representaci√≥n del mapa de sombras.  Dado que la acci√≥n del juego tiene lugar principalmente en espacios abiertos, la mayor parte de la luz y las sombras se toman de la luz direccional principal.  Aqu√≠ utilizamos la t√©cnica de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mapas de sombras en cascada</a> (una variaci√≥n de los cuales es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">mapas de sombras divididos en paralelo</a> ), una t√©cnica bastante est√°ndar para aplicar sombras a largas distancias, que consiste en representar la misma escena desde un punto de vista de la fuente de luz para diferentes √°reas del espacio.  Por lo general, los mapas de sombras alejados del √°rea de cobertura de la c√°mara est√°n a grandes distancias o tienen una resoluci√≥n m√°s baja que las anteriores, lo que esencialmente reduce la resoluci√≥n en √°reas en las que a√∫n no se requieren detalles debido al hecho de que la geometr√≠a est√° demasiado lejos.  En esta escena, el juego presenta tres cascadas de sombras 4096 √ó 4096 (de hecho, el juego tiene un lugar para cuatro).  La cascada superior est√° muy cerca de Talion, y la inferior incluye monta√±as y objetos muy lejos de la c√°mara.  Cuando se trabaja con sombras, el juego usa el mismo truco con la coordenada z inversa que en el mapa de profundidad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/7bc/a65/3477bca65b8cff92dfcfd68c9d66b8a8.jpg"></div><br><h5>  Buffer de sombra </h5><br>  El siguiente paso es crear un b√∫fer de sombra.  Esta es una textura de un solo canal, basada en informaci√≥n de oclusi√≥n de mapas de sombras anteriores, codifica un factor de sombra en el intervalo [0, 1].  Para crear suavidad alrededor de los bordes, el mapa de sombras se muestrea 4 veces usando el estado de un muestreador bilineal especial, que recibe 4 muestras y las compara con un valor dado (esto se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">filtrado porcentual de cierre</a> ).  Obtener m√∫ltiples muestras y promediar sus resultados a menudo se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Porcentaje de sombras suaves m√°s cercanas</a> .  Adem√°s de leer el mapa de sombras, tambi√©n se muestrea el √∫ltimo componente del b√∫fer especular (es decir, el coeficiente de dispersi√≥n subsuperficial), que se multiplica por el "factor de purga de luz".  Parece que esto es necesario para eliminar el sombreado de estos objetos, para que pase un poco m√°s de luz a trav√©s de ellos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7f/b55/63f/b7fb5563faae1553e0f970374ee0b774.jpg"></div><br><h5>  Textura de proyecci√≥n direccional </h5><br>  Otra fuente de luz y sombra es una textura de vista superior muestreada por una fuente de luz direccional.  Este es el color agregado al color de la fuente de luz direccional, m√°s el efecto de sombreado global que se aplica a la iluminaci√≥n direccional.  Parece que algunos de ellos fueron creados manualmente sobre un mapa de iluminaci√≥n de nivel generado autom√°ticamente con una vista superior.  Parece que los bordes de las sombras para la geometr√≠a est√°tica se ajustan manualmente (quiz√°s para evitar conflictos con el mapa de sombras real), y algunas partes tambi√©n parecen estar ligeramente te√±idas a mano.  Probablemente la tarea de esta textura es la adici√≥n de bajo costo de la oclusi√≥n ambiental a gran escala y las simulaciones de iluminaci√≥n global liviana, adem√°s de la iluminaci√≥n direccional.  Las im√°genes a continuaci√≥n muestran el tono, la oclusi√≥n y el producto de ambos factores, lo que nos da una idea de c√≥mo se ve la m√°scara de color final. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6v/vf/6a/6vvf6aaf5khdrbclmwpzp9_faka.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7e/fs/fe/7efsferrjbdtsu9megpk0gtfidc.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sd/bk/sv/sdbksv3a4jlkgzxui4nvl-suylq.png"></div><br>  El resultado de todos los pases de iluminaci√≥n se guarda en el objetivo de representaci√≥n del formato R11G11B10F.  As√≠ es como se ve el resultado.  Realic√© una correcci√≥n tonal de los resultados para hacer m√°s visible el efecto de la iluminaci√≥n direccional en el nivel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2a/28e/a63/f2a28ea6372642667b3778dfc32b193f.jpg"></div><br>  Todas las monta√±as distantes (que no se muestran en la imagen de arriba) tambi√©n se iluminan con luz direccional, pero se resaltan como un caso separado para que la iluminaci√≥n pueda controlarse mejor.  Algunos est√°n escalados, pero los que est√°n m√°s lejos en realidad son impostores con mapas normales y albedo inteligentemente creados.  Tienen fuentes especiales de iluminaci√≥n direccional que afectan solo a las monta√±as. <br><br><h3>  Iluminaci√≥n est√°tica </h3><br>  Shadow of Mordor utiliza una implementaci√≥n de iluminaci√≥n est√°tica muy intensiva en memoria, que utiliza texturas de gran volumen.  La imagen a continuaci√≥n muestra tres texturas est√°ticas para la cantidad de iluminaci√≥n utilizada para iluminar difusamente parte de esta √°rea.  Cada uno de ellos es una gran textura comprimida 512x512x128 BC6H, es decir, ocupan 32 MB por textura o 96 MB en general (jugamos con configuraciones de m√°xima calidad).  La textura del color indica la intensidad que ingresa al v√≥xel.  Los otros dos indican la fuerza o magnitud de esta intensidad a lo largo de las seis direcciones xyz y -xyz, y la normal se usa para seleccionar tres componentes (xyz positivo o negativo, aquellos que son m√°s consistentes con lo normal).  Una vez construido este vector, tomamos su producto vectorial por el cuadrado de lo normal, y esto se convierte en el factor de escala para la intensidad.  La f√≥rmula es la siguiente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l9/yw/vk/l9ywvkgxuoti8bbppke_2c8o068.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ez/j3/uf/ezj3ufolhefyqxafjqskci0msho.png"></div><br>  Los vol√∫menes de luz est√°tica tambi√©n representan un mapa c√∫bico para la iluminaci√≥n especular, que probablemente se captura en el centro del SLV.  Curiosamente, las texturas de volumen almacenan valores HDR comprimidos en BC6H, y los mapas c√∫bicos se almacenan en formato BC3 (DXT5), que no puede almacenar valores de punto flotante.  Para compensar esta limitaci√≥n, el canal alfa retiene el brillo, que luego escala de 1 a 10.  Esta es una decisi√≥n un poco extra√±a, y para m√≠, se parece m√°s a una implementaci√≥n de Legacy.  No olvides que el juego se lanz√≥ para las consolas de la generaci√≥n anterior, que no admiten los nuevos formatos de textura HDR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k3/qo/z-/k3qoz-zblorjdxi7jyqthripztg.png"></div><br>  Los cuadros a continuaci√≥n muestran los resultados "antes y despu√©s" teniendo en cuenta el impacto de la imagen promedio.  Para la visualizaci√≥n, realic√© la correcci√≥n tonal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4i/iq/yo/4iiqyosjg2tmdud840rxbhstofa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/su/of/cd/suofcd-ls4myfuivd5vqb9ykbgi.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/37/rq/wb/37rqwb76ngards_rywaxhb_x9xw.png"></div><br><h3>  Niebla atmosf√©rica </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9af/086/c47/9af086c474cada9250daae007ec3c8bc.jpg"></div><br>  Shadow of Mordor tiene un sistema de tiempo y tiempo, gracias al cual el sol brilla o la lluvia cae a trav√©s del juego en Mordor.  Este sistema est√° controlado por la suma de los componentes, y uno de los m√°s importantes es la niebla.  Shadow of Mordor utiliza un modelo de niebla atmosf√©rica bastante simple pero f√≠sicamente s√≥lido, que incluye <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la</a> dispersi√≥n √∫nica de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rayleigh</a> , as√≠ como la dispersi√≥n por una part√≠cula esf√©rica (dispersi√≥n de Mie). <br><br>  Comienza calculando la posici√≥n de la c√°mara con respecto al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">centro de la tierra</a> .  Varias f√≥rmulas trigonom√©tricas permiten determinar d√≥nde se encuentra la c√°mara en la atm√≥sfera, d√≥nde est√° el p√≠xel y qu√© distancia recorre el haz en la atm√≥sfera a una altura m√°xima dada de la atm√≥sfera.  En nuestro caso, la atm√≥sfera se establece a una altura de 65,000 metros sobre la superficie del planeta.  Con esta informaci√≥n en mente, los coeficientes de part√≠culas esf√©ricas y de Rayleigh se utilizan para calcular los tipos de densidades de las part√≠culas de niebla y sus colores.  Estas densidades oscurecen los p√≠xeles ya sombreados, dispersan la luz que ingresa a la c√°mara desde la superficie sombreada y contribuyen a la niebla.  Al simular dicha dispersi√≥n, se tiene en cuenta el brillo y la direcci√≥n del sol. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/at/id/yeatidzdiemga1gntnm1zg9uz8k.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zj/39/zr/zj39zryuhmwdyadmcp0nb_g1uz8.png"></div><br><h3>  Velocidad de obturaci√≥n y correcci√≥n de tono </h3><br>  Al calcular la velocidad de obturaci√≥n, se utiliza un enfoque bastante est√°ndar: reducir secuencialmente la resoluci√≥n del b√∫fer de brillo, calculado a partir del b√∫fer de color HDR principal, en una cadena de texturas, cada una de las cuales es la mitad del tama√±o de la textura anterior, comenzando con una textura 1/3 del b√∫fer de cuadro principal.  Con esta disminuci√≥n en la resoluci√≥n, se toman 4 muestras, promediando los valores de p√≠xeles vecinos, es decir, despu√©s de convertir todos los valores promedio en un solo texel, el resultado final se convierte en brillo promedio.  Despu√©s de que la textura alcanza el tama√±o de 16 √ó 9 texels, se inicia un sombreador de c√°lculo, que resume todos los texels restantes.  Este valor se lee inmediatamente en el pase de correcci√≥n de tono para cambiar los valores de brillo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/bi/h4/igbih41dc2x9aytucfgq1z_iuye.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/gw/t8/osgwt8co0pqgvomovsydsemapuw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qh/bc/qv/qhbcqvqxy5hgvtn9x0c9kd1an6e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/dw/fm/g-dwfm48oqtvuu1bizc1sikm7sq.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zg/8w/oz/zg8wozwpviq0nnt4-kef9b9azis.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/56/ik/dc/56ikdcoixmrbo0whghswhxdzxhk.png"></div><br>  Para la correcci√≥n del tono, se utiliza el operador Reinhardt, cuya f√≥rmula optimizada se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  En el c√≥digo hlsl, esto se ver√° as√≠: <br><br><pre><code class="cpp hljs">float3 hdrColor = tex2D(HDRTexture, uv.xy); hdrColor *= exposureValue; <span class="hljs-comment"><span class="hljs-comment">// This was calculated by the compute shader in the luminance downsampling pass float3 x = max(0.0, hdrColor - 0.004); float3 finalColor = (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);</span></span></code> </pre> <br>  Si trazamos esta curva, veremos que este operador descarta el 10% de los valores de blanco incluso con un valor de entrada de 2.0, al mismo tiempo que deja a la fuerza una peque√±a parte del intervalo inferior completamente en negro.  Esto crea una imagen oscura desaturada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc2/ea1/097/cc2ea10970239fb761b995496c049a8b.jpg" alt="imagen"></div><br><h3>  Etapa alfa </h3><br>  El paso alfa es un poco inusual porque representa los objetos directamente en el b√∫fer LDR.  Otros juegos tambi√©n los muestran en el b√∫fer HDR para que puedan participar en el pase del obturador.  Sea como fuere, la textura de brillo previamente calculada se limita a todos los objetos con iluminaci√≥n alfa (en algunos casos, por ejemplo, para objetos emisores de luz, la velocidad de obturaci√≥n se calcula utilizando las constantes de sombreado, no la b√∫squeda de textura), y por lo tanto, la velocidad de obturaci√≥n se aplica autom√°ticamente al renderizar, y no realizado en postprocesamiento.  Un caso muy espec√≠fico de usar alfa en un juego es una transici√≥n al modo fantasma (en √©l, el fantasma de Celebrimbor se representa sobre el personaje del jugador, forjado en los anillos soberanos del universo LOTR; por lo tanto, el juego muestra que siempre est√° cerca, aunque invisible).  El juego pasa varios par√°metros a las mallas de ambos personajes, que controlan la opacidad y permiten que el juego oscurezca parcialmente a Talion y muestre gradualmente a Celebrimore.  Otros objetos en el juego en modo fantasma tambi√©n muestran versiones fantasmas sobre objetos opacos, como enemigos y torres.  Aqu√≠ hay otra escena con la transici√≥n al mundo fantasmal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ux/ca/zs/uxcazsok9pqzuusfrb__dutdphw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6g/1c/9e/6g1c9esdqit50db_mbck516ma-0.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f_/dq/ss/f_dqss-avlzlyrb4s6_z6kqog0e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uw/yy/va/uwyyvakydfnsksy49ntfltpbwp8.png"></div><br><h3>  Lluvia </h3><br>  En el marco principal que examinamos, no llueve, pero el clima es una parte tan importante del juego que me gustar√≠a mencionarlo aqu√≠.  Se genera y simula en la GPU, y se procesa justo al final de la fase alfa.  Se ejecuta un sombreador de c√≥mputo que realiza la simulaci√≥n y escribe las posiciones en el b√∫fer.  Estas posiciones son tomadas por otro sombreador, que con la ayuda de una llamada indirecta instanciada genera tantas instancias de quads como las posiciones se calcularon en el pase anterior.  El sombreador de v√©rtices tiene un quad simple que, si es necesario, se deforma y gira hacia la c√°mara.  Para evitar que la lluvia penetre a trav√©s de las superficies, el sombreador de v√©rtices tambi√©n lee mapas de altura desde una vista superior, lo que le permite rechazar todas las gotas debajo de la superficie superpuesta.  Este mapa de altura se representa justo al comienzo del marco.  El mismo sombreador de v√©rtices le dice al sombreador de p√≠xeles d√≥nde obtener la muestra de la textura de la gota;  Si la ca√≠da est√° cerca de la superficie, selecciona un √°rea de textura que contiene una animaci√≥n de bienvenida.  Adem√°s, las gotas de lluvia realizan c√°lculos de niebla en el sombreador de p√≠xeles para integrarse perfectamente con el resto de la escena.  Aqu√≠ hay una captura de pantalla desde la misma perspectiva en un d√≠a lluvioso. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xv/yv/ds/xvyvds_w25ybjxilgvr5crbcpo4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/ox/ax/3coxaxhejifprppkaheiahszfcm.png"></div><br>  Cuando se activa el efecto de lluvia, el buffer especular se modifica globalmente para crear superficies h√∫medas, y las ondas de lluvia se convierten en el buffer normal.  La animaci√≥n est√° cronometrada, por lo que solo se utiliza un cuadro de la animaci√≥n en bucle.  El b√∫fer normal que se muestra a continuaci√≥n se modifica para mostrar las ondas representadas en el b√∫fer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ur/du/mz/urdumzhuebf1o2pnud_b2ztlfik.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p3/cv/t_/p3cvt_qq7vo9txgwycf7l2oec2y.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vc/3d/u3/vc3du3ytthqfsw1h7vwzr0tfxom.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6y/tk/rk/6ytkrkj0w38kvccrtrjpey95c_w.png"></div><br><h3>  Destellos de lente y floraci√≥n </h3><br>  Una vez que se completa la representaci√≥n alfa, los destellos de la lente se representan encima.  Se representa una serie de quads desplazados a partir del punto de donde proviene la luz direccional (en nuestro caso, el sol).  Inmediatamente despu√©s de esto, se realiza un pase de floraci√≥n.  Esta es una t√©cnica bastante est√°ndar, que consiste en una serie de texturas borrosas y de tama√±o reducido que contienen p√≠xeles cuyo brillo supera un cierto umbral.  Se utilizan dos pases de floraci√≥n, comunes con el desenfoque gaussiano para toda la escena y un desenfoque radial especial que se aplica solo al cielo.  El desenfoque radial es una de las operaciones que utiliza una identificaci√≥n especial del b√∫fer G de los mapas normales, porque solo se tienen en cuenta los p√≠xeles en el cielo.  Como beneficio adicional, este desenfoque muestrear√° el mapa de profundidad y puede crear <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rayos crepusculares de</a> bajo costo.  Como estamos trabajando con un b√∫fer LDR en esta etapa, el valor del umbral de floraci√≥n es diferente del valor de la alfombra HDR (los valores por encima del umbral, generalmente 1.0, conducen al c√°lculo), y esto significa que el valor de la floraci√≥n obtenida de √©l es ligeramente limitado.  En cualquier caso, esto es bueno para el juego y aqu√≠ est√°n los resultados.  En las im√°genes a continuaci√≥n, los colores de la textura de mip de floraci√≥n se ven un poco extra√±os porque cada p√≠xel est√° escalado por el brillo contenido en el canal alfa.  Este brillo se calcul√≥ anteriormente, en la etapa de correcci√≥n tonal.  En la composici√≥n final, bloom se calcula como <strong>bloom.rgb ¬∑ bloom.a ¬∑ bloomScale</strong> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h3/2y/ra/h32yra8lvz_-pxsab9raxyfobei.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/le/2k/dx/le2kdxxuaqtjrdnhdvxfobubyhw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/kz/mk/jbkzmkd2ans3vxvs_we9eowudvs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/gs/dg/xsgsdgnvhckxgckfhs7k4hvpc7u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/yr/hh/v3yrhhxazolya5nu8fn7id66p6k.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q8/r1/wl/q8r1wlekxf0tae6ivo6bfyjngie.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/5c/tj/gw5ctjh8owpukokne73nskb4n48.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8k/te/sg/8ktesgsr6ser_l6ssaorfcpniww.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j6/u6/ts/j6u6tsvqcjuwqqzepsfeogf330i.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/tf/vg/eetfvgkcuahvbbonuhfnpinh32w.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/zw/bc/m-zwbcp4qvnr69vn1unq1clh3ws.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ei/ta/-s/eita-ssnu2cqzwkspcrjan42-ua.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/db/cb/cs/dbcbcsoo_znq2ex30ixasi-c8le.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/ja/ro/i4jarols6px4f0nnbai-rk5r87u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/na/ag/mj/naagmjq8e75kxcxmyhberqpslag.png"></div><br><h3>  Antialiasing + Profundidad de campo </h3><br>  No hay mucho que decir sobre estas dos operaciones; se utilizan enfoques est√°ndar de la industria.  Se realiza una pasada simple a trav√©s del antialiasing FXAA inmediatamente despu√©s de componer la floraci√≥n con la imagen LDR, y la profundidad de campo se realiza inmediatamente despu√©s.  Por profundidad de campo, el juego presenta dos versiones borrosas disminuidas del b√∫fer final.  Luego, la profundidad de p√≠xel se usa para mezclar im√°genes borrosas y normales, lo que da el efecto de desenfoque.  En aras de la claridad, en esta captura, exager√© el efecto de la profundidad de campo.  El juego tiene un modo de captura de pantalla incorporado, que le permite configurar f√°cilmente estas condiciones. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ug/et/zf/ugetzfmh2jbbcpvrzb1e6dpwbhu.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p_/x4/fk/p_x4fkleolfxxnpvs9vnveywipy.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/vg/bp/bivgbpqa_nmzkx4zgiuzmu3nm6e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w2/vn/hg/w2vnhg6eoxe92rjat51qf65pggo.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/0g/kj/uf0gkjnripqq4ctkcpsremqrqnk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bx/k5/z4/bxk5z47piwcgchqepehqpyypwgu.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/dc/xq/uedcxqx7svcjyq6g0-tp4uc1gho.png"></div><br><h3>  Desenfoque de movimiento </h3><br>  El desenfoque de movimiento consta de dos pases.  Primero, los datos de las orientaciones anteriores y actuales de la c√°mara se transfieren al b√∫fer de velocidad de pantalla completa.  En este caso, dos canales de la textura se llenan de velocidad en el espacio de la pantalla.  Ahora, el canal r contiene la magnitud del cambio de p√≠xel en la direcci√≥n horizontal de la pantalla, y el canal g contiene la magnitud en la direcci√≥n vertical.  As√≠ es como se obtienen rayas radiales al mover la c√°mara.  El personaje se representa nuevamente, esta vez llenando el canal azul en funci√≥n de sus poses actuales y anteriores, como es el caso de la c√°mara.  El canal azul se usa para marcar si se debe o no renderizar.  El canal alfa tambi√©n est√° lleno de un valor constante (0.0598), pero no he investigado su valor o sus objetivos.  La resoluci√≥n del b√∫fer de velocidad se reduce a una textura muy peque√±a promediando un rango relativamente amplio de velocidades en la textura original.  En la √∫ltima pasada, esto le da a cada p√≠xel una idea aproximada de cu√°l ser√° el radio de desenfoque en una pasada de desenfoque real. <br><br>  Luego, el pase de desenfoque lee las texturas de velocidad, un mapa de profundidad, el b√∫fer de color original y la textura de ruido.  Este √∫ltimo se utiliza para ocultar el efecto de una imagen espejo, que puede ocurrir con este tipo de desenfoque con un radio grande.  Luego, el b√∫fer de imagen se muestrea varias veces en la direcci√≥n indicada por el b√∫fer de velocidad, se promedian los colores, lo que conduce a que la imagen se vea borrosa en la direcci√≥n de los vectores de movimiento.  Adem√°s, este efecto se escala de acuerdo con la velocidad de fotogramas con la que funciona el juego.  Para esta captura, tuve que limitar el juego a 30 fps, porque a 60 fps o m√°s, esto apenas se nota. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zn/4r/-7/zn4r-7rgnvx9zuh6asjnzqxknno.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/x_/yu/hrx_yug350grzjbnn6r6d9b7spa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/94/i5/bc/94i5bcpjozmzuykcwfh9vksqjk8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n7/mr/zo/n7mrzoppnprexpqv5h7uj-xobvu.png"></div><br><h3>  Correcci√≥n de color </h3><br>  El paso final de la correcci√≥n de color se realiza utilizando los "cubos de color".  Un cubo de color es una textura 3D cuyos componentes rgb se ajustan a las coordenadas xyz de la textura.  Estas coordenadas xyz contienen el color con el que necesitamos reemplazar el color original.  En nuestro caso, la tabla de b√∫squeda (LUT) es neutral (es decir, las coordenadas y el color contienen el mismo valor), por lo que modifiqu√© la misma escena usando los ajustes preestablecidos que el juego proporciona en el editor de la c√°mara. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-i/dk/rd/-idkrdltmru5ndotkyzhmdbwth4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/az/-x/it/az-xitiqseycg8t_mz0kuhjxh1m.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/em/p0/ds/emp0dsyarj3nhdi-s453p0p0rsa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/9q/fa/1e9qfapyuezjdafa8licevb6csu.png"></div><br><h3>  Marco final </h3><br>  Despu√©s de la creaci√≥n del marco principal en un b√∫fer separado, se representa la IU.  Esto garantiza que, independientemente del tama√±o seleccionado para el b√∫fer trasero, la interfaz de usuario siempre se ver√° clara y hermosa en el tama√±o de la ventana nativa, mientras que el juego puede cambiar la resoluci√≥n si es necesario para garantizar la velocidad.  Al final, ambas texturas se mezclan en funci√≥n de los datos del canal alfa de la interfaz de usuario, y luego se procesan en el b√∫fer de cuadro final, que est√° listo para visualizarse en la pantalla. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/ba/t9/cvbat95whbpymp0cfpnjmohp_oo.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i0/y0/qm/i0y0qmb9x6liyqlpcd4vs2rli3y.png"></div><br>  Espero que hayan disfrutado mi an√°lisis.  Quiero agradecer a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Adrian Correge</a> por el incre√≠ble trabajo que me inspir√≥ a estudiar los gr√°ficos, as√≠ como al personal del estudio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Monolith</a> para este juego realmente inolvidable. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es430518/">https://habr.com/ru/post/es430518/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es430506/index.html">Dark art of resurrection: c√≥mo recuperar datos de medios da√±ados</a></li>
<li><a href="../es430508/index.html">DevOps: ¬øqu√© es realmente?</a></li>
<li><a href="../es430510/index.html">¬øC√≥mo escribir c√≥digo que todos entiendan?</a></li>
<li><a href="../es430512/index.html">C√≥mo viven los freelancers: no trabaje con clientes que lo saben todo y perm√≠tase postergar</a></li>
<li><a href="../es430514/index.html">Blockchain Charity - DataArt gana el Hackathon de la Cumbre Blockchain de Malta</a></li>
<li><a href="../es430520/index.html">Presentamos Spring Data MongoDB</a></li>
<li><a href="../es430522/index.html">¬øNecesitas una cultura corporativa en TI? Confesi√≥n del gerente de marca del estudio Krasnodar Plarium</a></li>
<li><a href="../es430524/index.html">Arquitectura de red neuronal</a></li>
<li><a href="../es430526/index.html">M√°quinas tragamonedas: de d√≥nde vinieron en la URSS y c√≥mo est√°n organizadas</a></li>
<li><a href="../es430528/index.html">Programaci√≥n con PyUSB 1.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>