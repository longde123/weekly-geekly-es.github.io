<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèª üôÖüèº üëäüèΩ Gestionnaire d'affichage de donn√©es r√©actif. Pr√©sentation üê© ‚ôåÔ∏è üë´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il s'agit de la premi√®re partie d'une s√©rie d'articles sur la biblioth√®que ReactiveDataDisplayManager (RDDM) . Dans cet article, je d√©crirai les probl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gestionnaire d'affichage de donn√©es r√©actif. Pr√©sentation</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/466147/">  Il s'agit de la premi√®re partie d'une s√©rie d'articles sur la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ReactiveDataDisplayManager (RDDM)</a> .  Dans cet article, je d√©crirai les probl√®mes courants auxquels je dois faire face lorsque je travaille avec des tables ¬´r√©guli√®res¬ª, ainsi qu'une description du RDDM. <br><br><img src="https://habrastorage.org/webt/ys/lo/ms/yslomsnycv9gjh_69ojwvxzxe14.png"><br><a name="habracut"></a><br><br><h3>  Probl√®me 1. UITableViewDataSource </h3><br>  Pour commencer, oubliez la r√©partition des responsabilit√©s, la r√©utilisation et d'autres mots sympas.  Regardons le travail habituel avec les tables: <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDelegate</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br>  Nous analyserons l'option la plus courante.  Que devons-nous mettre en ≈ìuvre?  Correctement, 3 m√©thodes <code>UITableViewDataSource</code> sont g√©n√©ralement impl√©ment√©es: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberOfSections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span></code> </pre> <br>  Pour l'instant, nous ne ferons pas attention aux m√©thodes auxiliaires ( <code>numberOfSection</code> , etc.) et consid√©rerons la plus int√©ressante - <code>func tableView(tableView: UITableView, indexPath: IndexPath)</code> <br><br>  Supposons que nous voulons remplir un tableau avec des cellules avec une description des produits, alors notre m√©thode ressemblera √† ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> anyCell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-type"><span class="hljs-type">ProductCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = anyCell <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">ProductCell</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.products[indexPath.row]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell }</code> </pre> <br>  Excellent, ce n'est pas difficile.  Supposons maintenant que nous ayons plusieurs types de cellules, par exemple trois: <br><br><ul><li>  Les produits </li><li>  Liste d'actions; </li><li>  La publicit√©. </li></ul><br>  Pour simplifier l'exemple, nous obtenons la m√©thode cell to <code>getCell</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> indexPath.row { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">PromoCell</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getCell() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.promo) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">AdCell</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getCell() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ad) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">AdCell</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getCell() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.products[indexPath.row - <span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } }</code> </pre> <br>  D'une certaine mani√®re, beaucoup de code.  Imaginez que nous voulons cr√©er l'√©cran des param√®tres.  Qu'y aura-t-il? <br><br><ul><li>  Une casquette cellulaire avec un avatar; </li><li>  Un ensemble de cellules avec des transitions "en profondeur"; </li><li>  Cellules avec interrupteurs (par exemple, activer / d√©sactiver l'entr√©e par code PIN); </li><li>  Cellules contenant des informations (par exemple, une cellule sur laquelle il y aura un t√©l√©phone, un e-mail, etc.); </li><li>  Offres personnelles. </li></ul><br>  De plus, l'ordre est fix√©.  Une excellente m√©thode sera ... <br><br>  Et maintenant, une autre situation - il existe un formulaire de saisie.  Sur le formulaire d'entr√©e, un groupe de cellules identiques, chacune √©tant responsable d'un champ sp√©cifique dans le mod√®le de donn√©es.  Par exemple, la cellule pour entrer le t√©l√©phone est responsable du t√©l√©phone et ainsi de suite. <br>  Tout est simple, mais il y en a un ¬´MAIS¬ª.  Dans ce cas, vous devez toujours peindre diff√©rents cas, car vous devez mettre √† jour les champs n√©cessaires. <br><br>  Vous pouvez continuer √† fantasmer et √† imaginer Backend Driven Design, dans lequel nous recevons 6 types de champs d'entr√©e diff√©rents, et selon l'√©tat des champs (visibilit√©, type d'entr√©e, validation, valeur par d√©faut, etc.), les cellules changent tellement que leur ne peut pas conduire √† une seule interface.  Dans ce cas, cette m√©thode sera tr√®s d√©sagr√©able.  M√™me si vous d√©composez la configuration en diff√©rentes m√©thodes. <br><br>  Au fait, apr√®s cela, imaginez √† quoi ressemblera votre code si vous souhaitez ajouter / supprimer des cellules pendant que vous travaillez.  Cela ne sera pas tr√®s joli car nous serons oblig√©s de surveiller ind√©pendamment la coh√©rence des donn√©es stock√©es dans le <code>ViewController</code> et le nombre de cellules. <br><br>  Les probl√®mes: <br><br><ul><li>  S'il existe des cellules de types diff√©rents, le code ressemble √† une nouille; </li><li>  La gestion des √©v√©nements √† partir des cellules pose de nombreux probl√®mes; </li><li>  Code laid au cas o√π vous auriez besoin de changer l'√©tat de la table. </li></ul><br><h3>  Probl√®me 2. MindSet </h3><br>  Le temps des mots sympas n'est pas encore venu. <br>  Voyons comment fonctionne l'application, ou plut√¥t comment les donn√©es apparaissent √† l'√©cran.  Nous pr√©sentons toujours ce processus de mani√®re s√©quentielle.  Eh bien, plus ou moins: <br><br><ol><li>  Obtenez des donn√©es du r√©seau; </li><li>  Pour traiter; </li><li>  Affichez ces donn√©es √† l'√©cran. </li></ol><br>  Mais est-ce vraiment le cas?  Non!  En fait, nous faisons ceci: <br><br><ol><li>  Obtenez des donn√©es du r√©seau; </li><li>  Pour traiter; </li><li>  Enregistrer dans le mod√®le ViewController; </li><li>  Quelque chose provoque un rafra√Æchissement de l'√©cran; </li><li>  Le mod√®le enregistr√© est converti en cellules; </li><li>  Les donn√©es s'affichent √† l'√©cran. </li></ol><br>  En plus de la quantit√©, il existe encore des diff√©rences.  Premi√®rement, nous ne sortons plus de donn√©es, elles sont sorties.  Deuxi√®mement, il existe une lacune logique dans le processus de traitement des donn√©es, le mod√®le est enregistr√© et le processus s'arr√™te l√†.  Puis quelque chose se produit et un autre processus d√©marre.  Ainsi, nous n'ajoutons √©videmment pas d'√©l√©ments √† l'√©cran, mais nous les sauvegardons (ce qui, soit dit en passant, est √©galement lourd) √† la demande. <br><br>  Et souvenez-vous de <code>UITableViewDelegate</code> , il comprend √©galement des m√©thodes pour d√©terminer la hauteur des cellules.  Habituellement, <code>automaticDimension</code> suffit, mais parfois cela ne suffit pas et vous devez d√©finir la hauteur vous-m√™me (par exemple, dans le cas des animations ou des en-t√™tes) <br>  Ensuite, nous partageons g√©n√©ralement les param√®tres de cellule, la pi√®ce avec la configuration de hauteur est dans une autre m√©thode. <br><br>  Les probl√®mes: <br><br><ul><li>  La connexion explicite entre le traitement des donn√©es et son affichage sur l'interface utilisateur est perdue; </li><li>  La configuration des cellules se divise en diff√©rentes parties. </li></ul><br><h3>  Id√©e </h3><br>  Les probl√®mes r√©pertori√©s sur des √©crans complexes provoquent des maux de t√™te et une forte envie d'aller prendre le th√©. <br><br>  Premi√®rement, je ne veux pas impl√©menter constamment des m√©thodes de d√©l√©gu√©.  La solution √©vidente est de cr√©er un objet qui le mettra en ≈ìuvre.  Ensuite, nous ferons quelque chose comme: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> displayManager = <span class="hljs-type"><span class="hljs-type">DisplayManager</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.tableView)</code> </pre> <br>  Super.  Maintenant, vous avez besoin de l'objet pour pouvoir travailler avec toutes les cellules, tandis que la configuration de ces cellules doit √™tre d√©plac√©e ailleurs. <br><br>  Si nous mettons la configuration dans un objet s√©par√©, nous encapsulons (il est temps pour les mots intelligents) la configuration en un seul endroit.  Dans ce m√™me endroit, nous pouvons retirer la logique de formatage des donn√©es (par exemple, changer le format de la date, la concat√©nation des cha√Ænes, etc.).  Gr√¢ce au m√™me objet, nous pouvons nous abonner aux √©v√©nements de la cellule. <br><br>  Dans ce cas, nous aurons un objet qui a deux interfaces diff√©rentes: <br><br><ol><li>  L'interface de g√©n√©ration d'instance <code>UITableView</code> est destin√©e √† notre DisplayManager. </li><li>  Interface d'initialisation, d'abonnement et de configuration - pour Presenter ou ViewController. </li></ol><br>  Nous appelons cet objet un g√©n√©rateur.  Ensuite, notre g√©n√©rateur pour la table est une cellule, et pour tout le reste - un moyen de pr√©senter des donn√©es sur une interface utilisateur et de traiter des √©v√©nements. <br><br>  Et puisque la configuration est maintenant encapsul√©e par le g√©n√©rateur, et que le g√©n√©rateur lui-m√™me est une cellule, nous pouvons r√©soudre beaucoup de probl√®mes.  Y compris ceux √©num√©r√©s ci-dessus. <br><br><h3>  Impl√©mentation </h3><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableCellGenerator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identifier: <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>.<span class="hljs-type"><span class="hljs-type">Type</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cellHeight: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> estimatedCellHeight: <span class="hljs-type"><span class="hljs-type">CGFloat?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tableView: UITableView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewType</span></span>: <span class="hljs-type"><span class="hljs-type">UIView</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: ViewType)</span></span></span></span> }</code> </pre> <br>  Avec de telles impl√©mentations, nous pouvons effectuer l'impl√©mentation par d√©faut: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableCellGenerator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Self</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tableView: UITableView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.identifier.nameOfClass, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Self</span></span>.<span class="hljs-type"><span class="hljs-type">ViewType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.build(view: cell) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> ?? <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> { tableView.registerNib(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.identifier) } }&lt;source lang=<span class="hljs-string"><span class="hljs-string">"swift"</span></span>&gt;</code> </pre> <br>  Je vais donner un exemple de petit g√©n√©rateur: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FamilyCellGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cell: <span class="hljs-type"><span class="hljs-type">FamilyCell?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> family: <span class="hljs-type"><span class="hljs-type">Family?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> didTapPerson: ((<span class="hljs-type"><span class="hljs-type">Person</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(family: Family)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.family = family cell?.fill(with: family) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.family = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> cell?.showLoading() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FamilyCellGenerator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableCellGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identifier: <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>.<span class="hljs-type"><span class="hljs-type">Type</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">FamilyCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FamilyCellGenerator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: FamilyCell)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.cell = view view.selectionStyle = .<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> view.didTapPerson = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] person <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.didTapPerson?(person) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> family = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.family { view.fill(with: family) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { view.showLoading() } } }</code> </pre> <br>  Ici, nous avons cach√© √† la fois la configuration et les abonnements.  Notez que nous avons maintenant un endroit o√π nous pouvons encapsuler l'√©tat (car il est impossible d'encapsuler l'√©tat dans la cellule car il est r√©utilis√© par la table).  Et ils ont √©galement eu la possibilit√© de modifier les donn√©es dans la cellule "√† la vol√©e". <br><br>  Faites attention √† <code>self.cell = view</code> .  Nous nous sommes souvenus de la cellule et nous pouvons maintenant mettre √† jour les donn√©es sans recharger cette cellule.  Ceci est une fonctionnalit√© utile. <br><br>  Mais j'√©tais distrait.  Comme nous pouvons avoir n'importe quelle cellule repr√©sent√©e par un g√©n√©rateur, nous pouvons rendre l'interface de notre DisplayManager un peu plus belle. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataDisplayManager</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">CollectionType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">CellGeneratorType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">HeaderGeneratorType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(collection: <span class="hljs-type"><span class="hljs-type">CollectionType</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forceRefill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSectionHeaderGenerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generator: HeaderGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generator: CellGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generators: [CellGeneratorType], after: CellGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generator: CellGeneratorType, after: CellGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generators: [CellGeneratorType])</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(generators: [CellGeneratorType])</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearHeaderGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearCellGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> }</code> </pre> <br>  Ce n'est pas tout.  Nous pouvons ins√©rer des g√©n√©rateurs aux bons endroits ou les supprimer. <br><br>  Soit dit en passant, l'insertion d'une cellule apr√®s une cellule sp√©cifique peut √™tre sacr√©ment utile.  Surtout si nous chargeons progressivement les donn√©es (par exemple, l'utilisateur a entr√© le TIN, nous avons t√©l√©charg√© les informations TIN et les avons affich√©es en ajoutant plusieurs nouvelles cellules apr√®s le champ TIN). <br><br><h3>  R√©sum√© </h3><br>  √Ä quoi ressemblera le travail cellulaire: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: [Products])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gens = data.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> { <span class="hljs-type"><span class="hljs-type">ProductCellGenerator</span></span>($<span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerators(gens) } }</code> </pre><br>  Ou ici: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fields: [Field])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gens = fields.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> { field <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> field.type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .phone: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = <span class="hljs-type"><span class="hljs-type">PhoneCellGenerator</span></span>(item) gen.didUpdate = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePhone($<span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gen <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .date: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = <span class="hljs-type"><span class="hljs-type">DateInputCellGenerator</span></span>(item) gen.didTap = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.showPicker() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gen <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .dropdown: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = <span class="hljs-type"><span class="hljs-type">DropdownCellGenerator</span></span>(item) gen.didTap = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.showDropdown(item) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gen } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splitter = <span class="hljs-type"><span class="hljs-type">SplitterGenerator</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerator(splitter) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerators(gens) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerator(splitter) } }</code> </pre> <br>  Nous pouvons contr√¥ler l'ordre d'ajout d'√©l√©ments et, en m√™me temps, la connexion entre le traitement des donn√©es et leur ajout √† l'interface utilisateur n'est pas perdue.  Ainsi, dans des cas simples, nous avons un code simple.  Dans les cas difficiles, le code ne se transforme pas en p√¢tes et en m√™me temps semble passable.  Une interface d√©clarative pour travailler avec les tableaux est apparue et maintenant nous encapsulons la configuration des cellules, ce qui en soi nous permet de r√©utiliser les cellules avec les configurations entre les diff√©rents √©crans. <br><br>  Avantages de l'utilisation du RDDM: <br><br><ul><li>  Encapsulation de la configuration cellulaire; </li><li>  R√©duction de la duplication de code en encapsulant le travail des collections vers l'adaptateur; </li><li>  S√©lectionnez un objet adaptateur qui encapsule la logique sp√©cifique de l'utilisation des collections; </li><li>  Le code devient plus √©vident et plus facile √† lire; </li><li>  La quantit√© de code qui doit √™tre √©crite pour ajouter une table est r√©duite; </li><li>  Le processus de traitement des √©v√©nements √† partir des cellules est simplifi√©. </li></ul><br>  Sources <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Merci de votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466147/">https://habr.com/ru/post/fr466147/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466129/index.html">Efficacit√© du transport sur l'essence, les batteries et l'hydrog√®ne</a></li>
<li><a href="../fr466135/index.html">Megapack: comment les d√©veloppeurs de Factorio ont r√©ussi √† r√©soudre le probl√®me avec le mode multijoueur √† 200 joueurs</a></li>
<li><a href="../fr466137/index.html">Pipelines System.IO. - un outil peu connu des amateurs de hautes performances</a></li>
<li><a href="../fr466139/index.html">Technologie appliqu√©e sur les ruines de la fi√®vre de la blockchain ou les avantages pratiques de l'allocation des ressources</a></li>
<li><a href="../fr466143/index.html">Comment avons-nous fait du code en carton ou la version Scratch du jeu de plateau Golem Battle</a></li>
<li><a href="../fr466149/index.html">Cr√©ation d'un symbole de connecteur avec du texte ¬´dynamique¬ª dans OrCAD</a></li>
<li><a href="../fr466151/index.html">Enqu√™te: programmes √©tranges dans le registre des logiciels nationaux</a></li>
<li><a href="../fr466153/index.html">Cr√©ation d'un document de conception de mission de jeu narratif en utilisant l'exemple de Last of Us</a></li>
<li><a href="../fr466155/index.html">Architecture et fonctionnalit√©s de Tarantool Data Grid</a></li>
<li><a href="../fr466157/index.html">Blockchain: que devons-nous construire PoC?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>