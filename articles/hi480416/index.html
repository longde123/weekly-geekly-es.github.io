<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйтАНЁЯСжтАНЁЯСж ЁЯЩМЁЯП┐ ЁЯдЫЁЯП┐ C # рдореЗрдВ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЬреЗрдиреЗрд░рд┐рдХ рдЧрдгрд┐рдд ЁЯзФЁЯП╝ тШВя╕П ЁЯСЙЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд░реВрд╕реА рдореЗрдВ рд╢реБрд░реВ рд╣реБрдИ рдХреБрд░реВрдкрддрд╛ рдХреЗ рдирд╛рдо рдХрд╛ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рдЕрдиреБрд╡рд╛рдж рдХрд░рдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рдерд╛ред рдореБрдЭреЗ рдпрд╣ рдЬрд╛рдирдХрд░ рдЖрд╢реНрдЪрд░реНрдп рд╣реБрдЖ рдХрд┐ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ MSDN рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг "...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C # рдореЗрдВ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЬреЗрдиреЗрд░рд┐рдХ рдЧрдгрд┐рдд</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480416/"><p><img src="https://habrastorage.org/webt/mj/zg/yw/mjzgywquj0lud4_vs9bjh8xdacu.png"></p><br><p> рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд░реВрд╕реА рдореЗрдВ рд╢реБрд░реВ рд╣реБрдИ рдХреБрд░реВрдкрддрд╛ рдХреЗ рдирд╛рдо рдХрд╛ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рдЕрдиреБрд╡рд╛рдж рдХрд░рдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рдерд╛ред  рдореБрдЭреЗ рдпрд╣ рдЬрд╛рдирдХрд░ рдЖрд╢реНрдЪрд░реНрдп рд╣реБрдЖ рдХрд┐ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ <a href="https://docs.microsoft.com/ru-ru/dotnet/csharp/programming-guide/generics/" rel="nofollow">MSDN</a> рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг "рдЬреЗрдирд░рд┐рдХ" "рдЯреЗрдореНрдкрд▓реЗрдЯ" ( <code>C++</code> рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рд╕рдорд╛рди, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ) рдХрд╣рддрд╛ рд╣реИред  <a href="https://www.microsoftpressstore.com/store/clr-via-c-sharp-9780735667457" rel="nofollow"><code>C#</code> рдорд╛рдзреНрдпрдо</a> рд╕реЗ <a href="https://www.microsoftpressstore.com/store/clr-via-c-sharp-9780735667457" rel="nofollow"><code>"CLR</code></a> рдХреЗ рдЪреМрдереЗ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ <a href="https://www.microsoftpressstore.com/store/clr-via-c-sharp-9780735667457" rel="nofollow"><code>C#</code></a> рдЬрд┐рд╕рдиреЗ рдореБрдЭреЗ рдорд╛рд░рд╛ <a href="https://www.microsoftpressstore.com/store/clr-via-c-sharp-9780735667457" rel="nofollow">,</a> <a href="https://habr.com/en/company/piter/">рдкреАрдЯрд░</a> рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд╡рд╛рджрд┐рдд <a href="https://twitter.com/jeffrichter" rel="nofollow">рдЬреЗрдлрд░реА рд░рд┐рдХреНрдЯрд░</a> , рдЬреЗрдиреЗрд░рд┐рдХ рдХреЛ "рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг" рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЗ рд╕рд╛рд░ рдХреЛ рдмреЗрд╣рддрд░ рдврдВрдЧ рд╕реЗ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред  рдпрд╣ рд▓реЗрдЦ <em><code>C#</code> рдореЗрдВ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдЧрдгрд┐рддреАрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЗ</em> рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдЧрд╛ред  рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ <code>C#</code> рдЙрдЪреНрдЪ-рдкреНрд░рджрд░реНрд╢рди рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЕрднрд┐рдкреНрд░реЗрдд рдирд╣реАрдВ рд╣реИ (рд╣рд╛рд▓рд╛рдВрдХрд┐, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдпрд╣ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдорд╛рди <code>C/C++</code> рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ), <code>BCL</code> рдореЗрдВ рдЧрдгрд┐рддреАрдп рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рдирд╣реАрдВ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЖрдЗрдП <code>C#</code> рдФрд░ <code>CLR</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреБрдирд┐рдпрд╛рджреА рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред </p><a name="habracut"></a><br><h2 id="postanovka-zadachi">  рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдмрдпрд╛рди </h2><br><p>  <strong>рдбрд┐рд╕реНрдХреНрд▓реЗрдорд░</strong> : рд▓реЗрдЦ рдореЗрдВ рдХрдИ рдХреЛрдб рдЕрдВрд╢ рд╣реЛрдВрдЧреЗ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдореИрдВ <a href="https://twitter.com/ashmind" rel="nofollow">рдПрдВрдбреНрд░реА</a> <a href="https://github.com/ashmind/SharpLab" rel="nofollow">рд╢реЗрдХрд┐рди</a> рджреНрд╡рд╛рд░рд╛ рдЕрджреНрднреБрдд рд╕рдВрд╕рд╛рдзрди <a href="https://sharplab.io/" rel="nofollow">рд╢рд╛рд░реНрдкрд▓реИрдм</a> ( <a href="https://github.com/ashmind/SharpLab" rel="nofollow">Gi <s>r</s> tHub</a> ) рдХреЗ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде рдЪрд┐рддреНрд░рд┐рдд <a href="https://sharplab.io/" rel="nofollow">рдХрд░реВрдВрдЧрд╛</a> ред </p><br><p>  рдПрдХ рддрд░рд╣ рд╕реЗ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЧрдгрдирд╛ рдореЗрдВ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЧрдгрдирд╛ рдмреБрдирд┐рдпрд╛рджреА рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдмрд╛рд▓рддреА рд╣реИред  рдЬреЛрдбрд╝, рдШрдЯрд╛рд╡ (рд╡реНрдпреБрддреНрдХреНрд░рдо, рдЛрдгрд╛рддреНрдордХ), рдЧреБрдгрди рдФрд░ рд╡рд┐рднрд╛рдЬрди рдХреЛ рд╕рдорд╛рдирддрд╛ рдХреЗ рд▓рд┐рдП рддреБрд▓рдирд╛ рдФрд░ рдЬрд╛рдБрдЪ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рджреНрд╡рд╛рд░рд╛ рдкреВрд░рдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдмреЗрд╢рдХ, рдЗрди рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдФрд░ рдХрд┐рд╕реА рднреА рдореВрд▓ рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдкреНрд░рдХрд╛рд░ рдХреЗ <code>C#</code> рдЪрд░ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдПрдХрдорд╛рддреНрд░ рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ <code>C#</code> рдХреЛ рдЙрд╕ рд╕рдВрдХрд▓рди рд╕рдордп рдкрд░ <em>рдкрддрд╛</em> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╕рдВрдЪрд╛рд▓рди рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рдХрд╛рд░реЛрдВ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рд╡рд┐рдзрд┐ рд▓рд┐рдЦрдирд╛ рдЬреЛ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдХреБрд╢рд▓рддрд╛рдкреВрд░реНрд╡рдХ (рдФрд░ рдкрд╛рд░рджрд░реНрд╢реА рд░реВрдк рд╕реЗ) рджреЛ рдкреВрд░реНрдгрд╛рдВрдХ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рджреЛ рдлрд╝реНрд▓реЛрдЯрд┐рдВрдЧ-рдкреЙрдЗрдВрдЯ рдирдВрдмрд░ рдЕрд╕рдВрднрд╡ рд╣реИред </p><br><p>  рдЖрдЗрдП рдХреБрдЫ рд╕рд╛рдзрд╛рд░рдг рдЧрдгрд┐рддреАрдп рдХреНрд░рд┐рдпрд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рдХрд╛рд▓реНрдкрдирд┐рдХ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реА рдЗрдЪреНрдЫрд╛рдУрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ: </p><br><ol><li>  рдПрдХ рд╡рд┐рдзрд┐ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреНрд░рддрд┐рдмрдВрдз рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП рдЬреЛ рд╣рдореЗрдВ рджреЛ рдордирдорд╛рдиреЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ (рдпрд╛ рдЧреБрдгрд╛, рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ) рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рд╕реЗ рдмрдЪрд╛рддреЗ рд╣реИрдВред  рд╣рдореЗрдВ рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреА рдмрд╛рдзрд╛рдУрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </li><li>  рдкреНрд░рдпреЛрдЧ рдХреА рд╢реБрджреНрдзрддрд╛ рдХреЗ рд▓рд┐рдП, рд╕реНрд╡реАрдХреГрдд рдФрд░ рд▓реМрдЯреЗ рдкреНрд░рдХрд╛рд░ рд╕рдорд╛рди рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдмрд╛рдЗрдирд░реА рдСрдкрд░реЗрдЯрд░ рдХреЗ рдкрд╛рд╕ рдлреЙрд░реНрдо <code>(T, T) =&gt; T</code> рдХрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП <code>(T, T) =&gt; T</code> </li><li>  рд╡рд┐рдзрд┐ рдХрдо рд╕реЗ рдХрдо рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд░реНрд╡рд╡реНрдпрд╛рдкреА рдореБрдХреНрдХреЗрдмрд╛рдЬреА рдЕрд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИред </li></ol><br><h2 id="a-chto-tam-u-sosedey">  рдФрд░ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛? </h2><br><p>  рдЖрдЗрдП <code>F#</code> ред  рдореИрдВ <code>F#</code> рдореЗрдВ рдордЬрдмреВрдд рдирд╣реАрдВ рд╣реВрдВ, рд▓реЗрдХрд┐рди рдЬреНрдпрд╛рджрд╛рддрд░ <code>C#</code> рдкреНрд░рддрд┐рдмрдВрдз <code>CLR</code> рд╕реАрдорд╛рдУрдВ рд╕реЗ рддрдп рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ <code>F#</code> рд╕рдорд╛рди рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдЧреНрд░рд╕реНрдд рд╣реИред  рдЖрдк рдПрдХ рд╕реНрдкрд╖реНрдЯ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдЬреЛрдбрд╝ рд╡рд┐рдзрд┐ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдЬреЛрдбрд╝ рд╡рд┐рдзрд┐ рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ <code>F#</code> рдкреНрд░рдХрд╛рд░ рдХреА рдЕрдиреБрдорд╛рди рдкреНрд░рдгрд╛рд▓реА рдХреНрдпрд╛ рдХрд╣рддреА рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_gen</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'a) (y : '</span></span></span></span><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">)</span></span> = x + y <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> xy = x + y add_gen <span class="hljs-number"><span class="hljs-number">5.0</span></span> <span class="hljs-number"><span class="hljs-number">6.0</span></span> |&gt; ignore <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">5.0</span></span> <span class="hljs-number"><span class="hljs-number">6.0</span></span> |&gt; ignore</code> </pre> <br><p>  <a href="https://sharplab.io/" rel="nofollow">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ,</a> рджреЛрдиреЛрдВ рд╡рд┐рдзрд┐рдпрд╛рдБ рдЧреИрд░-рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╣реЛ рдЬрд╛рдПрдВрдЧреА, рдФрд░ рдЙрддреНрдкрдиреНрди рдХреЛрдб рд╕рдорд╛рди рд╣реЛрдЧрд╛ред  <code>F#</code> рдкреНрд░рдХрд╛рд░ рдкреНрд░рдгрд╛рд▓реА рдХреА рдХрдареЛрд░рддрд╛ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдЬрд╣рд╛рдВ рдлрд╛рд░реНрдо рдХреЗ рдХреЛрдИ рдирд┐рд╣рд┐рдд рд░реВрдкрд╛рдВрддрд░рдг рдирд╣реАрдВ рд╣реИрдВ <code>int -&gt; double</code> , рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдХреЗ рдмрд╛рдж <code>double</code> рдкреНрд░рдХрд╛рд░ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде ( <code>C#</code> рд╢рд░реНрддреЛрдВ рдореЗрдВ), рдЕрдиреНрдп рддрд░реАрдХреЛрдВ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рд╡рд┐рдзрд┐рдпреЛрдВ (рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЯрд╛рдЗрдк рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рдХрд╛рд░рдг рд╕рдЯреАрдХрддрд╛ рдХреА рд╕рдВрднрд╛рд╡рд┐рдд рд╣рд╛рдирд┐ рдХреЗ рд╕рд╛рде) рдЕрдзрд┐рдХ рдЕрд╕рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдк <code>+</code> рдСрдкрд░реЗрдЯрд░ рдХреЛ рд╕рдорд╛рдирддрд╛ рдСрдкрд░реЗрдЯрд░ <code>=</code> рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ <a href="https://sharplab.io/" rel="nofollow">рдЪрд┐рддреНрд░ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ</a> : рджреЛрдиреЛрдВ рд╡рд┐рдзрд┐рдпрд╛рдБ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд ( <code>C#</code> рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ) рдореЗрдВ рдмрджрд▓ рдЬрд╛рддреА рд╣реИрдВ, рдФрд░ <code>F#</code> рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕рд╣рд╛рдпрдХ рд╡рд┐рдзрд┐, рдХреЛ рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eq_gen</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'a) (y : '</span></span></span></span><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">)</span></span> = x = y <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> eq xy = x = y eq_gen <span class="hljs-number"><span class="hljs-number">5.0</span></span> <span class="hljs-number"><span class="hljs-number">6.0</span></span> |&gt; ignore eq_gen <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> |&gt; ignore eq <span class="hljs-number"><span class="hljs-number">5.0</span></span> <span class="hljs-number"><span class="hljs-number">6.0</span></span> |&gt; ignore eq <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> |&gt; ignore</code> </pre> <br><h3 id="chto-naschet-java">  <code>Java</code> рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛? </h3><br><p>  рдореЗрд░реЗ рд▓рд┐рдП <code>Java</code> рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдирд╛ рдХрдард┐рди рд╣реИ, рд▓реЗрдХрд┐рди рдЬрд╣рд╛рдБ рддрдХ рдореИрдВ рдмрддрд╛ рд╕рдХрддрд╛ рд╣реВрдБ, рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреНрд░рдХрд╛рд░ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рдореЗрдВ <a href="https://en.wikipedia.org/wiki/Comparison_of_C_Sharp_and_Java" rel="nofollow">рдирд╣реАрдВ</a> рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрднреА рднреА <em>рдЖрджрд┐рдо</em> рдкреНрд░рдХрд╛рд░ рд╣реИрдВред  <code>Java</code> рдореЗрдВ рдкреНрд░рд┐рдорд┐рдЯрд┐рд╡ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <a href="https://en.wikipedia.org/wiki/Comparison_of_C_Sharp_and_Java" rel="nofollow">рд░реИрдкрд░ рд╣реИрдВ</a> (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреНрд░рд┐рдорд┐рдЯрд┐рд╡ рдмрд╛рдп-рд╡реИрд▓реНрдпреВ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html" rel="nofollow"><code>Long</code></a> рд▓рд┐рдП рдПрдХ рд╕рдВрджрд░реНрдн <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html" rel="nofollow"><code>Long</code></a> ), рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдмреЗрд╕ рдХреНрд▓рд╛рд╕ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Number.html" rel="nofollow"><code>Number</code></a> ред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЖрдк <code>Number</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рд╕рдВрджрд░реНрдн рдкреНрд░рдХрд╛рд░ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдкрд░ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкреНрд░рднрд╛рд╡ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИред </p><br><p>  <em>рдЕрдЧрд░ рдореИрдВ рдЧрд▓рдд рд╣реВрдВ рддреЛ рдореБрдЭреЗ рд╕реБрдзрд╛рд░реЛред</em> </p><br><h3 id="c">  <code>C++</code> ? </h3><br><p>  <code>C++</code> рдЪреЗрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рднрд╛рд╖рд╛ рд╣реИред <br>  <code>C++</code> рдЙрди рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдорд╛рд░реНрдЧ рдкреНрд░рд╢рд╕реНрдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХреБрдЫ рдорд╛рдирддреЗ рд╣реИрдВ ... <a href="https://ru.wikiquote.org/wiki/%25D0%2597%25D0%25B2%25D1%2591%25D0%25B7%25D0%25B4%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B2%25D0%25BE%25D0%25B9%25D0%25BD%25D1%258B._%25D0%25AD%25D0%25BF%25D0%25B8%25D0%25B7%25D0%25BE%25D0%25B4_III:_%25D0%259C%25D0%25B5%25D1%2581%25D1%2582%25D1%258C_%25D1%2581%25D0%25B8%25D1%2582%25D1%2585%25D0%25BE%25D0%25B2" rel="nofollow">рдЕрдкреНрд░рд╛рдХреГрддрд┐рдХ</a> ред <br>  рд╕рд╛рдорд╛рдиреНрдп рдЬреНрдЮрд╛рди (рдЬреЗрдирд░рд┐рдХ) рдХреЗ рд╡рд┐рдкрд░реАрдд рдЯреЗрдореНрдкреНрд▓реЗрдЯ (рдЙрд░реНрдл рдЯреЗрдореНрдкреНрд▓реЗрдЯ), рд╢рд╛рдмреНрджрд┐рдХ рдЕрд░реНрдереЛрдВ рдореЗрдВ, <em>рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╣реИрдВ</em> ред  рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рддреЗ рд╕рдордп, рдЖрдк рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрди рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдпрд╣ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЙрдкрд▓рдмреНрдз рд╣реИред  рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ, <code>C++</code> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрди рдХреЛрдб рдорд╛рдиреНрдп рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; template&lt;typename T, std::enable_if_t&lt;std::is_arithmetic&lt;T&gt;::value&gt;* = nullptr&gt; T Add (T left, T right) { return left + right; } int main() { std::cout &lt;&lt; Add(5, 6) &lt;&lt; std::endl; std::cout &lt;&lt; Add(5.0, 6.0) &lt;&lt; std::endl; // std::cout &lt;&lt; Add("a", "b") &lt;&lt; std::endl; Does not compile }</span></span></span></span></code> </pre> <br><p>  <code>is_arithmetic</code> , рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, <code>char</code> рдФрд░ <code>bool</code> рджреЛрдиреЛрдВ рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рджреВрд╕рд░реА рдУрд░, <code>C#</code> рд╢рдмреНрджрд╛рд╡рд▓реА рдореЗрдВ <code>char</code> рдмрд░рд╛рдмрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкреВрд░реНрдгрд╛рдВрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЖрдХрд╛рд░ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо / рдХрдВрдкрд╛рдЗрд▓рд░ / рдореВрди рдЪрд░рдг рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВред </p><br><h3 id="yazyki-s-dinamicheskoy-tipizaciey">  рдЧрддрд┐рд╢реАрд▓ рдЯрд╛рдЗрдкрд┐рдВрдЧ рднрд╛рд╖рд╛рдПрдБ </h3><br><p>  рдЕрдВрдд рдореЗрдВ, рдЧрдгрдирд╛ рджреНрд╡рд╛рд░рд╛ рдзрд╛рд░рд┐рдд, рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЯрд╛рдЗрдк рдХреА рдЧрдИ (рдФрд░ <em>рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЧрдИ</em> ) рднрд╛рд╖рд╛рдУрдВ рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред  рдРрд╕реА рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ, рдЖрдорддреМрд░ рдкрд░ рдЧрдгрдирд╛ рдХреЗ рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг рд╕реЗ рд╕рдорд╕реНрдпрд╛рдПрдВ рдкреИрджрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ: рдпрджрд┐ рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рдкреНрд░рдХрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ, рд╕рд╢рд░реНрдд рд░реВрдк рд╕реЗ, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рддреЛ рдСрдкрд░реЗрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЕрдиреНрдпрдерд╛ рдпрд╣ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  <code>Python</code> (3.7.3 x64): </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y type(add(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># &lt;class 'int'&gt; type(add(5.0, 6.0)) # &lt;class 'float'&gt; type(add('a', 'b') # &lt;class 'str'&gt;</span></span></code> </pre> <br><p>  <code>R</code> (3.6.1 x64) </p><br><pre> <code class="cpp hljs">add &lt;- function(x, y) x + y # <span class="hljs-function"><span class="hljs-function">Or </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeof</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> vctrs::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec_ptype_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(add(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span><span class="hljs-function"> # Prototype: </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> vctrs::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec_ptype_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(add(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5L</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6L</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span><span class="hljs-function"> # Prototype: integer vctrs::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec_ptype_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(add(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"5"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"6"</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span><span class="hljs-function"> # Error in x + y : non-numeric argument to binary </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">operator</span></span></span></span></code> </pre> <br><h2 id="obratno-v-mir-c-ogranichivaem-obobschennyy-tip-matematicheskoy-funkcii">  рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, C # рджреБрдирд┐рдпрд╛ рдореЗрдВ: рд╣рдо рдЧрдгрд┐рддреАрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдкреНрд░рдХрд╛рд░ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ </h2><br><p>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд╣рдо рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред  <code>C#</code> рдЖрджрд┐рдо рдкреНрд░рдХрд╛рд░ рдХреЗ рдореВрд▓реНрдп рдкреНрд░рдХрд╛рд░ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреНред  рд╕рдВрд░рдЪрдирд╛рдПрдБ, рдЬреЛ рдХрд┐ <code>System.Object</code> (рдФрд░ <a href="https://docs.microsoft.com/en-us/dotnet/api/system.valuetype%3Fview%3Dnetcore-3.0" rel="nofollow"><code>System.ValueType</code></a> ) рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реА рд╣реИрдВ, рдЙрдирдореЗрдВ рдмрд╣реБрдд рдХреБрдЫ рдирд╣реАрдВ рд╣реИред  рдПрдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдФрд░ рддрд╛рд░реНрдХрд┐рдХ рд╕реАрдорд╛ рд╣реИ <code>where T : struct</code> ред  <code>C# 7.3</code> рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ <code>C# 7.3</code> рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <code>where T : unmanaged</code> рдмрд╛рдзрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ <code>T</code> рдПрдХ <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/unmanaged-types" rel="nofollow"><code> ,        null</code></a> ред  рдЖрджрд┐рдо рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд┐рдирдХреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, <code>char</code> , <code>bool</code> , <code>decimal</code> , <em>рдХреЛрдИ рднреА</em> <code>Enum</code> рдФрд░ <em>рдХреЛрдИ рднреА</em> рд╕рдВрд░рдЪрдирд╛ рдЬрд┐рдирдХреЗ рд╕рднреА рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдПрдХ рд╣реА <code>unmanaged</code> рдкреНрд░рдХрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рдЗрди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╛рдиреА  <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/unmanaged-types" rel="nofollow">рдпрд╣ рдкреНрд░рдХрд╛рд░</a> рдкрд░реАрдХреНрд╖рд╛ рдкрд╛рд╕ рдХрд░реЗрдЧрд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Coords&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : unmanaged { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TY; }</code> </pre> <br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХреЗрд╡рд▓ рд╡рд╛рдВрдЫрд┐рдд рдЕрдВрдХрдЧрдгрд┐рдд рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рд▓реЗрдЦ рдХреЗ рд╢реАрд░реНрд╖рдХ рдореЗрдВ <code>Unsafe</code> - рд╣рдореЗрдВ рдЕрдкрдиреЗ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдПрдХ рдХрд╛рд▓реНрдкрдирд┐рдХ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ <code>T Add&lt;T&gt;(T left, T right) where T : unmanaged</code> рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдкрд░рд┐рдгрд╛рдо рдХрд╛ рдиреЗрддреГрддреНрд╡ рдХрд░реЗрдЧрд╛ рдпрджрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрд╕рдВрдЧрдд рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред </p><br><h2 id="eksperiment-pervyy-naivnyy-dynamic">  рдкрд╣рд▓рд╛ рдкреНрд░рдпреЛрдЧ, рднреЛрд▓рд╛: <code>dynamic</code> </h2><br><p>  <code>dynamic</code> рдкрд╣рд▓рд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╣рдорд╛рд░реА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рд╣рдорд╛рд░реА рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдмреЗрд╢рдХ, рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП <code>dynamic</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмрд┐рд▓реНрдХреБрд▓ рдмреЗрдХрд╛рд░ рд╣реИ - <code>dynamic</code> <code>object</code> рдмрд░рд╛рдмрд░ рд╣реИ, рдФрд░ <code>dynamic</code> рдЪрд░ рд╡рд╛рд▓реЗ рддрд░реАрдХреЛрдВ рдХреЛ рд╕рдВрдХрд▓рдХ рджреНрд╡рд╛рд░рд╛ рдПрдХ рд░рд╛рдХреНрд╖рд╕реА рдкреНрд░рддрд┐рдмрд┐рдВрдм рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдПрдХ рдмреЛрдирд╕ рдХреЗ рд░реВрдк рдореЗрдВ - рд╣рдорд╛рд░реЗ рдмрд╛рдп-рд╡реИрд▓реНрдпреВ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреА рдкреИрдХрд┐рдВрдЧ / рдЕрдирдкреИрдХрд┐рдВрдЧред  рдпрд╣рд╛рдБ <a href="https://sharplab.io/" rel="nofollow">рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ</a> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Class</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = Add(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = Add(<span class="hljs-number"><span class="hljs-number">5.0</span></span>, <span class="hljs-number"><span class="hljs-number">6.0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">dynamic</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">dynamic</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">dynamic</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right</span></span></span><span class="hljs-function">)</span></span> =&gt; left + right; }</code> </pre> <br><p>  рдмрд╕ <code>Method</code> рд╡рд┐рдзрд┐ рдХреЗ <code>IL</code> : </p><br><pre> <code class="cs hljs">.<span class="hljs-function"><span class="hljs-function">method </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> hidebysig </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) cil managed</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Method begins at RVA 0x2050 // Code size 53 (0x35) .maxstack 8 IL_0000: ldc.i4.5 IL_0001: box [System.Private.CoreLib]System.Int32 IL_0006: ldc.i4.6 IL_0007: box [System.Private.CoreLib]System.Int32 IL_000c: call object Class::Add(object, object) IL_0011: pop IL_0012: ldc.r8 5 IL_001b: box [System.Private.CoreLib]System.Double IL_0020: ldc.r8 6 IL_0029: box [System.Private.CoreLib]System.Double IL_002e: call object Class::Add(object, object) IL_0033: pop IL_0034: ret } // end of method Class::Method</span></span></code> </pre> <br><p>  рднрд░реА рд╣реБрдИ <code>5</code> , рднрд░реА рд╣реБрдИ, рднрд░реА рд╣реБрдИ <code>6</code> , рднрд░реА рд╣реБрдИ, рдЬрд┐рд╕реЗ <code>object Add(object, object)</code> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред <br>  рд╡рд┐рдХрд▓реНрдк рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╣рдореЗрдВ рд╢реЛрднрд╛ рдирд╣реАрдВ рджреЗрддрд╛ред </p><br><h2 id="eksperiment-vtoroy-v-lob">  рджреВрд╕рд░рд╛ рдкреНрд░рдпреЛрдЧ, "рдорд╛рдереЗ рдореЗрдВ" </h2><br><p>  рд╡реИрд╕реЗ, <code>dynamic</code> рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░рд┐рдорд┐рдд рд╣реИ, рдФрд░ рд╡реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдиреЗ рдЬрд╛рддреЗ рд╣реИрдВред  рдЪрд▓реЛ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдПрдХ рд╢рд╛рдЦрд╛ <s>рдореБрдХреБрдЯ рдХреЗ</s> рд╕рд╛рде рдмрд╛рдВрдзрд╛ рдФрд░ рдЗрд╕реЗ рд▓рд┐рдЦреЗрдВ: рдпрджрд┐ <em>рд╣рдорд╛рд░рд╛</em> рдкреНрд░рдХрд╛рд░ <em>рд╣реИ</em> , рддреЛ рдХреБрдЫ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ, рдЕрдиреНрдпрдерд╛ - рдпрд╣рд╛рдВ рдЕрдкрд╡рд╛рдж рд╣реИред </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T Add&lt;T&gt;(T left, T right) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : unmanaged { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i32Left &amp;&amp; right <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i32Right) { <span class="hljs-comment"><span class="hljs-comment">// ??? } // ... throw new NotSupportedException(); }</span></span></code> </pre> <br><p>  III, рдпрд╣рд╛рдБ рд╣рдо рдПрдХ рд╕рдорд╕реНрдпрд╛ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдк рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрднреА рднреА рдЙрди рдкрд░ рднреА рдСрдкрд░реЗрд╢рди рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдкрд░рд┐рдгрд╛рдореА рд╕рд╢рд░реНрдд <code>int</code> рдХреЛ рдПрдХ рдЕрдЬреНрдЮрд╛рдд рдкреНрд░рдХрд╛рд░ <code>T</code> рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдмрд╣реБрдд рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИред  <code>return (T)(i32Left + i32Right)</code> рд╕рдВрдХрд▓рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ - рдХреЛрдИ рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рд╣реИ рдХрд┐ <code>T</code> <code>int</code> (рднрд▓реЗ рд╣реА рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рд╣реИ)ред  рдЖрдк рдбрдмрд▓ рд░реВрдкрд╛рдВрддрд░рдг <code>return (T)(object)(i32Left + i32Right)</code> ред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд░рд╛рд╢рд┐ рдкреИрдХ рдХреА рдЬрд╛рддреА рд╣реИ, рдлрд┐рд░ рдЗрд╕реЗ <code>T</code> рдореЗрдВ рдЕрдирдкреИрдХ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ <code>T</code>  рдпрд╣ <strong>рддрднреА</strong> рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдЬрдм рдкреНрд░рдХрд╛рд░ рдкреИрдХреЗрдЬрд┐рдВрдЧ рд╕реЗ рдкрд╣рд▓реЗ рдФрд░ рдкреИрдХреЗрдЬрд┐рдВрдЧ рдХреЗ рдмрд╛рдж <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/types/boxing-and-unboxing" rel="nofollow">рдореЗрд▓ рдЦрд╛рддреЗ рд╣реЛрдВ</a> ред  рдЖрдк <code>int</code> рдкреИрдХ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ <code>double</code> рдореЗрдВ рдЕрдирдкреИрдХ рдХрд░реЗрдВ, рднрд▓реЗ рд╣реА рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд░реВрдкрд╛рдВрддрд░рдг <code>int -&gt; double</code> ред  <a href="https://sharplab.io/" rel="nofollow">рдЗрд╕</a> рдХреЛрдб рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ <a href="https://sharplab.io/" rel="nofollow">рдпрд╣</a> рд╣реИ рдХрд┐ рд╡рд┐рд╢рд╛рд▓ рд╢рд╛рдЦрд╛рдПрдВ рдФрд░ рдЕрдирдкреИрдХрд┐рдВрдЧ рдкреИрдХреЗрдЬреЛрдВ рдХреА рдмрд╣реБрддрд╛рдпрдд, рднрд▓реЗ <code>if</code> рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рд╣реЛред  рдпрд╣ рд╡рд┐рдХрд▓реНрдк рднреА рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИред </p><br><h2 id="refleksiya-i-metadannye">  рдкрд░рд╛рд╡рд░реНрддрди рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ </h2><br><p>  рдЦреИрд░, рдЦреЗрд▓рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣реА рдХрд╛рдлреА рд╣реИред  рд╣рд░ рдХреЛрдИ рдЬрд╛рдирддрд╛ рд╣реИ рдХрд┐ <code>C#</code> рдореЗрдВ рдСрдкрд░реЗрдЯрд░ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╡рд╣рд╛рдВ, <code>+</code> , <code>-</code> , <code>==</code> <code>!=</code> рдФрд░ рдЗрддрдиреЗ рдкрд░ рд╣реИрдВред  рд╣рдореЗрдВ рдмрд╕ рдЗрддрдирд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдСрдкрд░реЗрдЯрд░ рдХреЗ рдЕрдиреБрд░реВрдк рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА <code>T</code> рд╕реНрдЯреЗрдЯрд┐рдХ рд╡рд┐рдзрд┐ рдирд┐рдХрд╛рд▓рдиреА рдЪрд╛рд╣рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкрд░рд┐рд╡рд░реНрдзрди - рдмрд╕ рдЗрддрдирд╛ рд╣реАред  рдареАрдХ рд╣реИ, рд╣рд╛рдБ, рдлрд┐рд░ рд╕реЗ рдПрдХ рджреЛ рдкреИрдХреЗрдЬ, рд▓реЗрдХрд┐рди рдХреЛрдИ рд╢рд╛рдЦрд╛ рдФрд░ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВред  рдкреВрд░реА рдЪреАрдЬ рдХреЛ рдЯрд╛рдЗрдк <code>T</code> рджреНрд╡рд╛рд░рд╛ рдХреИрд╢ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЖрдо рддреМрд░ рдкрд░ рд╣рд░ рддрд░рд╣ рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЧрддрд┐ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдПрдХрд▓ рдкреНрд░рддрд┐рдмрд┐рдВрдм рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧрдгрд┐рддреАрдп рдСрдкрд░реЗрд╢рди рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИред  рдЦреИрд░, рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T Add&lt;T&gt;(T left, T right) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : unmanaged { <span class="hljs-comment"><span class="hljs-comment">// Simple example without cache. var method = typeof(T) .GetMethod(@"op_Addition", new [] {typeof(T), typeof(T)}) ?.CreateDelegate(typeof(Func&lt;T, T, T&gt;)) as Func&lt;T, T, T&gt;; return method?.Invoke(left, right) ?? throw new InvalidOperationException(); }</span></span></code> </pre> <br><p>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ рдпрд╣ <a href="https://jonskeet.uk/csharp/genericoperators.html" rel="nofollow">рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ</a> ред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдкреНрд░рдХрд╛рд░ (рд▓реЗрдХрд┐рди <code>decimal</code> рдирд╣реАрдВ) <em>рдореЗрдВ</em> рдРрд╕реА рдХреЛрдИ рд╕реНрдерд┐рд░ рд╡рд┐рдзрд┐ рдирд╣реАрдВ рд╣реИред  рд╕рднреА рдСрдкрд░реЗрд╢рди <code>IL</code> рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ <a href="" rel="nofollow"><code>add</code></a> ред  рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рддрд┐рдмрд┐рдВрдм рд╣рдорд╛рд░реА рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </p><br><h2 id="systemlinqexpressions">  System.Linq.Expressions </h2><br><p>  <code>Expressions</code> рдЖрдзрд╛рд░рд┐рдд рд╕рдорд╛рдзрд╛рди <a href="https://twitter.com/jonskeet" rel="nofollow">рдЬреЙрди рд╕реНрдХреАрдЯ</a> рдХреЗ рдмреНрд▓реЙрдЧ рдкрд░ <a href="https://jonskeet.uk/csharp/genericoperators.html" rel="nofollow">рдпрд╣рд╛рдВ</a> (рдорд╛рд░реНрдХ рдЧреНрд░реЗрд╡реЗрд▓ рджреНрд╡рд╛рд░рд╛) рд╡рд░реНрдгрд┐рдд рд╣реИред <br>  рд╡рд┐рдЪрд╛рд░ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЯрд╛рдЗрдк <code>T</code> рдЬреЛ рдСрдкрд░реЗрд╢рди <code>+</code> рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред  рдЖрдЗрдП рдЗрд╕ рддрд░рд╣ рд╕реЗ рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдмрдирд╛рдПрдВ: </p><br><pre> <code class="cs hljs">(x, y) =&gt; x + y;</code> </pre> <br><p>  рдЙрд╕рдХреЗ рдмрд╛рдж, рдХреИрд╢ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдРрд╕реА рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред  рд╣рдореЗрдВ рджреЛ рдорд╛рдкрджрдВрдбреЛрдВ рдФрд░ рдПрдХ рдСрдкрд░реЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рддреЛ рдЪрд▓рд┐рдП рд▓рд┐рдЦрддреЗ рд╣реИрдВред </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;(Type Type, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Op), Delegate&gt; Cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;(Type Type, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Op), Delegate&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T Add&lt;T&gt;(T left, T right) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : unmanaged { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T); <span class="hljs-comment"><span class="hljs-comment">// If op is cached by type and function name, use cached version if (Cache.TryGetValue((t, nameof(Add)), out var del)) return del is Func&lt;T, T, T&gt; specificFunc ? specificFunc(left, right) : throw new InvalidOperationException(nameof(Add)); var leftPar = Expression.Parameter(t, nameof(left)); var rightPar = Expression.Parameter(t, nameof(right)); var body = Expression.Add(leftPar, rightPar); var func = Expression.Lambda&lt;Func&lt;T, T, T&gt;&gt;(body, leftPar, rightPar).Compile(); Cache[(t, nameof(Add))] = func; return func(left, right); }</span></span></code> </pre> <br><p>  рд╣рдм рдкрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝реЛрдВ рдФрд░ рдкреНрд░рддрд┐рдирд┐рдзрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рдХрд╛рд╢рд┐рдд рдХреА рдЧрдИ рдереА </p><br><p>  рддрдХрдиреАрдХреА рд░реВрдк рд╕реЗ, рднрд╛рд╡ рд╣рдореЗрдВ рдЕрдкрдиреА рд╕рднреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ - рдХрд┐рд╕реА рднреА рд╕рд╛рдорд╛рдиреНрдп рдСрдкрд░реЗрд╢рди рдХреЛ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡рд┐рдзрд┐ рдХрд╣рдХрд░ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рднреА рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдСрдкрд░реЗрд╢рди рдХреЛ рдЙрд╕реА рддрд░рд╣ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ <em>рд▓рдЧрднрдЧ</em> рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред </p><br><h2 id="narushaem-vse-pravila">  рд╣рдо рд╕рд╛рд░реЗ рдирд┐рдпрдо рддреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ </h2><br><p>  рдХреНрдпрд╛ <code>CLR/C#</code> рдХреА рд╢рдХреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рдФрд░ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ?  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ <a href="https://sharplab.io/" rel="nofollow">рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП</a> рдХреЛрдб рдХрд┐рд╕ рд╡рд┐рдзрд┐ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Class</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> =&gt; x + y; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> =&gt; x + y; <span class="hljs-comment"><span class="hljs-comment">// Decimal only to show difference public static decimal Add(decimal x, decimal y) =&gt; x + y; }</span></span></code> </pre> <br><p>  рд╕рдВрдмрдВрдзрд┐рдд <code>IL</code> рдХреЛрдб рдореЗрдВ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдПрдХ рд╣реА рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs">ldarg<span class="hljs-number"><span class="hljs-number">.0</span></span> ldarg<span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ret</code> </pre> <br><p>  рдпрд╣ рдмрд╣реБрдд рд╣реА <a href="" rel="nofollow"><code>add</code></a> рдСрдк рдХреЛрдб рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрдВрдХрдЧрдгрд┐рдд рдЖрджрд┐рдо рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рд╕реНрдерд╛рди рдкрд░ <code>decimal</code> рдХреЛ <code>static decimal decimal.op_Addition(decimal, decimal)</code> рдХрд╣рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рд╣рдо рдПрдХ рдРрд╕реА рд╡рд┐рдзрд┐ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╣реЛрдЧреА, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ <code>IL</code> рдХреЛрдб рд╣реЛрдЧрд╛?  рдЦреИрд░, рдЬреЙрди рд╕реНрдХреАрдЯ рдиреЗ рдЪреЗрддрд╛рд╡рдиреА рджреА рд╣реИ рдХрд┐ рдпрд╣ <a href="https://jonskeet.uk/csharp/genericoperators.html" rel="nofollow">рдЗрд╕рдХреЗ рд▓рд╛рдпрдХ рдирд╣реАрдВ рд╣реИ</a> ред  рдЕрдкрдиреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд╣ рд╕рднреА рдкреНрд░рдХрд╛рд░реЛрдВ ( <code>decimal</code> рд╕рд╣рд┐рдд), рд╕рд╛рде рд╣реА рд╕рд╛рде рдЙрдирдХреЗ <code>nullable</code> рдПрдирд╛рд▓реЙрдЧреНрд╕ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдХрд╛рдлреА nontrivial <code>IL</code> рд╕рдВрдЪрд╛рд▓рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдФрд░ рдЬрд░реВрд░реА рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд▓рд┐рдП рдиреЗрддреГрддреНрд╡ рдХрд░реЗрдВрдЧреЗред  рд▓реЗрдХрд┐рди рд╣рдо рдЕрднреА рднреА рдмреБрдирд┐рдпрд╛рджреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдореЗрд░реЗ рдЖрд╢реНрдЪрд░реНрдп рдХреЗ рд▓рд┐рдП, <code>Visual Studio</code> <code>IL</code> рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдФрд░ <code>IL</code> рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдирд╣реАрдВ рд╣реИрдВред  рдЖрдк рдХреЗрд╡рд▓ <code>IL</code> рдореЗрдВ рдХреЛрдб рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕рдХрд╛ рд╡рд░реНрдгрди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреА рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╣рдорд╛рд░реА рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП рдЖрддрд╛ рд╣реИред  <a href="https://github.com/ins0mniaque/ILSupport" rel="nofollow"><code>ILSupport</code></a> рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ <code>IL</code> рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╣реИрдВ, рд╕рд╛рде рд╣реА рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реИ рдЬреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ <code>IL</code> рдХреЛрдб рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>*.csproj</code> рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдмреЗрд╢рдХ, <code>IL</code> рдореЗрдВ рд╕рдм рдХреБрдЫ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдирд╛ рдХрд╛рдлреА рдореБрд╢реНрдХрд┐рд▓ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓реЗрдЦрдХ <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.methodimploptions%3Fredirectedfrom%3DMSDN%26view%3Dnetcore-3.0" rel="nofollow"><code>ForwardRef</code></a> рдлреНрд▓реИрдЧ рдХреЗ рд╕рд╛рде рдмрд┐рд▓реНрдЯ-рдЗрди <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.methodimplattribute%3Fview%3Dnetcore-3.0" rel="nofollow"><code>MethodImpl</code></a> рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рд╡рд┐рд╢реЗрд╖рддрд╛ рдЖрдкрдХреЛ рд╡рд┐рдзрд┐ рдХреЛ <code>extern</code> рдШреЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдФрд░ рд╡рд┐рдзрд┐ рдХреЗ рд╢рд░реАрд░ рдХрд╛ рд╡рд░реНрдгрди рдирд╣реАрдВ рдХрд░рддреА рд╣реИред  рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">MethodImpl(MethodImplOptions.ForwardRef)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> T Add&lt;T&gt;(T left, T right) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : unmanaged;</code> </pre> <br><p>  рдЕрдЧрд▓рд╛ рдЪрд░рдг <code>*.il</code> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╡рд┐рдзрд┐ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ <code>IL</code> рдХреЛрдб рдХреЗ рд╕рд╛рде рд▓рд┐рдЦрдирд╛ рд╣реИ: </p><br><pre> <code class="cs hljs">.method <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> hidebysig !!T Add&lt;valuetype .ctor (<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [<span class="hljs-title"><span class="hljs-title">mscorlib</span></span>]<span class="hljs-title"><span class="hljs-title">System</span></span>.<span class="hljs-title"><span class="hljs-title">ValueType</span></span> <span class="hljs-title"><span class="hljs-title">modreq</span></span> ([<span class="hljs-title"><span class="hljs-title">mscorlib</span></span>]<span class="hljs-title"><span class="hljs-title">System</span></span>.<span class="hljs-title"><span class="hljs-title">Runtime</span></span>.<span class="hljs-title"><span class="hljs-title">InteropServices</span></span>.<span class="hljs-title"><span class="hljs-title">UnmanagedType</span></span>)) <span class="hljs-title"><span class="hljs-title">T</span></span>&gt;(!!<span class="hljs-title"><span class="hljs-title">T</span></span> <span class="hljs-title"><span class="hljs-title">left</span></span>, !!<span class="hljs-title"><span class="hljs-title">T</span></span> <span class="hljs-title"><span class="hljs-title">right</span></span>) <span class="hljs-title"><span class="hljs-title">cil</span></span> <span class="hljs-title"><span class="hljs-title">managed</span></span> { .param type [<span class="hljs-number"><span class="hljs-number">1</span></span>] .custom instance <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> System.Runtime.CompilerServices.IsUnmanagedAttribute::.ctor() = (<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ) ldarg<span class="hljs-number"><span class="hljs-number">.0</span></span> ldarg<span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> ret }</code> </pre> <br><p>  рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЯрд╛рдЗрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реАрдВ рднреА <code>!!T</code> , рд╣рдо <code>CLR</code> рдХреЛ рджреЛ рддрд░реНрдХ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рдкрд░рд┐рдгрд╛рдо рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддреЗ рд╣реИрдВред  рдХрд┐рд╕реА <strong>рднреА</strong> рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рдВрдЪ <strong>рдирд╣реАрдВ</strong> рд╣реЛрддреА рд╣реИ, рдФрд░ рд╕рдм рдХреБрдЫ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд╡рд┐рд╡реЗрдХ рдкрд░ рд╣реИред  рд╣реИрд░рд╛рдиреА рдХреА рдмрд╛рдд рд╣реИ, рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ <em>рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд</em> рдЬрд▓реНрджреАред </p><br><h2 id="nemnogo-benchmarka">  рдереЛрдбрд╝рд╛ рд╕рд╛ рдмреЗрдВрдЪрдорд╛рд░реНрдХ </h2><br><p>  рд╕рдВрднрд╡рддрдГ, рдПрдХ рдИрдорд╛рдирджрд╛рд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреБрдЫ рдЬрдЯрд┐рд▓ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкрд░ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рдХреА рдЧрдгрдирд╛ "рд╣реЗрдб-рдСрди" рдЗрди рдЦрддрд░рдирд╛рдХ <code>IL</code> рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛рдПрдЧреАред  рдореИрдВрдиреЗ рдПрдХ рд╕рд░рд▓ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рд▓рд┐рдЦрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЧрдгрдирд╛ рдХреА рдЧрдИ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд╡рд░реНрдЧреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ <code>double</code> рд╕рд░рдгреА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЕрдВрддрд┐рдо рд░рд╛рд╢рд┐ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдСрдкрд░реЗрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ <code>C#</code> рдСрдкрд░реЗрдЯрд░реЛрдВ <code>+</code> , <code>*</code> рдФрд░ <code>/</code> , рдЬреИрд╕рд╛ рдХрд┐ рд╕реНрд╡рд╕реНрде рд▓реЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, <code>Expressions</code> рдФрд░ <code>IL</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдирд┐рд░реНрдорд┐рдд рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рдкрд░рд┐рдгрд╛рдо рд▓рдЧрднрдЧ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВ:</b> <div class="spoiler_text"><ul><li>  <code>DirectSum</code> рдорд╛рдирдХ рдСрдкрд░реЗрдЯрд░реЛрдВ <code>+</code> , <code>*</code> рдФрд░ <code>/</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдпреЛрдЧ рд╣реИ; </li><li>  <code>BranchSum</code> рдХрд╛ рдЙрдкрдпреЛрдЧ <code>object</code> рдорд╛рдзреНрдпрдо рд╕реЗ рдЯрд╛рдЗрдк рдФрд░ рдХрд╛рд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ; </li><li>  <code>UnsafeBranchSum</code> <code>Unsafe.As&lt;,&gt;()</code> рдорд╛рдзреНрдпрдо рд╕реЗ рдЯрд╛рдЗрдк рдФрд░ <code>Unsafe.As&lt;,&gt;()</code> рджреНрд╡рд╛рд░рд╛ <code>UnsafeBranchSum</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ; </li><li>  <code>ExpressionSum</code> рдкреНрд░рддреНрдпреЗрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдХреИрд╢реНрдб <code>ExpressionSum</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ ( <code>Expression</code> ); </li><li>  <code>UnsafeSum</code> рд▓реЗрдЦ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд <code>IL</code> рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ </li></ul><br><p>  рдкреЗрд▓реЛрдб рдмреЗрдВрдЪрдорд╛рд░реНрдХ - рдкреНрд░рдХрд╛рд░ <code>double</code> рдФрд░ рдЖрдХрд╛рд░ <code>N</code> рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдкреВрд░реНрд╡-рднрд░реЗ рд╕рд░рдгреА рдХреЗ рддрддреНрд╡реЛрдВ рдХреЗ рд╡рд░реНрдЧреЛрдВ рдХреЛ рд╕рдореЗрдЯрдирд╛, рдЗрд╕рдХреЗ рдмрд╛рдж <code>N</code> рджреНрд╡рд╛рд░рд╛ рдпреЛрдЧ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рдФрд░ рдЗрд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛;  рдЕрдиреБрдХреВрд▓рди рд╢рд╛рдорд┐рд▓ рдереЗред </p><br><pre> <code class="plaintext hljs">BenchmarkDotNet=v0.12.0, OS=Windows 10.0.18362 Intel Core i7-2700K CPU 3.50GHz (Sandy Bridge), 1 CPU, 8 logical and 4 physical cores .NET Core SDK=3.1.100 [Host] : .NET Core 3.1.0 (CoreCLR 4.700.19.56402, CoreFX 4.700.19.56404), X64 RyuJIT Job-POXTAH : .NET Core 3.1.0 (CoreCLR 4.700.19.56402, CoreFX 4.700.19.56404), X64 RyuJIT Runtime=.NET Core 3.1</code> </pre><br><div class="scrollable-table"><table><thead><tr><th>  рд╡рд┐рдзрд┐ </th><th>  рдПрди </th><th>  рдореАрди </th><th>  рддреНрд░реБрдЯрд┐ </th><th>  StdDev </th><th>  рдЕрдиреБрдкрд╛рдд </th><th>  RatioSD </th></tr></thead><tbody><tr><td>  <strong>DirectSum</strong> </td><td>  <strong>1000</strong> </td><td>  <strong>2.128 рд╣рдореЗрдВ</strong> </td><td>  <strong>0.0341 рд╣рдореЗрдВ</strong> </td><td>  <strong>рд╣рдореЗрдВ 0.0303</strong> </td><td>  <strong>1.00</strong> </td><td>  <strong>0.00</strong> </td></tr><tr><td>  BranchSum </td><td>  1000 </td><td>  57.468 рд╣рдореЗрдВ </td><td>  0.4478 рд╣рдореЗрдВ </td><td>  рд╣рдореЗрдВ 0.3496 </td><td>  26.97 </td><td>  0.46 </td></tr><tr><td>  UnsafeBranchSum </td><td>  1000 </td><td>  72.924 рд╣рдореЗрдВ </td><td>  0.4131 рд╣рдореЗрдВ </td><td>  0.3864 рд╣рдореЗрдВ </td><td>  34.28 </td><td>  0.50 </td></tr><tr><td>  ExpressionSum </td><td>  1000 </td><td>  144.555 рд╣рдореЗрдВ </td><td>  2.5182 рд╣рдореЗрдВ </td><td>  реи.реирейреирей рд╣рдо </td><td>  67.94 </td><td>  1.29 </td></tr><tr><td>  UnsafeSum </td><td>  1000 </td><td>  5.054 рд╣рдореЗрдВ </td><td>  0.0324 рд╣рдореЗрдВ </td><td>  рд╣рдореЗрдВ 0.0303 </td><td>  2.37 </td><td>  0.03 </td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  <strong>DirectSum</strong> </td><td>  <strong>10000</strong> </td><td>  <strong>21.174 рд╣рдореЗрдВ</strong> </td><td>  <strong>0.3092 рд╣рдореЗрдВ</strong> </td><td>  <strong>0.2741 рд╣рдореЗрдВ</strong> </td><td>  <strong>1.00</strong> </td><td>  <strong>0.00</strong> </td></tr><tr><td>  BranchSum </td><td>  10000 </td><td>  573.972 рд╣рдореЗрдВ </td><td>  2.9274 рд╣рдореЗрдВ </td><td>  2.5951 рд╣рдореЗрдВ </td><td>  27.11 </td><td>  0.40 </td></tr><tr><td>  UnsafeBranchSum </td><td>  10000 </td><td>  735.031 рд╣рдореЗрдВ </td><td>  9.1016 рд╣рдореЗрдВ </td><td>  8.0683 рд╣рдореЗрдВ </td><td>  34.72 </td><td>  0.53 </td></tr><tr><td>  ExpressionSum </td><td>  10000 </td><td>  1,462.593 рд╣рдореЗрдВ </td><td>  9.0932 рд╣рдореЗрдВ </td><td>  8.0609 рд╣рдореЗрдВ </td><td>  69.09 </td><td>  1.02 </td></tr><tr><td>  UnsafeSum </td><td>  10000 </td><td>  50.388 рд╣рдореЗрдВ </td><td>  рд╣рдореЗрдВ 0.3956 </td><td>  рд╣рдореЗрдВ 0.3701 </td><td>  2.38 </td><td>  0.03 </td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  <strong>DirectSum</strong> </td><td>  <strong>100000</strong> </td><td>  <strong>210.021 рд╣рдореЗрдВ</strong> </td><td>  <strong>1.9832 рд╣рдореЗрдВ</strong> </td><td>  <strong>1.7581 рд╣рдореЗрдВ</strong> </td><td>  <strong>1.00</strong> </td><td>  <strong>0.00</strong> </td></tr><tr><td>  BranchSum </td><td>  100000 </td><td>  6,046.340 рд╣рдореЗрдВ </td><td>  86.9740 рд╣рдореЗрдВ </td><td>  77.1002 рд╣рдореЗрдВ </td><td>  28.79 </td><td>  0.42 </td></tr><tr><td>  UnsafeBranchSum </td><td>  100000 </td><td>  7,406.489 рд╣рдореЗрдВ </td><td>  65.7415 рд╣рдореЗрдВ </td><td>  58.2782 рд╣рдореЗрдВ </td><td>  35.27 </td><td>  0.27 </td></tr><tr><td>  ExpressionSum </td><td>  100000 </td><td>  14,021.642 рд╣рдореЗрдВ </td><td>  189.2625 рд╣рдореЗрдВ </td><td>  167.7763 рд╣рдореЗрдВ </td><td>  66.77 </td><td>  0.88 </td></tr><tr><td>  UnsafeSum </td><td>  100000 </td><td>  505.551 рд╣рдореЗрдВ </td><td>  2.3662 рд╣рдореЗрдВ </td><td>  реи.реирезрейрей рд╣рдо </td><td>  2.41 </td><td>  0.03 </td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>  <strong>DirectSum</strong> </td><td>  <strong>1024000</strong> </td><td>  <strong>2,306.751 рд╣рдореЗрдВ</strong> </td><td>  <strong>22.4173 рд╣рдореЗрдВ</strong> </td><td>  <strong>20.9692 рд╣рдореЗрдВ</strong> </td><td>  <strong>1.00</strong> </td><td>  <strong>0.00</strong> </td></tr><tr><td>  BranchSum </td><td>  1024000 </td><td>  61,643.224 рд╣рдореЗрдВ </td><td>  610.3048 рд╣рдореЗрдВ </td><td>  570.8795 рд╣рдореЗрдВ </td><td>  26.72 </td><td>  0.28 </td></tr><tr><td>  UnsafeBranchSum </td><td>  1024000 </td><td>  75,644.639 рд╣рдореЗрдВ </td><td>  494.4096 рд╣рдореЗрдВ </td><td>  462.4711 рд╣рдореЗрдВ </td><td>  32.80 </td><td>  0.39 </td></tr><tr><td>  ExpressionSum </td><td>  1024000 </td><td>  154,327.137 рд╣рдореЗрдВ </td><td>  1,267.2469 рд╣рдореЗрдВ </td><td>  1,185.3835 рд╣рдореЗрдВ </td><td>  66.91 </td><td>  0.55 </td></tr><tr><td>  UnsafeSum </td><td>  1024000 </td><td>  5,295.990 рд╣рдореЗрдВ </td><td>  14.9537 рд╣рдореЗрдВ </td><td>  12.4871 рд╣рдореЗрдВ </td><td>  2.29 </td><td>  0.02 </td></tr></tbody></table></div></div></div><br><p>  рд╣рдорд╛рд░рд╛ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдб рд▓рдЧрднрдЧ <code>2.5</code> рдЧреБрдирд╛ рдзреАрдорд╛ рд╣реИ (рдПрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ)ред  рдЗрд╕реЗ рдЗрд╕ рддрдереНрдп рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдард╣рд░рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ "рдорд╛рдереЗ" рдХреА рдЧрдгрдирд╛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХрдВрдкрд╛рдЗрд▓рд░ <code>add</code> рдСрдк рдХреЛрдб рдореЗрдВ <code>a + b</code> рд╕рдВрдХрд▓рд┐рдд рдХрд░рддрд╛ <code>a + b</code> , рдФрд░ рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╡рд┐рдзрд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдХ рд╕реНрдерд┐рд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ рдзреАрдорд╛ рд╣реИред </p><br><h2 id="vmesto-zaklyucheniya-kogda-true--true">  рд╕рдорд╛рдкрди рдХреЗ рдмрдЬрд╛рдп: рдЬрдм <code>true != true</code> </h2><br><p>  рдХреБрдЫ рджрд┐рдиреЛрдВ рдкрд╣рд▓реЗ, рдореИрдВ рдЬреЗрд░реЗрдб рдкрд╛рд░реНрд╕рдиреНрд╕ рдХреЗ рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ <a href="https://twitter.com/jaredpar/status/1205540750764625920" rel="nofollow">рдЯреНрд╡реАрдЯ рдкрд░</a> рдЖрдпрд╛ рдерд╛: </p><br><blockquote>  рдРрд╕реЗ рдорд╛рдорд▓реЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд "рдЧрд▓рдд" рдЫрд╛рдкреЗрдВрдЧреЗ <br>  рдмреВрд▓ рдм = ... <br>  if (b) рдХрдВрд╕реЛрд▓.рдЯреНрд░рд╛рдЗрдЯрд▓рд╛рдЗрди (b.IsTrue ()); </blockquote><p>  рдпрд╣ <a href="https://twitter.com/vreshetnikov/status/1204929378368417792" rel="nofollow">рдЗрд╕ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐</a> рдХрд╛ рдЙрддреНрддрд░ рдерд╛, рдЬреЛ <code>true</code> рдХреЗ рд▓рд┐рдП <code>bool</code> рд╕рддреНрдпрд╛рдкрди рдХреЛрдб рджрд┐рдЦрд╛рддрд╛ <code>true</code> , рдЬреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; !<span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><p>  рдЪреЗрдХ рдмреЗрдорд╛рдиреА рд▓рдЧрддреЗ рд╣реИрдВ, рд╣реИ рдирд╛?  рдЬрд╛рд░реЗрдб рдПрдХ рдкреНрд░рддрд┐рд░реВрдк рджреЗрддрд╛ <a href="https://gist.github.com/jaredpar/a0835afc71139284c09bfda203d8c011" rel="nofollow">рд╣реИ</a> рдЬреЛ <code>bool</code> рд╡реНрдпрд╡рд╣рд╛рд░ рдХреА <a href="https://gist.github.com/jaredpar/a0835afc71139284c09bfda203d8c011" rel="nofollow">рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ</a> рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд <a href="https://gist.github.com/jaredpar/a0835afc71139284c09bfda203d8c011" rel="nofollow">рдХрд░рддрд╛ рд╣реИ</a> ред  рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ <code>bool</code> <code>byte</code> ( <code>sizeof(bool) == 1</code> ) рд╣реИ, рдЬрдмрдХрд┐ <code>false</code> <code>0</code> рдФрд░ <code>true</code> <code>1</code> рдореИрдЪред  рдЬрдм рддрдХ рдЖрдк рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рд╕реНрд╡рд┐рдВрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, <code>bool</code> рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдФрд░ рдЕрдиреБрдорд╛рдирд┐рдд рд░реВрдк рд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬреИрд╕рд╛ рдХрд┐ рдЬреЗрд░реЗрдб рдиреЗ рджрд┐рдЦрд╛рдпрд╛ рд╣реИ, рдЖрдк рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореВрд▓реНрдп рдХреЗ рд░реВрдк рдореЗрдВ <code>2</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ <code>bool</code> рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЪреЗрдХреЛрдВ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> b = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>* ptr = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>*)&amp;b; *ptr = <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br><p>  рд╣рдо рдЕрдкрдиреЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЧрдгрд┐рддреАрдп рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕рдорд╛рди рдкреНрд░рднрд╛рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╣ <code>Expressions</code> рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fakeTrue = Subtract&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val = *(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>*)&amp;fakeTrue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(fakeTrue) Assert.AreNotEqual(fakeTrue, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Assert.Fail(<span class="hljs-string"><span class="hljs-string">"Clause not entered."</span></span>);</code> </pre> <br><p>  рд╣рд╛рдВ, рд╣рд╛рдВ, рд╣рдо <code>true</code> рд╢рд╛рдЦрд╛ рдХреЗ рдЕрдВрджрд░ рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╕реНрдерд┐рддрд┐ <code>true</code> , рдФрд░ рд╣рдо рдЙрдореНрдореАрдж рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ <em><code>true</code> рдирд╣реАрдВ <code>true</code></em> ред  рдРрд╕рд╛ рдХреНрдпреЛрдВ рд╣реИ?  рдпрджрд┐ рдЖрдк рдЪреЗрдХ рдХреЗ рдмрд┐рдирд╛ <code>0</code> ( <code>=false</code> ) <code>1</code> ( <code>=true</code> ) рд╕реЗ рдШрдЯрд╛рддреЗ рд╣реИрдВ, рддреЛ <code>byte</code> рдпрд╣ <code>255</code> рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛ред  рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, <code>255</code> (рд╣рдорд╛рд░реЗ <code>fakeTrue</code> ) <code>1</code> (рд╡рд╛рд╕реНрддрд╡рд┐рдХ <code>true</code> ) рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП <code>fakeTrue</code> рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдмреНрд░рд╛рдВрдЪрд┐рдВрдЧ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИред </p><br><p>  <code>if</code> рдЙрд▓рдЯрд╛ рд╣реЛрддрд╛ рд╣реИ: рдПрдХ рд╕рд╢рд░реНрдд рд╢рд╛рдЦрд╛ рдбрд╛рд▓реА рдЬрд╛рддреА рд╣реИ;  рдпрджрд┐ рд╕реНрдерд┐рддрд┐ <em>рдЭреВрдареА рд╣реИ</em> , рддреЛ рдмрд┐рдВрджреБ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдХреНрд░рдордг <code>if</code> рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрдд рдХреЗ рдмрд╛рдж рд╣реЛрддрд╛ рд╣реИред  рд╕рддреНрдпрд╛рдкрди <code>brfalse</code> / <code>brfalse_S</code> рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╕реНрдЯреИрдХ рдкрд░ рдЕрдВрддрд┐рдо рдорд╛рди рдХреА рддреБрд▓рдирд╛ <em>рд╢реВрдиреНрдп рдХреЗ</em> рд╕рд╛рде рдХрд░рддрд╛ <em>рд╣реИ</em> ред  рдпрджрд┐ рдорд╛рди рд╢реВрдиреНрдп рд╣реИ, рддреЛ рдпрд╣ <code>false</code> , рд╣рдо <code>if</code> рдмреНрд▓реЙрдХ рдкрд░ рдХрджрдо рд░рдЦрддреЗ рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, <code>fakeTrue</code> рд╕рд┐рд░реНрдл рд╢реВрдиреНрдп рдХреЗ рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪреЗрдХ рдкрд╛рд╕ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди <code>fakeBool</code> рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдЬрд╛рд░реА рд░рд╣рддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ рд╣рдо <code>fakeBool</code> рдореВрд▓реНрдп рдХреА рддреБрд▓рдирд╛ рд╕рдЪреНрдЪреЗ рдореВрд▓реНрдп рд╕реЗ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдирдХрд╛рд░рд╛рддреНрдордХ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  UPD01: <br>  <a href="https://habr.com/en/users/shai_hulud/" class="user_link">Shai_hulud</a> рдФрд░ <a href="https://habr.com/en/users/shai_hulud/" class="user_link">blowin рдХреЗ</a> рд╕рд╛рде рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдореЗрдВ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдЬреЛрдбрд╝рд╛ рд╣реИ рдЬреЛ рдПрдХ рд╢рд╛рдЦрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ <code>if(typeof(T) == typeof(int)) return (T)(object)((int)(object)left + (int)(object)right);</code>  ред  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ <code>JIT</code> рдХреЛ рдЪреЗрдХ рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХрдо рд╕реЗ рдХрдо рдЬрдм <code>T</code> рдПрдХ <code>struct</code> , рддреЛ рдЗрд╕ рддрд░рд╣ рдХреЗ рддрд░реАрдХреЗ рдЕрднреА рднреА рдкрд░рд┐рдорд╛рдг рдзреАрдореА рдХреЗ рдПрдХ рдЖрджреЗрд╢ рдХрд╛ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд░реВрдкрд╛рдВрддрд░рдг <code>T</code> -&gt; <code>int</code> -&gt; <code>T</code> рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реИрдВ, рдпрд╛ рдмреЙрдХреНрд╕рд┐рдВрдЧ / рдЕрдирдмреЙрдХреНрд╕рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред  рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреЗ рдкрд░рд┐рдгрд╛рдо <code>MethodImpl</code> рдЭрдВрдбреЗ рд╕реЗ рдХрд╛рдлреА рдкреНрд░рднрд╛рд╡рд┐рдд <code>MethodImpl</code> рд╣реЛрддреЗ рд╣реИрдВред </p><br><p>  UPD02: <br>  рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ <a href="https://habr.com/en/users/xxxvano/" class="user_link">xXxVano</a> рдиреЗ рдЯрд╛рдЗрдк рдХрд░рдХреЗ рдбрд╛рд▓реА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА <code>T</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рдпрд╛ &lt;&lt;&gt; <code>Unsafe.As&lt;TFrom, TTo&gt;()</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рдХрд╛рд░ред  <code>object</code> рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдмреНрд░рд╛рдВрдЪрд┐рдВрдЧ рдФрд░ рдХрд╕реНрдЯрдо рдХреЗ рдЕрдиреБрд░реВрдк, рдореИрдВрдиреЗ рд╕рднреА рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдмреНрд░рд╛рдВрдЪрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рддреАрди рдСрдкрд░реЗрд╢рди (рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЧреБрдгрд╛ рдФрд░ рднрд╛рдЧ) рд▓рд┐рдЦрд╛, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдореИрдВрдиреЗ рдПрдХ рдФрд░ рдмреЗрдВрдЪрдорд╛рд░реНрдХ ( <code>UnsafeBranchSum</code> ) рдЬреЛрдбрд╝рд╛ред  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рд╕рднреА рд╡рд┐рдзрд┐рдпрд╛рдБ (рднрд╛рд╡реЛрдВ рдХреЛ рдЫреЛрдбрд╝рдХрд░) рд▓рдЧрднрдЧ рд╕рдорд╛рди рдПрд╕ рдПрдо рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рддреА рд╣реИрдВ (рдЬрд╣рд╛рдБ рддрдХ рдЕрд╕реЗрдВрдмрд▓реА рдХреЗ рдореЗрд░реЗ рд╕реАрдорд┐рдд рдЬреНрдЮрд╛рди рд╕реЗ рдореБрдЭреЗ рдиреНрдпрд╛рдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ), рдХрд┐рд╕реА рдЕрдЬреНрдЮрд╛рдд рдХрд╛рд░рдг рд╕реЗ, рдмреНрд░рд╛рдВрдЪрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рджреЛрдиреЛрдВ рд╡рд┐рдзрд┐рдпрд╛рдБ рджреЛрдиреЛрдВ рд╕реАрдзреЗ <code>DirectSum</code> ( <code>DirectSum</code> ) рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдзреАрдореА рд╣реИрдВ рдЬреЗрдирд░рд┐рдХ рдФрд░ <code>IL</code> рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред  рдЗрд╕ рдкреНрд░рднрд╛рд╡ рдХреЗ рд▓рд┐рдП рдореЗрд░реЗ рдкрд╛рд╕ рдХреЛрдИ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдирд╣реАрдВ рд╣реИ, рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╕рдордп рд╡реНрдпрддреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рдиреБрдкрд╛рддрд┐рдХ рд░реВрдк рд╕реЗ <code>N</code> рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ <code>JIT</code> рд╕рднреА рдЬрд╛рджреВ рдХреЗ рдмрд╛рд╡рдЬреВрдж, <em>рдкреНрд░рддреНрдпреЗрдХ</em> рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдирд┐рд░рдВрддрд░ рдУрд╡рд░рд╣реЗрдб рд╣реИред  рдпрд╣ рдУрд╡рд░рд╣реЗрдб рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ <code>IL</code> рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рдЧрд╛рдпрдм рд╣реИред   ,   <code>IL</code> -    ,    /    /  ,          100%  (  ,   ). <br>   ,      , -       . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi480416/">https://habr.com/ru/post/hi480416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi480402/index.html">рдХреИрд╕реЗ Tinkoff рд╕реЗ рджреВрд╕рд░рд╛ Android mitap T╠╢╠╢╤Л╠╢╨╣ second p How╨╡ did╤А</a></li>
<li><a href="../hi480404/index.html">рдорд┐рдХрд░реЛрдЯрд┐рдХ рдФрд░ рд▓рд┐рдирдХреНрд╕ред рджрд┐рдирдЪрд░реНрдпрд╛ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рди</a></li>
<li><a href="../hi480408/index.html">рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП 52 рдбреЗрдЯрд╛рд╕реЗрдЯ</a></li>
<li><a href="../hi480412/index.html">рдЦреБрд▓реЗ рдореЗрдВ JJ.msk.ru рдмреИрдардХ рдореЗрдВ рдУрдкрдирдЬреЗрдбреАрдХреЗ 11 рдореЗрдВ рдЬрд╛рд╡рд╛ рдлреНрд▓рд╛рдЗрдЯ рд░рд┐рдХреЙрд░реНрдбрд░ рдХреА рдирдИ рдФрд░ рдкреБрд░рд╛рдиреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрд▓реЗрдХреНрд╕реА рд░рд╛рдЧреЛрдЬрд╝рд┐рди</a></li>
<li><a href="../hi480414/index.html">рдкрд┐рдЫрд▓реЗ рд╕рдкреНрддрд╛рд╣ рдирдВрдмрд░ 393 (9 рджрд┐рд╕рдВрдмрд░ - 15, 2019) рдХреЗ рд▓рд┐рдП рдлреНрд░рдВрдЯ-рдПрдВрдб рдХреА рджреБрдирд┐рдпрд╛ рд╕реЗ рддрд╛рдЬрд╛ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдкрд╛рдЪрди</a></li>
<li><a href="../hi480420/index.html">рдПрдереЗрд░реЛрд╕реНрдХреНрд▓реЗрд░реЛрд╕рд┐рд╕ рдФрд░ рдЗрд╕рдХреЗ рдЙрдкрдЪрд╛рд░ рдкрд░ рдореИрдереНрдпреВ "рдУрдХреА" рдУ'рдХреЙрдирд░ рдХреЗ рд╕рд╛рде рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░</a></li>
<li><a href="../hi480422/index.html">C ++ рдореЗрдВ Google рд╕реНрдЯрд╛рдЗрд▓ рдЧрд╛рдЗрдбред рднрд╛рдЧ 1</a></li>
<li><a href="../hi480424/index.html">C ++ рдореЗрдВ Google рд╕реНрдЯрд╛рдЗрд▓ рдЧрд╛рдЗрдбред рднрд╛рдЧ 9</a></li>
<li><a href="../hi480428/index.html">рд╕рдмрд╕реЗ рд╕рд░рд▓ рдЖрд╢реБрд▓рд┐рдкрд┐ рдХреА рд╡рд┐рдзрд┐ред рдЙрд╕рдХреЗ рд▓рд┐рдП рд╡рд░реНрдгрдорд╛рд▓рд╛ рдФрд░ рдлрд╝реЙрдиреНрдЯред</a></li>
<li><a href="../hi480430/index.html">рд╡реАрдбрд┐рдпреЛ рдХреЛрдбреЗрдХ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред рднрд╛рдЧ 2. рдХреНрдпрд╛, рдХреНрдпреЛрдВ, рдХреИрд╕реЗ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>