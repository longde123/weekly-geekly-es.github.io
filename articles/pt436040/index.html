<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üâë üñïüèø üõéÔ∏è Otimiza√ß√£o de gr√°ficos. Casco c√¥ncavo interessante ü§ôüèæ ü•ì üåî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em um ponto, durante o desenvolvimento do jogo, eu me deparei com a quest√£o do desempenho em PCs modernos. Nosso modelador possui um computador de mon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimiza√ß√£o de gr√°ficos. Casco c√¥ncavo interessante</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436040/">  Em um ponto, durante o desenvolvimento do jogo, eu me deparei com a quest√£o do desempenho em PCs modernos.  Nosso modelador possui um computador de montagem vermelho moderno bastante poderoso.  Mas ele teve nosso projeto terrivelmente lento, carregando um n√∫cleo de processador. <br><br>  O motivo √© simples - os novos processadores possuem muitos n√∫cleos, mas na verdade s√£o menos eficientes em aplicativos de thread √∫nico.  Naquela √©poca, eu tinha uma renderiza√ß√£o em um fluxo.  Mas, de fato, as raz√µes n√£o estavam muito nisto.  E, no processo de encontrar o problema, decidi calcular quantos pol√≠gonos est√£o presentes na cena: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen006.jpg"><br><br>  No mapa m√©dio do jogo, com a dist√¢ncia m√°xima e com um grande conjunto de palmeiras - <b>15 824 756 tri√¢ngulos!</b>  Quase 16 milh√µes!  Um n√∫mero enorme. <br><a name="habracut"></a><br>  Tendo brincado um pouco com o gerador de mapas, consegui encontrar um lugar com 16,75 milh√µes: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen007.jpg"><br><br>  Embora, aqui, um lugar semelhante com √°rvores de Natal tenha dado apenas 8,5 milh√µes de tri√¢ngulos: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen008.jpg"><br><br>  A cena m√©dia consistia em ~ 4 milh√µes: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen009.jpg"><br><br>  Em geral, fiquei feliz que minha renderiza√ß√£o estivesse lidando com um n√∫mero t√£o grande de tri√¢ngulos, mas o n√∫mero deles era excessivo.  A solu√ß√£o estava na superf√≠cie: <br><br><ol><li>  Otimize o n√∫mero de pol√≠gonos nos modelos. </li><li>  Otimize a malha poligonal da paisagem. </li><li>  A implementa√ß√£o da renderiza√ß√£o multithread. </li></ol><br>  Para aqueles que podem n√£o estar interessados ‚Äã‚Äãno primeiro par√°grafo do nosso programa de otimiza√ß√£o, por exemplo, especialistas inexperientes, recomendo ir com seguran√ßa para a segunda parte. <br><br><h2>  1. Otimiza√ß√£o do n√∫mero de pol√≠gonos nos modelos </h2><br>  Em nosso motor, a vegeta√ß√£o √© desenhada em "pacotes", toda a paisagem √© dividida em ladrilhos e sub-ladrilhos, o pacote m√≠nimo √© um sub-ladrilho. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen001.jpg"><br><br>  Um pacote √© uma malha, pois reduzir o n√∫mero de malhas reduz significativamente o n√∫mero de chamadas de CPU-&gt; GPU. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen002.jpg"><br><br>  Inicialmente, nossas √°rvores consistiam em cones truncados, movendo-se para cones completos, conseguimos remover alguns tri√¢ngulos extras: <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen003.jpg"><br><br>  A cereja no bolo foi a decis√£o de remover os troncos das √°rvores, porque com o √¢ngulo da c√¢mera eles simplesmente n√£o eram vis√≠veis. <br><br>  Como resultado, conseguimos reduzir em 40% o n√∫mero de pol√≠gonos, em um pacote de √°rvores de Natal.  As diferen√ßas s√£o quase invis√≠veis: <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen004.jpg"><br><br>  Com as palmeiras, era mais dif√≠cil, mas pacotes de 5000 - 6000 pol√≠gonos precisavam ser consertados.  Como alcan√ßar a massa e a densidade da selva?  A alta densidade da selva foi alcan√ßada devido ao grande n√∫mero de palmeiras: <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen005.jpg"><br><br>  Decidimos simplificar as palmas das m√£os e introduzir uma segunda camada de vegeta√ß√£o, o que nos permitiu manter a densidade vis√≠vel e alcan√ßar os 600 - 700 pol√≠gonos desejados por pacote. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen006.jpg"><br><br>  Reduzir o n√∫mero de pol√≠gonos em 10 vezes √© um excelente resultado. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen007.jpg"><br><br><h2>  2. Otimiza√ß√£o do cen√°rio de malha poligonal </h2><br><br>  Inicialmente, a grade da paisagem era: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen010.jpg"><br><br>  A captura de tela mostra se√ß√µes simples da paisagem, s√£o telhas de prados, plan√≠cies, embora outras superf√≠cies lisas.  Decidi remover pequenas irregularidades na paisagem.  Assim, ele aumentou a √°rea dos mesmos ladrilhos de altura.  N√£o verificando astuciosamente todos os v√©rtices dos ladrilhos e sub-ladrilhos quanto √† igualdade na altura, consegui alcan√ßar este resultado: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen012.jpg"><br><br>  Ainda havia lugares planos que poderiam ser otimizados, e comecei a construir pol√≠gonos a partir desses tri√¢ngulos que tinham a mesma altura.  Um ladrilho foi retirado e todos os seus tri√¢ngulos foram classificados em uma matriz de tri√¢ngulos de altura desigual e uma lista de matrizes consistindo em altura igual e tri√¢ngulos adjacentes. <br><br><img src="http://thegreattribes.com/imagestoinet/habrblog1/screen008.jpg"><br><br>  No exemplo dado, descobriu-se: 1 matriz de tri√¢ngulos que n√£o podem ser alterados, uma vez que tinham todas as alturas diferentes (tri√¢ngulos vermelhos) e uma lista composta por duas matrizes de tri√¢ngulos com a mesma altura (as matrizes s√£o preenchidas com cores). <br><br>  Agora, a tarefa era encontrar, a partir da matriz de tri√¢ngulos, seu contorno c√¥ncavo-c√¥ncavo (casco c√¥ncavo), e muitos tri√¢ngulos poderiam ter orif√≠cios.  Anteriormente, encontrei o Convex Hull em meu trabalho, n√£o havia problemas com eles, eu j√° usava o algoritmo Graham.  Mas houve problemas com a constru√ß√£o do casco c√¥ncavo ... Foi bastante dif√≠cil encontrar informa√ß√µes sobre esse t√≥pico na Internet.  Eu tive que escrever uma implementa√ß√£o de algoritmos do zero.  N√£o mentirei se disser que li cerca de dez disserta√ß√µes diferentes sobre esse assunto.  Mas todos os algoritmos propostos deram um resultado aproximado com algum erro.  Depois de uma semana de tormento e dor, tive a ideia do meu algoritmo. <br><br>  Tentei construir um contorno a partir do conjunto de v√©rtices dos tri√¢ngulos, ou seja,  Traduzi a matriz de tri√¢ngulos em uma matriz de v√©rtices e j√° constru√≠ uma concha sobre eles.  Mas, para minha tarefa, isso n√£o foi necess√°rio.  De acordo com minhas conclus√µes, construir uma concha diretamente a partir de tri√¢ngulos era mais f√°cil e a precis√£o do casco c√¥ncavo era de 100%. <br><br>  Inicialmente, eu queria colocar uma colcha de retalhos do c√≥digo fonte do algoritmo aqui, mas parece mais f√°cil descrev√™-lo em poucas palavras: base √© a regra: se o v√©rtice de um tri√¢ngulo for inclu√≠do em quatro ou menos tri√¢ngulos, uma das arestas que formam o v√©rtice fica na borda.  Em seguida, √© formada uma lista dessas arestas, levando em considera√ß√£o a remo√ß√£o de arestas id√™nticas.  Encontramos a aresta com o menor X e Y e a partir dela iniciamos a passagem / classifica√ß√£o das arestas com a adi√ß√£o de v√©rtices exclusivos √† lista.  Esta lista ser√° a concha de muitos tri√¢ngulos.  A √∫nica coisa na final √© remover pontos colineares da lista. <br><br>  Como resultado disso, eu pude construir o Casco C√¥ncavo de quase qualquer complexidade.  Esse algoritmo n√£o se encaixava em um conjunto de furos, mas eu resolvi isso simplesmente dividindo esse conjunto em duas metades em um buraco.  Ent√£o peguei o circuito e o triangulei: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen014.jpg"><br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen015.jpg"><br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen016.jpg"><br><br>  Tudo saiu bem: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen017.jpg"><br><br>  Mas no final, fiquei chateado com o resultado.  O algoritmo que desenvolvi proporcionou um aumento tang√≠vel no desempenho ao renderizar uma cena, j√° que o n√∫mero de pol√≠gonos em m√©dia foi reduzido de 60 a 70%.  Mas, ao mesmo tempo, a gera√ß√£o de cart√µes come√ßou a ocorrer 10 vezes mais lenta.  O algoritmo acabou consumindo muito tempo. <br><br>  Demorou tr√™s dias para considerar uma vers√£o leve do algoritmo para otimizar a malha poligonal da paisagem, o que deu os seguintes resultados: <br><br><img src="http://thegreattribes.com/imagestoinet/devblog33/screen027.jpg"><br><br>  Agora, os c√°lculos de dados para otimiza√ß√£o tornaram-se percept√≠veis no contexto da gera√ß√£o de mapas, e o n√∫mero de pol√≠gonos diminuiu, em m√©dia, de 40 a 50%. <br><br>  Este artigo √© experimental e superficial.  Se algu√©m estiver interessado no t√≥pico de desenvolvimento de jogos, estou pronto para continuar e expandir o artigo com o fantasma de etapas espec√≠ficas, solu√ß√µes e planos futuros.  Al√©m disso, acho que voc√™ estar√° interessado no t√≥pico de constru√ß√£o de um aplicativo Open GL multiencadeado desenvolvido em Java, sobre o qual tentarei falar no pr√≥ximo artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436040/">https://habr.com/ru/post/pt436040/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436026/index.html">Info Desk: ‚ÄúInternet Archive‚Äù - hist√≥ria, miss√£o e projetos subsidi√°rios</a></li>
<li><a href="../pt436028/index.html">Uma introdu√ß√£o ao Kubernetes para usu√°rios do VMware. Parte 1. Teoria</a></li>
<li><a href="../pt436032/index.html">Tutorial Reagir Parte 9: Propriedades do componente</a></li>
<li><a href="../pt436036/index.html">Os pesquisadores de intelig√™ncia artificial podem confiar a ele um teste de seu trabalho?</a></li>
<li><a href="../pt436038/index.html">O som do sil√™ncio: quantos gadgets malucos s√£o necess√°rios para alcan√ßar um ambiente ideal para dormir?</a></li>
<li><a href="../pt436042/index.html">Painel de ferramentas adicionais para o desenvolvedor no InterSystems IRIS</a></li>
<li><a href="../pt436044/index.html">Servidor VDS em Amsterd√£ por 150 rublos / m√™s</a></li>
<li><a href="../pt436048/index.html">Colabore pontos de acesso Wi-Fi</a></li>
<li><a href="../pt436050/index.html">Como conectar o Raspberry PI √† IoT do Azure: instru√ß√µes passo a passo</a></li>
<li><a href="../pt436052/index.html">Como criar um departamento de ci√™ncia de dados e n√£o estragar tudo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>