<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™†ğŸ¾ ğŸ˜Œ ğŸ‘©â€ğŸ‘©â€ğŸ‘§ Eskalasi hak istimewa Windows â—¾ï¸ ğŸ‘°ğŸ¿ ğŸ˜±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Praktek Manajemen Keamanan Informasi: terpuji 
 Meningkatkan hak pengguna ke tingkat administrator domain Windows 

 Pendahuluan 
 Sistem manajemen ke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eskalasi hak istimewa Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423937/"><h2>  Praktek Manajemen Keamanan Informasi: terpuji </h2><br>  <b>Meningkatkan hak pengguna ke tingkat administrator domain Windows</b> <br><br><h4>  Pendahuluan </h4><br>  Sistem manajemen keamanan informasi yang baik (ISMS) memerlukan evaluasi berkala atas efektivitasnya.  Ada berbagai metode penilaian seperti itu, salah satu varietas di antaranya adalah yang disebut.  "Penetration test" atau pentest - simulasi resmi serangan hacker pada sistem informasi untuk mengidentifikasi kerentanan dalam perlindungannya sebelum seorang penyerang nyata mendeteksi mereka.  Dalam hal ini, alat, eksploitasi, metode, dll. Yang tersedia dalam kehidupan nyata dapat digunakan. <br><br>  Artikel ini menjelaskan salah satu praktik anti-peretasan ini, yang bertujuan untuk meningkatkan hak istimewa dari pengguna domain Microsoft Windows biasa ke tingkat administrator domain.  Artikel ini didasarkan pada laporan hasil tes yang dipraktikkan.  Untuk alasan kerahasiaan, semua informasi yang memungkinkan untuk mengidentifikasi tempat (domain dan nama host, akun, dll.) Dihapus atau diubah.  Artikel ini menunjukkan teknik-teknik dasar, untuk pemahaman yang lebih baik, saya memberikan landasan teoretis dan kerentanan yang digunakan untuk versi spesifik sistem operasi, serta rekomendasi umum untuk perlindungan.  Dan meskipun sebagian besar versi Windows ini akan dianggap usang pada saat publikasi, artikel ini mungkin berguna bagi administrator sistem pemula untuk lebih memahami metode melindungi kredensial di lingkungan Windows. <br><a name="habracut"></a><br><h4>  Deskripsi objek uji </h4><br>  Objek pengujian cukup standar - sistem informasi perusahaan kecil (kurang dari 200 karyawan) yang berspesialisasi dalam pengembangan perangkat lunak.  Jaringan internal perusahaan juga tipikal: dial-up Gigabit Ethernet, domain Microsoft Windows (kami akan menyebutnya CORP.LOCAL).  Host internal dibagi menjadi subnet IP berdasarkan afiliasi fungsional mereka (seperti: sekelompok pengembang, insinyur kualitas, departemen sumber daya manusia, akuntansi, pemasaran, manajemen puncak, fasilitas, dll.), Semua segmentasi dilakukan pada saklar L3 .  Ada juga taman server internal yang didedikasikan untuk subnet IP terpisah dan berisi: dua pengontrol domain Windows Server 2008 dengan DNS terintegrasi, server email internal yang menjalankan Exchange, server file, terminal server, dan beberapa server tambahan lainnya yang menjalankan Windows dan Linux.  Secara terpisah, perlu dicatat laboratorium pengujian dengan armada mesin yang menjalankan berbagai versi Microsoft Windows (baik desktop dan server) dan dirancang untuk menguji perangkat lunak yang dikembangkan.  Akses ke host lab uji tersedia untuk semua karyawan.  Versi utama OS desktop adalah Windows 7. Di komputer desktop dan server, diinstal perangkat lunak antivirus yang tidak dikonfigurasi dengan baik dari produsen yang berbeda (dari Symantec, Kaspersky dan Trend Micro, mengapa yang dikonfigurasi dengan buruk akan dibahas kemudian). <br><br><h4>  Model Penyusup </h4><br>  Penyusup - karyawan internal yang memiliki akun pengguna yang tidak terjangkau dalam domain, komputer desktop, akses fisik ke komputer uji (mungkin memiliki laptop perusahaan), tetapi tidak memiliki hak administrator lokal pada salah satu dari mereka.  Selain itu, akun penyusup tidak memiliki kemampuan untuk mengubah pengaturan perangkat lunak antivirus.  Maksud penyerang adalah untuk mendapatkan akses yang setara dengan akses administrator ke pengontrol domain dan / atau server file. <br><br>  Seperti yang kita lihat, baik model penyusup maupun deskripsi perusahaannya cukup tipikal. <br><br><h3>  Implementasi serangan </h3><br><h4>  Langkah 0. Pengumpulan informasi tentang jaringan internal </h4><br>  Jadi, kami bertindak atas nama pelaku.  Pada langkah ini, kita perlu mengumpulkan informasi tentang: <br><br><ul><li>  pengalamatan dan subnetting internal </li><li>  nama host dan alamat IP, pertama-tama kami tertarik pada daftar server </li><li>  menggunakan protokol NetBIOS. </li></ul><br>  Pertama, menggunakan utilitas ipconfig, kami mendapatkan alamat IP dari server DNS: 192.168.12.1 dan 192.168.12.2.  Karena  DNS terintegrasi dengan Active Directory, yang memberi kami alasan untuk meyakini bahwa kami mengetahui alamat IP pengontrol domain.  Selanjutnya, menggunakan utilitas nslookup dalam mode interaktif, kami mencoba untuk mendapatkan daftar semua host di zona corp.local: <br><br>  <i>&gt; ls â€“d corp.local&gt; file</i> <br><br>  Bahkan, perintah ini memulai transfer zona DNS penuh, menyimpannya ke file.  Banyak administrator lupa untuk menetapkan batasan pada transfer zona untuk jaringan internal, yang membuatnya lebih mudah bagi penyerang potensial untuk mengumpulkan informasi tentang infrastruktur perusahaan, untuk lebih jelasnya lihat [12]. <br><br>  <b>Hasil.</b>  Sukses  Transfer zona tanpa perlindungan memberi kami daftar lengkap nama host internal, termasuk server, dan alamat IP mereka.  Menggunakan utilitas nbtstat, telnet, serta salah satu pemindai kerentanan umum, penyerang dapat mengumpulkan informasi tentang platform, menjalankan layanan, versi OS pada host yang menarik baginya. <br><br><h4>  Langkah 1. Mendapatkan hak administrator lokal </h4><br>  <b>Teori</b>  Untuk mendapatkan kata sandi administrator lokal, serangan diterapkan pada nilai hash kata sandi ini yang disimpan dalam registri sistem.  Terlepas dari kenyataan bahwa fungsi hash tidak dapat diubah secara matematis, perhitungan kata sandi dimungkinkan dengan penghitungan langsung nilai-nilainya bersama dengan serangan kamus.  Windows secara historis menggunakan dua algoritma untuk menghitung fungsi hash kata sandi: algoritma legacy LM dan algoritma NT yang lebih baru (kadang-kadang juga disebut NTLM).  Fungsi hash LM rentan karena kompleksitas komputasinya yang rendah, yang memungkinkan untuk menghitung nilainya bahkan pada komputer yang lemah.  Kehadiran hash kata sandi LM dan NT dalam sistem registry memastikan bahwa penyerang dapat memecahkannya dalam jumlah waktu yang dapat diterima.  Nilai hash LM pada pengaturan default disimpan dalam registri Windows XP / 2003, yang membuat sistem ini sangat menarik bagi peretas.  Fungsi hash NT secara komputasi lebih kompleks, namun, menghitung nilai-nilainya sangat disederhanakan oleh fakta bahwa ada tabel nilai pra-dihitung tersedia (disebut tabel Rainbow) untuk itu - mereka mengurangi perhitungan nilai hash untuk mencari hash yang diinginkan di antara nilai yang dihitung sebelumnya. <br><br>  <b>Obyek serangan.</b>  Hash kata sandi dalam database SAM (registri).  Dalam kasus kami, ini semua mesin yang kami miliki akses fisiknya.  Pertama-tama, ini adalah desktop kerja kami, dan kedua, host untuk melakukan tes. <br><br>  <b>Implementasi.</b>  Dengan mesin yang memiliki akses fisik, kami melakukan operasi berikut: boot dari media eksternal (menggunakan CD Lingkungan Pra-instalasi Windows atau Linux Live CD), pasang partisi sistem NTFS dan salin cabang registry HKLM \ SYSTEM dan HKLM \ SAM (% file WINDIR % \ System32 \ Config \ System dan% WINDIR masing-masing% \ System32 \ Config \ Sam).  Kami memberikan perhatian khusus pada mesin yang menjalankan Windows XP \ Windows 2003, yang kemungkinan akan ditemukan hash LM.  Untuk membuang kata sandi dari file registri yang disalin, kami menggunakan alat [1], [2] (semua tautan di akhir artikel).  Hasil: <br><br><img src="https://habrastorage.org/webt/kn/jq/wm/knjqwm1nlf7ljjd99ndwh60bngg.png" alt="gambar"><br><br>  Baris terakhir berisi hash NT yang diperlukan dari administrator lokal.  Pada host dari lab uji (sebut host ini LAB1 dan LAB2) kami menemukan hash LM yang tidak nol: <br><br><img src="https://habrastorage.org/webt/sz/wi/30/szwi30d1cje8gsfkiok70xtnuyy.png" alt="gambar"><br><br><img src="https://habrastorage.org/webt/1j/g5/l-/1jg5l-dgphti0eayxdcozs-onts.png" alt="gambar"><br><br>  Jadi, kami mendapat hash NT dan LM.  Tetapi bagaimana cara memulihkan kata sandi dari mereka?  Untuk melakukan ini, kita akan menggunakan alat yang sama [1], [2] serta layanan membalikkan hash online [8] - [11]: <br><br><img src="https://habrastorage.org/webt/qx/dk/70/qxdk70sdc94zqcuzmxkavjeu4tg.png" alt="gambar"><br><br>  Catatan: kata sandi asli terdiri dari nama perusahaan dengan pengubah kecil dan cepat rusak di bawah serangan kamus). <br><br>  <b>Hasil.</b>  Sukses  Kata sandi (biarlah "Pa $$ word1" dan "Pa $$ word2") dari akun administrator lokal dari desktop kami yang berfungsi dan dua komputer uji telah diterima.  Tetapi apakah mereka akan membantu mendapatkan hak administrator domain?  Tentang itu lebih jauh. <br><br><h4>  Langkah 2. Mendapatkan kredensial administrator domain </h4><br>  <b>Teori</b>  Dalam kebanyakan kasus, itu sudah cukup untuk mendapatkan nilai hash NT dari kata sandi untuk administrator domain.  Hal ini disebabkan oleh fakta bahwa ketika pengguna diverifikasi menggunakan protokol NTLM, sistem yang diautentikasi hanya menyajikan hash NT ke autentikator, dan verifikasi kata sandi tidak terjadi.  Hash NT dapat diperoleh dari apa yang disebut  Penyimpanan LSA dengan merujuk pada apa yang disebut  Administrator Logon Sessions (sesi Logon adalah area data khusus yang dibuat oleh proses Winlogon di mana nama pengguna, domain login, dan nilai hash kata sandi NT disimpan, secara kolektif, ini disebut LSA-secret).  Hash NT ini digunakan oleh proses NTLMSSP untuk otentikasi NTLM.  Sesi masuk disimpan sepanjang waktu saat akun masuk ke sistem.  Anda juga dapat mencegat hash NT dari sesi otentikasi administrator NTLM.  Selain itu, mendapatkan kata sandi administrator dimungkinkan dari cache Domain Cached Credentials (DCC).  DCC adalah cache lokal yang terisi ketika pengguna berhasil masuk ke domain.  Tujuan dari cache DCC adalah untuk dapat mengotentikasi pengguna ketika pengontrol domain tidak tersedia. <br><br>  <b>Objek Serangan:</b> <br><br><ul><li>  Hash DCC (cabang registry HKLM \ Security). </li><li>  Sesi Logon Administrator Domain (LSA-secret). </li><li>  Intersepsi sesi NTLM (tidak dianggap karena kompleksitas praktis yang lebih besar). </li></ul><br>  <b>Berlatih.</b>  Banyak administrator Windows menggunakan akun administrator domain untuk melakukan berbagai jenis operasi pada komputer pengguna.  Pada saat yang sama, datanya jatuh ke dalam cache DCC.  Karena itu, cobalah dulu untuk mendapatkan kata sandi dari cache DCC.  Kami pergi ke workstation kami, menyimpan cabang registry HKLM \ Security dan mengimpornya ke [1].  Karena  kami memiliki kata sandi administrator lokal, kami tidak perlu lagi mem-boot mesin dari media eksternal untuk menyimpan registri: <br><br><img src="https://habrastorage.org/webt/up/6p/v3/up6pv3qirtuto8wcxfk6lkofkqq.png" alt="gambar"><br><br>  Cache berisi data kata sandi dari tiga akun.  Akun terakhir (pengguna ***) tidak menarik bagi kami, akun kedua tidak memiliki hak istimewa yang diperlukan, tetapi shadmin pengguna tampak seperti administrator yang Anda cari.  Sayangnya, algoritma MS-CACHE2 memiliki kompleksitas komputasi yang besar dan serangan brute force langsung tidak efisien.  Fungsi MS-CACHEv2 berisi "rahasia komputasi" - garam (nama akun digunakan sebagai "garam"), yang membuatnya terlindung dari serangan pada tabel Rainbow.  Namun, di masa mendatang, tabel nilai hash dapat muncul untuk akun standar - â€œAdministratorâ€, â€œAdministratorâ€, dll.  Demi kepentingan, kami mengirimkan "cache hash" yang ditemukan ke layanan cloud [8] - [11] (tentang hasil dan efektivitas layanan tersebut di akhir artikel).  Sementara cloud sedang berpikir, kami berusaha menemukan DCC lainnya.  Kami menganalisis daftar host yang diperoleh pada langkah 0, memeriksa server mana yang dapat kami akses di bawah administrator lokal menggunakan kata sandi yang diperoleh pada langkah 1. Karena, pada pengontrol domain, administrator lokal diblokir, dan server email biasanya terlindungi dengan lebih baik, Anda perlu bereksperimen dengan server sekunder.  Dalam kasus kami, server dengan nama Pembaruan yang tidak mencolok ditemukan di daftar server.  Login dengan kata sandi "Pa $$ word2" yang ditemukan di langkah 1 berhasil.  Kami menemukan itu di host Upd: <br><br><ol><li>  Tidak ada perangkat lunak antivirus yang diinstal. </li><li>  Ini menjalankan Apache, yang merupakan server manajemen untuk antivirus korporat (ini berarti ada juga kata sandi untuk akun yang digunakan untuk menginstal perangkat lunak anti-virus dari jarak jauh dan, secara teoritis, Anda bisa mengeluarkannya dari sana). </li><li>  Tuan rumah tidak mengaudit upaya login yang gagal. </li><li>  Versi OS - Windows 2008 R2. </li></ol><br>  Setelah membuang registri HKLM \ Security, kami mendapatkan hash DCC dari akun CORP.LOCAL \ Administrator (dan beberapa lainnya): <br><br><img src="https://habrastorage.org/webt/a5/3t/--/a53t--0v2fycjxm29xiytiqri3g.png" alt="gambar"><br><br>  Secara teoritis, Anda dapat mencoba menemukan kata sandi untuk Administrator melalui layanan cloud.  Namun, seperti yang saya sebutkan di atas, serangan brute force pada MS-CACHEv2 tidak berguna (walaupun ada kemungkinan bahwa dalam beberapa tahun situasinya akan berubah).  Biarkan DCC sendiri dan beralih ke mencari sesi Logon.  Periksa pengguna mana yang masuk ke host Upd: <br><br><img src="https://habrastorage.org/webt/57/ri/fa/57rifa8peyelwyvtbw6d4nwrofu.png" alt="gambar"><br><br>  Kita melihat bahwa dua sesi tidak aktif tergantung pada mesin Upd - administrator dan pengguna Shadmin, sudah akrab bagi kita, yang berarti kita bisa mendapatkan hash NT dari kata sandi mereka dengan mencuri rahasia LSA.  Ini adalah kunci untuk menentukan keberhasilan seluruh serangan.  Untuk mencuri hash, gunakan exploit Lslsass [3].  Untuk menjalankannya, Anda memerlukan hak administrator lokal (atau lebih tepatnya, hak untuk proses debug), yang sudah kami miliki.  Kami mendapatkan daftar rahasia LSA (dalam format "domain \ akun: LM hash: NT hash :::"): <br><br><pre><code class="hljs pgsql">lslsass v1<span class="hljs-number"><span class="hljs-number">.0</span></span> - Copyright (C) <span class="hljs-number"><span class="hljs-number">2010</span></span> Bjorn Brolin, Truesec (www.truesec.com) <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> Lsass pid: <span class="hljs-number"><span class="hljs-number">520</span></span> Lsass process <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token UPD\Administrator::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>:&lt;i&gt;<span class="hljs-number"><span class="hljs-number">8833</span></span>c58febc977799520e7536bb2011e&lt;/i&gt;::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token UPD\Administrator::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>:<span class="hljs-number"><span class="hljs-number">8833</span></span>c58febc977799520e7536bb2011e::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token UPD\Administrator::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>:<span class="hljs-number"><span class="hljs-number">8833</span></span>c58febc977799520e7536bb2011e::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token CORP.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span>\UPD$::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>:<span class="hljs-number"><span class="hljs-number">68987</span></span>a0fb5529dbf99d5eac3bfce773b::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token CORP.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> \UPD$::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>:<span class="hljs-number"><span class="hljs-number">68987</span></span>a0fb5529dbf99d5eac3bfce773b::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token CORP.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> \UPD$::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>:<span class="hljs-number"><span class="hljs-number">68987</span></span>a0fb5529dbf99d5eac3bfce773b::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token CORP.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> \Administrator::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>: &lt;b&gt; c690e441dc78bc5da8b389e78daa6392 &lt;/b&gt;::: <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> token <span class="hljs-built_in"><span class="hljs-built_in">Found</span></span> <span class="hljs-type"><span class="hljs-type">real</span></span> token CORP.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> \shadmin::<span class="hljs-number"><span class="hljs-number">00000000000000000000000000000000</span></span>: &lt;b&gt; <span class="hljs-number"><span class="hljs-number">5794</span></span>cba8b464364eacf366063ff70e78 &lt;/b&gt; :::</code> </pre> <br>  Garis-garis yang disorot oleh huruf tebal berisi hash kata sandi yang diperlukan.  Perhatikan juga hash dalam huruf miring di baris keenam.  Kami sudah melihatnya di suatu tempat, kan? <br><br>  <b>Hasil.</b>  Sukses  Kami memiliki hash kata sandi NT dari akun administrator domain di tangan kami.  Tetapi apa gunanya hash jika mengembalikan kata sandi asli darinya dalam waktu yang dapat diterima tidak mungkin?  Tentang ini di langkah selanjutnya. <br><br><h4>  Langkah 3. Curang Sesi Otentikasi NTLM </h4><br>  <b>Teori</b>  Windows tidak pernah menggunakan kata sandi murni untuk otentikasi, sistem terotentikasi selalu menyajikan hash.  Ini memunculkan ide: mengganti nama pengguna, domain login, dan hash NT dalam sesi Logon pengguna login dengan nilai-nilai administrator domain yang sesuai, kita dapat mengotentikasi menggunakan protokol NTLM sebelum sistem jarak jauh sebagai administrator domain.  Serangan ini [7] hanya dimungkinkan dengan otentikasi menggunakan protokol NTLM.  Terlepas dari meluasnya penggunaan protokol Kerberos, NTLM adalah satu-satunya cara yang mungkin untuk mengautentikasi klien ketika mengakses berbagi jaringan bukan dengan nama simbolis, tetapi dengan alamat IP [13]. <br><br>  <b>Obyek serangan.</b>  Sesi masuk dari administrator lokal. <br><br>  <b>Berlatih.</b>  Ada beberapa eksploit yang tersedia yang memungkinkan Anda untuk menerapkan serangan pada platform Windows Server 2008 x86 dan x64.  Eksploitasi utama adalah Windows Credentials Editor [4].  Untuk melakukan serangan, kita pergi ke host LAB2 menggunakan kredensial "Administrator" \ "Pa $$ word2".  Dengan menggunakan [4], kami mengganti nama akun, domain login, dan data hash NT di sesi Logon dengan nilai Shadmin yang sesuai yang kami peroleh pada langkah sebelumnya: <br><br><img src="https://habrastorage.org/webt/ww/kp/hc/wwkphcbxcv5fjhsrlk_1ydcakze.png" alt="gambar"><br><br>  Nama akun administrator domain dan hash NT dilewatkan ke perintah wce sebagai argumen dari baris perintah.  Hasil - hash berhasil diubah.  Saya perhatikan bahwa keanggotaan pengguna dalam grup dan token akses tidak berubah selama serangan: <br><br><img src="https://habrastorage.org/webt/jg/jn/ym/jgjnymw3o3j8yv9cfd1sjojagbe.png" alt="gambar"><br><br>  Kami masih Administrator lokal, nama host berwarna hijau di screenshot di atas diolesi dengan hijau - LAB2.  Namun, selama otentikasi NTLM, sistem jarak jauh akan disajikan dengan nama domain CORP.LOCAL, nama pengguna Shadmin, dan hash kata sandi Shadmin.  Berikut ini adalah dump paket jaringan tunggal yang berisi sesi gumpalan keamanan NTLM: <br><br><img src="https://habrastorage.org/webt/tt/c7/_x/ttc7_xrvp9e81zvathjqultz5sc.png" alt="gambar"><br><br>  Nama domain (CORP.LOCAL) dan nama host (LAB2) berwarna abu-abu hijau), sebuah akun disajikan - Shadmin.  Sekarang kami mencoba untuk menyambung ke partisi root volume sistem pada pengontrol domain dengan perintah net use menggunakan alamat IP pengontrol domain: <br><br><img src="https://habrastorage.org/webt/ja/ga/2h/jaga2h8xrnj_wbn5acv-fe6zlqs.png" alt="gambar"><br><br>  Berhasil.  Untuk memverifikasi akses, saya membuat file teks di root (temukan di screenshot).  Setelah membuat file batch pada disk pengendali domain dengan urutan perintah yang kita butuhkan, kita dapat, menggunakan [5], melakukan operasi yang diperlukan pada kontroler domain (misalnya, menambahkan pengguna ke grup administrator domain).  Operasi akan dilakukan dengan hak akun Shadmin.  Untuk mengilustrasikan, buat file batch sederhana pada host jarak jauh yang menambahkan pengguna lokal: <br><br>  <i>pengguna bersih TstUsr Pa $$ kata / tambahkan</i> <br><br>  Jalankan dari jarak jauh dari host LAB2: <br><br><img src="https://habrastorage.org/webt/q3/3l/qf/q33lqf4cb4u9rw8zwqpcfpwhw-c.png" alt="gambar"><br><br>  Ini akan dieksekusi pada sistem jarak jauh 192.168.13.125 dengan hak istimewa pengguna sesi kami saat ini - shadmin (mis., Administrator domain).  Kami memeriksa: <br><br><img src="https://habrastorage.org/webt/cq/oj/wp/cqojwpt8bb1c0volgimww9gsv-c.png" alt="gambar"><br><br>  Output kedua dari perintah net user menunjukkan pengguna baru.  Meskipun tidak mungkin meluncurkan aplikasi yang membutuhkan interaksi pengguna interaktif dengan cara ini (misalnya, snap-in MMC), berbagai tindakan dapat dilakukan dengan menggunakan skrip. <br><br>  <b>Hasil.</b>  Sukses  Memperoleh akses ke sistem file dan shell dari kontroler domain. <br><br><h4>  Ringkasan </h4><br>  Secara singkat, rantai serangan tampak sebagai berikut: Mengumpulkan informasi tentang struktur jaringan -&gt; Memperoleh kata sandi administrator lokal -&gt; Menggunakan kata sandi ini untuk masuk ke salah satu server sekunder -&gt; Pencurian kredensial administrator domain "dibiarkan tanpa pengawasan" -&gt; Memodifikasi sesi Logon Anda dan eskalasi hak istimewa. <br><br>  Keberhasilan serangan itu difasilitasi oleh: <br><br><ol><li>  Lemahnya perlindungan zona DNS dari transfer ke host yang tidak terpercaya. </li><li>  Kebijakan kata sandi yang lemah.  Sebagian besar komputer domain menggunakan kata sandi yang sama untuk akun administrator lokal, yang rentan terhadap serangan kamus. </li><li>  Tidak adanya atau lemahnya konfigurasi perangkat lunak antivirus pada host kritis. </li><li>  Lemah perlindungan hash kata sandi - dua sesi Logon administrator tidak aktif pada host Upd, hash LM dalam database SAM. </li><li>  Kebijakan audit yang buruk. </li></ol><br><br>  Berdasarkan hal ini, rekomendasi perlindungan umum dapat diturunkan: <br><br>  0. Menyembunyikan struktur internal jaringan dari penyerang potensial.  Jadi, pengguna seharusnya tidak bisa mendapatkan konten lengkap dari file zona DNS.  Pengguna yang tidak tepercaya (misalnya, trainee, karyawan yang belum menyelesaikan masa percobaan mereka, dll.) Masuk akal untuk mentransfer mereka ke subnet terpisah menggunakan NAT ke alamat palsu (termasuk, misalnya, memodifikasi jawaban DNS). <br><br>  1. Kebijakan yang benar untuk menetapkan kata sandi ke administrator lokal.  Kata sandi administrator lokal harus berbeda pada host yang memiliki tingkat perlindungan berbeda terhadap akses tidak sah.  Mengompromikan kata sandi administrator lokal pada sembarang host domain harus meminimalkan kemungkinan penyerang menggunakan kata sandi ini. <br><br>  2. Penyimpanan hash LM di SAM harus dilarang oleh kebijakan keamanan. <br><br>  3. Jangan menggunakan nama perusahaan atau domainnya sebagai bagian dari kata sandi administrator) Ini akan mempersulit penyerang untuk menyerang kamus.  Tetapi bahkan dengan menggunakan kata sandi yang kompleks, jangan lupakan diri Anda dan secara teratur memeriksa hash-nya untuk daya tahan menggunakan layanan online. <br><br>  4. Tidak dianjurkan untuk melakukan operasi rutin pada komputer domain dari bawah akun administrator domain.  Ini akan melindungi akun dari mencegat data sesi Logon dan dari memasukkan hash kata sandi ke dalam cache DCC. <br><br>  5. Buat aturan untuk tidak meninggalkan sesi masuk administrator domain tanpa pengawasan.  Praktik terbaik: pekerjaan selesai - logout. <br><br>  6. Utilitas spoofing LSA cukup kecil.  Masuk akal untuk melacak evolusi mereka dan memverifikasi keberhasilan deteksi mereka dengan perangkat lunak antivirus perusahaan. <br><br>  7. Seorang pengguna, bahkan dengan hak administrator lokal, seharusnya tidak dapat mengubah pengaturan antivirus perusahaan.  Mematikan layanan antivirus di workstation domain harus menghasilkan pemberitahuan kepada administrator domain (dalam hal ini, Symantec Endpoint Protection bekerja dengan baik selama pengujian). <br><br><h4>  Lampiran 1. Perilaku antivirus </h4><br>  Komputer perusahaan menggunakan tiga jenis antivirus: KAV, saat ini pada saat tes Symantec Endpoint Protection, dan produk usang dari Trend Micro.  Dalam kebanyakan kasus, alat yang digunakan selama serangan diidentifikasi sebagai Hack Tool / Rootkit / Trojan.  KAV menghapusnya tanpa peringatan, dan SEP (bahkan dimatikan) mengeluarkan peringatan dan memindahkannya ke karantina untuk mencegahnya dimulai.  Namun, memiliki hak administrator lokal memungkinkan Anda untuk menonaktifkan KAV, dan perlindungan SEP dilewati dengan secara manual mengatur jalur pengecualian untuk verifikasi, lagi-lagi menggunakan akun administrator lokal.  Antivirus dari Trend Micro yang diinstal pada beberapa host tidak bereaksi dengan cara apa pun terhadap peluncuran eksploit. <br><br><h4>  Tambahan 2. Efisiensi menggunakan layanan verifikasi hash online </h4><br>  Ada banyak layanan online yang tersedia untuk menguji kekuatan hash kata sandi.  Mereka memungkinkan Anda untuk bekerja dengan hash yang paling umum - LM, NTLM, MD4, MD5, WPA, dengan hash menggunakan garam, dll.  Untuk memeriksa hash, enumerasi langsung digunakan menggunakan kekuatan pemrosesan GPU modern, enumerasi kamus, serangan hibrid, dll.  Setelah dibuka, hash dapat mengisi ulang database dan digunakan di masa depan.  Layanan ini dapat bebas untuk memeriksa kata sandi pendek (kurang dari 8 karakter) atau mengambil sedikit biaya.  Selama pengujian saya menggunakan empat layanan seperti itu, tautan diberikan di akhir artikel.  Saya mengirim beberapa hash yang ditemukan di langkah 2 dan setelah 15 bulan menerima pemberitahuan dari layanan Hash Crack On-line [9] tentang keberhasilan pemulihan salah satunya) <br><br><h4>  Referensi </h4><br>  <b>Alat bekas</b> <br><br>  [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cain &amp; Abel</a> - alat pemulihan kata sandi untuk Sistem Operasi Microsoft.  Ini memungkinkan pemulihan yang mudah dari beberapa jenis kata sandi dengan mengendus jaringan, memecahkan kata sandi terenkripsi menggunakan Kamus, Brute-Force dan serangan Cryptanalysis, merekam percakapan VoIP, men-decoding kata sandi yang diacak, memulihkan kunci jaringan nirkabel, membuka kotak kata sandi, membuka kata sandi yang di-cache dan menganalisa rute. protokol. <br>  [2] L0pht Crack. <br>  [3] Eksploitasi Lslsass.  Membuang hash kata sandi sesi masuk aktif dari proses lsass. <br>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Editor Kredensial Windows</a> pasca eksploitasi.  Alat untuk mengubah kredensial masuk. <br>  [5] PsExec dari PS Tools <br><br>  <b>Deskripsi Kerentanan Terperinci</b> <br><br>  [6] Seri artikel "Secara Efektif Memperoleh Hash Kata Sandi di Windows" di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.securitylab.ru</a> <br>  [7] Pass-the-Hash, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">deskripsi serangan</a> pada sistem jarak jauh dengan memberinya hash yang dikompromikan. <br><br>  <b>Layanan Peretasan Cloud Hash</b> <br>  [8] Pertanyaan-defense.com (tampaknya rusak pada saat publikasi () <br>  [9] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.onlinehashcrack.com</a> <br>  [10] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.cloudcracker.com</a> <br>  [11] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pembunuh hash online</a> <br><br>  <b>Bahan tambahan</b> <br><br>  [12] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Keamanan dan penyetelan DNS di Windows Server</a> <br>  [13] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kerberos tidak digunakan saat Anda terhubung ke saham SMB dengan menggunakan alamat IP</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id423937/">https://habr.com/ru/post/id423937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id423925/index.html">Buka webinar "Templat rekursif aneh"</a></li>
<li><a href="../id423927/index.html">10 mesin pencari yang menjanjikan untuk meningkatkan SEO</a></li>
<li><a href="../id423931/index.html">Bagaimana cara memotong otentikasi SMS saat menghubungkan ke jaringan Wi-Fi publik?</a></li>
<li><a href="../id423933/index.html">Keamanan Microsoft Office: Objek Tertanam</a></li>
<li><a href="../id423935/index.html">Embox menjawab pertanyaan populer dari festival IT TechTrain</a></li>
<li><a href="../id423939/index.html">Pemrograman Dinamis atau Divide and Conquer</a></li>
<li><a href="../id423941/index.html">Laporan dari iOS mitap Redmadrobot</a></li>
<li><a href="../id423943/index.html">Pengoptimalan harga eceran offline</a></li>
<li><a href="../id423945/index.html">Mahkamah Agung menetapkan prosedur untuk mempertimbangkan kasus-kasus dengan repost dan suka</a></li>
<li><a href="../id423947/index.html">Data pribadi kami tidak dikenakan biaya apa pun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>