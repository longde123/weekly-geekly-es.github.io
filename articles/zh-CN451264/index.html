<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âš±ï¸ ğŸ¤œğŸ½ ğŸ¤½ğŸ¿ ELKçš„å®é™…åº”ç”¨ã€‚ é…ç½®logstash â© ğŸ’…ğŸ» ğŸµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 éƒ¨ç½²ä¸‹ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œéœ€è¦å¤„ç†å¤§é‡çš„å„ç§æ—¥å¿—ã€‚ ä½œä¸ºå·¥å…·é€‰æ‹©äº†ELKã€‚ æœ¬æ–‡å°†è®¨è®ºæˆ‘ä»¬åœ¨è°ƒæ•´æ­¤å †æ ˆæ–¹é¢çš„ç»éªŒã€‚ 

 æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾å®šä¸€ä¸ªæè¿°å…¶æ‰€æœ‰å¯èƒ½æ€§çš„ç›®æ ‡ï¼Œä½†æˆ‘ä»¬æƒ³ä¸“æ³¨äºè§£å†³å®é™…é—®é¢˜ã€‚ è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šå­˜åœ¨å¤§é‡çš„æ–‡æ¡£å’Œç°æˆçš„å›¾åƒï¼Œå­˜åœ¨å¾ˆå¤šé™·é˜±ï¼Œè‡³å°‘æˆ‘ä»¬å‘ç°äº†è¿™äº›é™·é˜±ã€‚ 

 æˆ‘ä»¬é€šè¿‡do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ELKçš„å®é™…åº”ç”¨ã€‚ é…ç½®logstash</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451264/"><h1> å¼•è¨€ </h1><br> éƒ¨ç½²ä¸‹ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œéœ€è¦å¤„ç†å¤§é‡çš„å„ç§æ—¥å¿—ã€‚ ä½œä¸ºå·¥å…·é€‰æ‹©äº†ELKã€‚ æœ¬æ–‡å°†è®¨è®ºæˆ‘ä»¬åœ¨è°ƒæ•´æ­¤å †æ ˆæ–¹é¢çš„ç»éªŒã€‚ <br><br> æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾å®šä¸€ä¸ªæè¿°å…¶æ‰€æœ‰å¯èƒ½æ€§çš„ç›®æ ‡ï¼Œä½†æˆ‘ä»¬æƒ³ä¸“æ³¨äºè§£å†³å®é™…é—®é¢˜ã€‚ è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šå­˜åœ¨å¤§é‡çš„æ–‡æ¡£å’Œç°æˆçš„å›¾åƒï¼Œå­˜åœ¨å¾ˆå¤šé™·é˜±ï¼Œè‡³å°‘æˆ‘ä»¬å‘ç°äº†è¿™äº›é™·é˜±ã€‚ <br><a name="habracut"></a><br> æˆ‘ä»¬é€šè¿‡docker-composeéƒ¨ç½²äº†å †æ ˆã€‚ è€Œä¸”ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå†™å¾—å¾ˆå¥½çš„docker-compose.ymlï¼Œå®ƒä½¿æˆ‘ä»¬å‡ ä¹æ²¡æœ‰é—®é¢˜åœ°æå‡äº†å †æ ˆã€‚ å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œèƒœåˆ©ä¼¼ä¹å·²ç»è¿«åœ¨çœ‰ç«ï¼Œç°åœ¨æˆ‘ä»¬å°†ç¨ä½œè°ƒæ•´ä»¥é€‚åº”æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä»…æ­¤è€Œå·²ã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼Œå°è¯•è°ƒæ•´ç³»ç»Ÿä»¥ä»æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ¥æ”¶å’Œå¤„ç†æ—¥å¿—çš„å°è¯•å¹¶æœªè·å¾—æˆåŠŸã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºå€¼å¾—åˆ†åˆ«ç ”ç©¶æ¯ä¸ªç»„ä»¶ï¼Œç„¶åè¿”å›å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬ä»logstashå¼€å§‹ã€‚ <br><br><h1> ç¯å¢ƒï¼Œéƒ¨ç½²ï¼Œåœ¨å®¹å™¨ä¸­å¯åŠ¨Logstash </h1><br> ä¸ºäº†è¿›è¡Œéƒ¨ç½²ï¼Œæˆ‘ä»¬ä½¿ç”¨docker-composeï¼Œæ­¤å¤„æè¿°çš„å®éªŒæ˜¯åœ¨MacOSå’ŒUbuntu 18.0.4ä¸Šè¿›è¡Œçš„ã€‚ <br><br> åœ¨åŸå§‹docker-compose.ymlä¸­å‘æˆ‘ä»¬æ³¨å†Œçš„logstashæ˜ åƒæ˜¯docker.elastic.co/logstash/logstash:6.3.2 <br><br> æˆ‘ä»¬å°†å…¶ç”¨äºå®éªŒã€‚ <br><br> ä¸ºäº†è¿è¡Œlogstashï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå•ç‹¬çš„docker-compose.ymlã€‚ å½“ç„¶ï¼Œå¯ä»¥ä»å‘½ä»¤è¡Œå¯åŠ¨æ˜ åƒï¼Œä½†æ˜¯æˆ‘ä»¬ç¡®å®è§£å†³äº†ä¸€ä¸ªç‰¹å®šçš„é—®é¢˜ï¼Œå…¶ä¸­å¯åŠ¨äº†docker-composeä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ <br><br><h2> ç®€è¦ä»‹ç»é…ç½®æ–‡ä»¶ </h2><br> ä»æè¿°ä¸­å¯ä»¥çœ‹å‡ºï¼Œlogstashå¯ä»¥åœ¨ä¸€ä¸ªé€šé“ä¸­è¿è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒéœ€è¦ä¼ è¾“* .confæ–‡ä»¶ï¼Œæˆ–è€…åœ¨å¤šä¸ªé€šé“ä¸­è¿è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒéœ€è¦ä¼ è¾“pipelines.ymlæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åˆå°†é“¾æ¥åˆ°æ–‡ä»¶.confæ¯ä¸ªé¢‘é“ã€‚ <br> æˆ‘ä»¬èµ°äº†ç¬¬äºŒæ¡è·¯ã€‚ åœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œå®ƒä¼¼ä¹æ›´å…·é€šç”¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†pipelines.ymlï¼Œå¹¶åˆ›å»ºäº†pipelinesç›®å½•ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ”¾ç½®æ¯ä¸ªé€šé“çš„.confæ–‡ä»¶ã€‚ <br><br> å®¹å™¨å†…è¿˜æœ‰å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶-logstash.ymlã€‚ æˆ‘ä»¬ä¸è§¦æ‘¸å®ƒï¼Œè€Œæ˜¯æŒ‰åŸæ ·ä½¿ç”¨å®ƒã€‚ <br><br> å› æ­¤ï¼Œç›®å½•çš„ç»“æ„ä¸ºï¼š <br><br><img src="https://habrastorage.org/webt/ci/zd/49/cizd49eci9alvlbi1fwk8nyyaky.png"><br><br> ä¸ºäº†è·å¾—è¾“å…¥ï¼Œç›®å‰ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒæ˜¯ç«¯å£5046ä¸Šçš„tcpï¼Œå¯¹äºè¾“å‡ºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨stdoutã€‚ <br><br> è¿™æ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶çš„ç®€å•é…ç½®ã€‚ ç”±äºåˆå§‹ä»»åŠ¡æ˜¯å¯åŠ¨ã€‚ <br><br> æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ‰äº†è¿™ä¸ªdocker-compose.yml <br><br><pre><code class="plaintext hljs">version: '3' networks: elk: volumes: elasticsearch: driver: local services: logstash: container_name: logstash_one_channel image: docker.elastic.co/logstash/logstash:6.3.2 networks: - elk ports: - 5046:5046 volumes: - ./config/pipelines.yml:/usr/share/logstash/config/pipelines.yml:ro - ./config/pipelines:/usr/share/logstash/config/pipelines:ro</code> </pre> <br> æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°ä»€ä¹ˆï¼Ÿ <br><br><ol><li> ç½‘ç»œå’Œå·å–è‡ªåŸå§‹çš„docker-compose.ymlï¼ˆå¯åŠ¨æ•´ä¸ªå †æ ˆçš„é‚£ä¸ªï¼‰ï¼Œæˆ‘è®¤ä¸ºå®ƒä»¬ä¸ä¼šæ˜¾ç€å½±å“æ­¤å¤„çš„æ•´ä½“æƒ…å†µã€‚ </li><li> æˆ‘ä»¬ä»docker.elastic.co/logstash/logstash:6.3.2æ˜ åƒåˆ›å»ºä¸€ä¸ªlogstashæœåŠ¡ï¼Œå¹¶å°†å…¶å‘½åä¸ºlogstash_one_channelã€‚ </li><li> æˆ‘ä»¬å°†å®¹å™¨å†…çš„ç«¯å£5046è½¬å‘åˆ°ç›¸åŒçš„å†…éƒ¨ç«¯å£ã€‚ </li><li> æˆ‘ä»¬å°†é€šé“è®¾ç½®æ–‡ä»¶./config/pipelines.ymlæ˜ å°„åˆ°å®¹å™¨å†…çš„æ–‡ä»¶/usr/share/logstash/config/pipelines.ymlä¸­ï¼Œlogstashå°†åœ¨å…¶ä¸­å°†å…¶é€‰ä¸­å¹¶è®¾ä¸ºåªè¯»ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚ </li><li> åœ¨/ usr / share / logstash / config / pipelinesç›®å½•ä¸­ï¼Œæˆ‘ä»¬æ˜¾ç¤º./config/pipelinesç›®å½•ï¼Œå…¶ä¸­åŒ…å«é€šé“è®¾ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ä¹Ÿå°†å…¶è®¾ç½®ä¸ºåªè¯»ã€‚ </li></ol><br><img src="https://habrastorage.org/webt/5u/s3/dw/5us3dwu8forutzwmtlfnlcjt-ic.png"><br><br>  Pipelines.ymlæ–‡ä»¶ <br><br><pre> <code class="plaintext hljs">- pipeline.id: HABR pipeline.workers: 1 pipeline.batch.size: 1 path.config: "./config/pipelines/habr_pipeline.conf"</code> </pre><br> åœ¨æ­¤ï¼Œå°†æè¿°å…·æœ‰HABRæ ‡è¯†ç¬¦çš„ä¸€ä¸ªé€šé“åŠå…¶é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚ <br><br> æœ€åæ˜¯æ–‡ä»¶â€œ ./config/pipelines/habr_pipeline.confâ€ <br><br><pre> <code class="plaintext hljs">input { tcp { port =&gt; "5046" } } filter { mutate { add_field =&gt; [ "habra_field", "Hello Habr" ] } } output { stdout { } }</code> </pre><br> ç°åœ¨è®©æˆ‘ä»¬ä¸è¿›å…¥ä»–çš„æè¿°ï¼Œå°è¯•è¿è¡Œï¼š <br><br><pre> <code class="bash hljs">docker-compose up</code> </pre><br> æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ <br><br> å®¹å™¨å¯åŠ¨ã€‚ æˆ‘ä»¬å¯ä»¥æ£€æŸ¥å…¶æ“ä½œï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'13123123123123123123123213123213'</span></span> | nc localhost 5046</code> </pre><br> æˆ‘ä»¬åœ¨å®¹å™¨æ§åˆ¶å°ä¸­çœ‹åˆ°äº†ç­”æ¡ˆï¼š <br><br><img src="https://habrastorage.org/webt/uj/oy/tz/ujoytzcsc_mmiagm05savxahnzm.jpeg"><br><br> ä½†åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜çœ‹åˆ°ï¼š <br><br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š28ï¼š59,790] <font color="Â«CC0000Â»">[é”™è¯¯] [logstash.licensechecker.licensereader]æ— æ³•ä»è®¸å¯è¯æœåŠ¡å™¨è·å–è®¸å¯è¯ä¿¡æ¯{ï¼šmessage =&gt;â€œ Elasticsearch Unreachableï¼š[httpï¼š// elasticsearchï¼š9200 /]</font> [Manticore :: ResolutionFailure] elasticsearchâ€œï¼Œ... <br><br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š28ï¼š59,894] [INFO] [logstash.pipeline] <font color="green">ç®¡é“å·²æˆåŠŸå¯åŠ¨</font> {ï¼špipeline_id =&gt;â€œã€‚Monitoring-logstashâ€ ,: thread =&gt;â€œï¼ƒ&lt;Threadï¼š0x119abb86 run&gt;â€} <br><br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š28ï¼š59,988] [INFO] [logstash.agent]æ­£åœ¨è¿è¡Œçš„ç®¡é“{ï¼šcount =&gt; 2 ,: running_pipelines =&gt; [ï¼šHABR ,:â€œã€‚Monitoring-logstashâ€] ,: non_running_pipelines =&gt; [ ]} <br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š29ï¼š00,015] <font color="Â«CC0000Â»">[é”™è¯¯] [logstash.inputs.metrics] X-Packå·²å®‰è£…åœ¨Logstashä¸Šï¼Œä½†æœªå®‰è£…åœ¨Elasticsearchä¸Šã€‚</font>  <font color="Â«CC0000Â»">è¯·åœ¨Elasticsearchä¸Šå®‰è£…X-Packä»¥ä½¿ç”¨ç›‘è§†åŠŸèƒ½ã€‚</font>  <font color="Â«CC0000Â»">å…¶ä»–åŠŸèƒ½å¯èƒ½å¯ç”¨ã€‚</font> <br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š29ï¼š00,526] [INFO] [logstash.agent]å·²æˆåŠŸå¯åŠ¨Logstash APIç«¯ç‚¹{ï¼šport =&gt; 9600} <br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š29ï¼š04,478] [INFO] [logstash.outputs.elasticsearch]è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä»¥æŸ¥çœ‹Elasticsearchè¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ{ï¼šhealthcheck_url =&gt; httpï¼š// elasticsearchï¼š9200 / ,: path =&gt; â€œ /â€} <br>  l <font color="Â«#38B9C7Â»">ogstash_one_channel |</font>  [2019-04-29T11ï¼š29ï¼š04,487] <font color="orange">[WARN] [logstash.outputs.elasticsearch]è¯•å›¾æ¢å¤ä¸æ­»æ‰çš„ESå®ä¾‹çš„è¿æ¥ï¼Œä½†å‡ºç°é”™è¯¯ã€‚</font>  <font color="orange">{ï¼šurl =&gt;â€œ elasticsearchï¼š9200 /â€ ,: error_type =&gt; LogStash ::è¾“å‡º:: ElasticSearch :: HttpClient :: Pool :: HostUnreachableError ,: error =&gt;â€œ Elasticsearch Unreachableï¼š[httpï¼š// elasticsearchï¼š9200 / ] [Manticore :: ResolutionFailure] elasticsearchâ€}</font> <br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š29ï¼š04,704] [INFO] [logstash.licensechecker.licensereader]è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä»¥æŸ¥çœ‹Elasticsearchè¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ{ï¼šhealthcheck_url =&gt; httpï¼š// elasticsearchï¼š9200 / ,: path =&gt; â€œ /â€} <br>  <font color="Â«#38B9C7Â»">logstash_one_channel |</font>  [2019-04-29T11ï¼š29ï¼š04,710] <font color="orange">[WARN] [logstash.licensechecker.licensereader]è¯•å›¾æ¢å¤ä¸æ­»æ‰çš„ESå®ä¾‹çš„è¿æ¥ï¼Œä½†å‡ºç°é”™è¯¯ã€‚</font>  <font color="orange">{ï¼šurl =&gt;â€œ elasticsearchï¼š9200 /â€ ,: error_type =&gt; LogStash ::è¾“å‡º:: ElasticSearch :: HttpClient :: Pool :: HostUnreachableError ,: error =&gt;â€œ Elasticsearch Unreachableï¼š[httpï¼š// elasticsearchï¼š9200 / ] [Manticore :: ResolutionFailure] elasticsearchâ€}</font> <br><br> è€Œä¸”æˆ‘ä»¬çš„æ—¥å¿—ä¸€ç›´åœ¨çˆ¬ã€‚ <br><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¥ç»¿è‰²çªå‡ºæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨ç¤ºç®¡é“å·²æˆåŠŸå¯åŠ¨ï¼Œçº¢è‰²ï¼ˆä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œé»„è‰²ï¼‰ä¸€æ¡æœ‰å…³å°è¯•è”ç³»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">elasticsearch</a>çš„æ¶ˆæ¯ï¼š9200ã€‚ <br> å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºå›¾åƒä¸­åŒ…å«çš„logstash.confä¼šæ£€æŸ¥Elasticsearchçš„å¯ç”¨æ€§ã€‚ æ¯•ç«Ÿï¼Œlogstashå‡å®šå®ƒæ˜¯Elkå †æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶åˆ†å¼€ã€‚ <br><br> æ‚¨å¯ä»¥å·¥ä½œï¼Œä½†ä¸æ–¹ä¾¿ã€‚ <br><br> è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡XPACK_MONITORING_ENABLEDç¯å¢ƒå˜é‡ç¦ç”¨æ­¤æ£€æŸ¥ã€‚ <br><br> å¯¹docker-compose.ymlè¿›è¡Œæ›´æ”¹ï¼Œç„¶åå†æ¬¡è¿è¡Œï¼š <br><br><pre> <code class="plaintext hljs">version: '3' networks: elk: volumes: elasticsearch: driver: local services: logstash: container_name: logstash_one_channel image: docker.elastic.co/logstash/logstash:6.3.2 networks: - elk environment: XPACK_MONITORING_ENABLED: "false" ports: - 5046:5046 volumes: - ./config/pipelines.yml:/usr/share/logstash/config/pipelines.yml:ro - ./config/pipelines:/usr/share/logstash/config/pipelines:ro</code> </pre><br> ç°åœ¨ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ å®¹å™¨å·²å‡†å¤‡å¥½è¿›è¡Œå®éªŒã€‚ <br><br> æˆ‘ä»¬å¯ä»¥å†æ¬¡è¾“å…¥ä¸‹ä¸€ä¸ªæ§åˆ¶å°ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'13123123123123123123123213123213'</span></span> | nc localhost 5046</code> </pre><br> å¹¶æŸ¥çœ‹ï¼š <br><br><pre> <code class="plaintext hljs">logstash_one_channel | { logstash_one_channel | "message" =&gt; "13123123123123123123123213123213", logstash_one_channel | "@timestamp" =&gt; 2019-04-29T11:43:44.582Z, logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "host" =&gt; "gateway", logstash_one_channel | "port" =&gt; 49418 logstash_one_channel | }</code> </pre><br><h1> åœ¨ä¸€ä¸ªæ¸ é“å†…å·¥ä½œ </h1><br> å› æ­¤ï¼Œæˆ‘ä»¬å¼€å§‹äº†ã€‚ ç°åœ¨ï¼Œæ‚¨å®é™…ä¸Šå¯ä»¥èŠ±æ—¶é—´ç›´æ¥é…ç½®logstashã€‚ æˆ‘ä»¬æš‚æ—¶ä¸ä¼šè§¦æ‘¸pipelines.ymlæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä½¿ç”¨ä¸€ä¸ªé€šé“å¯ä»¥å¾—åˆ°ä»€ä¹ˆã€‚ <br><br> æˆ‘å¿…é¡»è¯´ï¼Œåœ¨å®˜æ–¹æŒ‡å—ä¸­å¯¹ä½¿ç”¨é€šé“é…ç½®æ–‡ä»¶çš„ä¸€èˆ¬åŸç†è¿›è¡Œäº†å¾ˆå¥½çš„è¯´æ˜ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a> <br> å¦‚æœæ‚¨æƒ³ç”¨ä¿„è¯­é˜…è¯»ï¼Œé‚£ä¹ˆæˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>ä½¿ç”¨äº†è¿™ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a> ï¼ˆä½†æ˜¯æŸ¥è¯¢è¯­æ³•åœ¨é‚£é‡Œå¤ªæ—§äº†ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼‰ã€‚ <br><br> è®©æˆ‘ä»¬ä¾æ¬¡ä»â€œè¾“å…¥â€éƒ¨åˆ†å¼€å§‹ã€‚ æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æœ‰å…³tcpçš„å·¥ä½œã€‚ è¿™é‡Œè¿˜æœ‰ä»€ä¹ˆæœ‰è¶£çš„ï¼Ÿ <br><br><h2> ä½¿ç”¨å¿ƒè·³æµ‹è¯•æ¶ˆæ¯ </h2><br> äº§ç”Ÿè‡ªåŠ¨æµ‹è¯•æ¶ˆæ¯çš„æœºä¼šéå¸¸æœ‰è¶£ã€‚ <br> ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨è¾“å…¥éƒ¨åˆ†ä¸­åŒ…å«heartbeanæ’ä»¶ã€‚ <br><br><pre> <code class="plaintext hljs">input { heartbeat { message =&gt; "HeartBeat!" } }</code> </pre><br> æ‰“å¼€ï¼Œæ¯åˆ†é’Ÿå¯åŠ¨ä¸€æ¬¡å³å¯æ¥æ”¶ <br><br><pre> <code class="plaintext hljs">logstash_one_channel | { logstash_one_channel | "@timestamp" =&gt; 2019-04-29T13:52:04.567Z, logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "message" =&gt; "HeartBeat!", logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "host" =&gt; "a0667e5c57ec" logstash_one_channel | }</code> </pre><br> æˆ‘ä»¬å¸Œæœ›å¾—åˆ°æ›´å¤šçš„é¢‘ç‡ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ intervalå‚æ•°ã€‚ <br> è¿™æ˜¯æˆ‘ä»¬æ¯10ç§’ä¼šæ”¶åˆ°ä¸€æ¡æ¶ˆæ¯çš„æ–¹å¼ã€‚ <br><br><pre> <code class="plaintext hljs">input { heartbeat { message =&gt; "HeartBeat!" interval =&gt; 10 } }</code> </pre><br><h2> ä»æ–‡ä»¶ä¸­æ£€ç´¢æ•°æ® </h2><br> æˆ‘ä»¬è¿˜å†³å®šæŸ¥çœ‹æ–‡ä»¶æ¨¡å¼ã€‚ å¦‚æœè¯¥æ–‡ä»¶å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œåˆ™å¯èƒ½è‡³å°‘åœ¨æœ¬åœ°ä½¿ç”¨æ—¶ä¸éœ€è¦ä»£ç†ã€‚ <br><br> æ ¹æ®æè¿°ï¼Œæ“ä½œæ¨¡å¼åº”ç±»ä¼¼äºtail -fï¼Œå³ã€‚ è¯»å–æ¢è¡Œç¬¦ï¼Œæˆ–è€…ä½œä¸ºä¸€ä¸ªé€‰æ‹©ï¼Œè¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚ <br><br> æ‰€ä»¥æˆ‘ä»¬æƒ³è¦å¾—åˆ°ï¼š <br><br><ol><li> æˆ‘ä»¬æƒ³è¦è·å–é™„åŠ åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶çš„è¡Œã€‚ </li><li> æˆ‘ä»¬å¸Œæœ›æ¥æ”¶å†™å…¥å¤šä¸ªæ—¥å¿—æ–‡ä»¶çš„æ•°æ®ï¼ŒåŒæ—¶èƒ½å¤Ÿå…±äº«æ•°æ®æ¥æºã€‚ </li><li> æˆ‘ä»¬è¦æ£€æŸ¥çš„æ˜¯ï¼Œé‡æ–°å¯åŠ¨logstashæ—¶ï¼Œå®ƒå°†ä¸ä¼šå†æ¬¡æ”¶åˆ°æ­¤æ•°æ®ã€‚ </li><li> æˆ‘ä»¬è¦æ£€æŸ¥æ˜¯å¦ç¦ç”¨äº†logstashï¼Œå¹¶ä¸”æ•°æ®ç»§ç»­å†™å…¥æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨è¿è¡Œå®ƒæ—¶ï¼Œæˆ‘ä»¬å°†è·å¾—æ­¤æ•°æ®ã€‚ </li></ol><br> è¦è¿›è¡Œå®éªŒï¼Œè¯·åœ¨docker-compose.ymlä¸­æ·»åŠ å¦ä¸€è¡Œï¼Œä»¥æ‰“å¼€ç”¨äºæ”¾ç½®æ–‡ä»¶çš„ç›®å½•ã€‚ <br><br><pre> <code class="plaintext hljs">version: '3' networks: elk: volumes: elasticsearch: driver: local services: logstash: container_name: logstash_one_channel image: docker.elastic.co/logstash/logstash:6.3.2 networks: - elk environment: XPACK_MONITORING_ENABLED: "false" ports: - 5046:5046 volumes: - ./config/pipelines.yml:/usr/share/logstash/config/pipelines.yml:ro - ./config/pipelines:/usr/share/logstash/config/pipelines:ro - ./logs:/usr/share/logstash/input</code> </pre><br> å¹¶åœ¨habr_pipeline.confä¸­æ›´æ”¹è¾“å…¥éƒ¨åˆ† <br><br><pre> <code class="plaintext hljs">input { file { path =&gt; "/usr/share/logstash/input/*.log" } }</code> </pre><br> æˆ‘ä»¬å¼€å§‹ï¼š <br><br><pre> <code class="bash hljs">docker-compose up</code> </pre><br> è¦åˆ›å»ºå’Œè®°å½•æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span> &gt;&gt; logs/number1.log</code> </pre><br><pre> <code class="plaintext hljs">{ logstash_one_channel | "host" =&gt; "ac2d4e3ef70f", logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "@timestamp" =&gt; 2019-04-29T14:28:53.876Z, logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "message" =&gt; "1", logstash_one_channel | "path" =&gt; "/usr/share/logstash/input/number1.log" logstash_one_channel | }</code> </pre><br> æ˜¯çš„ï¼Œå®ƒæœ‰æ•ˆï¼ <br><br> åŒæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬è‡ªåŠ¨æ·»åŠ äº†è·¯å¾„å­—æ®µã€‚ å› æ­¤ï¼Œå°†æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒè¿‡æ»¤è®°å½•ã€‚ <br><br> è®©æˆ‘ä»¬å†è¯•ä¸€æ¬¡ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span> &gt;&gt; logs/number1.log</code> </pre><br><pre> <code class="plaintext hljs">{ logstash_one_channel | "host" =&gt; "ac2d4e3ef70f", logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "@timestamp" =&gt; 2019-04-29T14:28:59.906Z, logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "message" =&gt; "2", logstash_one_channel | "path" =&gt; "/usr/share/logstash/input/number1.log" logstash_one_channel | }</code> </pre><br><br> ç°åœ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼š <br><br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span> &gt;&gt; logs/number2.log</code> </pre><br><pre> <code class="plaintext hljs">{ logstash_one_channel | "host" =&gt; "ac2d4e3ef70f", logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "@timestamp" =&gt; 2019-04-29T14:29:26.061Z, logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "message" =&gt; "1", logstash_one_channel | "path" =&gt; "/usr/share/logstash/input/number2.log" logstash_one_channel | }</code> </pre><br> å¤ªå¥½äº†ï¼ æ–‡ä»¶è¢«æ‹¾å–ï¼Œè·¯å¾„æ­£ç¡®ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ <br><br> åœæ­¢logstashå¹¶é‡æ–°å¯åŠ¨ã€‚ ç­‰ä¸€ä¸‹ æ²‰é»˜ã€‚ å³ æˆ‘ä»¬ä¸ä¼šå†æ”¶åˆ°è¿™äº›è®°å½•ã€‚ <br><br> ç°åœ¨æ˜¯æœ€å¤§èƒ†çš„å®éªŒã€‚ <br><br> æˆ‘ä»¬æ”¾å…¥logstashå¹¶æ‰§è¡Œï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'3'</span></span> &gt;&gt; logs/number2.log <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'4'</span></span> &gt;&gt; logs/number1.log</code> </pre><br> å†æ¬¡è¿è¡Œlogstashï¼Œè¯·å‚é˜…ï¼š <br><br><pre> <code class="plaintext hljs">logstash_one_channel | { logstash_one_channel | "host" =&gt; "ac2d4e3ef70f", logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "message" =&gt; "3", logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "path" =&gt; "/usr/share/logstash/input/number2.log", logstash_one_channel | "@timestamp" =&gt; 2019-04-29T14:48:50.589Z logstash_one_channel | } logstash_one_channel | { logstash_one_channel | "host" =&gt; "ac2d4e3ef70f", logstash_one_channel | "habra_field" =&gt; "Hello Habr", logstash_one_channel | "message" =&gt; "4", logstash_one_channel | "@version" =&gt; "1", logstash_one_channel | "path" =&gt; "/usr/share/logstash/input/number1.log", logstash_one_channel | "@timestamp" =&gt; 2019-04-29T14:48:50.856Z logstash_one_channel | }</code> </pre><br> ä¸‡å²ï¼ ä¸€åˆ‡éƒ½æ¡äº†ã€‚ <br><br> ä½†æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»è­¦å‘Šä»¥ä¸‹å†…å®¹ã€‚ å¦‚æœåˆ é™¤äº†å¸¦æœ‰logstashçš„å®¹å™¨ï¼ˆdocker stop logstash_one_channel &amp;&amp; docker rm logstash_one_channelï¼‰ï¼Œåˆ™å°†ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œã€‚ åœ¨å®¹å™¨å†…éƒ¨ï¼Œä¿å­˜äº†è¯»å–æ–‡ä»¶çš„ä½ç½®ã€‚ å¦‚æœä»å¤´å¼€å§‹ï¼Œå®ƒå°†ä»…æ¥å—æ¢è¡Œã€‚ <br><br><h3> è¯»å–ç°æœ‰æ–‡ä»¶ </h3><br> å‡è®¾æˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œlogstashï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æœ‰äº†æ—¥å¿—ï¼Œæˆ‘ä»¬æƒ³å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ <br> å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢ä½¿ç”¨çš„è¾“å…¥éƒ¨åˆ†æ¥è¿è¡Œlogstashï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¸€æ— æ‰€è·ã€‚ ä»…æ¢è¡Œç¬¦å°†ç”±logstashå¤„ç†ã€‚ <br><br> ä¸ºäº†ä»ç°æœ‰æ–‡ä»¶ä¸­æå–è¡Œï¼Œè¯·åœ¨è¾“å…¥éƒ¨åˆ†æ·»åŠ å¦ä¸€è¡Œï¼š <br><br><pre> <code class="plaintext hljs">input { file { start_position =&gt; "beginning" path =&gt; "/usr/share/logstash/input/*.log" } }</code> </pre><br> è€Œä¸”ï¼Œæœ‰ä¸€ä¸ªç»†å¾®å·®åˆ«ï¼Œè¿™åªä¼šå½±å“logstashå°šæœªçœ‹åˆ°çš„æ–°æ–‡ä»¶ã€‚ å¯¹äºå·²ç»è½å…¥logstashè§†é‡ä¸­çš„ç›¸åŒæ–‡ä»¶ï¼Œä»–å·²ç»è®°ä½äº†å®ƒä»¬çš„å¤§å°ï¼Œç°åœ¨åªåœ¨å…¶ä¸­æ·»åŠ æ–°æ¡ç›®ã€‚ <br><br> è®©æˆ‘ä»¬ä¸“æ³¨äºè¾“å…¥éƒ¨åˆ†çš„ç ”ç©¶ã€‚ è¿˜æœ‰æ›´å¤šé€‰æ‹©ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œç°åœ¨è¿›è¡Œè¿›ä¸€æ­¥çš„å®éªŒå°±è¶³å¤Ÿäº†ã€‚ <br><br><h2> è·¯ç”±å’Œæ•°æ®è½¬æ¢ </h2><br> è®©æˆ‘ä»¬å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå‡è®¾æˆ‘ä»¬ä»ä¸€ä¸ªæ¸ é“æ”¶åˆ°æ¶ˆæ¯ï¼Œå…¶ä¸­ä¸€äº›æ˜¯å‚è€ƒæ¶ˆæ¯ï¼Œéƒ¨åˆ†æ˜¯é”™è¯¯æ¶ˆæ¯ã€‚ æ ‡ç­¾ä¸åŒã€‚ ä¸€äº›ä¿¡æ¯ï¼Œå…¶ä»–é”™è¯¯ã€‚ <br><br> æˆ‘ä»¬éœ€è¦åœ¨è¾“å‡ºå¤„å°†å®ƒä»¬åˆ†å¼€ã€‚ å³ æˆ‘ä»¬åœ¨ä¸€ä¸ªé€šé“ä¸­ç¼–å†™å‚è€ƒæ¶ˆæ¯ï¼Œè€Œåœ¨å¦ä¸€é€šé“ä¸­ç¼–å†™é”™è¯¯æ¶ˆæ¯ã€‚ <br><br> ä¸ºæ­¤ï¼Œè¯·ä»è¾“å…¥éƒ¨åˆ†è½¬åˆ°è¿‡æ»¤å™¨å¹¶è¾“å‡ºã€‚ <br><br> ä½¿ç”¨è¿‡æ»¤å™¨éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†è§£æä¼ å…¥çš„æ¶ˆæ¯ï¼Œä»ä¸­è·å–å“ˆå¸Œï¼ˆé”®å€¼å¯¹ï¼‰ï¼Œæ‚¨å·²ç»å¯ä»¥ä½¿ç”¨å®ƒï¼Œå³ æ ¹æ®æ¡ä»¶æ‹†å¸ã€‚ åœ¨è¾“å‡ºéƒ¨åˆ†ï¼Œæˆ‘ä»¬é€‰æ‹©æ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°æˆ‘ä»¬çš„é¢‘é“ã€‚ <br><br><h3> ä½¿ç”¨grokè§£ææ¶ˆæ¯ </h3><br> ä¸ºäº†è§£ææ–‡æœ¬å­—ç¬¦ä¸²å¹¶ä»ä¸­è·å–ä¸€ç»„å­—æ®µï¼Œè¿‡æ»¤å™¨éƒ¨åˆ†ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ’ä»¶-grokã€‚ <br><br> æˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œç»™å‡ºè¯¦ç»†è¯´æ˜ï¼ˆä¸ºæ­¤ï¼Œæˆ‘å‚è€ƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a> ï¼‰ï¼Œæˆ‘å°†ç»™å‡ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚ <br><br> ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ç¡®å®šè¾“å…¥è¡Œçš„æ ¼å¼ã€‚ æˆ‘æœ‰å®ƒä»¬ï¼š <br><br>  1æ¡ä¿¡æ¯æ¶ˆæ¯1 <br>  2é”™è¯¯æ¶ˆæ¯2 <br><br> å³ æ ‡è¯†ç¬¦é¦–å…ˆå‡ºç°ï¼Œç„¶åæ˜¯INFO / ERRORï¼Œç„¶åæ˜¯ä¸€äº›æ²¡æœ‰ç©ºæ ¼çš„å•è¯ã€‚ <br> ä¸éš¾ï¼Œä½†è¶³ä»¥ç†è§£å…¶å·¥ä½œåŸç†ã€‚ <br><br> å› æ­¤ï¼Œåœ¨è¿‡æ»¤å™¨éƒ¨åˆ†çš„grokæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ç§æ¨¡å¼æ¥è§£æè¡Œã€‚ <br><br> å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="plaintext hljs">filter { grok { match =&gt; { "message" =&gt; ["%{INT:message_id} %{LOGLEVEL:message_type} %{WORD:message_text}"] } } }</code> </pre><br> è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ ä½¿ç”¨ç°æˆçš„æ¨¡å¼ï¼Œä¾‹å¦‚INTï¼ŒLOGLEVELï¼ŒWORDã€‚ å®ƒä»¬çš„æè¿°ä»¥åŠå…¶ä»–æ¨¡å¼å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>æ‰¾åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a> <br><br> ç°åœ¨ï¼Œé€šè¿‡æ­¤è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬çš„å­—ç¬¦ä¸²å°†å˜æˆä¸‰ä¸ªå­—æ®µçš„å“ˆå¸Œï¼šmessage_idï¼Œmessage_typeï¼Œmessage_textã€‚ <br><br> å®ƒä»¬å°†æ˜¾ç¤ºåœ¨è¾“å‡ºéƒ¨åˆ†ã€‚ <br><br><h3> ä½¿ç”¨ifå‘½ä»¤åœ¨è¾“å‡ºéƒ¨åˆ†ä¸­è·¯ç”±æ¶ˆæ¯ </h3><br> æˆ‘ä»¬è®°å¾—åœ¨è¾“å‡ºéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ¶ˆæ¯åˆ†æˆä¸¤ä¸ªæµã€‚ æœ‰äº›-iNFOï¼Œæˆ‘ä»¬å°†è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œæˆ‘ä»¬å°†è¾“å‡ºåˆ°æ–‡ä»¶ã€‚ <br><br> æˆ‘ä»¬å¦‚ä½•æ‹†åˆ†è¿™äº›èŒä½ï¼Ÿ é—®é¢˜çš„çŠ¶å†µå·²ç»æç¤ºè§£å†³æ–¹æ¡ˆ-æˆ‘ä»¬å·²ç»é€‰æ‹©äº†message_typeå­—æ®µï¼Œè¯¥å­—æ®µåªèƒ½ä½¿ç”¨ä¸¤ä¸ªå€¼INFOå’ŒERRORã€‚ å¯¹äºä»–æ¥è¯´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ifè¯­å¥è¿›è¡Œé€‰æ‹©ã€‚ <br><br><pre> <code class="plaintext hljs">if [message_type] == "ERROR" { #     } else { #    stdout }</code> </pre><br> æœ‰å…³ä½¿ç”¨å­—æ®µå’Œè¿ç®—ç¬¦çš„è¯´æ˜ï¼Œå¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ‰‹å†Œçš„</a>æ­¤éƒ¨åˆ†ä¸­æ‰¾åˆ°ã€‚ <br><br> ç°åœ¨ï¼Œå…³äºå®é™…ç»“è®ºæœ¬èº«ã€‚ <br><br> è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸€åˆ‡éƒ½åœ¨è¿™é‡Œæ¸…æ¥šäº†-stdout {} <br><br> è¿™æ˜¯æ–‡ä»¶çš„è¾“å‡º-è¯·è®°ä½ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä»å®¹å™¨è¿è¡Œæ‰€æœ‰æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥ä»å¤–éƒ¨è®¿é—®å†™å…¥ç»“æœçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨docker-compose.ymlä¸­æ‰“å¼€æ­¤ç›®å½•ã€‚ <br><br> æ€»è®¡ï¼š <br><br> æ–‡ä»¶çš„è¾“å‡ºéƒ¨åˆ†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="plaintext hljs"> output { if [message_type] == "ERROR" { file { path =&gt; "/usr/share/logstash/output/test.log" codec =&gt; line { format =&gt; "custom format: %{message}"} } } else {stdout { } } }</code> </pre><br> åœ¨docker-compose.ymlä¸­æ·»åŠ å¦ä¸€ä¸ªå·ä»¥è¾“å‡ºï¼š <br><br><pre> <code class="plaintext hljs">version: '3' networks: elk: volumes: elasticsearch: driver: local services: logstash: container_name: logstash_one_channel image: docker.elastic.co/logstash/logstash:6.3.2 networks: - elk environment: XPACK_MONITORING_ENABLED: "false" ports: - 5046:5046 volumes: - ./config/pipelines.yml:/usr/share/logstash/config/pipelines.yml:ro - ./config/pipelines:/usr/share/logstash/config/pipelines:ro - ./logs:/usr/share/logstash/input - ./output:/usr/share/logstash/output</code> </pre><br> æˆ‘ä»¬å¼€å§‹ï¼Œå°è¯•ï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ†æˆä¸¤ä¸ªæµç¨‹ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN451264/">https://habr.com/ru/post/zh-CN451264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN451252/index.html">Pythonä¸­çš„å­—ç¬¦ä¸²æ˜¯å¦åº”è¯¥å¯è¿­ä»£ï¼Ÿ</a></li>
<li><a href="../zh-CN451254/index.html">ç±»åˆ«ï¼šæ‹†ç®±é“IaaSæä¾›å•†</a></li>
<li><a href="../zh-CN451256/index.html">ä»€ä¹ˆæ˜¯ç†æƒ³çš„æŠ¥å‘Šç³»ç»Ÿã€‚ äº†è§£å…¬å¸æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…æ˜¯å¦ç°å®ï¼Ÿ</a></li>
<li><a href="../zh-CN451258/index.html">å¦‚æœå¯ä»¥çš„è¯ï¼Œèµ¶ä¸Šæˆ‘ã€‚ ç»ç†æ¥ä¿¡</a></li>
<li><a href="../zh-CN451260/index.html">ITMOå¤§å­¦çš„10ä¸ªä¸»é¢˜æ´»åŠ¨</a></li>
<li><a href="../zh-CN451266/index.html">ç°ä»£ä¸–ç•Œä¸­çš„ä¸‰ç»´å»ºæ¨¡</a></li>
<li><a href="../zh-CN451268/index.html">Victor Gamovåœ¨jug.msk.ruä¸Šä»‹ç»Kafka Streams IQ</a></li>
<li><a href="../zh-CN451270/index.html">B =æ³¨æ„ï¼Œæˆ–å¦‚ä½•åˆ›é€ æ—¶é—´</a></li>
<li><a href="../zh-CN451272/index.html">å¦‚æœæ‚¨å·²ç»æ•²é—¨ï¼šå¦‚ä½•ä¿æŠ¤è®¾å¤‡ä¸Šçš„ä¿¡æ¯</a></li>
<li><a href="../zh-CN451274/index.html">å®Œç¾æ­¦å™¨ï¼Œè§†è§’ä¹‹æˆ˜å’Œäººç±»ç™»ä¸Šå¤©èŠ±æ¿</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>