<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏻 🚛 🎵 Winnti：对供应链的攻击-亚洲游戏开发商处在最前沿 💟 🚴🏼 🗓️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这不是攻击者第一次攻击游戏产业，损害开发人员，在游戏的构建环境中添加后门，然后以合法的名义伪装分发恶意软件。 2013年4月，卡巴斯基实验室报告了类似事件。 该攻击归因于一个名为Winnti的网络组织。 

 最近，ESET专家被对供应链的新攻击所吸引。 两款游戏和一个游戏平台被入侵以引入后门。 这...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Winnti：对供应链的攻击-亚洲游戏开发商处在最前沿</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/443416/">这不是攻击者第一次攻击游戏产业，损害开发人员，在游戏的构建环境中添加后门，然后以合法的名义伪装分发恶意软件。  2013年4月，卡巴斯基实验室<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">报告</a>了类似事件。 该攻击归因于一个名为Winnti的网络组织。 <br><br> 最近，ESET专家被对供应链的新攻击所吸引。 两款游戏和一个游戏平台被入侵以引入后门。 这些攻击针对亚洲和游戏行业，而Winnti再次落后于他们。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/da/mm/9k/damm9kh-fnuiccaivkprl3kc9w0.jpeg"></div><a name="habracut"></a><br><h2> 三箱一箱 </h2><br> 尽管恶意软件配置不同，但三个受感染的软件产品包含相同的后门代码，并开始使用相同的机制。 现在，有两种产品没有后门程序，但其中一种仍以木马版本分发-具有讽刺意味的是，此游戏称为Infestation，由泰国公司Extreme Extreme发行。 自2月初以来，我们一直在尝试与开发人员联系，但到目前为止仍无济于事。 <br><br> 我们将分析恶意负载的引入方式，然后详细考虑后门。 <br><br><h4> 有效载荷实施 </h4> <br> 有效负载代码在木马可执行文件执行期间运行。 在PE入口点之后，立即拦截标准C运行时初始化调用（下图中的<code>__scrt_common_main_seh</code> ）以启动恶意有效负载（图2）。 这可能表明攻击者更改了程序集配置，而不是源代码本身。 <br><br><img src="https://habrastorage.org/webt/9x/5t/_z/9x5t_zr__dskzxeisuvum2z4at4.png"><br><br>  <i>图1.可执行文件的净入口点</i> <br><br><img src="https://habrastorage.org/webt/rc/ow/c5/rcowc5sx8hx2mi0our57vhagmea.png"><br><br>  <i>图2.受损可执行文件的入口点</i> <br><br> 在恢复C运行时初始化代码和后续主机应用程序代码的正常执行之前，添加到可执行文件中的代码将解密并启动RAM中的后门。 内置的有效负载具有特殊的结构，如下图所示，由添加的解压缩代码解释。 <br><br><img src="https://habrastorage.org/webt/uh/cc/_l/uhcc_l8yhoevfiwi71sfvm0fqrw.png"><br><br>  <i>图3.嵌入式有效负载结构</i> <br><br> 它包含RC4密钥（使用0x37加密的XOR），用于解密文件名和嵌入式DLL文件。 <br><br><h2> 恶意负载 </h2><br> 实际的恶意有效负载仅包含17 KB的代码和数据。 <br><br><h4> 构型 </h4><br> 下图所示的配置数据是由空格分隔的行的列表。 <br><br><img src="https://habrastorage.org/webt/07/xa/fk/07xafkyspktcwa2ladwz-yqx1aq.png"><br><br>  <i>图4.有效负载配置数据</i> <br><br> 该配置包含四个字段： <br><br><ol><li> 管理C＆C服务器的URL。 </li><li> 变量（t）用于确定超时（以毫秒为单位），然后继续。 等待时间在2/3至5/3 t的范围内随机选择。 </li><li> 标识广告系列的行。 </li><li> 可执行文件名称列表，以分号分隔。 如果其中任何一个有效，则后门将停止其执行。 </li></ol><br> 我们确定了有效载荷的五个版本： <br><br><img src="https://habrastorage.org/webt/9h/ni/mi/9hnimigerpgsvcibhsz67pzmtdy.png"><br><br> 在前三个选项中，未重新编译代码，但是在DLL文件本身中编辑了配置数据。 其余内容是字节副本。 <br><br><h4>  C＆C基础架构 </h4><br> 域名的选择应类似于受感染应用程序的开发人员的站点。 顶级域配置为使用Namecheap服务重定向到相应的合法站点，而子域指向恶意C＆C服务器。 <br><br><img src="https://habrastorage.org/webt/es/hi/ha/eshihaiupa4riqbqhjva7x3zy0u.png"><br><br> 在撰写本文时，所有域均不可用，C和C服务器未响应。 <br><br><h4> 研究报告 </h4><br> 机器人ID是从计算机的MAC地址生成的。 后门将机器信息（包括用户名，计算机名称，Windows版本和系统语言）传输到C＆C服务器，然后等待命令。 使用密钥“ <code>*&amp;b0i0rong2Y7un1</code> ”使用XOR加密数据，并使用base64进行编码。 从C＆C服务器接收的数据使用相同的密钥加密。 <br><br><h4> 队伍 </h4><br> 一个简单的后门仅支持攻击者可以使用的四个团队： <br><br>  <code>DownUrlFile</code> <br>  <code>DownRunUrlFile</code> <br>  <code>RunUrlBinInMem</code> <br>  - <code>UnInstall</code> <br><br> 球队的名字不言自明。 它们使攻击者可以从给定URL运行其他可执行文件。 <br><br> 也许最后一个命令不太明显。  <code>UnInstall</code>不会从系统中删除恶意软件。 最后，它将被嵌入仍可运行的合法可执行文件中。 该命令不是删除某些内容，而是通过将注册表项的值设置为1来禁用恶意代码： <br><br> <code>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ImageFlag</code> <br> <br> 启动有效负载后，将请求注册表中的值，并且如果指定了执行，将取消执行。 也许攻击者正试图通过避免没有兴趣的受害人回叫来减少C＆C服务器的负载。 <br><br><h2> 第二阶段 </h2><br> 根据遥测，发送给受害者的第二阶段有效载荷之一是Win64 / Winnti.BN。 据我们所知，该恶意软件的<code>api.goallbandungtravel[.]com</code>是通过HTTPs从<code>api.goallbandungtravel[.]com</code> 。 我们看到它使用以下文件名作为Windows服务和DLL安装在<code>C:\Windows\System32</code> ： <br><br>  -cscsrv.dll <br>  -dwmsvc.dll <br>  -iassrv.dll <br>  -mprsvc.dll <br>  -nlasrv.dll <br>  -powfsvc.dll <br>  -racsvc.dll <br>  -slcsvc.dll <br>  -snmpsvc.dll <br>  -sspisvc.dll <br><br> 我们分析的样本足够大-大约60 MB。 但是，这只是可见性，因为实际的大小或PE文件的大小从63到72 KB（取决于版本）。 许多干净的文件仅被添加到恶意文件中。 这很可能是由重置并安装恶意服务的组件完成的。 <br><br> 启动服务后，它将<code>.mui</code>扩展名添加到其DLL <code>.mui</code> ，并使用RC5对其进行解密。 解密的MUI文件包含偏移量为0的与位置无关的代码。RC5密钥是从硬盘的序列号和“ <code>f@Ukd!rCto R$.</code> ”行<code>f@Ukd!rCto R$.</code>  ” 我们无法获取MUI文件或首先安装它们的代码。 因此，恶意服务的确切目的对我们来说是未知的。 <br><br> 最新的恶意软件版本包括使用C＆C服务器<code>http://checkin.travelsanignacio[.]com</code>的自动更新机制。 该服务器提供了使用RC5静态密钥加密的MUI文件的最新版本。 在我们的研究过程中，此C＆C服务器没有响应。 <br><br><h2> 目标 </h2><br> 让我们从那些<b>没有</b>专门针对广告系列的人开始。 在有效负载开始时，恶意软件会检查系统语言是俄语还是中文（请参见下图）。 如果答案是肯定的，该程序将停止工作。 不可能解决此异常-攻击者从根本上对具有这些语言设置的计算机不感兴趣。 <br><br><img src="https://habrastorage.org/webt/dg/p8/tg/dgp8tgq_fhjjewczstuavcsgo34.png"><br><br>  <i>图5.在启动有效负载之前检查语言</i> <br><br><h4> 分布统计 </h4><br> 根据遥测，大多数感染发生在亚洲，尤其是泰国。 鉴于受侵害的应用程序仍由开发人员分发，因此该应用程序很受欢迎，如果受害者的数量达到数十万，也就不足为奇了。 <br><br><img src="https://habrastorage.org/webt/65/pl/fn/65plfnqbnt3lm1rvbmtt60vwo_c.png"><br><br><h2> 结论 </h2><br> 供应链攻击很难在用户端检测到。 无法分析所有正在运行的软件以及所有建议的更新。 默认情况下，用户信任开发人员，并假定他们的文件不包含恶意代码。 这可能就是为什么几个网络组织针对软件供应商发起攻击的原因-妥协将允许创建一个僵尸网络，其规模可与特洛伊木马软件的流行程度相提并论。 这种策略有一个缺点-揭露该方案后，攻击者将失去对僵尸网络的控制，用户将能够通过安装下一个更新来清理系统。 <br><br>  Winnti网络小组的动机目前未知。 攻击者可能正在寻求经济利益，或计划将僵尸网络用作较大规模行动的一部分。 <br><br>  <i>ESET产品将威胁检测为Win32 / HackedApp.Winnti.A，Win32 / HackedApp.Winnti.B，有效负载为Win32 / Winnti.AG，第二阶段为Win64 / Winnti.BN。</i> <i><br><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>提供了危害指标。</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443416/">https://habr.com/ru/post/zh-CN443416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443404/index.html">NASA寻找地球外文明的新目标：技术标志</a></li>
<li><a href="../zh-CN443406/index.html">在C ++中使用多线程时的前20个错误及其避免方法</a></li>
<li><a href="../zh-CN443408/index.html">光子，量子和Fock状态：利用射频谐振器进行量子级操纵</a></li>
<li><a href="../zh-CN443412/index.html">为什么尽管精简的Python程序员仍继续使用冗长的Java</a></li>
<li><a href="../zh-CN443414/index.html">路标：断点不足时</a></li>
<li><a href="../zh-CN443418/index.html">软件测试方法</a></li>
<li><a href="../zh-CN443422/index.html">MySQL（JSON）中的灵活数据存储</a></li>
<li><a href="../zh-CN443424/index.html">将用于初级前端的测试用例重写为TypeScript并做出反应</a></li>
<li><a href="../zh-CN443426/index.html">污点-OpenShift如何使用SELinux防范容器漏洞</a></li>
<li><a href="../zh-CN443428/index.html">Oculus Rift的“父亲” Palmer Lucky正在为五角大楼开发虚拟战场系统</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>