<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôéÔ∏è üë©üèΩ‚Äç‚öñÔ∏è üòñ WebRTC en streaming dans et autour de la r√©alit√© virtuelle üôä ü§æüèª üí†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La r√©alit√© virtuelle est d√©sormais √† la pointe de la mode. L'√©quipement qui pendant la tondeuse √† gazon √©tait  scientifiques fous  geeks avec beaucoup...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WebRTC en streaming dans et autour de la r√©alit√© virtuelle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/481698/"><p><img src="https://habrastorage.org/webt/jw/qo/v9/jwqov9cav_juhuolm3cwf8xm-aw.jpeg"></p><br><p>  La r√©alit√© virtuelle est d√©sormais √† la pointe de la mode.  L'√©quipement qui pendant la tondeuse √† gazon √©tait <del>  scientifiques fous </del>  geeks avec beaucoup d'argent <del>  du minist√®re de la d√©fense </del>  , maintenant c'est abordable pour une personne ordinaire, et ceux qui ont une poche compl√®tement vide peuvent assembler un casque VR √† partir de carton et d'un smartphone selon de nombreuses recettes. </p><a name="habracut"></a><br><p>  Et les avantages de la r√©alit√© virtuelle peuvent apporter bien plus.  que la salle de cin√©ma 3-4-5-6-7-plus-√†-go√ªter-D.  Disons que vous vivez √† Moscou et que vous souhaitez investir des ressources honn√™tement gagn√©es dans les devises les plus dures - l'immobilier quelque part sur la c√¥te m√©diterran√©enne.  Comme vous le savez, il vaut mieux choisir un logement sur place et par vous-m√™me, mais que faire si vous ne pouvez pas y consacrer suffisamment de temps?  C'est l√† que la r√©alit√© virtuelle est n√©cessaire.  Imaginez: un agent installe une cam√©ra sp√©ciale dans une pi√®ce, et vous, sans quitter votre chaise pr√©f√©r√©e, pouvez examiner cette pi√®ce, tourner la t√™te et m√™me le plafond avec un plafond du XVIIIe si√®cle. "Les dieux grecs se rendent <del>  d√©bauche </del>  repos "regarde! </p><br><p>  Alors, tout de m√™me, ne pas quitter l'endroit, √ßa vous int√©resse, mais √† quoi vos enfants s'adonnent-ils √† la maternelle?  Et encore une fois: la cam√©ra est dans la salle de jeux, et vous avec l'effet de pr√©sence pouvez examiner tous les coins o√π se trouvent vos enfants <del>  plac√© </del>  se cachent. </p><br><p>  Eh bien, nous allons trouver comment nous assurer que dans de tels cas tout fonctionne, et <del>  agents immobiliers </del>  les enfants n'ont pas eu le temps de s'enfuir. </p><br><h2 id="nyuansy-vr-kartinki">  Les nuances des images VR </h2><br><p>  <em>"Vasily Ivanovich, expliquez quelle est la nuance?"</em> <br>  <em>"Tu vois, Peter ..."</em> <br>  Du dialogue de deux messieurs √©minents </p><br><p>  Techniquement, un flux multim√©dia VR n'est pas diff√©rent d'un flux ordinaire: une piste vid√©o plus une piste audio.  Mais il y a une nuance. </p><br><p>  Le flux VR suppose une image st√©r√©o.  Une cam√©ra sp√©ciale regarde le monde avec deux larges, 180 degr√©s, ouverts <del>  les yeux </del>  lentilles √† peu pr√®s comme ce robot </p><br><p><img src="https://habrastorage.org/webt/yv/wq/gc/yvwqgcgjjnblruhtjnhduw3_xwq.jpeg"></p><br><p>  les images sont coll√©es ensemble dans un seul cadre, </p><br><p><img src="https://habrastorage.org/webt/ot/mn/li/otmnli2-vsrodo4wcjplsdmuw50.png"></p><br><p> par cons√©quent, un lecteur sp√©cial devrait travailler sur l'appareil du spectateur, qui fera l'une des deux images.  Comme vous pouvez le voir, le rapport hauteur / largeur de l'image est de 2: 1, image FullHD pour chaque ≈ìil. </p><br><h2 id="nyuansy-vr-translyacii">  Les nuances de la diffusion VR </h2><br><p>  <em>Oui, oui, oui, je peux tout faire</em> <br>  <em>Comptez comme des doigts sur une main</em> <br>  Chanson de film classique </p><br><p>  Nous parlons donc de diffuser des flux 4K avec un d√©bit binaire √©lev√©.  Qu'avons-nous?  Et nous avons RTMP et WebRTC. </p><br><p>  RTMP - <del>  pas cher </del>  fiable et pratique.  Sous le capot, il utilise TCP, ce qui est utile pour les canaux moins bons.  Il existe diff√©rentes solutions logicielles pour le client de publication, payantes et gratuites.  Mais, pour tous ses avantages, RTMP offre une latence √©lev√©e.  Dans un article pr√©c√©dent, nous avions not√© un d√©lai de 2-3 secondes pour un flux 720p.  Dans certains cas, les retards sont acceptables, mais la virtualit√© sera d√©j√† un peu en retrait par rapport √† la r√©alit√©, et les enfants auront le temps de s'enfuir. </p><br><p>  WebRTC - √©l√©gant, √† la mode, jeune.  Avec de bons canaux, les retards sont mesur√©s en millisecondes, la r√©alit√© restera la r√©alit√©.  Mais il y a des nuances. </p><br><p>  Premi√®rement, par d√©faut, WebRTC s'ex√©cute sur UDP, ce qui entra√Æne des pertes avec la moindre d√©t√©rioration de la qualit√© du canal.  Et pour un flux 4K, tout √©ternuement sur la cha√Æne est d√©j√† une d√©t√©rioration.  Cela peut √™tre r√©solu en passant au transport TCP, mais nous attend ensuite ... </p><br><p>  Deuxi√®mement, WebRTC est diffus√© √† partir du navigateur, et vous et moi savons quel navigateur est actuellement le plus populaire de la plan√®te (spoiler - pas IE6 depuis longtemps).  Et dans ce navigateur populaire, et au niveau du moteur, le d√©bit binaire de publication maximum est de 2500 kbps.  C'est assez. <del>  selon google </del>  pour FullHD, mais pas assez pour 4K, et si le d√©bit n'est pas acc√©l√©r√© √† 5 - 10 Mbit / s, les t√©l√©spectateurs verront des taches d'aquarelle en mouvement au lieu de la r√©alit√© virtuelle.  Heureusement, il existe des param√®tres sp√©ciaux pour l'overclocking du d√©bit binaire, qui fonctionnent dans <del>  √† propos de tout </del>  la plupart des navigateurs sur le moteur Chromium.  Ensuite, apr√®s avoir surmont√© cet obstacle, nous nous reposerons ... </p><br><p>  Troisi√®mement, nous serons confront√©s √† la capacit√© des canaux.  Afin de publier et de lire une image VR, au d√©bit binaire mentionn√© ci-dessus, le client aura besoin de canaux de 20 Mbit, ou mieux de 50, et encore mieux de 100 Mbit, dans les deux sens pour le t√©l√©chargement et le t√©l√©chargement.  De plus, cela ne devrait pas √™tre les param√®tres dont le fournisseur parle dans les brochures publicitaires, mais la vraie bande passante du client au serveur.  √Ä propos, ici, vous pouvez lire comment il peut √™tre <a href="https://flashphoner.com/indikator-kachestva-kanala-servernogo-webrtc-cherez-tcp/%3Flang%3Dru">mesur√© sans iperf et sans connaissances en ligne de commande</a> .  C√¥t√© serveur, il est donc souhaitable d'avoir 10 Go si vous comptez sur un grand nombre de flux. </p><br><p>  Enfin et quatri√®mement, ce qui d√©coule des exigences relatives aux cha√Ænes.  Le transcodage d'un flux 4K prendra trop de ressources processeur sur le serveur.  Par cons√©quent, vous devez soit choisir un serveur tsar, qui est cher sur un budget limit√©, soit utiliser l'encodage sur les cartes vid√©o, qui est √©galement tr√®s cher, ou √©viter le transcodage.  Autrement dit, ne modifiez en aucun cas la r√©solution, la fr√©quence d'images et le d√©bit binaire des flux pendant la traduction. </p><br><p>  Donc, tous les bas-fonds sont num√©rot√©s, maintenant </p><br><h2 id="davayte-poprobuem">  Essayons </h2><br><p>  <em>Qu'y a-t-il √† penser, il faut secouer!</em> <br>  Personnage de dessin anim√© </p><br><p>  Prenez: </p><br><ul><li>  cam√©ra sp√©ciale </li><li>  joueur sp√©cial </li><li>  un serveur qui peut <a href="https://flashphoner.com/brauzernaya-translyaciya-s-veb-kamery/%3Flang%3Dru">diffuser WebRTC √† partir d'un navigateur</a> </li></ul><br><p>  Montez l'appareil photo sur une table ou un tr√©pied </p><br><p><img src="https://habrastorage.org/webt/q-/bo/tw/q-botwt5-af0pl19umr-zphiez0.jpeg"></p><br><p>  Connectez-vous au PC via USB 3.0 avec une alimentation de 1 A, comme pour les disques externes </p><br><p><img src="https://habrastorage.org/webt/kh/4p/bp/kh4pbpwvvpvceliez14mgn0ocjc.jpeg"></p><br><p>  Je dois dire que l'appareil photo est tr√®s sensible aux √©quipements, et si l'ordinateur portable dispose de 2 ports USB 3.0, il peut tr√®s bien refuser de fonctionner avec l'un d'eux.  Le c√¢ble de connexion ne doit pas non plus √™tre enti√®rement chinois, toutes les broches pr√©vues par la norme doivent √™tre en place.  Et m√™me avec une connexion parfaite, l'appareil photo peut produire des interf√©rences, comme un vieux t√©l√©viseur √† ventre pot dans un orage.  Mais pour Windows 10, les pilotes ne sont pas n√©cessaires, un Plug-n-Play honn√™te. </p><br><p>  C√¥t√© serveur, d√©finissez les limites de d√©bit n√©cessaires </p><br><pre><code class="plaintext hljs">webrtc_cc_min_bitrate=5000000 webrtc_cc_max_bitrate=10000000</code> </pre> <br><p>  Nous allons ouvrir un exemple de <a href="https://demo.flashphoner.com:8888/client2/examples/demo/streaming/media_devices_manager/media_device_manager.html">page</a> dans le navigateur Chrome qui vous permet de d√©finir les param√®tres n√©cessaires pour capturer le flux depuis la cam√©ra et de d√©finir </p><br><ul><li>  R√©solution 3072x1536 </li><li>  FPS 24 (lors de la diffusion √† partir d'un navigateur, l'appareil photo prend uniquement en charge ces FPS) </li><li>  Transport TCP </li></ul><br><p>  et configurer les param√®tres SDP pour que le navigateur ne nous coupe pas <del>  esturgeon </del>  d√©bit binaire, c√¥t√© client </p><br><pre> <code class="javascript hljs">x-google-max-bitrate=<span class="hljs-number"><span class="hljs-number">10000</span></span>;x-google-min-bitrate=<span class="hljs-number"><span class="hljs-number">5000</span></span></code> </pre> <br><p>  ou c√¥t√© serveur (dans ce cas, les param√®tres seront valables pour tous les clients de publication) </p><br><pre> <code class="plaintext hljs">webrtc_sdp_min_bitrate_bps=5000000 webrtc_sdp_max_bitrate_bps=10000000</code> </pre> <br><p><img src="https://habrastorage.org/webt/ae/6z/r7/ae6zr7vxhkeeh65bp144sjklxfg.png"></p><br><p>  Nous publions le flux de la cam√©ra </p><br><p><img src="https://habrastorage.org/webt/hq/-r/hu/hq-rhunttdvkc4cff_o9uurcbec.png"></p><br><p>  Essayons maintenant de lire le flux avec un lecteur WebRTC standard </p><br><p><img src="https://habrastorage.org/webt/ot/mn/li/otmnli2-vsrodo4wcjplsdmuw50.png"></p><br><p>  Tout va bien ... Presque.  La virtualit√© n'est pas enti√®rement virtuelle.  Eh bien, maintenant nous jouons le m√™me flux dans un lecteur sp√©cial int√©gr√© √† la page </p><br><p><img src="https://habrastorage.org/webt/ij/ki/m-/ijkim-0dccwdgyeccgirdcusgec.png"></p><br><p>  Tant mieux (et il y a des phoques).  Si vous lisez le flux sur un appareil mobile ou dans des lunettes VR, vous pouvez tourner la t√™te et nous tournerons la souris dans le navigateur du PC.  Quelque part dans cette pi√®ce, un enfant s'est cach√©.  Regardons √† gauche </p><br><p><img src="https://habrastorage.org/webt/gc/dm/df/gcdmdflghc1jm1wxnleffttk-he.png"></p><br><p>  Maintenant bien </p><br><p><img src="https://habrastorage.org/webt/ct/iy/gl/ctiyglkgyc2wb987mj6pzpgqdji.png"></p><br><p>  Et en haut </p><br><p><img src="https://habrastorage.org/webt/nd/j8/3m/ndj83milhj9weql0x1ifufccuou.png"></p><br><p>  Et o√π est le b√©b√©?  Oui, ici, il se cache derri√®re le rideau.  Mais le chat voit tout! </p><br><h2 id="koda-nuzhno-bolshe-koda">  Code, vous avez besoin de plus de code! </h2><br><p>  C√¥t√© client, il n'y a pas beaucoup de code. </p><br><p>  Publier le flux depuis la page du navigateur </p><br><pre> <code class="javascript hljs">session.createStream({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: streamName, <span class="hljs-attr"><span class="hljs-attr">display</span></span>: localVideo, <span class="hljs-attr"><span class="hljs-attr">cacheLocalResources</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: <span class="hljs-string"><span class="hljs-string">"TCP"</span></span>, <span class="hljs-attr"><span class="hljs-attr">sdpHook</span></span>: rewriteSdp, <span class="hljs-attr"><span class="hljs-attr">constraints</span></span>: { <span class="hljs-attr"><span class="hljs-attr">audio</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">video</span></span>: { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">3072</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">1536</span></span>, <span class="hljs-attr"><span class="hljs-attr">frameRate</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> } } }).publish();</code> </pre> <br><p>  Fonction de remplacement du navigateur SDP </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rewriteSdp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sdp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sdpStringFind = <span class="hljs-string"><span class="hljs-string">"a=fmtp:(.*) (.*)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sdpStringReplace = <span class="hljs-string"><span class="hljs-string">"a=fmtp:$1 $2;x-google-max-bitrate=10000;x-google-min-bitrate=5000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newSDP = sdp.sdpString.toString(); newSDP = newSDP.replace(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(sdpStringFind,<span class="hljs-string"><span class="hljs-string">"g"</span></span>), sdpStringReplace); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newSDP; }</code> </pre> <br><p>  Exemple de page avec un lecteur VR </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>WebRTC Delight<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../../../flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../dependencies/jquery/jquery-1.12.0.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../dependencies/js/utils.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dl8-player.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dl8-custom-format"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{"name": "STEREO_TERPON","base":"STEREO_MESH","params":{"uri": "03198702.json"}}'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width: 50%;"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl8-live-video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">format</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"STEREO_TERPON"</span></span></span><span class="hljs-tag">&gt;</span></span> \<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl8-live-video</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"playStream"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Stream Name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"playBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">&gt;</span></span>Play<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stopBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">&gt;</span></span>Stop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> Flashphoner.init({</span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">flashMediaProviderSwfLocation</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'../../../../media-provider.swf'</span></span></span><span class="javascript">}); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> STREAM_STATUS_INFO = Flashphoner.constants.STREAM_STATUS_INFO; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> playBtn = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'playBtn'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> display = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'display'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> dl8video = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> url = setURL(); </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'x-dl8-evt-ready'</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ dl8video = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'remoteVideo'</span></span></span><span class="javascript">); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#playBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">).click(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ playStream(); }); }); </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">playStream</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#playBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#stopBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> video = dl8video.contentElement; Flashphoner.createSession({</span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">urlServer</span></span></span><span class="javascript">: url}).on(SESSION_STATUS.ESTABLISHED, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">session</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> session = Flashphoner.getSessions()[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; session.createStream({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'playStream'</span></span></span><span class="javascript">).value, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">display</span></span></span><span class="javascript">: display, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">remoteVideo</span></span></span><span class="javascript">: video, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">transport</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"TCP"</span></span></span><span class="javascript"> }).on(STREAM_STATUS.PLAYING, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">stream</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ dl8video.start(); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#stopBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">).click(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#playBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">); $(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#stopBtn'</span></span></span><span class="javascript">).prop(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'disabled'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); stream.stop(); dl8video.exit(); }); }).play(); }) } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Habituellement, lors de la cr√©ation d'un flux pour un lecteur (appelant <code>session.createStream()</code> ), nous passons un √©l√©ment div dans lequel un √©l√©ment vid√©o sera mont√© pour lire le flux via WebRTC.  Mais le lecteur VR utilise son propre √©l√©ment vid√©o, et nous devons en quelque sorte le transf√©rer dans le code de l'API utilis√©e.  Pour ce faire, nous transmettons directement l'√©l√©ment vid√©o du lecteur tiers √† la fonction session.createStream () avec le param√®tre <code>remoteVideo</code> </p><br><p>  Demo.flashphoner.com est utilis√© c√¥t√© serveur, des exemples d'applications web sont disponibles au sous-sol par les liens. </p><br><p>  Bonne chance dans l'inspection sur place, sans quitter la place! </p><br><h2 id="ssylki">  Les r√©f√©rences </h2><br><ol><li>  <a href="https://flashphoner.com/indikator-kachestva-kanala-servernogo-webrtc-cherez-tcp/%3Flang%3Dru">Indicateur de qualit√© de canal WebRTC du serveur sur TCP</a> - Contr√¥le de qualit√© des canaux du client au serveur </li><li>  <a href="https://flashphoner.com/brauzernaya-translyaciya-s-veb-kamery/%3Flang%3Dru">Streaming vid√©o depuis une webcam sur un navigateur ou un appareil mobile</a> - Streaming WebRTC depuis un navigateur </li><li>  <a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241519">Documentation pour utiliser WCS avec un lecteur VR</a> </li><li>  <a href="https://flashphoner.com/">WCS</a> - serveur pour la transmission de vid√©o VR 360 via WebRTC </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481698/">https://habr.com/ru/post/fr481698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481684/index.html">Un ordinateur portable de Powerbank?</a></li>
<li><a href="../fr481688/index.html">Pourquoi apprendre Java et comment le faire efficacement. Rapport Yandex</a></li>
<li><a href="../fr481692/index.html">Utilisation de Intel Processor Trace pour tracer le code du mode de gestion du syst√®me</a></li>
<li><a href="../fr481694/index.html">Ma fa√ßon de partitionner dans PostgreSQL</a></li>
<li><a href="../fr481696/index.html">r√®gle: contr√¥le dynamique de Go</a></li>
<li><a href="../fr481700/index.html">Une tante</a></li>
<li><a href="../fr481702/index.html">Du grille-pain au drone. Comment Internet des objets est-il n√© et pourquoi ne s'est-il d√©clench√© que 30 ans plus tard</a></li>
<li><a href="../fr481704/index.html">C'est la norme - 2: comment les cartes normales sont cuites</a></li>
<li><a href="../fr481706/index.html">Des ordinateurs quantiques perdus dans la course et leurs erreurs fatales</a></li>
<li><a href="../fr481708/index.html">PocketBook est-il si bon?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>