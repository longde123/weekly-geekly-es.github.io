<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè´ ‚ÜïÔ∏è üë¶ Cabe√ßalhos HTTP necess√°rios ‚úãüèæ üë®üèø‚Äç‚úàÔ∏è üï∫üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nossos clientes Fastly adoram manipular cabe√ßalhos HTTP. Escolher a combina√ß√£o certa de cabe√ßalhos √© uma das melhores coisas que voc√™ pode fazer para ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cabe√ßalhos HTTP necess√°rios</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413205/"> Nossos clientes Fastly adoram manipular cabe√ßalhos HTTP.  Escolher a combina√ß√£o certa de cabe√ßalhos √© uma das melhores coisas que voc√™ pode fazer para manter seu site seguro e dar uma contribui√ß√£o significativa ao seu desempenho. <br><br>  A maioria dos desenvolvedores est√° ciente dos cabe√ßalhos HTTP importantes e √∫teis.  Os mais famosos s√£o o <code>Content-Type</code> <code>Content-Length</code> , s√£o cabe√ßalhos quase universais.  Recentemente, por√©m, cabe√ßalhos como <code>Content-Security-Policy</code> e <code>Strict-Transport-Security</code> foram usados ‚Äã‚Äãpara aumentar a <code>Strict-Transport-Security</code> e <code>Link rel=preload</code> para melhorar o desempenho.  Apesar do amplo suporte nos navegadores, apenas alguns os utilizam. <br><br>  Em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior,</a> analisamos cabe√ßalhos desnecess√°rios.  Agora vamos descobrir quais cabe√ßalhos realmente devem ser configurados para o seu site. <br><a name="habracut"></a><br><h1>  Li√ß√£o de casa </h1><br>  Existem v√°rios servi√ßos na Internet que analisam seu site e aconselham quais cabe√ßalhos adicionar.  Examinei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">securityheaders.io</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Observat√≥rio</a> da Mozilla para complementar meu pr√≥prio conhecimento e dados da rede Fastly. <br><br><h1>  Quais t√≠tulos devem estar no seu site </h1><br>  Ent√£o, quais s√£o os principais cabe√ßalhos nas respostas do servidor?  A maioria √© respons√°vel por melhorar a seguran√ßa: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pol√≠tica de seguran√ßa de conte√∫do</a> .  Atua como um firewall no navegador.  Se o seu site estiver comprometido, ajudar√° a limitar os danos, impedindo conex√µes com hosts n√£o aprovados.  T√≠tulo muito importante.  Se voc√™ n√£o o possui, √© necess√°rio habilit√°-lo. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pol√≠tica de refer√™ncia</a> .  Ajusta o n√≠vel de detalhe a ser inclu√≠do no cabe√ßalho do <code>Referer</code> ao sair da p√°gina.  Ajuda a impedir o vazamento de dados nos sites para onde os links v√£o.  Altamente recomendado. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Seguran√ßa de transporte estrita</a> .  Impede qualquer tentativa de conex√£o com o site usando HTTP comum.  Ajuda a interromper os ataques do MiTM e melhora a seguran√ßa do site.  Tamb√©m √© altamente recomendado. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prote√ß√£o X-XSS</a> .  Impede algumas formas de ataques de script entre sites, impedindo a execu√ß√£o de scripts se alguma marca√ß√£o de um documento no mesmo formul√°rio estiver presente na solicita√ß√£o.  Por exemplo, se voc√™ carregar uma p√°gina com o endere√ßo <code>/index.html?foo=&lt;script&gt;alert('foo');&lt;/script&gt;</code> <code>&lt;script&gt;alert('foo');&lt;/script&gt;</code> , e no c√≥digo-fonte da p√°gina estiver <code>&lt;script&gt;alert('foo');&lt;/script&gt;</code> ent√£o o script est√° bloqueado.  Atualmente, o t√≠tulo √© amplamente substitu√≠do pelo CSP. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Op√ß√µes de tipo de conte√∫do X.</a>  Defina o valor como <code>nosniff</code> para impedir que os navegadores <code>nosniff</code> conte√∫do semelhante ao JavaScript para o qual o valor correto do tipo de conte√∫do n√£o est√° definido.  Impede ataques como a mistura MIME e, recentemente, o Chrome foi usado para ativar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isolamento do site</a> .  Com o tempo, torna-se menos importante devido ao comportamento aprimorado dos navegadores por padr√£o, mas atualmente ainda est√° entre as melhores pr√°ticas. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CORS</a> .  Os cabe√ßalhos de compartilhamento de recursos de origem cruzada permitem carregar um URL com um script de outra origem.  Este √© um t√≠tulo opcional.  Os t√≠tulos deste tipo s√£o permissivos, n√£o proibitivos; portanto, sua aus√™ncia fornece o n√≠vel m√°ximo de seguran√ßa. <br><br>  Outros s√£o para desempenho: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tempo Permitir Origem</a> .  D√° acesso √†s ferramentas de monitoramento para solicitar dados de temporiza√ß√£o.  Essas informa√ß√µes s√£o de muitas maneiras valiosas, pois podem melhorar significativamente a qualidade das an√°lises, como Google Analytics ou Speedcurve. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link rel = pr√©-carregamento</a> .  Informa ao navegador sobre recursos cr√≠ticos que devem ser baixados, mesmo que n√£o haja necessidade imediata deles.  Use o cabe√ßalho para fontes e CSS importantes. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tempo do servidor</a>  Fornece informa√ß√µes de tempo do servidor que complementam a API de tempo de navega√ß√£o e a API de tempo de recursos com informa√ß√µes mais detalhadas sobre o tempo necess√°rio para concluir tarefas no servidor (por exemplo, ‚Äúquanto tempo gastamos no MySQL‚Äù).  √ìtimo para monitorar dados de desempenho, combinado com as ferramentas RUM Beacon. <br><br>  Vamos dar uma olhada em alguns deles. <br><br><h1>  Pol√≠tica de seguran√ßa de conte√∫do: mantenha-a dentro </h1><br>  Embora <code>Content-Security-Policy</code> seja um dos t√≠tulos mais importantes, tamb√©m √© um dos mais detalhados.  O maior cabe√ßalho CSP que encontrei no HTTPArchive foi 10K.  <i>Dez kilobytes</i> .  Para um √∫nico valor de cabe√ßalho.  Pior: enquanto os corpos de resposta podem ser transmitidos, os cabe√ßalhos s√£o armazenados em buffer pela maioria dos servidores e proxies e transmitidos somente ap√≥s a conclus√£o.  A compacta√ß√£o HTTP / 2 ajuda um <i>pouco</i> a lembr√°-los entre solicita√ß√µes, mas isso n√£o significa que o cabe√ßalho de 10 KB esteja correto. <br><br>  Al√©m disso, preenchendo o primeiro pacote inteiro de sua resposta, voc√™ pode for√ßar o navegador a fazer duas chamadas para o servidor <b>apenas para come√ßar a receber o conte√∫do</b> .  Portanto, pense n√£o apenas em remover cabe√ßalhos desnecess√°rios, mas tamb√©m em maximizar os existentes. <br><br><h1>  Pol√≠tica de refer√™ncia </h1><br>  Desde tempos imemoriais (isto √©, no mundo da web desde o final dos anos 90), os navegadores enviam (e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escrevem incorretamente</a> ) o cabe√ßalho do <code>Referer</code> .  Durante a maior parte de sua hist√≥ria, essa foi uma das maneiras mais importantes de rastrear os movimentos dos usu√°rios entre as p√°ginas nas ferramentas de an√°lise, al√©m de entender a origem do tr√°fego recebido.  No entanto, este √∫ltimo est√° associado a importantes problemas de privacidade.  Se eu clicar no link no email do cliente de email, o site poder√° determinar meu dom√≠nio de email.  Pior ainda, saber o URL completo do qual voc√™ veio, incluindo os argumentos da solicita√ß√£o, pode revelar os termos da sua √∫ltima consulta de pesquisa ou dados pessoais, como um endere√ßo de email. <br><br>  Voc√™ pode selecionar v√°rias estrat√©gias nas op√ß√µes dispon√≠veis da Pol√≠tica de refer√™ncia, mas meu conselho habitual √© "origem quando origem cruzada", que habilita o Referer para todas as solicita√ß√µes normais, mas trunca o valor apenas para o dom√≠nio se o link for de um dom√≠nio para outro .  Os links em seu pr√≥prio site incluem um referenciador completo. <br><br><h1>  Medi√ß√£o de tempo do servidor no CDN Edge Server </h1><br>  <code>Server-Timing</code> tem muitos recursos interessantes, e um deles √© que voc√™ pode adicionar v√°rias inst√¢ncias em resposta - e todas elas ser√£o combinadas em um navegador ou ferramenta RUM.  Ou seja, se a solicita√ß√£o passar por v√°rios est√°gios do processamento do servidor - como acontece na CDN -, cada est√°gio adicionar√° suas pr√≥prias m√©tricas de tempo e n√£o entrar√° em conflito.  Veja como adicionar m√©tricas Fastly ao cabe√ßalho usando VCL na configura√ß√£o do servi√ßo Fastly: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Timing</span></span> = fastly_info.state {", fastly;desc="Edge <span class="hljs-type"><span class="hljs-type">time</span></span>";dur="} <span class="hljs-type"><span class="hljs-type">time</span></span>.elapsed.msec;</code> </pre> <br>  Esse n√∫mero inclui o tempo gasto aguardando o back-end; portanto, no caso normal, todas as m√©tricas de tempo do servidor ser√£o menores que o n√∫mero Fastly.  No entanto, se emitirmos o documento a partir do cache Fastly, voc√™ ver√° as m√©tricas de tempo originais a partir do momento em que a p√°gina foi gerada, mas o n√∫mero Fastly confirmar√° que a perda total de tempo √© realmente muito pequena. <br><br>  As m√©tricas de tempo do servidor est√£o dispon√≠veis por meio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do objeto de desempenho em JavaScript</a> e s√£o exibidas no painel de rede do Chrome Devtools: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d2e/5e2/349/d2e5e23497238f2cdf12cddf0c6dedb5.png"><br><br>  Atualmente, visualiza√ß√£o de indicadores em n√≠vel rudimentar.  Mas eles est√£o trabalhando duro nisso, portanto, no futuro, √© prov√°vel que a interface do usu√°rio melhore significativamente. <br><br><h1>  Adicione todos os cabe√ßalhos corretos. </h1><br>  Rapidamente √© um bom lugar para adicionar todos os cabe√ßalhos de seguran√ßa e desempenho.  A seguir, mostramos como todos eles parecem juntos.  Inclua esse c√≥digo no est√°gio de entrega do fluxo de solicita√ß√£o, alterando os valores para aqueles que s√£o adequados para o seu site ( <b>tente n√£o copiar e colar</b> sem verificar se os valores s√£o adequados para o seu site): <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.Content-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> = "default-src 'self'; frame-ancestors 'self'"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.Referer-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> = "origin-when-cross-origin"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Strict</span></span>-Transport-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span> = "max-age=86400"; # Increase <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> working well <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prod (a year <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a common final <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.X-XSS-Protection = "1; mode=block"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.X-Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> = "nosniff"; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.http.Origin) { # Consider checking this against an allowlist <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Access</span></span>-Control-Allow-Origin = req.http.Origin; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Access</span></span>-Control-Allow-Methods = "GET,HEAD,POST,OPTIONS"; } <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Timing</span></span> = fastly_info.state {", fastly;desc="Edge <span class="hljs-type"><span class="hljs-type">time</span></span>";dur="} <span class="hljs-type"><span class="hljs-type">time</span></span>.elapsed.msec; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.<span class="hljs-keyword"><span class="hljs-keyword">Timing</span></span>-Allow-Origin = "*"; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> resp.http.Link = "&lt;/fonts/myfont.otf&gt;; rel=preload; as=font";</code> </pre> <br>  No pr√≥ximo artigo, examinaremos alguns dos cabe√ßalhos mais ex√≥ticos que est√£o come√ßando a padronizar e implementar nos navegadores. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413205/">https://habr.com/ru/post/pt413205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413189/index.html">Cole√ß√£o de sombras css Box-shadows.css</a></li>
<li><a href="../pt413193/index.html">Compra de ferro contra a nuvem: como contar</a></li>
<li><a href="../pt413195/index.html">Pensamento funcional. Parte 6</a></li>
<li><a href="../pt413199/index.html">Falhas de futurologistas. Ideias de filmes que n√£o se materializaram</a></li>
<li><a href="../pt413203/index.html">OIC e seguran√ßa: an√°lise do concurso de intelig√™ncia competitiva em dias positivos de hackers</a></li>
<li><a href="../pt413207/index.html">PGCon 2018: fotos, slides, impress√µes</a></li>
<li><a href="../pt413211/index.html">Analisando o aplicativo Avito iOS: Ask Me Anything</a></li>
<li><a href="../pt413213/index.html">Apple WWDC 2018: transmiss√£o de texto</a></li>
<li><a href="../pt413215/index.html">O GitHub agora pertence oficialmente √† Microsoft</a></li>
<li><a href="../pt413217/index.html">Os carros el√©tricos s√£o t√£o ecol√≥gicos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>