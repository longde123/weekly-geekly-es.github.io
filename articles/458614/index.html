<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💃🏽 🧔🏿 🥣 Crear un enlace Reactivo UsePosition () para obtener y rastrear las coordenadas del navegador 🦍 🕴🏾 🔤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si brevemente 


 En este artículo, crearemos un usePosition() reactivo usePosition() para rastrear la geolocalización del navegador. Bajo el capó, es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Crear un enlace Reactivo UsePosition () para obtener y rastrear las coordenadas del navegador</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458614/"><p><img src="https://habrastorage.org/getpro/habr/post_images/b2e/801/b0c/b2e801b0c809c1b2059b4e0d712a71b1.jpg" alt="imagen"></p><br><h2 id="esli-vkratce">  Si brevemente </h2><br><p> En este artículo, crearemos un <code>usePosition()</code> reactivo <code>usePosition()</code> para rastrear la geolocalización del navegador.  Bajo el capó, este gancho utilizará los <code>getCurrentPosition()</code> y <code>watchPosition()</code> del objeto de navegador nativo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">navigator.geolocation</a> .  Publiqué la versión final del gancho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>en GitHub</b></a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>NPM</b></a> . </p><br><h2 id="zachem-sozdavat-huk-useposition-v-principe">  ¿Por qué crear un gancho <code>usePosition()</code> en principio </h2><br><p>  Una de las ventajas importantes de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ganchos</a> en React es la capacidad de aislar fragmentos de código relacionados lógicamente en un lugar (en el gancho), evitando la necesidad de mezclar fragmentos de código no relacionados lógicamente, por ejemplo, en el método <code>componentDidMount()</code> del componente. </p><br><p>  Supongamos que queremos obtener las coordenadas del navegador ( <code>latitude</code> y <code>longitude</code> ) y después de recibir las coordenadas, solicite el pronóstico del tiempo o la temperatura actual en esta región a un servicio externo.  El código de estas dos funcionalidades (obtención de coordenadas y solicitud de temperatura) en React a menudo se coloca dentro de un método <code>componentDidMount()</code> .  En este caso, el método <code>componentWillUnmount()</code> generalmente se "limpia" por sí solo, llamando al método <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clearWatch ()</a> para dejar de monitorear la ubicación del navegador.  Tal enfoque aumenta el tamaño de los métodos, divide secciones de código conectadas lógicamente en partes (suscribiendo y cancelando por separado la supervisión de la ubicación del navegador), y combina partes del código conectadas lógicamente débilmente en un método (obteniendo coordenadas y temperatura).  Leer el código es difícil, como lo es la depuración y el soporte. </p><br><p>  A continuación, intentaremos transferir la funcionalidad asociada con la obtención de las coordenadas del navegador en un gancho <code>usePosition()</code> separado para evitar las dificultades mencionadas anteriormente. </p><a name="habracut"></a><br><h2 id="kak-my-budem-ispolzovat-huk-useposition">  ¿Cómo usaremos el gancho <code>usePosition()</code> </h2><br><p>  Vayamos "desde el opuesto" y antes de implementar el gancho en sí mismo, planeemos cómo lo usaremos.  Esto nos ayudará a determinar la interfaz de enlace (qué aceptará y qué devolver). </p><br><p>  El ejemplo más simple de obtener coordenadas y mostrarlas en la pantalla podría verse así: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    . import { usePosition } from './usePosition'; export const UsePositionDemo = () =&gt; { //    ( ) . const { latitude, longitude, error } = usePosition(); //       (   ). return ( &lt;&gt; latitude: {latitude}, longitude: {longitude}, error: {error} &lt;/&gt; ); };</span></span></code> </pre> <br><p>  Solo una línea con el gancho <code>usePosition()</code> y podemos operar con coordenadas de <code>latitude</code> y <code>longitude</code> .  Ni siquiera <code>useState()</code> usado explícitamente los ganchos <code>useState()</code> o <code>useEffect()</code> aquí.  Una suscripción a las coordenadas de seguimiento, así como la eliminación de un suscriptor, se encapsulan en un <code>usePosition()</code> .  Además, la magia de volver a dibujar los componentes de React hará todo por nosotros.  Al principio, las coordenadas serán <code>null</code> o <code>undefined</code> .  Tan pronto como se reciban las coordenadas, el componente se volverá a dibujar y los veremos en la pantalla. </p><br><h2 id="realizaciya-huka-useposition">  Implementación de <code>usePosition()</code> </h2><br><p>  Nuestro gancho <code>usePosition()</code> es una función JavaScript normal que se ve así: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  . export const usePosition = () =&gt; { //    . }</span></span></code> </pre> <br><p>  Usaremos los ganchos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">useState ()</a> para el almacenamiento interno de coordenadas y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">useEffect ()</a> para suscribir y cancelar la suscripción de coordenadas de seguimiento.  Para hacer esto, debemos importarlos. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     . }</span></span></code> </pre> <br><p>  Crearemos variables de estado en las que almacenaremos coordenadas o un error en la obtención de coordenadas (por ejemplo, si el usuario se niega a compartir su ubicación). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ... }</span></span></code> </pre> <br><p>  También en esta etapa podemos devolver las variables que se esperan del gancho.  Hasta ahora, no hay nada útil en estas variables, pero lo arreglaremos pronto. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">// other code goes here... return { ...position, error }; }</span></span></code> </pre> <br><p>  Y ahora el momento clave de implementación es obtener coordenadas. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     ,    .. useEffect(() =&gt; { const geo = navigator.geolocation; if (!geo) { setError('   '); return; } //     . watcher = geo.watchPosition(onChange, onError); //  ,       //    ,    . return () =&gt; geo.clearWatch(watcher); }, []); return {...position, error}; }</span></span></code> </pre> <br><p>  En el <code>useEffect()</code> , primero verificamos si el navegador admite la funcionalidad de detección de coordenadas.  Si la funcionalidad no es compatible, salimos del gancho con un error.  De lo contrario, nos suscribimos a cambiar la geolocalización del navegador utilizando las <code>onError()</code> onChange <code>onChange()</code> y <code>onError()</code> (agregaremos su código a continuación).  Tenga en cuenta que desde el <code>useEffect()</code> , devolvemos una función anónima que se ejecutará si el componente se elimina de la pantalla.  En esta función anónima, nos damos de baja de la vigilancia para no obstruir la memoria.  Por lo tanto, toda la lógica de suscribirse y darse de baja del seguimiento está en un gancho <code>usePosition()</code> . </p><br><p>  Agreguemos las devoluciones de llamada faltantes: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{latitude, longitude}</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        position,   //    ,    . setPosition({latitude, longitude}); }; const onError = (error) =&gt; { setError(error.message); }; useEffect(() =&gt; { const geo = navigator.geolocation; if (!geo) { setError('   '); return; } //     . watcher = geo.watchPosition(onChange, onError); //  ,       //    ,    . return () =&gt; geo.clearWatch(watcher); }, []); return {...position, error}; }</span></span></code> </pre> <br><p>  El gancho <code>usePosition()</code> está listo para usar. </p><br><h2 id="naposledok">  Al final </h2><br><p>  Puede encontrar una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">demostración del gancho</a> y su implementación más detallada con la capacidad de establecer parámetros de seguimiento en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>GitHub</b></a> . </p><br><p>  Espero que este artículo te haya sido útil.  Codificación exitosa! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458614/">https://habr.com/ru/post/458614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458602/index.html">Cómo atravesamos el Gran Cortafuegos chino (Parte 1)</a></li>
<li><a href="../458604/index.html">¿Por qué los dos mayores fabricantes de productos electrónicos unieron fuerzas en un nuevo proyecto de GPU?</a></li>
<li><a href="../458606/index.html">Ejecute OpenVPN en Docker en 2 segundos</a></li>
<li><a href="../458608/index.html">Herramientas de desarrollo de Node.js Cola de trabajo</a></li>
<li><a href="../458612/index.html">Cosmos 7 años</a></li>
<li><a href="../458622/index.html">Automatización para los más pequeños. Primera parte (que es después de cero). Virtualización de red</a></li>
<li><a href="../458624/index.html">Cómo aprendimos a dibujar textos en lienzo</a></li>
<li><a href="../458626/index.html">StealthWatch: conceptos básicos y requisitos mínimos. Parte 1</a></li>
<li><a href="../458630/index.html">Un poco de historia sobre el desarrollo de tu juego en Windows Forms + C # puro en mis 16 años</a></li>
<li><a href="../458632/index.html">Realmente escribiendo vue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>