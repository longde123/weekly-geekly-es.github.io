<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèΩ üòê üåÑ C√≥mo el troyano Gustuff de Android elimina la crema (fiat y cripto) de sus cuentas üë©üèæ‚Äçü§ù‚Äçüë©üèΩ üìâ üéÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Justo el otro d√≠a, Group-IB inform√≥ sobre la actividad del troyano m√≥vil Android Gustuff. Funciona exclusivamente en mercados internacionales, atacand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo el troyano Gustuff de Android elimina la crema (fiat y cripto) de sus cuentas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/446948/"><img src="https://habrastorage.org/webt/b9/hn/wr/b9hnwrlclblkmurq29bkezeanui.png"><br><br>  Justo el otro d√≠a, Group-IB <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inform√≥</a> sobre la actividad del troyano m√≥vil Android Gustuff.  Funciona exclusivamente en mercados internacionales, atacando a clientes de los 100 bancos extranjeros m√°s grandes, usuarios de 32 billeteras criptogr√°ficas m√≥viles, as√≠ como grandes recursos de comercio electr√≥nico.  Pero el desarrollador de Gustuff es un ciberdelincuente de habla rusa bajo el apodo de Bestoffer.  Hasta hace poco, elogi√≥ su troyano como "un producto serio para personas con conocimiento y experiencia". <br><br>  <b>Ivan Pisarev,</b> especialista en an√°lisis de c√≥digos maliciosos del Grupo IB, en su investigaci√≥n cuenta en detalle sobre c√≥mo funciona Gustuff y cu√°l es su peligro. <a name="habracut"></a><br><br><h2>  ¬øPara qui√©n busca Gustuff? </h2><br>  Gustuff es una nueva generaci√≥n de malware con funciones totalmente automatizadas.  Seg√∫n el desarrollador, el troyano se ha convertido en una nueva versi√≥n mejorada del malware AndyBot, que desde noviembre de 2017 ha estado atacando tel√©fonos Android y robando dinero a trav√©s de formularios web de phishing que se hacen pasar por aplicaciones m√≥viles de conocidos bancos internacionales y sistemas de pago.  Bestoffer inform√≥ que el precio de alquiler de Gustuff Bot era de $ 800 por mes. <br><br>  El an√°lisis de la muestra de Gustuff mostr√≥ que el troyano est√° potencialmente dirigido a clientes que usan aplicaciones m√≥viles de los bancos m√°s grandes, como Bank of America, Bank of Scotland, JPMorgan, Wells Fargo, Capital One, TD Bank, PNC Bank, as√≠ como Bitcoin Wallet, BitPay crypto wallets , Cryptopay, Coinbase, etc. <br><br>  Originalmente creada como un troyano bancario cl√°sico, la versi√≥n actual de Gustuff ha ampliado significativamente la lista de objetivos potenciales para el ataque.  Adem√°s de las aplicaciones de Android de bancos, empresas de tecnolog√≠a financiera y servicios de cifrado, Gustuff est√° dirigido a usuarios de aplicaciones de mercado, tiendas en l√≠nea, sistemas de pago y mensajer√≠a instant√°nea.  En particular, PayPal, Western Union, eBay, Walmart, Skype, WhatsApp, Gett Taxi, Revolut y otros. <br><br><h2>  Punto de entrada: c√°lculo para infecci√≥n masiva </h2><br>  Gustuff se caracteriza por el vector "cl√°sico" de penetraci√≥n en los tel√©fonos inteligentes Android a trav√©s del env√≠o de SMS con enlaces a APK.  Si el dispositivo Android est√° infectado con un troyano a las √≥rdenes del servidor, Gustuff puede extenderse a√∫n m√°s a trav√©s de la base de datos de contactos del tel√©fono infectado o la base de datos del servidor.  La funcionalidad de Gustuff est√° dise√±ada para la infecci√≥n masiva y la capitalizaci√≥n m√°xima del negocio de sus operadores: tiene una funci√≥n √∫nica de "autocompletar" en aplicaciones leg√≠timas de banca m√≥vil y billeteras criptogr√°ficas, lo que le permite acelerar y escalar el robo de dinero. <br><br>  El estudio del troyano mostr√≥ que la funci√≥n de autocompletar se implement√≥ utilizando el Servicio de Accesibilidad, un servicio para personas con discapacidades.  Gustuff no es el primer troyano que evita con √©xito la protecci√≥n contra la interacci√≥n con elementos de ventana de otras aplicaciones que utilizan este servicio de Android.  Sin embargo, el uso del servicio de accesibilidad junto con la carga autom√°tica sigue siendo bastante raro. <br><br>  Despu√©s de descargar a la v√≠ctima al tel√©fono, Gustuff, utilizando el Servicio de Accesibilidad, tiene la oportunidad de interactuar con elementos de ventana de otras aplicaciones (banca, criptomoneda, as√≠ como aplicaciones para compras en l√≠nea, mensajes, etc.), realizando las acciones necesarias para los atacantes.  Por ejemplo, al comando del servidor, el troyano puede hacer clic en los botones y cambiar los valores de los campos de texto en las aplicaciones bancarias.  El uso del mecanismo del Servicio de Accesibilidad permite al troyano eludir los mecanismos de protecci√≥n utilizados por los bancos para contrarrestar los troyanos m√≥viles de la generaci√≥n anterior, as√≠ como los cambios en la pol√≠tica de seguridad introducida por Google en las nuevas versiones del sistema operativo Android.  Entonces, Gustuff "sabe c√≥mo" deshabilitar la protecci√≥n de Google Protect: seg√∫n el autor, esta funci√≥n funciona en el 70% de los casos. <br><br><img src="https://habrastorage.org/webt/ih/x4/1k/ihx41k2p4hqubcaaisklwvdyoy8.png"><br><br>  Gustuff tambi√©n puede mostrar notificaciones PUSH falsas con √≠conos de aplicaciones m√≥viles leg√≠timas.  El usuario hace clic en la notificaci√≥n PUSH y ve una ventana de phishing descargada del servidor, donde √©l mismo ingresa los datos solicitados de una tarjeta bancaria o billetera criptogr√°fica.  En otro escenario de Gustuff, se abre una aplicaci√≥n en nombre de la cual se muestra una notificaci√≥n PUSH.  En este caso, el programa malicioso, a pedido del servidor a trav√©s del Servicio de Accesibilidad, puede completar los campos del formulario de la aplicaci√≥n bancaria para una transacci√≥n fraudulenta. <br><br>  La funcionalidad de Gustuff tambi√©n incluye el env√≠o de informaci√≥n sobre un dispositivo infectado al servidor, la capacidad de leer / enviar mensajes SMS, enviar solicitudes USSD, iniciar Proxy SOCKS5, seguir el enlace, enviar archivos (incluidos escaneos fotogr√°ficos de documentos, capturas de pantalla, fotos) al servidor restablecer el dispositivo a la configuraci√≥n de f√°brica. <br><br><h2>  An√°lisis de malware </h2><br>  Antes de instalar una aplicaci√≥n maliciosa, el sistema operativo Android muestra al usuario una ventana que contiene una lista de los derechos solicitados por Gustuff: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/th/ac/kuthacuzh0webqtrwhgktysougi.png" alt="imagen alt"></div><br>  La instalaci√≥n de la aplicaci√≥n se realizar√° solo despu√©s de obtener el consentimiento del usuario.  Despu√©s de iniciar la aplicaci√≥n, el troyano le mostrar√° al usuario una ventana: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hj/uq/xa/hjuqxaw2ezubek_xmd3clywhpsw.png" alt="imagen alt"></div><br>  Luego eliminar√° su icono. <br><br>  Gustuff es empaquetado, seg√∫n el autor, por un empaquetador FTT.  Despu√©s de comenzar, la aplicaci√≥n accede peri√≥dicamente al servidor CnC para recibir comandos.  En varios archivos que examinamos, la direcci√≥n IP <b>88.99.171 [.] 105 se</b> utiliz√≥ como servidor de control (en adelante, la denominaremos <b>&lt;% CnC%&gt;</b> ). <br><br>  Despu√©s de comenzar, el programa comienza a enviar mensajes al servidor <b>http: // &lt;% CnC%&gt; /api/v1/get.php</b> . <br><br>  Como respuesta, se espera JSON en el siguiente formato: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;%id%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%command%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%Server Timestamp%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ &lt;%Command parameters as JSON%&gt; }, }, }</code> </pre> <br>  Cada vez que la aplicaci√≥n env√≠a informaci√≥n sobre un dispositivo infectado.  El formato del mensaje se presenta a continuaci√≥n.  Vale la pena se√±alar que los campos <b>completos</b> , <b>adicionales</b> , de <b>aplicaciones</b> y <b>permisos</b> son opcionales y se enviar√°n solo en caso de un comando de solicitud de CnC. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"cell"</span></span>:&lt;%Sim operator name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%Country ISO%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%IMEI%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1Number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"advertisementId"</span></span>:&lt;%ID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"admin"</span></span>:&lt;%Has admin rights%&gt;, <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"needPermissions"</span></span>:&lt;%Application needs permissions%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByName"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByService"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"safetyNet"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"defaultSmsApp"</span></span>:&lt;%Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"isDefaultSmsApp"</span></span>:&lt;%Current application is Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"dateTime"</span></span>:&lt;%Current date time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"batteryLevel"</span></span>:&lt;%Battery level%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"socks"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Proxy module ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"enabled"</span></span>:&lt;%Is enabled%&gt;, <span class="hljs-attr"><span class="hljs-attr">"active"</span></span>:&lt;%Is active%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"versionName"</span></span>:&lt;%Package Version Name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"versionCode"</span></span>:&lt;%Package Version Code%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lastUpdateTime"</span></span>:&lt;%Package Last Update Time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>:&lt;%Tag, default value: <span class="hljs-string"><span class="hljs-string">"TAG"</span></span>%&gt;, <span class="hljs-attr"><span class="hljs-attr">"targetSdkVersion"</span></span>:&lt;%Target Sdk Version%&gt;, <span class="hljs-attr"><span class="hljs-attr">"buildConfigTimestamp"</span></span>:<span class="hljs-number"><span class="hljs-number">1541309066721</span></span> }, }, <span class="hljs-attr"><span class="hljs-attr">"full"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Device Model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeCountry"</span></span>:&lt;%Country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeLang"</span></span>:&lt;%Locale language%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accounts"</span></span>:&lt;%JSON array, contains from <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> and <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> of accounts%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lockType"</span></span>:&lt;%Type of lockscreen password%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"serial"</span></span>:&lt;%Build serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"board"</span></span>:&lt;%Build Board%&gt;, <span class="hljs-attr"><span class="hljs-attr">"brand"</span></span>:&lt;%Build Brand%&gt;, <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>:&lt;%Build User%&gt;, <span class="hljs-attr"><span class="hljs-attr">"device"</span></span>:&lt;%Build Device%&gt;, <span class="hljs-attr"><span class="hljs-attr">"display"</span></span>:&lt;%Build Display%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Build ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%Build manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Build model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>:&lt;%Build product%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>:&lt;%Build tags%&gt;, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:&lt;%Build type%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1number"</span></span>:&lt;%phonenumber%&gt;, <span class="hljs-attr"><span class="hljs-attr">"iccid"</span></span>:&lt;%Sim serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mcc"</span></span>:&lt;%Mobile country code of operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mnc"</span></span>:&lt;%Mobile network codeof operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"cellid"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lac"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidid"</span></span>:&lt;%Android Id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"ssid"</span></span>:&lt;%Wi-Fi SSID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"apps"</span></span>:{&lt;%List of installed applications%&gt;}, <span class="hljs-attr"><span class="hljs-attr">"permission"</span></span>:&lt;%List of granted permissions%&gt; }</code> </pre> <br><h3>  Almacenamiento de datos de configuraci√≥n </h3><br>  Gustuff almacena informaci√≥n importante del trabajo en un archivo de preferencias.  El nombre del archivo, as√≠ como los nombres de los par√°metros que <b>contiene</b> , es el resultado del c√°lculo de la suma MD5 a partir de la l√≠nea <b>15413090667214.6.1 &lt;% name%&gt;</b> , donde <b>&lt;% name%&gt;</b> es el nombre-valor original.  Interpretaci√≥n de Python de la funci√≥n de generaci√≥n de nombres: <br><br><pre> <code class="json hljs"> nameGenerator(input): output = md<span class="hljs-number"><span class="hljs-number">5</span></span>(<span class="hljs-string"><span class="hljs-string">"15413090667214.6.1"</span></span> + input)</code> </pre> <br>  En el futuro lo denotaremos como <b>nameGenerator (input)</b> . <br><br>  Por lo tanto, el nombre del primer archivo es: <b>nameGenerator ("API_SERVER_LIST")</b> , contiene valores con los siguientes nombres: <br><br><table><tbody><tr><th width="400">  <b>Nombre variable</b> </th><th>  <b>Valor</b> </th></tr><tr><td>  <b>nameGenerator ("API_SERVER_LIST")</b> </td><td>  Contiene una lista de direcciones CnC como una matriz. </td></tr><tr><td>  <b>nameGenerator ("API_SERVER_URL")</b> </td><td>  Contiene una direcci√≥n CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_UPLOAD")</b> </td><td>  La bandera est√° configurada por defecto.  Si la bandera est√° activada, env√≠a mensajes SMS a CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER")</b> </td><td>  El n√∫mero de tel√©fono al que se enviar√°n los mensajes SMS recibidos por el dispositivo infectado.  El valor predeterminado es nulo. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER_RESEND")</b> </td><td>  La bandera se borra por defecto.  Si est√° instalado, cuando un dispositivo infectado recibe un SMS, se enviar√° al n√∫mero ra√≠z. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_APP_SMS")</b> </td><td>  La bandera se borra por defecto.  Si se establece este indicador, la aplicaci√≥n procesar√° los mensajes SMS entrantes. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ADMIN")</b> </td><td>  La bandera se borra por defecto.  Si se establece el indicador, la aplicaci√≥n tiene derechos de administrador. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ACCESSIBILITY")</b> </td><td>  La bandera se borra por defecto.  Si se establece el indicador, se inicia un servicio que utiliza el Servicio de accesibilidad. </td></tr><tr><td>  <b>nameGenerator ("APPS_CONFIG")</b> </td><td>  El objeto JSON contiene una lista de acciones que deben realizarse cuando se activa el evento de accesibilidad asociado con una aplicaci√≥n en particular. </td></tr><tr><td>  <b>nameGenerator ("APPS_INSTALLED")</b> </td><td>  Almacena una lista de aplicaciones instaladas en el dispositivo. </td></tr><tr><td>  <b>nameGenerator ("IS_FIST_RUN")</b> </td><td>  La bandera se restablece en el primer inicio. </td></tr><tr><td>  <b>nameGenerator ("UNIQUE_ID")</b> </td><td>  Contiene un identificador √∫nico.  Se genera en el primer lanzamiento del bot. </td></tr></tbody></table><br><h3>  M√≥dulo de procesamiento de comandos del servidor </h3><br>  La aplicaci√≥n almacena las direcciones de los servidores CnC como una matriz de <b>cadenas</b> codificadas <b>Base85</b> .  La lista de servidores CnC se puede cambiar al recibir el comando apropiado, en cuyo caso las direcciones se almacenar√°n en un archivo de preferencias. <br><br>  En respuesta a la solicitud, el servidor env√≠a un comando a la aplicaci√≥n.  Vale la pena se√±alar que los comandos y par√°metros se presentan en formato JSON.  Una aplicaci√≥n puede procesar los siguientes comandos: <br><table><tbody><tr><th width="150">  <b>El equipo</b> </th><th>  <b>Descripci√≥n</b> </th></tr><tr><td>  <b>forwardStart</b> </td><td>  Comience a enviar mensajes SMS recibidos por el dispositivo infectado al servidor CnC. </td></tr><tr><td>  <b>forwardStop</b> </td><td>  Deje de enviar mensajes SMS recibidos por el dispositivo infectado al servidor CnC. </td></tr><tr><td>  <b>ussdRun</b> </td><td>  Ejecute la solicitud de USSD.  El n√∫mero al que desea realizar una solicitud USSD est√° en el campo "n√∫mero" de JSON. </td></tr><tr><td>  <b>sendSms</b> </td><td>  Env√≠e un mensaje SMS (si es necesario, el mensaje se "divide" en partes).  Como par√°metro, el comando toma un objeto JSON que contiene los campos "a" - el n√∫mero de destino y el "cuerpo" - el cuerpo del mensaje. </td></tr><tr><td>  <b>sendSmsAb</b> </td><td>  Env√≠e mensajes SMS (si es necesario, el mensaje se "divide" en partes) a todos desde la lista de contactos del dispositivo infectado.  El intervalo entre el env√≠o de mensajes es de 10 segundos.  El cuerpo del mensaje est√° en el campo JSON "cuerpo" </td></tr><tr><td>  <b>sendSmsMass</b> </td><td>  Env√≠e mensajes SMS (si es necesario, el mensaje se "divide" en partes) a los contactos especificados en los par√°metros del comando.  El intervalo entre el env√≠o de mensajes es de 10 segundos.  Como par√°metro, el comando acepta una matriz JSON (campo "sms"), cuyos elementos contienen los campos "a" - el n√∫mero de destino y "cuerpo" - el cuerpo del mensaje. </td></tr><tr><td>  <b>changeServer</b> </td><td>  Este comando como par√°metro puede tomar un valor con la clave "url" - luego el bot cambiar√° el valor de nameGenerator ("SERVER_URL"), o "array" - luego el bot escribir√° el array en nameGenerator ("API_SERVER_LIST") Por lo tanto, la aplicaci√≥n cambia la direcci√≥n de los servidores CnC. </td></tr><tr><td>  <b>adminNumber</b> </td><td>  El comando est√° dise√±ado para funcionar con el n√∫mero ra√≠z.  El comando acepta un objeto JSON con los siguientes par√°metros: "n√∫mero" - cambiar nameGenerator ("ROOT_NUMBER") al valor recibido, "reenviar" - cambiar nameGenerator ("SMS_ROOT_NUMBER_RESEND"), "sendId" - enviar a nameGenerator ("ROOT_NUMBER") uniqueID. </td></tr><tr><td>  <b>updateInfo</b> </td><td>  Enviar informaci√≥n sobre un dispositivo infectado al servidor. </td></tr><tr><td>  <b>wipeData</b> </td><td>  El comando est√° dise√±ado para eliminar datos de usuario.  Dependiendo de qu√© nombre se inici√≥ la aplicaci√≥n, los datos se borran completamente con el reinicio del dispositivo (usuario principal) o solo se eliminan los datos del usuario (usuario secundario). </td></tr><tr><td>  <b>calcetines</b> </td><td>  Inicie el m√≥dulo proxy.  El funcionamiento del m√≥dulo se describe en una secci√≥n separada. </td></tr><tr><td>  <b>calcetines</b> </td><td>  Detenga el m√≥dulo proxy. </td></tr><tr><td>  <b>openLink</b> </td><td>  Sigue el enlace.  El enlace se encuentra en el par√°metro JSON por la clave "url".  Para abrir el enlace, use "android.intent.action.VIEW". </td></tr><tr><td>  <b>uploadAllSms</b> </td><td>  Env√≠e al servidor todos los mensajes SMS recibidos por el dispositivo. </td></tr><tr><td>  <b>uploadAllPhotos</b> </td><td>  Enviar im√°genes desde un dispositivo infectado a la URL.  La URL viene como un par√°metro. </td></tr><tr><td>  <b>uploadFile</b> </td><td>  Env√≠e el archivo a la URL desde el dispositivo infectado.  La URL viene como un par√°metro. </td></tr><tr><td>  <b>uploadPhoneNumbers</b> </td><td>  Enviar n√∫meros de tel√©fono de la lista de contactos al servidor.  Si un objeto JSON con la clave "ab" viene como par√°metro, la aplicaci√≥n recibe la lista de contactos de la gu√≠a telef√≥nica.  Si un objeto JSON con la tecla "sms" viene como par√°metro, la aplicaci√≥n lee la lista de contactos de los remitentes de los mensajes SMS. </td></tr><tr><td>  <b>changeArchive</b> </td><td>  La aplicaci√≥n descarga el archivo desde la direcci√≥n, que viene como un par√°metro con la clave "url".  El archivo descargado se guarda con el nombre "archive.zip".  Despu√©s de eso, la aplicaci√≥n descomprimir√° el archivo, si es necesario, utilizando la contrase√±a para el archivo "b5jXh37gxgHBrZhQ4j3D".  Los archivos descomprimidos se guardan en el directorio [almacenamiento externo] / hgps.  En este directorio, la aplicaci√≥n almacena falsificaciones web (descritas m√°s adelante). </td></tr><tr><td>  <b>acciones</b> </td><td>  El comando est√° dise√±ado para funcionar con el Servicio de acci√≥n, que se describe en una secci√≥n separada. </td></tr><tr><td>  <b>prueba</b> </td><td>  No hace nada </td></tr><tr><td>  <b>descargar</b> </td><td>  El comando est√° dise√±ado para descargar un archivo de un servidor remoto y guardarlo en el directorio de Descargas.  La URL y el nombre del archivo vienen como un par√°metro, los campos en el par√°metro del objeto JSON, respectivamente: "url" y "fileName". </td></tr><tr><td>  <b>quitar</b> </td><td>  Elimina un archivo del directorio de descargas.  El nombre del archivo viene en el par√°metro JSON con la clave "fileName".  El nombre de archivo predeterminado es "tmp.apk". </td></tr><tr><td>  <b>notificaci√≥n</b> </td><td>  Muestra una notificaci√≥n con los textos de descripci√≥n y t√≠tulo definidos por el servidor de administraci√≥n. </td></tr></tbody></table><br>  El formato del comando de <b>notificaci√≥n</b> es: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: &lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"notification"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:&lt;%Server Timestamp%&gt;, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"openApp"</span></span>:&lt;%Open original app or not%&gt;, <span class="hljs-attr"><span class="hljs-attr">"array"</span></span>:[ {<span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:&lt;%Title text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"desc"</span></span>:&lt;%Description text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"app"</span></span>:&lt;%Application name%&gt;} ] }, }, }</code> </pre> <br>  La notificaci√≥n generada por el archivo investigado se ve id√©ntica a las notificaciones creadas por la aplicaci√≥n especificada en el campo de la <b>aplicaci√≥n</b> .  Si el valor del campo <b>openApp</b> es True, cuando se abre la notificaci√≥n, se inicia la aplicaci√≥n especificada en el campo de la <b>aplicaci√≥n</b> .  Si el valor del campo <b>openApp</b> es False, entonces: <br><br><ul><li>  se abre una ventana de phishing, cuyo contenido se descarga del directorio <b>&lt;% external storage%&gt; / hgps / &lt;% filename%&gt;</b> </li><li>  se abre una ventana de phishing, cuyo contenido se descarga del servidor <b>&lt;% url%&gt;? id = &lt;% Bot id%&gt; &amp; app = &lt;% Application name%&gt;</b> </li><li>  Se abre una ventana de phishing disfrazada de una Tarjeta Google Play, con la capacidad de ingresar informaci√≥n de la tarjeta. </li></ul><br>  La aplicaci√≥n env√≠a el resultado de la ejecuci√≥n de cualquier comando a <b>&lt;% CnC%&gt; \ set_state.php</b> como un objeto JSON del siguiente formato: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:&lt;%command%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%command_id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>:&lt;%command_state%&gt; } <span class="hljs-string"><span class="hljs-string">"id"</span></span>:&lt;%bot_id%&gt; }</code> </pre> <br>  <b>Acciones de servicio</b> <br><br>  La lista de comandos que procesa la aplicaci√≥n incluye <b>acciones</b> .  Al recibir un comando, el m√≥dulo de procesamiento de comandos accede a este servicio para ejecutar un comando extendido.  El servicio acepta un objeto JSON como par√°metro.  Un servicio puede ejecutar los siguientes comandos: <br><br>  <b>1.</b> <b>PARAMS_ACTION</b> : al recibir dicho comando, el servicio recibe, en primer lugar, del par√°metro JSON el valor mediante la tecla Tipo, puede ser el siguiente: <br><br><ul><li>  <b>serviceInfo</b> : el subcomando recibe del par√°metro JSON el valor de la clave <b>includeNotImportant</b> .  Si el indicador es True, la aplicaci√≥n establece el indicador <b>FLAG_ISOLATED_PROCESS</b> en un servicio que utiliza el Servicio de accesibilidad.  Por lo tanto, el servicio se lanzar√° en un proceso separado. </li><li>  <b>root</b> : obtener y enviar al servidor informaci√≥n sobre la ventana, que ahora est√° enfocada.  Una aplicaci√≥n recupera informaci√≥n utilizando la clase AccessibilityNodeInfo. </li><li>  <b>admin</b> : solicita derechos de administrador. </li><li>  <b>delay</b> : suspende el ActionsService por la cantidad de milisegundos que se especifica en el par√°metro con la tecla "datos". </li><li>  <b>ventanas</b> : env√≠e una lista de ventanas visibles para el usuario. </li><li>  <b>instalar</b> : instala la aplicaci√≥n en un dispositivo infectado.  El nombre del paquete - archivo est√° en la clave "fileName".  El archivo en s√≠ est√° ubicado en el directorio de Descargas. </li><li>  <b>global</b> : el subcomando est√° dise√±ado para realizar la transici√≥n desde la ventana actual: <br><ul><li>  en el men√∫ de Configuraci√≥n r√°pida </li><li>  volver </li><li>  casa </li><li>  a las notificaciones </li><li>  a la ventana de aplicaciones abiertas recientemente </li></ul><br></li><li>  <b>launch</b> : inicia la aplicaci√≥n.  El nombre de la aplicaci√≥n viene como par√°metro por la clave de <b>datos</b> . </li><li>  <b>sonidos</b> : cambie el modo de sonido a silencio. </li><li>  <b>desbloquear</b> : enciende la luz de fondo de la pantalla y el teclado a pleno brillo.  La aplicaci√≥n realiza esta acci√≥n usando WakeLock, la cadena [Etiqueta de la aplicaci√≥n]: INFO </li><li>  <b>permissionOverlay</b> : la funci√≥n no est√° implementada (la respuesta a la ejecuci√≥n del comando es {"mensaje": "No es compatible"} o {"mensaje": "sdk bajo"}) </li><li>  <b>gesto</b> : la funci√≥n no est√° implementada (la respuesta a la ejecuci√≥n del comando es {"mensaje": "No es compatible"} o {"mensaje": "API baja"}) </li><li>  <b>permisos</b> : este comando es necesario para solicitar permisos para la aplicaci√≥n.  Sin embargo, la funci√≥n de consulta no est√° implementada, por lo que el comando no tiene sentido.  La lista de derechos solicitados viene como una matriz JSON con la clave "permisos".  Lista est√°ndar: <br><br><ul><li>  android.permission.READ_PHONE_STATE </li><li>  android.permission.READ_CONTACTS </li><li>  android.permission.CALL_PHONE </li><li>  android.permission.RECEIVE_SMS </li><li>  android.permission.SEND_SMS </li><li>  android.permission.READ_SMS </li><li>  android.permission.READ_EXTERNAL_STORAGE </li><li>  android.permission.WRITE_EXTERNAL_STORAGE </li></ul><br></li><li>  <b>abierto</b> : muestra una ventana de phishing.  Dependiendo del par√°metro que provenga del servidor, la aplicaci√≥n puede mostrar las siguientes ventanas de phishing: <br><br><ul><li>  Muestra una ventana de phishing, cuyo contenido est√° escrito en el archivo en el directorio <b>&lt;% directorio externo%&gt; / hgps / &lt;% param_filename%&gt;</b> .  El resultado de la interacci√≥n del usuario con la ventana se enviar√° a <b>&lt;% CnC%&gt; / records.php</b> </li><li>  Mostrar una ventana de phishing cuyos contenidos est√°n precargados desde la direcci√≥n <b>&lt;% url_param%&gt;? Id = &lt;% bot_id%&gt; &amp; app = &lt;% packagename%&gt;</b> .  El resultado de la interacci√≥n del usuario con la ventana se enviar√° a <b>&lt;% CnC%&gt; / records.php</b> </li><li>  Mostrar ventana de phishing disfrazada de una tarjeta Google Play. </li></ul></li><li>  <b>interactivo</b> : el comando est√° dise√±ado para interactuar con elementos de ventana de otras aplicaciones que utilizan AcessibilityService.  Para la interacci√≥n, se implementa un servicio especial en el programa.  La aplicaci√≥n en estudio puede interactuar con las ventanas: <br><ul><li>  Activo en este momento.  En este caso, el par√°metro contiene la identificaci√≥n o el texto (nombre) del objeto con el que es necesario interactuar. </li><li>  Visible para el usuario en el momento en que se ejecuta el comando.  La aplicaci√≥n selecciona ventanas por id. </li></ul><br>  Al recibir los objetos <b>AccessibilityNodeInfo</b> para los elementos de ventana de inter√©s, la aplicaci√≥n, seg√∫n los par√°metros, puede realizar acciones: <br><ul><li>  focus: establece el foco en el objeto. </li><li>  clic: haga clic en un objeto. </li><li>  actionId: realiza una acci√≥n por ID. </li><li>  setText: cambia el texto del objeto.  Es posible cambiar el texto de dos maneras: realice la acci√≥n <b>ACTION_SET_TEXT</b> (si la versi√≥n de Android del dispositivo infectado es m√°s joven o igual a <b>LOLLIPOP</b> ), o colocando una l√≠nea en el portapapeles y peg√°ndola en el objeto (para versiones anteriores).  Este comando se puede usar para cambiar datos en una aplicaci√≥n bancaria. </li></ul></li></ul><br>  <b>2.</b> <b>PARAMS_ACTIONS</b> : lo mismo que <b>PARAMS_ACTION</b> , solo viene la matriz de comandos JSON. <br><br>  Parece que muchos estar√°n interesados ‚Äã‚Äãen c√≥mo se ve la funci√≥n de interactuar con elementos de ventana de otra aplicaci√≥n.  As√≠ es como se implementa esta funcionalidad en Gustuff: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interactiveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List aiList, JSONObject action, JsonObject res)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = action.optInt(<span class="hljs-string"><span class="hljs-string">"repeat"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Iterator aiListIterator = ((Iterable)aiList).iterator(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(aiListIterator.hasNext()) { Object ani = aiListIterator.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(index = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; ++index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"click"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">16</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(action.optInt(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>))) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>)) { customHeader ch = CustomAccessibilityService.a; Context context = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getApplicationContext(); String text = action.optString(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(performSetTextAction(ch, context, ((AccessibilityNodeInfo)ani), text)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(index == count) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } ((AccessibilityNodeInfo)ani).recycle(); } res.addPropertyNumber(<span class="hljs-string"><span class="hljs-string">"res"</span></span>, Integer.valueOf(count)); }</code> </pre> <br>  Funci√≥n de reemplazo de texto: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performSetTextAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AccessibilityNodeInfo ani, String text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Build$VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">21</span></span>) { Bundle b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); b.putCharSequence(<span class="hljs-string"><span class="hljs-string">"ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE"</span></span>, ((CharSequence)text)); result = ani.performAction(<span class="hljs-number"><span class="hljs-number">0x200000</span></span>, b); <span class="hljs-comment"><span class="hljs-comment">// ACTION_SET_TEXT } else { Object clipboard = context.getSystemService("clipboard"); if(clipboard != null) { ((ClipboardManager)clipboard).setPrimaryClip(ClipData.newPlainText("autofill_pm", ((CharSequence)text))); result = ani.performAction(0x8000); // ACTION_PASTE } else { result = false; } } return result; }</span></span></code> </pre> <br>  Por lo tanto, si el servidor de control est√° configurado correctamente, Gustuff puede completar los campos de texto en la aplicaci√≥n bancaria y hacer clic en los botones necesarios para la transacci√≥n.  El troyano ni siquiera necesita autorizaci√≥n en la aplicaci√≥n, solo env√≠e un comando para demostrar la notificaci√≥n PUSH, seguido de la apertura de la aplicaci√≥n bancaria previamente instalada.  El usuario pasar√° por una autorizaci√≥n, despu√©s de lo cual Gustuff podr√° rellenarse autom√°ticamente. <br><br><h3>  M√≥dulo de procesamiento de SMS </h3><br>  La aplicaci√≥n configura el controlador de eventos para aceptar mensajes SMS del dispositivo infectado.  La aplicaci√≥n en estudio puede recibir comandos del operador que vienen en el cuerpo de los mensajes SMS.  Los comandos vienen en el formato: <br><br>  <b>7! 5 = &lt;% Comando codificado Base64%&gt;</b> <br><br>  La aplicaci√≥n busca en todos los mensajes SMS entrantes la cadena <b>7! 5 =</b> , si detecta una cadena, decodifica una cadena Base64 en el desplazamiento 4 y ejecuta el comando.  Los comandos son similares a los comandos con CnC.  El resultado de la ejecuci√≥n se env√≠a al mismo n√∫mero del que proviene el comando.  Formato de respuesta: <br><br>  <b>7 * 5 = &lt;% Codificaci√≥n Base64 del "comando result_code"%&gt;</b> <br><br>  Opcionalmente, la aplicaci√≥n puede enviar todos los mensajes recibidos al n√∫mero ra√≠z.  Para hacer esto, se debe especificar un n√∫mero de ra√≠z en el archivo de preferencias y se establece el indicador de redirecci√≥n de mensajes.  Se env√≠a un mensaje SMS al n√∫mero del atacante en el formato: <br><br>  <b>&lt;% Del n√∫mero%&gt; - &lt;% Hora, formato: dd / MM / aaaa HH: mm: ss%&gt; &lt;% SMS body%&gt;</b> <br><br>  Tambi√©n opcionalmente, la aplicaci√≥n puede enviar mensajes a CnC.  El mensaje SMS se env√≠a al servidor en formato JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%BotID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"sms"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>:&lt;%SMS body%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%From number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:&lt;%Timestamp%&gt; } }</code> </pre> <br>  Si se establece el flag <b>nameGenerator ("DEFAULT_APP_SMS")</b> , la aplicaci√≥n deja de procesar mensajes SMS y borra la lista de mensajes entrantes. <br><br><h3>  M√≥dulo proxy </h3><br>  En la aplicaci√≥n en estudio, hay un m√≥dulo Proxy de Backconnect (en adelante denominado el m√≥dulo Proxy), que tiene una clase separada que incluye campos est√°ticos con configuraci√≥n.  Los datos de configuraci√≥n se almacenan en la muestra en forma abierta: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/4f/mi/g-4fmidam6alfsjuhw1ltmcodhy.png" alt="imagen alt"></div><br><br>  Todas las acciones realizadas por el m√≥dulo Proxy se registran en los archivos.  Para hacer esto, la aplicaci√≥n en Almacenamiento externo crea un directorio llamado "registros" (el campo ProxyConfigClass.logsDir en la clase de configuraci√≥n), en el que se almacenan los archivos de registro.  El registro se produce en archivos con nombres: <br><br><ol><li>  <b>main.txt</b> : esta clase <b>registra el</b> funcionamiento de la clase con el nombre CommandServer.  El registro posterior de la cadena str en este archivo se indicar√° como mainLog (str). </li><li>  <b>session - &lt;% id%&gt;. txt</b> - los datos de registro asociados con una sesi√≥n proxy espec√≠fica se guardan en este archivo.  El registro posterior de la cadena str en este archivo se denominar√° sessionLog (str). </li><li>  <b>server.txt</b> : estos datos registran todos los datos escritos en los archivos anteriores. </li></ol><br>  Formato de datos de registro: <br><br>  &lt;% Date%&gt; [Thread [&lt;% thread id%&gt;], id []]: log-string <br><br>  Las excepciones que ocurren durante la operaci√≥n del m√≥dulo Proxy tambi√©n se registran en un archivo.  Para esto, la aplicaci√≥n genera un objeto JSON del formato: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"uncaughtException"</span></span>:&lt;%short description of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"thread"</span></span>:&lt;%thread%&gt; <span class="hljs-string"><span class="hljs-string">"message"</span></span>:&lt;%detail message of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"trace"</span></span>: //Stack trace info [ { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: }, { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: } ] }</code> </pre> <br>  Luego lo convierte en una representaci√≥n de cadena y registros. <br><br>  El m√≥dulo proxy se inicia despu√©s de la recepci√≥n del equipo apropiado.  Cuando llega un comando para iniciar el m√≥dulo Proxy, la aplicaci√≥n inicia un servicio llamado <b>MainService</b> , que es responsable de controlar el funcionamiento del m√≥dulo Proxy: su inicio y detenci√≥n. <br><br>  Etapas de inicio del servicio: <br><br>  <b>1.</b> Inicia un temporizador que funciona una vez por minuto y verifica la actividad del m√≥dulo proxy.  Si el m√≥dulo no est√° activo, lo inicia. <br>  Adem√°s, cuando se activa el evento <b>android.net.conn.CONNECTIVITY_CHANGE</b> , se inicia el m√≥dulo Proxy. <br><br>  <b>2. La</b> aplicaci√≥n crea un bloqueo de <b>activaci√≥n</b> con el par√°metro <b>PARTIAL_WAKE_LOCK</b> y lo captura.  Por lo tanto, no permite que la CPU del dispositivo entre en modo de suspensi√≥n. <br><br>  <b>3.</b> Inicia la clase de procesamiento de comandos del m√≥dulo proxy registrando primero la l√≠nea mainLog <b>("iniciar servidor")</b> y <br><br>  <b>Servidor :: servidor de inicio () [&lt;% proxy_cnc%&gt;], commandPort [&lt;% command_port%&gt;], proxyPort [&lt;% proxy_port%&gt;]</b> <br><br>  donde <b>proxy_cnc, command_port y proxy_port</b> son los par√°metros obtenidos de la configuraci√≥n del servidor proxy. <br><br>  La clase de procesamiento de comandos se llama <b>CommandConnection</b> .  Inmediatamente despu√©s del lanzamiento, realiza las siguientes acciones: <br><br>  <b>4.</b> Se conecta a <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.commandPort</b> y env√≠a all√≠ los datos sobre el dispositivo infectado en formato JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidVersion"</span></span>:&lt;%androidVersion%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"partnerId"</span></span>:&lt;%partnerId%&gt;, <span class="hljs-attr"><span class="hljs-attr">"packageName"</span></span>:&lt;%packageName%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkType"</span></span>:&lt;%networkType%&gt;, <span class="hljs-attr"><span class="hljs-attr">"hasGsmSupport"</span></span>:&lt;%hasGsmSupport%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simReady"</span></span>:&lt;%simReady%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simCountry"</span></span>:&lt;%simCountry%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkOperator"</span></span>:&lt;%networkOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simOperator"</span></span>:&lt;%simOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>:&lt;%version%&gt; }</code> </pre> <br>  Donde: <br><br><ul><li>  id: identificador que intenta obtener el valor con el campo "id" del archivo de preferencias compartidas con el nombre "x".  Si no se puede obtener este valor, genera uno nuevo.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por lo tanto, el m√≥dulo proxy tiene su propio identificador, que se genera de manera similar a la ID de Bot. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imei: dispositivos IMEI. </font><font style="vertical-align: inherit;">Si se produjo un error al recibir el valor, se escribir√° un mensaje de texto de error en lugar de este campo.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imsi: dispositivos de identidad de suscriptor m√≥vil internacional. </font><font style="vertical-align: inherit;">Si se produjo un error al recibir el valor, se escribir√° un mensaje de texto de error en lugar de este campo.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modelo: el nombre visible para el usuario final del producto final. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fabricante: el fabricante del producto / hardware (Build.MANUFACTURER). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> androidVersion: una cadena en el formato "&lt;% release_version%&gt; (&lt;% os_version%&gt;), &lt;% sdk_version%&gt;" </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pa√≠s: la ubicaci√≥n actual del dispositivo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partnerId es una cadena vac√≠a. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> packageName: nombre del paquete. </font></font></li><li> networkType ‚Äî     (: ¬´WIFI¬ª, ¬´MOBILE¬ª).     null. </li><li> hasGsmSupport ‚Äì true ‚Äì    GSM,  false. </li><li> simReady ‚Äì  SIM-. </li><li> simCountry ‚Äî ISO-  (  ÃÜ -). </li><li> networkOperator ‚Äî  .        ‚Äî         . </li><li> simOperator ‚Äî The Service Provider Name (SPN).        ‚Äî         . </li><li> version ‚Äî     -,   ÃÜ     ¬´1.6¬ª. </li></ul><br> <b>5.</b>       .      : <br><br><ul><li> 0 offset ‚Äì command </li><li> 1 offset ‚Äì sessionId </li><li> 2 offset ‚Äì length </li><li> 4 offset ‚Äî data </li></ul><br>     : <br><br> <b>mainLog(¬´Header { sessionId&lt;%id%&gt;], type[&lt;%command%&gt;], length[&lt;%length%&gt;] }¬ª)</b> <br><br>     : <br><br><table><tbody><tr><th> Name </th><th> Command </th><th> Data </th><th>  Descripci√≥n </th></tr><tr><td> <b>connectionId</b> </td><td>  0 0 </td><td> Connection ID </td><td>    </td></tr><tr><td> <b>SLEEP</b> </td><td>  3 </td><td>  Tiempo </td><td>   Proxy- </td></tr><tr><td> <b>PING_PONG</b> </td><td>  4 4 </td><td>  - </td><td>  PONG- </td></tr></tbody></table><br> PONG-   4     : <b>0x04000000</b> . <br><br>    connectionId (   ) <b>CommandConnection</b>    <b>ProxyConnection</b> . <br><br><ul><li>      : <b>ProxyConnection</b>  <b>end</b> .    <b>ProxyConnection</b>     <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.proxyPort</b>   JSON-: </li></ul><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%connectionId%&gt; }</code> </pre> <br>     SOCKS5-,     ,     . ÃÜ       <b>end</b> .       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hz/ed/y7/hzedy7sapdijp20ayiacbiwarc8.png" alt="imagen alt"></div><br><h2>  ÃÜ </h2><br>       ÃÜ  CnC-        SSL.             JSON-.       : <br><br><ul><li> <b>http://&lt;%CnC%&gt;/api/v1/set_state.php</b> ‚Äî   . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/get.php</b> ‚Äî  . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_sms.php</b> ‚Äî  SMS-ÃÜ   ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_ab.php</b> ‚Äî      ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/aevents.php</b> ‚Äì     ,   preference-ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_card.php</b> ‚Äî  ,    -,   Google Play Market. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/logs.php</b> ‚Äì  -. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/records.php</b> ‚Äì  ,     . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_error.php</b> ‚Äì   ÃÜ . </li></ul><br><h2>  </h2><br>              ,          ,     . <br><br>              ,    .               ,   ,             . <br><br>    ‚Äì   - ,      ,      -,    , ,     ,       ,     . <br><br><h3>    : </h3><br><ul><li>         Android  - ,  Google Play; </li><li>     <b> </b>    ; </li><li>     Android; </li><li>      ; </li><li>    ; </li><li>    ,   SMS-. </li></ul><br>   <b> </b> ,          Group-IB. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446948/">https://habr.com/ru/post/446948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446932/index.html">TDMS Fairway y BIM</a></li>
<li><a href="../446938/index.html">Sistema de part√≠culas en Core Animation. Cuento de navidad</a></li>
<li><a href="../446940/index.html">QA en prod. Porque es genial</a></li>
<li><a href="../446942/index.html">Servidor, ¬øme oyes? Ataque BROP en el ejemplo de la tarea NeoQUEST-2019</a></li>
<li><a href="../446944/index.html">¬øPor qu√© invertir en empresas no rentables?</a></li>
<li><a href="../446950/index.html">El 76% de los fabricantes no tienen experiencia en la implementaci√≥n de aditivos. ¬øPor qu√© es bueno?</a></li>
<li><a href="../446952/index.html">Crea histogramas animados usando R</a></li>
<li><a href="../446956/index.html">Es da√±ino para la luz o para mantener la carga de la bater√≠a de un autom√≥vil.</a></li>
<li><a href="../446958/index.html">Complicado perl quine</a></li>
<li><a href="../446960/index.html">La casa que construy√≥ Jack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>