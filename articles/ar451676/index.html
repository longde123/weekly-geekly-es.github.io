<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌠 🌯 📕 ضبط الأداء واستكشاف أخطاء قاعدة البيانات هذه الأيام ⛹🏿 🖕🏿 🖖🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="لسوء الحظ ، يتم الآن تقليل دور المتخصصين في ضبط الأداء واستكشاف الأخطاء وإصلاحها في قواعد البيانات إلى آخرها فقط - استكشاف الأخطاء وإصلاحها: إنهم دائم...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ضبط الأداء واستكشاف أخطاء قاعدة البيانات هذه الأيام</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451676/" style=";text-align:right;direction:rtl">  لسوء الحظ ، يتم الآن تقليل دور المتخصصين في ضبط الأداء واستكشاف الأخطاء وإصلاحها في قواعد البيانات إلى آخرها فقط - استكشاف الأخطاء وإصلاحها: إنهم دائمًا ما يتحولون إلى متخصصين فقط عندما تصل المشكلات بالفعل إلى نقطة حرجة ، ويجب حلها "بالأمس".  وحتى مع ذلك ، من الجيد أن يتم تشغيلها ، ولا تؤجل المشكلة عن طريق شراء أجهزة أكثر تكلفة وأقوى بدون مراجعة أداء واختبارات إجهاد مفصلة.  في الواقع ، غالبًا ما تكون الإحباطات كافية: لقد اشتروا معدات بقيمة 2-5 مرات أكثر تكلفة ، وفازوا في الأداء بنسبة 30-40٪ فقط ، وتؤكل الزيادة بأكملها في غضون بضعة أشهر إما عن طريق زيادة عدد المستخدمين ، أو بزيادة هائلة في البيانات ، إلى جانب تعقيد المنطق. <br><br>  والآن ، في الوقت الذي ينمو فيه عدد المهندسين المعماريين والمختبرين ومهندسي DevOps بشكل سريع ، يعمل مطورو Java Core على تحسين العمل حتى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مع السلاسل</a> ، ببطء ولكن بثبات حان الوقت لمحسّن قاعدة البيانات.  أصبحت نظم إدارة قواعد البيانات (DBMS) مع كل إصدار أكثر ذكاءً وتعقيدًا بحيث تتطلب دراسة الفروق الدقيقة الموثقة وغير الموثقة والتحسينات وقتًا كبيرًا.  يتم نشر عدد كبير من المقالات شهريًا وتعقد مؤتمرات رئيسية مخصصة لـ Oracle.  نأسف لهذا التشبيه المألوف ، ولكن في هذه الحالة ، عندما يصبح مسؤولو قواعد البيانات مشابهين للطيارين في الطائرة مع عدد لا يحصى من مفاتيح التبديل والأزرار والأضواء والشاشات ، فمن غير المناسب بالفعل تحميلها مع التفاصيل الدقيقة لتحسين الأداء. <br><a name="habracut"></a><br>  بالطبع ، يمكن لـ DBA ، مثل الطيارين ، في معظم الحالات حل المشكلات الواضحة والبسيطة بسهولة عندما يتم تشخيصها أو ملاحظتها بسهولة في "قمم" مختلفة (أهم الأحداث ، أعلى SQL ، القطاعات العليا ...).  والتي يسهل العثور عليها على MOS أو Google ، حتى لو كانوا لا يعرفون الحل.  يكون الأمر أكثر تعقيدًا حتى عندما يتم إخفاء الأعراض خلف تعقيد النظام وتحتاج إلى اكتشافها بين الكم الهائل من المعلومات التشخيصية التي يتم جمعها بواسطة Oracle DBMS نفسها. <br><br>  أحد الأمثلة الأكثر بساطة والأكثر لفتا للنظر في هذا هو تحليل عوامل التصفية والوصول: في الأنظمة الكبيرة والمحملة ، يحدث غالبًا أن يتم التغاضي عن هذه المشكلة بسهولة ، لأن  يتم توزيع الحمل بشكل متساوٍ إلى حد ما على طلبات مختلفة (مع وصلات لجداول مختلفة ، مع وجود اختلافات طفيفة في الظروف ، وما إلى ذلك) ، ولا تظهر الأجزاء العليا أي شيء خاص ، ويقولون "حسنًا ، نعم ، غالبًا ما تكون البيانات مطلوبة من هذه الجداول وهناك المزيد" .  في مثل هذه الحالات ، يمكنك بدء التحليل بإحصائيات من SYS.COL_USAGE $: <a href="">col_usage.sql</a> <br><br><pre style=";text-align:right;direction:rtl"><code class="sql hljs">col owner format a30 col oname format a30 heading "Object name" col cname format a30 heading "Column name" accept owner_mask prompt "Enter owner mask: "; accept tab_name prompt "Enter tab_name mask: "; accept col_name prompt "Enter col_name mask: "; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> a.username <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> owner ,o.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> oname ,c.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cname ,u.equality_preds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> equality_preds ,u.equijoin_preds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> equijoin_preds ,u.nonequijoin_preds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> nonequijoin_preds ,u.range_preds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> range_preds ,u.like_preds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> like_preds ,u.null_preds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> null_preds ,to_char(u.timestamp, <span class="hljs-string"><span class="hljs-string">'yyyy-mm-dd hh24:mi:ss'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.col_usage$ u , sys.obj$ o , sys.col$ c , all_users a <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> a.user_id = o.owner<span class="hljs-comment"><span class="hljs-comment"># AND u.obj# = o.obj# AND u.obj# = c.obj# AND u.intcol# = c.col# AND a.username like upper('&amp;owner_mask') AND o.name like upper('&amp;tab_name') AND c.name like upper('&amp;col_name') ORDER BY a.username, o.name, c.name ; col owner clear; col oname clear; col cname clear; undef tab_name col_name owner_mask;</span></span></code> </pre> <br>  ومع ذلك ، لتحليل كامل لهذه المعلومات ليست كافية ، لأنه  أنها لا تظهر مجموعات من المسندات.  في هذه الحالة ، يمكن أن يساعدنا تحليل v $ active_session_history و v $ sql_plan: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ash <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> sql_id ,plan_hash_value ,table_name ,<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> ,ACCESS_PREDICATES ,FILTER_PREDICATES ,<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> h.sql_id ,h.SQL_PLAN_HASH_VALUE plan_hash_value ,<span class="hljs-keyword"><span class="hljs-keyword">decode</span></span>(p.OPERATION ,<span class="hljs-string"><span class="hljs-string">'TABLE ACCESS'</span></span>,p.OBJECT_OWNER||<span class="hljs-string"><span class="hljs-string">'.'</span></span>||p.OBJECT_NAME ,(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> i.TABLE_OWNER||<span class="hljs-string"><span class="hljs-string">'.'</span></span>||i.TABLE_NAME <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dba_indexes i <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> i.OWNER=p.OBJECT_OWNER <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> i.index_name=p.OBJECT_NAME) ) table_name ,OBJECT_ALIAS <span class="hljs-keyword"><span class="hljs-keyword">ALIAS</span></span> ,p.ACCESS_PREDICATES ,p.FILTER_PREDICATES <span class="hljs-comment"><span class="hljs-comment">-- ,         : -- ,h.sql_plan_operation -- ,h.sql_plan_options -- ,decode(h.session_state,'ON CPU','ON CPU',h.event) event -- ,h.current_obj# from v$active_session_history h ,v$sql_plan p where h.sql_opname='SELECT' and h.IN_SQL_EXECUTION='Y' and h.sql_plan_operation in ('INDEX','TABLE ACCESS') and p.SQL_ID = h.sql_id and p.CHILD_NUMBER = h.SQL_CHILD_NUMBER and p.ID = h.SQL_PLAN_LINE_ID --     3 : -- and h.sample_time &gt;= systimestamp - interval '3' hour ) --       : -- where table_name='&amp;OWNER.&amp;TABNAME' group by sql_id ,plan_hash_value ,table_name ,alias ,ACCESS_PREDICATES ,FILTER_PREDICATES ) ,agg_by_alias as ( select table_name ,regexp_substr(ALIAS,'^[^@]+') ALIAS ,listagg(ACCESS_PREDICATES,' ') within group(order by ACCESS_PREDICATES) ACCESS_PREDICATES ,listagg(FILTER_PREDICATES,' ') within group(order by FILTER_PREDICATES) FILTER_PREDICATES ,sum(cnt) cnt from ash group by sql_id ,plan_hash_value ,table_name ,alias ) ,agg as ( select table_name ,'ALIAS' alias ,replace(access_predicates,'"'||alias||'".','"ALIAS".') access_predicates ,replace(filter_predicates,'"'||alias||'".','"ALIAS".') filter_predicates ,sum(cnt) cnt from agg_by_alias group by table_name ,replace(access_predicates,'"'||alias||'".','"ALIAS".') ,replace(filter_predicates,'"'||alias||'".','"ALIAS".') ) ,cols as ( select table_name ,cols ,access_predicates ,filter_predicates ,sum(cnt)over(partition by table_name,cols) total_by_cols ,cnt from agg ,xmltable( 'string-join(for $c in /ROWSET/ROW/COL order by $c return $c,",")' passing xmltype( cursor( (select distinct nvl( regexp_substr( access_predicates||' '||filter_predicates ,'("'||alias||'"\.|[^.]|^)"([A-Z0-9#_$]+)"([^.]|$)' ,1 ,level ,'i',2 ),' ') col from dual connect by level&lt;=regexp_count( access_predicates||' '||filter_predicates ,'("'||alias||'"\.|[^.]|^)"([A-Z0-9#_$]+)"([^.]|$)' ) ) )) columns cols varchar2(400) path '.' )(+) order by total_by_cols desc, table_name, cnt desc ) select table_name ,cols ,sum(cnt)over(partition by table_name,cols) total_by_cols ,access_predicates ,filter_predicates ,cnt from cols where rownum&lt;=50 order by total_by_cols desc, table_name, cnt desc;</span></span></code> </pre><br>  كما ترون من الاستعلام نفسه ، فإنه يعرض أفضل 50 عمود بحث ويتوقع أنفسهم بعدد مرات ظهور ASH في الساعات الثلاث الأخيرة.  على الرغم من حقيقة أن ASH تقوم بتخزين اللقطات فقط كل ثانية ، إلا أن أخذ العينات في القواعد المحمّلة يمثل تمثيليًا كبيرًا.  يمكن أن يوضح عدة نقاط: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يعرض حقل cols - أعمدة البحث نفسها ، و total_by_cols - مجموع الإدخالات في سياق هذه الأعمدة. </li><li style=";text-align:right;direction:rtl">  أعتقد أنه من الواضح أن هذه المعلومات في حد ذاتها ليست علامة كافية على المشكلة ، لأنه  على سبيل المثال ، يمكن للعديد من عمليات المسح الكامل لمرة واحدة أن تدمر الإحصائيات بسهولة ، لذلك سيكون عليك بالتأكيد التفكير في الاستعلامات نفسها وتواترها (v $ sqlstats ، dba_hist_sqlstat) </li><li style=";text-align:right;direction:rtl">  التجميع حسب OBJECT_ALIAS داخل SQL_ID ، plan_hash_value مهم لدمج تقديرات الجدول والجدول بحسب الكائن ، لأن  عند الوصول إلى الجدول من خلال الفهرس ، سيتم تقسيم المسند إلى خطوط مختلفة من الخطة: <br><img src="https://habrastorage.org/webt/ww/p8/uo/wwp8uovm0hfvpyn5_2n0srldszs.png" alt="صورة"><br></li></ul><br>  حسب الحاجة ، يمكن تعديل هذا البرنامج النصي بسهولة لجمع معلومات إضافية في أقسام أخرى ، على سبيل المثال ، مع مراعاة التقسيم أو التوقعات.  وبعد تحليل هذه المعلومات بالفعل ، إلى جانب تحليل إحصائيات الجدول وفهارسه ، ونظام البيانات العام ومنطق الأعمال ، يمكنك تمرير توصيات للمطورين أو المهندسين المعماريين لاختيار حل ، على سبيل المثال: خيارات لإزالة الطابع أو تغيير مخطط التقسيم أو فهارسه. <br><br>  غالبًا ما يتم نسيان تحليل حركة مرور SQL * net ، وهناك أيضًا العديد من التفاصيل الدقيقة ، على سبيل المثال: fetch-size ، SQLNET.COMPRESSION ، وأنواع البيانات الموسعة ، التي تسمح بتقليل عدد رحلات Roundtripes ، وما إلى ذلك ، ولكن هذا موضوع لمقال منفصل. <br><br>  في الختام ، أود أن أقول إنه بعد أن أصبح المستخدمون أقل تسامحًا مع التأخير ، أصبح تحسين الأداء ميزة تنافسية. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar451676/">https://habr.com/ru/post/ar451676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar451666/index.html">جعل توقيت العد التنازلي في جداول جوجل</a></li>
<li><a href="../ar451668/index.html">ACPI: إضافة أجهزة بدون إعادة ترجمة Kernel</a></li>
<li><a href="../ar451670/index.html">متحكم افتراضي 4 بت مع برمجة بثلاثة أزرار وأربعة مفاتيح</a></li>
<li><a href="../ar451672/index.html">مفهوم برج الجاهزة مع غطاء قبة أساسا لرصد الفلكية</a></li>
<li><a href="../ar451674/index.html">البرامج المعرفة للراديو - كيف يعمل؟ الجزء 1</a></li>
<li><a href="../ar451678/index.html">جميع تحليلاتك متاحة للجمهور.</a></li>
<li><a href="../ar451680/index.html">سيم العمق: الخبرة. الذين قواعد الارتباط هي أفضل</a></li>
<li><a href="../ar451682/index.html">خيالي جدا "بدايات" من إقليدس في تكس</a></li>
<li><a href="../ar451690/index.html">قراءة البوم</a></li>
<li><a href="../ar451694/index.html">انتبه # 4: ملخص المقالات حول التفكير المنتج ، علم النفس السلوكي والإنتاجية</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>