<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÉ üßëüèΩ üëÅÔ∏è SVG na vida real. Relat√≥rio Yandex üíÜ üîú üëÉüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, meu nome √© Artyom, sou o chefe de um dos grupos de desenvolvimento de interfaces no Yandex. H√° uma semana, no Ya. Subbotnik, contei como usamos o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SVG na vida real. Relat√≥rio Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/461571/"> Ol√°, meu nome √© Artyom, sou o chefe de um dos grupos de desenvolvimento de interfaces no Yandex.  H√° uma semana, no Ya. Subbotnik, contei como usamos o SVG para criar um calend√°rio interno.  Esta √© uma transcri√ß√£o do meu relat√≥rio, com v√°rias hist√≥rias da implementa√ß√£o do widget de calend√°rio: dimensionamento, preenchimento de padr√µes, m√°scaras, s√≠mbolos e recursos de formato. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/af/hj/b2/afhjb2fysygwu1kqxtxppwd181k.jpeg"></a> <br><br>  - Muitas pessoas trabalham no Yandex, todas em cidades diferentes, em fusos hor√°rios diferentes, e voc√™ precisa entender quando seus colegas est√£o ocupados e quando voc√™ pode encontrar e conversar com eles.  Decidimos criar um calend√°rio que ajudar√° a descobrir. <br><br><a name="habracut"></a>  Come√ßamos, √© claro, com um layout.  Ele ficou assim: <br><br><img src="https://habrastorage.org/webt/sv/5u/y0/sv5uy0sn1jwdgsv06nnvxzs2nqu.jpeg"><br><br>  Mostra eventos pares e √≠mpares com recheios diferentes.  Eventos que se sobrep√µem a outros eventos, ou seja, est√£o na segunda camada - outro preenchimento.  Eventos que duram o dia todo s√£o pintados o dia todo.  A hora atual √© exibida abaixo.  Esse era o objetivo. <br><br><img src="https://habrastorage.org/webt/98/xk/b3/98xkb3ij0xigknbxr2cuh_ceazw.jpeg"><br><br>  Come√ßamos a escolher o que faremos.  Criou v√°rios prot√≥tipos diferentes.  Come√ßamos com a tela, mas havia muito c√≥digo, redimensionando manualmente para escrever.  T√≠nhamos a ideia de que o calend√°rio ocupa tanto espa√ßo quanto necess√°rio; em layouts diferentes, ele tem diferentes formas e tamanhos.  E para a tela era complicado. <br><br>  Havia um prot√≥tipo bacana quando geramos toda essa imagem com gradientes lineares, mas ela foi alterada ao dimensionar e ao mudar para a retina.  Portanto, no final, chegamos ao SVG.  Porque  Em primeiro lugar, existe um sistema de coordenadas completamente independente do documento, para que voc√™ possa posicionar completamente tudo dentro, e isso n√£o ser√° interrompido, independentemente de qualquer coisa.  Tamb√©m h√° trabalho normal com dimensionamento.  Mesmo se voc√™ ampliar o navegador, abrir a retina ou esticar o calend√°rio de alguma forma, ele ser√° redimensionado como uma imagem e, em qualquer caso, parecer√° normal.  Tivemos um preenchimento de c√©lula no layout, e √© muito bom que o SVG tenha um preenchimento de padr√£o. <br><br><img src="https://habrastorage.org/webt/2k/fr/gg/2kfrgg1wo76nrglcb5porf-rx88.jpeg"><br><br>  Para desenhar um calend√°rio, voc√™ precisa de alguns dados.  Para desenhar um no layout, voc√™ precisa saber em que data ele come√ßa - geralmente o atual - para saber quantos dias devem ser horizontais, quantas horas devem ser exibidas na vertical e a que horas come√ßa o dia no calend√°rio.  Precisamos, de alguma forma, receber eventos. <br><br>  Como temos muitos escrit√≥rios em diferentes fusos hor√°rios, decidimos que os eventos sempre chegar√£o ao UTC e j√° os exibiremos no cliente para usu√°rios, pois √© necess√°rio consultar o calend√°rio do nosso fuso hor√°rio e do fuso hor√°rio da pessoa, em qual calend√°rio voc√™ est√° olhando - para entender que agora √© noite e √© melhor n√£o marcar uma consulta.  O que est√° destacado em vermelho ser√° usado mais tarde. <br><br><img src="https://habrastorage.org/webt/ve/zu/lf/vezulfk7ebhp9tbicgmjrahsagc.jpeg"><br><br>  Vamos come√ßar com o b√°sico.  SVG √© um plano de coordenadas gigante no qual gr√°ficos vetoriais podem ser colocados arbitrariamente.  Ao mesmo tempo, a parte da √°rea que vemos √© determinada pela viewBox, e o que est√° por tr√°s de suas bordas √© um estouro oculto nos ester√≥ides.  Seja o que for, n√£o ser√° vis√≠vel.  Decidimos que, para simplificar os c√°lculos, criaremos um pixel no calend√°rio igual a um minuto.  Portanto, uma hora ocupar√° exatamente 60 pixels.  Para simplificar ainda mais, decidimos que o dia em largura tamb√©m seria de 60 pixels - para que tudo fosse quadrado, como no ex√©rcito.  E eles come√ßaram a escrever. <br><br>  O Viewbox √© definido por quatro par√¢metros.  Os dois primeiros s√£o o ponto superior esquerdo no sistema de coordenadas, do qual a viewBox √© considerada, para n√≥s √© 0,0.  A largura √© 60 * para o n√∫mero de dias e a altura √© 60 * para o n√∫mero de horas. <br><br>  √â v√°lido inserir outros documentos SVG dentro do SVG, que ter√£o seu pr√≥prio sistema de coordenadas.  E para que os eventos do dia pudessem ser posicionados apenas ao longo do eixo vertical, decidimos que para cada dia ter√≠amos um SVG separado e apenas os mudar√≠amos horizontalmente em 60 * para a posi√ß√£o do dia no calend√°rio.  Ent√£o todos os eventos podem ser simplesmente definidos verticalmente em Y, ser√° muito conveniente.  E dentro de cada SVG, que √© um dia, colocamos um ret√¢ngulo que exibir√° o preenchimento do dia. <br><br>  Esse ret√¢ngulo, como nenhuma cor de preenchimento √© especificada, herdar√° a propriedade de preenchimento do SVG.  Nesse caso, este dia est√° funcionando e dois dias por semana de folga, para que sejam inundados de luz.  Isso √© determinado apenas pelas classes. <br><br><img src="https://habrastorage.org/webt/81/n0/nm/81n0nmbffb0doxecq1gvx7wcc5s.jpeg"><br><br>  H√° um espa√ßo em branco.  Agora voc√™ precisa adicionar a grade.  Como quer√≠amos redimensionar o calend√°rio e as linhas de grade sempre deveriam ter um pixel, usamos o atributo vector-effect = non-scaling-stroke.  Isso leva ao fato de que, independentemente de como redimensionamos ou aumentamos o zoom, sempre haver√° uma grade de pixel √∫nico.  Basta adicionar a quantidade certa de linhas horizontais e verticais, e haver√° uma grade desse tipo. <br><br><img src="https://habrastorage.org/webt/yw/ok/hg/ywokhgezdap7lon0dmcuisktia8.jpeg"><br><br>  N√≥s descobrimos a base, vamos para os eventos do dia todo.  Isso √© uma coisa t√£o complicada.  Voc√™ notou que h√° eventos nos calend√°rios e h√° uma marca de sele√ß√£o "o dia todo".  Esses eventos s√£o diferentes, pois acontecem o dia todo, independentemente do fuso hor√°rio em que voc√™ est√° olhando.  Portanto, se em algum lugar no in√≠cio dos fusos hor√°rios no Alasca o evento come√ßar de manh√£ cedo, em algum momento de 48 horas no extremo oposto do globo ainda continuar√°.  Parece complicado, mas √© mais f√°cil de implementar: basta comparar a data com a data do dia exibido.  Se ocorrer, significa um evento nesse dia.  Se dois eventos para o dia inteiro ca√≠rem no dia, ser√° exibido o que mais tarde come√ßou.  Ent√£o, o preenchimento mostra os eventos do dia inteiro. <br><br><img src="https://habrastorage.org/webt/7m/rz/wv/7mrzwvwwi6clluc6jdh4gqkfyiu.jpeg"><br><br>  Com outros eventos, √© um pouco mais dif√≠cil.  H√°, digamos, uma reuni√£o.  Est√° cheio de azul, tudo √© simples.  No entanto, se duas reuni√µes forem realizadas seguidas, de acordo com nosso layout, as preencheremos com cores diferentes, elas ser√£o pares e √≠mpares. <br><br>  Se uma reuni√£o se cruza com outra, fica mais alta, √© necess√°rio exibi-la de alguma forma.  Se houver interse√ß√µes com reuni√µes, elas ser√£o derramadas completamente separadamente, nas c√©lulas.  E para nos tornar ainda mais divertidos, temos n√£o apenas reuni√µes, mas tamb√©m aus√™ncias, confer√™ncias e muito mais.  Como eu n√£o queria codificar tudo isso no layout, decidimos descobrir como √© mais ou menos cross-browser e conveniente de configurar em CSS. <br><br><img src="https://habrastorage.org/webt/5g/tr/tk/5gtrtkzwlyddpnutc-pifopjssq.jpeg"><br><br>  Agora, haver√° o exemplo mais dif√≠cil de todo o relat√≥rio, seja paciente e observe, haver√° tr√™s etapas e ser√° mais f√°cil. <br><br>  Vamos come√ßar em ordem.  O SVG possui uma tag &lt;defs&gt;, que permite declarar elementos dentro dele que n√£o s√£o exibidos, mas voc√™ pode us√°-los por refer√™ncia, consultando-os.  A primeira coisa que faremos √© declarar &lt;defs&gt; e criar um padr√£o nele.  &lt;padr√£o&gt; √© uma tag que permite declarar um padr√£o que voc√™ pode usar para preencher um elemento espec√≠fico com um padr√£o espec√≠fico. <br><br>  Precisamos criar c√©lulas nesse padr√£o.  Como temos 60 por 60 pixels, as c√©lulas devem ter 6 por 6, declaramos um padr√£o de 12 por 12 e desenhamos um &lt;caminho&gt; dentro dele, como no diagrama √† esquerda.  Possui um atributo d, que indica exatamente como a linha se move.  Come√ßa a partir do ponto 0,0 e, em seguida, as coordenadas mostram as setas como s√£o desenhadas.  Se o preenchermos com branco, obtemos o seguinte padr√£o: o que n√£o √© inundado de branco, √© inundado de preto. <br><br><img src="https://habrastorage.org/webt/vg/sw/fu/vgswfu88zuzfiawxscejq7ral5o.jpeg"><br><br>  V√° para o pr√≥ximo passo, agora declare a m√°scara.  &lt;mask&gt; √© um elemento do SVG que permite adicionar um canal alfa a outros elementos.  O que √© desenhado em preto na m√°scara, naquele elemento ao qual a m√°scara √© aplicada, √© invis√≠vel, transparente.  O que √© pintado de branco √© opaco.  O que √© cinza √© transl√∫cido.  Temos um padr√£o preto e branco, e adicionaremos um ret√¢ngulo dentro da m√°scara e o preencheremos com esse padr√£o.  Agora n√≥s temos uma m√°scara. <br><br>  O pr√≥ximo passo √© &lt;s√≠mbolo&gt;.  Essa √© uma tag no SVG, que permite declarar gr√°ficos reutiliz√°veis.  Na maioria das vezes, os s√≠mbolos s√£o usados, por exemplo, para √≠cones.  E aqui declaramos um s√≠mbolo, dentro do qual colocamos dois ret√¢ngulos.  Um n√£o preenche nada, de modo que herda a propriedade fill do SVG pai, e o outro preenche com currentColor e aplica uma m√°scara a ele.  Agora teremos dois ret√¢ngulos: um com furos e preenchido com currentColor e o outro sem furos e preenchido com preenchimento.  E eles est√£o deitados um em cima do outro.  Se definirmos essas cores da mesma forma, teremos um preenchimento s√≥lido.  E se diferente - c√©lulas.  Isso tudo foi.  Agora voc√™ pode simplesmente usar CSS e, atrav√©s das classes, definir um preenchimento arbitr√°rio de duas cores para todos os eventos. <br><br><img src="https://habrastorage.org/webt/lj/pp/la/ljpplaevfwydccmgwqm3zs0bhmq.jpeg"><br><br>  Agora voc√™ precisa determinar exatamente quais eventos devem ser inclu√≠dos no calend√°rio em um determinado dia.  Temos um fuso hor√°rio de +3, no qual todos sentamos, tem uma escala de 9 a 20 horas.  H√° tamb√©m uma pessoa sentada em Orenburg condicional, com um fuso hor√°rio de +5, sua escala √© compensada em duas horas em rela√ß√£o a n√≥s.  Faremos uma proje√ß√£o no UTC e veremos que no UTC esse intervalo de cima para baixo precisa ser exibido na parte inferior, para que o usu√°rio possa, alternando entre os fusos hor√°rios, ver os eventos que se enquadram no calend√°rio dele e no calend√°rio da pessoa que ele est√° olhando. . <br><br>  Lembre-se desses n√∫meros, que est√£o deslocados, porque √© mais f√°cil posicionar os eventos que chegam no UTC no mesmo UTC.  Para fazer isso, pegamos a tag &lt;g&gt;, que indica um grupo no SVG, e posicionamos todos os eventos l√° absolutamente pelo UTC, e alteramos &lt;g&gt; pelo n√∫mero de pixels necess√°rios para exibir um ou outro fuso hor√°rio. <br><br><img src="https://habrastorage.org/webt/0l/yu/jk/0lyujkyfu18dmb5kpimya6fio2w.jpeg"><br><br>  Resumindo este estudo, obtemos que temos um s√≠mbolo ao qual nos referimos, existe um tipo de evento, n√≠vel, paridade, h√° -120 minutos desde o in√≠cio do dia no UTC e uma dura√ß√£o de 30 minutos.  Ao adicionar todos os eventos, obtemos uma imagem dessas. <br><br><img src="https://habrastorage.org/webt/ov/bi/6s/ovbi6sas81myfk1z4f2s9xlxb-4.jpeg"><br><br>  O hor√°rio atual tamb√©m √© feito de forma simples: ser√° uma linha com o mesmo efeito de tra√ßado sem escala, de modo que seja sempre de pixel √∫nico.  √â assim que √© exibido. <br><br>  O tempo n√£o p√°ra e √© necess√°rio que a seta se mova.  A maneira mais legal de criarmos √© a anima√ß√£o.  Decidimos fazer uma anima√ß√£o que deslocaria a seta pelo n√∫mero de minutos em um dia e a faria em um dia.  E para que ele n√£o se mova constantemente lentamente, ou seja, marcando uma vez por minuto, usamos os passos ().  E assim que adicionamos, o tempo come√ßou a mudar.  Ao mesmo tempo, de fato, como a anima√ß√£o n√£o garante que ela se mova constantemente, ela fica para tr√°s ou outra coisa.  Mas temos eventos no calend√°rio atualizados de tempos em tempos, e em algum lugar a cada dois a tr√™s minutos ou quando o usu√°rio sai da guia e retorna, todo o calend√°rio √© redesenhado e o hor√°rio √© atualizado.  Portanto, a anima√ß√£o √© vis√≠vel apenas quando voc√™ est√° sentado e assistindo atentamente, independentemente de estar marcando ou n√£o. <br><br><img src="https://habrastorage.org/webt/ui/82/pq/ui82pqjamllc_ee-1ng6d0ujbh4.jpeg"><br><br>  H√° um problema.  Aqui, ampliei um calend√°rio para que ele se parecesse mais com o de produ√ß√£o.  Ficou claro que as c√©lulas n√£o s√£o mais quadradas.  Isso ocorre porque as propor√ß√µes n√£o s√£o preservadas e, se esticarmos ou alterarmos a propor√ß√£o fisicamente, ela ser√° alterada como na figura.  Para evitar isso, voc√™ precisa escrever um pouco de JS.  H√° a viewBox de propor√ß√£o, que estava em nosso SVG original, e a propor√ß√£o real, usada em nosso layout.  Se voc√™ encontrar a raz√£o dessas propor√ß√µes e depois coloc√°-la na transforma√ß√£o do padr√£o, as c√©lulas se tornar√£o quadradas.  E tamb√©m esse coeficiente, que chegamos aqui, pode ser usado se quisermos entender onde o usu√°rio clicou.  Como temos um minuto no SVG original igual a um pixel, e pelas coordenadas do clique multiplicadas por esse coeficiente, podemos entender a que horas o usu√°rio ficou. <br><br><img src="https://habrastorage.org/webt/e2/oz/gh/e2ozghfj0zoqbzcfz57anw9ycba.jpeg"><br><br>  Resta adicionar HTML para que haja letras e n√∫meros no topo.  Obtenha um calend√°rio. <br><br><img src="https://habrastorage.org/webt/pu/xh/o9/puxho9vkcjuawtkaa9mpf0kadzi.jpeg" width="350"><img src="https://habrastorage.org/webt/sq/bl/cc/sqblcctralj1csyh_putsqfszh4.jpeg" width="394"><br><br>  Portanto, isso ocorre na produ√ß√£o atrav√©s dos olhos de um usu√°rio que fica no fuso hor√°rio +5.  Abaixo est√° uma chave de altern√¢ncia que meu colega pressiona e o calend√°rio se move nos fusos hor√°rios.  Depois, ele clica no evento e v√™ que, no s√°bado, no fuso hor√°rio +5, ou seja, agora, meu relat√≥rio est√° ativado. <br><br><img src="https://habrastorage.org/webt/jt/bz/x9/jtbzx9epd4it3m5fbys7yf0waew.jpeg"><br><br>  Mais alguns exemplos.  Aqui est√° o calend√°rio do desenvolvedor, ele tem stand-ups, v√°rias reuni√µes regulares e √© isso.  Aqui est√° o calend√°rio do gerente.  E aqui est√° o designer. <br><br>  Use CSS, use SVG.  Obrigada </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461571/">https://habr.com/ru/post/pt461571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461561/index.html">Temporizador Arduino</a></li>
<li><a href="../pt461563/index.html">Sabre de luz a laser caseiro para vapor de cobre - parte 3 final</a></li>
<li><a href="../pt461565/index.html">Os 5 mandamentos do desenvolvedor TypeScript</a></li>
<li><a href="../pt461567/index.html">SQL Quebra-cabe√ßas divertidos</a></li>
<li><a href="../pt461569/index.html">Nota para o front-end: o que verificar antes do teste</a></li>
<li><a href="../pt461575/index.html">Criando um PBX 3CX baseado em nuvem em qualquer hospedagem compat√≠vel com Openstack</a></li>
<li><a href="../pt461577/index.html">Part 5/2 Bldg. 1: Crossroads of RocketChip Avenue e pista de instrumenta√ß√£o escorregadia</a></li>
<li><a href="../pt461579/index.html">WebMoney apresenta novas carteiras WMP e altera as regras do jogo</a></li>
<li><a href="../pt461583/index.html">Python para ajudar a testar produtos estruturais</a></li>
<li><a href="../pt461587/index.html">Localiza√ß√£o do aplicativo em 10 etapas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>