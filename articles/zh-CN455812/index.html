<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¸ğŸ» â›¹ğŸ½ ğŸ’¤ åœ¨Golangå’ŒgRPCä¸Šæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼Œç¬¬2éƒ¨åˆ†ï¼ˆdockerï¼‰ ğŸš£ğŸ¿ â›¹ğŸ½ ğŸ‰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ˜¯æ—¶å€™åº”å¯¹é›†è£…ç®±äº† 
 é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°çš„Linux Alpineæ˜ åƒã€‚ Linux Alpineæ˜¯ä¸€ä¸ªè½»é‡çº§Linuxå‘è¡Œç‰ˆï¼Œå…¶è®¾è®¡å’Œä¼˜åŒ–å¯ä»¥åœ¨Dockerä¸­è¿è¡ŒWebåº”ç”¨ç¨‹åºã€‚ æ¢å¥è¯è¯´ï¼ŒLinux Alpineå…·æœ‰è¶³å¤Ÿçš„ä¾èµ–æ€§å’ŒåŠŸèƒ½æ¥è¿è¡Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºã€‚ è¿™æ„å‘³ç€å›¾åƒå¤§å°çº¦ä¸º8 MBï¼ 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Golangå’ŒgRPCä¸Šæ„å»ºå¾®æœåŠ¡æ¶æ„ï¼Œç¬¬2éƒ¨åˆ†ï¼ˆdockerï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455812/"><h3> æ˜¯æ—¶å€™åº”å¯¹é›†è£…ç®±äº† </h3><br> é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°çš„Linux Alpineæ˜ åƒã€‚  Linux Alpineæ˜¯ä¸€ä¸ªè½»é‡çº§Linuxå‘è¡Œç‰ˆï¼Œå…¶è®¾è®¡å’Œä¼˜åŒ–å¯ä»¥åœ¨Dockerä¸­è¿è¡ŒWebåº”ç”¨ç¨‹åºã€‚ æ¢å¥è¯è¯´ï¼ŒLinux Alpineå…·æœ‰è¶³å¤Ÿçš„ä¾èµ–æ€§å’ŒåŠŸèƒ½æ¥è¿è¡Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºã€‚ è¿™æ„å‘³ç€å›¾åƒå¤§å°çº¦ä¸º8 MBï¼ <br><br> ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¾‹å¦‚å®¹é‡çº¦ä¸º1 GBçš„Ubuntuè™šæ‹Ÿæœºï¼Œè¿™å°±æ˜¯Dockeræ˜ åƒå¯¹äºå¾®æœåŠ¡å’Œäº‘è®¡ç®—å˜å¾—æ›´åŠ è‡ªç„¶çš„åŸå› ã€‚ <br><br> å› æ­¤ï¼Œç°åœ¨æˆ‘å¸Œæœ›æ‚¨çœ‹åˆ°å®¹å™¨åŒ–çš„ä»·å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹â€œ Dockerizingâ€æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡ã€‚ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªDockerfile <b>$ touch</b> consignment <b>-service / Dockerfile</b> ã€‚ <br><br><img src="https://habrastorage.org/webt/xf/a7/ex/xfa7exynloocyeogmno3p3le27m.jpeg"><br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸå§‹çš„EwanValentineå­˜å‚¨åº“</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸå§‹æ–‡ç« </a> <br><br> åœ¨Dockerfileä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre><code class="plaintext hljs">FROM alpine:latest RUN mkdir /app WORKDIR /app ADD consignment-service /app/consignment-service CMD ["./consignment-service"]</code> </pre> <br> ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•æ¥æ‰¿è½½æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ ç„¶åï¼Œå°†å·²ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶æ·»åŠ åˆ°Dockerå®¹å™¨ä¸­å¹¶è¿è¡Œå®ƒã€‚ <br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ–°Makefileçš„æ„å»ºè®°å½•ä»¥åˆ›å»ºDockeræ˜ åƒã€‚ <br><br><pre> <code class="plaintext hljs">build: ... GOOS=linux GOARCH=amd64 go build docker build -t consignment .</code> </pre><br> æˆ‘ä»¬åˆæ·»åŠ äº†ä¸¤ä¸ªæ­¥éª¤ï¼Œæˆ‘æƒ³æ›´è¯¦ç»†åœ°è§£é‡Šå®ƒä»¬ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºGoäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œåœ¨è¿è¡Œ$ go buildä¹‹å‰ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚  GOOSå’ŒGOARCHå…è®¸æ‚¨äº¤å‰ç¼–è¯‘å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ç”±äºæˆ‘æ˜¯ä¸ºMacbookå¼€å‘çš„ï¼Œå› æ­¤æ— æ³•ç¼–è¯‘goå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶ååœ¨ä½¿ç”¨Linuxçš„Dockerå®¹å™¨ä¸­è¿è¡Œå®ƒã€‚ äºŒè¿›åˆ¶æ–‡ä»¶åœ¨æ‚¨çš„Dockerå®¹å™¨ä¸­å°†å®Œå…¨æ²¡æœ‰æ„ä¹‰ï¼Œå¹¶ä¸”å°†å¼•å‘é”™è¯¯ã€‚ <br><br> æˆ‘æ·»åŠ çš„ç¬¬äºŒæ­¥æ˜¯dockeræ„å»ºè¿‡ç¨‹ã€‚  Dockerå°†è¯»å–æ‚¨çš„Dockerfileå¹¶åˆ›å»ºä¸€ä¸ªåä¸ºconsignment-serviceçš„æ˜ åƒï¼Œç‚¹è¡¨ç¤ºç›®å½•è·¯å¾„ï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬åªå¸Œæœ›æ„å»ºè¿‡ç¨‹æŸ¥çœ‹å½“å‰ç›®å½•ã€‚ <br><br> æˆ‘å°†å‘æˆ‘ä»¬çš„Makefileæ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®ï¼š <br><br><pre> <code class="plaintext hljs">run: docker run -p 50051:50051 shippy-service-consignment</code> </pre><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å¼€ç«¯å£50051å¯åŠ¨Dockeræ˜ åƒã€‚ç”±äºDockeråœ¨å•ç‹¬çš„ç½‘ç»œå±‚ä¸Šè¿è¡Œï¼Œå› æ­¤æ‚¨éœ€è¦é‡å®šå‘ç«¯å£ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨ç«¯å£8080ä¸Šå¯åŠ¨æ­¤æœåŠ¡ï¼Œåˆ™å¿…é¡»å°†-på‚æ•°æ›´æ”¹ä¸º8080ï¼š50051ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡åŒ…å«-dæ ‡å¿—åœ¨åå°è¿è¡Œå®¹å™¨ã€‚ ä¾‹å¦‚ï¼Œ <b>docker run -d -p 50051ï¼š50051 consignment-service</b> ã€‚ <br><br> è¿è¡Œ<b>$ make run</b> ï¼Œç„¶åå†æ¬¡åœ¨å•ç‹¬çš„ç»ˆç«¯é¢æ¿ä¸­<b>è¿è¡Œ$ go run main.go</b>å¹¶æ£€æŸ¥å®ƒæ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚ <br><br> è¿è¡Œ$ docker buildæ—¶ï¼Œæ‚¨å°†ä»£ç å’Œè¿è¡Œæ—¶åµŒå…¥åˆ°æ˜ åƒä¸­ã€‚  Dockeræ˜ åƒæ˜¯æ‚¨çš„ç¯å¢ƒåŠå…¶ä¾èµ–é¡¹çš„å¯ç§»æ¤æ˜ åƒã€‚ æ‚¨å¯ä»¥é€šè¿‡å°†Dockeræ˜ åƒå‘å¸ƒåˆ°Docker Hubæ¥å…±äº«å®ƒä»¬ã€‚ è¿™ç±»ä¼¼äºnpmæˆ–dockeræ˜ åƒçš„yumå­˜å‚¨åº“ã€‚ åœ¨Dockerfileä¸­å®šä¹‰FROMæ—¶ï¼Œæ‚¨å‘Šè¯‰Dockerä»Dockerå­˜å‚¨åº“ä¸­æå–æ­¤æ˜ åƒä»¥ç”¨ä½œåŸºç¡€ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥å±•å¼€å’Œé‡æ–°å®šä¹‰æ­¤åŸºæœ¬æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†ï¼Œå¹¶æ ¹æ®éœ€è¦é‡æ–°å®šä¹‰å®ƒä»¬ã€‚ æˆ‘ä»¬ä¸ä¼šå‘å¸ƒdockeræ˜ åƒï¼Œä½†æ˜¯å¯ä»¥éšæ„æµè§ˆdockerå­˜å‚¨åº“ï¼Œå¹¶æ³¨æ„åˆ°å‡ ä¹æ‰€æœ‰è½¯ä»¶éƒ½å·²ç»æ‰“åŒ…åœ¨å®¹å™¨ä¸­ã€‚ ä¸€äº›éå¸¸ç¾å¦™çš„äº‹æƒ…è¢«ç å¤´åŒ–äº†ã€‚ <br><br>  Dockerfileä¸­çš„æ¯ä¸ªå¹¿å‘Šåœ¨é¦–æ¬¡æ„å»ºæ—¶éƒ½ä¼šè¢«ç¼“å­˜ã€‚ è¿™æ ·å°±æ— éœ€åœ¨æ¯æ¬¡æ›´æ”¹æ—¶éƒ½é‡å»ºæ•´ä¸ªè¿è¡Œæ—¶ã€‚ ç å¤´å·¥äººè¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥æ‰¾å‡ºå“ªäº›ç»†èŠ‚å·²æ›´æ”¹ä»¥åŠéœ€è¦é‡å»ºå“ªäº›ç»†èŠ‚ã€‚ è¿™ä½¿å¾—æ„å»ºè¿‡ç¨‹éå¸¸å¿«ã€‚ <br><br> è¶³å¤Ÿçš„å®¹å™¨ï¼ è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ä»£ç ã€‚ <br><br> åˆ›å»ºgRPCæœåŠ¡æ—¶ï¼Œæœ‰è®¸å¤šç”¨äºåˆ›å»ºè¿æ¥çš„æ ‡å‡†ä»£ç ï¼Œæ‚¨éœ€è¦å¯¹æœåŠ¡åœ°å€åœ¨å®¢æˆ·ç«¯æˆ–å…¶ä»–æœåŠ¡ä¸­çš„ä½ç½®è¿›è¡Œç¡¬ç¼–ç ï¼Œä»¥ä¾¿å®ƒå¯ä»¥ä¸å…¶è¿æ¥ã€‚ è¿™å¾ˆå›°éš¾ï¼Œå› ä¸ºåœ¨äº‘ä¸­å¯åŠ¨æœåŠ¡æ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¸ä¼šä½¿ç”¨åŒä¸€ä¸»æœºï¼Œæˆ–è€…åœ¨é‡æ–°éƒ¨ç½²æœåŠ¡ååœ°å€æˆ–ipå¯èƒ½ä¼šæ›´æ”¹ã€‚ <br><br> è¿™æ˜¯å‘ç°æœåŠ¡å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚ å‘ç°æœåŠ¡å°†æ›´æ–°æ‰€æœ‰æœåŠ¡çš„ç›®å½•åŠå…¶ä½ç½®ã€‚ æ¯ä¸ªæœåŠ¡éƒ½åœ¨è¿è¡Œæ—¶æ³¨å†Œï¼Œå¹¶åœ¨å…³é—­æ—¶æ³¨é”€ã€‚ ç„¶åä¸ºæ¯ä¸ªæœåŠ¡åˆ†é…ä¸€ä¸ªåç§°æˆ–æ ‡è¯†ç¬¦ã€‚ å› æ­¤ï¼Œå³ä½¿æœåŠ¡åç§°ä¿æŒä¸å˜ï¼Œå³ä½¿å®ƒå¯èƒ½å…·æœ‰æ–°çš„IPåœ°å€æˆ–ä¸»æœºåœ°å€ï¼Œä¹Ÿä¸éœ€è¦ä»å…¶ä»–æœåŠ¡æ›´æ–°å¯¹æ­¤æœåŠ¡çš„è°ƒç”¨ã€‚ <br><br> é€šå¸¸ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå°±åƒç¼–ç¨‹ä¸­çš„å¤§å¤šæ•°äº‹æƒ…ä¸€æ ·ï¼Œå¦‚æœæœ‰äººå·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆé‡æ–°å‘æ˜è½®å­æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Go-micro</a>çš„åˆ›å»ºè€…@Chuhnkï¼ˆAsim Aslamï¼‰ä»¥å‡ºè‰²çš„æ¸…æ™°åº¦å’Œæ˜“ç”¨æ€§è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ ä»–å•æªåŒ¹é©¬åˆ¶ä½œå‡ºäº†ä¸èµ·çš„è½¯ä»¶ã€‚ å¦‚æœæ‚¨å–œæ¬¢è‡ªå·±æ‰€çœ‹åˆ°çš„ï¼Œè¯·è€ƒè™‘å¸®åŠ©ä»–ï¼ <br><br><h3> å¾®å‹åŒ– </h3><br>  Go-microæ˜¯ä¸€ä¸ªç”¨Goç¼–å†™çš„åŠŸèƒ½å¼ºå¤§çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä¸»è¦ç”¨äºGoã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Sidecarä¸å…¶ä»–è¯­è¨€è¿›è¡Œäº¤äº’ã€‚ <br><br>  Go-microå…·æœ‰æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå¯ç”¨äºåœ¨Goä¸­åˆ›å»ºå¾®æœåŠ¡ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯èƒ½é¦–å…ˆä»ä»–è§£å†³çš„æœ€å¸¸è§é—®é¢˜å¼€å§‹ï¼Œè¿™å°±æ˜¯å‘ç°æœåŠ¡ã€‚ <br><br> ä¸ºäº†ä½¿ç”¨go-microï¼Œæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œå‡ æ¬¡æ›´æ–°ã€‚  Go-microé›†æˆä¸ºProtocæ’ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ›¿ä»£äº†æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ ‡å‡†gRPCæ’ä»¶ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»åœ¨Makefileä¸­æ›¿æ¢å®ƒå¼€å§‹ã€‚ <br><br> ç¡®ä¿å®‰è£…go-microä¾èµ–é¡¹ï¼š <br><br><pre> <code class="plaintext hljs">go get -u github.com/micro/protobuf/{proto,protoc-gen-go}</code> </pre> <br> æ›´æ–°æˆ‘ä»¬çš„Makefileä»¥ä½¿ç”¨go-microæ’ä»¶è€Œä¸æ˜¯gRPCæ’ä»¶ï¼š <br><br><pre> <code class="plaintext hljs">build: protoc -I. --go_out=plugins=micro:. \ proto/consignment/consignment.proto GOOS=linux GOARCH=amd64 go build docker build -t consignment . run: docker run -p 50051:50051 shippy-service-consignment</code> </pre><br> ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„shippy-service-consignment / main.goä»¥ä½¿ç”¨go-microã€‚ è¿™æŠ½è±¡äº†æˆ‘ä»¬ä»¥å‰çš„å¤§å¤šæ•°gRPCä»£ç ã€‚ å®ƒå¯ä»¥è½»æ¾åœ°å¤„ç†æ³¨å†Œå¹¶åŠ é€ŸæœåŠ¡çš„ç¼–å†™ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">shippyæœåŠ¡å¯„å”®/ main.go</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// shippy-service-consignment/main.go package main import ( "fmt" //  protobuf  pb "github.com/EwanValentine/shippy/consignment-service/proto/consignment" "github.com/micro/go-micro" "context" ) //repository -   type repository interface { Create(*pb.Consignment) (*pb.Consignment, error) GetAll() []*pb.Consignment } // Repository -    , //       type Repository struct { consignments []*pb.Consignment } func (repo *Repository) Create(consignment *pb.Consignment) (*pb.Consignment, error) { updated := append(repo.consignments, consignment) repo.consignments = updated return consignment, nil } func (repo *Repository) GetAll() []*pb.Consignment { return repo.consignments } //         //       proto. //           . type service struct { repo repository } // CreateConsignment -        , //    create,      //     gRPC. func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment, res *pb.Response) error { // Save our consignment consignment, err := s.repo.Create(req) if err != nil { return err } // Return matching the `Response` message we created in our // protobuf definition. res.Created = true res.Consignment = consignment return nil } //GetConsignments -         func (s *service) GetConsignments(ctx context.Context, req *pb.GetRequest, res *pb.Response) error { consignments := s.repo.GetAll() res.Consignments = consignments return nil } func main() { repo := &amp;Repository{} //     Go-micro srv := micro.NewService( //           proto micro.Name("shippy.service.consignment"), ) // Init will parse the command line flags. srv.Init() //   pb.RegisterShippingServiceHandler(srv.Server(), &amp;service{repo}) //   log.Println(" ") if err := srv.Run(); err != nil { fmt.Println(err) } }</span></span></code> </pre><br></div></div><br> æ­¤å¤„çš„ä¸»è¦æ›´æ”¹æ˜¯æˆ‘ä»¬åˆ›å»ºgRPCæœåŠ¡å™¨çš„æ–¹å¼ï¼Œè¯¥æ–¹æ³•å·²ä»mico.NewServiceï¼ˆï¼‰å·§å¦™åœ°æŠ½è±¡å‡ºæ¥ï¼Œåè€…å¤„ç†äº†æˆ‘ä»¬çš„æœåŠ¡æ³¨å†Œã€‚ æœ€åæ˜¯service.Runï¼ˆï¼‰å‡½æ•°ï¼Œè¯¥å‡½æ•°å¤„ç†è¿æ¥æœ¬èº«ã€‚ å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æ³¨å†Œå®ç°ï¼Œä½†æ˜¯è¿™æ¬¡ä½¿ç”¨çš„æ–¹æ³•ç•¥æœ‰ä¸åŒã€‚ <br><br> ç¬¬äºŒå¤§å˜åŒ–æ¶‰åŠæœåŠ¡æ–¹æ³•æœ¬èº«ï¼šå¯¹å‚æ•°å’Œå“åº”ç±»å‹è¿›è¡Œäº†è½»å¾®ä¿®æ”¹ï¼Œä»¥æ¥å—è¯·æ±‚å’Œå“åº”ç»“æ„ä½œä¸ºå‚æ•°ï¼Œç°åœ¨ä»…è¿”å›é”™è¯¯ã€‚ åœ¨æˆ‘ä»¬çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†å¾®å¤„ç†çš„å“åº”ã€‚ <br><br> æœ€åï¼Œæˆ‘ä»¬ä¸å†å¯¹ç«¯å£è¿›è¡Œç¼–ç¨‹ã€‚ å¿…é¡»ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤è¡Œå‚æ•°æ¥é…ç½®Go-microã€‚ è¦è®¾ç½®åœ°å€ï¼Œè¯·ä½¿ç”¨MICRO_SERVER_ADDRESS =ï¼š50051ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMicroä½¿ç”¨mdnsï¼ˆå¤šæ’­dnsï¼‰ä½œä¸ºæœåŠ¡å‘ç°ä»£ç†ä¾›æœ¬åœ°ä½¿ç”¨ã€‚ é€šå¸¸ï¼Œæ‚¨ä¸ä½¿ç”¨mdnsåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‘ç°æœåŠ¡ï¼Œä½†æˆ‘ä»¬å¸Œæœ›é¿å…åœ¨æœ¬åœ°è¿è¡ŒConsulæˆ–etcdä¹‹ç±»çš„ä¸œè¥¿è¿›è¡Œæµ‹è¯•ã€‚ ç¨åå†è¯¦ç»†ä»‹ç»ã€‚ <br><br> è®©æˆ‘ä»¬æ›´æ–°Makefileæ¥åæ˜ è¿™ä¸€ç‚¹ã€‚ <br><br><pre> <code class="plaintext hljs">build: protoc -I. --go_out=plugins=micro:. \ proto/consignment/consignment.proto GOOS=linux GOARCH=amd64 go build docker build -t consignment . run: docker run -p 50051:50051 \ -e MICRO_SERVER_ADDRESS=:50051 \ shippy-service-consignment</code> </pre><br>  -eæ˜¯ç¯å¢ƒå˜é‡çš„æ ‡å¿—ï¼Œå®ƒå…è®¸æ‚¨å°†ç¯å¢ƒå˜é‡ä¼ é€’åˆ°Dockerå®¹å™¨ã€‚ æ¯ä¸ªå˜é‡éƒ½å¿…é¡»å…·æœ‰ä¸€ä¸ªæ ‡å¿—ï¼Œä¾‹å¦‚-e ENV = staging -e DB_HOST = localhostï¼Œç­‰ç­‰ã€‚ <br><br> ç°åœ¨ï¼Œå¦‚æœæ‚¨è¿è¡Œ$ make runï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªå¸¦æœ‰æœåŠ¡å‘ç°åŠŸèƒ½çš„DockerizedæœåŠ¡ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„Cliå·¥å…·ä»¥ä½¿ç”¨å®ƒã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¯„å”®</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"encoding/json"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> <span class="hljs-string"><span class="hljs-string">"context"</span></span> pb <span class="hljs-string"><span class="hljs-string">"github.com/EwanValentine/shippy-service-consignment/proto/consignment"</span></span> micro <span class="hljs-string"><span class="hljs-string">"github.com/micro/go-micro"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( address = <span class="hljs-string"><span class="hljs-string">"localhost:50051"</span></span> defaultFilename = <span class="hljs-string"><span class="hljs-string">"consignment.json"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*pb.Consignment, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> consignment *pb.Consignment data, err := ioutil.ReadFile(file) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, err } json.Unmarshal(data, &amp;consignment) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> consignment, err } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { service := micro.NewService(micro.Name(<span class="hljs-string"><span class="hljs-string">"shippy.cli.consignment"</span></span>)) service.Init() client := pb.NewShippingServiceClient(<span class="hljs-string"><span class="hljs-string">"shippy.service.consignment"</span></span>, service.Client()) <span class="hljs-comment"><span class="hljs-comment">// Contact the server and print out its response. file := defaultFilename if len(os.Args) &gt; 1 { file = os.Args[1] } consignment, err := parseFile(file) if err != nil { log.Fatalf("Could not parse file: %v", err) } r, err := client.CreateConsignment(context.Background(), consignment) if err != nil { log.Fatalf("Could not greet: %v", err) } log.Printf("Created: %t", r.Created) getAll, err := client.GetConsignments(context.Background(), &amp;pb.GetRequest{}) if err != nil { log.Fatalf("Could not list consignments: %v", err) } for _, v := range getAll.Consignments { log.Println(v) } }</span></span></code> </pre><br></div></div><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¼å…¥äº†go-microåº“æ¥åˆ›å»ºå®¢æˆ·ç«¯ï¼Œå¹¶ç”¨go-microå®¢æˆ·ç«¯ä»£ç æ›¿æ¢äº†ç°æœ‰çš„è¿æ¥ä»£ç ï¼Œè¯¥ä»£ç ä½¿ç”¨æœåŠ¡çš„æƒé™è€Œä¸æ˜¯ç›´æ¥è¿æ¥åˆ°åœ°å€ã€‚ <br><br> ä½†æ˜¯ï¼Œå¦‚æœè¿è¡Œæ­¤å‘½ä»¤ï¼Œå®ƒå°†ä¸èµ·ä½œç”¨ã€‚ è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨æ­£åœ¨Dockerå®¹å™¨ä¸­å¯åŠ¨æœåŠ¡ï¼Œè¯¥å®¹å™¨å…·æœ‰è‡ªå·±çš„mdnsï¼Œä¸æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„mdnsä¸»æœºåˆ†å¼€ã€‚ è§£å†³æ­¤é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯ç¡®ä¿æœåŠ¡å’Œå®¢æˆ·ç«¯éƒ½åœ¨dockerlandä¸­è¿è¡Œï¼Œä»¥ä¾¿å®ƒä»¬éƒ½åœ¨åŒä¸€ä¸»æœºä¸Šå·¥ä½œå¹¶ä½¿ç”¨åŒä¸€ç½‘ç»œå±‚ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºmake consignment-cli / Makefileå¹¶åˆ›å»ºä¸€äº›æ¡ç›®ã€‚ <br><br><pre> <code class="plaintext hljs">build: GOOS=linux GOARCH=amd64 go build docker build -t shippy-cli-consignment . run: docker run shippy-cli-consignment</code> </pre><br> å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬è¦ä¸ºLinuxæ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å½“å¯åŠ¨dockeré•œåƒæ—¶ï¼Œæˆ‘ä»¬æƒ³è¦ä¼ é€’ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä»¥å‘å‡ºgo-microå‘½ä»¤æ¥ä½¿ç”¨mdnsã€‚ <br><br> ç°åœ¨è®©æˆ‘ä»¬ä¸ºCLIå·¥å…·åˆ›å»ºä¸€ä¸ªDockerfileï¼š <br><br><pre> <code class="plaintext hljs">FROM alpine:latest RUN mkdir -p /app WORKDIR /app ADD consignment.json /app/consignment.json ADD consignment-cli /app/consignment-cli CMD ["./shippy-cli-consignment"]</code> </pre><br> è¿™ä¸æˆ‘ä»¬çš„æœåŠ¡Dockerfileéå¸¸ç›¸ä¼¼ï¼Œé™¤äº†å®ƒè¿˜ä¼šæå–æˆ‘ä»¬çš„jsonæ•°æ®æ–‡ä»¶ã€‚ <br><br> ç°åœ¨ï¼Œå½“åœ¨shippy-cli-consignmentä¸­è¿è¡Œ$ make runæ—¶ï¼Œæ‚¨åº”è¯¥åƒä»¥å‰ä¸€æ ·çœ‹åˆ°Createdï¼štrueã€‚ <br><br> ç°åœ¨ï¼Œçœ‹æ¥è¯¥çœ‹çœ‹æ–°çš„DockeråŠŸèƒ½äº†ï¼šå¤šé˜¶æ®µæ„å»ºã€‚ è¿™ä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªDockerfileä¸­ä½¿ç”¨å¤šä¸ªDockeræ˜ åƒã€‚ <br><br> è¿™åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ˜ åƒæ¥åˆ›å»ºå…·æœ‰æ‰€æœ‰æ­£ç¡®ä¾èµ–é¡¹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ç„¶åä½¿ç”¨ç¬¬äºŒä¸ªå›¾åƒå¯åŠ¨å®ƒã€‚ è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œæˆ‘å°†åœ¨ä»£ç ä¸­ç•™ä¸‹è¯¦ç»†çš„æ³¨é‡Šï¼š <br><div class="spoiler">  <b class="spoiler_title">å¯„å”®æœåŠ¡/ Dockerfile</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># consignment-service/Dockerfile #     golang,    #     .    `as builder`, #     ,      . FROM golang:alpine as builder RUN apk --no-cache add git #         gopath WORKDIR /app/shippy-service-consignment #       COPY . . RUN go mod download #     ,   #       Alpine. RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o shippy-service-consignment #      FROM, #   Docker        . FROM alpine:latest # ,    -     RUN apk --no-cache add ca-certificates #   ,     . RUN mkdir /app WORKDIR /app #   ,       , #         `builder` #       , #    ,    , #      . ! COPY --from=builder /app/shippy-service-consignment/shippy-service-consignment . #     !        #        # run time . CMD ["./shippy-service-consignment"]</code> </pre><br></div></div><br> ç°åœ¨ï¼Œæˆ‘å°†ç»§ç»­ä½¿ç”¨å…¶ä»–Dockeræ–‡ä»¶å¹¶é‡‡ç”¨è¿™ç§æ–°æ–¹æ³•ã€‚ å“¦ï¼Œåˆ«å¿˜äº†ä»æ‚¨çš„Makefileä¸­åˆ é™¤$ go buildï¼ <br><br><h3> èˆ¹èˆ¶æœåŠ¡ </h3><br> è®©æˆ‘ä»¬åˆ›å»ºç¬¬äºŒä¸ªæœåŠ¡ã€‚ æˆ‘ä»¬æœ‰ä¸€é¡¹æœåŠ¡ï¼ˆshippy-service-consignmentï¼‰ï¼Œè¯¥æœåŠ¡è´Ÿè´£å°†è¿™æ‰¹é›†è£…ç®±ä¸èˆ¹èˆ¶è¿›è¡Œåè°ƒï¼Œè¿™æœ€é€‚åˆæ­¤æ‰¹è´§ç‰©ã€‚ ä¸ºäº†åŒ¹é…æˆ‘ä»¬çš„æ‰¹æ¬¡ï¼Œæˆ‘ä»¬å¿…é¡»å°†é›†è£…ç®±çš„é‡é‡å’Œæ•°é‡å‘é€åˆ°æˆ‘ä»¬çš„æ–°èˆ¹æœåŠ¡éƒ¨é—¨ï¼Œåè€…å°†æ‰¾åˆ°èƒ½å¤Ÿå¤„ç†è¯¥æ‰¹æ¬¡çš„èˆ¹åªã€‚ <br><br> åœ¨<b>$ mkdir vessel-service</b>æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œç°åœ¨ä¸ºæˆ‘ä»¬çš„æ–°protobufæœåŠ¡å®šä¹‰<b>$ mkdir -p shippy-service-vessel / proto / vessel</b>åˆ›å»ºä¸€ä¸ªå­ç›®å½•ã€‚ ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„protobufæ–‡ä»¶ï¼Œ <b>$ touch shippy-service-vessel / proto / vessel / vesselã€‚vessel</b> ã€‚ <br><br> ç”±äºprotobufçš„å®šä¹‰ç¡®å®æ˜¯æˆ‘ä»¬è½¯ä»¶è®¾è®¡çš„æ ¸å¿ƒï¼Œå› æ­¤è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å®¹å™¨/å™¨çš¿</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">// shippy-service-vessel/proto/vessel/vessel.proto syntax = "proto3"; package vessel; service VesselService { rpc FindAvailable(Specification) returns (Response) {} } message Vessel { string id = 1; int32 capacity = 2; int32 max_weight = 3; string name = 4; bool available = 5; string owner_id = 6; } message Specification { int32 capacity = 1; int32 max_weight = 2; } message Response { Vessel vessel = 1; repeated Vessel vessels = 2; }</code> </pre><br></div></div><br> å¦‚æ‚¨æ‰€è§ï¼Œè¿™ä¸æˆ‘ä»¬çš„ç¬¬ä¸€é¡¹æœåŠ¡éå¸¸ç›¸ä¼¼ã€‚ æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç§°ä¸ºFindAvailableçš„rpcæ–¹æ³•åˆ›å»ºæœåŠ¡ã€‚ è¿™é‡‡ç”¨ä¸€ç§è§„èŒƒç±»å‹ï¼Œå¹¶è¿”å›ä¸€ç§å“åº”ç±»å‹ã€‚ å“åº”ç±»å‹ä½¿ç”¨é‡å¤å­—æ®µè¿”å›â€œå®¹å™¨â€ç±»å‹æˆ–å¤šä¸ªå®¹å™¨ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªMakefileæ¥å¤„ç†æ„å»ºé€»è¾‘å’Œå¯åŠ¨è„šæœ¬ã€‚  <b>$ touch shippy-service-vessel / Makefile</b> ã€‚ æ‰“å¼€æ­¤æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="plaintext hljs">// vessel-service/Makefile build: protoc -I. --go_out=plugins=micro:. \ proto/vessel/vessel.proto docker build -t shippy-service-vessel . run: docker run -p 50052:50051 -e MICRO_SERVER_ADDRESS=:50051 shippy-service-vessel</code> </pre><br> è¿™å‡ ä¹ä¸æˆ‘ä»¬ä¸ºå¯„å”®æœåŠ¡åˆ›å»ºçš„ç¬¬ä¸€ä¸ªMakefileç›¸åŒï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼ŒæœåŠ¡å’Œç«¯å£çš„åç§°æœ‰æ‰€å˜åŒ–ã€‚ æˆ‘ä»¬æ— æ³•åœ¨åŒä¸€ç«¯å£ä¸Šè¿è¡Œä¸¤ä¸ªæ‰©å±•åå®¹å™¨ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨Dockersç«¯å£è½¬å‘ï¼Œä»¥ä¾¿è¯¥æœåŠ¡ä»ä¸»æœºç½‘ç»œä¸Šçš„50051é‡å®šå‘åˆ°50052ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ–°çš„å¤šé˜¶æ®µæ ¼å¼çš„Dockerfileï¼š <br><br><pre> <code class="plaintext hljs"># vessel-service/Dockerfile FROM golang:alpine as builder RUN apk --no-cache add git WORKDIR /app/shippy-service-vessel COPY . . RUN go mod download RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o shippy-service-vessel FROM alpine:latest RUN apk --no-cache add ca-certificates RUN mkdir /app WORKDIR /app COPY --from=builder /app/shippy-service-vessel . CMD ["./shippy-service-vessel"]</code> </pre><br> æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å®ç°ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">èˆ¹åªæœåŠ¡/ main.go</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// vessel-service/main.go package main import ( "context" "errors" "fmt" pb "github.com/EwanValentine/shippy/vessel-service/proto/vessel" "github.com/micro/go-micro" ) type Repository interface { FindAvailable(*pb.Specification) (*pb.Vessel, error) } type VesselRepository struct { vessels []*pb.Vessel } // FindAvailable -     , //           , //      . func (repo *VesselRepository) FindAvailable(spec *pb.Specification) (*pb.Vessel, error) { for _, vessel := range repo.vessels { if spec.Capacity &lt;= vessel.Capacity &amp;&amp; spec.MaxWeight &lt;= vessel.MaxWeight { return vessel, nil } } //     return nil, errors.New("     ") } //    grpc type service struct { repo repository } func (s *service) FindAvailable(ctx context.Context, req *pb.Specification, res *pb.Response) error { //     vessel, err := s.repo.FindAvailable(req) if err != nil { return err } //       res.Vessel = vessel return nil } func main() { vessels := []*pb.Vessel{ &amp;pb.Vessel{Id: "vessel001", Name: "Boaty McBoatface", MaxWeight: 200000, Capacity: 500}, } repo := &amp;VesselRepository{vessels} srv := micro.NewService( micro.Name("shippy.service.vessel"), ) srv.Init() //    pb.RegisterVesselServiceHandler(srv.Server(), &amp;service{repo}) if err := srv.Run(); err != nil { fmt.Println(err) } }</span></span></code> </pre><br></div></div><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œæœ‰è¶£çš„éƒ¨åˆ†ã€‚ åˆ›å»ºæ‰˜è¿è´§ç‰©æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹è´§ç‰©è£…å¸æœåŠ¡ä»¥è”ç³»èˆ¹æœç´¢æœåŠ¡ï¼Œæ‰¾åˆ°èˆ¹å¹¶æ›´æ–°æ‰€åˆ›å»ºæ‰˜è¿è´§ç‰©ä¸­çš„ship_idå‚æ•°ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">è¿è´§èˆ¹/å¯„å”®æœåŠ¡/ main.go</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"context"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"sync"</span></span> pb <span class="hljs-string"><span class="hljs-string">"github.com/EwanValentine/shippy-service-consignment/proto/consignment"</span></span> vesselProto <span class="hljs-string"><span class="hljs-string">"github.com/EwanValentine/shippy-service-vessel/proto/vessel"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/micro/go-micro"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( port = <span class="hljs-string"><span class="hljs-string">":50051"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> repository <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Create(*pb.Consignment) (*pb.Consignment, error) GetAll() []*pb.Consignment } <span class="hljs-comment"><span class="hljs-comment">// Repository -    , //       type Repository struct { mu sync.RWMutex consignments []*pb.Consignment } //Create -     func (repo *Repository) Create(consignment *pb.Consignment) (*pb.Consignment, error) { repo.mu.Lock() updated := append(repo.consignments, consignment) repo.consignments = updated repo.mu.Unlock() return consignment, nil } //GetAll -       func (repo *Repository) GetAll() []*pb.Consignment { return repo.consignments } //         //       proto. //            type service struct { repo repository vesselClient vesselProto.VesselServiceClient } // CreateConsignment -         create, //     ,     gRPC. func (s *service) CreateConsignment(ctx context.Context, req *pb.Consignment, res *pb.Response) error { //         , //    vesselResponse, err := s.vesselClient.FindAvailable(context.Background(), &amp;vesselProto.Specification{ MaxWeight: req.Weight, Capacity: int32(len(req.Containers)), }) log.Printf(" : %s \n", vesselResponse.Vessel.Name) if err != nil { return err } //     id  req.VesselId = vesselResponse.Vessel.Id //      consignment, err := s.repo.Create(req) if err != nil { return err } res.Created = true res.Consignment = consignment return nil } // GetConsignments -         func (s *service) GetConsignments(ctx context.Context, req *pb.GetRequest, res *pb.Response) error { consignments := s.repo.GetAll() res.Consignments = consignments return nil } func main() { //   repo := &amp;Repository{} //  micro srv := micro.NewService( micro.Name("shippy.service.consignment"), ) srv.Init() vesselClient := vesselProto.NewVesselServiceClient("shippy.service.vessel", srv.Client()) //      gRPC. pb.RegisterShippingServiceHandler(srv.Server(), &amp;service{repo, vesselClient}) //   if err := srv.Run(); err != nil { fmt.Println(err) } }</span></span></code> </pre><br></div></div><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºèˆ¹èˆ¶æœåŠ¡åˆ›å»ºäº†ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ï¼Œè¯¥å®ä¾‹å…è®¸æˆ‘ä»¬ä½¿ç”¨æœåŠ¡åç§°ï¼Œå³  shipy.service.vesselä»¥å®¢æˆ·ç«¯çš„èº«ä»½è°ƒç”¨èˆ¹èˆ¶çš„æœåŠ¡ï¼Œå¹¶ä¸å…¶æ–¹æ³•è¿›è¡Œäº¤äº’ã€‚<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ç§æ–¹æ³•ï¼ˆFindAvailableï¼‰ã€‚æˆ‘ä»¬å°†æ‰¹æ¬¡é‡é‡ä¸æˆ‘ä»¬è¦è¿é€çš„é›†è£…ç®±æ•°é‡ä¸€èµ·è¿é€ï¼Œä½œä¸ºè¿é€æœåŠ¡çš„è§„æ ¼ã€‚è¿™å°†å‘æˆ‘ä»¬è¿”å›ä¸æ­¤è§„èŒƒç›¸å¯¹åº”çš„èˆ¹åªã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ–°consignment-cli / consignment.jsonæ–‡ä»¶ï¼Œåˆ é™¤ç¡¬ç¼–ç çš„ship_idï¼Œå› ä¸ºæˆ‘ä»¬è¦ç¡®è®¤æˆ‘ä»¬çš„èˆ¹èˆ¶æœç´¢æœåŠ¡æ­£åœ¨è¿è¡Œã€‚å¦å¤–ï¼Œè®©æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„å®¹å™¨å¹¶å¢åŠ é‡é‡ã€‚</font></font>ä¾‹å¦‚ï¼š <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>: <span class="hljs-number"><span class="hljs-number">55000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"containers"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"customer_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"_001"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"user_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"_001"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"origin"</span></span>: <span class="hljs-string"><span class="hljs-string">"--"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"customer_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"_002"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"user_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"_001"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"origin"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"customer_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"_003"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"user_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"_001"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"origin"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } ] }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨</font><font style="vertical-align: inherit;">åœ¨consignment-cliä¸­</font><font style="vertical-align: inherit;">è¿è¡Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ make build &amp;&amp; make</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ‚¨åº”è¯¥çœ‹åˆ°åŒ…å«å·²åˆ›å»ºå•†å“æ¸…å•çš„ç­”æ¡ˆã€‚</font><font style="vertical-align: inherit;">åœ¨æ‚¨çš„èšä¼šä¸­ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°å·²ç»è®¾ç½®äº†vessel_idå‚æ•°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’è¿çš„å¾®æœåŠ¡å’Œä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä½¿ç”¨MongoDBä¿å­˜å…¶ä¸­ä¸€äº›æ•°æ®ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†æ·»åŠ ç¬¬ä¸‰é¡¹æœåŠ¡ï¼Œå¹¶ä½¿ç”¨docker-composeåœ¨æœ¬åœ°ç®¡ç†æˆ‘ä»¬ä¸æ–­å‘å±•çš„å®¹å™¨ç”Ÿæ€ç³»ç»Ÿã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€éƒ¨åˆ†</font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EwanValentineåŸå§‹å­˜å‚¨åº“</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455812/">https://habr.com/ru/post/zh-CN455812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455796/index.html">Javaå’ŒPythonä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼šå¼‚åŒ</a></li>
<li><a href="../zh-CN455800/index.html">çŸ©é˜µ1.0-åˆ†æ•£æ¶ˆæ¯åè®®å‘å¸ƒ</a></li>
<li><a href="../zh-CN455802/index.html">å¦‚ä½•é€šè¿‡ç”µå­é‚®ä»¶é€šè®¯ç»„ç»‡å¥¥æ—åŒ¹å…‹è¿åŠ¨ä¼šã€‚ æ¡ˆä¾‹é»‘æ˜Ÿ</a></li>
<li><a href="../zh-CN455806/index.html">ä¸“è¾‘çš„ç”Ÿä¸æ­»ï¼šæˆ‘ä»¬äº†è§£è¿‡å»100å¹´æ¥éŸ³ä¹æ ¼å¼çš„å˜åŒ–</a></li>
<li><a href="../zh-CN455808/index.html">ä½¿ç”¨pythonä»FTSç½‘ç«™ä¸Šçš„æ³¨å†Œè¡¨ä¸­è·å–æ‘˜å½•</a></li>
<li><a href="../zh-CN455816/index.html">å¦‚ä½•ä¸ºGoogle Assistantåˆ›å»ºé…·ç‚«çš„åŠ¨ä½œã€‚ Just AIçš„Lifehacks</a></li>
<li><a href="../zh-CN455820/index.html">VMware vSphereä¸­çš„VMæ€§èƒ½åˆ†æã€‚ ç¬¬2éƒ¨åˆ†ï¼šè®°å¿†</a></li>
<li><a href="../zh-CN455826/index.html">é¥æ§è‡ªåŠ¨æµ‡æ°´</a></li>
<li><a href="../zh-CN455828/index.html">ç§‘å­¦å®¶å‘ç°äº†æ–°çš„å¼‚å›½åŒæ­¥å½¢å¼</a></li>
<li><a href="../zh-CN455830/index.html">çœ‹ä¸€ä¸‹.NETå¼€å‘äººå‘˜çš„çœ¼å…‰ã€‚ ç¬¬ä¸€å‘¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>