<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🎓 👧🏻 🥠 استكشاف جافا 14 السجلات 🗺️ 👨‍👨‍👧 🙄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="آخر مرة اختبرنا فيها مشغل instanceof محسن ، والذي سيظهر في الإصدار الرابع عشر القادم من Java (سيتم إصداره في مارس 2020). أود اليوم أن أبحث بالتفصيل في...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>استكشاف جافا 14 السجلات</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482300/" style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/post/477654/">آخر مرة</a> اختبرنا فيها مشغل <code>instanceof</code> محسن ، والذي سيظهر في <a href="https://openjdk.java.net/projects/jdk/14/">الإصدار الرابع عشر</a> القادم <a href="https://openjdk.java.net/projects/jdk/14/">من</a> Java (سيتم إصداره في مارس 2020).  أود اليوم أن أبحث بالتفصيل في الميزة النحوية الثانية ، والتي ستظهر أيضًا في Java 14: records. <br><br>  تحتوي السجلات <a href="https://openjdk.java.net/jeps/359">على JEP خاصة بها</a> ، ولكنها لا تعرض الكثير من التفاصيل ، لذلك هناك الكثير الذي يمكنك تجربته والتحقق منه بنفسك.  نعم ، يمكنك بالطبع فتح <a href="http://cr.openjdk.java.net/~gbierman/jep359/jep359-20191125/specs/records-jls.html">مواصفات</a> Java SE ، لكن يبدو لي أنه من المثير جدًا أن تبدأ في كتابة التعليمات البرمجية بنفسك وإلقاء نظرة على سلوك المترجم في بعض المواقف.  اصنعي طيور النورس وجلس بشكل مريح.  دعنا نذهب. <br><a name="habracut"></a><br>  بخلاف المرة الأخيرة ، عندما اضطررت إلى إنشاء فرع JDK خاص للاختبار على <code>instanceof</code> ، الآن كل هذا موجود بالفعل في الفرع الرئيسي ومتاح في الإصدار <a href="http://jdk.java.net/14/">JDK 14 المبكر</a> الذي قمت بتنزيله. <br><br>  أولاً ، نطبق المثال الكلاسيكي باستخدام <code>Point</code> ونقوم بتجميعه: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; javac --enable-preview --release 14 Point.java Note: Point.java uses preview language features. Note: Recompile with -Xlint:preview for details.</code> </pre> <br>  <code>javac</code> جمعت بنجاح ملف <code>Point.class</code> .  لنقم بتفكيكها ونرى ما قام المترجم بإنشائه هناك: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; javap -private Point.class Compiled from "Point.java" final class Point extends java.lang.Record { private final float x; private final float y; public Point(float, float); public java.lang.String toString(); public final int hashCode(); public final boolean equals(java.lang.Object); public float x(); public float y(); }</code> </pre> <br>  نعم ، أنشأ المترجم ما يلي: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الفئة النهائية الموروثة من <a href="https://download.java.net/java/early_access/jdk14/docs/api/java.base/java/lang/Record.html">java.lang.Record</a> (على غرار <code>enum</code> ، الذي يرث من <code>java.lang.Enum</code> ). </li><li style=";text-align:right;direction:rtl">  الحقول النهائية الخاصة <code>x</code> و <code>y</code> . </li><li style=";text-align:right;direction:rtl">  مُنشئ عام يطابق توقيع السجل نفسه.  ويسمى هذا المنشئ <i>الكنسي</i> . </li><li style=";text-align:right;direction:rtl">  تطبيقات <code>toString()</code> ، <code>hashCode()</code> <code>equals()</code> .  ومن المثير للاهتمام أن <code>hashCode()</code> و <code>equals()</code> <code>toString()</code> ، و <code>toString()</code> ليس كذلك.  من غير المرجح أن يؤثر هذا على أي شيء ، لأن الفصل نفسه <code>final</code> ، لكن هل يعرف أحد لماذا فعلوا ذلك؟  (لست كذلك) </li><li style=";text-align:right;direction:rtl">  طرق قراءة الحقول. </li></ul><br>  مع المنشئ وطرق القراءة ، كل شيء واضح ، لكنني أتساءل كيف يتم تنفيذ <code>toString()</code> و <code>hashCode()</code> و <code>equals()</code> بالضبط؟  لنرى.  للقيام بذلك ، قم بتشغيل <code>javap</code> باستخدام علامة <code>-verbose</code> : <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">دبوس طويل مفكك</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; javap -private -verbose Point.class Classfile Point.class Last modified 29 . 2019 .; size 1157 bytes SHA-256 checksum 24fe5489a6a01a7232f45bd7739a961c30d7f6e24400a3e3df2ec026cc94c0eb Compiled from "Point.java" final class Point extends java.lang.Record minor version: 65535 major version: 58 flags: (0x0030) ACC_FINAL, ACC_SUPER this_class: #8 // Point super_class: #2 // java/lang/Record interfaces: 0, fields: 2, methods: 6, attributes: 4 Constant pool: #1 = Methodref #2.#3 // java/lang/Record."&lt;init&gt;":()V #2 = Class #4 // java/lang/Record #3 = NameAndType #5:#6 // "&lt;init&gt;":()V #4 = Utf8 java/lang/Record #5 = Utf8 &lt;init&gt; #6 = Utf8 ()V #7 = Fieldref #8.#9 // Point.x:F #8 = Class #10 // Point #9 = NameAndType #11:#12 // x:F #10 = Utf8 Point #11 = Utf8 x #12 = Utf8 F #13 = Fieldref #8.#14 // Point.y:F #14 = NameAndType #15:#12 // y:F #15 = Utf8 y #16 = Fieldref #8.#9 // Point.x:F #17 = Fieldref #8.#14 // Point.y:F #18 = InvokeDynamic #0:#19 // #0:toString:(LPoint;)Ljava/lang/String; #19 = NameAndType #20:#21 // toString:(LPoint;)Ljava/lang/String; #20 = Utf8 toString #21 = Utf8 (LPoint;)Ljava/lang/String; #22 = InvokeDynamic #0:#23 // #0:hashCode:(LPoint;)I #23 = NameAndType #24:#25 // hashCode:(LPoint;)I #24 = Utf8 hashCode #25 = Utf8 (LPoint;)I #26 = InvokeDynamic #0:#27 // #0:equals:(LPoint;Ljava/lang/Object;)Z #27 = NameAndType #28:#29 // equals:(LPoint;Ljava/lang/Object;)Z #28 = Utf8 equals #29 = Utf8 (LPoint;Ljava/lang/Object;)Z #30 = Utf8 (FF)V #31 = Utf8 Code #32 = Utf8 LineNumberTable #33 = Utf8 MethodParameters #34 = Utf8 ()Ljava/lang/String; #35 = Utf8 ()I #36 = Utf8 (Ljava/lang/Object;)Z #37 = Utf8 ()F #38 = Utf8 SourceFile #39 = Utf8 Point.java #40 = Utf8 Record #41 = Utf8 BootstrapMethods #42 = MethodHandle 6:#43 // REF_invokeStatic java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object; #43 = Methodref #44.#45 // java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object; #44 = Class #46 // java/lang/runtime/ObjectMethods #45 = NameAndType #47:#48 // bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object; #46 = Utf8 java/lang/runtime/ObjectMethods #47 = Utf8 bootstrap #48 = Utf8 (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object; #49 = String #50 // x;y #50 = Utf8 x;y #51 = MethodHandle 1:#7 // REF_getField Point.x:F #52 = MethodHandle 1:#13 // REF_getField Point.y:F #53 = Utf8 InnerClasses #54 = Class #55 // java/lang/invoke/MethodHandles$Lookup #55 = Utf8 java/lang/invoke/MethodHandles$Lookup #56 = Class #57 // java/lang/invoke/MethodHandles #57 = Utf8 java/lang/invoke/MethodHandles #58 = Utf8 Lookup { private final float x; descriptor: F flags: (0x0012) ACC_PRIVATE, ACC_FINAL private final float y; descriptor: F flags: (0x0012) ACC_PRIVATE, ACC_FINAL public Point(float, float); descriptor: (FF)V flags: (0x0001) ACC_PUBLIC Code: stack=2, locals=3, args_size=3 0: aload_0 1: invokespecial #1 // Method java/lang/Record."&lt;init&gt;":()V 4: aload_0 5: fload_1 6: putfield #7 // Field x:F 9: aload_0 10: fload_2 11: putfield #13 // Field y:F 14: return LineNumberTable: line 1: 0 MethodParameters: Name Flags x y public java.lang.String toString(); descriptor: ()Ljava/lang/String; flags: (0x0001) ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokedynamic #18, 0 // InvokeDynamic #0:toString:(LPoint;)Ljava/lang/String; 6: areturn LineNumberTable: line 1: 0 public final int hashCode(); descriptor: ()I flags: (0x0011) ACC_PUBLIC, ACC_FINAL Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokedynamic #22, 0 // InvokeDynamic #0:hashCode:(LPoint;)I 6: ireturn LineNumberTable: line 1: 0 public final boolean equals(java.lang.Object); descriptor: (Ljava/lang/Object;)Z flags: (0x0011) ACC_PUBLIC, ACC_FINAL Code: stack=2, locals=2, args_size=2 0: aload_0 1: aload_1 2: invokedynamic #26, 0 // InvokeDynamic #0:equals:(LPoint;Ljava/lang/Object;)Z 7: ireturn LineNumberTable: line 1: 0 public float x(); descriptor: ()F flags: (0x0001) ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: getfield #16 // Field x:F 4: freturn LineNumberTable: line 1: 0 public float y(); descriptor: ()F flags: (0x0001) ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: getfield #17 // Field y:F 4: freturn LineNumberTable: line 1: 0 } SourceFile: "Point.java" Record: float x; descriptor: F float y; descriptor: F BootstrapMethods: 0: #42 REF_invokeStatic java/lang/runtime/ObjectMethods.bootstrap:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/TypeDescriptor;Ljava/lang/Class;Ljava/lang/String;[Ljava/lang/invoke/MethodHandle;)Ljava/lang/Object; Method arguments: #8 Point #49 x;y #51 REF_getField Point.x:F #52 REF_getField Point.y:F InnerClasses: public static final #58= #54 of #56; // Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles</code> </pre> </div></div><br>  في تطبيق <code>toString()</code> ، <code>hashCode()</code> و <code>equals()</code> نرى <code>invokedynamic</code> .  هذا يعني أنه سيتم إنشاء منطق هذه الأساليب بتكاسل بواسطة الجهاز الظاهري نفسه.  لست متخصصًا في وقت التشغيل ، لكنني أعتقد أن هذا يتم لتحقيق كفاءة أفضل.  على سبيل المثال ، إذا توصلوا في المستقبل إلى علامة تجزئة أسرع ، في هذا النهج ، ستحصل الشفرة المترجمة القديمة على جميع مزايا الإصدار الجديد.  كما أنه يقلل من حجم ملفات الفئة. <br><br>  ولكن شيئا ذهبنا عميقا.  دعنا نعود إلى سجلات <s>الأغنام</s> لدينا.  دعونا نحاول إنشاء مثيل <code>Point</code> ونرى كيف تعمل الطرق.  من الآن فصاعدًا ، لن أستخدم <code>javac</code> وأعد تشغيل ملف java مباشرةً: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">… <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); System.out.println(point); System.out.println(<span class="hljs-string"><span class="hljs-string">"hashCode = "</span></span> + point.hashCode()); System.out.println(<span class="hljs-string"><span class="hljs-string">"hashCode2 = "</span></span> + Objects.hash(point.x(), point.y())); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); System.out.println(point.equals(point2)); } } <span class="hljs-function"><span class="hljs-function">record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Main.java Note: Main.java uses preview language features. Note: Recompile with -Xlint:preview for details. Point[x=1.0, y=2.0] hashCode = -260046848 hashCode2 = -260045887 true</code> </pre> <br>  وبالتالي ، يعمل <code>toString()</code> و <code>equals()</code> كما كنت أتوقع (جيدًا ، ما لم يستخدم <code>toString()</code> الأقواس المربعة ، لكنني أود الأقواس المتعرجة).  لكن <code>hashCode()</code> يعمل بشكل مختلف.  لسبب ما ، أعتقد أنه سيكون متوافقًا مع <code>Objects.hash()</code> .  لكن لا شيء يمنعنا من إنشاء تطبيقنا الخاص لـ <code>hashCode()</code> .  دعونا نفعل ذلك ، وفي الوقت نفسه سننقل الطريقة <code>main()</code> الداخل: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">… <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.hash(x, y); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).hashCode()); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Point.java Note: Point.java uses preview language features. Note: Recompile with -Xlint:preview for details. -260045887</code> </pre> <br>  OK.  الآن دعونا نتحقق من المترجم للتأكد من متانته.  لنقم بشيء غير صحيح ، على سبيل المثال ، أضف حقلًا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z; }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:2: error: field declaration must be static private float z; ^ (consider replacing field with record component)</code> </pre> <br>  لذلك ، يمكنك إضافة الحقول الثابتة فقط. <br><br>  أتساءل ماذا سيحدث إذا قمت بإجراء المكونات <code>final</code> ؟  هل سيكونون أكثر نهائية؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:1: error: record components cannot have modifiers public record Point(final float x, final float y) { ^ Point.java:1: error: record components cannot have modifiers public record Point(final float x, final float y) { ^</code> </pre> <br>  ربما هذا هو الحظر المنطقي.  بحيث لا يوجد أي وهم بأن المكونات ستصبح قابلة للتغيير إذا قمت بإزالة النهائي.  نعم ، <code>enum</code> له قاعدة مماثلة ، لذلك لا شيء جديد: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> A { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> X; <span class="hljs-comment"><span class="hljs-comment">// No modifiers allowed for enum constants }</span></span></code> </pre> <br>  ماذا لو تجاوزت طريقة الوصول؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:2: error: invalid accessor method in record Point public double x() { ^ (return type of accessor method x() is not compatible with type of record component x)</code> </pre> <br>  هذا منطقي تماما. <br><br>  وإذا قمت بتغيير الرؤية؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:2: error: invalid accessor method in record Point private float x() { ^ (accessor method must be public)</code> </pre> <br>  إنه مستحيل أيضًا. <br><br>  الوراثة من الفصول محظورة ، حتى من <code>Object</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> extends Object </span></span>{ }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:1: error: '{' expected public record Point(float x, float y) extends Object { ^</code> </pre> <br>  ولكن يمكنك تنفيذ واجهات: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> implements PointLike </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ PointLike point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); System.out.println(point.x()); System.out.println(point.y()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PointLike</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Point.java Note: Point.java uses preview language features. Note: Recompile with -Xlint:preview for details. 1.0 2.0</code> </pre> <br>  من الممتع أن تلعب قليلاً مع المنشئ القانوني.  أولاً ، دعنا نكتب مُنشئًا قانونيًا مدمجًا ، أي  مُنشئ قانوني بدون وسيطات ، وإضافة التحقق من صحة معلمات الإدخال هناك: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Float.isNaN(x) || Float.isNaN(y)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"NaN"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(Float.NaN, <span class="hljs-number"><span class="hljs-number">2</span></span>)); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">… Exception in thread "main" java.lang.IllegalArgumentException: NaN at Point.&lt;init&gt;(Point.java:4) at Point.main(Point.java:9)</code> </pre> <br>  انها ربحت.  لكنني أتساءل عما إذا كانت ستنجح إذا كتبت الرمز نفسه ، ولكن من خلال <code>return</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Float.isNaN(x) &amp;&amp; !Float.isNaN(y)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"NaN"</span></span>); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:2: error: invalid compact constructor in record Point(float,float) public Point { ^ (compact constructor must not have return statements)</code> </pre> <br>  تفاصيل مثيرة للاهتمام.  من غير المحتمل أن يؤذيني هذا كثيرًا في الحياة ، حيث أنني لست من عشاق الكتابة ، لكن على جميع مطوري IDE أن يضعوا ذلك في الاعتبار. <br><br>  دعونا نجرب منشئ قانوني واضح.  وأتساءل عما إذا كان من الممكن إعادة تسمية المعلمات؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Float.isNaN(_x) || Float.isNaN(_y)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"NaN"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = _x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = _y; } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:2: error: invalid canonical constructor in record Point public Point(float _x, float _y) { ^ (invalid parameter names in canonical constructor)</code> </pre> <br>  اتضح أنه لا يمكنك إعادة تسمية.  لكني لا أرى شيئًا خاطئًا في مثل هذا التقييد.  الرمز سيكون أكثر نظافة. <br><br>  وماذا عن ترتيب التهيئة؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point { System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">… Point[x=0.0, y=0.0] Point[x=-1.0, y=2.0]</code> </pre> <br>  <code>Point</code> طباعة First <code>Point</code> بأصفار ، مما يعني أنه تم تعيين الحقول في نهاية المنشئ ، بعد <code>System.out.println(this)</code> . <br><br>  حسنا.  ماذا عن إضافة مُنشئ غير قانوني؟  على سبيل المثال ، مُنشئ بدون وسيطات: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:2: error: constructor is not canonical, so its first statement must invoke another constructor public Point() { ^</code> </pre> <br>  نعم ، نسيت أن تكتب <code>this(0, 0)</code> .  لكننا لن نصحح ونتحقق من ذلك. <br><br>  ماذا عن الوراثة؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> record Point&lt;A extends Number&gt;(A x, A y) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point&lt;&gt;(-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Point.java Note: Point.java uses preview language features. Note: Recompile with -Xlint:preview for details. Point[x=-1, y=2]</code> </pre> <br>  لا شيء خارق.  حسنًا ، باستثناء أنك تحتاج إلى تذكر أنه يجب تعيين معلمات الكتابة قبل تسجيل المعلمات. <br><br>  هل من الممكن إنشاء سجل بدون مكونات؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">None</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> None()); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 None.java Note: None.java uses preview language features. Note: Recompile with -Xlint:preview for details. None[]</code> </pre> <br>  لم لا. <br><br>  ما الأشياء التي لم نجربها؟  ماذا عن المشاركات المتداخلة؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nested</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(x); } } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Point.java:4: error: non-static record component x cannot be referenced from a static context System.out.println(x); ^</code> </pre> <br>  هذا يعني أن الإدخالات المتداخلة ثابتة دائمًا (مثل <code>enum</code> ).  إذا كان الأمر كذلك ، فماذا لو كنت تعلن عن سجل محلي؟  من الناحية النظرية ، يجب ألا تلتقط سياقًا خارجيًا غير ثابت: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(Arrays.toString(args)); } } <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).print(); } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Main.java Note: Main.java uses preview language features. Note: Recompile with -Xlint:preview for details. []</code> </pre> <br>  حسنًا ، لقد عملت.  أعتقد أن هذا خطأ.  أو مجرد خلل: هذا السلوك موروث من فصول محلية عادية يمكنها التقاط متغيرات نهائية خارجية فعالة ، لكنهم نسوا إصلاحها للسجلات. <br><br>  نقطة حساسة تهمني: هل من الممكن إنشاء عدة سجلات عامة في ملف واحد؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; javac --enable-preview --release 14 Point.java Point.java:4: error: class Point2 is public, should be declared in a file named Point2.java public record Point2(float x, float y) { ^</code> </pre> <br>  هذا مستحيل.  أتساءل ما إذا كانت هذه ستكون مشكلة في المشاريع الحقيقية؟  بالتأكيد سيرغب الكثيرون في كتابة الكثير من السجلات لتصميم كياناتهم.  ثم سيتعين عليك تحليلها جميعًا في ملفاتك الخاصة ، أو استخدام السجلات المرفقة. <br><br>  أخيرًا ، أود أيضًا أن ألعب بالتفكير.  كيف في وقت التشغيل لمعرفة معلومات حول المكونات التي يحتوي على سجل؟  لهذا ، يمكنك استخدام الأسلوب <a href="https://download.java.net/java/early_access/jdk14/docs/api/java.base/java/lang/Class.html">Class.getRecordComponents ()</a> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.RecordComponent; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (RecordComponent component : point.getClass().getRecordComponents()) { System.out.println(component); } } }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Point.java Note: Point.java uses preview language features. Note: Recompile with -Xlint:preview for details. float x float y</code> </pre> <br>  لاحظت أيضًا أنه في Java 14 ، ظهر نوع جديد من التعليقات التوضيحية خصيصًا لتسجيل المكونات: <a href="https://download.java.net/java/early_access/jdk14/docs/api/java.base/java/lang/annotation/ElementType.html">ElementType.RECORD_COMPONENT</a> .  وماذا يحدث إذا استخدمت الأنواع القديمة <code>FIELD</code> و <code>PARAMETER</code> ؟  بعد كل شيء ، يبدو أن المكونات ليست حقول ولا معلمات: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @FieldAnnotation @ComponentAnnotation </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, @ParamAnnotation @ComponentAnnotation </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.FIELD) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> FieldAnnotation { } <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.PARAMETER) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ParamAnnotation { } <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.RECORD_COMPONENT) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ComponentAnnotation { }</code> </pre> <br>  نعم ، يتم تجميع الشفرة ، لذا تعمل الثلاثة.  حسنًا ، هذا منطقي.  أتساءل عما إذا كان سيتم "جرهم" إلى الحقول؟ <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> record </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Point</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @FieldAnnotation @ComponentAnnotation </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, @ParamAnnotation @ComponentAnnotation </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); Field[] fields = point.getClass().getDeclaredFields(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Field field : fields) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Annotation annotation : field.getAnnotations()) { System.out.println(field + <span class="hljs-string"><span class="hljs-string">": "</span></span> + annotation); } } } } <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.FIELD) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> FieldAnnotation { } <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.PARAMETER) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ParamAnnotation { } <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.RECORD_COMPONENT) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ComponentAnnotation { }</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">&gt; java --enable-preview --source 14 Point.java Note: Point.java uses preview language features. Note: Recompile with -Xlint:preview for details. private final float Point.x: @FieldAnnotation()</code> </pre><br>  وهذا يعني أن التعليقات التوضيحية <code>FIELD</code> هي فقط " <code>RECORD_COMPONENT</code> " ، ولكن ليس <code>RECORD_COMPONENT</code> و <code>PARAMETER</code> . <br><br>  ربما سأنتهي بهذا ، لأن المقال قد بدا مرهقًا بالفعل.  يمكن للمرء أن "يحفر" لفترة طويلة وعميق ، واختبار جميع أنواع الحالات المختلفة ، لكنني أعتقد أن المستوى الحالي للعمق أكثر من كاف. <br><br><h4 style=";text-align:right;direction:rtl">  النتائج </h4><br>  مما لا شك فيه أن السجلات شيء رائع ومتوقع للغاية من جانب المجتمع الذي سيوفر لنا وقتًا في المستقبل ويوفر علينا قدرًا كبيرًا من التعليمات البرمجية للملف.  الآن أصبحت التسجيلات جاهزة تقريبًا ، ويظل فقط في انتظار إصلاح <a href="https://bugs.openjdk.java.net/browse/JDK-8236005">بعض</a> <a href="https://bugs.openjdk.java.net/browse/JDK-8236210">الدرجات الخشنة</a> وإصدار الإصدار العمومي من Java 14. صحيحًا ، ستظل بحاجة إلى الانتظار حتى الإصدارين الأول والثاني عندما تصبح التسجيلات مستقرة ، ولكن إذا كنت ترغب في ذلك ، فيمكنك استخدامها في وضع المعاينة . <br><br>  وأولئك الذين ليسوا في عجلة من أمرهم للتبديل من Java 8 ، أعتقد أننا يجب أن ننتظر حتى سبتمبر 2021 ، وأن نتحول على الفور إلى Java 17 ، حيث ستكون هناك بالفعل <a href="https://openjdk.java.net/jeps/361">تعبيرات تبديل</a> مستقرة ، <a href="https://openjdk.java.net/jeps/368">وكتل نصية</a> ، <a href="https://openjdk.java.net/jeps/305">ومثيل محسن</a> ، <a href="https://openjdk.java.net/jeps/359">وسجلات</a> <a href="https://openjdk.java.net/jeps/360">وأنواع مختومة</a> (مع احتمال كبير). <br><br>  ملاحظة: إذا كنت لا تريد أن تفوت الأخبار والمقالات حول جافا ، فنوصيك بالاشتراك في <a href="https://t.me/miniJUG">قناتي في Telegram</a> . <br><br>  كل ذلك مع المجيء! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar482300/">https://habr.com/ru/post/ar482300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar482290/index.html">نزاع بوت مع الاقتصاد مع sqlite</a></li>
<li><a href="../ar482292/index.html">العالم الداخلي للفومانتس P432</a></li>
<li><a href="../ar482294/index.html">أخبار من خريطة الشارع المفتوح رقم 491 (10.12.2019-16.12.2019)</a></li>
<li><a href="../ar482296/index.html">البرنامج التعليمي من Ember.js تعليمي. سوبر الإيجارات التطبيق. الجزء 1.1</a></li>
<li><a href="../ar482298/index.html">مبرمج متعصب. كيفية الحفاظ على المزايا التنافسية وتصبح مرئية؟</a></li>
<li><a href="../ar482302/index.html">ضباب نفسي عن العام الجديد</a></li>
<li><a href="../ar482304/index.html">صنع من أجل الصين: كيفية إنشاء لافتة مثالية للمستهلك الصيني</a></li>
<li><a href="../ar482308/index.html">نصنع مشروعًا إضافيًا مع تجميع للإصدارات المختلفة من Revit / AutoCAD</a></li>
<li><a href="../ar482310/index.html">نقل الحيوانات من القرن 21st</a></li>
<li><a href="../ar482314/index.html">بناء مجموعة PostgreSQL عالية التوفر باستخدام Patroni ، وغيرها ، HAProxy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>