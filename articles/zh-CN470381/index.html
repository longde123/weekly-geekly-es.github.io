<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🤝‍👨🏼 🐖 📞 ATMEGA328P控制器上的自主气象站，电池由无线遥感器供电 👂🏻 🙆 😞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="改善房间温度调节器，这是我之前写的 ，我打算用无线温度传感器来补充它，以测量室外空气温度，组装电池供电的温度调节器，并用另一对无线电模块替换RF 433MHz发射器-接收器模块，该模块具有更长的通信范围，且供电电压不超过超过3V。 在解决这些问题的过程中，出现了一个自动气象站，下面将对此进行讨论。 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ATMEGA328P控制器上的自主气象站，电池由无线遥感器供电</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470381/"><p> 改善<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">房间温度调节器，这是我之前写的</a> ，我打算用无线温度传感器来补充它，以测量室外空气温度，组装电池供电的温度调节器，并用另一对无线电模块替换RF 433MHz发射器-接收器模块，该模块具有更长的通信范围，且供电电压不超过超过3V。 在解决这些问题的过程中，出现了一个自动气象站，下面将对此进行讨论。 </p><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dd/vj/6r/ddvj6rih_mxyi4izpiz4iplozik.gif"></div><br><p> 气象站由两个节点组成，为简单起见，我们将其称为分析仪和温度计。 节点之间的通信-无线，无线。 </p><br><p> 分析仪基于ATMEGA328P控制器，可测量室内的温度和湿度（温度和湿度传感器DHT22）以及分析仪的电源电压，该电压由两节AA 1.5V电池提供。 控制器从LoRa接收器接收信号，该接收器通过空气从温度计（远程传感器）接收信息。 来自控制器的信息显示在诺基亚5110的LCD上。 </p><br><p> 温度计也安装在ATMEGA328P控制器上，用于测量室外温度（温度传感器DS18B20）和远程单元的电源电压，该远程单元由两节1.5 V AA电池组组成，该单元的LoRa变送器将温度和电源电压传输到分析仪。 </p><br><p> 温度计的ATMEGA328P控制器和LoRa变送器进入睡眠模式，以节省测量后的电池电量并发送信息。 仅在温度测量期间以编程方式施加DS18B20传感器的电源电压。 温度计的测量和发送数据需要大约一分钟的时间。 </p><br><p> 在相同的工作睡眠模式下，分析仪也可以工作。 控制器和接收器分析仪的持续时间要比一分钟多几秒钟。 这样做是为了放心地接收来自温度计的信号-毕竟，温度计和分析仪的操作不同步。 然后将ATMEGA328P和LoRa接收器置于睡眠模式达14分钟，然后唤醒并开始下一个周期。  DHT22仅在测量期间提供电源。 </p><br><p> 为了编程ATMEGA328P控制器的睡眠模式，使用了LowPower.h库。 </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">随着电池放电，电池上的电压值降低。</a> </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/hi/6z/obhi6ztutl3wckifbjzbg0p-pcs.png"></div><br><p>  ATMEGA328P控制器的工作电压下限为1.8V。 同时，执行了保险丝ATMEGA328P的出厂设置以监视2.7V的电源电压阈值，因此有必要将保险丝的出厂设置更改为1.8V的监视阈值，以确保由废电池供电时控制器的运行。 </p><br><p> 内部控制器发生器可能无法以3 MHz或更低的电源电压以16 MHz的频率启动。 两种控制器均使用2.7 ... 2.8 V降低的电源电压使用16 MHz石英，因此我没有将16 MHz石英更改为8 MHz。 </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/kl/rf/orklrfdoalqoh5d3gsqxde-9x_c.jpeg"></div><br><p> 要组装设备，您将需要一些组件，这些组件的列表及其在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">速卖通</a>网站价格上的估计成本显示在表中。 </p><br><table border="1"><tbody><tr><td>  <strong>组成部分</strong> </td><td>  <strong>价格，美元</strong> </td></tr><tr><td colspan="2">  <em>分析仪</em> </td></tr><tr><td>  ATMEGA328P-PU控制器 </td><td>  1,59 </td></tr><tr><td> 温湿度传感器DHT22 </td><td>  2,34 </td></tr><tr><td>  LoRa Ra-01发送器 </td><td>  3.95 </td></tr><tr><td> 诺基亚5110液晶屏 </td><td>  1.91 </td></tr><tr><td> 面包板（安装）板，安装线，AA电池，16 MHz石英谐振器，电阻器等。 </td><td>  4.00 </td></tr><tr><td colspan="2">  <em>体温计</em> </td></tr><tr><td>  ATMEGA328P-PU控制器 </td><td>  1,59 </td></tr><tr><td>  DS18B20温度传感器 </td><td>  0.63 </td></tr><tr><td>  LoRa Ra-01发送器 </td><td>  3.95 </td></tr><tr><td> 开发板（玻璃纤维），安装线，AA电池，16 MHz石英谐振器，电阻器等。 </td><td>  4.00 </td></tr><tr><td>  <strong>总计（大约）：</strong> </td><td>  <strong>24</strong> </td></tr></tbody></table><br><p></p><h4> 分析仪 </h4><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/of/fu/xd/offuxdrjbzlmia_xnnsfqeliisc.jpeg"></div><br><p> 分析仪的大脑是ATMEGA328P控制器。 它从DHT22传感器接收信号，并通过SPI协议与LoRa接收器和NOKIA 5110显示器进行通信。 </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/b3/wl/9b/b3wl9b2zijmxgg8yso3xxt1faxq.png"></div><br><p></p><p> 互联网上有很多关于DHT22精度低的投诉。 如今有另一种选择：更现代的温度和湿度传感器<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTU21（GY21）</a> ，（Vcc = 3 ... 5 V）， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Si7021</a> ，（Vcc = 1.9 ... 3.6 V）， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SHT21</a> ，（Vcc = 2.1 .... 3.6 V）。 </p><br><p> 我使用DHT22，因为我的传感器样品的湿度读数与市售的LaCrosse WS-9024IT温湿度计之间的差异不超过8个单位，这对于家用而言是可以接受的。 如果DHT22电源电压低于3V，则湿度读数之间的差异会大大增加。 这是可以理解的，因为DHT22的电源电压应在3 ... 5V之内。 总结一下-在这些情况下，理想的情况是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Si7021</a>传感器适合分析仪<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">电路</a> 。 </p><br><p> 在下面的图片中-气象站元素的引脚排列。 </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/ut/go/gqutgob1fbq1hd85xtnovdvphfw.png"></div><br><p></p><p> 可以使用SinaProg实用程序读取和编辑Fusion以及包括ATMEGA328P在内的各种控制器。 如果您是第一次使用此程序，则尽管界面直观，但在安装应用程序后请勿尝试开始使用它。 首先阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">本文</a> ，其中在将Arduino UNO板用作引导加载程序时， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">HWman</a>提供了必要的SinaProg附加组件。 </p><br><p> 我建议您首先阅读融合ATMEGA328P的出厂设置，并保存它们的值，以便在出现故障时返回到它们。 在我的控制器中，保险丝位的出厂设置为： <strong>LOW：0xFF，HIGH：0xDE，EXTENDED：0x05</strong> （Vcc = 2.7V，BODLEVEL = 101）。 用于监视您要设置的1.8V阈值的新保险丝： <strong>LOW：0xFF，HIGH：0xDE，EXTENDED：0x06</strong> （Vcc = 1.8V，BODLEVEL = 110）。 </p><br><p> 用于加载到ATMEGA328P中的分析仪草图在扰流板下方。 </p><br><div class="spoiler">  <b class="spoiler_title">分析仪草图</b> <div class="spoiler_text">  ```cpp <br>  / * <br>  ATMEGA328P控制器上的自主气象站，电池由无线遥感器，分析仪供电 <br>  https://habr.com/cn/post/470381/ <br>  * / <br><br>  #include &lt;SPI.h&gt; <br>  #include &lt;LoRa.h&gt; <br><br>  #include &lt;DHT.h&gt; <br>  #define DHTPIN 3 //我们连接到哪个数字引脚 <br>  #define DHTTYPE DHT22 // DHT 22（AM2302），AM2321 <br>  DHT dht（DHTPIN，DHTTYPE）； <br><br> 浮锡= 0; <br>  int Hin = 0; <br> 浮动BatteryInLevel;  //基本电池电压 <br> 字符串LoRaData，Tout_str，BatteryInLevel_str，BatteryOutLevel_str; <br><br>  //睡觉 <br>  #include &lt;LowPower.h&gt; <br>  #define PowerDHT（4）// DHT22电源引脚 <br>  unsigned int sleepCounter; <br><br>  //诺基亚5110 <br>  #include &lt;SPI.h&gt; <br>  #include &lt;Adafruit_GFX.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br>  #include &lt;Adafruit_PCD8544.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br><br>  //计时器 <br>  #include &lt;SimpleTimer.h&gt; <br>  SimpleTimer计时器； <br><br>  Adafruit_PCD8544显示= Adafruit_PCD8544（5、7、6）; <br><br> 无效sendSensor（）{ <br>  digitalWrite（PowerDHT，1）; <br> 延误（2000）; <br>  Hin = dht.readHumidity（）; <br> 锡= dht.readTemperature（）; <br><br>  / * if（isnan（Hin）|| isnan（Tin））{ <br>  // Serial.println（“无法从DHT传感器读取！”）； <br> 归还 <br>  } * / <br><br>  digitalWrite（PowerDHT，0）; <br><br>  //电池电压测量： <br>  AnalogReference（INTERNAL）; <br>  int sensorValue = AnalogRead（A4）; <br>  BatteryInLevel =（传感器值* 3.2 / 1024）; <br>  } <br><br> 无效抽奖（）{ <br>  display.clearDisplay（）; <br>  //锡 <br>  { <br>  display.setTextSize（2）; <br>  display.setCursor（8，0）; <br>  display.println（Tin，1）;  //小数点后一位 <br>  display.setCursor（68，0）; <br>  display.println（“ C”）; <br>  } <br>  //欣 <br>  { <br>  display.setTextSize（2）; <br>  display.setCursor（8，16）; <br>  display.println（String（Hin）+“％”）; <br>  } <br>  // Tout <br>  { <br> 字符chr_Tout [12]; <br><br>  Tout_str.toCharArray（chr_Tout，5）; <br>  display.setTextSize（1）; <br>  display.setCursor（50，16）; <br>  display.println（String（chr_Tout）+“ C”）; <br>  } <br>  //电池电量不足 <br>  { <br>  char chr_BatteryOutLevel [12]; <br><br>  BatteryOutLevel_str.toCharArray（chr_BatteryOutLevel，4）; <br>  display.setTextSize（1）; <br>  display.setCursor（2，32）; <br>  display.println（“ BAT Out：” +字符串（chr_BatteryOutLevel）+“ V”）; <br>  } <br>  //电池电量 <br>  { <br>  display.setTextSize（1）; <br>  display.setCursor（2，40）; <br>  display.println（“ BAT In：„）; <br>  display.setCursor（56，40）; <br>  display.println（BatteryInLevel，1）;  //小数点后一位 <br>  display.setCursor（74，40）; <br>  display.println（“ V”）; <br>  } <br><br>  display.display（）; <br>  / * <br>  Serial.println（“ Tin：” +字符串（Tin）+“ * C”）； <br>  Serial.println（“ H​​in：” +字符串（Hin）+“％”）； <br>  Serial.println（“ Tout：” +字符串（Tout_str）+“ * C”）； <br>  Serial.println（“ BAT_In：” +字符串（BatteryInLevel）+“ V”）； <br>  Serial.println（“ BAT_Out：” +字符串（BatteryOutLevel_str）+“ V”）； <br>  Serial.println（“ ......”）; <br>  * / <br>  } <br><br>  void sleepDevice（）{ <br>  // sleepCounter = 65-10分钟 <br>  // sleepCounter = 91-14分钟 <br>  for（sleepCounter = 91; sleepCounter&gt; 0; sleepCounter--）// 91 !!! <br>  { <br>  LoRa.sleep（）; <br>  LowPower.powerDown（SLEEP_8S，ADC_OFF，BOD_OFF）; <br>  } <br>  LoRa.sleep（）; <br>  } <br><br> 无效SignalReception（）{ <br>  //尝试解析数据包 <br>  int packetSize = LoRa.parsePacket（）; <br> 如果（packetSize）{ <br>  //读取数据包 <br> 而（LoRa.available（））{ <br>  LoRaData = LoRa.readString（）; <br>  // Serial.println（“ Accepted：” +（LoRaData））; <br>  } <br>  int pos1 = LoRaData.indexOf（'＃'）; <br>  Tout_str = LoRaData.substring（0，pos1）; <br>  BatteryOutLevel_str = LoRaData.substring（pos1 + 1，LoRaData.length（））; <br>  } <br>  } <br><br> 无效设置（）{ <br>  //Serial.begin(9600）; <br>  pinMode（PowerDHT，输出）; <br><br>  //初始化并清除显示 <br>  display.begin（）; <br>  display.clearDisplay（）; <br>  display.display（）; <br>  display.setContrast（60）;  //设置对比度 <br><br>  display.clearDisplay（）; <br>  display.setTextSize（2）; <br>  display.setCursor（12，16）; <br>  display.println（“ &gt;&gt;&gt;&gt;&gt;”）;  //开启时指示工作开始 <br>  display.display（）; <br><br>  dht.begin（）; <br>  sendSensor（）; <br> 画（）; <br><br>  while（！LoRa.begin（433E6））{ <br>  //Serial.println（“。”）; <br> 延误（500）; <br>  } <br>  //同步字的范围在“ 0-0xFF”之间。 <br>  LoRa.setSyncWord（0xF3）; <br>  //Serial.println（wonLoRa初始化“）; <br>  timer.setInterval（20000，sendSensor）; <br>  timer.setInterval（5000，开奖）; <br>  timer.setInterval（65000，sleepDevice）; <br>  } <br><br> 无效循环（）{ <br>  SignalReception（）; <br>  timer.run（）; <br>  } <br>  ``'' </div></div><br><br><p> 为了与ATMEGA328P控制器一起使用，我将Arduino UNO板用作编程器。  Youtube <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上</a>有一个很好的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视频，介绍如何安装引导加载程序</a>以及使用Arduino UNO板将草图下载到ATMEGA328控制器。 </p><br><p> 草图注释掉了输出到串行端口监视器（串行）的命令。 如有必要，请取消注释。 </p><br><p> 该周期开始于通过LoRa接收器收听广播并接收信息。 计时器设定收听时间-65秒。 此时，以5秒钟的时间更新NOKIA显示屏上的信息，以20秒钟的时间（3次）更新DHT22传感器通过控制器的模拟输入之一测量温度，湿度以及电池的电压水平。  DHT22的电源电压仅在测量期间以至少2秒的延迟施加，此时传感器仍在工作。 草图中ADC的输出按比例缩放为新电池的电压，即3.2V（1.6V x 2）。 空气的收听时间选择为略大于1分钟，以放心地从温度计接收一个数据包，该温度计在1分钟的传输时间内正常工作，但在下面的传输时间更长。 然后，在第62秒，控制器和接收器进入睡眠模式，该模式持续约14分钟，即 分析仪的“工作/睡眠”周期约为15分钟。 我注意到分析仪中的睡眠模式是一种强制措施，旨在显着减少能耗。 </p><br><p> 为了进行比较，下表显示了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LaCrosse WS-9024IT温湿度计</a>和该项目分析仪的特性。 </p><br><p></p><table border="1"><tbody><tr><td>  <strong>参量</strong> </td><td>  <strong>君越WS-9024IT</strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td> 营养学 </td><td>  2xAA，3B，Durasell </td><td>  2xAA，3V，GP Ultra +，1800 mAh </td></tr><tr><td> 睡眠消耗 </td><td></td><td>  350μA（10μA） </td></tr><tr><td> 睡眠时间 </td><td></td><td>  14分钟 </td></tr><tr><td> 运营消耗 </td><td>  &lt;200μA </td><td>  12-18毫安 </td></tr><tr><td> 工作时间 </td><td></td><td> 约1分钟 </td></tr><tr><td> 工作/睡眠周期 </td><td></td><td>  15分钟 </td></tr><tr><td> 营业时间 </td><td> 大约2年 </td><td> 约2.5个月 </td></tr></tbody></table><br><p>  LaCrosse舞蹈的当前消耗量很大。 在表中，我给出了峰值测量值以显示消耗的顺序：不超过200微安。 </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tg/h0/ke/tgh0kev0vv-b_tmlefcjddxmqlg.gif"></div><br><p> 我想用类似业余开发的结果来补充表格，但是我什么也没找到。 可能是因为大多数业余爱好者将信息从传感器输出到计算机，平板电脑，智能手机，或者在传输到网络上其中一项根本不存在节省电池寿命问题的服务的途中的信息。 </p><br><p>  LCD是导致分析仪睡眠（350μA）的主要因素。 如果将其关闭，则功耗将降至10μA。 当LoRa接收器从发射器接收信号时，会发生18 mA的峰值消耗，但该信号需要花费几微秒的时间。 与接收机处于监听模式的时间和消耗10 mA的时间相比，此时间非常短，因此在计算一组电池的工作时间时，我没有考虑此短期峰值。 </p><br><p> 计算工作时间。 <br> 平均电流消耗：10 mA / 15 + 0.35 mA = 1.0 mA，其中15是占空比。 工作时间：1800 mA *小时/ 1.0 mA = 1800小时（2.5个月）。 <br> 我将澄清： <br>  -计算非常近似。 <br>  -LaCrosse的营业时间是根据我自己的经验得出的。 我已经使用此设备很长时间了。 <br></p><br><h4> 体温计 </h4><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/tb/nx/rptbnxv-nlwql3ap7i1rcjdf_wk.jpeg"></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">寒冷天气下电池的容量和电压会大大降低</a> 。 因此，为了不使电池和整个设备经受如此严格的测试，我只取出了房间外面的DS18B20温度传感器，并将设备和电池放在房间里。  DS18B20用细的三线电缆连接到主板。 我在我的串行气象站中发现了该解决方案-开发人员确信，在公寓中总会留有空隙来铺设直径为几毫米的电线。 </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ic/vq/me/icvqmeepxsfgd9ut_hhcais3xle.jpeg"></div><br><p>  ATMEGA328P温度计的保险丝与分析仪的保险丝相同。 </p><br><p> 温度计组件也建在ATMEGA328P控制器上。 它从DS18B20传感器接收信号，测量电源电压并控制LoRa变送器。 </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0d/ie/ww/0diewwzov4r4gwbrojlrvbyzbrq.png"></div><br><p></p><p> 温度计草图在扰流板下方。 </p><br><div class="spoiler">  <b class="spoiler_title">温度计素描</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     ATMEGA328P        ,  https://habr.com/ru/post/470381/ */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;OneWire.h&gt; OneWire ds(7); //pin 13, Atmega328P #include &lt;SPI.h&gt; #include &lt;LoRa.h&gt; #include &lt;LowPower.h&gt; #define PowerDS18B20 (6) //pin 12 (Atmega328P), e DS18B20 unsigned int sleepCounter; // ,    float Tout; // int i; //         (20   1 ) String messageTout; // LoRa- float batteryLevel; //   const int batteryPin = A0; // pin 23 (Atmega328P),        void Measurement () { //  byte data[2]; digitalWrite(PowerDS18B20, 1); ds.reset(); ds.write(0xCC); //     (1 ) ds.write(0x44); //    delay(700); ds.reset(); ds.write(0xCC); ds.write(0xBE); //      data[0] = ds.read(); data[1] = ds.read(); Tout = ((data[1] &lt;&lt; 8) | data[0]) * 0.0625; // Serial.println("Tout= "+ String(Tout)); digitalWrite(PowerDS18B20, 0); //   : analogReference(INTERNAL); int sensorValue = analogRead(A0); batteryLevel = (sensorValue * 3.2 / 1024); // Serial.println("BAT= "+ String(batteryLevel)); } void SetSynchLoRa () { int counter = 0; while (!LoRa.begin(433E6) &amp;&amp; counter &lt; 10) { // Serial.print("."); counter++; delay(500); } LoRa.setTxPower(4); //  2-20  /* if (counter == 10) { // Serial.println("Failed to initialize ..."); }*/ LoRa.setSyncWord(0xF3); } void SendMessage () { //   (,  ) messageTout = String(Tout) + "#" + String(batteryLevel); // Serial.println(messageTout); delay(250); LoRa.beginPacket(); LoRa.print(messageTout); LoRa.endPacket(); } void setup() { //Serial.begin(9600); // Serial.println("Initializing ..."); pinMode(PowerDS18B20, OUTPUT); SetSynchLoRa (); } void loop() { //Serial.println(""); //Serial.println("i = " + String(i)); if (i &gt;= 30) { // i &gt;= 30 (1 ) —   (,  — 1 /1 ) for (sleepCounter = 5; sleepCounter &gt; 0; sleepCounter--) { LoRa.sleep (); LowPower.powerDown(SLEEP_8S, ADC_OFF, BOD_OFF); } Measurement (); SendMessage (); LoRa.sleep (); } else { //   1 ,  — 1 /2  Measurement (); SendMessage (); delay (1000); } i++; if (i &gt;= 30) i = 30; //    }</span></span></span></span></code> </pre> </div></div><br><p> 一对LoRa发射器-接收器可在1.5公里的距离内提供稳定的通信，并具有直接的可视性，并且在城市地区最长可达300 m，当然，最大或接近最大发射器功率：17-20 dB。 为了使公寓内保持稳定连接，仅需4 dB。 </p><br><p> 首先，接通电源后，温度计将在密集模式下运行一分钟。 它测量电池的温度，电压，并每2秒钟将其值在空中发送一次。 这是为了方便。 假设您在更换电池或进行调试时不必等待一分钟。 连接温度计和分析仪的电池后的最初几秒钟，来自传感器的信息将出现在分析仪的显示屏上。 自然，您应该抓紧时间，在两个节点上连接电池之间的时间不要超过一分钟。 </p><br><p> 然后，遥感器进入正常模式。 在测量并发送了比第一秒稍长的信息之后，控制器和发送器进入软件睡眠模式约1分钟。 </p><br><p> 计算工作时间。 <br> 平均电流消耗：14 mA / 60 + 0.005 mA = 0.24 mA，其中60为占空比。 工作时间：1800 mA *小时/ 0.24 mA = 7500小时（10个月）。 <br> 以前有关单组电池计算的工作时间准确性的澄清仍然有效。 <br></p><br><p> 和比较表。 它包含来自Internet的几个类似项目的结果。 </p><br><table border="1"><tbody><tr><td>  <strong>参量</strong> </td><td>  <strong>君越WS-9024IT</strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">疯子</a></strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">avs24rus</a></strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td> 营养学 </td><td>  2xAAA，3B，Durasell </td><td>  3V，CR2450 Renata，540毫安 </td><td>  3V，CR2450，550-610毫安 </td><td>  2xAA，3V，GP Ultra +，1800 mAh </td></tr><tr><td> 睡眠消耗 </td><td></td><td>  0.14 mA（？） </td><td>  14微安 </td><td>  5微安 </td></tr><tr><td> 睡眠时间 </td><td></td><td></td><td></td><td>  1分钟 </td></tr><tr><td> 运营消耗 </td><td>  &lt;700μA </td><td>  13.57毫安 </td><td>  16-18 mA </td><td>  14毫安 </td></tr><tr><td> 工作时间 </td><td></td><td>  0.027秒 </td><td></td><td>  1秒 </td></tr><tr><td> 工作/睡眠周期 </td><td></td><td>  1分钟 </td><td>  10分钟 </td><td>  1分钟 </td></tr><tr><td> 营业时间 </td><td> 大约2年 </td><td></td><td>  0。5年以上 </td><td> 大约10个月 </td></tr></tbody></table><br><p> 如果节点组装正确无误，则在显示屏上我们将看到以下图片： </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/vm/ry/-9/vmry-9owzy-rtsulc5mz5ghzh2g.png"></div><br><p> 从比较表中可以看出，业余设备的峰值功耗比工业LaCrosse的类似功能高一个数量级。 例如，远程传感器为14 mA对700μA，分析仪为10 ... 18 mA对200μA。 我认为，这种最大消耗量的显着差异是通过以下事实来解释的：业余电路中的控制器是使用Arduino IDE平台，繁重的功能和库以及在工业产品中进行编程的-最有可能使用一种低级语言或例如C语言++（顺便说一句，是Arduino的基本语言）或C（C）。 如果您使用这些语言，那么我相信您可以达到与工业品外观设计相当的消费量。 然而，这在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">HWman</a>的出版物“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">为什么许多人不喜欢Arduino</a> ”中非常有说服力地证明了这一点。 正如在视频中作者所言，在一种情况下，在Arduino IDE中执行最多一打的最简单草图（闪烁），正如作者在视频中所说的那样，“简单C”会导致26倍的性能损失。 简而言之，增加资源消耗是为了给程序员带来舒适感和一小部分的付出，其余的将由他在Arduino中对开发环境的“繁琐”功能来完成。 我希望您至少要精通和掌握C / C ++的基础知识，而C / C ++的功能是由Arduino IDE编译的。 </p><br><h4> 结论 </h4><br><p>  •与工业设计相比，组装的分析仪和温度计消耗的电流过多。 </p><br><p>  •第三个建议针对电路中的两个电池，然后自动解决以下问题：无需重新安装保险丝，控制器以16 MHz的频率工作，传感器DHT22，DS18B20远低于其电源电压下限。 后者很重要，因为电源电压不是直接提供给传感器，而是通过控制器引脚上的按键以编程方式提供，在该引脚上大约下降1V。 </p><br><p>  •使用具有4 dB可编程发射器功率的LoRa无线电模块，可以使用两节AA电池为模块供电，从而在公寓内建立稳定的连接。 </p><br><h4> 相关连结 </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">低能耗无线传感器组件</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CR2450无线照明传感器</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nRF52832上的无线温度，湿度和大气压传感器</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">无线体温计</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">将Arduino转变为成熟的AVRISP程序员</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">劳拉和睡眠</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了解ATmega328P的配置位以及如何与外部石英晶体一起使用</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AVR融合计算器</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">为什么很多人不喜欢Arduino</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">盛大电池测试</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">电池在寒冷中</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470381/">https://habr.com/ru/post/zh-CN470381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470359/index.html">OpenStreetMap第479号世界新闻（09/17/2019-09/23/2019）</a></li>
<li><a href="../zh-CN470361/index.html">上周第383期（2019年10月1日至6日）来自前端世界的新鲜材料摘要</a></li>
<li><a href="../zh-CN470365/index.html">在Android上使用USB自定义HID</a></li>
<li><a href="../zh-CN470373/index.html">PHP摘要165号（2019年9月23日至10月7日）</a></li>
<li><a href="../zh-CN470379/index.html">三座山的问题，难以捉摸的心理理论和儿童发育的分期问题</a></li>
<li><a href="../zh-CN470389/index.html">Mozilla承诺在英国不包括DoH加密。 这对俄罗斯意味着什么？</a></li>
<li><a href="../zh-CN470393/index.html">智慧眼镜-Pegasi Dream Glasses的印象</a></li>
<li><a href="../zh-CN470395/index.html">OWASP API安全性Top 10 RC</a></li>
<li><a href="../zh-CN470399/index.html">如何将孩子介绍给IT以及如何在.NET中使用ML：Dmitry Soshnikov（Microsoft）访谈</a></li>
<li><a href="../zh-CN470411/index.html">Chrome开发者工具的10个鲜为人知的功能</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>