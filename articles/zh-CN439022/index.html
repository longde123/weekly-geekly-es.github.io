<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🚀 👩🏽‍🏫 🤴🏿 业余爱好工作室中的CNC（第3部分） 🛕 👩‍🔧 💽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最初，我计划将自己限制在有关CNC实验的两篇文章中（ 一 ， 二 ）。 但是，这个话题原来对很多人来说都很有趣，因此，我仍然会稍微介绍一下。 在这篇文章中，我们将讨论编写用于控制业余CNC的自制软件。 

 前言 
 我不知道我是否能通过第一篇文章激励某人，但我自己的一些评论令人深思。 特别感谢@e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>业余爱好工作室中的CNC（第3部分）</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439022/"><img src="https://habrastorage.org/webt/ps/rt/b9/psrtb98htrntl_pcfsmcloxegei.png"><br><br> 最初，我计划将自己限制在有关CNC实验的两篇文章中（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">二</a> ）。 但是，这个话题原来对很多人来说都很有趣，因此，我仍然会稍微介绍一下。 在这篇文章中，我们将讨论编写用于控制业余CNC的自制软件。 <br><a name="habracut"></a><br><h2> 前言 </h2><br> 我不知道我是否能通过第一篇文章激励某人，但我自己的一些评论令人深思。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">特别</a>感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@evilruff</a>为他的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">实验室</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">拍摄</a>的照片和带有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">韩国帅气</a>的视频。 看完这两本书之后，我在地下室的手套箱不再显得那么舒适。 <br><br> 聚集他的力量，在周末，他带来了一些隐约让人联想到秩序的东西，最后做了半年前他打算做的两件事。 <br><br> 首先，他更换了一块用作牺牲桌的胶合板。 从购买机器的那一刻起，我就使用了这种胶合板，用螺钉将坯料拧入其中，并用棍棒和楔子构造了各种疯狂的设计。 所有这些使零件在铣削过程中不会发生不可预测的飞行。 <br><br> 也许有人需要救生员：他们用塑料甲板（在Castorama出售）制成了一张新桌子： <br><br><img src="https://habrastorage.org/webt/yc/fv/mj/ycfvmjzxxjh35o9koqhm6fjzc-q.png"><br><br> 他将木板直接用螺栓固定在铝制桌子上。 额外的好处是用于工件夹紧的便捷凹槽和加料台的快速安装。 一切都花了几个小时和1100r。 <br><br> 其次，最后，他编写了用于管理非标准CNC功能的或多或少可用的软件。 这将是主要故事。 <br><br><h2> 问题陈述 </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第二部分中</a>描述的操作的G代码<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">是</a>最简单的。 但是，设置过程本身不能被快速调用。 <br><br><h3> 这是怎么发生的 </h3><br> 例如，对于添加剂，这是必要的：了解面板的宽度，计算孔的数量，计算孔之间的确切距离，创建文件，编写g代码，并将其加载到Mach3中。 所有这些最多只需要15到20分钟的时间，因此，与手动工具相比，数字机器的优势大大降低，而手动工具却可以打出很多孔。 <br><br><h3> 我想要得到什么 </h3><br> 对于相同的添加剂，我想得到一个程序，在一个非常简单的界面中，我将输入面板的宽度和厚度，然后按下按钮以开始以彼此相同的距离钻孔所需数量的填充孔的过程。 <br><br><h2> 寻找解决方案 </h2><br> 我想到的第一件事是编写一个可直接与并行端口进行交互的自治程序。 快速搜寻表明，写给lpt的任务是可以解决的，但是您知道，魔鬼正在详细隐藏。 通过对该问题的进一步研究，我意识到您可能会长期陷入困境。 而且，这样的解决方案将不够灵活：对于另一台机器（例如带有USB的机器），它将无法工作。 <br><br> 有一个处理Mach3 SDK的选项。 在收集有关创建mach插件的信息的过程中，我遇到了一个有趣的解决方案。 它描述了如何使用OLE机制从第三方应用程序中提取Mach3。 我不是Microsoft技术方面的专家，但是在查看了Mach3 SDK上的手册对角线后，如果我正确理解了主要思想，就没有灵丹妙药，那么插件将使用与Mach3 COM对象相同的公共方法。 我不会重绘Mach3界面，因此，该用户在插件和Standalon应用程序之间的唯一区别是可以从Mach3菜单访问该插件，而可以通过XP桌面上的图标访问该应用程序。 <br><br> 对我来说，单独申请似乎更可取。 在这种情况下，从理论上讲，我可以在加载计算机后立即启动程序，这将为Mach3加载蒸汽机车（而不是先加载Mach3，然后再挖掘其菜单以启动插件）。 <br><br><h2> 拿起军刀 </h2><br> 我上一次不得不为Windows编写本机桌面应用程序是在2006年，当时是在Delphi中。 从那时起，带有Linux的Web技术就完全让我吃饱了。 因此，现在我对使用哪种语言来雕刻Windows程序没有任何特别的偏好。 找到的简单示例是用C＃编写的，该语言被选为实验兔子。 <br><br> 我不会在此处发布最终应用程序的所有代码（如果您愿意，可以使用文章底部的链接在github上找到它）。 我将解释基本的东西。 我在带有WinXP SP3，VS 2003和Mach3 R3.043.062版本的虚拟机上进行的所有实验。 对于那些认为最好<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在YouTube上</a>一次查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视频链接的人</a> ，据我了解。 以下是重点摘要的笔录。 <br><br><h4> 准备工作 </h4><br><ol><li> 为了使Visual Studio能够正确拾取Mach3组件，必须在注册表中正确注册它。 为此，请下载文件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mach3Registry.reg</a> </li><li> 启动Mach3Registry.reg </li><li> 我们启动VS，在C＃中创建一个窗口应用程序的项目 </li><li> 在“解决方案资源管理器”块中，右键单击“引用”，然后从菜单中选择“添加引用”。 在打开的窗口中，单击“浏览”，然后查找Mach3.exe。 <br><br><img src="https://habrastorage.org/webt/bw/pv/tj/bwpvtjvkxx6gaivlgdkaly0z4_i.png"><br><br> 如果一切正确，则应该在“引用”列表中显示一行，以为会认为Mach4 ... </li><li>  5.接下来，绘制UI，挂断处理程序，实现算法... </li></ol><br><h4> 与Mach3的互动 </h4><br> 我们连接必要的库，声明变量（Form1.cs） <br><br><pre><code class="cpp hljs">... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Runtime.InteropServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Mach4; <span class="hljs-comment"><span class="hljs-comment">//   Mach namespace Cnc { public class Form1 : System.Windows.Forms.Form { private IMach4 _mach; private IMyScriptObject _mInst; ... //      Mach3 private void GetMachInstance() { try { _mach = (IMach4) Marshal.GetActiveObject("Mach4.Document"); _mInst = (IMyScriptObject) _mach.GetScriptDispatch(); } catch { _mach = null; _mInst = null; } } ...</span></span></code> </pre> <br> 用法： <br><br><pre> <code class="cpp hljs">GetMachInstance(); <span class="hljs-comment"><span class="hljs-comment">// if(_mInst != null) { _mInst.DoOEMButton(1003); //    Stop  Mach3 _mInst.Code("G00 X100"); //  G-code _mInst.GetOEMDRO(800); //     X }</span></span></code> </pre><br> 可以在Wiki上查看按钮和参数值的代码： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OEM_DRO</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OEM_Buttons</a> （它们没有Wiki，表中未显示参数值，我查看了“查看源代码”选项卡）。 <br><br> 该程序的第一个版本是这样工作的：根据设置的参数，生成了由<b>_mInst.Code</b>方法<b>逐帧</b>执行（即逐行）的g代码。 那是我的错误。 在虚拟机上的调试环境中，一切正常。 在Mach3中，运行了坐标中的正确数字。 但是，当转移到机器计算机时会出现问题。 托架正确移动，但主轴未打开。 <br><br> 似乎路由器和Mach中的主轴的管理工作在不同的线程中。 结果表明，运动命令（G ...）在一个线程中进入_mInst.Code方法时是依次执行的，而主轴控制命令（M3，M5）（无论是第一个线程）都是在另一个线程中执行的。 结果，在移动托架时，主轴打开（M3）并立即关闭（M5）。 <br><br> 我尝试了不同的选项，连接了延迟，试图将整个g代码控件驱动为一行，然后将其发送到_mInst.Code。 结果，我选择了“额头上”的解决方案：我只是将生成的代码驱动到一个文件中，然后在Mach3中以编程方式打开该文件，然后在此处以编程方式按下“开始”按钮。 工作代码段： <br><br><pre> <code class="cpp hljs">_mInst.LoadFile(<span class="hljs-string"><span class="hljs-string">"C:\\tmp\\gcode.txt"</span></span>); System.Threading.Thread.Sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>); _mInst.DoOEMButton(<span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br> 为了使Mach打开文件，需要在下载文件和按下按钮之间暂停。 也许有一些更优雅的方法。 如果有人知道，请在评论中写。 <br><br> 该解决方案的另一个好处是，现在您可以在Mach界面中观察处理过程的可视化。 <br><br><h2> 最终发生了什么 </h2><br> 此外，简而言之，涉及到最终的应用程序。 另外，我将讨论每个操作的UI。 <br><br><h3> 切 </h3><br><img src="https://habrastorage.org/webt/xy/ny/jr/xynyjryvow1ftwsuwvss8xvyvie.png"><br><br> 这里的一切都很透明。 如果工件未沿X（或沿Y沿切削时）沿零点固定，则需要参数S来补偿尺寸L。 <br><br><h3> 添加剂 </h3><br> 对于添加，可能有2种快速配置。 第一个带有用于钻削端孔的磨床。 第二个带有通常在屏蔽层上钻孔的主轴（出于某种原因，我称其为“正面添加剂”）。 <br><br><h4> 加性脸 </h4><br><img src="https://habrastorage.org/webt/qq/mn/mi/qqmnmiv1ofy4bwpryj8n3obufcg.png"><br><br> 使用最终添加剂时，重要的是在工件的右下角精确设置零（我在这里有侧挡板和工作台的角度）。 用木头钻，这并不难-要进入这个角落，需要有一个尖锐的尖端。 将工件固定在工作台上，我将其放在钻头中。 <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qvBl2Q2pg-k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> 在不以相同方式更换设备的情况下，我通过垂直固定工件来制造倒角孔： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8OzIyF37MWw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> 需要参数X才能连接不同宽度的面板（例如，当机柜的上下面板比侧面板的宽度乘以门的厚度时）。 <br><br><h4> 额叶添加剂 </h4><br><img src="https://habrastorage.org/webt/ll/_k/kr/ll_kkr9enxnd-vrs_3yc5cskxsg.png"><br><br> 前面的设备是普通主轴。 当您需要在水平表面上钻孔时，不仅可以沿着边缘，还可以在中间某处钻孔，可以使用这种添加剂。 例如，如果机柜中有多个隔间，并且除了侧壁之外，还有内部隔间。 如果面板的长度大于机器的长度，则可以将零件旋转180度制成2组添加剂。 在这种情况下，参数X也很有用。 <br><br><h3> 转弯 </h3><br><img src="https://habrastorage.org/webt/e5/-j/e9/e5-je9dvs8fwye3vrv1rg5wsdam.png"><br><br> 对我来说，准备带有旋转路径的g代码的主要困难在于，不要在磁盘的最大浸入深度下过度使用它。 事实是，在Inkscape的出口处获得了一行，并且转弯发生了一次。 因此，我必须创建一个单独的代码来圆柱化工件，直到启动创建模板的主要通道之后。 而且此表格有一些限制。 特别是，必须确保轨迹不会太深。 我尝试不超过原始圆柱的高度10-15毫米。 <br><br> 在新程序中解决了所有这些问题。 它的工作方式如下：加载从Inkscape获得的“原始” g代码，设置工件的条形侧面的大小，并在1次通过中指示最大加工深度（木材越硬，该深度越小）。 基于源g代码和参数，程序将计算安全路径并将其发送到CNC。 <br><br><h2> 未来计划 </h2><br> 该程序大大简化了例程，但仍远远不够完善。 首先，有必要优化用于钻深孔的算法（钻头被切屑和过热堵塞，您需要来回摆动）。 其次，提出了制作转弯形式库的想法。 即 几种标准形式（例如圆柱体，圆锥体，rolling面杖等），可以调整尺寸而无需在第三方程序中创建轨迹。 <br><br><h2> 参考文献 </h2><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mach3Registry.reg</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mach3 SDK和其他程序</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github上的项目存储库</a> （我预先向Sharpoviks致歉以获取建筑门框-这是我在C＃中的第一个程序）。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439022/">https://habr.com/ru/post/zh-CN439022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439010/index.html">归档合并在DeviceLock DLP中的工作方式</a></li>
<li><a href="../zh-CN439012/index.html">组织电话簿-印刷版</a></li>
<li><a href="../zh-CN439016/index.html">静态通用表</a></li>
<li><a href="../zh-CN439018/index.html">为在线商店配置Sphinx搜索</a></li>
<li><a href="../zh-CN439020/index.html">欧洲乘车票-算术，第二部分</a></li>
<li><a href="../zh-CN439024/index.html">lur喝3结果</a></li>
<li><a href="../zh-CN439026/index.html">学习对抗策略，技巧和常识（ATT @ CK）。 企业策略。 第8部分</a></li>
<li><a href="../zh-CN439028/index.html">如何提高网络边界保护？ 不仅针对Check Point的实用建议</a></li>
<li><a href="../zh-CN439030/index.html">很多经理</a></li>
<li><a href="../zh-CN439032/index.html">亚马逊和谷歌计划进入能源市场</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>