<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✌🏻 💪 🍡 Pourquoi limiter l'héritage au final? 👩🏼‍🤝‍👨🏾 💅🏻 🍩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous avez probablement entendu cette fameuse déclaration du GoF: "Préférez la composition à l'héritage de classe." Et puis, en règle générale, de long...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pourquoi limiter l'héritage au final?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482154/"><p>  Vous avez probablement entendu cette fameuse déclaration du GoF: "Préférez la composition à l'héritage de classe."  Et puis, en règle générale, de longues réflexions ont porté sur la façon dont l'héritage déterminé statiquement n'est pas si <em>flexible</em> par rapport à une composition dynamique. </p><br><p> La flexibilité est bien sûr une caractéristique de conception utile.  Cependant, lors du choix d'une architecture, nous nous intéressons principalement à la maintenabilité, la testabilité, la lisibilité du code, la réutilisation des modules.  Donc, avec ces critères de bonne conception, l'héritage est également un problème.  "Et maintenant, n'utilisez pas du tout l'héritage?" - demandez-vous. </p><br><p> Voyons comment une forte dépendance entre les classes par héritage peut rendre votre architecture système trop rigide et fragile.  Et pourquoi utiliser l'un des mots-clés les plus mystérieux et insaisissables du code - <code>final</code> .  Les idées formulées sont illustrées à l'aide d'un simple exemple transversal.  À la fin de l'article, il y a des astuces et des outils pour un travail pratique avec les classes <code>final</code> . </p><br><p><img src="https://habrastorage.org/webt/ub/8n/_e/ub8n_esvqmijrl-trdc_xtpqtfe.gif" alt="Le problème de la classe de base fragile"></p><br><p>  <em>Le problème de la classe de base fragile</em> </p><a name="habracut"></a><br><p>  L'un des principaux critères d'une bonne architecture est <a href="https://en.wikipedia.org/wiki/Loose_coupling" rel="nofollow">le couplage lâche</a> , qui caractérise le degré d'interconnexion entre les modules logiciels.  Ce n'est pas pour rien que la faiblesse de l'engagement fait partie <a href="https://ru.wikipedia.org/wiki/GRASP" rel="nofollow">de la</a> liste des <a href="https://ru.wikipedia.org/wiki/GRASP" rel="nofollow">modèles GRASP</a> qui décrivent les principes de base du partage des responsabilités entre les classes. </p><br><p>  Un engagement faible présente de nombreux avantages. </p><br><ul><li>  En relâchant les dépendances entre les modules logiciels, vous facilitez la maintenance et le support du système en créant une architecture plus flexible. </li><li>  Il existe la possibilité de développer en parallèle des modules à couplage lâche sans risque de perturber leur fonctionnement. </li><li>  La logique de la classe devient plus évidente, il devient plus facile d'utiliser la classe correctement et pour son usage prévu, et il est difficile de l'utiliser - faux. </li></ul><br><p>  Traditionnellement, les dépendances dans un système sont principalement comprises comme des connexions entre l'objet utilisé (service) et l'objet utilisateur (client).  Une telle relation modélise <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B3%25D1%2580%25D0%25B5%25D0%25B3%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">la relation d'agrégation</a> lorsque le service fait «partie» du client ( <a href="https://en.wikipedia.org/wiki/Has-a" rel="nofollow">a une relation</a> ) et que le client transfère la responsabilité du comportement au service intégré.  Un rôle clé dans l'affaiblissement de la relation entre le client et le service est joué par <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D0%25B8%25D0%25BD%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D0%25B8_%25D0%25B7%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2581%25D0%25B8%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D0%25B5%25D0%25B9" rel="nofollow">le</a> <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" rel="nofollow">principe d'inversion de dépendance</a> ( <em>DIP</em> ), qui propose de convertir une dépendance directe entre modules en une dépendance réciproque des modules sur une abstraction commune. </p><br><p>  Cependant, vous pouvez également améliorer considérablement l'architecture de l'application en desserrant les dépendances dans le cadre d'une <a href="https://en.wikipedia.org/wiki/Is-a" rel="nofollow">relation is-a</a> .  La relation d'héritage par défaut crée <a href="https://en.wikipedia.org/wiki/Tight_coupling" rel="nofollow">un couplage étroit</a> , la plus forte parmi toutes les formes de dépendances possibles, et doit donc être utilisée très soigneusement. </p><br><p><img src="https://habrastorage.org/webt/mv/u8/u0/mvu8u0gs0chkxt4jly0h0defdpe.jpeg" alt="Lien solide concernant l'héritage"></p><br><p>  <em>Lien solide concernant l'héritage</em> </p><br><p>  La quantité de code partagée entre les classes parent et enfant est très importante.  Ce problème commence à se manifester particulièrement fortement lorsque le concept d'héritage est abusé - en utilisant l'héritage exclusivement pour la réutilisation de code horizontal, et non pour créer des sous-classes spécialisées.  Parce que l'héritage est le moyen le plus simple de réutiliser du code.  Vous avez juste besoin d'écrire des <code>extends ParentClass</code> et c'est tout!  Après tout, c'est beaucoup plus simple que l'agrégation, l' <a href="https://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">injection de dépendance</a> (DI), l'allocation d'interface. </p><br><p>  La réduction du lien de classe dans la hiérarchie d'héritage est traditionnellement obtenue en utilisant des modificateurs restrictifs de la portée ( <code>private</code> , <code>protected</code> ).  Il existe même une opinion selon laquelle les propriétés de classe doivent être déclarées exclusivement avec le modificateur <code>private</code> .  Et le modificateur <code>protected</code> doit être appliqué très soigneusement et uniquement aux méthodes, car  il encourage les dépendances entre les classes parent et enfant. </p><br><p>  Cependant, les problèmes d'héritage ne sont pas seulement liés au masquage des propriétés et des méthodes, ils sont beaucoup plus profonds.  De nombreux ouvrages sur l'architecture des applications, y compris le <a href="https://ru.wikipedia.org/wiki/Design_Patterns" rel="nofollow">livre</a> classique du <a href="https://ru.wikipedia.org/wiki/Design_Patterns" rel="nofollow">GoF, sont</a> sceptiques quant à l'héritage et suggèrent de rechercher des conceptions plus flexibles.  Mais n'est-ce que de la flexibilité?  Je propose ci-dessous de systématiser les problèmes de succession, et ensuite de réfléchir à la manière de les éviter. </p><br><p>  Prenons comme «lapin expérimental» la classe de bloc de commentaires la plus simple avec un tableau de commentaires à l'intérieur.  Des classes similaires avec une collection à l'intérieur se trouvent en grand nombre dans n'importe quel projet. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; }</code> </pre> <br><p>  Les exemples ci-dessous sont délibérément simplifiés dans le style <a href="https://en.wikipedia.org/wiki/KISS_principle" rel="nofollow">KISS</a> afin de montrer les idées formulées dans le code.  Vous pouvez trouver des exemples de code dans l'article et une annotation détaillée sur leur utilisation dans <a href="https://github.com/parshikovpavel/final-keyword" rel="nofollow">ce référentiel</a> . </p><br><h2 id="problemy-nasledovaniya">  Problèmes d'héritage </h2><br><p>  Commençons par le problème le plus évident, qui est principalement donné dans la littérature sur l'architecture. </p><br><h3 id="nasledovanie-narushaet-princip-sokrytiya">  L'héritage viole le principe de la dissimulation </h3><br><blockquote>  Étant donné que la sous-classe a accès aux détails d'implémentation de la classe parente, il est souvent dit que l'héritage viole l'encapsulation. <br><br>  <em>GoF, Design Patterns</em> </blockquote><p>  Bien que le livre classique, The Gangs of Four, traite des violations d'encapsulation, il serait plus exact de dire que <em>«l'héritage viole le principe de la dissimulation»</em> .  Après tout, l' <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25BA%25D0%25B0%25D0%25BF%25D1%2581%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">encapsulation</a> est une combinaison de données et de méthodes conçues pour leur traitement.  Mais le <a href="https://en.wikipedia.org/wiki/Information_hiding" rel="nofollow">principe de dissimulation</a> ne fait que garantir la restriction de l'accès de certains composants du système aux détails de la mise en œuvre d'autres. </p><br><p>  Le respect du principe de dissimulation dans l'architecture permet d'assurer l'engagement des modules grâce à une interface stable.  Et si la classe autorise l'héritage, elle fournit automatiquement les types d'interfaces stables suivants: </p><br><ul><li>  <em>interface publique</em> utilisée par tous les clients de cette classe; </li><li>  <em>interface protégée</em> utilisée par toutes les classes enfants. </li></ul><br><p>  C'est-à-dire  la classe enfant dispose d'un arsenal de capacités bien plus important que l'API publique.  Par exemple, il peut affecter l'état interne de la classe parente caché dans ses propriétés <code>protected</code> . </p><br><p>  Souvent, une classe enfant n'a pas besoin d'accéder à tous les éléments de la classe parente qui sont accessibles par héritage, cependant, vous ne pouvez pas fournir sélectivement l'accès aux membres <code>protected</code> des classes pour certaines des sous-classes.  La classe enfant commence à dépendre de l' <em>interface protégée de la</em> classe parente. </p><br><p>  La principale raison de l'héritage de classe, le plus souvent, est d'étendre les fonctionnalités de la classe parente en réutilisant son implémentation.  Si initialement l'accès à l'implémentation de la classe parente via l' <em>interface protégée</em> ne laissait pas présager de problèmes, alors que le système se développe, le programmeur commence à utiliser cet accès dans les méthodes de la classe enfant et à renforcer le lien dans la hiérarchie. </p><br><p>  La classe parente est désormais obligée de maintenir la stabilité non seulement de l' <em>interface publique</em> , mais également de l' <em>interface protégée</em> , car toute modification de celle-ci entraînera des problèmes dans le travail des classes enfants.  Cependant, il est impossible de refuser d'utiliser <code>protected</code> membres de classe <code>protected</code> .  Si l' <em>interface protégée</em> correspond complètement à l' <em>interface publique</em> externe, c'est-à-dire  la classe parente n'utilisera que <code>private</code> membres <code>public</code> et <code>private</code> , alors l'héritage n'a généralement aucun sens. </p><br><p>  En fait, le mot clé <code>protected</code> n'offre aucune protection aux membres de la classe.  Pour avoir accès à ces membres, il suffit d’hériter de la classe, et dans le cadre de la classe enfant, vous avez toutes les chances de violer le principe de la dissimulation.  Il devient très facile d'utiliser une classe de manière incorrecte, ce qui est l'un des premiers signes d'une mauvaise architecture. </p><br><p><img src="https://habrastorage.org/webt/kz/lj/u2/kzlju2j0kqgao50qols46uwvz0e.gif" alt="Utiliser une classe via une interface protégée"></p><br><p>  <em>Violation du principe de dissimulation via une interface protégée</em> </p><br><p>  Plus important encore, les éléments encapsulés (constantes, propriétés, méthodes) deviennent non seulement lisibles et invoqués dans la classe enfant, mais peuvent également être remplacés.  Une telle opportunité comporte un danger caché - en raison de tels changements, le comportement des objets de la classe enfant peut devenir incompatible avec les objets de la classe parent.  Dans ce cas, la substitution des objets de la classe enfant aux points du code où le comportement des objets de la classe parent était censé entraîner des conséquences imprévues. </p><br><p>  Par exemple, nous ajoutons la fonctionnalité de la classe <code>CommentBlock</code> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**       `$comments` */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Comment</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key] ?? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre> <br><p>  et nous en hériterons la classe <code>CustomCommentBlock</code> , dans laquelle nous profitons de toutes les possibilités de briser la dissimulation. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    * *    (information hiding) *     `CommentBlock::$comments`, *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $comments)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments = $comments; } <span class="hljs-comment"><span class="hljs-comment">/** *    ,   `Comment::getKey()` * *       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Comment</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $comment) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($comment-&gt;getKey() === $key) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $comment; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br><p>  Les cas courants de violation de la dissimulation sont les suivants: </p><br><ul><li>  Les méthodes de la classe enfant révèlent l'état de la classe parent et permettent d'accéder aux membres cachés de la classe parent.  Un tel scénario n'était probablement pas prévu lors de la conception de la classe parente, ce qui signifie que la logique de ses méthodes sera probablement violée. <br>  Dans l'exemple, la classe enfant fournit la méthode setter <code>CustomCommentBlock::setComments()</code> pour modifier la propriété <code>CommentBlock::$comments</code> protégée masquée dans la classe parente. </li><li>  remplacer le comportement de la méthode de la classe parent dans la classe enfant.  Parfois, les développeurs perçoivent cette fonctionnalité comme un moyen de résoudre les problèmes de la classe parent en créant des classes enfants avec un comportement modifié. <br>  Dans l'exemple, la méthode <code>CommentBlock::getComment()</code> de la classe parente s'appuie sur les clés du tableau associatif <code>CommentBlock::$comments</code> .  Et dans la classe enfant - aux clés des commentaires eux-mêmes, accessibles via la méthode <code>Comment::getKey()</code> . </li></ul><br><h3 id="problema-banan-obezyana-dzhungli">  Le problème banane-singe-jungle </h3><br><blockquote>  Le problème avec les langages orientés objet est qu'ils traînent dans tout leur environnement implicite.  Vous vouliez juste une banane, mais en conséquence vous avez obtenu un gorille tenant cette banane, et toute la jungle en plus. <br><br>  <em>Joe Armstrong, créateur d'Erlang</em> </blockquote><p>  Les dépendances sont toujours présentes dans l'architecture du système.  Cependant, l'héritage comporte un certain nombre de facteurs de complication. </p><br><p>  Vous avez probablement rencontré une situation où, à mesure que le produit logiciel se développe, les hiérarchies de classes se sont considérablement développées.  Par exemple </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Block</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Block</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PopularCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachedPopularCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PopularCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-comment"><span class="hljs-comment">/* .... */</span></span></code> </pre> <br><p>  Vous héritez et héritez, mais vous ne pouvez pas décider quels membres hériter.  Vous héritez de tout et de l'ensemble, héritant des membres de toutes les classes dans l'arborescence de la hiérarchie.  En outre, vous obtenez une forte dépendance sur l'implémentation de la classe parente, sur la classe parente de la classe parente, etc.  Et ces dépendances ne peuvent en aucun cas être affaiblies (contrairement à l'agrégation complète avec <em>DIP</em> ). </p><br><p>  Sans parler du fait qu'une classe feuille dans une hiérarchie aussi profonde violera presque certainement <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BD%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25BE%25D1%2582%25D0%25B2%25D0%25B5%25D1%2582%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8" rel="nofollow">le</a> <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle" rel="nofollow">principe de responsabilité unique</a> ( <em>SRP</em> ), en sait et en fait trop.  Vous avez commencé le développement avec une classe <code>Block</code> simple, puis y avez ajouté des fonctions pour sélectionner des commentaires, puis des fonctionnalités de tri par popularité, une mise en cache attachée ... En conséquence, vous avez obtenu une classe avec beaucoup de responsabilités et, de plus, <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%258F%25D0%25B7%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">mal connectée</a> ( <a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)" rel="nofollow">faible cohésion</a> ) </p><br><p>  Vous vouliez juste obtenir une banane (créer un objet feuille dans la hiérarchie) et vous ne vous souciez pas de la façon dont elle est arrivée au supermarché le plus proche (comment le comportement est mis en œuvre, dont le résultat est cet objet).  Cependant, avec l'héritage, vous êtes obligé de porter la réalisation de toute la hiérarchie, à partir de la jungle elle-même.  Vous devez garder à l'esprit les caractéristiques de la jungle et les nuances de leur mise en œuvre, tout en vous concentrant sur la banane. </p><br><p>  Par conséquent, l'état de votre classe est réparti sur de nombreuses classes parentes.  Vous ne pouvez résoudre ce problème qu'en limitant l'impact de l'environnement externe (la jungle) sur votre classe grâce à l'encapsulation et au masquage.  Cependant, il est impossible d'y parvenir avec héritage, car  l'héritage viole le principe de la dissimulation. </p><br><p>  Comment maintenant tester les classes enfants quelque part au fond de l'arborescence hiérarchique, car leur implémentation est dispersée dans les classes parentes?  Pour les tests, vous aurez besoin de toutes les classes parentes, et vous ne pouvez en aucun cas les remplacer, car  vous avez un engagement non pas dans le comportement, mais dans la mise en œuvre.  Étant donné que votre classe ne peut pas être facilement isolée et testée, vous hériterez de nombreux problèmes de maintenabilité, d'extensibilité et de réutilisation. </p><br><h3 id="otkrytaya-rekursiya-po-umolchaniyu">  Récursivité ouverte par défaut </h3><br><p>  Cependant, la classe enfant ne dépend pas seulement de l' <em>interface protégée du</em> parent.  Il partage également partiellement avec lui une réalisation physique, en dépend et peut l'influencer.  Cela viole non seulement le principe de la dissimulation, mais rend également le comportement de la classe des enfants particulièrement déroutant et imprévisible. </p><br><p>  Les langages orientés objet fournissent une récursivité ouverte par défaut.  En PHP, la récursivité ouverte est implémentée en utilisant la pseudo-variable <code>$this</code> .  Un appel de méthode via <code>$this</code> est appelé <em>self-call</em> dans la littérature. </p><br><p>  <em>L'auto-appel</em> conduit à des appels de méthode dans la classe actuelle, ou il peut être redirigé dynamiquement vers le haut ou vers le bas de la hiérarchie d'héritage en fonction d'une liaison tardive.  En fonction de cela, l' <em>auto-appel est</em> divisé en: </p><br><ul><li>  <em>down-call</em> - un appel à une méthode dont l'implémentation est remplacée dans une classe enfant, plus bas dans la hiérarchie. </li><li>  <em>up-call</em> - un appel à une méthode dont l'implémentation est héritée de la classe parente, plus haut dans la hiérarchie.  Vous pouvez explicitement faire <em>des appels ascendants</em> en PHP via la construction <code>parent::method()</code> . </li></ul><br><p>  L'utilisation fréquente des <em>appels descendants</em> et <em>des appels entrants</em> dans l'implémentation de méthodes accroche encore plus étroitement les classes, ce qui rend l'architecture difficile et fragile. </p><br><p>  Prenons un exemple.  Nous implémentons la méthode <code>getComments()</code> dans la classe parent <code>CommentBlock</code> , qui retourne un tableau de commentaires. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *        `getComment()`. * *        `CustomCommentBlock`, * ..   `CommentBlock::getComment()`  * `CustomCommentBlock::getComment()` . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $comments = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $comments[] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $comments; } }</code> </pre><br><p>  Cette méthode s'appuie sur la logique de <code>CommentBlock::getComment()</code> et <code>CommentBlock::getComment()</code> sur les commentaires par les clés du tableau associatif <code>$comments</code> .  Dans le contexte de la classe <code>CustomCommentBlock</code> de la méthode <code>CommentBlock::getComments()</code> , l' <em>appel vers</em> le <em>bas de</em> la méthode <code>CustomCommentBlock::getComment()</code> sera exécuté.  Cependant, la méthode <code>CustomCommentBlock::getComment()</code> a un comportement différent de celui attendu dans la classe parente.  En tant que paramètre, cette méthode attend la propriété <code>key</code> du commentaire lui-même. </p><br><p>  Par conséquent, <code>CommentBlock::getComments()</code> hérité automatiquement de la classe parente, s'est révélé incompatible avec le comportement de <code>CustomCommentBlock::getComment()</code> .  L'appel de <code>getComments()</code> dans le contexte de <code>CustomCommentBlock</code> retournera très probablement un tableau de valeurs <code>null</code> . </p><br><p>  En raison de l'engagement fort, lorsque vous apportez des modifications à une classe, vous ne pouvez pas vous concentrer uniquement sur son comportement.  Vous êtes obligé de prendre en compte la logique interne de toutes les classes, de bas en haut de la hiérarchie.  La liste et l'ordre de l' <em>appel vers</em> le <em>bas</em> dans la classe parente doivent être connus et documentés, ce qui viole substantiellement le principe de la dissimulation.  <em>Les détails d'implémentation font</em> partie du contrat de classe parent. </p><br><h3 id="kontrol-pobochnyh-effektov">  Contrôle des effets secondaires </h3><br><p>  Dans l'exemple précédent, le problème s'est manifesté en raison de la différence de logique des méthodes <code>getComment()</code> dans les classes parent et enfant.  Cependant, il ne suffit pas de contrôler la similitude du comportement des méthodes dans la hiérarchie des classes.  Des problèmes peuvent vous attendre si ces méthodes ont des effets secondaires. </p><br><p>  La fonction avec <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B1%25D0%25BE%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258D%25D1%2584%25D1%2584%25D0%25B5%25D0%25BA%25D1%2582_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">effets secondaires</a> (fonction avec <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)" rel="nofollow">effets secondaires</a> ) modifie certains états du système, en plus de l'effet principal - renvoyant le résultat au point d'appel.  Exemples d'effets secondaires: </p><br><ul><li>  changer les variables externes à la méthode (par exemple, les propriétés des objets); </li><li>  changer les variables statiques locales à la méthode; </li><li>  interaction avec des services externes. </li></ul><br><p>  Ces effets secondaires font donc également <em>partie de la mise en œuvre</em> , qui ne peuvent pas non plus être efficacement cachés dans le processus d'héritage. </p><br><p>  Imaginez que <code>CommentBlock</code> devions inclure la méthode <code>viewComment()</code> dans la classe <code>CommentBlock</code> pour obtenir une représentation textuelle de l'un des commentaires. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre> <br><p>  Ajoutez un effet secondaire à la classe enfant et spécifiez son objectif.  Nous implémentons la classe <code>CountingCommentBlock</code> , qui complète <code>CommentBlock</code> possibilité de compter les vues des commentaires individuels dans le cache.  Laissez la classe accepter l' <a href="https://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">injection d'un</a> cache compatible <a href="https://www.php-fig.org/psr/psr-16/" rel="nofollow">PSR-16</a> dans le constructeur ( <a href="https://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">injection de constructeur</a> ) via l'interface <code>CounterInterface</code> (qui, cependant, <a href="https://github.com/php-fig/fig-standards/pull/847/" rel="nofollow">a finalement été exclue</a> du PSR-16).  Nous utiliserons la méthode <code>increment()</code> pour incrémenter atomiquement la valeur du compteur dans le cache. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CounterInterface  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::viewComment($key); } }</code> </pre> <br><p>  Tout fonctionne bien.  Cependant, à un moment donné, il est décidé d'ajouter la fonction <code>viewComments()</code> pour former une représentation textuelle de tous les commentaires dans le bloc.  Cette méthode est ajoutée à la classe de base <code>CommentBlock</code> et, en un coup d'œil, l'héritage de l'implémentation de cette méthode par toutes les classes enfants semble très pratique et évite d'écrire du code supplémentaire dans les classes enfants. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= $comment-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><p>  Cependant, la classe parent ne sait rien des fonctionnalités d'implémentation des classes enfants.     <code>viewComments()</code>    (responsibility)  <code>CountingCommentBlock</code> –      . </p><br><p>  : </p><br><pre> <code class="php hljs">$commentBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CountingCommentBlock(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeCache()); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> $commentBlock-&gt;viewComments();</code> </pre> <br><p>      .      ,     . </p><br><p>         «  »          .   ,    <code>viewComments()</code>     (  ). </p><br><h3 id="hrupkost-bazovogo-klassa">    </h3><br><p>  ,        . ,   ,             ,     .        – « <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D1%2580%25D1%2583%25D0%25BF%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B1%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581" rel="nofollow">  </a> » (" <a href="https://en.wikipedia.org/wiki/Fragile_base_class" rel="nofollow">Fragile base class</a> ").       «- »   <a href="https://habr.com/ru/post/331732/">  </a> –  (fragility). </p><br><p>    ,    <em> </em>     ?   . ,      <code>CommentBlock</code> ,               . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= $comment-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><p>   <code>CountingCommentBlock</code>           . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CounterInterface  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::viewComment($key); } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::viewComments(); } }</code> </pre> <br><p>              <code>CommentBlock::viewComments()</code> : </p><br><pre> <code class="php hljs">$view .= $comment-&gt;view();</code> </pre> <br><p>      ,    <code>viewComment()</code> , –     .            .      <code>viewComment()</code>  <code>viewComments()</code> .      ,   <code>CommentBlock::viewComment()</code>  <code>CommentBlock::viewComments()</code> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); <span class="hljs-comment"><span class="hljs-comment">//  `$comment-&gt;view()` } return $view; } }</span></span></code> </pre> <br><p>     <code>CommentBlock</code>   ,  ,    .      <code>CommentBlock</code> –   ,  «».        . </p><br><p>     ,    .        <code>CountingCommentBlock</code> .  : </p><br><pre> <code class="php hljs">$commentBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CountingCommentBlock(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeCache()); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> $commentBlock-&gt;viewComments();</code> </pre> <br><p>    : </p><br><pre> <code class="php hljs">CountingCommentBlock::viewComments() -&gt; CommentBlock::viewComments() -&gt; (n ) CountingCommentBlock::viewComment()</code> </pre> <br><p>            :   <code>CountingCommentBlock::viewComments()</code>  <code>CountingCommentBlock::viewComment()</code> .  C'est-à-dire      –        .       <code>CountingCommentBlock</code> ,    ,  ! </p><br><p>         ,    <em>protected </em>  .     ,       .      .          ,    . </p><br><p>       .        ,     .         ,           .         ,      ,    « <a href="https://en.wikipedia.org/wiki/Yo-yo_problem" rel="nofollow"> -</a> ». </p><br><p>     ,     .     ,            « <em>  </em> ».       « <em> </em> »  <code>$this</code> ,            <code>private</code> ,    . </p><br><p> ,        . ,               ,      .     PHP      ( <code>public</code> , <code>protected</code> , <code>private</code> )    <code>final</code> . </p><br><h2 id="klyuchevoe-slovo-final">   final </h2><br><p>     PHP          .     ,    , ..     ,          ,   ,  . ,           <code>final</code> . </p><br><blockquote> PHP 5    <code>final</code> ,      ,       .         ,      . <br><br>  #1. <br>  ... <br>  #2 <br>  ... <br><br> :        ,    . </blockquote><p> <em>  PHP, « <a href="https://www.php.net/manual/ru/language.oop5.final.php" rel="nofollow">  final</a> »</em> </p><br><p>      PHP     .                   .     <code>final</code>     ,       . </p><br><p> ,  <code>final</code> –        PHP,         .      ,     PHP      :   <em>typehints</em> ,      .. </p><br><p>   <code>final</code> ,     ,       <a href="https://en.wikipedia.org/wiki/Defensive_programming" rel="nofollow"> </a> .  C'est-à-dire              ,  .     . </p><br><p>   ,            ,   <code>private</code> ,         .          ,     . </p><br><p> ,   ,       ,      API.       ,      «»   ,    .      «»     -    .     «»           ,       . </p><br><p>     API     «  ».   ,                  . </p><br><p>    ,              <code>final</code>          . </p><br><h2 id="primenenie-final-dlya-uluchsheniya-arhitektury">  final    </h2><br><h3 id="pattern-shablonnyy-metod">  « » </h3><br><p>          –   .        ,       <em>public</em>  <em>protected</em> . </p><br><p>   ,     ,      .     PHP (    -)          .        –   ,        ,  ,    . </p><br><p>    ,     ()           .       « <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)" rel="nofollow"> </a> » ( <a href="https://en.wikipedia.org/wiki/Template_method_pattern" rel="nofollow">Template method</a> ). </p><br><p>     ,        : </p><br><ul><li> <u>   </u> .   ,   () .   <em> </em>  .       <code>final</code> .          –       . </li><li> <u>   </u> .       .     ,          .     <em> ()  </em> . </li></ul><br><p>     <em>  </em>   ,      <em>abstract </em> ,    ,  <em>final </em> ,     .      ,  ,      .          , ..      <code>final</code> . </p><br><p>      .  ,     ,         .    ,              .        . .., ,   -   ,    , , .            : </p><br><ul><li>       <code>abstract</code>      ; </li><li>        <code>final</code> ,  ,   . </li></ul><br><p>      .         « »     <em>abstract</em>  <em>final </em> . </p><br><p>     <code>CommentBlock</code> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p>         <code>SimpleCommentBlock</code> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre> <br><p>  ,  ,   : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre> <br><p>      «»,       <em>   </em> .            <em>final </em>  <em>final </em> . </p><br><p>              . ,   .  ,    « »   <em>down-call</em> ,       ,     .      . </p><br><p>     ,        ,         .  ,         . </p><br><h3 id="predpochitay-realizaciyu-interfeysa-nasledovaniyu">     </h3><br><p>            - ,         .            <code>extends</code> ,     <code>implements</code> . </p><br><p>            -   .     <code>CommentBlock</code> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre><br><p>        : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><p>       ,  : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p>          <code>implements</code>  - <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D1%2581%25D1%2581%25D0%25BE%25D1%2586%25D0%25B8%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_(%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow"></a> ( <a href="https://en.wikipedia.org/wiki/Association_(object-oriented_programming)" rel="nofollow"><em>association</em></a> )   . </p><br><p> -,    <em>   </em> .            -  .    <code>final</code> ,         :   ,         .. </p><br><p>  .  <em></em>            .  ,      <em></em>     <code>public</code> .       <code>implements</code> ,    ()        , ,    <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D1%2584%25D0%25B5%25D0%25B9%25D1%2581%25D0%25B0" rel="nofollow">  </a> ( <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle" rel="nofollow">ISP</a> ).             ,      . </p><br><p>    <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D0%25BE%25D1%2582%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8/%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8" rel="nofollow"> /</a> ( <a href="https://en.wikipedia.org/wiki/Open%25E2%2580%2593closed_principle" rel="nofollow">OCP</a> )?     <code>final</code>  <code>implements</code> –     PHP    . </p><br><p>   , ,   ,    .    ,     <code>implements</code> ,     .          . </p><br><p>   <code>final</code>  ,         .     .     –        ,            <code>implements</code>       <code>final</code> . </p><br><p>        « »,    .   <code>implements</code>       ,    <code>final</code>       . </p><br><p>   ,     « »,      ,       .       –   <code>SimpleCommentBlock</code>  <code>CountingCommentBlock</code>      <code>viewComments()</code>         . </p><br><h3 id="predpochitay-agregaciyu-nasledovaniyu">    </h3><br><p> ,     <code>viewComments()</code>     ,       , , ,   .        ,      .        <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BA%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)" rel="nofollow"> </a> ( <a href="https://en.wikipedia.org/wiki/Decorator_pattern" rel="nofollow">decorator pattern</a> ).         ,   « », –    <code>final</code>    ,    <code>implements</code> . </p><br><p>     ,   <code>CommentBlock</code> ,      . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre> <br><p>  ,      <code>getCommentKeys()</code>    .           .    ,        <em>protected </em> ,            <code>CommentBlock</code> . </p><br><p> <code>SimpleCommentBlock</code>      - «»  . ,    ,      <code>implements</code>       <code>final</code> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p> <code>CountingCommentBlock</code>  - «»             –     <abbr title="Principe ouvert - fermé">OCP</abbr> . <code>CountingCommentBlock</code>   :        <code>CommentBlock</code>      . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**  CommentBlock */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $commentBlock; <span class="hljs-comment"><span class="hljs-comment">/**  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommentBlock $commentBlock, CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock = $commentBlock; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock-&gt;getCommentKeys(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $commentKeys = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getCommentKeys(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($commentKeys <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $commentKey) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($commentKey); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock-&gt;viewComments(); } }</code> </pre> <br><p> - <code>CountingCommentBlock</code>           . ,  <code>viewComment()</code>       .      ( <em>forwarding methods</em> ). </p><br><p>          ,     « ».   <code>getCommentKeys()</code> .   ,  «»        ,         ,        . </p><br><p>         ,    .   ,    -       «»  .  ,      –         ( ,  SOLID)     ( ,  ,   ). </p><br><p>     .  <code>SimpleCommentBlock</code>  <code>CountingCommentBlock</code>    <code>CommentBlock</code> ,       .           -,     . </p><br><p> ,           <em> </em>  <em>  </em> ,    <code>final</code>        <em>   </em> ,       <code>CommentBlock</code> . </p><br><p>   <code>SimpleCommentBlock</code>  <code>CountingCommentBlock</code>    -  « »,            .   « »    ,     .            ,       « ».       –        . </p><br><p>     ,  <code>final</code>   ,   .     ,     «--»   –         .    <abbr title="Principe d'inversion de dépendance">DIP</abbr> ,       . </p><br><p>       : <code>SimpleCommentBlock</code> –     ;  <code>CountingCommentBlock</code> –   <code>SimpleCommentBlock</code> ,       ().  C'est-à-dire      ,        –    <abbr title="Principe de responsabilité unique">SRP</abbr> .     ,    ,     ( <em>cohesion</em> )          . </p><br><p>       «  » –      (, , ),    ,      .       ,                  . </p><br><p>   . </p><br><p>     <code>viewRandomComment()</code>    <code>SimpleCommentBlock</code>         - <code>CountingCommentBlock</code> .    ,                –   <code>viewRandomComment()</code>     .  <code>CountingCommentBlock::viewRandomComment()</code>      . </p><br><p>  ,    <code>viewComments()</code>    <code>SimpleCommentBlock</code>       . <code>CountingCommentBlock</code>         <code>SimpleCommentBlock</code> ,     . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewRandomComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $key = array_rand(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-comment"><span class="hljs-comment">/**      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { <span class="hljs-comment"><span class="hljs-comment">/*    `$this-&gt;viewComment()`      */</span></span> $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><h3 id="klass-dolzhen-byt-podgotovlen-k-nasledovaniyu">       </h3><br><p>       :    ,  ,       ,   ,   ,   ..           . </p><br><p>    PHP     ,  ,        <code>final</code> ,          .     , ,   ,    .          ,      .        .         –        ,     –         . </p><br><p>      ,            .     <a href="" rel="nofollow">PHPDoc</a>   ,           .     :           . </p><br><p>     ,         ,    (.. ,   <code>public</code>  <code>protected</code> ).  <a href="" rel="nofollow">PSR-19: PHPDoc tags</a> ,    ,        .         <em>PHPDoc</em> ,     «    -». </p><br><p>     <a href="https://en.wikipedia.org/wiki/Javadoc" rel="nofollow">JavaDoc</a>  <a href="https://openjdk.java.net/jeps/8068562" rel="nofollow">@implSpec</a> ,              .  , <em>PHPDoc</em>   <em>API</em>         , ..  <em>public </em> .  <code>@implSpec</code>     ,    <em>API</em> .        ,    <em>protected </em>     . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *         *       *  (,    ) * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@implSpec</span></span></span><span class="hljs-comment">      `$key` *    `$this-&gt;comments`      `view()` * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre><br><p>  <em>PHPDoc</em>    <code>@implSpec</code>     .        <code>$key</code>      .        –     <code>view()</code> . </p><br><p>        ,     <code>@implSpec</code> : </p><br><ul><li>         (   ,  ,    ,    ..). </li><li>              <code>parent::method()</code> . </li></ul><br><p>  ,   «»  .  ,  <em>self-call</em>  ( <code>$this</code> )  ,      ,  : </p><br><ul><li>        <code>$this</code> ; </li><li>    ; </li><li>    . </li></ul><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *           * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@implSpec</span></span></span><span class="hljs-comment">    `$this-&gt;comments` *        `$this-&gt;viewComment()`. *       . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p>  ,   <code>viewComments()</code>   <code>final</code>       .       <code>viewComment()</code> ,        .        : </p><br><ul><li>    <code>viewComment()</code>   <code>viewComments()</code> ; </li><li>       <code>viewComments()</code>   <code>viewComment()</code> . </li></ul><br><p>     ,    .       ,      ,        .  «  »,     <code>CommentBlock</code>  <code>CountingCommentBlock</code> ,  .         <code>viewComment()</code>    <code>viewComments()</code> ,   ,      . </p><br><p>      ,   ,    .  <em>PHPDoc</em>     <em>API</em>        :       ,      ,    . </p><br><p>  ,     ,    ,    ,    ,            ,  «».       –   .  <em>PHPDoc</em>      ,         . </p><br><p> ,           ,            .   –          <code>final</code> ,        .        .          – «            ». </p><br><p>           : </p><br><ul><li>    .              ; </li><li>       <code>final</code> .  . </li></ul><br><p>  , ,   <code>final</code>      .      <code>final</code>     ,        .          ,       .         ,        ? </p><br><p>   <code>final</code>            .     ,      ,     .   ,       ,  <code>final</code>     ,   . </p><br><h3 id="final-zastavlyaet-zadumatsya-o-neobhodimosti-nasledovaniya"> final      </h3><br><p>      « »,    ,     , ,  ,    .  ,      <em>protected </em>   .   ,   <code>final</code> –     ,    ,     ,      <em>public </em> ,    . </p><br><p>       ,    ,      .  ,            ,   ,   .   –    <code>final</code> . </p><br><p>        ,           <code>final</code> ?  Non.  -   ,      <em>Opensource</em> ,    ,    .              <em>IDE</em> .  ,           . </p><br><p> ,  ,     <code>final</code>      .      <code>final</code>  ,              .          . </p><br><p> <code>final</code>     ,           .          <em>public </em> ?           –     ,   ? </p><br><p>      ,           .   ,      <code>final</code> ,      ,   <em>protected </em>  . </p><br><p> <code>final</code>       ,              <em>code review</em> (    <em>code review</em> ? ;). , . </p><br><ul><li>      <code>final</code> ?    ? ? </li><li>      <code>final</code> ?             ?       ? </li></ul><br><p>            .        ,   ,    <em>code review</em>       .     . </p><br><p>    .   <code>final</code>        <em>PHP5</em> . ,  ,     ( ,   )        . </p><br><p>       ,             ,     .     « »      ,   . ,  <em>C#</em>          <code>virtual</code> ,    – <code>override</code> .     <em>PHP</em>  <code>final</code>    <code>extandable</code> ,    «       <code>final</code> »,              <code>extend</code>    . </p><br><h3 id="klass-dolzhen-byt-podgotovlen-k-agregacii">       </h3><br><p> ,      –    .     .          .               . </p><br><p>    . ,   .    ,        .     <code>final</code>    ,      ,    -.  ,     ,    <code>implements</code>      . </p><br><p>  ,        ,   <code>final</code>       . </p><br><ol><li><p>         <code>final</code>    : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br></li><li><p>         .   , <code>final</code>          .          ,      .            . </p><br><p>   ,      <code>public</code>      . ,               ,     . </p><br><p>        ,              . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre><br></li><li><p>     . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br></li><li><p>     -,          .   -    <code>CommentBlock</code>   .  -           . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $commentBlock; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommentBlock $commentBlock </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/* ,... */</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock = $commentBlock; } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br></li></ol><br><p>             ,     .  ,       <code>final</code>  ,    ,     -   .   ,         <code>final</code>   . </p><br><p>      <code>final</code> ,      .   ,             «».   ,          .         <code>final</code>      . </p><br><h3 id="ispolzovanie-final-klassov-v-testah">  final    </h3><br><p>         <code>final</code>       –     ( <em>PHPUnit, Mockery</em> )     <em> «»</em> ( <a href="https://en.wikipedia.org/wiki/Test_double" rel="nofollow">test doubles</a> ).       ,           . </p><br><p> ,  : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlockTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreatingTestDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createMock(SimpleCommentBlock::class); } }</code> </pre> <br><p>   : </p><br><pre> <code class="bash hljs">Class <span class="hljs-string"><span class="hljs-string">"SimpleCommentBlock"</span></span> is declared <span class="hljs-string"><span class="hljs-string">"final"</span></span> and cannot be mocked.</code> </pre> <br><p>   ,   « » <em>PHPUnit</em>    ,  : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mock_SimpleCommentBlock_591bc3f3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>      <em> «»</em> . -,           , ..   . , -,    ,   <em>PHPUnit</em>       . ,      . </p><br><p>   <code>final</code>               .         :   .   . </p><br><p> <strong> </strong> </p><br><p>    –     <em> «»</em>   . ,    ( <code>Post</code> , <code>Comment</code> )  - ( <a href="https://en.wikipedia.org/wiki/Value_object" rel="nofollow">value object</a> )   ( <em>stable</em> )      .       .    <a href="https://martinfowler.com/articles/mocksArentStubs.html" rel="nofollow">classical TDD</a> (  <a href="https://martinfowler.com/articles/mocksArentStubs.html" rel="nofollow">mockist TDD</a> ) </p><br><p>  ,      ( <em>volatile</em> )       .   ,  ,  <em> «»</em> –     ,   .   ,  <em> «»</em>        ,       .           ( <em>DIP</em> ),      ,  <em> «»</em>       . </p><br><p>  ,            .  C'est-à-dire     : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>     : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>      <em> «»</em> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlockTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreatingTestDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createMock(CommentBlock::class); } }</code> </pre> <br><p>        <em> «»</em>    ,       .    : </p><br><ul><li>      <em> «»</em> ; </li><li>         ; </li><li> <em> «»</em>       , ..  <em>DIP</em>      . </li></ul><br><p> <strong> </strong> </p><br><p>   ,    «» –      ,     -. ,         (  ,  ).           ,    «   »  «    ». </p><br><p> ,          <code>final</code>   . </p><br><p>   –     -.          -. ,   -,       .         <a href="http://docs.mockery.io/en/latest/reference/final_methods_classes.html" rel="nofollow"> </a>   <a href="https://github.com/mockery/mockery" rel="nofollow">Mockery</a> . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlockTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreatingProxyDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> $simpleCommentBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleCommentBlock(); <span class="hljs-comment"><span class="hljs-comment">/*  - */</span></span> $proxy = Mockery::mock($simpleCommentBlock); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> $proxy-&gt;shouldReceive(<span class="hljs-string"><span class="hljs-string">'viewComment'</span></span>) -&gt;andReturn(<span class="hljs-string"><span class="hljs-string">'text'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-string"><span class="hljs-string">'text'</span></span>, $proxy-&gt;viewComment(<span class="hljs-string"><span class="hljs-string">'1'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/* `$proxy`     `SimpleCommentBlock`  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertNotInstanceOf(SimpleCommentBlock::class, $proxy); } }</code> </pre><br><p>     – -             .   ,      <code>instanceof</code> .      <a href="https://www.php.net/manual/ru/functions.arguments.php" rel="nofollow"> </a> ( <a href="https://www.php.net/manual/en/functions.arguments.php" rel="nofollow"><em>type declarations</em></a> ),  -     . </p><br><p>   « » –  PHP,        ,   .       <a href="https://github.com/dg/bypass-finals" rel="nofollow">Bypass Finals</a> ,             <code>final</code>   .     <em>composer</em>    <code>final</code>      : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testUsingBypassFinals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*   `final` */</span></span> BypassFinals::enable(); $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createMock(SimpleCommentBlock::class); }</code> </pre> <br><h3 id="instrumenty-dlya-udobnoy-raboty-s-final-klassami">      final  </h3><br><p> ,  PHP       .      « »     ,      <code>final</code>  .  ,   <em>IDE</em>     <code>final</code>     . </p><br><p> <strong>PHPStorm   </strong> </p><br><p>  <em>PHPStorm</em>       .      <strong>File | Settings | Editor | File and Code Templates</strong>   <strong>Files</strong>    <strong>PHP Class</strong> .        <code>final</code> . </p><br><p> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/ss/ox/hd/ssoxhdbjwapvnacnr2yfxbbk5nk.png" alt="Modification du modèle intégré `PHP Class`"></a> </p><br><p>      <strong>File | New | PHP Class</strong>     : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br><p> ,    .          .      –  . </p><br><p>    <em>PHPStorm</em>     <strong>Refactor | Extract | Interface</strong> .        ,   .           ( <strong>Replace class reference with interface where possible</strong> )   <em>PHPDoc</em>   ( <strong>Move PHPDoc</strong> ). </p><br><p>      : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** PHPDoc */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre> <br><p>       : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br><p>     <strong>File | New | PHP Class</strong>     -,  .             : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CommentBlock */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $commentBlock; }</code> </pre> <br><p>       <strong>Code | Generate | Constructor</strong> .         . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommentBlock $commentBlock)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock = $commentBlock; } }</code> </pre><br><p>    –      .   <strong>Code | Generate | Implement Methods</strong> .  ,        .     <em>PHPStorm</em>      «»       ,       <em>IntelliJ IDEA</em>  <em>ReSharper</em> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement viewComment() method. } }</span></span></code> </pre> <br><p> PHPDoc     .     . </p><br><p> <strong>PHPStan    </strong> </p><br><p>        ,          . ,    , ,      <code>final</code>    .          ( <a href="https://habr.com/ru/company/badoo/blog/426605/">  </a> ). </p><br><p>      <a href="https://github.com/phpstan/phpstan" rel="nofollow">PHPStan</a> .  « »        .  <em>PHPStan</em>            .           . </p><br><p>        <a href="https://github.com/localheinz/phpstan-rules/blob/master/src/Classes/FinalRule.php" rel="nofollow"><code>FinalRule</code></a>    <a href="https://github.com/localheinz/phpstan-rules" rel="nofollow"><code>localheinz/phpstan-rules</code></a> .     <code>PHPStan\Rules\Rule</code>        <code>processNode()</code> . </p><br><p>      . ,   <code>FinalRule</code>         « »   <code>allowAbstractClasses</code> .   ,    ,     <code>classesNotRequiredToBeAbstractOrFinal</code> . </p><br><p>          ,    <em>composer</em> : </p><br><pre> <code class="bash hljs">composer require --dev phpstan/phpstan composer require --dev localheinz/phpstan-rules</code> </pre> <br><p>   <code>FinalRule</code>    <code>phpstan.neon</code>   : </p><br><pre> <code class="plaintext hljs">services: - class: Localheinz\PHPStan\Rules\Classes\FinalRule arguments: allowAbstractClasses: true classesNotRequiredToBeAbstractOrFinal: [] tags: - phpstan.rules.rule</code> </pre> <br><p>          ( <code>max</code> ): </p><br><pre> <code class="bash hljs">vendor/bin/phpstan -lmax analyse src</code> </pre> <br><p>     : </p><br><pre> <code class="plaintext hljs"> ------ ------------------------------------------------------------------------ Line CommentBlock.php ------ ------------------------------------------------------------------------ 10 Class CommentBlock is neither abstract nor final. ------ ------------------------------------------------------------------------</code> </pre> <br><p>     <em>JSON</em>      <em>Continuous Integration</em> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p> ,    :     <code>final</code>  !       IDE,    . </p><br><p> ,       ,        .      –    <em>SOLID</em>   .      ,         ,          . </p><br><p> ,           .   : </p><br><ul><li>              ; </li><li>   <code>final</code> , ,  ,    ; </li><li>            . </li></ul><br><p>     ,   -      - .             .           .  ,           , ,      ,         .   ,       .        ? </p><br><p>   ,      –    ,     .       <code>final</code>     .       <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D0%25BA%25D0%25BE%25D0%25B3%25D0%25BD%25D0%25B8%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25BD%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B8" rel="nofollow"> </a> ( <a href="https://en.wikipedia.org/wiki/Cognitive_load" rel="nofollow">cognitive load</a> ) –          .     –       . </p><br><p>         :        <code>final</code> .            .   –      .        .            .    ,      .  ,     . </p><br><p>   <code>final</code>        .    ( <em>SOLID</em> )     ( <em>fragile</em> ) .         ,      . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482154/">https://habr.com/ru/post/fr482154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482136/index.html">Comment un projet monomarque peut-il entrer dans le TOP en battant les agrégateurs et les services internes des moteurs de recherche?</a></li>
<li><a href="../fr482140/index.html">Jeux de société pour jeunes programmeurs de 4 à 10 ans. Que trouve-t-on sur le marché fin 2019</a></li>
<li><a href="../fr482142/index.html">23 minutes Justification de l'esprit lent</a></li>
<li><a href="../fr482146/index.html">Confidentialité dès la conception, ou comment créer une application pour ne pas tomber en panne des marchés</a></li>
<li><a href="../fr482152/index.html">Vulnérabilités dans les systèmes d'exploitation en temps réel</a></li>
<li><a href="../fr482156/index.html">Entretien avec Will Kurt à propos de son nouveau livre, Bayesian Statistics - It's Great</a></li>
<li><a href="../fr482158/index.html">Rencontrez Ember Octane</a></li>
<li><a href="../fr482162/index.html">Les mathématiciens ont trouvé un modèle, sachant comment éviter son apparition</a></li>
<li><a href="../fr482166/index.html">Service de dressage de chiens à l'aéroport: vous êtes déjà reniflé</a></li>
<li><a href="../fr482176/index.html">Comment s'est déroulée la conférence @Kubernetes le 29 novembre: vidéo et résultats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>