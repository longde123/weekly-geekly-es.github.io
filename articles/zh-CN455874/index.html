<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖼️ ✍🏿 🕉️ macOS 10.14.5的Electron应用程序的通知过程 🙋🏾 👲🏻 📪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="随着macOS 10.14.5的发布，Apple在分发应用程序之前为应用程序添加了强制性的公证流程。 我想告诉您它是什么，并且在Electron.js上进行开发时此更新引起了哪些困难。 



 引言 


 在Electron.js蓬勃发展2年之后，所有关于它的严重程度以及为什么需要它的热潮都是安...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>macOS 10.14.5的Electron应用程序的通知过程</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455874/"><p> 随着macOS 10.14.5的发布，Apple在分发应用程序之前为应用程序添加了强制性的公证流程。 我想告诉您它是什么，并且在Electron.js上进行开发时此更新引起了哪些困难。 </p><br><p><img src="https://habrastorage.org/webt/7c/vo/qz/7cvoqzkecwn_jtlk82d33eghvda.png"></p><a name="habracut"></a><br><h2 id="vvedenie"> 引言 </h2><br><p> 在Electron.js蓬勃发展2年之后，所有关于它的严重程度以及为什么需要它的热潮都是安静的。 我们不要在评论中重新点燃它们。 谢谢啦 </p><br><p> 我们的项目使用电子构建器来构建应用程序，但是对于电子包装器，此过程将大致相同。 </p><br><p> 该项目本身是用于云游戏的启动器，通过该启动器，本机客户端将启动以访问远程计算机。 </p><br><p> 用电子生成器签署应用程序看起来并不复杂，但是为了完整起见，我将简要介绍一下此过程。 如果对应用程序签名没有问题，则可以跳过本章。 </p><br><h3 id="podpisanie-prilozheniya"> 应用程序签名 </h3><br><p> 要签署该应用程序，我们需要从Apple开发人员的个人帐户中导出证书。 我们将需要： </p><br><ul><li> 开发人员ID申请 </li><li> 开发人员ID安装程序 </li><li>  *第三方Mac开发人员应用程序和第三方Mac开发人员安装程序（如果您打算在AppStore中发布该应用程序） </li></ul><br><p> 为特定的应用程序颁发了开发人员ID安装程序证书，因为此bundleID是必需的。 对于电子生成器，它由package.json中的appId参数指定 </p><br><p><img src="https://habrastorage.org/webt/pz/xc/ut/pzxcutr2ad_xxln6bqd5dlegi1q.png"></p><br><p> 证书必须收集在一个文件中。 为此，将它们添加到钥匙串中（两次单击证书）。 <br> 然后，我们进入钥匙串，选择必要的证书，然后在上下文菜单中单击“导出项目”。 导出后，我们得到一个扩展名为.p12的文件。 </p><br><p><img src="https://habrastorage.org/webt/uq/si/no/uqsinodlzfxhbrk0y3eqcyw2igi.png"></p><br><p> 在收到证书文件之后，将以下条目添加到环境变量中 </p><br><ul><li>  CSC_LINK（证书文件.p12的路径） </li><li>  CSC_KEY_PASSWORD（证书访问密码） </li></ul><br><p> 如果不添加这些变量，收集器将自动在钥匙串存储库中搜索合适的钥匙。 添加这些条目可让您查明要用于签名的证书。 </p><br><p> 完成这些操作后，您可以开始构建过程，一切应该顺利进行。 </p><br><p> 直到macOS 10.14.5发行为止，此工作一直很顺利.... </p><br><h2 id="chto-izmenilos-s-vyhodom-macos-10145">  macOS 10.14.5发生了什么变化 </h2><br><p> 一个小题外话。 在晚上执行新补丁的最后工作时，我决定在早上离开生产版本的程序集。 注意到macOS上有更新，它启动并进入睡眠状态。 </p><br><p> 第二天早上，我很惊讶地看到在对应用程序进行签名时，该程序集因未知错误而掉线-“未经公证的开发人员ID”。 </p><br><blockquote> 不要推迟到明天，今天可以做什么。 本杰明·富兰克林 </blockquote><br><h4 id="sut-problemy"> 问题的实质 </h4><br><p> 从macOS 10.14.5开始，Apple引入了强制性的公证程序。 苹果公司有关此的第一篇文章是在2018年，但由于此更新，此程序成为强制性的。 她长什么样 </p><br><p> 您收集应用程序-&gt;将其发送到Apple服务器-&gt; Apple对其进行认证-&gt;返回成功认证的状态-&gt;执行设置认证标记的命令。 </p><br><p> 对于使用Xcode的开发人员，您只需要勾选公证即可 </p><br><p><img src="https://habrastorage.org/webt/-x/sa/t4/-xsat4hgljlntg9x36agif_k13c.png"></p><br><p> 而且，可以通过终端中的命令来执行组装的应用的公证处理。 </p><br><pre><code class="plaintext hljs">$ xcrun altool --notarize-app --primary-bundle-id "com.example.ote.zip" --username "AC_USERNAME" --password "@keychain:AC_PASSWORD" --file OvernightTextEditor_11.6.8.zip</code> </pre> <br><ul><li>  primary-bundle-id-应用程序bundleID </li><li> 用户名<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-developer.apple.com</a>用户登录 </li><li> 密码-“应用专用密码”。 可以在开发人员的帐户下的个人帐户<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">appleid.apple.com中</a>创建它。 </li></ul><br><p> 如果您不执行公证程序，那么当用户尝试安装该应用程序时，会弹出带有错误的窗口。  Gatekeeper负责检查应用程序的安全性。 正是他打破了电子生成器上的应用程序组装。 </p><br><p><img src="https://habrastorage.org/webt/v6/gm/-a/v6gm-azhc2cgsxtvrqylh4hz_l0.jpeg"></p><br><h4 id="kak-vyglyadel-process-sborki-electron-builder"> 电子生成器的构建过程看起来如何 </h4><br><p> 在使用electronic-osx-sign实用程序在.app文件中构建应用程序之后，对该应用程序进行了签名。 使用证书签名后，启动了使用Gatekepper检查应用程序的过程。 但是随着更新的发布，网守开始检查应用程序的正确公证，这无法成功完成应用程序签名过程。 </p><br><p><img src="https://habrastorage.org/webt/gs/-v/g0/gs-vg0zydktmqzserrjzfqrjmi0.png"></p><br><h4 id="patch-dlya-vozmozhnosti-notarizacii"> 公证补丁 </h4><br><p>  Github用户<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kallin</a>迅速提出了一种解决方案，在设置中增加了两个新参数。 第一个是“ gatekeeperAssess”-签名后禁用程序集验证，第二个是“ sign”-禁用带有证书的安装文件（dmg）的签名。 此提交包含在电子生成器20.43.0的发行版中。 </p><br><p> 对于公证过程本身，电子用户区具有一个执行此任务的电子公证模块，您只需要编写一个小脚本并使用afterSign挂钩运行它即可。 </p><br><h2 id="process-podpisaniya-i-notarizacii-prilozheniya"> 申请签名和公证流程 </h2><br><p><img src="https://habrastorage.org/webt/mc/qg/n5/mcqgn5yehovsqcheiyq_5a1b-qo.png"></p><br><p> 最初，您需要检查是否已经安装了electronic-builder版本&gt; = 20.43.0，并安装了electronic-notarize软件包。 </p><br><p> 在环境变量中添加2个条目： </p><br><ul><li>  appleId-developer.apple.com登录 </li><li>  appleASP-“应用专用密码”，可以在您的个人帐户<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">appleid.apple.com中</a>创建。 </li></ul><br><p><img src="https://habrastorage.org/webt/q0/co/bv/q0cobvddzumimcg6kzffx9hzjkg.png"></p><br><p> 现在创建一个公证脚本，将在对应用程序签名后执行。 </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> notarize = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'electron-notarize'</span></span>).notarize; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (context) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { electronPlatformName } = context; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (electronPlatformName === <span class="hljs-string"><span class="hljs-string">'darwin'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Try notarize app'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> notarize({ <span class="hljs-attr"><span class="hljs-attr">appBundleId</span></span>: <span class="hljs-string"><span class="hljs-string">'APP_BUNDLE_ID'</span></span>, <span class="hljs-attr"><span class="hljs-attr">appPath</span></span>: <span class="hljs-string"><span class="hljs-string">'./dist/mac/APP_NAME.app'</span></span>, <span class="hljs-attr"><span class="hljs-attr">appleId</span></span>: process.env.appleId, <span class="hljs-attr"><span class="hljs-attr">appleIdPassword</span></span>: process.env.appleASP, }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Success notarize'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); } } };</code> </pre> <br><p> 我们将其保存在方便您的位置。 </p><br><p> 另外，为了进行适当的公证，我们需要确定访问权限 <br> 用于我们应用程序的系统资源。 为此，请创建文件build / entitlements.mac.inherit.plist </p><br><pre> <code class="plaintext hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt; &lt;plist version="1.0"&gt; &lt;dict&gt; &lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.allow-dyld-environment-variables&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.disable-library-validation&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.disable-executable-page-protection&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.debugger&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.automation.apple-events&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt; &lt;/plist&gt;</code> </pre> <br><p> 在我的情况下文件的内容。 您可能有不同的配置。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">所有字段的描述</a> 。 <br>  Electron.js的必需项是-com.apple.security.cs.allow-unsigned-executable-memory。 </p><br><p> 现在更新package.json中的设置 </p><br><p> 在macOS的部分中： </p><br><p><img src="https://habrastorage.org/webt/lg/-2/tn/lg-2tnabm6hagn1s17mrcfgzhbw.png"></p><br><ul><li>  gatekeeperAssess（禁用电子-osx-sign侧的应用程序验证） </li><li>  hardenedRuntime（允许您创建安全权限列表和对系统资源的访问） </li><li> 权利（我们应用程序访问权限文件的路径） </li></ul><br><p> 在电子生成器设置的常规部分中： </p><br><p><img src="https://habrastorage.org/webt/jb/6e/ek/jb6eekoqrg9qvfm2wxhilunfdjk.png"></p><br><ul><li>  afterSign（公证脚本的路径，将在对应用程序进行签名后启动） </li></ul><br><p> 我们开始组装过程。 似乎有点暂停，但是将文件传输到Apple服务器并等待响应需要一些时间（从3到10分钟） </p><br><p> 可以通过以下命令在终端中查看通知状态： </p><br><p> <code>$ xcrun altool --notarization-history 0 -u $appleId -p $appleASP</code> </p> <br><p> 答案将显示在表格中。 状态字段的值可能为“处理”，“已批准”，“无效” </p><br><p><img src="https://habrastorage.org/webt/lf/-c/gt/lf-cgtkjf3jwkwses9dnbaztnig.png"></p><br><p> 如果状态为“无效”，则可以通过请求号查看到底出了什么问题。 </p><br><p> <code>$ xcrun altool --notarization-info "RequestUUID" -u $appleId</code> </p> <br><p> 这就是签名和公证的整个过程。 希望本文对您有所帮助。 谢谢啦 </p><br><h4 id="nebolshoe-dopolnenie"> 小加成 </h4><br><p> 在转移应用程序进行测试时，发现了一个有趣的故障。 通过电报收到的应用程序只是拒绝启动。 查看日志时，发现该应用程序已被Telegram隔离。 由于什么原因以及如何发生，我找不到答案。 通过Yandex.Disk（或通过浏览器下载的任何其他方式）发送文件时，不会发生此问题。 </p><br><p><img src="https://habrastorage.org/webt/ww/3j/4k/ww3j4kakytwimj8uvz89d0jm2l0.png"></p><br><h3 id="poleznye-ssylki"> 有用的链接 </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">电子公证存储库</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">苹果有关应用程序公证的文章</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kallin关于公证过程的文章，是在我写完我的论文后才发现的</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455874/">https://habr.com/ru/post/zh-CN455874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455856/index.html">nRF52832上的无线温度，湿度和大气压传感器</a></li>
<li><a href="../zh-CN455858/index.html">最小的有线电视网络。 第9部分：头端</a></li>
<li><a href="../zh-CN455860/index.html">Camunda的时尚，时尚，青年BPM开发</a></li>
<li><a href="../zh-CN455862/index.html">AWS的新增功能：DATA API，Kinesis Data Analytics，S3 Path</a></li>
<li><a href="../zh-CN455868/index.html">克服摩尔定律：未来的晶体管技术</a></li>
<li><a href="../zh-CN455878/index.html">在零售中使用视频分析的方案。 跟随零售业视频分析的脚步</a></li>
<li><a href="../zh-CN455880/index.html">新的序列化可能会出现在Java中</a></li>
<li><a href="../zh-CN455882/index.html">Cisco ACI数据中心的网络工厂-管理员帮助</a></li>
<li><a href="../zh-CN455884/index.html">VS代码扩展-代码段-我将告诉您如何节省时间</a></li>
<li><a href="../zh-CN455886/index.html">给HAT-P-3系统中的恒星和系外行星起个名字</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>