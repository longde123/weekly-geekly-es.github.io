<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üó≥Ô∏è üëÜüèæ Como √© o arquivo zip e o que podemos fazer a respeito üë©üèø‚Äçüöí ‚è´ üëÇüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom dia, querido Habr! 

 Nos √∫ltimos meio ano, o caminho tortuoso dos meus projetos de animais de estima√ß√£o me levou a uma selva, de onde ainda n√£o √©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como √© o arquivo zip e o que podemos fazer a respeito</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471066/"> Bom dia, querido Habr! <br><br>  Nos √∫ltimos meio ano, o caminho tortuoso dos meus projetos de animais de estima√ß√£o me levou a uma selva, de onde ainda n√£o √© poss√≠vel sair.  E tudo come√ßou de forma inofensiva - um site com fotos, mas um senso de perfeccionismo, a busca de um brinde, al√©m de algumas caracter√≠sticas da minha mentalidade, que transformaram essa caminhada, como planejada originalmente, em uma jornada realmente longa.  Bem, tudo bem, como costumava dizer um revolucion√°rio bastante burry: "Aprenda, estude e estude novamente", mas eu, quer ou n√£o, tenho que seguir essa advert√™ncia. <br><br>  Oh, algo que nos distra√≠ do t√≥pico principal.  N√£o vou mais aborrec√™-lo com discursos longos, mas vou direto ao assunto. <br><a name="habracut"></a><br><h3>  Crie um arquivo zip </h3><br>  Em princ√≠pio, n√£o vou reescrever a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o</a> aqui.  No geral, tamb√©m n√£o faz sentido descrever a estrutura, porque tudo isso foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">feito antes de mim</a> . <br><br>  Para quem tem pregui√ßa de seguir os links, descreverei brevemente que qualquer arquivo zip deve conter: <br><br><ul><li>  Entrada do arquivo: <ul><li>  Cabe√ßalho do arquivo local </li><li>  Dados √∫teis </li><li>  Descritor de dados (opcional, usado quando n√£o sabemos o tamanho do arquivo e seu hash at√© o lermos at√© o final) </li></ul></li><li>  Cabe√ßalho de arquivo do diret√≥rio central (para cada arquivo. √â como um sum√°rio do livro, onde cada se√ß√£o e p√°gina na qual ele pode ser encontrado) </li><li>  Fim do diret√≥rio central </li></ul><br>  Sabendo disso, podemos tentar escrever um arquivo simples que conter√° apenas dois arquivos: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//        (1.txt  2.txt)   : $entries = [ '1.txt' =&gt; 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc id ante ultrices, fermentum nibh eleifend, ullamcorper nunc. Sed dignissim ut odio et imperdiet. Nunc id felis et ligula viverra blandit a sit amet magna. Vestibulum facilisis venenatis enim sed bibendum. Duis maximus felis in suscipit bibendum. Mauris suscipit turpis eleifend nibh commodo imperdiet. Donec tincidunt porta interdum. Aenean interdum condimentum ligula, vitae ornare lorem auctor in. Suspendisse metus ipsum, porttitor et sapien id, fringilla aliquam nibh. Curabitur sem lacus, ultrices quis felis sed, blandit commodo metus. Duis tincidunt vel mauris at accumsan. Integer et ipsum fermentum leo viverra blandit.', '2.txt' =&gt; 'Mauris in purus sit amet ante tempor finibus nec sed justo. Integer ac nibh tempus, mollis sem vel, consequat diam. Pellentesque ut condimentum ex. Praesent finibus volutpat gravida. Vivamus eleifend neque sit amet diam scelerisque lacinia. Nunc imperdiet augue in suscipit lacinia. Curabitur orci diam, iaculis non ligula vitae, porta pellentesque est. Duis dolor erat, placerat a lacus eu, scelerisque egestas massa. Aliquam molestie pulvinar faucibus. Quisque consequat, dolor mattis lacinia pretium, eros eros tempor neque, volutpat consectetur elit elit non diam. In faucibus nulla justo, non dignissim erat maximus consectetur. Sed porttitor turpis nisl, elementum aliquam dui tincidunt nec. Nunc eu enim at nibh molestie porta ut ac erat. Sed tortor sem, mollis eget sodales vel, faucibus in dolor.', ]; //      Lorem.zip,      cwd (      ) $destination = 'Lorem.zip'; $handle = fopen($destination, 'w'); //      ,    ,     ,   "" Central Directory File Header $written = 0; $dictionary = []; foreach ($entries as $filename =&gt; $content) { //         Local File Header,     //        ,      . $fileInfo = [ //     'versionToExtract' =&gt; 10, //   0,        - 'generalPurposeBitFlag' =&gt; 0, //      ,    0 'compressionMethod' =&gt; 0, // -    mtime ,    ,      ? 'modificationTime' =&gt; 28021, //   , ? 'modificationDate' =&gt; 20072, //      .     ,       ,   ? 'crc32' =&gt; hexdec(hash('crc32b', $content)), //     .        . //       :) 'compressedSize' =&gt; $size = strlen($content), 'uncompressedSize' =&gt; $size, //    'filenameLength' =&gt; strlen($filename), //  .    ,   0. 'extraFieldLength' =&gt; 0, ]; //      . $LFH = pack('LSSSSSLLLSSa*', ...array_values([ 'signature' =&gt; 0x04034b50, //  Local File Header ] + $fileInfo + ['filename' =&gt; $filename])); //       ,       Central Directory File Header $dictionary[$filename] = [ 'signature' =&gt; 0x02014b50, //  Central Directory File Header 'versionMadeBy' =&gt; 798, //  .    ,  -  . ] + $fileInfo + [ 'fileCommentLength' =&gt; 0, //    . No comments 'diskNumber' =&gt; 0, //     0,        'internalFileAttributes' =&gt; 0, //    'externalFileAttributes' =&gt; 2176057344, //    'localFileHeaderOffset' =&gt; $written, //      Local File Header 'filename' =&gt; $filename, //  . ]; //      $written += fwrite($handle, $LFH); //    $written += fwrite($handle, $content); } // ,     ,    . //          End of central directory record (EOCD) $EOCD = [ //  EOCD 'signature' =&gt; 0x06054b50, //  .    ,   0 'diskNumber' =&gt; 0, //      -  0 'startDiskNumber' =&gt; 0, //       . 'numberCentralDirectoryRecord' =&gt; $records = count($dictionary), //    .    ,     'totalCentralDirectoryRecord' =&gt; $records, //   Central Directory Record. //      ,      'sizeOfCentralDirectory' =&gt; 0, // ,    Central Directory Records 'centralDirectoryOffset' =&gt; $written, //     'commentLength' =&gt; 0 ]; //     !   foreach ($dictionary as $entryInfo) { $CDFH = pack('LSSSSSSLLLSSSSSLLa*', ...array_values($entryInfo)); $written += fwrite($handle, $CDFH); } // ,   .  ,    $EOCD['sizeOfCentralDirectory'] = $written - $EOCD['centralDirectoryOffset']; //     End of central directory record $EOCD = pack('LSSSSLLS', ...array_values($EOCD)); $written += fwrite($handle, $EOCD); //  . fclose($handle); echo '  : ' . $written . ' ' . PHP_EOL; echo '     `unzip -tq ' . $destination . '`' . PHP_EOL; echo PHP_EOL;</span></span></code> </pre> <br>  Tente executar esse c√≥digo primitivo e a sa√≠da fornecer√° um arquivo Lorem.zip que conter√° 1.txt e 2.txt. <br><br><h3>  Porque </h3><br>  Obviamente, qualquer pessoa adequada dir√° que escrever arquivadores em php √© uma tarefa f√∫til, especialmente porque para um formato como zip, existem v√°rias implementa√ß√µes prontas para todos os gostos e cores.  E no mesmo php existem bibliotecas prontas.  Eu vou dizer isso tamb√©m :) <br><br>  Mas por que, ent√£o, √© este artigo inteiro, por que gastei tempo escrevendo e voc√™ lendo? <br>  E ent√£o, que tudo n√£o √© t√£o simples e saber como o zip funciona, abre algumas possibilidades adicionais para n√≥s. <br><br>  Em primeiro lugar, espero, pelo menos um pouco, mas ajudar√° aqueles que querem entender a estrutura do zip. <br>  E, em segundo lugar, criando o arquivo com nossas pr√≥prias m√£os, temos controle e, mais importante, acesso aos seus dados internos. <br><br>  Podemos pr√©-calcular o cabe√ßalho do arquivo local e o cabe√ßalho do arquivo do diret√≥rio central e, a pedido, gerar um arquivo zip em tempo real com qualquer conte√∫do e ordem dos arquivos, simplesmente substituindo esses dados.  E sem sobrecarga, exceto E / S. <br><br>  Ou ent√£o, podemos gravar o arquivo morto, carreg√°-lo, por exemplo, na nuvem, que suporta downloads fragmentados e, conhecendo as compensa√ß√µes de cada arquivo, obter qualquer um deles, como se n√£o estivesse no arquivo, adicionando apenas um t√≠tulo para a solicita√ß√£o.  E ent√£o tudo isso pode ser procurado e ... <br><br>  Ok, n√£o vamos nos antecipar.  Se voc√™ estiver interessado neste t√≥pico, nos artigos a seguir tentarei considerar essas oportunidades e mostrar como us√°-las. <br><br><hr><blockquote>  'diskNumber' =&gt; 0, // Eu geralmente encontrei 0 em todos os lugares e, em particular, decidi n√£o me aprofundar </blockquote>  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">berez</a> sugeriu, o n√∫mero do volume no arquivo m√∫ltiplo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471066/">https://habr.com/ru/post/pt471066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471048/index.html">React + Mobx: qual √© o objetivo?</a></li>
<li><a href="../pt471050/index.html">D Financiamento do Fundo de Desenvolvimento da Linguagem: Novas Plataformas e Novos Subs√≠dios ...</a></li>
<li><a href="../pt471052/index.html">Posso haz? Atingido por programa√ß√£o de tipo gen√©rico</a></li>
<li><a href="../pt471054/index.html">Longrid sobre o realismo da amea√ßa qu√¢ntica para criptomoedas e os problemas da "profecia 2027"</a></li>
<li><a href="../pt471062/index.html">Como ensinar Alice a gerenciar sua casa inteligente. Relat√≥rio Yandex</a></li>
<li><a href="../pt471070/index.html">Qual idioma do servidor escolher ... para um desenvolvedor de dispositivos m√≥veis</a></li>
<li><a href="../pt471072/index.html">Quanto gramas em telegrama?</a></li>
<li><a href="../pt471074/index.html">Synet - uma estrutura para o lan√ßamento de redes neurais pr√©-treinadas na CPU</a></li>
<li><a href="../pt471076/index.html">Como a Matrix criou um legado √† prova de balas</a></li>
<li><a href="../pt471078/index.html">O Chrome bloquear√° completamente o conte√∫do misto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>