<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐐 👩🏾‍🤝‍👨🏻 ↖️ Flutter nos exemplos. Links profundos em aplicativos Flutter 🖕🏼 ✌🏽 🧝🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A nova estrutura multiplataforma do Google, Flutter, está conquistando cada vez mais fãs. Mais e mais pessoas estão interessadas nessa tecnologia e a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Flutter nos exemplos. Links profundos em aplicativos Flutter</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/461239/">  A nova estrutura multiplataforma do Google, Flutter, está conquistando cada vez mais fãs.  Mais e mais pessoas estão interessadas nessa tecnologia e a experimentam em projetos comerciais e de animais de estimação.  Mais e mais artigos e exemplos aparecem no RuNet, mas há algum tempo notei que, diferentemente do Medium, os artigos de revisão principalmente sobre a tecnologia como um todo e suas vantagens ou novidades apresentadas na versão mais recente predominam em Habré.  Existem poucos textos sobre casos específicos.  Portanto, decidi que era necessário corrigir a situação atual.  Começarei não com o caso mais comum, mas com bastante frequência - Deep Links. <br><img src="https://habrastorage.org/getpro/habr/post_images/28d/92d/505/28d92d5054ae40ababa4463ca68e7632.png" alt="imagem"><br><a name="habracut"></a><br>  Recentemente, tive a tarefa de iniciar um aplicativo Flutter usando links diretos.  Eu tive que vasculhar a documentação e experimentar para ter uma idéia adequada de como trabalhar com eles no Flutter.  Neste artigo, agreguei os resultados, para que aqueles que enfrentam a mesma tarefa fiquem mais fáceis de entender. <br><br>  Links diretos são URLs que permitem aos usuários navegar para conteúdo específico em um aplicativo móvel no iOS ou Android.  Isso significa que devemos rastrear como o aplicativo foi aberto: da maneira padrão ou usando um link e, além disso, o aplicativo já pode estar aberto quando a transição foi concluída.  Portanto, precisamos rastrear os cliques e o plano de fundo de um aplicativo em execução.  Vamos ver a melhor maneira de fazer isso no Flutter. <br><br><h3>  A primeira coisa é configuração </h3><br>  Para usar os Deep Links no desenvolvimento nativo, você precisa preparar a configuração apropriada no projeto.  Para um aplicativo Flutter, isso é feito exatamente da mesma maneira que no nativo. <br><br><h4>  iOS </h4><br>  Existem duas maneiras de criar esses links no ecossistema da Apple: "Esquemas de URL personalizados" e "Links universais". <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Esquemas de URL personalizados</a> - permitem usar um esquema personalizado, independentemente do host especificado.  Essa abordagem é a mais simples, mas existem nuances: você deve ter certeza de que o esquema é único e, além disso, o link não funcionará sem um aplicativo instalado.  Se você usar esquemas de URL personalizados, poderá usar links como: <code>your_scheme://any_host</code> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Universal Links</a> é uma abordagem um pouco mais complexa.  Eles permitem que você trabalhe apenas com o esquema https e com um host específico, mas é necessário confirmar os direitos de uso desse host, para os quais você precisa colocar o arquivo no servidor - apple-app-site-association.  O Universal Links oferece a você a oportunidade de executar o aplicativo no URL: <code>https://your_host</code> e, na ausência de um aplicativo instalado, oferecerá instalá-lo na loja ou abrir o link em um navegador. <br></li></ul><br>  Por exemplo, eu uso a abordagem de esquemas de URL personalizados, pois é mais simples.  Adicione a seguinte peça ao arquivo Info.plist: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleURLTypes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleTypeRole<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Editor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleURLName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>deeplink.flutter.dev<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>CFBundleURLSchemes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>poc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  Android </h4><br>  O ecossistema do Android também tem duas maneiras de vincular aproximadamente as mesmas propriedades: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Links diretos</a> - (assim como os esquemas de URL personalizado no iOS) permitem que você use um esquema personalizado, independentemente do host especificado. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">App Links</a> - eles permitem que você trabalhe apenas com o esquema https e com um host específico (assim como o Universal Links no iOS) e também precisa confirmar os direitos de uso desse host colocando um arquivo JSON no servidor Digital Asset Links. <br></li></ul><br>  Para o Android, também decidi não complicá-lo e usei o Deep Links.  Adicione isso ao AndroidManifest.xml: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.VIEW"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.BROWSABLE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"poc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:host</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"deeplink.flutter.dev"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Assim, configuramos aplicativos para ambas as plataformas para esquemas de <code>poc</code> e poderemos processar o URL <code>poc://deeplink.flutter.dev</code> neles <code>poc://deeplink.flutter.dev</code> <br><br><h3>  Canais da plataforma de cozinha </h3><br>  Portanto, a configuração nativa para cada plataforma está pronta.  Além da configuração, você precisa preparar os Canais da Plataforma, graças aos quais a parte nativa irá interagir com o Flutter.  E, novamente, você precisa preparar sua implementação para Android e iOS. <br>  Vamos começar com o Android.  Você só precisa fazer nada - apenas processe a intenção de entrada no método onCreate, crie um MethodChannel e passe o URI a ele se o aplicativo estiver sendo executado através do Deep Link. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CHANNEL = <span class="hljs-string"><span class="hljs-string">"poc.deeplink.flutter.dev/channel"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); GeneratedPluginRegistrant.registerWith(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); Intent intent = getIntent(); Uri data = intent.getData(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodChannel(getFlutterView(), CHANNEL).setMethodCallHandler( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodChannel.MethodCallHandler() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMethodCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodCall call, MethodChannel.Result result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (call.method.equals(<span class="hljs-string"><span class="hljs-string">"initialLink"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (startString != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { result.success(startString); } } } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { startString = data.toString(); } }</code> </pre> <br>  No iOS, tudo será um pouco diferente, embora em geral a mesma coisa: passar o URI para o aplicativo através do MethodChannel.  Decidi implementá-lo no Swift, já que com o Objecttive-C as coisas não são muito boas para mim)).  Em seguida, é o AppDelegate.swift modificado <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlutterAppDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methodChannel: <span class="hljs-type"><span class="hljs-type">FlutterMethodChannel?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]? )</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = window.rootViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">FlutterViewController</span></span> methodChannel = <span class="hljs-type"><span class="hljs-type">FlutterMethodChannel</span></span>(name: <span class="hljs-string"><span class="hljs-string">"poc.deeplink.flutter.dev/channel"</span></span>, binaryMessenger: controller) methodChannel?.setMethodCallHandler({ (call: <span class="hljs-type"><span class="hljs-type">FlutterMethodCall</span></span>, result: <span class="hljs-type"><span class="hljs-type">FlutterResult</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> call.method == <span class="hljs-string"><span class="hljs-string">"initialLink"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { result(<span class="hljs-type"><span class="hljs-type">FlutterMethodNotImplemented</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } }) <span class="hljs-type"><span class="hljs-type">GeneratedPluginRegistrant</span></span>.register(with: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.application(application, didFinishLaunchingWithOptions: launchOptions) }</code> </pre><br>  Portanto, lidaremos com o lançamento do aplicativo através do Deep Link.  Mas e se o link seguisse quando o aplicativo já estava em execução?  É necessário levar em consideração esse momento. <br><br>  No Android, para isso, substituiremos o método onNewIntent e processaremos cada intenção recebida.  Se for um clique no link, lançaremos um evento no EventChannel criado para isso por meio de um BroadcastReceiver especialmente criado. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String EVENTS = <span class="hljs-string"><span class="hljs-string">"poc.deeplink.flutter.dev/events"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BroadcastReceiver linksReceiver; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); GeneratedPluginRegistrant.registerWith(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventChannel(getFlutterView(), EVENTS).setStreamHandler( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventChannel.StreamHandler() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onListen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object args, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EventChannel.EventSink events)</span></span></span><span class="hljs-function"> </span></span>{ linksReceiver = createChangeReceiver(events); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object args)</span></span></span><span class="hljs-function"> </span></span>{ linksReceiver = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } ); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onNewIntent(intent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(intent.getAction() == android.content.Intent.ACTION_VIEW &amp;&amp; linksReceiver != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { linksReceiver.onReceive(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getApplicationContext(), intent); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> BroadcastReceiver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createChangeReceiver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EventChannel.EventSink events)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> assuming intent.getAction() is Intent.ACTION_VIEW String dataString = intent.getDataString(); if (dataString == null) { events.error("UNAVAILABLE", "Link unavailable", null); } else { events.success(dataString); } ; } }; } }</span></span></code> </pre> <br>  Vamos fazer o mesmo na parte do iOS.  No Swift, precisamos criar um FlutterStreamHandler e processar qualquer link que recebermos enquanto o aplicativo estiver em segundo plano.  É hora de mudar AppDelegate.swift um pouco novamente <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlutterAppDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventChannel: <span class="hljs-type"><span class="hljs-type">FlutterEventChannel?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> linkStreamHandler = <span class="hljs-type"><span class="hljs-type">LinkStreamHandler</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]? )</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = window.rootViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">FlutterViewController</span></span> eventChannel = <span class="hljs-type"><span class="hljs-type">FlutterEventChannel</span></span>(name: <span class="hljs-string"><span class="hljs-string">"poc.deeplink.flutter.dev/events"</span></span>, binaryMessenger: controller) <span class="hljs-type"><span class="hljs-type">GeneratedPluginRegistrant</span></span>.register(with: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) eventChannel?.setStreamHandler(linkStreamHandler) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.application(application, didFinishLaunchingWithOptions: launchOptions) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> app: UIApplication, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">open</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url: URL, options: [UIApplicationOpenURLOptionsKey : </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">] = [:])</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { eventChannel?.setStreamHandler(linkStreamHandler) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linkStreamHandler.handleLink(url.absoluteString) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkStreamHandler</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlutterStreamHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventSink: <span class="hljs-type"><span class="hljs-type">FlutterEventSink?</span></span> <span class="hljs-comment"><span class="hljs-comment">// links will be added to this queue until the sink is ready to process them var queuedLinks = [String]() func onListen(withArguments arguments: Any?, eventSink events: @escaping FlutterEventSink) -&gt; FlutterError? { self.eventSink = events queuedLinks.forEach({ events($0) }) queuedLinks.removeAll() return nil } func onCancel(withArguments arguments: Any?) -&gt; FlutterError? { self.eventSink = nil return nil } func handleLink(_ link: String) -&gt; Bool { guard let eventSink = eventSink else { queuedLinks.append(link) return false } eventSink(link) return true } }</span></span></code> </pre> <br>  Quando combinamos as duas partes: a parte para iniciar o aplicativo e a parte para o aplicativo em segundo plano - controlaremos todos os cliques do usuário nos Links diretos. <br><br><h3>  Processando links diretos no Flutter </h3><br>  A parte da plataforma está pronta para isso, é hora de passar para a parte Flutter.  Como você provavelmente sabe, é possível criar aplicativos no flutter usando diferentes abordagens arquiteturais.  Muitos artigos já foram escritos sobre esse tópico ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por exemplo, este</a> ), mas, pessoalmente, parece-me que o BLoC puro é a abordagem mais adequada.  Portanto, prepararei um BLoC separado que manipulará esses links.  Como resultado, obtemos um código absolutamente não vinculado à interface do usuário e que pode lidar com o recebimento de links sempre que conveniente. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeepLinkBloc</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bloc</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Event Channel creation static const stream = const EventChannel('poc.deeplink.flutter.dev/events'); //Method channel creation static const platform = const MethodChannel('poc.deeplink.flutter.dev/channel'); StreamController&lt;String&gt; _stateController = StreamController(); Stream&lt;String&gt; get state =&gt; _stateController.stream; Sink&lt;String&gt; get stateSink =&gt; _stateController.sink; //Adding the listener into contructor DeepLinkBloc() { //Checking application start by deep link startUri().then(_onRedirected); //Checking broadcast stream, if deep link was clicked in opened appication stream.receiveBroadcastStream().listen((d) =&gt; _onRedirected(d)); } _onRedirected(String uri) { // Here can be any uri analysis, checking tokens etc, if it's necessary // Throw deep link URI into the BloC's stream stateSink.add(uri); } @override void dispose() { _stateController.close(); } Future&lt;String&gt; startUri() async { try { return platform.invokeMethod('initialLink'); } on PlatformException catch (e) { return "Failed to Invoke: '${e.message}'."; } } }</span></span></code> </pre> <br>  Especialmente para aqueles que não tinham experiência anterior com BLoC e StreamBuilders, prepararei um exemplo de widget que funcionará com este BLoC.  O widget é baseado no StreamBuilder, que reconstrói a interface do usuário dependendo dos eventos recebidos do fluxo. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PocWidget</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatelessWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-function">Widget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BuildContext context)</span></span></span><span class="hljs-function"> </span></span>{ DeepLinkBloc _bloc = Provider.of&lt;DeepLinkBloc&gt;(context); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StreamBuilder&lt;String&gt;( stream: _bloc.state, builder: (context, snapshot) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!snapshot.hasData) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Container( child: Center( child: Text(<span class="hljs-string"><span class="hljs-string">'No deep link was used '</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Container( child: Center( child: Padding( padding: EdgeInsets.all(<span class="hljs-number"><span class="hljs-number">20.0</span></span>), child: Text(<span class="hljs-string"><span class="hljs-string">'Redirected: ${snapshot.data}'</span></span>)))); } }, ); } }</code> </pre> <br>  Tadam!  Isso é tudo.  Agora tudo funciona! <br><br>  Para testar, execute o aplicativo de três maneiras diferentes.  Manualmente e por meio do Deep Links, primeiro com o URI <code>poc://deeplink.flutter.dev</code> e, em seguida, com <code>poc://deeplink.flutter.dev/parameter</code> .  Aqui estão as capturas de tela do que aconteceu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/429/1a8/c10/4291a8c100fbc77a0e6cba5910ae9fca.png" alt="imagem"><br><br>  Existem outras maneiras de trabalhar com o Deep Links.  Por exemplo, você pode usar os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Links dinâmicos do Firebase</a> para isso.  Há <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um excelente artigo</a> sobre como usá-los com o Flutter.  Também existe uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">biblioteca 'uni-links'</a> pronta para conectar o Deep Links - você pode usá-lo.  E se você não quiser depender de bibliotecas de terceiros, sempre poderá implementar suas próprias.  Espero que meu artigo o ajude com isso! <br><br><h3>  Código fonte </h3><br>  O código fonte do exemplo acima pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">visto aqui</a> . <br><br><h3>  Algumas informações úteis </h3><br>  Se você leu o artigo até este ponto, provavelmente está interessado no desenvolvimento do Flutter).  Quero falar sobre vários recursos que podem ser úteis para você.  Há pouco tempo, foi criado um par de podcasts de língua russa diretamente relacionados ao desenvolvimento do Flutter.  Eu recomendo assinar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Flutter Dev Podcast</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal de telegrama</a> ), onde discutimos os problemas mais graves do desenvolvimento do Flutter, e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mobile People Talks</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal de telegrama</a> ), onde discutimos os problemas do desenvolvimento móvel em princípio, sob diferentes pontos de vista.  As principais palestras sobre celular são iOS, Android, ReactNative e Flutter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3e/9ec/3f1/c3e9ec3f1258cdf6656a156db6841ca3.png" alt="imagem"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461239/">https://habr.com/ru/post/pt461239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461223/index.html">Resumo de IaaS: alto desempenho, armazenamento de dados e novas tecnologias para data centers</a></li>
<li><a href="../pt461225/index.html">Como chegar ao Pólo Norte a partir da base à deriva de Barneo</a></li>
<li><a href="../pt461227/index.html">O Embarcadero RAD Studio 10.3.2 saiu ou o que está morto ... morreu</a></li>
<li><a href="../pt461229/index.html">Helsinque Como encontrar um emprego na indústria finlandesa de jogos, começar a trabalhar sem permissão e não violar as leis russas</a></li>
<li><a href="../pt461231/index.html">E que diferença a Collation escolhe?</a></li>
<li><a href="../pt461241/index.html">Wolfram Mathematica em Geofísica</a></li>
<li><a href="../pt461243/index.html">Não vá passear na África: qual é a situação da censura na Internet no continente negro</a></li>
<li><a href="../pt461247/index.html">50 Melhores Fontes em Gerenciamento de Produtos para Ler, Ouvir e Assistir</a></li>
<li><a href="../pt461249/index.html">Escrevendo um aplicativo Android para fãs de filmes - Parte 2 (Design)</a></li>
<li><a href="../pt461251/index.html">Uma seleção de slides úteis de Julia Evans</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>