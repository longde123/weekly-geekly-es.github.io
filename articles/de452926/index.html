<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï§ üó°Ô∏è ‚õîÔ∏è Statische Tests oder Private Ryan speichern üõµ üéà üí≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine Ver√∂ffentlichung schleicht sich oft unbemerkt ein. Und jeder Fehler, der pl√∂tzlich vor ihm entdeckt wurde, droht uns mit einer Verschiebung der F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Statische Tests oder Private Ryan speichern</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/452926/">  Eine Ver√∂ffentlichung schleicht sich oft unbemerkt ein.  Und jeder Fehler, der pl√∂tzlich vor ihm entdeckt wurde, droht uns mit einer Verschiebung der Fristen, Hotfixes, der Arbeit bis zum Morgen und der verbrauchten Nerven.  Als ein solcher Ansturm systematisch begann, wurde uns klar, dass man so nicht mehr leben kann.  Es wurde beschlossen, ein umfassendes Validierungssystem zu entwickeln, um den <s>gew√∂hnlichen Ryan-</s> Entwickler Artyom zu retten, der vor der Ver√∂ffentlichung um 21 Uhr, um 10 Uhr oder um 11 Uhr nach Hause ging.  Der Entwickler sollte sich √ºber den Fehler informieren, w√§hrend die √Ñnderungen das Repository noch nicht erreicht hatten und er selbst den Kontext der Aufgabe nicht verloren hatte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/050/6ad/e0c0506adfa607df0102904b82c0d96a.png"></div><br>  Heute werden die vorgenommenen √Ñnderungen zuerst lokal und dann mit einer Reihe von Integrationstests in der Assemblyfarm sorgf√§ltig √ºberpr√ºft.  In diesem Artikel werden wir √ºber die erste Stufe der √úberpr√ºfung sprechen - statische Tests, die die Richtigkeit der Ressourcen √ºberwachen und den Code analysieren.  Dies ist das erste Subsystem in der Kette und macht den Gro√üteil der gefundenen Fehler aus. <br><a name="habracut"></a><br><h2>  Wie alles begann </h2><br>  Der manuelle Prozess der √úberpr√ºfung des Spiels vor der Ver√∂ffentlichung begann anderthalb Wochen vor der Ver√∂ffentlichung in der Qualit√§tssicherung.  Nat√ºrlich m√ºssen Fehler, die sich in diesem Stadium befinden, so schnell wie m√∂glich behoben werden. <br><br>  Aufgrund des Zeitmangels f√ºr eine gute L√∂sung wird eine tempor√§re ‚ÄûKr√ºcke‚Äú hinzugef√ºgt, die dann lange Wurzeln schl√§gt und von anderen nicht sehr beliebten L√∂sungen umgeben ist. <br><br>  Zun√§chst haben wir uns entschlossen, das Auffinden offener Fehler zu automatisieren: Abst√ºrze, Unf√§higkeit, die wichtigsten Aktionen f√ºr das Spiel auszuf√ºhren (ein Gesch√§ft er√∂ffnen, einen Kauf t√§tigen, ein Level spielen).  Zu diesem Zweck startet das Spiel in einem speziellen Autogame-Modus. Wenn etwas schief gelaufen ist, werden wir es sofort nach dem Bestehen des Tests auf unserer Farm erfahren. <br><br>  Die meisten Fehler, die sowohl Tester als auch unser automatisierter Rauchtest feststellten, waren das Fehlen einer Ressource oder falsche Einstellungen verschiedener Systeme.  Daher war der n√§chste Schritt das <i>statische Testen</i> - √úberpr√ºfen der Verf√ºgbarkeit von Ressourcen, ihrer Beziehungen und Einstellungen, ohne die Anwendung zu starten.  Dieses System wurde durch einen zus√§tzlichen Schritt in der Baugruppenfarm gestartet und vereinfachte das Auffinden und Beheben von Fehlern erheblich.  Aber warum sollten Sie die Ressourcen der Assemblyfarm verschwenden, wenn Sie einen Fehler erkennen k√∂nnen, bevor Sie den Problemcode festschreiben und in das Repository √ºbertragen?  Dies kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mit Precommit-Hooks erfolgen</a> , die gerade gestartet werden, bevor das Commit erstellt und an das Repository gesendet wird. <br><br>  Und ja, wir sind so cool, dass statische Tests vor dem Festschreiben und in der Assemblyfarm von einem Code ausgef√ºhrt werden, was die Unterst√ºtzung erheblich vereinfacht. <br><br>  Unsere Bem√ºhungen k√∂nnen in drei Bereiche unterteilt werden: <br><br><ul><li>  Schaffung einer Montagefarm - genau dort, wo alles, was gesammelt und gepr√ºft wurde, gesammelt wird; </li><li>  Entwicklung statischer Tests - √úberpr√ºfung der Richtigkeit von Ressourcen, ihrer Beziehungen, Starten von Code-Analysatoren; </li><li>  Entwicklung von Laufzeit-Tests - Starten der Anwendung im Auto-Play-Modus. </li></ul><br>  Eine separate Aufgabe bestand darin, den Start der Tests auf dem Computer durch den Entwickler zu organisieren.  Es war notwendig, die Ausf√ºhrungszeit lokal zu minimieren (der Entwickler muss nicht 10 Minuten warten, um eine Zeile festzuschreiben) und sicherzustellen, dass auf jedem System, das die √Ñnderungen vornimmt, unser System installiert ist. <br><br><h2>  Viele Anforderungen - ein System </h2><br>  W√§hrend der Entwicklung gibt es eine ganze Reihe von Baugruppen, die sich als n√ºtzlich erweisen k√∂nnen: mit und ohne Cheats, Beta oder Alpha, iOS oder Android.  In jedem Fall k√∂nnen unterschiedliche Ressourcen, Einstellungen oder sogar unterschiedlicher Code erforderlich sein.  Das Schreiben von Skripten f√ºr statische Tests f√ºr jede m√∂gliche Baugruppe f√ºhrt zu einem komplizierten System mit vielen Parametern.  Jedes Projekt ist nicht nur schwierig zu warten und zu modifizieren, sondern verf√ºgt auch √ºber einen eigenen Satz Kr√ºckenr√§der. <br><br>  Durch Versuch und Irrtum kamen wir zu einem System, bei dem jeder Test den Startkontext ber√ºcksichtigen und entscheiden kann, ob er ausgef√ºhrt werden soll, was genau und wie zu √ºberpr√ºfen ist.  Zu Beginn der Tests haben wir drei Haupteigenschaften identifiziert: <br><br><ul><li>  Art der Baugruppe: Bei der Freigabe und beim Debuggen von Ressourcen unterscheiden sich die √úberpr√ºfungen in Bezug auf Genauigkeit, Vollst√§ndigkeit der Abdeckung sowie Einstellungen f√ºr Kennungen und √úberpr√ºfung der verf√ºgbaren Funktionalit√§t. </li><li>  Plattform: Was f√ºr Android g√ºltig ist, kann f√ºr iOS falsch sein, Ressourcen werden auch anders gesammelt und nicht alle Ressourcen in der Android-Version werden in iOS sein und umgekehrt; </li><li>  Startort: ‚Äã‚ÄãWo genau starten wir - auf dem Build-Agenten, auf dem alle verf√ºgbaren Tests ben√∂tigt werden, oder auf dem Computer des Benutzers, auf dem die Liste der Starts minimiert werden muss. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/9b4/a61/e869b4a61b7f46ba9d545058baa4af5a.png"></div><br><h2>  Statisches Testsystem </h2><br>  Der Kern des Systems und die grundlegenden statischen Tests sind in Python implementiert.  Die Basis sind nur wenige Entit√§ten: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d09/e44/1fd/d09e441fd62385fb616c3875cdc67a4d.png"></div><br>  <i>Das Testen des Kontexts</i> ist ein umfangreiches Konzept.  Es speichert sowohl die Build- und Startparameter, √ºber die wir oben gesprochen haben, als auch die Metainformationen, die die Tests f√ºllen und verwenden. <br><br>  Zuerst m√ºssen Sie verstehen, welche Tests ausgef√ºhrt werden sollen.  Zu diesem Zweck enthalten die Metainformationen die Arten von Ressourcen, an denen wir speziell f√ºr diesen Start interessiert sind.  Ressourcentypen werden durch im System registrierte Tests bestimmt.  Ein Test kann einem oder mehreren Typen zugeordnet werden. Wenn zum Zeitpunkt des Festschreibens festgestellt wird, dass sich die von diesem Test √ºberpr√ºften Dateien ge√§ndert haben, hat sich die zugeordnete Ressource ge√§ndert.  Dies passt bequem zu unserer Ideologie - so wenige Pr√ºfungen wie m√∂glich lokal auszuf√ºhren: Wenn sich die Dateien, f√ºr die der Test verantwortlich ist, nicht ge√§ndert haben, m√ºssen Sie sie nicht ausf√ºhren. <br><br>  Beispielsweise gibt es eine Beschreibung des Fisches, in der das 3D-Modell und die Textur angegeben sind. Wenn sich die Beschreibungsdatei ge√§ndert hat, wird √ºberpr√ºft, ob das darin angegebene Modell und die Textur vorhanden sind.  In anderen F√§llen muss kein Fischcheck durchgef√ºhrt werden. <br><br>  Andererseits kann das √Ñndern einer Ressource √Ñnderungen und Entit√§ten erfordern, die davon abh√§ngen: Wenn sich der Satz von Texturen, die wir in XML-Dateien speichern, ge√§ndert hat, m√ºssen zus√§tzliche 3D-Modelle √ºberpr√ºft werden, da sich m√∂glicherweise herausstellt, dass die ben√∂tigte Textur entfernt wird.  Die oben beschriebenen Optimierungen werden zum Zeitpunkt des Festschreibens nur lokal auf dem Computer des Benutzers angewendet. Beim Start in der Assemblyfarm wird davon ausgegangen, dass sich alle Dateien ge√§ndert haben, und wir f√ºhren alle Tests aus. <br><br>  Das n√§chste Problem ist die Abh√§ngigkeit einiger Tests von anderen: Es ist unm√∂glich, den Fisch zu √ºberpr√ºfen, bevor alle Texturen und Modelle gefunden wurden.  Daher haben wir die gesamte Ausf√ºhrung in zwei Phasen unterteilt: <br><br><ul><li>  Kontextvorbereitung </li><li>  √úberpr√ºfung </li></ul><br>  In der ersten Phase wird der Kontext mit Informationen √ºber die gefundenen Ressourcen gef√ºllt (im Fall von Fischen mit Kennungen von Mustern und Texturen).  √úberpr√ºfen Sie in der zweiten Phase anhand der gespeicherten Informationen einfach, ob die gew√ºnschte Ressource vorhanden ist.  Ein vereinfachter Kontext wird unten dargestellt. <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationContext</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, app_path, build_type, platform, changed_files=None)</span></span></span><span class="hljs-function">:</span></span>       self.__app_path = app_path       self.__build_type = build_type       self.__platform = platform       <span class="hljs-comment"><span class="hljs-comment">#          self.__modified_resources = set()       self.__expected_resources = set()       #      ,              self.__changed_files = changed_files       # -  ,          self.__resources = {} def expect_resources(self, resources):   self.__expected_resources.update(resources) def is_resource_expected(self, resource):   return resource in self.__expected_resources def register_resource(self, resource_type, resource_id, resource_data=None):   self.__resources.setdefault(resource_type, {})[resource_id] = resource_data def get_resource(self, resource_type, resource_id):   if resource_type not in self.__resources or resource_id not in self.__resources[resource_type]:       return None, None   return resource_id, self.__resources[resource_type][resource_id]</span></span></code> </pre> <br>  Nachdem wir alle Parameter ermittelt hatten, die sich auf den Start des Tests auswirken, konnten wir die gesamte Logik in der Basisklasse ausblenden.  In einem bestimmten Test m√ºssen nur der Test selbst und die erforderlichen Werte f√ºr die Parameter geschrieben werden. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, context, build_types=None, platforms=None, predicate=None,               expected_resources=None, modified_resources=None)</span></span></span><span class="hljs-function">:</span></span>      self.__name = name      self.__context = context      self.__build_types = build_types      self.__platforms = platforms      self.__predicate = predicate      self.__expected_resources = expected_resources      self.__modified_resources = modified_resources      <span class="hljs-comment"><span class="hljs-comment">#               #   ,          self.__need_run = self.__check_run()      self.__need_resource_run = False  @property  def context(self):      return self.__context  def fail(self, message):      print('Fail: {}'.format(message))  def __check_run(self):      build_success = self.__build_types is None or self.__context.build_type in self.__build_types      platform_success = self.__platforms is None or self.__context.platform in self.__platforms      hook_success = build_success      if build_success and self.__context.is_build('hook') and self.__predicate:          hook_success = any(self.__predicate(changed_file) for changed_file in self.__context.changed_files)      return build_success and platform_success and hook_success  def __set_context_resources(self):      if not self.__need_run:          return      if self.__modified_resources:          self.__context.modify_resources(self.__modified_resources)      if self.__expected_resources:          self.__context.expect_resources(self.__expected_resources)   def init(self):      """        ,                    ,          """      self.__need_resource_run = self.__modified_resources and any(self.__context.is_resource_expected(resource) for resource in self.__modified_resources)  def _prepare_impl(self):      pass  def prepare(self):      if not self.__need_run and not self.__need_resource_run:          return      self._prepare_impl()  def _run_impl(self):      pass  def run(self):      if self.__need_run:          self._run_impl()</span></span></code> </pre> <br>  Um auf das Fischbeispiel zur√ºckzukommen, ben√∂tigen wir zwei Tests, von denen einer Texturen findet und im Kontext registriert, der andere nach Texturen f√ºr die gefundenen Modelle sucht. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyTexture</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyTexture, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyTexture'</span></span>, context,                                          build_types=[<span class="hljs-string"><span class="hljs-string">'production'</span></span>, <span class="hljs-string"><span class="hljs-string">'hook'</span></span>],                                          platforms=[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span>],                                          expected_resources=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>,                                          modified_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                          predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.png'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepare_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      texture_dir = os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'textures'</span></span>)      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(texture_dir):          <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tex_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files:              self.context.register_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, tex_file) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyModels</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyModels, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyModels'</span></span>, context,                                         expected_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                         predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.obj'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_run_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      models_descriptions = etree.parse(os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'models.xml'</span></span>))      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> model_xml <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> models_descriptions.findall(<span class="hljs-string"><span class="hljs-string">'.//Model'</span></span>):          texture_id = model_xml.get(<span class="hljs-string"><span class="hljs-string">'texture'</span></span>)          texture = self.context.get_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, texture_id)          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> texture <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>:              self.fail(<span class="hljs-string"><span class="hljs-string">'Texture for model {} was not found: {}'</span></span>.format(model_xml.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>), texture_id))</code> </pre> <br><h2>  Projektverbreitung </h2><br>  Die Spieleentwicklung in Playrix erfolgt auf einer eigenen Engine. Dementsprechend haben alle Projekte eine √§hnliche Dateistruktur und einen √§hnlichen Code nach denselben Regeln.  Daher gibt es viele allgemeine Tests, die einmal geschrieben wurden und im allgemeinen Code enthalten sind.  F√ºr Projekte reicht es aus, die Version des Testsystems zu aktualisieren und einen neuen Test mit sich selbst zu verbinden. <br><br>  Um die Integration zu vereinfachen, haben wir einen Runner geschrieben, der die Konfigurationsdatei und die Designtests (dazu sp√§ter) erh√§lt.  Die Konfigurationsdatei enth√§lt grundlegende Informationen, √ºber die wir oben geschrieben haben: Art der Baugruppe, Plattform, Pfad zum Projekt. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runner</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config_str, setup_function)</span></span></span><span class="hljs-function">:</span></span>      self.__tests = []      config_parser = RawConfigParser()      config_parser.read_string(config_str)      app_path = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'app_path'</span></span>)      build_type = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'build_type'</span></span>)      platform = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'platform'</span></span>)      <span class="hljs-string"><span class="hljs-string">'''      get_changed_files         CVS      '''</span></span>      changed_files = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> build_type != <span class="hljs-string"><span class="hljs-string">'hook'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> get_changed_files()      self.__context = VerificationContext(app_path, build_type, platform, changed_files)      setup_function(self)  @property  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__context  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, test)</span></span></span><span class="hljs-function">:</span></span>      self.__tests.append(test)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.init()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.prepare()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.run()</code> </pre> <br>  Das Sch√∂ne an der Konfigurationsdatei ist, dass sie in der Assemblyfarm f√ºr verschiedene Assemblys im automatischen Modus generiert werden kann.  Das √úbergeben von Einstellungen f√ºr alle Tests durch diese Datei ist jedoch m√∂glicherweise nicht sehr praktisch.  Zu diesem Zweck gibt es eine spezielle Konfigurations-XML, die im Projekt-Repository gespeichert ist und in die Listen ignorierter Dateien, Masken f√ºr die Suche im Code usw. geschrieben sind. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel f√ºr eine Konfigurationsdatei</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[main] app_path = {app_path} build_type = production platform = ios</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">XML-Beispiel optimieren</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8Bom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofix_path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ci/autofix"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span>*android/tmp/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NsStringConversion"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LogConstructions"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  Zus√§tzlich zum allgemeinen Teil weisen Projekte ihre eigenen Besonderheiten und Unterschiede auf. Daher gibt es eine Reihe von Projekttests, die √ºber die Konfiguration des L√§ufers mit dem System verbunden sind.  F√ºr den Code in den Beispielen reichen ein paar Zeilen aus, um ausgef√ºhrt zu werden: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(runner)</span></span></span><span class="hljs-function">:</span></span>  runner.add_test(VerifyTexture(runner.context))  runner.add_test(VerifyModels(runner.context)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>  raw_config = <span class="hljs-string"><span class="hljs-string">'''  [main]  app_path = {app_path}  build_type = production  platform = ios  '''</span></span>  runner = Runner(raw_config, setup)  runner.run()</code> </pre> <br><h2>  Gesammelter Rechen </h2><br>  Obwohl Python selbst plattform√ºbergreifend ist, hatten wir regelm√§√üig Probleme mit der Tatsache, dass Benutzer ihre eigene einzigartige Umgebung haben, in der sie m√∂glicherweise nicht die erwartete Version, mehrere Versionen oder √ºberhaupt keinen Interpreter haben.  Infolgedessen funktioniert es nicht wie erwartet oder √ºberhaupt nicht.  Es gab mehrere Iterationen, um dieses Problem zu l√∂sen: <br><br><ol><li>  Python und alle Pakete werden vom Benutzer installiert.  Es gibt jedoch zwei ‚ÄûAber‚Äú: Nicht alle Benutzer sind Programmierer, und die Installation √ºber Pip Install f√ºr Designer und auch f√ºr Programmierer kann ein Problem sein. </li><li>  Es gibt ein Skript, das alle erforderlichen Pakete installiert.  Dies ist bereits besser, aber wenn der Benutzer die falsche Python installiert hat, k√∂nnen Konflikte in der Arbeit auftreten. </li><li>  Bereitstellung der richtigen Version des Interpreters und der Abh√§ngigkeiten aus dem Artefaktspeicher (Nexus) und Ausf√ºhren von Tests in einer virtuellen Umgebung. </li></ol><br>  Ein weiteres Problem ist die Leistung.  Je mehr Tests durchgef√ºhrt werden, desto l√§nger wird die √Ñnderung auf dem Computer des Benutzers √ºberpr√ºft.  Alle paar Monate werden Engp√§sse profiliert und optimiert.  So wurde der Kontext verbessert, ein Cache f√ºr Textdateien wurde angezeigt, Pr√§dikatmechanismen wurden verbessert (um festzustellen, dass diese Datei f√ºr den Test interessant ist). <br><br>  Und dann bleibt nur noch das Problem zu l√∂sen, wie das System in allen Projekten implementiert und alle Entwickler gezwungen werden, gebrauchte Hooks einzuschlie√üen, aber das ist eine ganz andere Geschichte ... <br><br><h2>  Fazit </h2><br>  W√§hrend des Entwicklungsprozesses haben wir auf dem Rechen getanzt, hart gek√§mpft, aber dennoch ein System erhalten, mit dem wir Fehler w√§hrend des Festschreibens finden, die Arbeit der Tester reduzieren konnten und die Aufgaben vor der Ver√∂ffentlichung bez√ºglich der fehlenden Textur der Vergangenheit angeh√∂rten.  F√ºr ein vollkommenes Gl√ºck reichen eine einfache Einrichtung der Umgebung und die Optimierung einzelner Tests nicht aus, aber Golems aus der ci-Abteilung arbeiten hart daran. <br><br>  Ein vollst√§ndiges Beispiel f√ºr den Code, der als Beispiele im Artikel verwendet wird, finden Sie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserem Repository</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de452926/">https://habr.com/ru/post/de452926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de452910/index.html">Hallo Habr! Hallo Tercon</a></li>
<li><a href="../de452914/index.html">ML auf der Scala mit einem L√§cheln f√ºr diejenigen, die keine Angst vor Experimenten haben</a></li>
<li><a href="../de452916/index.html">Steh auf und geh. Wirbels√§ulenchirurgie: Wann, was ist gef√§hrlich?</a></li>
<li><a href="../de452922/index.html">Flexible CSS-Rastertabellen</a></li>
<li><a href="../de452924/index.html">Was Sie tun m√ºssen, um zu verhindern, dass Ihr Google-Konto gestohlen wird</a></li>
<li><a href="../de452928/index.html">Wir stellen virtuelle Maschinen aus dem f√§lschlicherweise initialisierten Datenspeicher wieder her. Die Geschichte eines Unsinns mit Happy End</a></li>
<li><a href="../de452938/index.html">Die Pistolen vom 3D-Drucker sind zur√ºck und k√∂nnen jetzt nicht mehr gestoppt werden</a></li>
<li><a href="../de452942/index.html">GeekBrains h√§lt 12 kostenlose Online-Meetings mit Programmierexperten ab</a></li>
<li><a href="../de452944/index.html">Was wird der "Dialog" von Linguisten und Datenanalysespezialisten sein?</a></li>
<li><a href="../de452946/index.html">Lou Greenaws ‚ÄûWindows 95 / NT-Programmierphilosophie‚Äú erneut lesen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>