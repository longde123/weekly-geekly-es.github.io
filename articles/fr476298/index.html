<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍💼 🎴 👩‍👩‍👧‍👧 Parcourez les épines des vélos, première partie: découvrez les bases de la personnalisation du débogueur Visual Studio à l'aide de plugins 🕐 👨🏿‍🔧 🌀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'une des innovations de Visual Studio 2012 s'est accompagnée de l'apparition d'un nouveau débogueur personnalisé appelé Concord. Son système de compo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Parcourez les épines des vélos, première partie: découvrez les bases de la personnalisation du débogueur Visual Studio à l'aide de plugins</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476298/"><img src="https://habrastorage.org/webt/kl/8o/1x/kl8o1xvmgggvg_ssk6tb72xz6se.png" align="right">  L'une des innovations de Visual Studio 2012 s'est accompagnée de l'apparition d'un nouveau débogueur personnalisé appelé Concord.  Son système de composants permet aux plug-ins VSIX de personnaliser le comportement du débogueur et d'écrire de nouveaux outils contextuels qui peuvent utiliser le débogueur pour leurs besoins.  Son API fournit de nombreuses fonctionnalités QOL, telles que le marshaling entre le code managé / non managé, l'intégration transparente avec un processus distant / débogué localement, et plus encore.  En fait, presque tout ce qui peut être fait dans l'EDI peut être fait par programme en utilisant l'API Concord!  Modifiez les valeurs de variables spécifiques à la volée, appelez des fonctions sur demande (ou faites spécifiquement le programme leur sauter des appels!), Les plugins peuvent rechercher par PDB (!), Bypass étape par étape et même modification de code!  Ouvrez le chat et vous découvrirez ces innovations peu connues dans le domaine de la construction de vélos. <br><a name="habracut"></a><br>  Vous devriez probablement recommencer depuis le début.  Le débogueur détecte les composants en lisant les informations du fichier <i>vsdconfig</i> référencé par le manifeste du plugin VSIX.  À son tour, <i>vsdconfig</i> indique quelles interfaces sont implémentées par les composants du plugin et comment trouver ces composants (lien vers un fichier .dll, indiquant la classe ou, dans le cas de l'implémentation native, indiquant CLSID. Je donnerai des exemples en C #).  De plus, un identifiant unique (GUID) pour chaque composant est indiqué, ainsi que son "niveau".  Un niveau est ce qui détermine dans quel ordre les plugins seront traités, ainsi que dans le contexte de quel processus cette implémentation sera chargée - dans le processus IDE ou dans le processus de l'application déboguée.  Cela est dû au fait que certaines fonctionnalités ne peut fonctionner que dans le cadre de l'IDE, et vice versa - que dans le contexte du processus en cours de débogage.  Certaines fonctions API fonctionnent de la même manière ici et là.  En outre, un certain nombre de composants ont leurs propres règles de disposition, car ils peuvent dépendre des éléments de débogueur existants situés à leurs niveaux fixes.  Pour éviter les incidents, je recommande RTFM (https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.debugger.componentinterfaces?view=visualstudiosdk-2017) et des expériences indépendantes dans un bac à sable séparé, ce qui ne sera pas dommage. supprimer si quelque chose se produit (cela est connecté, encore une fois, avec une telle nuance - dans certains cas, il n'est même pas clair pourquoi l'assemblage ou le type ne se charge pas, car je ne pouvais toujours pas trouver où les journaux apparaîtraient qui signaleraient le problème de manière stable. Erreur, par exemple, en référence à une dépendance qui ne peut pas être chargée dans le processus cible, elle peut apparaître dans la sortie st  di-, ou non. Soyez akuratno, prenez commits fréquentes, <s>et ne restez pas assis derrière le volant ivre).</s> <br><br>  La liste des niveaux est la suivante (je donnerai le texte en anglais pour que le lecteur n'ait pas d'incidents lors de la réalisation d'actes RFTM): <br><br>  Niveaux des composants IDE (valeurs&gt; 100 000): <br><div class="scrollable-table"><table><tbody><tr><th>  Composant </th><th>  Niveau composant </th></tr><tr><td>  AD7 AL </td><td>  1 000 000 000 </td></tr><tr><td>  Fournisseur de démontage </td><td>  9,998,000 </td></tr><tr><td>  Requête de pile - Composants qui souhaitent interroger la pile d'appels </td><td>  9 997 000 </td></tr><tr><td>  Fournisseur de pile </td><td>  9,996,000 </td></tr><tr><td>  Filtre de pile - niveau où les piles peuvent être filtrées et annotées </td><td>  9 995 000 </td></tr><tr><td>  Gestionnaire de points d'arrêt </td><td>  9 994 000 </td></tr><tr><td>  Évaluation de l'expression IDE </td><td>  9 992 000 </td></tr><tr><td>  Marcheurs de pile de symboles - marcheurs de pile qui ont besoin d'accéder aux symboles </td><td>  9 991 000 </td></tr><tr><td>  IDE SymbolProvider - Composants qui fournissent des informations sur les symboles au reste du débogueur.  Le chemin du symbole ne doit pas être utilisé en dessous de ce niveau. </td><td>  1,999,000 </td></tr></tbody></table></div><br>  Niveaux de composants du processus cible (valeurs &lt;99,999): <br><div class="scrollable-table"><table><tbody><tr><th>  Composant </th><th>  Niveau composant </th></tr><tr><td>  Surveiller le fournisseur de symboles - Fournisseurs de symboles lorsque l'état symbolique est créé sur l'ordinateur cible (ex: interprète, code compilé / émis dynamiquement) </td><td>  75 000 </td></tr><tr><td>  Processeur de condition de point d'arrêt - Ce niveau est destiné au traitement des conditions de point d'arrêt telles que les expressions de condition et le nombre de résultats.  En dessous de ce point de tous les événements physiques des points d'arrêt seront visibles, peu importe si oui ou non ils ont des conditions fausses. </td><td>  70 000 </td></tr><tr><td>  Surveiller le fournisseur de tâches - Il s'agit du niveau d'exploration de données de tâches dans le processus cible </td><td>  65 500 </td></tr><tr><td>  Surveiller l'évaluateur d'expression </td><td>  65 000 </td></tr><tr><td>  Coordination du moniteur - Composants qui arbitrent entre les différents moniteurs pour les étapes, les points d'arrêt par adresse native, la marche de la pile, etc. </td><td>  60 000 </td></tr><tr><td>  Surveiller les marcheurs de pile </td><td>  55 000 </td></tr><tr><td>  Moniteur de débogage personnalisé - Réservé aux moniteurs de débogage tiers qui souhaitent utiliser les services fournis par les moniteurs de débogage standard. </td><td>  40 500 </td></tr><tr><td>  Moniteur de débogage d'exécution - Fournit une inspection des données et un contrôle d'exécution pour le code managé / natif / script </td><td>  40 000 </td></tr><tr><td>  Moniteur de débogage de base </td><td>  10 000 </td></tr><tr><td>  Services de moniteur de débogage de base - fournit des services utilitaires aux moniteurs de débogage de base (ex: création de processus) ainsi que des services de pré-débogage (ex: énumération de processus) </td><td>  1 000 </td></tr></tbody></table></div><br>  Ensuite, dans l'ordre, le processus de création d'un projet.  S'il n'y avait pas de nuances importantes, je pourrais décrire ce processus de manière minimale ou l'ignorer du tout, mais les réalités sont complètement différentes - nous avons besoin d'un certain nombre de dépendances de bibliothèque, ainsi que d'un outil pour créer des fichiers de configuration, qui pour une raison quelconque n'est pas distribué avec VisualStudio, mais est disponible uniquement avec pépite.  En fait, nous devons maintenant passer à l'essentiel.  Le processus de création et de configuration d'un projet est structuré comme suit: <br><br><ol><li>  Ouvrez Visual Studio.  Dans mon cas, 2017 Community Edition </li><li>  Projet VSIX ( <i>Visual C # -&gt;</i> onglet <i>Extensibilité</i> , ou via la recherche).  Appelons ça "HelloVSIX" </li><li>  Ajoutez un nouveau projet de bibliothèque de classes dans la solution et appelez-le «DebuggeePlugin» </li><li>  Nous mettons la référence sur le projet "DebuggeePlugin" dans le projet "HelloVSIX" </li><li>  Nous mettons la référence à l'assembly "Microsoft.VisualStudio.Debugger.Engine" dans le projet DebuggeePlugin </li><li>  Ajouter au projet «DebuggeePlugin» une référence à l'ensemble NuGet Microsoft.VSSDK.Debugger.VSDConfigTool.  Ceci est notre outil pour générer des configurations VSD. </li></ol><br>  Maintenant, nous sommes prêts à faire de notre plugin quelque chose d'utile.  Faisons la chose la plus simple que vous puissiez faire - laissez-le afficher un MessageBox qui dit "Bonjour VSIX" lorsque le processus cible rencontre un point d'entrée.  Pour ce faire, nous devons créer une classe qui implémente l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">IDkmEntryPointNotification</a> , ainsi que remplir plusieurs fichiers de configuration.  Ajoutez une nouvelle classe publique appelée DkmEntryPointNotificationService et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">héritez de l'</a> interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">IDkmEntryPointNotification</a> et laissez l'implémentation par défaut pour l'instant: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } } }</code> </pre> <br>  Ajoutez le fichier «DkmEntryPointNotificationService.vsdconfigxml» au projet «DebuggeePlugin».  Pour chaque classe déclarée qui doit recevoir des notifications via les implémentations des interfaces d'espace de noms Microsoft.VisualStudio.Debugger.ComponentInterfaces, vous devez disposer d'un tel fichier.  Soit dit en passant, il est possible d'implémenter plusieurs de ces interfaces à la fois dans une même classe.  Nous devons maintenant modifier l'action de génération de notre fichier ".vsdconfigxml".  Pour ce faire, vous devez éditer manuellement le fichier de projet (j'ai sérieusement).  Nous déchargeons le projet DebuggeePlugin et l'ouvrons avec l'éditeur de studio.  Nous devons trouver la balise XLM suivante: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">None</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DkmEntryPointNotificationService.vsdconfigxml"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  et déplacez cette balise vers votre propre ItemGroup, en changeant le type de None en VsdConfigXmlFiles: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VsdConfigXmlFiles</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DkmEntryPointNotificationService.vsdconfigxml"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Vous pouvez enregistrer et recharger le projet. <br><br>  Maintenant, allez dans les configs.  La première chose à faire: si «DebuggeePlugin» a ajouté le fichier de projet vsdconfig.xsd, alors il doit être retiré.  Nous allons le remplacer maintenant, car il est plus facile de travailler avec du texte brut.  Ouvrez DkmEntryPointNotificationService.vsdconfigxml et remplacez le texte par ce qui suit: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/vstudio/vsdconfig/2008"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ManagedComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ComponentId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"422413E1-450E-40A6-AE24-7E80A81CC668"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ComponentLevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">^_^quot𘙮quot^_^</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssemblyName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggeePlugin"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Class</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggeePlugin.DkmEntryPointNotificationService"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Implements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">InterfaceGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NoFilter</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Interface</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IDkmEntryPointNotification"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">InterfaceGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Implements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ManagedComponent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Dans tout fichier de ce type, nous devrons indiquer les éléments suivants: <br><br><ol><li>  ComponentId - cette valeur peut être générée à l'aide de l'outil de génération de GUID (Tools -&gt; CreateGUID) </li><li>  ComponentLevel est le niveau de notre composant dans la hiérarchie.  Consultez le tableau ci-dessus et les informations d'aide sur MSDN pour sélectionner la plage de valeurs souhaitée. </li><li>  Assemblyname est le nom de notre assemblage (pas une solution!).  Dans ce cas, il y aura un DebuggeePlugin </li><li>  Nom de classe - doit être indiqué, y compris l'espace de noms dans lequel se trouve la classe.  Dans ce cas, DebuggeePlugin.DkmEntryPointNotificationService </li><li>  Tableau InterfaceGroup - chaque entrée qu'il contient indique une interface implémentée par ce composant.  À l'intérieur de chaque nœud InterfaceGroup, il devrait y avoir un sous-nœud indiquant les interfaces communes à tous, dans ce groupe, filtre, mais sur les filtres plus tard.  Nous avons maintenant un seul nœud d'interface et porte le nom de l'interface IdkmEntryPointNotification.  Si nous avions plusieurs interfaces, il y aurait plusieurs nœuds d'interface. </li></ol><br>  Permettez-moi de vous rappeler que pour chaque classe qui devrait recevoir des notifications du débogueur, il doit y avoir un tel fichier.  Mais le plaisir ne s'arrête pas là.  Chacun de ces fichiers est ensuite collecté dans un fichier .vsdconfig dans le répertoire de sortie du projet.  Et ils doivent être référencés dans le manifeste du plugin.  Cela se fait comme suit: <br><br><ol><li>  Après avoir formé le fichier ".vsdconfigxml", nous devons ... collecter la solution une fois, sinon nous n'aurons aucun fichier .vsdconfig dans le répertoire de sortie du projet) </li><li>  Après cela, ouvrez l'éditeur de texte pour le fichier source.extension.vsixmanifest et ajoutez le code suivant avant la balise PackageManifest de fermeture: </li></ol><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Assets</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Asset</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggerEngineExtension"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"File"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggeePlugin.vsdconfig"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Assets</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Si, après les actions terminées, le fichier «DebuggeePlugin.vsdconfig» apparaît dans le projet HelloVSIX, il doit être <b>SUPPRIMÉ DU PROJET</b> et la solution doit être collectée à nouveau, sinon elle ne sera pas mise à jour. <br><br>  Les travaux préparatoires sont terminés!  Vous pouvez commencer à déboguer notre plugin.  Cela se fait en démarrant une instance expérimentale de VisualStudio (pour les projets VSIX, il s'agit de la cible de débogage par défaut, donc aucune étape supplémentaire n'est nécessaire).  En fait, nous cliquons sur Debug-&gt; StartDebugging et nous voyons une instance expérimentale de VisualStudio.  Dans celui-ci, par défaut, notre plugin devrait déjà être installé.  Vous pouvez le vérifier via le menu Outils-&gt; Extensions et mises à jour. <br><br>  Du fait que nous avons implémenté l'interface IDkmEntryPointNotification, nous devrons créer un projet de test dans une instance expérimentale de VisualStudio.  En fait, nous créons un nouveau projet, sélectionnez <b>C ++ -&gt; Application console</b> (choisissez C ++, car les exemples suivants contiendront des spécificités C ++), appelez-le <b>VSIXTestApp</b> , exécutez sans aucune modification, collectez et voyez que notre instance expérimentale a cessé de lever une exception à l'intérieur de la méthode DebuggeePlugin. DkmEntryPointNotificationService.OnEntryPoint.  Super!  Vous devez maintenant afficher la MessageBox.  Pour ce faire, il est nécessaire d'ajouter les références suivantes au projet DebuggeePlugin: <br><br><ul><li>  Microsoft.VisualStudio.Shell.15.0 </li><li>  Microsoft.VisualStudio.Shell.Interop </li><li>  Microsoft.VisualStudio.Shell.Interop.8.0 </li><li>  Microsoft.VisualStudio.OLE.Interop </li></ul><br>  Ajoutez deux utilisations au début du fichier DkmEntryPointNotificationService.cs: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop;</code> </pre><br>  Et ajoutez un appel à la méthode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">VsShellUtilities.ShowMessageBox</a> dans la méthode DkmEntryPointNotificationService.OnEntryPoint: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { VsShellUtilities.ShowMessageBox(Microsoft.VisualStudio.Shell.ServiceProvider.GlobalProvider, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, OLEMSGICON.OLEMSGICON_INFO, OLEMSGBUTTON.OLEMSGBUTTON_OK, OLEMSGDEFBUTTON.OLEMSGDEFBUTTON_FIRST); } } }</code> l' <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { VsShellUtilities.ShowMessageBox(Microsoft.VisualStudio.Shell.ServiceProvider.GlobalProvider, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, OLEMSGICON.OLEMSGICON_INFO, OLEMSGBUTTON.OLEMSGBUTTON_OK, OLEMSGDEFBUTTON.OLEMSGDEFBUTTON_FIRST); } } }</code> du <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { VsShellUtilities.ShowMessageBox(Microsoft.VisualStudio.Shell.ServiceProvider.GlobalProvider, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, OLEMSGICON.OLEMSGICON_INFO, OLEMSGBUTTON.OLEMSGBUTTON_OK, OLEMSGDEFBUTTON.OLEMSGDEFBUTTON_FIRST); } } }</code> </pre><br>  Nous reconstruisons, lançons une instance expérimentale du studio, lançons un projet de test et le tour est joué! <br><br>  Nous voyons que l'instance de test du studio a créé MessageBox! <br><br><img src="https://habrastorage.org/webt/2c/a7/fd/2ca7fdpdvkt3z_fscr76xskl7rk.png"><br><br>  Et qu'en est-il en fait? <br><br>  Ici, nous avons appris à configurer un projet VSIX contenant un plug-in pour le débogueur Visual Studio, en tenant compte de la plupart des nuances qui entravent le résultat.  C'est le point de départ d'un travail plus détaillé.  Dans le prochain article, je vais vous montrer un autre point important: comment la communication a lieu entre l'IDE et les composants cibles de débogage. <br><br>  Pour obtenir de l'aide sur l'utilisation de l'API Concord, vous pouvez vous référer non seulement à MSDN, mais également aux référentiels Microsoft suivants sur le github: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">github.com/microsoft/PTVS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">github.com/Microsoft/ConcordExtensibilitySamples</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476298/">https://habr.com/ru/post/fr476298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476288/index.html">Top 5 des cadres JS pour le développement frontal en 2020. 2e partie</a></li>
<li><a href="../fr476290/index.html">Gestion des erreurs dans Express</a></li>
<li><a href="../fr476292/index.html">SVG ou toile?</a></li>
<li><a href="../fr476294/index.html">Réseau de jeu distribué comme alternative à GFN: comment et pourquoi il peut décoller, là où il fonctionne déjà en Fédération de Russie</a></li>
<li><a href="../fr476296/index.html">21 novembre, Meetup d'ingénierie produit: qui est ingénieur produit?</a></li>
<li><a href="../fr476300/index.html">Le magazine Tram est une star brillamment éclairée et rapidement fanée de l'avant-garde russe pour enfants</a></li>
<li><a href="../fr476304/index.html">Authentification du dongle matériel du périphérique Linux sur les systèmes de niveau supérieur</a></li>
<li><a href="../fr476306/index.html">Instructions TelegramBot pour créer des fonctionnalités de base pour le bot. (Partie 1)</a></li>
<li><a href="../fr476308/index.html">Les 5 meilleures pratiques de développement logiciel à suivre en 2020</a></li>
<li><a href="../fr476310/index.html">CRM visage humain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>