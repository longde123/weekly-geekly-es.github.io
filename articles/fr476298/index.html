<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüíº üé¥ üë©‚Äçüë©‚Äçüëß‚Äçüëß Parcourez les √©pines des v√©los, premi√®re partie: d√©couvrez les bases de la personnalisation du d√©bogueur Visual Studio √† l'aide de plugins üïê üë®üèø‚Äçüîß üåÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'une des innovations de Visual Studio 2012 s'est accompagn√©e de l'apparition d'un nouveau d√©bogueur personnalis√© appel√© Concord. Son syst√®me de compo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Parcourez les √©pines des v√©los, premi√®re partie: d√©couvrez les bases de la personnalisation du d√©bogueur Visual Studio √† l'aide de plugins</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476298/"><img src="https://habrastorage.org/webt/kl/8o/1x/kl8o1xvmgggvg_ssk6tb72xz6se.png" align="right">  L'une des innovations de Visual Studio 2012 s'est accompagn√©e de l'apparition d'un nouveau d√©bogueur personnalis√© appel√© Concord.  Son syst√®me de composants permet aux plug-ins VSIX de personnaliser le comportement du d√©bogueur et d'√©crire de nouveaux outils contextuels qui peuvent utiliser le d√©bogueur pour leurs besoins.  Son API fournit de nombreuses fonctionnalit√©s QOL, telles que le marshaling entre le code manag√© / non manag√©, l'int√©gration transparente avec un processus distant / d√©bogu√© localement, et plus encore.  En fait, presque tout ce qui peut √™tre fait dans l'EDI peut √™tre fait par programme en utilisant l'API Concord!  Modifiez les valeurs de variables sp√©cifiques √† la vol√©e, appelez des fonctions sur demande (ou faites sp√©cifiquement le programme leur sauter des appels!), Les plugins peuvent rechercher par PDB (!), Bypass √©tape par √©tape et m√™me modification de code!  Ouvrez le chat et vous d√©couvrirez ces innovations peu connues dans le domaine de la construction de v√©los. <br><a name="habracut"></a><br>  Vous devriez probablement recommencer depuis le d√©but.  Le d√©bogueur d√©tecte les composants en lisant les informations du fichier <i>vsdconfig</i> r√©f√©renc√© par le manifeste du plugin VSIX.  √Ä son tour, <i>vsdconfig</i> indique quelles interfaces sont impl√©ment√©es par les composants du plugin et comment trouver ces composants (lien vers un fichier .dll, indiquant la classe ou, dans le cas de l'impl√©mentation native, indiquant CLSID. Je donnerai des exemples en C #).  De plus, un identifiant unique (GUID) pour chaque composant est indiqu√©, ainsi que son "niveau".  Un niveau est ce qui d√©termine dans quel ordre les plugins seront trait√©s, ainsi que dans le contexte de quel processus cette impl√©mentation sera charg√©e - dans le processus IDE ou dans le processus de l'application d√©bogu√©e.  Cela est d√ª au fait que certaines fonctionnalit√©s ne peut fonctionner que dans le cadre de l'IDE, et vice versa - que dans le contexte du processus en cours de d√©bogage.  Certaines fonctions API fonctionnent de la m√™me mani√®re ici et l√†.  En outre, un certain nombre de composants ont leurs propres r√®gles de disposition, car ils peuvent d√©pendre des √©l√©ments de d√©bogueur existants situ√©s √† leurs niveaux fixes.  Pour √©viter les incidents, je recommande RTFM (https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.debugger.componentinterfaces?view=visualstudiosdk-2017) et des exp√©riences ind√©pendantes dans un bac √† sable s√©par√©, ce qui ne sera pas dommage. supprimer si quelque chose se produit (cela est connect√©, encore une fois, avec une telle nuance - dans certains cas, il n'est m√™me pas clair pourquoi l'assemblage ou le type ne se charge pas, car je ne pouvais toujours pas trouver o√π les journaux appara√Ætraient qui signaleraient le probl√®me de mani√®re stable. Erreur, par exemple, en r√©f√©rence √† une d√©pendance qui ne peut pas √™tre charg√©e dans le processus cible, elle peut appara√Ætre dans la sortie st  di-, ou non. Soyez akuratno, prenez commits fr√©quentes, <s>et ne restez pas assis derri√®re le volant ivre).</s> <br><br>  La liste des niveaux est la suivante (je donnerai le texte en anglais pour que le lecteur n'ait pas d'incidents lors de la r√©alisation d'actes RFTM): <br><br>  Niveaux des composants IDE (valeurs&gt; 100 000): <br><div class="scrollable-table"><table><tbody><tr><th>  Composant </th><th>  Niveau composant </th></tr><tr><td>  AD7 AL </td><td>  1 000 000 000 </td></tr><tr><td>  Fournisseur de d√©montage </td><td>  9,998,000 </td></tr><tr><td>  Requ√™te de pile - Composants qui souhaitent interroger la pile d'appels </td><td>  9 997 000 </td></tr><tr><td>  Fournisseur de pile </td><td>  9,996,000 </td></tr><tr><td>  Filtre de pile - niveau o√π les piles peuvent √™tre filtr√©es et annot√©es </td><td>  9 995 000 </td></tr><tr><td>  Gestionnaire de points d'arr√™t </td><td>  9 994 000 </td></tr><tr><td>  √âvaluation de l'expression IDE </td><td>  9 992 000 </td></tr><tr><td>  Marcheurs de pile de symboles - marcheurs de pile qui ont besoin d'acc√©der aux symboles </td><td>  9 991 000 </td></tr><tr><td>  IDE SymbolProvider - Composants qui fournissent des informations sur les symboles au reste du d√©bogueur.  Le chemin du symbole ne doit pas √™tre utilis√© en dessous de ce niveau. </td><td>  1,999,000 </td></tr></tbody></table></div><br>  Niveaux de composants du processus cible (valeurs &lt;99,999): <br><div class="scrollable-table"><table><tbody><tr><th>  Composant </th><th>  Niveau composant </th></tr><tr><td>  Surveiller le fournisseur de symboles - Fournisseurs de symboles lorsque l'√©tat symbolique est cr√©√© sur l'ordinateur cible (ex: interpr√®te, code compil√© / √©mis dynamiquement) </td><td>  75 000 </td></tr><tr><td>  Processeur de condition de point d'arr√™t - Ce niveau est destin√© au traitement des conditions de point d'arr√™t telles que les expressions de condition et le nombre de r√©sultats.  En dessous de ce point de tous les √©v√©nements physiques des points d'arr√™t seront visibles, peu importe si oui ou non ils ont des conditions fausses. </td><td>  70 000 </td></tr><tr><td>  Surveiller le fournisseur de t√¢ches - Il s'agit du niveau d'exploration de donn√©es de t√¢ches dans le processus cible </td><td>  65 500 </td></tr><tr><td>  Surveiller l'√©valuateur d'expression </td><td>  65 000 </td></tr><tr><td>  Coordination du moniteur - Composants qui arbitrent entre les diff√©rents moniteurs pour les √©tapes, les points d'arr√™t par adresse native, la marche de la pile, etc. </td><td>  60 000 </td></tr><tr><td>  Surveiller les marcheurs de pile </td><td>  55 000 </td></tr><tr><td>  Moniteur de d√©bogage personnalis√© - R√©serv√© aux moniteurs de d√©bogage tiers qui souhaitent utiliser les services fournis par les moniteurs de d√©bogage standard. </td><td>  40 500 </td></tr><tr><td>  Moniteur de d√©bogage d'ex√©cution - Fournit une inspection des donn√©es et un contr√¥le d'ex√©cution pour le code manag√© / natif / script </td><td>  40 000 </td></tr><tr><td>  Moniteur de d√©bogage de base </td><td>  10 000 </td></tr><tr><td>  Services de moniteur de d√©bogage de base - fournit des services utilitaires aux moniteurs de d√©bogage de base (ex: cr√©ation de processus) ainsi que des services de pr√©-d√©bogage (ex: √©num√©ration de processus) </td><td>  1 000 </td></tr></tbody></table></div><br>  Ensuite, dans l'ordre, le processus de cr√©ation d'un projet.  S'il n'y avait pas de nuances importantes, je pourrais d√©crire ce processus de mani√®re minimale ou l'ignorer du tout, mais les r√©alit√©s sont compl√®tement diff√©rentes - nous avons besoin d'un certain nombre de d√©pendances de biblioth√®que, ainsi que d'un outil pour cr√©er des fichiers de configuration, qui pour une raison quelconque n'est pas distribu√© avec VisualStudio, mais est disponible uniquement avec p√©pite.  En fait, nous devons maintenant passer √† l'essentiel.  Le processus de cr√©ation et de configuration d'un projet est structur√© comme suit: <br><br><ol><li>  Ouvrez Visual Studio.  Dans mon cas, 2017 Community Edition </li><li>  Projet VSIX ( <i>Visual C # -&gt;</i> onglet <i>Extensibilit√©</i> , ou via la recherche).  Appelons √ßa "HelloVSIX" </li><li>  Ajoutez un nouveau projet de biblioth√®que de classes dans la solution et appelez-le ¬´DebuggeePlugin¬ª </li><li>  Nous mettons la r√©f√©rence sur le projet "DebuggeePlugin" dans le projet "HelloVSIX" </li><li>  Nous mettons la r√©f√©rence √† l'assembly "Microsoft.VisualStudio.Debugger.Engine" dans le projet DebuggeePlugin </li><li>  Ajouter au projet ¬´DebuggeePlugin¬ª une r√©f√©rence √† l'ensemble NuGet Microsoft.VSSDK.Debugger.VSDConfigTool.  Ceci est notre outil pour g√©n√©rer des configurations VSD. </li></ol><br>  Maintenant, nous sommes pr√™ts √† faire de notre plugin quelque chose d'utile.  Faisons la chose la plus simple que vous puissiez faire - laissez-le afficher un MessageBox qui dit "Bonjour VSIX" lorsque le processus cible rencontre un point d'entr√©e.  Pour ce faire, nous devons cr√©er une classe qui impl√©mente l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">IDkmEntryPointNotification</a> , ainsi que remplir plusieurs fichiers de configuration.  Ajoutez une nouvelle classe publique appel√©e DkmEntryPointNotificationService et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">h√©ritez de l'</a> interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">IDkmEntryPointNotification</a> et laissez l'impl√©mentation par d√©faut pour l'instant: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } } }</code> </pre> <br>  Ajoutez le fichier ¬´DkmEntryPointNotificationService.vsdconfigxml¬ª au projet ¬´DebuggeePlugin¬ª.  Pour chaque classe d√©clar√©e qui doit recevoir des notifications via les impl√©mentations des interfaces d'espace de noms Microsoft.VisualStudio.Debugger.ComponentInterfaces, vous devez disposer d'un tel fichier.  Soit dit en passant, il est possible d'impl√©menter plusieurs de ces interfaces √† la fois dans une m√™me classe.  Nous devons maintenant modifier l'action de g√©n√©ration de notre fichier ".vsdconfigxml".  Pour ce faire, vous devez √©diter manuellement le fichier de projet (j'ai s√©rieusement).  Nous d√©chargeons le projet DebuggeePlugin et l'ouvrons avec l'√©diteur de studio.  Nous devons trouver la balise XLM suivante: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">None</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DkmEntryPointNotificationService.vsdconfigxml"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  et d√©placez cette balise vers votre propre ItemGroup, en changeant le type de None en VsdConfigXmlFiles: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VsdConfigXmlFiles</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DkmEntryPointNotificationService.vsdconfigxml"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Vous pouvez enregistrer et recharger le projet. <br><br>  Maintenant, allez dans les configs.  La premi√®re chose √† faire: si ¬´DebuggeePlugin¬ª a ajout√© le fichier de projet vsdconfig.xsd, alors il doit √™tre retir√©.  Nous allons le remplacer maintenant, car il est plus facile de travailler avec du texte brut.  Ouvrez DkmEntryPointNotificationService.vsdconfigxml et remplacez le texte par ce qui suit: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/vstudio/vsdconfig/2008"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ManagedComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ComponentId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"422413E1-450E-40A6-AE24-7E80A81CC668"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ComponentLevel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">^_^quotòôÆquot^_^</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssemblyName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggeePlugin"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Class</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggeePlugin.DkmEntryPointNotificationService"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Implements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">InterfaceGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NoFilter</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Interface</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IDkmEntryPointNotification"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">InterfaceGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Implements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ManagedComponent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Dans tout fichier de ce type, nous devrons indiquer les √©l√©ments suivants: <br><br><ol><li>  ComponentId - cette valeur peut √™tre g√©n√©r√©e √† l'aide de l'outil de g√©n√©ration de GUID (Tools -&gt; CreateGUID) </li><li>  ComponentLevel est le niveau de notre composant dans la hi√©rarchie.  Consultez le tableau ci-dessus et les informations d'aide sur MSDN pour s√©lectionner la plage de valeurs souhait√©e. </li><li>  Assemblyname est le nom de notre assemblage (pas une solution!).  Dans ce cas, il y aura un DebuggeePlugin </li><li>  Nom de classe - doit √™tre indiqu√©, y compris l'espace de noms dans lequel se trouve la classe.  Dans ce cas, DebuggeePlugin.DkmEntryPointNotificationService </li><li>  Tableau InterfaceGroup - chaque entr√©e qu'il contient indique une interface impl√©ment√©e par ce composant.  √Ä l'int√©rieur de chaque n≈ìud InterfaceGroup, il devrait y avoir un sous-n≈ìud indiquant les interfaces communes √† tous, dans ce groupe, filtre, mais sur les filtres plus tard.  Nous avons maintenant un seul n≈ìud d'interface et porte le nom de l'interface IdkmEntryPointNotification.  Si nous avions plusieurs interfaces, il y aurait plusieurs n≈ìuds d'interface. </li></ol><br>  Permettez-moi de vous rappeler que pour chaque classe qui devrait recevoir des notifications du d√©bogueur, il doit y avoir un tel fichier.  Mais le plaisir ne s'arr√™te pas l√†.  Chacun de ces fichiers est ensuite collect√© dans un fichier .vsdconfig dans le r√©pertoire de sortie du projet.  Et ils doivent √™tre r√©f√©renc√©s dans le manifeste du plugin.  Cela se fait comme suit: <br><br><ol><li>  Apr√®s avoir form√© le fichier ".vsdconfigxml", nous devons ... collecter la solution une fois, sinon nous n'aurons aucun fichier .vsdconfig dans le r√©pertoire de sortie du projet) </li><li>  Apr√®s cela, ouvrez l'√©diteur de texte pour le fichier source.extension.vsixmanifest et ajoutez le code suivant avant la balise PackageManifest de fermeture: </li></ol><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Assets</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Asset</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggerEngineExtension"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"File"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DebuggeePlugin.vsdconfig"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Assets</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Si, apr√®s les actions termin√©es, le fichier ¬´DebuggeePlugin.vsdconfig¬ª appara√Æt dans le projet HelloVSIX, il doit √™tre <b>SUPPRIM√â DU PROJET</b> et la solution doit √™tre collect√©e √† nouveau, sinon elle ne sera pas mise √† jour. <br><br>  Les travaux pr√©paratoires sont termin√©s!  Vous pouvez commencer √† d√©boguer notre plugin.  Cela se fait en d√©marrant une instance exp√©rimentale de VisualStudio (pour les projets VSIX, il s'agit de la cible de d√©bogage par d√©faut, donc aucune √©tape suppl√©mentaire n'est n√©cessaire).  En fait, nous cliquons sur Debug-&gt; StartDebugging et nous voyons une instance exp√©rimentale de VisualStudio.  Dans celui-ci, par d√©faut, notre plugin devrait d√©j√† √™tre install√©.  Vous pouvez le v√©rifier via le menu Outils-&gt; Extensions et mises √† jour. <br><br>  Du fait que nous avons impl√©ment√© l'interface IDkmEntryPointNotification, nous devrons cr√©er un projet de test dans une instance exp√©rimentale de VisualStudio.  En fait, nous cr√©ons un nouveau projet, s√©lectionnez <b>C ++ -&gt; Application console</b> (choisissez C ++, car les exemples suivants contiendront des sp√©cificit√©s C ++), appelez-le <b>VSIXTestApp</b> , ex√©cutez sans aucune modification, collectez et voyez que notre instance exp√©rimentale a cess√© de lever une exception √† l'int√©rieur de la m√©thode DebuggeePlugin. DkmEntryPointNotificationService.OnEntryPoint.  Super!  Vous devez maintenant afficher la MessageBox.  Pour ce faire, il est n√©cessaire d'ajouter les r√©f√©rences suivantes au projet DebuggeePlugin: <br><br><ul><li>  Microsoft.VisualStudio.Shell.15.0 </li><li>  Microsoft.VisualStudio.Shell.Interop </li><li>  Microsoft.VisualStudio.Shell.Interop.8.0 </li><li>  Microsoft.VisualStudio.OLE.Interop </li></ul><br>  Ajoutez deux utilisations au d√©but du fichier DkmEntryPointNotificationService.cs: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop;</code> </pre><br>  Et ajoutez un appel √† la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">VsShellUtilities.ShowMessageBox</a> dans la m√©thode DkmEntryPointNotificationService.OnEntryPoint: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { VsShellUtilities.ShowMessageBox(Microsoft.VisualStudio.Shell.ServiceProvider.GlobalProvider, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, OLEMSGICON.OLEMSGICON_INFO, OLEMSGBUTTON.OLEMSGBUTTON_OK, OLEMSGDEFBUTTON.OLEMSGDEFBUTTON_FIRST); } } }</code> l' <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { VsShellUtilities.ShowMessageBox(Microsoft.VisualStudio.Shell.ServiceProvider.GlobalProvider, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, OLEMSGICON.OLEMSGICON_INFO, OLEMSGBUTTON.OLEMSGBUTTON_OK, OLEMSGDEFBUTTON.OLEMSGDEFBUTTON_FIRST); } } }</code> du <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Debugger.ComponentInterfaces; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.Shell.Interop; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DebuggeePlugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DkmEntryPointNotificationService</span></span> : <span class="hljs-title"><span class="hljs-title">IDkmEntryPointNotification</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEntryPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DkmProcess process, DkmThread thread, DkmEventDescriptor eventDescriptor</span></span></span><span class="hljs-function">)</span></span> { VsShellUtilities.ShowMessageBox(Microsoft.VisualStudio.Shell.ServiceProvider.GlobalProvider, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello VSIX"</span></span>, OLEMSGICON.OLEMSGICON_INFO, OLEMSGBUTTON.OLEMSGBUTTON_OK, OLEMSGDEFBUTTON.OLEMSGDEFBUTTON_FIRST); } } }</code> </pre><br>  Nous reconstruisons, lan√ßons une instance exp√©rimentale du studio, lan√ßons un projet de test et le tour est jou√©! <br><br>  Nous voyons que l'instance de test du studio a cr√©√© MessageBox! <br><br><img src="https://habrastorage.org/webt/2c/a7/fd/2ca7fdpdvkt3z_fscr76xskl7rk.png"><br><br>  Et qu'en est-il en fait? <br><br>  Ici, nous avons appris √† configurer un projet VSIX contenant un plug-in pour le d√©bogueur Visual Studio, en tenant compte de la plupart des nuances qui entravent le r√©sultat.  C'est le point de d√©part d'un travail plus d√©taill√©.  Dans le prochain article, je vais vous montrer un autre point important: comment la communication a lieu entre l'IDE et les composants cibles de d√©bogage. <br><br>  Pour obtenir de l'aide sur l'utilisation de l'API Concord, vous pouvez vous r√©f√©rer non seulement √† MSDN, mais √©galement aux r√©f√©rentiels Microsoft suivants sur le github: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">github.com/microsoft/PTVS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">github.com/Microsoft/ConcordExtensibilitySamples</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476298/">https://habr.com/ru/post/fr476298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476288/index.html">Top 5 des cadres JS pour le d√©veloppement frontal en 2020. 2e partie</a></li>
<li><a href="../fr476290/index.html">Gestion des erreurs dans Express</a></li>
<li><a href="../fr476292/index.html">SVG ou toile?</a></li>
<li><a href="../fr476294/index.html">R√©seau de jeu distribu√© comme alternative √† GFN: comment et pourquoi il peut d√©coller, l√† o√π il fonctionne d√©j√† en F√©d√©ration de Russie</a></li>
<li><a href="../fr476296/index.html">21 novembre, Meetup d'ing√©nierie produit: qui est ing√©nieur produit?</a></li>
<li><a href="../fr476300/index.html">Le magazine Tram est une star brillamment √©clair√©e et rapidement fan√©e de l'avant-garde russe pour enfants</a></li>
<li><a href="../fr476304/index.html">Authentification du dongle mat√©riel du p√©riph√©rique Linux sur les syst√®mes de niveau sup√©rieur</a></li>
<li><a href="../fr476306/index.html">Instructions TelegramBot pour cr√©er des fonctionnalit√©s de base pour le bot. (Partie 1)</a></li>
<li><a href="../fr476308/index.html">Les 5 meilleures pratiques de d√©veloppement logiciel √† suivre en 2020</a></li>
<li><a href="../fr476310/index.html">CRM visage humain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>