<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßóüèø üçª üëßüèæ Dasar-dasar proxy transparan menggunakan 3proxy dan iptables / netfilter atau bagaimana "membiarkan semuanya melalui proxy" üß• üë®üèæ‚Äçüè´ ‚ùÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, saya ingin mengungkap kemungkinan proxy transparan, yang memungkinkan Anda untuk mengarahkan ulang seluruh atau sebagian lalu lintas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dasar-dasar proxy transparan menggunakan 3proxy dan iptables / netfilter atau bagaimana "membiarkan semuanya melalui proxy"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460469/">  Pada artikel ini, saya ingin mengungkap kemungkinan proxy transparan, yang memungkinkan Anda untuk mengarahkan ulang seluruh atau sebagian lalu lintas melalui server proxy eksternal yang benar-benar tidak terlihat. <br><br>  Ketika saya mulai memecahkan masalah ini, saya dihadapkan dengan kenyataan bahwa implementasinya memiliki satu masalah signifikan - protokol HTTPS.  Di masa lalu yang baik, tidak ada masalah khusus dengan proxy HTTP transparan, tetapi ketika proxy HTTPS, browser melaporkan gangguan dengan protokol, dan di situlah kebahagiaan berakhir. <br><br>  Dalam instruksi umum ke server proxy, Squid bahkan menawarkan untuk menghasilkan sertifikat mereka sendiri dan menginstalnya untuk klien, yang merupakan <s>omong kosong lengkap,</s> setidaknya tidak masuk akal dan terlihat seperti serangan MITM.  Saya tahu bahwa Squid sudah tahu bagaimana melakukan sesuatu seperti itu, tetapi artikel ini adalah tentang cara yang terbukti dan bekerja menggunakan 3proxy dari 3APA3A yang disegani. <br><br>  Selanjutnya, kita akan melihat lebih dekat pada proses membangun 3proxy dari sumber, konfigurasinya, proxy penuh dan selektif menggunakan NAT, distribusi saluran ke beberapa server proxy eksternal, dan penggunaan router dan rute statis.  Kami menggunakan Debian 9 x64 sebagai OS.  Ayo mulai! <br><a name="habracut"></a><br><h3>  Instal 3proxy dan mulai server proxy biasa </h3><br>  1. Instal ifconfig (dari paket net-tools) <br> <code>apt-get install net-tools</code> <br>  2. Instal Midnigth Commander <br> <code>apt-get install mc</code> <br>  3. Kami sekarang memiliki 2 antarmuka: <br>  enp0s3 - eksternal, terlihat di Internet <br>  enp0s8 - internal, harus melihat ke dalam jaringan area lokal <br>  Dalam distribusi berbasis Debian lain, antarmuka biasanya disebut eth0 dan eth1. <br> <code>ifconfig -a</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Antarmuka</b> <div class="spoiler_text">  enp0s3: flags = 4163 &lt;UP, BROADCAST, RUNNING, MULTICAST&gt; mtu 1500 <br>  inet 192.168.23.11 netmask 255.255.255.0 broadcast 192.168.23.255 <br>  inet6 fe80 :: a00: 27ff: fec2: bae4 prefixlen 64 scopeid 0x20 ether 08: 00: 27: c2: ba: e4 txqueuelen 1000 (Ethernet) <br>  Paket RX 6412 byte 8676619 (8,2 MiB) <br>  Kesalahan RX 0 turun 0 overruns 0 frame 0 <br>  Paket TX 1726 byte 289128 (282,3 KiB) <br>  Kesalahan TX 0 turun 0 overruns 0 operator 0 tumbukan 0 <br><br>  enp0s8: flags = 4098 &lt;BROADCAST, MULTICAST&gt; mtu 1500 <br>  eter 08: 00: 27: 79: a7: e3 txqueuelen 1000 (Ethernet) <br>  Paket RX 0 byte 0 (0,0 B) <br>  Kesalahan RX 0 turun 0 overruns 0 frame 0 <br>  Paket TX 0 byte 0 (0,0 B) <br>  Kesalahan TX 0 turun 0 overruns 0 operator 0 tumbukan 0 <br><br>  lo: flags = 73 &lt;UP, LOOPBACK, RUNNING&gt; mtu 65536 <br>  inet 127.0.0.1 netmask 255.0.0.0 <br>  inet6 :: 1 prefixlen 128 scopeid 0x10 loop txqueuelen 1 (Local Loopback) <br>  Paket RX 0 byte 0 (0,0 B) <br>  Kesalahan RX 0 turun 0 overruns 0 frame 0 <br>  Paket TX 0 byte 0 (0,0 B) <br>  Kesalahan TX 0 turun 0 overruns 0 operator 0 tumbukan 0 <br><br>  Antarmuka enp0s8 saat ini tidak digunakan, kami akan mengaktifkannya ketika kami ingin menggunakan konfigurasi Proxy NAT atau NAT.  Maka logis untuk menetapkan ip statis untuk itu. <br><br>  4. Lanjutkan untuk menginstal 3proxy <br><br>  4.1 Menginstal paket-paket dasar untuk mengkompilasi 3proxy dari sumber <br><br> <code>root@debian9:~# apt-get install build-essential libevent-dev libssl-dev -y</code> <br> <br>  4.2.  Buat folder untuk mengunduh arsip dengan sumber <br><br> <code>root@debian9:~# mkdir -p /opt/proxy</code> <br> <br>  4.3.  Ayo buka folder ini <br><br> <code>root@debian9:~# cd /opt/proxy <br></code> <br><br>  4.4.  Sekarang unduh paket 3proxy terbaru.  Pada saat penulisan, versi stabil terbaru adalah 0.8.12 (18/4/2018) Unduh dari situs web resmi 3proxy <br><br> <code>root@debian9:/opt/proxy# wget https://github.com/z3APA3A/3proxy/archive/0.8.12.tar.gz <br></code> <br><br>  4.5.  Buka zip arsip yang diunduh <br><br> <code>root@debian9:/opt/proxy# tar zxvf 0.8.12.tar.gz</code> <br> <br>  4.6.  Pergi ke direktori unpacked untuk membangun program <br><br> <code>root@debian9:/opt/proxy# cd 3proxy-0.8.12</code> <br> <br>  4.7.  Selanjutnya, Anda perlu menambahkan baris ke file header sehingga server kami benar-benar anonim (itu benar-benar berfungsi, semuanya diperiksa, klien ip disembunyikan) <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# nano +29 src/proxy.h</code> <br> <br>  Tambahkan satu baris <br><br> <code>#define ANONYMOUS 1 <br></code> <br>  Tekan Ctrl + x dan Enter untuk menyimpan perubahan. <br><br>  4.8.  Mari kita bangun programnya <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# make -f Makefile.Linux</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Makelog</b> <div class="spoiler_text">  make [2]: Meninggalkan direktori '/opt/proxy/3proxy-0.8.12/src/plugins/TransparentPlugin' <br>  make [1]: Meninggalkan direktori '/opt/proxy/3proxy-0.8.12/src' <br></div></div><br>  Tidak ada kesalahan, lanjutkan. <br><br>  4.9.  Instal program dalam sistem <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# make -f Makefile.Linux install</code> <br> <br>  4.10.  Pergi ke direktori root dan periksa di mana program diinstal. <br><br> <code>root@debian9:/opt/proxy/3proxy-0.8.12# cd ~/ <br> root@debian9:~# whereis 3proxy</code> <br>  3proxy: / usr / local / bin / 3proxy / usr / local / etc / 3proxy <br><br>  4.11.  Buat folder untuk file konfigurasi dan log di direktori home pengguna <br><br> <code>root@debian9:~# mkdir -p /home/joke/proxy/logs</code> <br> <br>  4.12.  Pergi ke direktori di mana konfigurasi seharusnya <br><br> <code>root@debian9:~# cd /home/joke/proxy/</code> <br> <br>  4.13.  Buat file kosong dan salin konfigurasi di sana <br><br> <code>root@debian9:/home/joke/proxy# cat &gt; 3proxy.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">3proxy.conf</b> <div class="spoiler_text">  daemon <br>  pidfile /home/joke/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br>  tester pengguna: CL: 1234 <br>  batas waktu 1 5 30 60 180 1800 16 60 <br>  log /home/joke/proxy/logs/3proxy.log D <br>  logformat "- + _L% t.%.% N.% p% E% U% C:% c% R:% r% O% I% h% T" <br>  putar 3 <br>  auth kuat <br>  siram <br>  izinkan tester <br>  kaus kaki -p3128 <br>  proxy -p8080 <br></div></div><br>  Untuk menyimpan, tekan Ctrl + Z <br><br>  4.14.  Buat file pid sehingga tidak ada kesalahan saat startup. <br><br> <code>root@debian9:/home/joke/proxy# cat &gt; 3proxy.pid</code> <br> <br>  Untuk menyimpan, tekan Ctrl + Z <br><br>  4.15.  Luncurkan server proxy! <br><br> <code>root@debian9:/home/joke/proxy# 3proxy /home/joke/proxy/3proxy.conf</code> <br> <br>  4.16.  Mari kita lihat apakah server mendengarkan pada port <br><br> <code>root@debian9:~/home/joke/proxy# netstat -nlp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">log netstat</b> <div class="spoiler_text">  Koneksi internet aktif (hanya server) <br>  Proto Recv-Q Kirim-Q Alamat Lokal Alamat Asing Negara PID / Nama program <br>  tcp 0 0 0.0.0.0:8080 0.0.0.0:* DENGARKAN 504 / 3proxy <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:* DENGARKAN 338 / sshd <br>  tcp 0 0 0.0.0.0lla128 0.0.0.0:* DENGARKAN 504 / 3proxy <br>  tcp6 0 0 ::: 22 ::: * DENGARKAN 338 / sshd <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 352 / dhclient <br></div></div><br>  Seperti yang tertulis dalam konfigurasi, proxy web mendengarkan ke port 8080, dan proxy Socks5 mendengarkan 3128. <br><br>  4.17.  Untuk memulai layanan proxy setelah reboot, tambahkan ke cron. <br><br> <code>root@debian9:/home/joke/proxy# crontab -e</code> <br> <br>  Tambahkan satu baris <br><br> <code>@reboot /usr/local/bin/3proxy /home/joke/proxy/3proxy.conf</code> <br> <br>  Tekan Enter, karena cron akan melihat karakter garis akhir dan menyimpan file. <br><br>  Harus ada pesan tentang memasang crontab baru. <br><br>  crontab: menginstal crontab baru <br><br>  4.18.  Kami akan mem-boot ulang sistem dan mencoba terhubung melalui browser ke proksi.  Untuk verifikasi, kami menggunakan browser Firefox (untuk proksi web) dan add-on FoxyProxy untuk socks5 dengan otentikasi. <br><br> <code>root@debian9:/home/joke/proxy# reboot</code> <br> <br>  4.19.  Setelah memeriksa proksi setelah reboot, Anda dapat melihat log.  Ini menyelesaikan pengaturan proxy. <br><br><div class="spoiler">  <b class="spoiler_title">3 log proxy</b> <div class="spoiler_text">  1542573996.018 PROXY.8080 00000 tester 192.168.23.10:50915 217.12.15.54ced43 1193 6939 0 CONNECT_ads.yahoo.com:443_HTTP/1.1 <br>  1542574289.634 SOCK5.3128 00000 tester 192.168.23.10/101193 54.192.13.69:443 0 0 0 CONNECT_normandy.cdn.mozilla.net:443 <br></div></div><br><h3>  Konfigurasikan dan jalankan konfigurasi Transparent Proxy NAT </h3><br>  Dalam konfigurasi ini, semua perangkat di jaringan internal akan bekerja secara transparan di Internet melalui server proxy jarak jauh.  Benar-benar semua koneksi tcp akan dialihkan ke satu atau beberapa (benar-benar memperluas lebar saluran, contoh konfigurasi No. 2!) Server proxy.  DNS akan menggunakan kemampuan 3proxy (dnspr).  UDP tidak akan keluar karena kami belum menggunakan mekanisme penerusan (dinonaktifkan secara default di kernel Linux). <br><br>  1. Sudah saatnya untuk mengaktifkan antarmuka enp0s8 <br><br> <code>root@debian9:~# nano /etc/network/interfaces</code> <br> <br><div class="spoiler">  <b class="spoiler_title">/ etc / network / interfaces file</b> <div class="spoiler_text">  # File ini menjelaskan antarmuka jaringan yang tersedia di sistem Anda <br>  # dan cara mengaktifkannya.  Untuk informasi lebih lanjut, lihat antarmuka (5). <br><br>  source /etc/network/interfaces.d/* <br><br>  # Antarmuka jaringan loopback <br>  otomatis lo <br>  iface lo inet loopback <br><br>  # Antarmuka jaringan utama <br>  allow-hotplug enp0s3 <br>  iface enp0s3 inet dhcp <br><br>  # Antarmuka jaringan sekunder <br>  allow-hotplug enp0s8 <br>  iface enp0s8 inet statis <br>  alamat 192.168.201.254 <br>  netmask 255.255.255.0 <br></div></div><br>  Di sini kami menetapkan alamat statis 192.168.201.254 dan menyamarkan 255.255.255.0 ke antarmuka enp0s8 <br>  Simpan konfigurasi Ctrl + X dan reboot <br><br> <code>root@debian9:~# reboot</code> <br> <br>  2. Memeriksa antarmuka <br><br> <code>root@debian9:~# ifconfig</code> <br> <br><div class="spoiler">  <b class="spoiler_title">log ifconfig</b> <div class="spoiler_text">  enp0s3: flags = 4163 &lt;UP, BROADCAST, RUNNING, MULTICAST&gt; mtu 1500 <br>  inet 192.168.23.11 netmask 255.255.255.0 broadcast 192.168.23.255 <br>  inet6 fe80 :: a00: 27ff: fec2: bae4 prefixlen 64 scopeid 0x20 ether 08: 00: 27: c2: ba: e4 txqueuelen 1000 (Ethernet) <br>  Paket RX 61 byte 7873 (7,6 KiB) <br>  Kesalahan RX 0 turun 0 overruns 0 frame 0 <br>  Paket TX 65 byte 10917 (10,6 KiB) <br>  Kesalahan TX 0 turun 0 overruns 0 operator 0 tumbukan 0 <br><br>  enp0s8: flags = 4163 &lt;UP, BROADCAST, RUNNING, MULTICAST&gt; mtu 1500 <br>  inet 192.168.201.254 netmask 255.255.255.0 broadcast 192.168.201.255 <br>  inet6 fe80 :: a00: 27ff: fe79: awalan a7e3 64 scopeid 0x20 ether 08: 00: 27: 79: a7: e3 txqueuelen 1000 (Ethernet) <br>  Paket RX 0 byte 0 (0,0 B) <br>  Kesalahan RX 0 turun 0 overruns 0 frame 0 <br>  Paket TX 8 byte 648 (648.0 B) <br>  Kesalahan TX 0 turun 0 overruns 0 operator 0 tumbukan 0 <br><br>  lo: flags = 73 &lt;UP, LOOPBACK, RUNNING&gt; mtu 65536 <br>  inet 127.0.0.1 netmask 255.0.0.0 <br>  inet6 :: 1 prefixlen 128 scopeid 0x10 loop txqueuelen 1 (Local Loopback) <br>  Paket RX 0 byte 0 (0,0 B) <br>  Kesalahan RX 0 turun 0 overruns 0 frame 0 <br>  Paket TX 0 byte 0 (0,0 B) <br>  Kesalahan TX 0 turun 0 overruns 0 operator 0 tumbukan 0 <br><br>  3. Semuanya berubah, sekarang Anda perlu mengkonfigurasi 3proxy untuk proxy transparan. <br><br> <code>root@debian9:~# cd /home/joke/proxy/ <br> root@debian9:/home/joke/proxy# cat &gt; 3proxytransp.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Contoh konfigurasi server proxy transparan # 1</b> <div class="spoiler_text">  daemon <br>  pidfile /home/joke/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br>  batas waktu 1 5 30 60 180 1800 16 60 <br>  log /home/joke/proxy/logs/3proxy.log D <br>  logformat "- + _L% t.%.% N.% p% E% U% C:% c% R:% r% O% I% h% T" <br>  putar 3 <br>  siram <br>  autentik iponly <br>  dnspr <br>  bolehkan * <br>  induk 1000 socks5 IP_EXTERNAL_PROXY 3128 tester 1234 <br>  plugin /opt/proxy/3proxy-0.8.12/src/TransparentPlugin.ld.so transparent_plugin <br>  tcppm -i0.0.0.0 888 127.0.0.1 11111 <br></div></div><br>  4. Sekarang jalankan 3proxy dengan konfigurasi baru <br> <code>root@debian9:/home/joke/proxy# /usr/local/bin/3proxy /home/joke/proxy/3proxytransp.conf</code> <br> <br>  5. Tambahkan crontab lagi <br> <code>root@debian9:/home/joke/proxy# crontab -e <br> @reboot /usr/local/bin/3proxy /home/joke/proxy/3proxytransp.conf</code> <br> <br>  6. Mari kita lihat apa yang sedang didengarkan proxy kami <br> <code>root@debian9:~# netstat -nlp <br></code> <br><br><div class="spoiler">  <b class="spoiler_title">log netstat</b> <div class="spoiler_text">  Koneksi internet aktif (hanya server) <br>  Proto Recv-Q Kirim-Q Alamat Lokal Alamat Asing Negara PID / Nama program <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:* DENGARKAN 349 / sshd <br>  tcp 0 0 0.0.0.0:888 0.0.0.0:* DENGARKAN 354 / 3proxy <br>  tcp6 0 0 ::: 22 ::: * DENGARKAN 349 / sshd <br>  udp 0 0 0.0.0.0:53 0.0.0.0:* 354 / 3proxy <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 367 / dhclient <br></div></div><br>  7. Sekarang proxy siap menerima koneksi TCP apa pun pada port 888, DNS pada port 53, sehingga mereka dapat dialihkan ke remote socks5 - proksi Google dan DNS 8.8.8.8.  Tetap bagi kami untuk mengkonfigurasi aturan netfilter (iptables) dan DHCP untuk mengeluarkan alamat. <br><br>  8. Instal paket iptables-persistent dan dhcpd <br><br> <code>root@debian9:~# apt-get install iptables-persistent isc-dhcp-server</code> <br> <br>  9. Edit file startup dhcpd <br> <code>root@debian9:~# nano /etc/dhcp/dhcpd.conf</code> <br> <br><div class="spoiler">  <b class="spoiler_title">dhcpd.conf</b> <div class="spoiler_text">  # dhcpd.conf <br>  # <br>  # Contoh file konfigurasi untuk ISC dhcpd <br>  # <br><br>  # definisi opsi yang umum untuk semua jaringan yang didukung ... <br>  option domain-name "example.org"; <br>  domain opsi-nama-server ns1.example.org, ns2.example.org; <br><br>  waktu sewa standar 600; <br>  waktu sewa maksimum 7200; <br><br>  ddns-perbarui-style tidak ada; <br><br>  # Jika server DHCP ini adalah server DHCP resmi untuk lokal <br>  # jaringan, arahan resmi harus dihapus komentar. <br><br>  berwibawa; <br><br>  # Konfigurasi yang sedikit berbeda untuk subnet internal. <br>  subnet 192.168.201.0 netmask 255.255.255.0 { <br>  kisaran 192.168.201.10 192.168.201.250; <br>  opsi domain-nama-server 192.168.201.254; <br>  router opsi 192.168.201.254; <br>  option broadcast-address 192.168.201.255; <br>  waktu sewa standar 600; <br>  waktu sewa maksimum 7200; <br>  } <br></div></div><br>  11. Reboot dan periksa layanan pada port 67 <br> <code>root@debian9:~# reboot <br> root@debian9:~# netstat -nlp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">log netstat</b> <div class="spoiler_text">  Koneksi internet aktif (hanya server) <br>  Proto Recv-Q Kirim-Q Alamat Lokal Alamat Asing Negara PID / Nama program <br>  tcp 0 0 0.0.0.0:22 0.0.0.0:* DENGARKAN 389 / sshd <br>  tcp 0 0 0.0.0.0:888 0.0.0.0:* DENGARKAN 310 / 3proxy <br>  tcp6 0 0 ::: 22 ::: * DENGARKAN 389 / sshd <br>  udp 0 0 0.0.0.0.20364 0.0.0.0:* 393 / dhcpd <br>  udp 0 0 0.0.0.0:53 0.0.0.0:* 310 / 3proxy <br>  udp 0 0 0.0.0.0:67 0.0.0.0:* 393 / dhcpd <br>  udp 0 0 0.0.0.0:68 0.0.0.0:* 405 / dhclient <br>  udp6 0 0 ::: 31728 ::: * 393 / dhcpd <br>  mentah 0 0 0.0.0.0:1 0.0.0.0:* 393 / dhcpd <br><br></div></div><br>  12. Tetap mengarahkan ulang semua permintaan tcp ke port 888 dan menyimpan aturan di iptables <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.201.0/24 -p tcp -j REDIRECT --to-ports 888</code> <br> <br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br>  13. Untuk memperluas bandwidth saluran, Anda dapat menggunakan beberapa server proxy sekaligus.  Jumlah totalnya harus 1000. Koneksi baru dibuat dengan probabilitas 0,2, 0,2, 0,2, 0,2, 0,1, 0,1 ke server proxy yang ditentukan. <br><br>  Catatan: jika kami memiliki proxy web, maka alih-alih socks5 Anda harus menulis connect, jika socks4, lalu socks4 (socks4 TIDAK MENDUKUNG LOGIN / OTORISASI PASSWORD!) <br><br><div class="spoiler">  <b class="spoiler_title">Contoh konfigurasi server proxy transparan # 2</b> <div class="spoiler_text">  daemon <br>  pidfile /home/joke/proxy/3proxy.pid <br>  nserver 8.8.8.8 <br>  nscache 65536 <br>  maxconn 500 <br>  batas waktu 1 5 30 60 180 1800 16 60 <br>  log /home/joke/proxy/logs/3proxy.log D <br>  logformat "- + _L% t.%.% N.% p% E% U% C:% c% R:% r% O% I% h% T" <br>  putar 3 <br>  siram <br>  autentik iponly <br>  dnspr <br>  bolehkan * <br><br>  induk 200 kaus kaki5 IP_EXT_EXT_PROXY # 1 3128 tester 1234 <br>  induk 200 kaus kaki5 IP_EXT_EXT_PROXY # 2 3128 tester 1234 <br>  induk 200 kaus kaki5 IP_EXT_EXT_PROXY # 3 3128 tester 1234 <br>  induk 200 kaus kaki5 IP_EXT_EXT_PROXY # 4 3128 tester 1234 <br>  induk 100 kaus kaki5 IP_EXT_EXT_PROXY # 5 3128 tester 1234 <br>  induk 100 kaus kaki5 IP_EXT_EXT_PROXY # 6 3128 tester 1234 <br><br>  plugin /opt/proxy/3proxy-0.8.12/src/TransparentPlugin.ld.so transparent_plugin <br>  tcppm -i0.0.0.0 888 127.0.0.1 11111 <br></div></div><br><h3>  Konfigurasikan dan jalankan konfigurasi NAT + Transparent Proxy </h3><br>  Dalam konfigurasi ini, kita akan menggunakan mekanisme NAT biasa dengan proksi selektif atau penuh transparan dari masing-masing alamat atau subnet.  Pengguna jaringan internal akan bekerja dengan layanan / subnet tertentu tanpa menyadari bahwa mereka bekerja melalui proxy.  Semua koneksi https berfungsi dengan baik, tidak ada sertifikat yang perlu dibuat / diganti. <br><br>  Pertama, kami memutuskan subnet / layanan mana yang ingin kami proksi.  Misalkan proxy eksternal terletak di mana layanan seperti pandora.com sedang berjalan.  Sekarang tinggal menentukan subnet / alamatnya. <br><br>  1. Ping <br><br> <code>root@debian9:~# ping pandora.com</code> <br>  PING pandora.com (208.85.40.20) 56 (84) byte data. <br><br>  2. Kami mengetik di Google BGP 208.85.40.20 <br><br>  Buka situs web <a href="">bgp.he.net/net/208.85.40.0/24#_netinfo</a> <br>  Anda dapat melihat bahwa saya mencari subnet AS40428 Pandora Media, Inc <br><br>  <a href="">bgp.he.net/net/208.85.40.0/24#_netinfo</a> <br><br>  Buka awalan v4 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bgp.he.net/AS40428#_prefixes</a> <br><br>  Inilah subnet yang diinginkan! <br><br>  199.116.161.0/24 <br>  199.116.162.0/24 <br>  199.116.164.0/23 <br>  199.116.164.0/24 <br>  199.116.165.0/24 <br>  208.85.40.0/24 <br>  208.85.41.0/24 <br>  208.85.42.0/23 <br>  208.85.42.0/24 <br>  208.85.43.0/24 <br>  208.85.44.0/24 <br>  208.85.46.0/23 <br>  208.85.46.0/24 <br>  208.85.47.0/24 <br><br>  3. Untuk mengurangi jumlah subnet, agregasi harus dilakukan.  Pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ip-calculator.ru/aggregate</a> dan salin daftar kami di sana.  Akibatnya - 6 subnet bukannya 14. <br><br>  199.116.161.0/24 <br>  199.116.162.0/24 <br>  199.116.164.0/23 <br>  208.85.40.0/22 <br>  208.85.44.0/24 <br>  208.85.46.0/23 <br><br>  4. Hapus aturan iptables <br><br> <code>root@debian9:~# iptables -F <br> root@debian9:~# iptables -X <br> root@debian9:~# iptables -t nat -F <br> root@debian9:~# iptables -t nat -X</code> <br> <br>  Aktifkan maju dan NAT <br><br> <code>root@debian9:~# echo 1 &gt; /proc/sys/net/ipv4/ip_forward <br> root@debian9:~# iptables -A FORWARD -i enp0s3 -o enp0s8 -j ACCEPT <br> root@debian9:~# iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT <br> root@debian9:~# iptables -t nat -A POSTROUTING -o enp0s3 -s 192.168.201.0/24 -j MASQUERADE</code> <br> <br>  Agar maju selalu aktif setelah reboot, ubah file <br><br> <code>root@debian9:~# nano /etc/sysctl.conf</code> <br> <br>  Dan batalkan komentar pada garis <br><br>  net.ipv4.ip_forward = 1 <br><br>  Ctrl + X untuk menyimpan file <br><br>  5. Kami membungkus subnet pandora.com di proxy <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.201.0/24 -d 199.116.161.0/24,199.116.162.0/24,199.116.164.0/23,208.85.40.0/22,208.85.44.0/24,208.85.46.0/23 -p tcp -j REDIRECT --to-ports 888</code> <br> <br>  6. Simpan aturannya <br><br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br><h3>  Konfigurasikan dan jalankan Proxy Transparan melalui konfigurasi router </h3><br>  Dalam konfigurasi ini, server proxy transparan dapat berupa PC terpisah atau mesin virtual di belakang router rumah / perusahaan.  Cukup mendaftarkan rute statis pada router atau perangkat dan seluruh subnet akan menggunakan proxy tanpa perlu pengaturan tambahan. <br><br>  PENTING!  Gateway kami perlu menerima IP statis dari router, atau dikonfigurasi untuk statis itu sendiri. <br><br>  1. Konfigurasikan alamat gateway statis (adaptor enp0s3) <br><br> <code>root@debian9:~# nano /etc/network/interfaces</code> <br> <br><div class="spoiler">  <b class="spoiler_title">/ etc / network / interfaces file</b> <div class="spoiler_text">  # File ini menjelaskan antarmuka jaringan yang tersedia di sistem Anda <br>  # dan cara mengaktifkannya.  Untuk informasi lebih lanjut, lihat antarmuka (5). <br><br>  source /etc/network/interfaces.d/* <br><br>  # Antarmuka jaringan loopback <br>  otomatis lo <br>  iface lo inet loopback <br><br>  # Antarmuka jaringan utama <br>  allow-hotplug enp0s3 <br>  iface enp0s3 inet statis <br>  alamat 192.168.23.2 <br>  netmask 255.255.255.0 <br>  gateway 192.168.23.254 <br><br>  # Antarmuka jaringan sekunder <br>  allow-hotplug enp0s8 <br>  iface enp0s8 inet statis <br>  alamat 192.168.201.254 <br>  netmask 255.255.255.0 <br></div></div><br>  2. Izinkan perangkat dari subnet 192.168.23.0/24 menggunakan proxy <br><br> <code>root@debian9:~# iptables -t nat -A PREROUTING -s 192.168.23.0/24 -d 199.116.161.0/24,199.116.162.0/24,199.116.164.0/23,208.85.40.0/22,208.85.44.0/24,208.85.46.0/23 -p tcp -j REDIRECT --to-ports 888</code> <br> <br>  3. Simpan aturan <br> <code>root@debian9:~# iptables-save &gt; /etc/iptables/rules.v4</code> <br> <br>  4. Kami akan mendaftarkan subnet pada router <br><br><div class="spoiler">  <b class="spoiler_title">Daftar jaringan router</b> <div class="spoiler_text">  199.116.161.0 255.255.255.0 192.168.23.2 <br>  199.116.162.0 255.255.255.0 192.168.23.2 <br>  199.116.164.0 255.255.254.0 192.168.23.2 <br>  208.85.40.0 255.255.252.0 192.168.23.2 <br>  208.85.44.0 255.255.255.0 192.168.23.2 <br>  208.85.46.0 255.255.254.0 192.168.23.2 <br></div></div><br><h3>  Bahan / Sumber Daya yang Digunakan </h3><br>  1. Situs web resmi program 3proxy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">3proxy.ru</a> <br><br>  2. Instruksi pemasangan untuk 3proxy dari sumber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.ekzorchik.ru/2015/02/bagaimana-untuk-mengambil-Anda- kaus kaki-proxy</a> <br><br>  3. 3 cabang pengembang proksi di github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/z3APA3A/3proxy/issues/274</a> <br><br></div></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460469/">https://habr.com/ru/post/id460469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460459/index.html">File konfigurasi htaccess</a></li>
<li><a href="../id460461/index.html">Simulasi serangan yang ditargetkan sebagai penilaian keamanan. Instruksi Cyber ‚Äã‚ÄãTeaming Merah</a></li>
<li><a href="../id460463/index.html">Apa yang terjadi dengan GALILEO - Versi Programmer GNSS</a></li>
<li><a href="../id460465/index.html">Digital Shadows - Kompeten Membantu Mengurangi Risiko Digital</a></li>
<li><a href="../id460467/index.html">Kami mencari kerusakan di mobil oleh suara: kami meminta sedikit pembelajaran mesin untuk menemukan anomali di mesin</a></li>
<li><a href="../id460471/index.html">Kesalahan Panel Admin atau Pengalaman Pengembangan Anggrek Laravel</a></li>
<li><a href="../id460473/index.html">Kebisingan putih menarik kotak hitam</a></li>
<li><a href="../id460475/index.html">Remote Control Mobile Lifebuoy</a></li>
<li><a href="../id460479/index.html">Dan boneka teddy bear itu tampak sangat sarat muatan</a></li>
<li><a href="../id460481/index.html">Komputer Kinerja Tanpa Kipas MIC-7000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>