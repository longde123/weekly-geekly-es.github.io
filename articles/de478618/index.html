<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌙 🚶🏿 👨🏽‍🚀 Schule der Magie PHP 🆒 🤾🏾 🙏🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was ist Magie in PHP? Dies bedeutet normalerweise Methoden wie _construct() oder __get() . Die magischen Methoden in PHP sind Lücken, die Entwicklern ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Schule der Magie PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/478618/"> Was ist Magie in PHP?  Dies bedeutet normalerweise Methoden wie <code>_construct()</code> oder <code>__get()</code> .  Die magischen Methoden in PHP sind Lücken, die Entwicklern helfen, erstaunliche Dinge zu tun.  Das Netzwerk ist voll von Anweisungen zu deren Verwendung, mit denen Sie wahrscheinlich vertraut sind.  Aber was ist, wenn wir sagen, dass Sie nicht einmal die wahre Magie gesehen haben?  Denn je mehr du scheinst, alles zu wissen, desto mehr Magie entzieht sich dir. <br><br><img src="https://habrastorage.org/webt/kd/xp/vm/kdxpvmeklgs6av1hp8ldzbnq4vc.jpeg"><br><br>  Lassen Sie uns das etablierte Framework der OOP-Regeln fallen und das Unmögliche an der PHP School of Magic möglich machen.  Der Haupt- und erste Zauberlehrer der Schule ist <b>Alexander Lisachenko</b> ( <a href="https://habr.com/ru/users/nighttiger/" class="user_link">NightTiger</a> ).  Er wird das magische Denken unterrichten und vielleicht werden Sie magische Methoden, nicht standardisierte Methoden zum Zugreifen auf Eigenschaften, Ändern von Kontexten, aspektorientiertes Programmieren und Stream-Filter lieben. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1W3UR7v3sAo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Alexander Lisachenko</b> ist der Leiter der Abteilung für Webentwicklung und Architektur in Alpari.  Der Autor und Hauptentwickler des aspektorientierten Frameworks <a href="http://go.aopphp.com/">Go!</a>  <a href="http://go.aopphp.com/">Aop</a> .  Referent bei internationalen Konferenzen zu PHP. <br><br>  In dem guten Film "Die Illusion der Täuschung" gibt es einen Satz: <br><blockquote>  "Je näher du bist, desto weniger siehst du." </blockquote><br>  Dasselbe gilt für PHP als Zaubertrick, mit dem Sie ungewöhnliche Dinge tun können.  Aber zuallererst wurde es geschaffen, um Sie zu täuschen: "... eine Handlung, die dazu gedacht ist, entweder jemanden zu betrügen, oder als Witz oder Form der Unterhaltung." <br><br>  Wenn wir PHP zusammen nehmen und versuchen, etwas Magisches darauf zu schreiben, werde ich Sie höchstwahrscheinlich täuschen.  Ich werde einen Trick machen, und Sie werden sich lange fragen, warum dies passiert.  Das liegt daran, dass PHP eine Programmiersprache ist, die für ihre ungewöhnlichen Dinge bekannt ist. <br><br><h2>  Magische Ausrüstung </h2><br>  Was brauchen wir von magischer Ausrüstung?  Schmerzlich vertraute Methoden. <br><br> <code>__construct(), __destruct(), __clone(), <br> __call(), __callStatic(), <br> __get(), __set(), __isset(), __unset(), <br> __sleep(), __wakeup(), <br> __toString(), __invoke(), __set_state(), <br> __debugInfo()</code> <br> <br>  Ich werde die letzte Methode separat erwähnen - damit können Sie ungewöhnliche Dinge aufdrehen.  Das ist aber noch nicht alles. <br><br><ul><li>  <code>declare(ticks=1)</code> . <br></li><li>  <code>debug_backtrace()</code> .  Dies ist unser Begleiter, um zu verstehen, wo wir uns im aktuellen Code befinden, wer uns angerufen hat und warum, mit welchen Argumenten.  Nützlich, um zu entscheiden, nicht der ganzen Logik zu folgen. <br></li><li>  <code>unset(), isset()</code> .  Es scheint nichts Besonderes zu sein, aber diese Designs verbergen eine Menge Tricks, die wir weiter betrachten werden. <br></li><li>  <code>by-reference passing</code> .  Wenn wir ein Objekt oder eine Variable als Referenz übergeben, sollten wir damit rechnen, dass Ihnen unweigerlich etwas Magie zustoßen wird. <br></li><li>  <code>bound closures</code> .  Auf den Verschlüssen und der Tatsache, dass sie binden können, können Sie viele Tricks bauen. <br></li><li>  Mit der Reflection-API können Sie die Reflektion auf eine neue Ebene heben. <br></li><li>  StreamWrapper-API. <br></li></ul><br>  Die Ausrüstung ist fertig - ich werde die erste Regel der Magie erinnern. <br><br><blockquote>  Sei immer der klügste Kerl im Raum. </blockquote><br><h2>  Trick Nr. 1.  Unmöglicher Vergleich </h2><br>  Beginnen wir mit dem ersten Trick, den ich Impossible Comparison nenne. <br>  Schauen Sie sich den Code genau an und prüfen Sie, ob dies in PHP möglich ist. <br><br><img src="https://habrastorage.org/webt/ji/sd/8i/jisd8ip2pzz7kx9otvdxq8_c-k4.png"><br><br>  Es gibt eine Variable, wir deklarieren ihren Wert und dann ist sie plötzlich nicht mehr gleich sich selbst. <br><br><h3>  Nicht eine Nummer </h3><br>  Es gibt solch ein magisches Artefakt wie NaN - Not-a-Number. <br><br><img src="https://habrastorage.org/webt/gf/fw/3b/gffw3bl5rfz8xz1br3ut9ocmhnw.jpeg"><br><br>  Das Erstaunliche ist, dass es sich selbst nicht ebenbürtig ist.  Und dies ist unser erster Trick: Verwende NaN, um einen Freund zu rätseln.  NaN ist jedoch nicht die einzige Lösung für diese Aufgabe. <br><br><h3>  Wir verwenden Konstanten </h3><br><img src="https://habrastorage.org/webt/7c/hd/l1/7chdl1uranfz-cg9lbhc078ipnq.jpeg"><br><br>  Der Trick ist, dass wir <code>false</code> für <code>namespace</code> und compare als <code>true</code> deklarieren können.  Der unglückliche Entwickler wird sich lange fragen, warum es <code>true</code> und nicht <code>false</code> . <br><br><h3>  Handler </h3><br>  Der nächste Trick ist eine stärkere Artillerie als die beiden vorherigen.  Mal sehen, wie es funktioniert. <br><br><img src="https://habrastorage.org/webt/xj/3g/5j/xj3g5jvenlytadytgnqth9yb47c.jpeg"><br><br>  Der Trick basiert auf <code>tick_function</code> und <code>tick_function</code> , wie <code>tick_function</code> <code>declare(ticks=1)</code> <code>tick_function</code> <code>declare(ticks=1)</code> . <br><br>  Wie funktioniert das alles?  Zuerst deklarieren wir eine Funktion, und als Referenz wird der <code>isMagic</code> Parameter verwendet. Anschließend wird versucht, diesen Wert in <code>true</code> zu ändern.  Nachdem wir <code>declare(ticks=1)</code> deklariert haben <code>declare(ticks=1)</code> ruft der PHP-Interpreter nach jeder elementaren Operation <code>register_tick_function</code> - callback auf.  In diesem Rückruf können wir den Wert, der zuvor <code>false</code> in <code>true</code> ändern.  Die Magie! <br><br><h2>  Trick Nr. 2.  Magische Ausdrücke </h2><br>  Nehmen Sie ein Beispiel, in dem zwei Variablen deklariert sind.  Einer von ihnen ist <code>false</code> , der andere ist <code>true</code> .  Wir <code>isBlack</code> und <code>isWhite</code> und var_dump das Ergebnis.  Was denkst du wird das Ergebnis sein? <br><br><img src="https://habrastorage.org/webt/yy/5r/kx/yy5rkxfp5zdicpodqjrutq1diri.png"><br><br>  <b>Vorrangige Bediener</b> .  Die richtige Antwort ist <code>false</code> , weil es in PHP so etwas wie „Operator-Priorität“ gibt. <br><br><img src="https://habrastorage.org/webt/tm/8e/uf/tm8eufef1fi8j46c3fc3xbgl1z8.jpeg"><br><br>  Überraschenderweise hat der logische Operator <code>or</code> die Zuweisung weniger Priorität als die Operation.  Daher wird einfach <code>false</code> zugewiesen.  In <code>isWhite</code> kann es einen beliebigen anderen Ausdruck geben, der ausgeführt wird, wenn der erste Teil fehlschlägt. <br><br><h3>  Magische Ausdrücke </h3><br>  Schauen Sie sich den folgenden Code an.  Es gibt eine Klasse, die den Konstruktor enthält, und eine Factory, deren Code weiter unten angegeben wird. <br><br><img src="https://habrastorage.org/webt/bk/md/w5/bkmdw5zdb6bxcpml7jzygu9vjhs.jpeg"><br><br>  Achten Sie auf die letzte Zeile. <br><br><pre> <code class="php hljs">$value = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $factory-&gt;build(Foo::class);</code> </pre> <br>  Es gibt verschiedene Möglichkeiten, die auftreten können. <br><br><ul><li>  <code>$factory</code> wird als Klassenname <code>new</code> ; <br></li><li>  es wird ein Parsing-Fehler auftreten; <br></li><li>  es wird der Aufruf <code>$factory-&gt;build()</code> verwendet, dessen Wert diese Funktion <code>$factory-&gt;build()</code> , das Ergebnis ist <code>new</code> ; <br></li><li>  Der Wert der Eigenschaft <code>$factory-&gt;build</code> wird zum <code>$factory-&gt;build</code> der Klasse verwendet. <br></li></ul><br>  Schauen wir uns die letzte Idee an.  In der Klasse <code>$factory</code> deklarieren wir eine Reihe magischer Funktionen.  Sie schreiben, was wir tun: Rufen Sie die Eigenschaft auf, rufen Sie die Methode auf oder versuchen Sie sogar, <code>invoke</code> für das Objekt <code>invoke</code> . <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Getting property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $arg)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Calling method {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Invoking {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} }</code> </pre> <br>  Die richtige Antwort: Wir rufen keine Methode auf, sondern eine Eigenschaft.  Nach <code>$factory-&gt;build</code> gibt es einen Parameter für den Konstruktor, den wir an diese Klasse übergeben. <br><br>  Übrigens habe ich in diesem Framework eine Funktion namens "Abfangen der Erstellung neuer Objekte" implementiert - Sie können dieses Design "sperren". <br><br><h3>  Parser-Lücke </h3><br>  Das folgende Beispiel ist für den PHP-Parser selbst.  Haben Sie jemals versucht, Funktionen aufzurufen oder Variablen in geschweiften Klammern zuzuweisen? <br><br><img src="https://habrastorage.org/webt/wi/b5/kb/wib5kbzb1j_0gzdurptouztvb7u.jpeg"><br><br>  Ich habe diesen Trick auf Twitter, es funktioniert extrem nicht-Standard. <br><br><pre> <code class="php hljs">$result = ${<span class="hljs-string"><span class="hljs-string">'_'</span></span> . !$_=getCallback()}(); $_=getCallback(); <span class="hljs-comment"><span class="hljs-comment">// string(5) "hello" !$_=getCallback()}(); // bool(false) '_'.!$_=getCallback()}(); // string(1) "_" ${'_'.!$_=getCallback()}(); // string(5) "hello"</span></span></code> </pre> <br>  Zunächst weisen wir der Variablen <code>_</code> (Unterstrich) den Wert des Ausdrucks zu.  Wir haben bereits eine Variable, wir versuchen, ihren Wert logisch zu invertieren, und wir bekommen <code>false</code> - die Zeile wird wie auf <code>true</code> .  Dann kleben wir alles im Variablennamen zusammen, durch den wir uns dann in die geschweiften Klammern drehen. <br><br><blockquote>  Was ist Magie?  Dies ist Unterhaltung, die es uns ermöglicht, uns inspiriert und ungewöhnlich zu fühlen und zu sagen: „Was?  Also war es möglich?! " </blockquote><br><h2>  Trick Nr. 3.  Regeln brechen </h2><br>  Was ich an PHP mag, ist, dass Sie die Regeln brechen können, die jeder erstellt, um supersicher zu sein.  Es gibt ein Design namens "Sealed Class", das einen privaten Konstruktor hat.  Ihre Aufgabe als Schüler des Magiers ist es, eine Instanz dieser Klasse zu erstellen. <br><br><img src="https://habrastorage.org/webt/rt/uw/h4/rtuwh49inyhecfbsbea1hvb6kq4.jpeg"><br><br>  Betrachten Sie dazu drei Möglichkeiten. <br><br><h3>  Umgehung </h3><br>  Der erste Weg ist der offensichtlichste.  Es sollte jedem Entwickler bekannt sein - dies ist die Standard-API, die uns die Sprache bietet. <br><br><img src="https://habrastorage.org/webt/w2/or/df/w2ordfmqdhs3qg-nnzbff9yiilc.png"><br><br>  Mit <code>newInstanceWithoutConstructor</code> Konstrukt <code>newInstanceWithoutConstructor</code> können Sie die Spracheinschränkungen umgehen, die für den Konstruktor gelten, und eine Instanz der Klasse erstellen, die alle unsere privaten Konstruktordeklarationen umgeht. <br><br>  Die Option funktioniert, ist einfach, bedarf keiner Erklärung. <br><br><h3>  Kurzschluss </h3><br>  Die zweite Option erfordert mehr Aufmerksamkeit und Geschicklichkeit.  Es wird eine anonyme Funktion erstellt, die dann an den Fischadler dieser Klasse gebunden wird. <br><br><img src="https://habrastorage.org/webt/2z/6k/lz/2z6klzhpzlkbcglexaslmiu9ezo.png"><br><br>  Hier sind wir in der Klasse und können sicher private Methoden aufrufen.  Wir verwenden dies, indem wir <code>new static</code> aus dem Kontext unserer Klasse aufrufen. <br><br><img src="https://habrastorage.org/webt/fn/v5/ul/fnv5ulkueuayx56vd07u7tfk128.png"><br><br><h3>  Deserialisierung </h3><br>  Die dritte Option ist meiner Meinung nach die am weitesten fortgeschrittene. <br><br><img src="https://habrastorage.org/webt/ky/qi/xb/kyqixbfapmoxxaisd6g3mlypuny.png"><br><br>  Wenn Sie eine bestimmte Zeile in einem bestimmten Format schreiben, ersetzen Sie dort bestimmte Werte - unsere Klasse wird sich herausstellen. <br><br><img src="https://habrastorage.org/webt/d2/0k/fi/d20kfibw1fnqmmovhc90_mqb1sy.png"><br><br>  Nach der Deserialisierung erhalten wir unsere <code>instance</code> . <br><br><h3>  Doktrin / Instantiator-Paket </h3><br>  Magie wird oft zu einem dokumentierten Framework oder einer Bibliothek - zum Beispiel in <b>Doctrine / Instantiator wird</b> all dies implementiert.  Wir können beliebige Objekte mit beliebigem Code erstellen. <br><br><pre> <code class="plaintext hljs">composer show doctrine/instantiator --all name : doctrine/instantiator descrip. : A small, lightweight utility to instantiate objects in PHP without invoking their constructors keywords : constructor, instantiate type : library license : MIT License (MIT)</code> </pre> <br><h2>  Trick Nr. 4.  Abfangen des Zugangs zu Eigentum </h2><br>  Die Wolken ziehen auf: Die Klasse ist geheim, die Eigenschaften und der Konstruktor sind privat und auch der Rückruf. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Secret</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $secret = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Secret is: '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;secret; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPropAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Accessing property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">100500</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// How to create a secret instance and intercept the secret value?</span></span></code> </pre> <br>  Unsere Aufgabe als Assistenten ist es, einen Rückruf zu tätigen. <br><br><h3>  Hinzufügen der Magie ... Getter </h3><br>  Fügen Sie eine Prise Magie hinzu, damit es funktioniert. <br><br><img src="https://habrastorage.org/webt/p7/ut/2w/p7ut2w699vysx99jnvmxvr0akfy.png"><br><br>  Diese Prise Magie ist ein magischer <code>getter</code> .  Es ruft eine Funktion auf, und bisher ist nichts Schlimmes passiert.  Wir werden jedoch den vorherigen Trick anwenden und eine Instanz dieses Objekts erstellen, die das private Konstrukt umgeht. <br><br><img src="https://habrastorage.org/webt/b0/oy/gu/b0oyguiksznuw3rzfn19rsz1s4y.jpeg"><br><br>  Jetzt müssen wir den Rückruf irgendwie anrufen. <br><br><h3>  "Unset" im Schaltkreis </h3><br>  Erstellen Sie dazu einen Abschluss.  Innerhalb des Abschlusses, der sich im Gültigkeitsbereich der Klasse befindet, löschen wir diese Variable mit der Funktion <code>unset()</code> . <br><br><img src="https://habrastorage.org/webt/-n/2l/md/-n2lmdkswrc0cgk6tcobilajlgk.jpeg"><br><br>  <code>unset</code> können Sie eine Variable vorübergehend ausschließen, wodurch unsere magic <code>get</code> Methode aufgerufen werden kann. <br><br><h3>  Wir rufen den privaten Konstrukteur an </h3><br>  Da wir einen privaten Konstruktor haben, der <code>echo</code> anzeigt, können Sie diesen Konstruktor einfach abrufen und durch Aufrufen zugänglich machen. <br><br><img src="https://habrastorage.org/webt/1z/-g/vo/1z-gvohztwjnrbeujkiwecxdowi.jpeg"><br><br>  Also zerfiel unsere Geheimklasse. <br><br><img src="https://habrastorage.org/webt/om/cv/ef/omcvefwmkjdrmnvuepdf3mmvf5k.png"><br><br>  Wir haben eine Nachricht erhalten, dass wir: <br><br><ul><li>  abgefangen; <br></li><li>  etwas ganz anderes zurückgegeben. <br></li></ul><br><h3>  Leedavis / Altr-Ego-Paket </h3><br>  Viel Magie ist bereits dokumentiert.  Das <b>altr-ego-</b> Paket gibt nur vor, Ihre Komponente zu sein. <br><br><pre> <code class="plaintext hljs">composer show leedavis81/altr-ego --all name : leedavis81/altr-ego descrip. : Access an objects protected / private properties and methods keywords : php, break scope versions : dev-master, v1.0.2, v1.0.1, v1.0.0 type : library license : MIT License (MIT)</code> </pre> <br>  Sie können eines Ihrer Objekte erstellen und ein zweites daran anhängen.  Dadurch können Änderungen an der Einrichtung vorgenommen werden.  Er wird sich gehorsam verändern und alle Ihre Wünsche erfüllen. <br><br><h2>  Trick Nr. 5.  Unveränderliche Objekte in PHP </h2><br>  Gibt es unveränderliche Objekte in PHP?  Ja und eine sehr, sehr lange Zeit. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Magic</span></span> { $<span class="hljs-title"><span class="hljs-title">object</span></span> = (<span class="hljs-title"><span class="hljs-title">object</span></span>) [ "\0<span class="hljs-title"><span class="hljs-title">Secret</span></span>\0<span class="hljs-title"><span class="hljs-title">property</span></span>" =&gt; '<span class="hljs-title"><span class="hljs-title">test</span></span>' ]; var_dump($object); }</code> </pre> <br>  Erhalten Sie sie einfach auf interessante Weise.  Das Interessante ist, dass wir ein Array mit einem <b>speziellen Schlüssel</b> erstellen.  Es beginnt mit der Konstruktion <code>\0</code> - dies ist ein Null-Byte-Zeichen, und nach <code>Secret</code> wir auch <code>\0</code> . <br><br>  Das Konstrukt wird in PHP verwendet, um eine private Eigenschaft innerhalb einer Klasse zu deklarieren.  Wenn wir versuchen, ein Objekt in ein Array umzuwandeln, sehen wir dieselben Schlüssel.  Wir werden nichts als <code>stdClass</code> .  Es enthält eine Privateigenschaft aus der Klasse <code>Secret</code> , die <code>test</code> . <br><br><pre> <code class="php hljs">object(stdClass) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-string"><span class="hljs-string">'property'</span></span> (Secret) =&gt; string <span class="hljs-string"><span class="hljs-string">'test'</span></span> (length=<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br>  Das einzige Problem ist, dass Sie diese Eigenschaft von dort aus nicht erhalten können.  Es ist erstellt, aber nicht verfügbar. <br><br>  Ich fand es ziemlich unpraktisch - wir haben unveränderliche Objekte, aber Sie können es nicht verwenden.  Daher entschied ich mich, dass es Zeit war, meine Entscheidung einzureichen.  Ich habe mein gesamtes Wissen und meine Magie, die in PHP verfügbar sind, genutzt, um eine Konstruktion zu erstellen, die auf all unseren Zaubertricks basiert. <br><br>  <b>Beginnen wir mit einem einfachen: Erstellen Sie ein DTO</b> und versuchen Sie, alle darin enthaltenen Eigenschaften abzufangen (siehe den vorherigen Trick). <br><br>  <b>Wir speichern an einem sicheren Ort die Werte</b> , die wir von dort erfassen.  Sie werden mit keiner Methode zugänglich sein: weder <code>reflection</code> , noch Verschlüsse, noch andere Magie.  Aber es besteht Unsicherheit - gibt es einen solchen Platz in PHP, der garantiert, dass einige Variablen gespeichert werden, damit kein schlauer junger Programmierer dorthin gelangt? <br><br>  <b>Wir bieten eine magische Methode</b> , mit der Sie diesen Wert ablesen können.  Zu diesem <code>isset</code> verfügen wir über Magic <code>getters</code> , Magic <code>isset</code> Methoden, mit denen wir APIs bereitstellen können. <br><br>  Kehren wir zu einem verlässlichen Ort zurück und versuchen zu suchen. <br><br><ul><li>  <code>Global variables</code> gelöscht - jeder kann sie ändern. <br></li><li>  <code>Public properties</code> ebenfalls nicht geeignet. <br></li><li>  <code>Protected properties</code> so lala, weil die untergeordnete Klasse durchkommt. <br></li><li>  <code>Private properties</code> .  Es gibt kein Vertrauen, weil es durch Schließen oder durch <code>reflection</code> verändert werden kann. <br></li><li>  <code>Private static properties</code> können ausprobiert werden, aber auch die <code>reflection</code> unterbrochen. <br></li></ul><br>  Es scheint, dass es keinen Ort gibt, an dem man die Werte von Variablen verbergen kann.  Aber es gab eine magische Sache - <code>Static variables in functions</code> - das sind Variablen, die sich in Funktionen befinden. <br><br><h3>  Sichere Aufbewahrung von Werten </h3><br>  Ich habe <b>Nikita Popov</b> und <b>Jay Watkins</b> auf dem speziellen Stack Overflow-Kanal danach gefragt. <br><br><img src="https://habrastorage.org/webt/dz/lg/ev/dzlgevsl3qi9lwbi91sjwladbpu.png"><br><br>  Dies ist eine Funktion, in der eine statische Variable deklariert wird.  Kann man das irgendwie ändern?  Die Antwort lautet nein. <br><br>  Wir haben eine kleine Lücke in der Welt der geschützten Variablen gefunden und wollen sie nutzen. <br><br><h3>  Werte per Link übergeben </h3><br>  Wir werden es nicht standardmäßig als Eigentum des Objekts verwenden.  Da Sie jedoch keine Eigenschaft übergeben können, verwenden wir die klassische Übertragung von Werten als Referenz. <br><br><img src="https://habrastorage.org/webt/xr/qe/vn/xrqevnya2a0a8mizylf8gbimfb8.jpeg"><br><br>  Es stellt sich heraus, dass es eine Klasse gibt, in der es eine magische <code>callStatic</code> Methode gibt, in der die <code>Static</code> Variable deklariert ist.  Bei jedem Aufruf einer Funktion übergeben wir den Wert der Variablen aus dem Immutable-Objekt unter Bezugnahme auf alle unsere verschachtelten Methoden.  Wir stellen also irgendwie den Kontext zur Verfügung. <br><br><h3>  Zustand speichern </h3><br>  Mal sehen, wie der Zustand gerettet wird. <br><br><img src="https://habrastorage.org/webt/ef/5j/tm/ef5jtmjn0yuws-_nkbegq0neqag.png"><br><br>  Es ist ziemlich einfach.  Für das übertragene Objekt verwenden wir die Funktion <code>spl_object_id</code> , die für jede Instanz einen eigenen Bezeichner zurückgibt.  Der <code>State</code> , den wir bereits von dem Objekt erhalten haben, versucht dort zu retten.  Nichts Besonderes. <br><br><h3>  Wenden Sie den Status des Objekts an </h3><br>  Auch hier gibt es eine Konstruktion zum Übergeben von Werten anhand von Referenzen und nicht <code>unset</code> Eigenschaften.  Wir deaktivieren alle aktuellen Eigenschaften, nachdem wir sie zuvor in der Statusvariablen gespeichert haben, und legen diesen Kontext für das Objekt fest.  Das Objekt enthält keine Eigenschaften mehr, sondern nur seinen Bezeichner, der mit <code>spl_object_id</code> deklariert und an dieses Objekt angehängt wird, solange es noch aktiv ist. <br><br><img src="https://habrastorage.org/webt/tl/gp/b9/tlgpb9z5yi8ibnwqmod_kifacrq.jpeg"><br><br><h3>  Status abrufen </h3><br>  Dann ist alles einfach. <br><br><img src="https://habrastorage.org/webt/2n/om/aq/2nomaqdui4jxeusbrlzucow9dck.png"><br><br>  Wir bekommen diesen Zusammenhang auf den Magic <code>getter</code> und nennen unser Eigentum daraus.  Jetzt kann niemand und nichts den Wert ändern, nachdem dieses <code>Trait</code> verbunden wurde. <br><br><img src="https://habrastorage.org/webt/m7/iu/_y/m7iu_yazwpqoc4hxhlg6rv4srbo.png"><br><br>  Alle magischen Methoden werden überschrieben und implementieren die Unveränderlichkeit des Objekts. <br><br><img src="https://habrastorage.org/webt/jy/he/ht/jyheht4ncrsuwsh7ngerdnd5x4m.jpeg"><br><br><h3>  Lisachenko / unveränderliches Objekt </h3><br>  Wie erwartet ist alles sofort in der Bibliothek formalisiert und einsatzbereit. <br><br><pre> <code class="plaintext hljs">composer show /immutable-object --all name : /immutable-object descrip. : Immutable object library keywords : versions : * dev-master type : library license : MIT License (MIT)</code> </pre> <br>  Die Bibliothek sieht ziemlich einfach aus.  Wir verbinden es und schaffen unsere Klasse.  Es hat verschiedene Eigenschaften: privat, geschützt und öffentlich.  Wir verbinden <code>ImmutableTrait</code> . <br><br><img src="https://habrastorage.org/webt/xj/gt/pe/xjgtpettshurwn257f51iaj5u78.jpeg"><br><br>  Danach können Sie das Objekt einmalig initiieren - siehe Wert.  Es ist dort wirklich gespeichert und sieht sogar aus wie ein echter DTO. <br><br><pre> <code class="php hljs">object (MagicObject) [<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; int <span class="hljs-number"><span class="hljs-number">200</span></span></code> </pre> <br>  Aber wenn wir versuchen, es zu ändern, zum Beispiel so ... <br><br><img src="https://habrastorage.org/webt/su/s2/dh/sus2dhhps9ts4gwpx5nxk9301m4.jpeg"><br><br>  ... dann bekomme sofort eine <code>fatal exception</code> .  Wir können eine Eigenschaft nicht ändern, da sie unveränderlich ist.  Wie so <br><br><img src="https://habrastorage.org/webt/sh/iy/1c/shiy1cl8vmbfmwzbmah8whsbnyu.png"><br><br>  Wenn Sie sich auf eine aufregende Herausforderung einlassen und versuchen, sie zu entwerten, erhalten Sie Folgendes. <br><br><img src="https://habrastorage.org/webt/ga/ym/l6/gayml6qurl3mr1o6qpvhzk1_rgi.png"><br><br>  Das ist mein Geschenk.  Sobald Sie versuchen, in PHPStorm innerhalb dieser Klasse einen Fehler zu machen, wird die Ausführung Ihres Befehls sofort gestoppt.  Ich möchte nicht, dass Sie sich mit diesem Code befassen - er ist zu gefährlich.  Er wird warnen, dass es nichts zu tun gibt. <br><br><h2>  Trick Nr. 6.  Thread-Verarbeitung </h2><br>  Betrachten Sie das Design. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'php://filter/read=string.toupper/resource=magic.php'</span></span>;</code> </pre> <br>  Es gibt etwas Magisches: Ein PHP-Filter, <code>read</code> , am Ende ist eine Art magic.php- <b>Datei angeschlossen</b> .  Diese Datei sieht ziemlich einfach aus. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Hello, world!'</span></span></code> </pre> <br>  Beachten Sie, dass der Fall anders ist.  Wenn wir die Datei jedoch über unser Design „füllen“, erhalten wir Folgendes: <br><br><pre> <code class="php hljs">HELLO, WORLD!</code> </pre> <br>  Was ist in diesem Moment passiert?  Durch die Verwendung der Konstruktion des PHP-Filters in <code>include</code> können Sie jeden Filter, einschließlich Ihres Filters, anschließen, um den Quellcode zu analysieren.  Sie verwalten alles in diesem Quellcode.  Sie können <code>final</code> aus Klassen und Methoden entfernen, Eigenschaften öffentlich machen - alles, was Sie durch dieses Ding drehen können. <br><br>  Ein Teil meines Aspekt-Frameworks basiert darauf.  Wenn Ihre Klasse verbunden ist, analysiert sie sie und wandelt sie in das um, was ausgeführt wird. <br><br>  In PHP gibt es bereits eine ganze Reihe von vorgefertigten Filtern. <br><br><pre> <code class="php hljs">var_dump(stream_get_filters()); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (size=<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'zlib.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'bzip2.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.iconv.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">' string.rotl3'</span></span> (length=<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.toupper'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.tolower'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.strip_tags'</span></span> (length=<span class="hljs-number"><span class="hljs-number">17</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'consumed'</span></span> (length=<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'dechunk'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br>  Sie können den Inhalt "zip", in Groß- oder Kleinschreibung übersetzen. <br><br>  Die wichtigsten Tricks, die ich zeigen wollte, sind vorbei.  Kommen wir nun zur Quintessenz von allem, was ich tun kann - aspektorientierte Programmierung. <br><br><h2>  Trick Nr. 7.  Aspektorientierte Programmierung </h2><br>  Schauen Sie sich diesen Code an und überlegen Sie, ob er aus Ihrer Sicht gut oder schlecht ist. <br><br><img src="https://habrastorage.org/webt/xx/za/wa/xxzawap4whyavczg4g5ptvsx6q0.jpeg"><br><br>  Der Code scheint völlig ausreichend zu sein.  Es überprüft die Zugriffsrechte, führt die Protokollierung durch, erstellt einen Benutzer, bleibt bestehen und versucht, eine <code>exception</code> abzufangen. <br><br>  Wenn Sie sich all diese Nudeln ansehen, wird dies bei jeder unserer Methoden wiederholt, und das einzig Wertvolle dabei ist, dass sie grün markiert sind. <br><br><img src="https://habrastorage.org/webt/uk/za/mo/ukzamorqli1-u6wijf7d7knpwu4.jpeg"><br><br>  Alles andere: "Nebenbedenken" oder "Querschnittsbedenken" sind Querschnittsfunktionen. <br><br>  Herkömmliches OOP macht es unmöglich, alle diese Strukturen mit Copy-Paste zu kopieren, zu entfernen und irgendwo herauszunehmen.  Das ist schlecht, weil man es wiederholen muss.  Ich wünschte, der Code sah immer sauber und ordentlich aus. <br><br><img src="https://habrastorage.org/webt/hg/vw/pm/hgvwpmdhsbhaeeh0uj5tdngunqo.jpeg"><br><br>  Damit es keine Protokollierung enthält (lass es irgendwie angewendet werden) und keine <code>security</code> enthält. <br><br><img src="https://habrastorage.org/webt/yz/-4/i2/yz-4i2yxrju_ti0839xg7idj5ua.jpeg"><br><br>  Das ist also alles, einschließlich Protokollierung ... <br><br><img src="https://habrastorage.org/webt/sb/g1/8u/sbg18ud79gi4fg2dhc4h__ojxie.jpeg"><br><br>  ... und eine Sicherheitskontrolle, ... <br><br><img src="https://habrastorage.org/webt/3p/-s/07/3p-s07k5zl65ze55vxs4iddkia8.jpeg"><br><br>  ... von selbst durchgeführt. <br><br>  Und es ist möglich. <br><br><h3>  Glossar "Aspekt" </h3><br>  Es gibt eine Sache namens Aspekt.  Dies ist ein einfaches Beispiel, das Berechtigungen überprüft.  Dank ihm können Sie einige Anmerkungen sehen, die auch durch das Plugin für PhpStorm hervorgehoben werden.  "Aspect" deklariert SQL-Ausdrücke, auf welche Punkte im Code diese Bedingung angewendet werden soll.  Im Folgenden möchten wir beispielsweise einen Abschluss auf alle öffentlichen Methoden der <code>UserService</code> Klasse <code>UserService</code> . <br><br><img src="https://habrastorage.org/webt/jx/y_/g4/jxy_g4pvoli4gjezfp3w1vqpkpi.jpeg"><br><br>  Wir erhalten den Abschluss mit der Methode <code>$invocation</code> . <br><br><img src="https://habrastorage.org/webt/ym/ju/mp/ymjump3eozldipcvntd-lpo9zbi.jpeg"><br><br>  Dies ist eine Art Wrapper über der <code>reflection</code> , die weitere Argumente enthält. <br><br>  Weiter können Sie in diesem Callback für jede Methode die notwendigen Zugriffsrechte überprüfen, dies wird als "Advice" bezeichnet. <br><br><img src="https://habrastorage.org/webt/i8/zz/pq/i8zzpqsvck05an3amyc8hihxj00.jpeg"><br><br>  Wir sagen sozusagen die Sprache: "Lieber PHP, bitte wenden Sie diese Methode vor jedem Aufruf der öffentlichen Methode der <code>UserService</code> Klasse an <code>UserService</code> "  Nur eine Zeile, aber sehr nützlich. <br><br><h3>  Aspekt vs Ereignis-Listener </h3><br>  Um es klarer zu machen, habe ich Aspect mit Event Listener verglichen.  Viele arbeiten bei Symfony und wissen, was Event Dispatcher ist. <br><br><img src="https://habrastorage.org/webt/5v/8o/ge/5v8oge0pczc4pteufmb0bvxf-da.jpeg"><br><br>  Sie ähneln sich darin, dass wir eine Art Abhängigkeit übergeben, z. B. <code>AutorizationChecker</code> , und <code>AutorizationChecker</code> , wo in diesem Fall die Anwendung erfolgen soll.  Im Fall von Listener ist dies ein <code>SubscrabingEvent</code> Namen <code>UserCreate</code> . Im Fall von <code>Aspect</code> abonnieren wir alle Aufrufe öffentlicher Methoden vom <code>UserService</code> .       callback  :   -    . <br><br> ,      . <br><br> <b> </b> ,    ,  <b></b> <code>Aspects</code> . <br><br><img src="https://habrastorage.org/webt/-i/ae/iy/-iaeiyqqw4oar3tyxzbe4au38n8.jpeg"><br><br> <b> </b> .   ,    <b>  PHP-</b> . <br><br><img src="https://habrastorage.org/webt/6z/sq/da/6zsqda5rxa9alxpilq57s0wyspc.jpeg"><br><br>   ,     .    ,      ,     OPcache. <br><br> <b> </b> .     <code>Composer</code> .    Go! AOP,      <code>Composer</code>    ,    . <br><br><img src="https://habrastorage.org/webt/or/v8/l9/orv8l9yh9swl-mxtzowmrzoomm4.jpeg"><br><br>         <code>Aspects</code> ,   <code>Aspects</code> .       . <br><br>     . <br><br> <b>PHP-Parser</b> .     ,   ,      <b></b> . ,      <b> </b> ,  <a href="https://github.com/nikic/PHP-Parser">PHP-Parser</a> .           . <br><br><img src="https://habrastorage.org/webt/eg/ys/dm/egysdmlqf0bbvkmnacewmrrx-bw.jpeg"><br><br> <b> </b> .     ,   <b>goaop/parser-reflection</b> . <br><br><img src="https://habrastorage.org/webt/b_/oc/6d/b_oc6dfphlk-dtq3jxoijxzmn3i.jpeg"><br><br>    AST-      ,     .    ,        ,       ,       . <br><br>      . <br><br><img src="https://habrastorage.org/webt/9p/lu/an/9pluanmjyprlie0muf8sndyudba.jpeg"><br><br> ,         ,     <code>Aspect</code> . <br><br><img src="https://habrastorage.org/webt/3u/36/3z/3u363ztvggoi6ugvvsunvuilvuy.jpeg"><br><br>            ,     . <br><br><img src="https://habrastorage.org/webt/7z/tv/8p/7ztv8pyc8zti-wlpidlp3fm2zqk.jpeg"><br><br>    ,             ,       .      —     ,   -   ,      . <br><br><img src="https://habrastorage.org/webt/ea/o9/zn/eao9znftd3ywdjzd14acr-9w-fe.png"><br><br>      ,    .      ,   . <br><br>      Aspect MOCK.   «»,      ,   .     . <br><br>       —   <code>joinPoint</code> .   -    <code>joinPoint</code> :  ,   ,    . <br><br><h3>  Was weiter? </h3><br>    . <br><br> <b>OPcache preloading for AOP Core</b> .  AOP-      .          10   . Bootstrapping     ,       PHP. <br><br> <b>FFI integration to modify binary opcodes</b> . ,    ,    .     PHP-opcodes,        <code>.bin</code> .   FFI  . <br><br> <b>Modifying PHP engine internal callbacks</b>   PHP-   userland.  PHP   .   FFI  PHP     userland,       , , .     . <br><br>    ,   . <br><br><h2>  #8. goaop/framework </h2><br>   ,   <a href="https://github.com/goaop/framework"> GitHub</a>       . <br><br><pre> <code class="plaintext hljs">composer show goaop/framework --all name : goaop/framework descrip. : Framework for aspect-oriented programming in PHP. keywords : php, aop, library, aspect versions : dev-master, 3.0.x-dev, 2.x-dev, 2.3.1, … type : library license : MIT License</code> </pre> <br>    ,        PhpStorm. <br><br><img src="https://habrastorage.org/webt/ut/ah/rp/utahrp4yrgxj7ch2d0brjr_p7fk.jpeg"><br><br>   ,     Pointcuts.  ,    ,  .     —    ,   ,     . <br><br><h2> Trick #9.   </h2><br>          . ,    . <br><br>   :  ,   -    .           <code>fastcgi_finish_request</code> .    ,      ,   , - callback  —   . <br><br>         ? <br><br>   ,   <code>Deffered</code> ,  ,       . <br><br><img src="https://habrastorage.org/webt/yy/zh/7d/yyzh7dcpvv14sd3r75kroe07xky.jpeg"><br><br>    <code>Aspect</code> ,  ,    ,   <code>Deffered</code> ,    . <br><br><img src="https://habrastorage.org/webt/cc/y5/zj/ccy5zjad0olfwzemsxmnmo8mi_c.png"><br><br>   <code>Aspect</code>    :  ,  , ,      callback,  ,     callback.      . <br><br>  React ,     <code>promise</code> .     ,  -    ,  -     ,   . <br><br> ,       . <br><br><img src="https://habrastorage.org/webt/yp/zl/zp/ypzlzpf5k7tmuiculbcntozf0ga.png"><br><br>  <code>shutdown_function</code>   <code>Aspect</code> .     ,    callback,  ,   ,   ,   callback <code>onPhpTerminate</code> .     <code>fastcgi_finish_request</code>  : «, , ,   ,  ».         . <br><br>   ,          <code>sendPushNotification</code> . <br><br><img src="https://habrastorage.org/webt/z4/4g/g0/z44gg0rpyaguh-rs8xge_tf6ync.jpeg"><br><br> , -       —   2 . <br><br><img src="https://habrastorage.org/webt/v9/oa/rr/v9oarrwwsrifqgxpfpldsbezd4s.jpeg"><br><br>   ,  ,      ,  2   . <br><br>    ,  <code>Deferred</code> . <br><br><img src="https://habrastorage.org/webt/62/um/gw/62umgw3pjrqokgzk462oyhtlcpu.jpeg"><br><br>   ,    . -       ,  ,      . <br><br>  Das ist alles. ,          - .  ,   . <br><br><blockquote>    <a href="https://phprussia.ru/moscow/2020">PHP Russia 2020</a>   .        — <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dpc2020"> </a> .   <a href="http://eepurl.com/VYVaf"></a>  <a href="https://t.me/PHPRussiaConfChannel">telegram-</a> ,       PHP Russia 2020. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de478618/">https://habr.com/ru/post/de478618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de478596/index.html">PHP Anonymous-Funktionen: Belichten von Black Magic-Sitzungen</a></li>
<li><a href="../de478602/index.html">MVC in Einheit mit skriptfähigen Objekten. Teil 2</a></li>
<li><a href="../de478604/index.html">Von Arbeitern zu PHP-Programmierern. Ungewöhnliche Entwicklungskarriere</a></li>
<li><a href="../de478606/index.html">„Gute Nacht“ - wie intelligente Geräte Menschen den Schlaf rauben</a></li>
<li><a href="../de478616/index.html">Windows UAC hört nie auf zu überraschen, oder wie man einen Insider erkennt</a></li>
<li><a href="../de478620/index.html">Warum sollten Sie FastAPI ausprobieren?</a></li>
<li><a href="../de478626/index.html">Debuggen der Softwarebereitstellung mit strace</a></li>
<li><a href="../de478628/index.html">Hoher CRI auf Chinesisch</a></li>
<li><a href="../de478634/index.html">Fallstricke im Projektmanagement für maschinelles Lernen</a></li>
<li><a href="../de478636/index.html">Wie Textcodierungen funktionieren. Woher kommen die "Krokodile"? Die Prinzipien der Kodierung. Verallgemeinerung und detaillierte Analyse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>