<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåô üö∂üèø üë®üèΩ‚ÄçüöÄ Schule der Magie PHP üÜí ü§æüèæ üôèüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was ist Magie in PHP? Dies bedeutet normalerweise Methoden wie _construct() oder __get() . Die magischen Methoden in PHP sind L√ºcken, die Entwicklern ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Schule der Magie PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/478618/"> Was ist Magie in PHP?  Dies bedeutet normalerweise Methoden wie <code>_construct()</code> oder <code>__get()</code> .  Die magischen Methoden in PHP sind L√ºcken, die Entwicklern helfen, erstaunliche Dinge zu tun.  Das Netzwerk ist voll von Anweisungen zu deren Verwendung, mit denen Sie wahrscheinlich vertraut sind.  Aber was ist, wenn wir sagen, dass Sie nicht einmal die wahre Magie gesehen haben?  Denn je mehr du scheinst, alles zu wissen, desto mehr Magie entzieht sich dir. <br><br><img src="https://habrastorage.org/webt/kd/xp/vm/kdxpvmeklgs6av1hp8ldzbnq4vc.jpeg"><br><br>  Lassen Sie uns das etablierte Framework der OOP-Regeln fallen und das Unm√∂gliche an der PHP School of Magic m√∂glich machen.  Der Haupt- und erste Zauberlehrer der Schule ist <b>Alexander Lisachenko</b> ( <a href="https://habr.com/ru/users/nighttiger/" class="user_link">NightTiger</a> ).  Er wird das magische Denken unterrichten und vielleicht werden Sie magische Methoden, nicht standardisierte Methoden zum Zugreifen auf Eigenschaften, √Ñndern von Kontexten, aspektorientiertes Programmieren und Stream-Filter lieben. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1W3UR7v3sAo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Alexander Lisachenko</b> ist der Leiter der Abteilung f√ºr Webentwicklung und Architektur in Alpari.  Der Autor und Hauptentwickler des aspektorientierten Frameworks <a href="http://go.aopphp.com/">Go!</a>  <a href="http://go.aopphp.com/">Aop</a> .  Referent bei internationalen Konferenzen zu PHP. <br><br>  In dem guten Film "Die Illusion der T√§uschung" gibt es einen Satz: <br><blockquote>  "Je n√§her du bist, desto weniger siehst du." </blockquote><br>  Dasselbe gilt f√ºr PHP als Zaubertrick, mit dem Sie ungew√∂hnliche Dinge tun k√∂nnen.  Aber zuallererst wurde es geschaffen, um Sie zu t√§uschen: "... eine Handlung, die dazu gedacht ist, entweder jemanden zu betr√ºgen, oder als Witz oder Form der Unterhaltung." <br><br>  Wenn wir PHP zusammen nehmen und versuchen, etwas Magisches darauf zu schreiben, werde ich Sie h√∂chstwahrscheinlich t√§uschen.  Ich werde einen Trick machen, und Sie werden sich lange fragen, warum dies passiert.  Das liegt daran, dass PHP eine Programmiersprache ist, die f√ºr ihre ungew√∂hnlichen Dinge bekannt ist. <br><br><h2>  Magische Ausr√ºstung </h2><br>  Was brauchen wir von magischer Ausr√ºstung?  Schmerzlich vertraute Methoden. <br><br> <code>__construct(), __destruct(), __clone(), <br> __call(), __callStatic(), <br> __get(), __set(), __isset(), __unset(), <br> __sleep(), __wakeup(), <br> __toString(), __invoke(), __set_state(), <br> __debugInfo()</code> <br> <br>  Ich werde die letzte Methode separat erw√§hnen - damit k√∂nnen Sie ungew√∂hnliche Dinge aufdrehen.  Das ist aber noch nicht alles. <br><br><ul><li>  <code>declare(ticks=1)</code> . <br></li><li>  <code>debug_backtrace()</code> .  Dies ist unser Begleiter, um zu verstehen, wo wir uns im aktuellen Code befinden, wer uns angerufen hat und warum, mit welchen Argumenten.  N√ºtzlich, um zu entscheiden, nicht der ganzen Logik zu folgen. <br></li><li>  <code>unset(), isset()</code> .  Es scheint nichts Besonderes zu sein, aber diese Designs verbergen eine Menge Tricks, die wir weiter betrachten werden. <br></li><li>  <code>by-reference passing</code> .  Wenn wir ein Objekt oder eine Variable als Referenz √ºbergeben, sollten wir damit rechnen, dass Ihnen unweigerlich etwas Magie zusto√üen wird. <br></li><li>  <code>bound closures</code> .  Auf den Verschl√ºssen und der Tatsache, dass sie binden k√∂nnen, k√∂nnen Sie viele Tricks bauen. <br></li><li>  Mit der Reflection-API k√∂nnen Sie die Reflektion auf eine neue Ebene heben. <br></li><li>  StreamWrapper-API. <br></li></ul><br>  Die Ausr√ºstung ist fertig - ich werde die erste Regel der Magie erinnern. <br><br><blockquote>  Sei immer der kl√ºgste Kerl im Raum. </blockquote><br><h2>  Trick Nr. 1.  Unm√∂glicher Vergleich </h2><br>  Beginnen wir mit dem ersten Trick, den ich Impossible Comparison nenne. <br>  Schauen Sie sich den Code genau an und pr√ºfen Sie, ob dies in PHP m√∂glich ist. <br><br><img src="https://habrastorage.org/webt/ji/sd/8i/jisd8ip2pzz7kx9otvdxq8_c-k4.png"><br><br>  Es gibt eine Variable, wir deklarieren ihren Wert und dann ist sie pl√∂tzlich nicht mehr gleich sich selbst. <br><br><h3>  Nicht eine Nummer </h3><br>  Es gibt solch ein magisches Artefakt wie NaN - Not-a-Number. <br><br><img src="https://habrastorage.org/webt/gf/fw/3b/gffw3bl5rfz8xz1br3ut9ocmhnw.jpeg"><br><br>  Das Erstaunliche ist, dass es sich selbst nicht ebenb√ºrtig ist.  Und dies ist unser erster Trick: Verwende NaN, um einen Freund zu r√§tseln.  NaN ist jedoch nicht die einzige L√∂sung f√ºr diese Aufgabe. <br><br><h3>  Wir verwenden Konstanten </h3><br><img src="https://habrastorage.org/webt/7c/hd/l1/7chdl1uranfz-cg9lbhc078ipnq.jpeg"><br><br>  Der Trick ist, dass wir <code>false</code> f√ºr <code>namespace</code> und compare als <code>true</code> deklarieren k√∂nnen.  Der ungl√ºckliche Entwickler wird sich lange fragen, warum es <code>true</code> und nicht <code>false</code> . <br><br><h3>  Handler </h3><br>  Der n√§chste Trick ist eine st√§rkere Artillerie als die beiden vorherigen.  Mal sehen, wie es funktioniert. <br><br><img src="https://habrastorage.org/webt/xj/3g/5j/xj3g5jvenlytadytgnqth9yb47c.jpeg"><br><br>  Der Trick basiert auf <code>tick_function</code> und <code>tick_function</code> , wie <code>tick_function</code> <code>declare(ticks=1)</code> <code>tick_function</code> <code>declare(ticks=1)</code> . <br><br>  Wie funktioniert das alles?  Zuerst deklarieren wir eine Funktion, und als Referenz wird der <code>isMagic</code> Parameter verwendet. Anschlie√üend wird versucht, diesen Wert in <code>true</code> zu √§ndern.  Nachdem wir <code>declare(ticks=1)</code> deklariert haben <code>declare(ticks=1)</code> ruft der PHP-Interpreter nach jeder elementaren Operation <code>register_tick_function</code> - callback auf.  In diesem R√ºckruf k√∂nnen wir den Wert, der zuvor <code>false</code> in <code>true</code> √§ndern.  Die Magie! <br><br><h2>  Trick Nr. 2.  Magische Ausdr√ºcke </h2><br>  Nehmen Sie ein Beispiel, in dem zwei Variablen deklariert sind.  Einer von ihnen ist <code>false</code> , der andere ist <code>true</code> .  Wir <code>isBlack</code> und <code>isWhite</code> und var_dump das Ergebnis.  Was denkst du wird das Ergebnis sein? <br><br><img src="https://habrastorage.org/webt/yy/5r/kx/yy5rkxfp5zdicpodqjrutq1diri.png"><br><br>  <b>Vorrangige Bediener</b> .  Die richtige Antwort ist <code>false</code> , weil es in PHP so etwas wie ‚ÄûOperator-Priorit√§t‚Äú gibt. <br><br><img src="https://habrastorage.org/webt/tm/8e/uf/tm8eufef1fi8j46c3fc3xbgl1z8.jpeg"><br><br>  √úberraschenderweise hat der logische Operator <code>or</code> die Zuweisung weniger Priorit√§t als die Operation.  Daher wird einfach <code>false</code> zugewiesen.  In <code>isWhite</code> kann es einen beliebigen anderen Ausdruck geben, der ausgef√ºhrt wird, wenn der erste Teil fehlschl√§gt. <br><br><h3>  Magische Ausdr√ºcke </h3><br>  Schauen Sie sich den folgenden Code an.  Es gibt eine Klasse, die den Konstruktor enth√§lt, und eine Factory, deren Code weiter unten angegeben wird. <br><br><img src="https://habrastorage.org/webt/bk/md/w5/bkmdw5zdb6bxcpml7jzygu9vjhs.jpeg"><br><br>  Achten Sie auf die letzte Zeile. <br><br><pre> <code class="php hljs">$value = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $factory-&gt;build(Foo::class);</code> </pre> <br>  Es gibt verschiedene M√∂glichkeiten, die auftreten k√∂nnen. <br><br><ul><li>  <code>$factory</code> wird als Klassenname <code>new</code> ; <br></li><li>  es wird ein Parsing-Fehler auftreten; <br></li><li>  es wird der Aufruf <code>$factory-&gt;build()</code> verwendet, dessen Wert diese Funktion <code>$factory-&gt;build()</code> , das Ergebnis ist <code>new</code> ; <br></li><li>  Der Wert der Eigenschaft <code>$factory-&gt;build</code> wird zum <code>$factory-&gt;build</code> der Klasse verwendet. <br></li></ul><br>  Schauen wir uns die letzte Idee an.  In der Klasse <code>$factory</code> deklarieren wir eine Reihe magischer Funktionen.  Sie schreiben, was wir tun: Rufen Sie die Eigenschaft auf, rufen Sie die Methode auf oder versuchen Sie sogar, <code>invoke</code> f√ºr das Objekt <code>invoke</code> . <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Getting property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $arg)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Calling method {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Invoking {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Foo::class;} }</code> </pre> <br>  Die richtige Antwort: Wir rufen keine Methode auf, sondern eine Eigenschaft.  Nach <code>$factory-&gt;build</code> gibt es einen Parameter f√ºr den Konstruktor, den wir an diese Klasse √ºbergeben. <br><br>  √úbrigens habe ich in diesem Framework eine Funktion namens "Abfangen der Erstellung neuer Objekte" implementiert - Sie k√∂nnen dieses Design "sperren". <br><br><h3>  Parser-L√ºcke </h3><br>  Das folgende Beispiel ist f√ºr den PHP-Parser selbst.  Haben Sie jemals versucht, Funktionen aufzurufen oder Variablen in geschweiften Klammern zuzuweisen? <br><br><img src="https://habrastorage.org/webt/wi/b5/kb/wib5kbzb1j_0gzdurptouztvb7u.jpeg"><br><br>  Ich habe diesen Trick auf Twitter, es funktioniert extrem nicht-Standard. <br><br><pre> <code class="php hljs">$result = ${<span class="hljs-string"><span class="hljs-string">'_'</span></span> . !$_=getCallback()}(); $_=getCallback(); <span class="hljs-comment"><span class="hljs-comment">// string(5) "hello" !$_=getCallback()}(); // bool(false) '_'.!$_=getCallback()}(); // string(1) "_" ${'_'.!$_=getCallback()}(); // string(5) "hello"</span></span></code> </pre> <br>  Zun√§chst weisen wir der Variablen <code>_</code> (Unterstrich) den Wert des Ausdrucks zu.  Wir haben bereits eine Variable, wir versuchen, ihren Wert logisch zu invertieren, und wir bekommen <code>false</code> - die Zeile wird wie auf <code>true</code> .  Dann kleben wir alles im Variablennamen zusammen, durch den wir uns dann in die geschweiften Klammern drehen. <br><br><blockquote>  Was ist Magie?  Dies ist Unterhaltung, die es uns erm√∂glicht, uns inspiriert und ungew√∂hnlich zu f√ºhlen und zu sagen: ‚ÄûWas?  Also war es m√∂glich?! " </blockquote><br><h2>  Trick Nr. 3.  Regeln brechen </h2><br>  Was ich an PHP mag, ist, dass Sie die Regeln brechen k√∂nnen, die jeder erstellt, um supersicher zu sein.  Es gibt ein Design namens "Sealed Class", das einen privaten Konstruktor hat.  Ihre Aufgabe als Sch√ºler des Magiers ist es, eine Instanz dieser Klasse zu erstellen. <br><br><img src="https://habrastorage.org/webt/rt/uw/h4/rtuwh49inyhecfbsbea1hvb6kq4.jpeg"><br><br>  Betrachten Sie dazu drei M√∂glichkeiten. <br><br><h3>  Umgehung </h3><br>  Der erste Weg ist der offensichtlichste.  Es sollte jedem Entwickler bekannt sein - dies ist die Standard-API, die uns die Sprache bietet. <br><br><img src="https://habrastorage.org/webt/w2/or/df/w2ordfmqdhs3qg-nnzbff9yiilc.png"><br><br>  Mit <code>newInstanceWithoutConstructor</code> Konstrukt <code>newInstanceWithoutConstructor</code> k√∂nnen Sie die Spracheinschr√§nkungen umgehen, die f√ºr den Konstruktor gelten, und eine Instanz der Klasse erstellen, die alle unsere privaten Konstruktordeklarationen umgeht. <br><br>  Die Option funktioniert, ist einfach, bedarf keiner Erkl√§rung. <br><br><h3>  Kurzschluss </h3><br>  Die zweite Option erfordert mehr Aufmerksamkeit und Geschicklichkeit.  Es wird eine anonyme Funktion erstellt, die dann an den Fischadler dieser Klasse gebunden wird. <br><br><img src="https://habrastorage.org/webt/2z/6k/lz/2z6klzhpzlkbcglexaslmiu9ezo.png"><br><br>  Hier sind wir in der Klasse und k√∂nnen sicher private Methoden aufrufen.  Wir verwenden dies, indem wir <code>new static</code> aus dem Kontext unserer Klasse aufrufen. <br><br><img src="https://habrastorage.org/webt/fn/v5/ul/fnv5ulkueuayx56vd07u7tfk128.png"><br><br><h3>  Deserialisierung </h3><br>  Die dritte Option ist meiner Meinung nach die am weitesten fortgeschrittene. <br><br><img src="https://habrastorage.org/webt/ky/qi/xb/kyqixbfapmoxxaisd6g3mlypuny.png"><br><br>  Wenn Sie eine bestimmte Zeile in einem bestimmten Format schreiben, ersetzen Sie dort bestimmte Werte - unsere Klasse wird sich herausstellen. <br><br><img src="https://habrastorage.org/webt/d2/0k/fi/d20kfibw1fnqmmovhc90_mqb1sy.png"><br><br>  Nach der Deserialisierung erhalten wir unsere <code>instance</code> . <br><br><h3>  Doktrin / Instantiator-Paket </h3><br>  Magie wird oft zu einem dokumentierten Framework oder einer Bibliothek - zum Beispiel in <b>Doctrine / Instantiator wird</b> all dies implementiert.  Wir k√∂nnen beliebige Objekte mit beliebigem Code erstellen. <br><br><pre> <code class="plaintext hljs">composer show doctrine/instantiator --all name : doctrine/instantiator descrip. : A small, lightweight utility to instantiate objects in PHP without invoking their constructors keywords : constructor, instantiate type : library license : MIT License (MIT)</code> </pre> <br><h2>  Trick Nr. 4.  Abfangen des Zugangs zu Eigentum </h2><br>  Die Wolken ziehen auf: Die Klasse ist geheim, die Eigenschaften und der Konstruktor sind privat und auch der R√ºckruf. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Secret</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $secret = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Secret is: '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;secret; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPropAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Accessing property {$name}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">100500</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// How to create a secret instance and intercept the secret value?</span></span></code> </pre> <br>  Unsere Aufgabe als Assistenten ist es, einen R√ºckruf zu t√§tigen. <br><br><h3>  Hinzuf√ºgen der Magie ... Getter </h3><br>  F√ºgen Sie eine Prise Magie hinzu, damit es funktioniert. <br><br><img src="https://habrastorage.org/webt/p7/ut/2w/p7ut2w699vysx99jnvmxvr0akfy.png"><br><br>  Diese Prise Magie ist ein magischer <code>getter</code> .  Es ruft eine Funktion auf, und bisher ist nichts Schlimmes passiert.  Wir werden jedoch den vorherigen Trick anwenden und eine Instanz dieses Objekts erstellen, die das private Konstrukt umgeht. <br><br><img src="https://habrastorage.org/webt/b0/oy/gu/b0oyguiksznuw3rzfn19rsz1s4y.jpeg"><br><br>  Jetzt m√ºssen wir den R√ºckruf irgendwie anrufen. <br><br><h3>  "Unset" im Schaltkreis </h3><br>  Erstellen Sie dazu einen Abschluss.  Innerhalb des Abschlusses, der sich im G√ºltigkeitsbereich der Klasse befindet, l√∂schen wir diese Variable mit der Funktion <code>unset()</code> . <br><br><img src="https://habrastorage.org/webt/-n/2l/md/-n2lmdkswrc0cgk6tcobilajlgk.jpeg"><br><br>  <code>unset</code> k√∂nnen Sie eine Variable vor√ºbergehend ausschlie√üen, wodurch unsere magic <code>get</code> Methode aufgerufen werden kann. <br><br><h3>  Wir rufen den privaten Konstrukteur an </h3><br>  Da wir einen privaten Konstruktor haben, der <code>echo</code> anzeigt, k√∂nnen Sie diesen Konstruktor einfach abrufen und durch Aufrufen zug√§nglich machen. <br><br><img src="https://habrastorage.org/webt/1z/-g/vo/1z-gvohztwjnrbeujkiwecxdowi.jpeg"><br><br>  Also zerfiel unsere Geheimklasse. <br><br><img src="https://habrastorage.org/webt/om/cv/ef/omcvefwmkjdrmnvuepdf3mmvf5k.png"><br><br>  Wir haben eine Nachricht erhalten, dass wir: <br><br><ul><li>  abgefangen; <br></li><li>  etwas ganz anderes zur√ºckgegeben. <br></li></ul><br><h3>  Leedavis / Altr-Ego-Paket </h3><br>  Viel Magie ist bereits dokumentiert.  Das <b>altr-ego-</b> Paket gibt nur vor, Ihre Komponente zu sein. <br><br><pre> <code class="plaintext hljs">composer show leedavis81/altr-ego --all name : leedavis81/altr-ego descrip. : Access an objects protected / private properties and methods keywords : php, break scope versions : dev-master, v1.0.2, v1.0.1, v1.0.0 type : library license : MIT License (MIT)</code> </pre> <br>  Sie k√∂nnen eines Ihrer Objekte erstellen und ein zweites daran anh√§ngen.  Dadurch k√∂nnen √Ñnderungen an der Einrichtung vorgenommen werden.  Er wird sich gehorsam ver√§ndern und alle Ihre W√ºnsche erf√ºllen. <br><br><h2>  Trick Nr. 5.  Unver√§nderliche Objekte in PHP </h2><br>  Gibt es unver√§nderliche Objekte in PHP?  Ja und eine sehr, sehr lange Zeit. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Magic</span></span> { $<span class="hljs-title"><span class="hljs-title">object</span></span> = (<span class="hljs-title"><span class="hljs-title">object</span></span>) [ "\0<span class="hljs-title"><span class="hljs-title">Secret</span></span>\0<span class="hljs-title"><span class="hljs-title">property</span></span>" =&gt; '<span class="hljs-title"><span class="hljs-title">test</span></span>' ]; var_dump($object); }</code> </pre> <br>  Erhalten Sie sie einfach auf interessante Weise.  Das Interessante ist, dass wir ein Array mit einem <b>speziellen Schl√ºssel</b> erstellen.  Es beginnt mit der Konstruktion <code>\0</code> - dies ist ein Null-Byte-Zeichen, und nach <code>Secret</code> wir auch <code>\0</code> . <br><br>  Das Konstrukt wird in PHP verwendet, um eine private Eigenschaft innerhalb einer Klasse zu deklarieren.  Wenn wir versuchen, ein Objekt in ein Array umzuwandeln, sehen wir dieselben Schl√ºssel.  Wir werden nichts als <code>stdClass</code> .  Es enth√§lt eine Privateigenschaft aus der Klasse <code>Secret</code> , die <code>test</code> . <br><br><pre> <code class="php hljs">object(stdClass) [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-string"><span class="hljs-string">'property'</span></span> (Secret) =&gt; string <span class="hljs-string"><span class="hljs-string">'test'</span></span> (length=<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br>  Das einzige Problem ist, dass Sie diese Eigenschaft von dort aus nicht erhalten k√∂nnen.  Es ist erstellt, aber nicht verf√ºgbar. <br><br>  Ich fand es ziemlich unpraktisch - wir haben unver√§nderliche Objekte, aber Sie k√∂nnen es nicht verwenden.  Daher entschied ich mich, dass es Zeit war, meine Entscheidung einzureichen.  Ich habe mein gesamtes Wissen und meine Magie, die in PHP verf√ºgbar sind, genutzt, um eine Konstruktion zu erstellen, die auf all unseren Zaubertricks basiert. <br><br>  <b>Beginnen wir mit einem einfachen: Erstellen Sie ein DTO</b> und versuchen Sie, alle darin enthaltenen Eigenschaften abzufangen (siehe den vorherigen Trick). <br><br>  <b>Wir speichern an einem sicheren Ort die Werte</b> , die wir von dort erfassen.  Sie werden mit keiner Methode zug√§nglich sein: weder <code>reflection</code> , noch Verschl√ºsse, noch andere Magie.  Aber es besteht Unsicherheit - gibt es einen solchen Platz in PHP, der garantiert, dass einige Variablen gespeichert werden, damit kein schlauer junger Programmierer dorthin gelangt? <br><br>  <b>Wir bieten eine magische Methode</b> , mit der Sie diesen Wert ablesen k√∂nnen.  Zu diesem <code>isset</code> verf√ºgen wir √ºber Magic <code>getters</code> , Magic <code>isset</code> Methoden, mit denen wir APIs bereitstellen k√∂nnen. <br><br>  Kehren wir zu einem verl√§sslichen Ort zur√ºck und versuchen zu suchen. <br><br><ul><li>  <code>Global variables</code> gel√∂scht - jeder kann sie √§ndern. <br></li><li>  <code>Public properties</code> ebenfalls nicht geeignet. <br></li><li>  <code>Protected properties</code> so lala, weil die untergeordnete Klasse durchkommt. <br></li><li>  <code>Private properties</code> .  Es gibt kein Vertrauen, weil es durch Schlie√üen oder durch <code>reflection</code> ver√§ndert werden kann. <br></li><li>  <code>Private static properties</code> k√∂nnen ausprobiert werden, aber auch die <code>reflection</code> unterbrochen. <br></li></ul><br>  Es scheint, dass es keinen Ort gibt, an dem man die Werte von Variablen verbergen kann.  Aber es gab eine magische Sache - <code>Static variables in functions</code> - das sind Variablen, die sich in Funktionen befinden. <br><br><h3>  Sichere Aufbewahrung von Werten </h3><br>  Ich habe <b>Nikita Popov</b> und <b>Jay Watkins</b> auf dem speziellen Stack Overflow-Kanal danach gefragt. <br><br><img src="https://habrastorage.org/webt/dz/lg/ev/dzlgevsl3qi9lwbi91sjwladbpu.png"><br><br>  Dies ist eine Funktion, in der eine statische Variable deklariert wird.  Kann man das irgendwie √§ndern?  Die Antwort lautet nein. <br><br>  Wir haben eine kleine L√ºcke in der Welt der gesch√ºtzten Variablen gefunden und wollen sie nutzen. <br><br><h3>  Werte per Link √ºbergeben </h3><br>  Wir werden es nicht standardm√§√üig als Eigentum des Objekts verwenden.  Da Sie jedoch keine Eigenschaft √ºbergeben k√∂nnen, verwenden wir die klassische √úbertragung von Werten als Referenz. <br><br><img src="https://habrastorage.org/webt/xr/qe/vn/xrqevnya2a0a8mizylf8gbimfb8.jpeg"><br><br>  Es stellt sich heraus, dass es eine Klasse gibt, in der es eine magische <code>callStatic</code> Methode gibt, in der die <code>Static</code> Variable deklariert ist.  Bei jedem Aufruf einer Funktion √ºbergeben wir den Wert der Variablen aus dem Immutable-Objekt unter Bezugnahme auf alle unsere verschachtelten Methoden.  Wir stellen also irgendwie den Kontext zur Verf√ºgung. <br><br><h3>  Zustand speichern </h3><br>  Mal sehen, wie der Zustand gerettet wird. <br><br><img src="https://habrastorage.org/webt/ef/5j/tm/ef5jtmjn0yuws-_nkbegq0neqag.png"><br><br>  Es ist ziemlich einfach.  F√ºr das √ºbertragene Objekt verwenden wir die Funktion <code>spl_object_id</code> , die f√ºr jede Instanz einen eigenen Bezeichner zur√ºckgibt.  Der <code>State</code> , den wir bereits von dem Objekt erhalten haben, versucht dort zu retten.  Nichts Besonderes. <br><br><h3>  Wenden Sie den Status des Objekts an </h3><br>  Auch hier gibt es eine Konstruktion zum √úbergeben von Werten anhand von Referenzen und nicht <code>unset</code> Eigenschaften.  Wir deaktivieren alle aktuellen Eigenschaften, nachdem wir sie zuvor in der Statusvariablen gespeichert haben, und legen diesen Kontext f√ºr das Objekt fest.  Das Objekt enth√§lt keine Eigenschaften mehr, sondern nur seinen Bezeichner, der mit <code>spl_object_id</code> deklariert und an dieses Objekt angeh√§ngt wird, solange es noch aktiv ist. <br><br><img src="https://habrastorage.org/webt/tl/gp/b9/tlgpb9z5yi8ibnwqmod_kifacrq.jpeg"><br><br><h3>  Status abrufen </h3><br>  Dann ist alles einfach. <br><br><img src="https://habrastorage.org/webt/2n/om/aq/2nomaqdui4jxeusbrlzucow9dck.png"><br><br>  Wir bekommen diesen Zusammenhang auf den Magic <code>getter</code> und nennen unser Eigentum daraus.  Jetzt kann niemand und nichts den Wert √§ndern, nachdem dieses <code>Trait</code> verbunden wurde. <br><br><img src="https://habrastorage.org/webt/m7/iu/_y/m7iu_yazwpqoc4hxhlg6rv4srbo.png"><br><br>  Alle magischen Methoden werden √ºberschrieben und implementieren die Unver√§nderlichkeit des Objekts. <br><br><img src="https://habrastorage.org/webt/jy/he/ht/jyheht4ncrsuwsh7ngerdnd5x4m.jpeg"><br><br><h3>  Lisachenko / unver√§nderliches Objekt </h3><br>  Wie erwartet ist alles sofort in der Bibliothek formalisiert und einsatzbereit. <br><br><pre> <code class="plaintext hljs">composer show /immutable-object --all name : /immutable-object descrip. : Immutable object library keywords : versions : * dev-master type : library license : MIT License (MIT)</code> </pre> <br>  Die Bibliothek sieht ziemlich einfach aus.  Wir verbinden es und schaffen unsere Klasse.  Es hat verschiedene Eigenschaften: privat, gesch√ºtzt und √∂ffentlich.  Wir verbinden <code>ImmutableTrait</code> . <br><br><img src="https://habrastorage.org/webt/xj/gt/pe/xjgtpettshurwn257f51iaj5u78.jpeg"><br><br>  Danach k√∂nnen Sie das Objekt einmalig initiieren - siehe Wert.  Es ist dort wirklich gespeichert und sieht sogar aus wie ein echter DTO. <br><br><pre> <code class="php hljs">object (MagicObject) [<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; int <span class="hljs-number"><span class="hljs-number">200</span></span></code> </pre> <br>  Aber wenn wir versuchen, es zu √§ndern, zum Beispiel so ... <br><br><img src="https://habrastorage.org/webt/su/s2/dh/sus2dhhps9ts4gwpx5nxk9301m4.jpeg"><br><br>  ... dann bekomme sofort eine <code>fatal exception</code> .  Wir k√∂nnen eine Eigenschaft nicht √§ndern, da sie unver√§nderlich ist.  Wie so <br><br><img src="https://habrastorage.org/webt/sh/iy/1c/shiy1cl8vmbfmwzbmah8whsbnyu.png"><br><br>  Wenn Sie sich auf eine aufregende Herausforderung einlassen und versuchen, sie zu entwerten, erhalten Sie Folgendes. <br><br><img src="https://habrastorage.org/webt/ga/ym/l6/gayml6qurl3mr1o6qpvhzk1_rgi.png"><br><br>  Das ist mein Geschenk.  Sobald Sie versuchen, in PHPStorm innerhalb dieser Klasse einen Fehler zu machen, wird die Ausf√ºhrung Ihres Befehls sofort gestoppt.  Ich m√∂chte nicht, dass Sie sich mit diesem Code befassen - er ist zu gef√§hrlich.  Er wird warnen, dass es nichts zu tun gibt. <br><br><h2>  Trick Nr. 6.  Thread-Verarbeitung </h2><br>  Betrachten Sie das Design. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'php://filter/read=string.toupper/resource=magic.php'</span></span>;</code> </pre> <br>  Es gibt etwas Magisches: Ein PHP-Filter, <code>read</code> , am Ende ist eine Art magic.php- <b>Datei angeschlossen</b> .  Diese Datei sieht ziemlich einfach aus. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Hello, world!'</span></span></code> </pre> <br>  Beachten Sie, dass der Fall anders ist.  Wenn wir die Datei jedoch √ºber unser Design ‚Äûf√ºllen‚Äú, erhalten wir Folgendes: <br><br><pre> <code class="php hljs">HELLO, WORLD!</code> </pre> <br>  Was ist in diesem Moment passiert?  Durch die Verwendung der Konstruktion des PHP-Filters in <code>include</code> k√∂nnen Sie jeden Filter, einschlie√ülich Ihres Filters, anschlie√üen, um den Quellcode zu analysieren.  Sie verwalten alles in diesem Quellcode.  Sie k√∂nnen <code>final</code> aus Klassen und Methoden entfernen, Eigenschaften √∂ffentlich machen - alles, was Sie durch dieses Ding drehen k√∂nnen. <br><br>  Ein Teil meines Aspekt-Frameworks basiert darauf.  Wenn Ihre Klasse verbunden ist, analysiert sie sie und wandelt sie in das um, was ausgef√ºhrt wird. <br><br>  In PHP gibt es bereits eine ganze Reihe von vorgefertigten Filtern. <br><br><pre> <code class="php hljs">var_dump(stream_get_filters()); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> (size=<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'zlib.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'bzip2.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.iconv.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">' string.rotl3'</span></span> (length=<span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.toupper'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.tolower'</span></span> (length=<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'string.strip_tags'</span></span> (length=<span class="hljs-number"><span class="hljs-number">17</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'convert.*'</span></span> (length=<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'consumed'</span></span> (length=<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">9</span></span> =&gt; string <span class="hljs-string"><span class="hljs-string">'dechunk'</span></span> (length=<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br>  Sie k√∂nnen den Inhalt "zip", in Gro√ü- oder Kleinschreibung √ºbersetzen. <br><br>  Die wichtigsten Tricks, die ich zeigen wollte, sind vorbei.  Kommen wir nun zur Quintessenz von allem, was ich tun kann - aspektorientierte Programmierung. <br><br><h2>  Trick Nr. 7.  Aspektorientierte Programmierung </h2><br>  Schauen Sie sich diesen Code an und √ºberlegen Sie, ob er aus Ihrer Sicht gut oder schlecht ist. <br><br><img src="https://habrastorage.org/webt/xx/za/wa/xxzawap4whyavczg4g5ptvsx6q0.jpeg"><br><br>  Der Code scheint v√∂llig ausreichend zu sein.  Es √ºberpr√ºft die Zugriffsrechte, f√ºhrt die Protokollierung durch, erstellt einen Benutzer, bleibt bestehen und versucht, eine <code>exception</code> abzufangen. <br><br>  Wenn Sie sich all diese Nudeln ansehen, wird dies bei jeder unserer Methoden wiederholt, und das einzig Wertvolle dabei ist, dass sie gr√ºn markiert sind. <br><br><img src="https://habrastorage.org/webt/uk/za/mo/ukzamorqli1-u6wijf7d7knpwu4.jpeg"><br><br>  Alles andere: "Nebenbedenken" oder "Querschnittsbedenken" sind Querschnittsfunktionen. <br><br>  Herk√∂mmliches OOP macht es unm√∂glich, alle diese Strukturen mit Copy-Paste zu kopieren, zu entfernen und irgendwo herauszunehmen.  Das ist schlecht, weil man es wiederholen muss.  Ich w√ºnschte, der Code sah immer sauber und ordentlich aus. <br><br><img src="https://habrastorage.org/webt/hg/vw/pm/hgvwpmdhsbhaeeh0uj5tdngunqo.jpeg"><br><br>  Damit es keine Protokollierung enth√§lt (lass es irgendwie angewendet werden) und keine <code>security</code> enth√§lt. <br><br><img src="https://habrastorage.org/webt/yz/-4/i2/yz-4i2yxrju_ti0839xg7idj5ua.jpeg"><br><br>  Das ist also alles, einschlie√ülich Protokollierung ... <br><br><img src="https://habrastorage.org/webt/sb/g1/8u/sbg18ud79gi4fg2dhc4h__ojxie.jpeg"><br><br>  ... und eine Sicherheitskontrolle, ... <br><br><img src="https://habrastorage.org/webt/3p/-s/07/3p-s07k5zl65ze55vxs4iddkia8.jpeg"><br><br>  ... von selbst durchgef√ºhrt. <br><br>  Und es ist m√∂glich. <br><br><h3>  Glossar "Aspekt" </h3><br>  Es gibt eine Sache namens Aspekt.  Dies ist ein einfaches Beispiel, das Berechtigungen √ºberpr√ºft.  Dank ihm k√∂nnen Sie einige Anmerkungen sehen, die auch durch das Plugin f√ºr PhpStorm hervorgehoben werden.  "Aspect" deklariert SQL-Ausdr√ºcke, auf welche Punkte im Code diese Bedingung angewendet werden soll.  Im Folgenden m√∂chten wir beispielsweise einen Abschluss auf alle √∂ffentlichen Methoden der <code>UserService</code> Klasse <code>UserService</code> . <br><br><img src="https://habrastorage.org/webt/jx/y_/g4/jxy_g4pvoli4gjezfp3w1vqpkpi.jpeg"><br><br>  Wir erhalten den Abschluss mit der Methode <code>$invocation</code> . <br><br><img src="https://habrastorage.org/webt/ym/ju/mp/ymjump3eozldipcvntd-lpo9zbi.jpeg"><br><br>  Dies ist eine Art Wrapper √ºber der <code>reflection</code> , die weitere Argumente enth√§lt. <br><br>  Weiter k√∂nnen Sie in diesem Callback f√ºr jede Methode die notwendigen Zugriffsrechte √ºberpr√ºfen, dies wird als "Advice" bezeichnet. <br><br><img src="https://habrastorage.org/webt/i8/zz/pq/i8zzpqsvck05an3amyc8hihxj00.jpeg"><br><br>  Wir sagen sozusagen die Sprache: "Lieber PHP, bitte wenden Sie diese Methode vor jedem Aufruf der √∂ffentlichen Methode der <code>UserService</code> Klasse an <code>UserService</code> "  Nur eine Zeile, aber sehr n√ºtzlich. <br><br><h3>  Aspekt vs Ereignis-Listener </h3><br>  Um es klarer zu machen, habe ich Aspect mit Event Listener verglichen.  Viele arbeiten bei Symfony und wissen, was Event Dispatcher ist. <br><br><img src="https://habrastorage.org/webt/5v/8o/ge/5v8oge0pczc4pteufmb0bvxf-da.jpeg"><br><br>  Sie √§hneln sich darin, dass wir eine Art Abh√§ngigkeit √ºbergeben, z. B. <code>AutorizationChecker</code> , und <code>AutorizationChecker</code> , wo in diesem Fall die Anwendung erfolgen soll.  Im Fall von Listener ist dies ein <code>SubscrabingEvent</code> Namen <code>UserCreate</code> . Im Fall von <code>Aspect</code> abonnieren wir alle Aufrufe √∂ffentlicher Methoden vom <code>UserService</code> .       callback  :   -    . <br><br> ,      . <br><br> <b> </b> ,    ,  <b></b> <code>Aspects</code> . <br><br><img src="https://habrastorage.org/webt/-i/ae/iy/-iaeiyqqw4oar3tyxzbe4au38n8.jpeg"><br><br> <b> </b> .   ,    <b>  PHP-</b> . <br><br><img src="https://habrastorage.org/webt/6z/sq/da/6zsqda5rxa9alxpilq57s0wyspc.jpeg"><br><br>   ,     .    ,      ,     OPcache. <br><br> <b> </b> .     <code>Composer</code> .    Go! AOP,      <code>Composer</code>    ,    . <br><br><img src="https://habrastorage.org/webt/or/v8/l9/orv8l9yh9swl-mxtzowmrzoomm4.jpeg"><br><br>         <code>Aspects</code> ,   <code>Aspects</code> .       . <br><br>     . <br><br> <b>PHP-Parser</b> .     ,   ,      <b></b> . ,      <b> </b> ,  <a href="https://github.com/nikic/PHP-Parser">PHP-Parser</a> .           . <br><br><img src="https://habrastorage.org/webt/eg/ys/dm/egysdmlqf0bbvkmnacewmrrx-bw.jpeg"><br><br> <b> </b> .     ,   <b>goaop/parser-reflection</b> . <br><br><img src="https://habrastorage.org/webt/b_/oc/6d/b_oc6dfphlk-dtq3jxoijxzmn3i.jpeg"><br><br>    AST-      ,     .    ,        ,       ,       . <br><br>      . <br><br><img src="https://habrastorage.org/webt/9p/lu/an/9pluanmjyprlie0muf8sndyudba.jpeg"><br><br> ,         ,     <code>Aspect</code> . <br><br><img src="https://habrastorage.org/webt/3u/36/3z/3u363ztvggoi6ugvvsunvuilvuy.jpeg"><br><br>            ,     . <br><br><img src="https://habrastorage.org/webt/7z/tv/8p/7ztv8pyc8zti-wlpidlp3fm2zqk.jpeg"><br><br>    ,             ,       .      ‚Äî     ,   -   ,      . <br><br><img src="https://habrastorage.org/webt/ea/o9/zn/eao9znftd3ywdjzd14acr-9w-fe.png"><br><br>      ,    .      ,   . <br><br>      Aspect MOCK.   ¬´¬ª,      ,   .     . <br><br>       ‚Äî   <code>joinPoint</code> .   -    <code>joinPoint</code> :  ,   ,    . <br><br><h3>  Was weiter? </h3><br>    . <br><br> <b>OPcache preloading for AOP Core</b> .  AOP-      .          10   . Bootstrapping     ,       PHP. <br><br> <b>FFI integration to modify binary opcodes</b> . ,    ,    .     PHP-opcodes,        <code>.bin</code> .   FFI  . <br><br> <b>Modifying PHP engine internal callbacks</b>   PHP-   userland.  PHP   .   FFI  PHP     userland,       , , .     . <br><br>    ,   . <br><br><h2>  #8. goaop/framework </h2><br>   ,   <a href="https://github.com/goaop/framework"> GitHub</a>       . <br><br><pre> <code class="plaintext hljs">composer show goaop/framework --all name : goaop/framework descrip. : Framework for aspect-oriented programming in PHP. keywords : php, aop, library, aspect versions : dev-master, 3.0.x-dev, 2.x-dev, 2.3.1, ‚Ä¶ type : library license : MIT License</code> </pre> <br>    ,        PhpStorm. <br><br><img src="https://habrastorage.org/webt/ut/ah/rp/utahrp4yrgxj7ch2d0brjr_p7fk.jpeg"><br><br>   ,     Pointcuts.  ,    ,  .     ‚Äî    ,   ,     . <br><br><h2> Trick #9.   </h2><br>          . ,    . <br><br>   :  ,   -    .           <code>fastcgi_finish_request</code> .    ,      ,   , - callback  ‚Äî   . <br><br>         ? <br><br>   ,   <code>Deffered</code> ,  ,       . <br><br><img src="https://habrastorage.org/webt/yy/zh/7d/yyzh7dcpvv14sd3r75kroe07xky.jpeg"><br><br>    <code>Aspect</code> ,  ,    ,   <code>Deffered</code> ,    . <br><br><img src="https://habrastorage.org/webt/cc/y5/zj/ccy5zjad0olfwzemsxmnmo8mi_c.png"><br><br>   <code>Aspect</code>    :  ,  , ,      callback,  ,     callback.      . <br><br>  React ,     <code>promise</code> .     ,  -    ,  -     ,   . <br><br> ,       . <br><br><img src="https://habrastorage.org/webt/yp/zl/zp/ypzlzpf5k7tmuiculbcntozf0ga.png"><br><br>  <code>shutdown_function</code>   <code>Aspect</code> .     ,    callback,  ,   ,   ,   callback <code>onPhpTerminate</code> .     <code>fastcgi_finish_request</code>  : ¬´, , ,   ,  ¬ª.         . <br><br>   ,          <code>sendPushNotification</code> . <br><br><img src="https://habrastorage.org/webt/z4/4g/g0/z44gg0rpyaguh-rs8xge_tf6ync.jpeg"><br><br> , -       ‚Äî   2 . <br><br><img src="https://habrastorage.org/webt/v9/oa/rr/v9oarrwwsrifqgxpfpldsbezd4s.jpeg"><br><br>   ,  ,      ,  2   . <br><br>    ,  <code>Deferred</code> . <br><br><img src="https://habrastorage.org/webt/62/um/gw/62umgw3pjrqokgzk462oyhtlcpu.jpeg"><br><br>   ,    . -       ,  ,      . <br><br>  Das ist alles. ,          - .  ,   . <br><br><blockquote>    <a href="https://phprussia.ru/moscow/2020">PHP Russia 2020</a>   .        ‚Äî <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dpc2020"> </a> .   <a href="http://eepurl.com/VYVaf"></a>  <a href="https://t.me/PHPRussiaConfChannel">telegram-</a> ,       PHP Russia 2020. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de478618/">https://habr.com/ru/post/de478618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de478596/index.html">PHP Anonymous-Funktionen: Belichten von Black Magic-Sitzungen</a></li>
<li><a href="../de478602/index.html">MVC in Einheit mit skriptf√§higen Objekten. Teil 2</a></li>
<li><a href="../de478604/index.html">Von Arbeitern zu PHP-Programmierern. Ungew√∂hnliche Entwicklungskarriere</a></li>
<li><a href="../de478606/index.html">‚ÄûGute Nacht‚Äú - wie intelligente Ger√§te Menschen den Schlaf rauben</a></li>
<li><a href="../de478616/index.html">Windows UAC h√∂rt nie auf zu √ºberraschen, oder wie man einen Insider erkennt</a></li>
<li><a href="../de478620/index.html">Warum sollten Sie FastAPI ausprobieren?</a></li>
<li><a href="../de478626/index.html">Debuggen der Softwarebereitstellung mit strace</a></li>
<li><a href="../de478628/index.html">Hoher CRI auf Chinesisch</a></li>
<li><a href="../de478634/index.html">Fallstricke im Projektmanagement f√ºr maschinelles Lernen</a></li>
<li><a href="../de478636/index.html">Wie Textcodierungen funktionieren. Woher kommen die "Krokodile"? Die Prinzipien der Kodierung. Verallgemeinerung und detaillierte Analyse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>