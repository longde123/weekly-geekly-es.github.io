<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äç‚öñÔ∏è ü§û üåÉ Romper las reglas de la recolecci√≥n de basura de Unity üåπ üå§Ô∏è üíá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hab√≠a una vez un programador de juegos de la unidad llamado Lancelot. Una muy apasionada, dir√≠a yo. Todav√≠a no lo sab√≠a, pero eventualmente enfrentar√≠...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Romper las reglas de la recolecci√≥n de basura de Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484710/"> Hab√≠a una vez un programador de juegos de la unidad llamado Lancelot.  Una muy apasionada, dir√≠a yo.  Todav√≠a no lo sab√≠a, pero eventualmente enfrentar√≠a el lado m√°s oscuro de la recolecci√≥n de basura de Unity. <br><br><div style="text-align:center;"><img src="https://thegamedevguru.b-cdn.net/wp-content/uploads/2019/12/GC-GarbageCollection-Thumbnail.jpg" alt="imagen"></div><br>  Lancelot siempre estaba buscando <b>t√≠tulos</b> cada vez <b>m√°s grandes</b> para trabajar.  Y as√≠ trabaj√≥ duro para tener su gran oportunidad en la industria de los juegos. <br><br>  No fue f√°cil, eso lo sab√≠a. <br><a name="habracut"></a><br>  Estos lugares en la industria del juego estaban y a√∫n est√°n reservados para una peque√±a minor√≠a de programadores de juegos.  Y no estaba seguro de estar a la altura de todos modos. <br><br>  Pero √©l persisti√≥ y continu√≥ agudizando sus habilidades de programaci√≥n. <br><br>  Lancelot comenz√≥ a trabajar en peque√±os juegos.  Quiz√°s en alg√∫n momento, tendr√≠a la gran oportunidad que estaba buscando, pens√≥. <br><br>  Pasaron los a√±os hasta que tuvo la oportunidad que estaba esperando.  Se le pidi√≥ que transfiriera un gran juego de realidad virtual a una plataforma m√≥vil.  Tan emocionado como estaba Lancelot, no pod√≠a dejar de preguntarse si era <b>lo suficientemente bueno</b> para la tarea.  Fue desalentador pero acept√≥ el desaf√≠o.  Sab√≠a que solo pod√≠a salir de eso. <br><br>  La mayor preocupaci√≥n de Lancelot era la necesidad de mejorar enormemente el rendimiento del juego.  Fue un doble desaf√≠o, de hecho.  Tuvo que <b>mejorar el rendimiento en un 20%</b> para una <b>plataforma</b> significativamente <b>menos potente</b> . <br><br>  Despu√©s de meses de trabajo ininterrumpido, finalmente logr√≥ optimizar el juego lo suficiente como para tener una base de rendimiento s√≥lida como una roca. <br><br>  Sin embargo, un problema inesperado estaba a la vuelta de la esquina ... <br><br>  El generador de perfiles de la unidad le revel√≥ una ca√≠da significativa de la velocidad de cuadros cada pocos segundos.  Y eso le preocupaba porque eso no le permitir√≠a enviar el juego.  El lanzamiento del juego estaba en peligro.  Eso lo hizo sentir completamente inc√≥modo. <br><br>  Basado en su experiencia previa, Lancelot r√°pidamente sospech√≥ del <b>recolector de basura</b> .  Despu√©s de todo, sab√≠a que asignar memoria temporal en el juego con demasiada frecuencia podr√≠a causar estos picos de rendimiento.  Al igual que el bote de basura en la cocina de todos, usted sabe que es hora de limpiarlo cuando alcanza el 80% de su capacidad. <br><br>  Y as√≠ pas√≥ d√≠as luchando contra las molestas asignaciones de memoria.  Realiz√≥ todo tipo de optimizaciones que se le ocurrieron.  Agrupaciones de objetos, almacenamiento en cach√© de datos, optimizaciones de estructura de datos ... <br><br>  Pasar estos d√≠as optimizando lo llev√≥ un poco por delante en el viaje de rendimiento.  Lancelot estaba orgulloso de su trabajo, pero sus preocupaciones solo aumentaron cuando vio que el recolector de basura segu√≠a funcionando cada 15 segundos. <br><br>  Jugar el juego en realidad virtual con estas ca√≠das de rendimiento de alguna manera har√≠a que las personas se vean p√°lidas. <br><br>  "¬øC√≥mo podr√≠a estar pasando eso?", Se pregunt√≥. <br><br>  Con m√°s paciencia y excavaci√≥n, Lancelot descubri√≥ una segunda fuente de asignaciones de memoria que no hab√≠a visto antes.  Esos sucedieron en una <b>biblioteca de terceros</b> . <br><br>  Ech√≥ un vistazo y pronto se dio cuenta de que estaba en la peor posici√≥n: la biblioteca era de c√≥digo cerrado.  No solo eso, tambi√©n trat√≥ de usar el <b>recolector de basura incremental</b> de Unity, pero no pod√≠a pagar el precio de su rendimiento. <br><br>  Lancelot se estaba quedando sin opciones. <br><br>  Se sent√≠a desesperado pero logr√≥ mantener la calma.  Ha estado en situaciones peores despu√©s de todo. <br><br>  Pod√≠a realizar <b>ingenier√≠a inversa en</b> la biblioteca y hacer las optimizaciones de asignaci√≥n de memoria √©l mismo.  El problema era que la licencia no permit√≠a tales cosas.  Y √©l era demasiado joven para ir a la c√°rcel. <br><br>  La segunda opci√≥n que consider√≥ fue <b>preasignar</b> mucha memoria en el mont√≥n.  Sab√≠a que la unidad desencadenaba el proceso de recolecci√≥n de basura cuando el uso del mont√≥n alcanzaba un cierto porcentaje.  Por lo tanto, aumentar el mont√≥n deber√≠a darle m√°s tiempo entre las recolecciones de basura. <br><br>  Lamentablemente, eso todav√≠a no fue suficiente. <br><br>  Lentamente se sinti√≥ como si no tuviera control sobre la situaci√≥n.  Fue duro, pero de nuevo, √©l <b>persisti√≥</b> . <br><br>  Entonces a Lancelot se le ocurri√≥ una <b>idea loca</b> .  ¬øQu√© pasa si deshabilita la recolecci√≥n de basura por completo?  ¬øEra eso posible?  Sinti√≥ en sus huesos lo arriesgada que era esa idea.  No quer√≠a agregar la posibilidad de que el juego se bloquee en puntos impredecibles.  La √∫ltima vez que lo revis√≥, eso no fue divertido para los jugadores.  Tal vez los tiempos cambiaron, pero m√°s vale prevenir que curar. <br><br>  Adem√°s de eso, le preocupaba retrasar el lanzamiento del juego.  No quer√≠a que sus jugadores se perdieran este t√≠tulo para Navidad.  Record√≥ lo divertido que era jugar EverQuest durante estas vacaciones.  No le quitar√≠a eso a los jugadores. <br><br>  Llegado a este punto, no ten√≠a otra opci√≥n que desactivar el recolector de basura. <br><br>  Entr√≥ en modo de investigaci√≥n y descubri√≥ que pod√≠a <b>deshabilitar manualmente la recolecci√≥n de basura</b> .  Realiz√≥ docenas de experimentos para ver cu√°nto tiempo durar√≠a el juego sin quedarse sin memoria.  Hizo todo tipo de pruebas para estresar el sistema.  Al hacer clic en todas partes, caminar y saltar, cambiar entre diferentes aplicaciones. <br><br>  <b>Los n√∫meros</b> comenzaron a llegar en su hoja de c√°lculo: 25 minutos, 28 minutos, 30 minutos ... Tambi√©n not√≥ c√≥mo el uso del mont√≥n aument√≥ con el tiempo para asegurarse de que nunca exceder√≠a un presupuesto seguro. <br><br>  Con esos n√∫meros, Lancelot estableci√≥ un generoso <b>margen seguro</b> y prepar√≥ un <b>prototipo</b> .  Corr√≠a la recolecci√≥n de basura manualmente durante las pantallas de carga y cada pocos minutos. <br><br>  Ten√≠a esperanza de nuevo. <br><br>  Cort√©smente le pidi√≥ a QA que revisara el juego docenas de veces. <br><br>  La memoria siempre estuvo dentro del presupuesto.  No se bloquea.  Sin efectos secundarios. <br><br>  Este largo viaje lo llev√≥ al punto donde pudo <b>enviar</b> el juego. <br><br>  ¬øY adivina qu√©?  Cientos de jugadores ahora lo disfrutan durante el per√≠odo navide√±o. <br><br>  Al principio, no estaba c√≥modo con esta soluci√≥n.  Fue un movimiento arriesgado y √©l lo sab√≠a.  Pero se las arregl√≥ para lograrlo. <br><br>  Lancelot aprendi√≥ a sentirse c√≥modo con lo <b>inc√≥modo</b> .  Aprendi√≥ a ser m√°s <b>pragm√°tico</b> .  Porque hay momentos en que un programador tiene que serlo. <br><br>  ¬øAlgo de la historia te suena?  Si es as√≠, su intuici√≥n probablemente sea correcta. <br><br>  Ese programador era yo. <br><br>  Para las veces que lo necesite, as√≠ es como puede administrar el recolector de basura: <br><br>  Ese fragmento de c√≥digo le muestra c√≥mo deshabilitar las recolecciones de basura autom√°ticas.  Ejecuta el proceso de GC manualmente cada minuto y posiblemente durante las transiciones de pantalla (fundido a negro). <br><br>  Tenga en cuenta sus posibles efectos secundarios: <br><br><ul><li>  <b>Accidentes</b> : si no juegas lo suficientemente seguro, te quedar√°s sin memoria.  Peor a√∫n, el sistema operativo puede matar tu juego cuando cambias de aplicaci√≥n </li><li>  <b>Tiempos de recolecci√≥n de basura m√°s largos</b> : aumentar el mont√≥n har√° que las futuras recolecciones de basura sean m√°s lentas </li></ul><br>  Si necesita producir cantidades generosas de basura, aqu√≠ hay un m√©todo sencillo que funcionar√°: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GenerousGarbageCreator</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> garbageCreationRate = <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] _garbage; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _garbage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[garbageCreationRate]; } }</code> </pre> <br>  Esto es lo que obtendr√°s en el generador de perfiles: <br><br><img src="https://thegamedev.guru/wp-content/uploads/2019/12/GC-Garbage-Collection-Management-Highlight.gif" alt="imagen"><br>  <i>Recolecci√≥n de basura de Unity: disparador manual basado en el tiempo</i> <br><br>  Ah√≠ ves un uso creciente de la memoria.  El uso creciente del mont√≥n se resalta como "mono".  Afortunadamente para nosotros, estamos ejecutando el recolector de basura manual cada 3 segundos. <br><br>  Puede ver claramente este ciclo de generaci√≥n de basura en el gr√°fico del generador de perfiles.  Para aquellos desarrolladores de juegos que estudiaron f√≠sica, es posible que la reconozcan como una forma de onda de diente de sierra. <br><br>  Si desea el c√≥digo fuente de este proyecto, ya sabe d√≥nde encontrarlo (spoiler: aqu√≠). <br><br>  Para optimizaciones de memoria m√°s generales, puede estar interesado en Unity Addressables.  Con los direccionables puede reducir el uso total de memoria para que pueda desencadenar la recolecci√≥n de basura con menos frecuencia.  A su vez, esto reducir√° los picos de rendimiento que experimentar√°n tus jugadores. <br><br>  Tengo muchas ganas de trabajar con todos ustedes en 2020. <br>  Rub√©n </div></div><p>Source: <a href="https://habr.com/ru/post/484710/">https://habr.com/ru/post/484710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484692/index.html">Vitamina C: ¬ønecesito tomar suplementos o es una medida comercial?</a></li>
<li><a href="../484700/index.html">Java 14: vista previa de registros</a></li>
<li><a href="../484702/index.html">Alternativas de Prestashop en 2020: principales plataformas de comercio electr√≥nico</a></li>
<li><a href="../484706/index.html">Practica trabajando con neum√°ticos personalizados del complejo Redd</a></li>
<li><a href="../484708/index.html">Richard Hamming "Cap√≠tulo inexistente": ¬øC√≥mo sabemos lo que sabemos (versi√≥n completa)</a></li>
<li><a href="../484712/index.html">Compatibilidad binaria reactiva: c√≥mo la proporcionamos</a></li>
<li><a href="../484716/index.html">Deja de llamar a todo AI</a></li>
<li><a href="../484718/index.html">Las impresoras modernas HP se niegan a trabajar sin suscripci√≥n de tinta</a></li>
<li><a href="../484720/index.html">Concierto para una ciudad con una orquesta: qui√©n y por qu√© graba los sonidos de la vida cotidiana</a></li>
<li><a href="../484722/index.html">Qu√© herramientas de desarrollo de Ruby on Rails se adaptan a su proyecto: las mejores gemas de Ruby on Rails para 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>