<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ’…ğŸ¼ ğŸ‘§ğŸ¾ Corona SDK json anomali perpustakaan ğŸ“¢ ğŸ‘¨ğŸ¼â€ğŸš€ ğŸ˜¯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Bukan rahasia bagi siapa pun bahwa menggunakan json dalam proyek Anda di Corona SDK dapat membuat beberapa hal cukup nyaman. Saya menem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Corona SDK json anomali perpustakaan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422591/">  Halo semuanya.  Bukan rahasia bagi siapa pun bahwa menggunakan json dalam proyek Anda di Corona SDK dapat membuat beberapa hal cukup nyaman.  Saya menemukan satu anomali menarik ketika bekerja dengan perpustakaan, yang telah ditunjukkan oleh praktik sama sekali bukan kesalahan, melainkan fitur yang harus Anda waspadai dan siapkan.  Mari kita pertimbangkan semuanya secara rinci. <a name="habracut"></a><br><br><h3>  1. Deskripsi masalah </h3><br>  Misalkan kita memiliki array Lua yang terlihat seperti ini: <br><br><pre><code class="lua hljs">ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>}</code> </pre> <br>  Jika Anda memiliki semuanya normal dengan pemahaman bahasa, array ini disajikan kepada Anda seperti yang ditunjukkan di bawah ini, hanya rendah lemak karena keadaan - JADI MUNGKIN: <br><br><pre> <code class="lua hljs">ar = {[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">23</span></span>,[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">45</span></span>,[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">56</span></span>,[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">'weer'</span></span>}</code> </pre> <br>  Jika Anda memutuskan untuk mengubah array ini menjadi json, maka outputnya akan memberi Anda sesuatu seperti ini (tentu saja, kami tidak akan lupa untuk menghubungkan pustaka json): <br><br><pre> <code class="lua hljs">ar = {[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">23</span></span>,[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">45</span></span>,[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">56</span></span>,[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">'weer'</span></span>} json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt; [23,45,56,"weer"]</span></span></code> </pre><br>  Seperti yang Anda lihat, json juga tahu tentang keberadaan catatan yang disederhanakan ini, di mana jika elemen-elemen array berjalan secara berurutan, mereka tidak akan diberi nomor secara eksplisit, dan ini luar biasa karena kita sering menggunakan json dalam proyek-proyek kami untuk protokol jaringan atau untuk menyimpan ke file, dan ukuran ekstra sama sekali tidak ada untuk apa. <br><br>  Sekarang mari kita coba konversi saluran kembali ke tabel Lua dan tampilkan isinya, sambil memperhatikan tipe data kunci: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = <span class="hljs-string"><span class="hljs-string">'[23,45,56,"weer"]'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ar2 = json.decode(str) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k,v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(ar2)<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(k,<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>(k),v) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">--[[ 1 number 23 2 number 45 3 number 56 4 number weer ]]</span></span></code> </pre> <br>  Seperti yang Anda lihat, hasilnya lebih dari yang diharapkan, tabel ar pada input sepenuhnya sesuai dengan tabel ar2 pada output.  Sekarang, mengikuti 2 poin sebelumnya, tetapi pada saat yang sama akan ada sebuah array di mana ada urutan terputus dalam array, katakanlah kita menambahkan kunci 6 (memintas 5) dengan nilai 'wtf'.  Kami bangkrut. <br><br><pre> <code class="lua hljs">json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>,[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-string"><span class="hljs-string">'wtf'</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt;[23,45,56,"weer",null,"wtf"] local t = json.decode(str) for k,v in pairs(t)do print(k,type(k),v) end --[[ 1 number 23 2 number 45 3 number 56 4 number weer 6 number wtf ]]</span></span></code> </pre> <br>  Seperti yang Anda lihat, semuanya menjadi hebat lagi, karena json.encode mengharapkan tangkapan ini dan alih-alih tidak ada 5 kunci yang dimasukkan nol dan ini semua berakhir dengan sukses, kami tidak akan berhenti di situ dan menambahkan kunci 777 lainnya dengan nilai 1 ke array, kemungkinan besar kami harapkan bahwa tabel dikonversi dengan cara yang sama dan akan menyertakan 770 null - ini jelas bukan pilihan terbaik karena akan memakan lebih banyak ruang, tetapi tidak ada cara lain di json untuk membuat analog penuh dari tabel lua ini karena kuncinya bukan di json mungkin jelas  vlen sebagai angka.  Kami melihat apa yang terjadi. <br><br><pre> <code class="lua hljs">json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>,[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-string"><span class="hljs-string">'wtf'</span></span>,[<span class="hljs-number"><span class="hljs-number">777</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt;{"1":23,"2":45,"3":56,"4":"weer","6":"wtf","777":1} local t = json.decode(str) for k,v in pairs(t)do print(k,type(k),v) end --[[ 1 string 23 777 string 1 3 string 56 2 string 45 4 string weer 6 string wtf ]]</span></span></code> </pre> <br>  Seperti yang Anda lihat, encoder pergi ke arah lain dan mengkonversi semua kunci dengan nomor tipe nilai ke string.  Bukan rahasia lagi bahwa fitur seperti itu dapat dan akan menyebabkan kesalahan (jika Anda tidak mengetahuinya), atau ke kruk menggunakan transformasi tonumber / tostring eksplisit ketika bekerja dengan tabel ini, dalam hal apa pun, ini tidak akan membawa banyak kesenangan.  Pertimbangkan cara menangani ini. <br><br><h3>  2. menyelesaikan masalah </h3><br>  Untuk mengatasi masalah ini, Anda dapat menulis fungsi yang akan menginisialisasi semua array di mana masalah muncul, maka dalam kode Anda harus terus-menerus mengingat masalah ini dan menerapkan fungsi ini di mana-mana, ini adalah cara yang normal, tetapi bukan yang terbaik, dan oleh karena itu ada rencana B Definisikan kembali implementasi fungsi json.decode sehingga semua area masalah dikonversi secara otomatis dan solusi ini akan berfungsi baik pada nesting pertama dalam array yang diteruskan dan pada lampiran yang lebih dalam.  Kami akan melakukan redefinisi nilai fungsi segera setelah kami menghubungkan json library ke proyek.  Implementasi berikut tersedia: <br><br><pre> <code class="lua hljs">json = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> jd = json.decode<span class="hljs-comment"><span class="hljs-comment">--   local norm_ar json.decode = function(ar,not_convert)--  local res = jd(ar) --     --    norm_ar = function(root) local res = {} --  for k,v in pairs(root)do res[k] = v end --   for k,v in pairs(res) do if type(k) == 'string' and--  string.match(tostring(k),'%D') == nil then--    -- string -&gt; number root[tonumber(k)] = root[k] root[k] = nil--   end --      if type(v) == 'table' then norm_ar(v) end end return root end --   not_convert    return not_convert and res or norm_ar(res) end</span></span></code> </pre> <br>  Sekarang coba lakukan operasi sebelumnya lagi: <br><br><pre> <code class="lua hljs">ar = {<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>,<span class="hljs-string"><span class="hljs-string">'weer'</span></span>,[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-string"><span class="hljs-string">'wtf'</span></span>,[<span class="hljs-number"><span class="hljs-number">777</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> str = json.encode(ar) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(str)<span class="hljs-comment"><span class="hljs-comment">--&gt;{"1":23,"2":45,"3":56,"4":"weer","6":"wtf","777":1} local t = json.decode(str) for k,v in pairs(t)do print(k,type(k),v) end --[[ 1 number 23 2 number 45 3 number 56 4 number weer 6 number wtf 777 number 1 --]]</span></span></code> </pre> <br>  Seperti yang Anda lihat, semuanya berfungsi dan array mempertahankan struktur sebelumnya.  Terakhir, saya ingin menambahkan bahwa jika karena alasan tertentu Anda perlu menghindari konversi ini, opsi implementasi json.decode baru mendukung parameter opsional kedua yang akan menonaktifkan konversi. <br><br>  Selamat tinggal semuanya! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id422591/">https://habr.com/ru/post/id422591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id422581/index.html">Sakelar kuantum gaya SchrÃ¶dinger</a></li>
<li><a href="../id422583/index.html">Tough Middling: Ulasan Telepon IP Snom D735</a></li>
<li><a href="../id422585/index.html">Penggunaan praktis dari jaringan saraf</a></li>
<li><a href="../id422587/index.html">Cara menyiapkan dan lulus IELTS: pengalaman pribadi</a></li>
<li><a href="../id422589/index.html">Berurusan dengan efek samping kotor dalam kode JavaScript murni dan fungsional</a></li>
<li><a href="../id422593/index.html">Sembunyikan tanpa bersembunyi. Sekali lagi tentang steganografi LSB, chi-square dan ... singularitas?</a></li>
<li><a href="../id422595/index.html">Ilmuwan Rusia telah menciptakan mesin untuk cubesat pada larutan alkohol 40%</a></li>
<li><a href="../id422597/index.html">Backend United # 2: Isian</a></li>
<li><a href="../id422601/index.html">Chrome 69 keluar dengan generator kata sandi acak</a></li>
<li><a href="../id422603/index.html">Sedikit lebih dekat ke kesempurnaan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>