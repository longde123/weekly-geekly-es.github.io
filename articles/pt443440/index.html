<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ≤Ô∏è üé≠ üê¢ M√≥dulo PHP para trabalhar com dados hier√°rquicos no InterSystems IRIS ‚òÇÔ∏è ‚öæÔ∏è ‚ùï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desde o in√≠cio de seu tempo, o PHP √© famoso (e criticado) por oferecer suporte √† integra√ß√£o com uma s√©rie de bibliotecas, bem como com praticamente to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√≥dulo PHP para trabalhar com dados hier√°rquicos no InterSystems IRIS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intersystems/blog/443440/"><img src="https://habrastorage.org/webt/ia/44/2l/ia442lsk5svgjp_oflwf7c_sesw.png" alt="imagem" align="left">  Desde o in√≠cio de seu tempo, o PHP √© famoso (e criticado) por oferecer suporte √† integra√ß√£o com uma s√©rie de bibliotecas, bem como com praticamente todos os DBMSs do mercado.  No entanto, devido a algumas raz√µes estranhas, ele n√£o suportava bancos de dados hier√°rquicos em globais. <br><br>  Globais s√£o estruturas para armazenar informa√ß√µes hier√°rquicas.  Eles lembram um pouco o banco de dados "chave -&gt; valor", com a √∫nica diferen√ßa de que a chave pode ter v√°rios n√≠veis: <br><a name="habracut"></a><br clear="all"><pre><code class="bash hljs">Set ^inn(<span class="hljs-string"><span class="hljs-string">"1234567890"</span></span>, <span class="hljs-string"><span class="hljs-string">"city"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span> Set ^inn(<span class="hljs-string"><span class="hljs-string">"1234567890"</span></span>, <span class="hljs-string"><span class="hljs-string">"city"</span></span>, <span class="hljs-string"><span class="hljs-string">"street"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Req Square"</span></span> Set ^inn(<span class="hljs-string"><span class="hljs-string">"1234567890"</span></span>, <span class="hljs-string"><span class="hljs-string">"city"</span></span>, <span class="hljs-string"><span class="hljs-string">"street"</span></span>, <span class="hljs-string"><span class="hljs-string">"house"</span></span>) = 1 Set ^inn(<span class="hljs-string"><span class="hljs-string">"1234567890"</span></span>, <span class="hljs-string"><span class="hljs-string">"year"</span></span>) = 1970 Set ^inn(<span class="hljs-string"><span class="hljs-string">"1234567890"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"first"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Vladimir"</span></span> Set ^inn(<span class="hljs-string"><span class="hljs-string">"1234567890"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"last"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Ivanov"</span></span></code> </pre> <br>  Neste exemplo, a linguagem ObjectScript incorporada no global <strong>^ inn</strong> , que √© armazenada no disco r√≠gido (indicado pelo √≠cone ^ na frente do nome global), armazena informa√ß√µes em v√°rios n√≠veis. <br><br>  Naturalmente, para trabalhar com globais do PHP, precisaremos de novas fun√ß√µes que ser√£o adicionadas pelo m√≥dulo PHP, que ser√£o discutidas abaixo. <br><br>  Globals suportam muitas fun√ß√µes para trabalhar com hierarquia: ignorando chaves em cada n√≠vel separadamente, excluindo, copiando e colando √°rvores inteiras e n√≥s individuais.  Bem, assim como qualquer bom banco de dados de transa√ß√µes ACID.  Tudo isso acontece com extrema rapidez (cerca de 10 <sup>5 a</sup> 10 <sup>6</sup> opera√ß√µes de inser√ß√£o por segundo no hardware comum), por dois motivos: <br><br><ol><li>  Globals s√£o uma abstra√ß√£o de n√≠vel inferior ao SQL, </li><li>  As bases globais est√£o em produ√ß√£o h√° d√©cadas e, durante esse per√≠odo, conseguiram lamber seu c√≥digo e otimiz√°-lo completamente. </li></ol><br>  Mais sobre globais na s√©rie de artigos ‚ÄúGlobals - espadas-pedreiros para armazenamento de dados‚Äù: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As √°rvores</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As √°rvores</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Matrizes esparsas.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br><br>  Neste mundo, os globais encontraram seu principal local de aplica√ß√£o em sistemas de armazenamento de informa√ß√µes pouco estruturadas e esparsas, como: m√©dicos, dados pessoais, bancos, etc. <br><br>  Eu amo PHP (e desenvolvo isso) e queria brincar com os globais.  N√£o havia m√≥dulo finalizado.  Escrevi para a InterSystems pedindo para cri√°-lo.  A espera n√£o levou a nada e, no final, n√≥s (juntamente com meu aluno de gradua√ß√£o) fizemos o m√≥dulo.  A InterSystems patrocinou o desenvolvimento como parte de uma concess√£o educacional. <br><br>  De maneira geral, o InterSystems IRIS √© um DBMS de v√°rios modelos, portanto, do PHP, voc√™ pode trabalhar com ele atrav√©s do ODBC usando SQL, mas eu estava interessado em globais, e n√£o havia esse conector. <br><br>  Portanto, o m√≥dulo est√° dispon√≠vel para o PHP 7.x (testado sob 7.0-7.2).  Atualmente, ele s√≥ pode funcionar com o InterSystems IRIS e Cach√© instalado no mesmo host. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">P√°gina do m√≥dulo no OpenExchange</a> (um cat√°logo de projetos e complementos para desenvolvedores no InterSystems IRIS e Cach√©). <br><br>  H√° uma se√ß√£o de discuss√£o √∫til na qual as pessoas compartilham suas experi√™ncias de uso. <br><br>  Fa√ßa o download aqui: <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/intersystems-community/php_ext_iris</a> <br></blockquote>  Fa√ßa o download do reposit√≥rio na linha de comando: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/intersystems-community/php_ext_iris</code> </pre> <br>  <a href="">Instru√ß√µes para instalar o m√≥dulo em ingl√™s e russo.</a> <br><br>  Fun√ß√µes do m√≥dulo: <br><div class="scrollable-table"><table><tbody><tr><td>  Fun√ß√£o php </td><td>  Descri√ß√£o do produto </td></tr><tr><th colspan="2">  Trabalhar com dados </th></tr><tr><td>  <nobr>iris_set ($ n√≥, valor)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Local de instala√ß√£o.</b> <div class="spoiler_text"><ol><li><blockquote>  <strong>iris_set ($ global, $ subscript1, ..., $ subscriptN, $ value);</strong> <strong><br></strong>  <strong>iris_set ($ global, $ valor);</strong> </blockquote><br>  <strong>Retorna:</strong> verdadeiro ou falso (em erro). <br>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices, o √∫ltimo par√¢metro √© o valor. <br><br><pre> <code class="php hljs">iris_set(<span class="hljs-string"><span class="hljs-string">'^time'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); iris_set(<span class="hljs-string"><span class="hljs-string">'^time'</span></span>, <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>);</code> </pre> <br>  Anal√≥gico no ObjectScript <br><br><pre> <code class="bash hljs">Set ^time = 1 Set ^time(<span class="hljs-string"><span class="hljs-string">"tree"</span></span>, 1, 1) = <span class="hljs-string"><span class="hljs-string">"value"</span></span></code> </pre> </li><li><blockquote>  <strong>iris_set ($ arrayGlobal, $ value);</strong> </blockquote>  Apenas 2 par√¢metros: o primeiro √© uma matriz na qual o nome do global e todos os seus √≠ndices s√£o armazenados;  o segundo √© significado. <br><br><pre> <code class="php hljs">$node = [<span class="hljs-string"><span class="hljs-string">'^time'</span></span>, <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; iris_set($node,<span class="hljs-string"><span class="hljs-string">'value'</span></span>);</code> </pre> </li></ol></div></div><br></td></tr><tr><td>  <nobr>iris_get ($ node)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Leia o n√≥.</b> <div class="spoiler_text">  <strong>Retorna:</strong> valor (n√∫mero ou sequ√™ncia), NULL (valor n√£o definido) ou FALSE (com erro). <br><br><ol><li><blockquote>  <strong>iris_get ($ global, $ subscript1, ..., $ subscriptN);</strong> <strong><br></strong>  <strong>iris_get ($ global);</strong> </blockquote>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices.  Um global pode n√£o ter √≠ndices. <br><br><pre> <code class="php hljs">$res = iris_get(<span class="hljs-string"><span class="hljs-string">'^time'</span></span>); $res1 = iris_get(<span class="hljs-string"><span class="hljs-string">'^time'</span></span>, <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> </li><li><blockquote>  <strong>iris_get ($ arrayGlobal);</strong> </blockquote>  O √∫nico par√¢metro √© a matriz na qual o nome do global e todos os seus √≠ndices s√£o armazenados. <br><br><pre> <code class="php hljs">$node = [<span class="hljs-string"><span class="hljs-string">'^time'</span></span>, <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; $res = iris_get($node);</code> </pre> </li></ol><br></div></div></td></tr><tr><td>  <nobr>iris_zkill ($ n√≥)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Excluindo um valor do n√≥.</b> <div class="spoiler_text">  <strong>Retorna:</strong> VERDADEIRO ou FALSO - com erro. <br><br>  √â importante observar que essa fun√ß√£o exclui apenas o valor no n√≥ e n√£o toca nas ramifica√ß√µes subjacentes. <br><br><ol><li><blockquote>  <strong>iris_zkill ($ global, $ subscript1, ..., $ subscriptN);</strong> <strong><br></strong>  <strong>iris_zkill ($ global);</strong> </blockquote>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices.  Um global pode n√£o ter √≠ndices. <br><br><pre> <code class="php hljs">$res = iris_zkill(<span class="hljs-string"><span class="hljs-string">'^time'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . $res1 = iris_zkill('^time', 'tree', 1, 1);</span></span></code> </pre> </li><li><blockquote>  <strong>iris_zkill ($ arrayGlobal);</strong> </blockquote>  O √∫nico par√¢metro √© a matriz na qual o nome do global e todos os seus √≠ndices s√£o armazenados. <br><br><pre> <code class="php hljs">$a = [<span class="hljs-string"><span class="hljs-string">'^time'</span></span>, <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; $res = iris_zkill($a);</code> </pre> </li></ol><br></div></div></td></tr><tr><td>  <nobr>iris_kill ($ node)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Exclua um n√≥ e todas as ramifica√ß√µes descendentes.</b> <div class="spoiler_text">  Retorna: VERDADEIRO ou FALSO - com erro. <br><br><ol><li><blockquote>  <strong>iris_kill ($ global, $ subscript1, ..., $ subscriptN);</strong> <strong><br></strong>  <strong>iris_kill ($ global);</strong> </blockquote>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices.  Um global pode n√£o ter √≠ndices; nesse caso, ele √© exclu√≠do completamente. <br><br><pre> <code class="php hljs">$res1 = iris_kill(<span class="hljs-string"><span class="hljs-string">'^example'</span></span>, <span class="hljs-string"><span class="hljs-string">'subscript1'</span></span>, <span class="hljs-string"><span class="hljs-string">'subscript2'</span></span>); $res = iris_kill(<span class="hljs-string"><span class="hljs-string">'^time'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   .</span></span></code> </pre></li><li><blockquote>  <strong>iris_kill ($ arrayGlobal);</strong> </blockquote>  O √∫nico par√¢metro √© a matriz na qual o nome do global e todos os seus √≠ndices s√£o armazenados. <br><br><pre> <code class="php hljs">$a = [<span class="hljs-string"><span class="hljs-string">'^time'</span></span>, <span class="hljs-string"><span class="hljs-string">'tree'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; $res = iris_kill($a);</code> </pre> </li></ol><br></div></div></td></tr><tr><td>  <nobr>iris_order ($ node)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Ignorar filiais globais em um determinado n√≠vel</b> <div class="spoiler_text">  <strong>Retorna: uma</strong> matriz que cont√©m o nome completo do pr√≥ximo n√≥ global ou FALSE (em erro). <br><br><ol><li><blockquote>  <strong>iris_order ($ global, $ subscript1, ..., $ subscriptN);</strong> </blockquote>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices. <br><br>  Formul√°rio de uso do PHP e equivalente ao ObjectScript: <br><br><pre> <code class="php hljs">iris_order(<span class="hljs-string"><span class="hljs-string">'^ccc'</span></span>,<span class="hljs-string"><span class="hljs-string">'new2'</span></span>,<span class="hljs-string"><span class="hljs-string">'res2'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// $Order(^ccc("new2", "res2"))</span></span></code> </pre> </li><li><blockquote>  <strong>iris_order ($ arrayGlobal);</strong> </blockquote>  O √∫nico par√¢metro √© a matriz na qual o nome global e os √≠ndices do n√≥ inicial s√£o armazenados. <br><br><pre> <code class="php hljs">$node = [<span class="hljs-string"><span class="hljs-string">'^inn'</span></span>, <span class="hljs-string"><span class="hljs-string">'1234567890'</span></span>, <span class="hljs-string"><span class="hljs-string">'city'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; $node !== <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; $node = iris_order($node)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> join(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $node).<span class="hljs-string"><span class="hljs-string">'='</span></span>.iris_get($node).<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; }</code> </pre> <br>  Nos dar√° uma conclus√£o: <br><br><pre> <code class="bash hljs">^inn, 1234567890, city=Moscow ^inn, 1234567890, year=1970</code> </pre> </li></ol><br></div></div></td></tr><tr><td>  <nobr>iris_order_rev ($ node)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Ignorar filiais globais em um determinado n√≠vel na ordem inversa</b> <div class="spoiler_text">  <strong>Retorna: uma</strong> matriz que cont√©m o nome completo do n√≥ global anterior no mesmo n√≠vel ou FALSE (se ocorrer um erro). <br><br><ol><li><blockquote>  <strong>iris_order_rev ($ global, $ subscript1, ..., $ subscriptN);</strong> </blockquote><br>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices. <br><br>  Formul√°rio de uso do PHP e equivalente ao ObjectScript: <br><br><pre> <code class="php hljs">iris_order_rev(<span class="hljs-string"><span class="hljs-string">'^ccc'</span></span>,<span class="hljs-string"><span class="hljs-string">'new2'</span></span>,<span class="hljs-string"><span class="hljs-string">'res2'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// $Order(^ccc("new2", "res2"), -1)</span></span></code> </pre> </li><li><blockquote>  <strong>iris_order_rev ($ arrayGlobal);</strong> </blockquote><br>  O √∫nico par√¢metro √© a matriz na qual o nome global e os √≠ndices do n√≥ inicial s√£o armazenados. <br><br><pre> <code class="php hljs">$node = [<span class="hljs-string"><span class="hljs-string">'^inn'</span></span>, <span class="hljs-string"><span class="hljs-string">'1234567890'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'last'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; $node !== <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; $node = iris_order_rev($node)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> join(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $node).<span class="hljs-string"><span class="hljs-string">'='</span></span>.iris_get($node).<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; }</code> </pre> <br>  Nos dar√° uma conclus√£o: <br><br><pre> <code class="bash hljs">^inn, 1234567890, name, last=Ivanov ^inn, 1234567890, name, first=Vladimir</code> </pre> </li></ol><br></div></div></td></tr><tr><td>  <nobr>iris_query ($ CmdLine)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Ignorando filiais globais com entrada para n√≠veis mais baixos</b> <div class="spoiler_text">  <strong>Retorna: uma</strong> matriz que cont√©m o nome completo do n√≥ subjacente (se houver) ou o pr√≥ximo n√≥ global (se n√£o houver n√≥ aninhado). <br><br><ol><li><blockquote>  <strong>iris_query ($ global, $ subscript1, ..., $ subscriptN);</strong> </blockquote>  Todos os par√¢metros de fun√ß√£o s√£o cadeias ou n√∫meros.  O primeiro √© o nome do global, depois os √≠ndices. <br><br>  Formul√°rio de uso do PHP e equivalente ao ObjectScript: <br><br><pre> <code class="php hljs">iris_query(<span class="hljs-string"><span class="hljs-string">'^ccc'</span></span>, <span class="hljs-string"><span class="hljs-string">'new2'</span></span>, <span class="hljs-string"><span class="hljs-string">'res2'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// $Query(^ccc("new2", "res2"))</span></span></code> </pre> </li><li><blockquote>  <strong>iris_query ($ arrayGlobal);</strong> </blockquote>  O √∫nico par√¢metro √© a matriz na qual o nome global e os √≠ndices do n√≥ inicial s√£o armazenados. <br><br><pre> <code class="php hljs">$node = [<span class="hljs-string"><span class="hljs-string">'^inn'</span></span>, <span class="hljs-string"><span class="hljs-string">'city'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; $node !== <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; $node = iris_query($node)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> join(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $node).<span class="hljs-string"><span class="hljs-string">'='</span></span>.iris_get($node).<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; }</code> </pre> <br>  Nos dar√° uma conclus√£o: <br><br><pre> <code class="bash hljs">^inn, 1234567890, city=Moscow ^inn, 1234567890, city, street=Req Square ^inn, 1234567890, city, street, house=1 ^inn, 1234567890, name, first=Vladimir ^inn, 1234567890, name, last=Ivanov ^inn, 1234567890, year=1970</code> </pre> </li></ol><br>  A ordem difere da ordem em que definimos, pois no global automaticamente quando voc√™ insere tudo √© classificado em ordem crescente. <br></div></div></td></tr><tr><th colspan="2">  Fun√ß√µes de Servi√ßo </th></tr><tr><td>  <nobr>iris_set_dir ($ FullPath)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Definindo um diret√≥rio com um banco de dados</b> <div class="spoiler_text">  <strong>Retorna:</strong> VERDADEIRO ou FALSO - com erro. <br><br><pre> <code class="php hljs">iris_set_dir(<span class="hljs-string"><span class="hljs-string">'/InterSystems/Cache/mgr'</span></span>);</code> </pre> <br>  Ele deve ser conclu√≠do antes de conectar-se ao banco de dados. <br></div></div></td></tr><tr><td>  <nobr>iris_exec ($ CmdLine)</nobr> </td><td><div class="spoiler">  <b class="spoiler_title">Executar comando DB</b> <div class="spoiler_text">  <strong>Retorna:</strong> VERDADEIRO ou FALSO - com erro. <br><br><pre> <code class="php hljs">iris_exec(<span class="hljs-string"><span class="hljs-string">'kill ^global(6)'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   ObjectScript   </span></span></code> </pre> <br></div></div></td></tr><tr><td>  <nobr>iris_connect ($ login, $ pass)</nobr> </td><td>  Conectar ao DB </td></tr><tr><td>  <nobr>iris_quit ()</nobr> </td><td>  Interromper a conex√£o com o banco de dados </td></tr><tr><td>  <nobr>iris_errno ()</nobr> </td><td>  Obter c√≥digo de erro </td></tr><tr><td>  <nobr>iris_error ()</nobr> </td><td>  Obter uma descri√ß√£o em texto do erro </td></tr></tbody></table></div><br>  Se voc√™ quiser jogar com o m√≥dulo, ent√£o: <br><br><div class="spoiler">  <b class="spoiler_title">Especialmente para usu√°rios do Habr, um Dockerfile foi criado para criar a imagem.</b> <div class="spoiler_text"><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/intersystems-community/php_ext_iris <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php_ext_iris/iris docker-compose build docker-compose up -d</code> </pre><br>  Testando a p√°gina de demonstra√ß√£o no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">localhost: 52080</a> no navegador. <br><br>  Os arquivos PHP que podem ser editados e reproduzidos com eles est√£o na pasta php / demo e ser√£o montados dentro do cont√™iner. <br><br>  Para testar o IRIS, use o nome de usu√°rio <strong>admin</strong> , a senha √© <strong>SYS</strong> . <br><br>  Para inserir as configura√ß√µes do IRIS, use o seguinte URL: <br>  <a href="">http: // localhost: 52773 / csp / sys / UtilHome.csp</a> <br><br>  Para entrar no console IRIS deste cont√™iner, use o comando: <br><pre> <code class="bash hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it iris_iris_1 iris session IRIS</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Especialmente para usu√°rios de Habr e InterSystems Cach√©, a virtualka com m√≥dulo php foi levantada.</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">P√°gina de demonstra√ß√£o em russo.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">P√°gina de demonstra√ß√£o em ingl√™s.</a> <br>  Login: habr_test <br>  Senha: burmur # @ 8765 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Para auto-instala√ß√£o do m√≥dulo no InterSystems Cach√©</b> <div class="spoiler_text"><ol><li>  Tenha Linux.  Eu testei no Ubuntu, no Windows o m√≥dulo tamb√©m deve ser constru√≠do, mas n√£o o testei. </li><li>  Baixe a vers√£o gratuita: <ul><li>  <a href="">Cach√© da InterSystems (registro obrigat√≥rio)</a> .  No Linux pronto para uso, o Red Hat e o Suse s√£o suportados, mas voc√™ pode coloc√°-lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em outras distribui√ß√µes</a> . </li></ul><br></li><li>  Instale o m√≥dulo cach.so no PHP de <a href="">acordo com as instru√ß√µes</a> . </li></ol></div></div><br>  No cont√™iner do docker do meu computador pessoal (AMD FX-9370 @ 4700Mhz 32GB, LVM, SATA SSD), por divers√£o, fiz dois testes primitivos sobre a velocidade de inser√ß√£o de novos valores no banco de dados. <br><br><ul><li>  A inser√ß√£o de 1 milh√£o de novos elementos no global levou 1,81 segundo ou 552 mil inser√ß√µes por segundo. </li><li>  A atualiza√ß√£o de um valor no mesmo 1.000.000 vezes global levou 1,98 segundos ou 505K atualiza√ß√µes por segundo.  Um fato interessante √© que ocorre a inser√ß√£o do que a atualiza√ß√£o.  Aparentemente, isso √© uma consequ√™ncia da otimiza√ß√£o inicial do banco de dados para inser√ß√£o r√°pida. </li></ul><br>  √â claro que esses testes n√£o podem ser precisos e √∫teis, pois s√£o primitivos, feitos em um cont√™iner.  Em um hardware mais poderoso com um sistema de disco SSD PCIe, √© poss√≠vel obter dezenas de milh√µes de inser√ß√µes por segundo. <br><br><h3>  O que pode ser conclu√≠do e o estado atual </h3><br><ol><li>  Voc√™ pode adicionar fun√ß√µes √∫teis para trabalhar com transa√ß√µes (voc√™ ainda pode us√°-las atrav√©s do iris_exec). </li><li>  A fun√ß√£o de retornar toda a estrutura do global n√£o √© implementada para que o PHP n√£o ignore o global. </li><li>  A fun√ß√£o de salvar a matriz PHP como uma sub√°rvore n√£o est√° implementada. </li><li>  O acesso √†s vari√°veis ‚Äã‚Äãlocais do banco de dados n√£o est√° implementado.  Somente atrav√©s do iris_exec, embora seja melhor atrav√©s do iris_set. </li><li>  N√£o implementado ignorando o global em profundidade na dire√ß√£o oposta. </li><li>  O acesso ao banco de dados atrav√©s do objeto usando m√©todos (semelhantes √†s fun√ß√µes atuais) n√£o √© implementado. </li></ol><br>  O m√≥dulo atual provavelmente ainda n√£o est√° pronto para produ√ß√£o: n√£o houve testes para altas cargas e vazamentos de mem√≥ria.  No entanto, se algu√©m precisar, entre em contato comigo (Sergey Kamenev updates@mail.ru). <br><br><h3>  Conclus√£o </h3><br>  Por um longo tempo, os mundos do PHP e as bases hier√°rquicas em globais praticamente n√£o se cruzaram, embora os globais proporcionem funcionalidade forte e r√°pida em tipos de dados espec√≠ficos (m√©dicos, pessoais). <br><br>  Espero que este m√≥dulo sirva de incentivo para experimentos de programadores PHP com globais e programadores ObjectScript para o desenvolvimento simples de interfaces da Web em PHP. <br><br>  PS Obrigado por sua aten√ß√£o! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443440/">https://habr.com/ru/post/pt443440/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443430/index.html">Por que √© ruim quando a Internet sabe tudo sobre voc√™?</a></li>
<li><a href="../pt443432/index.html">Lan√ßamento do Blazor 0.9.0</a></li>
<li><a href="../pt443434/index.html">Notifica√ß√µes: a√ß√£o necess√°ria para obter lucros / perdas. Caso seu Broker n√£o suporte esses pedidos</a></li>
<li><a href="../pt443436/index.html">Onde falar sobre o Apache Ignite, bancos de dados distribu√≠dos e aprendizado de m√°quina distribu√≠do na primavera</a></li>
<li><a href="../pt443438/index.html">7 extens√µes √∫teis do Firefox para aprender ingl√™s</a></li>
<li><a href="../pt443450/index.html">Por que os pobres n√£o podem ser saud√°veis</a></li>
<li><a href="../pt443452/index.html">Militares russos criar√£o sua pr√≥pria Internet fechada</a></li>
<li><a href="../pt443456/index.html">Convidamos voc√™ a Yandex PNL por uma semana</a></li>
<li><a href="../pt443458/index.html">6 erros divertidos do sistema na opera√ß√£o do Kubernetes [e sua solu√ß√£o]</a></li>
<li><a href="../pt443460/index.html">11 respostas sobre Yandex.Directory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>