<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚼 😅 ☯️ "Un, deux, trois - brûlez le sapin de Noël!" Ou mon premier regard sur le petit contrôleur CANNY 3 👌🏻 🧖🏽 📹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="«Nouvel an», ce sont les mandarines, Olivier, les week-ends et bien sûr les cadeaux. 

 Comme vous l'avez probablement déjà deviné, je suis soudaineme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Un, deux, trois - brûlez le sapin de Noël!" Ou mon premier regard sur le petit contrôleur CANNY 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482948/">  «Nouvel an», ce sont les mandarines, Olivier, les week-ends et bien sûr les cadeaux. <br><br>  Comme vous l'avez probablement déjà deviné, je suis soudainement devenu le propriétaire du microcontrôleur CANNY 3 Tiny.  Certes, je ne suis pas particulièrement dans l'électronique de bricolage et la dernière fois que j'ai moi-même essayé de connecter quelque chose au contrôleur il y a près de sept ans, lorsque j'ai fait du rétro-éclairage <a href="https://habr.com/ru/post/184144/">pour le persil en utilisant le clone Arduino</a> .  Mais le bien ne disparaît-il pas?  Nous devons encore voir de quel genre de bête il s'agit. <br><br>  Ainsi, selon le site des développeurs, leurs produits sont largement utilisés et même installés dans KAMAZ participant au rallye Dakar.  Dans le même temps, la principale caractéristique de leurs contrôleurs est que pour la programmation, vous n'avez pas à écrire une seule ligne de code.  L'ensemble du programme est développé sous forme de diagramme.  En tant que personne loin du monde du bricolage, j'étais très intriguée. <br><br>  Et tout irait bien, mais il y a un hic.  L'année dernière, je voulais honnêtement acheter une paire de camions Dakarovsky KAMAZ, mais je n'ai pas réussi à les obtenir à prix réduit le Black Friday.  Nous devons donc en quelque sorte sortir de cette situation simplement et avec élégance. <br><br>  Dans cet article, nous allons connecter le bouton et la LED piranha rouge au contrôleur, après quoi nous les programmerons pour que la LED s'allume et s'éteigne en appuyant sur le bouton. <br><br>  Voulez-vous rejoindre le plaisir de ma nouvelle année rampante?  Alors vous êtes les bienvenus sous chat. <br><br><img src="https://habrastorage.org/webt/gw/ij/hy/gwijhya-ewtskixrwrdvavds_ww.png"><br><a name="habracut"></a><br>  Soit dit en passant, sur Habré, il y avait déjà un <a href="https://habr.com/ru/post/369429/">article sur les contrôleurs CANNY</a> , mais d'une part, il y avait un autre contrôleur là-bas, et d'autre part, les logiciels de développement de programmes étaient obsolètes à partir de ce moment.  En conséquence, il m'a fallu environ une heure pour comprendre comment faire clignoter la LED verte intégrée au contrôleur.  C'est en partie pourquoi j'ai décidé de partager avec vous mes tentatives de "freiner" le contrôleur.  <i>Et en partie juste parce que j'aime écrire dans Habr, quand j'ai du temps libre.</i> <br><br>  Avant d'aller plus loin, je considère qu'il est de mon devoir d'avertir les lecteurs.  Malgré le fait que cet article soit présenté comme un "tutoriel", je ne suis pas un expert en microélectronique ni en programmation.  Je vais juste partager ce que j'ai réussi à comprendre afin de vous faire gagner du temps. <br><br>  C'est ce que l'article va discuter: <br><br>  <a href="https://habr.com/ru/post/482948/">Partie I: Déballage et familiarisation</a> <br>  <a href="https://habr.com/ru/post/482948/">Partie II: Connexion du circuit</a> <br>  <a href="https://habr.com/ru/post/482948/">Partie III: Programmation</a> <br>  <a href="https://habr.com/ru/post/482948/">Partie IV: Conclusion</a> <br><a name="I"></a><br><h2>  Partie I: Déballage et familiarisation </h2><br>  Pour commencer, il faut dire au moins quelques mots sur notre héros de l'article.  Le petit contrôleur CANNY 3 est la plus petite famille de contrôleurs CANNY.  Les frères aînés CANNY 3 Tiny - les contrôleurs des séries CANNY 7 et CANNY 5 sont capables de fonctionner avec le bus CAN de la voiture.  Notre jeune frère, comme ma vieille voiture Zhiguli, ne sait rien du bus CAN et vit en paix. <br><br>  Pour plus d'informations sur le contrôleur, consultez la <a href="https://wiki.canny.ru/index.php%3Ftitle%3DCANNY_3_tiny" rel="nofollow">section Wiki</a> correspondante.  Les développeurs ont également une section sur le <a href="https://forum.canny.ru/viewforum.php%3Fid%3D12" rel="nofollow">forum</a> , grâce à laquelle j'ai finalement compris comment configurer les registres du contrôleur pour l'entrée et la sortie. <br><br>  Mais nous reviendrons sur les problèmes de programmation plus tard.  Voyons enfin un cadeau inattendu. <br><br><img src="https://habrastorage.org/webt/j6/wl/oc/j6wlocyi347hcsq7yjy3xzny6b4.png"><br><br>  En ouvrant la boîte, j'ai ressenti une courte sensation de tendresse.  Le contrôleur est vraiment petit.  Pardonnez aux fans de me pardonner une comparaison inappropriée, mais il est presque comme "bébé Yoda". <br><br><img title="image de https://www.boredpanda.com/baby-yoda-the-mandalorian-star-wars/?utm_source=google&amp;utm_medium=organic&amp;utm_campaign=organic" src="https://habrastorage.org/webt/1m/a8/cs/1ma8csw3fpmhebz9lwywv97bkhw.png"><br><br>  Selon les magasins en ligne, le contrôleur a deux options de configuration: sans bornier et faisceau, ainsi qu'avec eux.  Compte tenu de ma courbure en termes de «soudure quelque chose», je suis très content d'avoir obtenu une version avec bornier et faisceau. <br><br>  Je vais cacher quelques photos de plus du contrôleur et du harnais sous le spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Plus de photos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dg/yg/l3/dgygl39ncrq4k7_kju-ew_qaonw.png"><br><img src="https://habrastorage.org/webt/mx/xx/ha/mxxxhah45zvwcpprfzmaiedqsfo.png"><br></div></div><br><a name="II"></a><br><h2>  Partie II: Connexion du circuit </h2><br>  Comme je l'ai dit, nous allons connecter une LED au contrôleur (dans notre cas, "piranha"), mais tout le monde est possible (je n'en avais tout simplement pas d'autre).  Nous contrôlerons la LED à l'aide du bouton.  L'algorithme de fonctionnement est le suivant: une fois enfoncé le bouton et la LED est allumée, une nouvelle fois enfoncée est éteinte. <br><br>  Décrivons brièvement les caractéristiques du contrôleur jours importants de notre cas: <br><br><ol><li>  Nous alimenterons le contrôleur à partir du chargeur microUSB (dans mon cas 5V, 1 A); </li><li>  Le contrôleur possède 6 broches programmables, ainsi que les broches "+" et "-"; </li><li>  Les sorties programmables peuvent être configurées soit comme une «entrée» soit comme une sortie; </li><li>  Le courant maximum à la sortie des bornes contrôlées est de 100 mA; </li><li>  Les conclusions ont différents modes, y compris PWM, mais aujourd'hui, nous n'irons pas aussi loin. </li></ol><br>  J'ai essayé de faire en sorte que vous puissiez comprendre, ma simple idée et même de mettre KiCad pour dessiner au moins quelques croquis. <br><br>  <i>Pour être honnête, je ne suis pas bon dans ces domaines, et je vois KiCad la première (ou la deuxième) fois de ma vie, donc si vous trouvez des erreurs, assurez-vous de me le dire afin que je puisse le réparer.</i> <br><br><img src="https://habrastorage.org/webt/dn/t6/xf/dnt6xf2vl6xzwv_yru_pgf_syla.png"><br><br><img src="https://habrastorage.org/webt/rt/km/y9/rtkmy9vwn_gofdpom7x0boetzvo.png"><br><br>  Comme vous l'espérez, nous comprenons des diagrammes que dans notre projet, nous utiliserons: le contrôleur lui-même, une planche à pain, une résistance de limitation de courant de 80 Ohms, un bouton similaire à KLS7-TS6601-5.0-180 et une LED similaire à BL-FL7600UEC, mais en fait, vous pouvez remplacez-les par ce qui est à portée de main. <br><br>  La logique de connexion est la suivante: <br><br><ol><li>  La sortie «-» du contrôleur est connectée au bus moins; </li><li>  La sortie «2» nous servira de «plus», connectez-la au bus correspondant sur la maquette; </li><li>  Conclusion "1" Fonctionnera à l'entrée et recevra un signal si le bouton ferme le circuit (lorsqu'il est enfoncé); </li><li>  La sortie «4» sera alimentée par notre LED, pour plus de commodité, je l'ai connectée à un autre bus «+» sur la platine, mais ce n'est pas nécessaire. </li><li>  L'arbre de Noël est un attribut de la nouvelle année et justifie à tous égards le titre de cet article. </li></ol><br><a name="III"></a><br><h2>  Partie III: Programmation </h2><br>  Pour programmer le contrôleur, nous avons besoin de l'environnement de développement CannyLab, vous pouvez le télécharger sur le site du développeur.  Au moment d'écrire ces lignes, la version actuelle était 1.41.  L'environnement de développement ne nécessite pas d'installation, il vous suffit de décompresser l'archive dans un dossier. <br><br>  Avant d'écrire du code pour notre circuit, assurons-nous que tout fonctionne pour nous. <br>  Dans mon cas, la première chose à faire a été d'écrire le logiciel système sur le contrôleur. <br><br>  Nous connectons le contrôleur via un câble microUSB à l'ordinateur.  Dans mon cas, sur Windows 10, je n'ai pas eu à installer de pilote séparément. <br><br>  Nous nous assurons que le contrôleur est connecté, sinon, cliquez sur le bouton "Connecter" (ressemble à deux maillons d'une chaîne) <br><br>  Ensuite, vous devez appeler la boîte de dialogue à l'adresse «Périphérique -&gt; Logiciel système -&gt; Écrire» et sélectionner le fichier approprié (dans mon cas «c3tinyv00108.ccx»).  Au cas où, je laisserais une capture d'écran ci-dessous. <br><br><img src="https://habrastorage.org/webt/99/09/og/9909ogg8gl7vwfvwhvt2j3zi2ii.png"><br><br>  Vous pouvez maintenant configurer le programme. <br><br>  Le programme est formé en faisant glisser les éléments de gauche sur le champ blanc de l'espace de travail, puis en reliant les éléments entre eux. <br><br>  Afin de faire clignoter la LED intégrée en mode PWM, nous avons besoin de 3 constantes, d'un bloc générateur de signal PWM et d'un registre d'écriture. <br><br>  Nous connectons tout comme sur l'image. <br><br><img src="https://habrastorage.org/webt/vy/n5/sp/vyn5spknchxhe7ko4wm4wbbkpa0.png"><br><br>  Les valeurs des constantes et des registres peuvent être définies si vous double-cliquez dessus avec LMB. <br>  Quelles sont ces mystérieuses valeurs de constantes? <br><br><ul><li>  "3000" - une période de 3 secondes; </li><li>  "1500" - nous dit que notre LED de trois secondes ne brillera que d'un an et demi; </li><li>  «1» - démarre simplement le générateur. </li></ul><br>  <i>Afin de ne pas rechercher la valeur souhaitée du registre pendant une longue période, entrez la ligne «LED» dans la fenêtre «Filtre»</i> <br><br>  Nous écrivons le programme dans la mémoire du contrôleur. <br><br><img src="https://habrastorage.org/webt/4o/3x/e-/4o3xe-ht5p4-e17yzjpmx6-cmt0.png"><br><br>  Ensuite, déconnectez le contrôleur de l'ordinateur et passez le fil au chargement USB. <br><br>  Le voyant vert clignote avec une période de trois secondes, donc tout fonctionne comme nous le voulions. <br><br><img src="https://habrastorage.org/webt/sz/ir/kc/szirkckvqoex2r0ynkj9eebhghw.png"><br><br>  Quelques mots sur l'environnement de développement, tout d'abord, il vérifie les erreurs dans le diagramme avant de le télécharger sur le contrôleur, ce qui signifie qu'il y a une certaine «protection contre le fou».  Deuxièmement, si vous cliquez sur le bouton sous la forme d'un "bug", l'émulateur du graphique s'ouvrira, mais plus à ce sujet une autre fois. <br><br>  Passons au programme du circuit. <br><br>  Assemblez le diagramme comme sur l'image. <br><br><img src="https://habrastorage.org/webt/mk/oe/m4/mkoem46zzjx5l-qvq3yn9vvuejs.png"><br><br>  Afin de ne pas chercher longtemps les noms des registres et des constantes, utilisez le filtre par analogie avec la capture d'écran. <br><br><img src="https://habrastorage.org/webt/ll/fx/ga/llfxga06iodeygrpjyu2pwenup8.png"><br><br>  Expliquez brièvement les blocs. <br><br><pre><code class="plaintext hljs">« /   » -  . .   2»</code> </pre> <br>  Il nous définit la sortie 2 pour fournir + 5V, de même pour le quatrième canal <br><br>  Puisque le canal 2 est en fait utilisé comme «+ 5 V», nous écrivons simplement la constante «1» (je pense que n'importe quel nombre peut être supérieur à zéro). <br><br>  <i>Remarque: La tension aux sorties du contrôleur dépend de la tension d'alimentation et peut varier selon la façon dont vous l'alimentez.</i> <br><br>  Mais le canal 4 donne ici + 5V, alors ce n'est pas le cas, en fonction de la pression sur un bouton. <br><br>  Le canal 1 est configuré par défaut pour l'entrée et rien ne doit être configuré séparément, nous prenons sa valeur d'entrée en utilisant le bloc: <br><br><pre> <code class="plaintext hljs">« . .  1»</code> </pre><br>  Et nous passons au bloc de négation logique ("Non"). <br><br>  Le bloc "Non" est nécessaire pour que par défaut lorsque le circuit est allumé, notre LED s'allume immédiatement.  Si ce bloc est supprimé et que le registre de canal 1 est connecté directement au détecteur de bord d'attaque, la LED sera éteinte par défaut. <br><br>  Le détecteur de bord d'attaque se déclenche lorsque nous appuyons sur le bouton et ne donnera plus de signaux tant que nous n'aurons pas décidé d'appuyer à nouveau. <br><br>  Pour enregistrer l'état actuel, un déclencheur «T» est utilisé.  Si l'on est alimenté à l'entrée "T", et qu'une seule impulsion est alimentée à l'entrée "C" de la sortie du détecteur, alors notre déclencheur alternera l'état "0" et l'état "1" à la sortie.  Exactement ce dont nous avons besoin. <br><br>  Ensuite, le signal de la sortie de déclenchement va au registre de sortie du canal 4, qui à son tour alimente la LED. <br><br>  Les deux graphiques peuvent être téléchargés depuis <a href="https://github.com/bosonbeard/Funny-models-and-scripts/tree/master/5.Canny" rel="nofollow">GitHub</a> . <br><a name="IV"></a><br><h2>  Partie IV: Conclusion </h2><br><img src="https://habrastorage.org/webt/sl/jf/80/sljf80-deg-ha1k35vza91rlu5q.png"><br><br><img src="https://habrastorage.org/webt/tn/om/n7/tnomn7q4-cw7pqe0jpvgtm4nee4.png"><br><br><img src="https://habrastorage.org/webt/sa/yc/xz/saycxzcopf5rbpbzdcz6dbue0xs.png"><br><br>  Les photos ci-dessous montrent que tout fonctionne (et mon doigt est toujours visible). <br>  <i>Au début de l'article, j'ai mentionné le garrot, mais j'étais trop paresseux pour le dénuder et l'étain, donc pour l'instant j'ai utilisé des fils séparés que j'ai encore des expériences avec Craftduino.</i> <br><br>  «Et qu'en est-il des plates-formes croisées?» - demandez-vous.  J'ai essayé d'écrire du code sur le contrôleur en exécutant l'environnement de développement sur Linux via Wine.  En conséquence, l'environnement de développement a commencé, mais le contrôleur lui-même ne voit pas l'ordinateur (peut-être devez-vous le «conjurer» avec Wine).  Il n'est donc pas encore possible de parler de solutions multiplateformes prêtes à l'emploi. <br><br>  Un autre inconvénient du contrôleur est le coût élevé par rapport à certains faux «chinois» pour Arduino, mais cela est partiellement compensé par la qualité.  Le contrôleur est agréable à tenir entre vos mains, et tout a été emballé très soigneusement dans une boîte.  Le contrôleur est même tombé une fois, mais jusqu'à présent, tout fonctionne. <br><br>  Certes, dans les évaluations du contrôleur, je suis probablement un peu subjectif.  C'est juste que je suis heureux que le produit soit domestique et que les développeurs, quoique un peu, soient impliqués dans les victoires de KAMAZ au rallye Dakar. <br><br>  En général, j'étais satisfait du cadeau, le style visuel de programmation est très inhabituel pour moi, mais en même temps il a ses avantages.  Je pense que les gens qui ont étudié la technologie électronique et l'informatique même à partir des manuels soviétiques et qui savaient quels registres, déclencheurs, multiplexeurs, etc. le souhaiteraient le plus. <br><br>  <i>UPD: Amis, j'étais un peu en retard et j'ai légèrement violé les règles Habr, j'ai donc supprimé les liens directs vers le site Web des développeurs du contrôleur afin que l'article ne soit pas publicitaire et conforme aux règles.</i>  <i>Je pense que vous pouvez facilement trouver le lien pour télécharger l'environnement de développement CannyLab et les «preuves» de KAMAZ vous-même.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482948/">https://habr.com/ru/post/fr482948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482938/index.html">Application des principes de programmation fonctionnelle dans la conception d'ERP</a></li>
<li><a href="../fr482940/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 396 (30 décembre 2019 - 5 janvier 2020)</a></li>
<li><a href="../fr482942/index.html">Mythes et légendes de l'ancien Fediverse</a></li>
<li><a href="../fr482944/index.html">Distributeur de convoyeur multi-composants</a></li>
<li><a href="../fr482946/index.html">1С DSS et estimation des conditions et coût des projets par la méthode COCOMO II</a></li>
<li><a href="../fr482950/index.html">Java: des choses qui peuvent sembler curieuses à un développeur expérimenté</a></li>
<li><a href="../fr482956/index.html">Examen de WCS 5.2 - Serveur WebRTC pour développeurs Webcast et Webcam</a></li>
<li><a href="../fr482958/index.html">"Règles de croissance: du junior au CTO", résumé d'un webinaire de Fedor Borshchev</a></li>
<li><a href="../fr482960/index.html">Présentation de WCS 5.2 - Serveur WebRTC pour les développeurs Web de diffusions en ligne et de chat vidéo</a></li>
<li><a href="../fr482968/index.html">Quarkus - Un nouveau regard sur Java Native Cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>