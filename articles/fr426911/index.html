<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîñ üïñ üìô GreyEnergy: le successeur de BlackEnergy attaque les entreprises du secteur de l'√©nergie üëÜüèø ü§≥üèº üé∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les sp√©cialistes d'ESET ont effectu√© une analyse de logiciels malveillants sophistiqu√©s qui n'avaient pas √©t√© √©tudi√©s auparavant, con√ßus pour des atta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GreyEnergy: le successeur de BlackEnergy attaque les entreprises du secteur de l'√©nergie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/426911/">  Les sp√©cialistes d'ESET ont effectu√© une analyse de logiciels malveillants sophistiqu√©s qui n'avaient pas √©t√© √©tudi√©s auparavant, con√ßus pour des attaques cibl√©es contre des entreprises d'infrastructures critiques en Europe centrale et orientale.  Le programme, appel√© GreyEnergy, a une ressemblance conceptuelle avec BlackEnergy, un malware qui a √©t√© utilis√© dans les attaques contre les soci√©t√©s √©nerg√©tiques ukrainiennes en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©cembre 2015</a> .  De plus, des liens indiquent que les op√©rateurs GreyEnergy ont travaill√© avec le groupe TeleBots derri√®re un certain nombre d'attaques destructrices. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dv/d5/8-/dvd58-ginvoshns9sbcaupqnvzy.jpeg"></div><br>  Le rapport fournit des informations sur les activit√©s du groupe GreyEnergy au cours des derni√®res ann√©es.  Notez que nous n'attribuons d'attaques et de d√©veloppement de logiciels malveillants √† aucun √©tat.  Selon notre terminologie, ¬´ART-group¬ª est un ensemble d'indicateurs techniques. <br><a name="habracut"></a><br><h2>  Pr√©sentation </h2><br>  En d√©cembre 2015, le groupe BlackEnergy a attaqu√© le complexe √©nerg√©tique ukrainien √† l'aide de logiciels malveillants des familles BlackEnergy et KillDisk.  Il s'agit du dernier incident connu avec le logiciel BlackEnergy en conditions r√©elles.  Apr√®s cette attaque, le groupe s'est transform√© en au moins deux sous-groupes: TeleBots et GreyEnergy. <br><br>  TeleBots est sp√©cialis√© dans le cyber-sabotage par le biais d'attaques informatiques en r√©seau (CNA).  Le groupe a d√©nombr√© des attaques destructrices, notamment: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une s√©rie d'attaques</a> utilisant la version mise √† jour de KillDisk pour Windows et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Linux</a> en d√©cembre 2016; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'√©pid√©mie de NotPetya</a> en juin 2017, mise en ≈ìuvre √† l'aide d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">porte d√©rob√©e</a> complexe mise en ≈ìuvre √† l'aide du logiciel de comptabilit√© MEDoc; </li><li>  attaque √† l'aide de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">encodeur BadRabbit</a> en octobre 2017. </li></ul><br>  Les experts ESET suivent l'activit√© du groupe GreyEnergy depuis plusieurs ann√©es.  Le groupe utilise la famille unique de logiciels malveillants du m√™me nom.  L'architecture Malvari ressemble √† la famille BlackEnergy. <br><br>  Outre les similitudes conceptuelles des programmes, il existe d'autres liens indiquant que les op√©rateurs GreyEnergy travaillent en √©troite collaboration avec le groupe TeleBots.  En particulier, en d√©cembre 2016, le groupe GreyEnergy a lanc√© un ver ressemblant √† NotPetya, et une version plus avanc√©e de ce programme est apparue en juin 2017 lors d'une attaque TeleBots. <br><br>  Il convient de noter que GreyEnergy et TeleBots ont des objectifs diff√©rents - GreyEnergy s'int√©resse principalement aux r√©seaux industriels appartenant √† des entreprises d'infrastructures critiques et, contrairement aux TeleBots, ne se limite pas aux objets en Ukraine. <br><br>  Fin 2015, nous avons remarqu√© pour la premi√®re fois un malware GreyEnergy destin√© √† une soci√©t√© d'√©nergie en Pologne.  Cependant, GreyEnergy attaque √©galement des cibles ukrainiennes.  Le groupe se concentre sur le secteur de l'√©nergie, les infrastructures de transport et d'autres installations de haut rang.  Au moins une organisation cible BlackEnergy a √©t√© attaqu√©e par GreyEnergy.  La derni√®re utilisation de GreyEnergy a √©t√© enregistr√©e mi-2018. <br><br>  Le programme malveillant GreyEnergy a une architecture modulaire; cependant, contrairement √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Industroyer</a> , nous n'avons vu aucun module qui pourrait affecter les syst√®mes de contr√¥le industriels (ICS).  Cependant, les op√©rateurs GreyEnergy ont d√©ploy√© une vip√®re sur le disque au moins une fois pour perturber les flux de travail et masquer les traces d'une cyberattaque. <br><br>  L'un des d√©tails les plus int√©ressants trouv√©s lors de nos recherches est que l'un des √©chantillons GreyEnergy a √©t√© sign√© avec un certificat num√©rique valide.  Tr√®s probablement, ce certificat a √©t√© vol√© √† un fabricant ta√Øwanais d'√©quipements ICS.  √Ä cet √©gard, le groupe GreyEnergy a suivi les traces des auteurs de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Stuxnet</a> . <br><br><h2>  GreyEnergy: m√©thode de travail </h2><br>  Lors des observations de l'activit√© du groupe GreyEnergy, nous avons principalement vu deux premiers vecteurs d'infection.  Le premier concerne les organisations disposant de services Web situ√©s sur les propres serveurs des victimes.  Si le service Web public s'ex√©cute sur un serveur connect√© au r√©seau interne, les attaquants tenteront de le compromettre pour p√©n√©trer le r√©seau.  Le deuxi√®me vecteur est le phishing cibl√© avec des pi√®ces jointes malveillantes. <br><br>  Les documents malveillants d√©chargent GreyEnergy mini - une porte d√©rob√©e l√©g√®re de la premi√®re √©tape qui ne n√©cessite pas de privil√®ges administratifs.  Une fois qu'un ordinateur est compromis √† l'aide de GreyEnergy mini, les attaquants cr√©ent une carte r√©seau et collectent des mots de passe pour obtenir les droits d'administrateur de domaine.  Avec ces privil√®ges, les attaquants peuvent contr√¥ler l'ensemble du r√©seau.  Le groupe GreyEnergy utilise des outils assez standard pour accomplir ces t√¢ches: Nmap et Mimikatz. <br><br>  Apr√®s une premi√®re exploration du r√©seau, les attaquants peuvent d√©ployer une porte d√©rob√©e phare - la principale GreyEnergy.  Les logiciels malveillants n√©cessitent des droits d'administrateur, qui doivent √™tre obtenus avant la phase de d√©ploiement de GreyEnergy principal.  Selon nos recherches, les op√©rateurs GreyEnergy installent la porte d√©rob√©e principale principalement sur deux types de points de terminaison: les serveurs √† longue disponibilit√© et les postes de travail utilis√©s pour g√©rer les environnements ICS. <br><br>  Pour masquer les communications avec les serveurs C&amp;C, les attaquants peuvent installer des logiciels suppl√©mentaires sur les serveurs internes d'un r√©seau compromis afin que chaque serveur fasse office de proxy.  Un tel proxy C &amp; C redirige les demandes des n≈ìuds infect√©s du r√©seau vers un serveur C &amp; C externe sur Internet.  La ¬´communication¬ª de plusieurs ordinateurs du r√©seau avec un serveur interne ne semble pas aussi suspecte qu'avec un serveur externe.  La m√©thode peut √©galement √™tre utilis√©e pour g√©rer les logiciels malveillants dans diff√©rents segments d'un r√©seau compromis.  Une m√©thode similaire utilisant des serveurs internes comme proxy-C &amp; C a √©t√© observ√©e dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">campagne Duqu 2.0 ART</a> . <br><br>  Si l'organisation compromise dispose de serveurs Web publics connect√©s au r√©seau interne, les attaquants peuvent d√©ployer des backdoors de ¬´sauvegarde¬ª sur ces serveurs.  Ils sont utilis√©s pour restaurer l'acc√®s au r√©seau en cas de d√©couverte et de suppression des portes d√©rob√©es principales. <br><br>  Tous les serveurs C&amp;C li√©s aux programmes malveillants GreyEnergy utilisent Tor. <br><br><img src="https://habrastorage.org/webt/xx/oq/go/xxoqgo-8cdke9obd1fcazkwa3cq.png"><br>  <i>Figure 1. Diagramme simplifi√© de deux sc√©narios de compromis de r√©seau utilis√©s par le groupe GreyEnergy</i> <br><br><h2>  Greyenergy mini </h2><br>  GreyEnergy mini est une porte d√©rob√©e l√©g√®re de la premi√®re √©tape, qui a √©t√© utilis√©e par les attaquants pour √©valuer un ordinateur compromis et fournir une t√™te de pont initiale sur le r√©seau.  En r√®gle g√©n√©rale, GreyEnergy mini a √©t√© t√©l√©charg√© √† l'aide d'un document malveillant distribu√© dans des e-mails de phishing.  GreyEnergy mini est √©galement connu sous le nom de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FELIXROOT</a> . <br><br>  En septembre 2017, ESET a d√©couvert un document Microsoft Word ukrainien contenant une macro malveillante.  Le document d'app√¢t imite un formulaire interactif pour encourager la victime √† activer la macro et √† la remplir. <br><br><img src="https://habrastorage.org/webt/fw/vr/33/fwvr33hhjxbw8fufl_c6qpeluoo.png"><br>  <i>Figure 2. Document d'app√¢t utilis√© par GreyEnergy en septembre 2017</i> <br><br>  Apr√®s avoir activ√© la macro, son code essaie de t√©l√©charger et d'ex√©cuter le fichier binaire √† partir du serveur distant. <br><br><img src="https://habrastorage.org/webt/lu/xi/c8/luxic8ibbi5mgwhz7rhefr978ak.png"><br>  <i>Figure 3. Macro VBA malveillante (commentaires ajout√©s par ESET)</i> <br><br>  Fait int√©ressant, un lien menant √† une image externe est int√©gr√© dans le corps du document.  Apr√®s avoir ouvert le document, il essaie de t√©l√©charger cette image - de cette fa√ßon, les attaquants apprennent que le fichier est ouvert.  La m√©thode vous permet de suivre les cibles qui comprenaient une macro malveillante et celle qui venait d'ouvrir un document. <br><br><img src="https://habrastorage.org/webt/0j/td/ot/0jtdotwwqqa9vzly3-cd92brvsa.png"><br>  <i>Figure 4. Lien vers un dessin ¬´tracker¬ª externe dans un document malveillant</i> <br><br>  L'ex√©cutable t√©l√©charg√© est un mini compte-gouttes GreyEnergy.  Le compte-gouttes √©crit la DLL malveillante dans le dossier <code>%APPDATA%</code> , en utilisant un GUID g√©n√©r√© al√©atoirement comme nom.  En outre, le compte-gouttes cr√©e un fichier <code>.LNK</code> avec un nom de fichier vide dans le dossier de <code></code> dans le menu D√©marrer avec une entr√©e qui ex√©cute <code>rundll32.exe</code> avec le chemin d'acc√®s √† la DLL comme argument de la ligne de commande.  Il s'agit de la mini m√©thode de persistance GreyEnergy. <br><br>  La DLL vid√©e est le module principal de GreyEnergy mini;  il est d√©guis√© en un fichier l√©gitime li√© √† Microsoft Windows. <br><br><img src="https://habrastorage.org/webt/ly/yu/lg/lyyulg-m5vxpbdbsgqvyssghhww.png"><br>  <i>Figure 5. Mini DLL de porte d√©rob√©e GreyEnergy se faisant passer pour une DLL Windows l√©gitime</i> <br><br>  Pour √©valuer un ordinateur compromis, un logiciel malveillant collecte autant d'informations que possible et envoie des donn√©es √† C&amp;C.  Les donn√©es sont collect√©es √† l'aide du langage de requ√™te WMI (WQL) et des requ√™tes du registre Windows.  Les donn√©es suivantes sont collect√©es: <br><br><ul><li>  nom d'ordinateur </li><li>  version du syst√®me d'exploitation, y compris la version du Service Pack </li><li>  langue par d√©faut </li><li>  nom d'utilisateur </li><li>  privil√®ges utilisateur Windows actuels, √©l√©vation, niveau UAC </li><li>  param√®tres proxy </li><li>  informations informatiques (fabricant, mod√®le, type de syst√®me) </li><li>  fuseau horaire </li><li>  logiciel de s√©curit√© install√© (antivirus et pare-feu) </li><li>  liste d'utilisateurs et de domaines </li><li>  liste des programmes install√©s obtenus √† partir du registre </li><li>  informations r√©seau (adresses IP, serveur DHCP, etc.) </li><li>  liste des processus en cours </li></ul><br>  Un logiciel malveillant re√ßoit des commandes du serveur C&amp;C.  La prise en charge des commandes suivantes est fournie (ci-dessous sont les ID de commande et leur signification): <br><br><ol><li>  collecter des informations informatiques </li><li>  t√©l√©chargez et ex√©cutez l'ex√©cutable √† partir du dossier des fichiers temporaires </li><li>  ex√©cuter la commande shell </li><li>  se retirer d'un ordinateur compromis </li><li>  t√©l√©chargez et ex√©cutez le fichier .BAT √† partir du dossier des fichiers temporaires </li><li>  t√©l√©charger le fichier sur le disque local </li><li>  t√©l√©charger un fichier </li></ol><br>  La configuration du logiciel malveillant au format JSON est int√©gr√©e dans le fichier binaire et crypt√©e √† l'aide d'un algorithme personnalis√©.  Les donn√©es chiffr√©es contiennent quatre octets au d√©but;  ces octets sont utilis√©s comme cl√© pour l'op√©ration XOR pour d√©crypter le reste des donn√©es.  La plupart des cha√Ænes utilis√©es par le malware sont crypt√©es √† l'aide de cet algorithme. <br><br><img src="https://habrastorage.org/webt/ra/1e/7q/ra1e7q7lgjkezdzs1cvknhtjytc.png"><br>  <i>Figure 6. Mini configuration GreyEnergy int√©gr√©e avant et apr√®s le d√©chiffrement</i> <br><br>  Toutes les mini-configurations GreyEnergy que nous avons vues incluent des serveurs HTTPS et HTTP utilis√©s comme C&amp;C.  Cela permet aux attaquants de passer √† HTTP sur des cibles o√π la connexion HTTPS n'est pas prise en charge par la configuration du r√©seau ou du pare-feu. <br><br>  GreyEnergy mini pr√©sente des similitudes de code avec d'autres programmes malveillants de la famille GreyEnergy.  De plus, GreyEnergy mini et la porte d√©rob√©e GreyEnergy principale utilisent les m√™mes serveurs C&amp;C. <br><br><h2>  Porte arri√®re principale GreyEnergy </h2><br>  GreyEnergy est la principale porte d√©rob√©e de ce cyber-groupe.  Les exemples de logiciels malveillants analys√©s ici sont √©crits en C et compil√©s √† l'aide de Visual Studio, mais sans utiliser les fonctions standard de la biblioth√®que d'ex√©cution C (CRT).  Les √©chantillons emball√©s peuvent contenir un faux horodatage PE, mais apr√®s le d√©ballage, l'horodatage est r√©initialis√© (1er janvier 1970). <br><br><img src="https://habrastorage.org/webt/4g/30/bx/4g30bxseryscxui0m-0z3hrdrzo.png"><br>  <i>Figure 7. Horodatage PE de l'√©chantillon GreyEnergy non emball√©</i> <br><br>  Fait int√©ressant, l'un des premiers √©chantillons GreyEnergy analys√©s a √©t√© sign√© avec un certificat appartenant √† Advantech.  Il s'agit d'une entreprise ta√Øwanaise fabriquant des √©quipements pour l'industrie et l'IoT.  √âtant donn√© que nous avons constat√© que le m√™me certificat avait √©t√© utilis√© pour signer le logiciel propre et non malveillant d'Advantech, nous pensons qu'il a √©t√© vol√©.  Notez que l'√©chantillon d√©tect√© n'a pas de signature num√©rique - cela signifie que la signature est devenue invalide lorsque le certificat a expir√©. <br><br><img src="https://habrastorage.org/webt/y4/qe/i8/y4qei8gt9buk4eftsr5_5bukgiy.png"><br>  <i>Figure 8. Certificat Advantech utilis√© pour signer l'exemple de malware GreyEnergy</i> <br><br>  Les donn√©es du certificat sont les suivantes: <br><br> <code>Serial Number: 15:f4:8f:98:c5:79:41:00:6f:4c:9a:63:9b:f3:c1:cc <br> Validity: <br> Not Before: Feb 10 00:00:00 2014 GMT <br> Not After : Feb 26 23:59:59 2017 GMT <br> SHA1 Fingerprint=97:53:AD:54:DF:6B:D6:73:E0:6C:00:36:3D:34:6A:06:00:7A:0A:9B</code> <br> <br>  Nous avons remarqu√© que GreyEnergy est g√©n√©ralement d√©ploy√© en deux modes: uniquement en m√©moire et avec la persistance du service DLL.  Le premier mode est utilis√© lorsque les attaquants sont s√ªrs que l'installation ne n√©cessite pas de mesures sp√©ciales pour assurer la stabilit√© (par exemple, sur des serveurs avec une longue disponibilit√©);  le deuxi√®me mode est lorsque le malware doit r√©sister √† tout red√©marrage. <br><br><h4>  Mode m√©moire seule </h4><br>  Pour ce mode, les attaquants placent le fichier DLL dans un dossier sp√©cifique, puis l'ex√©cutent √† l'aide de l'application Windows <code>rundll32.exe</code> .  Nous avons observ√© que les attaquants utilisent l'outil Windows Sysinternals PsExec localement pour ex√©cuter <code>rundll32.exe</code> avec les privil√®ges les plus √©lev√©s possibles ( <code>NT AUTHORITY\SYSTEM</code> ). <br><br>  Ci-dessous, la ligne de commande utilis√©e dans la phase d'ex√©cution initiale de GreyEnergy uniquement en m√©moire: <br><br> <code>cmd.exe /c "C:\Windows\System32\rundll32.exe "C:\Sun\Thumbs.db",#1 CAIAABBmAAAgAAAA8GFGvkHVGDtGRqcl3Z3nYJ9aXCm7TVZX8klEdjacOSU="</code> <br> <br>  Dans cet exemple, <code>Thumbs.db</code> est un fichier DLL GreyEnergy √† partir duquel la fonction avec le premier num√©ro de s√©quence est appel√©e par le processus <code>rundll32.exe</code> .  L'exemple de ligne de commande donn√© contient une s√©quence d'octets chiffr√©s avec base64, qui est ensuite utilis√©e comme cl√© AES-256 pour d√©chiffrer un petit talon.  Apr√®s cela, le code dans le ¬´stub¬ª d√©marre une nouvelle copie du processus <code>svchost.exe</code> et injecte la charge utile GreyEnergy.  √Ä la derni√®re √©tape, le processus <code>rundll32.exe</code> GreyEnergy se termine, le fichier DLL malveillant est prot√©g√© contre la suppression du disque.  Par cons√©quent, la charge utile GreyEnergy n'existera que dans le contexte de la m√©moire de processus <code>svchost.exe</code> . <br><br>  Tr√®s probablement, les auteurs avaient l'intention de d√©velopper des logiciels malveillants de telle mani√®re que sans cl√© sur la ligne de commande, il √©tait impossible de d√©crypter le ¬´talon¬ª et la charge utile. <br><br><img src="https://habrastorage.org/webt/rb/l5/vt/rbl5vtt2xe-e3ud4p9wxpuhsgz8.png"><br>  <i>Figure 9. Nom interne de la DLL GreyEnergy pour le mode m√©moire uniquement</i> <br><br>  Si vous utilisez le mode "uniquement en m√©moire", il <code>svchost.exe</code> terminer le processus <code>svchost.exe</code> correspondant ou de red√©marrer l'ordinateur pour supprimer GreyEnergy. <br><br><h4>  Persistance du service DLL </h4><br>  Pour utiliser cette m√©thode, les op√©rateurs d√©ploient le compte-gouttes GreyEnergy, qui doit √™tre ex√©cut√© avec des privil√®ges d'administrateur. <br><br>  La cl√© de registre <code>ServiceDLL</code> vous permet de d√©marrer le module DLL de service dans le contexte du processus <code>svchost.exe</code> .  Fonction non document√©e par Microsoft;  cependant, il est utilis√© par un certain nombre de familles de logiciels malveillants, notamment le ver Conficker. <br><br>  Pour garantir la persistance du service DLL, le compte-gouttes recherche un service existant et ajoute une nouvelle cl√© de registre <code>ServiceDLL</code> .  √âtant donn√© que la m√©thode peut entra√Æner une d√©faillance du syst√®me, le compte-gouttes effectue initialement une s√©rie de v√©rifications pour s√©lectionner un service qui r√©pond √† un certain nombre d'exigences. <br><br>  Tout d'abord, le dropper trouve tous les services Windows actuellement arr√™t√©s en ex√©cutant la requ√™te WQL suivante: <br><br> <code>Select * from Win32_Service where PathName Like '%%svchost%%' and State = 'Stopped'</code> <br> <br>  Les conditions suivantes peuvent √™tre ajout√©es √† la demande: <br><br><ul><li>  <code>and StartMode = 'Disabled'</code> ou <code>and StartMode = 'Manual'</code> </li><li>  <code>and ServiceType = 'Own Process'</code> ou <code>and ServiceType = 'Share Process'</code> </li></ul><br>  Ensuite, le dropper essaie de s√©lectionner le service souhait√©, en v√©rifiant les r√©sultats et en ignorant ceux qui remplissent les conditions suivantes: <br><br><ul><li>  le nom du service contient <code>winmgmt</code> (Windows Management Instrumentation) ou <code>BITS</code> (Background Intelligent Transfer Service) </li><li>  dropper n'a pas acc√®s au service ou √† la cl√© de registre </li><li>  <code>DependOnService</code> registre <code>DependOnService</code> pas vide </li><li>  la valeur de Registre pour <code>ServiceDll</code> ou <code>ImagePath</code> n'existe pas </li><li>  La ligne de commande de service contient l'un des mots suivants: </li><li>  <code>DcomLaunch</code> , <code>LocalServiceNetworkRestricted</code> , <code>LocalServiceNoNetwork</code> , <code>LocalServicePeerNet</code> , <code>LocalSystemNetworkRestricted</code> , <code>NetworkServiceNetworkRestricted</code> , <code>secsvcs</code> , <code>wcssvc</code> </li></ul><br>  Lors de la d√©tection d'un service qui remplit ces conditions, le programme malveillant d√©charge le fichier DLL dans le r√©pertoire Windows <code>system32</code> et √©crit la cl√© de registre <code>ServiceDLL</code> .  Le nom de la DLL contient quatre caract√®res g√©n√©r√©s de mani√®re al√©atoire et <code>svc.dll</code> ou <code>srv.dll</code> √† la fin.  De plus, le compte-gouttes simule les m√©tadonn√©es temporelles du fichier en le copiant √† partir du fichier <code>user32.dll</code> existant. <br><br>  La derni√®re version du compte-gouttes GreyEnergy prend en charge les syst√®mes d'exploitation 32 bits et 64 bits. <br><br><img src="https://habrastorage.org/webt/ih/kq/uu/ihkquuwr7ha_ggshsdfwgngg3sw.png"><br>  <i>Figure 10. DLL GreyEnergy DLL d√©ploy√©e via la m√©thode de persistance du service DLL</i> <br><br>  Dropper utilise une m√©thode int√©ressante pour d√©guiser une DLL malveillante en fichier l√©gitime.  En particulier, le dropper copie la ressource VERSIONINFO, qui contient une description d√©taill√©e du fichier ex√©cutable appartenant au service Windows en question, et √©crit ces donn√©es dans une DLL malveillante.  √Ä cette fin, les fonctions API Windows <code>BeginUpdateResource</code> / <code>UpdateResource</code> / <code>EndUpdateResource</code> .  Les versions r√©centes n'appellent pas ces fonctions √† partir de l'API;  leur code est impl√©ment√© dans le programme malveillant lui-m√™me pour √©viter de vider le fichier DLL sur le disque sans une fausse ressource VERSIONINFO.  Vraisemblablement, cela √©vite la d√©tection de certains produits de s√©curit√©.  Le m√™me compte-gouttes peut cr√©er des fichiers DLL malveillants avec des descriptions diff√©rentes sur diff√©rents ordinateurs.  Chaque mod√®le d√©velopp√© de cette mani√®re aura un hachage unique. <br><br>  Si le malware est d√©j√† pr√©sent sur le syst√®me, le compte-gouttes peut le mettre √† jour √† l'aide du canal nomm√©. <br><br>  √Ä la derni√®re √©tape, le dropper se supprime automatiquement en rempla√ßant le fichier par des z√©ros et en le supprimant du disque.  Dropper efface √©galement le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">magazine USN</a> .  Les actions sont effectu√©es via les commandes shell suivantes: <br><br> <code>timeout 2 &gt; nul &amp; fsutil file setzerodata offset=0 length=%DROPPER_FILESIZE% "%DROPPER_PATH%" &amp; timeout 2 &amp; cmd /c del /F /Q "%DROPPER_PATH%" &amp; fsutil usn deletejournal /D %DROPPER_DRIVE%</code> <br> <br><h4>  Configuration et communications </h4><br>  Le mode de persistance s√©lectionn√© par les op√©rateurs n'affecte pas la fonctionnalit√© du programme malveillant, qui reste inchang√© avec les deux m√©thodes. <br><br>  Un logiciel malveillant contient une configuration int√©gr√©e qui est chiffr√©e √† l'aide de l'algorithme AES-256 et compress√©e √† l'aide de LZNT1. <br><br>  Le format MIME √† plusieurs composants est utilis√© pour la configuration de logiciels malveillants int√©gr√©s.  Les auteurs n'ont pas impl√©ment√© leur propre analyseur pour ce format;  √† la place, ils utilisent les interfaces COM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IMimeMessage</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IMimeBody</a> .  Fait int√©ressant, la documentation de Microsoft recommande de ne pas utiliser ces interfaces. <br><br><img src="https://habrastorage.org/webt/wr/uw/mb/wruwmbzmf4phjtbinjintm9ryfw.png"><br>  <i>Figure 11. Exemple de configuration int√©gr√©e de GreyEnergy</i> <br><br>  Pour la configuration externe, le format MIME identique est utilis√©;  cependant, le malware crypte la configuration externe de diff√©rentes mani√®res.  Il utilise l'interface de programmation d'application de protection des donn√©es (DPAPI), en particulier les fonctions API Windows <code>CryptProtectData</code> et <code>CryptUnprotectData</code> .  La configuration externe est enregistr√©e dans le chemin d'acc√®s suivant <code>C:\ProgramData\Microsoft\Windows\%GUID%</code> , o√π <code>%GUID%</code> est une valeur GUID g√©n√©r√©e de mani√®re al√©atoire en fonction du num√©ro de s√©rie du volume du lecteur C :. <br><br>  Certains exemples GreyEnergy contiennent une version obscurcie de la configuration.  En particulier, les champs <code>Type</code> de ces configurations contiennent des lettres au lieu des noms d'options. <br><br><img src="https://habrastorage.org/webt/wj/dl/7-/wjdl7-_lpzwki1oifgi_awjctxy.png"><br>  <i>Figure 12. Exemple d'une configuration GreyEnergy obscurcie</i> <br><br>  La configuration peut contenir les valeurs suivantes: <br><br><img src="https://habrastorage.org/webt/yo/_s/8e/yo_s8eqfgp-xgxf3mooreev9tmo.png"><br><br>  Un programme malveillant se supprime du syst√®me infect√© si le nombre de tentatives infructueuses d√©passe la valeur de <code>MaxAttempts</code> et que la derni√®re connexion r√©ussie <code>MaxAttempts</code> plus de <code>Lifetime</code> jours. <br><br>  La communication avec C&amp;C se fait g√©n√©ralement via HTTPS;  cependant, dans certains cas, HTTP est √©galement utilis√©.  Le m√™me format MIME est encapsul√© dans les requ√™tes HTTP.  Il convient de noter que les donn√©es sont crypt√©es √† l'aide d'AES-256 et RSA-2048. <br><br><img src="https://habrastorage.org/webt/b1/g8/6d/b1g86dydvt2stlutlwkgy79ydem.png"><br>  <i>Figure 13. Communication GreyEnergy sur HTTP captur√©e dans Wireshark</i> <br><br>  Si vous utilisez HTTP, il est plus facile d'identifier une machine compromise sur le r√©seau en analysant son trafic r√©seau.  Les √©chantillons de logiciels malveillants qui ont √©t√© √©tudi√©s ont toujours utilis√© les agents utilisateurs cod√©s en dur suivants: <br><br><ul><li> <code>Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko</code> </li> <li> <code>Mozilla/5.0 (compatible, MSIE 11, Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko</code> </li> </ul><br>  Pour aider les op√©rateurs GreyEnergy √† identifier les ordinateurs infect√©s, le malware envoie les r√©sultats des requ√™tes WQL suivantes au serveur C&amp;C: <br><br><ul><li> <code>SELECT Caption, Version, CSName, ProductType, CurrentTimeZone, LocalDateTime, OSLanguage, OSType FROM Win32_OperatingSystem</code> </li> <li> <code>SELECT MACAddress, IPAddress, IPSubnet, DHCPEnabled, DHCPServer, DNSDomain FROM Win32_NetworkAdapterConfiguration WHERE MACAddress IS NOT NULL</code> </li> </ul><br>  Les r√©ponses du serveur C&amp;C sont crypt√©es, mais apr√®s d√©cryptage, elles contiennent le m√™me format MIME avec les valeurs possibles suivantes: <br><img src="https://habrastorage.org/webt/go/am/pd/goampdwrvmb0ospdus377v4jvj8.png"><br><br>  GreyEnergy charge des modules suppl√©mentaires et une charge utile en m√©moire √† l'aide de son propre chargeur de fichiers PE. <br><br><h4>  Modules GreyEnergy </h4><br>  Comme de nombreuses menaces complexes, le malware GreyEnergy a une architecture modulaire.  Sa fonctionnalit√© peut √™tre √©tendue en ajoutant des modules suppl√©mentaires.  Le module GreyEnergy est un fichier DLL qui est ex√©cut√© en appelant une fonction avec le premier num√©ro de s√©quence.  Chaque module, y compris le module GreyEnergy principal, accepte des commandes de texte avec divers param√®tres. <br><br>  Les op√©rateurs GreyEnergy n'envoient pas imm√©diatement tous les modules √† une machine compromise.  En r√®gle g√©n√©rale, un programme malveillant t√©l√©charge et ex√©cute les modules n√©cessaires pour effectuer des t√¢ches sp√©cifiques. <br><br>  Nous sommes conscients de l'existence des modules GreyEnergy suivants: <br><br>  <code>remoteprocessexec</code> - injecte un fichier RE binaire dans un processus distant <br>  <code>info</code> - collecte des informations syst√®me, des journaux d'√©v√©nements, des logiciels malveillants SHA-256 <br>  <code>file</code> - op√©rations sur le syst√®me de fichiers <br>  <code>sshot</code> - prend des captures d'√©cran <br>  <code>keylogger</code> - intercepte les frappes <br>  <code>passwords</code> - collecte les mots de passe stock√©s dans diverses applications <br>  <code>mimikatz</code> - Outil <code>mimikatz</code> utilis√© pour collecter les informations d'identification Windows <br>  <code>plink</code> - Logiciel <code>plink</code> utilis√© pour cr√©er des tunnels SSH <br>  <code>3proxy</code> - Logiciel <code>3proxy</code> utilis√© pour cr√©er des proxys <br><br>  Le module <code>remoteprocessexec</code> permet √† un attaquant d'ex√©cuter des fichiers binaires arbitraires dans le contexte de processus existants.  Par exemple, vous pouvez ex√©cuter Mimikatz ou un scanner de port dans le contexte de l'Explorateur Windows sans les d√©poser sur le disque.  Pour rediriger la sortie standard et les threads de processus et l'arr√™t du processus, le module intercepte cinq fonctions de l'API Windows. <br><br><img src="https://habrastorage.org/webt/vn/c9/2a/vnc92aap-hqdl_ps_0r-tzj4ngc.png"><br>  <i>Figure 14. Fonctions API Windows captur√©es par remoteprocessexec</i> <br><br>  √âtant donn√© que la DLL GreyEnergy r√©initialis√©e est unique pour chaque machine infect√©e, les attaquants peuvent collecter des hachages SHA-256 √† l'aide du module d'information.  La pr√©sence de hachages vous permettra de suivre si le fichier a √©t√© t√©l√©charg√© sur des services Web publics tels que VirusTotal. <br><br><h4>  Protection inverse et m√©thodes anti-criminelles </h4><br>  GreyEnergy utilise plusieurs m√©thodes pour compliquer l'analyse.  Par exemple, un programme malveillant crypte les cha√Ænes.  Certaines options utilisent le m√™me algorithme que GreyEnergy mini. <br><br>  Cependant, la plupart des exemples GreyEnergy ont un algorithme de cryptage diff√©rent.  En particulier, les quatre premiers octets d'un objet blob chiffr√© ne sont pas utilis√©s comme cl√© pour les op√©rations XOR.  Au lieu de cela, ils sont utilis√©s pour initialiser le nombre initial de l'algorithme de g√©n√©ration de nombres pseudo-al√©atoires ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mersenne Whirlwind</a> ), puis les quatre octets g√©n√©r√©s sont la cl√©.  Avant de lib√©rer un tampon de m√©moire contenant une cha√Æne de texte brut, le logiciel malveillant √©crase le tampon avec des z√©ros. <br><br><img src="https://habrastorage.org/webt/on/px/a6/onpxa6j99a73zoqabotlcujmfyu.png"><br>  <i>Figure 15. Code d√©compil√© pour la fonction de d√©codage de cha√Æne GreyEnergy</i> <br><br>  Le programme malveillant intercepte les fonctions <code>DeleteFileA</code> et <code>DeleteFileW</code> dans la table d'importation de chaque fichier PE binaire charg√© en m√©moire.  Le crochet remplace ces fonctions par des fonctions qui effacent les fichiers en toute s√©curit√©.  En particulier, le fichier sera remplac√© par des z√©ros avant d'√™tre supprim√© du disque.  Chaque charge utile ou plugin utilisera une telle fonction sans avoir besoin de son impl√©mentation dans chaque module. <br><br><img src="https://habrastorage.org/webt/h1/ii/9y/h1ii9yhj8un7_f4zsauhxcaf4wg.png"><br>  <i>Figure 16. Code d√©compil√© pour une routine qui intercepte DeleteFileA et DeleteFileW</i> <br><br><h2>  Les outils </h2><br>  Les attaquants ont utilis√© le scanner de port Nmap comme principal outil de cartographie des r√©seaux internes de la victime.  De plus, nous avons observ√© l'utilisation d'un scanner de port personnalis√© l√©ger o√π Nmap n'√©tait pas possible. <br><br><img src="https://habrastorage.org/webt/6s/6p/wu/6s6pwugb_rufwoeytkhlkorgc_m.png"><br>  <i>Figure 17. Sortie console d'un scanner de port de groupe GreyEnergy personnalis√©</i> <br><br>  Les attaquants utilisent activement des outils l√©gitimes, tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SysInternals PsExec</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WinExe</a> , pour se d√©placer horizontalement √† l'int√©rieur de r√©seaux compromis.  L'outil WinExe, l'analogue open source de WinExe, peut √™tre contr√¥l√© √† partir d'un p√©riph√©rique Linux, par exemple, √† partir d'un serveur Web Linux compromis. <br><br>  Il convient de noter qu'en plus de ces outils, les attaquants utilisent des scripts PowerShell. <br><br><h2>  Portes d√©rob√©es du serveur Web </h2><br>  Comme mentionn√© pr√©c√©demment, le groupe GreyEnergy d√©ploie des portes d√©rob√©es suppl√©mentaires sur les serveurs Web, si ces serveurs sont accessibles depuis Internet.  Nous avons remarqu√© que les attaquants utilisent des backdoors √©crits en PHP √† cet effet.  Ils utilisent le webshell PHP web shell WSO et c99shell accessibles au public. <br><br>  Les attaquants peuvent modifier un script PHP existant sur un serveur Web ou en d√©ployer un nouveau.  Le code PHP r√©el de porte d√©rob√©e cache g√©n√©ralement plusieurs niveaux d'obscurcissement et de chiffrement. <br><br><img src="https://habrastorage.org/webt/zo/ri/hz/zorihzdc7ajclfmonz_fcia53yy.png"><br>  <i>Figure 18. Code obscurci de la porte d√©rob√©e PHP du groupe GreyEnergy</i> <br><br>  Le dernier niveau de code est prot√©g√© par cryptage de flux.  La g√©n√©ration de cl√© pour ce chiffrement est bas√©e sur une cha√Æne de la valeur de cookie fournie par les attaquants via une requ√™te HTTP.  Chacune de ces portes d√©rob√©es PHP est chiffr√©e avec une cl√© distincte. <br><br><img src="https://habrastorage.org/webt/cs/8t/yh/cs8tyhnegnb6c1rk1avs7dxfgtk.png"><br>  <i>Figure 19. Le dernier niveau que le code de porte d√©rob√©e PHP d√©code</i> <br><br>  La technique d'obscurcissement est utilis√©e pour emp√™cher l'analyse, ainsi que l'impossibilit√© d'utiliser une telle porte d√©rob√©e PHP par d'autres cyber-groupes. <br><br><h2>  Proxy C&amp;C (triuline) </h2><br>  Comme nous l'avons mentionn√© pr√©c√©demment, les attaquants peuvent utiliser le serveur interne comme proxy C&amp;C. <br><br>  Nous avons constat√© que les attaquants ont m√™me cr√©√© des cha√Ænes de proxys C&amp;C dans lesquelles le premier de ces serveurs peut rediriger le trafic r√©seau vers le suivant et ainsi de suite jusqu'√† ce qu'il atteigne la destination finale sur Internet. <br><br>    ,       C&amp;C.         GreyEnergy,     .        Windows  GreyEnergy,     C&amp;C,   3proxy  plink.     GreyEnergy       Linux   : <br><br><ul><li>  - 3proxy </li><li>  Dante SOCKS </li><li> PuTTY Link (Plink) </li></ul><br>        -,     .      ASP. <br><br>   ,   ,  -          ,     -.   ,     cookie,   ,     GreyEnergy.           URL- . <br><br><img src="https://habrastorage.org/webt/ms/tm/84/mstm84awqgzzm0rxykrmni1ocmw.png"><br> <i> 20.  ,     ,   cookie</i> <br><br> ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">triungulin</a>     - -. ,      ,   GreyEnergy. <br><br>        C&amp;C  ,     C&amp;C-. ,     C&amp;C,      ,       -. <br><br>     -: <br><br><ul><li>  - - </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Antichat Socks5 Server</a> </li></ul><br>  - -  URL-   C&amp;C  . <br><br><img src="https://habrastorage.org/webt/z1/il/bq/z1ilbqnz3shhbn__app1xhpgtem.png"><br> <i> 21.  C&amp;C-,    - -</i> <br><br>  -   OpenSSL  Curl,         C&amp;C-  . <br><br><img src="https://habrastorage.org/webt/ph/bc/20/phbc20w7dx91bjkhopbartak4cw.png"><br> <i> 22.   - -  GreyEnergy</i> <br><br>   ,        ASP-.   ,   ,  ASP  cookie,   ,     C&amp;-   AES;        . <br><br><img src="https://habrastorage.org/webt/y-/2k/tq/y-2ktq8-zcd2m9e70sobitai9se.png"><br> <i> 23.  ASP-,   GreyEnergy</i> <br><br><h2> C&amp;C-     </h2><br>  C&amp;C- GreyEnergy  Tor,   .  C&amp;C-   BlackEnergy, TeleBots  Industroyer,    Tor-. <br><br> ,  C&amp;C-  onion-,      ,    . ,    OPSEC,       . <br><br>  ESET  C&amp;C-,    GreyEnergy    .      ¬´ ¬ª. <br><br><h2>  GreyEnergy  BlackEnergy </h2><br>    GreyEnergy  BlackEnergy   ,    .   ,     ,  - . <br><img src="https://habrastorage.org/webt/mn/zc/sj/mnzcsjrof8t61sfkfi3lzs15p8k.png"><br><br><h2> Moonraker Petya </h2><br>   2016    , ,   ,   NotPetya (  Petya, ExPetr, Nyetya, EternalPetya).             ,     . <br><br>     DLL   <code>msvcrt120b.dll</code> ,    Windows.    ‚Äì <code>moonraker.dll</code> , , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> .  ,    Moonraker Petya. <br><br><img src="https://habrastorage.org/webt/21/ez/o5/21ezo5wz4iwkebpqamk88nnuv3e.png"><br> <i> 24.   ,    2016 </i> <br><br>     DLL ,       2016 , ,   . <br><br> Moonraker Petya  ,      .  ,    <code>ImagePath</code>    <code>[HKEY_LOCAL_MACHINE\System\ControlSet001\Services\ACPI]</code>  <code>[HKEY_LOCAL_MACHINE\System\ControlSet002\Services\ACPI]</code>      .    NotPetya, Moonraker Petya   ,     MBR    .   DLL Moonraker Petya     .      ,        .        zlib          .     ,       .    MBR  ,   ,    Green Petya,   . ,      Green Petya. <br><br><img src="https://habrastorage.org/webt/ok/4h/pk/ok4hpk-oion7dmngxdeo0ud8tka.png"><br> <i> 25.  ,     ,  Moonraker Petya</i> <br><br> ,    Moonraker Petya        DLL- GreyEnergy   ¬´  ¬ª. <br><br><img src="https://habrastorage.org/webt/mb/ef/mq/mbefmqjst4qziv5a8wxnrggyxky.png"><br> <i> 26.    Moonraker Petya ()  GreyEnergy ()</i> <br><br> Moonraker Petya        SysInternals PsExec.      zlib     .      Windows    <code>conhost.exe</code> . <br><br>     NotPetya:   ,    ( <code>WNetEnumResourceW</code> , <code>GetIpNetTable</code> , <code>GetExtendedTcpTable</code> , <code>NetServerEnum</code> , TERMSRV-records   <code>CredEnumerateW</code> ),         <code>WNetAddConnection2W</code>     <code>\\%TARGET-HOST%\admin$\%MALWARE%</code> .   Moonraker Petya   ,           PsExec: <br><br> <code>C:\Windows\conhost.exe \\%TARGET-HOST% -accepteula -s -d C:\Windows\System32\rundll32.exe "C:\Windows\msvcrt120b.dll", #1 %TIMEOUT% "USER1:PASSWORD1;USER2:PASSWORD2" "%DECRYPTIONKEY%"</code> <br> <br>  ,            Mimikatz     EternalBlue. <br><br>      Moonraker Petya    .        ,     ,   AES-256.          <code>README.txt</code>    . <br><br>    ,    RSA-2048.  ,       onion-,    Green Petya. ,            Green Petya. <br><br><img src="https://habrastorage.org/webt/9f/i3/qu/9fi3quz_fckxngvtzjm6eay2svy.png"><br> <i> 27.  Readme    ,  Moonraker Petya</i> <br><br>     Moonraker Petya   . <br><br><h2>  Conclusion </h2><br> GreyEnergy ‚Äì        -,        .      BlackEnergy,        .  ,      , ‚Äî    ,     .   BlackEnergy  GreyEnergy    2015  ‚Äì ,              BlackEnergy. <br><br>    ‚Äì      2016  Moonraker Petya, ,   ,     NotPetya.   ,   TeleBots  GreyEnergy          .   ,      ,    .          TeleBots   ,    GreyEnergy  BlackEnergy  . <br><br>   ,  GreyEnergy    .     GreyEnergy  TeleBots              . <br><br><h2>  Indicateurs de compromis </h2><br><h4>   ESET: </h4><br> <code>VBA/TrojanDownloader.Agent.EYV <br> Win32/Agent.SCT <br> Win32/Agent.SCM <br> Win32/Agent.SYN <br> Win64/Agent.SYN <br> Win32/Agent.WTD <br> Win32/GreyEnergy <br> Win64/GreyEnergy <br> Win32/Diskcoder.MoonrakerPetya.A <br> PHP/Agent.JS <br> PHP/Agent.JX <br> PHP/Agent.KJ <br> PHP/Agent.KK <br> PHP/Agent.KL <br> PHP/Agent.KM <br> PHP/Agent.KN <br> PHP/Agent.KO <br> PHP/Agent.KP <br> PHP/Agent.KQ <br> PHP/Agent.KR <br> PHP/Agent.KS <br> PHP/Agent.KT <br> PHP/Agent.KU <br> PHP/Agent.LC <br> PHP/Agent.NBP <br> PHP/Kryptik.AB <br> PHP/TrojanProxy.Agent.B <br> ASP/Agent.L <br> Win64/HackTool.PortScanner.A <br> Win64/Riskware.Mimikatz.A <br> Win64/Riskware.Mimikatz.AE <br> Win64/Riskware.Mimikatz.AH <br> Win32/Winexe.A <br> Win64/Winexe.A <br> Win64/Winexe.B</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Document GreyEnergy: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>177AF8F6E8D6F4952D13F88CDF1887CB7220A645</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy mini: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>455D9EB9E11AA9AF9717E0260A70611FF84EF900 <br> 51309371673ACD310F327A10476F707EB914E255 <br> CB11F36E271306354998BB8ABB6CA67C1D6A3E24 <br> CC1CE3073937552459FB8ED0ADB5D56FA00BCD43 <br> 30AF51F1F7CB9A9A46DF3ABFFB6AE3E39935D82C</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compte-gouttes GreyEnergy: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>04F75879132B0BFBA96CB7B210124BC3D396A7CE <br> 69E2487EEE4637FE62E47891154D97DFDF8AAD57 <br> 716EFE17CD1563FFAD5E5E9A3E0CAC3CAB725F92 <br> 93EF4F47AC160721768A00E1A2121B45A9933A1D <br> 94F445B65BF9A0AB134FAD2AAAD70779EAFD9288 <br> A414F0A651F750EEA18F6D6C64627C4720548581 <br> B3EF67F7881884A2E3493FE3D5F614DBBC51A79B <br> EBD5DC18C51B6FB0E9985A3A9E86FF66E22E813E <br> EC7E018BA36F07E6DADBE411E35B0B92E3AD8ABA</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DLL r√©initialisables GreyEnergy: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>0B5D24E6520B8D6547526FCBFC5768EC5AD19314 <br> 10D7687C44BECA4151BB07F78C6E605E8A552889 <br> 2A7EE7562A6A5BA7F192B3D6AED8627DFFDA4903 <br> 3CBDC146441E4858A1DE47DF0B4B795C4B0C2862 <br> 4E137F04A2C5FA64D5BF334EF78FE48CF7C7D626 <br> 62E00701F62971311EF8E57F33F6A3BA8ED28BF7 <br> 646060AC31FFDDFBD02967216BC71556A0C1AEDF <br> 748FE84497423ED209357E923BE28083D42D69DE <br> B75D0379C5081958AF83A542901553E1710979C7 <br> BFC164E5A28A3D56B8493B1FC1CA4A12FA1AC6AC <br> C1EB0150E2FCC099465C210B528BF508D2C64520 <br> CBB7BA92CDF86FA260982399DAB8B416D905E89B <br> DF051C67EE633231E4C76EC247932C1A9868C14F <br> DFD8665D91C508FAF66E2BC2789B504670762EA2 <br> E2436472B984F4505B4B938CEE6CAE26EF043FC7 <br> E3E61DF9E0DD92C98223C750E13001CBB73A1E31 <br> E496318E6644E47B07D6CAB00B93D27D0FE6B415 <br> EDA505896FFF9A29BD7EAE67FD626D7FFA36C7B2 <br> F00BEFDF08678B642B69D128F2AFAE32A1564A90 <br> F36ECAC8696AA0862AD3779CA464B2CD399D8099</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy DLL (mode "uniquement en m√©moire"): </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>0BCECB797306D30D0BA5EAEA123B5BF69981EFF4 <br> 11159DB91B870E6728F1A7835B5D8BE9424914B9 <br> 6ABD4B82A133C4610E5779C876FCB7E066898380 <br> 848F0DBF50B582A87399428D093E5903FFAEEDCD <br> 99A81305EF6E45F470EEE677C6491045E3B4D33A <br> A01036A8EFE5349920A656A422E959A2B9B76F02 <br> C449294E57088E2E2B9766493E48C98B8C9180F8 <br> C7FC689FE76361EF4FDC1F2A5BAB71C0E2E09746 <br> D24FC871A721B2FD01F143EB6375784144365A84 <br> DA617BC6DCD2083D93A9A83D4F15E3713D365960 <br> E4FCAA1B6A27AA183C6A3A46B84B5EAE9772920B</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moonraker petya </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>1AA1EF7470A8882CA81BB9894630433E5CCE4373</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Scripts PHP et ASP </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>10F4D12CF8EE15747BFB618F3731D81A905AAB04 <br> 13C5B14E19C9095ABA3F1DA56B1A76793C7144B9 <br> 1BA30B645E974DE86F24054B238FE77A331D0D2C <br> 438C8F9607E06E7AC1261F99F8311B004C23DEC3 <br> 4D1C282F9942EC87C5B4D9363187AFDC120F4DC7 <br> 4E0C5CCFFB7E2D17C26F82DB5564E47F141300B3 <br> 5377ADB779DE325A74838C0815EEA958B4822F82 <br> 58A69A8D1B94E751050DECF87F2572E09794F0F8 <br> 5DD34FB1C8E224C17DCE04E02A4409E9393BCE58 <br> 639BCE78F961C4B9ECD9FE1A8537733388B99857 <br> 7127B880C8E31FBEB1D376EB55A6F878BC77B21A <br> 71BA8FE0C9C32A9B987E2BB827FE54DAE905D65E <br> 78A7FBDD6ADF073EA6D835BE69084E071B4DA395 <br> 81332D2F96A354B1B8E11984918C43FB9B5CB9DB <br> 8CC008B3189F8CE9A96C2C41F864D019319EB2EE <br> 940DE46CD8C50C28A9C0EFC65AEE7D567117941B <br> A415E12591DD47289E235E7022A6896CB2BFDE96 <br> D3AE97A99D826F49AD03ADDC9F0D5200BE46AB5E <br> E69F5FF2FCD18698BB584B6BC15136D61EB4F594 <br> E83A090D325E4A9E30B88A181396D62FEF5D54D5 <br> ECF21EFC09E4E2ACFEEB71FB78CB1F518E1F5724</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Scanner de port personnalis√© </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>B371A5D6465DC85C093A5FB84D7CDDEB1EFFCC56 <br> B40BDE0341F52481AE1820022FA8376E53A20040</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mimikatz </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>89D7E0DA80C9973D945E6F62E843606B2E264F7E <br> 8B295AB4789105F9910E4F3AF1B60CBBA8AD6FC0 <br> AD6F835F239DA6683CAA54FCCBCFDD0DC40196BE</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Winexe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1: </font><font style="vertical-align: inherit;">Avertissement: la plupart des serveurs avec ces adresses IP faisaient partie du r√©seau Tor, c'est-√†-dire que l'utilisation de ces indicateurs peut conduire √† des faux positifs.</font></font><br> <code>0666B109B0128599D535904C1F7DDC02C1F704F2 <br> 2695FCFE83AB536D89147184589CCB44FC4A60F3 <br> 3608EC28A9AD7AF14325F764FB2F356731F1CA7A <br> 37C837FB170164CBC88BEAE720DF128B786A71E0 <br> 594B809343FEB1D14F80F0902D764A9BF0A8C33C <br> 7C1F7CE5E57CBDE9AC7755A7B755171E38ABD70D <br> 90122C0DC5890F9A7B5774C6966EA694A590BD38 <br> C59F66808EA8F07CBDE74116DDE60DAB4F9F3122 <br> CEB96B364D6A8B65EA8FA43EB0A735176E409EB0 <br> FCEAA83E7BD9BCAB5EFBA9D1811480B8CB0B8A3E</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le serveur C&amp;C s'adresse √† GreyEnergy mini </font></font></h4><br> <code>https://82.118.236[.]23:8443/27c00829d57988279f3ec61a05dee75a <br> http://82.118.236[.]23:8080/27c00829d57988279f3ec61a05dee75a <br> https://88.198.13[.]116:8443/xmlservice <br> http://88.198.13[.]116:8080/xmlservice <br> https://217.12.204[.]100/news/ <br> http://217.12.204[.]100/news/ <br> http://pbank.co[.]ua/favicon.ico (IP: 185.128.40.90)</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adresses des serveurs GreyEnergy C &amp; C (p√©riodes d'activit√© et IP) </font></font></h4><br> <code>2015‚Äì2016 ‚Äì 109.200.202.7 <br> 2015‚Äì2015 ‚Äì 193.105.134.68 <br> 2015‚Äì2016 ‚Äì 163.172.7.195 <br> 2015‚Äì2016 ‚Äì 163.172.7.196 <br> 2016‚Äì2016 ‚Äì 5.149.248.77 <br> 2016‚Äì2016 ‚Äì 31.148.220.112 <br> 2016‚Äì2016 ‚Äì 62.210.77.169 <br> 2016‚Äì2016 ‚Äì 85.25.211.10 <br> 2016‚Äì2016 ‚Äì 138.201.198.164 <br> 2016‚Äì2017 ‚Äì 124.217.254.55 <br> 2017‚Äì2017 ‚Äì 46.249.49.231 <br> 2017‚Äì2017 ‚Äì 37.59.14.94 <br> 2017‚Äì2017 ‚Äì 213.239.202.149 <br> 2017‚Äì2017 ‚Äì 88.198.13.116 <br> 2017‚Äì2017 ‚Äì 217.12.202.111 <br> 2017‚Äì2017 ‚Äì 176.31.116.140 <br> 2017‚Äì2018 ‚Äì 185.217.0.121 <br> 2017‚Äì2018 ‚Äì 178.150.0.200 <br> 2018‚Äì2018 ‚Äì 176.121.10.137 <br> 2018‚Äì2018 ‚Äì 178.255.40.194 <br> 2018‚Äì2018 ‚Äì 193.105.134.56 <br> 2018‚Äì2018 ‚Äì 94.130.88.50 <br> 2018‚Äì2018 ‚Äì 185.216.33.126</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426911/">https://habr.com/ru/post/fr426911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426899/index.html">Vid√©o Meetup Video Science</a></li>
<li><a href="../fr426901/index.html">L'appareil photo le plus rapide du monde prend 10 000 milliards d'images par seconde</a></li>
<li><a href="../fr426903/index.html">La ville de Chengdu veut mettre en orbite un r√©flecteur satellite pour √©clairer les rues avec une tache de soleil de 10 √† 80 km</a></li>
<li><a href="../fr426905/index.html">PVS-Studio 6.26 Release</a></li>
<li><a href="../fr426907/index.html">Probl√®mes courants de s√©curit√© du r√©seau d'entreprise pouvant √™tre d√©tect√©s avec Check Point Security CheckUP</a></li>
<li><a href="../fr426913/index.html">Comment faire des interviews entre les rapports et un petit rapport sur DevOops</a></li>
<li><a href="../fr426915/index.html">Hackathon de la NASA: Space Apps Challenge</a></li>
<li><a href="../fr426917/index.html">Plate-forme intelligente et s√©curis√©e de Cisco pour les entreprises √† l'√®re num√©rique</a></li>
<li><a href="../fr426919/index.html">Pr√©sentation de Microsoft Learn</a></li>
<li><a href="../fr426921/index.html">Oh, mon code: comment r√©ussir en informatique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>