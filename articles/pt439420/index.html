<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úãüèª üßóüèæ üë®‚Äçüè≠ Construindo um pacote de transporte sem instalar o MODX ü•† üîò üç∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Escrever seus pacotes para o MODX n√£o √© f√°cil para iniciantes, e um desenvolvedor experiente √†s vezes se diverte. Mas o iniciante est√° assustado, e o ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construindo um pacote de transporte sem instalar o MODX</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439420/"><img src="https://habrastorage.org/webt/jv/hq/2n/jvhq2nbsj0ti2v8v_ucoyk_bwam.jpeg"><br><br>  Escrever seus pacotes para o MODX n√£o √© f√°cil para iniciantes, e um desenvolvedor experiente √†s vezes se diverte.  Mas o iniciante est√° assustado, e o experiente entende :). <br><br>  Este post fala sobre como voc√™ pode escrever e criar um pacote de componentes para o MODX sem instalar e configurar o pr√≥prio MODX.  O n√≠vel est√° acima da m√©dia, portanto, em alguns casos, voc√™ pode ter que mexer com o c√©rebro, mas vale a pena. <br><br>  Pe√ßo detalhes sob gato. <br><a name="habracut"></a><br>  Uma vez, quando o MODX Revolution apareceu, era na vers√£o beta inicial, os desenvolvedores ainda n√£o sabiam como trabalhar com ele e como escrever plugins para ele.  Bem, exceto a equipe que se debru√ßou sobre o CMS.  E a equipe, devo dizer, teve sucesso parcial e forneceu ao pr√≥prio sistema a coleta conveniente de pacotes que podem ser instalados no reposit√≥rio, o que parece l√≥gico.  Mas desde ent√£o, muitos anos se passaram e os requisitos para pacotes e sua montagem mudaram um pouco. <br><br><h2>  Copiar e colar √© ruim, embora nem sempre </h2><br>  Nos √∫ltimos meses, fui assombrado com a id√©ia de por que, para criar um pacote para o MODX, voc√™ deve instal√°-lo, criar um banco de dados, criar um administrador, etc.  Tantas a√ß√µes extras.  N√£o, n√£o h√° nada errado com isso se voc√™ configur√°-lo uma vez e depois us√°-lo.  Muitos fazem isso.  Mas e quando voc√™ deseja confiar a assembl√©ia ao script e tomar um caf√© voc√™ mesmo? <br><br>  Aconteceu que os criadores do MODX estavam acostumados a trabalhar com o pr√≥prio MODX e adicionaram classes ao pacote diretamente no kernel.  Eles tamb√©m escreveram os primeiros componentes, os primeiros scripts de compila√ß√£o, que foram usados ‚Äã‚Äãcomo exemplos por outros desenvolvedores que simplesmente copiaram a solu√ß√£o, nem sempre investigando a ess√™ncia do que estava acontecendo.  E eu fiz isso. <br><br>  Mas a tarefa √© automatizar a montagem do pacote, preferencialmente no servidor, sempre com um conjunto m√≠nimo de software necess√°rio, com recursos m√≠nimos e, portanto, com maior velocidade.  A tarefa foi definida e, depois de estudar a fonte, Jason freou no bate-papo e encontrou uma solu√ß√£o. <br><br><h2>  E qual? </h2><br>  A primeira coisa que descobri √© que o c√≥digo respons√°vel pela compila√ß√£o do pacote est√° diretamente na biblioteca xPDO, e no MODX existem apenas classes de wrapper que fornecem uma API mais conveniente e s√£o mais f√°ceis de trabalhar, mas apenas se o MODX estiver instalado.  Portanto, provavelmente apenas o xPDO pode ser usado de alguma forma, mas no c√≥digo, o construtor do objeto xPDO exige que voc√™ especifique dados para a conex√£o com o banco de dados. <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $dsn, $username = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $password = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $options = [], $driverOptions= null )</span></span></span></span>;</code> </pre> <br>  Ap√≥s interrogar Jason, ficou claro que, embora os par√¢metros precisem ser definidos, a conex√£o f√≠sica real com o banco de dados ocorre exatamente no momento em que √© necess√°rio.  Carga pregui√ßosa em toda a sua gl√≥ria.  O segundo problema foi resolvido. <br><br>  A terceira quest√£o foi a conex√£o do xPDO ao projeto.  O Composer imediatamente veio √† mente, mas a vers√£o 2.x na qual o MODX atual est√° sendo executado n√£o suporta o Composer, e a ramifica√ß√£o 3.x usa namespaces e os nomes de classe s√£o escritos de maneira diferente da 2.x, o que leva a conflitos e erros.  Em geral, incompat√≠vel.  Ent√£o eu tive que usar ferramentas git e conectar o xPDO como um subm√≥dulo. <br><blockquote><h4>  Como usar subm√≥dulos </h4><br><br>  Primeiro, leia a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> neles. <br><br>  Ent√£o, se este for um novo projeto, voc√™ precisar√° adicionar um subm√≥dulo: <br><br><pre> <code class="plaintext hljs">$ git submodule add https://github.com/username/reponame</code> </pre> <br>  Este comando clonar√° e instalar√° um subm√≥dulo no seu projeto.  Ent√£o voc√™ precisar√° adicionar a pasta submodule ao seu reposit√≥rio com o comando git add.  Ele n√£o adicionar√° a pasta inteira ao subm√≥dulo, mas adicionar√° ao git apenas um link para o √∫ltimo commit do subm√≥dulo. <br><br>  Para que outro desenvolvedor possa clonar o projeto com todas as depend√™ncias, √© necess√°rio criar uma configura√ß√£o .gitmodules para submodules.  No projeto Slackify, √© assim: <br><br><pre> <code class="plaintext hljs">[submodule "_build/xpdo"] path = _build/xpdo url = https://github.com/modxcms/xpdo.git branch = 2.x</code> </pre><br>  Depois disso, ao clonar, basta especificar o sinalizador recursivo e o git far√° o download de todos os reposit√≥rios dependentes. </blockquote>  Como resultado, temos o xPDO, o xPDO pode ser usado sem conex√£o com o banco de dados; se n√£o for necess√°rio, o xPDO pode ser conectado ao c√≥digo do componente como uma depend√™ncia externa (sub-m√≥dulo git).  Agora a implementa√ß√£o do script de constru√ß√£o. <br><br><h2>  Vamos entender </h2><br>  Descreverei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">script de compila√ß√£o do</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Slackify addon</a> postado recentemente por mim.  Esse componente √© gratuito e est√° dispon√≠vel publicamente no GitHub, o que facilitar√° o auto-estudo. <br><br><h3>  Connect xPDO </h3><br>  N√≥s omitimos a tarefa de constantes com o nome do pacote e outras chamadas necess√°rias e conectamos o xPDO. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'xpdo/xpdo/xpdo.class.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'xpdo/xpdo/transport/xpdotransport.class.php'</span></span>; $xpdo = xPDO::getInstance(<span class="hljs-string"><span class="hljs-string">'db'</span></span>, [ xPDO::OPT_CACHE_PATH =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../cache/'</span></span>, xPDO::OPT_HYDRATE_FIELDS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDO::OPT_HYDRATE_RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDO::OPT_HYDRATE_ADHOC_FIELDS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDO::OPT_CONNECTIONS =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'dsn'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=xpdotest;charset=utf8'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; [xPDO::OPT_CONN_MUTABLE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>], <span class="hljs-string"><span class="hljs-string">'driverOptions'</span></span> =&gt; [], ] ] ]);</code> </pre> <br>  Adicionei o sub-m√≥dulo xPDO √† pasta _build, necess√°ria apenas no est√°gio de desenvolvimento e montagem do pacote e que n√£o entrar√° no arquivo principal do componente.  A segunda c√≥pia do xPDO no site com MODX ao vivo n√£o √© necess√°ria. <br><br>  Nas configura√ß√µes de conex√£o do xPDO, defino o nome do banco de dados em <code>dsn</code> , mas ele n√£o desempenha nenhum papel.  √â importante que a pasta de cache dentro do xPDO seja grav√°vel.  √â isso a√≠, o xPDO √© inicializado. <br><br><h3>  Fazendo um truque complicado com classes </h3><br>  Ao usar o MODX instalado ao criar o pacote, tudo √© simples, pegamos e criamos um objeto da classe que precisamos.  O MODX realmente encontra a classe necess√°ria, encontra a implementa√ß√£o necess√°ria para esta classe (a classe com o postfix _mysql), que depende do banco de dados e cria o objeto desejado (por causa desse recurso, voc√™ pode receber erros ao criar o pacote que a classe * _mysql n√£o encontrado, isso n√£o √© assustador).  No entanto, n√£o temos base nem implementa√ß√£o.  De alguma forma, precisamos substituir a classe desejada, o que estamos fazendo. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modNamespace</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xPDOObject</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modSystemSetting</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xPDOObject</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  Criamos uma classe fict√≠cia (stub), necess√°ria para criar o objeto desejado.  Isso n√£o teria que ser feito se o xPDO n√£o verificasse especificamente a qual classe o objeto pertence.  Mas ele verifica. <br><br>  Mas h√° casos especiais em que voc√™ precisa fazer um pouco mais do que apenas definir uma classe.  Esses s√£o casos de depend√™ncias entre classes.  Por exemplo, precisamos adicionar um plugin √† categoria.  No c√≥digo, apenas <code>$category-&gt;addOne($plugin);</code>  mas no nosso caso isso n√£o vai funcionar. <br><br>  Se voc√™ j√° examinou <a href="">o esquema do banco de dados MODX</a> , provavelmente viu elementos como agregado e composto.  Est√° escrito sobre eles na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> , mas se de uma maneira simples, eles descrevem o relacionamento entre as classes. <br><br>  No nosso caso, pode haver v√°rios plugins em uma categoria, pelos quais o elemento agregado √© respons√°vel pela classe <code>modCategory</code> .  Portanto, como temos uma classe sem uma implementa√ß√£o concreta, precisamos indicar essa conex√£o manualmente.  √â mais f√°cil fazer isso substituindo o m√©todo <code>getFKDefinition</code> : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modCategory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xPDOObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFKDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($alias)</span></span></span><span class="hljs-function"> </span></span>{ $aggregates = [ <span class="hljs-string"><span class="hljs-string">'Plugins'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modPlugin'</span></span>, <span class="hljs-string"><span class="hljs-string">'local'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'foreign'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'category'</span></span>, <span class="hljs-string"><span class="hljs-string">'cardinality'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'many'</span></span>, <span class="hljs-string"><span class="hljs-string">'owner'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'local'</span></span>, ] ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($aggregates[$alias]) ? $aggregates[$alias] : []; } }</code> </pre> <br>  No nosso componente, apenas plugins s√£o usados, portanto, adicionamos links apenas para eles.  Depois disso, o m√©todo addMany da classe modCategory pode adicionar facilmente os plugins necess√°rios √† categoria e, em seguida, ao pacote. <br><br><h3>  Crie um pacote </h3><br><pre> <code class="php hljs">$package = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> xPDOTransport($xpdo, $signature, $directory);</code> </pre> <br>  Como voc√™ pode ver, tudo √© muito, muito simples.  Aqui precisamos passar o par√¢metro <code>$xpdo</code> , que inicializamos no in√≠cio.  Se n√£o fosse por esse momento, n√£o haveria problema 2.  <code>$signature</code> - o nome do pacote, incluindo a vers√£o, <code>$directory</code> - o local onde o pacote ser√° cuidadosamente colocado.  De onde v√™m essas vari√°veis, veja voc√™ mesmo na fonte. <br><br><h3>  Crie um espa√ßo para nome e adicione-o ao pacote </h3><br>  Precisamos de um espa√ßo para nome para vincular l√©xicos e configura√ß√µes do sistema a ele.  No nosso caso, apenas por isso, outros ainda n√£o s√£o considerados. <br><br><pre> <code class="php hljs">$namespace = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modNamespace($xpdo); $namespace-&gt;fromArray([ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'path'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'{core_path}components/'</span></span> . PKG_NAME_LOWER . <span class="hljs-string"><span class="hljs-string">'/'</span></span>, ]); $package-&gt;put($namespace, [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RESOLVE_FILES =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RESOLVE_PHP =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::NATIVE_KEY =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'namespace'</span></span> =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'package'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modx'</span></span>, <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'validate'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ]);</code> </pre> <br>  A primeira parte √© clara para quem j√° escreveu um c√≥digo para o MODX.  O segundo, com a adi√ß√£o do pacote, √© um pouco mais complicado.  O m√©todo <code>put</code> usa 2 par√¢metros: o pr√≥prio objeto e uma matriz de par√¢metros que descrevem esse objeto e seu poss√≠vel comportamento no momento da instala√ß√£o do pacote.  Por exemplo, <code>xPDOTransport::UNIQUE_KEY =&gt; 'name'</code> significa que o campo de <code>name</code> com o nome do pr√≥prio espa√ßo para nome como valor ser√° usado para o espa√ßo como uma chave exclusiva no banco de dados.  Voc√™ pode ler mais sobre os par√¢metros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">na documenta√ß√£o do xPDO</a> e, melhor, estudando o c√≥digo-fonte. <br><br>  Da mesma maneira, voc√™ pode adicionar outros objetos, como configura√ß√µes do sistema. <br><br><pre> <code class="php hljs">$package-&gt;put($setting, [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'key'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modSystemSetting'</span></span>, <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'validate'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'package'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modx'</span></span>, ]);</code> </pre> <br><h3>  Crie uma categoria </h3><br>  Com a adi√ß√£o de uma categoria, tive a maior piada quando descobri tudo.  Os elementos colocados em uma categoria no modelo xPDO devem pertencer a essa categoria, ou seja,  ser aninhado nele e somente ent√£o a pr√≥pria categoria deve ser aninhada no pacote.  E, ao mesmo tempo, voc√™ precisa levar em considera√ß√£o os relacionamentos entre as classes, que eu j√° descrevi acima.  Demorou muito tempo para entender, perceber e aplic√°-lo corretamente. <br><br><pre> <code class="php hljs">$package-&gt;put($category, [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'category'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::ABORT_INSTALL_ON_VEHICLE_FAIL =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RELATED_OBJECT_ATTRIBUTES =&gt; [ <span class="hljs-string"><span class="hljs-string">'Plugins'</span></span> =&gt; [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ], <span class="hljs-string"><span class="hljs-string">'PluginEvents'</span></span> =&gt; [ xPDOTransport::UNIQUE_KEY =&gt; [<span class="hljs-string"><span class="hljs-string">'pluginid'</span></span>, <span class="hljs-string"><span class="hljs-string">'event'</span></span>], xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ] ], xPDOTransport::NATIVE_KEY =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'package'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modx'</span></span>, <span class="hljs-string"><span class="hljs-string">'validate'</span></span> =&gt; $validators, <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; $resolvers ]);</code> </pre> <br>  Parece monstruoso, mas n√£o t√£o visto.  Um par√¢metro importante √© <code>xPDOTransport::RELATED_OBJECTS =&gt; true</code> , que indica que a categoria possui elementos aninhados que tamb√©m precisam ser empacotados e depois instalados. <br><br>  Como a maioria dos m√≥dulos cont√©m v√°rios elementos (chunks, snippets, plugins), a categoria com elementos √© a parte mais importante do pacote de transporte.  Portanto, √© aqui que s√£o especificados validadores e resolvedores, que s√£o executados durante a instala√ß√£o do pacote. <br><blockquote>  Os validadores s√£o executados antes da instala√ß√£o, os resolvedores - depois. </blockquote><br>  Eu quase esqueci, antes de embalar a categoria, precisamos adicionar nossos elementos a ela.  Assim: <br><br><pre> <code class="php hljs">$plugins = <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'data'</span></span>] . <span class="hljs-string"><span class="hljs-string">'transport.plugins.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($plugins)) { $category-&gt;addMany($plugins, <span class="hljs-string"><span class="hljs-string">'Plugins'</span></span>); }</code> </pre> <br><h3>  Adicione outros dados ao pacote. </h3><br>  No pacote, voc√™ precisa adicionar outro arquivo com uma licen√ßa, um arquivo com um log de altera√ß√µes e um arquivo com uma descri√ß√£o do componente.  Se necess√°rio, voc√™ pode adicionar outro script especial atrav√©s do atributo <code>setup-options</code> , que mostrar√° a janela antes de instalar o pacote.  √â quando, em vez de "Instalar", o bot√£o "Op√ß√µes de instala√ß√£o".  E a partir da vers√£o do MODX 2.4, tornou-se poss√≠vel especificar depend√™ncias entre pacotes usando o atributo require, e nele voc√™ tamb√©m pode especificar a vers√£o do PHP e MODX. <br><br><pre> <code class="php hljs">$package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'changelog'</span></span>, file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'changelog.txt'</span></span>)); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'license'</span></span>, file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'license.txt'</span></span>)); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'readme'</span></span>, file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'readme.txt'</span></span>)); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'requires'</span></span>, [<span class="hljs-string"><span class="hljs-string">'php'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&gt;=5.4'</span></span>]); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'setup-options'</span></span>, [<span class="hljs-string"><span class="hljs-string">'source'</span></span> =&gt; $sources[<span class="hljs-string"><span class="hljs-string">'build'</span></span>] . <span class="hljs-string"><span class="hljs-string">'setup.options.php'</span></span>]);</code> </pre> <br><h3>  N√≥s embalamos </h3><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($package-&gt;pack()) { $xpdo-&gt;log(xPDO::LOG_LEVEL_INFO, <span class="hljs-string"><span class="hljs-string">"Package built"</span></span>); }</code> </pre> <br>  √â isso, pegue o pacote pronto em <code>_packages</code> , bem, ou de onde voc√™ configurou a montagem. <br><br><h2>  Qual √© o resultado? </h2><br>  O resultado superou minhas expectativas, pois essa abordagem, apesar de impor algumas limita√ß√µes e, em alguns lugares, acrescenta algum inconveniente, mas vence em termos de possibilidades de aplica√ß√£o. <br><br>  Para compilar o pacote, basta executar 2 comandos: <br><br><pre> <code class="plaintext hljs">git clone --recursive git@github.com:Alroniks/modx-slackify.git cd modx-slackify/_build &amp;&amp; php build.transport.php</code> </pre> <br>  O primeiro √© a clonagem do reposit√≥rio e de seus subm√≥dulos.  Um par√¢metro importante √© <code>--recursive</code> , pois o git far√° o download e instalar√°, al√©m do pr√≥prio c√≥digo do componente, todas as depend√™ncias descritas como sub-m√≥dulos. <br><br>  O segundo √© construir o pacote diretamente.  Depois disso, voc√™ pode pegar o <code>_packages</code> pasta <code>_packages</code> e carreg√°-lo, por exemplo, no reposit√≥rio. <br><br>  As perspectivas s√£o amplas.  Por exemplo, voc√™ pode configurar um gancho no GitHub, que, ap√≥s se comprometer com uma ramifica√ß√£o, executar√° um script no servidor que coletar√° o pacote e o colocar√° em todos os sites que voc√™ possui.  Ou fa√ßa o upload da nova vers√£o para algum reposit√≥rio e, nesse momento, voc√™ far√° caf√© para si, como eu disse no come√ßo.  Ou voc√™ pode criar e escrever testes para o m√≥dulo, executar o teste e criar atrav√©s do Jenkins ou Travis.  Sim, voc√™ pode criar v√°rios cen√°rios.  Com essa abordagem, agora √© muito mais f√°cil fazer isso. <br><br>  Fa√ßa perguntas, tente responder. <br><br>  PS N√£o passe, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coloque uma estrela do Slackify no GitHub</a> , por favor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439420/">https://habr.com/ru/post/pt439420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439408/index.html">Pseudo Lens Flare</a></li>
<li><a href="../pt439410/index.html">Jeff Hawkins est√° finalmente pronto para explicar sua pesquisa sobre o c√©rebro</a></li>
<li><a href="../pt439414/index.html">Cliente para "Servidor de Mensagens Push"</a></li>
<li><a href="../pt439416/index.html">Artigo de revis√£o A-Frame</a></li>
<li><a href="../pt439418/index.html">Pentaho Data Integration (PDI), Python e Deep Learning</a></li>
<li><a href="../pt439422/index.html">O que um programador precisa para desenvolver jogos e quem √© desenvolvedor de jogos de um programador?</a></li>
<li><a href="../pt439424/index.html">Como lutei com hospedagem gratuita e compositor</a></li>
<li><a href="../pt439426/index.html">Situa√ß√£o: uma nova onda de ataques com a intercepta√ß√£o de consultas DNS - analisamos os m√©todos b√°sicos de prote√ß√£o</a></li>
<li><a href="../pt439428/index.html">Como evitar ataques cibern√©ticos direcionados? 10 melhores caixas de prote√ß√£o de rede</a></li>
<li><a href="../pt439430/index.html">Acredite em mim se puder. Contadores de √°gua. parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>