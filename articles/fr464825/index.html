<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏿 🚣🏽 🏇🏿 Préparation de l'application pour Android Q. Partie 2 🧑‍🤝‍🧑 🏘️ 🚍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La traduction de l'article a été préparée spécialement pour les étudiants du cours "développeur Android". Cours de base . " Nous vous rappelons égalem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Préparation de l'application pour Android Q. Partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/464825/">  <i>La traduction de l'article a été préparée spécialement pour les étudiants du cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"développeur Android".</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cours de base</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a></i>  <i>Nous vous rappelons également que nous continuons de nous inscrire au cours avancé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Spécialisation Android-développeur"</a></i> <br><br><img src="https://habrastorage.org/webt/jn/f8/--/jnf8--c1dp0fowsqumsy7obnvbi.png"><br><br><hr><blockquote>  La confidentialité et la sécurité se trouvent dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">première partie de l'</a> article. <br></blockquote><br><h2>  2) Expériences utilisateur </h2><br><h4>  a) Gestes de navigation </h4><br><img src="https://habrastorage.org/webt/l6/83/t0/l683t0nbn6vonb7dbotjerud2wa.gif"><br><br>  Dans Android Q, Google a essayé de combiner tous les gestes de navigation avec le nouveau système de gestes de navigation, qui a remplacé la barre de navigation flottante (retour, accueil et applications récentes). <br><br><ul><li>  <b>Ce qui affecte:</b> si votre application contient des gestes, ils peuvent entrer en conflit avec les gestes du système.  Cela affectera toutes les applications exécutées sur Android Q (quel que soit le SDK cible), car les gestes du système seront traités en premier. </li><li>  <b>Approche recommandée:</b> la barre de navigation flottante ayant pratiquement disparu, il est recommandé d'utiliser pleinement le nouvel espace d'écran disponible et de fournir aux utilisateurs un effet immersif. </li></ul><a name="habracut"></a><br>  Pour créer un effet immersif, les applications doivent apparaître derrière la barre d'état et la barre de navigation.  Tout d'abord, rendez la barre d'état et la barre de navigation transparentes. <br><br><pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string"><span class="hljs-string">"AppTheme"</span></span>&gt; ...... &lt;item name=<span class="hljs-string"><span class="hljs-string">"android:navigationBarColor"</span></span>&gt;<span class="hljs-meta"><span class="hljs-meta">@android</span></span>:color/transparent&lt;/item&gt; &lt;!-- Optional, but recommended <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> full edge-to-edge rendering --&gt; &lt;item name=<span class="hljs-string"><span class="hljs-string">"android:statusbarColor"</span></span>&gt;<span class="hljs-meta"><span class="hljs-meta">@android</span></span>:color/transparent&lt;/item&gt; &lt;/style&gt;</code> </pre> <br>  Ensuite, nous faisons l'affichage <code>Activity/View</code> Affichage en plein écran: <br><br><pre> <code class="kotlin hljs">view.systemUiVisibility = <span class="hljs-comment"><span class="hljs-comment">//Layout as if the navigation bar was hidden View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION or //Layout as if the status bar was hidden View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN or //Layout at its most extreme View.SYSTEM_UI_FLAG_LAYOUT_STABLE</span></span></code> </pre><br><img src="https://habrastorage.org/webt/u-/dv/wc/u-dvwcebklqibn25qn99msqrdc4.png"><br><br>  FAB (Floating Action Button) est couvert par une barre de navigation flottante.  Une barre de navigation flottante est incluse pour plus de clarté. <br><br>  Maintenant que l'application est affichée en mode plein écran derrière les composants système (transparents), il est possible qu'un type de composant d'application interactif soit bloqué par l'interface utilisateur du système.  Pour résoudre ce problème, utilisez des encarts. <br><br>  Les encarts sont un ensemble de valeurs qui nous indiqueront le degré de déplacement de la vue afin qu'elles n'entrent pas en conflit avec l'interface utilisateur du système.  Ces informations sont fournies par la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WindowInset</a> .  À partir de l'API 20, Android fournit aux développeurs des insertions de fenêtre système, qui vous indiquent la quantité d'espace qu'occupent les composants du système (tels que la barre de navigation flottante et la barre d'état).  Ces informations peuvent être utilisées pour déplacer la vue interactive de sorte que l'utilisateur appuie dessus, et non sur l'interface utilisateur du système. <br><br><pre> <code class="kotlin hljs">root.setOnApplyWindowInsetsListener { _, insets -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fabLp = fab.layoutParams <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CoordinatorLayout.LayoutParams fabLp.bottomMargin = fabOriginalBottomMargin + insets.systemWindowInsetBottom fab.layoutParams = fabLp insets.consumeSystemWindowInsets() }</code> </pre> <br>  Pour FAB, définissez l'écouteur WindowsInsets et appliquez l'encart de la fenêtre inférieure comme retrait inférieur. <br><br>  <i>De même, à partir d'Android Q, le système fournit des encarts pour les mouvements de navigation afin de déplacer les vues permutées afin qu'elles n'entrent pas en conflit avec les mouvements du système.</i>  <i>Ils sont fournis via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Insets.getSystemGestureInsets ()</a></i> <br><br><img src="https://habrastorage.org/webt/ns/pk/fi/nspkfinzrxups6mgjnqaf-rpoza.png"><br>  <i>Les zones de gestes du système sont surlignées en jaune.</i> <br><br>  Mais que se passe-t-il si nous ne voulons pas déplacer la vue et que nous voulons placer du contenu dans ces zones de gestes qui peuvent entrer en conflit avec l'application?  Dans ces scénarios, l'application peut déterminer les zones dans lesquelles l'application va d'abord gérer l'événement tactile, plutôt que les gestes du système.  Cela peut être fait en passant <code><code>List&lt;</code> Rect <code>&gt;</code></code> à l'API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">View.setSystemGestureExclusionRects ()</a> fournie dans Android Q. Cette méthode est également disponible dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ViewCompat</a> avec <code>androidx.core:core:1.1.0</code> . <br><br><ul><li>  <b>Pièges:</b> vous pouvez refuser de traiter uniquement les gestes inversés.  Les limites du geste «maison» sont réservées et ne peuvent pas être redéfinies.  En effet, il n'y a qu'une seule façon de quitter l'application.  Si votre application entre en conflit avec le geste "home", utilisez <code>WindowInsets.getMandatorySystemGestureInsets()</code> pour obtenir ses bordures et déplacer votre vue. </li></ul><br><h4>  b) Thème sombre </h4><br>  Au cours de la dernière année, de nombreuses applications ont commencé à prendre en charge des thèmes sombres.  Android Q ajoute ce commutateur aux paramètres système. <br><br>  L'utilisateur peut activer le thème sombre de trois manières: <br><br><ol><li>  Un nouvel élément dans les paramètres système (Paramètres -&gt; Affichage -&gt; Thème) </li><li>  Nouvel élément dans les paramètres rapides </li><li>  Selon le fabricant, il peut être activé via le mode d'économie d'énergie. </li></ol><br>  Pour prendre en charge la configuration à l'échelle du système Dark Theme, le thème par défaut de votre application doit hériter du thème DayNight.  Cela relie le thème principal de l'application aux indicateurs de mode nuit contrôlés par le système.  Cela fonctionne en extrayant les ressources des dossiers de qualification de <code>night</code> . <br><br><pre> <code class="kotlin hljs">&lt;!--App Compat Style--&gt; &lt;style name=<span class="hljs-string"><span class="hljs-string">"AppTheme"</span></span> parent=<span class="hljs-string"><span class="hljs-string">"Theme.AppCompat.DayNight"</span></span>&gt; &lt;!--Material Components--&gt; &lt;style name=<span class="hljs-string"><span class="hljs-string">"AppTheme"</span></span> parent=<span class="hljs-string"><span class="hljs-string">"Theme.MaterialComponents.DayNight"</span></span>&gt;</code> </pre> <br>  Si vous regardez à l'intérieur des styles de compatibilité des applications, vous remarquerez que le thème DayNight pointe vers AppCompat Light dans la configuration par défaut et AppCompat dans la configuration de nuit. <br><br><pre> <code class="kotlin hljs">&lt;!--values/themes.xml--&gt; &lt;style name=<span class="hljs-string"><span class="hljs-string">"Theme.AppCompat.DayNight"</span></span> parent=<span class="hljs-string"><span class="hljs-string">"Theme.AppCompat.Light"</span></span>&gt; &lt;!--values-night/themes.xml--&gt; &lt;style name=<span class="hljs-string"><span class="hljs-string">"Theme.AppCompat.DayNight"</span></span> parent=<span class="hljs-string"><span class="hljs-string">"Theme.AppCompat"</span></span>&gt;</code> </pre> <br>  Si vous voulez donner aux utilisateurs la possibilité de contrôler le thème depuis l'application, vous pouvez appeler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AppCompatDelegate.setDefaultNightMode ()</a> , qui accepte l'un des quatre modes: <br><br><ol><li>  <code>MODE_NIGHT_YES</code> - Afficher le thème sombre </li><li>  <code>MODE_NIGHT_NO</code> - Afficher un sujet brillant </li><li>  <code>MODE_NIGHT_FOLLOW_SYSTEM</code> - Suivez les paramètres du système </li><li>  <code>MODE_NIGHT_AUTO_BATTERY</code> - <code>MODE_NIGHT_AUTO_BATTERY</code> thème sombre lorsque l'appareil passe en mode d'économie d'énergie. </li></ol><br><ul><li>  <b>Pièges:</b> </li></ul><br>  <b>a)</b> Ne codez pas en dur les couleurs.  S'il y a des couleurs codées en dur dans les fichiers de mise en page, c'est un réveil.  Remplacez-les par des liens vers la <code>color</code> .  Encore mieux: utilisez des attributs pour faire référence aux couleurs. <br><br>  <b>b)</b> Vérifiez les images et fournissez-leur d'autres ressources dans le cadre du classificateur de <code>night</code> . <br><br>  <b>c)</b> Il ne devrait pas y avoir de couleurs à revêtement dur dans les dessins vectoriels.  Utilisez la <code>tint</code> pour styliser les ressources vectorielles avec la bonne couleur. <br><br>  <b>d)</b> Assurez-vous que toutes <code>color</code> ressources de <code>color</code> ont des alternatives correspondantes dans le dossier <code>night</code> ( <code>values-night/colors.xml</code> ) <br><br>  <b>e)</b> Si une application utilise RemoteViews pour les notifications ou les widgets, assurez-vous également de les tester.  C'est bien si l'application utilise les styles de notification par défaut, car alors le système les traitera. <br><br>  <b>f)</b> Un changement de configuration pour <code>uiMode</code> est appelé chaque fois que l'appareil bascule entre le mode normal et le mode sombre.  L'utilisateur peut le faire manuellement ou activer le mode d'économie d'énergie.  Si l'application ne gère pas correctement les modifications de configuration, l'interface utilisateur perd le contexte lorsque l'appareil bascule entre les modes normal et sombre, car les activités visibles et leurs fragments sont détruits et recréés.  Par conséquent, même si l'interface utilisateur est verrouillée dans la même orientation, ajoutez la prise en charge des modifications de configuration.  De plus, si l'application gère manuellement les changements de configuration via <code>android:configChanges</code> , il y a de fortes chances que vous souhaitiez également gérer manuellement <code>uiMode</code> .  Par exemple, si une application utilise la lecture continue (lecteur vidéo), elle peut ne pas vouloir interrompre la lecture simplement parce que l'appareil est passé du mode normal au mode sombre. <br><br>  Android Q a également introduit de nombreuses autres choses que je n'ai pas abordées en détail, telles que le panneau Paramètres, la nouvelle API AudioPlaybackCapture (l'API permet aux applications de copier le son joué par d'autres applications. Cette fonction est similaire à la capture d'écran, mais pour l'audio). <br><br>  Enfin, Android Q comprend une liste mise à jour des interfaces limitées non spécifiques au SDK, qui peuvent finalement se voir refuser l'accès à partir du SDK Android.  Vous pouvez trouver une liste de vos violations dans la console de jeu dans la section «Rapport de pré-lancement». <br><br>  C’est tout.  Si vous pensez qu'il y a quelque chose d'important qui n'est pas mentionné dans l'article, faites le moi savoir dans les commentaires ci-dessous.  ;-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464825/">https://habr.com/ru/post/fr464825/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464805/index.html">Écrire un serpent sur iPad (Pythonista)</a></li>
<li><a href="../fr464809/index.html">Comment nous avons testé la technologie de reconnaissance faciale et ce qui en est ressorti</a></li>
<li><a href="../fr464811/index.html">Apple Music pour le développeur</a></li>
<li><a href="../fr464813/index.html">Remplacement de Punto Switcher, Birman layouts par un script sur autohotkey</a></li>
<li><a href="../fr464823/index.html">Nous considérons le salaire moyen d'un «data scientologist». Parsim hh.ru en utilisant pandas / python</a></li>
<li><a href="../fr464831/index.html">Ajouter la fonctionnalité Razor Pages au standard .NET</a></li>
<li><a href="../fr464833/index.html">Count Scoring de la Fer ou une étude sur la notation du crédit dans le cadre de l'élargissement de ses horizons. 2e partie</a></li>
<li><a href="../fr464837/index.html">Du Gange à la Volga: comment sauver les fleuves de la pollution?</a></li>
<li><a href="../fr464839/index.html">À propos d'un brevet Tesla Motors</a></li>
<li><a href="../fr464843/index.html">Agréable avec utile ou développement pour ASIO en C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>