<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜí ü§Æ üî´ Mainkan "osu!", Jangan lupa tentang kesalahan üë®üèª‚Äçüéì üàØÔ∏è üëäüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami menyambut semua pecinta kode eksotis dan tidak terlalu kesalahan. Hari ini di bangku tes PVS-Studio adalah tamu yang cukup langka - permainan dal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mainkan "osu!", Jangan lupa tentang kesalahan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/483438/"><p><img src="https://habrastorage.org/getpro/habr/post_images/3ac/9da/a12/3ac9daa12b519fc14e45f7f65abdd204.png" alt="Gambar 1" align="left"></p>  Kami menyambut semua pecinta kode eksotis dan tidak terlalu kesalahan.  Hari ini di bangku tes PVS-Studio adalah tamu yang cukup langka - permainan dalam C #.  Yaitu, osu!  Seperti biasa: cari kesalahan, pikirkan, mainkan. <br><a name="habracut"></a><br><h2>  Permainan </h2><br>  Osu!  - Sebuah permainan irama musik open source.  Dilihat oleh informasi dari <a href="https://osu.ppy.sh/home">situs web game</a> , itu cukup populer, karena lebih dari 15 juta pemain terdaftar diklaim.  Proyek ini ditandai oleh permainan gratis, desain penuh warna dengan kemampuan untuk menyesuaikan kartu, fitur-fitur canggih untuk menyusun peringkat pemain online, kehadiran multi pemain, serangkaian komposisi musik yang besar.  Saya tidak akan menjelaskan game secara detail, mereka yang tertarik akan dengan mudah menemukan semua informasi di jaringan.  Misalnya di <a href="https://en.wikipedia.org/wiki/Osu!">sini</a> . <br><br>  Saya lebih tertarik pada kode sumber proyek, yang tersedia untuk diunduh dari <a href="https://github.com/ppy/osu">GitHub</a> .  Sejumlah besar komitmen (lebih dari 24 ribu) ke repositori segera menarik perhatian, yang menunjukkan perkembangan aktif proyek, yang berlanjut hingga hari ini (permainan dirilis pada 2007, tetapi pekerjaan itu mungkin dimulai sebelumnya).  Pada saat yang sama, tidak ada banyak kode sumber - 1813 file .cs yang berisi 135 ribu baris kode, tidak termasuk yang kosong.  Kode ini berisi tes yang biasanya tidak saya perhitungkan dalam cek.  Kode uji terkandung dalam 306 file .cs dan, karenanya, 25 ribu baris kode, tidak termasuk yang kosong.  Ini adalah proyek kecil: untuk perbandingan, inti C # dari analisa PVS-Studio berisi sekitar 300 ribu baris kode. <br><br>  Secara total, untuk memeriksa kesalahan pada game, saya menggunakan proyek non-tes yang mengandung 1507 file kode sumber dan 110 ribu baris.  Namun, hasilnya sebagian menyenangkan saya, karena ada beberapa kesalahan menarik yang saya buru-buru ceritakan. <br><br><h2>  Kesalahan </h2><br>  <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> Ada hasil sub-ekspresi yang identik '== HitResult.Perfect' ke kiri dan ke kanan '||'  operator.  DrawableHoldNote.cs 266 <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckForResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... ApplyResult(r =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (holdNote.hasBroken &amp;&amp; (result == HitResult.Perfect || result == HitResult.Perfect)) result = HitResult.Good; .... }); }</code> </pre> <br>  Contoh yang bagus dari pemrograman berorientasi copy-paste.  Istilah komik yang baru-baru ini digunakan oleh kolega saya Valery Komarov (diperkenalkan) dalam artikelnya " <a href="https://www.viva64.com/ru/b/0699/">10 Kesalahan Teratas di Proyek Java untuk 2019</a> ". <br><br>  Jadi, dua pemeriksaan identik mengikuti satu demi satu.  Salah satu cek kemungkinan besar berisi <i>konstanta</i> enumerasi <i>HitResult</i> lainnya: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> HitResult { None, Miss, Meh, Ok, Good, Great, Perfect, }</code> </pre> <br>  Konstanta khusus mana yang perlu digunakan, atau apakah pemeriksaan kedua tidak diperlukan sama sekali?  Pertanyaan yang hanya bisa dijawab pengembang.  Bagaimanapun, kesalahan telah dibuat yang mendistorsi logika program. <br><br>  <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> Ada sub-ekspresi identik 'family! = GetFamilyString (TournamentTypeface.Aquatico)' di sebelah kiri dan di sebelah kanan operator '&amp;&amp;'.  TournamentFont.cs 64 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWeightString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> family, FontWeight weight</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weight == FontWeight.Regular &amp;&amp; family != GetFamilyString(TournamentTypeface.Aquatico) &amp;&amp; family != GetFamilyString(TournamentTypeface.Aquatico)) weightString = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; .... }</code> </pre> <br>  Dan lagi copy-paste.  Saya memformat kode, sehingga kesalahan mudah terlihat.  Dalam versi aslinya, seluruh kondisi ditulis dalam satu baris.  Sulit juga mengatakan bagaimana kode dapat diperbaiki.  <i>Enumerasi TournamentTypeface</i> berisi konstanta tunggal: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TournamentTypeface { Aquatico }</code> </pre> <br>  Kondisi ini mungkin telah menggunakan variabel <i>keluarga</i> dua kali secara tidak sengaja, tetapi ini tidak akurat. <br><br>  <a href="https://www.viva64.com/ru/w/v3009/">V3009</a> [CWE-393] Aneh bahwa metode ini selalu mengembalikan satu dan nilai 'false' yang sama.  KeyCounterAction.cs 19 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPressed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T action, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> forwards</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!EqualityComparer&lt;T&gt;.Default.Equals(action, Action)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IsLit = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (forwards) Increment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Metode ini akan selalu mengembalikan <i>false</i> .  Untuk kesalahan seperti itu, saya biasanya memeriksa kode panggilan, karena mereka sering tidak menggunakan nilai pengembalian di mana saja, maka tidak ada kesalahan (kecuali untuk gaya pemrograman yang jelek).  Dalam hal ini, saya menemukan kode berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPressed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T action</span></span></span><span class="hljs-function">)</span></span> =&gt; Target.Children .OfType&lt;KeyCounterAction&lt;T&gt;&gt;() .Any(c =&gt; c.OnPressed(action, Clock.Rate &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre> <br>  Seperti yang Anda lihat, hasil yang dikembalikan oleh metode <i>OnPressed</i> digunakan.  Dan karena selalu <i>salah</i> , hasil pemanggilan <i>OnPressed</i> juga akan selalu <i>salah</i> .  Saya pikir Anda harus memeriksa ulang kode ini lagi, karena ada kemungkinan kesalahan tinggi. <br><br>  Kesalahan serupa lainnya: <br><br><ul><li>  V3009 [CWE-393] Aneh bahwa metode ini selalu mengembalikan satu dan nilai 'false' yang sama.  KeyCounterAction.cs 30 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v3042/">V3042</a> [CWE-476] Kemungkinan NullReferenceException.  '?.'  dan '.'  operator digunakan untuk mengakses anggota objek 'val.NewValue' TournamentTeam.cs 41 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TournamentTeam</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Acronym.ValueChanged += val =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) FlagName.Value = val.NewValue.Length &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">// &lt;= ? val.NewValue?.Substring(0, 2).ToUpper() : string.Empty; }; .... }</span></span></code> </pre> <br>  Dalam kondisi <i>?:</i> Operator, variabel <i>val.NewValue</i> tidak aman.  Penganalisa membuat kesimpulan seperti itu, sejak saat itu di cabang kemudian, opsi aman digunakan untuk mengakses variabel melalui <i>pernyataan</i> akses bersyarat <i>val.NewValue?. Substring (....)</i> . <br><br>  Kesalahan serupa lainnya: <br><br><ul><li>  V3042 [CWE-476] Kemungkinan NullReferenceException.  '?.'  dan '.'  operator digunakan untuk mengakses anggota objek 'val.NewValue' TournamentTeam.cs 48 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v3042/">V3042</a> [CWE-476] Kemungkinan NullReferenceException.  '?.'  dan '.'  operator digunakan untuk mengakses anggota objek 'api' SetupScreen.cs 77 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionableInfo { Label = <span class="hljs-string"><span class="hljs-string">"Current User"</span></span>, ButtonText = <span class="hljs-string"><span class="hljs-string">"Change Login"</span></span>, Action = () =&gt; { api.Logout(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }, Value = api?.LocalUser.Value.Username, .... }, .... } private class ActionableInfo : LabelledDrawable&lt;Drawable&gt; { .... public Action Action; .... }</span></span></code> </pre> <br>  Kode ini kurang jelas, tetapi saya pikir kesalahannya masih ada.  Buat objek bertipe <i>ActionableInfo</i> .  Bidang <i>Tindakan</i> diinisialisasi dengan lambda, di badan yang tidak aman untuk bekerja dengan <i>api</i> referensi yang berpotensi nol.  Penganalisa menganggap pola ini sebagai kesalahan, sejak saat itu, ketika menginisialisasi parameter <i>Nilai</i> , variabel <i>api</i> bekerja dengan aman.  Saya menyebut kesalahan ambigu, karena kode lambda mengasumsikan eksekusi tertunda dan kemudian, mungkin, pengembang entah bagaimana menjamin nilai non-nol dari tautan <i>api</i> .  Tapi ini hanya asumsi, karena tubuh lambda tidak mengandung tanda-tanda pekerjaan yang aman dengan tautan (misalnya, pemeriksaan pendahuluan). <br><br>  <a href="https://www.viva64.com/ru/w/v3066/">V3066</a> [CWE-683] Kemungkinan urutan argumen yang salah diteruskan ke metode 'Atan2': 'diff.X' dan 'diff.Y'.  SliderBall.cs 182 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateProgress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> completionProgress</span></span></span><span class="hljs-function">)</span></span> { .... Rotation = <span class="hljs-number"><span class="hljs-number">-90</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(-Math.Atan2(diff.X, diff.Y) * <span class="hljs-number"><span class="hljs-number">180</span></span> / Math.PI); .... }</code> </pre> <br>  Penganalisa menduga bahwa ketika bekerja dengan metode <i>Atan2</i> dari kelas <i>Matematika</i> , pengembang mencampur urutan argumen.  <i>Atan2 Ad</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Parameters: // y: // The y coordinate of a point. // // x: // The x coordinate of a point. public static double Atan2(double y, double x);</span></span></code> </pre> <br>  Seperti yang Anda lihat, nilai-nilai ditransfer dalam urutan terbalik.  Saya tidak dapat menilai apakah ini kesalahan, karena metode <i>UpdateProgress</i> berisi banyak perhitungan nontrivial.  Saya hanya mencatat fakta kemungkinan masalah dalam kode. <br><br>  <a href="https://www.viva64.com/ru/w/v3080/">V3080</a> [CWE-476] Kemungkinan null dereference.  Pertimbangkan untuk memeriksa 'Beatmap'.  WorkingBeatmap.cs 57 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Track </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVirtualTrack</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastObject = Beatmap.HitObjects.LastOrDefault(); .... }</code> </pre> <br>  Penganalisa menunjukkan bahaya akses melalui tautan null <i>Beatmap</i> .  Ini dia apa adanya: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IBeatmap Beatmap { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LoadBeatmapAsync().Result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (TaskCanceledException) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  Nah, alat analisa itu benar. <br><br>  Untuk informasi lebih lanjut tentang bagaimana PVS-Studio menemukan kesalahan seperti itu, serta tentang inovasi C # 8.0 yang terkait dengan topik yang serupa (bekerja dengan referensi yang berpotensi nol), lihat artikel " <a href="https://www.viva64.com/ru/b/0631/">Jenis Referensi yang Tidak Dapat Diperbolehkan dalam C # 8.0 dan Analisis Statis</a> ". <br><br>  <a href="https://www.viva64.com/ru/w/v3083/">V3083</a> [CWE-367] Doa yang tidak aman dari acara 'ObjectConverted', NullReferenceException dimungkinkan.  Pertimbangkan menugaskan acara ke variabel lokal sebelum menjalankannya.  BeatmapConverter.cs 82 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertHitObjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ObjectConverted != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { converted = converted.ToList(); ObjectConverted.Invoke(obj, converted); } .... }</code> </pre> <br>  Kesalahan yang tidak kritis dan sangat umum.  Antara memeriksa acara untuk <i>null</i> dan permintaannya, mereka dapat berhenti berlangganan dari acara tersebut, yang akan menyebabkan program macet. <br>  Salah satu perbaikannya: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertHitObjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... converted = converted.ToList(); ObjectConverted?.Invoke(obj, converted); .... }</code> </pre> <br>  <a href="https://www.viva64.com/ru/w/v3095/">V3095</a> [CWE-476] Objek 'kolom' digunakan sebelum diverifikasi terhadap nol.  Periksa baris: 141, 142. SquareGraph.cs 141 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redrawProgress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ColumnCount; i++) columns[i].State = i &lt;= progress ? ColumnState.Lit : ColumnState.Dimmed; columns?.ForceRedraw(); }</code> </pre> <br>  Tidak aman untuk mem-bypass koleksi <i>kolom</i> dalam satu lingkaran.  Pada saat yang sama, pengembang mengasumsikan bahwa tautan <i>kolom</i> mungkin nol, karena nanti dalam kode, operator akses bersyarat digunakan untuk mengakses koleksi. <br><br>  <a href="https://www.viva64.com/ru/w/v3119/">V3119</a> Memanggil acara yang diganti 'OnNewResult' dapat menyebabkan perilaku yang tidak dapat diprediksi.  Pertimbangkan untuk menerapkan pengakses acara secara eksplisit atau gunakan kata kunci 'tersegel'.  DrawableRuleset.cs 256 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHitObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TObject hitObject</span></span></span><span class="hljs-function">)</span></span> { .... drawableObject.OnNewResult += (_, r) =&gt; OnNewResult?.Invoke(r); .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action&lt;JudgementResult&gt; OnNewResult;</code> </pre> <br>  Penganalisa memperingatkan bahaya menggunakan acara yang ditimpa atau virtual.  Apa sebenarnya bahayanya - saya sarankan membaca dalam <a href="https://www.viva64.com/ru/w/v3119/">deskripsi</a> untuk diagnosis.  Juga, pada suatu waktu saya menulis artikel tentang topik ini, " <a href="https://www.viva64.com/ru/b/0453/">Acara Virtual di C #: Ada yang salah</a> ." <br><br>  Konstruk serupa lainnya yang tidak aman dalam kode: <br><br><ul><li>  V3119 Memanggil acara yang diganti dapat menyebabkan perilaku yang tidak terduga.  Pertimbangkan untuk menerapkan pengakses acara secara eksplisit atau gunakan kata kunci 'tersegel'.  DrawableRuleset.cs 257 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v3123/">V3123</a> [CWE-783] Mungkin '??'  Operator bekerja dengan cara yang berbeda dari yang diharapkan.  Prioritasnya lebih rendah daripada prioritas operator lain di bagian kirinya.  OsuScreenStack.cs 45 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onScreenChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IScreen prev, IScreen next</span></span></span><span class="hljs-function">)</span></span> { parallaxContainer.ParallaxAmount = ParallaxContainer.DEFAULT_PARALLAX_AMOUNT * ((IOsuScreen)next)?.BackgroundParallaxAmount ?? <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; }</code> </pre> <br>  Untuk pemahaman yang lebih baik tentang masalah ini - saya akan memberikan contoh sintetis tentang bagaimana kode bekerja sekarang: <br><br><pre> <code class="cs hljs">x = (c * a) ?? b;</code> </pre> <br>  Kesalahan dibuat karena fakta bahwa * operator memiliki prioritas lebih tinggi daripada operator.  Versi kode yang diperbaiki (tanda kurung ditambahkan): <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onScreenChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IScreen prev, IScreen next</span></span></span><span class="hljs-function">)</span></span> { parallaxContainer.ParallaxAmount = ParallaxContainer.DEFAULT_PARALLAX_AMOUNT * (((IOsuScreen)next)?.BackgroundParallaxAmount ?? <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); }</code> </pre> <br>  Kesalahan serupa lainnya dalam kode: <br><br>  <a href="https://www.viva64.com/ru/w/v3123/">V3123</a> [CWE-783] Mungkin '??'  Operator bekerja dengan cara yang berbeda dari yang diharapkan.  Prioritasnya lebih rendah daripada prioritas operator lain di bagian kirinya.  FramedReplayInputHandler.cs 103 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> inImportantSection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsImportant(frame) &amp;&amp; Math.Abs(CurrentTime - NextFrame?.Time ?? <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;= AllowedImportantTimeSpan; } }</code> </pre> <br>  Di sini, seperti pada fragmen kode sebelumnya, prioritas operator tidak diperhitungkan.  Sekarang ekspresi yang diteruskan ke metode <i>Math.Abs</i> dievaluasi sebagai berikut: <br><br><pre> <code class="cs hljs">(a ‚Äì b) ?? <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  Kode yang diperbaiki: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> inImportantSection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsImportant(frame) &amp;&amp; Math.Abs(CurrentTime ‚Äì (NextFrame?.Time ?? <span class="hljs-number"><span class="hljs-number">0</span></span>)) &lt;= AllowedImportantTimeSpan; } }</code> </pre> <br>  <a href="https://www.viva64.com/ru/w/v3142/">V3142</a> [CWE-561] Kode tidak terjangkau terdeteksi.  Mungkin saja ada kesalahan.  DrawableHoldNote.cs 214 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPressed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ManiaAction action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnPressed(action)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Result.Type == HitResult.Miss) <span class="hljs-comment"><span class="hljs-comment">// &lt;= holdNote.hasBroken = true; .... }</span></span></code> </pre> <br>  Penganalisa mengklaim bahwa <i>kode</i> handler <i>OnPressed</i> , dimulai dengan <i>pernyataan if</i> kedua, tidak dapat dijangkau.  Ini mengikuti dari asumsi bahwa kondisi pertama selalu benar, yaitu basis. Metode yang <i>ditekan akan</i> selalu kembali <i>salah</i> .  <i>Lihatlah basisnya.</i> Metode yang <i>ditekan</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPressed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ManiaAction action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action != Action.Value) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UpdateResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  Kami melanjutkan ke metode <i>UpdateResult</i> : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userTriggered</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Time.Elapsed &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Judged) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Judged; }</code> </pre> <br>  Perhatikan bahwa implementasi properti yang <i>dinilai</i> tidak penting di sini, karena logika metode <i>UpdateResult</i> menyiratkan bahwa <i>pernyataan pengembalian</i> terakhir setara dengan ini: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>  Dengan demikian, metode <i>UpdateResult akan</i> selalu mengembalikan <i>false</i> , yang akan menyebabkan kesalahan dengan kode yang tidak terjangkau dalam kode di atas tumpukan. <br><br>  <a href="https://www.viva64.com/ru/w/v3146/">V3146</a> [CWE-476] Kemungkinan null dereference dari 'ruleset'.  'FirstOrDefault' dapat mengembalikan nilai nol default.  APILegacyScoreInfo.cs 24 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ScoreInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateScoreInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RulesetStore rulesets</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ruleset = rulesets.GetRuleset(OnlineRulesetID); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mods = Mods != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? ruleset.CreateInstance() <span class="hljs-comment"><span class="hljs-comment">// &lt;= .GetAllMods().Where(....) .ToArray() : Array.Empty&lt;Mod&gt;(); .... }</span></span></code> </pre> <br>  Penganalisa menganggap panggilan <i>ruleset.CreateInstance ()</i> tidak aman.  Variabel <i>ruleset</i> sebelumnya mendapatkan nilai sebagai hasil dari memanggil <i>GetRuleset</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RulesetInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRuleset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> =&gt; AvailableRulesets.FirstOrDefault(....);</code> </pre> <br>  Seperti yang Anda lihat, peringatan penganalisa dibenarkan, karena rantai panggilan berisi <i>FirstOrDefault</i> , yang dapat mengembalikan <i>nol</i> . <br><br><h2>  Kesimpulan </h2><br>  Secara umum, proyek game "osu!" Senang dengan sejumlah kecil kesalahan.  Namun demikian, saya merekomendasikan pengembang untuk memperhatikan masalah yang terdeteksi.  Dan biarkan game terus menyenangkan para penggemarnya. <br><br>  Dan bagi mereka yang suka menggali kode, saya mengingatkan Anda bahwa penganalisa PVS-Studio, yang mudah <a href="https://www.viva64.com/ru/pvs-studio-download/">diunduh</a> dari situs resmi, akan sangat membantu.  Saya juga mencatat bahwa pemeriksaan proyek satu kali, seperti yang dijelaskan di atas, tidak ada hubungannya dengan menggunakan penganalisa statis dalam pekerjaan nyata.  Efisiensi maksimum dalam memerangi kesalahan hanya dapat dicapai dengan menggunakan alat secara rutin baik pada server build maupun langsung di komputer pengembang (analisis tambahan).  Tujuan maksimum adalah untuk mencegah kesalahan memasuki sistem kontrol versi, memperbaiki kerusakan sudah pada tahap penulisan kode. <br><br>  Semoga sukses dan sukses! <br><br><h2>  Referensi </h2><br>  Ini adalah publikasi pertama pada tahun 2020.  Mengambil kesempatan ini, saya akan memberikan tautan ke artikel tentang memeriksa proyek C # tahun lalu: <br><br><ul><li>  <a href="https://www.viva64.com/ru/b/0605/">Mencari bug di Amazon Web Services SDK untuk kode sumber .NET</a> </li><li>  <a href="https://www.viva64.com/ru/b/0622/">Memeriksa kode sumber Roslyn</a> </li><li>  <a href="https://www.viva64.com/ru/b/0631/">Jenis Referensi Nullable dalam C # 8.0 dan Analisis Statis</a> </li><li>  <a href="https://www.viva64.com/ru/b/0653/">WinForms: Kesalahan, Holmes</a> </li><li>  <a href="https://www.viva64.com/ru/b/0654/">Kisah bagaimana PVS-Studio menemukan kesalahan di perpustakaan yang digunakan di ... PVS-Studio</a> </li><li>  <a href="https://www.viva64.com/ru/b/0656/">Verifikasi kode sumber pustaka .NET Core oleh penganalisa statis PVS-Studio</a> </li><li>  <a href="https://www.viva64.com/ru/b/0664/">Memeriksa analis Roslyn</a> </li><li>  <a href="https://www.viva64.com/ru/b/0677/">Periksa Telerik UI untuk UWP untuk berkenalan dengan PVS-Studio</a> </li><li>  <a href="https://www.viva64.com/ru/b/0678/">Azure PowerShell: "kebanyakan tidak berbahaya"</a> </li><li>  <a href="https://www.viva64.com/ru/b/0681/">Kami mencari dan menganalisis kesalahan dalam kode CMS Orchard</a> </li><li>  <a href="https://www.viva64.com/ru/b/0683/">Memeriksa bungkus OpenCvSharp melalui OpenCV dengan PVS-Studio</a> </li><li>  <a href="https://www.viva64.com/ru/b/0692/">Azure SDK untuk .NET: Kisah Pencari Bug yang Sulit</a> </li><li>  <a href="https://www.viva64.com/ru/b/0694/">SARIF SDK dan kesalahannya</a> </li><li>  <a href="https://www.viva64.com/ru/b/0698/">10 bug teratas dalam proyek C # untuk 2019</a> </li></ul><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/483436/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Sergey Khrenov.  <a href="https://habr.com/en/company/pvs-studio/blog/483436/">Mainkan "osu!", But Watch Out for Bugs</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id483438/">https://habr.com/ru/post/id483438/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id483418/index.html">Sistem tiket: bagaimana Anda mendapatkan tiga OTRS gratis dibayar?</a></li>
<li><a href="../id483424/index.html">DBA: mentransfer nilai SEQUENCE antara database PostgreSQL</a></li>
<li><a href="../id483426/index.html">Survei Tab Jumat</a></li>
<li><a href="../id483428/index.html">Apa yang akan menjadi manajemen dokumen elektronik setelah berlakunya amandemen undang-undang tentang tanda tangan elektronik?</a></li>
<li><a href="../id483436/index.html">Mainkan "osu!", But Watch Out for Bugs</a></li>
<li><a href="../id483440/index.html">Kompiler D Terbaru</a></li>
<li><a href="../id483444/index.html">Laporan DORA 2019: Cara Meningkatkan Kinerja DevOps</a></li>
<li><a href="../id483446/index.html">Para ilmuwan telah menemukan cara baru untuk menurunkan kadar zat besi dalam air minum</a></li>
<li><a href="../id483448/index.html">Disney - Dua Arah Terhebat dalam Sejarah Manusia</a></li>
<li><a href="../id483454/index.html">Beralih dari Mercurial ke GIT di Atlassian Bitbucket dengan menyimpan file dalam Cyrillic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>