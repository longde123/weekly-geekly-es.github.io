<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ï üò≤ üèáüèæ Python-Test mit Pytest. Plugins KAPITEL 5 üöá üê• ‚ò†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zur√ºck Weiter 


 Pytest ist sofort leistungsstark genug und wird noch besser, wenn Sie eine Mischung aus Plugins hinzuf√ºgen. Die Pytest-Codebasis ist...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Python-Test mit Pytest. Plugins KAPITEL 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448794/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zur√ºck</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weiter</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Pytest ist sofort leistungsstark genug und wird noch besser, wenn Sie eine Mischung aus Plugins hinzuf√ºgen.</em>  <em>Die Pytest-Codebasis ist nach Einstellungen und Erweiterungen strukturiert, und es stehen Hooks zur Verf√ºgung, die √ºber Plugins ge√§ndert und verbessert werden k√∂nnen.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Die Beispiele in diesem Buch wurden mit Python 3.6 und pytest 3.2 geschrieben.  pytest 3.2 unterst√ºtzt Python 2.6, 2.7 und Python 3.3+. </p><br><blockquote>  Der Quellcode f√ºr das Aufgabenprojekt sowie f√ºr alle in diesem Buch gezeigten Tests ist unter dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">Link</a> auf der Webseite des Buches unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com verf√ºgbar</a> .  Sie m√ºssen den Quellcode nicht herunterladen, um den Testcode zu verstehen.  Der Testcode wird in den Beispielen in einer praktischen Form dargestellt.  Um jedoch die Aufgaben des Projekts zu verfolgen oder Testbeispiele anzupassen, um Ihr eigenes Projekt zu testen (Ihre H√§nde sind losgebunden!), M√ºssen Sie auf die Webseite des Buches gehen und die Arbeit herunterladen.  Dort, auf der Webseite des Buches, gibt es einen Link f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="https://pragprog.com/titles/bopytest/errata">Errata-</a> Nachrichten und ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="https://forums.pragprog.com/forums/438">Diskussionsforum</a> . </blockquote><p>  Unter dem Spoiler befindet sich eine Liste der Artikel dieser Reihe. </p><br><div class="spoiler">  <b class="spoiler_title">Inhaltsverzeichnis</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Einf√ºhrung</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 1: Erste Schritte mit Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 2: Schreiben von Testfunktionen</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 3: Pytest-Vorrichtungen</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 4: Eingebaute Vorrichtungen</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 5: Plugins</strong></a> (Dieser Artikel) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 6: Konfiguration</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Kapitel 7: Verwenden von pytest mit anderen Tools</strong></a> </li></ul></div></div><br><h2 id="poehali-dalshe">  Lass uns weiter gehen! </h2><br><p> Es kann Sie √ºberraschen, dass Sie bereits einige Plugins geschrieben haben, wenn Sie die vorherigen Kapitel in diesem Buch durchgearbeitet haben.  Jedes Mal, wenn Sie Fixtures und / oder Hook-Funktionen in die Datei <code>conftest.py</code> der obersten Ebene des Projekts <code>conftest.py</code> , erstellen Sie ein lokales <code>conftest</code> Plugin.  Es ist nur ein wenig zus√§tzliche Arbeit, diese <code>conftest.py</code> Dateien in installierbare Plugins zu konvertieren, die Sie zwischen Projekten, mit anderen Menschen oder mit der Welt teilen k√∂nnen. </p><br><p>  Wir beginnen dieses Kapitel mit der Beantwortung der Frage, wo nach Plugins von Drittanbietern gesucht werden soll.  Es sind nicht wenige Plugins verf√ºgbar, daher besteht eine gute Chance, dass bereits jemand die √Ñnderungen geschrieben hat, die Sie in <code>pytest</code> vornehmen <code>pytest</code> .  Da wir Open Source-Plugins in Betracht ziehen, k√∂nnen Sie das Plugin, wenn es fast das tut, was Sie wollen, aber nicht ganz, entwickeln oder als Referenz verwenden, um Ihr eigenes Plugin zu erstellen.  Obwohl es in diesem Kapitel darum geht, eigene Plugins zu erstellen, ist Anhang 3, das <em>Sampler Pack-</em> Plugin, auf Seite 163 enthalten, um Ihnen einen Eindruck davon zu geben, was m√∂glich ist. </p><br><p>  In diesem Kapitel erfahren Sie, wie Sie Plugins erstellen, und ich zeige Ihnen die richtige Richtung f√ºr das Testen, Verpacken und Verteilen.  Das vollst√§ndige Thema der Python-Verpackung und -Distribution ist zu umfangreich und behauptet, ein eigenes Buch zu sein, sodass wir nicht alles behandeln werden.  Sie erhalten jedoch gen√ºgend Informationen, um Plugins mit Ihrem Team austauschen zu k√∂nnen.  Ich werde auch √ºber einige einfache M√∂glichkeiten sprechen, Plugins mit PyPI-Unterst√ºtzung und dem geringsten Arbeitsaufwand zu erstellen. </p><br><h2 id="poisk-plaginov">  Plugins suchen </h2><br><p>  Sie k√∂nnen Pytest-Plugins von Drittanbietern an mehreren Stellen finden.  Die in Anhang 3, Plugin Sampler Pack, auf Seite 163 aufgef√ºhrten Plugins k√∂nnen von PyPI heruntergeladen werden.  Dies ist jedoch nicht der einzige Ort, an dem Sie gro√üartige Pytest-Plugins finden. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://docs.pytest.org/en/latest/plugins.html</a> </p><br><p>  Die Hauptdokumentationsseite f√ºr pytest enth√§lt eine Seite, auf der die Installation und Verwendung von pytest-Plugins beschrieben und einige g√§ngige Plugins aufgelistet werden. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://pypi.python.org</a> </p><br><p>  Der Python Package Index (PyPI) ist ein gro√üartiger Ort, um viele Python-Pakete zu erhalten, aber auch ein gro√üartiger Ort, um nach Pytest-Plugins zu suchen.  Wenn Sie nach Pytest-Plugins suchen, geben Sie einfach "pytest", "pytest -" oder "-pytest" in das Suchfeld ein, da die meisten Pytest-Plugins entweder mit "pytest -" beginnen oder mit "-pytest" enden. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/pytest-dev</a> </p><br><p>  In der pytest-dev-Gruppe auf GitHub wird der pytest-Quellcode gespeichert.  Dar√ºber hinaus finden Sie hier beliebte Pytest-Plugins, die langfristig vom Pytest-Kernel-Team unterst√ºtzt werden sollten. </p><br><h2 id="ustanovka-plaginov">  Plugin Installation </h2><br><p>  Pytest-Plugins werden wie andere Python-Pakete mit pip installiert.  Allerdings <br>  Sie k√∂nnen pip auf verschiedene Arten verwenden, um Plugins zu installieren. </p><br><h3 id="ustanovka-iz-pypi">  Von PyPI installieren </h3><br><p>  Da PyPI der Standardspeicherort f√ºr Pip ist, ist die Installation von Plugins von PyPI die einfachste Methode.  Lassen Sie uns das <code>pytest-cov</code> Plugin installieren: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov</code> </pre> <br><p>  Die neueste stabile Version von PyPI wird installiert. </p><br><h3 id="ustanovka-opredelennoy-versii-iz-pypi">  Installieren einer bestimmten Version von PyPI </h3><br><p>  Wenn Sie eine bestimmte Version des Plugins m√∂chten, k√∂nnen Sie die Version nach <code>==</code> angeben: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-fayla-targz-ili-whl">  Installation von einer .tar.gz- oder .whl-Datei </h3><br><p>  PyPI-Pakete werden als Zip-Dateien mit den Erweiterungen <code>.tar.gz</code> und / oder <code>.whl</code> .  Sie werden oft als Teerkugeln und R√§der bezeichnet.  Wenn Sie Probleme haben, direkt mit PyPI zu arbeiten (was bei Firewalls und anderen Netzwerkkomplikationen auftreten kann), k√∂nnen Sie entweder <code>.tar.gz</code> oder <code>.whl</code> und von diesem oder jenem installieren. </p><br><p>  Sie m√ºssen nicht mit einem Tamburin auspacken oder tanzen.  Zeigen Sie einfach mit Pip darauf: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov-2.4.0.tar.gz # or $ pip install pytest_cov-2.4.0-py2.py3-none-any.whl</code> </pre> <br><h3 id="ustanovka-iz-lokalnogo-kataloga">  Installation aus dem lokalen Verzeichnis </h3><br><p>  Sie k√∂nnen die Plugins f√ºr Plugins (und andere Python-Pakete) in einem lokalen oder freigegebenen Verzeichnis im <code>.whl</code> <code>.tar.gz</code> oder <code>.whl</code> und dieses anstelle von PyPI verwenden, um Plugins zu installieren: </p><br><pre> <code class="plaintext hljs">$ mkdir some_plugins $ cp pytest_cov-2.4.0-py2.py3-none-any.whl some_plugins/ $ pip install --no-index --find-links=./some_plugins/ pytest-cov</code> </pre> <br><p>  <code>--no-index</code> weist <code>pip</code> keine Verbindung zu PyPI herzustellen.  <code>--find-links=./some_plugins/</code> weist pip an, im Verzeichnis <code>some_plugins</code> .  Diese Methode ist besonders n√ºtzlich, wenn Sie sowohl Plugins von Drittanbietern als auch Ihre eigenen Plugins lokal gespeichert haben sowie wenn Sie neue virtuelle Umgebungen f√ºr die kontinuierliche Integration oder mit tox erstellen.  (Wir werden in Kapitel 7 √ºber Tox und kontinuierliche Integration sprechen, wobei Pytest mit anderen Tools verwendet wird, auf Seite 125.) </p><br><p>  Bitte beachten Sie, dass Sie mit der Installationsmethode f√ºr das lokale Verzeichnis mehrere Versionen installieren und angeben k√∂nnen, welche Version Sie m√∂chten, indem Sie == und die Versionsnummer hinzuf√ºgen: </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links=./some_plugins/ pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-repozitoriya-git">  Installation aus dem Git-Repository </h3><br><p>  Sie k√∂nnen Plugins in diesem Fall direkt aus dem Git-Repository installieren. GitHub: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov</code> </pre> <br><p>  Sie k√∂nnen auch das Versions-Tag angeben: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@v2.4.0</code> </pre> <br><p>  Oder Sie k√∂nnen einen Zweig angeben: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@master</code> </pre> <br><p>  Die Installation aus dem Git-Repository ist besonders n√ºtzlich, wenn Sie Ihre eigene Arbeit in Git speichern oder wenn die erforderliche Version des Plugins oder Plugins in PyPI fehlt. </p><br><blockquote>  <em>Anmerkung des √úbersetzers:</em> <br><br>  pip unterst√ºtzt die Installation von Git, Mercurial, Subversion und Bazaar und definiert den VCS-Typ mithilfe der URL-Pr√§fixe: "git +", "hg +", "svn +", "bzr +". <br>  Weitere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Informationen finden</a> Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PyPI-Dokumentation</a> . </blockquote><br><h2 id="napisanie-sobstvennyh-plaginov">  Schreiben Sie Ihre eigenen Plugins </h2><br><p>  Viele Plugins von Drittanbietern enthalten viel Code.  Dies ist einer der Gr√ºnde, warum wir sie verwenden, um uns Zeit zu sparen, all dies selbst zu entwickeln.  F√ºr Ihren spezifischen Code werden Sie jedoch zweifellos spezielle Vorrichtungen und Modifikationen finden, die Ihnen beim Testen helfen.  Durch das Erstellen eines Plugins k√∂nnen Sie problemlos mehrere Ger√§te freigeben, die Sie f√ºr mehrere Projekte freigeben m√∂chten.  Sie k√∂nnen diese √Ñnderungen mit mehreren Projekten - und m√∂glicherweise mit dem Rest der Welt - teilen, indem Sie Ihre eigenen Plugins entwickeln und verteilen.  Das ist ziemlich einfach.  In diesem Abschnitt werden wir eine kleine Modifikation des Pytest-Verhaltens entwickeln, es als Plugin verpacken, testen und √ºberlegen, wie es verteilt werden soll. </p><br><p>  Plugins k√∂nnen Hook-Funktionen enthalten, die das Verhalten von pytest √§ndern.  Da pytest so konzipiert wurde, dass Plugins das Verhalten von pytest geringf√ºgig √§ndern k√∂nnen, stehen viele Hook-Funktionen zur Verf√ºgung.  Hooks f√ºr Pytest sind auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Pytest-Dokumentationsseite aufgef√ºhrt</a> .  In unserem Beispiel erstellen wir ein Plugin, das das Erscheinungsbild des Teststatus √§ndert.  F√ºgen Sie einen Befehlszeilenparameter hinzu, um dieses neue Verhalten zu aktivieren.  F√ºgen Sie dem Ausgabekopf Text hinzu.  Insbesondere werden wir alle Statusindikatoren FAILED (fehlgeschlagen) in "OPPORTUNITY (prospektiv) f√ºr Verbesserungen" √§ndern, F in O √§ndern und dem Header "Danke, dass Sie die Tests ausgef√ºhrt haben" hinzuf√ºgen.  Dazu verwenden wir die Option <code>--nice</code> . </p><br><p>  Um die Verhaltens√§nderungen von der Diskussion der Plugin-Mechanik zu trennen, werden wir √Ñnderungen an conftest.py vornehmen, bevor wir es in ein weiterverteilbares Plugin verwandeln.  Sie m√ºssen keine Plugins auf diese Weise ausf√ºhren.  Aber oft sind die √Ñnderungen, die Sie in nur einem Projekt verwenden wollten, n√ºtzlich genug, um sie zu teilen und in ein Plugin umzuwandeln.  Daher f√ºgen wir der Datei conftest.py zun√§chst Funktionen hinzu, und nachdem alles in conftest.py funktioniert hat, verschieben wir den Code in das Paket. </p><br><p>  Zur√ºck zum Aufgabenprojekt.  Im Abschnitt ‚ÄûWarten auf Ausnahmen‚Äú auf Seite 30 haben wir mehrere Tests geschrieben, in denen √ºberpr√ºft wurde, ob Ausnahmen ausgel√∂st wurden, wenn jemand die API-Funktion falsch aufgerufen hat.  Es sieht so aus, als h√§tten wir zumindest einige m√∂gliche Fehlerzust√§nde √ºbersehen. </p><br><p>  Hier noch ein paar Tests: </p><br><blockquote>  <strong>ch5 / a / task_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""     API wrong."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task @pytest.mark.usefixtures(<span class="hljs-string"><span class="hljs-string">'tasks_db'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestAdd</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""",   tasks.add()."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_missing_summary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  summary missing."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(owner=<span class="hljs-string"><span class="hljs-string">'bob'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_done_not_bool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  done   bool."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(summary=<span class="hljs-string"><span class="hljs-string">'summary'</span></span>, done=<span class="hljs-string"><span class="hljs-string">'True'</span></span>))</code> </pre><br><p>  Lassen Sie uns sie ausf√ºhren, um zu √ºberpr√ºfen, ob sie bestanden haben: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/a/tasks_proj $ pytest ===================== test session starts ====================== collected 57 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py .F....... tests/func/test_unique_id.py . tests/unit/test_task.py .... =========================== FAILURES =========================== __________________ TestAdd.test_done_not_bool __________________ self = &lt;func.test_api_exceptions.TestAdd object at 0x103a71a20&gt; def test_done_not_bool(self): """Should raise an exception if done is not a bool.""" with pytest.raises(ValueError): &gt; tasks.add(Task(summary='summary', done='True')) E Failed: DID NOT RAISE &lt;class 'ValueError'&gt; tests/func/test_api_exceptions.py:20: Failed ============= 1 failed, 56 passed in 0.28 seconds ==============</code> </pre><br><p>  Lassen Sie es uns noch einmal mit <code>-v</code> ausf√ºhren, um Details zu <code>-v</code> .  Da Sie den Trace bereits gesehen haben, k√∂nnen Sie ihn durch Dr√ºcken von <code>--tb=no</code> . </p><br><p>  Konzentrieren wir uns nun auf die neuen Tests mit <code>-k TestAdd</code> , was funktioniert, da es keine anderen Tests mit Namen gibt, die "TestAdd" enthalten. </p><br><p>  Wir k√∂nnten "alles fallen lassen" und versuchen, diesen Test zu beheben (und wir werden es sp√§ter tun), aber jetzt werden wir uns darauf konzentrieren, Fehler f√ºr Entwickler angenehmer zu machen. </p><br><p>  Beginnen wir mit dem Hinzuf√ºgen einer Dankesnachricht zum Header, die Sie mit einem Pytest-Hook namens <code>pytest_report_header()</code> . </p><br><blockquote>  <strong>ch5 / b / task_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span></code> </pre> <br><p>  Offensichtlich ist es ziemlich dumm, einen Dankesbrief zu schreiben.  Die M√∂glichkeit, Informationen zum Header hinzuzuf√ºgen, kann jedoch erweitert werden.  Sie k√∂nnen einen Benutzernamen hinzuf√ºgen, das verwendete Ger√§t und die zu testenden Versionen angeben.  Im Allgemeinen kann alles, was Sie in eine Zeichenfolge konvertieren k√∂nnen, in den Titel des Tests eingef√ºgt werden. </p><br><p>  Dann √§ndern wir den Teststatusbericht, um <code>F</code> in <code>O</code> und <code>FAILED</code> in <code>OPPORTUNITY for improvement</code> zu √§ndern.  Es gibt einen Hook, der diese Angelegenheit erlaubt: <code>pytest_report_teststatus()</code> : </p><br><blockquote>  <strong>ch5 / b / task_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> report.failed: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  Und jetzt haben wir genau die L√∂sung, nach der wir gesucht haben.  Eine <code>--verbose</code> ohne das Flag <code>--verbose</code> zeigt <code>O</code> f√ºr Fehler an, <code>--verbose</code> Verbesserungen sind m√∂glich: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/b/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Mit dem Flag <code>-v</code> oder <code>--verbose</code> w√§re besser: </p><br><pre> <code class="plaintext hljs">$ pytest -v --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  Die letzte √Ñnderung, die wir vornehmen werden, besteht darin, den Befehlszeilenparameter <code>--nice,</code> damit √Ñnderungen in unserem Status nur auftreten, wenn Sie <code>--nice</code> : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn failures into opportunities"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre><br><p>  Es ist erw√§hnenswert, dass wir f√ºr dieses Plugin nur ein paar Hooks verwenden.  Es gibt viele andere, die auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hauptdokumentationsseite von Pytest</a> zu finden sind. </p><br><p>  Jetzt k√∂nnen wir unser Plugin manuell testen, indem wir es in unserem Beispiel einfach ausf√ºhren.  <code>--nice</code> ohne die Option <code>--nice</code> sicher, dass nur der Benutzername angezeigt wird: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/c/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== collected 9 items test_api_exceptions.py .F ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre><br><p>  Jetzt mit <code>--nice</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  Jetzt mit <code>--nice</code> und <code>--verbose</code> : </p><br><pre> <code class="plaintext hljs">$ pytest -v --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Gro√üartig!  Alle √Ñnderungen, die wir vornehmen wollten, wurden in etwa zehn Codezeilen f√ºr die Datei <code>conftest.py</code> .  Als n√§chstes werden wir diesen Code in die Plugin-Struktur verschieben. </p><br><h2 id="sozdanie-ustanavlivaemogo-plagina">  Erstellen eines installierbaren Plugins </h2><br><p>  Der Prozess des Teilens von Plugins mit anderen Benutzern ist klar definiert.  Selbst wenn Sie niemals Ihr eigenes Plugin in PyPI einbinden, wird es Ihnen durch diesen Vorgang leichter fallen, den Code aus den Open Source-Plugins zu lesen, und Sie haben mehr M√∂glichkeiten zu bewerten, ob sie Ihnen helfen oder nicht. </p><br><p>  Es w√§re √ºberfl√ºssig, die Verpackung und Verteilung von Python-Paketen in diesem Buch vollst√§ndig zu behandeln, da dieses Thema an anderer Stelle gut dokumentiert ist.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> auf Russisch.  Es ist jedoch keine gro√üe Sache, vom lokalen Konfigurations-Plug-In, das wir im vorherigen Abschnitt erstellt haben, zu etwas zu wechseln, das mit pip installiert wurde.  , </p><br><p>  Zuerst m√ºssen wir ein neues Verzeichnis erstellen, um unseren Plugin-Code zu hosten.  Es spielt keine Rolle, wie Sie es nennen, aber da wir ein Plugin f√ºr die nette Flagge erstellen, nennen wir es pytest-nice.  Wir werden zwei Dateien in diesem neuen Verzeichnis haben: pytest_nice.py und setup.py.  (Der Testkatalog wird im Abschnitt ‚ÄûTest-Plugins‚Äú auf Seite 105 erl√§utert.) </p><br><pre> <code class="plaintext hljs">‚îÇ LICENSE ‚îÇ pytest_nice.py ‚îÇ setup.py ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ test_nice.py</code> </pre><br><p>  In <code>pytest_nice.py</code> wir den genauen Inhalt unserer conftest.py ein, der dieser Funktion zugeordnet war (und extrahieren ihn aus <code>tasks_proj/tests/conftest.py</code> ): </p><br><p>  <strong>ch5 / pytest-nice / pytest_nice.py</strong> </p><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""  pytest-nice ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn FAILED into OPPORTUNITY for improvement"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  In <code>setup.py</code> ben√∂tigen wir den minimalsten Aufruf von <code>setup()</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / setup.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Setup  pytest-nice plugin."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> setuptools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup setup( name=<span class="hljs-string"><span class="hljs-string">'pytest-nice'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'0.1.0'</span></span>, description=<span class="hljs-string"><span class="hljs-string">' Pytest,   FAILURE into OPPORTUNITY'</span></span>, url=<span class="hljs-string"><span class="hljs-string">'https:////////'</span></span>, author=<span class="hljs-string"><span class="hljs-string">' '</span></span>, author_email=<span class="hljs-string"><span class="hljs-string">'your_email@somewhere.com'</span></span>, license=<span class="hljs-string"><span class="hljs-string">'proprietary'</span></span>, py_modules=[<span class="hljs-string"><span class="hljs-string">'pytest_nice'</span></span>], install_requires=[<span class="hljs-string"><span class="hljs-string">'pytest'</span></span>], entry_points={<span class="hljs-string"><span class="hljs-string">'pytest11'</span></span>: [<span class="hljs-string"><span class="hljs-string">'nice = pytest_nice'</span></span>, ], }, )</code> </pre> <br><p>  Sie ben√∂tigen weitere Informationen in den Einstellungen, wenn Sie diese an ein breites Publikum oder im Internet verteilen m√∂chten.  F√ºr ein kleines Team oder nur f√ºr sich selbst ist dies jedoch ausreichend. </p><br><p>  Sie k√∂nnen einige andere Parameter f√ºr <code>setup()</code> angeben.  und hier haben wir nur die erforderlichen Felder.  Das Versionsfeld ist die Version dieses Plugins.  Und es liegt ganz bei Ihnen, wenn Sie die Version aufrufen.  Das URL-Feld ist erforderlich.  Sie k√∂nnen es leer lassen, aber Sie erhalten eine Warnung.  Die <code>author_email</code> <code>author</code> und <code>author_email</code> k√∂nnen durch <code>maintainer</code> und <code>maintainer_email</code> , aber eines dieser Paare sollte vorhanden sein.  Das <code>license</code> ist ein kurzes Textfeld.  Dies kann eine von vielen Open Source-Lizenzen sein, Ihr Name oder Unternehmen oder etwas, das f√ºr Sie geeignet ist.  Der <code>py_modules</code> listet <code>pytest_nice</code> als unser einziges Modul f√ºr dieses Plugin auf.  Obwohl dies eine Liste ist und Sie mehr als ein Modul einschlie√üen k√∂nnen, w√ºrde ich, wenn ich mehr als ein Modul h√§tte, das Paket verwenden und alle Module in einem Verzeichnis ablegen. </p><br><p>  Bisher sind alle <code>setup()</code> -Optionen Standard und werden von allen Python-Installationsprogrammen verwendet.  Der Teil, der sich f√ºr Pytest-Plugins unterscheidet, ist der Parameter <code>entry_points</code> .  Wir haben <code>entry_points={'pytest11': ['nice = pytest_nice', ], },.</code>  Die Funktion <code>entry_points</code> ist Standard f√ºr <code>setuptools</code> , aber pytest11 ist die spezielle Kennung, nach der pytest sucht.  In dieser Zeile teilen wir pytest mit, dass <code>nice</code> der Name unseres Plugins ist und <code>pytest_nice</code> Name des Moduls, in dem unser Plugin lebt.  Wenn wir das Paket verwenden w√ºrden, w√§re unser Eintrag hier: </p><br><p>  Ich habe noch nicht √ºber die Datei <code>README.rst</code> gesprochen.  Eine Form von README ist eine Anforderung von Setuptools.  Wenn Sie es verpassen, erhalten Sie Folgendes: </p><br><pre> <code class="plaintext hljs">... warning: sdist: standard file not found: should have one of README, README.rst, README.txt ...</code> </pre><br><p>  Es ist sowieso eine gute Idee, README als Standardmethode f√ºr einige Projektinformationen beizubehalten.  Folgendes habe ich in die Datei f√ºr pytest-nice eingef√ºgt: </p><br><blockquote>  <strong>ch5 / pytest-nice / README.rst</strong> </blockquote><br><pre> <code class="plaintext hljs">pytest-nice : A pytest plugin =============================   pytest     .  -------- -   ,     pytest. -  ``--nice`` , : -  ``F``  ``O`` -  ``-v``,  ``FAILURE``  ``OPPORTUNITY for improvement``  ------------ ,    Pytest    .tar.gz    PATH,  : :: $ pip install PATH/pytest-nice-0.1.0.tar.gz $ pip install --no-index --find-links PATH pytest-nice  ----- :: $ pytest --nice</code> </pre><br><p>  Es gibt viele Meinungen dar√ºber, was in der README-Datei enthalten sein sollte.  Dies ist eine stark beschnittene Version, aber sie funktioniert. </p><br><h2 id="testirovanie-plaginov">  Plugins testen </h2><br><p>  Plugins sind Code, der wie jeder andere Code getestet werden muss.  Das Testen von √Ñnderungen an einem Testwerkzeug ist jedoch etwas komplizierter.  Als wir den Plugin-Code im Abschnitt ‚ÄûSchreiben eigener Plugins‚Äú auf Seite 98 entwickelten, √ºberpr√ºften wir ihn manuell anhand einer Beispieltestdatei, f√ºhrten pytest damit aus und √ºberpr√ºften die Ausgabe, um sicherzustellen, dass sie korrekt war.  Wir k√∂nnen dasselbe im automatischen Modus mit einem Plugin namens <code>pytester</code> , das mit pytest geliefert wird, aber standardm√§√üig deaktiviert ist. </p><br><p>  In unserem Testverzeichnis befinden sich zwei Dateien f√ºr pytest-nice: <code>conftest.py</code> und <code>test_nice.py</code> .  Um <code>pytester</code> , m√ºssen wir <code>pytester</code> nur eine Zeile <code>conftest.py</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""pytester is needed for testing plugins."""</span></span> pytest_plugins = <span class="hljs-string"><span class="hljs-string">'pytester'</span></span></code> </pre> <br><p>  Diese Zeile enth√§lt das <code>pytester</code> Plugin.  Wir werden ein Ger√§t namens <code>testdir</code> , das verf√ºgbar wird, wenn der <code>pytester</code> . <br>  Oft haben Tests f√ºr Plugins die Form, die wir manuell beschrieben haben: </p><br><ol><li>  Erstellen Sie eine Beispieltestdatei. </li><li>  F√ºhren Sie pytest mit oder ohne Parameter in dem Verzeichnis aus, das die Beispieldatei enth√§lt. </li><li>  √úberpr√ºfen Sie die Ausgabe. </li><li>  M√∂glicherweise ist der Ergebniscode 0 f√ºr alle Durchg√§nge und 1 f√ºr einige Fehler. </li></ol><br><p>  Schauen wir uns ein Beispiel an: </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_pass_fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     Pytest testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) #  pytest result = testdir.runpytest() # fnmatch_lines    result.stdout.fnmatch_lines([ '*.F', # .  Pass, F  Fail ]) # ,      '1'  testsuite assert result.ret == 1</span></span></code> </pre> <br><p>  Fixture <code>testdir</code> erstellt automatisch ein tempor√§res Verzeichnis zum Hosten von Testdateien.  Es verf√ºgt √ºber eine <code>makepyfile()</code> -Methode, mit der Sie den Inhalt einer Testdatei ablegen k√∂nnen. In diesem Fall erstellen wir zwei Tests: einen, <em>der erfolgreich ist,</em> und einen, <em>der nicht erfolgreich ist</em> . </p><br><p>  Wir f√ºhren pytest f√ºr eine neue Testdatei mit <code>testdir.runpytest()</code> .  Sie k√∂nnen Parameter √ºbergeben, wenn Sie m√∂chten.  Der R√ºckgabewert kann sp√§ter ber√ºcksichtigt werden und ist vom Typ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RunResult</a> . </p><br><p>  Normalerweise schaue ich auf <code>stdout</code> und <code>ret</code> .   ,    ,     ,  <code>fnmatch_lines</code> ,   ,      ,   ,  <code>ret</code>  0     1   . ,   <code>fnmatch_lines</code> ,    .        .  ,    ,   : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture() def sample_test(testdir): testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) return testdir</span></span></code> </pre> <br><p> ,   ,    <code>sample_test</code>   ,       .      : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_with_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'*.O'</span></span>, ]) <span class="hljs-comment"><span class="hljs-comment"># . for Pass, O for Fail assert result.ret == 1 def test_with_nice_verbose(sample_test): result = sample_test.runpytest('-v', '--nice') result.stdout.fnmatch_lines([ '*::test_fail OPPORTUNITY for improvement', ]) assert result.ret == 1 def test_not_nice_verbose(sample_test): result = sample_test.runpytest('-v') result.stdout.fnmatch_lines(['*::test_fail FAILED']) assert result.ret == 1</span></span></code> </pre> <br><p>     .  ,       : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header_not_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest() thanks_message = <span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> thanks_message <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result.stdout.str()</code> </pre><br><p>       ,        ,      . </p><br><p>    : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_help_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> result = testdir.runpytest(<span class="hljs-string"><span class="hljs-string">'--help'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># fnmatch_lines    result.stdout.fnmatch_lines([ 'nice:', '*--nice*nice: turn FAILED into OPPORTUNITY for improvement', ])</span></span></code> </pre> <br><p>  ,     , ,    . </p><br><p>         <code>pytest-nice</code>  ,    .       <code>.zip.gz</code> ,       : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice/ $ pip install . Processing /path/to/code/ch5/pytest-nice Requirement already satisfied: pytest in /path/to/venv/lib/python3.6/site-packages (from pytest-nice==0.1.0) Requirement already satisfied: py&gt;=1.4.33 in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Requirement already satisfied: setuptools in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Building wheels for collected packages: pytest-nice Running setup.py bdist_wheel for pytest-nice ... done ... Successfully built pytest-nice Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p> ,   ,   : </p><br><pre> <code class="plaintext hljs">$ pytest -v ===================== test session starts ====================== plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED tests/test_nice.py::test_with_nice PASSED tests/test_nice.py::test_with_nice_verbose PASSED tests/test_nice.py::test_not_nice_verbose PASSED tests/test_nice.py::test_header PASSED tests/test_nice.py::test_header_not_nice PASSED tests/test_nice.py::test_help_message PASSED =================== 7 passed in 0.34 seconds ===================</code> </pre> <br><blockquote> <strong>. :</strong>    ,    .      . <br><pre> <code class="plaintext hljs">platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe collected 7 items tests/test_nice.py::test_pass_fail FAILED [ 14%] tests/test_nice.py::test_with_nice OPPORTUNITY for improvement [ 28%] tests/test_nice.py::test_with_nice_verbose OPPORTUNITY for improvement [ 42%] tests/test_nice.py::test_not_nice_verbose FAILED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ================================== FAILURES =================================== _______________________________ test_pass_fail ________________________________</code> </pre> <br><br>     <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F', # . for Pass, F for Fail ])</code> </pre> <br><br>  auf <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F*', # . for Pass, F for Fail ])</code> </pre> <br><br>   <code>*</code>  <code>F</code> <br><br>       <code>test_with_nice</code> , <code>test_with_nice_verbose</code> , <code>test_not_nice_verbose</code> <br><br>     pytest. <br>    c   <br> <code>'test_with_nice.py .O [100%]'</code> <br>   <code>.</code>        <br>  ,    <br><br> RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead <br><br>    ! <br><pre> <code class="plaintext hljs">(venv36) c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice&gt;pytest -v ============================= test session starts ============================= platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe cachedir: .pytest_cache rootdir: c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice, inifile: plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED [ 14%] tests/test_nice.py::test_with_nice PASSED [ 28%] tests/test_nice.py::test_with_nice_verbose PASSED [ 42%] tests/test_nice.py::test_not_nice_verbose PASSED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ============================== warnings summary =============================== tests/test_nice.py::test_pass_fail c:\venv36\lib\site-packages\_pytest\compat.py:332: RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead return getattr(object, name, default)</code> </pre> <br></blockquote><p>  Hurra!   .     (pytest-nice),      Python <br>  pytest-: </p><br><pre> <code class="plaintext hljs">$ pip uninstall pytest-nice Uninstalling pytest-nice-0.1.0: Would remove: \path\to\venv\lib\site-packages\pytest_nice-0.1.0.dist-info\* ... Proceed (y/n)? y Successfully uninstalled pytest-nice-0.1.0</code> </pre> <br><p>        ‚Äî   ,     pytest,   PyPI. </p><br><h2 id="sozdanie-distributiva">   </h2><br><p>    ,      . ,         setup.py   : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice $ python setup.py sdist running sdist running egg_info creating pytest_nice.egg-info ... running check creating pytest-nice-0.1.0 ... creating dist Creating tar archive ... $ ls dist pytest-nice-0.1.0.tar.gz</code> </pre> <br><p> ( ,  sdist  <em>source distribution</em> ‚Äî ‚Äú  .‚Äù) </p><br><p>  pytest-nice  dist      <code>pytest-nice-0.1.0.tar.gz</code> . </p><br><p>         ,    ,   : </p><br><pre> <code class="plaintext hljs">$ pip install dist/pytest-nice-0.1.0.tar.gz Processing ./dist/pytest-nice-0.1.0.tar.gz ... Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p>       <code>.tar.gz</code>   ,       . </p><br><h2 id="rasprostranenie-plaginov-cherez-obschiy-katalog">      </h2><br><p> <code>pip</code>       ,  ,    ,       ,   ,    ,     <code>.tar.gz</code>   . ,   <code>pytest-nice-0.1.0.tar.gz</code>     <code>myplugins</code> . </p><br><p>   <code>pytest-nice</code>  <code>myplugins</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links myplugins pytest-nice</code> </pre> <br><p> <code>--no-index</code>  <code>pip</code>    PyPI,   ,    . <br> The --find-links myplugins tells PyPI to look in myplugins for packages to install. And of course, pytest-nice is what we want to install. <br> <code>--find-links myplugins</code>  PyPI   <code>myplugins</code>   .  , <code>pytest-nice</code> ‚Äî  ,    . </p><br><p>         <code>myplugins</code>    ,    ,  <code>--upgrade</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --upgrade --no-index --find-links myplugins pytest-nice</code> </pre> <br><p>      <code>pip</code> ,    <code>--no-index --find-links myplugins</code> . </p><br><h2 id="rasprostranenie-plaginov-cherez-pypi">    PyPI </h2><br><p>        ,    ,    .   ,    . ,          ,      ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python Packaging</a> . </p><br><p>     pytest,      ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>cookiecutter-pytest-plugin</code></a> : </p><br><pre> <code class="plaintext hljs">$ pip install cookiecutter $ cookiecutter https://github.com/pytest-dev/cookiecutter-pytest-plugin</code> </pre> <br><p>          .      ,      .          ; , ,     .     pytest,      ,       . </p><br><h2 id="uprazhneniya">  √úbungen </h2><br><p>  <code>ch4/cache/test_slower.py</code>  autouse fixture,  <code>check_duration()</code> .        4.      . </p><br><ol><li>     pytest-slower,        ,  ,    ¬´  ¬ª  . 102. </li><li>    ,   pytest-slower ,   . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schreiben Sie einen Testcode f√ºr das Plugin. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schauen Sie sich den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Package Index an</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und suchen Sie nach "pytest-". </font><font style="vertical-align: inherit;">Finden Sie ein Pytest-Plugin, das f√ºr Sie interessant aussieht.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Installieren Sie das Plugin Ihrer Wahl und probieren Sie es bei den Tasks-Tests aus. </font></font></li></ol><br><h2 id="chto-dalshe">  Was weiter </h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie haben bisher viele Male </font></font><code>conftest.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in diesem Buch verwendet. </font><font style="vertical-align: inherit;">Es gibt auch Konfigurationsdateien, die sich beispielsweise auf die Ausf√ºhrung von Pytests auswirken </font></font><code>pytest.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Im n√§chsten Kapitel werden Sie sich mit den verschiedenen Konfigurationsdateien vertraut machen und herausfinden, was Sie tun k√∂nnen, um Ihnen das Leben beim Testen zu erleichtern.</font></font></p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zur√ºck</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weiter</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448794/">https://habr.com/ru/post/de448794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448780/index.html">Was gibt Software f√ºr die Rekrutierung in Geld</a></li>
<li><a href="../de448784/index.html">Neue Funktionen f√ºr Erweiterungsautoren in Visual Studio 2019 Version 16.1</a></li>
<li><a href="../de448786/index.html">Python-Test mit Pytest. KAPITEL 3 Pytest-Vorrichtungen</a></li>
<li><a href="../de448788/index.html">Python-Test mit Pytest. Kapitel 2, Schreiben von Testfunktionen</a></li>
<li><a href="../de448790/index.html">SpaceVIL - plattform√ºbergreifendes GUI-Framework f√ºr die Entwicklung auf .Net Core, .Net Standard und JVM</a></li>
<li><a href="../de448796/index.html">Python-Test mit Pytest. Konfiguration, KAPITEL 6</a></li>
<li><a href="../de448798/index.html">Python-Test mit Pytest. Verwenden von pytest mit anderen Tools, KAPITEL 7</a></li>
<li><a href="../de448800/index.html">Konfigurieren Sie Visual Studio in Ihrer Organisation mit .vsconfig</a></li>
<li><a href="../de448802/index.html">Mit Portalen denken: Portale in Unreal Engine 4 erstellen</a></li>
<li><a href="../de448804/index.html">Vorbereitungen f√ºr die geh√§rtete Laufzeit und den Notar von macOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>