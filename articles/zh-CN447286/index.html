<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙇🏼 🚉 🌅 为什么以及如何在Avito广告中隐藏车牌 👨🏼‍🔬 💘 ⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你好 去年年底，我们开始自动在Avito公告卡中的照片上隐藏车牌号。 关于我们为什么这样做，以及解决此类问题的方法有哪些，请阅读本文。 



 挑战赛 
 2018年在Avito售出250万辆汽车。 每天将近7000。 所有待售广告都需要插图-汽车照片。 但是通过状态编号，您可以找到许多有关汽车的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>为什么以及如何在Avito广告中隐藏车牌</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/447286/"> 你好 去年年底，我们开始自动在Avito公告卡中的照片上隐藏车牌号。 关于我们为什么这样做，以及解决此类问题的方法有哪些，请阅读本文。 <br><br><img src="https://habrastorage.org/webt/fr/0p/vx/fr0pvxzrkfbjqpvdeeu3-hfp4z8.png" alt="隐藏我的盘子！"><br><a name="habracut"></a><br><h4> 挑战赛 </h4><br>  2018年在Avito售出250万辆汽车。 每天将近7000。 所有待售广告都需要插图-汽车照片。 但是通过状态编号，您可以找到许多有关汽车的信息。 我们的一些用户尝试自行关闭车牌。 <br><table><tbody><tr><td><img src="https://habrastorage.org/webt/ti/u9/yl/tiu9ylusazwgoyouuhvbd3iephi.png" alt="图片"></td><td><img src="https://habrastorage.org/webt/tf/8x/6l/tf8x6lq0j4cnyytbzn4pbwalky8.png" alt="图片"></td></tr><tr><td><img src="https://habrastorage.org/webt/t-/mz/ig/t-mzigkjjc00g-w_b2vx4sz0vy8.png" alt="图片"></td><td><img src="https://habrastorage.org/webt/rq/gu/31/rqgu31h8n1j4n08z2wu6oqfzwlo.png" alt="图片"></td></tr><tr><td colspan="2"><img src="https://habrastorage.org/webt/55/9b/rb/559brbhsq8xldsnln_umbwjqldw.png" alt="本文开头用于说明的原型"></td></tr></tbody></table><br> 用户想要隐藏车牌号的原因可能有所不同。 就我们而言，我们希望帮助他们保护数据。 并且我们尝试改善用户的买卖过程。 例如，匿名号码服务已经与我们合作了很长时间：当您出售汽车时，会为您创建一个临时的手机号码。 好吧，为了保护车牌上的数据，我们将照片匿名化。 <br><br><img src="https://habrastorage.org/webt/ol/-o/ii/ol-oiivyox1f2cogwd2pzf1jz9y.png" alt="图片"><br><br><h4> 解决方案概述 </h4><br> 要自动化保护用户照片的过程，可以使用卷积神经网络来检测带有车牌的多边形。 <br> 现在，为了检测对象，使用了两组的体系结构：两级网络，例如Faster RCNN和Mask RCNN。 单级（单快照）-SSD，YOLO，RetinaNet。 检测物体是导出感兴趣物体所刻入的矩形的四个坐标。 <br><br><img src="https://habrastorage.org/webt/-g/bz/p4/-gbzp4vk0cj2uwknc1qeavh8roy.png" alt="图片"><br><br> 上面提到的网络能够在图片中找到许多不同类别的对象，这对于解决车牌搜索问题已经是多余的，因为我们通常在图片中只有一辆汽车（人们拍摄他们所售汽车及其随机邻居的照片时会有例外。 ，但这种情况很少发生，因此可以忽略）。 <br><br> 这些网络的另一个功能是，默认情况下，它们会生成一个边界框，其边界平行于坐标轴。 发生这种情况是因为使用了一组称为锚框的预定义类型的矩形框架进行检测。 更准确地说，首先使用卷积网络（例如resnet34），从图片中获取属性矩阵。 然后，对于使用滑动窗口获得的每个属性子集，都会进行分类：是否有第k个锚框的对象，并对框架的四个坐标进行回归，从而调整其位置。 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关此内容的更多信息。 <br><br><img src="https://habrastorage.org/webt/ew/er/dq/ewerdqloqogwqhsp8kauzmwzwtq.png" alt="图片"><br><br> 此后，还有两个负责人： <br><br><img src="https://habrastorage.org/webt/be/9j/ib/be9jibquo3xic6fi-3dof-ivyq4.png" alt="不是最原始的建筑图"><br><br> 一个分类对象（狗/猫/植物等）， <br> 第二个（bbox回归器）-用于回归上一步中获得的框架的坐标，以增加对象的面积与框架的面积之比。 <br><br> 为了预测旋转的拳击框，您需要更改bbox回归器，以便获得框架的旋转角度。 如果不这样做，它将以某种方式出现。 <br><br><img src="https://habrastorage.org/webt/c0/4p/5d/c04p5dcpnl02xrgbvapzycdtboe.png" alt="图片"><br><br> 除了两阶段的Faster R-CNN，还有一阶段的检测器，例如RetinaNet。 它与以前的体系结构的不同之处在于，它可以立即预测类和帧，而无需提议可能包含对象的图片部分。 为了预测旋转的蒙版，还必须更改box子网的头部。 <br><br><img src="https://habrastorage.org/webt/uu/_w/qx/uu_wqxel27ctxz39s_trbw4be88.png" alt="图片"><br><br>  DRBOX是用于预测旋转边界框的现有体系结构的一个示例。 该网络未使用该地区提案的初步阶段，如Faster RCNN；因此，它是对一阶段方法的修改。 为了训练该网络，使用以特定角度旋转的K边界框（rbox）。 网络预测每个K rbox包含目标对象，坐标，bbox大小和旋转角度的概率。 <br><br><img src="https://habrastorage.org/webt/oq/a4/yo/oqa4yonbchbbmkcu9mjsj7nmmfm.png" alt="图片"><br><br> 修改架构并使用旋转的边界框对数据中考虑的网络之一进行重新训练是一项可实现的任务。 但是我们的目标可以轻松实现，因为我们拥有的网络范围要狭窄得多-仅用于隐藏车牌。 <br> 因此，我们决定从一个简单的网络开始，以预测数字的四个点，随后便有可能使体系结构复杂化。 <br><br><h4> 资料 </h4><br> 数据集的组装分为两个步骤：收集汽车图片并在上面标有车牌的区域。 我们的基础架构已经解决了第一个任务：我们仔细存储了放置在Avito上的所有广告。 为了解决第二个问题，我们使用Toloka。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">toloka.yandex.ru/requester上，我们</a>创建一个任务： <br><blockquote> 任务给了汽车的照片。 必须使用四边形突出显示汽车的车牌。 在这种情况下，状态编号应尽可能准确地分配。 </blockquote><img src="https://habrastorage.org/webt/mk/vl/j4/mkvlj4d7k8bsg_xkke1gkcsrxuy.png" alt="图片"><br><br> 使用Toloka，您可以创建用于标记数据的任务。 例如，评估搜索结果的质量，标记不同类别的对象（文本和图片），标记视频等。 它们将由Toloka用户执行，需要您付费。 例如，在我们的案例中，驾车者必须在照片中突出显示带有汽车牌照的垃圾填埋场。 通常，标记大型数据集非常方便，但是获得高质量非常困难。 人群中有很多机器人，它们的任务是通过随机给出答案或使用某种策略从您那里赚钱。 为了对抗这些机器人，有一套规则和检查系统。 主要检查是控制问题的混合：您可以使用Toloki界面手动标记部分任务，然后将其混合到主要任务中。 如果标记经常被误认为是控制问题，则可以将其阻止，而不考虑标记。 <br><br> 对于分类任务，确定标记是否错误非常简单，对于突出显示区域的问题，并不是那么简单。 经典方法是计算IoU。 <br><br><img src="https://habrastorage.org/webt/fw/r2/ye/fwr2yeqbrlk1-skjy2udjx04y2e.png" alt="图片"><br><br> 如果该比率小于几个任务的某个特定阈值，则将阻止该用户。 但是，对于两个任意的四边形，计算IoU并不是那么简单，尤其是因为在Tolok中必须在JavaScript中实现它。 我们进行了一次小小的尝试，我们相信，如果在一个小社区中，对于源多边形的每个点，都有一个标有划线的点，那么用户就不会错。 还有一条快速响应规则，可阻止响应用户过快，验证码，与大多数意见不符等。 设置了这些规则后，您可以期望获得不错的标记，但是如果您确实需要高质量和复杂的标记，则需要专门聘请自由职业者-书写者。 结果，我们的数据集总计有4k个标记图像，在Tolok的价格均为28美元。 <br><br><h4> 型号 </h4><br> 现在，让我们建立一个网络来预测该区域的四个点。 我们将使用resnet18来获得标志（resnet34的参数为11.7M，resnet34的参数为21.8M），然后我们将头回归到四个点（八个坐标），并对图片中是否有车牌进行分类。 需要第二个标题，因为在销售汽车的广告中，并非所有带有汽车的照片。 照片可能是汽车的细节。 <br><br><img src="https://habrastorage.org/webt/wz/qc/5s/wzqc5spmzueaqptlw6hiknobayo.png" alt="图片"><br><br> 当然，与我们相似，没有必要进行检测。 <br><br> 我们通过将没有边界框（0,0,0,0,0,0,0,0,0,0）目标的牌照照片和分类器“带有/不带有牌照的图片”的值添加到数据集中来同时训练两个目标。 1）。 <br><br> 然后，您可以为两个目标创建单个损失函数，作为以下损失的总和。 为了回归到车牌多边形的坐标，我们使用平滑的L1损失。 <br><br><img src="https://habrastorage.org/webt/6s/v7/yu/6sv7yus_w9o4d1xmqfhbnsenotc.png" alt="图片"><br><br> 它可以解释为L1和L2的组合，当自变量的绝对值较大时，其行为类似于L1；当自变量的值接近零时，其行为与L2相同。 对于分类，我们使用softmax和交叉熵损失。 特征提取器是resnet18，我们使用ImageNet上预先训练的权重，然后我们将进一步训练数据集中的提取器和头部。 在此问题中，我们使用了mxnet框架，因为它是Avito中用于计算机视觉的主要框架。 通常，微服务体系结构允许您不受特定框架的束缚，但是当您拥有大量代码库时，最好使用它，而不必再次编写相同的代码。 <br><br> 在我们的数据集上获得可接受的质量后，我们求助于设计师为我们获取带有Avito徽标的车牌。 当然，起初我们尝试自己动手做，但是看起来并不漂亮。 接下来，您需要使用牌照将Avito牌照的亮度更改为原始区域的亮度，然后可以将徽标覆盖在图像上。 <br><br><img src="https://habrastorage.org/webt/3j/gr/bz/3jgrbzhv3y9sldjmbm5hlfmhlo8.png" alt="图片"><br><br><h4> 在产品中启动 </h4><br> 结果的可再现性，项目的支持和开发的问题在后端和前端开发的世界中以一定的错误解决，但在使用机器学习模型的地方仍然存在。 您可能必须了解遗留代码模型。 如果自述文件具有该解决方案所基于的文章或开源资源库的链接，那将是一个很好的选择。 开始重新训练的脚本可能会因错误而失败，例如，cudnn版本已更改，并且该版本的tensorflow不再适用于此版本的cudnn，并且cudnn不适用于此版本的nvidia驱动程序。 也许为了进行培训，我们根据数据使用了一个迭代器，而在生产中测试了另一个迭代器。 这可以持续相当长的时间。 通常，存在再现性问题。 <br><br> 我们尝试使用nvidia-docker环境中的训练模型删除它们，它具有suda的所有必需依赖关系，并且我们还在其中安装了python依赖关系。 根据数据，扩充和推理模型，带有迭代器的库版本在训练/实验阶段和生产中很常见。 因此，为了在新数据上训练模型，您需要将存储库泵送到服务器，运行将收集docker环境的shell脚本，jupyter笔记本将在其中存储。 在内部，您将拥有所有用于培训和测试的笔记本，由于环境的原因，这些笔记本当然不会因错误而失败。 当然，最好有一个train.py文件，但是实践表明，您始终需要目睹模型所提供的功能并在学习过程中进行某些更改，因此最终您仍将运行jupyter。 <br><br> 模型权重存储在git lfs中-这是一种用于在git中存储大文件的特殊技术。在此之前，我们使用了人工制品，但使用git lfs更为方便，因为使用该服务下载存储库后，您可以立即获得秤的最新版本，就像在生产中一样。 自动测试是为模型推断而编写的，因此您将无法推出权重无法通过的服务。 服务本身是在kubernetes集群上的微服务基础架构内的docker中启动的。 为了监控性能，我们使用了grafana。 滚动之后，我们使用新模型逐渐增加服务实例的负载。 推出新功能时，我们会根据统计测试创建/ b测试，并对功能的未来命运做出判断。 <br><br> 结果是：我们为私人交易者在自动类别的广告中启用了数字修饰，一幅图像隐藏数字的处理时间的95％为250毫秒。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN447286/">https://habr.com/ru/post/zh-CN447286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN447276/index.html">什么是ITIL库，为什么您的公司需要它</a></li>
<li><a href="../zh-CN447278/index.html">爱沙尼亚正试图在司法中使用人工智能</a></li>
<li><a href="../zh-CN447280/index.html">在中国升级游戏帐户：严肃的生意和开发者的头疼</a></li>
<li><a href="../zh-CN447282/index.html">前端陷入系统和应用程序程序员的错误（已删除文章）</a></li>
<li><a href="../zh-CN447284/index.html">在Visual Studio 2019中更新Web和Azure工具</a></li>
<li><a href="../zh-CN447288/index.html">前5名稳定币。 所有你需要知道的</a></li>
<li><a href="../zh-CN447290/index.html">医生游乐设施</a></li>
<li><a href="../zh-CN447292/index.html">Visual Studio 2019中的14种新产品</a></li>
<li><a href="../zh-CN447294/index.html">Visual Studio 2019现在包含实时共享</a></li>
<li><a href="../zh-CN447298/index.html">通过能力模型进行知识管理</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>