<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∏ üí™ üßñüèø Wie MSTP funktioniert üìß ‚ò∏Ô∏è üî•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lassen Sie uns heute √ºber MSTP sprechen. Bevor Sie sich mit MSTP befassen, m√ºssen Sie sich mit den STP- und RSTP- Protokollen vertraut machen. MSTP is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie MSTP funktioniert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419785/"> Lassen Sie uns heute √ºber MSTP sprechen.  Bevor Sie sich mit MSTP befassen, m√ºssen Sie sich mit den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">STP-</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RSTP-</a> Protokollen vertraut machen.  MSTP ist eine Modifikation von RSTP und damit von STP.  Wenn RSTP das gleiche STP ist, nur mit einem optimierten Senden von BPDUs und STP im Allgemeinen, warum sollten wir dann ein MSTP entwickeln, das auf der Basis von RSTP funktioniert?  Das Hauptmerkmal von MSTP ist die F√§higkeit, mit VLANs zu arbeiten.  Einige Leser sagen m√∂glicherweise: "Warten Sie, k√∂nnen Cisco pvst + und rpvst + nicht mit vlan arbeiten?"  RPVST + und PVST + f√ºhren einfach eigenst√§ndige RSTP- oder STP-Instanzen innerhalb eines einzelnen VLAN-Limits aus.  Aber hier gibt es Probleme: <br><br><ul><li>  RPVST + und PVST + sind nur auf Cisco-Ger√§ten verf√ºgbar, und auf Cisco gibt es kein klassisches STP und RSTP.  Was sollen wir tun, wenn andere Anbieter an der Topologie teilnehmen? </li><li>  Jede Instanz von STP und RSTP sendet alle zwei Sekunden BPDUs.  Wenn 100 vlanes zum Trunk-Port √ºbersprungen werden, bedeutet dies, dass 100 Nachrichten in 2 Sekunden gesendet werden.  Welches ist nicht zu gut. </li><li>  Cisco hat je nach Modell eine Begrenzung f√ºr die Anzahl der STP- oder RSTP-Instanzen auf einem einzelnen Switch.  Das hei√üt, wenn wir 128 vlans auf einem Switch hinzuf√ºgen, werden wir einer solchen Einschr√§nkung ausgesetzt sein.  Link <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">hier</a> </li></ul><a name="habracut"></a><br>  All diese Probleme werden durch das Multi-Vendor-Protokoll MSTP erfolgreich gel√∂st.  Wir werden versuchen, mit seiner Arbeit umzugehen.  Das Schema zum Erstellen einer schleifenlosen Topologie in RSTP besteht darin, ein Diagramm ohne Schnittpunkte unabh√§ngig von der logischen Topologie zu erstellen, ohne zu ber√ºcksichtigen, wo und wie die vlans konfiguriert sind.  In MSTP haben wir die M√∂glichkeit, bestimmte vlans zu einer Gruppe zusammenzufassen und f√ºr jede Gruppe eine eigene Topologie zu erstellen.  Schauen Sie sich zum Beispiel eine solche Topologie an: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/893/ec7/7a1/893ec77a1fc1abfe79a50798cbd67141.jpg" alt="Mein bild"></a> <br><br>  PCs fungieren als Netzwerksegmente.  PC1, PC3 ist ein Netzwerksegment, in dem vlans von 10 bis 50 verwendet werden, und PC2, PC4 sind vlans von 50 bis 100. Vlans von 10 bis 100 werden auf Sw1-4-Switches selbst erstellt. Wenn wir das RSTP-Protokoll verwenden, dann Segmente PC1 und PC2 Um zu den Segmenten PC3 bzw. PC4 zu gelangen, m√ºssen Sie einen gemeinsamen Pfad verwenden und zwischen zwei m√∂glichen <b>ausw√§hlen</b> : <b>Sw1-Sw2-Sw4</b> oder <b>Sw1-Sw3-Sw4</b> .  Leider funktioniert es nicht, eine Schaltung mit Lastverteilung aufzubauen, und einer dieser Pfade wird blockiert und leer.  Mit Hilfe von PVST + und RPVST + wird dies m√∂glich sein, es gibt jedoch die oben genannten Probleme.  MSTP hilft uns in dieser Angelegenheit und erstellt RSTP-Instanzen f√ºr eine Gruppe von vlans 10-50 und 50-100.  Es kann konfiguriert werden, dass der Root-Switch f√ºr Vlan 10-50 Sw3 und f√ºr 50-100 - Sw2 ist.  Der <b>Pfad Sw1-Sw3-Sw4</b> wird von VLAN 10-50 verwendet, der <b>Pfad Sw1-Sw2-Sw4</b> wird von VLAN 50-100 verwendet.  Die Idee ist, Instanzen zu erstellen, die vlans kombinieren und einen RSTP-Baum f√ºr jede Instanz separat erstellen.  Durch die Kombination von vlana 10-50 und 51-100 in verschiedenen Instanzen k√∂nnen Sie mit dem MSTP-Protokoll unabh√§ngige B√§ume f√ºr jede Instanz erstellen.  Die Konfiguration sieht folgenderma√üen aus: <br><blockquote>  Spanning-Tree-MST-Konfiguration <br>  Namensnotiz <br>  Instanz 1 vlan 10-50 <br>  Instanz 2 vlan 51-100 <br></blockquote>  Es ist bei allen 4 Schaltern identisch.  Schalter mit identischer Konfiguration dieser Parameter erstellen eine Region.  In Bezug auf die Regionen werden wir im Folgenden ausf√ºhrlicher sprechen, w√§hrend wir die Topologie innerhalb einer Region betrachten.  F√ºr jede Instanz wird eine eigene Root Bridge ausgew√§hlt.  Auf Sw3 geben wir den <b>Root-Prim√§rbefehl mst 1 f√ºr Spanning-Tree ein,</b> sodass Sw3 die Root-Bridge f√ºr 10-50 vlans ist, und auf Sw2 <b>-</b> <b>Root-Prim√§r-</b> Befehl <b>mst 2</b> f√ºr 51-100 vlans.  Zusammenfassend kombiniert jede Instanz - <b>mehrere Spanning-Tree-Instanzen (MSTI)</b> - vlana.  Und jede Region kombiniert Switches mit demselben MSTI.  Genau genommen sollte der Switch in der Region die folgenden Parameter haben: <br><br><ul><li>  Regionsname - Der Name der Region.  Definiert durch den Befehl name. </li><li>  Revisionsstand - Konfigurations√§nderungsparameter. </li><li>  MSTI. </li></ul><br>  In jeder Region gibt es eine Instanz von MSTI 0 (Instanz 0), die standardm√§√üig erstellt wird und alle vlans enth√§lt, die in anderen Instanzen nicht enthalten waren.  Instanz 0 hei√üt IST: <br>  <b>Internal Spanning Tree (IST)</b> ist eine spezielle Kopie des Spanning Tree, die standardm√§√üig in jeder MST-Region vorhanden ist.  IST zugewiesen Nummer 0 (Instanz 0).  Es kann BPDU-Frames senden und empfangen und dient zur Verwaltung der Topologie innerhalb einer Region.  Alle auf den Switches in dieser MST-Region konfigurierten VLANs sind standardm√§√üig an das IST gebunden. <br>  Root Bridge f√ºr IST hei√üt Regional Root Bridge.  √úber IST werden BPDU-Frames √ºbertragen, √ºber die der Baum f√ºr jede Instanz installiert wird.  Schauen wir uns an, wie BDPU in dieser Region aussieht: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/603/7e8/9b6/6037e89b6888f6219b2bd82c2271c761.jpg" alt="Mein bild"></a> <br><br>  Vor dem Start der MST-Erweiterung ist es sehr schwierig, BPDU MSTP von BPDU RSTP zu trennen, und IST ist grob gesagt ein klassisches RSTP.  MSTP f√ºgt nur Daten zu MSTI hinzu.  BPDU speichert Root Bridge-Informationen f√ºr Instanz 0-2.  Somit wird f√ºr alle VLANs und Beh√∂rden nur eine BPDU gesendet, die alle erforderlichen Informationen enth√§lt.  Dies ist eine enorme Einsparung gegen√ºber PVST + und RPVST +.  Sehen wir uns die Ausgabe des Befehls show spanning-tree mst auf dem Sw2-Switch an: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/211/365/372/2113653723bfbe70f327a68a1ea4f27d.jpg" alt="Mein bild"></a> <br><br>  Zum Beispiel 0 gibt es ein spezielles Feld - Regional Root.  Regional Root, wir haben Sw3 mit dem <b>Spanning-Tree mst 0 root-Prim√§rbefehl ausgew√§hlt</b> .  Regional Root ist der Root-Switch f√ºr MSTI 0 innerhalb derselben Region.  F√ºr MSTI1 ist Root auch Sw3 und f√ºr MSTI2 ist es Sw2.  In Bezug auf Portblockierung und Konvergenz wiederholt MSTP die Prinzipien von RSTP, auf deren Grundlage es funktioniert. Daher denke ich, dass die Arbeit von MSTP innerhalb einer Region durchaus verst√§ndlich ist.  Stellen Sie sich eine Topologie mit zwei Regionen vor: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/501/c74/f20/501c74f206c089449ca1238133fa5dd8.jpg" alt="Mein bild"></a> <br><br>  √úber Region A, wie oben gesagt, versuchen wir nun herauszufinden, wie die Regionen miteinander interagieren.  In Region B haben die Schalter die folgende Konfiguration: <br><blockquote>  Spanning-Tree-MST-Konfiguration <br>  Name RegionB <br>  Instanz 1 vlan 10-30 <br>  Instanz 2 vlan 31-60 <br></blockquote>  Gleichzeitig ist Sw9 der <b>Spanning-Tree-MST-1-Root-Primary</b> der Root-Switch f√ºr Vlan 10-30 und Sw10 der <b>Spanning-Tree-Mst-2-Root-Primary</b> ist der Root-Switch f√ºr Vlan 31-60. <br><br>  Der Aufbau des STP-Baums in Region B √§hnelt Region A und wurde oben beschrieben.  Sagen wir einfach, da wir die Root Bridge f√ºr MSTI 0 in Region B nicht festgelegt haben, wird sie von der niedrigsten MAC-Adresse unter Sw9-12 ausgew√§hlt.  Die kleinste MAC-Adresse ist Sw9.  Befehlsausgabe mit Sw10: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7f4/52a/bbd7f452a27ace3d97fc9b714bfed31a.jpg" alt="Mein bild"></a> <br><br>  F√ºr MSTI 0 Regional Root 5000.0009.0000 (Sw9).  Im Folgenden werden wir diskutieren, warum Sw9 und warum die Priorit√§t oder Mohnadresse nichts damit zu tun hat.  Jetzt interessiert uns mehr die Frage, was an der Grenze passieren wird.  Damit der STP-Baum zwischen Regionen korrekt erstellt wird, wird mit MST0 (IST) ein gemeinsamer Baum f√ºr alle Regionen erstellt.  Ein solcher Baum hei√üt CIST.  Lassen Sie uns das Konzept auch CST vorstellen.  Erinnern Sie sich also zuerst an das IST: <br><br><ul><li>  <b>Internal Spanning Tree (IST)</b> ist eine spezielle Kopie des Spanning Tree, die standardm√§√üig in jeder MST-Region vorhanden ist.  IST zugewiesen Nummer 0 (Instanz 0).  IST kann BPDU-Frames senden und empfangen und dient zur Verwaltung der Topologie innerhalb einer Region.  Standardm√§√üig sind alle VLANs in derselben Region an IST gebunden.  Wenn in einer Region mehrere MSTIs erstellt werden, bleiben die ihnen nicht zugeordneten VLANs an das IST gebunden.  In unseren Regionen A und B wird ein unabh√§ngiger STP-Baum f√ºr VLANs erstellt, die nicht in die Beh√∂rden 1 und 2 fallen. Die Root Bridge in IST hei√üt Regional Root. </li><li>  <b>Common Spanning Tree (CST)</b> - Ein Baum, der Regionen und alle Switches STP, RSTP, PVST +, RPVST + (keine MST-Switches) verbindet. </li><li>  <b>Common and Internal Spanning Tree (CIST)</b> - ein einzelner Spanning Tree, der CST und IST jeder MST-Region kombiniert. </li></ul><br>  Um die Grenzen jedes Baums zu verstehen, schlage ich den folgenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Artikel vor</a> . <br><br>  IST ist ein Baum innerhalb einer Region, CIST ist ein Baum zwischen Regionen, CST ist ein Baum, der B√§ume innerhalb einer Region und einen Baum zum Verbinden von Regionen kombiniert. <br><br>  Da wir den <b>Spanning-Tree-Befehl mst 0 root</b> auf Sw3 eingef√ºhrt haben, lautet die CIST-Root-Bridge f√ºr beide Regionen Sw3.  Wenn es in der gesamten Topologie nur eine Region gibt, fallen Regional Root Bridge und CIST Root Bridge zusammen.  Wenn es viele Regionen gibt, wird die beste regionale Wurzel unter allen Regionen ausgew√§hlt.  Bei der Wahl f√ºr die Rolle der CIST-Root-Bridge k√∂nnen auch Switches verwendet werden, die andere Protokolle als MSTP verwenden.  Wenn Sie versuchen, ein Gesamtbild zu erstellen, k√∂nnen Sie die Interaktion der Regionen wie folgt erkl√§ren: Jede Region scheint eine Kombination mehrerer Switches zu sein und wird anderen Switches als ein gro√üer virtueller Switch dargestellt.  Das hei√üt, wenn wir unsere Topologie mit den Augen von Region B betrachten, erhalten wir das folgende Bild daf√ºr: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/115/6f5/1d91156f550268ff06521adfff7a4136.jpg" alt="Mein bild"></a> <br><br>  F√ºr Region A ist es √§hnlich, Region B wird durch einen Schalter dargestellt.  In jeder Region verf√ºgt jeder Switch √ºber einen Root-Port, der ihn mit dem regionalen Root verbindet.  Jede Region w√§hlt auch einen Root-Port f√ºr MSTI 0 aus, was zu einer gemeinsamen CIST-Root-Bridge f√ºhrt.  Diese Ports k√∂nnen die Gi1 / 1-Ports auf Sw9 und Sw10 sein, da sie Regionen verbinden.  In unserer Topologie hat Sw9 die beste Bridge-ID, dann wird der Root-Port ausgew√§hlt und bei Sw10 wird der Gi1 / 1-Port blockiert.  Unter Sw9 ist f√ºr MSTI 0 der Gi1 / 1-Port der Root-Port. F√ºr MSTI 1 und 2 gibt es beispielsweise einen Root-Port f√ºr die Instanz-Root-Bridge, und der Port, der zur CIST-Root-Bridge f√ºhrt, erh√§lt eine neue Rolle - Master.  Von einer Region zur anderen kann es nur einen Arbeitskanal oder mit anderen Worten nur einen Master-Port und nur einen Switch geben.  Hier finden Sie Informationen zum MST am Sw9-Switch, an dem der Master-Port ausgew√§hlt wird. Achten Sie auf den Gi1 / 1-Port: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7f4/52a/bbd7f452a27ace3d97fc9b714bfed31a.jpg" alt="Mein bild"></a> <br><br>  Dieser Port f√ºr MSTI 0 hat, wie gesagt, die Rolle des Root und f√ºr MSTI 1-2 Master.  Au√üerdem wurde ein neuer Kanaltyp eingef√ºhrt - P2p Bound (RSTP).  Der Grenztyp wird den Ports zugewiesen, die an die andere Region oder eine andere Variante des STP-Protokolls angrenzen.  Informationen √ºber die CIST-Root-Bridge werden √ºber den Master-Port an die Region √ºbertragen. Eine Besonderheit besteht darin, dass dieser Port keine BPDUs selbst sendet, sondern im Gegensatz zum Typ des P2P-Ports in RSTP nur empf√§ngt.  Die Ausnahme bilden nur BPDUs mit dem TC-Flag (Topologie√§nderung).  Mal sehen, wie ein Switch in einer Region BPDUs aus einer anderen Region verarbeitet.  Wie bereits auf dem Master-Port Gi1 / 1 Sw9 erw√§hnt, werden BPDUs von Sw1 empfangen, w√§hrend Sw9 selbst nicht gesendet wird. <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/35e/f5a/4d835ef5a9fdc2514075fab810cf5cb9.jpg" alt="Mein bild"></a> <br><br>  Sw1 sendet dieselbe BPDU, unabh√§ngig davon, ob der Switch BPDUs innerhalb oder au√üerhalb der Region sendet.  Nachdem Sw9 diese BPDU akzeptiert hat, verarbeitet es nur Informationen vor dem Start des MST-Erweiterungsfelds. Nur diese Informationen werden zum Erstellen des Baums in Instanz 0 verwendet. Hier k√∂nnen Sie eine interessante Tatsache feststellen - die Stammkennung (50: 00: 00: 03: 00: 00) stimmt mit der Br√ºckenkennung √ºberein (50: 00: 00: 03: 00: 00), obwohl das Sw1-Paket mit der Bridge-ID gesendet wird - 50: 00: 00: 01: 00: 00.  Dies best√§tigt unsere Theorie, dass jede Region f√ºr eine andere durch einen gro√üen virtuellen Switch dargestellt wird.  Man kann auch sagen, dass wir zwischen den Regionen das klassische RSTP haben.  Aber lassen Sie uns √ºber die Kosten des Root-Pfads sprechen.  Es gibt zwei Arten von Pfadkosten - interne und externe.  Die Root-Pfadkosten, die auf MSTI 0 verweisen, sind extern.  Und trotz der Tatsache, dass es noch einen Kanal von Sw1 zur Root Bridge (Sw3) gibt, wird dieser immer noch als Null angezeigt.  Es war, als h√§tte Root Bridge es selbst geschickt.  Interne Stammpfadkosten werden in den Feldern unter der MST-Erweiterung aufgef√ºhrt.  Die internen CIST-Wurzelpfadkosten geben die Kosten f√ºr den Pfad zur regionalen Wurzelbr√ºcke f√ºr MSTI 0 an, und die Felder unter MSTID 1 und 2 geben die internen Wurzelpfadkosten zur Wurzelbr√ºcke f√ºr jede Instanz an.  Die externen Root-Path-Kosten spielen eine besondere und sehr wichtige Rolle. Sie bestimmen die regionale Root-Bridge und nicht die Priorit√§t und die Mohnadresse. Wir haben oben eine Bemerkung dazu gemacht.  Der Switch mit den geringsten Root-Path-Kosten bis zur CIST-Root-Bridge wird zur regionalen Root-Bridge!  Beispielsweise haben Sw9 und Sw10 Root-Pfadkosten von 20.000, was den Kosten des Gi1 / 1-Ports entspricht.  Und erst danach beginnen sie, ihre Bridge-IDs zu vergleichen.  Lassen Sie uns dies √ºberpr√ºfen, die Verbindungskosten in Sw10 √§ndern und gleichzeitig die Priorit√§t auf das Maximum erh√∂hen, um die Option auszuschlie√üen, Regional Root nach Priorit√§t auszuw√§hlen.  Wir f√ºhren die folgenden Befehle ein: <br><blockquote>  Sw10 (config-if) # Spanning-Tree mst 0 Priorit√§t 61440 <br>  Sw10 (config-if) # Schnittstelle gigabitEthernet 1/1 <br>  Sw10 (config-if) # Spanning-Tree mst 0 kostet 10000 <br></blockquote>  Und wir bekommen, dass Sw10 trotz seiner schrecklichen Priorit√§t zur regionalen Wurzelbr√ºcke geworden ist: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/abd/51c/e5babd51cd3a12bfbe4e0ab94d9b474a.jpg" alt="Mein bild"></a> <br><br>  Daher erfolgt die Auswahl der regionalen Root-Bridge in dieser Reihenfolge, und die regionale Root-Bridge kann niemals ein Switch ohne Grenzports sein: <br><br><ul><li>  Niedrigste externe Pfadkosten zur CIST-Root-Bridge. </li><li>  Niedrigste regionale Br√ºckenkennung. </li><li>  CIST Bridge Identifier von BPDU aus der Region mit CIST Root Bridge. </li></ul><br>  Wenn wir beispielsweise eine Verkn√ºpfung zwischen Sw9 und Sw4 hinzuf√ºgen und √ºberlegen, welche Verkn√ºpfung zum Master wird, wird das Feld CIST Bridge Identifier, das niedriger als die MST-Erweiterung ist, das bestimmende Feld, wenn alle Parameter gleich sind.  Wir haben ein bisschen gelogen, als wir sagten, dass Sw9 die Daten unter der MST-Erweiterung nicht betrachtet.  In diesem Fall wird die CIST-Br√ºckenkennung aus der MST-Erweiterung gez√§hlt. <br>  Lassen Sie uns nun das Verhalten von MST sehen, wenn wir RPVST-Schalter hinzuf√ºgen: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/d40/eff/45b/d40eff45b3025e0e1b47b6a352199390.jpg" alt="Mein bild"></a> <br><br>  Zwei F√§lle sind m√∂glich: <br><br><ol><li>  Root Bridge geh√∂rt RPVST. </li><li>  Root Bridge geh√∂rt MSTP. </li></ol><br>  Betrachten Sie zun√§chst den Fall, in dem Sw3 weiterhin eine CIST-Root-Bridge ist (d. H. Fall 2).  In diesem Fall √§ndern Sw10 und Sw12, sobald sie BPDUs von RSTP1 und RSTP2 f√ºr jedes VLAN empfangen, den Porttyp Gi1 / 0 in <b>P2p Bound (PVST)</b> .  Dieser Typ bedeutet, dass Sw10 und Sw12 an diesem Port mit RPVST-Switches verbunden sind und Kopien von BPDUs f√ºr MSTI0 (dh ohne Felder unterhalb der MST-Erweiterung) an alle an diesem Port zul√§ssigen Vlanes senden.  Daher werden RSTP1 und RSTP2 nicht bemerken, dass Sw10 und Sw12 ein anderes Protokoll verwenden.  Diese Technologie in MSTP hei√üt <b>PVST-Simulation</b> und damit erhalten wir die Koordination zwischen verschiedenen Switches. <br><br>  Der Fall, dass sich die Root Bridge unter den RPVST-Switches befindet, ist komplexer und wird nicht empfohlen.  Angenommen, wir haben RSTP1 ist die Root Bridge f√ºr alle vlan.  Der Einfachheit halber nehmen wir an, dass die vlans 1-3 erstellt werden und der <b>Spanning-Tree-Befehl vlan 1-3 mit der Priorit√§t 12288</b> eingef√ºhrt wird, der niedrigsten Priorit√§t unter den RSTP- und MSTP-Switches.  Sw10 erh√§lt f√ºr jede Vlana BPDU.  Es ist sehr wichtig zu verstehen, dass nur BPDUs f√ºr Vlan 1 vom MSTP-Switch verarbeitet werden. Wie geschieht dies? <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/d40/eff/45b/d40eff45b3025e0e1b47b6a352199390.jpg" alt="Mein bild"></a> <br><br>  Abh√§ngig davon, wie viele vlans konfiguriert sind, werden so viele RPVST + BPDU-Pakete gesendet, aber zus√§tzlich wird es auch √ºber eine native vlan-BPDU mit der Ziel-Mac-Adresse gesendet - 01: 80: c2: 00: 00: 00.  Es ist diese Mohnadresse, die MSTP verwendet. PVST- und RPVST-Schalter verwenden eine andere Mohnadresse - 01: 00: 0c: cc: cc: cd.  Unabh√§ngig davon, welches VLAN als nativ konfiguriert ist, werden Informationen f√ºr das erste VLAN in dieser BPDU √ºbertragen.  Nur dieses Paket wird verarbeitet, um den Baum von den MSTP-Switches zu erstellen.  Die verbleibenden BPDUs f√ºr bestimmte Vlanes werden verwendet, um den Wurzelknotenschutz w√§hrend PVST-Simulationen zu √ºberpr√ºfen (PVST-Simulationen Root-Guard-basierte Konsistenzpr√ºfung).  Was f√ºr ein Scheck?  Sobald wir RSTP1 mit einem solchen Befehl f√ºr die <b>Spanning-Tree-VLAN 1-3-Priorit√§t</b> 12288 konfigurieren, wird auf Sw10 sofort eine Fehlermeldung angezeigt: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/098/25f/7a009825fc7dd326bc5e426493500385.jpg" alt="Mein bild"></a> <br><br>  Versuchen wir es zu erkl√§ren.  Sw10 hat eine native vlan-BPDU f√ºr vlan 1 mit der Priorit√§t 12288 + 1 √ºbernommen.  Verarbeitet und entschieden, dass Gi1 / 0 sein Root-Port ist.  Dann kam die PVST-BPDU f√ºr den Rest des VLAN (1-3), er untersuchte sie, um die Integrit√§t des Root-Switch zu √ºberpr√ºfen, und es gab Priorit√§ten 12288 + 2, 12288 + 3 f√ºr den VLAN 2-3, die mehr als 12288 + 1 sind.  Integrit√§t bricht zusammen - einerseits muss es der Root-Port sein, und andere h√∂here Priorit√§ten zwingen den Port, zur designierten Rolle zu wechseln.  Eine solche Mehrdeutigkeit ist f√ºr solche Protokolle nicht zul√§ssig, und MST blockiert diesen Port, versetzt ihn in den BKN-Status und meldet einen Fehler. - <b>Blockieren des Root-Ports Gi1 / 0: Inkonsistente minderwertige PVST-BPDU empfangen</b> .  Um dies zu verhindern, muss kein einziger VLAN, dessen BPDUs an diesem Port √ºbertragen werden, eine niedrigere Priorit√§t (mehr) als VLAN 1 haben. Wenn wir also die Priorit√§t von VLAN 2‚Äì3 auf 4096 reduzieren, ist sie offensichtlich kleiner als vlana 1, dann beheben Sie dieses Problem. <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/0f6/4a6/c6d/0f64a6c6d9b21ae127cb5572c7ade92d.jpg" alt="Mein bild"></a> <br><br>  Wie Sie sehen k√∂nnen, wurde eine Meldung <b>angezeigt</b> , die den korrekten Betrieb des Ports <b>wiederherstellt</b> - <b>Inkonsistenz der PVST-Simulation auf Port GigabitEhternet 0/1 behoben</b> . <br><br>  Ich denke, um das Gespr√§ch √ºber MSTP zu vervollst√§ndigen.  N√ºtzliche Links unten: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">www.cisco.com/c/en/us/support/docs/lan-switching/multiple-instance-stp-mistp-8021s/116464-configure-pvst-00.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">habrahabr.ru/post/128172</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">www.cisco.com/c/ru/support/docs/lan-switching/multiple-instance-stp-mistp-8021s/116464-configure-pvst-00.pdf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5000/sw/configuration/guide/cli_rel_4_0_1a/CLIConfigurationGuide/MST.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">networkengineering.stackexchange.com/questions/28716/multiple-spanning-tree-terminology-cst-ist-cist-and-exact-behavior</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">blog.sbolshakov.ru/11-3-mstp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">blog.ine.com/2010/02/22/understanding-mstp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">networklessons.com/spanning-tree/multiple-spanning-tree-mst</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de419785/">https://habr.com/ru/post/de419785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de419775/index.html">Meine Version des ‚ÄûGer√§ts f√ºr klare Tr√§ume‚Äú ist eine kurze Geschichte und Beschreibung der ersten Version</a></li>
<li><a href="../de419777/index.html">Wie man NNN-Server in den Niederlanden verkauft und nicht mit blo√üer Begeisterung zur√ºckgelassen wird: Verkaufsgeheimnisse</a></li>
<li><a href="../de419779/index.html">Die gewachsenen Lungen wurden erfolgreich einem Schwein transplantiert, nach 5 Jahren sind Versuche am Menschen m√∂glich</a></li>
<li><a href="../de419781/index.html">SpaceX veranstaltete den ersten Mars-Workshop</a></li>
<li><a href="../de419783/index.html">Mensch gegen Maschine: Eine neue Ethik f√ºr Cybersicherheit</a></li>
<li><a href="../de419787/index.html">Club Club Report 2018, Kapitel 3.9: ‚ÄûF√ºnffache Ressourcenleistung‚Äú</a></li>
<li><a href="../de419789/index.html">Jimmy Wales Gedanken: "Wikipedia ist wie eine Wurst ..."</a></li>
<li><a href="../de419791/index.html">Apple lehnt das Partnerprogramm ab, um Apps aus dem App Store zu bewerben</a></li>
<li><a href="../de419795/index.html">Tesla meldete einen Rekordverlust. Die Aktien des Unternehmens stiegen aufgrund von Prognosen f√ºr das n√§chste Quartal weiter</a></li>
<li><a href="../de419797/index.html">Reverse Engineering des Protokolls des Panels von der Wechselrichter-Klimaanlage Electrolux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>