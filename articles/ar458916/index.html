<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📗 👼🏼 🌒 تحت غطاء محرك السيارة من رد الفعل. نكتب تنفيذنا من الصفر 🍠 👍🏼 💚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في هذه السلسلة من المقالات ، سننشئ تطبيق React الخاص بنا من البداية. في النهاية ، سيكون لديك فهم لكيفية عمل React ، وطرق دورة حياة المكون التي يسميها ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تحت غطاء محرك السيارة من رد الفعل. نكتب تنفيذنا من الصفر</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458916/" style=";text-align:right;direction:rtl">  في هذه السلسلة من المقالات ، سننشئ تطبيق React الخاص بنا من البداية.  في النهاية ، سيكون لديك فهم لكيفية عمل React ، وطرق دورة حياة المكون التي يسميها ، ولماذا.  هذه المقالة مخصصة لأولئك الذين استخدموا React بالفعل ويريدون التعرف على أجهزتها أو للفضوليين للغاية. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d8/ea8/66a/9d8ea866a9fac6aadd47eb3d51026f61.jpg" alt="صورة"><br><a name="habracut"></a><br>  هذه المقالة هي ترجمة لـ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">React Internals ، الجزء الأول: التقديم الأساسي</a> <br><br><h2 style=";text-align:right;direction:rtl">  هذا هو في الواقع المادة الأولى من أصل خمسة </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  أساسيات التقديم &lt;- نحن هنا </li><li style=";text-align:right;direction:rtl">  ComponentWillMount و componentDidMount </li><li style=";text-align:right;direction:rtl">  تحديث </li><li style=";text-align:right;direction:rtl">  setState </li><li style=";text-align:right;direction:rtl">  المعاملات </li></ol><br><blockquote style=";text-align:right;direction:rtl">  تم إنشاء المادة عندما يكون React 15.3 ذا صلة ، ولا سيما استخدام ReactDOM وموفق المكدس.  الرد 16 وما فوق له بعض التغييرات.  ومع ذلك ، تظل هذه المادة ذات صلة ، لأنها تعطي فكرة عامة عما يحدث "تحت الغطاء". <br></blockquote><h2 style=";text-align:right;direction:rtl">  الجزء 1. تقديم الأساسيات </h2><br><h3 style=";text-align:right;direction:rtl">  العناصر والمكونات </h3><br>  هناك ثلاثة أنواع من الكيانات في React: عنصر DOM أصلي ، وعنصر تفاعل افتراضي ، ومكون. <br><br><h4 style=";text-align:right;direction:rtl">  عناصر DOM الأصلية </h4><br>  هذه هي عناصر DOM التي يستخدمها المستعرض لإنشاء صفحة الويب ، على سبيل المثال ، div ، span ، h1.  يقوم React بإنشائها عن طريق استدعاء document.createElement () ، ويتفاعل مع الصفحة باستخدام أساليب DOM API المستندة إلى المستعرض مثل element.insertBefore () ، element.nodeValue ، وغيرها. <br><br><h4 style=";text-align:right;direction:rtl">  رد فعل الظاهري عنصر </h4><br>  عنصر React الظاهري (يُشار إليه غالبًا باسم "عنصر") هو كائن javascript يحتوي على الخصائص الضرورية لإنشاء أو تحديث عنصر DOM أصلي أو شجرة من هذه العناصر.  استنادًا إلى عنصر React الظاهري ، يتم إنشاء عناصر DOM الأصلية ، مثل div و span و h1 وغيرها.  يمكننا القول أن عنصر React الظاهري هو مثيل لمركب مركب يحدده المستخدم ، المزيد حول هذا أدناه. <br><br><h4 style=";text-align:right;direction:rtl">  عنصر </h4><br>  المكون هو مصطلح عام إلى حد ما في React.  المكونات هي الكيانات التي بها React تلاعب مختلف.  مكونات مختلفة تخدم أغراض مختلفة.  على سبيل المثال ، ReactDomComponent من مكتبة ReactDom مسؤولة عن الارتباط بين عناصر React وعناصر DOM الأصلية المقابلة لها. <br><br><h4 style=";text-align:right;direction:rtl">  مكونات مجمع مخصص </h4><br>  على الأرجح واجهت بالفعل هذا النوع من المكونات.  عند استدعاء React.createClass () أو استخدام فئات ES6 من خلال تمديد React.Component ، يمكنك إنشاء مكون مركب مخصص.  يحتوي هذا المكون على أساليب دورة الحياة ، مثل componentWillMount و shouldComponentUpdate ، وغيرها.  يمكننا إعادة تعريفهم لإضافة نوع من المنطق.  بالإضافة إلى ذلك ، يتم إنشاء طرق أخرى ، مثل mountComponent ، receComponent.  لا تستخدم React هذه الطرق إلا لأغراضها الداخلية ؛ لا نتفاعل معها بأي طريقة. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ZanudaMode = على</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  في الواقع ، لم تكتمل المكونات التي أنشأها المستخدمون في البداية.  React يلفها في ReactCompositeComponentWrapper ، والذي يضيف جميع أساليب دورة الحياة إلى مكوناتنا ، وبعد ذلك React يمكن إدارتها (إدراج ، تحديث ، وما إلى ذلك). <br></div></div><br><h3 style=";text-align:right;direction:rtl">  رد الفعل التعريفي </h3><br>  عندما يتعلق الأمر بالمكونات المخصصة ، فإن مهمتنا هي تحديد فئات هذه المكونات ، لكننا لا نقوم بإنشاء مثيل لهذه الفئات.  React يخلق لهم عند الحاجة. <br><br>  أيضًا ، لا نقوم بإنشاء عناصر بشكل صريح باستخدام نمط ضروري ؛ بدلاً من ذلك ، نكتب بأسلوب تعريفي باستخدام JSX: <br><br><pre style=";text-align:right;direction:rtl"><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">hello</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } }</code> </pre> <br>  تتم ترجمة هذا الرمز مع JSX بواسطة المحول البرمجي إلى ما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'hello'</span></span>); } }</code> </pre> <br>  وهذا ، في جوهره ، يتحول إلى بنية ضرورية لإنشاء عنصر من خلال دعوة واضحة إلى React.createElement ().  ولكن هذا البناء موجود داخل طريقة التقديم () ، والتي لا ندعوها بشكل صريح ، فإن React ستطلق على هذه الطريقة نفسها عند الضرورة.  لذلك ، فإن إدراك React هو نفس التصريح: نصف ما نريد استلامه ، و React يحدد كيفية القيام بذلك. <br><br><h3 style=";text-align:right;direction:rtl">  اكتب رد فعلك الصغير </h3><br>  بعد تلقي الأساس التقني اللازم ، سنبدأ في إنشاء تطبيق React الخاص بنا.  ستكون هذه نسخة مبسطة للغاية ، دعنا نسميها Feact. <br><br>  لنفترض أننا نريد إنشاء تطبيق Feact بسيط الذي سيكون رمزه كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Feact.render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">hello world</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'root'</span></span>));</code> </pre> <br>  أولاً ، دعنا نتطرق إلى JSX.  هذا هو بالضبط "تراجع" ، لأن تحليل JSX هو موضوع كبير منفصل سنحذفه كجزء من تطبيقنا لـ Feact.  إذا كنا نتعامل مع JSX التي تمت معالجتها ، فسنرى الرمز التالي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Feact.render( Feact.createElement(<span class="hljs-string"><span class="hljs-string">'h1'</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'hello world'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'root'</span></span>) );</code> </pre> <br>  أي أننا نستخدم Feact.createElement بدلاً من JSX.  لذلك نحن نطبق هذه الطريقة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Feact = { createElement(type, props, children) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> element = { type, <span class="hljs-attr"><span class="hljs-attr">props</span></span>: props || {} }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (children) { element.props.children = children; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element; } };</code> </pre> <br>  العنصر المرتجع هو كائن بسيط يمثل ما نريد تقديمه. <br><br><h3 style=";text-align:right;direction:rtl">  ماذا تفعل Feact.render ()؟ </h3><br>  عن طريق استدعاء Feact.render () ، نمرر معلمتين: ما نريد تقديمه وأين.  هذه هي نقطة الانطلاق لأي تطبيق React.  دعنا نكتب تنفيذ طريقة تقديم () لـ Feact: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Feact = { createElement() { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> }, render(element, container) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FeactDOMComponent(element); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> componentInstance.mountComponent(container); } };</code> </pre> <br>  عند الانتهاء من تقديم () ، نحصل على صفحة ويب منتهية.  يتم إنشاء عناصر DOM بواسطة FeactDOMComponent.  دعنا نكتب تنفيذه: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeactDOMComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(element) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement = element; } mountComponent(container) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> domElement = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement.type); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement.props.children; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textNode = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createTextNode(text); domElement.appendChild(textNode); container.appendChild(domElement); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._hostNode = domElement; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> domElement; } }</code> </pre> <br>  الأسلوب mountComponent ينشئ عنصر DOM ويخزنه في هذا. _hostNode.  لن نستخدمها الآن ، لكننا سنعود إلى ذلك في الأجزاء التالية. <br><br>  يمكن الاطلاع على الإصدار الحالي من التطبيق في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">كمان</a> . <br><br>  حرفيًا 40 سطرًا من الشفرة كانت كافية لإجراء تنفيذ بدائي لـ React.  من غير المرجح أن يغزو العالم Feact ، لكنه يعكس جيدًا ما يحدث تحت غطاء React. <br><br><h3 style=";text-align:right;direction:rtl">  إضافة مكونات مخصصة </h3><br>  يجب أن يكون Feact الخاص بنا قادرًا على عرض عناصر HTML فقط (div ، span ، إلخ) ، ولكن أيضًا المكونات المركبة المعرفة من قبل المستخدم: <br><blockquote style=";text-align:right;direction:rtl">  طريقة Feact.createElement () الموضحة مسبقًا جيدة حاليًا ، لذلك لن أكررها في قائمة الأكواد البرمجية. <br></blockquote><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Feact = { createClass(spec) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props = props; } Constructor.prototype.render = spec.render; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Constructor; }, render(element, container) { <span class="hljs-comment"><span class="hljs-comment">//      //   , //    } }; const MyTitle = Feact.createClass({ render() { return Feact.createElement('h1', null, this.props.message); } }; Feact.render({ Feact.createElement(MyTitle, { message: 'hey there Feact' }), document.getElementById('root') );</span></span></code> </pre> <br>  اسمحوا لي أن أذكرك ، إذا كانت JSX متوفرة ، فإن استدعاء طريقة التقديم () سيبدو كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Feact.render( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MyTitle</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hey there Feact"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">, document.getElementById('root') );</span></span></code> </pre> <br>  لقد مررنا فئة المكون المخصص لإنشاء العنصر.  يمكن أن يمثل عنصر React الظاهري عنصر DOM عادي أو مكون مخصص.  سنميزها كما يلي: إذا مررنا بنوع سلسلة ، فهذا عنصر DOM ؛  إذا كانت وظيفة ، فإن هذا العنصر يمثل مكونًا مخصصًا. <br><br><h3 style=";text-align:right;direction:rtl">  تحسين Feact.render () </h3><br>  إذا نظرت عن كثب إلى الشفرة في الوقت الحالي ، سترى أن Feact.render () لا يمكنه معالجة المكونات المخصصة.  دعونا إصلاح هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Feact = { render(element, container) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FeactCompositeComponentWrapper(element); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> componentInstance.mountComponent(container); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeactCompositeComponentWrapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(element) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement = element; } mountComponent(container) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement.type; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Component(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement.props); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> element = componentInstance.render(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> domComponentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FeactDOMComponent(element); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> domComponentInstance.mountComponent(container); } }</code> </pre> <br>  لقد أنشأنا مجمعا للعنصر مرت.  داخل المجمّع ، نقوم بإنشاء مثيل لفئة مكون المستخدم ونستدعي طريقة componentInstance.render () الخاصة به.  يمكن تمرير نتيجة هذه الطريقة إلى FeactDOMComponent ، حيث سيتم إنشاء عناصر DOM المقابلة. <br><br>  الآن يمكننا إنشاء وتقديم مكونات مخصصة.  ستنشئ Feact عقد DOM بناءً على المكونات المخصصة ، وتغييرها وفقًا للخصائص (الدعائم) للمكونات المخصصة لدينا.  هذا هو تحسن كبير في Feact لدينا. <br><blockquote style=";text-align:right;direction:rtl">  لاحظ أن FeactCompositeComponentWrapper مباشرة بإنشاء FeactDOMComponent.  هذه العلاقة الوثيقة سيئة.  سوف نصلح هذا لاحقا.  إذا كان React له نفس الارتباط الوثيق ، فيمكن إنشاء تطبيقات الويب فقط.  تتيح لك إضافة طبقة إضافية ReactCompositeComponentWrapper فصل منطق React لإدارة العناصر الافتراضية والعرض النهائي للعناصر الأصلية ، مما يسمح لك باستخدام React ليس فقط عند إنشاء تطبيقات الويب ، ولكن أيضًا ، على سبيل المثال ، React Native للجوال. <br></blockquote><h3 style=";text-align:right;direction:rtl">  تعزيز مكون مخصص </h3><br>  يمكن للمكونات المخصصة التي تم إنشاؤها فقط إرجاع عناصر DOM الأصلية ، إذا حاولنا إرجاع مكونات مخصصة أخرى ، فسيظهر لنا خطأ.  صحح هذا العيب.  تخيل أننا نود تنفيذ التعليمات البرمجية التالية دون أخطاء: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MyMessage = Feact.createClass({ render() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.asTitle) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Feact.createElement(MyTitle, { <span class="hljs-attr"><span class="hljs-attr">message</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.message }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Feact.createElement(<span class="hljs-string"><span class="hljs-string">'p'</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.message); } } }</code> </pre><br>  يمكن أن تعرض طريقة التقديم () للمكون المخصص إما عنصر DOM أصلي أو مكون مخصص آخر.  إذا كانت الخاصية asTitle صحيحة ، فسوف تُرجع FeactCompositeComponentWrapper المكون المخصص لـ FeactDOMComponent حيث سيحدث الخطأ.  إصلاح FeactCompositeComponentWrapper: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeactCompositeComponentWrapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(element) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement = element; } mountComponent(container) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement.type; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Component(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentElement.props); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> element = componentInstance.render(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> element.type === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { element = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> element.type(element.props)).render(); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> domComponentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FeactDOMComponent(element); domComponentInstance.mountComponent(container); } }</code> </pre><br>  في الحقيقة ، لقد حققنا الآن عكاز لتلبية الاحتياجات الحالية.  تؤدي استدعاء طريقة التجسيد إلى إرجاع المكونات الفرعية حتى تقوم بإرجاع عنصر DOM أصلي.  هذا أمر سيئ لأن هذه المكونات الفرعية لن تشارك في دورة الحياة.  على سبيل المثال ، في هذه الحالة ، لن نتمكن من تنفيذ استدعاء componentWillMount.  سوف نصلح هذا لاحقا. <br><br><h3 style=";text-align:right;direction:rtl">  ومرة أخرى نقوم بإصلاح Feact.render () </h3><br>  يمكن أن يعالج الإصدار الأول من Feact.render () عناصر DOM الأصلية فقط.  الآن تتم معالجة المكونات المعرفة من قبل المستخدم بشكل صحيح دون دعم محلي.  من الضروري التعامل مع كلتا الحالتين.  يمكنك كتابة المصنع الذي سينشئ مكونًا بناءً على نوع العنصر الذي تم تمريره ، لكن React اختار طريقة مختلفة: مجرد لف أي مكون وارد في مكون آخر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TopLevelWrapper = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props = props; }; TopLevelWrapper.prototype.render = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Feact = { render(element, container) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wrapperElement = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createElement(TopLevelWrapper, element); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> componentInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FeactCompositeComponentWrapper(wrapperElement); <span class="hljs-comment"><span class="hljs-comment">//   } };</span></span></code> </pre><br>  TopLevelWrapper هو في الأساس مكون مخصص.  يمكن تعريفه أيضًا عن طريق استدعاء Feact.createClass ().  تقوم طريقة التجسيد ببساطة بإرجاع العنصر الذي تم تمريره إليها.  الآن يتم التفاف كل عنصر في TopLevelWrapper ، وسوف يتلقى FeactCompositeComponentWrapper دائمًا مكونًا مخصصًا كمدخل. <br><br><h3 style=";text-align:right;direction:rtl">  اختتام الجزء الاول </h3><br>  قمنا بتنفيذ Feact ، والتي يمكن أن تجعل المكونات.  يظهر الرمز الذي تم إنشاؤه المفاهيم الأساسية للتقديم.  العرض الحقيقي في React أكثر تعقيدًا ، وهو يغطي الأحداث والتركيز وتصفح النوافذ والأداء وما إلى ذلك. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">jsfiddle</a> النهائي <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">للجزء</a> الأول. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458916/">https://habr.com/ru/post/ar458916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458906/index.html">[يكاترينبرج ، إعلان] Flutteron - ورشة عمل حول تطوير Flutter</a></li>
<li><a href="../ar458908/index.html">مسح المستندات عبر الشبكة</a></li>
<li><a href="../ar458910/index.html">مقارنة PostgreSQL مع صفحات لينكس الكبيرة</a></li>
<li><a href="../ar458912/index.html">الهجرة إلى زيمبرا مع imapsync</a></li>
<li><a href="../ar458914/index.html">ما (لا) تحتاج إلى معرفته لإنشاء ألعاب على الوحدة</a></li>
<li><a href="../ar458918/index.html">ما يمكن أن تتعلمه من تصميم الألعاب غير العادية</a></li>
<li><a href="../ar458920/index.html">مؤتمر لمحبي DevOps</a></li>
<li><a href="../ar458922/index.html">كيفية الانتقال من ESXi إلى KVM / LXD ولا تفقد عقلك</a></li>
<li><a href="../ar458924/index.html">الحوادث تساعدك على التعلم</a></li>
<li><a href="../ar458926/index.html">المأساة لا تأتي وحدها</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>