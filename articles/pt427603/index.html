<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÅ üçë üîª Como finalmente come√ßar a escrever testes e n√£o se arrepender üë®üèø‚Äçü§ù‚Äçüë®üèª üññüèª üßëüèø‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chegando a um novo projeto, encontro regularmente uma das seguintes situa√ß√µes: 



1. N√£o h√° testes. 
2. Existem poucos testes, eles raramente s√£o esc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como finalmente come√ßar a escrever testes e n√£o se arrepender</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/custis/blog/427603/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/vr/v7/q_/vrv7q_kwfiqd5f7qx7jxwukv62g.jpeg"></a> <br><br>  Chegando a um novo projeto, encontro regularmente uma das seguintes situa√ß√µes: <br><br><ol><li>  N√£o h√° testes. </li><li>  Existem poucos testes, eles raramente s√£o escritos e n√£o s√£o executados continuamente. </li><li>  Os testes est√£o presentes e inclu√≠dos no CI (integra√ß√£o cont√≠nua), mas causam mais danos do que benef√≠cios. </li></ol><br>  Infelizmente, √© o √∫ltimo cen√°rio que geralmente leva a s√©rias tentativas de iniciar a implementa√ß√£o de testes na aus√™ncia de habilidades apropriadas. <br><br>  O que pode ser feito para mudar a situa√ß√£o atual?  A ideia de usar testes n√£o √© nova.  Ao mesmo tempo, a maioria dos tutoriais se assemelha √† famosa figura sobre como desenhar uma coruja: conecte o JUnit, escreva o primeiro teste, use o primeiro simulador - e pronto!  Esses artigos n√£o respondem a perguntas sobre quais testes precisam ser escritos, em que vale a pena prestar aten√ß√£o e como conviver com tudo isso.  A partir daqui, a ideia deste artigo nasceu.  Tentei resumir brevemente minha experi√™ncia na implementa√ß√£o de testes em diferentes projetos, a fim de facilitar esse caminho para todos. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ra/7v/m-/ra7vm-kgn__gsmaeg6xg7aud4ey.jpeg"></div><br>  Existem artigos introdut√≥rios mais do que suficientes sobre esse t√≥pico, portanto n√£o nos repetiremos e tentaremos ir do outro lado.  Na primeira parte, desbancaremos o mito de que o teste acarreta custos exclusivamente adicionais.  Ser√° mostrado como a cria√ß√£o de testes de qualidade, por sua vez, pode acelerar o processo de desenvolvimento.  Ent√£o, no exemplo de um projeto pequeno, ser√£o considerados os princ√≠pios e regras b√°sicos que devem ser seguidos para obter esse benef√≠cio.  Finalmente, na se√ß√£o final, recomenda√ß√µes espec√≠ficas de implementa√ß√£o ser√£o fornecidas: como evitar problemas t√≠picos quando os testes come√ßam, pelo contr√°rio, diminuem significativamente o desenvolvimento. <br><br>  Como minha principal especializa√ß√£o √© o Java back-end, a seguinte pilha de tecnologia ser√° usada nos exemplos: Java, JUnit, H2, Mockito, Spring, Hibernate.  Ao mesmo tempo, uma parte significativa do artigo √© dedicada a problemas gerais de teste e as dicas s√£o aplic√°veis ‚Äã‚Äãa uma gama muito maior de tarefas. <br><br>  No entanto, tenha cuidado!  Os testes s√£o muito viciantes: depois que voc√™ aprender a us√°-los, n√£o poder√° mais viver sem eles. <br><br><div class="spoiler">  <b class="spoiler_title">Conte√∫do</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Testes versus velocidade de desenvolvimento</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Executando c√≥digo em qualquer lugar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Relan√ßando testes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Depura√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Efic√°cia</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Da teoria √† pr√°tica</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Desafio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modelo de dom√≠nio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Estrutura do projeto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Testes de integra√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Testes unit√°rios</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Recomenda√ß√µes de implementa√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conclus√£o</a> </div></div><br><a name="TestsVsSpeed"></a><h2>  Testes versus velocidade de desenvolvimento </h2><br>  As principais perguntas que surgem ao discutir a implementa√ß√£o de testes: quanto tempo levar√° para escrever testes e quais benef√≠cios ele ter√°?  Os testes, como qualquer outra tecnologia, exigir√£o esfor√ßos s√©rios para desenvolvimento e implementa√ß√£o, portanto, a princ√≠pio, nenhum benef√≠cio significativo deve ser esperado.  Quanto aos custos de tempo, eles s√£o altamente dependentes da equipe em particular.  No entanto, menos de 20 a 30% dos custos adicionais da codifica√ß√£o n√£o devem ser calculados exatamente.  Menos simplesmente n√£o √© suficiente para alcan√ßar pelo menos algum resultado.  A expectativa de retornos instant√¢neos √© frequentemente o principal motivo para restringir essa atividade antes mesmo que os testes se tornem √∫teis. <br><br>  Mas de que tipo de efici√™ncia estamos falando?  Vamos soltar as letras das dificuldades de implementa√ß√£o e ver quais oportunidades espec√≠ficas para economizar tempo nos testes se abrem. <br><br><a name="CodeRun"></a><h3>  Executando c√≥digo em qualquer lugar </h3><br>  Se n√£o houver testes no projeto, a √∫nica maneira de come√ßar √© levantar o aplicativo inteiro.  √â bom que demore cerca de 15 a 20 segundos, mas os casos de grandes projetos nos quais um lan√ßamento completo pode demorar alguns minutos est√£o longe de ser raros.  O que isso significa para os desenvolvedores?  Uma parte significativa de seu tempo de trabalho ser√£o essas breves sess√µes de espera, durante as quais √© imposs√≠vel continuar trabalhando na tarefa atual, mas ao mesmo tempo, h√° muito pouco tempo para mudar para outra coisa.  Muitos j√° encontraram pelo menos uma vez esses projetos em que o c√≥digo escrito em uma hora requer muitas horas de depura√ß√£o devido a longas reinicializa√ß√µes entre as corre√ß√µes.  Nos testes, voc√™ pode limitar-se a executar pequenas partes do aplicativo, o que reduzir√° significativamente o tempo de espera e aumentar√° a produtividade do trabalho no c√≥digo. <br><br>  Al√©m disso, a capacidade de executar c√≥digo em qualquer lugar leva a uma depura√ß√£o mais completa.  Frequentemente, verificar at√© os principais casos de uso positivos por meio da interface do aplicativo requer muito esfor√ßo e tempo.  A presen√ßa de testes torna poss√≠vel realizar uma verifica√ß√£o detalhada de uma funcionalidade espec√≠fica com muito mais facilidade e rapidez. <br><br>  Outra vantagem √© a capacidade de regular o tamanho da unidade testada.  Dependendo da complexidade da l√≥gica que est√° sendo testada, voc√™ pode restringir-se a um m√©todo, uma classe, um grupo de classes que implementa alguma funcionalidade, um servi√ßo etc., at√© a automa√ß√£o do teste de todo o aplicativo.  Essa flexibilidade permite descarregar testes de alto n√≠vel de v√°rias partes devido ao fato de que eles ser√£o testados em n√≠veis mais baixos. <br><br><a name="RepeatedRun"></a><h3>  Relan√ßando testes </h3><br>  Esse plus √© frequentemente citado como a ess√™ncia da automa√ß√£o de testes, mas vamos ver de um √¢ngulo menos familiar.  Que novas oportunidades ele abre para os desenvolvedores? <br><br>  Primeiramente, cada novo desenvolvedor que veio ao projeto poder√° executar facilmente testes existentes para entender a l√≥gica do aplicativo usando exemplos.  Infelizmente, a import√¢ncia disso √© muito subestimada.  Em condi√ß√µes modernas, as mesmas pessoas raramente trabalham em um projeto por mais de um a dois anos.  E como as equipes s√£o compostas por v√°rias pessoas, a apar√™ncia de um novo participante a cada 2-3 meses √© uma situa√ß√£o t√≠pica para projetos relativamente grandes.  Projetos particularmente dif√≠ceis est√£o passando por mudan√ßas de gera√ß√µes inteiras de desenvolvedores!  A capacidade de iniciar facilmente qualquer parte do aplicativo e observar o comportamento do sistema √†s vezes simplifica a imers√£o de novos programadores no projeto.  Al√©m disso, um estudo mais detalhado da l√≥gica do c√≥digo reduz o n√∫mero de erros cometidos na sa√≠da e o tempo para depur√°-los no futuro. <br><br>  Em segundo lugar, a capacidade de verificar facilmente se o aplicativo est√° funcionando corretamente abre caminho para a refatora√ß√£o cont√≠nua.  Infelizmente, esse termo √© muito menos popular que o IC.  Isso significa que a refatora√ß√£o pode e deve ser feita sempre que o c√≥digo √© refinado.  √â o cumprimento regular da not√≥ria regra dos escoteiros ‚Äúdeixe o estacionamento mais limpo do que era antes da sua chegada‚Äù, o que permite evitar a degrada√ß√£o do c√≥digo base e garante ao projeto uma vida longa e feliz. <br><br><a name="Debugging"></a><h3>  Depura√ß√£o </h3><br>  A depura√ß√£o j√° foi mencionada nos par√°grafos anteriores, mas esse ponto √© t√£o importante que merece uma an√°lise mais detalhada.  Infelizmente, n√£o h√° uma maneira confi√°vel de medir a rela√ß√£o entre o tempo gasto escrevendo e depurando o c√≥digo, pois esses processos s√£o praticamente insepar√°veis ‚Äã‚Äãum do outro.  No entanto, a presen√ßa de testes de qualidade no projeto reduz significativamente o tempo de depura√ß√£o, at√© a quase completa aus√™ncia da necessidade de executar um depurador. <br><br><a name="Efficiency"></a><h3>  Efic√°cia </h3><br>  Todas as op√ß√µes acima podem economizar significativamente tempo na depura√ß√£o inicial do c√≥digo.  Com a abordagem correta, somente isso pagar√° todos os custos adicionais de desenvolvimento.  Os b√¥nus de teste restantes - melhorando a qualidade da base de c√≥digo (c√≥digo mal projetado √© dif√≠cil de testar), reduzindo o n√∫mero de defeitos, a capacidade de verificar a corre√ß√£o do c√≥digo a qualquer momento etc. - ficar√£o quase gratuitos. <br><br><a name="FromTheoryToPractice"></a><h2>  Da teoria √† pr√°tica </h2><br>  Em palavras, tudo parece bom, mas vamos ao que interessa.  Como mencionado anteriormente, existem materiais mais do que suficientes sobre como fazer a configura√ß√£o inicial do ambiente de teste.  Portanto, prosseguimos imediatamente para o projeto finalizado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fontes aqui.</a> <br><br><a name="Task"></a><h3>  Desafio </h3><br>  Como uma tarefa de modelo, considere um pequeno fragmento do back-end de uma loja online.  Escreveremos uma API t√≠pica para trabalhar com produtos: criar, receber, editar.  Al√©m de alguns m√©todos para trabalhar com os clientes: alterar um "produto favorito" e calcular pontos de b√¥nus para um pedido. <br><br><a name="DomainModel"></a><h3>  Modelo de dom√≠nio </h3><br>  Para n√£o sobrecarregar o exemplo, nos restringimos a um conjunto m√≠nimo de campos e classes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/pn/pz/wcpnpz94fmrb-av0-wkkuu4l2wi.jpeg"></div><br><br>  O cliente possui um nome de usu√°rio, um link para um produto favorito e um sinalizador indicando se √© um cliente premium. <br><br>  Produto (Produto) - nome, pre√ßo, desconto e sinalizador indicando se √© atualmente anunciado. <br><br><a name="ProjectStructure"></a><h3>  Estrutura do projeto </h3><br>  A estrutura do c√≥digo principal do projeto √© a seguinte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ks/qa/m3/ksqam31c3vwkzdfwkmi8r7o3ggk.jpeg"></div><br><br>  As classes s√£o em camadas: <br><br><ul><li>  Modelo - modelo de dom√≠nio do projeto; </li><li>  Jpa - reposit√≥rios para trabalhar com bancos de dados baseados em Spring Data; </li><li>  Servi√ßo - l√≥gica de neg√≥cios da aplica√ß√£o; </li><li>  Controlador - controladores que implementam a API. </li></ul><br>  Estrutura de teste de unidade. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i3/_1/mi/i3_1micxy4kvvlb6dlgihfmmng0.jpeg"></div><br><br>  As classes de teste est√£o nos mesmos pacotes que o c√≥digo original.  Al√©m disso, foi criado um pacote com construtores para a prepara√ß√£o dos dados de teste, mas mais sobre isso abaixo. <br><br>  √â conveniente separar testes de unidade e testes de integra√ß√£o.  Eles geralmente t√™m depend√™ncias diferentes e, para um desenvolvimento confort√°vel, deve haver a capacidade de executar um ou outro.  Isso pode ser alcan√ßado de v√°rias maneiras: conven√ß√µes de nomenclatura, m√≥dulos, pacotes, sourceSets.  A escolha de um m√©todo espec√≠fico √© exclusivamente uma quest√£o de gosto.  Neste projeto, os testes de integra√ß√£o est√£o em um sourceSet - integrationTest separado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qq/1w/z7/qq1wz7n9tq77_zromu01ofx9cns.jpeg"></div><br><br>  Como os testes de unidade, as classes com testes de integra√ß√£o est√£o nos mesmos pacotes que o c√≥digo original.  Al√©m disso, existem classes base que ajudam a se livrar da duplica√ß√£o de configura√ß√£o e, se necess√°rio, cont√™m m√©todos universais √∫teis. <br><br><a name="IntegrationTests"></a><h3>  Testes de integra√ß√£o </h3><br>  Existem diferentes abordagens para quais testes valem a pena come√ßar.  Se a l√≥gica testada n√£o for muito complicada, voc√™ poder√° prosseguir imediatamente para as de integra√ß√£o (elas tamb√©m s√£o chamadas de aceita√ß√£o).  Ao contr√°rio dos testes de unidade, eles garantem que o aplicativo como um todo funcione corretamente. <br><br>  <b>Arquitetura</b> <br><br>  Primeiro, voc√™ precisa decidir em que n√≠vel espec√≠fico as verifica√ß√µes de integra√ß√£o ser√£o executadas.  O Spring Boot oferece total liberdade de escolha: voc√™ pode elevar parte do contexto, todo o contexto e at√© um servidor completo, acess√≠vel a partir dos testes.  √Ä medida que o tamanho do aplicativo aumenta, esse problema se torna cada vez mais complexo.  Muitas vezes, voc√™ precisa escrever testes diferentes em diferentes n√≠veis. <br><br>  Um bom ponto de partida seria o teste do controlador sem iniciar o servidor.  Em aplica√ß√µes relativamente pequenas, √© aceit√°vel elevar todo o contexto, pois, por padr√£o, √© reutilizado entre testes e inicializado apenas uma vez.  Considere os m√©todos b√°sicos da classe <code>ProductController</code> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@PostMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"new"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody Product product)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productService.createProduct(product); } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"{productId}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> productId) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productService.getProduct(productId); } <span class="hljs-meta"><span class="hljs-meta">@PostMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"{productId}/edit"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> productId, @RequestBody Product product) </span></span>{ productService.updateProduct(productId, product); }</code> </pre> <br>  A quest√£o do tratamento de erros √© deixada de lado.  Suponha que ele seja implementado externamente com base em uma an√°lise de exce√ß√µes lan√ßadas.  O c√≥digo dos m√©todos √© muito simples, sua implementa√ß√£o no <code>ProductService</code> n√£o <code>ProductService</code> muito mais complicada: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(readOnly = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long productId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productRepository.findById(productId) .orElseThrow(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataNotFoundException(<span class="hljs-string"><span class="hljs-string">"Product"</span></span>, productId)); } <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product(product)); } <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long productId, Product product)</span></span></span><span class="hljs-function"> </span></span>{ Product dbProduct = productRepository.findById(productId) .orElseThrow(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataNotFoundException(<span class="hljs-string"><span class="hljs-string">"Product"</span></span>, productId)); dbProduct.setPrice(product.getPrice()); dbProduct.setDiscount(product.getDiscount()); dbProduct.setName(product.getName()); dbProduct.setIsAdvertised(product.isAdvertised()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productRepository.save(dbProduct); }</code> </pre> <br>  O reposit√≥rio <code>ProductRepository</code> n√£o cont√©m seus pr√≥prios m√©todos: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre> <br>  Tudo indica que essas classes n√£o precisam de testes de unidade simplesmente porque toda a cadeia pode ser verificada com facilidade e efici√™ncia por v√°rios testes de integra√ß√£o.  A duplica√ß√£o dos mesmos testes em testes diferentes complica a depura√ß√£o.  No caso de um erro no c√≥digo, agora nenhum teste cair√°, mas 10 a 15 de uma vez.  Por sua vez, isso exigir√° uma an√°lise mais aprofundada.  Se n√£o houver duplica√ß√£o, √© prov√°vel que o √∫nico teste reprovado indique imediatamente um erro. <br><br>  <b>Configura√ß√£o</b> <br><br>  Por conveni√™ncia, destacamos a classe base <code>BaseControllerIT</code> , que cont√©m a configura√ß√£o Spring e alguns campos: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span>(webEnvironment = SpringBootTest.WebEnvironment.NONE) <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseControllerIT</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> ProductRepository productRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> CustomerRepository customerRepository; }</code> </pre> <br>  Os reposit√≥rios s√£o movidos para a classe base para n√£o confundir as classes de teste.  Sua fun√ß√£o √© exclusivamente auxiliar: preparando dados e verificando o status do banco de dados ap√≥s o controlador funcionar.  Quando voc√™ aumenta o tamanho do aplicativo, isso pode n√£o ser mais conveniente, mas, para come√ßar, √© bastante adequado. <br><br>  A configura√ß√£o principal do Spring √© definida pelas seguintes linhas: <br><br>  <code>@SpringBootTest</code> - usado para definir o contexto do aplicativo.  <code>WebEnvironment.NONE</code> significa que nenhum contexto da web precisa ser gerado. <br><br>  <code>@Transactional</code> - <code>@Transactional</code> todos os testes de classe em uma transa√ß√£o com revers√£o autom√°tica para salvar o estado do banco de dados. <br><br>  <b>Estrutura de teste</b> <br><br>  Vamos passar para um conjunto minimalista de testes para a classe <code>ProductControllerIT</code> - <code>ProductControllerIT</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct_productSaved</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = product(<span class="hljs-string"><span class="hljs-string">"productName"</span></span>).price(<span class="hljs-string"><span class="hljs-string">"1.01"</span></span>).discount(<span class="hljs-string"><span class="hljs-string">"0.1"</span></span>).advertised(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build(); Product createdProduct = productController.createProduct(product); Product dbProduct = productRepository.getOne(createdProduct.getId()); assertEquals(<span class="hljs-string"><span class="hljs-string">"productName"</span></span>, dbProduct.getName()); assertEquals(number(<span class="hljs-string"><span class="hljs-string">"1.01"</span></span>), dbProduct.getPrice()); assertEquals(number(<span class="hljs-string"><span class="hljs-string">"0.1"</span></span>), dbProduct.getDiscount()); assertEquals(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, dbProduct.isAdvertised()); }</code> </pre> <br>  O c√≥digo do teste deve ser extremamente simples e compreens√≠vel √† primeira vista.  Caso contr√°rio, a maioria das vantagens dos testes descritos na primeira se√ß√£o do artigo s√£o perdidas.  √â uma boa pr√°tica dividir o corpo de teste em tr√™s partes que podem ser visualmente separadas uma da outra: preparar dados, chamar o m√©todo de teste, validar os resultados.  Ao mesmo tempo, √© muito desej√°vel que o c√≥digo de teste caiba na tela como um todo. <br><br>  Pessoalmente, parece-me mais √≥bvio quando os valores de teste da se√ß√£o de prepara√ß√£o de dados s√£o usados ‚Äã‚Äãposteriormente nas verifica√ß√µes.  Como alternativa, voc√™ pode comparar explicitamente objetos, por exemplo, assim: <br><br><pre> <code class="java hljs">assertEquals(product, dbProduct);</code> </pre> <br>  Em outro teste para atualizar as informa√ß√µes do produto ( <code>updateProduct</code> ), fica claro que a cria√ß√£o de dados se tornou um pouco mais complicada e, para manter a integridade visual das tr√™s partes do teste, eles s√£o separados por dois feeds de linha seguidos: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateProduct_productUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = product(<span class="hljs-string"><span class="hljs-string">"productName"</span></span>).build(); productRepository.save(product); Product updatedProduct = product(<span class="hljs-string"><span class="hljs-string">"updatedName"</span></span>).price(<span class="hljs-string"><span class="hljs-string">"1.1"</span></span>).discount(<span class="hljs-string"><span class="hljs-string">"0.5"</span></span>).advertised(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build(); updatedProduct.setId(product.getId()); productController.updateProduct(product.getId(), updatedProduct); Product dbProduct = productRepository.getOne(product.getId()); assertEquals(<span class="hljs-string"><span class="hljs-string">"updatedName"</span></span>, dbProduct.getName()); assertEquals(number(<span class="hljs-string"><span class="hljs-string">"1.1"</span></span>), dbProduct.getPrice()); assertEquals(number(<span class="hljs-string"><span class="hljs-string">"0.5"</span></span>), dbProduct.getDiscount()); assertEquals(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, dbProduct.isAdvertised()); }</code> </pre> <br>  Cada uma das tr√™s partes da massa pode ser simplificada.  Para a prepara√ß√£o dos dados, os construtores de teste s√£o excelentes, os quais cont√™m a l√≥gica para criar objetos que √© conveniente para usar a partir de testes.  Chamadas de m√©todo muito complexas podem ser transformadas em m√©todos auxiliares nas classes de teste, ocultando alguns dos par√¢metros que s√£o irrelevantes para essa classe.  Para simplificar verifica√ß√µes complexas, voc√™ tamb√©m pode escrever fun√ß√µes auxiliares ou implementar seus pr√≥prios correspondentes.  O principal com todas essas simplifica√ß√µes √© n√£o perder a visibilidade do teste: tudo deve ficar claro rapidamente no m√©todo principal, sem a necessidade de aprofundar. <br><br>  <b>Construtores de teste</b> <br><br>  Os construtores de teste merecem aten√ß√£o especial.  Encapsular a l√≥gica da cria√ß√£o de objetos simplifica a manuten√ß√£o do teste.  Em particular, o preenchimento dos campos do modelo que n√£o s√£o relevantes para este teste pode ser oculto dentro do construtor.  Para fazer isso, n√£o √© necess√°rio cri√°-lo diretamente, mas use um m√©todo est√°tico que preencha os campos ausentes com valores padr√£o.  Por exemplo, se novos campos obrigat√≥rios aparecerem no modelo, eles poder√£o ser facilmente adicionados a esse m√©todo.  No <code>ProductBuilder</code> fica assim: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductBuilder() .name(name) .advertised(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) .price(<span class="hljs-string"><span class="hljs-string">"0.00"</span></span>); }</code> </pre> <br>  <b>Nome do teste</b> <br><br>  √â imperativo entender o que √© testado especificamente neste teste.  Para maior clareza, √© melhor dar uma resposta a esta pergunta em seu t√≠tulo.  Usando os testes de amostra para o m√©todo <code>getProduct</code> considere a conven√ß√£o de nomenclatura usada: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct_oneProductInDb_productReturned</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = product(<span class="hljs-string"><span class="hljs-string">"productName"</span></span>).build(); productRepository.save(product); Product result = productController.getProduct(product.getId()); assertEquals(<span class="hljs-string"><span class="hljs-string">"productName"</span></span>, result.getName()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct_twoProductsInDb_correctProductReturned</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product1 = product(<span class="hljs-string"><span class="hljs-string">"product1"</span></span>).build(); Product product2 = product(<span class="hljs-string"><span class="hljs-string">"product2"</span></span>).build(); productRepository.save(product1); productRepository.save(product2); Product result = productController.getProduct(product1.getId()); assertEquals(<span class="hljs-string"><span class="hljs-string">"product1"</span></span>, result.getName()); }</code> </pre> <br>  No caso geral, o cabe√ßalho do m√©todo de teste consiste em tr√™s partes, separadas por sublinhado: o nome do m√©todo que est√° sendo testado, o script e o resultado esperado.  No entanto, ningu√©m cancelou o bom senso e pode ser justificado omitir algumas partes do nome se elas n√£o forem necess√°rias nesse contexto (por exemplo, um script em um √∫nico teste para criar um produto).  O objetivo dessa nomea√ß√£o √© garantir que a ess√™ncia de cada teste seja compreens√≠vel sem aprender o c√≥digo.  Isso torna a janela dos resultados do teste o mais clara poss√≠vel e √© com ela que o trabalho com os testes geralmente come√ßa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gu/0k/p9/gu0kp9p5hdbswo4i8d6ti2sy1qi.jpeg"></div><br><br>  <b>Conclus√µes</b> <br><br>  Isso √© tudo.  Pela primeira vez, um conjunto m√≠nimo de quatro testes √© suficiente para testar os m√©todos da classe <code>ProductController</code> .  No caso de detec√ß√£o de erros, voc√™ sempre pode adicionar os testes ausentes.  Ao mesmo tempo, o n√∫mero m√≠nimo de testes reduz significativamente o tempo e o esfor√ßo para apoi√°-los.  Isso, por sua vez, √© fundamental no processo de implementa√ß√£o dos testes, uma vez que os primeiros testes geralmente n√£o s√£o da melhor qualidade e criam muitos problemas inesperados.  Ao mesmo tempo, esse conjunto de testes √© suficiente para receber os b√¥nus descritos na primeira parte do artigo. <br><br>  Vale ressaltar que esses testes n√£o verificam a camada da web do aplicativo, mas geralmente isso n√£o √© necess√°rio.  Se necess√°rio, voc√™ pode escrever testes separados para a camada da Web com um esbo√ßo em vez da base ( <code>@WebMvcTest</code> , <code>MockMvc</code> , <code>@MockBean</code> ) ou usar um servidor completo.  O √∫ltimo pode complicar a depura√ß√£o e o trabalho com transa√ß√µes, pois o teste n√£o pode controlar a transa√ß√£o do servidor.  Um exemplo desse teste de integra√ß√£o pode ser encontrado na classe <code>CustomerControllerServerIT</code> . <br><br><a name="UnitTests"></a><h3>  Testes unit√°rios </h3><br>  Os testes de unidade t√™m v√°rias vantagens sobre os testes de integra√ß√£o: <br><br><ul><li>  A inicializa√ß√£o leva milissegundos; </li><li>  Tamanho pequeno da unidade testada; </li><li>  √â f√°cil implementar a verifica√ß√£o de um grande n√∫mero de op√ß√µes, pois quando o m√©todo √© chamado diretamente, a prepara√ß√£o dos dados √© bastante simplificada. </li></ul><br>  Apesar disso, os testes de unidade, por natureza, n√£o podem garantir a operacionalidade do aplicativo como um todo e n√£o permitem que voc√™ evite gravar os de integra√ß√£o.  Se a l√≥gica da unidade em teste for simples, a duplica√ß√£o de testes de integra√ß√£o com testes de unidade n√£o trar√° nenhum benef√≠cio, mas apenas adicionar√° mais c√≥digo ao suporte. <br><br>  A √∫nica classe neste exemplo que merece teste de unidade √© o <code>BonusPointCalculator</code> .  Sua caracter√≠stica distintiva √© um grande n√∫mero de ramos da l√≥gica de neg√≥cios.  Por exemplo, sup√µe-se que o comprador receba b√¥nus de 10% do custo do produto, multiplicado por n√£o mais de 2 multiplicadores da lista a seguir: <br><br><ul><li>  O produto custa mais de 10.000 (√ó 4); </li><li>  O produto participa de uma campanha publicit√°ria (√ó 3); </li><li>  O produto √© o produto "favorito" do cliente (√ó 5); </li><li>  O cliente tem um status premium (√ó 2); </li><li>  Se o cliente tiver um status premium e comprar um produto ‚Äúfavorito‚Äù, em vez dos dois multiplicadores indicados, um (√ó 8) ser√° usado. </li></ul><br>  Na vida real, √© claro, valeria a pena projetar um mecanismo universal flex√≠vel para calcular esses b√¥nus, mas, para simplificar o exemplo, nos restringimos a uma implementa√ß√£o fixa.  O c√≥digo de c√°lculo do multiplicador √© assim: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;BigDecimal&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateMultipliers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Customer customer, Product product)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;BigDecimal&gt; multipliers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (customer.getFavProduct() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; customer.getFavProduct().equals(product)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (customer.isPremium()) { multipliers.add(PREMIUM_FAVORITE_MULTIPLIER); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { multipliers.add(FAVORITE_MULTIPLIER); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (customer.isPremium()) { multipliers.add(PREMIUM_MULTIPLIER); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (product.isAdvertised()) { multipliers.add(ADVERTISED_MULTIPLIER); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (product.getPrice().compareTo(EXPENSIVE_THRESHOLD) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { multipliers.add(EXPENSIVE_MULTIPLIER); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> multipliers; }</code> </pre> <br>  Um grande n√∫mero de op√ß√µes leva ao fato de que dois ou tr√™s testes de integra√ß√£o n√£o s√£o limitados aqui.  Um conjunto minimalista de testes de unidade √© perfeito para depurar essa funcionalidade. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bk/jw/ai/bkjwai9dy1mrxxarxncx6jgfehq.jpeg"></div><br><br>  O conjunto de testes correspondente pode ser encontrado na classe <code>BonusPointCalculatorTest</code> .  Aqui est√£o alguns deles: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate_oneProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = product(<span class="hljs-string"><span class="hljs-string">"product"</span></span>).price(<span class="hljs-string"><span class="hljs-string">"1.00"</span></span>).build(); Customer customer = customer(<span class="hljs-string"><span class="hljs-string">"customer"</span></span>).build(); Map&lt;Product, Long&gt; quantities = mapOf(product, <span class="hljs-number"><span class="hljs-number">1L</span></span>); BigDecimal bonus = bonusPointCalculator.calculate(customer, list(product), quantities::get); BigDecimal expectedBonus = bonusPoints(<span class="hljs-string"><span class="hljs-string">"0.10"</span></span>).build(); assertEquals(expectedBonus, bonus); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate_favProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = product(<span class="hljs-string"><span class="hljs-string">"product"</span></span>).price(<span class="hljs-string"><span class="hljs-string">"1.00"</span></span>).build(); Customer customer = customer(<span class="hljs-string"><span class="hljs-string">"customer"</span></span>).favProduct(product).build(); Map&lt;Product, Long&gt; quantities = mapOf(product, <span class="hljs-number"><span class="hljs-number">1L</span></span>); BigDecimal bonus = bonusPointCalculator.calculate(customer, list(product), quantities::get); BigDecimal expectedBonus = bonusPoints(<span class="hljs-string"><span class="hljs-string">"0.10"</span></span>).addMultiplier(FAVORITE_MULTIPLIER).build(); assertEquals(expectedBonus, bonus); }</code> </pre> <br>  Vale ressaltar que nos testes nos referimos especificamente √† API p√∫blica da classe - o m√©todo de <code>calculate</code> .  Testar um contrato de classe em vez de sua implementa√ß√£o evita quebras de testes devido a altera√ß√µes n√£o funcionais e refatora√ß√£o. <br><br>  Finalmente, quando verificamos a l√≥gica interna com testes de unidade, n√£o precisamos mais colocar todos esses detalhes em integra√ß√£o.  Nesse caso, basta um teste mais ou menos representativo, por exemplo: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateBonusPoints_twoProductTypes_correctValueCalculated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product1 = product(<span class="hljs-string"><span class="hljs-string">"product1"</span></span>).price(<span class="hljs-string"><span class="hljs-string">"1.01"</span></span>).build(); Product product2 = product(<span class="hljs-string"><span class="hljs-string">"product2"</span></span>).price(<span class="hljs-string"><span class="hljs-string">"10.00"</span></span>).build(); productRepository.save(product1); productRepository.save(product2); Customer customer = customer(<span class="hljs-string"><span class="hljs-string">"customer"</span></span>).build(); customerRepository.save(customer); Map&lt;Long, Long&gt; quantities = mapOf(product1.getId(), <span class="hljs-number"><span class="hljs-number">1L</span></span>, product2.getId(), <span class="hljs-number"><span class="hljs-number">2L</span></span>); BigDecimal bonus = customerController.calculateBonusPoints( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CalculateBonusPointsRequest(<span class="hljs-string"><span class="hljs-string">"customer"</span></span>, quantities) ); BigDecimal bonusPointsProduct1 = bonusPoints(<span class="hljs-string"><span class="hljs-string">"0.10"</span></span>).build(); BigDecimal bonusPointsProduct2 = bonusPoints(<span class="hljs-string"><span class="hljs-string">"1.00"</span></span>).quantity(<span class="hljs-number"><span class="hljs-number">2</span></span>).build(); BigDecimal expectedBonus = bonusPointsProduct1.add(bonusPointsProduct2); assertEquals(expectedBonus, bonus); }</code> </pre> <br>  Como no caso de testes de integra√ß√£o, o conjunto de testes de unidade usado √© muito pequeno e n√£o garante a total corre√ß√£o da aplica√ß√£o.  No entanto, sua presen√ßa aumenta significativamente a confian√ßa no c√≥digo, facilita a depura√ß√£o e concede os outros b√¥nus listados na primeira parte do artigo. <br><br><a name="ImplementationConsiderations"></a><h2>  Recomenda√ß√µes de implementa√ß√£o </h2><br>  Espero que as se√ß√µes anteriores tenham sido suficientes para convencer pelo menos um desenvolvedor a tentar come√ßar a usar testes em seu projeto.  Este cap√≠tulo listar√° brevemente as principais recomenda√ß√µes que ajudar√£o a evitar problemas s√©rios e reduzir√£o os custos iniciais de implementa√ß√£o. <br><br>  <b>Tente come√ßar a implementar os testes no novo aplicativo.</b>  Escrever os primeiros testes em um grande projeto legado ser√° muito mais dif√≠cil e exigir√° mais habilidade do que em um rec√©m-criado.  Portanto, se poss√≠vel, √© melhor come√ßar com um novo aplicativo pequeno.  Se novos aplicativos completos n√£o forem esperados, voc√™ pode tentar desenvolver algum utilit√°rio √∫til para uso interno.  O principal √© que a tarefa deve ser mais ou menos realista - exemplos inventados n√£o fornecer√£o uma experi√™ncia completa. <br><br>  <b>Configure execu√ß√µes de teste regulares.</b>  Se os testes n√£o forem executados regularmente, eles n√£o apenas param de executar sua fun√ß√£o principal - verificar a corre√ß√£o do c√≥digo - mas tamb√©m rapidamente se tornam desatualizados.  Portanto, √© extremamente importante configurar pelo menos o pipeline m√≠nimo de IC com o lan√ßamento autom√°tico de testes sempre que o c√≥digo for atualizado no reposit√≥rio. <br><br>  <b>N√£o persiga a tampa.</b>  Como no caso de qualquer outra tecnologia, a princ√≠pio os testes n√£o ser√£o obtidos da melhor qualidade.  A literatura relevante (links no final do artigo) ou um mentor competente pode ajudar aqui, mas isso n√£o cancela a necessidade de cones autoadesivos.  Os testes nesse sentido s√£o semelhantes ao restante do c√≥digo: para entender como eles afetar√£o o projeto, √© poss√≠vel somente depois de viver com eles por um tempo.  Portanto, para minimizar os danos, a primeira vez √© melhor n√£o perseguir o n√∫mero e n√∫meros bonitos como cem por cento de cobertura.  Em vez disso, voc√™ deve limitar-se aos principais cen√°rios positivos para a sua pr√≥pria funcionalidade de aplicativo. <br><br>  <b>N√£o se deixe levar pelos testes de unidade.</b>  Continuando o tema ‚Äúquantidade versus qualidade‚Äù, deve-se notar que testes de unidade honestos n√£o devem ser realizados pela primeira vez, porque isso pode facilmente levar a especifica√ß√µes excessivas da aplica√ß√£o.  Por sua vez, isso se tornar√° um s√©rio fator inibidor nas subsequentes melhorias na refatora√ß√£o e aplica√ß√£o.  Os testes de unidade devem ser usados ‚Äã‚Äãapenas se houver l√≥gica complexa em uma classe ou grupo de classes espec√≠fico, o que √© inconveniente para verificar no n√≠vel de integra√ß√£o. <br><br>  <b>N√£o se empolgue com classes de stub e m√©todos de aplica√ß√£o.</b>  Os stubs (stub, mock) s√£o outra ferramenta que requer uma abordagem equilibrada e a manuten√ß√£o de um equil√≠brio.  Por um lado, o isolamento completo da unidade permite que voc√™ se concentre na l√≥gica testada e n√£o pense no resto do sistema.  Por outro lado, isso exigir√° tempo de desenvolvimento adicional e, como nos testes de unidade, pode levar √† especifica√ß√£o excessiva de comportamento. <br><br>  <b>Desatar testes de integra√ß√£o de sistemas externos.</b>  Um erro muito comum nos testes de integra√ß√£o √© o uso de um banco de dados real, filas de mensagens e outros sistemas externos ao aplicativo.  Obviamente, a capacidade de executar um teste em um ambiente real √© √∫til para depura√ß√£o e desenvolvimento.  Tais testes em pequenas quantidades podem fazer sentido, especialmente para execu√ß√£o interativa.  No entanto, seu uso generalizado leva a v√°rios problemas: <br><br><ol><li>  Para executar os testes, voc√™ precisar√° configurar o ambiente externo.  Por exemplo, instale um banco de dados em cada m√°quina em que o aplicativo ser√° montado.  Isso dificultar√° a entrada de novos desenvolvedores no projeto e a configura√ß√£o do IC. </li><li>  O estado dos sistemas externos pode variar em m√°quinas diferentes antes de executar os testes.  Por exemplo, o banco de dados j√° pode conter as tabelas que o aplicativo precisa com dados que n√£o s√£o esperados no teste.  Isso levar√° a falhas imprevis√≠veis nos testes e sua elimina√ß√£o exigir√° uma quantidade significativa de tempo. </li><li>  Se houver trabalho paralelo em v√°rios projetos, √© poss√≠vel a influ√™ncia n√£o √≥bvia de alguns projetos em outros.  Por exemplo, configura√ß√µes espec√≠ficas do banco de dados feitas para um dos projetos podem ajudar a funcionalidade de outro projeto a funcionar corretamente, o que, no entanto, ser√° interrompido quando iniciado em um banco de dados limpo em outra m√°quina. </li><li>  Os testes s√£o realizados por um longo tempo: uma execu√ß√£o completa pode chegar a dezenas de minutos.  Isso leva ao fato de que os desenvolvedores param de executar testes localmente e analisam seus resultados somente ap√≥s enviar as altera√ß√µes para o reposit√≥rio remoto.  Esse comportamento nega a maioria das vantagens dos testes, discutidos na primeira parte do artigo. </li></ol><br>  <b>Limpe o contexto entre testes de integra√ß√£o.</b>  Freq√ºentemente, para acelerar o trabalho de testes de integra√ß√£o, √© necess√°rio reutilizar o mesmo contexto entre eles.  At√© a documenta√ß√£o oficial do Spring faz essa recomenda√ß√£o.  Ao mesmo tempo, a influ√™ncia dos testes um no outro deve ser evitada.  Como s√£o lan√ßadas em uma ordem arbitr√°ria, a presen√ßa de tais conex√µes pode levar a erros irreprodut√≠veis aleat√≥rios.  Para impedir que isso aconte√ßa, os testes n√£o devem deixar para tr√°s nenhuma altera√ß√£o no contexto.  Por exemplo, ao usar um banco de dados, para isolamento, geralmente √© suficiente reverter todas as transa√ß√µes confirmadas no teste.  Se n√£o for poss√≠vel evitar altera√ß√µes no contexto, voc√™ poder√° configurar sua recrea√ß√£o usando a anota√ß√£o <code>@DirtiesContext</code> . <br><br> <b>  ,      .</b>         ,       - .    ,            .  ,   , ‚Äî      ,           . <br><br> <b>      .</b>      ,    ,       . ,    ,       . <br><br> <b>   TDD (Test-Driven Development).</b> TDD    ,      ,     .  ,        ,     .   ,         ,        . <br><br><h2>   ,  ? </h2><br>              ,  : <br><br><ol><li>       (  )?             . </li><li>           ,      ( ,  CI)?    . </li><li>     ?                     . </li><li>     ?    .   ,      ,      . </li></ol><br>        ,      .     , , -   .   ‚Äî           . <br><br><a name="Conclusion"></a><h2>  Conclus√£o </h2><br>       ,     .    -    ,    .  ,  -      .        ‚Äî         ,      ,    -.      ,                 . <br><br> ,    ,        ,            ! <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   GitHub</a> <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Growing Object-Oriented Software, Guided by Tests</a> , Steve Freeman, Nat Pryce <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">The Art of Unit Testing</a> , Roy Osherove <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Test-driven Development: By Example</a> , Kent Beck <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Refactoring: Improving the Design of Existing Code</a> , Martin Fowler <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427603/">https://habr.com/ru/post/pt427603/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427589/index.html">Escrevemos um bate-papo on-line no Websockets usando o Swoole</a></li>
<li><a href="../pt427591/index.html">Arquitetura como um fardo</a></li>
<li><a href="../pt427593/index.html">Magia de Comando R√°pido em Vivaldi 2.1</a></li>
<li><a href="../pt427595/index.html">Tente Micronaut ou Darling, eu reduzi o quadro</a></li>
<li><a href="../pt427601/index.html">Caso 5 + 1 em que a especifica√ß√£o da API REST desempenha um grande papel</a></li>
<li><a href="../pt427605/index.html">Como a plataforma de crowdsourcing da Yandex ajuda a treinar drones e avaliar a qualidade do servi√ßo</a></li>
<li><a href="../pt427607/index.html">Datacenter na Su√≠√ßa: trabalhar como um rel√≥gio</a></li>
<li><a href="../pt427609/index.html">Resolvendo a equa√ß√£o com divis√£o inteira sem for√ßa bruta</a></li>
<li><a href="../pt427611/index.html">A hist√≥ria de como eu atualizei o Yandex MapKit no iOS ou mapas, dinheiro, 2 mappits</a></li>
<li><a href="../pt427613/index.html">10 blogs √∫teis para programadores em ingl√™s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>