<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåû üßïüèæ üê§ "Last Resort" oder warum Database First Design ben√∂tigt wird ü§≠ üí™üèæ üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem sehr sp√§ten Artikel werde ich erkl√§ren, warum Sie meiner Meinung nach in den meisten F√§llen bei der Entwicklung eines Datenmodells f√ºr eine ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Last Resort" oder warum Database First Design ben√∂tigt wird</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413597/"><p>  In diesem sehr sp√§ten Artikel werde ich erkl√§ren, warum Sie meiner Meinung nach in den meisten F√§llen bei der Entwicklung eines Datenmodells f√ºr eine Anwendung den ersten Ansatz der Datenbank befolgen m√ºssen.  Anstelle des Ansatzes ‚ÄûJava [jede andere Sprache] zuerst‚Äú, der Sie zu einem langen Weg voller Schmerzen und Leiden f√ºhrt, sobald das Projekt zu wachsen beginnt. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2ae/fcf/aaf/2aefcfaafbeb94adc7a73ec265b5feb1.png" alt="Bild"><br>  <em>"Too Busy to Be Better" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lizenzierter CC</a> von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alan O'Rourke / Audience Stack</a> .</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Originalbild</a></em> <em><br></em> </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dieser Artikel wurde von einer aktuellen StackOverflow-Frage inspiriert</a> . </p><br><p>  Interessante reddit Diskussionen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">/ r / java</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">/ r / Programmierung</a> . </p><br><h2 id="kodogeneraciya">  Codegenerierung </h2><br><p>  Zu meiner √úberraschung scheint eine kleine Gruppe von Benutzern schockiert gewesen zu sein, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jOOQ</a> stark mit der Generierung von Quellcode verbunden ist. </p><br><p>  W√§hrend Sie jOOQ genau so verwenden k√∂nnen, wie Sie m√∂chten, besteht die bevorzugte Methode (gem√§√ü Dokumentation) darin, mit dem vorhandenen Datenbankschema zu beginnen und dann die erforderlichen Clientklassen (entsprechend Ihren Tabellen) mit jOOQ zu generieren. Danach ist es einfach, typsicher zu schreiben Abfragen f√ºr diese Tabellen: </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Record2&lt;String, String&gt; record : DSL.using(configuration) <span class="hljs-comment"><span class="hljs-comment">// ^^^^^^^^^^^^^^^^^^^^^^^ Type information derived from the // generated code referenced from the below SELECT clause .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME) // vvvvv ^^^^^^^^^^^^ ^^^^^^^^^^^^^^^ Generated names .from(ACTOR) .orderBy(1, 2)) { // ... }</span></span></code> </pre> <br><p>  Der Code kann entweder manuell au√üerhalb der Baugruppe oder automatisch mit jeder Baugruppe generiert werden.  Eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">solche Generierung kann beispielsweise unmittelbar nach der Installation von Flyway-Migrationen erfolgen</a> , die auch manuell oder automatisch gestartet werden k√∂nnen. </p><br><h3 id="generaciya-ishodnogo-koda">  Quellcode-Generierung </h3><br><p>  Es gibt verschiedene Philosophien, Vor- und Nachteile in Bezug auf diese Ans√§tze zur Codegenerierung, die ich in diesem Artikel nicht diskutieren m√∂chte.  Im Wesentlichen bedeutet der generierte Code jedoch, dass es sich um eine Java-Darstellung dessen handelt, was wir als eine Art "Standard" betrachten (sowohl innerhalb als auch au√üerhalb unseres Systems).  In gewisser Weise machen Compiler dasselbe, wenn sie Bytecode, Maschinencode oder einen anderen Quellcode aus der Quelle generieren. Dadurch erhalten wir eine Vorstellung von unserem ‚ÄûStandard‚Äú in einer anderen spezifischen Sprache. </p><br><p>  Es gibt einige solcher Codegeneratoren.  Beispielsweise kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">XJC Java-Code aus XSD- oder WSDL-Dateien generieren</a> .  Das Prinzip ist immer dasselbe: </p><br><ul><li>  Es gibt einige Standards (extern oder intern), wie z. B. Spezifikation, Datenmodell usw. </li><li>  Es ist notwendig, sich in unserer √ºblichen Programmiersprache ein Bild von diesem Standard zu machen. </li></ul><br><p>  Und fast immer ist es sinnvoll, diese Ansicht zu <em>generieren</em> , um unn√∂tige Arbeit und unn√∂tige Fehler zu vermeiden. </p><br><h3 id="type-providers-i-obrabotka-annotaciy">  Typanbieter und Anmerkungsverarbeitung </h3><br><p>  Es ist bemerkenswert, dass ein anderer, modernerer Ansatz zur Codegenerierung in jOOQ Type Providers ist ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie in F #</a> ), bei dem der Code vom Compiler w√§hrend der Kompilierung generiert wird und niemals in der urspr√ºnglichen Form vorhanden ist.  Ein √§hnliches (aber weniger ausgefeiltes) Tool in Java sind Annotationsprozessoren wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lombok</a> . </p><br><p>  In beiden F√§llen ist alles das gleiche wie bei der normalen Codegenerierung, au√üer: </p><br><ul><li>  Sie sehen den generierten Code nicht (vielleicht ist dies f√ºr viele ein gro√ües Plus?) </li><li>  Sie m√ºssen sicherstellen, dass Ihre ‚ÄûReferenz‚Äú bei jeder Zusammenstellung verf√ºgbar ist.  Dies verursacht keine Probleme im Fall von Lombok, das den Quellcode selbst direkt kommentiert, was in diesem Fall der "Standard" ist.  Etwas komplizierter bei Datenbankmodellen, die auf einer aktiven Live-Verbindung basieren. </li></ul><br><h2 id="v-chem-problema-s-generaciey-koda">  Was ist das Problem bei der Codegenerierung? </h2><br><p>  Neben der kniffligen Frage, ob der Code manuell oder automatisch generiert werden soll, denken einige Leute, dass der Code √ºberhaupt nicht generiert werden muss.  Der Grund, den ich am h√§ufigsten h√∂re, ist, dass eine solche Generierung in der CI / CD-Pipeline schwer zu implementieren ist.  Und ja, es ist wahr, weil  Wir erhalten Overhead f√ºr die Erstellung und Unterst√ºtzung zus√§tzlicher Infrastrukturen, insbesondere wenn Sie mit den verwendeten Tools (jOOQ, JAXB, Hibernate usw.) noch nicht vertraut sind. </p><br><p>  Wenn der Aufwand f√ºr das Studium des Codegenerators zu hoch ist, hat dies nur einen geringen Nutzen.  Dies ist jedoch das einzige Argument dagegen.  In den meisten anderen F√§llen macht es absolut keinen Sinn, Code manuell zu schreiben, was die √ºbliche Darstellung eines Modells von etwas ist. </p><br><p>  Viele Leute behaupten, dass sie daf√ºr keine Zeit haben, weil  Im Moment m√ºssen Sie so schnell wie m√∂glich ein weiteres MVP einf√ºhren.  Und sie werden irgendwann sp√§ter in der Lage sein, ihre CI / CD-Pipeline fertigzustellen.  In solchen F√§llen sage ich normalerweise: "Sie sind zu besch√§ftigt, um besser zu werden." </p><br><h2 id="no-ved-hibernatejpa-delaet-java-first-razrabotku-gorazdo-prosche">  "Aber Hibernate / JPA erleichtert die erste Entwicklung von Java erheblich." </h2><br><p>  Ja es ist wahr.  Dies ist sowohl eine Freude als auch ein Schmerz f√ºr Benutzer im Ruhezustand.  Mit ihm k√∂nnen Sie einfach mehrere Objekte des Formulars schreiben: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String title; }</code> </pre> <br><p>  Und das ist fast geschafft.  Als n√§chstes √ºbernimmt Hibernate die gesamte Routine zum Definieren dieses Objekts in DDL und im gew√ºnschten SQL-Dialekt: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALWAYS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, title <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_book PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> i_book_title <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> book (title);</code> </pre> <br><p>  Dies ist wirklich eine gro√üartige M√∂glichkeit, schnell mit der Entwicklung zu beginnen - Sie m√ºssen nur die Anwendung starten. </p><br><p>  Aber nicht alles ist so rosig.  Es gibt noch viele Fragen: </p><br><ul><li>  Wird Hibernate den Namen generieren, den ich f√ºr den Prim√§rschl√ºssel ben√∂tige? </li><li>  Werde ich den Index erstellen, den ich f√ºr das Feld TITLE ben√∂tige? </li><li>  Wird f√ºr jeden Datensatz ein eindeutiger ID-Wert generiert? </li></ul><br><p>  Es scheint nicht.  W√§hrend das Projekt entwickelt wird, k√∂nnen Sie Ihre aktuelle Datenbank jederzeit wegwerfen und alles von Grund auf neu generieren, indem Sie dem Modell die erforderlichen Anmerkungen hinzuf√ºgen. <br>  Die Buchklasse in ihrer endg√ºltigen Form sieht also ungef√§hr so ‚Äã‚Äãaus: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"book"</span></span>, indexes = { <span class="hljs-meta"><span class="hljs-meta">@Index</span></span>(name = <span class="hljs-string"><span class="hljs-string">"i_book_title"</span></span>, columnList = <span class="hljs-string"><span class="hljs-string">"title"</span></span>) }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = IDENTITY) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String title; }</code> </pre> <br><h2 id="no-vy-zaplatite-za-eto-chut-pozzhe">  Aber Sie werden etwas sp√§ter daf√ºr bezahlen </h2><br><p>  Fr√ºher oder sp√§ter wird Ihre Anwendung in Produktion genommen, und das beschriebene Schema funktioniert nicht mehr: </p><br><blockquote>  In einem lebendigen und realen System k√∂nnen Sie Ihre Datenbank nicht mehr nur abholen und ablegen, weil  Daten werden darin verwendet und k√∂nnen viel Geld kosten. </blockquote><p>  Von nun an m√ºssen Sie Migrationsskripte f√ºr jede √Ñnderung im Datenmodell schreiben, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">z. B. mit Flyway</a> .  Was passiert jedoch mit Ihren Kundenklassen?  Sie k√∂nnen sie entweder manuell anpassen (was zu doppelter Arbeit f√ºhrt) oder Hibernate bitten, sie zu generieren (aber wie wahrscheinlich ist es, dass die Ergebnisse dieser Generierung die Erwartungen erf√ºllen?).  Infolgedessen k√∂nnen Sie gro√üe Probleme erwarten. </p><br><p>  Sobald der Code in Produktion geht, m√ºssen fast sofort und so schnell wie m√∂glich Korrekturen vorgenommen werden. </p><br><p>  Und weil  Die Installation von Datenbankmigrationen ist nicht in Ihre Fertigungslinie integriert. Sie m√ºssen solche Patches manuell auf eigenes Risiko installieren.  Es wird nicht genug Zeit geben, um zur√ºck zu gehen und alles richtig zu machen.  Es reicht nur aus, Hibernate f√ºr all seine Probleme verantwortlich zu machen. </p><br><p>  Stattdessen h√§tten Sie von Anfang an ganz anders handeln k√∂nnen.  Verwenden Sie n√§mlich runde R√§der anstelle von quadratischen. </p><br><h2 id="vpered-k-database-first">  Gehen Sie zuerst zur Datenbank </h2><br><p>  Die Referenz und Steuerung des Datenschemas befindet sich im B√ºro Ihres DBMS.  Eine Datenbank ist der einzige Ort, an dem ein Schema definiert ist, und alle Clients haben eine <em>Kopie</em> dieses Schemas, aber nicht umgekehrt.  Die Daten befinden sich in Ihrer Datenbank und nicht in Ihrem Client. Daher ist es sinnvoll, die Kontrolle √ºber das Schema und seine Integrit√§t genau dort zu √ºbernehmen, wo sich die Daten befinden. </p><br><p>  Das ist alte Weisheit, nichts Neues.  Prim√§r- und eindeutige Schl√ºssel sind gut.  Fremdschl√ºssel sind wundersch√∂n.  Das √úberpr√ºfen der Einschr√§nkungen auf der Datenbankseite ist wunderbar.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Behauptung (wenn sie endlich implementiert sind) ist</a> gro√üartig. </p><br><p>  Und das ist noch nicht alles.  Wenn Sie beispielsweise Oracle verwenden, k√∂nnen Sie Folgendes angeben: </p><br><ul><li>  In welchem ‚Äã‚ÄãTablespace befindet sich Ihre Tabelle? </li><li>  Was bedeutet PCTFREE? </li><li>  Wie gro√ü ist der Sequenzcache? </li></ul><br><p>  Vielleicht spielt all dies auf kleinen Systemen keine Rolle, aber auf gr√∂√üeren Systemen m√ºssen Sie nicht dem Pfad von "Big Data" folgen, bis Sie alle S√§fte aus Ihrem aktuellen Speicher herausgepresst haben.  Mit keinem einzigen ORM, den ich jemals gesehen habe (einschlie√ülich jOOQ), k√∂nnen Sie den vollst√§ndigen Satz von DDL-Parametern verwenden, die Ihr DBMS bereitstellt.  ORMs bieten nur einige Tools, mit denen Sie DDL schreiben k√∂nnen. </p><br><p>  Letztendlich sollte ein gut gestaltetes Schema nur manuell mit einer DBMS-spezifischen DDL geschrieben werden.  Alle automatisch generierten DDLs sind nur eine Ann√§herung daran. </p><br><h2 id="chto-naschet-klientskoy-modeli">  Was ist mit dem Kundenmodell? </h2><br><p>  Wie bereits erw√§hnt, ben√∂tigen Sie eine bestimmte Darstellung des Datenbankschemas auf der Clientseite.  Diese Ansicht muss nat√ºrlich mit dem realen Modell synchronisiert werden.  Wie kann man das machen?  Nat√ºrlich mit Codegeneratoren. </p><br><p>  Alle Datenbanken bieten Zugriff auf ihre Metainformationen √ºber das gute alte SQL.  So k√∂nnen Sie beispielsweise eine Liste aller Tabellen aus verschiedenen Datenbanken abrufen: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server SELECT table_schema, table_name FROM information_schema.tables -- DB2 SELECT tabschema, tabname FROM syscat.tables -- Oracle SELECT owner, table_name FROM all_tables -- SQLite SELECT name FROM sqlite_master -- Teradata SELECT databasename, tablename FROM dbc.tables</span></span></code> </pre> <br><p>  Es sind solche Abfragen (sowie √§hnliche Abfragen f√ºr Ansichten, materialisierte Ansichten und Tabellenfunktionen), die ausgef√ºhrt werden, wenn die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DatabaseMetaData.getTables ()</a> -Methode eines bestimmten JDBC-Treibers aufgerufen wird, oder im jOOQ-Metamodul. </p><br><p>  Aus den Ergebnissen solcher Abfragen ist es relativ einfach, eine Client-Darstellung des Datenbankmodells zu erstellen, unabh√§ngig davon, welche Datenzugriffstechnologie verwendet wird. </p><br><ul><li>  Wenn Sie JDBC oder Spring verwenden, k√∂nnen Sie eine Gruppe von String-Konstanten erstellen </li><li>  Wenn Sie JPA verwenden, k√∂nnen Sie Objekte selbst erstellen </li><li>  Wenn Sie jOOQ verwenden, k√∂nnen Sie jOOQ-Metamodelle erstellen </li></ul><br><p>  Abh√§ngig von der Anzahl der Funktionen, die Ihre Datenzugriffs-API bietet (jOOQ, JPA oder etwas anderes), kann das generierte Metamodell sehr umfangreich und vollst√§ndig sein.  Als Beispiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die implizite Verkn√ºpfungsfunktion in jOOQ 3.11, die auf Metainformationen √ºber die Beziehungen von Fremdschl√ºsseln zwischen Ihren Tabellen basiert</a> . </p><br><p>  Jetzt f√ºhrt jede √Ñnderung am Datenbankschema automatisch zu einer Aktualisierung des Client-Codes. </p><br><p>  Stellen Sie sich vor, Sie m√ºssen eine Spalte in einer Tabelle umbenennen: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book <span class="hljs-keyword"><span class="hljs-keyword">RENAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> book_title;</code> </pre> <br><p>  Sind Sie sicher, dass Sie diese Arbeit zweimal ausf√ºhren m√∂chten?  Auf keinen Fall.  √úbernehmen Sie einfach diese DDL, f√ºhren Sie den Build aus und genie√üen Sie das aktualisierte Objekt: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"book"</span></span>, indexes = { <span class="hljs-comment"><span class="hljs-comment">// Would you have thought of this? @Index(name = "i_book_title", columnList = "book_title") }) class Book { @Id @GeneratedValue(strategy = IDENTITY) int id; @Column("book_title") String **bookTitle**; }</span></span></code> </pre> <br><p>  Au√üerdem muss der empfangene Client nicht jedes Mal kompiliert werden (zumindest bis zur n√§chsten √Ñnderung des Datenbankschemas), was bereits ein gro√ües Plus sein kann! <br>  Die meisten DDL-√Ñnderungen sind auch semantische √Ñnderungen, nicht nur syntaktische.  Daher ist es gro√üartig, im generierten Client-Code zu sehen, welche genauen √Ñnderungen in der Datenbank betroffen sind. </p><br><h2 id="pravda-vsegda-odna">  Die Wahrheit ist immer allein </h2><br><p>  Unabh√§ngig davon, welche Technologie Sie verwenden, sollte es immer nur ein Modell geben, das der Standard f√ºr das Subsystem ist.  Oder zumindest sollten wir uns darum bem√ºhen und Verwirrung im Gesch√§ftsleben vermeiden, wo der ‚ÄûStandard‚Äú √ºberall und nirgendwo gleichzeitig ist.  Es macht alles viel einfacher.  Wenn Sie beispielsweise XML-Dateien f√ºr ein anderes System freigeben, verwenden Sie wahrscheinlich XSD.  Als Metamodell INFORMATION_SCHEMA jOOQ im XML-Format: <a href="">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</a> </p><br><ul><li>  XSD ist gut verstanden </li><li>  XSD beschreibt XML-Inhalte perfekt und erm√∂glicht die Validierung in allen Client-Sprachen </li><li>  XSD macht die Versionierung einfach und abw√§rtskompatibel </li><li>  XSD kann mit XJC in Java-Code umgewandelt werden </li></ul><br><p>  Besonderes Augenmerk legen wir auf den letzten Punkt.  Bei der Kommunikation mit einem externen System √ºber XML-Nachrichten m√ºssen wir uns der G√ºltigkeit der Nachrichten sicher sein.  Und mit Dingen wie JAXB, XJC und XSD ist das wirklich sehr einfach.  Es w√§re verr√ºckt, √ºber die Angemessenheit des Java-First-Ansatzes in diesem Fall nachzudenken.  Das auf der Grundlage der XML-Objekte generierte XML ist von schlechter Qualit√§t, schlecht dokumentiert und schwer zu erweitern.  Und wenn es eine SLA f√ºr eine solche Interaktion gibt, werden Sie entt√§uscht sein. </p><br><p>  Ehrlich gesagt √§hnelt dies dem, was jetzt mit den verschiedenen JSON-APIs passiert, aber das ist eine ganz andere Geschichte ... </p><br><h3 id="chem-bazy-dannyh-huzhe">  Was macht Datenbanken schlimmer? </h3><br><p>  Bei der Arbeit mit einer Datenbank ist hier alles gleich.  Die Datenbank besitzt die Daten und muss auch der Master des Datenschemas sein.  Alle Schema√§nderungen m√ºssen direkt √ºber DDL vorgenommen werden, um die Referenz zu aktualisieren. </p><br><p>  Nach der Aktualisierung der Referenz sollten alle Kunden ihre Vorstellungen zum Modell aktualisieren.  Einige Clients k√∂nnen mit jOOQ und / oder Hibernate oder JDBC in Java geschrieben werden.  Andere Kunden k√∂nnen in Perl (viel Gl√ºck f√ºr sie) oder sogar in C # geschrieben werden.  Es spielt keine Rolle.  Das Hauptmodell befindet sich in der Datenbank.  Mit ORM erstellte Modelle sind zwar von schlechter Qualit√§t, jedoch nicht gut dokumentiert und schwer zu erweitern. </p><br><p>  Tun Sie dies daher nicht und von Anfang an.  Beginnen Sie stattdessen mit einer Datenbank.  Erstellen Sie eine automatisierte CI / CD-Pipeline.  Verwenden Sie die Codegenerierung, um automatisch ein Datenbankmodell f√ºr Clients f√ºr jeden Build zu generieren.  Und h√∂r auf, dir Sorgen zu machen, alles wird gut.  Alles, was erforderlich ist, ist ein kleiner anf√§nglicher Aufwand zum Aufbau der Infrastruktur, aber als Ergebnis erhalten Sie f√ºr den Rest Ihres Projekts √ºber Jahre hinweg einen Gewinn im Entwicklungsprozess. </p><br><p>  Nein danke. </p><br><h2 id="poyasneniya">  Erkl√§rungen </h2><br><p>  Konsolidierung: In diesem Artikel wird in keiner Weise behauptet, dass das Datenbankmodell f√ºr Ihr gesamtes System (Themenbereich, Gesch√§ftslogik usw.) gelten sollte.  Meine Aussagen bestehen nur darin, dass der mit der Datenbank interagierende Client-Code nur eine <em>Darstellung</em> des Datenbankschemas sein sollte, es aber in keiner Weise definieren und formen sollte. </p><br><p>  In den zweistufigen Architekturen, die noch einen Platz haben, ist das Datenbankschema m√∂glicherweise die einzige Informationsquelle √ºber das Modell Ihres Systems.  Auf den meisten Systemen sehe ich die Ebene des Datenzugriffs jedoch als ein ‚ÄûSubsystem‚Äú, das ein Datenbankmodell kapselt.  Irgendwie so. </p><br><h2 id="isklyucheniya">  Ausnahmen </h2><br><p>  Wie bei jeder anderen guten Regel gibt es auch bei uns Ausnahmen (und ich habe bereits gewarnt, dass der erste Ansatz der Datenbank und die Codegenerierung nicht immer die richtige Wahl sind).  Diese Ausnahmen (m√∂glicherweise ist die Liste nicht vollst√§ndig): </p><br><ul><li>  Wenn die Schaltung nicht im Voraus bekannt ist und untersucht werden muss.  Sie sind beispielsweise Anbieter eines Tools, mit dem Benutzer in jedem Schema navigieren k√∂nnen.  Nat√ºrlich kann es keine Codegenerierung geben.  In jedem Fall m√ºssen Sie sich jedoch mit der Datenbank selbst und ihrem Schema befassen. </li><li>  Wenn Sie f√ºr eine Aufgabe ein Schema im laufenden Betrieb erstellen m√ºssen.  Dies kann einer der Variationen des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entity-Attribut-Wert-Musters</a> √§hnlich sein, wie z  Sie haben kein klar definiertes Muster.  Es gibt auch keine Gewissheit, dass RDBMS in diesem Fall die richtige Wahl ist. </li></ul><br><p>  Die Besonderheit dieser Ausnahmen ist, dass sie sich in Wildtieren selten treffen.  In den meisten F√§llen ist das Schema bei Verwendung relationaler Datenbanken im Voraus bekannt und der "Standard" Ihres Modells. Clients sollten mit einer Kopie dieses Modells arbeiten, die mit Codegeneratoren erstellt wurde. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413597/">https://habr.com/ru/post/de413597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413585/index.html">Hansen-Zusammenarbeit: entweder gut oder nichts (Teil 2)</a></li>
<li><a href="../de413587/index.html">Bewertung der Testabdeckung eines Java-Projekts am Beispiel von Apache Ignite</a></li>
<li><a href="../de413589/index.html">Code Review: Erfolgreiche Erfahrung</a></li>
<li><a href="../de413591/index.html">Industrierobotik - 57 Jahre! Erinnern Sie sich, woher die Z√§hlung kommt</a></li>
<li><a href="../de413593/index.html">Weiter den Meeresboden erobern. Microsoft und sein Unterwasser-Rechenzentrumsprojekt Natick 2</a></li>
<li><a href="../de413599/index.html">Es gibt S.L.O.N.a in Teilen. ITAM einf√ºhren und nicht ersticken</a></li>
<li><a href="../de413601/index.html">Erw√§rmt das Rechenzentrum von Microsoft das Meer?</a></li>
<li><a href="../de413603/index.html">Codegenerierung in Uber</a></li>
<li><a href="../de413605/index.html">Fragen Sie Ethan: Was passiert, wenn ein Stern das Sonnensystem passiert?</a></li>
<li><a href="../de413607/index.html">Fintech Digest: Digitale W√§hrungen bedrohen das Finanzsystem der Russischen F√∂deration nicht. PayPal hat herausgefunden, wie viel Spieler f√ºr Spiele ausgeben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>