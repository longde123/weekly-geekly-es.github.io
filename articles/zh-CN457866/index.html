<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•´ğŸ½ ğŸ™‹ğŸ½ ğŸ‘ğŸ¿ Laravelä¸­çš„å•å…ƒæµ‹è¯• ãŠ™ï¸ ğŸ§ ğŸš–</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ç¤¾åŒºä¸­çš„è®¨è®ºä¸­ï¼Œæˆ‘ç»å¸¸å¬åˆ°è¿™æ ·çš„è§‚ç‚¹ï¼Œå³Laravelä¸­çš„å•å…ƒæµ‹è¯•æ˜¯é”™è¯¯çš„ï¼Œå¤æ‚çš„ï¼Œå¹¶ä¸”æµ‹è¯•æœ¬èº«å¾ˆé•¿å¹¶ä¸”æ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚ å› æ­¤ï¼Œå¾ˆå°‘æœ‰äººç¼–å†™è¿™äº›æµ‹è¯•ï¼Œä»…å°†å®ƒä»¬é™äºåŠŸèƒ½æµ‹è¯•ï¼Œè€Œå•å…ƒæµ‹è¯•çš„ä½¿ç”¨è¶‹å‘äº0ã€‚ 
 æˆ‘ä¹Ÿæ›¾ç»è¿™æ ·æƒ³è¿‡ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘æƒ³åˆ°äº†å¹¶é—®è‡ªå·±-ä¹Ÿè®¸æˆ‘ä¸çŸ¥é“å¦‚ä½•ç…®å®ƒä»¬ï¼Ÿ 


 ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œæˆ‘äº†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Laravelä¸­çš„å•å…ƒæµ‹è¯•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457866/"><p> åœ¨ç¤¾åŒºä¸­çš„è®¨è®ºä¸­ï¼Œæˆ‘ç»å¸¸å¬åˆ°è¿™æ ·çš„è§‚ç‚¹ï¼Œå³Laravelä¸­çš„å•å…ƒæµ‹è¯•æ˜¯é”™è¯¯çš„ï¼Œå¤æ‚çš„ï¼Œå¹¶ä¸”æµ‹è¯•æœ¬èº«å¾ˆé•¿å¹¶ä¸”æ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚ å› æ­¤ï¼Œå¾ˆå°‘æœ‰äººç¼–å†™è¿™äº›æµ‹è¯•ï¼Œä»…å°†å®ƒä»¬é™äºåŠŸèƒ½æµ‹è¯•ï¼Œè€Œå•å…ƒæµ‹è¯•çš„ä½¿ç”¨è¶‹å‘äº0ã€‚ <br> æˆ‘ä¹Ÿæ›¾ç»è¿™æ ·æƒ³è¿‡ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘æƒ³åˆ°äº†å¹¶é—®è‡ªå·±-ä¹Ÿè®¸æˆ‘ä¸çŸ¥é“å¦‚ä½•ç…®å®ƒä»¬ï¼Ÿ </p><br><p> ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œæˆ‘äº†è§£äº†ï¼Œåœ¨å‡ºå£æ—¶ï¼Œæˆ‘å¯¹å•å…ƒæµ‹è¯•æœ‰äº†æ–°çš„äº†è§£ï¼Œæµ‹è¯•å˜å¾—æ¸…æ™°ï¼Œå‹å¥½ï¼Œå¿«é€Ÿï¼Œå¹¶å¼€å§‹ä¸ºæˆ‘æä¾›å¸®åŠ©ã€‚ <br> æˆ‘æƒ³ä¸ç¤¾åŒºåˆ†äº«æˆ‘çš„ç†è§£ï¼Œç”šè‡³æ›´å¥½åœ°ç†è§£è¿™ä¸ªä¸»é¢˜ï¼Œä½¿æˆ‘çš„æµ‹è¯•å˜å¾—æ›´å¥½ã€‚ </p><a name="habracut"></a><br><h2 id="nemnogo-filosofii-i-ogranicheniy"> ä¸€ç‚¹å“²å­¦å’Œå±€é™æ€§ </h2><br><p>  Laravelåœ¨æŸäº›åœ°æ–¹æ˜¯ä¸€ç§æ¡†æ¶ã€‚ ç‰¹åˆ«æ˜¯åœ¨å¤–å¢™å’Œå£æ‰æ–¹é¢ã€‚ æˆ‘ä¸ä¼šæ¶‰åŠè¿™äº›é—®é¢˜çš„è®¨è®ºæˆ–è°´è´£ï¼Œä½†ä¼šå±•ç¤ºå¦‚ä½•å°†å®ƒä»¬ä¸å•å…ƒæµ‹è¯•ç»“åˆèµ·æ¥ã€‚ <br> æˆ‘åœ¨ç¼–å†™ä¸»ä»£ç åï¼ˆæˆ–åŒæ—¶ï¼‰ç¼–å†™æµ‹è¯•ã€‚ ä¹Ÿè®¸æˆ‘çš„æ–¹æ³•ä¸TDDæ–¹æ³•ä¸å…¼å®¹æˆ–éœ€è¦éƒ¨åˆ†è°ƒæ•´ã€‚ </p><br><p>åœ¨ç¼–å†™æµ‹è¯•ä¹‹å‰ï¼Œæˆ‘é—®è‡ªå·±æœ€é‡è¦çš„é—®é¢˜æ˜¯â€œæˆ‘åˆ°åº•è¦æµ‹è¯•ä»€ä¹ˆï¼Ÿâ€ã€‚ è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„é—®é¢˜ã€‚ æ­£æ˜¯è¿™ç§æƒ³æ³•è®©æˆ‘é‡æ–°è€ƒè™‘äº†å¯¹ç¼–å†™å•å…ƒæµ‹è¯•å’Œé¡¹ç›®ä»£ç æœ¬èº«çš„çœ‹æ³•ã€‚ </p><br><p> æµ‹è¯•åº”è¯¥ç¨³å®šå¹¶ä¸”å¯¹ç¯å¢ƒçš„ä¾èµ–æ€§æœ€å°ã€‚ å¦‚æœåœ¨è¿›è¡Œçªå˜æ—¶æµ‹è¯•å¤±è´¥ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½æ˜¯å¥½çš„ã€‚ ç›¸åï¼Œå¦‚æœå®ƒä»¬ä¸è·Œå€’ï¼Œåˆ™å¯èƒ½ä¸æ˜¯å¾ˆå¥½ã€‚ </p><br><p> å¼€ç®±å³ç”¨ï¼ŒLaravelæ”¯æŒ3ç§ç±»å‹çš„æµ‹è¯•ï¼š </p><br><ul><li> æµè§ˆå™¨ </li><li> ç‰¹è‰² </li><li> å•ä½ </li></ul><br><p> æˆ‘å°†ä¸»è¦è®¨è®ºå•å…ƒæµ‹è¯•ã€‚ </p><br><p> æˆ‘æ²¡æœ‰é€šè¿‡å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ‰€æœ‰ä»£ç ï¼ˆä¹Ÿè®¸è¿™æ˜¯ä¸æ­£ç¡®çš„ï¼‰ã€‚ æˆ‘æ ¹æœ¬ä¸æµ‹è¯•ä¸€äº›ä»£ç ï¼ˆä¸‹é¢æœ‰æ›´å¤šå†…å®¹ï¼‰ã€‚ </p><br><p> å¦‚æœæµ‹è¯•ä¸­ä½¿ç”¨äº†Moqueï¼Œè¯·ä¸è¦å¿˜è®°å¯¹tearDownè¿›è¡ŒMockery :: closeï¼ˆï¼‰ã€‚ </p><br><p> æµ‹è¯•çš„ä¸€äº›ç¤ºä¾‹æ˜¯â€œä»Internetä¸Šè·å–çš„â€ã€‚ </p><br><h2 id="kak-ya-testiruyu"> æˆ‘å¦‚ä½•æµ‹è¯• </h2><br><p> ä¸‹é¢ï¼Œæˆ‘å°†æŒ‰ç­çº§å¯¹æµ‹è¯•ç¤ºä¾‹è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å°è¯•ç»™å‡ºæ¯ä¸ªç­çº§çš„æµ‹è¯•ç¤ºä¾‹ã€‚ å¯¹äºå¤§å¤šæ•°ç±»ç»„ï¼Œæˆ‘ä¸ä¼šæä¾›ä»£ç æœ¬èº«çš„ç¤ºä¾‹ã€‚ </p><br><h3 id="middleware"> ä¸­é—´ä»¶ </h3><br><p> å¯¹äºä¸­é—´ä»¶å•å…ƒæµ‹è¯•ï¼Œæˆ‘åˆ›å»ºä¸€ä¸ªRequestç±»çš„å¯¹è±¡ï¼Œä¸€ä¸ªæ‰€éœ€ä¸­é—´ä»¶çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨handleæ–¹æ³•å¹¶æ‰§è¡Œå¿…è¦çš„æ–­è¨€ã€‚ ä¸­é—´ä»¶æ ¹æ®æ‰§è¡Œçš„åŠ¨ä½œå¯ä»¥åˆ†ä¸º3ç»„ï¼š </p><br><ul><li> æ›´æ”¹è¯·æ±‚å¯¹è±¡ï¼ˆæ›´æ”¹æ­£æ–‡è¯·æ±‚æˆ–ä¼šè¯ï¼‰ </li><li> é‡å®šå‘ï¼ˆæ›´æ”¹å“åº”çŠ¶æ€ï¼‰ </li><li> ä¸å¤„ç†è¯·æ±‚å¯¹è±¡ <br> è®©æˆ‘ä»¬å°è¯•ç»™å‡ºæ¯ä¸ªç»„çš„æµ‹è¯•ç¤ºä¾‹ï¼š </li></ul><br><p> å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸­é—´ä»¶ï¼Œå…¶ä»»åŠ¡æ˜¯ä¿®æ”¹æ ‡é¢˜å­—æ®µï¼š </p><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TitlecaseMiddleware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request, Closure $next)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;title) { $request-&gt;merge([ <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; title_case($request-&gt;title) ]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $next($request); } }</code> </pre> <br><p> å¯¹ç±»ä¼¼ä¸­é—´ä»¶çš„æµ‹è¯•å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testChangeTitleToTitlecase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request; $request-&gt;merge([ <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Title is in mixed CASE'</span></span> ]); $middleware = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TitlecaseMiddleware; $middleware-&gt;handle($request, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($req)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-string"><span class="hljs-string">'Title Is In Mixed Case'</span></span>, $req-&gt;title); }); }</code> </pre> <br><p> ç¬¬2ç»„å’Œç¬¬3ç»„çš„æµ‹è¯•åˆ†åˆ«æ˜¯è¿™æ ·çš„è®¡åˆ’ï¼š </p><br><pre> <code class="php hljs">$response = $middleware-&gt;handle($request, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($response-&gt;getStatusCode(), <span class="hljs-number"><span class="hljs-number">302</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   $this-&gt;assertEquals($response, null); //      request</span></span></code> </pre> <br><h3 id="request-class"> è¦æ±‚ç­‰çº§ </h3><br><p> è¯¥ç±»ç»„çš„ä¸»è¦ä»»åŠ¡æ˜¯è¯·æ±‚çš„æˆæƒå’Œç¡®è®¤ã€‚ </p><br><p> æˆ‘ä¸é€šè¿‡å•å…ƒæµ‹è¯•æ¥æµ‹è¯•è¿™äº›ç±»ï¼ˆæˆ‘æ‰¿è®¤è¿™å¯èƒ½ä¸æ­£ç¡®ï¼‰ï¼Œè€Œä»…é€šè¿‡åŠŸèƒ½æµ‹è¯•æ¥æµ‹è¯•ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œå•å…ƒæµ‹è¯•å¯¹äºè¿™äº›ç±»æ˜¯å¤šä½™çš„ï¼Œä½†æ˜¯æˆ‘å‘ç°äº†ä¸€äº›æœ‰è¶£çš„ç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚ å¦‚æœæ‚¨å†³å®šä½¿ç”¨æµ‹è¯•æ¥æµ‹è¯•æ‚¨çš„è¯·æ±‚å•å…ƒç±»ï¼Œä¹Ÿè®¸å®ƒä»¬ä¼šä¸ºæ‚¨æä¾›å¸®åŠ©ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://medium.com/@daaaan/a-guide-to-unit-testing-laravel-form-requests-in-a-different-way-f1bdb6d86053</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://stackoverflow.com/questions/36978147/unit-test-laravels-formrequest</a> </li></ul><br><h3 id="controller"> æ§åˆ¶è€… </h3><br><p> æˆ‘ä¹Ÿä¸é€šè¿‡å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ§åˆ¶å™¨ã€‚ ä½†æ˜¯åœ¨æµ‹è¯•å®ƒä»¬æ—¶ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªæˆ‘æƒ³è°ˆçš„åŠŸèƒ½ã€‚ </p><br><p> æˆ‘è®¤ä¸ºæ§åˆ¶å™¨åº”è¯¥è½»å·§ã€‚ ä»–ä»¬çš„ä»»åŠ¡æ˜¯è·å–æ­£ç¡®çš„è¯·æ±‚ï¼Œè°ƒç”¨å¿…è¦çš„æœåŠ¡å’Œå­˜å‚¨åº“ï¼ˆç”±äºè¿™ä¸¤ä¸ªæœ¯è¯­éƒ½æ˜¯Laravelçš„â€œå¤–æ¥â€ï¼Œæˆ‘å°†åœ¨ä¸‹é¢è§£é‡Šæˆ‘çš„æœ¯è¯­ï¼‰ï¼Œå¹¶è¿”å›ç­”æ¡ˆã€‚ æœ‰æ—¶ä¼šè§¦å‘äº‹ä»¶ï¼Œå·¥ä½œç­‰ã€‚ <br> å› æ­¤ï¼Œåœ¨é€šè¿‡åŠŸèƒ½æµ‹è¯•è¿›è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦ä½¿ç”¨å¿…è¦çš„å‚æ•°è°ƒç”¨æ§åˆ¶å™¨å¹¶æ£€æŸ¥ç­”æ¡ˆï¼Œè¿˜éœ€è¦é”å®šå¿…è¦çš„æœåŠ¡å¹¶éªŒè¯å®ƒä»¬æ˜¯å¦è¢«çœŸæ­£è°ƒç”¨ï¼ˆæˆ–æœªè¢«è°ƒç”¨ï¼‰ã€‚ æœ‰æ—¶-åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€æ¡è®°å½•ã€‚ </p><br><p> ä½¿ç”¨æœåŠ¡ç±»æ¨¡æ‹Ÿè¿›è¡Œæ§åˆ¶å™¨æµ‹è¯•çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testProductCategorySync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $service = Mockery::mock(\App\Services\Product::class); app()-&gt;instance(\App\Services\Product::class, $service); $service-&gt;shouldReceive(<span class="hljs-string"><span class="hljs-string">'sync'</span></span>)-&gt;once(); $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post(<span class="hljs-string"><span class="hljs-string">'/api/v1/sync/eventsCallback'</span></span>, [ <span class="hljs-string"><span class="hljs-string">"eventType"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"PRODUCT_SYNC"</span></span> ]); $response-&gt;assertStatus(<span class="hljs-number"><span class="hljs-number">200</span></span>); }</code> </pre> <br><p> ä½¿ç”¨å¤–è§‚æ¨¡æ‹Ÿçš„æ§åˆ¶å™¨æµ‹è¯•çš„ç¤ºä¾‹ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œä½†ä»¥æ­¤ç±»æ¨ï¼Œå…¶ä»–Laravelå¤–è§‚ä¹Ÿå®Œæˆäº†ï¼‰ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testChangeCart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Event::fake(); $user = factory(User::class)-&gt;create(); Passport::actingAs( $user ); $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post(<span class="hljs-string"><span class="hljs-string">'/api/v1/cart/update'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'products'</span></span> =&gt; [ [ <span class="hljs-comment"><span class="hljs-comment">// our changed data ] ], ]); $data = json_decode($response-&gt;getContent()); $response-&gt;assertStatus(200); $this-&gt;assertEquals($user-&gt;id, $data-&gt;data-&gt;userId); // and assert other data from response Event::assertDispatched(CartChanged::class); }</span></span></code> </pre> <br><h3 id="service-i-repositories"> æœåŠ¡å’Œå­˜å‚¨åº“ </h3><br><p> è¿™äº›ç±»å‹çš„ç±»æ˜¯å¼€ç®±å³ç”¨çš„ã€‚ æˆ‘è¯•å›¾ä½¿æ§åˆ¶å™¨å˜è–„ï¼Œæ‰€ä»¥æˆ‘å°†æ‰€æœ‰é¢å¤–çš„å·¥ä½œæ”¾åœ¨è¿™äº›ç±»ç»„ä¹‹ä¸€ä¸­ã€‚ </p><br><p> æˆ‘ç¡®å®šå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ï¼š </p><br><ul><li> å¦‚æœéœ€è¦å®ç°ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œåˆ™å¯ä»¥å°†å…¶æ”¾åœ¨é€‚å½“çš„æœåŠ¡å±‚ï¼ˆç±»ï¼‰ä¸­ã€‚ </li><li> åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘å°†å…¶æ”¾åœ¨å­˜å‚¨åº“ç±»ç»„ä¸­ã€‚ é€šå¸¸ï¼ŒEloquentçš„åŠŸèƒ½å°±åœ¨é‚£é‡Œã€‚ æˆ‘äº†è§£è¿™å¹¶ä¸æ˜¯å¯¹å­˜å‚¨åº“çº§åˆ«çš„æ­£ç¡®å®šä¹‰ã€‚ æˆ‘è¿˜å¬è¯´æœ‰äº›äººå¿å—äº†æ¨¡å‹ä¸­ä¸Eloquentç›¸å…³çš„ä¸€åˆ‡ã€‚ æˆ‘è®¤ä¸ºæˆ‘çš„æ–¹æ³•æ˜¯ä¸€ç§æŠ˜è¡·ï¼Œå°½ç®¡â€œå­¦æœ¯ä¸Šâ€å¹¶ä¸å®Œå…¨æ­£ç¡®ã€‚ </li></ul><br><p> å¯¹äºå­˜å‚¨åº“ç±»ï¼Œæˆ‘å‡ ä¹ä¸ç¼–å†™æµ‹è¯•ã€‚ </p><br><p> æœåŠ¡ç±»æµ‹è¯•ç¤ºä¾‹å¦‚ä¸‹ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testUpdateCart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Event::fake(); $cartService = resolve(CartService::class); $cartRepo = resolve(CartRepository::class); $user = factory(User::class)-&gt;make(); $cart = $cartRepo-&gt;getCart($user); <span class="hljs-comment"><span class="hljs-comment">// set data $data = [ ]; $newCart = $cartService-&gt;updateForUser($user, $data); $this-&gt;assertEquals($data, $newCart-&gt;toArray()); Event::assertDispatched(CartChanged::class, 1); }</span></span></code> </pre> <br><h3 id="event-listener-jobs"> äº‹ä»¶ç›‘å¬å™¨ï¼Œä¹”å¸ƒæ–¯ </h3><br><p> è¿™äº›ç±»å‡ ä¹éƒ½æ˜¯æŒ‰ç…§ä¸€èˆ¬åŸåˆ™è¿›è¡Œæµ‹è¯•çš„-æˆ‘ä»¬å‡†å¤‡æµ‹è¯•æ‰€éœ€çš„æ•°æ®ï¼› æˆ‘ä»¬ä»æ¡†æ¶ä¸­è°ƒç”¨æ‰€éœ€çš„ç±»å¹¶æ£€æŸ¥ç»“æœã€‚ <br> ä¾¦å¬å™¨ç¤ºä¾‹ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $user = factory(User::class)-&gt;create(); $cart = Cart::create([ <span class="hljs-string"><span class="hljs-string">'userId'</span></span> =&gt; $user-&gt;id, <span class="hljs-comment"><span class="hljs-comment">// other needed data ]); $listener = new CreateTaskForSyncCart(); $listener-&gt;handle(new CartChanged($cart)); $job = // get our job $this-&gt;assertSame(json_encode($cart-&gt;products), $job-&gt;payload); $this-&gt;assertSame($user-&gt;id, $job-&gt;user_id); // some additional asserts. Work with this data simplest for example $this-&gt;assertTrue($updatedAt-&gt;equalTo($job-&gt;last_updated_at)); }</span></span></code> </pre> <br><h3 id="console-commands"> æ§åˆ¶å°æ§åˆ¶å° </h3><br><p> æˆ‘è®¤ä¸ºæ§åˆ¶å°å‘½ä»¤æ˜¯å¯ä»¥é¢å¤–è¾“å‡ºï¼ˆå¹¶ä½¿ç”¨æ–‡æ¡£ä¸­æè¿°çš„æ§åˆ¶å°è¾“å…¥è¾“å‡ºæ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œï¼‰æ•°æ®çš„æŸç§æ§åˆ¶å™¨ã€‚ å› æ­¤ï¼Œæµ‹è¯•ä¸æ§åˆ¶å™¨ç±»ä¼¼ï¼šæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº†å¿…è¦çš„æœåŠ¡æ–¹æ³•ï¼Œæ˜¯å¦è§¦å‘äº†äº‹ä»¶ï¼Œè¿˜æ£€æŸ¥äº†ä¸æ§åˆ¶å°çš„äº¤äº’ï¼ˆè¾“å‡ºæˆ–æ•°æ®è¯·æ±‚ï¼‰ã€‚ </p><br><p> ç±»ä¼¼æµ‹è¯•çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testSendCartSyncDataEmptyJobs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $service = m::mock(CartJobsRepository::class); app()-&gt;instance(CartJobsRepository::class, $service); $service-&gt;shouldReceive(<span class="hljs-string"><span class="hljs-string">'getAll'</span></span>) -&gt;once()-&gt;andReturn(collect([])); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;artisan(<span class="hljs-string"><span class="hljs-string">'sync:cart'</span></span>) -&gt;expectsOutput(<span class="hljs-string"><span class="hljs-string">'Get all jobs for sending...'</span></span>) -&gt;expectsOutput(<span class="hljs-string"><span class="hljs-string">'All count for sending: 0'</span></span>) -&gt;expectsOutput(<span class="hljs-string"><span class="hljs-string">'Empty jobs'</span></span>) -&gt;assertExitCode(<span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br><h3 id="otdelnye-vneshnie-biblioteki"> å•ç‹¬çš„å¤–éƒ¨åº“ </h3><br><p> é€šå¸¸ï¼Œå¦‚æœå•ç‹¬çš„åº“å…·æœ‰ç”¨äºå•å…ƒæµ‹è¯•çš„åŠŸèƒ½ï¼Œåˆ™å°†åœ¨æ–‡æ¡£ä¸­å¯¹å…¶è¿›è¡Œæè¿°ã€‚ åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¸æœåŠ¡å±‚ç±»ä¼¼åœ°æµ‹è¯•ä½¿ç”¨æ­¤ä»£ç ã€‚ ç”¨æµ‹è¯•è¦†ç›–åº“æœ¬èº«æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼ˆä»…å½“æ‚¨æƒ³å°†PRå‘é€åˆ°è¯¥åº“æ—¶ï¼‰ï¼Œå¹¶ä¸”æ‚¨åº”è¯¥å°†å®ƒä»¬è§†ä¸ºæŸç§é»‘ç›’ã€‚ </p><br><p> åœ¨è®¸å¤šé¡¹ç›®ä¸­ï¼Œæˆ‘å¿…é¡»é€šè¿‡APIä¸å…¶ä»–æœåŠ¡è¿›è¡Œäº¤äº’ã€‚  Laravelé€šå¸¸å°†Guzzleåº“ç”¨äºè¿™äº›ç›®çš„ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œå°†æ‰€æœ‰ä¸å…¶ä»–æœåŠ¡ä¸€èµ·çš„å·¥ä½œæ”¾åˆ°NetworkServiceæœåŠ¡çš„å•ç‹¬çš„ç±»ä¸­ä¼¼ä¹å¾ˆæ–¹ä¾¿ã€‚ è¿™ä½¿æˆ‘å¯ä»¥æ›´è½»æ¾åœ°ç¼–å†™å’Œæµ‹è¯•ä¸»è¦ä»£ç ï¼Œå¹¶æœ‰åŠ©äºæ ‡å‡†åŒ–ç­”æ¡ˆå’Œé”™è¯¯å¤„ç†ã€‚ </p><br><p> æˆ‘æä¾›äº†ä¸€äº›é’ˆå¯¹NetworkServiceç±»çš„æµ‹è¯•ç¤ºä¾‹ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testSuccessfulSendNetworkService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $mockHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MockHandler([ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response(<span class="hljs-number"><span class="hljs-number">200</span></span>), ]); $handler = HandlerStack::create($mockHandler); $client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client([<span class="hljs-string"><span class="hljs-string">'handler'</span></span> =&gt; $handler]); app()-&gt;instance(\GuzzleHttp\Client::class, $client); $networkService = resolve(NetworkService::class); $response = $networkService-&gt;sendRequestToSite(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-string"><span class="hljs-string">'200'</span></span>, $response-&gt;getStatusCode()); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testUnsupportedMethodSendNetworkService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $networkService = resolve(NetworkService::class); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;expectException(<span class="hljs-string"><span class="hljs-string">'\InvalidArgumentException'</span></span>); $networkService-&gt;sendRequestToSite(<span class="hljs-string"><span class="hljs-string">'PUT'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testUnsetConfigUrlNetworkService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $networkService = resolve(NetworkService::class); Config::shouldReceive(<span class="hljs-string"><span class="hljs-string">'get'</span></span>) -&gt;once() -&gt;with(<span class="hljs-string"><span class="hljs-string">'app.api_url'</span></span>) -&gt;andReturn(<span class="hljs-string"><span class="hljs-string">''</span></span>); Config::shouldReceive(<span class="hljs-string"><span class="hljs-string">'get'</span></span>) -&gt;once() -&gt;with(<span class="hljs-string"><span class="hljs-string">'app.api_token'</span></span>) -&gt;andReturn(<span class="hljs-string"><span class="hljs-string">'token'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;expectException(<span class="hljs-string"><span class="hljs-string">'\InvalidArgumentException'</span></span>); $networkService-&gt;sendRequestToApi(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>); }</code> </pre> <br><h2 id="vyvody"> ç»“è®º </h2><br><p> è¿™ç§æ–¹æ³•ä½¿æˆ‘å¯ä»¥ç¼–å†™æ›´å¥½å’Œæ›´æ˜“ç†è§£çš„ä»£ç ï¼Œä»¥åœ¨ç¼–å†™ä»£ç æ—¶åˆ©ç”¨SOLIDå’ŒSRPæ–¹æ³•ã€‚ æˆ‘çš„æµ‹è¯•å˜å¾—æ›´å¿«ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå®ƒä»¬å¼€å§‹ä½¿æˆ‘å—ç›Šã€‚ </p><br><p> é€šè¿‡åœ¨æ‰©å±•æˆ–æ›´æ”¹åŠŸèƒ½æ—¶è¿›è¡Œä¸»åŠ¨é‡æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³çœ‹åˆ°ç¡®åˆ‡çš„ä¸‹é™æƒ…å†µï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿè€Œå‡†ç¡®åœ°çº æ­£é”™è¯¯ï¼Œè€Œæ— éœ€ä»æœ¬åœ°ç¯å¢ƒä¸­é‡Šæ”¾é”™è¯¯ã€‚ è¿™ä½¿å¾—çº é”™å°½å¯èƒ½ä¾¿å®œã€‚ </p><br><p> æˆ‘å¸Œæœ›æˆ‘æ‰€æè¿°çš„åŸç†å’Œæ–¹æ³•å°†å¸®åŠ©æ‚¨å¤„ç†Laravelä¸­çš„å•å…ƒæµ‹è¯•ï¼Œå¹¶ä½¿å•å…ƒæµ‹è¯•æˆä¸ºä»£ç å¼€å‘çš„åŠ©æ‰‹ã€‚ </p><br><p> å†™ä¸‹æ‚¨çš„æ·»åŠ å†…å®¹å’Œè¯„è®ºã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457866/">https://habr.com/ru/post/zh-CN457866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457852/index.html">åˆ†æï¼šç¾å›½å½“å±€çš„é—®é¢˜å°†å¦‚ä½•å½±å“åä¸ºå’ŒITä¸šåŠ¡</a></li>
<li><a href="../zh-CN457854/index.html">80å¹´ä»£çš„ç¨‹åºå‘˜å¤§å®¶å¥½</a></li>
<li><a href="../zh-CN457860/index.html">ä½¿ç”¨Node.jså’ŒReactå¼€å‘ç”¨äºæµå¼ä¼ è¾“çš„åº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN457862/index.html">iOSæ‘˜è¦8ï¼ˆ6æœˆ14æ—¥è‡³6æœˆ27æ—¥ï¼‰</a></li>
<li><a href="../zh-CN457864/index.html">ç³»ç»Ÿåˆ†æçš„ç¥è¯ä¼ è¯´æˆ–é“¶è¡Œåˆ†æå¸ˆçš„è¡Œä¸º</a></li>
<li><a href="../zh-CN457870/index.html">ä½¿ç”¨Dockeræ„å»ºé¡¹ç›®åŸºç¡€æ¶æ„</a></li>
<li><a href="../zh-CN457872/index.html">å¦‚ä½•ç®¡ç†æ—¶é—´å¹¶åœæ­¢æ‹–å»¶ï¼Ÿ</a></li>
<li><a href="../zh-CN457874/index.html">å‘˜å·¥ä¸ºä»€ä¹ˆå›æ¥ï¼Ÿ å‡ºå‘å’Œè¿”å›çš„æ•…äº‹</a></li>
<li><a href="../zh-CN457876/index.html">ç¿»è¯‘ï¼šIEEE 802.15.4zæ ‡å‡†ã€‚ å°†æ¥æœ‰ä»€ä¹ˆåœ¨ç­‰æˆ‘ä»¬ï¼Ÿ</a></li>
<li><a href="../zh-CN457884/index.html">ä¸»æƒäº’è”ç½‘-æ¾„æ¸…è®¢å•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>