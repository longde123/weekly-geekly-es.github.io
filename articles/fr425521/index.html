<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîê üéÉ üéÄ M√©thodes prot√©g√©es dans JavaScript ES5 ‚¨ÜÔ∏è üßïüèΩ üë®üèΩ‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup d'excellents articles ont √©t√© √©crits sur le mod√®le objet en JavaScript. Et sur les diff√©rentes fa√ßons de cr√©er des membres de classe priv√©s s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©thodes prot√©g√©es dans JavaScript ES5</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425521/">  Beaucoup d'excellents articles ont √©t√© √©crits sur le mod√®le objet en JavaScript.  Et sur les diff√©rentes fa√ßons de cr√©er des membres de classe priv√©s sur Internet est plein de descriptions dignes.  Mais √† propos des m√©thodes prot√©g√©es - il y a tr√®s peu de donn√©es.  Je voudrais combler cette lacune et dire comment vous pouvez cr√©er des m√©thodes prot√©g√©es sans biblioth√®ques en pur JavaScript ECMAScript 5. <br><br>  Dans cet article: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pourquoi les membres de classe prot√©g√©s sont n√©cessaires</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ce dont vous avez besoin pour comprendre la m√©thode pr√©sent√©e</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Classe d'assistance ProtectedError</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Impl√©mentation de membres prot√©g√©s (m√©thodes et propri√©t√©s) pour les classes d√©clar√©es en tant que fonctions (ECMAScript 5)</a> </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers le r√©f√©rentiel git-hub avec le code source et les tests.</a> <a name="habracut"></a><br><br><h2>  Pourquoi les membres de classe prot√©g√©s sont n√©cessaires </h2><br>  Bref, alors <br><br><ul><li>  il est plus facile de comprendre le fonctionnement de la classe et d'y trouver des erreurs.  (Vous pouvez imm√©diatement voir dans quels cas les membres de la classe sont utilis√©s. S'il est priv√©, vous devez analyser uniquement cette classe, enfin, et s'il est prot√©g√©, alors uniquement cette classe et les classes d√©riv√©es.) </li><li>  plus facile √† g√©rer le changement.  (Par exemple, vous pouvez supprimer des membres priv√©s sans craindre que quelque chose en dehors de la classe modifiable se brise.) </li><li> le nombre d'applications dans le suivi des bogues est r√©duit, car  les utilisateurs de la biblioth√®que ou du contr√¥le peuvent "recoudre" nos membres "priv√©s", que nous avons d√©cid√© de supprimer dans la nouvelle version de la classe, ou de changer la logique de leur travail. </li><li>  Et en g√©n√©ral, les membres de classe prot√©g√©s sont un outil de conception.  C'est bien de l'avoir √† port√©e de main et bien test√©. </li></ul><br>  Permettez-moi de vous rappeler que l'id√©e principale des membres prot√©g√©s est de masquer les m√©thodes et les propri√©t√©s aux utilisateurs de l'instance de classe, mais en m√™me temps de permettre aux classes d√©riv√©es d'y avoir acc√®s. <br><br>  L'utilisation de TypeScript ne permettra pas d'appeler des m√©thodes prot√©g√©es, cependant, apr√®s la compilation en JavaScript, tous les membres priv√©s et prot√©g√©s deviennent publics.  Par exemple, nous d√©veloppons un contr√¥le ou une biblioth√®que que les utilisateurs installeront sur leurs sites ou applications.  Ces utilisateurs pourront faire tout ce qu'ils veulent avec des membres prot√©g√©s, violant l'int√©grit√© de la classe.  En cons√©quence, notre traqueur de bogues regorge de plaintes selon lesquelles notre biblioth√®que ou notre contr√¥le ne fonctionne pas correctement.  Nous passons du temps et des efforts √† le trier - <i>"est-ce ainsi que l'objet √©tait dans cet √©tat du client, ce qui a conduit √† une erreur?!"</i>  .  Par cons√©quent, afin de faciliter la vie de tous, une telle protection est n√©cessaire qui ne permettra pas de changer le sens des membres du groupe priv√©s et prot√©g√©s. <br><br><h2>  Ce dont vous avez besoin pour comprendre la m√©thode en question </h2><br>  Pour comprendre la m√©thode de d√©claration des membres de classe prot√©g√©s, vous avez besoin de solides connaissances: <br><br><ul><li>  classes d'appareils et objets en JavaScript. </li><li>  fa√ßons de cr√©er des membres de classe priv√©s (au moins par la fermeture). </li><li>  m√©thodes Object.defineProperty et Object.getOwnPropertyDescriptor </li></ul><br>  √Ä propos du mod√®le d'appareil en JavaScript, je peux recommander, par exemple, un excellent article d'Andrey Akinshin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">DreamWalker</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Comprendre la POO dans JS [Part No. 1]¬ª</a> . <br>  √Ä propos des propri√©t√©s priv√©es, il y a une bonne et, √† mon avis, une description assez compl√®te de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas moins de 4 fa√ßons diff√©rentes de cr√©er des membres de classe priv√©s</a> sur le site Web de MDN. <br><br>  Quant √† la m√©thode Object.defineProperty, elle nous permettra de masquer les propri√©t√©s et les m√©thodes des boucles for-in et, par cons√©quent, des algorithmes de s√©rialisation: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(MyClass.prototype, <span class="hljs-string"><span class="hljs-string">'protectedNumber'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.publicNumber = <span class="hljs-number"><span class="hljs-number">25</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyClass(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> obj1){ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'property:'</span></span> prop); <span class="hljs-comment"><span class="hljs-comment">//prop     'protectedNumber' } console.log(JSON.stringify(obj1)); //  { 'publicNumber': 25 }</span></span></code> </pre> <br>  Une telle dissimulation doit √™tre effectu√©e, mais cela, bien s√ªr, ne suffit pas car  Il y a toujours la possibilit√© d'appeler directement la m√©thode / propri√©t√©: <br><br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj1.protectedNumber); <span class="hljs-comment"><span class="hljs-comment">//  12.</span></span></code> </pre><br><h2>  Classe d'assistance ProtectedError </h2><br>  Tout d'abord, nous avons besoin de la classe ProtectedError, qui h√©rite d'Erreur, et qui sera lev√©e s'il n'y a pas d'acc√®s √† la m√©thode ou √† la propri√©t√© prot√©g√©e. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProtectedError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message = <span class="hljs-string"><span class="hljs-string">"Encapsulation error, the object member you are trying to address is protected."</span></span>; } ProtectedError.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(); ProtectedError.prototype.constructor = ProtectedError;</code> </pre><br><h2>  Impl√©mentation de membres de classe prot√©g√©s dans ES5 </h2><br>  Maintenant que nous avons la classe ProtectedError et que nous comprenons ce que fait Object.defineProperty avec la valeur √©num√©rable: false, analysons la cr√©ation d'une classe de base qui souhaite partager la m√©thode protectedMethod avec toutes ses classes d√©riv√©es, mais la cacher √† tout le monde: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ,        /** @summary       */ function checkAccess() { if (!(this instanceof BaseClass)) throw new ProtectedError(); if (this.constructor === BaseClass) throw new ProtectedError() } Object.defineProperty(_self, 'protectedMethod', { enumerable: false, //    for-in  configurable:false, //     value: function(){ //   , ,          Base,     checkAccess.call(this); //  . protectedMethod(); } }); function protectedMethod(){ //       , //       this,   _self return 'example value'; } this.method = function (){ protectedMethod(); //          BaseClass //this.protectedMethod(); //   , ..      ProtectedError } }</span></span></code> </pre><br><h3>  Description du constructeur de la classe BaseClass </h3><br>  Peut-√™tre serez-vous d√©rout√© par le ch√®que: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass();</code> </pre>  Ce test est un "amateur".  Vous pouvez le supprimer, cela n'a rien √† voir avec les m√©thodes prot√©g√©es.  Cependant, je le laisse personnellement dans mon code, car  il est n√©cessaire pour les cas o√π l'instance de classe n'est pas cr√©√©e correctement, c'est-√†-dire  sans le mot-cl√© new.  Par exemple, comme ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj1 = BaseClass(); <span class="hljs-comment"><span class="hljs-comment">//  : var obj2 = BaseClass.call({});</span></span></code> </pre><br>  Dans de tels cas, faites ce que vous voulez.  Vous pouvez, par exemple, g√©n√©rer une erreur: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Wrong instance creation. Maybe operator "new" was forgotten'</span></span>);</code> </pre><br>  Ou vous pouvez simplement instancier correctement, comme cela est fait dans BaseClass. <br><br>  Ensuite, nous enregistrons la nouvelle instance dans la variable _self (pourquoi je dois l'expliquer plus tard). <br><br><h3>  Description d'une propri√©t√© publique nomm√©e protectedMethod </h3><br>  En entrant dans la m√©thode, nous appelons la v√©rification de contexte sur laquelle nous avons √©t√© appel√©s.  Il est pr√©f√©rable de v√©rifier dans une m√©thode distincte, par exemple, checkAccess, car  la m√™me v√©rification sera n√©cessaire dans toutes les m√©thodes et propri√©t√©s prot√©g√©es des classes.  Donc, tout d'abord, v√©rifiez le type de contexte de l'appel √† ceci.  S'il s'agit d'un type autre que BaseClass, le type n'est ni BaseClass ni aucun de ses d√©riv√©s.  Nous interdisons de tels appels. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError();</code> </pre><br>  Comment cela peut-il arriver?  Par exemple, comme ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someObject = {}; b.protectedMethod.call(someObject); <span class="hljs-comment"><span class="hljs-comment">//   ,  protectedMethod this   someObject    , .. someObject instanceof BaseClass  </span></span></code> </pre><br>  Dans le cas des classes d√©riv√©es, l'expression this instanceof BaseClass sera vraie.  Mais pour les instances BaseClass, cette expression instanceof BaseClass sera vraie.  Par cons√©quent, pour distinguer les instances de la classe BaseClass des instances de classes d√©riv√©es, nous v√©rifions le constructeur.  Si le constructeur correspond √† BaseClass, alors notre protectedMethod est appel√©e sur l'instance BaseClass, tout comme une m√©thode publique classique: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); b.protectedMethod();</code> </pre><br>  Nous interdisons de tels appels: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor === BaseClass) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError();</code> </pre><br>  Vient ensuite l'appel de la m√©thode ferm√©e protectedMethod, qui, en fait, est la m√©thode que nous prot√©geons.  Dans la m√©thode, si vous devez faire r√©f√©rence aux membres de la classe BaseClass, vous pouvez le faire en utilisant l'instance stock√©e de _self.  C'est exactement ce que _self a √©t√© cr√©√© pour avoir acc√®s aux membres de la classe √† partir de toutes les m√©thodes priv√©es / priv√©es.  Par cons√©quent, si vous n'avez pas besoin d'acc√©der aux membres de classe dans votre m√©thode ou propri√©t√© prot√©g√©e, vous ne pouvez pas cr√©er la variable _self. <br><br><h3>  Appel d'une m√©thode prot√©g√©e dans la classe BaseClass </h3><br>  √Ä l'int√©rieur de la classe BaseClass, protectedMethod doit √™tre accessible uniquement par son nom, pas par ce biais.  Sinon, dans protectedMethod, nous ne pouvons pas distinguer si nous avons √©t√© appel√©s en tant que m√©thode publique ou √† l'int√©rieur d'une classe.  Dans ce cas, la fermeture nous sauve - protectedMethod se comporte comme une m√©thode priv√©e classique, ferm√©e √† l'int√©rieur de la classe et visible uniquement dans le cadre de la fonction BaseClass. <br><br><h3>  Description de la classe d√©riv√©e DerivedClass </h3><br>  Examinons maintenant une classe d√©riv√©e et comment la rendre accessible √† une m√©thode prot√©g√©e d'une classe de base. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DerivedClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _base = { <span class="hljs-attr"><span class="hljs-attr">protectedMethod</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.protectedMethod.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }; <span class="hljs-comment"><span class="hljs-comment">/** @summary       */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor === DerivedClass) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError(); } <span class="hljs-comment"><span class="hljs-comment">//     Object.defineProperty(this, 'protectedMethod', { enumerable: false, // ..       this configurable: false,//         for-in  //      value: function(){ checkAccess.call(_self); return _base.protectedMethod(); } }); //        this.someMethod = function(){ console.log(_base.protectedMethod()); } } DerivedClass.prototype = new BaseClass(); Object.defineProperty(DerivedClass.prototype, 'constructor', { value : DerivedClass, configurable: false });</span></span></code> </pre><br><h3>  Description du constructeur de classe d√©riv√©e </h3><br>  Dans la classe d√©riv√©e, nous cr√©ons un objet _base dans lequel nous pla√ßons une r√©f√©rence √† la m√©thode protectedMethod de la classe de base, ferm√©e au contexte de la classe d√©riv√©e via la m√©thode de liaison standard.  Cela signifie que l'appel de _base.protectedMethod ();  √† l'int√©rieur de protectedMethod, il ne s'agit pas d'un objet _base, mais d'une instance de la classe DerivedClass. <br><br><h3>  M√©thode ProtectedMethod Description √Ä l'int√©rieur de DerivedClass </h3><br>  Dans la classe DerivedClass, il est n√©cessaire de d√©clarer la m√©thode publique protectedMethod de la m√™me mani√®re que nous l'avons fait dans la classe de base via Object.defineProperty et de v√©rifier son acc√®s en appelant la m√©thode checkAccess ou en v√©rifiant directement dans la m√©thode: <br><br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(DerivedClass.prototype, <span class="hljs-string"><span class="hljs-string">'protectedMethod'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor === DerivedClass) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _base.protectedMethod(); } });</code> </pre><br>  Nous v√©rifions - <i>"mais avons-nous √©t√© appel√©s comme une simple m√©thode publique?"</i>  Pour les instances de la classe DerivedClass, le constructeur sera √©gal √† DerivedClass.  Si c'est le cas, g√©n√©rez une erreur.  Sinon, nous l'envoyons √† la classe de base et il fera d√©j√† tous les autres contr√¥les. <br><br>  Donc, dans la classe d√©riv√©e, nous avons deux fonctions.  L'un est d√©clar√© via Object.defineProperty et est n√©cessaire pour les classes d√©riv√©es de DerivedClass.  Il est public et dispose donc d'un ch√®que interdisant les appels publics.  La deuxi√®me m√©thode se trouve dans l'objet _base, qui est ferm√© √† l'int√©rieur de la classe DerivedClass et n'est donc visible par personne de l'ext√©rieur et elle est utilis√©e pour acc√©der √† la m√©thode prot√©g√©e √† partir de toutes les m√©thodes DerivedClass. <br><br><h3>  Protection des biens </h3><br>  Avec les propri√©t√©s, le travail se d√©roule un peu diff√©remment.  Les propri√©t√©s dans BaseClass sont d√©finies comme d'habitude via Object.defineProperty, uniquement dans les getters et setters, vous devez d'abord ajouter notre ch√®que, c'est-√†-dire  appelez checkAccess: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _protectedProperty; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _protectedProperty; }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); _protectedProperty = value; }, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); }</code> </pre><br>  √Ä l'int√©rieur de la classe BaseClass, la propri√©t√© prot√©g√©e n'est pas accessible par ce biais, mais √† la variable ferm√©e _protectedProperty.  S'il est important pour nous que le getter et le setter fonctionnent lors de l'utilisation de la propri√©t√© √† l'int√©rieur de la classe BaseClass, nous devons cr√©er des m√©thodes priv√©es getProtectedPropety et setProtectedProperty, dans lesquelles il n'y aura pas de v√©rifications, et elles doivent d√©j√† √™tre appel√©es. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _protectedProperty; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getProtectedProperty(); }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); setProtectedProperty(value); }, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProtectedProperty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    return _protectedProperty; } function setProtectedProperty(value){ //    _protectedProperty = value; } }</span></span></code> </pre><br>  Dans les classes d√©riv√©es, travailler avec des propri√©t√©s est un peu plus compliqu√©, car  la propri√©t√© ne peut pas √™tre remplac√©e par le contexte.  Par cons√©quent, nous utiliserons la m√©thode Object.getOwnPropertyDescriptor standard pour obtenir le getter et le setter de la propri√©t√© de la classe de base en tant que fonctions qui peuvent d√©j√† √™tre utilis√©es pour changer le contexte d'appel: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DerivedClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _base = { <span class="hljs-attr"><span class="hljs-attr">protectedMethod</span></span>: _self.protectedMethod.bind(_self), }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _baseProtectedPropertyDescriptor = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(_self, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      _base //    DerivedClass     Object.defineProperty(_base, 'protectedProperty', { get: function() { return _baseProtectedPropertyDescriptor.get.call(_self); }, set: function(value){ _baseProtectedPropertyDescriptor.set.call(_self, value); } }) //      ,      DerivedClass      . Object.defineProperty(_self, 'protectedProperty', { get: function () { checkAccess.call(_self); return base.protectedProperty; }, set: function (value) { checkAccess.call(_self); _base.protectedProperty = value; }, enumerable: false, configurable: false }); }</span></span></code> </pre><br><h3>  Description de l'h√©ritage </h3><br>  Et la derni√®re chose que je voudrais commenter est l'h√©ritage de DerivedClass de BaseClass.  Comme vous le savez peut-√™tre, DerivedClass.prototype = new BaseClass ();  cr√©e non seulement un prototype, mais r√©√©crit √©galement sa propri√©t√© constructeur.  De ce fait, pour chaque instance de DerivedClass, la propri√©t√© constructeur devient √©gale √† BaseClass.  Pour r√©soudre ce probl√®me, g√©n√©ralement apr√®s avoir cr√©√© un prototype, r√©√©crivez la propri√©t√© constructeur: <br><br><pre> <code class="javascript hljs">DerivedClass.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); DerivedClass.prototype.constructor = DerivedClass;</code> </pre><br>  Cependant, afin que personne ne r√©√©crive cette propri√©t√© apr√®s nous, nous utilisons le m√™me Object.defineProperty.  La propri√©t√© configurable: false emp√™che la propri√©t√© d'√™tre √† nouveau remplac√©e: <br><br><pre> <code class="javascript hljs">DerivedClass.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(DerivedClass.prototype, <span class="hljs-string"><span class="hljs-string">'constructor'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">value</span></span> : DerivedClass, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> });</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425521/">https://habr.com/ru/post/fr425521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425505/index.html">Analyse du processus de d√©marrage du noyau Linux</a></li>
<li><a href="../fr425507/index.html">Parsim Wikipedia pour les t√¢ches PNL en 4 √©quipes</a></li>
<li><a href="../fr425511/index.html">Fonctionnalit√©s non √©videntes de l'application Rotativa pour la g√©n√©ration de PDF dans l'application ASP.NET MVC</a></li>
<li><a href="../fr425515/index.html">Apple bloque la r√©paration ind√©pendante des nouveaux mod√®les de MacBook</a></li>
<li><a href="../fr425517/index.html">Comment Yandex a cr√©√© une pr√©vision des pr√©cipitations mondiales √† l'aide de radars et de satellites</a></li>
<li><a href="../fr425525/index.html">Tim Berners-Lee part sur le chemin de la guerre: "Un petit pas pour le web ..."</a></li>
<li><a href="../fr425527/index.html">Listes chez Kotlin. Approche Haskell</a></li>
<li><a href="../fr425529/index.html">Sans Forgetica: une police qui vous permet de m√©moriser l√©g√®rement mieux ce que vous lisez</a></li>
<li><a href="../fr425531/index.html">Refroidissement liquide des freins. Options de d√©veloppement du syst√®me</a></li>
<li><a href="../fr425533/index.html">Comment travailler dans le cloud: de la v√©rification de la fiabilit√© d'un datacenter √† la gestion d'une infrastructure virtuelle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>