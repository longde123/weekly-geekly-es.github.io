<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø ü§µüèº ü§Ω Comment voler de l'argent avec une carte sans contact et Apple Pay ‚òÄÔ∏è üëø üë©üèΩ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'article examine les mythes et sc√©narios populaires de fraude au paiement sans contact en utilisant l'exemple d'un v√©ritable terminal de point de ven...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment voler de l'argent avec une carte sans contact et Apple Pay</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422551/"><img alt="Comment voler de l'argent d'une carte sans contact dans votre poche? Dans quelle mesure PayPass et Apple Pay sont-ils s√©curis√©s?" src="https://habrastorage.org/webt/gb/2f/ry/gb2frybl-08fyn1a0w1xxjap9f0.jpeg"><br><br>  L'article examine les mythes et sc√©narios populaires de fraude au paiement sans contact en utilisant l'exemple d'un v√©ritable terminal de point de vente, de cartes PayPass / payWave et de t√©l√©phones avec la fonction Google Pay / Apple Pay. <br><br>  Sujets trait√©s: <br><br><ul><li>  <b>Est-il vraiment possible de voler de l'argent en mettant mon terminal PDV dans ma poche?</b>  - Nous allons essayer de reproduire int√©gralement ce sc√©nario de fraude du d√©but √† la fin, en utilisant un vrai terminal PDV et des cartes de paiement en conditions r√©elles. </li><li>  <b>Quelle est la diff√©rence entre les cartes Apple Pay physiques et virtuelles?</b>  - comment la carte physique et le jeton Apple Pay sont li√©s, et pourquoi Apple Pay est beaucoup plus s√ªr qu'une carte ordinaire. </li><li>  <b>Nous utilisons un renifleur NFC mat√©riel (ISO 14443A)</b> - nous utiliserons un appareil HydraNFC pour intercepter les donn√©es entre le terminal PDV et la carte.  Consid√©rez quelles donn√©es sensibles peuvent √™tre extraites du trafic intercept√©. </li><li>  <b>Nous analysons le protocole EMV</b> - quelles donn√©es la carte √©change avec le terminal POS, le format de demande utilis√©, les m√©canismes de protection contre la fraude et les attaques par rejeu. </li><li>  <b>Nous √©tudions les op√©rations sans carte (CNP, MO / TO)</b> - dans quels cas en fait (!) Vous pouvez voler de l'argent d'une carte, en ne lisant que les d√©tails sans contact, et dans lequel c'est impossible. </li></ul><br>  <font color="red"><b>Attention!</b></font> <br><br>  L'article d√©crit en d√©tail le sch√©ma hypoth√©tique de la fraude, du d√©but √† la fin, √† travers les yeux d'un fraudeur, afin de couvrir tous les aspects dans lesquels les mythes et les erreurs sont cultiv√©s.  Malgr√© le titre provocateur, la principale conclusion de l'article est que <b>les paiements sans contact sont assez s√ªrs et que les attaques contre eux prennent du temps et ne sont pas rentables</b> . <br><br>  <font color="red">Les mat√©riaux de l'article sont pr√©sent√©s √† titre informatif uniquement.</font>  <font color="red">Toutes les sc√®nes de fraude sont mises en sc√®ne et ex√©cut√©es avec le consentement des parties concern√©es.</font>  <font color="red">Tout l'argent d√©duit des cartes a √©t√© restitu√© √† leurs propri√©taires.</font>  <font color="red">Le vol de cartes de cr√©dit est une infraction p√©nale et est punissable par la loi.</font> <a name="habracut"></a><br><h1>  Comment √ßa marche? </h1><br>  Pour commencer, consid√©rons les concepts de base: tout mouvement d'argent √† l'aide de cartes de paiement n'est possible que par des interm√©diaires connect√©s au syst√®me de paiement, tels que VISA ou MasterCard.  Contrairement aux virements entre particuliers, le d√©bit d'argent de la carte n'est accessible qu'√† une personne morale (commer√ßant) ayant un accord d'acquisition avec une banque. <br><br><img src="https://habrastorage.org/webt/d5/1w/ce/d51wcetyqo_5ppr5467wwknaaus.png"><br>  <i><font color="99999">√âtapes de transaction lors du paiement via un terminal PDV</font></i> <br><br>  L'illustration ci-dessus montre le sch√©ma de paiement classique via un terminal POS.  C'est cette s√©quence d'actions qui se produit lorsque, apr√®s le paiement √† la caisse, vous attendez une confirmation au terminal. <br><br><ol><li>  L'acheteur applique / d√©tient / ins√®re la carte dans le terminal PDV; </li><li>  Un terminal de point de vente transmet des donn√©es √† une banque acqu√©reuse sur Internet; </li><li>  La banque acqu√©reuse via le syst√®me de paiement international (MPS) contacte la banque √©mettrice et demande si un titulaire de carte particulier peut payer pour l'achat; </li><li>  La banque √©mettrice confirme ou refuse l'achat, apr√®s quoi un bordereau est imprim√© (deuxi√®me ch√®que). </li></ol><br>  Il existe des exceptions √† ce sch√©ma, par exemple, les transactions hors ligne, nous les examinerons plus avant.  De m√™me, si la banque acqu√©reuse et la banque √©mettrice sont la m√™me banque, les √©tapes 2 et 4 sont effectu√©es au sein de la m√™me banque. <br><br>  <b>Vendeur</b> (marchand) - une personne ou une organisation qui fournit des biens ou des services <br><br>  La banque acqu√©reuse est une banque qui fournit au vendeur des services d'acceptation de paiement par carte bancaire.  Dans cette banque, il y a g√©n√©ralement un compte bancaire du vendeur o√π l'argent d√©bit√© de la carte est cr√©dit√©. <br><br>  Banque √©mettrice - banque qui a √©mis la carte.  Il contient le compte du titulaire de la carte, √† partir duquel l'argent est d√©bit√©. <br><br>  <b>Le syst√®me de paiement international</b> (MPS) est un syst√®me interm√©diaire international entre les banques du monde entier qui permet aux banques d'effectuer des r√®glements entre elles sans conclure un accord avec chaque banque s√©par√©ment.  Toutes les banques li√©es au minist√®re des chemins de fer acceptent de travailler selon les m√™mes r√®gles, ce qui simplifie consid√©rablement l'interaction.  Par exemple, Visa, MasterCard, UnionPay, American Express, <s>MIR</s> (non, MIR ne fonctionne pas √† l'√©tranger). <br><br>  <b>Titulaire de carte</b> - une personne qui a conclu un contrat de service de carte avec la banque √©mettrice. <br><br><h1>  Quelle est la diff√©rence entre une carte ordinaire d'Apple Pay ou de Google Pay? </h1><br>  La proc√©dure de liaison d'une carte bancaire au syst√®me Apple Pay ou Google Pay en raison de l'incompr√©hensibilit√© du processus donne souvent lieu √† des id√©es fausses, m√™me parmi les informaticiens.  J'ai entendu de nombreux mythes diff√©rents √† propos de cette technologie. <br><br><h4>  Mythes Apple Pay populaires </h4><br><ul><li>  <b><font color="D13CB8">La carte est copi√©e sur le t√©l√©phone</font></b> <br>  Ce n'est pas le cas, la carte √† microprocesseur contient une zone de m√©moire prot√©g√©e avec des informations cryptographiques qui ne peuvent pas √™tre extraites apr√®s l'√©mission de la carte.  De ce fait, une carte √† puce ne peut en aucun cas √™tre copi√©e.  <i><font color="99999">En toute justice, il faut dire que de telles attaques sont possibles, mais leur co√ªt d√©passe le montant total que la plupart des lecteurs de cet article d√©penseront toute leur vie.</font></i> </li><li>  <b><font color="D13CB8">Chaque fois que le t√©l√©phone se connecte √† Internet pendant le paiement</font></b> <br>  Google Pay / Apple Pay ne se connectent pas √† Internet lors du paiement via un terminal PDV.  Toutes les informations n√©cessaires sont stock√©es localement sur le t√©l√©phone. </li><li>  <b><font color="D13CB8">Un nouveau num√©ro de carte (PAN) est g√©n√©r√© pour chaque paiement</font></b> <br>  Il pourrait en √™tre ainsi si vous lisez les communiqu√©s de presse d'Apple sur la technologie Apple Pay.  Mais c'est une interpr√©tation erron√©e du concept de jeton.  En fait, les d√©tails de la carte virtuelle restent inchang√©s pendant longtemps, vous pouvez le v√©rifier par les derniers chiffres du num√©ro de carte dans le bordereau (ch√®que bancaire) lors du paiement des achats. </li><li>  <b><font color="D13CB8">Lors du paiement via Apple Pay / Google Pay, des frais suppl√©mentaires sont factur√©s</font></b> <br>  Ce n'est pas le cas, vous paierez exactement le montant indiqu√© sur l'√©tiquette de prix et selon les termes de votre accord avec la banque √©mettrice dont vous avez li√© la carte. </li><li>  <b><font color="D13CB8">L'argent peut √™tre d√©bit√© deux fois</font></b> <br>  Ce mythe s'applique non seulement √† Google Pay / Apple Pay, mais aussi aux cartes bancaires ordinaires.  Je pense que cela est d√ª aux syst√®mes de paiement des transports publics, dans lesquels le terminal d√©duit de l'argent du billet √† chaque fois qu'il est pr√©sent√©, de sorte que vous pouvez d√©biter deux fois ou plus si vous apportez la carte de mani√®re inexacte.  Dans le cas des terminaux de point de vente, ce risque n'existe pas, car le terminal cesse d'√©changer avec la carte d√®s qu'il re√ßoit les donn√©es n√©cessaires. </li></ul><br><br><img src="https://habrastorage.org/webt/z5/mt/og/z5mtogccxmh5picpde0ng_nmnnk.png"><br>  <i><font color="99999">Associer une carte physique √† un jeton dans le t√©l√©phone</font></i> <br><br>  Des syst√®mes comme Apple Pay sont aliment√©s par la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sp√©cification de tokenisation de paiement EMV</a> .  La proc√©dure d'association d'une carte physique et d'un t√©l√©phone √† Apple Pay n'a pas √©t√© d√©crite publiquement, nous analyserons donc le processus en fonction de donn√©es connues: <br><br><ol><li>  Le fournisseur (Google, Apple, Samsung) re√ßoit des informations cartographiques; </li><li>  Par le biais du MPS, le fournisseur demande si cette carte (cette banque √©mettrice) prend en charge la Tokenisation EMV; </li><li>  Du c√¥t√© MPS, une carte virtuelle (jeton) est g√©n√©r√©e, qui est t√©l√©charg√©e sur le stockage s√©curis√© du t√©l√©phone.  <i><font color="99999">Je ne sais pas exactement o√π la cl√© priv√©e de la carte virtuelle est g√©n√©r√©e, qu'elle soit transmise sur Internet ou g√©n√©r√©e localement sur le t√©l√©phone, dans ce cas, cela n'a pas d'importance.</font></i> </li><li>  Une carte √† jeton virtuelle g√©n√©r√©e appara√Æt sur le t√©l√©phone, les op√©rations sur lesquelles la banque √©mettrice interpr√®te comme des op√©rations sur la premi√®re carte physique.  En cas de blocage de la carte physique, le jeton est √©galement bloqu√©. </li></ol><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://zhovner.com/forever/applepay_different_pan.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Apple Pay vous permet de lire les d√©tails d'une carte virtuelle.</font></i>  <i><font color="99999">Le num√©ro PAN et la date d'expiration diff√®rent de la carte li√©e de la Alfa-Bank russe.</font></i>  <i><font color="99999">Le BIN de la carte virtuelle (480099) est d√©termin√© par la MBNA AMERICA BANK.</font></i> <br><br>  Lors d'un paiement par t√©l√©phone, le terminal PDV voit une carte VISA ou MasterCard r√©guli√®re et communique avec lui de la m√™me mani√®re qu'avec une carte physique.  Une carte √† jeton virtuelle contient tous les attributs d'une carte ordinaire: num√©ro PAN, date d'expiration, etc.  Dans le m√™me temps, le num√©ro de carte virtuelle et la p√©riode de validit√© diff√®rent de la carte d'origine jointe. <br><br><h2>  Sc√©nario 1 - Terminal POS r√©gulier </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/jz/mj/fwjzmjgmj7beldkf8bh4hdwmlay.jpeg"></div><br>  <i><font color="99999">Fraud de terminal de point de vente</font></i> <br><br>  L'intrigue de fraude la plus populaire dans l'esprit des gens ordinaires: un fraudeur avec un terminal allum√© est press√© contre eux dans la foule et radie de l'argent.  Nous allons essayer de reproduire ce sc√©nario dans la r√©alit√©. <br><br>  <b>Les conditions sont les suivantes</b> : <br><br><ul><li>  Le fraudeur a un <b>terminal de point de vente ordinaire</b> enti√®rement fonctionnel connect√© √† une banque acqu√©reuse, comme dans les magasins et les coursiers.  Le firmware du terminal n'est pas modifi√©.  Dans notre cas - Ingenico iWL250.  Il s'agit d'un terminal de point de vente portable avec un modem GPRS qui prend en charge le paiement sans contact, fonctionne sur batterie et est enti√®rement mobile. </li><li>  Le fraudeur n'utilise pas de moyens techniques suppl√©mentaires, uniquement un terminal PDV </li><li>  Les fonds d√©bit√©s sont cr√©dit√©s sur le compte courant du fraudeur, selon toutes les r√®gles des syst√®mes bancaires </li></ul><br><h3>  Entit√© l√©gale </h3><br><img src="https://habrastorage.org/webt/do/f_/qs/dof_qscba68g-7za5caz02pszqi.jpeg"><br><br>  Tout d'abord, nous avons besoin d'une entit√© juridique avec un compte courant et une acquisition connect√©e.  Comme de vrais escrocs, nous ne distinguerons rien en notre nom, mais nous essaierons d'acheter une entit√© juridique toute faite.  la personne sur le site pour les m√™mes escrocs.  Pour ce faire, regardez les annonces sur la premi√®re page de Google pour "acheter ip" et "acheter ooo". <br><br> <a href=""><img src="https://habrastorage.org/webt/lu/7v/yc/lu7vycgengac_zvziy7cltrjl-k.png"></a> <br>  <i><font color="99999">Offres de vente d'entreprises pr√™tes √† l'emploi contre les fraudeurs (cliquable)</font></i> <br><br>  Le prix d'une entreprise sur le march√© noir avec un compte courant varie de 20 √† 300 mille roubles.  J'ai r√©ussi √† trouver plusieurs offres de LLC avec un terminal POS √† partir de 200 mille roubles.  Ces soci√©t√©s sont encadr√©es par des mannequins, et l'acheteur re√ßoit l'ensemble complet des documents, ainsi qu'une ¬´carte cache¬ª - il s'agit d'une carte bancaire li√©e au compte de r√®glement de la soci√©t√© fictive.  Avec une telle carte, un fraudeur peut retirer de l'argent √† un guichet automatique. <br><br><blockquote>  Pour simplifier, nous supposons que LLC + compte bancaire + acquisition et un terminal de point de vente co√ªteront au fraudeur <b>100 000 roubles</b> .  En fait plus, mais nous simplifierons la vie de notre fraudeur hypoth√©tique, r√©duisant le co√ªt de l'attaque.  Apr√®s tout, plus le co√ªt d'une attaque est faible, plus sa mise en ≈ìuvre est facile. </blockquote><br><h2>  Volons de l'argent </h2><br>  Ainsi, le fraudeur a obtenu un terminal de point de vente et est pr√™t √† se rendre dans un endroit bond√© pour s'appuyer contre les victimes et voler de l'argent dans ses poches.  Dans notre exp√©rience, toutes les victimes ont √©t√© pr√©-inform√©es de nos intentions, et toutes les tentatives d'annuler de l'argent ont √©t√© faites avec leur consentement.  Dans les cas o√π les sujets n'avaient pas leurs propres cartes bancaires sans contact, on leur a demand√© de mettre notre carte dans leur portefeuille.  Auparavant, les sujets avaient d√©couvert exactement o√π et comment ils stockaient leurs cartes, de sorte que le fraudeur savait √† l'avance o√π se trouvait la carte sans contact dans le sac / la poche. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://zhovner.com/forever/nfc_fraud_in_public.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Vid√©o: un fraudeur fait rage dans un centre commercial</font></i> <br><br>  En cas de radiation r√©ussie, la transaction √©tait annul√©e via le menu du terminal et l'argent √©tait restitu√© sur le compte des sujets.  Pendant toute la dur√©e de l'exp√©rience, nous avons essay√© de ¬´voler¬ª de l'argent √† 20 sujets dans le b√¢timent du centre commercial et dans la rue.  Le r√©sultat du test est d√©crit ci-dessous. <br><br><h1>  Probl√®me: limite de transaction sans code PIN </h1><br>  La limite du montant maximal de la transaction sans confirmation avec un code PIN peut √™tre d√©finie √† la fois sur le terminal de point de vente lui-m√™me (CVM Required Limit) et sur le c√¥t√© de la banque.  En Russie, cette restriction est √©gale √† 1000 roubles. <br><br><hr><br>  <font color="99999"><i><b>UPD</b> Dans les param√®tres de la carte, le type d'autorisation M√©thodes de v√©rification du titulaire de carte (CVM) peut √™tre d√©fini comme une signature sur le ch√®que.</i></font>  <font color="99999"><i>Dans ce cas, une transaction sans contact aura lieu pour tout montant sans code PIN.</i></font> <br><br><hr><br>  Notre fraudeur d√©cide de radier 999,99 roubles √† la fois.  Si vous √™tes invit√© √† r√©essayer d'annuler le montant inf√©rieur √† la limite dans un court laps de temps, il vous sera √©galement demand√© d'entrer le code PIN et, dans la plupart des cas, il ne sera pas possible d'annuler 999,99 roubles plusieurs fois de suite.  Par cons√©quent, la strat√©gie la plus optimale ne sera pas plus d'une charge d'une carte. <br><br><div style="text-align:center;"><img width="300" alt="Terminal de point de vente au montant de 999,99" src="https://habrastorage.org/webt/at/kg/lt/atkgltocfv4dmqiutgb-8rbcej8.png"></div><br>  <i><font color="99999">En Russie, le montant maximum d√©bit√© sans code PIN est de 1000 roubles.</font></i> <br><br>  En fait, de nombreuses radiations d'un montant de 999,99 roubles sur une courte p√©riode peuvent d√©clencher le fonctionnement du syst√®me antifraude du c√¥t√© de la banque acqu√©reuse, cette strat√©gie n'est donc pas optimale pour le fraudeur.  Ainsi, dans la vraie vie, il devrait choisir des montants plus diversifi√©s, r√©duisant ainsi le revenu potentiel. <br><br>  Soit dit en passant, de nombreux articles sur ce sujet en russe disent que vous pouvez d√©finir manuellement votre propre limite sur les transactions sans contact sans code PIN.  Je n'ai pas pu trouver une telle option dans les principales banques russes.  Peut-√™tre connaissez-vous cette possibilit√©?  Il s'agit de paiements sans contact et non de transactions par puce et √©pingle. <br><br><h2>  Probl√®me: plusieurs cartes dans le portefeuille </h2><br>  C'est un point important dans ce sc√©nario d'attaque, car en r√©alit√© presque personne ne porte <b>une seule carte</b> dans sa poche.  Dans la plupart des cas, la carte est stock√©e dans le portefeuille avec d'autres cartes sans contact, telles que des billets de voyage ou d'autres cartes bancaires. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/im/x5/j1/imx5j1sci8ml-89qidz1_w8tdow.png" alt="Portefeuille gonfl√© par carte"></div><br>  Plus pr√©cis√©ment, mon terminal Igenico iWL250, lorsqu'il d√©tecte plus d'une carte dans le champ d'action avec un SAK indiquant la prise en charge du protocole 14443-4, renvoie une erreur: ¬´pr√©senter une carte¬ª. <br><br>  Mais tous les terminaux ne le font pas.  Par exemple, les terminaux POS VeriFone Sberbank choisissent une carte al√©atoire parmi plusieurs.  Certains terminaux ignorent simplement toutes les cartes s'il y en a plusieurs, sans afficher de messages d'erreur. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://zhovner.com/forever/pos_terminal_declines_few_cards.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Essayer de lire plusieurs cartes dans un portefeuille.</font></i>  <i><font color="99999">Le terminal POS renvoie une erreur.</font></i> <br><br><h3>  Anti-collision ISO 14443-3 </h3><br>  Lire une carte sp√©cifique parmi plusieurs n'est pas une t√¢che facile au niveau physique.  Pour r√©soudre ce probl√®me, il existe un m√©canisme d'anticollisions.  Il vous permet de s√©lectionner une carte si une r√©ponse a √©t√© re√ßue de plusieurs cartes √† la fois.  Il s'agit de la toute premi√®re √©tape pour √©tablir le contact avec une carte sans contact dans le protocole ISO-14443A.  √Ä ce stade, le lecteur n'est pas en mesure de d√©terminer laquelle des cartes pr√©sent√©es est bancaire.  La seule option est de choisir une carte plus ou moins similaire √† une carte bancaire, en fonction de la r√©ponse de SAK (Select Acknowledge). <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/_k/ie/yz/_kieyz-qmexulctjyhmfnjyvff8.png"></div>  <i><font color="99999">Valeur en bits dans la r√©ponse SAK</font></i> <br><br>  Ainsi, par exemple, la carte Tro√Øka (norme Mifare) utilis√©e dans les transports publics de Moscou a une valeur de <b>SAK = 0x08 (b00001000)</b> , dans laquelle le sixi√®me bit est nul.  Alors que pour toutes les cartes bancaires dans les r√©ponses SAK, le sixi√®me bit est 1, ce qui signifie la prise en charge du protocole ISO 14443-4. <br><br>  Par cons√©quent, tout ce que le terminal peut faire lorsque plusieurs cartes sont d√©tect√©es en m√™me temps est d'exclure les cartes qui ne prennent pas en charge ISO 14443-4 et d'en choisir une similaire √† la banque.  La prise en charge du protocole ISO 14443-4, en passant, ne garantit pas que cette carte sera une carte bancaire, mais tr√®s probablement, dans le portefeuille d'une personne ordinaire, il n'y aura aucun autre type de cartes prenant en charge ISO 14443-4. <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/4l/q0/e_/4lq0e_bzubjholfmtdiu29fmlxe.png"></div><br>  <i><font color="99999">Organigramme du protocole anti-collision</font></i> <br><br>  D'exp√©rience personnelle: malgr√© l'existence d'un protocole anti-collision, s'il y a au moins trois cartes sans contact dans votre portefeuille, il est <b><font color="red">EXTR√äMEMENT</font></b> difficile de lire <b><font color="red">avec succ√®s la</font></b> carte souhait√©e.  La plupart des tentatives entra√Ænent des erreurs de lecture.  Il est encore plus difficile de le faire en courant, accroch√© aux poches et aux sacs de quelqu'un d'autre. <br><br>  Cependant, nous consid√©rerons que notre fraudeur a beaucoup de chance, et cette restriction ne le d√©range pas. <br><br><h2>  Transactions hors ligne vs transactions en ligne </h2><br>  Dans des reportages effrayants, ils parlent d'escroqueurs avec des terminaux POS dans des voitures de m√©tro, qui vous font de l'argent dans les poches en chemin.  Ces histoires ne mentionnent pas d'o√π l'escroc a obtenu l'Internet mobile dans la voiture de m√©tro.  Peut-√™tre que son terminal prend en charge les transactions hors ligne? <br><br>  Les sp√©cifications EMV autorisent les transactions hors ligne.  Dans ce mode, le d√©bit s'effectue sans confirmation en ligne de la banque √©mettrice.  Cela fonctionne, par exemple, dans les transports publics √† Moscou et √† Saint-P√©tersbourg.  Afin de ne pas faire la queue √† l'entr√©e du bus, pendant que le terminal compl√®te la confirmation en ligne, il vous laisse entrer imm√©diatement sans v√©rifier si vous avez suffisamment d'argent sur votre compte pour payer le tarif.  En fin de journ√©e, lorsque Internet appara√Æt sur le terminal, les transactions sign√©es sont envoy√©es √† la banque √©mettrice.  S'il s'av√®re qu'√† ce moment vous n'avez pas d'argent pour payer le prix, la carte sera ajout√©e √† la liste des arr√™ts dans tous les terminaux de la ville.  Vous pouvez rembourser la dette via votre compte personnel par num√©ro de carte.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus</a> sur le paiement du bus √† Saint-P√©tersbourg. <br><br>  Personnellement, je n'ai pas pu obtenir de terminal POS prenant en charge cette fonction, donc dans le sc√©nario avec le terminal POS ¬´civil¬ª habituel, nous ne consid√©rerons pas la possibilit√© de d√©bit hors ligne.  Cela ne change rien, sauf que l'attaquant aura besoin d'Internet au terminal, donc l'attaque, par exemple, dans le m√©tro, est beaucoup plus compliqu√©e. <br>  Il existe des mod√®les de terminaux qui prennent en charge le WiFi, et en th√©orie, notre fraudeur pourrait utiliser le WiFi dans le m√©tro, ayant auparavant pris soin d'acheter un acc√®s sans publicit√© pour l'adresse MAC de son terminal de point de vente afin que l'authentification n'ait pas besoin d'√™tre effectu√©e via le portail captif, car sur le point de vente. le terminal ne peut pas faire cela. <br><br><h2>  Calculer le profit </h2><br>  Dans notre sc√©nario, le co√ªt de l'attaque √©tait de 100 000 roubles.  Cela signifie que pour au moins restituer les investissements, notre h√©ros doit effectuer au moins 100 transactions de 1 000 roubles chacune.  Imaginez qu'il √©tait assez agile et courait dans la ville toute la journ√©e, s'accrochant √† tout le monde d'affil√©e, de sorte qu'√† la fin de la journ√©e, il avait r√©ussi 120 radiations.  Nous ne prendrons pas en compte la commission d'acquisition (en moyenne 2%), la commission d'encaissement (4-10%) et les autres commissions. <br><br>  Peut-il encaisser de l'argent avec une carte li√©e √† un compte courant? <br><br>  En r√©alit√©, tout n'est pas si simple.  <b>L'argent ne sera cr√©dit√© sur le compte du fraudeur que dans quelques jours!</b>  Pendant ce temps, notre fraudeur devrait esp√©rer qu'aucune des cent vingt victimes ne contestera la transaction, ce qui est extr√™mement improbable.  Par cons√©quent, en r√©alit√©, le compte du fraudeur sera bloqu√© avant m√™me que l'argent lui soit cr√©dit√©. <br><br><blockquote>  <i>Si une personne a remarqu√© qu'un achat sur sa carte n'a pas √©t√© effectu√©, elle doit contacter la banque √©mettrice et d√©poser une r√©clamation.</i>  <i>Il faut jusqu'√† 30 jours pour examiner les op√©rations litigieuses en Russie et jusqu'√† 60 jours pour les transactions effectu√©es √† l'√©tranger.</i> <i>   -   -,   -     ,          .</i> <br><br> <b> ,           ()</b> <br></blockquote><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le co√ªt d'une attaque dans notre sc√©nario est de 100 000 roubles. En fait, il sera plusieurs fois plus √©lev√©, donc le fraudeur aura besoin de beaucoup plus d'efforts pour r√©aliser un profit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans notre sc√©nario, le fraudeur annule toujours 999,99 roubles, ce qui entra√Ænera tr√®s probablement le fonctionnement du syst√®me antifraude du c√¥t√© de la banque acqu√©reuse. En r√©alit√©, le fraudeur devra radier de plus petits montants. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afin de r√©cup√©rer au moins les investissements, le fraudeur devra traiter plusieurs centaines de victimes. Si m√™me une douzaine d'entre eux contactent la banque √©mettrice et contestent la transaction, le compte du fraudeur sera tr√®s probablement bloqu√©. Le sc√©nario dans lequel la banque acqu√©reuse est en collusion avec le fraudeur est peu probable, car la licence pour travailler avec le MPS co√ªte beaucoup plus cher que tout profit potentiel de ce type de fraude.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur les 20 sujets, seulement trois ont r√©ussi √† annuler l'argent de la carte, ce qui repr√©sente 15% du succ√®s de toutes les tentatives. Ce sont ces cas artificiels quand il y avait une seule carte dans votre poche. Dans les cas avec un portefeuille et plusieurs cartes, le terminal a renvoy√© une erreur. Dans un sc√©nario avec un terminal qui utilise un firmware modifi√© et impl√©mente un m√©canisme anti-collision, le pourcentage de charges r√©ussies peut √™tre plus √©lev√©. Cependant, m√™me dans le cas de l'utilisation d'anti-collisions, en conditions r√©elles sur la course, il est si difficile de compter une carte parmi plusieurs afin que le d√©bit r√©ussi dans de telles conditions puisse √™tre consid√©r√© comme de la chance. En r√©alit√©, la part des radiations r√©ussies ne d√©passera gu√®re 10% du nombre de tentatives.</font></font><br><br><blockquote> ,   ,      ,         .    -   ,     . <br></blockquote><br><h2>  2 ‚Äî  POS- </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disons que notre escroc travaille √† la caisse dans un magasin ou un coursier avec un terminal de point de vente mobile. </font><font style="vertical-align: inherit;">Dans ce cas, il a la possibilit√© de capturer des donn√©es de carte, qui, dans certains cas, peuvent suffire √† payer sur Internet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, d√©couvrons √† quoi ressemble une transaction sans contact et quel type de donn√©es la carte √©change avec un terminal de point de vente. </font><font style="vertical-align: inherit;">√âtant donn√© que nous sommes trop paresseux pour lire des milliers de pages de documentation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV sans contact</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous interceptons simplement l'√©change au niveau physique √† l'aide du renifleur HydraNFC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe une certaine diff√©rence entre la sp√©cification EMV pour MasterCard PayPass et Visa payWave. </font><font style="vertical-align: inherit;">Il s'agit de la diff√©rence de format de signature et de certaines donn√©es. </font><font style="vertical-align: inherit;">Mais pour nous, ce n'est pas essentiel.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Renifleur NFC </font></font></h2><br><img src="https://habrastorage.org/webt/bs/sx/oy/bssxoy5b-wmgyab33hakrihmfyc.png"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HydraNFC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un renifleur autonome enti√®rement open source ISO-14443A qui enregistre les commandes APDU intercept√©es sur une carte SD. </font><font style="vertical-align: inherit;">L'antenne renifleur est situ√©e entre le terminal et la carte et capture passivement toutes les informations transmises. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site Web sur HydraBus et le bouclier HydraNFC</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources du firmware</font></font></a> <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Votre navigateur ne prend pas en charge la vid√©o HTML5. <source src="https://zhovner.com/forever/hydranfc_pos_terminal_sniff.mp4" type="video/mp4"></video></div></div></div><br> <i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©monstration d'interception de l'√©change entre le terminal de point de vente et le t√©l√©phone avec Apple Pay</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ä l'avenir, je dois dire qu'√† ce niveau, le paiement par t√©l√©phone et une carte en plastique ordinaire n'est pas diff√©rent. </font><font style="vertical-align: inherit;">Pour un terminal de point de vente, il s'agit d'une carte VISA ordinaire. </font><font style="vertical-align: inherit;">Cependant, payer par t√©l√©phone est beaucoup plus s√ªr que d'utiliser une carte physique, puis nous analyserons pourquoi.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analyse du protocole EMV </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici √† quoi ressemble le vidage enregistr√© lorsque vous payez pour du chocolat et une bouteille d'eau pour une valeur totale de 142,98 roubles avec Apple Pay: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donn√©es brutes re√ßues du renifleur (spoiler ouvert)</font></font></b> <div class="spoiler_text"><a href=""><img width="200" src="https://habrastorage.org/webt/ia/by/xg/iabyxg1ocokwqruiq9ew3qmwqws.png"></a><br>
<i><font color="99999">      ()</font></i><br>
<br>
<b>R (READER)</b> ‚Äî POS-<br>
<b>T (TAG)</b> ‚Äî  (   )<br>
<code>R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00<br>
R&gt;&gt; 93 20 <br>
T&lt;&lt; 08 fe e4 ec fe <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; 50 00 57 cd <br>
R&gt;&gt; 26 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00 <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; e0 80 31 73 <br>
T&lt;&lt; 05 78 80 70 02 a5 46 <br>
R&gt;&gt; 02 00 a4 04 00 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 00 e0 42 <br>
T&lt;&lt; 02 6f 23 84 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 a5 11 bf 0c 0e 61 0c 4f 07 a0 00 00 00 03 10 10 87 01 01 90 00 4b b3 <br>
R&gt;&gt; 03 00 a4 04 00 07 a0 00 00 00 03 10 10 00 bc 41 <br>
T&lt;&lt; 03 6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00 1d 66 <br>
R&gt;&gt; 02 80 a8 00 00 23 83 21 36 a0 40 00 00 00 00 01 42 98 00 00 00 00 00 00 06 43 00 00 00 00 00 06 43 18 09 18 00 e0 11 01 03 00 f9 14 <br>
T&lt;&lt; 02 77 62 82 02 00 40 94 04 18 01 01 00 9f 36 02 02 06 9f 26 08 d6 f5 6b 8a be d7 8f 23 9f 10 20 1f 4a ff 32 a0 00 00 00 00 10 03 02 73 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 9f 6c 02 00 80 57 13 48 00 99 72 50 51 17 56 d2 31 22 01 00 00 05 20 99 99 5f 9f 6e 04 23 88 00 00 9f 27 01 80 90 00 af c8 <br>
R&gt;&gt; 03 00 b2 01 1c 00 c9 05 <br>
T&lt;&lt; 03 70 37 5f 28 02 06 43 9f 07 02 c0 00 9f 19 06 04 00 10 03 02 73 5f 34 01 00 9f 24 1d 56 30 30 31 30 30 31 34 36 31 38 30 34 30 31 37 37 31 30 31 33 39 36 31 36 37 36 32 35 90 00 a7 7b <br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analysons s√©par√©ment chaque ligne du vidage intercept√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R &gt;&gt; - donn√©es transmises par le POS-terminal </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T &gt;&gt; - donn√©es transmises par la carte (dans notre cas, un t√©l√©phone avec Apple Pay)</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14443-A S√©lectionner</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but de l'√©change, le terminal √©tablit une connexion avec la carte au niveau du canal. </font><font style="vertical-align: inherit;">Pour ceux qui sont familiers avec les r√©seaux et le mod√®le OSI, il sera pratique de le pr√©senter comme le niveau L2 et l'UID (Unique Identifier) ‚Äã‚Äãde la carte comme l'adresse MAC de l'h√¥te.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la terminologie standard ISO-14443: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dispositif de couplage de proximit√©) est le nom du lecteur, dans notre cas, il s'agit d'un PIC-terminal </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PICC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (carte de circuit int√©gr√© de proximit√©) est une carte, dans notre cas, le t√©l√©phone joue ce r√¥le</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une diff√©rence importante entre une carte de paiement classique d'Apple Pay est que la carte est toujours lisible et ne vous permet pas de contr√¥ler le processus de lecture. Il peut √™tre lu de mani√®re incontr√¥l√©e √† travers les v√™tements, tandis que le t√©l√©phone, tombant dans le champ d‚Äôaction du lecteur, invite l‚Äôutilisateur √† activer une carte virtuelle. Jusqu'√† ce que l'utilisateur confirme, le t√©l√©phone ne transmet aucune donn√©e et le lecteur ne sait m√™me pas qu'il y a une carte virtuelle √† proximit√©.</font></font><br>
<br>
<pre><code class="plaintext">R&gt;&gt; 52 // WUPA (wake up)<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA (Answer To Request type A) <font></font>
R&gt;&gt; 93 20 // Select cascade 1 (Anti Collision CL1 SEL)<font></font>
T&lt;&lt; 08 fe e4 ec fe // UID (4 bytes) + BCC (Bit Count Check)<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SEL (select tag 0x9370) + UID + CRC16<font></font>
T&lt;&lt; 20 fc 70  // SAK (Select Acknowledge 0x20) + CRC16 <font></font>
R&gt;&gt; 50 00 57 cd // HALT (Disable communocaion 0x5000) + CRC16<font></font>
R&gt;&gt; 26 // REQA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SELECT<font></font>
T&lt;&lt; 20 fc 70 // SAK<font></font>
R&gt;&gt; e0 80 31 73 // RATS (Request Answer to Select 0xE080) + CRC16<font></font>
T&lt;&lt; 05 78 80 70 02 a5 46 // ATS (Answer to select response)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le terminal envoie constamment la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©veil </font><b><font style="vertical-align: inherit;">0x52</font></b><font style="vertical-align: inherit;"> (WUPA) et d√®s que la carte appara√Æt dans le champ d'action, il r√©pond avec la commande Answer To Request de type A (ATQA), dans notre cas, c'est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x04 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La r√©ponse ATQA peut varier selon les fabricants de puces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir re√ßu une r√©ponse ATQA, le terminal commence une proc√©dure de d√©tection de collision pour d√©terminer s'il y a plus d'une carte dans le champ d'action. La commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x93 0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Select cascade level 1 (SEL CL1) demande √† toutes les cartes du champ d'action de signaler la premi√®re partie de leur UID. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carte r√©pond avec </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xFE 0xE4 0xEC 0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les quatre premiers octets sont l'UID de la carte virtuelle Apple Pay et le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contr√¥le</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du </font><b><font style="vertical-align: inherit;">nombre de</font></b><font style="vertical-align: inherit;"> bits </font><b><font style="vertical-align: inherit;">0xFE</font></b><font style="vertical-align: inherit;"> (BCC) √† la fin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir re√ßu les identifiants de carte, le lecteur acc√®de √† la carte sp√©cifique avec la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x93 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (SELECT). Pour une √©quipe d'√™tre carte UID </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xfe 0xe4 0xec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la BCC + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xdd 0x6E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carte r√©pond avec </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Select Acknowledge (SAK) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfc 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si plusieurs r√©ponses SAK sont re√ßues √† cette √©tape, le lecteur peut r√©duire la longueur de l'UID dans la commande SELECT jusqu'√† ce qu'une seule carte r√©ponde. Cependant, comme indiqu√© ci-dessus, certains terminaux de point de vente refusent de continuer si des collisions sont d√©tect√©es √† ce stade, c'est-√†-dire la pr√©sence de plusieurs cartes en m√™me temps.</font></font><br>
<br>
<blockquote> UID   4, 7  10 .    ,   ,      Apple Pay, UID   4 . ,  Apple Pay   UID   ,     ,  UID  . ,     ,         ,       UID     . <br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le lecteur envoie la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x50 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HALT + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x57 0xcd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. Il s'agit d'une commande de terminaison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, la proc√©dure est r√©p√©t√©e √† nouveau, le lecteur r√©veille √† nouveau la carte (WUPA), mais sans v√©rifier les collisions, SELECT est imm√©diatement ex√©cut√©. Pourquoi cela est fait - je ne sais pas, c'est peut-√™tre un moyen plus fiable de d√©terminer les collisions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxi√®me fois, le lecteur envoie d√©j√† la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xE0 0x80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Request Answer to Select (RATS) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x31 0x73</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carte r√©pond </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x05 0x78 0x80 0x70 0x02</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©ponse pour s√©lectionner la r√©ponse (ATS) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xA5 0x46</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©pondre pour s√©lectionner</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- La r√©ponse est similaire √† la r√©ponse √† la r√©initialisation (ATR) pour les cartes de contact. </font><font style="vertical-align: inherit;">Il contient des informations sur la taille de trame maximale et les param√®tres de couche de liaison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ce stade, le niveau ¬´canal¬ª est termin√©, puis l'√©change commence sur un protocole de niveau sup√©rieur, en fonction de l'application contenue sur la carte. </font><font style="vertical-align: inherit;">L'op√©ration SELECT est la m√™me pour toutes les cartes sans contact de la norme ISO 14443A, y compris les √©tiquettes NFC, les tickets de transports en commun, etc.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande d'applications disponibles - SELECT PPSE</font></font></h4><br>
<font color="grey"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description officielle: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sp√©cifications EMV sans contact - PPSE et gestion des applications pour l'√©l√©ment s√©curis√©</font></font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le d√©but de la communication avec une carte EMV se produit toujours en lisant le PPSE (Payment System Environment). </font><font style="vertical-align: inherit;">Le terminal demande √† la carte quelles sont les applications de paiement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus souvent, il s'agit d'une seule application, comme dans notre exemple - VISA. </font><font style="vertical-align: inherit;">Cependant, il existe des cartes avec plusieurs applications de paiement, par exemple, il existe des cartes MIR nationales sp√©ciales avec deux applications de paiement √† l'int√©rieur. </font><font style="vertical-align: inherit;">Le syst√®me de paiement MIR ne fonctionnant pas √† l'√©tranger, une deuxi√®me application de paiement est int√©gr√©e √† la carte, en fait une deuxi√®me carte. </font><font style="vertical-align: inherit;">Il peut s'agir d'une application de syst√®me de paiement JCB ou UnionPay. </font><font style="vertical-align: inherit;">Ces cartes sont appel√©es cobaging. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commande APDU SELECT PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 00'<font></font>
  00 A4 04 00 //  select <font></font>
   0E //  command data (14 )<font></font>
    32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 // command data 2PAY.SYS.DDF01<font></font>
    00 //  <font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©pondre √† SELECT PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'6F 23 84 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 A5 11 BF 0C 0E 61 0C 4F 07 A0 00 00 00 03 10 10 87 01 01 90 00'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de commodit√©, nous analyserons la r√©ponse en utilisant l'analyseur en ligne du format TVL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info/lib/EMV/TLVs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La m√™me r√©ponse trait√©e par l'analyseur: </font></font><br>
<br>
<img width="900" alt="EMV SELECT PPSE VISA RESPONE parsed" src="https://habrastorage.org/webt/yi/x_/_y/yix__y6me7kqdg9inwi05eyk1yq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De tout cela, nous ne sommes int√©ress√©s que par l'identifiant de l'application de paiement (AID). Dans ce cas, cette valeur est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A0000000031010</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-√†-dire Visa International. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'AID est marqu√© d'un marqueur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4F</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le deuxi√®me bit apr√®s le jeton est la longueur des donn√©es qu'il contient. Bien que la longueur de l'AID puisse varier de 5 √† 16 octets, dans la plupart des cas, elle est de 7 octets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AID Big List: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eftlab.co.uk/knowledge-base/211-emv-aid-rid-pix</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quelques </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">AID</font></a><font style="vertical-align: inherit;"> populaires</font></font><br>
<br>
<pre><code class="plaintext">A0000000031010 Visa International<font></font>
A0000000032020 Visa International<font></font>
A0000000041010 Mastercard International<font></font>
A0000000043060 Mastercard International United States Maestro (Debit)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicateur de priorit√© d'application - indique la priorit√© des applications de paiement. </font><font style="vertical-align: inherit;">Par exemple, dans les cartes de cobaging de MIR qui contiennent plusieurs applications de paiement, ce champ indique laquelle des deux applications est prioritaire. </font><font style="vertical-align: inherit;">√âtant donn√© que nous n'avons qu'une seule demande de Visa International, elle pointe vers elle et il n'y a aucune priorit√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer l'application de paiement - SELECT AID</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 07 A0 00 00 00 03 10 10'<font></font>
  00 A4 04 00 //  select <font></font>
   07 //  command data (7 )<font></font>
    A0 00 00 00 03 10 10 // AID Visa International<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir s√©lectionn√© l'application de paiement n√©cessaire, le terminal la lance. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PDOL (liste des objets de donn√©es des options de traitement)</font></font></h4><br>
<pre><code class="cpp">'6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analysons la r√©ponse avec l'analyseur </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lo/jr/dh/lojrdhsptl6kkauc02a5c0qwnme.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En r√©ponse au lancement de l'application de paiement, la carte signale un ensemble de param√®tres qu'elle attend de la part du terminal - PDOL (Processing Options Data Object List). </font><font style="vertical-align: inherit;">Le terminal doit r√©pondre dans le strict respect de cette s√©quence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les PDOL pour diff√©rentes cartes peuvent varier. </font><font style="vertical-align: inherit;">Le nombre total de param√®tres PDOL est de plusieurs dizaines. </font><font style="vertical-align: inherit;">Une liste compl√®te des param√®tres PDOL peut √™tre trouv√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons de plus pr√®s PDOL. </font><font style="vertical-align: inherit;">La longueur indiqu√©e apr√®s le marqueur est la longueur strictement attendue de la r√©ponse du terminal √† cette requ√™te. </font><font style="vertical-align: inherit;">Une r√©ponse vide est remplie de z√©ros √† la longueur souhait√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analyse des requ√™tes PDOL:</font></font><br>
<br>
<pre><code class="cpp">9F 38 18 //   PDOL.  18 (24 ) <font></font>
 9F 66 ( 04) // Terminal Transaction Qualifiers (TTQ).    . <font></font>
  9F 02 ( 06) //  <font></font>
   9F 03 ( 06) //  <font></font>
   9F 1A ( 02) //     ISO3166-1<font></font>
   95 ( 05) // Terminal Verification Results<font></font>
    5F 2A ( 02) //  ,    ,   ISO4217<font></font>
     9A ( 03) //    YYMMDD<font></font>
      9C ( 01) //   <font></font>
       9F 37 ( 04) //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'√† ce point, toutes les donn√©es transmises sont identiques pour toutes les transactions sur cette carte.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Demande de facturation - OBTENIR DES OPTIONS DE TRAITEMENT </font></font></h4><br>
<pre><code class="cpp">'80A8000023832136A0400000000001429800000000000006430000000000064318091800E011010300'<font></font>
 80 A8 00 00 //  GET PROCESSING OPTIONS (GPO)<font></font>
  23 //    (35 )<font></font>
   83 //  PDOL-<font></font>
    21 //  PDOL- (33 )<font></font>
     36 A0 40 00 // Terminal Transaction Qualifiers (TTQ)<font></font>
      00 00 00 01 42 98 //   (142,98 )<font></font>
       00 00 00 00 00 00 //   <font></font>
        06 43 //    (643 - )<font></font>
         00 00 00 00 00 // Terminal Verification Results (TVR)<font></font>
          06 43 //  (643 - russian ruble) <font></font>
           18 09 18 //  (18  2018 )<font></font>
            00 //  <font></font>
             E0 11 01 03 //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette r√©ponse montre clairement comment le terminal, qui est situ√© en Russie, demande √† √™tre d√©bit√© de la carte pour un montant de 142,98 roubles. </font><font style="vertical-align: inherit;">Nous attirons l'attention sur le nombre al√©atoire √† la fin (E0110103). </font><font style="vertical-align: inherit;">Il s'agit du param√®tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9F37 Unpredictable Number</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il s'agit de la premi√®re mention de la cryptographie. </font><font style="vertical-align: inherit;">√Ä l'avenir, ce num√©ro, ainsi que les donn√©es de transaction, la carte devra signer avec une signature cryptographique. </font><font style="vertical-align: inherit;">Cela donne au terminal le contr√¥le de la pertinence de la signature de la carte et prot√®ge contre les attaques par rejeu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ponse de la carte √† GET PROCESSING OPTIONS </font></font></h4><br>
<pre><code class="cpp">'7762820200409404180101009F360202069F2608D6F56B8ABED78F239F10201F4AFF32A00000000010030273000000004000000000000000000000000000009F6C02008057134800997250511756D23122010000052099995F9F6E04238800009F2701809000'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette r√©ponse contient des champs de donn√©es sp√©cifiques √† VISA, j'ai donc utilis√© un analyseur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prenant en charge la sp√©cification de paiement sans contact VISA (VCSP)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img width="600" src="https://habrastorage.org/webt/n-/b0/la/n-b0laaskytjo0ahyyvlo6e7js0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Profil d'√©change d'application (AIP) - contient des informations sur les param√®tres de l'application de paiement. Dans notre cas, AIP est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 40</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Consid√©rez les valeurs de ce param√®tre dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV 4.3 Book 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/rp/tc/ya/rptcyalvdwd6oaycintkbt02krq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, un bit est d√©fini dans le deuxi√®me octet, qui, selon ce tableau, est r√©serv√© pour une utilisation future (RFU). Qu'est-ce que cela signifie et quel est l'int√©r√™t d'investir dans Apple Pay, je ne sais pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AIP contient des informations importantes sur les m√©thodes d'authentification prises en charge (SDA, CDA, DDA) de paiement. Pourquoi dans mon cas tous ces drapeaux sont √©gaux √† z√©ro - je ne comprends pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Localisateur de fichiers d'application (AFL) - Contient des informations d'enregistrement SFI dans un AID sp√©cifique. Sur la base de cette r√©ponse, le terminal va g√©n√©rer une requ√™te READ RECORD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analysons plus en d√©tail la r√©ponse AFL: l' </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
identificateur de fichier court (SFI) est 0x18. Ce param√®tre est cod√© avec cinq bits au lieu de huit. Par cons√©quent, la valeur 0x18 (b00011000) est convertie en b00000011 et nous obtenons 0x3. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premier enregistrement = 1</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dernier enregistrement = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
i.e. dans le "dossier" n ¬∞ 3, il y a des entr√©es de 1 √† 1, c'est-√†-dire une entr√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le compteur de transactions d'application (ATC) est un compteur de transactions incr√©mentielles qui s'incr√©mente d'une unit√© chaque fois qu'une GET PROCESSING OPTIONS est demand√©e. Une fois la valeur 0xFFFF ou 0x7FFF atteinte, l'application de paiement sera d√©finitivement bloqu√©e. Je crois que cela est fait pour se prot√©ger contre la force brute de la cl√© priv√©e de la carte. Dans notre cas, on peut voir que cet iPhone avec Apple Pay a d√©j√† √©t√© utilis√© pour payer 518 (0x206) fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cryptogramme d'application (AC) - une signature cryptographique calcul√©e par la carte √† l'aide de sa cl√© priv√©e. Cette signature est transmise avec le reste des donn√©es √† la banque √©mettrice, et l'authenticit√© de la transaction est v√©rifi√©e sur sa base. La cl√© priv√©e de la carte ne pouvant pas √™tre (moyen accessible) extraite de la carte, cela √©limine la possibilit√© de copier la carte. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Issuer Application Data (IAD) - Contient des donn√©es propri√©taires sp√©cifiques √† VISA. </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai pas ma√Ætris√© l'analyse de cette structure, aide.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Card Transaction Qualifiers (CTQ) - Liste sp√©cifique √† VISA des sp√©cifications de cartes prises en charge. Par exemple, est-il possible d'utiliser cette carte sans contact pour des transactions dans un guichet automatique ou non, et quel type de confirmation sera requis. </font></font><br>
<br>
<img align="right" width="200" src="https://habrastorage.org/webt/vd/aw/ny/vdawnyz0tkkjbs-rradkbk0loiy.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donn√©es √©quivalentes de la piste 2 - </font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oppa!</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce champ contient le num√©ro de carte et la date d'expiration, plus de d√©tails sur ces informations seront discut√©s plus tard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicateur de facteur de forme (FFI) - champ sp√©cifique √† VISA. </font><font style="vertical-align: inherit;">D√©crit le facteur de forme et les caract√©ristiques d'un appareil de paiement. </font><font style="vertical-align: inherit;">Dans notre cas, il est clair qu'il s'agit d'un t√©l√©phone portable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cryptogram Information Data (CID) - </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai pas ma√Ætris√© l'analyse de cette structure, aide.</font></font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIRE la requ√™te ENREGISTREMENT DES DONN√âES</font></font></h4><br>
<pre><code class="cpp">'00 b2 01 1c 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le terminal envoie une demande de lecture des enregistrements re√ßus de l'AFL: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/jw/mv/odjwmvemclc5gd4q6dhvlcmqfjy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans ce cas, √† partir de l'octet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lu comme deux valeurs, o√π les cinq premiers bits sont 0x18 (b000011) et sont SFI, et les trois bits suivants sont 0x04 (d100), et constituer le num√©ro d'enregistrement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©pondre √† READ RECORD</font></font></h2><br>
<pre><code class="cpp">'70375F280206439F0702C0009F19060400100302735F3401009F241D5630303130303134363138303430313737313031333936313637363235'
</code></pre><br>
<img src="https://habrastorage.org/webt/x9/ke/vv/x9kevvho_se85wg6vlgkwrd4jtw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contr√¥le d'utilisation des applications (AUC) - d√©termine s'il est autoris√© √† payer avec une carte √† l'√©tranger et les types d'op√©rations autoris√©s. </font></font><br>
<br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9F19 - quelque chose d'incompr√©hensible, apparemment - la Tokenisation</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
EMV de la </font><i><font color="99999"><font style="vertical-align: inherit;">liste d'objets de donn√©es d'authentification dynamique de donn√©es (DDOL)</font></font></i><font style="vertical-align: inherit;"> , la r√©f√©rence de compte de paiement (PAR) est un param√®tre sp√©cifique aux cartes √† jetons (virtuelles). </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai pas ma√Ætris√© l'analyse de cette structure, aide.</font></font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que peut-on extraire d'une transaction intercept√©e?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons analys√© un exemple sp√©cifique du trafic intercept√© d'une transaction sans contact Apple Pay avec une carte VISA li√©e. Le protocole MasterCard est l√©g√®rement diff√©rent, mais globalement similaire. D'apr√®s l'analyse, on peut voir que la transaction est prot√©g√©e par crypto-signature et que le protocole est prot√©g√© contre une attaque par rejeu. </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe un protocole de paiement sans contact obsol√®te en mode Bande magn√©tique (MSD), qui est beaucoup moins prot√©g√© contre les attaques par rejeu, mais dans cet article, je ne le d√©monterai pas, car, √† ma connaissance, il n'est presque pas pris en charge dans la CEI, je me trompe peut-√™tre. </font></font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/ys/kk/8_/yskk8_eztdatvwiziqusnqsa2ee.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä partir des donn√©es intercept√©es, vous pouvez extraire le num√©ro de carte (PAN) et la date d'expiration</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, √† partir du trafic intercept√©, vous pouvez extraire le num√©ro de carte complet et la date d'expiration. </font><font style="vertical-align: inherit;">Bien que CVV ne soit pas dans cette d√©charge, ces donn√©es sont d√©j√† suffisantes pour payer dans certaines boutiques en ligne. </font><font style="vertical-align: inherit;">Dans le cas d'une carte en plastique physique ordinaire, les donn√©es intercept√©es contiendront </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le m√™me PAN et la m√™me date d'expiration qui estampill√©e sur la carte elle-m√™me!</font></font></b><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paiement Internet sans CVV (CNP, MO / TO)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon article pr√©c√©dent </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Nous utilisons Apple Pay et la carte Tro√Øka comme passe pour travailler¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur ACS bas√© sur Apple Pay, j'ai √©t√© critiqu√© dans les commentaires, disant que n'ayant que les 10 derniers chiffres de la carte, vous pouvez voler de l'argent. Dans le vidage ci-dessus, non seulement le num√©ro complet de ma carte est indiqu√©, mais aussi la date d'expiration. Ces donn√©es suffisent √† payer dans certains magasins sur Internet. Eh bien, essayez de le faire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ue/-q/wt/ue-qwtah0au0uftojwdu8qsrs3m.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le formulaire d'ajout de carte Amazon ne n√©cessite pas de CVV</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il s'agissait d'un num√©ro de carte physique, de l'argent pourrait en effet √™tre vol√©, mais les donn√©es du jeton Apple Pay peuvent √™tre utilis√©es UNIQUEMENT pour les op√©rations de client pr√©sent (CP) lorsque la carte signe la transaction avec une signature cryptographique. </font><font style="vertical-align: inherit;">Ces donn√©es ne peuvent pas √™tre utilis√©es pour le paiement sur Internet et d'autres op√©rations telles que Carte non pr√©sente (CNP), c'est-√†-dire par t√©l√©phone ou par e-mail. </font><font style="vertical-align: inherit;">Voil√†! </font></font><br>
<br>
<font color="r"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour tous ceux qui souhaitent v√©rifier cela, je vous informe que les d√©tails du vidage Apple Pay intercept√© ci-dessus sont actuellement pertinents et li√©s √† une carte valide qui contient de l'argent. </font><font style="vertical-align: inherit;">Au moment de la r√©daction de ce document, cela repr√©sente 5 mille roubles. </font><font style="vertical-align: inherit;">Je sugg√®re d'essayer de les voler :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi Apple Pay est plus s√ªr qu'une carte ordinaire</font></font></h2><br>
<div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/jz/cn/2n/jzcn2ndu1pfw-znat4mxtab6k8k.png"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple Pay vs carte sans contact ordinaire</font></font></font></i><br>
<br>
<ul>
<li> <b>Apple Pay   (  )    .</b>            POS-.  , ¬´¬ª        ,       ,   ,     ,   ,   .  Apple Pay  ,            ,       .</li>
<li><b>     </b> ‚Äî    Apple Pay      (13,56 ),   ,           .       .     Apple Pay     ,     .</li>
<li><b>       </b> ‚Äî         Card not present (CNP),      ,    ..     Apple Pay    . </li>
<li><b>   </b> ‚Äî        (Cardholder name)    .   ,   ,    .  Apple Pay    . </li>
</ul><br>
<h2></h2><br>
     .     ,         .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a>.<br>
<br>
  , Apple Pay     .      CNP- (  )    ,         .<br>
<br>
<hr><br>
 :<br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les soci√©t√©s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tehpos.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le mat√©riel.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banque de l'Oural pour la reconstruction et le d√©veloppement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et personnellement √† Alexander Paderin (Directeur g√©n√©ral du Centre de s√©curit√© de l'information) pour des consultations.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rangez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aj.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour fournir les </font><font style="vertical-align: inherit;">iPhones pour les </font><font style="vertical-align: inherit;">tests.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeria </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquamine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les illustrations de l'article.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleb </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JRun</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de Digital Security pour des conseils techniques.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexGre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour des consultations sur le protocole EMV.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habrayuzeru </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour un excellent analyseur de la </font><font style="vertical-align: inherit;">norme EMV: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info</font></font></a></li>
</ul></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422551/">https://habr.com/ru/post/fr422551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422541/index.html">Le drame des trous dans l'Union s'est transform√© en fantasmagorie</a></li>
<li><a href="../fr422543/index.html">Pensez comme un programmeur. Tutoriel de r√©solution de probl√®mes</a></li>
<li><a href="../fr422545/index.html">Fa√ßons de synchroniser les onglets du navigateur</a></li>
<li><a href="../fr422547/index.html">Pour √©liminer Spectre et Meltdown, vous devrez peut-√™tre cr√©er un tout nouveau type de processeur</a></li>
<li><a href="../fr422549/index.html">Corda: Kotlin</a></li>
<li><a href="../fr422553/index.html">L'extension de navigateur officielle Mega vole les donn√©es de partage de fichiers et la crypto-monnaie</a></li>
<li><a href="../fr422555/index.html">Architecture multi-modules Android. De A √† Z</a></li>
<li><a href="../fr422561/index.html">Comment Yandex a appliqu√© la vision par ordinateur pour am√©liorer la qualit√© des √©missions vid√©o. Technologie DeepHD</a></li>
<li><a href="../fr422565/index.html">Webinaires Skillbox Friday: Tout pour les programmeurs et les concepteurs</a></li>
<li><a href="../fr422569/index.html">Application de suivi horaire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>