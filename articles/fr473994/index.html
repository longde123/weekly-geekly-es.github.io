<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍜 🤹🏻 📙 Chargement de script moderne 🐡 👂🏽 🍡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Passer le bon code pour chaque navigateur n'est pas une tâche facile. 

 Dans cet article, nous examinerons plusieurs options pour résoudre ce problèm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chargement de script moderne</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/473994/">  Passer le bon code pour chaque navigateur n'est pas une tâche facile. <br><br>  Dans cet article, nous examinerons plusieurs options pour résoudre ce problème. <br><br><img src="https://habrastorage.org/webt/4f/rs/cl/4frsclbbpc2v0pwpxqehbh3tj1w.png"><br><br>  Passer du code moderne par un navigateur moderne peut améliorer considérablement les performances.  Vos packages JavaScript pourront contenir une syntaxe moderne plus compacte ou optimisée et prendre en charge des navigateurs plus anciens. <br><br>  Parmi les outils pour les développeurs, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modèle de module / nomodule de</a> chargement déclaratif du code moderne ou hérité domine, ce qui fournit aux navigateurs des sources et vous permet de décider lesquels utiliser: <br><br><pre><code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"module"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script nomodule src=<span class="hljs-string"><span class="hljs-string">"/legacy.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Malheureusement, tout n'est pas si simple.  L'approche HTML illustrée ci-dessus déclenche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un rechargement de script dans Edge et Safari</a> . <a name="habracut"></a><br><br><h4>  Que peut-on faire? </h4><br>  Selon le navigateur, nous devons fournir l'une des options pour les scripts compilés, mais quelques anciens navigateurs ne prennent pas en charge toute la syntaxe nécessaire pour cela. <br><br>  Tout d'abord, il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Safari Fix</a> .  Safari 10.1 prend en charge les modules JS, pas l'attribut <code>nomodule</code> dans les scripts, ce qui lui permet d'exécuter du code moderne et hérité.  Cependant, l'événement <code>beforeload</code> non standard pris en charge par Safari 10 et 11 peut être utilisé pour polyfill le <code>nomodule</code> . <br><br><h4><a name="first"></a>  Première méthode: téléchargement dynamique </h4><br>  Vous pouvez contourner ces problèmes en implémentant un petit chargeur de script.  Similaire au fonctionnement de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LoadCSS</a> .  Au lieu d'espérer la mise en œuvre de modules ES et de l'attribut <code>nomodule</code> dans les <code>nomodule</code> , vous pouvez essayer d'exécuter un script de module en tant que «test avec un test décisif», et en fonction du résultat, choisissez de télécharger un code moderne ou hérité. <br><br><pre> <code class="javascript hljs">&lt;!-- use a <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> script to detect modern browsers: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript"> self.modern = </span></span><span class="hljs-literal"><span class="xml"><span class="actionscript"><span class="hljs-literal">true</span></span></span></span><span class="xml"><span class="actionscript"> </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- now use that flag to load modern VS legacy code: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> addEventListener(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'load'</span></span></span></span><span class="xml"><span class="javascript">, </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"></span><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span></span><span class="xml"><span class="javascript">{ </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">var</span></span></span></span><span class="xml"><span class="javascript"> s = </span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">.createElement(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'script'</span></span></span></span><span class="xml"><span class="javascript">) </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript"> (</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">'noModule'</span></span></span></span><span class="xml"><span class="javascript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">in</span></span></span></span><span class="xml"><span class="javascript"> s) { </span></span><span class="hljs-comment"><span class="xml"><span class="javascript"><span class="hljs-comment">// notice the casing s.type = 'module' s.src = '/modern.js' } else { s.src = '/legacy.js' } document.head.appendChild(s) }) </span></span></span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Mais avec cette approche, vous devez attendre la fin du script du module "tournesol" avant d'implémenter le script correct.  Cela se produit car <code>&lt;sript type="module"&gt;</code> fonctionne toujours de manière asynchrone.  Mais il y a une meilleure façon! <br><br>  Vous pouvez implémenter l'option indépendante en vérifiant si le <code>nomodule</code> est <code>nomodule</code> en <code>nomodule</code> dans le navigateur.  Cela signifie que nous considérerons les navigateurs comme Safari 10.1 comme obsolètes, même s'ils prennent en charge les modules.  Mais ça <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pourrait être</a> pour le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mieux</a> .  Voici le code pertinent: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'noModule'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) { <span class="hljs-comment"><span class="hljs-comment">// notice the casing s.type = 'module' s.src = '/modern.js' } else s.src = '/legacy.js' } document.head.appendChild(s)</span></span></code> </pre> <br>  Cela peut être rapidement transformé en une fonction qui charge du code moderne ou hérité, et en fournit également le chargement asynchrone: <br><br><pre> <code class="javascript hljs">&lt;script&gt; $loadjs(<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"/legacy.js"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">$loadjs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">src,fallback,s</span></span></span><span class="hljs-function">) </span></span>{ s = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'noModule'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) s.type = <span class="hljs-string"><span class="hljs-string">'module'</span></span>, s.src = src <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s.async = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, s.src = fallback <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(s) } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre> <br>  Quel est le compromis ici? <br><br>  <b>Précharge</b> <br><br>  Étant donné que la solution est complètement dynamique, le navigateur ne sera pas en mesure de détecter nos ressources JavaScript tant qu'il n'aura pas démarré le code d'amorçage que nous avons écrit pour insérer des scripts modernes ou hérités.  En règle générale, un navigateur analyse HTML pour les ressources qu'il peut télécharger à l'avance.  Ce problème est résolu, mais pas idéalement: vous pouvez précharger la version moderne du package dans les navigateurs modernes en utilisant <code>&lt;link rl=modulpreload&gt;</code> . <br><br>  Malheureusement, jusqu'à présent, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">seul Chrome prend en charge le</a> <code>modulepreload</code> . <br><br><pre> <code class="javascript hljs">&lt;link rel=<span class="hljs-string"><span class="hljs-string">"modulepreload"</span></span> href=<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"><span class="xml"><span class="undefined">self.modern=1</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- etc --&gt;</code> </pre> <br>  Si cette technique vous convient, vous pouvez réduire la taille du document HTML dans lequel vous intégrez ces scripts.  Si votre charge utile est petite, comme un écran de démarrage ou un code de téléchargement d'application client, il est peu probable que la suppression du scanner de précharge affecte les performances.  Et si vous dessinez beaucoup de code HTML important sur le serveur à envoyer aux navigateurs, le scanner de précharge vous sera utile et l'approche décrite ne sera pas la meilleure option pour vous. <br><br>  Voici à quoi pourrait ressembler cette solution en cours d'utilisation: <br><br><pre> <code class="javascript hljs">&lt;link rel=<span class="hljs-string"><span class="hljs-string">"modulepreload"</span></span> href=<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"><span class="xml"><span class="undefined">self.modern=1</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script&gt; $loadjs(<span class="hljs-string"><span class="hljs-string">"/modern.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"/legacy.js"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">$loadjs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,d,c</span></span></span><span class="hljs-function">)</span></span>{c=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"script"</span></span>),self.modern?(c.src=e,c.type=<span class="hljs-string"><span class="hljs-string">"module"</span></span>):c.src=d,<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(c)} &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre> <br>  Il convient également de noter que la liste des navigateurs qui prennent en charge les modules JS est presque la même que ceux qui prennent en charge <code>&lt;link rl=preload&gt;</code> .  Pour certains sites, il peut être approprié d'utiliser <code>&lt;link rl=preload as=script crossorigin&gt;</code> au lieu de <code>modulepreload</code> .  Les performances peuvent se détériorer car le préchargement de script classique n'implique pas une analyse uniforme dans le temps, comme c'est le cas avec le <code>modulepreload</code> de <code>modulepreload</code> . <br><br><a name="second"></a><h4>  Deuxième méthode: suivre l'agent utilisateur </h4><br>  Je n'ai pas d'exemple de code approprié, car le suivi de l'agent utilisateur est une tâche non triviale.  Mais alors vous pouvez lire l'excellent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article dans Smashing Magazine.</a> <br><br>  En fait, tout commence avec le même <code>&lt;scrit src=bundle.js&gt;</code> en HTML pour tous les navigateurs.  Lorsque bundle.js est demandé, le serveur analyse la chaîne d'agent utilisateur du navigateur demandeur et sélectionne le JavaScript à renvoyer - moderne ou hérité, selon la façon dont le navigateur a été reconnu. <br><br>  <b>L'approche est universelle, mais entraîne de graves conséquences:</b> <b><br></b> <br><ul><li>  Étant donné que des serveurs intelligents sont requis, cette approche ne fonctionnera pas dans des conditions de déploiement statiques (générateurs de sites statiques, Netlify, etc.). </li><li>  La mise en cache de ces URL JavaScript dépend désormais de l'agent utilisateur, qui est très volatile. </li><li>  La définition de l'AU est difficile et peut conduire à une fausse classification. </li><li>  La ligne User Agent est facile à usurper et de nouveaux UA apparaissent chaque jour. </li></ul><br>  Un moyen de contourner ces limitations consiste à combiner le modèle de module / nomodule avec la différenciation de l'agent utilisateur pour éviter d'envoyer plusieurs versions du package à la même adresse.  Cette approche réduit la mise en cache des pages, mais offre un préchargement efficace: le serveur générateur de HTML sait quand utiliser le <code>modulepreload</code> et quand <code>preload</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request, response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-string"><span class="hljs-string">`&lt;html&gt;&lt;head&gt;...`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> agent = request.headers.userAgent; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isModern = userAgent.isModern(agent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isModern) { html += <span class="hljs-string"><span class="hljs-string">` &lt;link rel="modulepreload" href="modern.mjs"&gt; &lt;script type="module" src="modern.mjs"&gt;&lt;/script&gt; `</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { html += <span class="hljs-string"><span class="hljs-string">` &lt;link rel="preload" as="script" href="legacy.js"&gt; &lt;script src="legacy.js"&gt;&lt;/script&gt; `</span></span>; } response.end(html); }</code> </pre> <br>  Pour les sites qui génèrent déjà du HTML sur le serveur en réponse à chaque demande, cela peut être une transition efficace vers le téléchargement de scripts modernes. <br><br><a name="third"></a><h4>  Méthode 3: beaux vieux navigateurs </h4><br>  L'effet négatif du modèle de module / nomodule est visible dans les anciennes versions de Chrome, Firefox et Safari - leur nombre est très faible, car les navigateurs sont mis à jour automatiquement.  Avec Edge 16-18, la situation est différente, mais il y a de l'espoir: les nouvelles versions d'Edge utiliseront le moteur de rendu basé sur Chromium, qui n'a pas de tels problèmes. <br><br>  Pour certaines applications, ce serait un compromis idéal: téléchargez la version moderne du code dans 90% des navigateurs et donnez du code hérité aux anciens.  La charge dans les anciens navigateurs augmentera. <br><br>  Soit dit en passant, aucun des agents utilisateurs pour lesquels un tel redémarrage est un problème n'occupe une part importante du marché mobile.  Il est donc peu probable que la source de tous ces octets supplémentaires soit des appareils mobiles ou des appareils avec un processeur faible. <br><br>  Si vous créez un site qui est principalement accessible par des navigateurs mobiles ou récents, alors pour la plupart de ces utilisateurs, le type le plus simple de modèle de module / nomodule convient.  Assurez-vous simplement d'ajouter le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">correctif Safari 10.1</a> si des appareils iOS plus anciens vous parviennent. <br><br><pre> <code class="javascript hljs">   iOS-. &lt;!-- polyfill <span class="hljs-string"><span class="hljs-string">`nomodule`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Safari <span class="hljs-number"><span class="hljs-number">10.1</span></span>: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="javascript"><span class="xml"><span class="javascript"> !</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e,t,n</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">)</span></span></span></span><span class="xml"><span class="javascript">{!(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"noModule"</span></span></span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">in</span></span></span></span><span class="xml"><span class="javascript">(t=e.createElement(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"script"</span></span></span></span><span class="xml"><span class="javascript">)))&amp;&amp;</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"onbeforeload"</span></span></span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">in</span></span></span></span><span class="xml"><span class="javascript"> t&amp;&amp;(n=!</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">1</span></span></span></span><span class="xml"><span class="javascript">,e.addEventListener(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"beforeload"</span></span></span></span><span class="xml"><span class="javascript">,</span></span><span class="hljs-function"><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">(</span></span></span><span class="hljs-params"><span class="xml"><span class="javascript"><span class="hljs-function"><span class="hljs-params">e</span></span></span></span></span><span class="xml"><span class="javascript"><span class="hljs-function">)</span></span></span></span><span class="xml"><span class="javascript">{</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript">(e.target===t)n=!</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">0</span></span></span></span><span class="xml"><span class="javascript">;</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">else</span></span></span></span><span class="xml"><span class="javascript"> </span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">if</span></span></span></span><span class="xml"><span class="javascript">(!e.target.hasAttribute(</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"nomodule"</span></span></span></span><span class="xml"><span class="javascript">)||!n)</span></span><span class="hljs-keyword"><span class="xml"><span class="javascript"><span class="hljs-keyword">return</span></span></span></span><span class="xml"><span class="javascript">;e.preventDefault()},!</span></span><span class="hljs-number"><span class="xml"><span class="javascript"><span class="hljs-number">0</span></span></span></span><span class="xml"><span class="javascript">),t.type=</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"module"</span></span></span></span><span class="xml"><span class="javascript">,t.src=</span></span><span class="hljs-string"><span class="xml"><span class="javascript"><span class="hljs-string">"."</span></span></span></span><span class="xml"><span class="javascript">,e.head.appendChild(t),t.remove())}(</span></span><span class="hljs-built_in"><span class="xml"><span class="javascript"><span class="hljs-built_in">document</span></span></span></span><span class="xml"><span class="javascript">) </span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- <span class="hljs-number"><span class="hljs-number">90</span></span>+% <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> browsers: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"modern.js"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"module'&gt;&lt;/script&gt;</span></span></span></span></span></span> &lt;!-- IE, Edge &lt;<span class="hljs-number"><span class="hljs-number">16</span></span>, Safari &lt;<span class="hljs-number"><span class="hljs-number">10.1</span></span>, old desktop: --&gt; <span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">&lt;script src="</span></span></span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">legacy.js</span></span></span></span><span class="xml"><span class="hljs-tag">" </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">nomodule</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><a name="fourth"></a><h4>  Méthode quatre: appliquer les termes du package </h4><br>  Une bonne solution serait d'utiliser <code>nomodule</code> pour télécharger conditionnellement des packages avec du code qui n'est pas nécessaire dans les navigateurs modernes, tels que les polyfills.  Avec cette approche, dans le pire des cas, le polyfill sera chargé ou même exécuté (dans Safari 10.1), mais l'effet de ceci sera limité au «re-polyfilling».  Considérant qu'aujourd'hui l'approche avec le téléchargement et l'exécution de polyfills dans tous les navigateurs prévaut, cela peut être une amélioration digne. <br><br><pre> <code class="javascript hljs">&lt;!-- newer browsers will not load <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> bundle: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">nomodule</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"polyfills.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;!-- all browsers load <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> one: --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/bundle.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Vous pouvez configurer la CLI angulaire pour utiliser cette approche avec les polyfills, comme l'a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">démontré Minko</a> Gachev.  Ayant appris cette approche, je me suis rendu compte que vous pouvez activer l'injection automatique de polyfill dans preact-cli - ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PR</a> montre à quel point il est facile de mettre en œuvre cette technique. <br><br>  Et si vous utilisez WebPack, il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin pratique</a> pour <code>html-webpack-plugin</code> , qui facilite l'ajout d'un nomodule aux packages avec des polyfills. <br><br><h4>  Alors que choisir? </h4><br>  La réponse dépend de votre situation.  Si vous créez une application cliente et que votre code HTML contient un peu plus que <code>&lt;sript&gt;</code> , vous aurez peut-être besoin de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">première méthode</a> . <br><br>  Si vous créez un site qui est rendu sur le serveur et que vous pouvez vous permettre la mise en cache, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxième méthode</a> peut vous convenir. <br><br>  Si vous utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le</a> rendu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">universel</a> , le gain de performances offert par le scan de pré-chargement peut être très important.  Par conséquent, faites attention aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">troisième</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quatrième</a> méthodes.  Choisissez ce qui convient à votre architecture. <br><br>  Personnellement, je choisis, en me concentrant sur la durée de l'analyse sur les appareils mobiles, et non sur le coût du téléchargement dans les versions de bureau.  Les utilisateurs mobiles perçoivent les coûts d'analyse et de transfert de données comme des dépenses réelles (consommation de batterie et frais de transfert de données), tandis que les utilisateurs de bureau n'ont pas de telles restrictions.  Je procède également à l'optimisation pour 90% des utilisateurs - le public principal de mes projets utilise des navigateurs modernes et / ou mobiles. <br><br><h4>  Que lire </h4><br>  Vous souhaitez en savoir plus sur ce sujet?  Vous pouvez commencer ici: <br><br><ul><li>  Excellentes informations supplémentaires sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">webpack-esnext -ilerplate</a> . </li><li>  Ralph a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">implémenté le module / nomodule dans Next.js</a> et travaille sur une solution aux problèmes courants. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473994/">https://habr.com/ru/post/fr473994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473984/index.html">Data Science Digest (octobre 2019)</a></li>
<li><a href="../fr473986/index.html">«Mon rêve est de voir une personne à travers les arbres» - fondatrice de Lisa Alert sur les technologies de recherche modernes</a></li>
<li><a href="../fr473988/index.html">Optimisation de la distribution des serveurs sur les racks</a></li>
<li><a href="../fr473990/index.html">Apprenez OpenGL. Leçon 7.2 - Dessin de texte</a></li>
<li><a href="../fr473992/index.html">Aperçu des protocoles modernes dans les systèmes d'automatisation industrielle</a></li>
<li><a href="../fr473998/index.html">Pays-Bas, ou aller-retour</a></li>
<li><a href="../fr474000/index.html">IQBX - concepteur électromécanique pour les cercles et les amateurs de bricolage [idée conceptuelle]</a></li>
<li><a href="../fr474004/index.html">De Norilsk à Riyad: un vrai cas pour les cartes mémoire microSD UHS-I à température industrielle de Kingston</a></li>
<li><a href="../fr474008/index.html">Greenplum 6: revue des nouvelles fonctionnalités</a></li>
<li><a href="../fr474012/index.html">Sécurité pour les conteneurs Docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>