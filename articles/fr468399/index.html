<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏽‍🤝‍🧑🏽 🎳 🥡 C / C ++. Comment utiliser les ressources d'application intégrées lorsque vous travaillez dans GCC sous Linux 🤽🏿 🍛 🙄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je voulais en quelque sorte utiliser automatiquement les ressources embarquées Linux. En général, la tâche est la suivante: 


1. Il existe un program...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C / C ++. Comment utiliser les ressources d'application intégrées lorsque vous travaillez dans GCC sous Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468399/"><p>  Je voulais en quelque sorte utiliser automatiquement les ressources embarquées Linux.  En général, la tâche est la suivante: </p><br><ol><li>  Il existe un programme de projet Eclipse en C ++. </li><li>  Système d'exploitation: Linux Ubuntu.  Compilateur: G ++ </li><li>  Le projet utilise des données de fichiers externes: chaînes de localisation, requêtes SQL, images, sons, etc. </li><li>  Toutes les ressources doivent être incorporées dans le fichier exécutable, car le programme est prévu pour être distribué comme portable. </li><li>  De plus, je souhaite que le processus soit le plus automatisé possible, car paresse. </li></ol><a name="habracut"></a><br><p> Pour commencer, une recherche sur les forums a fourni plusieurs façons possibles de résoudre le problème.  Parmi celles jugées les plus universelles, l'idée m'a semblé utiliser le <code>--format=binary</code> « <code>--format=binary</code> » du lieur « <code>ld</code> ».  Les messages du forum ont promis à une équipe du formulaire: <br><br></p><pre> <code class="bash hljs">g++ -Wl,--format=binary -Wl,my.res -Wl,--format=default</code> </pre> <br>  liera le fichier «my.res» à l'application et créera deux caractères - <code>_binary_my_res_start</code> et <code>_binary_my_res_end</code> , indiquant respectivement le début et la fin des données mêmes qui étaient dans le fichier lié.  Par conséquent, l'accès aux données à partir de C ++ pourrait se faire comme ceci: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> my_res_start[] <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span>(<span class="hljs-string"><span class="hljs-string">"_binary_my_res_start"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> my_res_end[] <span class="hljs-keyword"><span class="hljs-keyword">asm</span></span>(<span class="hljs-string"><span class="hljs-string">"_binary_my_res_end"</span></span>);</code> </pre><br><p>  Mais ça y était.  Nous écrivons tout comme il se doit et le compilateur n'est pas content.  Le symbole <code>«_binary_my_res_start»</code> , vous voyez, est introuvable.  Eh bien, rien, <code>nm</code> pour nous aider.  Nous écrivons la commande suivante: <br><br></p><pre> <code class="bash hljs">nm MyProgramm |grep -w -o -P -e <span class="hljs-string"><span class="hljs-string">'_binary_[\w\d_]+'</span></span></code> </pre> <br>  Et nous obtenons: <br><br><pre> <code class="bash hljs">_binary__home_unknown_workspace_MyProgramm_res_my_res_sql_end _binary__home_unknown_workspace_MyProgramm_res_my_res_sql_start</code> </pre><br><p>  Il s'avère que le nom du symbole inclut le chemin complet vers celui-ci, ce qui, à l'avenir, pourrait nécessiter une réécriture constante du fichier d'en-tête contenant des liens vers des ressources.  Le problème est résolu si le script suivant est ajouté à l'événement PostBuild dans les paramètres du projet Eclipse: <br><br></p><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash OUTPUT=$1/resources.h printf '#ifndef __RESOURCES_H__\n' &gt; "$OUTPUT" printf '#define __RESOURCES_H__\n\n' &gt;&gt; "$OUTPUT" printf '#include &lt;inttypes.h&gt;\n\n' &gt;&gt; "$OUTPUT" SYMBOLS=$(nm NewsParser |grep -w -o -P -e '_binary_[\w\d_]+') &gt;&gt; "$OUTPUT" VAR_SIZES_LIST='' for SYMBOL in $SYMBOLS do VAR_NAME=$(echo $SYMBOL | grep -o -P -e 'res_[\w\d_]+'|cut -c 5-) if [[ -z $(echo $SYMBOL|grep _size) ]] then printf '\textern const uint8_t '$VAR_NAME'[]\tasm("'$SYMBOL'");\n\n' &gt;&gt; "$OUTPUT" else START_VAR=$(echo $VAR_NAME|rev|cut -c 5-|rev)'start' END_VAR=$(echo $VAR_NAME|rev|cut -c 5-|rev)'end' VAR_SIZES_LIST=$VAR_SIZES_LIST$(printf '\\tconst uint64_t '$VAR_NAME'\\t=\\t'$END_VAR' - '$START_VAR';\\n\\n') fi done printf "$VAR_SIZES_LIST" &gt;&gt; "$OUTPUT" printf '#endif\n' &gt;&gt; "$OUTPUT" printf 'File '$OUTPUT' is generated.\n'</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Comment ajouter le script «update_resource.sh», qui se trouve à la racine du projet, à l'événement PostBuild dans les paramètres du projet Eclipse.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xg/iw/t6/xgiwt6ysf51nfgqvv3w-knrabea.png"><br></div></div><br>  Bon.  Maintenant, le fichier d'en-tête sera comme neuf à chaque fois, et vous pouvez accéder aux données par les noms des variables qui ne changeront pas à moins que vous renommiez le fichier de ressources lui-même.  De plus, ce script calcule la taille de chaque ressource.  Non seulement prendre le pointeur au début du pointeur à la fin était un gros problème, mais, néanmoins, c'est plus pratique. <br><br><p>  Mais ce n'est pas tout pour l'instant.  Après tout, l'ajout de chaque nouvelle ressource à un projet se transformera en une AD en forme.  Et ce problème peut également être résolu à l'aide d'un script, uniquement au stade de la liaison: <br><br></p><pre> <code class="bash hljs">FLAGS=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> OUTPUT_FLAG=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> OUTPUT_PREFIX=<span class="hljs-variable"><span class="hljs-variable">$3</span></span> OUTPUT=<span class="hljs-variable"><span class="hljs-variable">$4</span></span> INPUTS=<span class="hljs-variable"><span class="hljs-variable">$5</span></span> RESOURCE_PATH=<span class="hljs-variable"><span class="hljs-variable">$6</span></span> RESOURCES=<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> res_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(ls <span class="hljs-variable"><span class="hljs-variable">$RESOURCE_PATH</span></span>/*) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> RESOURCES=<span class="hljs-variable"><span class="hljs-variable">$RESOURCES</span></span><span class="hljs-string"><span class="hljs-string">' '</span></span>-Wl,<span class="hljs-variable"><span class="hljs-variable">$res_file</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span><span class="hljs-variable"><span class="hljs-variable">$res_file</span></span><span class="hljs-string"><span class="hljs-string">'   '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> g++ <span class="hljs-variable"><span class="hljs-variable">$FLAGS</span></span> <span class="hljs-variable"><span class="hljs-variable">$OUTPUT_FLAG</span></span> <span class="hljs-variable"><span class="hljs-variable">$OUTPUT_PREFIX</span></span><span class="hljs-variable"><span class="hljs-variable">$OUTPUT</span></span> <span class="hljs-variable"><span class="hljs-variable">$INPUTS</span></span> -Wl,--format=binary <span class="hljs-variable"><span class="hljs-variable">$RESOURCES</span></span> -Wl,--format=default</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Comment remplacer l'appel de l'éditeur de liens standard par un script personnalisé dans les paramètres du projet Eclipse.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/--/k_/nx/--k_nxk9lebtel3krzbtxzx87aw.png"><br><br><ul><li>  <font color="red">L'</font> endroit en <font color="red">rouge est</font> marqué dans l'image, où au lieu de la commande standard d'appeler l'éditeur de liens, le chemin vers le script "link.sh" est situé à la racine du projet. </li><li>  <font color="green">Le vert</font> dans l'image est un endroit dans lequel un autre éditeur de liens est ajouté aux paramètres habituels de l'éditeur de liens, qui indique au script l'emplacement du répertoire avec les ressources. </li><li>  <font color="blue">De plus</font> , il est important de ne pas oublier d'envelopper les paramètres restants avec des guillemets doubles afin qu'ils ne se brisent pas accidentellement avec des espaces dans le mauvais ordre dans lequel le script les attend. </li></ul><br></div></div><br>  Super.  Désormais, tous les fichiers qui se trouvent dans le sous-répertoire "res" tomberont eux-mêmes dans les ressources lors de chaque assemblage. <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468399/">https://habr.com/ru/post/fr468399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468387/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 316 (du 16 au 22 septembre)</a></li>
<li><a href="../fr468389/index.html">Artyom Galonsky, Bureau de la STO du Bureau: «Je suis contre une chose telle qu'un ingénieur DevOps»</a></li>
<li><a href="../fr468393/index.html">Avec un bon microcontrôleur et le temps passe vite ou un oscilloscope de week-end</a></li>
<li><a href="../fr468395/index.html">Surveillance de la sécurité du cloud. 2e partie</a></li>
<li><a href="../fr468397/index.html">Nouvelles du monde d'OpenStreetMap n ° 477 (09/03/2019 - 09.09.2019)</a></li>
<li><a href="../fr468401/index.html">Manière sécurisée d'échanger JWT dans ASP.NET Core + SPA</a></li>
<li><a href="../fr468403/index.html">Contrôles d'exécution des applications logicielles intégrés</a></li>
<li><a href="../fr468405/index.html">Deux navigateurs entrent en quelque sorte dans la barre de défilement ...</a></li>
<li><a href="../fr468407/index.html">5G - une technologie susceptible de ralentir le web</a></li>
<li><a href="../fr468409/index.html">Service Workers in Slack Client: Accélération de téléchargement et mode hors ligne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>