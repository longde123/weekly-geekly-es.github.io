<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÇ üôãüèæ ‚ú≥Ô∏è Experimente 2 milh√µes de sess√µes sem cabe√ßa üôÖ üéΩ üìî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicado em 4 de junho de 2018 no blog corporativo sem navegador. 

 Temos o prazer de anunciar que recentemente cruzamos a linha de dois milh√µes de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experimente 2 milh√µes de sess√µes sem cabe√ßa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413547/">  <font color="gray">Publicado em 4 de junho de 2018 no blog corporativo sem navegador.</font> <br><br>  Temos o prazer de anunciar que recentemente cruzamos a linha de <b>dois milh√µes de sess√µes realizadas</b> !  S√£o <i>milh√µes de</i> capturas <i>de</i> tela geradas, PDFs impressos e sites testados.  Fizemos quase tudo o que voc√™ pode pensar em fazer com um navegador sem cabe√ßa. <br><br>  Embora seja bom alcan√ßar esse marco, no caminho havia claramente <i>muitas</i> sobreposi√ß√µes e problemas.  Devido √† enorme quantidade de tr√°fego recebido, gostaria de dar um passo atr√°s e apresentar recomenda√ß√µes gerais para o lan√ßamento de navegadores sem cabe√ßa (e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">marionetes</a> ) na produ√ß√£o. <br><br>  Aqui est√£o algumas dicas. <br><a name="habracut"></a><br><h1>  1. N√£o use um navegador sem cabe√ßa </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/85f/438/cae85f438e0037a0f87f1ae6619cfc33.png"><br><br><h3>  Consumo de recursos sem cabe√ßa do Chrome </h3><br>  De nenhuma maneira, se poss√≠vel, <i>n√£o inicie o navegador no modo decapitado</i> .  Especialmente na mesma infraestrutura que seu aplicativo (veja acima).  O navegador sem cabe√ßa √© imprevis√≠vel, guloso e criador como o Sr. Misix, de Rick e Morty.  Quase tudo o que um navegador pode fazer (exceto interpolar e executar o JavaScript) pode ser feito usando ferramentas simples do Linux.  As bibliotecas Cheerio e outras oferecem uma API Node elegante para recuperar dados com solicita√ß√µes HTTP e raspagem, se esse for seu objetivo. <br><br>  Por exemplo, voc√™ pode pegar uma p√°gina (supondo que seja algum tipo de HTML) e descart√°-la com comandos simples como estes: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cheerio <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'cheerio'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fetch'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(url); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> html = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> res.test(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $ = cheerio.load(html); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $(<span class="hljs-string"><span class="hljs-string">'buy-now.price'</span></span>).text(); } getPrice(<span class="hljs-string"><span class="hljs-string">'https://my-cool-website.com/'</span></span>);</code> </pre> <br>  Obviamente, o script n√£o cobre todos os casos de uso e, se voc√™ ler este artigo, provavelmente precisar√° usar um navegador sem cabe√ßa.  Ent√£o, vamos come√ßar. <br><br><h1>  2. N√£o inicie um navegador sem cabe√ßa desnecessariamente </h1><br>  Encontramos v√°rios usu√°rios que est√£o tentando manter o navegador funcionando, mesmo que n√£o esteja em uso (com conex√µes abertas).  Embora essa possa ser uma boa estrat√©gia para acelerar uma sess√£o, ela falhar√° em algumas horas.  Principalmente porque os navegadores <i>gostam de</i> armazenar <i>em</i> cache tudo em uma fileira e gradualmente consomem mem√≥ria.  Assim que voc√™ parar de usar o navegador intensivamente, feche-o imediatamente! <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> puppeteer.launch(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> page = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> browser.newPage(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://www.example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// More stuff ...page.click() page.type() browser.close(); // &lt;- Always do this! }</span></span></code> </pre> <br>  No modo sem navegador, geralmente corrigimos esse erro para os usu√°rios, sempre definindo algum tipo de cron√¥metro para a sess√£o e fechando o navegador quando o WebSocket √© desconectado.  Mas se voc√™ n√£o usar nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servi√ßo</a> ou a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">imagem de backup do Docker</a> , certifique-se de fechar o navegador <i>automaticamente</i> , pois ser√° desagrad√°vel quando tudo cair no meio da noite. <br><br><h1>  3. A sua p√°gina de amigo. <code>page.evaluate</code> </h1><br><blockquote>  Tenha cuidado com transpilers como babel ou typescript, porque eles gostam de criar fun√ß√µes auxiliares e assumem que eles s√£o acess√≠veis com fechamentos.  Ou seja, o retorno de chamada .valuate <i>pode n√£o</i> funcionar corretamente. </blockquote><br>  O Puppeteer possui muitos m√©todos interessantes, como armazenar seletores DOM e outras coisas em um ambiente Node.  Embora seja muito conveniente, voc√™ pode facilmente dar um tiro no p√© se algo na p√°gina for√ßar esse n√≥ DOM a <i>sofrer</i> uma <i>muta√ß√£o</i> .  Pode n√£o ser t√£o legal, mas, na realidade, √© melhor fazer todo o trabalho no lado <i>do navegador no contexto do navegador</i> .  Isso geralmente significa carregar <code>page.evaulate</code> para todo o trabalho que precisa ser feito. <br><br>  Por exemplo, em vez de algo como isto ( <i>tr√™s</i> a√ß√µes ass√≠ncronas): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.$(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> link = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.getProperty(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.click(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> link;</code> </pre> <br>  √â melhor fazer isso (uma a√ß√£o ass√≠ncrona): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.evaluate(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = $anchor.href; $anchor.click(); });</code> </pre> <br>  Outra vantagem de agrupar a√ß√µes em uma chamada de <code>evaluate</code> √© a portabilidade: esse c√≥digo pode ser executado em um navegador para verificar em vez de tentar reescrever o c√≥digo do N√≥.  Obviamente, √© sempre recomend√°vel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usar um depurador</a> para reduzir o tempo de desenvolvimento. <br><br>  Uma regra simples √© contar o n√∫mero de <code>await</code> ou <code>then</code> no c√≥digo.  Se houver mais de um, provavelmente √© melhor executar o c√≥digo dentro da chamada <code>page.evaluate</code> .  O motivo √© que todas as a√ß√µes ass√≠ncronas v√£o e voltam entre o tempo de execu√ß√£o do Node e o navegador, o que significa serializa√ß√£o e desserializa√ß√£o JSON constantes.  Embora n√£o exista uma quantidade t√£o grande de an√°lise (porque tudo √© suportado pelo WebSockets), ele ainda leva tempo, o que √© melhor gasto em outra coisa. <br><br><h1>  4. Paralelize navegadores, n√£o p√°ginas da web </h1><br>  Ent√£o, percebemos que iniciar um navegador n√£o √© bom e precisamos fazer isso apenas em caso de emerg√™ncia.  A pr√≥xima dica √© executar apenas uma sess√£o por navegador.  Embora, na realidade, seja poss√≠vel economizar recursos paralelizando o trabalho pelas <code>pages</code> , mas se uma p√°gina cair, poder√° travar o navegador inteiro.  Al√©m disso, n√£o √© garantido que cada p√°gina esteja perfeitamente limpa (cookies e armazenamento podem se tornar uma dor de cabe√ßa, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como vemos</a> ). <br><br>  Em vez disso: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Launch one browser and capture the promise const launch = puppeteer.launch(); const runJob = async (url) { // Re-use the browser here const browser = await launch; const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Melhor fazer isso: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> runJob = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (url) { <span class="hljs-comment"><span class="hljs-comment">// Launch a clean browser for every "job" const browser = puppeteer.launch(); const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Cada nova inst√¢ncia do navegador recebe um <code>--user-data-dir</code> limpo (a <a href="">menos que seja indicado de outra forma</a> ).  Ou seja, √© completamente processado como uma nova sess√£o nova.  Se o Chrome travar por algum motivo, ele n√£o far√° outras sess√µes. <br><br><h1>  5. Limita√ß√£o de fila e simultaneidade </h1><br>  Um dos principais recursos do sem navegador √© a capacidade de limitar ordenadamente a paraleliza√ß√£o e a fila.  Portanto, os aplicativos clientes executam o <code>puppeteer.connect</code> , mas eles n√£o pensam na implementa√ß√£o da fila.  Isso evita uma enorme quantidade de problemas, principalmente nas inst√¢ncias simult√¢neas do Chrome que consomem todos os recursos dispon√≠veis do seu aplicativo. <br><br>  A melhor e mais f√°cil maneira √© pegar nossa imagem do Docker e execut√°-la com os par√¢metros necess√°rios: <br><br><pre> <code class="hljs pgsql"># Pull <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Puppeteer@<span class="hljs-number"><span class="hljs-number">1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> support $ docker pull browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> $ docker run -e "MAX_CONCURRENT_SESSIONS=10" browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  Isso limita o n√∫mero de solicita√ß√µes simult√¢neas a dez (incluindo sess√µes de depura√ß√£o e mais).  A fila √© configurada pela vari√°vel <code>MAX_QUEUE_LENGTH</code> .  Normalmente, voc√™ pode executar aproximadamente 10 solicita√ß√µes simult√¢neas por gigabyte de mem√≥ria.  A porcentagem de utiliza√ß√£o da CPU pode variar para tarefas diferentes, mas basicamente voc√™ precisar√° de muita e muita RAM. <br><br><h1>  6. N√£o se esque√ßa da <code>page.waitForNavigation</code> </h1><br>  Um dos problemas mais comuns que encontramos s√£o as a√ß√µes que come√ßam a carregar p√°ginas com o encerramento repentino subsequente de scripts.  Isso ocorre porque as a√ß√µes que acionam o <code>pageload</code> geralmente causam a ingest√£o de trabalho subsequente.  Para contornar o problema, geralmente voc√™ precisa chamar a a√ß√£o de carregamento da p√°gina - e imediatamente ap√≥s aguardar o carregamento. <br><br>  Por exemplo, esse <code>console.log</code> n√£o funciona em um √∫nico local ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">consulte a demonstra√ß√£o</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Mas <i>funciona</i> em outro ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">veja a demonstra√ß√£o</a> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.waitForNavigation(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Voc√™ pode ler mais sobre waitForNavigation <a href="">aqui</a> .  Esta fun√ß√£o possui aproximadamente os mesmos par√¢metros de interface que <code>page.goto</code> , mas apenas com a parte "wait". <br><br><h1>  7. Use o Docker para tudo que voc√™ precisa. </h1><br>  O Chrome precisa de muitas depend√™ncias para funcionar corretamente.  Realmente muito.  Mesmo depois de instalar tudo, voc√™ precisa se preocupar com coisas como fontes e processos fantasmas.  Portanto, √© ideal usar algum tipo de recipiente para colocar tudo l√°.  O Docker foi projetado quase especificamente para esta tarefa, porque voc√™ pode limitar a quantidade de recursos dispon√≠veis e isol√°-lo.  Se voc√™ deseja criar seu pr√≥prio <code>Dockerfile</code> , verifique abaixo todas as depend√™ncias necess√°rias: <br><br><pre> <code class="hljs tex"># Dependencies needed for packages downstream RUN apt-get update &amp;&amp; apt-get install -y <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>unzip <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fontconfig <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>locales <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>gconf-service <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libasound2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libatk1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libc6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcairo2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcups2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libdbus-1-3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libexpat1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libfontconfig1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgcc1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgconf-2-4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgdk-pixbuf2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libglib2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgtk-3-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnspr4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpango-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpangocairo-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libstdc++6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-xcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcomposite1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcursor1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxdamage1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxext6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxfixes3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxi6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrandr2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrender1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxss1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxtst6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>ca-certificates <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fonts-liberation <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libappindicator1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnss3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>lsb-release <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>xdg-utils <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>wget</code> </pre> <br>  E para evitar processos zumbi (algo comum no Chrome), √© melhor usar algo como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dumb-init</a> para executar corretamente: <br><br><pre> <code class="hljs powershell">ADD https://github.com/Yelp/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span>/releases/download/v1.<span class="hljs-number"><span class="hljs-number">2.0</span></span>/dumb<span class="hljs-literal"><span class="hljs-literal">-init_1</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>_amd64 /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span> RUN chmod +x /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span></code> </pre> <br>  Se voc√™ quiser saber mais, d√™ uma olhada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso Dockerfile</a> . <br><br><h1>  8. Lembre-se de dois tempos de execu√ß√£o diferentes. </h1><br>  √â √∫til lembrar que existem <i>dois</i> tempos de execu√ß√£o do JavaScript (n√≥ e navegador).  Isso √© √≥timo para separar tarefas, mas a confus√£o inevitavelmente ocorre porque alguns m√©todos exigir√£o a passagem expl√≠cita de links em vez de eleva√ß√µes. <br><br>  Por exemplo, considere <code>page.evaluate</code> .  <a href="">Nas</a> entranhas do protocolo, existe uma <a href="">string <i>literal</i> da fun√ß√£o e sua transfer√™ncia para o Chrome</a> .  Portanto, coisas como fechamentos e elevadores <i>n√£o funcionar√£o</i> .  Se voc√™ precisar passar algumas refer√™ncias ou valores para a chamada de avalia√ß√£o, adicione-os como argumentos que ser√£o processados ‚Äã‚Äãcorretamente. <br><br>  Assim, em vez de fazer refer√™ncia ao <code>selector</code> por meio de fechamentos: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// `selector` here is `undefined` since we're in the browser context const clicked = await page.evaluate(() =&gt; document.querySelector(anchor).click());</span></span></code> </pre> <br>  Melhor par√¢metro de passagem: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Here we add a `selector` arg and pass in the reference in `evaluate` const clicked = await page.evaluate((selector) =&gt; document.querySelector(selector).click(), anchor);</span></span></code> </pre> <br>  <code>page.evaluate</code> pode adicionar um ou mais argumentos √† fun√ß√£o <code>page.evaluate</code> , pois ela √© vari√°vel aqui.  Certifique-se de aproveitar isso! <br><br><h1>  O futuro </h1><br>  Estamos incrivelmente otimistas sobre o futuro dos navegadores sem cabe√ßa e toda a automa√ß√£o que eles podem alcan√ßar.  Usando ferramentas poderosas, como marionetistas e sem navegador, esperamos que a depura√ß√£o e execu√ß√£o da automa√ß√£o sem cabe√ßa na produ√ß√£o sejam mais f√°ceis e r√°pidas.  Em breve, lan√ßaremos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">faturamento pr√©-pago para contas</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√µes</a> que ajudar√£o voc√™ a lidar melhor com seu trabalho decapitado! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413547/">https://habr.com/ru/post/pt413547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413529/index.html">Por que os novos dispositivos i-SENSYS podem ser chamados de revolucion√°rios</a></li>
<li><a href="../pt413531/index.html">O livro "Unidade para o desenvolvedor. Jogos multiplataforma para celular ¬ª</a></li>
<li><a href="../pt413539/index.html">Um controlador simples baseado em l√≥gica difusa. Cria√ß√£o e customiza√ß√£o</a></li>
<li><a href="../pt413543/index.html">Angular cli 6: por que voc√™ precisa e como us√°-lo</a></li>
<li><a href="../pt413545/index.html">Humor na marca - por que nem sempre √© bom</a></li>
<li><a href="../pt413549/index.html">Curso de Desenvolvimento Web</a></li>
<li><a href="../pt413551/index.html">Rolagem e aten√ß√£o (estudo de 2018)</a></li>
<li><a href="../pt413553/index.html">O registrador REG.RU privou o parceiro de acesso a 70 mil dom√≠nios e levou o servi√ßo para si</a></li>
<li><a href="../pt413555/index.html">Interoperabilidade segura em sistemas distribu√≠dos</a></li>
<li><a href="../pt413557/index.html">NewSQL: SQL n√£o vai a lugar nenhum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>