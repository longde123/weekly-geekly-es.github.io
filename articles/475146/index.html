<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÆ üçò üöü La agon√≠a o la larga historia de un intento de recuperaci√≥n de datos üêÅ üë®‚Äçüë®‚Äçüë¶ ü§ï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el patio fue el a√±o 2019. El disco QUANTUM FIREBALL Plus KA con una capacidad de 9.1 GB lleg√≥ a nuestro laboratorio, lo que no es muy habitual en n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La agon√≠a o la larga historia de un intento de recuperaci√≥n de datos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475146/">  En el patio fue el a√±o 2019.  El disco QUANTUM FIREBALL Plus KA con una capacidad de 9.1 GB lleg√≥ a nuestro laboratorio, lo que no es muy habitual en nuestro tiempo.  Seg√∫n el propietario de la unidad, la falla ocurri√≥ en 2004 debido a una falla en la fuente de alimentaci√≥n, que agarr√≥ un disco duro y otros componentes de la PC.  Luego hubo caminatas sobre varios servicios con intentos de reparar la unidad y restaurar los datos que no tuvieron √©xito.  En alg√∫n lugar prometieron que era barato, pero a√∫n no resolvieron el problema, en alg√∫n lugar era demasiado costoso y el cliente no quer√≠a restaurar los datos, pero al final el disco pas√≥ por muchos centros de servicio.  Se perdi√≥ varias veces, pero debido al hecho de que el propietario se encarg√≥ de registrar la informaci√≥n de varias etiquetas adhesivas en el disco, logr√≥ asegurarse de que su disco duro fuera devuelto por algunos centros de servicio.  Los circuitos no pasaron desapercibidos, en la placa del controlador original hab√≠a m√∫ltiples trazas de soldadura, y la falta de elementos SMD tambi√©n se sinti√≥ visualmente (mirando hacia el futuro, dir√© que este es el menor de los problemas de esta unidad). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ju/oa/mq/juoamqzpbrmmmvhxyc8-re0-j2m.png"></div><br>  <i>Fig.</i>  <i>1 HDD Quantum Fireball Plus KA 9.1GB</i> <br><a name="habracut"></a><br>  Lo primero que tuve que hacer fue buscar en el archivo de donantes de un hermano gemelo tan antiguo de esta unidad con una placa controladora en funcionamiento.  Cuando se complet√≥ esta b√∫squeda, se hizo posible llevar a cabo medidas de diagn√≥stico detalladas.  Despu√©s de verificar los devanados del motor para detectar un cortocircuito y asegurarnos de su ausencia, instalamos la placa desde la unidad, el donante hasta la unidad, el paciente.  Energizamos y escuchamos el sonido normal del eje girando, pasando la prueba de calibraci√≥n con la carga del firmware, y despu√©s de unos segundos, la unidad se registra a trav√©s de los registros sobre su disponibilidad para responder a los comandos de la interfaz. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-h/57/vy/-h57vy6onwk8kkvcivdtq33ycie.png"></div><br>  <i>Fig.</i>  <i>2 indicadores DRD DSC indican que est√° listo para aceptar comandos.</i> <br><br>  Reservamos todas las copias de los m√≥dulos de firmware.  Verificamos la integridad de los m√≥dulos de firmware.  No hay problemas con la lectura de los m√≥dulos, pero el an√°lisis de los informes muestra que hay algunas rarezas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/vc/c3/dovcc3pxy7yje_t9trkxk3twfd4.png"></div><br>  <i>Fig.</i>  <i>3. Tabla de zonas.</i> <br><br>  Prestamos atenci√≥n a la tabla de distribuci√≥n de zonas, notamos que el n√∫mero de cilindros es 13845. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jj/7a/bk/jj7abkkhaeb-43dxtov1u5ihdnw.png"></div><br>  <i>Fig.</i>  <i>4 P-list (lista primaria: una lista de defectos introducidos durante el ciclo de producci√≥n).</i> <br><br>  Prestamos atenci√≥n a muy pocos defectos y su localizaci√≥n.  Observamos el m√≥dulo para ocultar defectos de f√°brica (60h) y encontramos que est√° vac√≠o y no contiene ninguna entrada.  En base a esto, podemos suponer que en algunos de los centros de servicio anteriores, se pudieron haber realizado algunas manipulaciones con el √°rea de servicio de la unidad, y se grab√≥ accidental o intencionalmente un m√≥dulo extra√±o, o se borr√≥ la lista de defectos en el original.  Para verificar esta suposici√≥n, creamos una tarea en Data Extractor con las opciones "crear una copia sector por sector" y "crear un traductor virtual" habilitado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3l/jd/hl/3ljdhluum6cv3dmilqwbsltk1lk.png"></div><br>  <i>Fig.</i>  <i>5 par√°metros de la tarea.</i> <br><br>  Despu√©s de crear la tarea, observamos las entradas en la tabla de particiones en el sector cero (LBA 0) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gt/jv/mt/gtjvmttab56tlxbz501caz8cpgk.png"></div><br>  <i>Fig.</i>  <i>6 Registro de arranque maestro y tabla de particiones.</i> <br><br>  En el desplazamiento 0x1BE, hay un √∫nico registro (16 bytes).  El tipo de sistema de archivos en la partici√≥n es NTFS, el desplazamiento al comienzo del sector 0x3F (63), el tama√±o de la partici√≥n es 0x011309A3 (18,024,867) sectores. <br>  En el editor del sector, abra LBA 63. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/yk/fq/kwykfq8od37sp8g22wtvijdpx1m.png"></div><br>  <i>Fig.</i>  <i>7 sector de arranque NTFS</i> <br><br>  De acuerdo con la informaci√≥n en el sector de arranque NTFS, se puede decir lo siguiente: el tama√±o del sector adoptado en el volumen es 512 bytes (la palabra 0x0200 (512) se escribe en el desplazamiento 0x0B), el n√∫mero de sectores en el cl√∫ster es 8 (el byte 0x08 se escribe en el desplazamiento 0x0D), el tama√±o del cl√∫ster es 512x8 = 4096 bytes, el primer registro MFT se encuentra en un desplazamiento de 6.291.519 sectores desde el comienzo del disco (en el desplazamiento 0x30 la palabra cu√°druple 0x00 00 00 00 00 00C 00 00 (786 432) es el n√∫mero del primer grupo MFT. El n√∫mero de sector se calcula mediante la f√≥rmula: N√∫mero de grupo * el n√∫mero de sectores en el cluster + shift antes del inicio de la partici√≥n 786 432 * 8 + 63 = 6,291,519). <br>  Pasamos al sector 6 291 519. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l7/yp/uy/l7ypuym-p2gflba2d5m49belsp8.png"></div><br>  <i>Fig.</i>  <i>8</i> <br><br>  Pero los datos contenidos en este sector son completamente diferentes del registro MFT.  Aunque esto indica una posible transmisi√≥n incorrecta debido a una lista de defectos incorrecta, no prueba este hecho.  Para una mayor verificaci√≥n, leeremos el disco en 10,000 sectores en ambas direcciones en relaci√≥n con 6,291,519 sectores.  Y luego buscaremos expresiones regulares en la lectura. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gx/sc/py/gxscpyil_-qwpvt8dtsjuoqkwda.png"></div><br>  <i>Fig.</i>  <i>9 Primer registro MFT</i> <br><br>  En el sector 6.291.551, encontramos el primer registro MFT.  Su posici√≥n difiere de la calculada por 32 sectores, y luego un grupo de 16 registros (de 0 a 15) sigue continuamente.  Ingresemos la posici√≥n del sector 6 291 519 en la tabla de cambios para avanzar 32 sectores. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jc/vy/hb/jcvyhbxvibt7si5xcibgz-ysrbg.png"></div><br>  <i>Fig.</i>  <i>10</i> <br><br>  La posici√≥n del registro No. 16 debe estar en un desplazamiento de 12 551 431, pero all√≠ encontramos ceros, en lugar de registrar MFT.  Realizaremos una b√∫squeda similar en los alrededores. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/dn/ni/jddnniazvuj5p8foynm9m_zpzjy.png"></div><br>  <i>Fig.</i>  <i>11 Registro MFT 0x00000011 (17)</i> <br><br>  Se detecta un gran fragmento de MFT, comenzando con el n√∫mero de registro 17 con una longitud de 53,646 registros) con un desplazamiento de 17 sectores.  Para la posici√≥n 12 155 431 colocaremos un cambio de +17 sectores en la tabla de cambios. <br>  Habiendo determinado la posici√≥n de los fragmentos de MFT en el espacio, podemos concluir que esto no parece una falla aleatoria y el registro de fragmentos de MFT por compensaciones incorrectas.  Una versi√≥n con un traductor incorrecto puede considerarse confirmada. <br>  Para una mayor localizaci√≥n de los puntos de corte, establecemos el desplazamiento m√°ximo posible.  Para hacer esto, determinamos cu√°nto se desplaza el marcador de partici√≥n NTFS final (copia del sector de arranque).  En la Figura 7, en el desplazamiento 0x28, la cuarta palabra es el valor del tama√±o de partici√≥n 0x00 00 00 00 00 01 13 09 A2 (18,024,866) sectores.  Agreguemos el desplazamiento de la partici√≥n en s√≠ desde el comienzo del disco a su longitud; obtendremos el desplazamiento del marcador NTFS final 18,024,866 + 63 = 18,024,929. Como era de esperar, no se necesitaba una copia del sector de arranque.  Al buscar en las proximidades, se detect√≥ con un cambio creciente de +12 sectores en relaci√≥n con el √∫ltimo fragmento de la MFT. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3f/lu/ha/3fluhair61nbqs6efqtncj0oily.png"></div><br>  <i>Fig.</i>  <i>12 Copiar sector de arranque NTFS</i> <br><br>  Ignoramos otra copia del sector de arranque en el desplazamiento 18 041 006, ya que no est√° relacionado con nuestra secci√≥n.  Con base en eventos anteriores, se encontr√≥ que dentro de la secci√≥n hay intercalados entre 61 sectores que "aparecieron" en la transmisi√≥n, que dividieron los datos. <br>  Realizamos una lectura de unidad completa, lo que da como resultado 34 sectores no le√≠dos.  Desafortunadamente, es imposible garantizar de manera confiable que todos ellos sean defectos eliminados de la lista P, pero es recomendable tener en cuenta su posici√≥n durante el an√°lisis posterior, ya que en algunos casos ser√° posible determinar de manera confiable los puntos de cambio precisos para el sector, y no para el archivo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sx/k9/sl/sxk9sldygcuoslhlrbi1bzuu8po.png"></div><br>  <i>Fig.</i>  <i>13 Estad√≠sticas de lectura de disco.</i> <br><br>  Nuestra pr√≥xima tarea ser√° establecer los lugares aproximados de los turnos (precisos para el archivo en el que surgieron).  Para hacer esto, escanearemos todos los registros MFT y crearemos las cadenas de ubicaci√≥n del archivo (fragmentos de archivo). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6n/-m/bi/6n-mbihfu_ej_y_ekagijttj7we.png"></div><br>  <i>Fig.</i>  <i>14 Las cadenas de la ubicaci√≥n de los archivos, o sus fragmentos.</i> <br><br>  Adem√°s, al pasar de un archivo a otro, estamos buscando en qu√© punto, en lugar del encabezado del archivo esperado, habr√° otros datos, y el encabezado deseado se detectar√° con un cierto desplazamiento positivo.  Y a medida que se refinan los puntos de cambio, completamos la tabla.  El resultado de su llenado ser√° m√°s del 99% de los archivos sin da√±os. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/on/ep/01/onep01nw4zpvpu_n3mfwruibbl8.png"></div><br>  <i>Fig.</i>  <i>15 Lista de archivos de usuario (consentimiento recibido del cliente para publicar esta captura de pantalla)</i> <br><br>  Para establecer cambios de puntos en archivos individuales, puede llevar a cabo trabajo adicional y, si conoce la estructura del archivo, puede encontrar entremezclas de datos que no est√°n relacionadas con √©l.  Pero en esta tarea no era econ√≥micamente factible. <br><br>  PD: Tambi√©n me gustar√≠a hacer un llamamiento a los colegas en cuyas manos ha estado este disco antes.  Tenga cuidado al trabajar con el firmware del dispositivo y reserve los datos de servicio antes de cambiar cualquier cosa, y tampoco permita que el problema se agrave deliberadamente si no puede llegar a un acuerdo con el cliente sobre la ejecuci√≥n del trabajo. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente publicaci√≥n: autodiagn√≥stico de discos duros y recuperaci√≥n de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Publicaci√≥n anterior: Guardar en coincidencias o recuperar datos del disco duro de rejilla Seagate ST3000NC002-1DY166</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475146/">https://habr.com/ru/post/475146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475136/index.html">Aprendizaje autom√°tico para su caza plana. Parte 3: el empuj√≥n final</a></li>
<li><a href="../475138/index.html">5 maneras de usar la Raspberry Pi de manera beneficiosa Parte dos</a></li>
<li><a href="../475140/index.html">¬øPor qu√© los mejores f√≠sicos consideran que las mediciones cu√°nticas d√©biles son una pseudociencia?</a></li>
<li><a href="../475142/index.html">Sue√±o, relajaci√≥n y m√∫sica: c√≥mo los atletas profesionales superan la fatiga y qu√© podemos hacer al respecto</a></li>
<li><a href="../475144/index.html">Divida a Laravel en componentes</a></li>
<li><a href="../475152/index.html">Hipocres√≠a google. PageSpeed ‚Äã‚ÄãInsights</a></li>
<li><a href="../475154/index.html">Timelapse interno con el servicio de vigilancia en la nube IPEYE</a></li>
<li><a href="../475158/index.html">Playme P570 Mono Review: breve y al grano</a></li>
<li><a href="../475162/index.html">Usando X-Macro en el c√≥digo moderno de C ++</a></li>
<li><a href="../475164/index.html">Discusi√≥n: Internet depende del c√≥digo abierto: ¬øqu√© argumentos tienen los cr√≠ticos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>