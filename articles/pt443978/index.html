<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõå üöâ ‚òòÔ∏è ATtiny13 vs PLC, ou como obter 14 E / S de um controlador de 8 p√©s üôéüèΩ üë©üèª‚Äçü§ù‚Äçüë®üèº üëåüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de prosseguir, gostaria de avisar um leitor zeloso. 



1. O que eu descrevo n√£o pode ser feito por muitos motivos; esses motivos ser√£o indicado...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ATtiny13 vs PLC, ou como obter 14 E / S de um controlador de 8 p√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443978/"><img src="https://habrastorage.org/webt/lk/bp/pb/lkbppbhy4dv1ifgmfeoc3w_mcua.jpeg" alt="imagem"><br><br>  Antes de prosseguir, gostaria de avisar um leitor zeloso. <br><br><ol><li>  O que eu descrevo n√£o pode ser feito por muitos motivos; esses motivos ser√£o indicados com alegria nos coment√°rios, e eu de modo algum exorto voc√™ a faz√™-lo.  E, em nenhum caso, afirmo que o dispositivo descrito abaixo pode substituir um PLC real.  Tudo o que foi descrito foi feito apenas para provar a mim mesmo que isso √© tecnicamente poss√≠vel e n√£o se aplica a equipamentos reais. </li><li>  Se voc√™ se sentir mal apenas por mencionar a palavra "Arduino", √© melhor n√£o ler.  Realizei todas as a√ß√µes com o controlador no IDE do Arduino, √© mais f√°cil para mim.  Mas nada impede de fazer o mesmo sem us√°-lo. </li></ol><a name="habracut"></a><br>  Durante muito tempo, quis escrever um artigo sobre minhas experi√™ncias com o ATtiny13, mas fiquei principalmente assustado com a atitude dos arduinoistas no site.  Al√©m disso, trabalho com controladores h√° apenas alguns anos (obrigado novamente ao Arduino, oh, onde voc√™ esteve antes!).  Coment√°rios sobre o artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tr√™s olhares para o post ...</a> mostraram que o t√≥pico ainda √© interessante para um n√∫mero suficiente de usu√°rios.  A prop√≥sito, o t√≠tulo do artigo deveria ser ‚ÄúPLC on ATtiny13‚Äù, mas nos mesmos coment√°rios, eles me explicaram educadamente <s>na mesa</s> que o dispositivo descrito n√£o poderia ser chamado de ‚ÄúPLC‚Äù.  Bem, n√£o, n√£o. <br><br><h3>  O que precisamos do PLC? </h3><br>  Come√ßou com o fato de que eu queria fazer um an√°logo funcional dos PLCs usados ‚Äã‚Äãem minha empresa, levando em considera√ß√£o como eles s√£o usados.  A maioria dos circuitos de controle temos retransmiss√£o com todas as defici√™ncias resultantes.  PLCs de v√°rios tipos tamb√©m s√£o usados ‚Äã‚Äãem locais, a partir dos anos 90.  Basicamente, eles executam a tarefa l√≥gica do circuito de controle, come√ßando pelo estado dos interruptores de limite e sensores de proximidade. <br><br>  Sem interfaces complexas, sem sinais anal√≥gicos.  On / Off.  S√≥ isso.  Na maioria das vezes, at√© a carga para as sa√≠das do PLC √© fornecida pelos mesmos rel√©s que eles estavam t√£o ansiosos para se livrar.  (O engra√ßado √© que em quase todos os lugares s√£o usadas sa√≠das de rel√© de PLC, que comutam rel√©s externos, que comutam eletro√≠m√£s de distribuidores hidr√°ulicos ... √Äs vezes, √© adicionado mais um link do iniciador.) Ent√£o, o que eu preciso do PLC: <br><br><ol><li>  Entradas discretas para um n√≠vel de sinal de 24 volts. </li><li>  Sa√≠das discretas com tens√£o de 24 volts. </li><li>  Testando o algoritmo interno de acordo com um determinado esquema, que pode ser alterado se necess√°rio (principalmente durante a depura√ß√£o). </li><li>  Velocidade de cerca de 50 ms, n√£o √© mais necess√°rio substituir os circuitos de rel√©. </li></ol><br>  E √© isso.  Sem interfaces.  Sem interrup√ß√µes.  Sem telas.  Ah, sim, as telas ... N√£o vai doer exibir o status das entradas e sa√≠das; aqui, os LEDs ainda n√£o possuem LEDs mais confi√°veis.  Bem, n√£o esque√ßa que tudo √© feito por interesse esportivo, respectivamente, o or√ßamento recai sobre os ombros do desenvolvedor.  A prop√≥sito, um incentivo muito bom. <br><br>  Se voc√™ n√£o levar em considera√ß√£o o n√≠vel do sinal de 24 volts, absolutamente qualquer microcontrolador com o n√∫mero de E / S (entradas / sa√≠das) n√£o menos do que o necess√°rio pode facilmente lidar com a tarefa. <br><br><h3>  Lidamos com os n√≠veis </h3><br>  Inicialmente, eu queria usar optoacopladores nas entradas.  Quem √© mais ou menos versado em eletr√¥nica, especialmente industrial, sabe que n√£o existem muitos optoacopladores.  Os coment√°rios explicar√£o em detalhes por que √© imposs√≠vel sem os acopladores √≥pticos.  Mas pesava os pr√≥s e os contras e decidi recusar.  Portanto, alguns podem n√£o ler mais e imediatamente prosseguir para escrever um coment√°rio. <br>  Portanto, temos um sinal de entrada de 24 volts ou 0 volts na aus√™ncia de um sinal.  Isso permitir√° o uso de um sensor de posi√ß√£o indutivo sem contato ou uma chave limitadora de contato convencional.  A partir de 24 volts, √© necess√°rio obter a tens√£o da unidade l√≥gica segura para o controlador.  O bom e velho divisor de tens√£o lida com isso da melhor maneira poss√≠vel. <br><br><img src="https://habrastorage.org/webt/k4/mh/5u/k4mh5u-z5xmykgkjexscgcu_pba.jpeg" alt="imagem"><br><br>  Os resistores s√£o calculados levando em considera√ß√£o que, para qualquer desvio da tens√£o de entrada em mais ou menos 20% da tens√£o nominal na entrada do microcontrolador, deve haver mais do que a tens√£o de comuta√ß√£o (geralmente √© metade da tens√£o do controlador), mas n√£o mais do que a tens√£o do controlador, consideramos igual a 5 V.  Adequado para qualquer controlador da fam√≠lia AVR.  Al√©m disso, a corrente estimada atrav√©s do divisor √© de cerca de 7 mA, o que reduz a probabilidade de interfer√™ncia e, ao mesmo tempo, n√£o carrega fortemente a sa√≠da do sensor e a fonte de energia.  Um diodo zener de 4,7 V serve para proteger contra sobretens√µes na mesma interfer√™ncia.  Ainda h√° um grande n√∫mero de contatos, podemos lutar com ele de forma program√°tica ou absolutamente nada, √© apenas uma maquete.  Agora eu ainda teria que indicar o status da entrada.  E aqui voc√™ pode aplicar o lifehack, matando dois coelhos com uma cajadada: <br><br><img src="https://habrastorage.org/webt/q9/rd/bj/q9rdbjjfnccqucc0cl6h9_19pr0.jpeg" alt="imagem"><br><br>  O LED no circuito executa duas fun√ß√µes - funciona como um diodo zener, limitando a tens√£o a 2,8 ... 2,9 volts (apenas para LEDs azuis e brancos!), E tamb√©m brilha.  Devo avisar que, em alguns casos, a tens√£o no LED n√£o √© suficiente para mudar a entrada do controlador!  Ao usar v√°rias entradas do controlador, simplificamos a instala√ß√£o e salvamos v√°rios diodos zener.  Ao aumentar gradualmente a tens√£o de entrada, voc√™ pode notar que o momento de igni√ß√£o do LED e o momento de alternar a entrada n√£o coincidem um pouco.  Mas isso n√£o nos incomoda muito, pois n√£o deve haver n√≠veis intermedi√°rios na entrada, apenas 0 V ou 24 V. Naturalmente, nesse momento, voc√™ deve ter pelo menos o firmware de teste m√≠nimo para uma entrada e uma sa√≠da no controlador. <br><br>  Agora, o sinal de sa√≠da do controlador tamb√©m precisa ser adaptado para 24 V, e levando em considera√ß√£o que o fio comum, que tamb√©m √© negativo, √© comum a todos os rel√©s de sa√≠da.  Aqui voc√™ precisa de pelo menos 2 transistores e 2 resistores: <br><br><div class="spoiler">  <b class="spoiler_title">esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v6/ap/um/v6apumv_nl09p0ozminlcjzajp8.jpeg" alt="imagem"><br></div></div><br>  De fato, seria necess√°rio mais um resistor e um diodo de prote√ß√£o paralelo ao rel√©, mas n√£o √© isso.  No come√ßo eu usei esse circuito.  Mas, a certa altura, chamei a aten√ß√£o para os acopladores √≥pticos, que recusei no in√≠cio. <br><blockquote>  Quem nos incomoda nos ajudar√° </blockquote><br><div class="spoiler">  <b class="spoiler_title">esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gr/hp/hf/grhphftzdbeeqn4qplwr1pup8z4.jpeg" alt="imagem"><br></div></div>  Examinamos os par√¢metros dos acopladores √≥pticos por folhas de dados: o PC817C de sa√≠da mais barato e mais acess√≠vel permite que voc√™ alterne U: 35 V: I: 50 mA.  Esses rel√©s conectados ao CLP em nosso local (na empresa) levam at√© 45 mA.  Sem estoque, mas bastante adequado.  A maioria dos rel√©s de tamanho pequeno a 24 V puxa at√© 15 ... 20 mA.  No final, voc√™ pode comprar um acoplador √≥ptico mais caro, se voc√™ realmente precisar, existem correntes de at√© 80 mA e tens√£o de at√© 60 V. Somos adequados para o layout e o 817.  Para que voc√™ n√£o aprenda com seus erros, aviso que, para obter a m√°xima corrente de sa√≠da atrav√©s do LED do acoplador √≥ptico, √© necess√°rio passar mais de 7 mA. <br><br>  Bem, novamente, lembre-se da indica√ß√£o.  Para exibir o status da sa√≠da, adicionamos um LED em s√©rie com o LED do acoplador √≥ptico, ainda temos mais de 3 volts ociosos l√°.  E √© hora de desenhar um diodo de prote√ß√£o antes de gravar o acoplador √≥ptico.  A prop√≥sito, n√£o consegui encontrar um m√©todo para escolher um diodo de prote√ß√£o, dependendo dos par√¢metros do rel√©.  Por um lado, deve ser pulsado, por outro, alta tens√£o.  Al√©m disso, ele pode ser colocado paralelo ao transistor, o que √© melhor?  A pr√°tica mostra que um diodo IN4148 de pot√™ncia suficientemente baixa neste caso, mas eu gostaria de uma justificativa te√≥rica. <br><br><div class="spoiler">  <b class="spoiler_title">esquema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yb/w6/-y/ybw6-ymcrmjzgumo8m3bcss2gek.jpeg" alt="imagem"><br></div></div><br>  Um resistor de 220 ohm √© indicado com o c√°lculo novamente em um LED azul ou branco; se voc√™ colocar vermelho, a corrente no circuito de 3,5 mA aumentar√° para 9 mA, isso deve ser levado em considera√ß√£o. <br><br><h3>  Um pouco sobre programa√ß√£o </h3><br>  Bem, existem muitas letras, mas ainda n√£o cheguei ao final do t√≠tulo, nem a ATtiny13.  Para programar meu controlador, usei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o projeto FLProg</a> , um ambiente de programa√ß√£o visual que aproxima a programa√ß√£o do controlador da programa√ß√£o do CLP no LAD e FBD.  O circuito criado nesse ambiente, que tamb√©m √© um projeto, √© compilado em um esbo√ßo do Arduino, que eu j√° carrego do Arduino no ATtiny13 ou em outro controlador da fam√≠lia AVR.  Por exemplo, um esquema t√£o simples <br><br><img src="https://habrastorage.org/webt/wl/i9/1m/wli91mdh38s505j7e5qlz4dpxym.png" alt="imagem"><br><br>  compila em c√≥digo como este: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _k1 = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
pinMode(<span class="hljs-number"><span class="hljs-number">1</span></span>, INPUT);
pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, INPUT);
pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT);
}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
_k1 = (((((!(digitalRead (<span class="hljs-number"><span class="hljs-number">1</span></span>)))) &amp;&amp;((digitalRead (<span class="hljs-number"><span class="hljs-number">2</span></span>))))) || ((((!(digitalRead (<span class="hljs-number"><span class="hljs-number">1</span></span>)))) &amp;&amp;(_k1))));
digitalWrite (<span class="hljs-number"><span class="hljs-number">3</span></span>, _k1);
}</code></pre><br>
     -   - ,   .     FLProg  ,       ¬´¬ª    .       ,      . , pin     ‚Äì      ,      .      ATtiny13,    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    Attiny13  Attiny13a   Arduino IDE</a> ,  : FLProg     ATtiny13 (     ),   ,     ,  ATmega168.  FLProg     ,    ATtiny13,     .    Arduino IDE     ,    .<br>
<br>
<h3>    </h3><br>
    ?    ATtiny13,      5 ,       .   ,   6 ,   ,  , : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> ?  RESET</a>.<br>
<br>
,  6,   .   ?<br>
<br>
  :<br>
<br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/i-/bo/y8/i-boy8fj5pf1ryijqu4pjdpyjto.jpeg" alt="image"><br>
</div></div><br>
 ,           .      .       ,    .  . <br>
<br>
  ,       50 . ,    50     ,    ,       .     ,   . <br>
<br>
        0   2,8 ,       ,           .  ,      ,    1,1  (   )  2,9 ,   4 .      ,  .<br>
<br>
   .      ,        ,  .      ,       ,    5 ,      --  ,       .          3  (   )  680 .      ,     .         ,   ,           .<br>
<br>
    ?       50 ,    1 ,    50 .  ,  1     ,             .       ,    .<br>
<br>
   ,     .       ,     . <br>
<br>
    6+6=12 -,    2?<br>
<br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><img src="https://habrastorage.org/webt/kf/rj/nu/kfrjnufoiyvhmwvetvqlf8x3mx4.jpeg" alt="image"><br>
</div></div><br>
,   ?     ,    )   4 , ,      ,     .          0 ,        ,  2,8 ,       (    ).        24,    0,  ,    2  ‚Äì 0,93   1,87 .         ,       .   Arduino IDE       ,            ATtiny,   .       ,    .<br>
<br>
,  , 6   10 (!)    ATtiny13     (     ). ,     ,     .         ,     ¬´¬ª  ATtiny. ,         ATmega8,     .     :-)<br>
<br>
            ,      .<br>
<br>
        ,        ,    ,     .   I/O     . ,   (8/6)    ,       ,     ¬´   ¬ª.<br>
<br>
 ,       , ,       ¬´¬ª,    <s></s>.  .<br>
<br>
P.S.       ,  : ¬´    ?¬ª<br>
<br>
<div class="spoiler"><b class="spoiler_title"></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/uu/9d/ah/uu9dahstj6whlhfckbfknzfdth4.png" alt="image"><br>
</div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443978/">https://habr.com/ru/post/pt443978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443966/index.html">Google Docs - um bate-papo favorito entre os alunos</a></li>
<li><a href="../pt443968/index.html">Como compramos uma casa com pain√©is solares e o que aconteceu</a></li>
<li><a href="../pt443972/index.html">Yandex procurar√° piratas usando um rob√¥</a></li>
<li><a href="../pt443974/index.html">Mem√≥ria e Span pt. 1</a></li>
<li><a href="../pt443976/index.html">Mem√≥ria e Span pt. 2</a></li>
<li><a href="../pt443980/index.html">Mem√≥ria e Span pt.3</a></li>
<li><a href="../pt443984/index.html">O novo padr√£o baseado no PCIe 5.0 "conectar√°" a CPU e a GPU - o que √© conhecido</a></li>
<li><a href="../pt443986/index.html">Como um esquilo em uma roda ou um pouco sobre pesquisa de usu√°rio em um ambiente de defici√™ncia</a></li>
<li><a href="../pt443988/index.html">Arquitetura de microsservi√ßo = computa√ß√£o distribu√≠da</a></li>
<li><a href="../pt443990/index.html">13 novos jogos introduzidos como parte do programa ID @ Xbox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>