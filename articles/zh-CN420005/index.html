<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👦 🐅 🈵 不专业的公寓视频监控既有趣又便宜 🎴 ▶️ ➕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="从我在保安室里安装了GSM警报系统的那一刻起，我就想到，如果触发了警报传感器（或者警报是错误的），那么在我不在的时候让“眼睛”呆在公寓里会很好。 由于我是信息技术领域的工程师，因此毫无疑问，任何专业解决方案都可以采用注册服务商和一堆摄像机的形式，只有我自己动手才能完成。 还决定立即将预算设置为极限，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>不专业的公寓视频监控既有趣又便宜</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420005/"><img align="left" src="https://habrastorage.org/webt/af/kl/ma/afklma2ivyuyigiy4x2qvej-tjc.jpeg"> 从我在保安室里安装了GSM警报系统的那一刻起，我就想到，如果触发了警报传感器（或者警报是错误的），那么在我不在的时候让“眼睛”呆在公寓里会很好。 由于我是信息技术领域的工程师，因此毫无疑问，任何专业解决方案都可以采用注册服务商和一堆摄像机的形式，只有我自己动手才能完成。 还决定立即将预算设置为极限，如果该项目成功，则已经在考虑进一步改进和现代化。 <br><a name="habracut"></a><br><h4> 铁 </h4><br> 首先，我们选择铁。  “眼睛”是指相机，什么也看不到。 然后就产生了一个问题，即如何处理接收到的图像-将其存储，传输到某个地方等 因此，我想到了通过UPS与4G调制解调器连接的路由器，以提供稳定的Internet通道，而这很难引起潜在的盗窃。 <br><br> 在工作中，几年来，我们已经成功地将路由器与ZyXel Keenetic USB端口配合使用（特别是我已经过时的Giga2型号）。 在固件开发人员“搞砸” OPKG（程序包管理器）之类的事情之后，便有可能将我的路由器变成具有linux的可能性最大的个人计算机，我决定将其用于我的目的。 总的来说，我已经在家中有一台连接了4G调制解调器的计算机路由器，但我只缺少USB相机的“眼睛”。 记得三，四年前，我为父母购买了一款Logitech C270网络摄像头，以便他们通过计算机上的Skype与亲戚进行交流，而现在他们已经通过平板电脑进行交流-我向他们索要了相机。 顺便说一句，在摄像机的前面板上有一个LED，用于显示摄像机是否正在工作-将来，从视觉上确定视频监视系统的操作非常方便。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jc/mn/7h/jcmn7hy7culoiu4yxzchbbrhpzo.jpeg"></div><br><h4> 配对并配置铁 </h4><br> 因此，有铁。 而当我们在预算之内时，不禁会感到高兴。 <br> 我的路由器上有两个USB端口，其中一个已经被4G USB调制解调器占用。 我们将通过将Logitech C270摄像机粘贴在那里来使用第二个摄像机。 为了使路由器与摄像机配合使用，必须首先在路由器上安装OPKG组件（在该组件中，我们勾选了除“支持USB DVB调谐器的内核模块”以外的所有复选标记）。 但是有一个陷阱-OPKG要在路由器中工作，您需要磁盘空间（1 GB足以容纳眼睛），但是在哪里可以得到它，因为路由器上的两个USB端口都已经被占用了？ 有两种解决方案：要么是带有USB闪存驱动器的USB集线器（立即想到的第一件事），要么是您可以在我的4G USB调制解调器中放入microSD卡的事实。 在家中发现的8 GB的慢速microSD卡很快就进入了调制解调器。 将文件系统放在NTFS卡上（尽管强烈建议使用EXT2或EXT3）。 创建安装文件夹，然后将所需的Entware映像上载到该文件夹​​。 <br><br> 然后我们转到路由器的管理面板的OPKG选项卡，选择我们的存储卡，在“ initrc脚本”行中写 <br><br><pre><code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/rc.unslung</code> </pre> <br> 然后单击“ <i>应用”</i> 。 <br> 安装OPKG后，SSH客户端（我在装有Windows的笔记本电脑上使用Putty程序）紧贴路由器并运行以下命令来更新OPKG： <br><br><pre> <code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> opkg <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span></code> </pre> <br> 默认情况下，在SSH上， <i>根</i>密码为<i>keenetic</i> （或<i>zyxel</i> ，具体取决于固件版本）。 强烈建议您使用<i>passwd</i>命令更改密码。 <br><br><h4> 软体类 </h4><br> 接下来，安装运动程序。 <br><br><pre> <code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> motion</code> </pre> <br> 是她将与我们的相机一起工作，分析图片中的变化并指示路由器将接收到的图像发送到哪里。 运动程序设置文件为\ etc \ motion \ motion.conf，对其进行编辑，我们将更改所需的设置。 首先，我将相机支持的最大分辨率设置为1280x720，将其旋转180度（将相机倒置时更方便），每秒记录2帧。 <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">rotate</span></span> <span class="hljs-number"><span class="hljs-number">180</span></span> width <span class="hljs-number"><span class="hljs-number">1280</span></span> height <span class="hljs-number"><span class="hljs-number">720</span></span> framerate <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br> 我没有看到需要记录整个视频流并将其广播到Internet的需要，因此我设置了动议来记录视频并仅在图像改变时进行传输。 在配置运动的过程中，很明显它不支持我的相机使用MJPEG模式，而仅支持YUYV模式-因此，工作的结果不是视频序列，而是仅JPEG照片序列。 <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">v4l2_palette</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span></code> </pre> <br> 我还配置了动作，以便将照片的副本复制到外部FTP服务器。 <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">on_picture_save</span></span> wput ftp://login:pass<span class="hljs-variable"><span class="hljs-variable">@XX</span></span>.29.136.XX %f</code> </pre> <br> 如果将带有存储卡的路由器从公寓中取出，则仍然有机会查看这是如何发生的。 <br><br> 强烈建议您更改登录密码以连接到相机。 <br><br><pre> <code class="hljs pgsql">stream_authentication <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>:pass</code> </pre> <br> 完成所有设置后，在浏览器中查看以下结果： <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8081</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b4/xd/wk/b4xdwknikb-elwngaufq3z8setg.jpeg"></div><br> 注意！ 如果浏览器中没有看到任何图像，则应注意您的Keenetic固件版本。 大概从固件版本2.11.A.4.0-1开始，默认情况下不加载视频模块，因此您需要将它们加载到“ SSH”“ pens”中或将它们添加到启动脚本中： <br><br><pre> <code class="hljs powershell">/opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/i2c<span class="hljs-literal"><span class="hljs-literal">-core</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/i2c<span class="hljs-literal"><span class="hljs-literal">-dev</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videodev.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-core</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-memops</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/videobuf2<span class="hljs-literal"><span class="hljs-literal">-vmalloc</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/v4l2<span class="hljs-literal"><span class="hljs-literal">-common</span></span>.ko /opt/sbin/insmod /lib/modules/<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">113</span></span>/uvcvideo.ko</code> </pre> <br> 如果之后仍未显示图像，则首先查看Keenetic日志，即连接相机后会发生什么。 是否将相机检测为视频设备等？ <br><br><h4> 管理学 </h4><br> 完成所有这些工作后，我们想到了需要以某种方式进行管理的想法，即 在适当的时间打开和关闭（且通常在远程）。 我通过在Android智能手机上安装SSH客户端解决了该问题。 选择SSH之后，客户端便选择了ScriptKitty。 通过按智能手机上的两个或三个键，您可以快速打开或关闭运动。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0r/dj/to/0rdjtofm6gsjlzfjxq_dkrk6zgo.jpeg"></div><br> 通过SSH运行运动： <br><br><pre> <code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/<span class="hljs-type"><span class="hljs-type">K99motion</span></span> restart</code> </pre> <br> 通过SSH完成运动： <br><br><pre> <code class="hljs swift">/opt/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/<span class="hljs-type"><span class="hljs-type">K99motion</span></span> stop</code> </pre> <br> 但是还有一个问题：4G调制解调器上的“灰色” IP地址。 通过Wi-fi连接到路由器，您可以打开或关闭运动，而不会出现任何问题。 但是，如果您不在路由器的Wi-Fi范围内，并且路由器的IP地址为“灰色”怎么办？ 我找到了以VPN形式进行的救援。 方案如下-使用家用路由器，我使用PPTP客户端（使用PPTP服务器安装在路由器上）通过静态IP固定在使用该路由器的路由器上。 现在，将SSH端口从工作路由器转发到家庭路由器后，我终于可以通过从智能手机访问工作中路由器的静态地址来远程控制摄像机。 <br><br> 我还尝试使用Tasker自动化工具（它具有自己的单独的SSH客户端）使控件自动化-监视智能手机与Wi-Fi路由器的连接，并据此打开或关闭运动。 逻辑是这样的：智能手机已连接到Wi-Fi路由器-所以我在家-关闭相机。 智能手机未连接到Wi-Fi路由器-因此我不在家-打开相机电源。 但是经过试验后，他拒绝了此选项-误报过多。 例如，我在家，智能手机入睡，路由器丢失了智能手机，相机打开-等等。 目前，我仅使用手动方法。 <br><br><h4> 结论 </h4><br> 原则上，我从项目中获得的就是我得到的。 我可以随时“看到”公寓，并且在触发任何GSM警报的情况下，我已经可以决定下一步要做什么。 在实施过程中，我解决了很多问题，但是从所获得的知识和计划的实施中，他们的解决方案引起了一定的刺激。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/av/fa/ux/avfauxqtn-lu_v2vmvijmrrd1em.jpeg"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN420005/">https://habr.com/ru/post/zh-CN420005/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419995/index.html">对新的Angular编译器Ivy的研究</a></li>
<li><a href="../zh-CN419997/index.html">解析JavaScript中的“模块”模式</a></li>
<li><a href="../zh-CN419999/index.html">Yii1 / yii2身份验证共享</a></li>
<li><a href="../zh-CN420001/index.html">推出3CX v15.5 Update 6 BETA和WebRTC浏览器软件电话</a></li>
<li><a href="../zh-CN420003/index.html">JavaFX上带有按钮的窗口：</a></li>
<li><a href="../zh-CN420007/index.html">FidgetPen，怪异的灯和分离器立方体：认识Allocacoc</a></li>
<li><a href="../zh-CN420009/index.html">产品设计的精妙之处</a></li>
<li><a href="../zh-CN420011/index.html">如何选择3D打印机：入门指南</a></li>
<li><a href="../zh-CN420013/index.html">瞻博网络交换机上的MAC地址搜索</a></li>
<li><a href="../zh-CN420015/index.html">如何正确衡量Internet通道的速度，并在提供者的眼中不再像傻瓜一样</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>