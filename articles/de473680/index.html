<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✴️ 🌶️ ↪️ Klimaanlage IT. Teil II 🏩 👐🏾 🙄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Teil werde ich Ihnen die Möglichkeit der „einfachen“ Integration einer Klimaanlage (und im Allgemeinen fast jedes über IR gesteuerten Geräts...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Klimaanlage IT. Teil II</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473680/"><img src="https://habrastorage.org/webt/y_/r9/qi/y_r9qi_etxishykvysm5-e6gqem.jpeg" align="left" title="Kleine schwarze Feige">  In diesem Teil werde ich Ihnen die Möglichkeit der „einfachen“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Integration einer Klimaanlage</a> (und im Allgemeinen fast jedes über IR gesteuerten Geräts) über ein WiFi &lt;=&gt; IR-Gateway erläutern. <br><br>  Um es interessanter zu machen, habe ich ein beliebtes Gateway gewählt (Yandex verwendet es übrigens für ihre Alice).  Sie können einen bei Ali kaufen, der Preis beträgt ca. 1200 Rubel (Yandex ist teurer). <br><br>  Das Gerät ist recht kompakt (passt leicht in Ihre Handfläche), von den sichtbaren Organen gibt es eine kleine unauffällige blaue LED und einen Knopf zum Koppeln.  Alles andere verbirgt sich hinter einem schwarzen transparenten Infrarotgehäuse.  Sie können jeden verfügbaren USB-Anschluss (Netzteil, Computer usw.) als Stromquelle verwenden.  Das Gateway wird über ein Micro-USB-Kabel (mitgeliefert oder auf bequeme Weise) mit dem Gateway verbunden. <br><br>  Die Besonderheit dieses Geräts ist, dass es auf dem „in engen Kreisen bekannten“ esp8266 aufgebaut ist, was bedeutet, dass es ziemlich leicht „gezähmt“ werden kann. <br><a name="habracut"></a><br><h2>  Option "für die Kleinsten" </h2><br>  Bevor ich das Gerät wechselte, habe ich versucht, es normal zu verwenden: Ich habe die TuyaSmart-Anwendung auf meinem Telefon installiert (es gibt Versionen für Android und iPhone), und dann ist alles einfach: <br><br><ul><li>  in der Anwendung registrieren, </li><li>  Wir werden einen kleinen Assistenten durchlaufen, um ein neues Gerät anzuschließen (dazu muss das Gateway an die Stromversorgung angeschlossen sein und es mit einer einzigen Taste in den Pairing-Modus versetzen. </li><li>  Nachdem das Gateway in der Anwendung angezeigt wurde, erstellen wir ein neues „Control Panel“ - einen weiteren kleinen Assistenten, in dem Sie den Gerätetyp auswählen (in meinem Fall - Klimaanlage) und dann den Hersteller auswählen (es gibt kein Electrolux in der Anwendung, aber es hat bei der Auswahl von Midea hervorragend funktioniert).  Sofort finden wir den „Namen“ der neuen Konsole (ich habe „Mr. White“ gewählt). </li></ul><br>  Das ist alles.  Danach erscheint die folgende Fernbedienung auf dem Telefon: <br><br><img src="https://habrastorage.org/webt/e5/ue/u_/e5ueu_qvxtkqvtt6itcpst7gpke.jpeg" align="right">  Damit können Sie die Grundfunktionen steuern: <br><br><ul><li>  ein / aus </li><li>  Temperatureinstellung </li><li>  Auswahl der Betriebsart ("Auto", "Kühlen", "Heizen", "Lüfter"), </li><li>  Auswahl der Lüftergeschwindigkeit („Auto“, „Niedrig“, „Mittel“, „Hoch“). </li></ul><br>  Im Allgemeinen ist die Verwendung für die Fernbedienung bereits möglich, aber wo ist das „Smart Home“ und die Integration? <br><br>  Da dies ein einfacher Weg ist, ist es schlecht mit einem Smart Home, aber mit der Integration ist es etwas besser. <br><br>  Erstens die Fliege in der Salbe - es gibt keine Integration mit Apple HomeKit, daher ist Siri noch nicht verfügbar, aber mit anderen konkurrierenden Plattformen macht alles viel mehr Spaß: <br><br><ul><li>  Für Amazon Alexa gibt es eine Tuya Smart-Fähigkeit.  Es reicht aus, es zu aktivieren und darin Ihr Konto anzugeben, das Sie bei der Registrierung in der Anwendung eingegeben haben - Sie können die Klimaanlage sprachgesteuert. </li><li>  Ebenso können Sie Tuya Smart mit Google Assistant verbinden. </li></ul><br>  In beiden Fällen wird die russische Sprache nicht unterstützt, aber die Stimme wird leicht und einfach gesteuert.  Ich habe folgende Befehle gefunden: <br>  - Alexa, mach Mr. White an <br>  - Hey, Google, stell Mr. White auf 24 Grad <br>  - Alexa, schalte Mr.White aus <br><br>  Ich möchte Sie daran erinnern, dass ich die Sprachsteuerung mit Amazon Echo Dot und Google Home Mini implementiert habe. Beide Geräte arbeiten identisch mit Teams. <br><br>  Übrigens, welche Sprachbefehle Sie den Betriebsmodus und den Luftdurchsatz steuern können - habe ich nicht gefunden.  Wenn mir jemand sagt, werde ich dankbar sein. <br><br>  Und dann wurde eine „halbautomatische“ Integration mit UD durchgeführt: Wenn die Temperatur im Raum über den Schwellenwert steigt, sendet der UD-Controller eine Nachricht, in der er aufgefordert wird, die Klimaanlage einzuschalten, und ich habe die Klimaanlage mithilfe der TuyaSmart-Anwendung aus der Ferne im erforderlichen Modus eingeschaltet. <br><br>  Die Lösung ist natürlich "so lala", aber zumindest irgendwie kann man sie verwenden. <br><br>  Aber das ist nicht unser Weg - wir gehen weiter: <br><br><h2>  Jedi Way </h2><br><h3>  Autopsie und Vorbereitung </h3><br>  Es besteht die Möglichkeit, das Gerät zu flashen, ohne es zu öffnen. Die Methode wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> beschrieben. <br><br>  Diese Methode schien mir unnötig kompliziert (so viele Bewegungen, wenn die Firmware nur 4 Drähte zum Löten benötigt), und es war interessant, nach innen zu schauen. <br><br>  Leider wurde ich dabei mitgerissen und habe vergessen, ein Foto zu machen, so dass ich die Fotos anderer Leute zeigen werde: <br><br><img src="https://habrastorage.org/webt/di/wv/bx/diwvbx4obuman2fxbcx9ncpxlhe.jpeg" width="360"><img src="https://habrastorage.org/webt/e3/dv/xd/e3dvxdmwrqauy1rhoqmdzlyolsu.jpeg" width="360"><br>  Weitere Fotos finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Das Foto zeigt deutlich, dass das TYWE3S-Modul verwendet wird (das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datenblatt,</a> auf dem es in Google sehr einfach ist). <br><br>  Jetzt müssen Sie das Modul flashen.  Die ursprüngliche Firmware wird überschrieben und kann nicht wiederhergestellt werden. <br><br>  Die Firmware ist sehr einfach: Wir nehmen die Arduino-Umgebung (oder Atom oder etwas anderes - wählen Sie nach Ihrem Geschmack).  Laden Sie die Skizze mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tasmota-</a> Firmware in die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwicklungsumgebung</a> herunter.  Dann schließen wir ein TYWE3S RX-, TX-, GND-, VCC-Modul von einer beliebigen USB-Serie an (nicht verwechseln - Sie benötigen 3,3 V Strom und die entsprechenden Signalpegel, wenn 5 V vorhanden sind, müssen Sie ein neues Gateway bestellen).  Vergessen Sie vor dem Einschalten nicht, den GPIO0 des Moduls (auf bequeme Weise) gegen Masse zu schließen, um das Modul in den Firmware-Modus zu versetzen.  Firmware. <br><br>  Es ist nicht erforderlich, die Firmware zu konfigurieren - alles kann im Code "wie es ist" belassen werden, wir müssen nur das Modul "zähmen". <br><br>  Wenn alles richtig gemacht wurde (natürlich nach dem Trennen der Kabel für die Firmware), schalten Sie das Gateway ein.  Aktivieren Sie auf Ihrem Telefon oder Computer die Suche nach WLAN-Netzwerken. Es sollte ein neues Netzwerk mit dem Namen sonoff-xxxx (wobei xxxx Zahlen sind) angezeigt werden, das unser Gerät aufnimmt. <br><br>  Wir stellen eine Verbindung zu diesem Netzwerk her und gehen zur Adresse: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">192.168.4.1</a> - Dies ist die Webschnittstelle unseres Gateways. <br><br>  Geben Sie zunächst in den Gateway-Einstellungen das WLAN-Heimnetzwerk und das Kennwort dafür an (das Gerät wird neu gestartet und stellt eine Verbindung zum Heimnetzwerk her).  Außerdem sind alle Aktionen darin einfacher durchzuführen.  Natürlich müssen Sie auf bequeme Weise herausfinden, welche Adresse das Gateway im Heimnetzwerk erhalten hat. <br><br>  Wir gehen auf die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Seite mit Tasmota-Firmware-Versionen</a> .  Laden Sie zwei Dateien herunter - sonoff-minimal.bin und sonoff-ir.bin <br><br>  Jetzt aktualisieren wir die Firmware über die Weboberfläche des Gateways in zwei Schritten: Zuerst nähen wir die „Minimum“ -Version und der zweite Schritt ist sonoff-ir. <br><br>  Nach all diesen einfachen Aktionen haben wir bereits ein Modul mit der aktuellen Firmware-Version in der Hand, es bleibt nur noch wie folgt zu konfigurieren: <br><br><img src="https://habrastorage.org/webt/mr/ti/wh/mrtiwhec5gh-ggeret8rsschi9a.png" align="left" width="350"><br><br>  Tatsächlich ist dies die minimal erforderliche Konfiguration - im beschriebenen Beispiel werden wir mit dem Modul über GET-Anforderungen interagieren (obwohl dies auch über MQTT möglich ist). <br><br>  Sie können die Funktionsweise des Moduls überprüfen und gleichzeitig in seiner Konsole etwas Nützliches herausfinden (einen Link dazu finden Sie auf der Hauptseite der Weboberfläche).  Öffnen Sie die Konsole und sehen Sie, wie das Modul "lebt". <br><br>  Jetzt können Sie beginnen, die Steuerungsschnittstelle der Klimaanlage zu lernen.  Nehmen Sie dazu die Standardfernbedienung von der Klimaanlage und drücken Sie den Netzschalter.  Wenn alles in Ordnung ist, dann eine Zeile wie: <br><br><pre><code class="plaintext hljs">19:24:09 MQT: tele/IRbridge/RESULT = {"IrReceived":{"Protocol":"COOLIX","Bits":24,"Data":"0xB29F70","DataLSB":"0x4DF90E","Repeat":0,"IRHVAC":{"Vendor":"COOLIX","Model":-1,"Power":"on","Mode":"cool","Celsius":"on","Temp":22,"FanSpeed":"min","SwingV":"off","SwingH":"off","Quiet":"off","Turbo":"off","Econo":"off","Light":"on","Filter":"off","Clean":"on","Beep":"off","Sleep":-1}}}</code> </pre> <br>  Das Modul hat den IR-Befehl von der Fernbedienung empfangen und "analysiert".  Das heißt,  Aus der Konsole wird sofort ersichtlich, welches Protokoll (in meinem Fall COOLIX) von der normalen Klimaanlage verwendet wird und welche Parameter im Paket codiert sind. <br><br>  Großartig, jetzt können Sie bereits die Klimaanlage steuern.  Um dies sinnvoll zu tun, ist es besser, sich mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dieser</a> Beschreibung der Befehle vertraut zu machen. <br><br>  Zur Überprüfung senden wir beispielsweise den folgenden Befehl über die Gateway-Konsole (ich gebe alle Befehle für meine Klimaanlage an, möglicherweise haben Sie ein anderes Steuerprotokoll): <br><br><pre> <code class="plaintext hljs">IRhvac{"Protocol":"COOLIX","Power":"On","Mode":"Cool","FanSpeed":"min","Temp":22}</code> </pre> <br>  Wie durch ein Wunder schaltet sich die Klimaanlage sofort und im gewünschten Modus ein.  Wunder! <br><br>  Schalten Sie die Klimaanlage mit folgendem Befehl aus: <br><br><pre> <code class="plaintext hljs">IRhvac{"Protocol":"COOLIX","Power":"Off"}</code> </pre> <br>  Im Allgemeinen wird das Modul vorbereitet und getestet. <br><br>  Gehe zur Integration! <br><br><h3>  Klimaanlage + Domoticz = Freundschaft für immer! </h3><br>  Ich verwende Domoticz als Hauptautomatisierungssystem, daher werden wir mit diesem speziellen System „befreundet“ sein. <br><br>  Der Arbeitsplan lautet wie folgt: <br><br><ol><li>  Erstellen Sie mehrere virtuelle Geräte: einen Schalter, zwei Selektoren (zur Auswahl von Modi und Luftdurchsatz) und einen Thermostat. </li><li>  Fügen Sie einige Skripts hinzu, die durch Aktionen mit virtuellen Geräten Befehle an das Gateway senden. </li><li>  Stellen Sie sicher, dass alles ordnungsgemäß verwaltet wird. </li></ol><br><h4>  Virtuelle Geräte </h4><br>  Beim Erstellen von Geräten müssen Sie deren Namen angeben.  Ich bringe meine mit, Sie können alle anderen auswählen, denken Sie daran, die Skripte später für sie zu reparieren. <br><br>  Erstellen Sie einen regulären Switch (Typ "Switch") mit dem Namen "HVAC".  Mit diesem Schalter wird eine Taste ein- und ausgeschaltet. <br><br>  Um die Betriebsarten der Klimaanlage auszuwählen, fügen Sie einen virtuellen Schalter „HVAC-Mode“ (Typ „Selector Switch“) mit den folgenden Eigenschaften hinzu: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t9/fe/dn/t9fednom5tcyxsgs-htc4vi2pkq.png"></div><br>  Bitte beachten Sie, dass ich hier nur zwei Modi erstellt habe - "Heizen" und "Kühlen".  Obwohl die Klimaanlage immer noch die Modi „Auto“ und „Fan“ hat, sind sie für mich nutzlos - der erste funktioniert irgendwie seltsam und unangenehm für Haushalte, und der zweite wurde überhaupt nicht benötigt.  Wenn Sie diese Modi verwenden, können Sie sie einfach zur Auswahl hinzufügen. <br><br>  Erstellen Sie auf ähnliche Weise den Selektor „HVAC-FanSpeed“: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xj/lj/3x/xjlj3x3mjwt9wtxyh0ve4ucljse.png"></div><br>  Jetzt muss nur noch der HVAC-Temp-Thermostat erstellt werden (der Gerätetyp ist Thermostat-Sollwert). <br><br><h4>  Skripte </h4><br>  Ich bin irgendwie näher an Domoticz-Skripten auf Lua (Geräte), also mache ich das, was für mich bequemer ist. <br><br>  Zur Sicherheit: Die IP-Adresse des IR-Gateways in meinem Heimnetzwerk lautet 10.40.20.254. Diese Adresse wird in einem der Skripte angezeigt. Sie müssen sie an der Adresse Ihres Gateways korrigieren. <br><br>  Erstellen Sie die folgenden drei Skripte. <br><br>  HVACauto: <br><br><pre> <code class="lua hljs">commandArray = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deviceName,deviceValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(devicechanged) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (deviceName==<span class="hljs-string"><span class="hljs-string">'HVAC-Temp'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">tonumber</span></span>(deviceValue) &lt; <span class="hljs-built_in"><span class="hljs-built_in">tonumber</span></span>(otherdevices_temperature[<span class="hljs-string"><span class="hljs-string">''</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> commandArray[<span class="hljs-string"><span class="hljs-string">'HVAC-Mode'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Set Level: 10'</span></span> <span class="hljs-comment"><span class="hljs-comment">--"Cool" else commandArray['HVAC-Mode'] = 'Set Level: 20' --"Heat" end commandArray['HVAC'] = "On" end end return commandArray</span></span></code> </pre> <br>  Dieses Skript vergleicht die eingestellte Temperatur der Klimaanlage und die Temperatur des Raumsensors, um den richtigen Modus auszuwählen - „Kühlen“ oder „Heizen“. <br><br>  HVACpower: <br><br><pre> <code class="lua hljs">commandArray = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deviceName,deviceValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(devicechanged) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (deviceName == <span class="hljs-string"><span class="hljs-string">'HVAC'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> deviceValue == <span class="hljs-string"><span class="hljs-string">"Off"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">'  '</span></span>) commandArray[<span class="hljs-string"><span class="hljs-string">'HVAC-Mode'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Set Level: 0'</span></span> <span class="hljs-comment"><span class="hljs-comment">--"Off" else if (tonumber(otherdevices['HVAC-Temp']) &lt; tonumber(otherdevices_temperature[''])) then commandArray['HVAC-Mode'] = 'Set Level: 10' --"Cool" else commandArray['HVAC-Mode'] = 'Set Level: 20' --"Heat" end end end end return commandArray</span></span></code> </pre> <br>  Dieses Skript überwacht den Status des „allgemeinen“ Schalters der Klimaanlage und wählt den gewünschten Betriebsmodus beim Ein- und Ausschalten der Klimaanlage. <br><br>  Und das letzte HVACmain-Skript: <br><br><pre> <code class="lua hljs">commandArray = {} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> cmnd <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deviceName,deviceValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(devicechanged) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (deviceName==<span class="hljs-string"><span class="hljs-string">'HVAC-Mode'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> deviceName==<span class="hljs-string"><span class="hljs-string">'HVAC-FanSpeed'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> deviceName==<span class="hljs-string"><span class="hljs-string">'HVAC-Temp'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherdevices[<span class="hljs-string"><span class="hljs-string">'HVAC-Mode'</span></span>]==<span class="hljs-string"><span class="hljs-string">'Off'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cmnd = <span class="hljs-string"><span class="hljs-string">'http://10.40.20.254/cm?cmnd=IRhvac{"Protocol":"COOLIX","Power":"Off"}'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cmnd = <span class="hljs-string"><span class="hljs-string">'http://10.40.20.254/cm?cmnd=IRhvac{"Protocol":"COOLIX","Power":"On","Mode":"'</span></span>..otherdevices[<span class="hljs-string"><span class="hljs-string">'HVAC-Mode'</span></span>]..<span class="hljs-string"><span class="hljs-string">'","FanSpeed":"'</span></span>..otherdevices[<span class="hljs-string"><span class="hljs-string">'HVAC-FanSpeed'</span></span>]..<span class="hljs-string"><span class="hljs-string">'","Temp":'</span></span>..otherdevices[<span class="hljs-string"><span class="hljs-string">'HVAC-Temp'</span></span>]..<span class="hljs-string"><span class="hljs-string">'}'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(cmnd) <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">execute</span></span>(<span class="hljs-string"><span class="hljs-string">"wget '"</span></span>..cmnd..<span class="hljs-string"><span class="hljs-string">"'"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> commandArray</code> </pre> <br>  Aber dieses Skript ist das wichtigste.  Es generiert die richtigen Befehle mit den erforderlichen Parametern und implementiert eine GET-Anforderung an das Gateway.  Vergessen Sie nicht, die IP-Adresse Ihres Gateways darin festzulegen. <br><br>  Das ist eigentlich alles.  Sie können die Domoticz-Oberfläche auf die entsprechenden Registerkarten umschalten und Tasten drücken, um die Klimaanlage zu steuern.  Wenn alles richtig gemacht ist, wird die Klimaanlage nach Bedarf gesteuert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5r/g0/yn/5rg0yn1zdupf6esyisywno0xck0.png" width="600"></div><br><h4>  Eigenschaften </h4><br>  Diese Option über ein IR-Gateway hat einen Nachteil - das Fehlen von Feedback.  Das heißt,  Wenn jemand eine Standardfernbedienung verwendet, ändern sich die Status in Domoticz nicht und es werden Informationen angezeigt, die nicht mehr relevant sind. <br><br>  Im Allgemeinen stört dies nicht wirklich (insbesondere wenn Sie nicht die IR-Fernbedienung verwenden, sondern nur die Funktionen des UD verwenden). <br><br>  Sie können natürlich mit dem IR-Gateway überwachen, welche Befehle über IR gesendet werden (das Gateway überträgt diese Informationen über MQTT) und etwas mehr programmieren, sodass auch bei Verwendung der Standardfernbedienung die aktuellen Status und Parameter im DD-System eingestellt werden. <br><br>  Aber obwohl ich keine Zeit dafür habe und auch keinen besonderen Bedarf habe (es ist einfacher, in das Videoüberwachungssystem zu schauen und zu sehen, ob die Klimaanlage eingeschaltet ist). <br><br><h2>  Und weiter? </h2><br>  Natürlich hören wir hier nicht auf. <br><br>  Zumindest ist die aktuelle Management-Implementierung bereits viel funktionaler als die Option „für die Kleinsten“. <br><br>  Nachdem ich die Klimaanlage in Domoticz „weitergeleitet“ hatte, übernahm ich auch die Kontrolle mit Siri: <br><br><img src="https://habrastorage.org/webt/xb/ks/rh/xbksrht6x7oixacm704aq57tixs.png" align="left" width="350">  Nachdem die Möglichkeit bestand, das UD-System (und insbesondere die Sprache über Siri) zu steuern, verschwand die Notwendigkeit, eine Standard-IR-Fernbedienung zu verwenden. <br><br>  In naher Zukunft werden wir ein "Winter" -Skript schreiben, das in Abwesenheit der Eigentümer und bei einer Temperatur "außerhalb" von mindestens -10 die Ressourcen der Klimaanlage zum Heizen des Hauses nutzt (es ist in diesem Modus energieeffizienter als elektrisch beheizte Böden, aber weniger komfortabel) Wenn die Eigentümer zurückkehren, wechseln sie wieder zur Fußbodenheizung. <br><br>  Natürlich wird es ein "Sommer" -Skript geben, das automatisch den Kühlmodus einschaltet und die eingestellte Temperatur des Hauses beibehält. <br><br>  Natürlich sind alle möglichen Anwendungsfälle nur durch Vorstellungskraft begrenzt.  Nicht zurückhalten;) <br><br><h2>  Teil III? </h2><br>  Das angekündigte WiFi-Modul zur Steuerung der Klimaanlage ist derzeit nicht im Handel erhältlich. <br><br>  Wenn es Zeit gibt (lange Winterabende), werde ich mich dem Schnittstellenmodul der Klimaanlage anders nähern und trotzdem versuchen, die internen Klimaanlagenbefehle zu "fangen". <br><br>  Also ... bleibt dran! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473680/">https://habr.com/ru/post/de473680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473668/index.html">Warum Bitrix - Bitrix</a></li>
<li><a href="../de473670/index.html">Stoloto: Wie man ein Handy in die Lotterie einführt</a></li>
<li><a href="../de473672/index.html">Warum, Bitrix? Oder die Feenwelt 1C</a></li>
<li><a href="../de473676/index.html">Die Backport-Sicherheitsanfälligkeit in RouterOS gefährdet Hunderttausende von Geräten</a></li>
<li><a href="../de473678/index.html">System zum Empfangen einer Speicherkopie auf Geräten mit Android über drahtlose Kanäle</a></li>
<li><a href="../de473684/index.html">Vom Tulpenwahn zum elektronischen Handel: Welche Optionen gibt es und wie Anleger sie heute nutzen?</a></li>
<li><a href="../de473692/index.html">Ennoble Phicomm K3C Wi-Fi Router</a></li>
<li><a href="../de473694/index.html">Russland ist ein globales CAD-Entwicklungszentrum. Wussten Sie davon?</a></li>
<li><a href="../de473702/index.html">Was ist Splitter in der Terahash-Blockchain?</a></li>
<li><a href="../de473704/index.html">Bro vs. nicht bro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>