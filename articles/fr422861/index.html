<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚ÄçüöÄ ü§¶ ‚ú°Ô∏è √Ä propos de la construction de JDK 8 sur Ubuntu, la qualit√© du code Hotspot et pourquoi tout √©choue en C ++ üë¥üèº üí† ü§πüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je voulais dormir aujourd'hui, mais j'ai encore √©chou√©. Un message est apparu dans le Telegram que quelqu'un n'allait pas √† Java ... et nous ne nous s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√Ä propos de la construction de JDK 8 sur Ubuntu, la qualit√© du code Hotspot et pourquoi tout √©choue en C ++</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/422861/"><p>  Je voulais dormir aujourd'hui, mais j'ai encore √©chou√©.  Un message est apparu dans le Telegram que quelqu'un n'allait pas √† Java ... et nous ne nous sommes r√©veill√©s qu'apr√®s quelques heures, fatigu√©s et heureux. </p><br><img src="https://habrastorage.org/webt/ti/ov/lf/tiovlf2wctfucdlsql2-avqmkwe.png"><br><br>  Qui peut utiliser ce message?  Oui, probablement, √† n'importe qui, sauf √† ceux qui collectionnent √©galement JDK8 ou qui aiment tout simplement lire les horreurs des cauchemars.  En g√©n√©ral, je vous ai pr√©venu, fermez l'article d'urgence. <br><p>  Trois probl√®mes: </p><br><ul><li>  Ne va pas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">niveau un</a> ) <br>  Une partie tr√®s ennuyeuse √† sauter.  Seulement n√©cessaire pour ceux qui veulent restaurer compl√®tement l'histoire des √©v√©nements; </li><li>  Ne va pas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">niveau deux</a> ) <br>  C'est plus int√©ressant car il y a quelques erreurs typiques, la n√©cromancie, la n√©crophilie, que BSD est meilleur que GNU / Linux et pourquoi cela vaut la peine de passer √† de nouvelles versions de JDK. </li><li>  M√™me si √ßa va <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tomber</a> <br>  Plus int√©ressant.  Yahuuu, la JVM est tomb√©e dans la cro√ªte, allons-y! </li></ul><br><p>  Sous le chat montre une solution d√©taill√©e aux probl√®mes, avec diff√©rentes pens√©es secondaires sur la vie. </p><br><p>  Il y aura beaucoup de C ++, il n'y aura pas de code Java du tout.  Tout javist √† la fin commence √† √©crire uniquement en C ++ ... </p><a name="habracut"></a><br><h1 id="ne-sobiraetsya">  Ne va pas </h1><br><p>  Celui qui a construit Java au moins une fois sait que cela ressemble √† ceci: </p><br><pre><code class="bash hljs">hg <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://hg.openjdk.java.net/jdk8u/jdk8u <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jdk8u sh ./get_source.sh sh ./configure \ --with-debug-level=fastdebug \ --with-target-bits=64 \ --with-native-debug-symbols=internal \ --with-boot-jdk=/home/me/opt/jdk1.8.0_161 make images</code> </pre> <br><p>  (Tous mes utilisateurs sont simplement appel√©s ¬´moi¬ª, afin que vous puissiez donner la machine virtuelle √† n'importe qui √† tout moment et ne pas cr√©er de refus en utilisant votre propre nom d'utilisateur) </p><br><p>  Le probl√®me, bien s√ªr, est que cela ne fonctionne pas.  Et d'une mani√®re plut√¥t cynique. </p><br><a name="one"></a><br><h2 id="pervyy-uroven-pogruzheniya">  Premier niveau de plong√©e </h2><br><p>  Essayons d'ex√©cuter: </p><br><pre> <code class="bash hljs">/home/me/git/jdk8u/hotspot/src/os/linux/vm/os_linux.inline.hpp:127:18: warning: <span class="hljs-string"><span class="hljs-string">'int readdir_r(DIR*, dirent*, dirent**)'</span></span> is deprecated [-Wdeprecated-declarations] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((status = ::readdir_r(dirp, dbuf, &amp;p)) != 0) { ^~~~~~~~~</code> </pre> <br><p>  Tout d'abord, pour que vous compreniez, j'ai install√© ceci: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> g++ -<span class="hljs-literal"><span class="hljs-literal">-version</span></span> g++ (Ubuntu <span class="hljs-number"><span class="hljs-number">7.3</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-literal"><span class="hljs-literal">-16ubuntu3</span></span>) <span class="hljs-number"><span class="hljs-number">7.3</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> Copyright (C) <span class="hljs-number"><span class="hljs-number">2017</span></span> Free Software Foundation, Inc.</code> </pre> <br><p>  Le compilateur n'est pas la premi√®re fra√Æcheur, pas la 8.2, mais celle-ci devrait √©galement fonctionner. </p><br><p>  Les d√©veloppeurs C ++ aiment tester les logiciels uniquement sur la version du compilateur qu'ils ont install√©e.  Habituellement, le d√©sir de tester sur diff√©rentes plates-formes se termine quelque part dans la r√©gion de la diff√©rence entre gcc et clang dans un sens g√©n√©ral.  Par cons√©quent, il est tout √† fait normal d'ex√©cuter d'abord <code>-Werror</code> ("traiter les avertissements comme des erreurs"), puis d'√©crire du code qui, dans toutes les autres versions, sera consid√©r√© comme des vorings. </p><br><p>  Il s'agit d'un probl√®me connu, et il est clair comment le r√©soudre.  Vous devez d√©finir votre variable d'environnement CXX_FLAGS, dans laquelle d√©finir le niveau d'erreur correct. </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CXX_FLAGS=-Wno-error=deprecated-declarations -Wno-error-deprecated-declarations</code> </pre> <br><p>  Et puis nous voyons le merveilleux: </p><br><pre> <code class="hljs powershell">Ignoring CXXFLAGS found <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> environment. Use -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-extra</span></span><span class="hljs-literal"><span class="hljs-literal">-cxxflags</span></span></code> </pre> <br><p>  Ok, construisez le syst√®me, tout ce que vous voulez!  Nous rempla√ßons configure par celui-ci: </p><br><pre> <code class="bash hljs">hg <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://hg.openjdk.java.net/jdk8u/jdk8u <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jdk8u sh ./configure \ --with-extra-cflags=<span class="hljs-string"><span class="hljs-string">'-Wno-cpp -Wno-error=deprecated-declarations'</span></span> \ --with-extra-cxxflags=<span class="hljs-string"><span class="hljs-string">'-Wno-cpp -Wno-error=deprecated-declarations'</span></span> \ --with-debug-level=fastdebug \ --with-target-bits=64 \ --with-native-debug-symbols=internal \ --with-boot-jdk=/home/me/opt/jdk1.8.0_161 make images</code> </pre> <br><p>  Et l'erreur reste la m√™me! <br>  On passe √† l'artillerie lourde: le code source. </p><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -rl <span class="hljs-string"><span class="hljs-string">"Werror"</span></span> .</code> </pre> <br><p>  Une √©norme quantit√© de chapeau g√©n√©r√© automatiquement tombe, parmi lesquels il y a des aper√ßus de fichiers significatifs: </p><br><pre> <code class="hljs go">./common/autoconf/flags.m4 ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/bsd/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/solaris/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/aix/makefiles/xlc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span></code> </pre> <br><p>  Dans <code>flags.m4</code> nous trouvons facilement le message pr√©c√©dent sur ¬´Ignorer CXXFLAGS¬ª et le drapeau cod√© en dur plus inv√©t√©r√© <code>CCXX_FLGS</code> (oui, deux lettres C), qui agit imm√©diatement au lieu de <code>CFLAGS</code> et au lieu de <code>XX_FLAGS</code> .  Id√©alement!  Deux faits sont int√©ressants: </p><br><ul><li>  Cet indicateur n'est pas transmis via les param√®tres de configuration; </li><li>  Dans la valeur par d√©faut sont significatifs et √©trangement similaires √† ces param√®tres: </li></ul><br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># Setup compiler/platform specific flags to CFLAGS_JDK, # CXXFLAGS_JDK and CCXXFLAGS_JDK (common to C and CXX?) if test "x$TOOLCHAIN_TYPE" = xgcc; then # these options are used for both C and C++ compiles CCXXFLAGS_JDK="$CCXXFLAGS $CCXXFLAGS_JDK -Wall -Wno-parentheses -Wextra -Wno-unused -Wno-unused-parameter -Wformat=2 \ -pipe -D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE"</span></span></code> </pre> <br><p>  Cette question semble tr√®s agr√©able dans les commentaires - mais quoi, les drapeaux sont-ils communs?  Non? </p><br><p>  Nous ne jouerons pas la d√©mocratie et nous y <code>-w</code> autoritaire ("ne montrez aucune erreur"): </p><br><pre> <code class="bash hljs"> CCXXFLAGS_JDK=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CCXXFLAGS</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CCXXFLAGS_JDK</span></span></span><span class="hljs-string"> -w -ffreestanding -fno-builtin -Wno-parentheses -Wno-unused -Wno-unused-parameter -Wformat=2 \</span></span></code> </pre> <br><p>  Et - bravo!  - la premi√®re erreur que nous avons travers√©e.  Elle ne fait plus de rapport, et en g√©n√©ral tout va bien.  Il semblerait. </p><br><a name="two"></a><br><h2 id="vtoroy-uroven-pogruzheniya">  Deuxi√®me niveau de plong√©e </h2><br><p>  Mais maintenant, il tombe dans une pile d'autres nouveaux endroits! </p><br><p>  Il s'av√®re que notre <code>-w</code> fonctionne, mais n'est pas transmis √† toutes les parties de l'assemblage.  Nous lisons attentivement les makefiles et ne comprenons pas du tout comment ce param√®tre peut √™tre transmis.  Vous l'avez vraiment oubli√©? </p><br><p>  Connaissant la bonne question de Google (¬´pourquoi cxx n'atteint-il pas la version?!¬ª), Nous arrivons rapidement √† la page de bogue avec le dicton <strong>¬´configurer --with-extra-cxxflags n'affecte pas le hotspot¬ª</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK-8156967</a> ). </p><br><p>  Qui promet d'√™tre corrig√© dans JDK 12. Peut-√™tre.  Magnifique - le param√®tre de construction le plus important n'est pas utilis√© dans l'assemblage! </p><br><p>  La premi√®re id√©e est, eh bien, remontons nos manches et corrigeons les erreurs! </p><br><h2 id="oshibka-1-xn12">  Erreur 1.xn [12] </h2><br><pre> <code class="hljs powershell">dependencies.cpp: <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dependencies</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_dependency_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xmlStream*, Dependencies::DepType, GrowableArray&lt;Dependencies::DepArgument&gt;*, Klass*)</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dependencies</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpp</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">498</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">6</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-function">: '%</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">directive</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writing</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">between</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">1</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">10</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bytes</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">into</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">region</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">9</span></span></span><span class="hljs-function"> [-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Werror</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format-overflow</span></span></span><span class="hljs-function">=] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dependencies</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_dependency_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xmlStream* xtty, ^~~~~~~~~~~~ dependencies.cpp:498:6: note: directive argument in the range [0, 2147483647]</span></span></span></span></code> </pre> <br><p>  Eh bien, nous devons probablement agrandir la r√©gion.  Cent livres, quelqu'un a calcul√© le tampon en cliquant sur le "I'm Lucky!"  dans google. </p><br><p>  Mais comment comprendriez-vous combien vous avez besoin?  Il y a un autre type de raffinement ci-dessous: </p><br><pre> <code class="hljs pgsql">stdio2.h:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>: note: <span class="hljs-string"><span class="hljs-string">'__builtin___sprintf_chk'</span></span> output <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> bytes <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> a destination <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> size <span class="hljs-number"><span class="hljs-number">10</span></span> __bos (__s), __fmt, __va_arg_pack ());</code> </pre> <br><p>  La position 12 ressemble √† quelque chose de valable, avec laquelle vous pouvez maintenant p√©n√©trer dans la source avec les pieds sales. </p><br><p>  Nous montons dans <code>dependencies.cpp</code> et observons l'image suivante: </p><br><pre> <code class="cpp hljs">DepArgument arg = args-&gt;at(j); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.is_oop()) { xtty-&gt;object(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, arg.oop_value()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xtty-&gt;object(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, arg.metadata_value()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> xn[<span class="hljs-number"><span class="hljs-number">10</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(xn, <span class="hljs-string"><span class="hljs-string">"x%d"</span></span>, j); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.is_oop()) { xtty-&gt;object(xn, arg.oop_value()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xtty-&gt;object(xn, arg.metadata_value()); } }</code> </pre> <br><p>  Faites attention √† la ligne probl√©matique: </p><br><pre> <code class="hljs perl">char xn[<span class="hljs-number"><span class="hljs-number">10</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">sprintf</span></span>(xn, <span class="hljs-string"><span class="hljs-string">"x%d"</span></span>, j);</code> </pre> <br><p>  Nous changeons 10 √† 12, remontons et ... le montage est parti! </p><br><p>  Mais suis-je le seul √† √™tre aussi intelligent et √† corriger le bug de tous les temps?  Pas de doute, nous conduisons √† nouveau notre m√©gapatch dans Google: <code>char xn[12];</code> </p><br><p>  Et nous voyons ... oui, c'est vrai.  Le bogue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK-8184309</a> , interdit par Vladimir Ivanov, contient exactement le m√™me correctif. </p><br><p>  Mais l'essentiel est qu'il n'est corrig√© que dans JDK 10 et que nifiga n'est pas r√©troport√© sur jdk8u.  C'est la question de savoir pourquoi de nouvelles versions de Java sont n√©cessaires. </p><br><h2 id="oshibka-2-strcmp">  Erreur 2. strcmp </h2><br><pre> <code class="hljs powershell">fprofiler.cpp: <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> member <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThreadProfiler</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TickPosition)</span></span></span><span class="hljs-function">': /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">home</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">me</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">git</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jdk8ut</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hotspot</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">share</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtime</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fprofiler</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpp</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">638</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">56</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">argument</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">1</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">null</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">where</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">non-null</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expected</span></span></span><span class="hljs-function"> [-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Werror</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonnull</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const char* name)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strcmp(name, _name) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Enseign√© par une exp√©rience am√®re pr√©c√©dente, nous allons imm√©diatement voir ce qui se trouve dans cet endroit dans JDK 11. Et ... ce fichier n'est pas l√†.  La structure du r√©pertoire a √©galement subi une refactorisation. </p><br><p>  Mais vous ne pouvez pas simplement vous √©loigner de nous! </p><br><p>  Tout javiste est un petit n√©cromancien dans son √¢me, et peut-√™tre m√™me un n√©crophile.  Par cons√©quent, il y aura maintenant NECROMANCE EN ACTION! </p><br><p>  Vous devez d'abord faire appel √† l'√¢me des morts et savoir quand il est mort: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> hg log -<span class="hljs-literal"><span class="hljs-literal">-template</span></span> <span class="hljs-string"><span class="hljs-string">"File(s) deleted in rev {rev}: {file_dels % '\n {file}'}\n\n"</span></span> <span class="hljs-literal"><span class="hljs-literal">-r</span></span> <span class="hljs-string"><span class="hljs-string">'removes("**/fprofiler.cpp")'</span></span> File(s) deleted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rev <span class="hljs-number"><span class="hljs-number">47106</span></span>: hotspot/src/share/vm/runtime/fprofiler.cpp hotspot/src/share/vm/runtime/fprofiler.hpp hotspot/test/runtime/MinimalVM/Xprof.java</code> </pre> <br><p>  Vous devez maintenant d√©couvrir la cause de sa mort: </p><br><pre> <code class="hljs pgsql">hg <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> -r <span class="hljs-number"><span class="hljs-number">47106</span></span> changeset: <span class="hljs-number"><span class="hljs-number">47106</span></span>:bed18a111b90 parent: <span class="hljs-number"><span class="hljs-number">47104</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>bdc0c9c44af <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>: gziemski <span class="hljs-type"><span class="hljs-type">date</span></span>: Thu Aug <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">-0500</span></span> <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>: <span class="hljs-number"><span class="hljs-number">8173715</span></span>: Remove FlatProfiler</code> </pre><br><p>  Donc, nous avons un tueur: <strong>gziemski</strong> .  Voyons pourquoi il a clou√© ce dossier malheureux. </p><br><p>  Pour ce faire, acc√©dez √† fat dans le ticket sp√©cifi√© dans le r√©sum√© du commit.  C'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK-8173715</a> : </p><br><p>  Supprimer FlatProfiler: <br>  Nous supposons que cette technologie n'est plus utilis√©e et est une source d'analyse racine pour le GC. </p><br><p>  Pour shih bis.  En fait, nous sommes maintenant invit√©s √† r√©parer le cadavre juste pour que la construction continue.  Ce qui s'est tellement d√©compos√© que m√™me nos coll√®gues n√©cromanciens d'OpenJDK l'ont abandonn√©. </p><br><p>  Ressuscitons le mort et essayons de lui demander ce dont il s'est souvenu en dernier.  Il √©tait d√©j√† mort dans la r√©vision 47106, ce qui signifie qu'il y en a une de moins dans la r√©vision - c'est ¬´une seconde avant¬ª: </p><br><pre> <code class="bash hljs">hg cat <span class="hljs-string"><span class="hljs-string">"~/git/jdk11/hotspot/src/share/vm/runtime/fprofiler.cpp"</span></span> -r 47105 &gt; ~/tmp/fprofiler_new.cpp cp ~/git/jdk8u/hotspot/src/share/vm/runtime/fprofiler.cpp ~/tmp/fprofiler_old.cpp <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/tmp diff fprofiler_old.cpp fprofiler_new.cpp</code> </pre> <br><p>  Malheureusement, rien du tout concernant <code>return strcmp(name, _name) == 0;</code>  dans diff no.  Le patient est d√©c√©d√© des suites d'un coup avec un objet tranchant √©mouss√© (utilit√© rm), mais au moment de sa mort, il √©tait d√©j√† en phase terminale. </p><br><p>  Explorons l'essence de l'erreur. </p><br><p>  Voici ce que l'auteur du code aimerait nous dire: </p><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_compiled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* name)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(name, _name) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Maintenant un peu de philosophie. </p><br><p>  La norme C11 dans la clause 7.1.4, ¬´Utilisation des fonctions de biblioth√®que¬ª, dit explicitement: </p><br><blockquote>  Chacune des instructions suivantes s'applique, sauf indication contraire explicite dans les descriptions d√©taill√©es qui suivent: Si un argument d'une fonction a une valeur non valide (comme [...] un pointeur nul [...]) [...], le comportement n'est pas d√©fini. </blockquote><p>  C'est-√†-dire que maintenant toute la question est de savoir s'il y en a <em>¬´explicitement indiqu√© autrement¬ª</em> .  Rien de tel n'est √©crit dans la description de <code>strcmp</code> dans la section 7.24.4, et je n'ai pas d'autres sections pour vous. </p><br><p>  Autrement dit, nous avons un comportement ind√©fini ici. </p><br><p>  Bien s√ªr, vous pouvez prendre et r√©√©crire ce morceau de code en l'entourant de v√©rification.  Mais je ne suis absolument pas s√ªr de bien comprendre la logique des gens qui utilisent UB l√† o√π il ne devrait pas √™tre.  Par exemple, certains syst√®mes g√©n√®rent SIGSERV pour z√©ro d√©r√©f√©rencement, et un amateur de hack peut en profiter, mais ce comportement n'est pas obligatoire et peut d√©marrer sur une autre plate-forme. </p><br><p>  Oui, bien s√ªr, quelqu'un dira que vous √™tes un imb√©cile pour vous-m√™me, que vous utilisez GCC 7.3, mais dans GCC 4 tout se serait rassembl√©.  Mais comportement ind√©fini! = Non sp√©cifi√©! = Impl√©mentation d√©finie.  Cela pour les deux derniers peut √™tre d√©fini pour fonctionner dans l'ancien compilateur.  Et UB dans la sixi√®me version √©tait UB. </p><br><p>  En bref, j'ai √©t√© compl√®tement attrist√© par cette question philosophique complexe (devrais-je entrer dans le code avec mes hypoth√®ses) quand j'ai soudainement r√©alis√© qu'elle pouvait √™tre diff√©rente. </p><br><h1 id="est-drugoy-put">  Il y a une autre fa√ßon </h1><br><p>  Comme vous le savez, les bons h√©ros font toujours le tour. </p><br><p>  M√™me si nous ignorons notre philosophie de l'UB, il y a l√† une quantit√© incroyable de probl√®mes.  Pas le fait qu'ils peuvent √™tre r√©par√©s jusqu'au matin.  Pas le fait que je ne peux pas le faire avec mes mains tordues.  Encore moins est le fait que cela sera accept√© en amont: le dernier patch de jdk8u √©tait il y a 6 semaines, et c'√©tait la fusion globale de la nouvelle balise. </p><br><p>  Imaginez simplement que le code ci-dessus est r√©ellement √©crit correctement.  Tout ce qui se trouve entre nous et son ex√©cution est un avertissement, qui a √©t√© per√ßu comme une erreur en raison d'un bogue dans le syst√®me de construction.  Mais nous pouvons construire un syst√®me de construction. </p><br><p>  Le sorceleur Geralt de Rivia a dit un jour: </p><br><blockquote>  ¬´Le mal est mal, Stregobor¬ª, dit gravement le sorceleur en se levant.  - Plus petit, plus grand, moyen - tout est pareil, les proportions sont arbitraires et les fronti√®res sont floues.  Je ne suis pas un saint ermite, non seulement j'ai fait un bien dans ma vie.  Mais si vous devez choisir entre un mal et un autre, je pr√©f√®re ne pas choisir du tout. <br><br>  - Z≈Ço √† z≈Ço, Stregoborze - rzek≈Ç powa≈ºnie wied≈∫min wstajƒÖc.  - Mniejsze, wiƒôksze, ≈õrednie, wszystko jedno, proporcje sƒÖ umowne a granice zatarte.  Nie jestem ≈õwiƒÖtobliwym pustelnikiem, nie samo dobro czyni≈Çem w ≈ºyciu.  Ale je≈ºeli mam wybieraƒá pomiƒôdzy jednym z≈Çem a drugim, √† wolƒô nie wybieraƒá wcale. </blockquote><p>  Ceci est une citation de The Last Wish, une histoire appel√©e Lesser Evil.  Nous savons tous que Geralt n'a presque jamais pu jouer le r√¥le d'un personnage vraiment neutre, et est m√™me mort en raison d'un autre comportement de type chaotique classique. </p><br><p>  Faisons donc une d√©monstration rapide du moindre mal.  Passons au syst√®me de construction. </p><br><p>  Au tout d√©but, nous avons d√©j√† vu cet √©chappement: </p><br><pre> <code class="hljs go">grep -rl <span class="hljs-string"><span class="hljs-string">"Werror"</span></span> . ./common/autoconf/flags.m4 ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/linux/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/bsd/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/solaris/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/aix/makefiles/xlc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span></code> </pre> <br><p>  En comparant ces deux fichiers, j'ai rompu tout le visage avec le facespalm et r√©alis√© la diff√©rence de culture des deux plateformes: </p><br><p>  BSD est une histoire de libert√© et de choix: </p><br><pre> <code class="hljs lisp"># Compiler warnings are treated as errors ifneq ($(<span class="hljs-name"><span class="hljs-name">COMPILER_WARNINGS_FATAL</span></span>),false) WARNINGS_ARE_ERRORS = -Werror endif</code> </pre> <br><p>  GNU / Linux est un r√©gime puriste autoritaire: </p><br><pre> <code class="hljs sql"><span class="hljs-comment"><span class="hljs-comment"># Compiler warnings are treated as errors WARNINGS_ARE_ERRORS = -Werror</span></span></code> </pre> <br><p>  Eh bien, elle serait transmise √† linux via <code>XX_FLAGS</code> , cette variable n'est pas prise en compte lors du calcul de <code>WARNINGS_ARE_ERRORS</code> !  Dans la version pour GNU / Linux, nous n'avons tout simplement pas d'autre choix que de suivre les valeurs par d√©faut qui ont √©t√© lanc√©es d'en haut. </p><br><p>  Eh bien, ou vous pouvez le rendre plus facile et changer la valeur de <code>WARNINGS_ARE_ERRORS</code> en un <code>-w</code> court, mais non moins puissant.  √áa vous pla√Æt, Elon Musk? </p><br><p>  Comme vous l'avez peut-√™tre devin√©, cela r√©sout compl√®tement ce probl√®me de construction. </p><br><p>  Lorsque le code est assembl√©, vous voyez un tas de probl√®mes √©tranges et terriblement volants.  Parfois, cela arrivait si effrayant que je voulais vraiment appuyer sur ctrl + C et essayer de le comprendre.  Mais non, vous ne pouvez pas, vous ne pouvez pas ... </p><br><p>  Il semble que tout s'est rassembl√© et n'a pas pos√© de probl√®mes suppl√©mentaires.  Bien s√ªr, je n'ai pas os√© commencer les tests.  Pourtant, la nuit, mes yeux commencent √† se coller et, d'une mani√®re ou d'une autre, je ne veux pas aller au dernier recours - quatre canettes d'√©nergie du r√©frig√©rateur. </p><br><a name="three"></a><br><h1 id="padaet-v-korku">  Tombe dans la cro√ªte </h1><br><p>  L'assemblage est pass√©, les ex√©cutables ont √©t√© g√©n√©r√©s, nous sommes super. </p><br><p>  Et donc nous sommes arriv√©s √† la ligne d'arriv√©e.  Ou n'est pas venu? </p><br><p>  Notre montage se d√©roule de la mani√®re suivante: </p><br><pre> <code class="hljs powershell">export JAVA_HOME=~/git/jdk8u/build/linux<span class="hljs-literal"><span class="hljs-literal">-x86_64</span></span><span class="hljs-literal"><span class="hljs-literal">-normal</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span>/jdk export PATH=<span class="hljs-variable"><span class="hljs-variable">$JAVA_HOME</span></span>/bin:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span></code> </pre> <br><p>  Lorsque vous essayez d'ex√©cuter l'ex√©cutable <code>java</code> , il se bloque instantan√©ment.  Pour ceux qui ne sont pas familiers - cela ressemble √† ceci: </p><br><p><img src="https://habrastorage.org/webt/n2/3p/ep/n23pepls-unfomopiqb1zgkx5eq.png"><br></p><br><p>  En m√™me temps, Alex a Debian 9.5 et j'ai Ubuntu.  Deux versions diff√©rentes de GCC, deux cro√ªtes d'aspect diff√©rent.  J'ai des farces innocentes avec le patch manuel strcmp et quelques autres endroits, Alex ne le fait pas.  Quel est le probl√®me? </p><br><p>  Cette histoire est digne d'une histoire distincte, mais ici, allons directement aux conclusions s√®ches, sinon je n'ajouterai jamais ce post. </p><br><p>  Le probl√®me est que nos pogromistes C ++ pr√©f√©r√©s ont de nouveau utilis√© un comportement non d√©fini. </p><br><p>  (De plus, l√† o√π cela d√©pend d'une mani√®re inconnue de l'impl√©mentation du compilateur. Cependant, nous devons nous rappeler que UB est toujours UB, m√™me sur une version connue du compilateur, il est impossible de s'y allonger) </p><br><p>  Dans un endroit, nous nous tournons vers le champ d'une classe sous-con√ßue l√†-bas, et tout se casse.  Ne demandez pas comment c'est arriv√©, tout est compliqu√©. </p><br><p>  Il est tr√®s difficile pour un javista d'imaginer comment on peut se tourner vers une classe sous-construite, sauf en √©mettant un lien vers celle-ci directement depuis le constructeur.  Heureusement, le merveilleux langage C ++ peut tout faire ou presque.  Je vais √©crire un exemple avec un certain pseudocode: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span> A() { _b.Show(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> B _b; }; A a; BA::_b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><p>  Bon d√©bogage! </p><br><p>  Si vous regardez C ++ 98 [class.cdtor]: </p><br><blockquote>  Pour un objet de type de classe non-POD ... avant que le constructeur commence l'ex√©cution ... se r√©f√©rer √† un membre non statique ou √† une classe de base de l'objet entra√Æne un comportement ind√©fini </blockquote><p>  √Ä partir de GCC d'une certaine version (et j'en ai 7.3), une optimisation de ¬´l'√©limination du magasin mort √† vie¬ª est apparue, qui croit que nous ne faisons r√©f√©rence √† un objet que pendant sa dur√©e de vie, et tout crache en dehors de la dur√©e de vie. </p><br><p>  La solution consiste √† d√©sactiver les nouvelles optimisations et √† revenir telles qu'elles √©taient dans l'ancien GCC: </p><br><pre> <code class="hljs powershell">CFLAGS += <span class="hljs-literal"><span class="hljs-literal">-fno</span></span><span class="hljs-literal"><span class="hljs-literal">-strict</span></span><span class="hljs-literal"><span class="hljs-literal">-aliasing</span></span> <span class="hljs-literal"><span class="hljs-literal">-fno</span></span><span class="hljs-literal"><span class="hljs-literal">-lifetime</span></span><span class="hljs-literal"><span class="hljs-literal">-dse</span></span> <span class="hljs-literal"><span class="hljs-literal">-fno</span></span><span class="hljs-literal"><span class="hljs-literal">-delete</span></span><span class="hljs-literal"><span class="hljs-literal">-null</span></span><span class="hljs-literal"><span class="hljs-literal">-pointer</span></span><span class="hljs-literal"><span class="hljs-literal">-checks</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Il</a> y a une discussion √† ce sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Pour une raison quelconque, les participants √† la discussion ont d√©cid√© que cela ne serait pas inclus en amont.  Mais vous devez toujours essayer de l'envoyer. </p><br><p>  Ajoutez ces options √† notre <code>./hotspot/make/linux/makefiles/gcc.make</code> , r√©assemblez tout et voyez les lignes ch√®res: </p><br><pre> <code class="hljs powershell">t<span class="hljs-variable"><span class="hljs-variable">$</span></span> ~/git/jdk8u/build/linux<span class="hljs-literal"><span class="hljs-literal">-x86_64</span></span><span class="hljs-literal"><span class="hljs-literal">-normal</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span>/jdk/bin/java <span class="hljs-literal"><span class="hljs-literal">-version</span></span> openjdk version <span class="hljs-string"><span class="hljs-string">"1.8.0-internal-fastdebug"</span></span> OpenJDK Runtime Environment (build <span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-literal"><span class="hljs-literal">-internal</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span><span class="hljs-literal"><span class="hljs-literal">-me_2018_09_10_08_14</span></span><span class="hljs-literal"><span class="hljs-literal">-b00</span></span>) OpenJDK <span class="hljs-number"><span class="hljs-number">64</span></span><span class="hljs-literal"><span class="hljs-literal">-Bit</span></span> Server VM (build <span class="hljs-number"><span class="hljs-number">25.71</span></span><span class="hljs-literal"><span class="hljs-literal">-b00</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span>, mixed mode)</code> </pre> <br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Vous pensiez probablement que la conclusion serait: "Java est une sorte d'enfer, il y a des ordures dans le code, il n'y a pas de support, tout est mauvais." </p><br><p>  Ce n'est pas le cas!  Au contraire, les exemples ci-dessus montrent de quel terrible mal nos amis, les n√©cromanciens d'OpenJDK, nous emp√™chent. </p><br><p>  Et malgr√© le fait qu'ils doivent vivre et utiliser C ++, trembler avec chaque UB et changer la version du compilateur et apprendre les subtilit√©s des plates-formes, le code utilisateur final en Java est incroyablement stable, et sur les versions publi√©es sur les sites Web officiels de soci√©t√©s telles que Azul, Red Hat et Oracle peuvent difficilement se heurter √† la cro√ªte dans un cas simple. </p><br><p>  La seule chose triste est, tr√®s probablement, que les erreurs trouv√©es sont peu susceptibles d'√™tre accept√©es dans jdk8u.  Nous avons pris JDK 8 simplement parce qu'il est plus facile pour nous de le patcher ici et maintenant, et nous devrons faire face √† JDK 11.  N√©anmoins, utiliser JDK 8 en 2018 est √† mon humble avis, c'est une tr√®s mauvaise pratique, et nous ne le faisons pas d'une bonne vie.  Peut-√™tre que notre vie s'am√©liorera √† l'avenir, et vous lirez de nombreuses autres histoires incroyables du monde de JDK 11 et JDK 12. </p><br><p>  Merci pour l'attention port√©e √† un texte aussi ennuyeux sans images :-) </p><br><blockquote>  Minute de publicit√©.  La conf√©rence Joker 2018 se tiendra tr√®s prochainement, o√π il y aura de nombreux sp√©cialistes √©minents de Java et de JVM.  Consultez la liste compl√®te des orateurs et les rapports <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site officiel</a> .  J'y serai aussi, il sera possible de se rencontrer et de broyer pour la vie et OpenJDK. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422861/">https://habr.com/ru/post/fr422861/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422843/index.html">Une introduction au monde des fausses puces: techniques de d√©tection des contrefa√ßons</a></li>
<li><a href="../fr422845/index.html">Comment rendre la t√©l√©vision vraiment intelligente?</a></li>
<li><a href="../fr422851/index.html">Pourquoi l'avenir du stockage de donn√©es reste la bande magn√©tique</a></li>
<li><a href="../fr422857/index.html">Impl√©mentation de votre conteneur IoC</a></li>
<li><a href="../fr422859/index.html">Le minist√®re des Communications a propos√© de passer aux cartes SIM avec cryptage du FSB</a></li>
<li><a href="../fr422863/index.html">Tribus, guildes, build train et no TDD: comment fonctionne le d√©veloppement mobile dans Uber, Spotify, Odnoklassniki et Avito</a></li>
<li><a href="../fr422865/index.html">Java Enterprise Open Lesson "CDI en action"</a></li>
<li><a href="../fr422867/index.html">D√©termination du nombre d'√©tages d'une maison √† partir de sa photo sans apprentissage automatique</a></li>
<li><a href="../fr422869/index.html">Nous ma√Ætrisons de nouveaux langages de programmation, en nous appuyant sur les acquis</a></li>
<li><a href="../fr422871/index.html">Identifier des profils significatifs dans VK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>