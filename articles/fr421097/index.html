<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîå üêÑ üë©üèº‚Äçüé® Composition des UIViewControllers et navigation entre eux (et pas seulement) üìé üö¥üèø üëºüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je veux partager l'exp√©rience que nous utilisons avec succ√®s depuis plusieurs ann√©es dans nos applications iOS, dont 3 sont actuelle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Composition des UIViewControllers et navigation entre eux (et pas seulement)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421097/"><p><img src="https://habrastorage.org/webt/x7/yt/ll/x7ytllwqwgvgxy2rvtmdwj3qkia.png"></p><br><p>  Dans cet article, je veux partager l'exp√©rience que nous utilisons avec succ√®s depuis plusieurs ann√©es dans nos applications iOS, dont 3 sont actuellement dans l'Appstore.  Cette approche a bien fonctionn√© et nous l'avons r√©cemment s√©par√©e du reste du code et l'avons con√ßue dans une biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RouteComposer</a> distincte, qui sera discut√©e en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait</a> . </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/ekazaev/route-composer</a> </p><br><p>  Mais, pour commencer, essayons de comprendre ce que l'on entend par composition des contr√¥leurs de vue dans iOS. </p><br><p> Avant de passer √† l'explication elle-m√™me, je vous rappelle que dans iOS, il est le plus souvent compris comme un contr√¥leur de vue ou <code>UIViewController</code> .  Il s'agit d'une classe h√©rit√©e du standard <code>UIViewController</code> , qui est le contr√¥leur de mod√®le MVC de base qu'Apple recommande d'utiliser pour d√©velopper des applications iOS. </p><br><p>  Vous pouvez utiliser des mod√®les architecturaux alternatifs tels que MVVM, VIP, VIPER, mais en eux l' <code>UIViewController</code> sera impliqu√© d'une mani√®re ou d'une autre, ce qui signifie que cette biblioth√®que peut √™tre utilis√©e avec eux.  L'essence de l' <code>UIViewController</code> utilis√©e pour contr√¥ler l' <code>UIView</code> , qui repr√©sente le plus souvent un √©cran ou une partie importante de l'√©cran, en traite les √©v√©nements et y affiche des donn√©es. </p><br><p><img src="https://habrastorage.org/webt/5v/ia/-3/5via-37-mfc9leww-hwfvcu20eg.png"></p><br><p>  Tous les <code>UIViewController</code> peuvent √™tre conditionnellement divis√©s en <strong>contr√¥leurs de vue normale</strong> , qui sont responsables d'une zone visible sur l'√©cran, et <strong>contr√¥leurs de vue de conteneur</strong> , qui, en plus de s'afficher eux-m√™mes et certains de leurs contr√¥les, peuvent √©galement afficher des contr√¥leurs de vue enfant int√©gr√©s en eux d'une mani√®re ou d'une autre. . </p><br><p>  Les contr√¥leurs de vue de conteneur standard fournis avec Cocoa Touch comprennent: <code>UINavigationConroller</code> , <code>UITabBarController</code> , <code>UISplitController</code> , <code>UIPageController</code> et quelques autres.  De plus, l'utilisateur peut cr√©er ses propres contr√¥leurs de vue de conteneur personnalis√©s en suivant les r√®gles Cocoa Touch d√©crites dans la documentation Apple. </p><br><p>  Le processus d'introduction des contr√¥leurs de vue standard dans les contr√¥leurs de vue de conteneur, ainsi que l'int√©gration des contr√¥leurs de vue dans la pile des contr√¥leurs, nous appellerons la <strong>composition</strong> dans cet article. </p><br><p>  Pourquoi, alors, la solution standard pour la composition des contr√¥leurs de vue s'est av√©r√©e ne pas √™tre optimale pour nous, et nous avons d√©velopp√© une biblioth√®que qui facilite notre travail. </p><br><p>  Jetons un coup d'≈ìil √† la composition de certains contr√¥leurs de vue de conteneur standard √† titre d'exemple: </p><br><h3 id="primery-kompozicii-v-standartnyh-konteynerah">  Exemples de composition dans des conteneurs standard </h3><br><h4 id="uinavigationcontroller"> <code>UINavigationController</code> </h4> <br><p><img src="https://habrastorage.org/webt/zx/fc/su/zxfcsucgp6qusx4kkkfccphmzz0.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tableViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-comment"><span class="hljs-comment">//        let navigationController = UINavigationController(rootViewController: tableViewController) // ... //        let detailViewController = UIViewController(nibName: "DetailViewController", bundle: nil) navigationController.pushViewController(detailViewController, animated: true) // ... //     navigationController.popToRootViewController(animated: true)</span></span></code> </pre> <br><h4 id="uitabbarcontroller"> <code>UITabBarController</code> </h4> <br><p><img src="https://habrastorage.org/webt/vi/2t/bx/vi2tbxjzyl9xs_rhrcpbx9p9lp8.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondViewController = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let tabBarController = UITabBarController() //         tabBarController.viewControllers = [firstViewController, secondViewController] //        tabBarController.selectedViewController = secondViewController</span></span></code> </pre> <br><h4 id="uisplitviewcontroller"> <code>UISplitViewController</code> </h4> <br><p><img src="https://habrastorage.org/webt/gs/jx/ll/gsjxllx4rm_tjpukwtawibmffsg.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondViewController = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let splitViewController = UISplitViewController() //        splitViewController.viewControllers = [firstViewController] //        splitViewController.showDetailViewController(secondViewController, sender: nil)</span></span></code> </pre> <br><h3 id="primery-integracii-kompozicii-vyu-kotrollerov-v-stek">  Exemples d'int√©gration (composition) de contr√¥leurs de vue sur la pile </h3><br><h4 id="ustanovka-vyu-kontrolera-rutom">  Installation de la racine du contr√¥leur de vue </h4><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> window: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> = <span class="hljs-comment"><span class="hljs-comment">//... window.rootViewController = viewController window.makeKeyAndVisible()</span></span></code> </pre> <br><h4 id="modalnaya-prezentaciya-vyu-kontrolera">  Pr√©sentation modale du contr√¥leur de vue </h4><br><pre> <code class="swift hljs">window.rootViewController.present(splitViewController, animated: animated, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><h3 id="pochemu-my-reshili-sozdat-biblioteku-dlya-kompozicii">  Pourquoi nous avons d√©cid√© de cr√©er une biblioth√®que de composition </h3><br><p>  Comme vous pouvez le voir dans les exemples ci-dessus, il n'y a pas de moyen unique d'int√©grer des contr√¥leurs de vue conventionnels dans des conteneurs, tout comme il n'y a pas de moyen unique de cr√©er une pile de contr√¥leurs de vue.  Et, si vous souhaitez modifier l√©g√®rement la disposition de votre application ou la fa√ßon dont vous y naviguez, vous aurez besoin de modifications importantes du code de l'application, vous aurez √©galement besoin de liens vers des objets conteneur afin que vous puissiez y ins√©rer vos contr√¥leurs de vue, etc.  Autrement dit, la m√©thode standard elle-m√™me implique une quantit√© de travail assez importante, ainsi que la pr√©sence de liens vers des contr√¥leurs de vue pour g√©n√©rer des actions et des pr√©sentations d'autres contr√¥leurs. </p><br><p>  Tout cela ajoute un casse-t√™te √† diverses m√©thodes de liaison par dip vers l'application (par exemple, en utilisant des liens universels), car vous devez r√©pondre √† la question: <em>que se passe-t-il si le contr√¥leur doit √™tre montr√© √† l'utilisateur car il a cliqu√© sur le lien dans le safari est d√©j√† affich√©, ou je regarde le contr√¥leur ce qui devrait montrer qu'il n'a pas encore √©t√© cr√©√©</em> , vous obligeant √† parcourir l'arborescence des contr√¥leurs de vue et √† √©crire du code dont parfois vos yeux commencent √† saigner et que tout d√©veloppeur iOS essaie de cacher.  De plus, contrairement √† l'architecture Android o√π chaque √©cran est construit s√©par√©ment, dans iOS, afin d'afficher une partie de l'application imm√©diatement apr√®s le lancement, il peut √™tre n√©cessaire de cr√©er une assez grande pile de contr√¥leurs qui sera masqu√©e sous celle que vous montrez sur demande. </p><br><p>  Il serait <code>goToAccount()</code> appeler des m√©thodes telles que <code>goToAccount()</code> , <code>goToMenu()</code> ou <code>goToProduct(withId: "012345")</code> lorsqu'un utilisateur clique sur un bouton ou lorsqu'une application <code>goToProduct(withId: "012345")</code> lien universel d'une autre application et ne songe pas √† int√©grer ce contr√¥leur de vue dans la pile, sachant que le cr√©ateur de ce contr√¥leur de vue a d√©j√† fourni cette impl√©mentation. </p><br><p>  De plus, souvent, nos applications se composent d'un grand nombre d'√©crans d√©velopp√©s par diff√©rentes √©quipes, et pour acc√©der √† l'un des √©crans pendant le processus de d√©veloppement, vous devez passer par un autre √©cran qui n'a peut-√™tre pas encore √©t√© cr√©√©.  Dans notre entreprise, nous avons utilis√© l'approche que nous appelons la <em>bo√Æte de P√©tri</em> .  Autrement dit, en mode d√©veloppement, le d√©veloppeur et le testeur ont acc√®s √† une liste de tous les √©crans d'application et il peut acc√©der √† chacun d'entre eux (bien s√ªr, certains d'entre eux peuvent n√©cessiter certains param√®tres d'entr√©e). </p><br><p><img src="https://habrastorage.org/webt/5l/wx/cv/5lwxcvup0mtdaedrgjsxokbsdti.png"></p><br><p>  Vous pouvez interagir avec eux et tester individuellement, puis les assembler dans l'application finale pour la production.  Cette approche facilite grandement le d√©veloppement, mais, comme vous l'avez vu dans les exemples ci-dessus, l'enfer de la composition commence lorsque vous devez conserver dans le code plusieurs fa√ßons d'int√©grer le contr√¥leur de vue dans la pile. </p><br><p>  Reste √† ajouter que tout cela sera multipli√© par N d√®s que votre √©quipe marketing exprime le souhait de r√©aliser des tests A / B sur des utilisateurs live et de v√©rifier quelle m√©thode de navigation fonctionne mieux, par exemple, une barre d'onglets ou un menu hamburger? </p><br><ul><li><del>  Coupons les jambes de Susanin </del>  Montrons 50% des utilisateurs de la barre d'onglets, et √† l'autre menu Hamburger, et dans un mois, nous vous dirons quels utilisateurs voient le plus de nos offres sp√©ciales? </li></ul><br><p>  Je vais essayer de vous dire comment nous avons abord√© la solution √† ce probl√®me et l'avons finalement allou√©e √† la biblioth√®que RouteComposer. </p><br><h3 id="susanin-route-composer"><del>  Susanin </del>  Compositeur de route </h3><br><p>  Apr√®s avoir analys√© tous les sc√©narios de composition et de navigation, nous avons essay√© d'abstraire le code donn√© dans les exemples ci-dessus et identifi√© 3 entit√©s principales dont la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RouteComposer fonctionne</a> - <code>Factory</code> , <code>Finder</code> , <code>Action</code> .  De plus, la biblioth√®que contient 3 entit√©s auxiliaires qui sont responsables d'un petit r√©glage qui peut √™tre requis pendant le processus de navigation - <code>RoutingInterceptor</code> , <code>ContextTask</code> , <code>PostRoutingTask</code> .  Toutes ces entit√©s doivent √™tre configur√©es dans une cha√Æne de d√©pendances et transf√©r√©es vers le <code>Router</code> y, l'objet qui construira votre pile de contr√¥leurs. </p><br><p>  Mais, √† propos de chacun d'eux dans l'ordre: </p><br><h4 id="factory">  Usine </h4><br><p>  Comme son nom l'indique, <code>Factory</code> est responsable de la cr√©ation du contr√¥leur de vue. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController</span></span> }</code> </pre> <br><p>  Ici, il est important de faire une r√©serve sur la notion de <strong>contexte</strong> .  Le contexte au sein de la biblioth√®que, nous appelons tout ce dont le spectateur peut avoir besoin pour √™tre cr√©√©.  Par exemple, afin d'afficher un contr√¥leur de vue qui affiche les d√©tails du produit, vous devez lui passer un certain productID, par exemple, sous la forme d'une <code>String</code> .  L'essence du contexte peut √™tre n'importe quoi: un objet, une structure, un bloc ou un tuple.  Si votre contr√¥leur n'a besoin de rien pour √™tre cr√©√© - le contexte peut-il √™tre sp√©cifi√© comme <code>Any?</code>  et installer en <code>nil</code> . </p><br><p>  Par exemple: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFactory</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with productID: UUID)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productViewController = <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span>(nibName: <span class="hljs-string"><span class="hljs-string">"ProductViewController"</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) productViewController.productID = productID <span class="hljs-comment"><span class="hljs-comment">//  ,      `ContextAction`,     return productViewController } }</span></span></code> </pre> <br><p>  De la mise en ≈ìuvre ci-dessus, il devient clair que cette usine chargera l'image du contr√¥leur √† partir du fichier XIB et y installera l'ID produit transf√©r√©.  En plus du protocole <code>Factory</code> standard, la biblioth√®que fournit plusieurs impl√©mentations standard de ce protocole afin de vous √©viter d'√©crire du code banal (en particulier, l'exemple ci-dessus). </p><br><p>  De plus, je m'abstiendrai de fournir des descriptions de protocoles et des exemples de leurs impl√©mentations, car vous pouvez vous familiariser avec eux en d√©tail en t√©l√©chargeant l'exemple fourni avec la biblioth√®que.  Il existe diff√©rentes impl√©mentations d'usines pour les contr√¥leurs de vue et conteneurs conventionnels, ainsi que des moyens de les configurer. </p><br><h4 id="action">  Action </h4><br><p>  L'entit√© <code>Action</code> est une description de la fa√ßon d'int√©grer un contr√¥leur de vue, qui sera construit par l'usine, sur la pile.  Le contr√¥leur de vue apr√®s la cr√©ation ne peut pas simplement rester en l'air et, par cons√©quent, chaque usine doit contenir une <code>Action</code> comme le montre l'exemple ci-dessus. </p><br><p>  La mise en ≈ìuvre la plus courante d' <code>Action</code> est la pr√©sentation modale du contr√¥leur: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PresentModally</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewController: UIViewController, on existingController: UIViewController, animated: Bool, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: ActionResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> existingController.presentedViewController == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { completion(.failure(<span class="hljs-string"><span class="hljs-string">"\(existingController) is already presenting a view controller."</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } existingController.present(viewController, animated: animated, completion: { completion(.continueRouting) }) } }</code> </pre> <br><p>  La biblioth√®que contient l'impl√©mentation de la plupart des fa√ßons standard d'int√©grer des contr√¥leurs de vue dans la pile, et vous n'aurez probablement pas √† cr√©er le v√¥tre jusqu'√† ce que vous utilisiez une sorte de contr√¥leur de vue de conteneur personnalis√© ou une m√©thode de pr√©sentation.  Mais la cr√©ation d'actions personnalis√©es ne devrait pas poser de probl√®me si vous lisez les exemples. </p><br><h4 id="finder">  Finder </h4><br><p>  L'essence de <code>Finder</code> r√©pond au routeur √† la question <em>- Un tel contr√¥leur est-il d√©j√† cr√©√© et est-il d√©j√† sur la pile?</em>  <em>Peut-√™tre que rien n'est n√©cessaire pour √™tre cr√©√© et suffit-il de montrer ce qui existe d√©j√†?</em>  . </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Finder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findViewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController?</span></span> }</code> </pre> <br><p>  Si vous stockez des liens vers tous les contr√¥leurs de vue que vous avez cr√©√©s, dans votre impl√©mentation du <code>Finder</code> vous pouvez simplement renvoyer un lien vers le contr√¥leur de vue souhait√©.  Mais le plus souvent, ce n'est pas le cas, car la pile d'applications, surtout si elle est volumineuse, change de mani√®re assez dynamique.  De plus, vous pouvez avoir plusieurs contr√¥leurs de vue identiques sur la pile montrant diff√©rentes entit√©s (par exemple, plusieurs ProductViewControllers montrant diff√©rents produits avec diff√©rents ID de produit), de sorte que l'impl√©mentation du <code>Finder</code> peut n√©cessiter une impl√©mentation personnalis√©e et rechercher le contr√¥leur de vue correspondant sur la pile.  La biblioth√®que facilite cette t√¢che en fournissant le <code>StackIteratingFinder</code> comme une extension du <code>Finder</code> , un protocole avec les param√®tres appropri√©s pour simplifier cette t√¢che.  Dans l'impl√©mentation de <code>StackIteratingFinder</code> vous n'avez qu'√† r√©pondre √† la question - est-ce que ce contr√¥leur de vue est celui que le routeur recherche √† votre demande. </p><br><p>  Un exemple d'une telle impl√©mentation: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFinder</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StackIteratingFinder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> = .currentAndUp) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.options = options } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> productViewController: ProductViewController, with productID: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productViewController.productID == productID } }</code> </pre> <br><h3 id="vspomogatelnye-suschnosti">  Entit√©s auxiliaires </h3><br><h4 id="routinginterceptor"> <code>RoutingInterceptor</code> </h4> <br><p>  <code>RoutingInterceptor</code> vous permet d'effectuer certaines actions avant de commencer la composition des contr√¥leurs de vue et d'indiquer au routeur s'il est possible d'int√©grer des contr√¥leurs de vue sur la pile.  L'exemple le plus courant d'une telle t√¢che est l'authentification (mais pas du tout courante dans la mise en ≈ìuvre).  Par exemple, vous souhaitez afficher un contr√¥leur de vue avec les d√©tails d'un compte d'utilisateur, mais pour cela, l'utilisateur doit √™tre connect√© au syst√®me.  Vous pouvez impl√©menter un <code>RoutingInterceptor</code> et l'ajouter √† la configuration de la vue du contr√¥leur des d√©tails de l'utilisateur et de la v√©rification interne: si l'utilisateur est connect√©, autorisez le routeur √† continuer la navigation, sinon, affichez le contr√¥leur de vue qui invite l'utilisateur √† se connecter et si cette action r√©ussit, autorisez le routeur √† continuer la navigation ou √† annuler elle si l'utilisateur refuse de se connecter. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginInterceptor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoutingInterceptor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> destination: AppDestination, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: InterceptorResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> !<span class="hljs-type"><span class="hljs-type">LoginManager</span></span>.sharedInstance.isUserLoggedIn <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... //  LoginViewController       completion(.success)  completion(.failure("User has not been logged in.")) // ... return } completion(.success) } }</span></span></code> </pre><br><p>  Une impl√©mentation d'un tel <code>RoutingInterceptor</code> avec commentaires est contenue dans l'exemple fourni avec la biblioth√®que. </p><br><h4 id="contexttask"> <code>ContextTask</code> </h4> <br><p>  L' <code>ContextTask</code> , si vous la fournissez, peut √™tre appliqu√©e s√©par√©ment √† chaque contr√¥leur de vue dans la configuration, qu'elle soit juste cr√©√©e par un routeur ou trouv√©e sur la pile, et que vous souhaitiez simplement mettre √† jour les donn√©es et / ou d√©finir des valeurs par d√©faut param√®tres (par exemple, afficher le bouton de fermeture ou ne pas afficher). </p><br><h4 id="postroutingtask"> <code>PostRoutingTask</code> </h4> <br><p>  L'impl√©mentation de <code>PostRoutingTask</code> sera appel√©e par le routeur apr√®s la r√©ussite de l'int√©gration du contr√¥leur de vue demand√© sur la pile.  Dans sa mise en ≈ìuvre, il est pratique d'ajouter diverses analyses ou de tirer divers services. </p><br><p>  <strong>Plus en d√©tail avec l'impl√©mentation de toutes les entit√©s d√©crites peuvent √™tre trouv√©es dans la documentation de la biblioth√®que ainsi que dans l'exemple ci-joint.</strong> </p><br><p>  PS: Le nombre d'entit√©s auxiliaires pouvant √™tre ajout√©es √† la configuration n'est pas limit√©. </p><br><h3 id="konfiguraciya">  La configuration </h3><br><p>  Toutes les entit√©s d√©crites sont bonnes en ce sens qu'elles divisent le processus de composition en petits blocs interchangeables et fiables. </p><br><p>  Passons maintenant √† la chose la plus importante - √† la configuration, c'est-√†-dire √† la connexion de ces blocs entre eux.  Afin de collecter ces blocs entre eux et de les combiner en une cha√Æne d'√©tapes, la biblioth√®que fournit une classe de g√©n√©rateur <code>StepAssembly</code> (pour les conteneurs - <code>ContainerStepAssembly</code> ).  Son impl√©mentation vous permet de cha√Æner les blocs de composition en un seul objet de configuration comme des perles sur une cha√Æne, et d'indiquer √©galement les d√©pendances sur les configurations d'autres contr√¥leurs de vue.  Que faire de la configuration √† l'avenir d√©pend de vous.  Vous pouvez le transmettre au routeur avec les param√®tres n√©cessaires et il va construire une pile de contr√¥leurs pour vous, vous pouvez l'enregistrer dans le dictionnaire et l'utiliser plus tard par cl√© - cela d√©pend de votre t√¢che sp√©cifique. </p><br><p>  Prenons un exemple trivial: supposons qu'en cliquant sur une cellule de la liste ou lorsque l'application re√ßoit un lien universel d'un safari ou d'un client de messagerie, nous devons afficher de mani√®re modale le contr√¥leur de produit avec un certain ID de produit.  Dans ce cas, le contr√¥leur de produit doit √™tre int√©gr√© √† l'int√©rieur de l' <code>UINavigationController</code> afin qu'il puisse afficher son nom et son bouton de fermeture sur son panneau de commande.  De plus, ce produit ne peut √™tre pr√©sent√© qu'aux utilisateurs connect√©s, sinon, invitez-les √† se connecter. </p><br><p>  Si vous analysez cet exemple sans utiliser de biblioth√®que, il ressemblera √† ceci: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> analyticsManager = <span class="hljs-type"><span class="hljs-type">AnalyticsManager</span></span>.sharedInstance <span class="hljs-comment"><span class="hljs-comment">//  UITableViewControllerDelegate override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] else { return } //   LoginInterceptor guard !LoginManager.sharedInstance.isUserLoggedIn else { //    LoginViewController         `showProduct(with: productID)` return } showProduct(with: productID) } func showProduct(with productID: String) { //   ProductViewControllerFactory let productViewController = ProductViewController(nibName: "ProductViewController", bundle: nil) //   ProductViewControllerContextTask productViewController.productID = productID //   NavigationControllerStep  PushToNavigationAction let navigationController = UINavigationController(rootViewController: productViewController) //   GenericActions.PresentModally present(alertController, animated: navigationController) { [weak self]   . ProductViewControllerPostTask self?.analyticsManager.trackProductView(productID: productID) } } }</span></span></code> </pre> <br><p>  Cet exemple n'inclut pas la mise en ≈ìuvre de liens universels, ce qui n√©cessitera d'isoler le code d'autorisation et de maintenir le contexte dans lequel l'utilisateur doit √™tre dirig√©, ainsi que de rechercher, soudainement, l'utilisateur clique sur un lien, et ce produit lui est d√©j√† montr√©, ce qui rendra finalement le code tr√®s difficile √† lire. </p><br><p>  <strong>Consid√©rez la configuration de cet exemple √† l'aide de la biblioth√®que:</strong> </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productScreen = <span class="hljs-type"><span class="hljs-type">StepAssembly</span></span>(finder: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFinder</span></span>(), factory: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFactory</span></span>()) <span class="hljs-comment"><span class="hljs-comment">//  : .adding(LoginInterceptor()) .adding(ProductViewControllerContextTask()) .adding(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) //  : .using(PushToNavigationAction()) .from(NavigationControllerStep()) // NavigationControllerStep -&gt; StepAssembly(finder: NilFinder(), factory: NavigationControllerFactory()) .using(GeneralAction.presentModally()) .from(GeneralStep.current()) .assemble()</span></span></code> </pre> <br><p>  Si vous traduisez cela en langage humain: </p><br><ul><li>  V√©rifiez que l'utilisateur est connect√© et sinon, offrez-lui une entr√©e </li><li>  Si l'utilisateur s'est connect√© avec succ√®s, continuez </li><li>  Rechercher le contr√¥leur d'affichage des produits fourni par <code>Finder</code> </li><li>  S'il a √©t√© trouv√© - rendre visible et terminer </li><li>  S'il n'a pas √©t√© trouv√© - cr√©ez un <code>UINavigationController</code> , <code>UINavigationController</code> -y le contr√¥leur de vue cr√©√© par <code>ProductViewControllerFactory</code> aide de <code>PushToNavigationAction</code> </li><li>  <code>GenericActions.PresentModally</code> <code>UINavigationController</code> <code>GenericActions.PresentModally</code> aide de <code>GenericActions.PresentModally</code> partir du contr√¥leur de vue actuel </li></ul><br><p>  La configuration n√©cessite une √©tude, comme de nombreuses solutions complexes, par exemple, le concept d' <code>AutoLayout</code> et, √† premi√®re vue, il peut sembler compliqu√© et redondant.  Cependant, le nombre de t√¢ches √† r√©soudre avec le fragment de code donn√© couvre tous les aspects, de l'autorisation au lien profond, et le fractionnement en une s√©quence d'actions permet de modifier facilement la configuration sans avoir √† apporter de modifications au code.  De plus, l'impl√©mentation de <code>StepAssembly</code> vous aidera √† √©viter les probl√®mes avec une cha√Æne incompl√®te d'√©tapes et √† contr√¥ler le type - probl√®mes d'incompatibilit√© des param√®tres d'entr√©e pour diff√©rents contr√¥leurs de vue. </p><br><p>  Consid√©rez le pseudo-code d'une application compl√®te dans laquelle un <code>ProductArrayViewController</code> affiche une liste de produits et, si l'utilisateur s√©lectionne ce produit, l'affiche selon que l'utilisateur est connect√© ou non, ou propose de se connecter et s'affiche apr√®s une connexion r√©ussie: </p><br><p>  <strong>Objets de configuration</strong> </p><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// `RoutingDestination`    .          . struct AppDestination: RoutingDestination { let finalStep: RoutingStep let context: Any? } struct Configuration { //     ,             static func productDestination(with productID: UUID) -&gt; AppDestination { let productScreen = StepAssembly(finder: ProductViewControllerFinder(), factory: ProductViewControllerFactory()) .add(LoginInterceptor()) .add(ProductViewControllerContextTask()) .add(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) .using(PushToNavigationAction()) .from(NavigationControllerStep()) .using(GenericActions.PresentModally()) .from(CurrentControllerStep()) .assemble() return AppDestination(finalStep: productScreen, context: productID) } }</span></span></code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? <span class="hljs-comment"><span class="hljs-comment">//... // DefaultRouter -  Router   ,   UIViewController   let router = DefaultRouter() override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] else { return } router.navigate(to: Configuration.productDestination(with: productID)) } }</span></span></code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIResponder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool { guard let productID = UniversalLinksManager.parse(url: url) else { return false } return DefaultRouter().navigate(to: Configuration.productDestination(with: productID)) == .handled } }</span></span></code> </pre><br><p>              . </p><br><p>             . ,          , ,           ‚Äî       ProductArrayViewController,      UINavigationController   HomeViewController ‚Äî         <code>StepAssembly</code>  <code>from()</code> .     <code>RouteComposer</code> ,      (     ).  ,      <code>Configuration</code>               .     ,      A/B ,         . </p><br><h3 id="vmesto-zaklyucheniya">  Au lieu d'une conclusion </h3><br><p>   ,      3       .     ,  ,       .   <code>Fabric</code> , <code>Finder</code>  <code>Action</code>            .   ,     ‚Äî              ,    ,       .          ,      . </p><br><p> ,      ,      objective c       Cocoa Touch,             .     iOS  9  12. </p><br><p>            <code>UIViewController</code>  (MVC, MVVM, VIP, RIB, VIPER  ..) </p><br><p>      ,   ,     ,   .         .            . </p><br><p>      . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421097/">https://habr.com/ru/post/fr421097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421087/index.html">Comment configurer le d√©ploiement d'une application Web sur Go pour Gitlab sur VDS</a></li>
<li><a href="../fr421089/index.html">Les fournisseurs russes ont compris comment transf√©rer √† Google une partie des co√ªts du "Spring Package"</a></li>
<li><a href="../fr421091/index.html">Comment nous avons r√©duit le temps de d√©veloppement des mod√®les de notation √† cinq reprises en passant √† Python</a></li>
<li><a href="../fr421093/index.html">Comment j'√©tudie le cadre Spring - partie 2 (aide aux d√©butants - le travail des d√©butants eux-m√™mes)</a></li>
<li><a href="../fr421095/index.html">En vertu du nouveau projet de loi sur le blocage avant le proc√®s pourrait tomber 19 millions de sites</a></li>
<li><a href="../fr421099/index.html">Est-ce difficile de se concentrer? Ce n'est peut-√™tre pas de ta faute</a></li>
<li><a href="../fr421101/index.html">"Calendrier des testeurs" pour ao√ªt. Lire un livre</a></li>
<li><a href="../fr421103/index.html">Premier aper√ßu du Mavic 2: volez plus longtemps, plus silencieusement, plus rapidement</a></li>
<li><a href="../fr421105/index.html">Situation: Spotify conclut des accords directs avec les musiciens - les labels ne sont pas satisfaits</a></li>
<li><a href="../fr421107/index.html">Nous d√©montons et visualisons les certificats qualifi√©s √† l'aide de Python / Tkinter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>