<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💃🏽 🏗️ 🌜 第一个字节的时间：这是什么，为什么重要 🌧️ 🥠 🕺🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=". , . — , . — , , , , ( , , ). , . : « ?». . 

  

 , , , - . (Time to First Byte, TTFB). , TTFB, , , . , , : « TTFB , , TTFB ». 

 , - , TTFB, , TTFB...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>第一个字节的时间：这是什么，为什么重要</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470868/">        .        ,        .    —  ,    .  —     ,     ,  ,    ,       (  , ,    ).        ,      . : «     ?».           . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/tq/4b/8i/tq4b8ifmpqelzhiw5uzboghocp8.jpeg"></a> <br><br>    , ,  , -     .        (Time to First Byte, TTFB).   ,           TTFB,   ,       ,     .         ,   ,    : «   TTFB    ,       ,   TTFB        ». <br><a name="habracut"></a><br>    ,  -     ,            TTFB,   ,    TTFB     .    -,    ,     .  , ,    ,     ,      ,     -.  , ,  ,        .    TTFB  ,           ,     ,        .  ,   ,    ,       TTFB,   ,      ,     . <br><br><h2> <font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是TTFB？</font></font></font></font></font> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/620/d0b/fe1/620d0bfe1034ff0d0c565f459ad2aa79.png"></div><script type="text/javascript">function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('ru', 'zh-CN', function () {});}</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=gtElInit&amp;client=wt"></script><br>  <i><font color="#999999">TTFB看起来信息不多（ <a href="">全图</a> ）</font></i> <br><br>  TTFB是一个看起来不透明的指示器。 他的影响如此之大，以至于我感到我们一直都在掠夺他的认真分析。 许多人认为TTFB只是服务器准备响应所花的时间，但实际上，这只是影响TTFB的一小部分。 <br><br> 我要引起您注意的第一件事是，在学习到人们通常会感到非常惊讶的东西之后。 我们正在谈论一个事实，即TTFB包括来自客户端的请求通过网络到达服务器的时间，以及将服务器响应路径传递给客户端的时间。 这就是所谓的“往返时间”（往返时间，RTT）。  TTFB不仅仅是服务器准备响应所花费的时间。 这也是花费在数据从客户端到服务器以及从服务器到客户端的路径上的时间（当然，此数据包含我们感兴趣的“第一个字节”）。 <br><br> 现在，有了这些知识，我们就可以轻松理解为什么从移动设备查看站点时，TTFB指示器通常只是大得令人讨厌。 在这种情况下，很可能您会问过这样的事情：“我确定服务器不知道我正在通过移动设备查看网站。 那它如何增加TTFB？” 其原因是，通常，移动网络连接是高延迟连接。 如果RTT指示器（例如，反映数据从电话到服务器往返传输所需的时间）为250毫秒，则TTFB将增加相应的值。 <br><br> 如果我希望本书的读者仅从中吸取一个主要想法，那么我可以将这个想法表述为：“网络延迟会影响TTFB。” <br><br> 还有什么影响TTFB？ 实际上-很多东西。 这远不完整是什么构成了此指标的清单。 此列表中的项目是随机顺序的。 <br><br><ul><li>  <b>网络延迟。</b> 如前所述，TTFB包括将请求传递到服务器并从服务器返回响应所花费的时间。 以位于伦敦的设备与位于纽约的服务器之间的数据交换会话所需的时间为例。 理想情况下，使用光纤连接时为28 ms。 但这是基于许多非常乐观的假设。 实际上，您应该期望<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">75毫秒左右的时间</a> 。 这就是使用CDN如此重要的原因。 即使是现在，在Internet时代，某些企业及其客户在地理上的接近也是一个优势。 </li><li>  <b>路由选择</b> 如果您使用CDN（应该是这样！），那么您的客户请求（例如，来自利兹的请求）只能重定向到MAN数据中心，因此结果是，客户需要的资源不在相应的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PoP</a>缓存中。 然后，该请求将随您的资料一起重定向到真实的服务器，以便将其所需的内容传输给客户端。 例如，如果此服务器位于弗吉尼亚州，则上述所有原因都会导致TTFB的严重增加，而没有明显原因。 </li><li>  <b>处理文件。</b> 即使服务器仅从其文件系统中读取静态数据（例如图像或样式文件），也需要花费一些时间来完成此操作。 这次也是TTFB的一部分。 </li><li>  <b>优先次序</b>  HTTP / 2协议具有用于优先处理请求的机制。 结果，可能会导致低优先级请求在服务器上被延迟，而让位于高优先级请求。 即使您没有考虑HTTP / 2优先级排序机制，并假设一切运行顺利，这些预期的延迟也可能导致TTFB。 </li><li>  <b>运行应用程序。</b> 实际上，这很明显，但是我想指出，运行服务器应用程序所需的时间会严重影响TTFB。 </li><li>  <b>数据库查询。</b> 如果您需要从数据库请求某些内容来形成页面，那么完成此类操作的时间也将包含在TTFB中。 </li><li>  <b>API调用</b> 如果需要来自某些API（内部或外部）的数据来准备页面，则对这些API的调用将影响TTFB。 </li><li>  <b>服务器渲染</b> 很明显，服务器端渲染需要时间，这个时间很容易估算，但这并不能抵消此操作对TTFB的贡献。 </li><li>  <b>廉价托管。</b> 如果您使用廉价的主机，试图尽可能节省并牺牲性能，这通常意味着许多其他项目都在使用项目所在的服务器。 也许相当可观。 结果，使用廉价主机的人可能会认为服务器性能会下降，这可能会影响项目处理请求的能力。 实际上，我们在谈论服务器硬件的功能不足以满足应用程序需求这一事实。 </li><li>  <b>DDoS攻击，项目负担沉重。</b> 在这里，我们继续该列表的上一段中讨论的主题。 即，如果服务器上的负载增加，并且该项目无法提供灵活的服务器容量扩展，则导致设备开始达到极限的事实。 结果，应用程序性能下降。 </li><li>  <b>WAF，负载均衡器。</b> 位于服务器应用程序前面的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WAF</a>或负载平衡器之类的服务会增加TTFB。 </li><li>  <b>CDN的某些功能。</b> 使用CDN无疑会对TTFB产生有益的影响，但是CDN的某些功能可能会使情况变得更糟。 例如，这是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请求折叠</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ESI</a>等。 </li><li>  <b>在“最后一英里”处延误。</b> 当我们谈论伦敦的一台计算机访问位于纽约的服务器时，我们通常会简化这种情况，几乎将其简化为计算机与服务器直接连接的事实。 但实际上，一切都更加复杂。 计算机和服务器之间的信号通过许多中介。 我们的路由器将其发送给提供商； 通过无线网络，他进入了铺设在海底的电缆。 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“最后一英里”的延迟</a>包括了在终端设备之间进行数据传输的所有困难。 </li></ul><br>  0毫秒的TTFB是梦dream以求的事情。 因此，需要注意的是，列表中没有任何东西总是对TTFB产生负面影响或使该指标恶化。 最好将此列表理解为对项目TTFB结构的描述。 我的目标不是批评某些技术，而是展示某些技术如何影响TTFB。 而且，老实说，考虑到在客户端从服务器接收到响应的第一个字节之前发生了多少事情，这些站点通常正在加载已经令人惊讶。 <br><br><h2>  <font color="#3AC1EF">揭秘TTFB</font> </h2><br> 现在，希望TTFB不再看起来那么神秘。 而且，如果您花一些时间在API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Server Timing</a>的实现上，则可以开始测量棘手的服务器时间指示器并将其发送到客户端系统。 这将使Web开发人员能够检测并消除以前看不到的潜在性能瓶颈。 <br><br>  Server Timing API允许开发人员使用可选的<code>Server-Timing</code> HTTP标头扩展查询响应。 它包含由应用程序本身测量的时间信息。 <br><br> 去年，我们在BBC iPlayer上使用的正是这种机制。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/573/4b1/63e/5734b163e8c49e7bd6729537f37a2866.png"></div><br>  <i><font color="#999999">可以将新的Server-Timing标头添加到任何答案中（ <a href="">全尺寸图片</a></font></i> ） <br><br> 请注意，“服务器定时”也会给系统带来压力。 在其工作过程中，您需要测量相关指标并填写<code>Server-Timing</code>标头。 浏览器仅允许前端开发人员使用适当的工具查看此数据。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/503/a38/b0c/503a38b0cb82096726135107e593fb25.png"></div><br>  <i><font color="#999999">现在，在浏览器中，您可以看到TTFB结构（ <a href="">全图</a> ）</font></i> <br><br> 如果要实现Server Timing API，请查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此资料</a> 。 <br><br><h2>  <font color="#3AC1EF">总结</font> </h2><br> 网站开发人员必须了解TTFB在多大程度上影响他们所谓的“网站性能”，这一点非常重要。 越过第一个字节的时间是一个特定的边界，我们可以讨论网站优化。 该指标越低越好。 <br><br>  <b>亲爱的读者们！</b> 您是否使用TTFB优化您的Web项目？ <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470868/">https://habr.com/ru/post/zh-CN470868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470844/index.html">杜洛夫兄弟的新项目：电报开放网络</a></li>
<li><a href="../zh-CN470852/index.html">使用Go以100美元在专用服务器上处理1000万个项目中的40 TB代码</a></li>
<li><a href="../zh-CN470856/index.html">电报GRAM钱包：服务条款</a></li>
<li><a href="../zh-CN470858/index.html">上古：第386个处理器和九十年代的基准</a></li>
<li><a href="../zh-CN470864/index.html">关于切换到面板的乐趣，而不仅仅是</a></li>
<li><a href="../zh-CN470870/index.html">预加载字体</a></li>
<li><a href="../zh-CN470872/index.html">用于研究难以置信的快速Web应用程序的性能指标</a></li>
<li><a href="../zh-CN470874/index.html">优化Wikipedia上的JavaScript加载</a></li>
<li><a href="../zh-CN470876/index.html">使用Babel创建自定义JavaScript语法结构。 第一部分</a></li>
<li><a href="../zh-CN470878/index.html">使用Babel创建自定义JavaScript语法结构。 第二部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>