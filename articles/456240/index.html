<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèΩ üî© üßùüèæ Desarrollo de chatbot (laravel + botman) üïì üë®‚Äçüíº üßóüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bienvenido! Yo, como desarrollador junior de pila completa, encontr√© muchos problemas al intentar escribir un bot usando laravel y botman. En primer l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo de chatbot (laravel + botman)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456240/"><p>  Bienvenido!  Yo, como desarrollador junior de pila completa, encontr√© muchos problemas al intentar escribir un bot usando laravel y botman.  En primer lugar, no s√© mucho ingl√©s, pero hay muy pocos art√≠culos sobre este tema en ruso, y los que no me ayudaron a resolver mis problemas.  El art√≠culo contar√° y mostrar√° c√≥mo desarrollar un chatbot en laravel + botman para telegram.  Yo mismo desarroll√© bots (comerciales) para viber y telegram.  Como desarrollador de telegramas, me gusta m√°s. </p><br><p><img src="https://habrastorage.org/webt/lt/zr/fm/ltzrfmykbxry39tsl6ni82onor8.png" alt="imagen"></p><br><p> No mostrar√© c√≥mo instalar laravel y configurar el servidor para que funcione.  Si nunca ha hecho esto antes, ser√° m√°s f√°cil instalar openserver, composer (administrador de paquetes para php) est√° integrado y el servidor local para laravel ya est√° configurado.  Solo tiene que escribir un c√≥digo en .htaccess.  Eso es exactamente lo que trabajo en casa.  En el art√≠culo mostrar√© una de las formas de desarrollar un bot de chat, configurar el bot para que funcione en telegramas y, al final, dejar√© enlaces a art√≠culos √∫tiles sobre laravel'e y botman'e. </p><br><h2>  Dise√±o / preparaci√≥n </h2><br><p>  Propongo el desarrollo de un bot, como todos los desarrolladores normales, con dise√±o, configuraci√≥n de una tarea y explicaci√≥n de c√≥mo funciona laravel.  Antes de eso, dir√© que estoy escribiendo c√≥digo en phpStrom.  Puedes escribir en cualquier otro IDE, pero lo uso. </p><br><p>  Laravel implementa el patr√≥n MVC (Model View Controller).  Esto no significa que solo necesite escribir bajo mvc, puede escribir mierda, pero es mejor usar las ventajas que proporciona el marco.  Si est√° familiarizado con mvc, pero no lo ha utilizado como yo, entonces el desarrollo con laravel es la mejor manera de consolidar el conocimiento. </p><a name="habracut"></a><br><h3>  ¬øQu√© debe hacer nuestro bot? </h3><br><ul><li>  Preguntar al usuario por su nombre de usuario </li><li>  Pregunte si al usuario le gusta el clima o no. </li><li>  Tambi√©n escriba la respuesta en la base de datos. </li><li>  Desp√≠dase y env√≠e una foto </li></ul><br><p>  Un poco sobre MVC.  Al acceder a nuestro software, a trav√©s de comandos (URL url), debemos aceptar estos comandos y procesos, entender lo que el usuario necesita.  Hay rutas para esto, las llamadas rutas.  Las rutas determinan qu√© controlador debe usarse; a su vez, el controlador, si es necesario, accede a la base de datos a trav√©s del modelo.  El modelo contacta con la base de datos y devuelve el resultado que necesitamos.  En el bot, la vista no es necesaria, porque  todo el trabajo pasa por la interfaz de mensajer√≠a.  Por lo tanto, despu√©s de recibir datos del modelo, el controlador proporciona los datos de esta vista, en nuestro caso es una plantilla de hoja (es utilizada por laravel).  Los datos se pueden enviar a una p√°gina php normal, pero es mejor hacerlo a trav√©s de plantillas de hoja.  Usamos la interfaz de mensajer√≠a, luego le enviaremos datos de inmediato. </p><br><h2>  Desarrollo </h2><br><p>  Para crear un proyecto, simplemente ingrese el siguiente comando en la consola </p><br><p><code>composer create-project --prefer-dist botman/studio botelegram</code> </p> <br><p>  El punto de entrada ser√° la ruta "/ start".  Hay varias implementaciones de ruta en botman.  Porque  accederemos a las rutas a trav√©s de un bot en un telegrama, luego necesitamos "botman.php". </p><br><p><img src="https://habrastorage.org/webt/hs/mw/tj/hsmwtj9-twdd9ktlk6ve5py4iwq.png" alt="imagen"></p><br><p>  En ella necesitamos escribir la siguiente l√≠nea </p><br><pre> <code class="php hljs">$botman-&gt;hears(<span class="hljs-string"><span class="hljs-string">'/start'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $bot )</span></span></span><span class="hljs-function"> </span></span>{ $bot-&gt;startConversation ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mainConversation ); } );</code> </pre> <br><p>  Telegram en s√≠ ofrece comenzar a trabajar con el bot a trav√©s del comando "start", y si es as√≠, podemos facilitar la interacci√≥n con el bot configurando el punto de entrada inicial como "/ start" e inmediatamente trabajar con √©l. </p><br><p>  Usando $ bot-&gt; startConversation (nueva mainConversation);  indicamos qu√© controlador ser√° responsable del trabajo.  Adem√°s, registraremos el uso de nuestro controlador, para esto necesitamos agregar este c√≥digo en el archivo de ruta: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">mainConversation</span></span>;</code> </pre> <br><p>  Vamos a continuar  Necesitamos crear una base de datos y el controlador en s√≠.  Quiero decir que est√°s usando openserver.  La base de datos se puede crear a trav√©s de la consola o usando phpMyAdmin, que est√° integrado en el servidor abierto. </p><br><p>  Ahora algunas configuraciones.  Necesitamos ingresar los datos de la base de datos en el archivo de configuraci√≥n de laravel.  Se encuentra en el directorio ra√≠z del proyecto y se llama .env </p><br><p><img src="https://habrastorage.org/webt/ya/j9/al/yaj9algdv_3ugct8rqt-ua2fy1a.png" alt="imagen"></p><br><p>  Encuentra las l√≠neas asociadas con la base de datos </p><br><pre> <code class="plaintext hljs">DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=botelegram DB_USERNAME=root DB_PASSWORD=</code> </pre> <br><p>  Aqu√≠ solo nos interesa el nombre de la base de datos, el nombre de usuario y la contrase√±a.  Si usa openserver, puede escribir el nombre ra√≠z y dejar la contrase√±a vac√≠a, el nombre de la base de datos depende de usted. </p><br><p>  Ahora nuestra aplicaci√≥n tiene acceso a la base de datos.  Lo siguiente que debemos hacer es crear un modelo y una migraci√≥n.  Escribimos en la consola: </p><br><p> <code>php artisan make:model messengerUser -m</code> </p> <br><p>  El indicador -m crear√° una migraci√≥n para la base de datos y la asociar√° con nuestro modelo.  Configuremos nuestra migraci√≥n de inmediato para no volver m√°s. </p><br><p>  Es mejor no hacer esto, pero para no crear un mont√≥n de archivos, escribimos todos los datos en una tabla. <br>  Necesitamos: </p><br><ul><li>  ID de chat </li><li>  Nombre de usuario </li><li>  Buen clima o no </li></ul><br><p>  Esto es suficiente para demostrar las capacidades b√°sicas de botman.  Abra la migraci√≥n reci√©n creada, que se encuentra en la base de datos / migrations / creation_create_messanger_users_table.php </p><br><p><img src="https://habrastorage.org/webt/dz/kq/sv/dzkqsvxyblhrqhm62erj_cd2xao.png" alt="imagen"></p><br><p>  Complete el m√©todo up en esta migraci√≥n, deber√≠a verse as√≠: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Schema::create(<span class="hljs-string"><span class="hljs-string">'messenger_users'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $table)</span></span></span><span class="hljs-function"> </span></span>{ $table-&gt;increments(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">"id_chat"</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">"name"</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'response'</span></span>); $table-&gt;timestamps(); }); }</code> </pre> <br><p>  Ahora necesitamos comenzar la migraci√≥n para que nuestra tabla exista en la base de datos.  En la consola necesitas registrarte: </p><br><p> <code>php artisan migrate</code> </p> <br><p>  Sugerencia: si durante el proceso de desarrollo necesita cambiar los campos en la tabla, pero hay datos en la tabla, y si no los necesita, puede actualizar las tablas usando el comando <code>php artisan migrate:refresh</code> . </p><br><p>  Resultado: </p><br><p><img src="https://habrastorage.org/webt/2k/wy/5e/2kwy5ennah0pz8us1oyljum6ftw.png" alt="imagen"></p><br><p>  laravel realiz√≥ 3 migraciones, pero solo estamos interesados ‚Äã‚Äãen la tercera migraci√≥n desde  Aqu√≠ es donde registraremos nuestros datos. </p><br><p>  Es hora de crear un controlador, conectar nuestro modelo a √©l y escribir la l√≥gica. </p><br><p>  En general, es mejor crear todos los archivos a trav√©s de la consola, pero como usamos botman y ya estoy tan acostumbrado, crearemos un controlador manualmente.  En botman, el controlador se llama conversaci√≥n, quiz√°s haya diferencias significativas entre ellos, pero no lo entend√≠, no era necesario.  En la carpeta de aplicaciones / Conversaciones, cree un archivo llamado mainConversation.php. </p><br><p>  En la pantalla ves una configuraci√≥n m√≠nima de conversaci√≥n </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">Conversation</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mainConversation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conversation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  Su clase debe tener un m√©todo de ejecuci√≥n p√∫blica, es el punto de entrada para el controlador. </p><br><p>  Conecte nuestro modelo al controlador: </p><br><p> <code>use app\messengerUser;</code> <br>  Escribamos la l√≥gica inicial.  El m√©todo de ejecuci√≥n ejecutar√° un m√©todo privado que pregunta cu√°l es el nombre del usuario, escribe su id y nombre en id_chat y el nombre de nuestra tabla. </p><br><p>  Para comenzar, escribe: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">messengerUser</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">database</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Attachments</span></span>\<span class="hljs-title"><span class="hljs-title">Image</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">Conversation</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Incoming</span></span>\<span class="hljs-title"><span class="hljs-title">Answer</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BotManAnswer</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">Actions</span></span>\<span class="hljs-title"><span class="hljs-title">Button</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">OutgoingMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">Question</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BotManQuestion</span></span>;</code> </pre> <br><p>  lo que nos permitir√° usar los m√©todos de botman </p><br><p>  Y ahora haremos cambios en nuestro controlador: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mainConversation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conversation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $response = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setName(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $question = BotManQuestion::create(<span class="hljs-string"><span class="hljs-string">"!   ?"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ask( $question, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( BotManAnswer $answer )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $answer-&gt;getText () != <span class="hljs-string"><span class="hljs-string">''</span></span> ){ array_push (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response, $answer-&gt;getText()); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;askWeather (); } }); } }</code> </pre> <br><p>  run () inicia el m√©todo que necesitamos, es setName ().  Ya en setName () pedimos el nombre de usuario, escribimos el nombre en la matriz, luego ejecutamos el siguiente m√©todo, que le preguntar√° al usuario sobre el clima. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askWeather</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $question = BotManQuestion::create(<span class="hljs-string"><span class="hljs-string">"    ?"</span></span>); $question-&gt;addButtons( [ Button::create(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;value(<span class="hljs-number"><span class="hljs-number">1</span></span>), Button::create(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;value(<span class="hljs-number"><span class="hljs-number">2</span></span>) ]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ask($question, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BotManAnswer $answer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      ,       array_push ($this-&gt;response, $answer); $this-&gt;exit(); }); }</span></span></code> </pre> <br><p>  askWeather () tiene una estructura similar, pero aqu√≠ usamos botones para limitar las opciones del usuario y hacernos la vida m√°s f√°cil.  Los botones eliminan muchos errores que un usuario puede crear.  Aqu√≠ tambi√©n creamos una pregunta, con la ayuda de addButtons () adjuntamos botones a la pregunta, y luego llamamos a esta pregunta y procesamos la respuesta, y tambi√©n pasamos al √∫ltimo m√©todo. </p><br><p>  El m√©todo exit () escribir√° todos los datos en la base de datos (puede extraerse en un m√©todo separado), se despedir√° del usuario y tambi√©n le enviar√° una imagen. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> database(); $db-&gt;id_chat = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bot-&gt;getUser()-&gt;getId(); $db-&gt;name = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $db-&gt;response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $db-&gt;save(); $attachment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(<span class="hljs-string"><span class="hljs-string">'https://gykov.ru/projects/botelegram.png'</span></span>); $message = OutgoingMessage::create(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>) -&gt;withAttachment($attachment); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bot-&gt;reply($message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><p>  Usando OutgoingMessage :: create ('¬°Nos vemos de nuevo!') -&gt; withAttachment ($ adjunto), creamos un nuevo mensaje y le adjuntamos una imagen.  En general, todos los archivos p√∫blicos que el usuario deber√≠a ver se colocan en la carpeta p√∫blica, pero en mi √∫ltimo bot hubo un problema con esto y tuve que colocarlos en una carpeta separada en el servidor (no relacionada con el proyecto).  Aqu√≠ hice lo mismo. </p><br><p>  La l√≥gica de nuestro bot est√° lista.  Para probarlo, solo abra el sitio a trav√©s de openserver, pero antes de eso, debe crear un archivo .htiaccess con el siguiente contenido </p><br><pre> <code class="plaintext hljs">&lt;IfModule mod_rewrite.c&gt; RewriteEngine On RewriteRule ^(.*)$ public/$1 [L] &lt;/IfModule&gt;</code> </pre> <br><p>  El archivo debe estar en la ra√≠z del sitio.  Ahora todas las solicitudes se transferir√°n a la carpeta p√∫blica.  As√≠ es como funciona laravel.  Abrimos el sitio y probamos el bot, no olvides que primero debes ingresar "/ start". </p><br><p>  Despu√©s de asegurarte de que todo funciona, puedes adjuntarlo a los telegramas.  Para hacer esto, cree un nuevo bot en @botfather, copie la clave del bot al final del archivo .env.  Se ve as√≠: </p><br><p> <code>TELEGRAM_KEY=key_bot</code> </p> <br><p>  Ahora necesitamos poner en nuestro proyecto un controlador para el trabajo conjunto de nuestro robot de l√≥gica y telegrama.  Esto se hace con un solo comando en la consola: </p><br><p> <code>composer require botman/driver-telegram</code> </p> <br><p>  Tambi√©n deber√° registrar el bot en laravel. </p><br><p> <code>php artisan botman:telegram:register</code> </p> <br><p>  Se nos pedir√° que ingresemos la direcci√≥n en la que estar√° disponible nuestro bot. </p><br><p><img src="https://habrastorage.org/webt/7t/pg/uv/7tpguvu21qjnqlotwj3nbkmy6c8.png" alt="imagen"></p><br><p>  Si est√° desarrollando un bot en el servidor, simplemente agregue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https: // url_site / botman</a> despu√©s de este bot, puede probarlo en el propio messenger.  Pero tenga en cuenta que laravel necesita una configuraci√≥n especial del servidor, y lo m√°s probable es que tenga que configurarlo usted mismo.  Dejar√© un enlace sobre c√≥mo configurar el servidor al final del art√≠culo. </p><br><p>  Quiz√°s eso es todo.  Si lees hasta el final, felicidades, ahora puedes desarrollar bots de chat para laravel usando botman.  Si tiene preguntas, con gusto responder√© en los comentarios, as√≠ como en los enlaces prometidos: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes en github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n de Botman</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configuraci√≥n del servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un art√≠culo en el que cre√© mi primer bot</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En art√≠culo sobre botman</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456240/">https://habr.com/ru/post/456240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456230/index.html">Iobroker b√∫squeda de misiones en juegos de realidad</a></li>
<li><a href="../456232/index.html">Gu√≠a: Actualizaci√≥n de interfaces con miembros predeterminados en C # 8.0</a></li>
<li><a href="../456234/index.html">¬øPor qu√© Cisco no compra Splunk o habla sobre c√≥mo funciona la plataforma Cisco para la caza de amenazas?</a></li>
<li><a href="../456236/index.html">Peter - Insider Dev Tour: Conferencia Insider para desarrolladores de Microsoft</a></li>
<li><a href="../456238/index.html">Tutorial: Actualizar interfaces con miembros de interfaz predeterminados en C # 8.0</a></li>
<li><a href="../456242/index.html">Un poco m√°s sobre la multitarea en microcontroladores</a></li>
<li><a href="../456246/index.html">Elemento cero</a></li>
<li><a href="../456248/index.html">C√≥mo atrap√©: antes de los estilos para un elemento de enfoque</a></li>
<li><a href="../456250/index.html">Localizaci√≥n de aplicaciones y soporte RTL. Informe Yandex.Taxi</a></li>
<li><a href="../456256/index.html">Gu√≠a de arquitectura de aplicaciones de Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>