<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš° ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ‘¨ğŸ»â€ğŸ”¬ åœ¨ç»Ÿä¸€ä¸­åˆ›å»ºå¡”é˜²ï¼šæ–¹æ¡ˆå’Œæ•Œäººæµªæ½® ğŸ… ğŸ‘” ğŸ‘¨â€ğŸ‘§â€ğŸ‘§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[ æœ¬æ•™ç¨‹çš„ç¬¬ä¸€ ï¼Œ ç¬¬äºŒ ï¼Œ ç¬¬ä¸‰å’Œç¬¬å››éƒ¨åˆ†] 



- æ”¯æŒå°ï¼Œä¸­ï¼Œå¤§å‹æ•Œäººã€‚ 
- åˆ›å»ºå…·æœ‰å¤šä¸ªæ•Œäººæµªæ½®çš„æ¸¸æˆåœºæ™¯ã€‚ 
- èµ„äº§é…ç½®å’Œæ¸¸æˆçŠ¶æ€çš„åˆ†ç¦»ã€‚ 
- å¼€å§‹ï¼Œæš‚åœï¼Œè·èƒœï¼Œå¤±è´¥å¹¶åŠ é€Ÿæ¸¸æˆã€‚ 
- åˆ›å»ºæ— é™é‡å¤çš„åœºæ™¯ã€‚ 
 è¿™æ˜¯æœ‰å…³åˆ›å»ºç®€å•å¡”é˜²æ¸¸æˆçš„ä¸€ç³»åˆ—æ•™ç¨‹çš„ç¬¬äº”éƒ¨åˆ†ã€‚ åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°†å­¦...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨ç»Ÿä¸€ä¸­åˆ›å»ºå¡”é˜²ï¼šæ–¹æ¡ˆå’Œæ•Œäººæµªæ½®</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466855/">  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬</a>æ•™ç¨‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„ç¬¬ä¸€</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬äºŒ</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸‰</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬å››</a>éƒ¨åˆ†] <br><br><ul><li> æ”¯æŒå°ï¼Œä¸­ï¼Œå¤§å‹æ•Œäººã€‚ </li><li> åˆ›å»ºå…·æœ‰å¤šä¸ªæ•Œäººæµªæ½®çš„æ¸¸æˆåœºæ™¯ã€‚ </li><li> èµ„äº§é…ç½®å’Œæ¸¸æˆçŠ¶æ€çš„åˆ†ç¦»ã€‚ </li><li> å¼€å§‹ï¼Œæš‚åœï¼Œè·èƒœï¼Œå¤±è´¥å¹¶åŠ é€Ÿæ¸¸æˆã€‚ </li><li> åˆ›å»ºæ— é™é‡å¤çš„åœºæ™¯ã€‚ </li></ul><br> è¿™æ˜¯æœ‰å…³åˆ›å»ºç®€å•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¡”é˜²</a>æ¸¸æˆçš„ä¸€ç³»åˆ—æ•™ç¨‹çš„ç¬¬äº”éƒ¨åˆ†ã€‚ åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºä¼šäº§ç”Ÿå„ç§å„æ ·æ•Œäººçš„æ¸¸æˆåœºæ™¯ã€‚ <br><br> è¯¥æ•™ç¨‹æ˜¯åœ¨Unity 2018.4.6f1ä¸­åˆ›å»ºçš„ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b12/6aa/945/b126aa94582cc44651853c3ee69be82b.jpg" width="512" height="256"></div><br>  <i>è¶Šæ¥è¶Šèˆ’æœäº†ã€‚</i> <br><a name="habracut"></a><br><h2> æ›´å¤šæ•Œäºº </h2><br> æ¯æ¬¡åˆ›å»ºç›¸åŒçš„è“è‰²ç«‹æ–¹ä½“å¹¶ä¸æ˜¯å¾ˆæœ‰è¶£ã€‚ æ”¯æŒæ›´æœ‰è¶£çš„æ¸¸æˆåœºæ™¯çš„ç¬¬ä¸€æ­¥å°†æ˜¯æ”¯æŒå‡ ç§ç±»å‹çš„æ•Œäººã€‚ <br><br><h3> æ•Œäººé…ç½® </h3><br> æœ‰å¤šç§æ–¹æ³•å¯ä»¥ä½¿æ•Œäººç‹¬ç‰¹ï¼Œä½†æˆ‘ä»¬ä¸ä¼šä½¿å…¶å¤æ‚åŒ–ï¼šæˆ‘ä»¬å°†å…¶åˆ†ä¸ºå¤§ï¼Œä¸­ï¼Œå°ä¸‰ç§ã€‚ è¦æ ‡è®°å®ƒä»¬ï¼Œè¯·åˆ›å»ºä¸€ä¸ª<code>EnemyType</code>æšä¸¾ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EnemyType { Small, Medium, Large }</code> </pre> <br> æ›´æ”¹<code>EnemyFactory</code> ï¼Œä½¿å…¶æ”¯æŒæ‰€æœ‰ä¸‰ç§ç±»å‹çš„æ•Œäººï¼Œè€Œä¸æ˜¯ä¸€ç§ã€‚ å¯¹äºæ‰€æœ‰ä¸‰ä¸ªæ•Œäººï¼Œéƒ½éœ€è¦ç›¸åŒçš„é…ç½®å­—æ®µï¼Œå› æ­¤æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ•Œäººçš„åµŒå¥—<code>EnemyConfig</code>ç±»ï¼Œç„¶åå°†ä¸‰ä¸ªæ­¤ç±»å‹çš„é…ç½®å­—æ®µæ·»åŠ åˆ°å·¥å‚ã€‚ ç”±äºæ­¤ç±»ä»…ç”¨äºé…ç½®ï¼Œæˆ‘ä»¬å°†ä¸ä¼šåœ¨å…¶ä»–ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒï¼Œå› æ­¤æ‚¨å¯ä»¥ç®€å•åœ°å°†å…¶å­—æ®µå…¬å¼€ï¼Œä»¥ä¾¿å·¥å‚å¯ä»¥è®¿é—®å®ƒä»¬ã€‚  <code>EnemyConfig</code>æœ¬èº«ä¸éœ€è¦å…¬å¼€ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemyFactory</span></span> : <span class="hljs-title"><span class="hljs-title">GameObjectFactory</span></span> { [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemyConfig</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Enemy prefab = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; [FloatRangeSlider(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">2f</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> FloatRange scale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">1f</span></span>); [FloatRangeSlider(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">5f</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> FloatRange speed = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">1f</span></span>); [FloatRangeSlider(<span class="hljs-number"><span class="hljs-number">-0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> FloatRange pathOffset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">0f</span></span>); } [SerializeField] EnemyConfig small = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, medium = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, large = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; â€¦ }</code> </pre> <br> æˆ‘ä»¬è¿˜è¦ä½¿æ¯ä¸ªæ•Œäººçš„å¥åº·çŠ¶å†µå¯è‡ªå®šä¹‰ï¼Œå› ä¸ºé€»è¾‘ä¸Šå¤§æ•Œäººæ¯”å°æ•Œäººæ›´å¤šã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">FloatRangeSlider(10f, 1000f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> FloatRange health = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatRange(<span class="hljs-number"><span class="hljs-number">100f</span></span>);</code> </pre> <br> åœ¨<code>Get</code>æ·»åŠ ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œä»¥ä¾¿å¯ä»¥è·å–ç‰¹å®šçš„æ•Œäººç±»å‹ï¼Œé»˜è®¤ç±»å‹ä¸ºä¸­ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨è¯¥ç±»å‹æ¥è·å–æ­£ç¡®çš„é…ç½®ï¼ˆä¸ºæ­¤ä½¿ç”¨å•ç‹¬çš„æ–¹æ³•ï¼‰ï¼Œç„¶ååƒä»¥å‰ä¸€æ ·ä»…ä½¿ç”¨æ·»åŠ çš„è¿è¡ŒçŠ¶å†µå‚æ•°æ¥åˆ›å»ºå’Œåˆå§‹åŒ–æ•Œäººã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">EnemyConfig </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConfig</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EnemyType type</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EnemyType.Small: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> small; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EnemyType.Medium: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> medium; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EnemyType.Large: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> large; } Debug.Assert(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"Unsupported enemy type!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Enemy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EnemyType type = EnemyType.Medium</span></span></span><span class="hljs-function">)</span></span> { EnemyConfig config = GetConfig(type); Enemy instance = CreateGameObjectInstance(config.prefab); instance.OriginFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; instance.Initialize( config.scale.RandomValueInRange, config.speed.RandomValueInRange, config.pathOffset.RandomValueInRange, config.health.RandomValueInRange ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }</code> </pre> <br> å‘<code>Enemy.Initialize</code>æ·»åŠ æ‰€éœ€çš„å‚æ•°ç”Ÿå‘½å€¼ï¼Œ <code>Enemy.Initialize</code>å¹¶ä½¿ç”¨å®ƒæ¥è®¾ç½®ç”Ÿå‘½å€¼ï¼Œè€Œä¸æ˜¯æ ¹æ®æ•Œäººçš„å¤§å°æ¥ç¡®å®šå®ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scale, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> speed, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pathOffset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> health </span></span></span><span class="hljs-function">)</span></span> { â€¦ Health = health; }</code> </pre> <br><h3> æˆ‘ä»¬åˆ›é€ ä¸åŒæ•Œäººçš„è®¾è®¡ </h3><br> æ‚¨å¯ä»¥é€‰æ‹©ä¸‰ä¸ªæ•Œäººçš„è®¾è®¡ï¼Œä½†æ˜¯åœ¨æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†åŠ›æ±‚æœ€å¤§ç¨‹åº¦çš„ç®€åŒ–ã€‚ æˆ‘å¤åˆ¶äº†æ•Œäººçš„åŸå§‹é¢„åˆ¶ä»¶ï¼Œå¹¶å°†å…¶ç”¨äºæ‰€æœ‰ä¸‰ç§å°ºå¯¸ï¼Œä»…æ›´æ”¹äº†æè´¨ï¼šé»„è‰²ä»£è¡¨å°ï¼Œè“è‰²ä»£è¡¨ä¸­ï¼Œçº¢è‰²ä»£è¡¨å¤§ã€‚ æˆ‘æ²¡æœ‰æ›´æ”¹é¢„åˆ¶ç«‹æ–¹ä½“çš„æ¯”ä¾‹ï¼Œä½†æ˜¯ä½¿ç”¨äº†å·¥å‚æ¯”ä¾‹é…ç½®æ¥è®¾ç½®å°ºå¯¸ã€‚ å¦å¤–ï¼Œæ ¹æ®å¤§å°ï¼Œæˆ‘å¢åŠ äº†å®ƒä»¬çš„å¥åº·ç¨‹åº¦å¹¶é™ä½äº†é€Ÿåº¦ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd7/070/231/bd707023151022e921c5b6956bb20c02.png" width="320" height="348"></div><br>  <i>å·¥å‚ç”¨äºä¸‰ç§å°ºå¯¸çš„æ•Œäººç«‹æ–¹ä½“ã€‚</i> <br><br> æœ€å¿«çš„æ–¹æ³•æ˜¯é€šè¿‡æ›´æ”¹<code>Game.SpawnEnemy</code> ï¼Œä½¿è¿™ä¸‰ç§ç±»å‹éƒ½å‡ºç°åœ¨æ¸¸æˆä¸­ï¼Œä»¥ä¾¿ä»–è·å¾—éšæœºçš„æ•Œäººç±»å‹ï¼Œè€Œä¸æ˜¯ä¸­é—´çš„ä¸€ä¸ªç±»å‹ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnEnemy</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GameTile spawnPoint = board.GetSpawnPoint(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, board.SpawnPointCount)); Enemy enemy = enemyFactory.Get((EnemyType)(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>))); enemy.SpawnOn(spawnPoint); enemies.Add(enemy); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/537/73b/b92/53773bb9299a8ec9c56b485718049e5b.png" width="230" height="230"></div><br>  <i>ä¸åŒç±»å‹çš„æ•Œäººã€‚</i> <br><br><h3> å‡ å®¶å·¥å‚ </h3><br> ç°åœ¨ï¼Œæ•Œäººçš„å·¥å‚è®¾ç½®äº†å¾ˆå¤šä¸‰ä¸ªæ•Œäººã€‚ ç°æœ‰å·¥å‚å¯ä»¥åˆ›å»ºä¸‰ç§å°ºå¯¸çš„ç«‹æ–¹ä½“ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢æˆ‘ä»¬åˆ¶é€ å¦ä¸€å®¶å¯ä»¥åˆ›å»ºå…¶ä»–å½¢çŠ¶çš„å·¥å‚ï¼Œä¾‹å¦‚ä¸‰ç§å°ºå¯¸çš„çƒä½“ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ¸¸æˆä¸­æŒ‡å®šå…¶ä»–å·¥å‚æ¥æ›´æ”¹åˆ›å»ºçš„æ•Œäººï¼Œä»è€Œåˆ‡æ¢åˆ°å…¶ä»–ä¸»é¢˜ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65f/7e5/330/65f7e5330945ea654f1caef579fe567f.png" width="230" height="230"></div><br>  <i>çƒå½¢æ•Œäººã€‚</i> <br><br><h2> æ•Œäººçš„æµªæ½® </h2><br> åˆ›å»ºæ¸¸æˆåœºæ™¯çš„ç¬¬äºŒæ­¥å°†æ˜¯æ‹’ç»ä»¥æ’å®šçš„é¢‘ç‡ç”Ÿæˆæ•Œäººã€‚ å¿…é¡»è¿ç»­ä¸æ–­åœ°åˆ›å»ºæ•Œäººï¼Œç›´åˆ°å‰§æœ¬ç»“æŸæˆ–ç©å®¶å¤±è´¥ã€‚ <br><br><h3> åˆ›å»ºé¡ºåº </h3><br> ä¸€æ³¢æ•Œäººç”±ä¸€ç»„æ•Œäººç»„æˆï¼Œè¿™äº›æ•Œäººä¸€ä¸ªæ¥ä¸€ä¸ªåœ°åˆ›å»ºï¼Œç›´åˆ°æ³¢å®Œæˆã€‚ æ³¢æµªå¯ä»¥åŒ…å«ä¸åŒç±»å‹çš„æ•Œäººï¼Œå¹¶ä¸”å®ƒä»¬ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ ä¸ºäº†ä¸ä½¿å®ç°å¤æ‚åŒ–ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªç®€å•çš„ç”Ÿæˆåºåˆ—å¼€å§‹ï¼Œè¯¥åºåˆ—ä»¥æ’å®šçš„é¢‘ç‡åˆ›å»ºç›¸åŒç±»å‹çš„æ•Œäººã€‚ ç„¶åï¼Œè¯¥æ³¢å°†åªæ˜¯è¿™äº›åºåˆ—çš„åˆ—è¡¨ã€‚ <br><br> è¦é…ç½®æ¯ä¸ªåºåˆ—ï¼Œè¯·åˆ›å»ºä¸€ä¸ª<code>EnemySpawnSequence</code>ç±»ã€‚ ç”±äºå®ƒå¾ˆå¤æ‚ï¼Œè¯·å°†å…¶æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚ åºåˆ—å¿…é¡»çŸ¥é“è¦ä½¿ç”¨å“ªä¸ªå·¥å‚ï¼Œè¦åˆ›å»ºå“ªç§ç±»å‹çš„æ•Œäººï¼Œå…¶æ•°é‡å’Œé¢‘ç‡ã€‚ ä¸ºäº†ç®€åŒ–é…ç½®ï¼Œæˆ‘ä»¬å°†æœ€åä¸€ä¸ªå‚æ•°è®¾ä¸ºæš‚åœï¼Œè¯¥å‚æ•°ç¡®å®šåœ¨åˆ›å»ºä¸‹ä¸€ä¸ªæ•Œäººä¹‹å‰åº”è¯¥ç»è¿‡å¤šå°‘æ—¶é—´ã€‚ è¯·æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•å…è®¸æ‚¨åœ¨waveä¸­ä½¿ç”¨å¤šä¸ªæ•Œæ–¹å·¥å‚ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemySpawnSequence</span></span> { [SerializeField] EnemyFactory factory = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; [SerializeField] EnemyType type = EnemyType.Medium; [SerializeField, Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> amount = <span class="hljs-number"><span class="hljs-number">1</span></span>; [SerializeField, Range(<span class="hljs-number"><span class="hljs-number">0.1f</span></span>, <span class="hljs-number"><span class="hljs-number">10f</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cooldown = <span class="hljs-number"><span class="hljs-number">1f</span></span>; }</code> </pre> <br><h3> æµ·æµª </h3><br> æ³¢æµªæ˜¯æ•Œäººåˆ›é€ åºåˆ—çš„ç®€å•é˜µåˆ—ã€‚ ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªä»¥ä¸€ä¸ªæ ‡å‡†åºåˆ—å¼€å¤´çš„EnemyWave <code>EnemyWave</code>ç±»å‹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemyWave</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField] EnemySpawnSequence[] spawnSequences = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EnemySpawnSequence() }; }</code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶é€ ä¸€æ³¢åˆä¸€æ³¢çš„æ•Œäººã€‚ ä¾‹å¦‚ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ³¢æµªï¼Œè¯¥æ³¢æµªäº§ç”Ÿä¸€ç»„ç«‹æ–¹ä½“æ•Œäººï¼Œä»åä¸ªå°æ•Œäººå¼€å§‹ï¼Œæ¯ç§’å‡ºç°ä¸¤æ¬¡ã€‚ å®ƒä»¬åé¢æ˜¯äº”ä¸ªå¹³å‡å€¼ï¼Œæ¯ç§’åˆ›å»ºä¸€æ¬¡ï¼Œæœ€åæ˜¯ä¸€ä¸ªå¤§æ•Œäººï¼Œåœé¡¿äº”ç§’é’Ÿã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b16/af3/47f/b16af347f057760db35703515642db89.png" width="320" height="376"></div><br>  <i>ä¸€æ³¢è¶Šæ¥è¶Šå¤šçš„ç«‹æ–¹ä½“ã€‚</i> <br><br><div class="spoiler">  <b class="spoiler_title">æˆ‘å¯ä»¥åœ¨åºåˆ—ä¹‹é—´æ·»åŠ å»¶è¿Ÿå—ï¼Ÿ</b> <div class="spoiler_text"> æ‚¨å¯ä»¥é—´æ¥å®ç°å®ƒã€‚ ä¾‹å¦‚ï¼Œåœ¨å°å‹å’Œä¸­å‹å¤šç»´æ•°æ®é›†ä¹‹é—´æ’å…¥å››ç§’é’Ÿçš„å»¶è¿Ÿï¼Œå°†å°å‹å¤šç»´æ•°æ®é›†çš„æ•°é‡å‡å°‘ä¸€ä¸ªï¼Œç„¶åæ’å…¥ä¸€ä¸ªå…·æœ‰å››ä¸ªæš‚åœæ—¶é—´çš„å°å‹å¤šç»´æ•°æ®é›†çš„åºåˆ—ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/59b/ff4/3f9/59bff43f9a71002c0bd562f270b755ea.png" width="320" height="272"></div><br>  <i>ä¸­å°å‹ç«‹æ–¹ä½“ä¹‹é—´æœ‰å››ç§’é’Ÿçš„å»¶è¿Ÿã€‚</i> </div></div><br><h3> æƒ…å¢ƒ </h3><br> æ¸¸æˆåœºæ™¯æ˜¯ç”±ä¸€ç³»åˆ—æ³¢æµªåˆ›å»ºçš„ã€‚ ä¸ºæ­¤ï¼Œè¯·åˆ›å»ºå…·æœ‰å•ä¸ªwaveæ•°ç»„çš„<code>GameScenario</code>èµ„äº§<code>GameScenario</code> ï¼Œç„¶åä½¿ç”¨å®ƒæ¥åˆ›å»ºåœºæ™¯ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [CreateAssetMenu] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameScenario</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField] EnemyWave[] waves = {}; }</code> </pre> <br> ä¾‹å¦‚ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­åŒ…å«ä¸¤æ³¢ä¸­å°å‹æ•Œäººï¼ˆMSCï¼‰ï¼Œé¦–å…ˆæ˜¯ç«‹æ–¹ä½“ï¼Œç„¶åæ˜¯çƒä½“ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/df0/73b/796df073b24d092d35093b6e56b8be79.png" width="320" height="142"></div><br>  <i>å¸¦æœ‰ä¸¤æ³¢MSCçš„åœºæ™¯ã€‚</i> <br><br><h3> é¡ºåºè¿åŠ¨ </h3><br> èµ„äº§ç±»å‹ç”¨äºåˆ›å»ºè„šæœ¬ï¼Œä½†æ˜¯ç”±äºå®ƒä»¬æ˜¯èµ„äº§ï¼Œå› æ­¤å®ƒä»¬å¿…é¡»åŒ…å«åœ¨æ¸¸æˆæœŸé—´ä¸ä¼šæ›´æ”¹çš„æ•°æ®ã€‚ ä½†æ˜¯ï¼Œè¦æ¨è¿›æ­¤æ–¹æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼è·Ÿè¸ªå®ƒä»¬çš„çŠ¶æ€ã€‚ ä¸€ç§æ–¹æ³•æ˜¯å¤åˆ¶æ¸¸æˆä¸­ä½¿ç”¨çš„èµ„äº§ï¼Œä»¥ä¾¿å¤åˆ¶å“è·Ÿè¸ªå…¶çŠ¶å†µã€‚ ä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦å¤åˆ¶æ•´ä¸ªèµ„äº§ï¼Œåªéœ€è¯´æ˜å’ŒæŒ‡å‘èµ„äº§çš„é“¾æ¥å°±è¶³å¤Ÿäº†ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬é¦–å…ˆä¸º<code>EnemySpawnSequence</code>åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„<code>State</code>ç±»ã€‚ ç”±äºå®ƒä»…é€‚ç”¨äºåºåˆ—ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶åµŒå¥—ã€‚ å®ƒä»…åœ¨å¼•ç”¨åºåˆ—æ—¶æ‰æœ‰æ•ˆï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸ºå®ƒæä¾›å¸¦æœ‰åºåˆ—å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18c/752/4fd/18c7524fdac87c062a6c683bbdee1866.png" width="315" height="50"></div><br>  <i>å¼•ç”¨å…¶åºåˆ—çš„åµŒå¥—çŠ¶æ€ç±»å‹ã€‚</i> <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemySpawnSequence</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">State</span></span> { EnemySpawnSequence sequence; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EnemySpawnSequence sequence</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sequence = sequence; } } }</code> </pre> <br> å½“æˆ‘ä»¬è¦å¼€å§‹æŒ‰é¡ºåºå‰è¿›æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„çŠ¶æ€å®ä¾‹ã€‚ å°†åºåˆ—æ·»åŠ åˆ°<code>Begin</code>æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•æ„é€ å¹¶è¿”å›çŠ¶æ€ã€‚ å› æ­¤ï¼Œæ¯ä¸ªè°ƒç”¨<code>Begin</code>éƒ½å°†è´Ÿè´£åŒ¹é…çŠ¶æ€ï¼Œå¹¶ä¸”åºåˆ—æœ¬èº«å°†ä¿æŒæ— çŠ¶æ€ã€‚ ç”šè‡³æœ‰å¯èƒ½ä»¥ç›¸åŒçš„é¡ºåºå¹³è¡Œå‰è¿›å‡ æ¬¡ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemySpawnSequence</span></span> { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Begin</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">State</span></span> { â€¦ } }</code> </pre> <br> ä¸ºäº†ä½¿çŠ¶æ€åœ¨çƒ­é‡å¯åä»ç„¶å­˜åœ¨ï¼Œæ‚¨éœ€è¦ä½¿å…¶å¯åºåˆ—åŒ–ã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">State</span></span> { â€¦ }</code> </pre> <br> è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯æ¯æ¬¡è¿è¡Œåºåˆ—æ—¶ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿å…¶æˆä¸ºç»“æ„è€Œä¸æ˜¯ç±»æ¥é¿å…å†…å­˜åˆ†é…ã€‚ åªè¦æƒ…å†µä»ç„¶å¾ˆå°ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚ è¯·è®°ä½ï¼ŒçŠ¶æ€æ˜¯ä¸€ç§å€¼ç±»å‹ã€‚ ä¼ è¾“åå°†è¢«å¤åˆ¶ï¼Œå› æ­¤è¯·åœ¨ä¸€ä¸ªä½ç½®è¿›è¡Œè·Ÿè¸ªã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> State { â€¦ }</code> </pre> <br> åºåˆ—çš„çŠ¶æ€ä»…åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼šç”Ÿæˆçš„æ•Œäººæ•°é‡å’Œæš‚åœæ—¶é—´çš„è¿›åº¦ã€‚ æˆ‘ä»¬æ·»åŠ äº†<code>Progress</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æš‚åœçš„å€¼å¢åŠ æ—¶é—´å¢é‡ï¼Œç„¶ååœ¨è¾¾åˆ°é…ç½®çš„å€¼æ—¶å°†å…¶é‡ç½®ï¼Œç±»ä¼¼äº<code>Game.Update</code>çš„ç”Ÿæˆæ—¶é—´ã€‚ æ¯å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šå¢åŠ æ•Œäººçš„æ•°é‡ã€‚ æ­¤å¤–ï¼Œæš‚åœå€¼å¿…é¡»ä»¥æœ€å¤§å€¼å¼€å¤´ï¼Œè¿™æ ·åºåˆ—å¯ä»¥åœ¨å¼€å§‹æ—¶æ²¡æœ‰æš‚åœçš„æƒ…å†µä¸‹åˆ›å»ºæ•Œäººã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cooldown; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EnemySpawnSequence sequence</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sequence = sequence; count = <span class="hljs-number"><span class="hljs-number">0</span></span>; cooldown = sequence.cooldown; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { cooldown += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (cooldown &gt;= sequence.cooldown) { cooldown -= sequence.cooldown; count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50c/aba/5e5/50caba5e50d89e05a6cb9a631feb1c6d.png" width="315" height="74"></div><br>  <i>çŠ¶æ€ä»…åŒ…å«å¿…è¦çš„æ•°æ®ã€‚</i> <br><br><div class="spoiler">  <b class="spoiler_title">æˆ‘å¯ä»¥ä»Stateè®¿é—®EnemySpawnSequence.cooldownå—ï¼Ÿ</b> <div class="spoiler_text"> æ˜¯çš„ï¼Œå› ä¸º<code>State</code>è®¾ç½®åœ¨ç›¸åŒçš„èŒƒå›´å†…ã€‚ å› æ­¤ï¼ŒåµŒå¥—ç±»å‹çŸ¥é“åŒ…å«å®ƒä»¬çš„ç±»å‹çš„ç§æœ‰æˆå‘˜ã€‚ </div></div><br> è¿›å±•å¿…é¡»æŒç»­åˆ°åˆ›å»ºæ‰€éœ€æ•°é‡çš„æ•Œäººå¹¶ç»“æŸæš‚åœä¸ºæ­¢ã€‚ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œâ€œ <code>Progress</code>åº”è¯¥æŠ¥å‘Šå®Œæˆï¼Œä½†æ˜¯æœ€æœ‰å¯èƒ½æˆ‘ä»¬å°†è·³è¿‡è¯¥å€¼ã€‚ å› æ­¤ï¼Œè¿™æ—¶æˆ‘ä»¬å¿…é¡»è¿”å›é¢å¤–çš„æ—¶é—´ï¼Œä»¥ä¾¿æŒ‰ä»¥ä¸‹é¡ºåºæå‰ä½¿ç”¨å®ƒã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å°†æ—¶é—´å¢é‡è½¬æ¢ä¸ºå‚æ•°ã€‚ æˆ‘ä»¬è¿˜éœ€è¦æŒ‡å‡ºæˆ‘ä»¬å°šæœªå®Œæˆï¼Œè¿™å¯ä»¥é€šè¿‡è¿”å›è´Ÿå€¼æ¥å®ç°ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> deltaTime</span></span></span><span class="hljs-function">)</span></span> { cooldown += deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (cooldown &gt;= sequence.cooldown) { cooldown -= sequence.cooldown; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count &gt;= sequence.amount) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cooldown; } count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1f</span></span>; }</code> </pre> <br><h3> åœ¨ä»»ä½•åœ°æ–¹åˆ¶é€ æ•Œäºº </h3><br> ä¸ºäº†ä½¿åºåˆ—äº§ç”Ÿæ•Œäººï¼Œæˆ‘ä»¬éœ€è¦å°†<code>Game.SpawnEnemy</code>è½¬æ¢ä¸ºå¦ä¸€ä¸ªå…¬å…±é™æ€æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnEnemy</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EnemyFactory factory, EnemyType type</span></span></span><span class="hljs-function">)</span></span> { GameTile spawnPoint = instance.board.GetSpawnPoint( Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, instance.board.SpawnPointCount) ); Enemy enemy = factory.Get(type); enemy.SpawnOn(spawnPoint); instance.enemies.Add(enemy); }</code> </pre> <br> ç”±äº<code>Game</code>æœ¬èº«ä¸å†ä¼šäº§ç”Ÿæ•Œäººï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»<code>Update</code>åˆ é™¤æ•Œäººçš„å·¥å‚ï¼Œåˆ›å»ºé€Ÿåº¦ï¼Œåˆ›å»ºä¿ƒè¿›è¿‡ç¨‹å’Œæ•Œäººåˆ›å»ºä»£ç ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br> åœ¨å¢åŠ æ•Œäººæ•°é‡ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨<code>EnemySpawnSequence.State.Progress</code>è°ƒç”¨<code>Game.SpawnEnemy</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> deltaTime</span></span></span><span class="hljs-function">)</span></span> { cooldown += deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (cooldown &gt;= sequence.cooldown) { â€¦ count += <span class="hljs-number"><span class="hljs-number">1</span></span>; Game.SpawnEnemy(sequence.factory, sequence.type); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1f</span></span>; }</code> </pre> <br><h3> æ³¢æµªå‰è¿› </h3><br> è®©æˆ‘ä»¬é‡‡ç”¨ä¸æ²¿æ•´ä¸ªæ³¢ç§»åŠ¨ç›¸åŒçš„æ–¹æ³•æ¥æ²¿åºåˆ—ç§»åŠ¨ã€‚ è®©æˆ‘ä»¬ç»™<code>EnemyWave</code>è‡ªå·±çš„<code>Begin</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›åµŒå¥—çš„<code>State</code>ç»“æ„çš„æ–°å®ä¾‹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒçŠ¶æ€åŒ…å«æ³¢ç´¢å¼•å’Œæ´»åŠ¨åºåˆ—çš„çŠ¶æ€ï¼Œæˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªåºåˆ—çš„å¼€å¤´è¿›è¡Œåˆå§‹åŒ–ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9eb/9f8/bc7/9eb9f8bc7769dd0c65624802ac2a97b8.png" width="315" height="128"></div><br>  <i>åŒ…å«åºåˆ—çŠ¶æ€çš„æ³¢åŠ¨çŠ¶æ€ã€‚</i> <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EnemyWave</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField] EnemySpawnSequence[] spawnSequences = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EnemySpawnSequence() }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Begin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> State { EnemyWave wave; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index; EnemySpawnSequence.State sequence; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EnemyWave wave</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wave = wave; index = <span class="hljs-number"><span class="hljs-number">0</span></span>; Debug.Assert(wave.spawnSequences.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Empty wave!"</span></span>); sequence = wave.spawnSequences[<span class="hljs-number"><span class="hljs-number">0</span></span>].Begin(); } } }</code> </pre> <br> æˆ‘ä»¬è¿˜æ·»åŠ äº†<code>EnemyWave.State</code>æ–¹æ³•<code>Progress</code> ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ä¸ä»¥å‰ç›¸åŒçš„æ–¹æ³•ï¼Œä½†æœ‰å°‘é‡æ›´æ”¹ã€‚ æˆ‘ä»¬ä»æ²¿æ´»åŠ¨åºåˆ—å¼€å§‹ï¼Œç„¶åç”¨æ­¤è°ƒç”¨çš„ç»“æœæ›¿æ¢æ—¶é—´å¢é‡ã€‚ å‰©ä¸‹çš„æ—¶é—´ï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªåºåˆ—ï¼ˆå¦‚æœå¯ä»¥è®¿é—®ï¼‰ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¿›åº¦ã€‚ å¦‚æœæ²¡æœ‰å‰©ä½™åºåˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿”å›å‰©ä½™æ—¶é—´ï¼› å¦åˆ™è¿”å›è´Ÿå€¼ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> deltaTime</span></span></span><span class="hljs-function">)</span></span> { deltaTime = sequence.Progress(deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deltaTime &gt;= <span class="hljs-number"><span class="hljs-number">0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++index &gt;= wave.spawnSequences.Length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deltaTime; } sequence = wave.spawnSequences[index].Begin(); deltaTime = sequence.Progress(deltaTime); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1f</span></span>; }</code> </pre> <br><h3> è„šæœ¬æ¨å¹¿ </h3><br> æ·»åŠ <code>GameScenario</code>çš„å¤„ç†ç›¸åŒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒçŠ¶æ€åŒ…å«æ³¢ç´¢å¼•å’Œæ´»åŠ¨æ³¢çš„çŠ¶æ€ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameScenario</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { [SerializeField] EnemyWave[] waves = {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Begin</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> State { GameScenario scenario; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index; EnemyWave.State wave; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameScenario scenario</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scenario = scenario; index = <span class="hljs-number"><span class="hljs-number">0</span></span>; Debug.Assert(scenario.waves.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Empty scenario!"</span></span>); wave = scenario.waves[<span class="hljs-number"><span class="hljs-number">0</span></span>].Begin(); } } }</code> </pre> <br> ç”±äºæˆ‘ä»¬å¤„äºé¡¶å±‚ï¼Œæ‰€ä»¥<code>Progress</code>æ–¹æ³•ä¸éœ€è¦å‚æ•°ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨<code>Time.deltaTime</code> ã€‚ æˆ‘ä»¬ä¸éœ€è¦è¿”å›å‰©ä½™æ—¶é—´ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ˜¾ç¤ºè„šæœ¬æ˜¯å¦å·²å®Œæˆã€‚ åœ¨æœ€åä¸€æ³¢ç»“æŸåï¼Œæˆ‘ä»¬å°†è¿”å›<code>false</code> ï¼Œå¹¶è¿”å›<code>true</code>ä»¥è¡¨æ˜è„šæœ¬ä»å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> deltaTime = wave.Progress(Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deltaTime &gt;= <span class="hljs-number"><span class="hljs-number">0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++index &gt;= scenario.waves.Length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } wave = scenario.waves[index].Begin(); deltaTime = wave.Progress(deltaTime); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3> è„šæœ¬è¿è¡Œ </h3><br> è¦æ’­æ”¾<code>Game</code>è„šæœ¬ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªè„šæœ¬é…ç½®å­—æ®µå¹¶è·Ÿè¸ªå…¶çŠ¶æ€ã€‚ æˆ‘ä»¬å°†åªåœ¨Awakeä¸­è¿è¡Œè„šæœ¬å¹¶å¯¹å…¶è¿è¡Œ<code>Update</code> ï¼Œç›´åˆ°æ¸¸æˆå…¶ä½™éƒ¨åˆ†çš„çŠ¶æ€<code>Update</code>ä¸ºæ­¢ã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] GameScenario scenario = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; GameScenario.State activeScenario; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { board.Initialize(boardSize, tileContentFactory); board.ShowGrid = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; activeScenario = scenario.Begin(); } â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ activeScenario.Progress(); enemies.GameUpdate(); Physics.SyncTransforms(); board.GameUpdate(); nonEnemies.GameUpdate(); }</code> </pre> <br> ç°åœ¨ï¼Œå·²é…ç½®çš„è„šæœ¬å°†åœ¨æ¸¸æˆå¼€å§‹æ—¶å¯åŠ¨ã€‚ å‡çº§å°†ä¸€ç›´è¿›è¡Œåˆ°å®Œæˆä¸ºæ­¢ï¼Œæ­¤åä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mk/x0/uf/mkx0ufxshpgvy29wjr_nxdmneu4.gif"></div><br>  <i>ä¸¤æ³¢åŠ é€Ÿäº†åå€ã€‚</i> <br><br><h2> å¼€å§‹å’Œç»“æŸæ¸¸æˆ </h2><br> æˆ‘ä»¬å¯ä»¥é‡ç°ä¸€ç§æƒ…å†µï¼Œä½†å®Œæˆåå°†ä¸ä¼šå‡ºç°æ–°çš„æ•Œäººã€‚ ä¸ºäº†ä½¿æ¸¸æˆç»§ç»­è¿›è¡Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿æ‰‹åŠ¨æˆ–ç”±äºç©å®¶è¾“/èµ¢çš„æ–°åœºæ™¯æˆä¸ºå¯èƒ½ã€‚ æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©å‡ ç§æ–¹æ¡ˆï¼Œä½†æ˜¯åœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬å°†ä¸è€ƒè™‘å®ƒã€‚ <br><br><h3> æ–°æ¸¸æˆçš„å¼€å§‹ </h3><br> ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æœ‰æœºä¼šåœ¨ä»»ä½•ç»™å®šæ—¶é—´å¯åŠ¨æ–°æ¸¸æˆã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦é‡ç½®æ•´ä¸ªæ¸¸æˆçš„å½“å‰çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸é‡ç½®è®¸å¤šå¯¹è±¡ã€‚ é¦–å…ˆï¼Œå‘<code>GameBehaviorCollection</code>æ·»åŠ ä¸€ä¸ª<code>Clear</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ©ç”¨å…¶æ‰€æœ‰è¡Œä¸ºã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; behaviors.Count; i++) { behaviors[i].Recycle(); } behaviors.Clear(); }</code> </pre> <br> è¿™è¡¨æ˜å¯ä»¥å¤„ç†æ‰€æœ‰è¡Œä¸ºï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤ã€‚ ä¸ºæ­¤ï¼Œè¯·å‘<code>GameBehavior</code>æ·»åŠ æŠ½è±¡çš„<code>Recycle</code>æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recycle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;</code> </pre> <br>  <code>WarEntity</code>ç±»çš„<code>Recycle</code>æ–¹æ³•å¿…é¡»æ˜¾å¼è¦†ç›–å®ƒã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recycle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { originFactory.Reclaim(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br>  <code>Enemy</code>è¿˜æ²¡æœ‰<code>Recycle</code>æ–¹æ³•ï¼Œå› æ­¤æ·»åŠ å®ƒã€‚ ä»–è¦åšçš„å°±æ˜¯è¿«ä½¿å·¥å‚é€€è¿˜å®ƒã€‚ ç„¶åï¼Œæˆ‘ä»¬åœ¨ç›´æ¥è®¿é—®å·¥å‚çš„ä»»ä½•åœ°æ–¹éƒ½ç§°ä¸º<code>Recycle</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GameUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Health &lt;= <span class="hljs-number"><span class="hljs-number">0f</span></span>) { Recycle(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } progress += Time.deltaTime * progressFactor; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (progress &gt;= <span class="hljs-number"><span class="hljs-number">1f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tileTo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Recycle(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } â€¦ } â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recycle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OriginFactory.Reclaim(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br>  <code>GameBoard</code>è¿˜éœ€è¦é‡ç½®ï¼Œå› æ­¤è®©æˆ‘ä»¬ç»™å®ƒæä¾›<code>Clear</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¸…ç©ºæ‰€æœ‰å›¾å—ï¼Œé‡ç½®æ‰€æœ‰åˆ›å»ºç‚¹å¹¶æ›´æ–°å†…å®¹ï¼Œç„¶åè®¾ç½®æ ‡å‡†èµ·ç‚¹å’Œç»ˆç‚¹ã€‚ ç„¶åï¼Œæ— éœ€é‡å¤ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>Initialize</code>çš„æœ«å°¾è°ƒç”¨<code>Clear</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector2Int size, GameTileContentFactory contentFactory </span></span></span><span class="hljs-function">)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; size.y; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; size.x; x++, i++) { â€¦ } } Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (GameTile tile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tiles) { tile.Content = contentFactory.Get(GameTileContentType.Empty); } spawnPoints.Clear(); updatingContent.Clear(); ToggleDestination(tiles[tiles.Length / <span class="hljs-number"><span class="hljs-number">2</span></span>]); ToggleSpawnPoint(tiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }</code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>BeginNewGame</code>æ–¹æ³•æ·»åŠ åˆ°<code>Game</code> ï¼Œè½¬å‚¨æ•Œäººï¼Œå…¶ä»–å¯¹è±¡å’Œå­—æ®µï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªæ–°è„šæœ¬ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginNewGame</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { enemies.Clear(); nonEnemies.Clear(); board.Clear(); activeScenario = scenario.Begin(); }</code> </pre> <br> å¦‚æœæ‚¨åœ¨ç»§ç»­æ‰§è¡Œè„šæœ¬ä¹‹å‰æŒ‰Bï¼Œæˆ‘ä»¬å°†åœ¨<code>Update</code>è°ƒç”¨æ­¤æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.B)) { BeginNewGame(); } activeScenario.Progress(); â€¦ }</code> </pre> <br><h3> è¾“äº† </h3><br> æ¸¸æˆçš„ç›®æ ‡æ˜¯åœ¨ä¸€å®šæ•°é‡çš„æ•Œäººåˆ°è¾¾ç»ˆç‚¹ä¹‹å‰å‡»è´¥æ‰€æœ‰æ•Œäººã€‚ è§¦å‘å¤±è´¥æ¡ä»¶æ‰€éœ€çš„æ•Œäººæ•°é‡å–å†³äºç©å®¶çš„åˆå§‹å¥åº·çŠ¶å†µï¼Œä¸ºæ­¤æˆ‘ä»¬å°†åœ¨<code>Game</code>æ·»åŠ ä¸€ä¸ªé…ç½®å­—æ®µã€‚ ç”±äºæˆ‘ä»¬è®¡ç®—æ•Œäººï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ•´æ•°ï¼Œè€Œä¸æ˜¯æµ®ç‚¹æ•°ã€‚ <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, Range(0, 100)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> startingPlayerHealth = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f3/9c5/11a/4f39c511ab9d362b1cc7e55610a317aa.png" width="320" height="38"></div><br>  <i>æœ€åˆï¼Œç©å®¶æœ‰10ç‚¹ç”Ÿå‘½ã€‚</i> <br><br> åœ¨â€œå”¤é†’â€æˆ–æ–°æ¸¸æˆå¼€å§‹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†åˆå§‹å€¼åˆ†é…ç»™ç©å®¶çš„å½“å‰å¥åº·çŠ¶å†µã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> playerHealth; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { playerHealth = startingPlayerHealth; â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginNewGame</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { playerHealth = startingPlayerHealth; â€¦ }</code> </pre> <br> æ·»åŠ ä¸€ä¸ªå…¬å…±çš„é™æ€<code>EnemyReachedDestination</code>æ–¹æ³•ï¼Œ <code>EnemyReachedDestination</code>æ•Œäººå¯ä»¥å‘Šè¯‰<code>Game</code>ä»–ä»¬å·²ç»åˆ°è¾¾ç«¯ç‚¹ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œè¯·å‡å°‘ç©å®¶çš„å¥åº·ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnemyReachedDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { instance.playerHealth -= <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br> åœ¨é€‚å½“çš„æ—¶é—´åœ¨<code>Enemy.GameUpdate</code>ä¸­è°ƒç”¨æ­¤æ–¹æ³•ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tileTo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Game.EnemyReachedDestination(); Recycle(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br> ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨<code>Game.Update</code>æ£€æŸ¥å¤±è´¥çš„æ¡ä»¶ã€‚ å¦‚æœç©å®¶çš„ç”Ÿå‘½å€¼ç­‰äºæˆ–å°äºé›¶ï¼Œåˆ™è§¦å‘å¤±è´¥æ¡ä»¶ã€‚ æˆ‘ä»¬åªéœ€è®°å½•æ­¤ä¿¡æ¯ï¼Œå¹¶åœ¨ç»§ç»­å‰è¿›ä¹‹å‰ç«‹å³å¼€å§‹ä¸€ä¸ªæ–°æ¸¸æˆã€‚ ä½†æ˜¯ï¼Œåªæœ‰åœ¨åˆæœŸå¥åº·çš„å‰æä¸‹ï¼Œæˆ‘ä»¬æ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚ è¿™ä½¿æˆ‘ä»¬å¯ä»¥å°†0ç”¨ä½œåˆå§‹å¥åº·çŠ¶å†µï¼Œä½¿å…¶ä¸å¯èƒ½ä¸¢å¤±ã€‚ å› æ­¤ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æµ‹è¯•è„šæœ¬ä¼šå¾ˆæ–¹ä¾¿ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (playerHealth &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; startingPlayerHealth &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Defeat!"</span></span>); BeginNewGame(); } activeScenario.Progress();</code> </pre> <br><h3> èƒœåˆ©çš„ </h3><br> å¤±è´¥çš„å¦ä¸€ç§é€‰æ‹©æ˜¯èƒœåˆ©ï¼Œå¦‚æœç©å®¶è¿˜æ´»ç€çš„è¯ï¼Œé‚£å°±æ˜¯åœ¨åœºæ™¯ç»“æŸæ—¶è·å¾—èƒœåˆ©ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“<code>GameScenario.Progess</code>çš„ç»“æœä¸º<code>false</code> ï¼Œæˆ‘ä»¬åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºä¸€ä¸ªèƒœåˆ©æ¶ˆæ¯ï¼Œå¼€å§‹ä¸€ä¸ªæ–°æ¸¸æˆï¼Œå¹¶ç«‹å³ç»§ç»­å‰è¿›ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (playerHealth &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Defeat!"</span></span>); BeginNewGame(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!activeScenario.Progress()) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Victory!"</span></span>); BeginNewGame(); activeScenario.Progress(); }</code> </pre> <br> ä½†æ˜¯ï¼Œå³ä½¿åœ¨åœºä¸Šä»ç„¶æœ‰æ•Œäººï¼Œèƒœåˆ©ä¹Ÿä¼šåœ¨æœ€åä¸€æ¬¡æš‚åœç»“æŸåæ‰èƒ½å‡ºç°ã€‚ æˆ‘ä»¬éœ€è¦å°†èƒœåˆ©æ¨è¿Ÿåˆ°æ‰€æœ‰æ•Œäººæ¶ˆå¤±ä¹‹å‰ï¼Œè¿™å¯ä»¥é€šè¿‡æ£€æŸ¥æ•Œäººçš„æ”¶è—æ˜¯å¦ä¸ºç©ºæ¥å®ç°ã€‚ æˆ‘ä»¬å‡å®šå®ƒå…·æœ‰<code>IsEmpty</code>å±æ€§ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!activeScenario.Progress() &amp;&amp; enemies.IsEmpty) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Victory!"</span></span>); BeginNewGame(); activeScenario.Progress(); }</code> </pre> <br> å°†æ‰€éœ€çš„å±æ€§æ·»åŠ åˆ°<code>GameBehaviorCollection</code> ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsEmpty =&gt; behaviors.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><h3> æ—¶é—´æ§åˆ¶ </h3><br> æˆ‘ä»¬è¿˜å®ç°æ—¶é—´ç®¡ç†åŠŸèƒ½ï¼Œè¿™å°†æœ‰åŠ©äºæµ‹è¯•ï¼Œé€šå¸¸æ˜¯ä¸€ç§æ¸¸æˆåŠŸèƒ½ã€‚ é¦–å…ˆï¼Œè®©<code>Game.Update</code>æ£€æŸ¥ç©ºæ ¼é”®ï¼Œå¹¶ä½¿ç”¨æ­¤äº‹ä»¶å¯ç”¨/ç¦ç”¨æ¸¸æˆä¸­çš„æš‚åœã€‚ è¿™å¯ä»¥é€šè¿‡åœ¨é›¶å’Œä¸€ä¹‹é—´åˆ‡æ¢<code>Time.timeScale</code>å€¼æ¥å®Œæˆã€‚ è¿™ä¸ä¼šæ”¹å˜æ¸¸æˆé€»è¾‘ï¼Œä½†æ˜¯ä¼šå†»ç»“æ‰€æœ‰å¯¹è±¡ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨éå¸¸å°çš„å€¼è€Œä¸æ˜¯0ï¼ˆä¾‹å¦‚0.01ï¼‰æ¥åˆ›å»ºææ…¢çš„è¿åŠ¨ã€‚ <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pausedTimeScale = <span class="hljs-number"><span class="hljs-number">0f</span></span>; â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { â€¦ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.Space)) { Time.timeScale = Time.timeScale &gt; pausedTimeScale ? pausedTimeScale : <span class="hljs-number"><span class="hljs-number">1f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.B)) { BeginNewGame(); } â€¦ }</code> </pre> <br> -,   <code>Game</code>    ,     . <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, Range(1f, 10f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> playSpeed = <span class="hljs-number"><span class="hljs-number">1f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5d/641/4e9/b5d6414e9cd53d7ac89c5c1b3699b806.png" width="320" height="38"></div><br> <i> .</i> <br><br>           ,     .         . <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.Space)) { Time.timeScale = Time.timeScale &gt; pausedTimeScale ? pausedTimeScale : playSpeed; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Time.timeScale &gt; pausedTimeScale) { Time.timeScale = playSpeed; }</code> </pre> <br><h2>   </h2><br>          .     ,           .      , ,      ,          . <br><br><h3>     </h3><br>   <code>GameScenario</code>      ,      1.   ,      .     ,    ,     ,  ,    . <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, Range(0, 10)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cycles = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0c/5d0/9df/d0c5d09dfd50e0e088c1848aaa32d531.png" width="320" height="38"></div><br> <i>   .</i> <br><br>  <code>GameScenario.State</code>    . <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cycle, index; EnemyWave.State wave; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameScenario scenario</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scenario = scenario; cycle = <span class="hljs-number"><span class="hljs-number">0</span></span>; index = <span class="hljs-number"><span class="hljs-number">0</span></span>; wave = scenario.waves[<span class="hljs-number"><span class="hljs-number">0</span></span>].Begin(); }</code> </pre> <br>  <code>Progress</code>       ,   <code>false</code> ,      .            . <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> deltaTime = wave.Progress(Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deltaTime &gt;= <span class="hljs-number"><span class="hljs-number">0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++index &gt;= scenario.waves.Length) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++cycle &gt;= scenario.cycles &amp;&amp; scenario.cycles &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } index = <span class="hljs-number"><span class="hljs-number">0</span></span>; } wave = scenario.waves[index].Begin(); deltaTime = wave.Progress(deltaTime); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3>  </h3><br>       ,        .    ,    .    ,          .            . <br><br>   <code>GameScenario</code>       .             . ,   0.5      Ã—1,     Ã—1.5,  Ã—2,  Ã—2.5,   . <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField, Range(0f, 1f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cycleSpeedUp = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>;</code> </pre> <br>        <code>GameScenario.State</code> .     1         .     <code>Time.deltaTime</code>    . <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeScale; EnemyWave.State wave; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GameScenario scenario</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scenario = scenario; cycle = <span class="hljs-number"><span class="hljs-number">0</span></span>; index = <span class="hljs-number"><span class="hljs-number">0</span></span>; timeScale = <span class="hljs-number"><span class="hljs-number">1f</span></span>; wave = scenario.waves[<span class="hljs-number"><span class="hljs-number">0</span></span>].Begin(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Progress</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> deltaTime = wave.Progress(timeScale * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deltaTime &gt;= <span class="hljs-number"><span class="hljs-number">0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++index &gt;= scenario.waves.Length) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++cycle &gt;= scenario.cycles &amp;&amp; scenario.cycles &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } index = <span class="hljs-number"><span class="hljs-number">0</span></span>; timeScale += scenario.cycleSpeedUp; } wave = scenario.waves[index].Begin(); deltaTime = wave.Progress(deltaTime); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qv/-d/3s/qv-d3srpikyuiorxx9vjk06wir8.gif"></div><br> <i>      ;    .</i> <br><br>       ?      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Patreon</a> ! <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  PDF</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466855/">https://habr.com/ru/post/zh-CN466855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466839/index.html">è¯ºé¡¿æŒ‡æŒ¥å®˜çš„åˆ›ä½œæ•…äº‹ã€‚ ç¬¬1/3éƒ¨åˆ†</a></li>
<li><a href="../zh-CN466841/index.html">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŠ çƒ­å«ï¼ˆå¦‚æœæœ‰ç¬”è®°æœ¬ç”µè„‘ï¼‰ï¼šåœ¨åŸå­çº§ç ”ç©¶çƒ­é˜»</a></li>
<li><a href="../zh-CN466845/index.html">åå‘é‡‡è®¿ï¼šé—®å…¬å¸ä»€ä¹ˆé—®é¢˜ï¼Ÿ</a></li>
<li><a href="../zh-CN466849/index.html">noexcept-ctcheckæˆ–ä¸€äº›ç®€å•çš„å®æ¥å¸®åŠ©ç¼–è¯‘å™¨ç¼–å†™noexceptä»£ç </a></li>
<li><a href="../zh-CN466851/index.html">Agilexç³»åˆ—-10nm Intel FPGA</a></li>
<li><a href="../zh-CN466857/index.html">iOS 13ä¸­çš„åå°åº”ç”¨ç¨‹åºæ‰§è¡Œ</a></li>
<li><a href="../zh-CN466859/index.html">ä½¿ç”¨AD Federation ServiceæˆæƒAWSç”¨æˆ·è¿›è¡Œæƒåˆ©åˆ†é…</a></li>
<li><a href="../zh-CN466861/index.html">å¦‚ä½•ä½¿ç”¨é»‘å®¢é©¬æ‹‰æ¾é€ƒé¿ç°å®</a></li>
<li><a href="../zh-CN466863/index.html">è®¾ç½®æ¸è¿‘çº¿</a></li>
<li><a href="../zh-CN466865/index.html">ç­‰å¾…11æœˆ1æ—¥ï¼šç¦æ­¢æˆ–ä½¿åŠ å¯†è´§å¸åˆæ³•åŒ–</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>