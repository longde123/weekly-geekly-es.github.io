<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíî üïµüèø üë®‚Äçüë®‚Äçüëß‚Äçüëß Como construir uma arquitetura IIoT fa√ßa voc√™ mesmo ü§¥üèæ üìï üë©‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No ano passado, projetamos (e continuamos a apoiar) v√°rios projetos de IIoT. Voc√™ j√° deve ter ouvido falar sobre a IIoT, mas, no caso, tentaremos expl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como construir uma arquitetura IIoT fa√ßa voc√™ mesmo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/415933/"><p>  No ano passado, projetamos (e continuamos a apoiar) v√°rios projetos de IIoT.  Voc√™ j√° deve ter ouvido falar sobre a IIoT, mas, no caso, tentaremos explicar da maneira mais simples poss√≠vel o que √© e por que √© interessante para desenvolvedores, arquitetos e administradores de solu√ß√µes altamente carregadas. </p><br><p><img src="https://habrastorage.org/webt/4v/ah/zc/4vahzcmpo0wh-i7hhutwxwzjjkk.png"></p><br><p>  A IoT - a Internet das coisas - envolve o controle de dispositivos projetados para executar tarefas dom√©sticas simples (abra a porta da garagem quando o carro parar, acenda a luz usando um sensor ou comando de movimento, monitore a temperatura ambiente) e, em seguida, sob a IIoT - a Internet industrial das coisas - geralmente h√° tendo em vista a ‚Äúdigitaliza√ß√£o‚Äù dos dados das ind√∫strias, com base nas quais an√°lises especializadas podem ser realizadas, geralmente com a ajuda do aprendizado de m√°quina. </p><a name="habracut"></a><br><p>  Por exemplo, voc√™ pode coletar e analisar dados de motores rotativos para aprender sobre falhas no tempo e economizar em reparos.  Substituir uma turbina completamente quebrada √© muito mais caro do que um reparo oportuno.  Outro exemplo √© a minera√ß√£o de carv√£o.  A an√°lise de dados sobre a composi√ß√£o do ar nas minas permite que voc√™ responda a tempo de exceder os valores permitidos.  Isso ajuda a evitar situa√ß√µes de risco de vida para os mineiros. </p><br><p>  O fluxo de dados - dos sensores nos campos, das m√°quinas industriais, dos sensores de g√°s - vai para os agregados de hubs e, al√©m disso, para a plataforma de processamento e an√°lise de dados. </p><br><p>  Queremos falar sobre a apar√™ncia de uma arquitetura, como coletar e analisar dados de maneira bastante simples, e nos concentrarmos nas especificidades de aplicativos individuais.  Contaremos com tradu√ß√µes de artigos em ingl√™s e nossa pr√≥pria experi√™ncia em design.  Este artigo est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">traduzido</a> com nossas explica√ß√µes e adi√ß√µes. </p><br><p>  No primeiro artigo, tentaremos criar uma arquitetura IIoT, na qual transmitiremos ainda mais os dados dos sensores e depois os transferiremos para um sistema que fornece processamento, an√°lise, aprendizado de m√°quina e monitoramento dos dados recebidos. </p><br><h3 id="sozdavaemaya-arhitektura">  Arquitetura criada </h3><br><p> Freq√ºentemente, na IoT industrial, n√£o h√° acesso direto aos sensores e sistemas de controle; portanto, um gateway √© usado para conectar os n√≠veis OT (tecnologia operacional) e TI (tecnologia da informa√ß√£o). </p><br><p>  Assim, a arquitetura IIoT geralmente inclui: dispositivos finais, gateways, hubs regionais e, finalmente, sistemas de processamento e armazenamento de informa√ß√µes. </p><br><p>  A arquitetura criada deve oferecer uma oportunidade: </p><br><ul><li>  Colete dados dos sensores para o gateway </li><li>  Transferir dados para a nuvem ou data center </li><li>  Atualizar automaticamente configura√ß√µes de gateway </li><li>  Manter transfer√™ncia e processamento seguros de dados </li></ul><br><p>  Na imagem: arquitetura do sistema e software criados que usaremos para constru√≠-lo em cada n√≠vel. </p><br><p><img src="https://habrastorage.org/webt/pb/g9/ei/pbg9eiqinl-rarf31fvlpinih9o.png"></p><br><p>  Os sensores coletam dados e os enviam para o gateway usando uma variedade de protocolos com e sem fio (Serial, RS-485, MODBUS, barramento CAN, OPC UA, BLE, WiFi, etc.).  Em nosso exemplo, teremos em mente que os dados chegam ao gateway via Wi-Fi. </p><br><p>  Como gateway, usaremos o Raspberry Pi, no qual o intermedi√°rio Mosquitto e o agente MiNiFi ser√£o lan√ßados.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mosquitto</a> √© um broker de mensagens leve e de c√≥digo aberto que usaremos para transmitir dados a partir de sensores usando o protocolo MQTT.  O MQTT adiciona uma sobrecarga m√≠nima e, portanto, √© conveniente para uso na IoT quando os recursos de hardware dos dispositivos finais s√£o limitados (por exemplo, telefones e microcontroladores s√£o usados). </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apache MiNiFi</a> - um subprojeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apache NiFi</a> - um agente leve que implementa a funcionalidade principal do Apache NiFi, projetado especificamente para coletar dados em dispositivos finais. </p><br><p>  O MiNiFi √© compacto, utiliza minimamente os recursos e permite o gerenciamento centralizado de todos os agentes.  Ele se conecta facilmente ao NiFi usando o Site-to-Site (S2S), o que permite criar um controle completo do fluxo de dados - escal√°vel, seguro e com uma ideia clara de todos os est√°gios da transfer√™ncia de informa√ß√µes. </p><br><p>  Em nosso sistema, o MiNiFi se inscrever√° em todos os t√≥picos do broker Mosquitto e encaminhar√° cada mensagem ao NiFi definido no n√≠vel regional.  Voc√™ tamb√©m pode us√°-lo para conectar-se a um sistema SCADA ou qualquer outra fonte de dados OT. </p><br><p>  No n√≠vel regional, existem dois componentes: </p><br><p>  O Apache NiFi √© um poderoso sistema de gerenciamento de fluxo de dados que suporta mais de 200 conectores.  Uma interface gr√°fica permite projetar r√°pida e facilmente fluxos de dados. </p><br><p>  O NiFi n√£o sacrifica o poder pela simplicidade.  √â um sistema distribu√≠do bem escal√°vel, com entrega garantida, contrapress√£o (a capacidade de armazenar dados antes de envi√°-los para outros sistemas mais lentos) e balanceamento de carga.  Essa funcionalidade faz do NiFi uma excelente ferramenta para aplicativos de IoT que geralmente funcionam em ambientes de rede inst√°veis. </p><br><p>  Em nosso sistema, o NiFi √© um centro de coleta de dados que os redireciona para v√°rios sistemas e aplicativos (HDFS, HBase, Kafka, S3 etc.). </p><br><p>  O MiNiFi C2 Server (Comando e Controle do MiNiFi) √© outro subprojeto do Apache NiFi que ainda est√° em desenvolvimento.  Seu papel √© ser o ponto central da configura√ß√£o de centenas e milhares de agentes de MiNiFi que est√£o em produ√ß√£o no campo (v√°rias salas, f√°bricas, territ√≥rios).  O servidor C2 gerencia as configura√ß√µes de fluxo MiNiFi (na terminologia C2 - classe de aplicativos com vers√£o) e as publica por meio da API Rest.  Os agentes MiNiFi podem se conectar a essa API em uma determinada frequ√™ncia para atualizar sua pr√≥pria configura√ß√£o. </p><br><p>  Ent√£o, vamos come√ßar a criar nosso prot√≥tipo. </p><br><h4 id="soglashenie-o-imenovanii-domennyh-imen">  Contrato de Nome de Dom√≠nio </h4><br><p>  Para configura√ß√µes adicionais dos v√°rios sistemas que devem entrar em contato, vamos concordar com os nomes de dom√≠nio que usaremos nas configura√ß√µes. </p><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Apache NiFi      192.168.0.20 nifi.iot.local #  Apache MiNiFi C2     MiNiFi 192.168.0.20 minifi-c2.iot.local #raspberry pi,      Apache MiNiFi  MQTT  192.168.0.68 iot-hub-1.iot.local</span></span></code> </pre> <br><h4 id="podgotovka-raspberry-pi-mqtt-i-minifi">  Prepara√ß√£o para Raspberry Pi: MQTT e MiNiFi </h4><br><p>  Para instalar o broker MQTT Mosquitto e o agente MiNiFi, execute os seguintes comandos no seu Raspberry Pi. </p><br><p>  Por padr√£o, o MiNiFi cont√©m um conjunto m√≠nimo de manipuladores de dados.  √â poss√≠vel adicionar manipuladores adicionais do kit NiFI adicionando um arquivo NAR (arquivo NiFi) ao diret√≥rio da biblioteca. </p><br><p>  Com o √∫ltimo comando, adicionamos o manipulador NAR MQTT. </p><br><pre> <code class="bash hljs">sudo apt-get update <span class="hljs-comment"><span class="hljs-comment">#install and run Mosquitto broker on default port 1883 sudo apt-get install mosquitto mosquitto #install and prepare MiNiFi agent wget http://apache.crihan.fr/dist/nifi/minifi/0.4.0/minifi-0.4.0-bin.tar.gz tar -xvf minifi-0.4.0-bin.tar.gz cd minifi-0.4.0 #add mqtt processor wget https://github.com/ahadjidj-hw/NiFi/raw/master/nifi-mqtt-nar-1.5.0.nar -P ./lib/</span></span></code> </pre> <br><p>  Agora vamos instalar o servidor de gerenciamento de configura√ß√£o MiNiFi C2 no servidor que estar√° dispon√≠vel com o Raspberry Pi </p><br><h4 id="ustanovka-i-konfigurirovanie-minifi-c2-servera">  Instala√ß√£o e configura√ß√£o do servidor MiNiFi C2. </h4><br><p>  Instale o servidor MiNiFi C2 em um servidor p√∫blico que estar√° dispon√≠vel com os agentes do MiNiFi.  Voc√™ pode usar a distribui√ß√£o hier√°rquica de servidores C2 para infraestruturas de rede complexas, conforme descrito abaixo.  Execute o seguinte comando para instalar o servidor C2: </p><br><pre> <code class="bash hljs">wget http://apache.crihan.fr/dist/nifi/minifi/0.4.0/minifi-c2-0.4.0-bin.tar.gz tar -xvf minifi-c2-0.4.0-bin.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> minifi-c2-0.4.0</code> </pre> <br><ul><li>  O servidor C2 publicar√° a configura√ß√£o organizada da classe.  O C2 suporta "provedores de configura√ß√£o" conect√°veis: </li><li>  O CacheConfigurationProvider, que atualiza a configura√ß√£o com base na configura√ß√£o especificada no sistema de arquivos ou no S3 </li><li>  O DelegatingConfigurationProvider, que passa a delega√ß√£o para outro servidor C2 para criar estruturas hier√°rquicas de servidores C2. </li><li>  O NiFiRestConfigurationProvider, que remove modelos dos servidores Apache NiFi por meio de sua API REST. </li></ul><br><p>  Vamos configurar o servidor C2 para usar o NiFi como um provedor de configura√ß√£o.  Edite o arquivo ./conf/minifi-c2-context.xml, descomente o bloco xml </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.nifi.minifi.c2.provider.nifi.rest.NiFiRestConfigurationProvider"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  e anote o endere√ßo do servidor NiFi ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: //nifi.iot.local: 8080</a> ) </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>http://nifi.iot.local:8080/nifi-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4 id="dalneyshee-konfigurirovanie-minifi-na-raspberry-pi">  Outras configura√ß√µes do MiNiFi no Raspberry Pi </h4><br><p>  Por padr√£o, para adicionar manipuladores e suas configura√ß√µes, voc√™ precisa editar a configura√ß√£o ./conf/config.yml.  A configura√ß√£o tamb√©m pode ser escrita manualmente ou criada usando a GUI do Apache NiFi, seguida pela exporta√ß√£o da configura√ß√£o como um modelo.  Um modelo √© um arquivo XML que deve ser convertido em um arquivo de configura√ß√£o YML do MiMLiFi usando o kit de ferramentas do MiNiFi.  Aqui est√° um exemplo de arquivo de configura√ß√£o que monitora o arquivo no dispositivo e encaminha cada nova linha para o NiFi usando o protocolo S2S. </p><br><p>  Para o nosso projeto, n√£o usaremos o ajuste manual.  De fato, se houver muitos agentes MiNiFi, n√£o ser√° f√°cil parar manualmente, editar o config.yml e reiniciar o agente sempre que a configura√ß√£o for alterada. </p><br><p>  O MiNiFi usa o Change Ingestor, com o qual o agente aprende sobre as novas configura√ß√µes poss√≠veis.  O Change Ingestor √© um plug-in e h√° tr√™s ChangeIngestor que s√£o suportados originalmente pelo MiNiFi. </p><br><ul><li>  FileChangeIngestor </li><li>  RestChangeIngestor </li><li>  PullHttpChangeIngestor </li></ul><br><p>  Usaremos o PullHttpChangeIngestor para acessar periodicamente o servidor C2 e baixar a nova configura√ß√£o.  Para configurar este Ingestor, voc√™ precisa editar o arquivo ./conf/bootstrap.conf, descomente as linhas correspondentes e defina as seguintes configura√ß√µes: </p><br><pre> <code class="bash hljs">nifi.minifi.notifier.ingestors=org.apache.nifi.minifi.bootstrap.configuration.ingestors.PullHttpChangeIngestor <span class="hljs-comment"><span class="hljs-comment"># Hostname on which to pull configurations from nifi.minifi.notifier.ingestors.pull.http.hostname=minifi-c2.iot.local # Port on which to pull configurations from nifi.minifi.notifier.ingestors.pull.http.port=10080 # Path to pull configurations from nifi.minifi.notifier.ingestors.pull.http.path=/c2/config # Query string to pull configurations with nifi.minifi.notifier.ingestors.pull.http.query=class=iot-minifi-raspberry-agent # Period on which to pull configurations from, defaults to 5 minutes if commented out nifi.minifi.notifier.ingestors.pull.http.period.ms=60000</span></span></code> </pre> <br><p>  Com essa configura√ß√£o, cada agente MiNiFi acessar√° o servidor C2 usando o protocolo API REST em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: //minifi-c2.iot.local: 10080 / c2 / config a</a> cada minuto e solicitar√° uma nova configura√ß√£o para a classe iot-minifi-raspberry-agent <br>  Um ponto importante: a frequ√™ncia de 1 minuto √© configurada apenas para demonstra√ß√£o.  Em um ambiente de produ√ß√£o, voc√™ provavelmente n√£o precisar√° atualizar agentes com essa frequ√™ncia. </p><br><p>  Antes de iniciar o agente, vamos para o n√≠vel de controle e configure o servidor MiNiFi C2 e o pr√≥prio Apache NiFi. </p><br><h4 id="ustanovka-i-konfigurirovanie-nifi-servera">  Instalando e configurando um servidor NiFi </h4><br><p>  Instale o servidor NiFi acess√≠vel no servidor C2 e inicie-o. </p><br><pre> <code class="bash hljs">wget http://apache.crihan.fr/dist/nifi/1.6.0/nifi-1.6.0-bin.tar.gz tar -xvf nifi-1.6.0-bin.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nifi-1.6.0 ./bin/nifi.sh start</code> </pre> <br><p>  Conecte-se √† interface NiFi em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // nifi-dev: 8080 / nifi /</a> e crie um fluxo que ser√° executado nos agentes MiNiFi, mas antes disso adicione a Porta de entrada (adicionada pressionando o bot√£o Porta de entrada no menu) na camada raiz e nomeie-a de Raspberry MiNiFi.  √â aqui que o NiFi receber√° arquivos de fluxo do MiNiFi. </p><br><p>  Adicione Funil e conecte a Porta de Entrada ao Funil - em artigos futuros, abordaremos o processamento de dados no lado Apache NiFi. </p><br><p>  Inclua um consumeMQTT do processador para assinar o broker do Mosquitto e inscreva-o em todos os t√≥picos iot / sensores / * observe que tcp: // raspberrypi: 1883 √© equivalente a tcp: // localhost: 1883, pois esse encadeamento ser√° executado no Raspberry Pi </p><br><p><img src="https://habrastorage.org/webt/lx/pk/vf/lxpkvfs8-shmdy1newdrmvrxc2w.png"></p><br><p>  Use o Processor UpdateAttribute para adicionar o atributo "version", que usaremos para notificar o sistema sobre a reconfigura√ß√£o.  Voc√™ pode adicionar atributos adicionais: registro de data e hora, local, nome do agente etc. </p><br><p><img src="https://habrastorage.org/webt/ah/de/6o/ahde6oblujww3keigvuzk_jjoje.png"></p><br><p>  Por fim, adicione o Remote Process Group (RPG) - para enviar eventos recebidos ao NiFi.  Combine todos os tr√™s desses processos. </p><br><p><img src="https://habrastorage.org/webt/up/re/sf/upresfdp_hwcku4z4lykpp6upzc.png"></p><br><p>  Seu stream agora deve aparecer na captura de tela abaixo.  O fluxo esquerdo ser√° iniciado no pr√≥prio Apache NiFi e receber√° dados do Apache MiNiFi.  O encadeamento do lado direito n√£o ser√° iniciado no Apache Nifi, criado para fins de configura√ß√£o e prototipagem, e ser√° executado no Raspberry Pi. </p><br><p><img src="https://habrastorage.org/webt/9q/jh/fi/9qjhfidv9dmhcxwlbu5bnwtafpk.png"></p><br><p>  Salve o fluxo correto como um modelo chamado "iot-minifi-raspberry-agent.v1".  O princ√≠pio de nomea√ß√£o √© extremamente importante aqui.  Devemos usar o mesmo nome que o nome da classe usado na configura√ß√£o do MiNiFi. </p><br><p>  <em>√â muito importante - voc√™ precisa destacar n√£o apenas os componentes armazenados, mas tamb√©m os relacionamentos entre eles.</em> <em><br></em> </p><br><p><img src="https://habrastorage.org/webt/zw/7u/8p/zw7u8prl5qspooe5igan-b7cy6c.png"></p><br><h4 id="razmeschenie-i-zapusk-prilozheniya">  Coloca√ß√£o e lan√ßamento do aplicativo </h4><br><p>  Antes de iniciar os agentes MiNiFi no Raspberry Pi, vamos verificar se o servidor C2 est√° configurado corretamente.  Abra o URL no seu navegador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // c2-server: 10080 / c2 / config? Class = iot-minifi-raspberry-agent &amp; version = 1 O</a> servidor C2 deve responder com um arquivo que cont√©m a configura√ß√£o do modelo que criamos no formato YML. </p><br><p><img src="https://habrastorage.org/webt/-2/b-/oj/-2b-oj_o1-wcxszifh4zopzmkd8.png"></p><br><p>  Se, em vez da configura√ß√£o, o servidor lan√ßar Java Exception, voc√™ encontrar√° um problema no servidor C2 mencionado aqui: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/apache/nifi-minifi/pull/126#issuecomment-388856304</a> <br>  Voc√™ precisar√° instalar a vers√£o 0.3.0 ou remover o arquivo javax.ws.rs-api-2.1.jar da pasta lib do diret√≥rio do servidor C2. </p><br><p>  Se voc√™ observar os logs do servidor C2, poder√° ver que o servidor aceitou a solicita√ß√£o com os par√¢metros {class = [agente-minifi-raspberry-iot], vers√£o = [1]} </p><br><p><img src="https://habrastorage.org/webt/ov/u_/r-/ovu_r-lyumqz9l_j_qpigysyuoe.png"></p><br><p>  Agora que a conex√£o entre os componentes da arquitetura individual (MQTT, MiNiFi, NiFi e C2) foi estabelecida, inicie o agente MiNiFi no Raspberry Pi usando o comando: </p><br><pre> <code class="bash hljs">./bin/minifi.sh start</code> </pre> <br><p>  Ap√≥s alguns segundos, voc√™ dever√° ver os logs do servidor C2.  O host 192.168.1.50 (no nosso caso, o endere√ßo IP do dispositivo Raspberry Pi) solicitou ao servidor C2 que fornecesse a vers√£o mais recente da classe ‚Äúiot-minifi-raspberry-agent‚Äù.  Em compara√ß√£o com a nossa solicita√ß√£o anterior, que fizemos no navegador, voc√™ pode observar que o MiNiFi n√£o indicou a vers√£o.  Se voc√™ abrir a configura√ß√£o do agente MiNiFi em ./conf/config.yml, ver√° a mesma configura√ß√£o que recebemos no navegador, definindo a solicita√ß√£o manualmente. </p><br><p><img src="https://habrastorage.org/webt/mx/iz/kt/mxizktf5jxyrrqz2k3wtvzjrtx0.png"></p><br><p>  O MQTT mostra que o agente MiNiFi se conectou ao broker e se inscreveu nos t√≥picos iot / sensores / # </p><br><p><img src="https://habrastorage.org/webt/5r/3m/gy/5r3mgyboojzkkldhcmxicengpsu.png"></p><br><h4 id="kontrol-peredavaemyh-dannyh">  Controle de transmiss√£o </h4><br><p>  √ìtimo, agora vamos fazer com que nossos sensores comecem a gerar dados e public√°-los no MQTT.  O MiNiFi come√ßar√° a enviar informa√ß√µes e enviar para o NiFi, conforme mostrado na captura de tela abaixo. </p><br><p>  <em>Importante: Para que o componente Apache NiFi comece a funcionar, voc√™ deve clicar no bot√£o Reproduzir.</em> <em><br></em> <br><img src="https://habrastorage.org/webt/0z/h_/qu/0zh_qu6j5ftih7dgmupq7we3b4e.png"></p><br><p>  Agora, vamos dar uma olhada em uma dessas postagens dentro do NiFi.  As informa√ß√µes s√£o provenientes do sensor ‚Äúiot / sensores / LightIntensity / z‚Äù, vers√£o do aplicativo - 1 </p><br><p><img src="https://habrastorage.org/webt/pj/zh/ie/pjzhiekpoq8vqe4wgipbjxgiwha.png"></p><br><h4 id="obnovlenie-konfiguracii-minifi">  Atualiza√ß√£o da configura√ß√£o do MiNiFi </h4><br><p>  Agora que nossa infraestrutura est√° funcionando e os dados est√£o indo para o nosso "centro de dados", vamos instalar uma nova configura√ß√£o MiNiFi.  V√° para a interface Apache NiFi e edite o manipulador updateAttribute.  Altere o atributo "version" para 2 em vez de 1 e salve o novo modelo "iot-minifi-raspberry-agent.v2".  Isso √© tudo.  A nova configura√ß√£o ser√° implantada automaticamente. </p><br><p>  Voc√™ pode ver os logs do servidor C2 e ver que uma nova vers√£o do V2 foi detectada, o servidor n√£o o encontrou no cache e o carregou. </p><br><p><img src="https://habrastorage.org/webt/cm/-4/sc/cm-4sccwolb-9dnpd4f88fga5pk.png"></p><br><p>  Ent√£o o MiNiFi descobre a nova configura√ß√£o, reserva a configura√ß√£o anterior, descarrega a nova e reinicia: </p><br><p><img src="https://habrastorage.org/webt/w-/tv/44/w-tv44lsbcmdb0ckfdnue4r4iya.png"></p><br><blockquote>  No pr√≥ximo artigo, falaremos sobre como montamos os sensores e os incorporamos √† nossa arquitetura.  Depois disso, falaremos sobre an√°lise de dados. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415933/">https://habr.com/ru/post/pt415933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415919/index.html">Refatorando um programa em movimento: acelera√ß√£o 23 vezes</a></li>
<li><a href="../pt415923/index.html">A unidade √© lenta? Cuidado LINQ</a></li>
<li><a href="../pt415925/index.html">MasterCard patenteada tecnologia blockchain an√¥nima</a></li>
<li><a href="../pt415927/index.html">L√¢mpada industrial Breeze 50</a></li>
<li><a href="../pt415929/index.html">Otimiza√ß√£o da arquitetura de intelig√™ncia artificial: a corrida come√ßa</a></li>
<li><a href="../pt415935/index.html">Classifica√ß√µes de inser√ß√£o</a></li>
<li><a href="../pt415937/index.html">Foguete particular japon√™s MOMO-2 explodiu na plataforma de lan√ßamento</a></li>
<li><a href="../pt415939/index.html">Processamento de gr√°fico distribu√≠do com Spark GraphX</a></li>
<li><a href="../pt415941/index.html">Como tentamos descobrir o c√≥digo de barras e n√£o entendemos nada</a></li>
<li><a href="../pt415943/index.html">"Desenvolvimento de jogos e teoria do entretenimento": pontos-chave do livro de Raff Coster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>