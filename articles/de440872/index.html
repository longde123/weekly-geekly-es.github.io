<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöπ üç¨ üîå PostGIS und JPA üë®üèº‚Äçüè≠ üèØ ü•©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PostGIS ist eine Open Source-Software, die der relationalen PostgreSQL-Datenbank Unterst√ºtzung f√ºr geografische Funktionen hinzuf√ºgt. 

 In diesem kur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostGIS und JPA</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440872/"><img src="https://habrastorage.org/webt/vw/el/t-/vwelt-o8fpxf22rlkq5zvcjzqag.png"><br><br>  PostGIS ist eine Open Source-Software, die der relationalen PostgreSQL-Datenbank Unterst√ºtzung f√ºr geografische Funktionen hinzuf√ºgt. <br><br>  In diesem kurzen Artikel wird die Verwendung in Java erl√§utert.  Insbesondere die Aufgabe, geografische Objekte anhand ihrer Koordinaten zu finden. <br><a name="habracut"></a><br>  PostGIS wurde bereits 2001 erstellt.  Es ist eine gute kostenlose L√∂sung zum Speichern von Kartendaten in der Datenbank.  In dem Artikel geht es jedoch nicht nur um ihn, sondern nur um einen Sonderfall - die bequeme Arbeit mit PostGIS mithilfe von JPA-Tools. <br><br><h3>  Abh√§ngigkeiten </h3><br>  Folgende Bibliotheken sind f√ºr unsere Aufgabe wichtig: <br><br><ul><li>  Ruhezustand 5.3.7 </li><li>  <b>Ruhezustand-r√§umlich</b> - gleiche Version.  Theoretisch k√∂nnen Sie die √§lteren verwenden.  Ab dem f√ºnften ist der r√§umliche Ruhezustand derselbe wie der Ruhezustand.  Zuvor: Hibernate Spatial 1.1.x f√ºr Hibernate 3.6.x, Hibernate Spatial 1.0 f√ºr Hibernate 3.2.x - 3.5.x. </li><li>  postgresql 42.2.4.  Diese Version wurde √ºbernommen, da neuere die SSL-Anforderungen versch√§rften.  W√§hlen Sie die Treiberversion, die der Datenbankversion entspricht. </li></ul><br>  Alles, was Sie f√ºr JPA ben√∂tigen, ist Spring oder ein Container. <br><br><h3>  Dialekte </h3><br>  Hibernate Spatial bietet geometrische <b>Abstraktionen</b> f√ºr die Arbeit mit r√§umlichen Basen.  Wie bei JPA interessiert uns in erster N√§herung nicht, welche Datenbank auf dem Server verwendet wird. <br><br>  Offiziell unterst√ºtzt von PostgresSQL, Oracle, MySQL, MS SQL Server, GeoDB (H2), DB2.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Features Support-Details</a> .  Muskel scheint wie ein Au√üenseiter.  In Version 8 wird die Unterst√ºtzung von Geodaten jedoch erheblich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verbessert</a> . <br><br>  Wir verwenden Postgres.  Sie m√ºssen jedoch den Hibernate-Dialekt <code>"org.hibernate.spatial.dialect.postgis.PostgisDialect"</code> <b>anstelle des</b> standardm√§√üigen <code>"org.hibernate.spatial.dialect.postgis.PostgisDialect"</code> Dialekts angeben. <br><br><h3>  Es ist Zeit zu codieren </h3><br>  Eine Tabelle in PostGIS kann beliebige Felder enthalten.  Nur Standard, einer von ihnen wird vom Typ Geometrie sein.  Und es gibt Geografie (wird im Ruhezustand derzeit nicht unterst√ºtzt).  Wenn Sie Java nicht beibringen, mit diesem Typ zu arbeiten, wird es als Blob oder String der Form "01010000207B7F0000188D594CC9B22541BC4E56674F2C5541" interpretiert. <br><br>  Nat√ºrlich k√∂nnen Sie mit PostGis an einem reinen JBDC arbeiten.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein Beispiel</a> .  Dies erfordert jedoch eine separate sorgf√§ltige Arbeit mit <code>org.postgis.PGgeometry</code> .  Dies sind nicht die Klassen, um die es in dem Artikel geht.  Und es wird keine Toleranz mehr geben. <br><br>  Wir gehen zu JPA und erstellen eine einfache Klasse: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdressBuilding</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Point geom; ...</code> </pre><br>  Die verbleibenden Felder werden weggelassen (ein geografisches Objekt kann alle Informationen speichern).  Hier ist nichts Ungew√∂hnliches - die Standardentit√§tsklasse.  Interessant ist nur ein Objekt der Klasse Point - ein Punkt des dreidimensionalen Raumes. <br><br>  Im Folgenden werden Klassen aus dem Paket com.vividsolutions.jts.geom verwendet. <br><br>  JTS ist zum De-facto-Standard f√ºr die Darstellung von Geodaten geworden.  Es implementiert die von OpenGIS in den 90er Jahren erstellte Spezifikation Simple Feature Specification / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Simple Feature Access</a> . <br><br>  <i>Klarstellung</i> .  Punkt erbt von der abstrakten Geometrieklasse.  Es enth√§lt die folgenden nicht statischen Felder: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Envelope envelope; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> GeometryFactory factory; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SRID; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Object userData;</code> </pre> <br>  Umschlag ist der minimale Begrenzungsrahmen f√ºr diese Geometrie.  Aber es kann in Form von Geometrie zur√ºckkommen.  Und dann haben Sie einen endlosen Versuch der Serialisierung. <br><br>  SRID - Koordinatensystemnummer.  Es gibt viele von ihnen.  Die Hauptunterschiede: das Koordinatenformat (Meter, Grad ...), der Bezugspunkt und die Form der Erde (die Erde ist nicht rund).  PostGis kennt viele Koordinatensysteme und kann diese transformieren. <br><br>  Wie gesagt, wir haben einen Geometrietyp in der Datenbank.  Der Einfachheit halber habe ich sofort die konkrete Punktklasse verwendet, da ich in dieser Tabelle nur Punktobjekte habe.  PostGIS theoretisch kann jedoch mehrere Arten von Geometrie gleichzeitig speichern.  Nur in jeder Geometrie wird der Typ angegeben: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"geometry"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"MultiPolygon"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"coordinates"</span></span>:...</code> </pre> <br>  Laut StackOverflow verlangsamt die Verwendung mehrerer Geometrien in derselben Tabelle die Abfragen.  Geometrien k√∂nnen auch verschachtelt werden.  Typen: <br><img src="https://habrastorage.org/webt/iz/a2/2s/iza22ssla5vc58aa11osbdytqai.png"><br><br><h3>  Datenbankabfragen </h3><br>  Mit der Implementierung der Klasse herausgefunden.  Jetzt ist es Zeit, sie von der Basis zu holen.  Unsere Punkte sind H√§user bzw. deren Adressen.  Sie k√∂nnen vertraute SQL-Abfragen stellen: H√§user nach ID, Anzahl, Anzahl der Gro√üm√ºtter abrufen ... <br><br>  Wir sind jetzt an r√§umlichen Abfragen interessiert.  Suchen Sie beispielsweise ein Haus nach Koordinaten.  Die gew√ºnschten Koordinaten x, y und + -Delta seien der gew√ºnschte Suchbereich.  Die Hauptabfragen in STS werden nach dem Verh√§ltnis der Geometrien durchgef√ºhrt.  Deshalb m√ºssen wir es schaffen: <br><br><pre> <code class="java hljs"> Coordinate c1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Coordinate(x - delta, y - delta); ... Coordinate[] coordinates = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Coordinate[]{c1, c2, c3, c4, c1}; GeometryFactory GEOMETRY_FACTORY = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GeometryFactory();<span class="hljs-comment"><span class="hljs-comment">//static  Polygon square_window = GEOMETRY_FACTORY.createPolygon(coordinates); square_window.setSRID(32635);</span></span></code> </pre><br>  Wenn wir kein Koordinatensystem angeben, wird PostGis den Vergleich ablehnen.  Sie kennen entweder Ihren <code>.getGeom().getSRID()</code> oder erhalten ihn von √ºberall mit dem Code <code>.getGeom().getSRID()</code> . <br><br>  Als n√§chstes senden wir eine Anfrage des Formulars: <br><br><pre> <code class="java hljs"> <span class="hljs-string"><span class="hljs-string">"select a "</span></span> + <span class="hljs-string"><span class="hljs-string">"from AdressBuilding a "</span></span> + <span class="hljs-string"><span class="hljs-string">"where within(a.geom, :window) = true"</span></span></code> </pre> <br>  Eine Abfrage innerhalb bedeutet, zu √ºberpr√ºfen, ob sich die Geometrie in einer anderen befindet.  Seien Sie nicht beunruhigt, wenn Ihre IDE sagt, dass es keine solche Anfrage in der JPA geben kann.  Hibernate Spatial konvertiert es in: <br><pre> <code class="sql hljs"> where st_within(adressbuil0_.geom, ?)=true</code> </pre> <br>  Wobei <code>st_within</code> bereits eine PostGis-Funktion ist. <br><br>  Es gibt verschiedene M√∂glichkeiten, um das gleiche Ergebnis zu erzielen - der Punkt fiel in ein Quadrat. <code>contains(:window, a.geom) / intersects(a.geom, :window)...</code> <br><br><img src="https://habrastorage.org/webt/kl/-b/_a/kl-b_a4_p-jgl5hrgrjdbdzn4pw.png"><br><br>  Eine detaillierte Beschreibung der Spezifikationen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br><h3>  Nachwort </h3><br>  Wir haben die Punkte - jetzt machen Sie mit ihnen, was Sie wollen. <br><br>  Ich habe den Fall einer kleinen Datenbank auf einem Server mit relativ viel RAM getestet.  Wenn Sie maximal laden und Indizes vergessen, wird die Suchaufgabe im Prozessor ausgef√ºhrt. <br>  Postgres hat viele verschiedene Indizes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Und einige von ihnen helfen Postgis</a> .  Die Studie zeigte, dass nur GIST (?) F√ºr <b>Punkte</b> geeignet ist <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> [indexname] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [tablename] <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> GIST ( [geometryfield] );</code> </pre> <br>  Am h√§ufigsten werden beim Importieren von Daten in PostGis Indizes automatisch erstellt ... <br><br>  Erl√§uterungen und zus√§tzliche Informationen sind willkommen. <br><br>  Handbuch verwendet: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">F√ºr den Winterschlaf 5</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">F√ºr den Winterschlaf 4</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440872/">https://habr.com/ru/post/de440872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440858/index.html">Es gibt viele Programme zum Englischlernen, aber lohnt es sich, eines davon zu verwenden, wenn Sie Programmierer sind?</a></li>
<li><a href="../de440862/index.html">CI / CD-Muster und Anti-Muster. Teil 1</a></li>
<li><a href="../de440864/index.html">Die tragische Geschichte der Poppler-Datierung</a></li>
<li><a href="../de440866/index.html">M√ºnztelefone in Russland wollen das Ministerium f√ºr Notsituationen erg√§nzen</a></li>
<li><a href="../de440870/index.html">Wie ich das Universum gepatcht habe</a></li>
<li><a href="../de440874/index.html">Implementierung der freien Partikelbewegung auf ReactJS</a></li>
<li><a href="../de440878/index.html">Webanalyse f√ºr Unternehmen</a></li>
<li><a href="../de440880/index.html">Top 10 IoT-Sensoren im Jahr 2019</a></li>
<li><a href="../de440882/index.html">Entfliehen Sie Crypto Pro. GOST 34.10-2012 Ausgabe</a></li>
<li><a href="../de440884/index.html">Die Verarbeitung nicht behebbarer Fehler in Swift</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>