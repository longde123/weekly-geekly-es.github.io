<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶î üö° üëÅÔ∏è Recopilaci√≥n de informaci√≥n contextual para el registro. üë®üèº‚Äçüéì üê∂ ü§ûüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A menudo necesita escribir informaci√≥n adicional en los registros, lo que puede aclarar la situaci√≥n y simplificar a√∫n m√°s la depuraci√≥n de la aplicac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Recopilaci√≥n de informaci√≥n contextual para el registro.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416751/"><p>  A menudo necesita escribir informaci√≥n adicional en los registros, lo que puede aclarar la situaci√≥n y simplificar a√∫n m√°s la depuraci√≥n de la aplicaci√≥n.  Por ejemplo, si se registra informaci√≥n de error, ser√≠a bueno guardar tambi√©n los datos de entrada de alguna forma, para que sea m√°s f√°cil reproducir el problema.  Aqu√≠ quiero describir un enfoque que le permite recopilar esta informaci√≥n adicional. </p><a name="habracut"></a><br><h2 id="postanovka-zadachi">  Declaraci√≥n del problema. </h2><br><p>  Supongamos que tenemos un ASP.NET MVC We service.  Acepta solicitudes POST que contienen una descripci√≥n de lo que debe hacerse en formato JSON.  Despu√©s de analizar dicha descripci√≥n, el servicio crea y ejecuta varias consultas SQL a la base de datos.  Luego combina los resultados y los env√≠a al cliente. </p><br><p> Hay que decir que este servicio hace un uso extensivo de asincron√≠a y subprocesamiento <em>m√∫ltiple a</em> trav√©s de <em>async / await</em> y <code>Task</code> . </p><br><p>  Ahora que entendemos a qu√© nos enfrentamos, pasemos a los problemas. </p><br><h2 id="sbor-kontekstnoy-informacii-ob-oshibkah">  Recopilar informaci√≥n de error contextual </h2><br><p>  A veces nuestro servicio da errores.  Los motivos pueden ser diferentes: entrada JSON incorrecta, errores en el c√≥digo, problemas con la base de datos ... En este caso, deber√≠amos escribir informaci√≥n de error en el registro. </p><br><p>  No hay problema para registrar la excepci√≥n en s√≠.  Podemos atraparlo en el m√©todo de acci√≥n de nuestro controlador: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ServiceController</span></span> : <span class="hljs-title"><span class="hljs-title">ApiController</span></span> { [Route(<span class="hljs-string"><span class="hljs-string">"api/service"</span></span>)] [HttpPost] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;HttpResponseMessage&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> [FromBody] RequestModel requestModel </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Logger.LogError(ex); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } } }</code> </pre> <br><p>  O podemos crear un atributo especializado para esto: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogErrorAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpActionExecutedContext actionExecutedContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuted(actionExecutedContext); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (actionExecutedContext.Exception != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Logger.LogError(actionExecutedContext.Exception); } } }</code> </pre> <br><p>  y √∫salo en el m√©todo de acci√≥n: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"api/service"</span></span></span><span class="hljs-meta">)</span></span>] [HttpPost] [LogError] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;HttpResponseMessage&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> [FromBody] RequestModel requestModel </span></span></span><span class="hljs-function">)</span></span> { ... }</code> </pre> <br><p>  Pero necesitamos m√°s.  Para cada error, queremos almacenar informaci√≥n adicional: </p><br><ul><li>  El texto del cuerpo JSON de la solicitud. </li><li>  El texto de todas las consultas SQL generadas. </li></ul><br><p>  Hay un requisito m√°s.  Esta informaci√≥n adicional debe registrarse en el registro solo si se produce un error.  De lo contrario, no lo necesitamos en los registros. </p><br><p>  Hacer esto para el cuerpo de la solicitud no es dif√≠cil: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ServiceController</span></span> : <span class="hljs-title"><span class="hljs-title">ApiController</span></span> { [Route(<span class="hljs-string"><span class="hljs-string">"api/service"</span></span>)] [HttpPost] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;HttpResponseMessage&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> [FromBody] RequestModel requestModel </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestText = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Request.Content.ReadAsStringAsync(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Logger.LogError(ex); Logger.LogError(<span class="hljs-string"><span class="hljs-string">$"Request test is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{requestText}</span></span></span><span class="hljs-string">"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } } }</code> </pre> <br><p>  Pero para las consultas SQL, no todo es tan simple.  El hecho es que estas solicitudes no son generadas por el m√©todo de acci√≥n.  Ni siquiera se generan en el controlador.  Entre el m√©todo de acci√≥n y el m√©todo de generaci√≥n de SQL, hay muchas llamadas a otros m√©todos de otras clases.  ¬øC√≥mo extraemos los textos de estas solicitudes cuando las necesitamos? </p><br><p>  Una opci√≥n es usar una lista de mensajes (por ejemplo, <code>List&lt;string&gt;</code> ).  Lo creamos en nuestro m√©todo de acci√≥n ( <code>ServiceAction</code> ) y lo pasamos al m√©todo que genera SQL.  All√≠ agregaremos los textos de consulta SQL a esta lista.  En caso de que ocurra un error, el m√©todo de acci√≥n tendr√° una lista de mensajes que deben colocarse en el registro. </p><br><p>  Este m√©todo tiene un inconveniente muy significativo, en mi opini√≥n.  Tendremos que pasar nuestra lista de mensajes a lo largo de toda la cadena de llamadas a m√©todos hasta llegar al m√©todo que genera SQL.  Esto significa que en muchos lugares esta lista de mensajes ser√° necesaria solo para transmitirla.  Esto complica el c√≥digo, y tratar√≠a de evitarlo. </p><br><p>  Si utiliza un contenedor DI y puede crear sus clases a partir de √©l, puede intentar colocar la lista de mensajes en el contenedor con una vida √∫til "por solicitud".  La clase de generaci√≥n SQL aceptar√° esta lista de mensajes como un par√°metro constructor.  Entonces, tanto una instancia de esta clase como una instancia del controlador podr√°n acceder a la misma instancia de la lista de mensajes. </p><br><p>  Pero hay una forma m√°s conveniente de recopilar informaci√≥n contextual, incluso si no est√° utilizando un contenedor DI.  Ser√≠a bueno si pudi√©ramos acceder a la lista de mensajes a trav√©s de una propiedad est√°tica: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;SqlDataReader&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunReaderAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> SqlCommand cmd</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = <span class="hljs-string"><span class="hljs-string">$"SQL Server query is: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{cmd.CommandText}</span></span></span><span class="hljs-string">"</span></span>; ErrorContext.Current.AttachMessage(message); ... }</code> </pre> <br><p>  Hay un problema serio aqu√≠.  Nuestro servicio puede atender simult√°neamente varias solicitudes.  Y cada solicitud debe tener su propia lista de mensajes.  Adem√°s, al procesar una sola solicitud, nuestro c√≥digo puede generar varios hilos (por ejemplo, usando <em>async / wait</em> ).  Y todos estos hilos deben tener acceso a la misma lista de mensajes.  ¬øC√≥mo se puede implementar esto? </p><br><p>  La <code>AsyncLocal&lt;T&gt;</code> viene en nuestra ayuda.  Garantiza que si coloca alg√∫n valor en una instancia de esta clase en un hilo, puede obtener este valor en este hilo, as√≠ como en todos los hilos lanzados desde este en adelante.  Al mismo tiempo, todos los otros hilos no tendr√°n acceso a este valor. </p><br><p>  Veamos la implementaci√≥n de la clase <code>ErrorContext</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ErrorContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Lock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> AsyncLocal&lt;ErrorContext&gt; CurrentErrorContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncLocal&lt;ErrorContext&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Lazy&lt;ConcurrentBag&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;&gt; _attachedMessages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lazy&lt;ConcurrentBag&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;&gt;(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentBag&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;()); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ErrorContext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ErrorContext Current { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (Lock) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorContext = CurrentErrorContext.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (errorContext == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { CurrentErrorContext.Value = errorContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorContext(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errorContext; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ErrorContext </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateNewErrorContext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (Lock) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errorContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorContext(); CurrentErrorContext.Value = errorContext; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errorContext; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AttachMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(message)) { _attachedMessages.Value.Add(message); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IReadOnlyList&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMessages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _attachedMessages.Value.ToArray(); } }</code> </pre> <br><p>  El m√©todo <code>CreateNewErrorContext</code> crea inmediatamente una nueva lista de mensajes y la guarda en el campo <code>CurrentErrorContext</code> , que es del tipo <code>AsyncLocal</code> .  Puede acceder a la lista actual en cualquier parte del c√≥digo utilizando la propiedad est√°tica <code>Current</code> .  El m√©todo <code>AttachMessage</code> agrega un nuevo mensaje a la lista.  Almacena mensajes en una instancia de <code>ConcurrentBag</code> , porque este m√©todo se puede llamar desde varios subprocesos al mismo tiempo.  El m√©todo <code>GetMessages</code> devuelve todos los mensajes guardados, para que puedan escribirse en el registro. </p><br><p>  Ahora puede inicializar y usar <code>ErrorContext</code> dentro de <code>LogErrorAttribute</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogErrorAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpActionContext actionContext</span></span></span><span class="hljs-function">)</span></span> { ErrorContext.CreateNewErrorContext(); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuting(actionContext); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpActionExecutedContext actionExecutedContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuted(actionExecutedContext); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (actionExecutedContext.Exception != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ErrorContext.Current.GetMessages()) { Logger.LogError(message); } Logger.LogError(actionExecutedContext.Exception); } } }</code> </pre> <br><p>  En cualquier parte de su c√≥digo, puede agregar su mensaje al contexto de error actual de la siguiente manera: </p><br><pre> <code class="cs hljs">ErrorContext.Current.AttachMessage(message);</code> </pre> <br><h2 id="logirovanie-problem-s-proizvoditelnostyu">  Registro de rendimiento </h2><br><p>  A veces mi servicio es lento.  No para todas las consultas, pero para algunas lleva demasiado tiempo completarlas.  Me gustar√≠a conservar informaci√≥n sobre tales solicitudes para analizarla m√°s adelante.  ¬øC√≥mo se puede implementar esto y qu√© informaci√≥n necesitamos? </p><br><p>  En primer lugar, necesito un umbral de tiempo de ejecuci√≥n.  Si procesar la solicitud lleva menos tiempo, entonces todo est√° en orden.  No escribir√© nada en el registro en este caso.  Pero si lleva m√°s tiempo, tengo que agregar informaci√≥n al registro. </p><br><p>  ¬øQu√© informaci√≥n necesito?  Definitivamente necesita saber cu√°nto tiempo llev√≥ el procesamiento de la solicitud.  Pero eso no es suficiente.  Mi servicio hace muchas cosas: verificar par√°metros de consulta, obtener datos de otros servicios, crear consultas SQL y ejecutarlas ... Necesito saber cu√°nto tiempo tom√≥ cada parte para comprender d√≥nde est√° oculto el problema. </p><br><p>  Adem√°s, necesito la misma informaci√≥n que para los errores.  Necesito un cuerpo de solicitud para poder reproducir el problema.  Necesito los textos de las consultas SQL en caso de que tarden m√°s tiempo. </p><br><p>  ¬øC√≥mo se puede lograr esto?  Nuevamente, usando la clase <code>AsyncLocal</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Timer</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Lock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> AsyncLocal&lt;Timer&gt; CurrentTimer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncLocal&lt;Timer&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Stopwatch _stopwatch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stopwatch(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Lazy&lt;ConcurrentQueue&lt;Timer&gt;&gt; _attachedTimers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lazy&lt;ConcurrentQueue&lt;Timer&gt;&gt;(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentQueue&lt;Timer&gt;()); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Lazy&lt;ConcurrentQueue&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;&gt; _attachedMessages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lazy&lt;ConcurrentQueue&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;&gt;(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentQueue&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;()); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _description; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> TimeSpan? _threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Timer _previousCurrent; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _isDisposed; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _suspendLogging; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Timer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Timer previousCurrent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> description = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">, TimeSpan? threshold = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { _previousCurrent = previousCurrent; _description = description; _threshold = threshold; _stopwatch.Start(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Timer Current { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (Lock) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = CurrentTimer.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { CurrentTimer.Value = timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> timer; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Timer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCurrentTimer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> description, TimeSpan? threshold = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (Lock) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentTimer = CurrentTimer.Value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer(currentTimer, description, threshold); CurrentTimer.Value = timer; currentTimer?._attachedTimers.Value.Enqueue(timer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> timer; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AttachMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(message)) { _attachedMessages.Value.Enqueue(message); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_isDisposed) { _isDisposed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; _stopwatch.Stop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_attachedTimers.IsValueCreated) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> attachedTimer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _attachedTimers.Value) { attachedTimer.Dispose(); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_suspendLogging &amp;&amp; _threshold.HasValue &amp;&amp; _stopwatch.Elapsed &gt; _threshold.Value) { Log(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_previousCurrent != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { CurrentTimer.Value = _previousCurrent; } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JObject Message { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">$"It took </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_stopwatch.ElapsedMilliseconds}</span></span></span><span class="hljs-string"> ms to execute </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_description}</span></span></span><span class="hljs-string">."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_threshold.HasValue) { message.Append(<span class="hljs-string"><span class="hljs-string">$" Duration threshold is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_threshold.Value.TotalMilliseconds}</span></span></span><span class="hljs-string"> ms."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageObj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JObject { [<span class="hljs-string"><span class="hljs-string">"message"</span></span>] = message.ToString(), }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_attachedTimers.IsValueCreated &amp;&amp; _attachedTimers.Value.Any()) { messageObj[<span class="hljs-string"><span class="hljs-string">"attachedTimers"</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JArray(_attachedTimers.Value.Select(t =&gt; t.Message)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_attachedMessages.IsValueCreated &amp;&amp; _attachedMessages.Value.Any()) { messageObj[<span class="hljs-string"><span class="hljs-string">"attachedMessages"</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JArray(_attachedMessages.Value); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> messageObj; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { _suspendLogging = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_stopwatch.Elapsed &lt; _threshold) { Logger.LogDebug(Message.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Logger.LogWarning(Message.ToString()); } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { _suspendLogging = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre> <br><p>  Veamos como funciona.  El m√©todo <code>SetCurrentTimer</code> crea un nuevo temporizador.  Aqu√≠ puede especificar su descripci√≥n y un umbral de tiempo de ejecuci√≥n opcional. </p><br><p>  ¬øPor qu√© es opcional este umbral?  A veces necesito parte de mi c√≥digo para ejecutar no m√°s de una cierta cantidad de tiempo.  Por lo tanto, puedo desear que toda la solicitud de servicio se procese en 3 segundos.  En otros casos, no quiero imponer restricciones al tiempo de ejecuci√≥n.  Por ejemplo, no me importa cu√°nto tiempo lleve ejecutar mis consultas SQL hasta que toda la solicitud de servicio se procese en menos de 3 segundos.  Por esta raz√≥n, para algunos temporizadores, debe establecer un umbral de tiempo de ejecuci√≥n, mientras que para otros, no. </p><br><p>  Dentro del m√©todo <code>SetCurrentTimer</code> , se crea un nuevo temporizador y se coloca en la variable <code>CurrentTimer</code> del tipo <code>AsyncLocal</code> .  Pero eso no es todo.  En este punto, puede existir otro temporizador activo.  En este caso, el nuevo temporizador que acaba de crear se une al existente.  Esto le permite crear temporizadores anidados para medir el tiempo de ejecuci√≥n de todo el bloque de c√≥digo y sus partes: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Timer.SetCurrentTimer(<span class="hljs-string"><span class="hljs-string">"The whole block"</span></span>)) { ... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Timer.SetCurrentTimer(<span class="hljs-string"><span class="hljs-string">"Part 1"</span></span>)) { ... } ... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Timer.SetCurrentTimer(<span class="hljs-string"><span class="hljs-string">"Part 2"</span></span>)) { ... } ... }</code> </pre> <br><p>  La propiedad <code>Current</code> da acceso al temporizador actual.  Esto es √∫til si desea agregarle algunos mensajes: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = <span class="hljs-string"><span class="hljs-string">$"SQL Server query is: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{cmd.CommandText}</span></span></span><span class="hljs-string">"</span></span>; Timer.Current.AttachMessage(message);</code> </pre> <br><p>  Aqu√≠, los mensajes adjuntos y los temporizadores anidados se almacenan en instancias de <code>ConcurrentQueue</code> , ya que su orden puede ser importante. </p><br><p>  La propiedad <code>Message</code> devuelve mensajes recopilados en una sola unidad del actual y todos los temporizadores apilados en √©l.  Aqu√≠ uso las clases JSON de la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JSON.NET</a> para estructurar todos los mensajes.  Pero en realidad no es tan importante.  Puedes usar cualquier formato. </p><br><p>  El m√©todo de <code>Log</code> escribe informaci√≥n almacenada en el temporizador en el registro, independientemente de si el umbral de tiempo de ejecuci√≥n se ha establecido o no.  Al mismo tiempo, el m√©todo <code>Dispose</code> escribe informaci√≥n en el registro solo si se ha excedido el umbral de tiempo de ejecuci√≥n establecido. </p><br><p>  Ahora podemos crear otro atributo para los m√©todos de nuestros controladores: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TimerContextAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _timerDescription; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _durationThresholdMs; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> AsyncLocal&lt;Timer&gt; _timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncLocal&lt;Timer&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerContextAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timerDescription, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> durationThresholdMs</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(timerDescription)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(timerDescription)); _timerDescription = timerDescription; _durationThresholdMs = durationThresholdMs; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpActionContext actionContext</span></span></span><span class="hljs-function">)</span></span> { _timer.Value = Timer.SetCurrentTimer(_timerDescription, TimeSpan.FromMilliseconds(_durationThresholdMs)); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuting(actionContext); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpActionExecutedContext actionExecutedContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuted(actionExecutedContext); _timer.Value?.Dispose(); } }</code> </pre> <br><p>  y √∫salo en m√©todos de acci√≥n como este: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"api/service"</span></span></span><span class="hljs-meta">)</span></span>] [HttpPost] [TimerContext(<span class="hljs-string"><span class="hljs-string">"For ServiceAction method"</span></span>, <span class="hljs-number"><span class="hljs-number">3000</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;HttpResponseMessage&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> [FromBody] RequestModel requestModel </span></span></span><span class="hljs-function">)</span></span> { ... }</code> </pre> <br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  En este art√≠culo, describ√≠ lo simple que es recopilar informaci√≥n de muchos lugares en el c√≥digo y acceder a ella m√°s tarde.  Dicha funcionalidad se puede implementar utilizando propiedades est√°ticas y m√©todos que manipulan instancias de la clase <code>AsyncLocal</code> . </p><br><p>  Espero que el art√≠culo sea √∫til para mejorar el sistema de registro en sus aplicaciones. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416751/">https://habr.com/ru/post/es416751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416737/index.html">A * Algoritmo de b√∫squeda de ruta en un juego Voxel 3d Unity</a></li>
<li><a href="../es416739/index.html">Nuevo ASUS en Computex 2018</a></li>
<li><a href="../es416741/index.html">Los atacantes usaron certificados D-Link robados en su software de robo de contrase√±as</a></li>
<li><a href="../es416743/index.html">Bot para Starcraft en Rust, C y cualquier otro idioma</a></li>
<li><a href="../es416745/index.html">Nuevo ASUS ROG en Computex 2018</a></li>
<li><a href="../es416753/index.html">El popular plugin Hola VPN est√° comprometido</a></li>
<li><a href="../es416755/index.html">Me gusta extremo - Comit√© de investigaci√≥n contra</a></li>
<li><a href="../es416757/index.html">Pruebas escamosas</a></li>
<li><a href="../es416759/index.html">¬øPor qu√© la inteligencia artificial no resolver√° todos los problemas?</a></li>
<li><a href="../es416761/index.html">Lenguaje c√≥smico, parte 1: ¬øes universal la gram√°tica universal?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>