<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∏ üíÉüèª üïµüèΩ Wie STP funktioniert ‚òïÔ∏è üßó üë®üèæ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grund f√ºr die Erstellung von STP 
 Der Grund f√ºr die Erstellung des STP-Protokolls war das Auftreten von Schleifen an den Switches. Was ist eine Schle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie STP funktioniert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419491/"><h4>  Grund f√ºr die Erstellung von STP </h4><br>  Der Grund f√ºr die Erstellung des STP-Protokolls war das Auftreten von Schleifen an den Switches.  Was ist eine Schleife?  Die Schleifendefinition lautet wie folgt: <br><br>  <b>√úberbr√ºckungsschleife (Switching Loop)</b> - Ein Zustand im Netzwerk, in dem eine endlose √úbertragung von Frames zwischen den Switches stattfindet, die mit demselben Netzwerksegment verbunden sind. <br><br>  Aus der Definition wird deutlich, dass das Auftreten einer Schleife gro√üe Probleme verursacht - dies f√ºhrt zu einer √úberlastung der Switches und zur Inoperabilit√§t dieses Netzwerksegments.  Wie entsteht eine Schleife?  Das folgende Bild zeigt die Topologie, in der eine Schleife ohne Schutzmechanismen auftritt: <br><br><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/126/e5d/0de/126e5d0dea4a92a1d6ec0c4dd2c7c897.jpg" alt="Mein bild"></a> <a name="habracut"></a><br><br>  Das Auftreten einer Schleife unter folgenden Bedingungen: <br><br>  <b>1. Einer der Hosts sendet einen Broadcast-Frame:</b> <br><br><ol><li>  Beispielsweise sendet VPC5 ein Paket mit einer Broadcast-Zieladresse. </li><li>  Nach dem Akzeptieren dieses Pakets muss Switch1 es √ºber alle Ports mit Ausnahme des Ports senden, von dem dieses Paket stammt.  Das Paket wird durch die Ports Gi0 / 0, Gi1 / 0 geleitet. </li><li>  Die Switches Switch2, Switch3, die dieses Paket akzeptiert haben, m√ºssen ihm auch das Paket senden.  Somit sendet Switch2, der das Paket von Switch1 empfangen hat, es an Switch3 und Switch3 sendet es an Switch2. </li><li>  Als n√§chstes hat Switch2 ein Paket von Switch3 empfangen, an Switch1 gesendet, und Switch3 hat ein Paket von Switch2 empfangen und es auch an Switch1 gesendet.  Wir kommen also zu Schritt 1) ‚Äã‚Äãund es wird auf unbestimmte Zeit fortgesetzt.  Alles wird durch die Tatsache erschwert, dass Switch1 in Schritt 4) bereits zwei Frame-Instanzen hat, da er sie sowohl von Switch2 als auch von Switch3 empf√§ngt. </li></ol><br>  Die Schritte 1) - 4) werden endlos wiederholt und bei Kommutatoren geschieht dies in Sekundenbruchteilen.  Die Bildung einer Schleife f√ºhrt auch dazu, dass sich die Tabelle der Mohnadressen auf den Schaltern st√§ndig √§ndert und die Mohnadresse des Absenders der VPC5 st√§ndig entweder der Schnittstelle Gi0 / 0, Gi1 / 0 oder Gi0 / 2 zugewiesen wird (wenn zu diesem Zeitpunkt VPC5 sendet andere Pakete).  Ein solcher Zyklus f√ºhrt zu einem fehlerhaften Betrieb des Netzwerks und aller Switches.  Das Senden von Broadcast-Paketen f√ºr Hosts ist beispielsweise im ARP-Protokoll weit verbreitet. <br><br>  <b>2. Eine Schleife kann sich auch bilden, ohne einen Broadcast-Frame zu senden.</b> <br><br><ol><li>  Beispielsweise sendet VPC5 einen Frame mit einer Unicast-Ziel-Mac-Adresse. </li><li>  M√∂glicherweise befindet sich die Ziel-Mac-Adresse nicht in der Switch-Mac-Adresstabelle.  In diesem Fall leitet der Switch das Paket √ºber alle Ports mit Ausnahme des Ports weiter, von dem er den Frame empfangen hat.  Und wir haben die gleiche Situation wie beim Broadcast-Frame. </li><li>  Im Folgenden wird das STP-Protokoll f√ºr Cisco-Switches beschrieben.  Sie verwenden STP separat f√ºr jedes vlan, das PVST + -Protokoll.  Wir haben nur einen VLAN, daher √§ndert sich die Bedeutung nicht. </li></ol><br><h4>  STP-Grundlagen </h4><br>  Das Funktionsprinzip dieses Protokolls basiert auf der Tatsache, dass alle redundanten Kan√§le zwischen den Switches logisch blockiert sind und kein Verkehr √ºber sie √ºbertragen wird.  Um eine Topologie ohne redundante Kan√§le zu erstellen, wird ein Baum erstellt (mathematischer Graph).  Um einen solchen Baum zu erstellen, muss zun√§chst die Wurzel des Baums bestimmt werden, aus dem der Graph erstellt wird.  Daher besteht der erste Schritt im STP-Protokoll darin, den Root-Switch (Root-Switch) zu bestimmen.  Um den Root-Switch zu bestimmen, tauschen Switches BPDU-Nachrichten aus.  Im Allgemeinen verwendet das STP-Protokoll zwei Arten von Nachrichten: BPDU - enth√§lt Informationen zu den Switches und TCN - benachrichtigt √ºber eine √Ñnderung der Topologie.  Betrachten wir die BPDU genauer.  Wir werden weiter unten mehr √ºber TCN sprechen.  Wenn Sie STP auf den Switches aktivieren, beginnen die Switches, BPDU-Nachrichten zu senden.  Diese Nachrichten enthalten die folgenden Informationen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ab/b03/95d/8abb0395d6af59aa1d0d89717a430640.jpg" alt="Mein bild"><br><br>  Der BPDU-Frame enth√§lt die folgenden Felder: <br><br><ul><li>  Kennung der STA-Protokollversion (2 Byte).  Switches m√ºssen dieselbe Version des STA-Protokolls unterst√ºtzen </li><li>  STP-Protokollversion (1 Byte) </li><li>  BPDU-Typ (1 Byte).  Es gibt zwei Arten von BPDUs: Benachrichtigung √ºber Konfiguration und Neukonfiguration </li><li>  Flags (1 Byte) </li><li>  Root Switch Identifier (8 Bytes) </li><li>  Die Kosten f√ºr die Route zum Root-Switch (Root Path Cost) </li><li>  Absender-ID (Bridge-ID) (8 Byte) </li><li>  Die Kennung des Ports, von dem dieses Paket gesendet wurde (Port-ID) (2 Byte) </li><li>  Nachrichtenlebensdauer (2 Bytes).  Gemessen in Einheiten von 0,5 s, um veraltete Nachrichten zu erkennen </li><li>  Maximale Nachrichtenlebensdauer (2 Byte).  Wenn der BPDU-Frame eine Lebensdauer hat, die das Maximum √ºberschreitet, wird der Frame von den Schaltern ignoriert </li><li>  Hallo-Intervall (2 Bytes), das Intervall, in dem BPDU-Pakete gesendet werden </li><li>  Zustands√§nderungsverz√∂gerung (2 Bytes).  Minimale aktive Schalterzeit </li></ul><br>  Die Hauptfelder, die besondere Aufmerksamkeit erfordern, sind folgende: <br><br><ul><li>  Absender-ID (Bridge-ID) </li><li>  Root Bridge ID </li><li>  Die Kennung des Ports, von dem dieses Paket gesendet wurde (Port-ID) </li><li>  Die Kosten f√ºr die Route zum Root-Switch (Root Path Cost) </li></ul><br>  Zur Bestimmung des Root-Switch wird die Switch-ID verwendet - Bridge-ID.  Die Bridge-ID ist eine 8-Byte-Nummer, die aus der Bridge-Priorit√§t (Priorit√§t 0 bis 65535, Standard 32768) und der MAC-Adresse des Ger√§ts besteht.  Der Root-Switch w√§hlt den Switch mit der niedrigsten Priorit√§t aus. Wenn die Priorit√§ten gleich sind, werden die MAC-Adressen verglichen (zeichenweise gewinnt der kleinere). <br><br>  Hier ist die Ausgabe der Bridge-ID-Informationen von Switch1 aus dem ersten Bild.  Priorit√§t - 32769 (Standard 32768 + Vlan-ID), MAC-Adressen - Adresse 5000.0001.0000: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0e/0a9/a20/f0e0a9a20fcaf20601fb2e5ffb02564e.jpg" alt="Mein bild"><br><br>  Stellen Sie sich das Bild vor, die Schalter sind gerade eingeschaltet und beginnen nun, eine schleifenfreie Topologie aufzubauen.  Sobald die Switches hochfahren, senden sie BPDUs, in denen sie alle dar√ºber informieren, dass sie die Wurzel des Baums sind.  In BPDUs geben Switches als Root-Bridge-ID ihre eigene Bridge-ID an.  Beispielsweise sendet Switch1 BPDUs an Switch3 und Switch3 an Switch1.  BPDU von Switch1 zu Switch3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc9/6ef/4e3/dc96ef4e309f4c565aa7fc68eda75137.jpg" alt="Mein bild"><br><br>  BPDU von Switch3 zu Switch1: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/809/4de/aee/8094deaeef6449cdf3dc280000fc6e78.jpg" alt="Mein bild"><br><br>  Wie Sie der Root-ID entnehmen k√∂nnen, teilen sich beide Kommutatoren gegenseitig mit, dass er der Root-Switch ist. <br><br><h4>  Root-Switch ausw√§hlen </h4><br>  Bis zur Erstellung der STP-Topologie wird aufgrund spezieller Portzust√§nde kein normaler Datenverkehr √ºbertragen, auf den weiter unten eingegangen wird.  Also erh√§lt Switch3 BPDU von Switch1 und untersucht diese Nachricht.  Switch3 sucht im Feld Root Bridge ID und stellt fest, dass dort eine andere Root Bridge ID angegeben ist als in der von Switch3 selbst gesendeten Nachricht.  Er vergleicht die Root Bridge-ID in dieser Nachricht mit seiner Root Bridge-ID und stellt fest, dass die MAC-Adresse dieses Switches (Switch1) trotz gleicher Priorit√§t besser (weniger) ist als zuvor.  Daher empf√§ngt Switch3 die Root Bridge-ID von Switch1 und beendet das Senden seiner BPDUs, h√∂rt jedoch nur BPDUs von Switch1 ab.  Der Port, an dem die beste BPDU empfangen wurde, wird zum Root-Port.  Switch1 hat auch eine BPDU von Switch3 empfangen, f√ºhrt einen Vergleich durch, aber in diesem Fall √§ndert sich das Verhalten von Switch1 nicht, da die empfangene BPDU eine schlechtere Root-Bridge-ID als Switch1 enth√§lt.  Daher wurde zwischen Switch1 und Switch3 ein Root-Switch definiert.  In √§hnlicher Weise wird der Root-Switch zwischen Switch1 und Switch2 ausgew√§hlt.  Die Gi0 / 0-Ports an Switch2 und Switch3 werden zu Root-Port - dem Port, der zum Root-Switch f√ºhrt.  √úber diesen Port akzeptieren Switch2 und Switch3 BPDUs von Root Bridge.  Lassen Sie uns nun herausfinden, was mit dem Kanal zwischen Switch2 und Switch3 passieren wird. <br><br><h4>  Redundante Kan√§le blockieren </h4><br>  Wie aus der Topologie hervorgeht, muss der Kanal zwischen Switch2 und Switch3 blockiert werden, um die Bildung von Schleifen zu verhindern.  Wie geht STP damit um? <br><br>  Nachdem Root Bridge ausgew√§hlt wurde, beenden Switch2 und Switch3 das Senden von BPDUs √ºber Root-Ports, empfangen jedoch BPDUs, die von Root Bridge √ºber alle anderen aktiven Ports empfangen wurden, und √§ndern nur die folgenden Felder in den BPDU-Daten: <br><br><ul><li>  Absender-ID (Bridge-ID) - wird durch Ihre ID ersetzt. </li><li>  Die Kennung des Ports, von dem dieses Paket gesendet wurde (Port-ID) - √§ndert sich in die Kennung des Ports, von dem die BPDU gesendet wird. </li><li>  Die Kosten der Route zum Root-Switch (Root-Pfadkosten) - Die Kosten der Route werden relativ zum Switch selbst berechnet. </li></ul><br>  Somit empf√§ngt Switch2 die folgende BPDU von Switch3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cb/1cb/bdf/0cb1cbbdfae70fb3ccf78a2ef590e847.jpg" alt="Mein bild"><br>  Und Switch3 von Switch2 erh√§lt eine solche BPDU: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91e/cc4/3a4/91ecc43a4ba7a061e38552d59fa26075.jpg" alt="Mein bild"><br><br>  Nach dem Austausch solcher BPDUs stellen Switch2 und Switch3 fest, dass die Topologie redundant ist.  Warum verstehen Switches, dass die Topologie redundant ist?  Sowohl Switch2 als auch Switch3 melden dieselbe Root Bridge in ihren BPDUs.  Dies bedeutet, dass es in Bezug auf Switch3 √ºber Switch1 und Switch2 zwei M√∂glichkeiten zur Root Bridge gibt, und genau gegen diese Redundanz k√§mpfen wir.  Es gibt auch zwei M√∂glichkeiten f√ºr Switch2 - √ºber Switch1 und Switch3.  Um diese Redundanz loszuwerden <br>  Sie m√ºssen den Kanal zwischen Switch3 und Switch2 blockieren.  Wie l√§uft das <br><br>  Die Wahl, an welchem ‚Äã‚ÄãSwitch der Port blockiert werden soll, ist wie folgt: <br><br><ul><li>  Kleinere Wurzelpfadkosten. </li><li>  Kleinere Br√ºcken-ID. </li><li>  Kleinere Port-ID. </li></ul><br>  In diesem Schema spielen Root Path Cost eine wichtigere Rolle als Bridge ID.  Fr√ºher dachte ich, dass diese Auswahl der Auswahl des Root-Switches √§hnlich ist, und war √ºberrascht, dass beispielsweise in dieser Topologie der Port auf dem Switch mit der schlechtesten Priorit√§t nicht blockiert wird: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a36/58f/9fc/a3658f9fca69d52cadf3b6d632e9d4c3.jpg" alt="Mein bild"><br><br>  Wie sich herausstellte, ist hier der Gi 0/1-Port am Sw2-Switch blockiert.  Bei dieser Abstimmung werden die Wurzelpfadkosten entscheidend.  Kehren wir zu unserer Topologie zur√ºck.  Da der Pfad zur Root Bridge derselbe ist, gewinnt Switch2 bei dieser Auswahl, da seine Priorit√§t gleich ist, werden Bridge-IDs verglichen.  Switch2 hat 50: 00: 00: 02: 00: 00, Switch3 hat 50: 00: 00: 03: 00: 00.  Switch2 hat eine bessere MAC-Adresse (weniger).  Nachdem die Auswahl getroffen wurde, leitet Switch3 keine Pakete mehr √ºber diesen Port weiter - Gi1 / 0, einschlie√ülich BPDU, sondern h√∂rt nur BPDU von Switch2 ab.  Dieser Portstatus in STP wird als Blocking (BLK) bezeichnet.  Der Gi1 / 0-Port an Switch2 funktioniert normal und leitet bei Bedarf verschiedene Pakete weiter, aber Switch3 verwirft sie sofort und h√∂rt nur BPDUs ab.  In diesem Beispiel haben wir daher eine Topologie ohne redundante Kan√§le erstellt.  Der einzige redundante Kanal zwischen Switch2 und Switch3 wurde blockiert, indem der Gi1 / 0-Port an Switch3 in einen speziellen Blockierungszustand - BLK - geschaltet wurde.  Jetzt werden wir die Mechanismen von STP genauer untersuchen. <br><br><h4>  Hafenstaaten </h4><br>  Wir haben oben gesagt, dass zum Beispiel der Gi1 / 0-Port an Switch3 in einen speziellen Blockierungszustand wechselt - Blocking.  Die folgenden Portzust√§nde sind in STP vorhanden: <br><br>  <b>Blockieren</b> - Blockieren.  In diesem Zustand werden keine Frames √ºber den Port √ºbertragen.  Wird verwendet, um Redundanz der Topologie zu vermeiden. <br><br>  <b>Zuh√∂ren</b> - zuh√∂ren.  Wie oben erw√§hnt, befinden sich die Ports in einem speziellen Zustand, in dem nur BPDUs √ºbertragen werden, Datenrahmen nicht √ºbertragen werden und in diesem Fall nicht akzeptiert werden, bevor der Root-Switch noch ausgew√§hlt ist.  Der Listening-Status wechselt nicht zum n√§chsten, selbst wenn die Root Bridge definiert ist.  Dieser Portstatus gilt f√ºr den Vorw√§rtsverz√∂gerungszeitgeber, der standardm√§√üig 15 ist. Warum muss ich immer 15 Sekunden warten?  Dies liegt an der Vorsicht des STP-Protokolls, damit die falsche Root Bridge nicht versehentlich ausgew√§hlt wird.  Nach dieser Zeit geht der Port in den n√§chsten Zustand √ºber - Lernen. <br><br>  <b>Lernen</b> - Training.  In diesem Zustand lauscht und sendet der Port BPDUs, sendet jedoch keine Informationen mit Daten.  Der Unterschied zwischen diesem Status und dem Abh√∂ren besteht darin, dass die Frames mit den Daten, die an den Port gelangen, untersucht werden und die MAC-Adressinformationen in die Switch-MAC-Adresstabelle eingegeben werden.  Der √úbergang zum n√§chsten Zustand erfordert auch einen Vorw√§rtsverz√∂gerungszeitgeber. <br><br>  <b>Weiterleitung</b> - Weiterleitung.  Dies ist der normale Zustand des Ports, an den sowohl BPDUs als auch Frames mit normalen Daten gesendet werden.  Wenn wir also das Schema durchlaufen, w√§hrend die Switches gerade gestartet wurden, erhalten wir das folgende Schema: <br><br><ol><li>  Der Switch versetzt alle angeschlossenen Ports in den Listening-Status und sendet BPDUs, bei denen er sich als Root-Switch deklariert.  W√§hrend dieses Zeitraums bleibt der Switch entweder root, wenn er nicht die beste BPDU empf√§ngt, oder er w√§hlt den Root-Switch aus.  Es dauert 15 Sekunden. </li><li>  Nachdem es in den Lernstatus eingetreten ist und die MAC-Adressen gelernt hat.  15 Sekunden </li><li>  Legt fest, welche Ports auf Weiterleitung und welche auf Blockieren eingestellt werden sollen. </li></ol><br><h4>  Portrollen </h4><br>  Zus√§tzlich zu den Portzust√§nden muss STP auch die Rollen ihrer Ports definieren.  Dies geschieht so, dass an welchem ‚Äã‚ÄãPort eine BPDU vom Root-Switch erwartet werden soll und √ºber welche Ports Kopien der vom Root-Switch empfangenen BPDU √ºbertragen werden sollen.  Die Portrollen lauten wie folgt: <br><br>  <b>Root-Port</b> - Der Root-Port des Switches.  Bei der Auswahl eines Root-Switch wird auch der Root-Port festgelegt.  Dies ist der Port, √ºber den der Root-Switch verbunden ist.  In unserer Topologie sind beispielsweise die Gi0 / 0-Ports an Switch2 und Switch3 die Root-Ports.  √úber diese Ports senden Switch2 und Switch3 keine BPDUs, sondern h√∂ren sie nur von Root Bridge ab.  Es stellt sich die Frage, wie der Root-Port ausgew√§hlt wird.  Warum ist der Gi1 / 0-Port nicht ausgew√§hlt?  K√∂nnen Sie schlie√ülich auch √ºber diesen Schalter mit dem Switch kommunizieren?  Um den Root-Port in STP zu bestimmen, wird eine Metrik verwendet, die die Root-Pfadkosten (die Kosten der Route zum Root-Switch) im Feld BPDU angibt.  Diese Kosten werden durch die Geschwindigkeit des Kanals bestimmt. <br><br>  Switch1 in seiner BPDU im Feld Root Path Cost setzt 0, da es sich selbst um Root Bridge handelt.  Wenn Switch2 die BPDU an Switch3 sendet, √§ndert sich dieses Feld.  Es setzt die Root-Pfadkosten gleich den Kanalkosten zwischen sich und Switch1.  Im BPDU-Bild von Switch2 und Switch3 sehen Sie, dass in diesem Feld die Root-Pfadkosten 4 betragen, da der Kanal zwischen Switch1 und Switch2 1 Gbit / s betr√§gt.  Wenn die Anzahl der Switches gr√∂√üer ist, addiert jeder n√§chste Switch die Root-Path-Kosten.  Stammpfadkostentabelle. <br><br>  <b>Designated Port</b> - Der zugewiesene Port im Segment.  F√ºr jedes Netzwerksegment muss ein Port vorhanden sein, der f√ºr die Verbindung dieses Segments mit dem Netzwerk verantwortlich ist.  Relativ gesehen kann ein Netzwerksegment ein Kabel bedeuten, das dieses Segment verbindet.  Beispielsweise verbinden die Gi0 / 2-Ports von Switch1, Switch3 einzelne Netzwerksegmente, zu denen nur dieses Kabel f√ºhrt.  Beispielsweise k√∂nnen die Ports auf der Root Bridge nicht blockiert werden, und alle sind als Ports im Segment bezeichnet.  Nach dieser Erkl√§rung k√∂nnen Sie strengere Definitionen f√ºr die zugewiesenen Ports angeben: <br>  Designated Port - Ein Nicht-Root-Bridge-Port zwischen Netzwerksegmenten, der Datenverkehr vom entsprechenden Segment empf√§ngt.  Jedem Netzwerksegment kann nur ein Port zugewiesen werden.  Dem Root-Switch sind alle Ports zugewiesen. <br><br>  Es ist auch wichtig zu beachten, dass der Gi1 / 0-Port an Switch2 ebenfalls zugewiesen ist, obwohl dieser Kommunikationskanal an Switch3 blockiert ist.  Relativ gesehen hat Switch2 keine Information, dass der Port am anderen Ende blockiert ist. <br><br>  <b>Nicht bezeichneter Port</b> - Ein nicht zugewiesener Segmentport.  Nicht benannter Port - Ein Port, der kein Root- oder designierter Port ist.  Die √úbertragung von Datenrahmen √ºber einen solchen Port ist verboten.  In unserem Beispiel ist Port Gi1 / 0 nicht zugewiesen. <br><br>  <b>Deaktivierter Port</b> - Ein Port, der ausgeschaltet ist. <br><br><h4>  Timer und STP-Konvergenz </h4><br>  Nachdem STP den Aufbau einer schleifenfreien Topologie abgeschlossen hat, bleibt die Frage: Wie werden Netzwerk√§nderungen erkannt und wie werden darauf reagiert?  Von STP verwendete BPDU-Nachrichten werden standardm√§√üig alle 2 Sekunden von Root Bridge gesendet.  Dieser Timer hei√üt Hello Timer.  Die √ºbrigen Switches, die diese Nachricht √ºber ihren Root-Port empfangen haben, leiten sie weiter √ºber alle zugewiesenen Ports weiter.  Es wurde ausf√ºhrlicher gesagt, welche √Ñnderungen an BPDUs bei der Weiterleitung ihrer Switches auftreten.  Wenn der Switch w√§hrend der vom Max Age-Timer festgelegten Zeit (standardm√§√üig - 20 Sekunden) keine BPDUs vom Root-Switch empfangen hat, wird dieses Ereignis als Kommunikationsverlust mit der Root Bridge behandelt.  Um die Konvergenz des Protokolls genauer zu beschreiben, m√ºssen Sie unsere Topologie √§ndern und Hubs zwischen den Switches platzieren.  Wir haben Hubs hinzugef√ºgt, damit die anderen Switches dies nicht durch den Verbindungsabbruch bestimmen, wenn einer der Switches ausf√§llt oder die Verbindung ausf√§llt, sondern Timer verwenden: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea3/0e7/105/ea30e7105f926c505b0a46f1e2adf758.jpg" alt="Bild"><br><br>  Bevor Sie beginnen, ist es auch wichtig, dass Sie mehr √ºber eine andere Art von STP-Nachricht erfahren - TCN.  TCN wird von den Switches im Falle einer Topologie√§nderung gesendet - sobald sich beispielsweise die Topologie auf einem Switch ge√§ndert hat, hat sich beispielsweise der Status der Schnittstelle ge√§ndert.  TCN wird vom Switch nur √ºber den Root-Port gesendet.  Sobald der Root-Switch TCN empf√§ngt, √§ndert er sofort den Parameter zum Speichern von MAC-Adressen in der Tabelle von 300 Sekunden auf 15 (worauf weiter unten eingegangen wird), und in der n√§chsten BPDU setzt Root Switch das Flag TCA (Topology Change Acknledgement) an den Switch gesendet, der das TCN gesendet hat, um zu benachrichtigen, dass das TCN empfangen wurde.  Sobald der TCN die Root Bridge erreicht, sendet er eine spezielle BPDU, die das TCN-Flag an allen anderen Schnittstellen enth√§lt, an andere Switches.  Das Bild zeigt die Struktur von TCN: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/871/0e9/123/8710e9123047de570b5fbf6eb8127ca9.jpg" alt="Bild"><br><br>  TCN wurde in STP aufgenommen, damit Nicht-Root-Switches √ºber eine √Ñnderung im Netzwerk benachrichtigen konnten.  Sie k√∂nnen dies nicht mit regul√§ren BPDUs tun, da Nicht-Root-Switches keine BPDUs senden.  Wie Sie sehen k√∂nnen, enth√§lt die TCN-Struktur keine Informationen dar√ºber, was genau und wo sich ge√§ndert hat, sondern meldet lediglich, dass sich irgendwo etwas ge√§ndert hat.  Kommen wir nun zur Frage der STP-Konvergenz. <br><br>  Mal sehen, was passiert, wenn wir die Gi0 / 1-Schnittstelle auf Switch1 deaktivieren und sehen, mit welchen Mechanismen der STP-Baum neu erstellt wird.  Switch2 empf√§ngt keine BPDUs von Switch1 und keine BPDUs von Switch3, da dieser Port an Switch3 blockiert ist.  Switch2 ben√∂tigt 20 Sekunden (Max Age Timer), um den Verbindungsverlust mit der Root Bridge zu verstehen.  Bis zu diesem Zeitpunkt befindet sich Gi0 / 0 auf Switch2 im Weiterleitungsstatus mit der Root-Port-Rolle.  Sobald der Max Age Timer abl√§uft und Switch2 den Kommunikationsverlust versteht, wird der STP-Baum neu erstellt und, wie es f√ºr STP typisch ist, als Root Bridge betrachtet.  Er sendet eine neue BPDU, in der er sich √ºber alle aktiven Ports, einschlie√ülich Switch3, als Root Bridge ausweist.  Der auf Switch2 abgelaufene Max Age-Timer ist jedoch auch auf Switch3 f√ºr die Gi1 / 0-Schnittstelle abgelaufen.  Dieser Port hat 20 Sekunden lang keine BPDU empfangen. Dieser Port wechselt in den Status LISTENING und sendet eine BPDU, die Root Bridge - Switch1 anzeigt.  Sobald Switch2 diese BPDU akzeptiert, betrachtet es sich nicht mehr als Root Bridge und w√§hlt Gi1 / 0 als Root-Port aus.  Zu diesem Zeitpunkt sendet Switch2 auch TCN √ºber Gi1 / 0, da dies der neue Root-Port ist.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies f√ºhrt dazu, dass die Speicherzeit der MAC-Adressen auf den Switches von 300 Sekunden auf 15 Sekunden reduziert wird. Dadurch wird das Netzwerk jedoch nicht vollst√§ndig wiederhergestellt. Sie m√ºssen warten, bis der Gi1 / 0-Port auf Switch3 das Abh√∂ren und dann das Lernen bestanden hat. Dies dauert zwei Zeitr√§ume f√ºr die Vorw√§rtsverz√∂gerungszeit - 15 + 15 = 30 Sekunden. Wenn die Verbindung unterbrochen wird, wartet Switch2 auf das Ablaufen des Timers Max Age = 20 Sekunden, w√§hlt Root Bridge erneut √ºber eine andere Schnittstelle aus und wartet weitere 30 Sekunden, bis der zuvor blockierte Port in den Weiterleitungsstatus wechselt. Insgesamt stellen wir fest, dass die Verbindung zwischen VPC5 und VPC6 f√ºr 50 Sekunden unterbrochen wird. Wie in mehreren S√§tzen oben erw√§hnt, wurde beim √Ñndern des Root-Ports von Gi0 / 0 auf Gi1 / 0 auf Switch2 TCN gesendet. Wenn dies nicht geschehen ist, werden alle MAC-Adressen √ºber den Gi-Port 0/0 gelernt.w√ºrde an Gi0 / 0 gebunden bleiben. Beispielsweise w√ºrde die MAC-Adresse von VPC5 und VPC7 trotz der Tatsache, dass STP die Konvergenz in 50 Sekunden abschlie√üt, die Verbindung zwischen VPC6 und VPC5, VPC7 nicht wiederhergestellt, da alle f√ºr VPC5, VPC7 bestimmten Pakete √ºber Gi0 / 0 gesendet wurden. Es w√§re notwendig, nicht 50 Sekunden, sondern 300 Sekunden zu warten, bis die MAC-Adresstabelle neu erstellt wird. Bei Verwendung von TCN wurde die Speicherzeit von 300 Sekunden auf 15 Sekunden ge√§ndert. W√§hrend die Gi1 / 0-Schnittstelle auf Switch3 den Abh√∂rstatus bestanden hat, werden die Lern- und MAC-Adressdaten aktualisiert.Die Speicherzeit wurde von 300 Sekunden auf 15 Sekunden ge√§ndert. W√§hrend die Gi1 / 0-Schnittstelle auf Switch3 die Abh√∂rzust√§nde bestanden hat, werden die Lern- und MAC-Adressdaten aktualisiert.Die Speicherzeit wurde von 300 Sekunden auf 15 Sekunden ge√§ndert. W√§hrend die Gi1 / 0-Schnittstelle auf Switch3 die Abh√∂rzust√§nde bestanden hat, werden die Lern- und MAC-Adressdaten aktualisiert.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interessant ist auch die Frage, was passiert, wenn wir die Gi0 / 1-Schnittstelle auf Switch1 wieder aktivieren? </font><font style="vertical-align: inherit;">Wenn die Gi0 / 1-Schnittstelle aktiviert ist, wechselt sie wie vorgesehen in den Listening-Status und beginnt mit dem Senden von BPDUs. </font><font style="vertical-align: inherit;">Sobald Switch2 eine BPDU am Gi0 / 0-Port empf√§ngt, w√§hlt er sofort seinen Root-Port erneut aus, da hier die Kosten am geringsten sind und Datenverkehr √ºber die Gi0 / 0-Schnittstelle gesendet wird. Wir m√ºssen jedoch warten, bis die Gi0 / 1-Schnittstelle den Status "Abh√∂ren, Lernen" an die Weiterleitung √ºbergibt . </font><font style="vertical-align: inherit;">Die Verz√∂gerung betr√§gt nicht mehr 50 Sekunden, sondern 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das STP-Protokoll hat auch verschiedene Technologien entwickelt, um den Betrieb des STP-Protokolls zu optimieren und zu sichern. </font><font style="vertical-align: inherit;">Ich werde sie in diesem Artikel nicht n√§her betrachten. Materialien √ºber sie finden Sie in H√ºlle und F√ºlle auf verschiedenen Websites.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de419491/">https://habr.com/ru/post/de419491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de419475/index.html">Wie man Inspiration findet und nicht die Einzigartigkeit verliert</a></li>
<li><a href="../de419477/index.html">Einfacher als es klingt. Kapitel 11</a></li>
<li><a href="../de419479/index.html">Sicherheit "Ekaterinburg Arena": Wie wir das Stadion f√ºr die WM 2018 vorbereitet haben</a></li>
<li><a href="../de419483/index.html">PowerShell und Shift + Ins oder wie Sie Hermes Geschwindigkeit bei der Arbeit mit GPP steigern k√∂nnen</a></li>
<li><a href="../de419485/index.html">Daf√ºr gibt es eine App: Ank√ºndigung von Mobius 2018 Moskau</a></li>
<li><a href="../de419493/index.html">Warum brauchst du Splunk? Sicherheitsereignisanalyse</a></li>
<li><a href="../de419495/index.html">Wer hat die Knochenleitung "erfunden", warum wird sie verwendet und wie sicher ist sie f√ºr das H√∂ren?</a></li>
<li><a href="../de419497/index.html">Hercules Strong 3D Gro√üdrucker Bewertung</a></li>
<li><a href="../de419501/index.html">Deep Learning: Erkennen von Szenen und Orientierungspunkten in Bildern</a></li>
<li><a href="../de419505/index.html">Sie k√∂nnen jetzt Pakete ohne Benachrichtigungen und P√§sse per Post im ganzen Land erhalten.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>