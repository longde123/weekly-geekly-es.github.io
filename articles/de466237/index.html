<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚖 🤟🏽 🧓🏽 Wie der grüne Junior seinen Hot-Reloader schrieb 🗞️ 🙍 👩🏾‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hintergrund 
 Ein paar Zeilen über mich, um ein allgemeines Verständnis des Niveaus des Autors und des zu lösenden Problems zu erhalten.  Mein Name is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie der grüne Junior seinen Hot-Reloader schrieb</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466237/"><h3>  Hintergrund </h3><br><div class="spoiler"> <b class="spoiler_title">Ein paar Zeilen über mich, um ein allgemeines Verständnis des Niveaus des Autors und des zu lösenden Problems zu erhalten.</b> <div class="spoiler_text">  Mein Name ist Eugene und ich bin ein <s>Webentwickler</s> Green Junior Frontend Entwickler. <br>  Vor einem anderen Jahr arbeitete ich in einem ganz anderen Bereich und dachte nur theoretisch darüber nach, meinen Beruf zu wechseln, aber um Dezember 2018 fand ich meinen Weg und begann zu schauspielern. <br>  Nach ungefähr sechs Monaten totaler Ausbildung bekomme ich einen Job als Frontend-Programmierer.  Ich habe grundlegende Dinge gelernt (ich möchte es glauben), js, Interaktion mit dem DOM, reagieren + reduzieren.  Mindestens HTML und CSS + ein allgemeines Verständnis von Bootstrap und Assembly, Arbeiten mit Git, der Befehlszeile. <br>  Zusätzlich zur Theorie wurden einige Schulungsprojekte durchgeführt, darunter ein Chat zu React + Redux sowie einige Versuche, einige ihrer Ideen umzusetzen. <br>  Im Allgemeinen ist ein solches Standard-Gentleman-Set für Anfänger geeignet. <br>  In den ersten anderthalb Wochen habe ich eine virtuelle Maschine eingerichtet, es gibt viel von allem und alles ist mir unbekannt und unverständlich. <br>  Dabei lerne ich neue Tools und Technologien kennen: Datenbanken (und setze mir ein weiteres Lesezeichen in die Lernliste), Kitt, Wincsp usw. <br>  Überquere diesen Hindernisparcours erfolgreich und gehe nach vorne. <br></div></div><br><h3>  Vorwort </h3><br>  Nachdem ich meinen Reloader und diesen Artikel bereits geschrieben hatte, fand ich Analoga, einschließlich solcher auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Habré</a> .  Er beschloss jedoch, sein Fahrrad zu veröffentlichen. <br><br><h3>  Starten Sie </h3><br>  Wir haben ein ziemlich großes Projekt geerbt, geschrieben in eckigem JS mit all seinen Reizen.  Nach React schien er mir wie ein Dinosaurier, aber nichts, ich kaufe eckige Kurse, fahre schnell hinein und fange an zu profitieren. <br><br>  Ein positiver Eindruck ist, dass das Projekt von Menschen mit deutlich geraden Armen gut geschrieben wurde.  Variablen mit ausgezeichneter klarer Benennung, die Struktur ist überall gleich und im Allgemeinen ist die gesamte Logik sehr zugänglich und einfach ausgedrückt. <br><br>  Aber es gibt genug Minuspunkte. <br><a name="habracut"></a><br>  Das erste Problem: Das Projekt wird von einem alten Minimierer erstellt, und es ist unmöglich, die moderne js-Syntax zu verwenden.  None () =&gt; {}, const res = [... data, subRes], async / await ... <br><br>  Das zweite Problem: Es gibt weder ein Webpack noch zumindest einen Schluck, und dementsprechend gibt es auch keinen Webpack-Dev-Server, der mir mit seinem hervorragenden Hot-Reload vertraut ist. <br><br>  Schrieb.  Gespeichert.  F5.  Unbequem.  Schmerz?  Kein direkter Schmerz, aber sehr unangenehm. <br><br>  Das dritte Problem: Erstellen der .bat-Datei des Projekts, in der ein Teil des Projekts einfach kopiert wird, ein Teil der Bibliotheken ohne Minimierung gesammelt wird, ein Teil in eine Datei minimiert wird, der Rest der Projektdateien in eine andere.  Liste der Bibliotheken in der dritten Datei.  Liste der Dateien, die im vierten erstellt werden sollen.  Usw. <br><br>  Das vierte Problem: Alle Bibliotheken befinden sich ordentlich im Ordner libs und sind durch ein Skript in index.html verbunden.  Alles in allem, außer Express und Proxy dafür (sie sind nicht an der Versammlung beteiligt, sondern nur für die Entwicklung). <br>  Und weit weg von überall gibt es Versionen oder Hinweise auf eine bestimmte Bibliothek. <br><br>  Ich habe in einer wunderschönen Welt der funktionalen Programmierung trainiert, voll von es6 +, Webpack-Dev-Server, tdd, eslint, automatischem Build und so weiter. <br><br>  Und hier in der Erwachsenenwelt ist alles ganz anders ... <br><br><h3>  Krawatte </h3><br>  Aber ich arbeite gerne, ich betrachte Hindernisse als Möglichkeiten zur Selbstentwicklung, das Unternehmen ist gut, die Atmosphäre ist ausgezeichnet, meine Augen brennen! <br><br>  In der Arbeitszeit erledige ich Arbeitsaufgaben, in meiner Freizeit versuche ich etwas zu verbessern. <br><br>  Mitte Juni beginne ich mit dem Versuch, das Webpack zu befestigen, aber der erste Ansatz erwartet einen vollständigen Fehler.  Ich bin seit einer Woche gequält, ich bin es sehr leid, vorübergehend aufgeschoben. <br><br>  Ich beschließe, klein anzufangen - ich verbinde die neue Syntax über babel.  Ich füge Babels anfängliche Verarbeitung zu unserer magischen build.bat hinzu, aber etwas bricht die Idylle und unser alter Minificator stolpert.  Ich suche ein Problem. <br><br>  Stolpert über eine der Bibliotheken aus den ordentlichen Papa-Bibliotheken.  Ich sehe mir Bibliotheksdateien an: Sie sind bereits in der alten Syntax minimiert. <br><br>  Ich sage babel - "du gehst nicht hierher ... der Kopf wird den Code bekommen, es wird wirklich schlimm sein."  Ich überprüfe: alles funktioniert!  Hurra!  Jetzt habe ich Zugang zu all diesen schönen neuen, stilvollen, trendigen Jugend-Dingen!  Erster Sieg.  Schön  Ich denke bei dieser Gelegenheit, das Skript in e.bat (e-Evgen) umzubenennen, kann mich aber nicht entscheiden. <br><br>  Die neue Syntax ist so vertraut und unterhaltsam, aber der Gedanke an einen krummen Build lässt mich nicht los. <br><br>  Ende Juni und Anfang Juli.  Ich mache den zweiten Ansatz, gründlicher, aber wieder stoße ich auf Fehler zwischen Webpack und AngularJS.  Wieder eine Woche Forschung. <br><br>  Nachdem ich einige Tage und teilweise Nächte damit verbracht habe, nach einer Lösung zu suchen, stoße ich auf äußerst interessante Reden von der HolyJS-Konferenz, bei der die Jungs bereits ziemlich tief in das Webpack eintauchen.  Ich mache Fortschritte in seinem Verständnis, aber ich verstehe das Material immer noch nicht bis zum Ende. <br><br>  Das Interesse steigt. <br><br>  Ein Kollege sagt - vergessen Sie es, um das Projekt in ein paar Monaten zu übergeben, müssen Sie dies nicht mehr tun. <br>  Ich hämmere nicht, aber ich schiebe es auf - viel Arbeit, es drückt mich alles zusammen, es bleibt keine Zeit mehr für außerschulische Aktivitäten. <br><br>  Mitte Juli bekomme ich ähnlich wie bei unserem Projekt einen maßgeschneiderten Build in die Hände.  Ich gehe mit ihm zum dritten Ansatz und richte praktisch ein Webpack mit uns ein, aber am Ende stelle ich neue Fehler fest, für deren Lösung ich nicht genug Zeit habe. Die Arbeit rollt mit neuer Intensität. Es zerstört mich mental. Ich habe dieses Geschäft wieder aufgeschoben. <br><br><h3>  Hauptteil </h3><br>  Mitte August.  Infolgedessen spricht ein Freund über das Lernen von node.js und seinen Wunsch, seinen eigenen Hot-Reloader zu schreiben.  Gedanken über unsere Versammlung flammen mit neuer Kraft auf. <br><br>  Aufgabe: Laden Sie die aktuelle Seite neu, wenn Sie Dateien im Projekt aktualisieren. <br>  Features: Alle Bibliotheken sind in index.html verbunden, Sie können nicht benötigen, ganz zu schweigen vom Import.  Die Baugruppe vor dem erneuten Laden wird noch nicht benötigt, nur neu laden.  Auf einem Entwicklungsserver, der Anfragen für unser Backing als Proxy sendet, kann ich Pakete verwenden und auch benötigen! <br><br>  All dies geschieht am Freitag und ich entscheide, dass ich in einer vereinfachten Version für unser Projekt durchaus in der Lage bin, eine Technologie zu implementieren, die mich und meine Kollegen vor F5 bewahrt. <br><br>  Der Denkprozess geht weiter und eine Vision der Lösung wird im Kopf gebildet. <br>  Auf dem einfachsten Server (wie unserem) werde ich den gesamten Ordner und die Unterordner durchsuchen und einen Baum mit den Änderungsdaten jeder Datei bilden. <br><br>  Dann werde ich alle n Millisekunden immer wieder umgehen und die Werte der Änderungszeit vergleichen.  Geändert - neu laden.  Ein Freund sagt dir: "Erfinde das Rad nicht neu, es gibt eine Uhr in node.js".  Großartig, ich werde es benutzen.  In server.js konfiguriere ich watch hinter dem Projektordner und rufe location.reload () auf, um etwas darin zu ändern. <br><br>  Erste Iteration: <br><br><div class="spoiler">  <b class="spoiler_title">server.js</b> <div class="spoiler_text"><pre><code class="plaintext hljs">var express = require('express'); var app = express(); var server = require('http').Server(app); const port = 9080; server.listen(port); app.use(express.static(__dirname + '/src')); location.reload().</code> </pre> <br></div></div><br>  Das erste Problem ist location - dies ist keine node.js-Variable (in diesem Moment verstehe ich, warum meine Versuche, auf process.env an der Vorderseite zuzugreifen, ebenfalls erfolglos waren)). <br><br>  Das zweite Problem ist, wie die Front verstehen kann, was beim Nachladen zu tun ist. <br><br>  Exit - Websocket!  Die Idee ist verlockend + Ich habe mit ihnen "Halbkegel" gearbeitet, als ich einen Chat schrieb, ich habe eine allgemeine Idee.  Gleichzeitig führe ich pro Sitzung einen Neustartzähler durch, füge eine Variable hinzu und verarbeite die Anforderung, die sie gibt. <br><br>  Ich versuche: <br><br><div class="spoiler">  <b class="spoiler_title">server.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">var express = require('express'); //  express var app = express(); var server = require('http').Server(app); //  http  app var io = require('socket.io')(server); //  socket.io     var fs = require('fs'); const port = 9080; server.listen(port); app.use(express.static(__dirname + '/src')); let count = 0; app.get('/data', (req, res) =&gt; { res.data = count; res.send(`${count}`); }) const dir = './src'; fs.watch(dir, () =&gt; { io.emit('change', {data: count}); count += 1; })</code> </pre><br></div></div><br>  An der Front mache ich die einfachste App auf Angularjs <br><br><div class="spoiler">  <b class="spoiler_title">app.js.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">angular.module('App', []) .controller('myAppCtrl',['$scope', '$timeout','$http', ($scope, $timeout, $http) =&gt; { $scope.title = '       '; $scope.count = 0; $scope.todo = [ '  ,  ', '   node.js watch   ', '     ,         ', ' , codeclimate  travis   ' ] $scope.marks = [ 'watcher      ' ] // var socket = io(); // socket.on('change', (data) =&gt; { // console.log(data.data); // $scope.count = data.data; // console.log('scope.count: ', $scope.count); // $scope.$digest();// // location.reload();//agfr // }) $http({method: 'GET',url: 'data'}) .then(response =&gt; { $scope.count = response.data;// }); }])</code> </pre><br></div></div><br>  Und ein separates Modul, das es neu lädt.  Separat, damit das Projekt nicht zu viel bekommt. <br><br><div class="spoiler">  <b class="spoiler_title">watch.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">var socket = io(); socket.on('change', () =&gt; { location.reload(); })</code> </pre><br></div></div><br>  Es funktioniert!  Er überwacht auch andere Dateien als js (man weiß es nie!): Checked .json, .css. <br>  Ich überprüfe die Unterordner - es funktioniert nicht. <br><br>  Ich denke, okay, jetzt werde ich es rekursiv reduzieren.  Nur für den Fall, Google und - voila - ist bereit <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Entscheidung.</a> <br><br>  Fügen Sie dieses Paket hinzu. <br><br><div class="spoiler">  <b class="spoiler_title">server.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">var express = require('express'); //  express var app = express(); var server = require('http').Server(app); //  http  app var io = require('socket.io')(server); //  socket.io     var fs = require('fs'); var watch = require('node-watch'); const port = 9080; server.listen(port); app.use(express.static(__dirname + '/src')); let count = 0; let changed = []; app.get('/data', (req, res) =&gt; { res.data = count; res.send({count, changed}); }) const translate = { remove: "", update: "" } watch('./', { recursive: true }, function(evt, name) { io.emit('change', {data: count}); count += 1; changed = [{name, evt}, ...changed]; });</code> </pre><br></div></div><br>  Hurra, es funktioniert! <br><br>  Ich erinnere mich an Eslint, Codeclimate und Travis. <br>  Installieren Sie die erste, fügen Sie den Rest hinzu. <br>  Ich bereinige den Code, alles ist var on const und so weiter. <br><br>  Linter schwört, dass der Winkel nicht definiert ist, aber meine Funktionen zum Verbinden von Bibliotheken im Projekt bestimmen dieses Verhalten. Ich schalte es aus.  Gleichzeitig schraube ich die Variablen ein wenig aus der Kommandozeile, führe sie aus, alles funktioniert! <br><br>  Er kam am Montag zur Arbeit und befestigte die gesamte Farm an einem Arbeitsentwurf.  Ich musste ein wenig ändern, gleichzeitig Änderungen vornehmen, damit es möglich war, einige Startparameter über die Befehlszeile und Ausnahmen zu ändern, so dass ich nicht alles las. <br><br>  Infolgedessen stellte sich Folgendes heraus: <br><br><div class="spoiler">  <b class="spoiler_title">server.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">const express = require('express'), http = require('http'), watch = require('node-watch'), proxy = require('http-proxy-middleware'), app = express(), server = http.createServer(app), io = require('socket.io').listen(server), exeptions = ['git', 'js_babeled', 'node_modules', 'build', 'hotreload'], // ,   ,    backPortObj = { /*  ,   back*/ }, address = process.argv[2] || /*    back*/, localHostPort = process.argv[3] || 9080, backMachinePort = backPortObj[address] || /*   back */, isHotReload = process.argv[4] || "y", // "n" || "y" target = `http://192.168.${address}:${backMachinePort}`, str = `Connected to machine: ${target}, hot reload: ${isHotReload === 'y' ? 'enabled' : 'disabled'}.`, link = `http://localhost:${localHostPort}/`; server.listen(localHostPort); app .use('/bg-portal', proxy({ target, changeOrigin: true, ws: true })) .use(express.static('.')); if (isHotReload === 'y') { watch('./', { recursive: true }, (evt, name) =&gt; { let include = false; exeptions.forEach(item =&gt; { if (`${name}`.includes(item)) include = true; }) if (!include) { console.log(name); io.emit('change', { evt, name, exeptions }); }; }); }; console.log(str); console.log(link);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">app.js.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">var socket = io.connect(); socket.on('change', ({ evt, name, exeptions }) =&gt; { location.reload(); });</code> </pre><br></div></div><br>  Das laufende Skript in package.json ruft nur server.js unter dem Knoten auf und beginnt wie folgt: <br><br><pre> <code class="plaintext hljs">npm start 1.100 8080</code> </pre><br>  Schrieb.  Gespeichert.  <s>F5</s> <br><br>  Abschließend möchte ich Vanya, meiner Freundin, an einigen Stellen dem Mastermind und dem Hauptkicker sowie Sasha - dem Mann, den ich als meinen Mentor betrachte - danken! <br><br><h3>  Anstelle eines Nachwortes </h3><br>  Und nach 2 Wochen, am letzten Tag meiner Testphase, schraubte ich Webpack und Webpack-Dev-Server in unser Projekt und schickte meinen heißen Reloader in den Staub im Geschichtsregal. <br><br>  Diese 2 Wochen haben wir es jedoch jeden Tag benutzt und er hat regelmäßig seinen Job gemacht! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466237/">https://habr.com/ru/post/de466237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466223/index.html">Saubere Zersetzung</a></li>
<li><a href="../de466227/index.html">Knotenorientierte Programmierung</a></li>
<li><a href="../de466229/index.html">Wie man zehn Schachteln Watte kauft und keinen Fehler macht</a></li>
<li><a href="../de466231/index.html">ShIoTiny und die umliegende Welt: Anschließen von Sensoren an Binäreingänge, Kontaktsprung und andere Probleme</a></li>
<li><a href="../de466235/index.html">Munch in einem äquidistanten Scan und Meyerhold, der den Roten Platz zerstörte - Denis Semenov auf VR-Kunst</a></li>
<li><a href="../de466247/index.html">Introvertiertes Interview</a></li>
<li><a href="../de466249/index.html">Schreiben einer Schlange für Android in Kivy, Python</a></li>
<li><a href="../de466251/index.html">Das Projekt von Soft Launch auf 1 Million US-Dollar Umsatz pro Monat steigern</a></li>
<li><a href="../de466253/index.html">Wie ich die Landeplätze von ALS Luna-9 und Luna-13 rekonstruiert habe</a></li>
<li><a href="../de466257/index.html">Eroberung der Meere: Schwimmende Data Warehouses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>