<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí™üèº üêö ü§í M√©todo de promedio vectorial para medir la direcci√≥n del viento üèâ üèüÔ∏è üëÉüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace un a√±o, describ√≠ una estaci√≥n meteorol√≥gica con un instrumento de medici√≥n para la direcci√≥n y velocidad del viento. En base a la experiencia de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©todo de promedio vectorial para medir la direcci√≥n del viento</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423243/"> Hace un a√±o, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describ√≠ una</a> estaci√≥n meteorol√≥gica con un instrumento de medici√≥n para la direcci√≥n y velocidad del viento.  En base a la experiencia de dos temporadas operativas, se hicieron algunos cambios y mejoras, que se describen parcialmente all√≠ adem√°s del texto principal. <br><br>  Uno de estos cambios se refiere al c√°lculo de la direcci√≥n promedio del viento.  Para mi sorpresa, no encontr√© nada sensato sobre este tema en la Web, solo en uno de los foros las personas mismas casi pensaron en el m√©todo de promediaci√≥n de vectores (pero solo casi, no resolvieron el problema en t√©rminos generales).  Por lo tanto, me pareci√≥ √∫til poner este tema en una publicaci√≥n separada; de repente, alguien m√°s ser√° √∫til.  El m√©todo se puede usar para promediar cualquier cantidad de vectores, no solo viento o corriente. <br><a name="habracut"></a><br>  Tenga en cuenta que el m√©todo can√≥nico para realizar mediciones meteorol√≥gicas del viento es el siguiente: promediar el vector (es decir, tanto la velocidad como la direcci√≥n) durante 10 minutos (en Rusia y en la mayor√≠a de los pa√≠ses del mundo se acepta de esa manera, dicen, en los EE. UU. Y algunos otros pa√≠ses de manera diferente).  En este caso, las mediciones se toman a una altura de 10 m de la superficie de la Tierra.  Asegurar todo esto bajo condiciones de rodilla es bastante dif√≠cil: uno no puede alcanzar una altura de 10 m en espacio abierto (no construya una torre especial, lejos de casas y √°rboles que distorsionen el flujo del viento), y la temperatura con humedad debe, por el contrario, medirse a la sombra y cerca desde la superficie  El sensor port√°til se transforma de un dispositivo compacto en un sistema de medici√≥n completo (ver foto del territorio de una estaci√≥n meteorol√≥gica en la ciudad de Kirov). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b03/704/b2b/b03704b2bd492c4455aae265a659d489.jpg" alt="Estaci√≥n meteorol√≥gica en Kirov"><br><br>  Y el resultado, un promedio de 10 minutos, ser√° poco informativo.  Cerca de la superficie, el viento es mucho m√°s fuerte que en altitud, en 10 minutos puede cambiar la velocidad y la direcci√≥n veinte veces, y la informaci√≥n sobre estas r√°fagas es mucho m√°s informativa para la persona promedio que el valor promedio.  Perm√≠tame recordarle que el sensor de velocidad aqu√≠ muestra el valor m√°ximo de cuatro mediciones por ciclo de 8 s, y result√≥ ser la elecci√≥n correcta (de hecho, obtuvimos un sensor de ondulaci√≥n en lugar del sensor de velocidad promedio). <br><br>  Pero la veleta result√≥ ser m√°s malhumorada que el sensor de velocidad.  Seg√∫n el algoritmo inicial de mi estaci√≥n meteorol√≥gica (que se seleccion√≥ en funci√≥n del m√°ximo ahorro de energ√≠a posible), la direcci√≥n se midi√≥ una vez por ciclo, es decir, incluso las pulsaciones no funcionaron: hubo muestras aleatorias del proceso continuo de colgar la veleta de ida y vuelta con una frecuencia mucho mayor que una vez cada 8 y M√°s de 16 segundos. <br><br>  Por lo tanto, se decidi√≥ promediar la direcci√≥n del vector de velocidad por ciclo, tomando mediciones cada dos segundos y calculando el promedio.  Y la cuesti√≥n no es que pueda resolverse con una media patada: los valores de direcci√≥n no forman una matriz uniforme de n√∫meros que se puedan agregar y dividir directamente (una palabra es un vector, no un escalar de mierda).  Por lo general, se da un ejemplo con valores de 1 grado y 359 grados: es f√°cil darse cuenta de que en promedio ser√° exactamente 360 ‚Äã‚Äã(o 0, sin diferencia), pero la aritm√©tica ordinaria dar√° el n√∫mero 180 grados. <br><br>  No hay necesidad de inventar nada, todo ya ha sido inventado antes que usted.  El problema se resuelve mediante el m√©todo de promediaci√≥n de vectores, bien conocido por aquellos que se ocuparon de mediciones de vientos o corrientes.  El m√©todo es esencialmente muy simple: dado que no podemos promediar directamente los √°ngulos, entonces promediemos las proyecciones del vector en el eje de coordenadas, que, por definici√≥n, es un valor escalar, es decir, puede someterse a la aritm√©tica ordinaria sin ninguna duda. <br><br>  Las proyecciones del vector de viento actual W '(el ap√≥strofe desempe√±a el papel de un super√≠ndice) en los ejes X e Y son wx = Wa ‚Ä¢ cos (Œ±) y wy = Wa ‚Ä¢ sin (Œ±), donde Wa es el m√≥dulo del vector (valor de velocidad), y Œ± - el valor del √°ngulo entre el vector y el eje de coordenadas cero.  Si promediamos estos valores de las proyecciones, y luego convertimos los promedios nuevamente en un vector, entonces obtenemos el verdadero valor de la velocidad y direcci√≥n promedio del viento. <br><br><div class="spoiler">  <b class="spoiler_title">Nota para particularmente corrosivo</b> <div class="spoiler_text">  Para un promedio completamente correcto de esta manera, es necesario que el valor de Wa (valor de velocidad) se mida estrictamente simult√°neamente con el valor del √°ngulo.  En la pr√°ctica, esto debe ser monitoreado solo si los per√≠odos de fluctuaciones significativas en la amplitud del flujo son menores o comparables con el tiempo de las mediciones.  Para el viento (y para casi todos los casos del flujo natural de agua), generalmente no es necesario monitorear, ya que el tiempo de medici√≥n para nosotros es un m√°ximo de una fracci√≥n de segundo, y las pulsaciones significativas del viento, por supuesto, duran m√°s.  Podemos descuidar las inhomogeneidades de alta frecuencia del flujo, porque no afectan nada: la inercia de los cuerpos f√≠sicos reales (incluidos los sensores) es mucho mayor que estas inhomogeneidades, y simplemente no las sentiremos: un trozo de papel temblar√°, pero nada m√°s.  En casos extremos, saldr√°n como un peque√±o ruido aleatorio que no afecta significativamente la calidad de las mediciones. <br></div></div><br>  Este maravilloso m√©todo (llam√©moslo promedio de vectores completo) tiene un inconveniente cardinal desde un punto de vista pr√°ctico: en ausencia de un sujeto de medici√≥n (es decir, cuando hay una calma total, que es un caso bastante com√∫n), da un resultado matem√°ticamente incorrecto: dado que la velocidad del viento es cero, entonces y ambas proyecciones son iguales a cero, lo que no puede ser (ya que sin y cos son funciones complementarias).  M√°s precisamente, puede ser, pero es fundamentalmente imposible extraer informaci√≥n de tal situaci√≥n.  ¬øQu√© quieres mostrar en la pantalla?  Para ser honesto, todav√≠a no s√© la forma correcta de solucionar esta situaci√≥n (en los medidores de flujo que una vez dise√±√©, los ciclos promedio fueron horas, y se cre√≠a que al menos se producir√≠a algo de agitaci√≥n). <br><br>  Pero en nuestro caso, la tarea, afortunadamente, es m√°s f√°cil: no necesitamos promediar la velocidad, y podemos hacerlo con proyecciones √∫nicas del vector, sin tener en cuenta la magnitud de su m√≥dulo.  En otras palabras, uno puede operar con senos y cosenos puros, que nunca toman cero a la vez: incluso cuando no hay viento, una veleta congelada en bienes ra√≠ces muestra alguna direcci√≥n.  Llamamos a este m√©todo un vector promedio simplificado de una direcci√≥n (tal vez tiene alg√∫n nombre oficial, pero no lo s√©). <br><br>  Ahora solo hab√≠a una dificultad: convertir los valores de proyecci√≥n promedio calculados nuevamente en el valor del √°ngulo.  Para esto, generalmente se usa la funci√≥n Œ± = arctan (sin (Œ±) / cos (Œ±)), pero si calculamos a trav√©s de las funciones trigonom√©tricas inversas, entonces es m√°s simple tomar simplemente arcos (cos (Œ±)) (o arcsin (sin (Œ±)), de todos modos), y para complementar este resultado para obtener un c√≠rculo completo (es decir, de 0 a 359 grados), analizando los signos de las proyecciones, a√∫n debe hacerlo en cualquier caso: todas las funciones inversas dan el resultado dentro de un semic√≠rculo (de 0 a 180 o de -90 a +90).  (Ver UPD sobre esto al final del art√≠culo). <br><br>  Formalizamos todo lo anterior en un algoritmo real (con referencia a Arduino).  Para comenzar, leeremos las indicaciones de direcci√≥n no en cada ciclo, sino en cada medici√≥n (despu√©s del valor de la frecuencia del anem√≥metro).  Convertiremos el resultado en c√≥digo Gray (en nuestro pa√≠s fue designado como wind_Gray de tipo byte, vea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esa publicaci√≥n</a> ) a c√≥digo binario ordinario y, al igual que la frecuencia del anem√≥metro, lo colocaremos en una matriz global, que declararemos como wDirAvr [4], donde 4 es el n√∫mero de mediciones en el ciclo.  No pintaremos la conversi√≥n del c√≥digo Gray de cuatro d√≠gitos a c√≥digo binario; esto se puede hacer de varias maneras a discreci√≥n del programador y se describe en cualquier referencia. <br><br>  Este c√≥digo binario tomar√° valores de 0 a 15, y estamos de acuerdo en que contaremos los √°ngulos, no como ge√≥grafos / top√≥grafos / navegadores desplazados, sino como personas normales que estudiaron trigonometr√≠a en la escuela, en sentido antihorario.  Es decir, si el norte corresponde al valor cero, entonces 90 grados no es el este, como en los "desplazados", sino el oeste.  Como tenemos 16 gradaciones de direcci√≥n, necesitamos multiplicar el valor del c√≥digo por 22.5 (360/16) para obtener la direcci√≥n en grados ordinarios del arco. <br><br>  Ahora, el algoritmo real de promediado vectorial simplificado de la direcci√≥n a partir de 4 valores de c√≥digo: <br><br><pre><code class="plaintext hljs">. . . . . float wSin=0; // sin float wCos=0; // cos float wind_Rad; //   for (byte i=0; i&lt;4; i++){ wind_Rad= ((float(wDirAvr[i])*22.5)*M_PI/180); //   wSin=wSin+sin(wind_Rad);//    sin wCos=wCos+cos(wind_Rad);//    cos } // wSin=wSin/4;// sin ‚Äì    ,   wCos=wCos/4; // cos wind_Rad = acos(wCos); //     arccos if (wSin&lt;0) wind_Rad=2*M_PI-wind_Rad; //   sin int wind_G = round ((wind_Rad*180/M_PI)/22.5); //    0-15 . . . . .</code> </pre> <br>  La √∫ltima l√≠nea convertimos el promedio, expresado en radianes, al promedio, expresado en nuestro c√≥digo de 0 a 15. Luego puede convertirlo nuevamente al c√≥digo Gray, luego ni siquiera tiene que cambiar el programa en el m√≥dulo principal para mostrar la direcci√≥n. <br><br>  Aqu√≠, de hecho, est√° todo el algoritmo.  Ten√≠a miedo de que el c√°lculo de cosenos-arcosinas desacelere el d√©bil controlador (para los tiempos de 32 bits de hoy), pero no pas√≥ nada: se trag√≥ el c√≥digo sin siquiera parpadear ... un LED, probablemente. <br><br>  <b>UPD</b> : Para el autor, el algoritmo funciona de esta forma durante varios meses sin fallas.  Sin embargo, los comentaristas me llevaron a un posible error, aunque extremadamente improbable en la pr√°ctica: si los datos contienen dos grupos de mediciones que est√°n aproximadamente separados 180 grados entre s√≠ cerca del valor del coseno cero (es decir, alrededor de 90 y 270 grados), entonces el algoritmo producir√° un error valor  Para evitarlo, en lugar de acos (), utilice la funci√≥n atan2 (wSin, wCos), que proporciona inmediatamente el resultado correcto teniendo en cuenta los signos seno y coseno (gracias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aamonster</a> por la ayuda).  La l√≠nea donde se calcula el valor promedio de wSin no debe comentarse, y la l√≠nea ajustada para el signo wSin no es necesaria.  En su lugar, debe insertar la conversi√≥n a valores positivos del √°ngulo (ya que atan2 proporciona valores de pi a -pi): <br><pre> <code class="plaintext hljs">if (wind_Rad&lt;0) wind_Rad=2*M_PI+wind_Rad;</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423243/">https://habr.com/ru/post/es423243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423233/index.html">Inteligencia artificial en el mundo real</a></li>
<li><a href="../es423235/index.html">De Dribbble a Android Motion</a></li>
<li><a href="../es423237/index.html">Un brazo rob√≥tico simple pero sofisticado</a></li>
<li><a href="../es423239/index.html">Cree paquetes para Kubernetes con Helm: estructura de gr√°ficos y plantillas</a></li>
<li><a href="../es423241/index.html">Descripci√≥n general de los tel√©fonos SIP Digip A20 y A25</a></li>
<li><a href="../es423247/index.html">¬øQu√© es la inteligencia?</a></li>
<li><a href="../es423249/index.html">Rust 1.29 Lanzamiento</a></li>
<li><a href="../es423251/index.html">Mi cuenta de Megafail</a></li>
<li><a href="../es423253/index.html">Plataforma CAD dom√©stica nanoCAD Plus 10: un complejo universal para quienes dise√±an</a></li>
<li><a href="../es423257/index.html">Argumentos de funciones como constantes de bit en PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>