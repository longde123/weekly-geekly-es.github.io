<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•´ üßóüèº üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® Apache NIFI: una breve descripci√≥n general de las caracter√≠sticas en la pr√°ctica üå®Ô∏è üë¶üèΩ üë®‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 Sucedi√≥ que en mi lugar de trabajo actual tuve que familiarizarme con esta tecnolog√≠a. Comenzar√© con un poco de historia. En el pr√≥xi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apache NIFI: una breve descripci√≥n general de las caracter√≠sticas en la pr√°ctica</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465299/"><h3>  Introduccion </h3><br><p> Sucedi√≥ que en mi lugar de trabajo actual tuve que familiarizarme con esta tecnolog√≠a.  Comenzar√© con un poco de historia.  En el pr√≥ximo rally, a nuestro equipo le dijeron que ten√≠amos que crear integraci√≥n con un <em>sistema conocido</em> .  Por integraci√≥n, se entendi√≥ que este conocido sistema enviar√≠a solicitudes a trav√©s de HTTP a un punto final espec√≠fico y, curiosamente, enviar√≠amos las respuestas en forma de mensaje SOAP.  Todo parece ser simple y trivial.  Sigue lo que se necesita ... <a name="habracut"></a></p><br><h3>  Desaf√≠o </h3><br><p>  Crea 3 servicios.  El primero es el Servicio de actualizaci√≥n de la base de datos.  Este servicio, cuando llegan nuevos datos de un sistema de terceros, actualiza los datos en la base de datos y genera un cierto archivo CSV para transferirlos al siguiente sistema.  Se llama al punto final del segundo servicio: el servicio de transporte FTP, que recibe el archivo transferido, lo valida y lo coloca en el almacenamiento de archivos a trav√©s de FTP.  El tercer servicio, el Servicio de transferencia de datos para el consumidor, funciona de forma as√≠ncrona con los dos primeros.  Recibe una solicitud de un sistema externo de terceros, para recibir el archivo discutido anteriormente, toma el archivo de respuesta terminado, lo modifica (actualiza los campos id, description, linkToFile) y env√≠a la respuesta en forma de mensaje SOAP.  Es decir, el panorama general es el siguiente: los dos primeros servicios comienzan su trabajo solo cuando llegan los datos para la actualizaci√≥n.  El tercer servicio funciona constantemente ya que hay muchos consumidores de informaci√≥n, alrededor de 1000 solicitudes para recibir datos por minuto.  Los servicios est√°n constantemente disponibles y sus instancias est√°n ubicadas en diferentes entornos, como prueba, demostraci√≥n, preprod y prod.  A continuaci√≥n se muestra un diagrama del trabajo de estos servicios.  Explicar√© de inmediato que algunos detalles se simplifican para evitar una complejidad innecesaria. <cut></cut></p><br><p><img src="https://habrastorage.org/webt/ni/-q/5j/ni-q5j3x3izj-jm2azo7mbhqimi.png"></p><br><h3 id="tehnicheskoe-uglublenie">  Profundizaci√≥n t√©cnica </h3><br><p>  Cuando planificamos una soluci√≥n al problema, primero decidimos hacer aplicaciones Java utilizando Spring Framework, el equilibrador Nginx, la base de datos Postgres y otras cosas t√©cnicas y no muy importantes.  Dado que el tiempo para desarrollar una soluci√≥n t√©cnica nos permiti√≥ considerar otros enfoques para resolver este problema, mis ojos se centraron en la tecnolog√≠a Apache NIFI, de moda en ciertos c√≠rculos.  Debo decir de inmediato que esta tecnolog√≠a nos permiti√≥ notar estos 3 servicios.  Este art√≠culo describir√° el desarrollo de un servicio de transferencia de archivos y un servicio de transferencia de datos a un consumidor, sin embargo, si el art√≠culo llega, escribir√© sobre un servicio de actualizaci√≥n de datos en la base de datos. <cut></cut></p><br><h3 id="chto-eto-takoe">  Que es esto </h3><br><p>  NIFI es una arquitectura distribuida para la carga paralela r√°pida y el procesamiento de datos, una gran cantidad de complementos para fuentes y transformaciones, configuraciones de versiones y mucho m√°s.  Una buena ventaja es que es muy f√°cil de usar.  Los procesos triviales, como getFile, sendHttpRequest y otros, se pueden representar como cuadrados.  Cada cuadrado representa un cierto proceso, cuya interacci√≥n se puede ver en la figura a continuaci√≥n.  Aqu√≠ se escribe documentaci√≥n m√°s detallada sobre la interacci√≥n del ajuste del proceso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.</a> <cut></cut>  , para los que est√°n en ruso, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  La documentaci√≥n describe perfectamente c√≥mo desempaquetar y ejecutar NIFI, as√≠ como c√≥mo crear procesos, son cuadrados <br>  La idea de escribir un art√≠culo naci√≥ despu√©s de una larga b√∫squeda y estructuraci√≥n de la informaci√≥n recibida en algo consciente, as√≠ como el deseo de facilitar la vida de los futuros desarrolladores. <cut></cut></p><br><h3 id="primer">  Ejemplo </h3><br><p>  Se considera un ejemplo de c√≥mo los cuadrados interact√∫an entre s√≠.  El esquema general es bastante simple: recibimos una solicitud HTTP (en teor√≠a, con un archivo en el cuerpo de la solicitud. Para demostrar las capacidades de NIFI, en este ejemplo, la solicitud inicia el proceso de recibir el archivo desde el PF local), luego enviamos la respuesta de que la solicitud fue recibida, el proceso de recibir el archivo desde FH y luego el proceso de moverlo a trav√©s de FTP a FH.  Vale la pena explicar que los procesos interact√∫an entre s√≠ a trav√©s del llamado flowFile.  Esta es la entidad b√°sica en NIFI que almacena atributos y contenido.  El contenido son los datos representados por el archivo continuo.  En t√©rminos generales, si recibi√≥ un archivo de un cuadrado y lo transfiri√≥ a otro, el contenido ser√° su archivo. <cut></cut></p><br><p><img src="https://habrastorage.org/webt/gu/dj/fx/gudjfxvisdkmjyl-wxdp0tyijt4.png"></p><br><p>  Como puede ver, esta figura representa el proceso general.  HandleHttpRequest: acepta solicitudes, ReplaceText: genera un cuerpo de respuesta, HandleHttpResponse: devuelve una respuesta.  FetchFile: recibe un archivo del almacenamiento de archivos y lo transfiere al cuadrado PutSftp: coloca este archivo en FTP en la direcci√≥n especificada.  Ahora m√°s sobre este proceso. <cut></cut></p><br><p>  En este caso, la solicitud es el comienzo de todo.  Veamos sus opciones de configuraci√≥n. </p><br><p><img src="https://habrastorage.org/webt/1w/fw/ln/1wfwlnfw40fmygnl3uugnwkf3-a.png"></p><br>  Todo aqu√≠ es bastante trivial con la excepci√≥n de StandartHttpContextMap: este es un servicio que le permite enviar y recibir solicitudes.  Puedes ver m√°s detalles e incluso ejemplos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://ddewaele.github.io/">aqu√≠</a> <cut></cut><br><p>  A continuaci√≥n, vea las opciones de configuraci√≥n del cuadrado Reemplazar texto.  Vale la pena prestar atenci√≥n a ReplacementValue: esto es lo que devolver√° al usuario en forma de respuesta.  En la configuraci√≥n puede ajustar el nivel de registro, los registros se pueden ver {donde se descomprimi√≥ nifi} /nifi-1.9.2/logs tambi√©n hay par√°metros de falla / √©xito; en funci√≥n de estos par√°metros, puede controlar todo el proceso.  Es decir, en el caso de un procesamiento de texto exitoso, se invoca el proceso de enviar una respuesta al usuario, y en otro caso, simplemente nos comprometemos con el proceso fallido. <cut></cut></p><br><p><img src="https://habrastorage.org/webt/o-/iq/gf/o-iqgfwl0ybjkzuixnb9j_tmcfw.png"></p><br><p>  Las propiedades HandleHttpResponse no tienen nada especial excepto el estado para la creaci√≥n exitosa de respuestas. </p><br><p><img src="https://habrastorage.org/webt/gz/ew/8w/gzew8wbk4rkz0ya9fs4b5q4z1vo.png"></p><br><p>  Resolvimos la solicitud con la respuesta: pasemos a recibir el archivo y colocarlo en el servidor FTP.  FetchFile: recibe el archivo en la ruta especificada en la configuraci√≥n y lo transfiere al siguiente proceso. </p><br><p><img src="https://habrastorage.org/webt/wz/l6/mz/wzl6mz7-4sayovbstrz-1jwlip0.png"></p><br><p>  Y luego el cuadrado PutSftp: coloca el archivo en el almacenamiento de archivos.  Los par√°metros de configuraci√≥n se pueden ver a continuaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/bw/wq/mr/bwwqmrh5k0bqjuyyo4ldct3ozak.png"></p><br><p>  Vale la pena prestar atenci√≥n al hecho de que cada cuadrado es un proceso separado que debe iniciarse.  Examinamos el ejemplo m√°s simple que no requiere ninguna personalizaci√≥n complicada.  Luego, considere el proceso un poco m√°s complicado, donde escribimos un poco en los surcos. <cut></cut></p><br><h3 id="bolee-slozhnyy-primer">  Ejemplo m√°s complejo </h3><br><p>  El servicio de transferencia de datos al consumidor result√≥ ser un poco m√°s complicado debido al proceso de modificaci√≥n del mensaje SOAP.  El proceso general se presenta en la figura a continuaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/e1/3y/be/e13ybeifhhjankse7kj3a22stiu.png"></p><br><p>  Aqu√≠, la idea tampoco es muy complicada: recibimos una solicitud del consumidor de que necesitaban datos, enviamos una respuesta de que recibieron un mensaje, comenzamos el proceso de recibir el archivo de respuesta, luego lo editamos con cierta l√≥gica y luego transferimos el archivo al consumidor en forma de mensaje SOAP al servidor. <cut></cut></p><br><p>  Creo que no vale la pena volver a describir esos cuadrados que vimos arriba: iremos directamente a los nuevos.  Si necesita editar un archivo y los cuadrados regulares como Reemplazar texto no son adecuados, tendr√° que escribir su propio script.  Esto se puede hacer usando el cuadrado ExecuteGroogyScript.  Su configuraci√≥n se presenta a continuaci√≥n. <cut></cut></p><br><p><img src="https://habrastorage.org/webt/4j/qi/s-/4jqis-go8xhrcpcfhb2fcx-nygu.png"></p><br><p>  Hay dos opciones para cargar el script en este cuadrado.  El primero es cargando el archivo de script.  El segundo es mediante la inserci√≥n de un script en scriptBody.  Hasta donde yo s√©, el cuadrado executeScript admite varios JP, uno de ellos es maravilloso.  Estoy decepcionando a los desarrolladores de Java: no se pueden escribir scripts en dichos cuadrados en Java.  Para aquellos que realmente quieran, debe crear su propio cuadrado personalizado y lanzarlo al sistema NIFI.  Toda esta operaci√≥n va acompa√±ada de bailes bastante largos con una pandereta, que no trataremos en el marco de este art√≠culo.  Eleg√≠ un lenguaje maravilloso.  A continuaci√≥n se muestra un script de prueba que simplemente actualiza incrementalmente la identificaci√≥n en el mensaje SOAP.  Es importante tener en cuenta.  Tome el archivo de flowFile, actual√≠celo, no olvide que lo necesita, actualizado, vuelva a colocarlo all√≠.  Tambi√©n vale la pena se√±alar que no todas las bibliotecas est√°n conectadas.  Puede suceder que todav√≠a tenga que importar una de las librer√≠as.  La desventaja es que el gui√≥n en esta plaza es bastante dif√≠cil de debutar.  Hay una manera de conectarse a JVM NIFI e iniciar el proceso de depuraci√≥n.  Personalmente, ejecut√© una aplicaci√≥n local y simul√© obtener un archivo de una sesi√≥n.  La depuraci√≥n tambi√©n se realiz√≥ localmente.  Los errores que salen al cargar un script son bastante f√°ciles de google y NIFI los escribe en el registro. <cut></cut></p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.commons.io.IOUtils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.xml.XmlUtil <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.charset.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.xml.StreamingMarkupBuilder def flowFile = session.get() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!flowFile) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { flowFile = session.write(flowFile, { inputStream, outputStream -&gt; String result = IOUtils.toString(inputStream, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); def recordIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSlurper().parseText(result) def element = recordIn.depthFirst().find { it.name() == <span class="hljs-string"><span class="hljs-string">'id'</span></span> } def newId = Integer.parseInt(element.toString()) + <span class="hljs-number"><span class="hljs-number">1</span></span> def recordOut = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSlurper().parseText(result) recordOut.Body.ClientMessage.RequestMessage.RequestContent.content.MessagePrimaryContent.ResponseBody.id = newId def res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamingMarkupBuilder().bind { mkp.yield recordOut }.toString() outputStream.write(res.getBytes(StandardCharsets.UTF_8)) } as StreamCallback) session.transfer(flowFile, REL_SUCCESS) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e) { log.error(<span class="hljs-string"><span class="hljs-string">"Error during processing of validate.groovy"</span></span>, e) session.transfer(flowFile, REL_FAILURE) }</code> </pre> <br><p>  En realidad, en esto termina la personalizaci√≥n de los cuadrados.  A continuaci√≥n, el archivo actualizado se transfiere al cuadrado, que se encarga de enviar el archivo al servidor.  A continuaci√≥n se encuentran las configuraciones para este cuadrado. </p><br><p><img src="https://habrastorage.org/webt/g-/zg/op/g-zgopoirr9nvy-jpfn2ll9twts.png"></p><br><p>  Describimos el m√©todo por el cual se transmitir√° el mensaje SOAP.  Escribimos a donde.  A continuaci√≥n, debe indicar que esto es exactamente SOAP. </p><br><p><img src="https://habrastorage.org/webt/sa/bu/z6/sabuz6a2gvq6hinipeghikl8z9y.png"></p><br><p>  Agregue algunas propiedades como host y action (soapAction).  Guardar, consultar.  Puede encontrar m√°s detalles sobre c√≥mo enviar solicitudes SOAP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://stackoverflow.com/questions/49457764/nifi-how-to-use-invoke">aqu√≠.</a> <cut></cut></p><br><p>  Analizamos varios usos de los procesos NIFI.  C√≥mo interact√∫an y qu√© beneficio real tienen.  Los ejemplos considerados son de prueba y son ligeramente diferentes de lo que es real en la batalla.  Espero que este art√≠culo sea un poco √∫til para los desarrolladores.  Gracias por su atencion  Si tiene alguna pregunta, escriba.  Intentar√© responder </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465299/">https://habr.com/ru/post/465299/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465289/index.html">El resumen de eventos para profesionales de recursos humanos en el campo de TI para septiembre de 2019</a></li>
<li><a href="../465291/index.html">M√°s cerca del suelo: c√≥mo cambi√© el coworking a una casa de pueblo</a></li>
<li><a href="../465293/index.html">C√≥mo abandonamos el gran hackathon y comenzamos a hacer viajes para equipos individuales</a></li>
<li><a href="../465295/index.html">C√≥mo trabaj√© en Turqu√≠a y conoc√≠ el mercado local</a></li>
<li><a href="../465297/index.html">"Lo mejor que he hecho en mi carrera es enviar el trabajo al infierno". Chris Dancy acerca de convertir la vida en datos</a></li>
<li><a href="../465301/index.html">C√≥mo construir un proceso de dise√±o de comercio electr√≥nico para obtener todos los datos que necesita</a></li>
<li><a href="../465303/index.html">Trenes de Mosc√∫ (y no solo): lo que ha cambiado y gracias a quienes ayudaron</a></li>
<li><a href="../465309/index.html">Soy el mayor malvado en el desarrollo de juegos indie</a></li>
<li><a href="../465311/index.html">Sistema de monitoreo de veh√≠culos de bricolaje</a></li>
<li><a href="../465315/index.html">Kafka y microservicios: una visi√≥n general</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>