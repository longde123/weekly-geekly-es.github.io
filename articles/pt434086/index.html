<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèº üë©üèº‚Äçüíª üë≤üèæ Implanta√ß√£o Incorporada do Windows e Linux ‚Ñ¢Ô∏è üì∏ ü§¥üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo descreve como implantar rapidamente um sistema incorporado baseado no Windows 10 e Debian Linux. Exemplos de constru√ß√£o de uma interface s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implanta√ß√£o Incorporada do Windows e Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434086/">  Este artigo descreve como implantar rapidamente um sistema incorporado baseado no Windows 10 e Debian Linux.  Exemplos de constru√ß√£o de uma interface segura s√£o dados. <br><a name="habracut"></a><br><h1>  1. Introdu√ß√£o </h1><br><p>  No processo de desenvolvimento de dispositivos que possuem uma interface gr√°fica homem-m√°quina, mais cedo ou mais tarde surge a tarefa n√£o apenas de criar a interface em si, mas tamb√©m de escolher a plataforma na qual ela deve trabalhar.  Essa plataforma pode ser um computador de placa √∫nica com um sistema operacional ou um microcontrolador com uma tela e um conjunto de bibliotecas relevantes, ou alguma outra solu√ß√£o original. </p><br><p>  Muitas vezes acontece que, no n√≠vel superior do sistema de controle em que a interface est√° sendo executada, tamb√©m s√£o executadas tarefas de comunica√ß√£o com o mundo externo e a intera√ß√£o com uma ampla gama de dispositivos perif√©ricos.  Al√©m disso, a pr√≥pria interface pode ser bastante exigente em recursos gr√°ficos.  Diante disso, e para economizar custos de m√£o-de-obra, √© poss√≠vel usar um computador de placa √∫nica como base e instalar nele um sistema operacional pronto.  O desenvolvimento de software nesse caso pode ser bastante simplificado usando estruturas modernas com boa documenta√ß√£o e um conjunto de exemplos. </p><br><h2>  Requisitos de interface </h2><br><p>  Do ponto de vista do usu√°rio, a interface deve atender aos seguintes requisitos: </p><br><ul><li>  Ao carregar em tela cheia, um aplicativo deve aparecer, √© a mesma interface, √© o mesmo shell gr√°fico; </li><li>  Al√©m deste aplicativo, nada mais deve estar dispon√≠vel para o usu√°rio; </li><li>  O aplicativo deve funcionar o tempo todo, o sistema n√£o deve adormecer, a tela n√£o deve desligar; </li><li>  Todos os atalhos de teclado, auxiliares, recursos de acessibilidade e outras fun√ß√µes similares devem ser desativados; </li><li>  Em caso de falha do aplicativo - ele deve ser reiniciado automaticamente pelo sistema; </li><li>  O sistema n√£o possui requisitos especiais para velocidade ou modos em tempo real; no entanto, √© necess√°rio que a interface responda aos comandos do usu√°rio sem atrasos vis√≠veis; </li><li>  O sistema deve ser resistente a reinicializa√ß√µes duras repetidas; n√£o h√° necessidade de executar um script especial para concluir o trabalho; </li><li>  Dever√° ser poss√≠vel clonar rapidamente o conjunto conclu√≠do em uma s√©rie de dispositivos com todas as configura√ß√µes necess√°rias feitas no modo autom√°tico. </li></ul><br><p>  Em outras palavras, uma completa limita√ß√£o das a√ß√µes do usu√°rio, estabilidade e escalabilidade. </p><br><p>  Quanto ao sistema operacional de um computador de placa √∫nica, consideraremos imediatamente duas op√ß√µes, uma baseada no Windows e a outra no Linux, e as compararemos. </p><br><p>  Por exemplo, vamos criar uma interface de quiosque com tela de toque.  E como aplicativo, vamos pegar um dos exemplos de treinamento do Qt Quick e implement√°-lo com algumas altera√ß√µes.  A estrutura Qt est√° dispon√≠vel para ambos os sistemas operacionais. </p><br><p>  Para n√£o se aprofundar nas nuances da instala√ß√£o do Windows e Linux em uma plataforma ARM, o sistema pode ser facilmente montado com base em algum processador compat√≠vel com x86.  Nesse caso, uma das muitas placas dispon√≠veis na plataforma Intel Bay Trail foi usada para experimentos. </p><br><p>  Um pacote de todos os programas e scripts est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . </p><br><h1>  Caminho do Windows </h1><br><p>  Ao mesmo tempo, o Windows Embedded da Microsoft foi introduzido para criar sistemas incorporados.  Mesmo na vers√£o inicial do Windows Embedded XP, os desenvolvedores recebiam um conjunto de ferramentas para montar os mais truncados, mas equipados com os drivers de imagem necess√°rios.  Esses conjuntos exigiam um m√≠nimo de RAM e funcionavam bem, mesmo em processadores fracos.  A tecnologia foi desenvolvida na vers√£o do Windows Embedded Standard 7, onde o processo de cria√ß√£o de seus pr√≥prios assemblies foi lembrado.  O Windows Embedded usava a ideologia de um cat√°logo aberto de m√≥dulos, e qualquer um podia equipar seu sistema apenas com o conjunto necess√°rio de componentes.  A vers√£o mais recente em que essa abordagem estava dispon√≠vel, embora de forma truncada, √© o Windows Embedded Standard 8.1. </p><br><p>  A IoT moderna do Windows 10 est√° posicionada como uma alternativa ao Windows Embedded, mas √© muito diferente de seus antecessores.  Um cat√°logo de componentes abertos n√£o est√° mais dispon√≠vel.  A capacidade de coletar imagens de luz do designer e criar seus pr√≥prios discos de instala√ß√£o desapareceu.  Op√ß√µes especiais de um sistema incorporado, como um filtro de grava√ß√£o, marca do carregador de inicializa√ß√£o, um filtro de teclado etc., agora est√£o configuradas em um sistema pr√©-instalado.  Al√©m disso, o suporte para essas fun√ß√µes est√° dispon√≠vel apenas como parte da vers√£o pesada do Windows 10 Enterprise. </p><br><p>  No entanto, apesar dos altos requisitos do sistema, especialmente a quantidade de RAM, o uso de vers√µes pesadas em solu√ß√µes incorporadas n√£o causa problemas especiais, principalmente devido √† disponibilidade de componentes de hardware.  Al√©m disso, n√£o esque√ßa que, nos √∫ltimos anos, tornou-se mais dif√≠cil comprar uma licen√ßa da Microsoft para produtos antigos. </p><br><h2>  Solu√ß√£o r√°pida </h2><br><p>  Ap√≥s o primeiro exame, verifica-se que, mesmo no Windows 10 comum, j√° existe uma fun√ß√£o interna de "Acesso atribu√≠do" (Fig. 1), que parece uma solu√ß√£o pronta para a tarefa. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/t6/14/yr/t614yroc8ueu_rkh1t7srjo0cnu.png" alt="Acesso atribu√≠do"></div><p>  <i>Fig.</i>  <i>1. Fun√ß√£o de acesso atribu√≠do</i> </p><br><p>  Um programa que pode ser usado como interface nesse caso deve ser desenvolvido inicialmente como um aplicativo da Plataforma Universal do Windows.  Esses <i>aplicativos appx</i> s√£o instalados, por exemplo, em um Windows Phone.  Um aplicativo simples em tela cheia, √© claro, pode ser convertido em <i>appx</i> e assinado com os certificados necess√°rios e, em seguida, instalado.  Pode funcionar como uma interface, mas sem a prote√ß√£o adequada.  Infelizmente, no modo "Acesso atribu√≠do" normal, o usu√°rio ainda tem acesso aberto a algumas configura√ß√µes do sistema e teclas de atalho.  Como resultado, uma interface que atenda a todos os requisitos acima n√£o pode ser obtida usando essa abordagem.  O sistema deve ser configurado manualmente, de uma maneira diferente. </p><br><h2>  Decis√£o correta </h2><br><h3>  1. Instala√ß√£o inicial </h3><br><p>  Ent√£o, primeiro de tudo, precisamos da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">distribui√ß√£o Windows 10 Enterprise LTSB</a> .  Voc√™ pode capturar a imagem original da Microsoft, usar uma leve ou criar sua pr√≥pria usando ferramentas de terceiros.  Para a prancha experimental, um dos conjuntos prontos foi selecionado (vers√£o leve de 32 bits). </p><br><p>  Instalamos o sistema a partir do kit de distribui√ß√£o no quadro de destino.  Ao instalar, dividimos o disco em duas se√ß√µes, C: - para o sistema, D: - para o aplicativo principal, utilit√°rios e logs.  Esse detalhamento √© √∫til no futuro para o filtro de grava√ß√£o.  Ap√≥s a instala√ß√£o, esperamos at√© que o menu de configura√ß√µes seja exibido ou n√£o continuamos o menu com as configura√ß√µes de rede. </p><br><p>  N√≥s reiniciamos no modo de servi√ßo via Ctrl + Shift + F3. </p><br><p>  Se n√£o houver erros durante o processo de instala√ß√£o, ap√≥s a reinicializa√ß√£o, o pr√≥prio sistema entrar√° na conta de servi√ßo do administrador e a janela <i>SysPrep</i> aparecer√° na tela (Fig. 2).  Ele deve ser fechado, iniciaremos o <i>SysPrep de maneira</i> diferente, usando um arquivo de resposta especial que ainda n√£o foi criado. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/xn/3y/kwxn3yxs3totane-ogcok3z9bto.png" alt="Janela Sysprep"></div><p>  <i>Fig.</i>  <i>2. modo de servi√ßo.</i> </p><br><h3>  2. Configura√ß√£o do sistema </h3><br><p>  Para outras a√ß√µes, voc√™ precisar√° das Ferramentas de <a href="">Implanta√ß√£o do Kit de Avalia√ß√£o e Implanta√ß√£o</a> do <a href="">Windows 10</a> . </p><br><p>  No disco com a distribui√ß√£o do Windows instalada no quadro, √© necess√°rio extrair o <i>arquivo de</i> imagem <i>install.wim</i> .  Acontece que em algumas montagens esse arquivo pode ser armazenado em formato compactado com a extens√£o <i>esd</i> .  Nesse caso, voc√™ deve primeiro descompact√°-lo.  O utilit√°rio <i>dism</i> √© usado para isso. </p><br><p>  Descubra o n√∫mero de s√©rie da vers√£o desejada dentro do cont√™iner (SourceIndex). </p><br><pre><code class="plaintext hljs">dism /Get-WimInfo /WimFile:install.esd</code> </pre> <br><p>  Em seguida, extraia o arquivo de imagem (nesse caso, o primeiro no cont√™iner). </p><br><pre> <code class="plaintext hljs">dism /export-image /SourceImageFile:install.esd /SourceIndex:1 /DestinationImageFile:install.wim /Compress:max /CheckIntegrity</code> </pre> <br><p>  Agora voc√™ precisa abrir a imagem no Windows System Image Manager (nas Ferramentas de Implanta√ß√£o) e gerar um diret√≥rio. </p><br><p>  Note-se que trabalhar com imagens no Windows System Image Manager s√≥ √© poss√≠vel se a profundidade de bits da imagem corresponder √† profundidade de bits do host.  Ou seja, √© imposs√≠vel editar a imagem da vers√£o de 32 bits em um sistema de 64 bits.  Aqui, como se costuma dizer, sem coment√°rios. </p><br><p>  Quando o diret√≥rio for criado, edite o arquivo de resposta para o utilit√°rio <i>SysPrep</i> .  Digite as informa√ß√µes do propriet√°rio, adicione os usu√°rios necess√°rios e configure o primeiro login autom√°tico (Fig. 3). </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ch/fn/4f/chfn4fan0jtazdofcrskqz6dakc.png" alt="Arquivo de respostas"></div><p>  <i>Fig.</i>  <i>3. Criando um arquivo de resposta.</i> </p><br><p>  N√£o faz sentido listar todos os par√¢metros, o conte√∫do do arquivo de resposta pode ser encontrado no reposit√≥rio.  O principal √© n√£o esquecer de definir os par√¢metros <i>CopyProfile</i> como <i>true</i> , <i>SkipReam</i> como <i>1</i> e ativar o <i>logon autom√°tico do</i> administrador.  Voc√™ pode inserir a chave do produto na se√ß√£o <i>4 especializar - Microsoft-Windows-Shell-Setup - ProductKey</i> . </p><br><h3>  3. Instalando Programas </h3><br><p>  Em seguida, √© necess√°rio o <i>arquivo de</i> imagem <i>install.wim</i> real, portanto, voc√™ deve coloc√°-lo ao lado do arquivo de resposta <i>customize.xml</i> , no qual, ap√≥s salvar, voc√™ dever√° substituir manualmente o caminho da imagem.  No final do arquivo, a linha deve ficar assim: </p><br><pre> <code class="plaintext hljs">&lt;cpi:offlineImage cpi:source="wim:d:/service/install.wim#Windows 10 Enterprise LTSB" xmlns:cpi="urn:schemas-microsoft-com:cpi" /&gt;</code> </pre> <br><p>  Para obter a interface de demonstra√ß√£o do KioskShell, voc√™ precisa criar uma vers√£o para Windows a partir da fonte.  As dicas de montagem est√£o no reposit√≥rio. </p><br><p>  Copiamos os arquivos para o quadro e obtemos a seguinte estrutura de arquivos e diret√≥rios: </p><br><pre> <code class="plaintext hljs">C:\ ‚îî‚îÄ‚îÄ Design\ ‚îú‚îÄ‚îÄ backgroundDefault.jpg -      ( ) ‚îî‚îÄ‚îÄ oemlogo.bmp -  ,      D:\ ‚îú‚îÄ‚îÄ Logs\ -       ‚îú‚îÄ‚îÄ Service\ ‚îÇ ‚îú‚îÄ‚îÄ AfterSetup.bat -   ,     SysPrep ‚îÇ ‚îú‚îÄ‚îÄ FirstLogon.bat -        ‚îÇ ‚îú‚îÄ‚îÄ customize.xml -   ‚îÇ ‚îú‚îÄ‚îÄ install.wim -   ‚îÇ ‚îú‚îÄ‚îÄ CustomShellSetup.ps1 -  PowerShell     ‚îÇ ‚îú‚îÄ‚îÄ EnableRules.ps1 -  PowerShell     ‚îÇ ‚îú‚îÄ‚îÄ DisableAllRules.ps1 -      ( ) ‚îÇ ‚îî‚îÄ‚îÄ UserLogon.bat -      ( ) ‚îî‚îÄ‚îÄ Shell\ -     "KioskShell.exe"   </code> </pre> <br><h3>  4. Configura√ß√£o manual do sistema </h3><br><p>  Quando o sistema est√° no modo de servi√ßo, voc√™ pode reiniciar quantas vezes quiser, o sistema retornar√° automaticamente a ele.  No entanto, com um longo tempo de inatividade antes de configurar a energia, a tela pode travar e n√£o voltar√°, apenas uma reinicializa√ß√£o ajudar√°.  Como cada projeto espec√≠fico pode ter seus pr√≥prios recursos de configura√ß√£o, √© melhor faz√™-lo manualmente, mas voc√™ tamb√©m pode usar scripts de automa√ß√£o. </p><br><p>  Instalamos os componentes necess√°rios do sistema incorporado e desabilitamos o controle de conta de usu√°rio (consulte <i>AfterSetup.bat</i> no reposit√≥rio) </p><br><p>  Instale todos os drivers, configure o hardware (placa de rede IP, resolu√ß√£o e orienta√ß√£o da tela, portas de dispositivos externos, etc.), desative as teclas de atalho e todos os recursos especiais. </p><br><p>  Como no futuro eu gostaria de poder administrar remotamente, habilitaremos o acesso via RDP.  A senha do administrador expirar√° no est√°gio de configura√ß√£o autom√°tica. </p><br><p>  Em seguida, voc√™ precisa desativar a atualiza√ß√£o do sistema no <i>Editor de Diretiva de Grupo Local</i> (na se√ß√£o <i>Configura√ß√£o</i> do <i>Computador - Modelos Administrativos - Componentes do Windows - Windows Update</i> , √© necess√°rio definir <i>Atualiza√ß√µes Autom√°ticas Configuradas</i> como <i>Desativadas</i> ).  Al√©m disso, voc√™ tamb√©m precisa desativar a verifica√ß√£o autom√°tica do Windows Update (no agendador de tarefas na se√ß√£o <i>Microsoft - Windows - UpdateOrchestrator,</i> √© necess√°rio desativar todas as tarefas); caso contr√°rio, uma janela preta ser√° <i>exibida</i> toda vez que voc√™ inicializar e, quando voc√™ se conectar √† Internet, o Windows poder√° iniciar a atualiza√ß√£o subitamente. </p><br><p>  Em seguida, defina as configura√ß√µes de energia.  Para fazer isso, voc√™ deve primeiro tornar todas as configura√ß√µes de energia vis√≠veis na se√ß√£o <i>Configura√ß√µes avan√ßadas de energia</i> (para isso, no registro em cada subchave em <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Power \ PowerSettings \ 238C9FA8-0AAD-41ED-83F4-97BE242C8F20,</i> se voc√™ precisar do par√¢metro <i>Atributos</i> , valor para ele <i>2</i> ).  Agora que todas as configura√ß√µes est√£o dispon√≠veis, desative o modo de suspens√£o, o modo de aus√™ncia, remova a a√ß√£o no bot√£o liga / desliga (a menos que, √© claro, voc√™ precise de outro modo) e desligue o timer de autoriza√ß√£o quando estiver ocioso.  Em seguida, removemos o modo de espera com a conex√£o (na se√ß√£o <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Power</i> , √© necess√°rio definir o par√¢metro <i>CsEnabled</i> como <i>0</i> ).  Se necess√°rio, desligue o controle de brilho adapt√°vel da tela. </p><br><p>  Quando todas as configura√ß√µes do sistema estiverem conclu√≠das, temos a √∫ltima oportunidade de fazer altera√ß√µes, pois a segunda execu√ß√£o do script <i>AfterSetup.bat</i> iniciar√° o mecanismo de configura√ß√£o autom√°tica usando o <i>SysPrep</i> , que n√£o pode ser parado.  Voc√™ ainda precisa se lembrar de ativar o sistema (prop√µe-se familiarizar-se com as op√ß√µes para ativar as vers√µes corporativas do Windows).  Mesmo nesse est√°gio, voc√™ pode fazer uma c√≥pia de backup de todo o disco e corrigir o estado preliminar da imagem em caso de altera√ß√µes no futuro. </p><br><p>  No final do trabalho, o <i>SysPrep</i> n√£o ser√° reiniciado, mas desligar√° o computador - neste momento, voc√™ j√° pode criar uma imagem de trabalho, pronta para ser transportada para uma s√©rie. </p><br><h3>  5. Configura√ß√£o final autom√°tica do sistema </h3><br><p>  Ap√≥s o primeiro carregamento da imagem de trabalho (consulte <i>FirstLogon.bat</i> no reposit√≥rio), a interface segura ser√° configurada, o <i>logon autom√°tico</i> ser√° reconfigurado para a conta de <i>Usu√°rio</i> e os atalhos de teclado que podem interromper o sistema ser√£o desativados.  Em seguida, o filtro de grava√ß√£o unificado ser√° configurado e ativado.  Nesse caso, o filtro est√° configurado para proteger todas as parti√ß√µes, exceto as pastas <i>Servi√ßo</i> e <i>Logs</i> , e usa uma troca de 256 MB.  O sistema ser√° reiniciado v√°rias vezes e, se tudo for feito corretamente, na pr√≥xima inicializa√ß√£o, uma interface segura aparecer√°, iniciada em nome da conta do <i>usu√°rio</i> . </p><br><p>  Para fazer a manuten√ß√£o do sistema no local, √© poss√≠vel acessar a tela de login e, por exemplo, fazer login na conta de administrador.  No Windows 10, √© fornecido um m√©todo padr√£o para isso, voc√™ precisa pressionar a tecla ‚ÄúGanhar‚Äù 5 vezes seguidas. </p><br><h1>  Caminho do Linux </h1><br><p>  N√£o existe uma maneira padr√£o √∫nica de criar sistemas incorporados com uma interface gr√°fica baseada no Linux.  Como n√£o existe uma distribui√ß√£o comum √∫nica, √© uma fam√≠lia de sistemas criada com princ√≠pios completamente diferentes.  O mais pr√≥ximo no assunto pode parecer o projeto Yocto Linux.  No entanto, √© bastante dif√≠cil coletar imagens cheias de aplicativos, drivers e bibliotecas de terceiros.  Para resolver esse problema, √© mais f√°cil pegar uma distribui√ß√£o pronta e bem suportada e configur√°-la manualmente. </p><br><h2>  Solu√ß√£o simples </h2><br><h3>  1. Instala√ß√£o inicial </h3><br><p>  Ent√£o, primeiro de tudo, precisamos da distribui√ß√£o em si, por exemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Debian</a> .  Voc√™ pode pegar outro, voc√™ pode fazer o seu.  O principal √© que a distribui√ß√£o n√£o possui um sistema de atualiza√ß√£o autom√°tica.  Para a placa experimental, o Debian Linux 9 (vers√£o de 64 bits, kernel 4.9) foi escolhido. </p><br><p>  Instalamos o sistema da maneira tradicional.  Ao instalar, dividimos o disco em duas se√ß√µes, sda1 - <i>/</i> para o sistema, sda2 - <i>/ var / log</i> para <i>logs</i> de sistema e software.  Esse detalhamento √© √∫til no futuro para o filtro de grava√ß√£o.  Instale a <i>GUI</i> padr√£o do <i>xfce</i> e o servidor <i>ssh</i> .  Adicionamos <i>administrador</i> durante a instala√ß√£o do usu√°rio e definimos a senha. </p><br><p>  Ap√≥s a instala√ß√£o, a primeira coisa da conta <i>raiz</i> √© adicionar o usu√°rio <i>administrador</i> ao grupo <i>sudo</i> . </p><br><pre> <code class="plaintext hljs">apt install sudo adduser administrator sudo</code> </pre> <br><p>  Entramos no sistema sob o <i>administrador</i> do nome de usu√°rio e adicionamos um novo <i>usu√°rio</i> . </p><br><pre> <code class="plaintext hljs">sudo useradd -m user</code> </pre> <br><p>  Por conveni√™ncia, voc√™ pode remover completamente a senha, pois o acesso a essa conta ainda ser√° fechado em todos os lugares. </p><br><pre> <code class="plaintext hljs">sudo passwd -d user</code> </pre> <br><h3>  2. Configura√ß√£o do sistema </h3><br><p>  Instalamos drivers, pacotes de firmware e programas adicionais, conforme desejado. </p><br><p>  Para habilitar a administra√ß√£o remota no futuro, se necess√°rio, voc√™ pode instalar e configurar o servidor <i>vnc</i> .  No entanto, neste caso, isso n√£o faz sentido, pois todas as tarefas administrativas podem ser executadas facilmente atrav√©s do console e, para isso, apenas o acesso via <i>ssh √©</i> suficiente. </p><br><p>  O Linux tem a capacidade de usar gerenciadores de janelas diferentes para usu√°rios diferentes.  Para que a interface do usu√°rio funcione, instale um gerenciador minimalista com a capacidade de ajustar.  E para a configura√ß√£o, voc√™ precisar√° de mais alguns aplicativos. </p><br><pre> <code class="plaintext hljs">sudo apt install fluxbox arandr plymouth</code> </pre> <br><p>  Usando o <i>arandr,</i> voc√™ pode alterar a resolu√ß√£o e a orienta√ß√£o da tela, se necess√°rio, e salvar a configura√ß√£o como um script (Fig. 4). </p><br><p><img src="https://habrastorage.org/webt/fm/qo/nw/fmqonwqu3j3rua5xd_nr9zbj4p4.png" alt="Par√¢metros da tela set_resolution.sh"></p><br><p>  Fig.  4. Configura√ß√µes da tela. </p><br><p>  Em seguida, √© necess√°rio efetuar login no sistema uma vez na conta do usu√°rio, depois de selecionar o <i>fluxbox</i> instalado anteriormente como gerenciador de janelas e, em seguida, sair novamente.  Isso √© necess√°rio para que o <i>fluxbox,</i> na primeira inicializa√ß√£o, crie todos os arquivos de configura√ß√µes e seja selecionado como o gerente padr√£o da conta do <i>usu√°rio</i> (consulte o arquivo <i>.dmrc</i> no diret√≥rio inicial do <i>usu√°rio</i> ). </p><br><p>  Agora voc√™ precisa configurar o <i>fluxbox</i> para atender aos requisitos de interface descritos acima.  Para fazer isso, <i>desative</i> o painel <i>session.screen0.toolbar.visible</i> em <i>/home/user/.fluxbox/init</i> <i>: false</i> , comente todos os atalhos de teclado, exceto os bot√µes de volume em <i>/home/user/.fluxbox/keys</i> e em <i>/ home / user /. O fluxbox / startup</i> adiciona o lan√ßamento do script de configura√ß√£o da tela, desativando as fun√ß√µes de economia de energia do monitor e a execu√ß√£o autom√°tica do aplicativo em tela cheia.  O script reiniciar√° o aplicativo em caso de falha inesperada. </p><br><pre> <code class="plaintext hljs">set_resolution.sh xset -dmps s off /home/user/autostart.sh &amp;</code> </pre><br><p>  Agora voc√™ precisa acelerar o processo de inicializa√ß√£o do sistema e ocult√°-lo do usu√°rio.  Para fazer isso, configure <i>GRUB_TIMEOUT = 0</i> em <i>/ etc / default / grub e</i> defina <i>quiet_boot = "1"</i> em <i>/etc/grub.d/10_linux</i> .  Para exibir a anima√ß√£o ao carregar nos par√¢metros do kernel <i>GRUB_CMDLINE_LINUX,</i> voc√™ precisa adicionar a op√ß√£o <i>inicial</i> , e se a orienta√ß√£o da tela mudar, a op√ß√£o <i>fbcon = rotate: 1</i> ou <i>fbcon = rotate: 3</i> , dependendo da dire√ß√£o.  Se necess√°rio, voc√™ pode alterar a resolu√ß√£o e a orienta√ß√£o na tela de login.  Para isso, <i>display-setup-script = set_resolution.sh</i> deve ser especificado em <i>/etc/lightdm/lightdm.conf</i> .  E se voc√™ precisar ocultar o cursor, adicione <i>xserver-command = X -core -nocursor</i> . </p><br><p>  Escolheremos um estilo de anima√ß√£o de carregamento. </p><br><pre> <code class="plaintext hljs">sudo plymouth-set-default-theme -R text</code> </pre> <br><p>  E finalmente conserte todas as altera√ß√µes. </p><br><pre> <code class="plaintext hljs">sudo update-grub2</code> </pre> <br><h3>  3. Instalando Programas </h3><br><p>  Para obter a interface de demonstra√ß√£o do KioskShell, voc√™ precisa criar uma vers√£o do Linux a partir da fonte.  As dicas de montagem est√£o no reposit√≥rio. </p><br><p>  Copiamos os arquivos para o quadro e obtemos a seguinte estrutura de arquivos e diret√≥rios: </p><br><pre> <code class="plaintext hljs">/ ‚îú‚îÄ‚îÄ usr/ -      "KioskShell"    ‚îú‚îÄ‚îÄ local/ ‚îÇ ‚îî‚îÄ‚îÄ bin/ ‚îÇ ‚îî‚îÄ‚îÄ set_resolution.sh ‚îî‚îÄ‚îÄ home/ ‚îú‚îÄ‚îÄ administrator/ ‚îÇ ‚îî‚îÄ‚îÄ relogin.sh -       ‚îî‚îÄ‚îÄ user/ ‚îî‚îÄ‚îÄ autostart.sh -    </code> </pre> <br><h3>  4. Configura√ß√£o final do sistema </h3><br><p>  Nesse est√°gio, voc√™ pode fazer uma c√≥pia de backup de todo o disco e corrigir o estado preliminar da imagem em caso de altera√ß√µes no futuro. </p><br><p>  Configure o login autom√°tico na conta do usu√°rio, para isso, defina <i>autologin-user = user</i> em <i>/etc/lightdm/lightdm.conf</i> . </p><br><p>  Agora defina a prote√ß√£o contra grava√ß√£o. </p><br><pre> <code class="plaintext hljs">sudo apt install bilibop</code> </pre> <br><p>  Ao instalar, selecione o <i>mapa din√¢mico de dispositivo falso</i> . </p><br><p>  Edite o arquivo de configura√ß√µes <i>/etc/bilibop/bilibop.conf</i> .  <i>Ativamos</i> o m√≥dulo com o par√¢metro <i>BILIBOP_LOCKFS = ‚Äútrue‚Äù</i> e adicionamos uma se√ß√£o com logs √†s exce√ß√µes <i>BILIBOP_LOCKFS_WHITELIST = "/ var / log"</i> .  Vamos ativar a capacidade de desativar temporariamente a prote√ß√£o, se necess√°rio <i>BILIBOP_LOCKFS_POLICY = "soft"</i> .  E como n√£o h√° criptografia no sistema, voc√™ precisa definir <i>BILIBOP_LOCKFS_SWAP_POLICY = "soft"</i> . </p><br><p>  Reinicializamos o sistema e, se tudo for feito corretamente, uma interface segura ser√° exibida, lan√ßada em nome da conta do usu√°rio. </p><br><p>  A √∫ltima etapa pode ser facilmente automatizada para obter um sistema com configura√ß√£o autom√°tica na primeira inicializa√ß√£o.  Isso criar√° uma distribui√ß√£o para dimensionar para v√°rios dispositivos (este mecanismo √© proposto para ser implementado independentemente). </p><br><p>  Para fazer a manuten√ß√£o do sistema, √© poss√≠vel acessar a tela de login e fazer login na conta de administrador.  No Linux, voc√™ primeiro precisa acessar o console atrav√©s de Ctrl + Alt + F1.  Ap√≥s fazer login na conta do administrador, force o <i>usu√°rio</i> a sair do sistema. </p><br><pre> <code class="plaintext hljs">sudo skill -KILL -u user</code> </pre> <br><p>  Em seguida, retorne ao modo gr√°fico via Ctrl + Alt + F7 e efetue login como administrador novamente. </p><br><h1>  Conclus√µes </h1><br><p>  Independentemente do caminho escolhido, o resultado final √© o mesmo.  Com a configura√ß√£o adequada, a interface do usu√°rio atender√° a todos os requisitos descritos acima.  Somente diferen√ßas visuais s√£o poss√≠veis, associadas, em regra, aos recursos de renderiza√ß√£o de elementos gr√°ficos usando a acelera√ß√£o de hardware em diferentes plataformas. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rm/nk/1-/rmnk1-wetcbmnk4qnwng5ztxdri.png" alt="Aplicativo shell protegido"></div><p>  Fig.  5. A interface est√° em opera√ß√£o. </p><br><p></p><p>  Como a base do sistema √© um computador de placa √∫nica, n√£o ser√° um problema instalar qualquer tela de toque ou outros controles.  Se voc√™ tiver o aplicativo apropriado, nessa base, poder√° criar n√£o apenas o console de controle ou o painel interativo do dispositivo, mas tamb√©m outros dispositivos, por exemplo, terminais de informa√ß√µes ou de negocia√ß√£o. </p><br><h2>  Problema de escolha </h2><br><p>  H√° uma opini√£o de que o Linux √© muito dif√≠cil de configurar e manter, mas ao mesmo tempo √© gratuito e o Windows √© simples e conveniente, mas custa dinheiro.  Talvez isso seja verdade, mas apenas no n√≠vel familiar.  Quando se trata de criar sistemas embarcados, outras circunst√¢ncias devem ser consideradas.  Por exemplo, o ajuste fino do Windows, especialmente em termos de gerenciamento de energia e outros elementos de baixo n√≠vel, n√£o parece mais simples e conveniente.  Al√©m disso, n√£o esque√ßa que o Windows 10 √© bastante exigente em recursos.  Neste exemplo, foi poss√≠vel medir o consumo de mem√≥ria de um sistema limpo v√°rias vezes, e havia cerca de 400 MB no estado inativo.  Para compara√ß√£o, o Linux Debian com todos os seus complementos ocupava cerca de 200 MB de mem√≥ria.  Obviamente, se voc√™ possui v√°rios gigabytes de RAM, isso n√£o √© um problema, mas ainda assim, ao usar o Windows e aplicativos clientes altamente carregados, √© necess√°rio ter computadores de placa √∫nica mais poderosos.  O Linux √© menos exigente em recursos, mas √© realmente dif√≠cil de configurar e requer uma abordagem elegante, especialmente ao trabalhar com o carregador de inicializa√ß√£o.  Al√©m disso, durante o desenvolvimento e a implementa√ß√£o de alguns elementos no sistema, √†s vezes √© necess√°rio montar seu pr√≥prio kernel com par√¢metros especiais.  √â eficaz, mas requer um n√≠vel apropriado de habilidade. </p><br><p>  √â dif√≠cil fazer uma escolha inequ√≠voca como parte da cria√ß√£o de uma interface segura.  A complexidade da implanta√ß√£o de sistemas √© aproximadamente a mesma.  O custo de aquisi√ß√£o de licen√ßas do Windows para uma s√©rie de instrumentos pode ser igual ao custo de manuten√ß√£o de sistemas no Linux.  Qual sistema escolher, voc√™ decide. </p><br><p>  V√°rias interfaces homem-m√°quina baseadas nos exemplos descritos foram introduzidas pelo autor em dispositivos eletr√¥nicos para uma ampla variedade de aplica√ß√µes e provaram sua operabilidade no mundo real. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt434086/">https://habr.com/ru/post/pt434086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt434076/index.html">Por que na R√∫ssia n√£o h√° sigilo banc√°rio</a></li>
<li><a href="../pt434078/index.html">Voc√™ s√≥ precisa fazer: um novo podcast sobre projetos editoriais e uma carreira na m√≠dia</a></li>
<li><a href="../pt434080/index.html">Como parar de escrever firmware para microcontroladores. Estamos come√ßando a viver ...</a></li>
<li><a href="../pt434082/index.html">Uma rede neural desenvolvida por cientistas russos aprendeu a determinar a idade do v√≠deo com um alto grau de precis√£o</a></li>
<li><a href="../pt434084/index.html">Um carro do filme "Men in Black" (1997) pode subir no teto do t√∫nel?</a></li>
<li><a href="../pt434088/index.html">Como ajudar funcion√°rios remotos a evitar a solid√£o e o cansa√ßo</a></li>
<li><a href="../pt434090/index.html">Introduzindo um transistor a v√°cuo: um dispositivo fabricado a partir do v√°cuo</a></li>
<li><a href="../pt434092/index.html">As pessoas que salvaram 1968</a></li>
<li><a href="../pt434096/index.html">Heisenbug 2018 Moscou: uma vis√£o da multid√£o</a></li>
<li><a href="../pt434098/index.html">P√≥s e pr√©-processamento de CSS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>