<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ”§ ğŸ¤°ğŸ¼ ğŸ‘¶ğŸ¿ ÙØªØ­ - Ø§Ù„Ø­Ø±Ù Ù‚Ø¨Ø¹Ø© Ø­Ù…Ø±Ø§Ø¡ ğŸ“” ğŸšŠ ğŸš¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ÙØªØ­ 


1. Ø§Ù„Ø§Ø¬ØªÙŠØ§Ø­ Openshift. 
2. Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª. 
3. Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙˆØµÙŠÙ„ Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ©. 
4. Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ†Ø´Ø± Ù…Ø´Ø±ÙˆØ¹ Red Hat Decision Manager (Ù…Ø´Ø±ÙˆØ¹ ØªÙ†Ø§Ø¸Ø±ÙŠ Ù„Ù…Ø¤Ø³Ø³...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ÙØªØ­ - Ø§Ù„Ø­Ø±Ù Ù‚Ø¨Ø¹Ø© Ø­Ù…Ø±Ø§Ø¡</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441360/" style=";text-align:right;direction:rtl"><h2 style=";text-align:right;direction:rtl">  ÙØªØ­ </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø§Ù„Ø§Ø¬ØªÙŠØ§Ø­ Openshift. </li><li style=";text-align:right;direction:rtl">  Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª. </li><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙˆØµÙŠÙ„ Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ©. </li><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ†Ø´Ø± Ù…Ø´Ø±ÙˆØ¹ Red Hat Decision Manager (Ù…Ø´Ø±ÙˆØ¹ ØªÙ†Ø§Ø¸Ø±ÙŠ Ù„Ù…Ø¤Ø³Ø³Ø© kie-workbench). </li><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ†Ø´Ø± Ù…Ø´Ø§Ø±ÙŠØ¹ AMQ (red hat active mq) Ùˆ postgressql Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø«Ø§Ø¨ØªØ©. </li><li style=";text-align:right;direction:rtl">  Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù†ÙØµÙ„Ø© Ù„Ù„Ø®Ø¯Ù…Ø§Øª ØŒ ÙˆÙ‚ÙˆØ§Ù„Ø¨ Ù„Ù‡Ù… ØŒ ÙˆØ®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØŒ ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ gitlab ØŒ gitlab regestry. </li></ol><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  <b>1. Openshift Ø§Ù„Ø§Ø¬ØªÙŠØ§Ø­</b> </h2><br>  Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù… ØŒ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ Ø®ÙˆØ§Ø¯Ù… Ù†Ø¸Ø§Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª ØŒ ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… ØŒ ÙˆÙ…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù…. <br><br>  Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…ÙˆØ¬Ø² - ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„ÙƒÙ„ Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 16 Ø¬ÙŠØ¬Ø§ Ø¨Ø§ÙŠØª Ù…Ù† Ø±Ø§Ù… 2 ÙˆÙ…Ø§ Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† 100 ØºÙŠØºØ§Ø¨Ø§ÙŠØª Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡. <br><br>  ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ù†Ø¸Ø§Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„ØªØ§Ù„ÙŠ. <br>  dkm - masterØŒ dk0 - Ù…Ù†ÙØ°Ø©ØŒ ifr - Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©ØŒ bln - balancerØŒ shd - nfsØŒ dkr - Ø¹Ù‚Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªÙŠ ØªÙ… ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙƒØªÙ„Ø© Ø¨Ù‡Ø§ØŒ ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù‡Ø§ Ø£ÙŠØ¶Ø§ ÙƒØ¹Ù‚Ø¯Ø© Ù…Ù†ÙØµÙ„Ø© ØªØ­Øª Regestry regestry. <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">db.osh $TTL 1h @ IN SOA test.osh. root.test.osh. ( 2008122601 ; Serial 28800 ; Refresh 14400 ; Retry 604800 ; Expire - 1 week 86400 ) ; Minimum @ IN NS test.osh. @ IN A 127.0.0.1 rnd-osh-dk0-t01 IN A 10.19.86.18 rnd-osh-dk0-t02 IN A 10.19.86.19 rnd-osh-dk0-t03 IN A 10.19.86.20 rnd-osh-dkm-t01 IN A 10.19.86.21 rnd-osh-dkm-t02 IN A 10.19.86.22 rnd-osh-dkm-t03 IN A 10.19.86.23 rnd-osh-ifr-t01 IN A 10.19.86.24 rnd-osh-ifr-t02 IN A 10.19.86.25 rnd-osh-ifr-t03 IN A 10.19.86.26 rnd-osh-bln-t01 IN A 10.19.86.27 rnd-osh-shd-t01 IN A 10.19.86.28 rnd-osh-dkr-t01 IN A 10.19.86.29 lb IN A 10.19.86.27 openshift IN A 10.19.86.27 api-openshift IN A 10.19.86.27 *.apps.openshift IN A 10.19.86.21 *.apps.openshift IN A 10.19.86.22 *.apps.openshift IN A 10.19.86.23</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">db.rv.osh $TTL 1h @ IN SOA test.osh. root.test.osh. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 604800 ) ; Negative Cache TTL ; @ IN NS test.osh. @ IN A 127.0.0.1 18 IN PTR rnd-osh-dk0-t01.test.osh. 19 IN PTR rnd-osh-dk0-t02.test.osh. 20 IN PTR rnd-osh-dk0-t03.test.osh. 21 IN PTR rnd-osh-dkm-t01.test.osh. 22 IN PTR rnd-osh-dkm-t02.test.osh. 23 IN PTR rnd-osh-dkm-t03.test.osh. 24 IN PTR rnd-osh-ifr-t01.test.osh. 25 IN PTR rnd-osh-ifr-t02.test.osh. 26 IN PTR rnd-osh-ifr-t03.test.osh. 27 IN PTR rnd-osh-bln-t01.test.osh. 28 IN PTR rnd-osh-shd-t01.test.osh. 29 IN PTR rnd-osh-dkr-t01.test.osh. 27 IN PTR lb.test.osh. 27 IN PTR api-openshift.test.osh. named.conf.default-zones</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">zone "test.osh" IN { type master; file "/etc/bind/db.osh"; allow-update { none; }; notify no; }; zone "86.19.10.in-addr.arpa" { type master; file "/etc/bind/db.rv.osh"; };</code> </pre><br>  <b>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø§Ø¯Ù…</b> <br><br>  Ø¨Ø¹Ø¯ ØªÙˆØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.  ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª ÙˆØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù… Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">rm -rf /etc/yum.repos.d/cdrom.repo subscription-manager repos --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>=<span class="hljs-string"><span class="hljs-string">"*"</span></span> subscription-manager repos --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-rpms"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-extras-rpms"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-ose-3.10-rpms"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-ansible-2.4-rpms"</span></span> yum -y install wget git net-tools <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-utils yum-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct yum -y update yum -y install docker</code> </pre> <br>  ØªÙƒÙˆÙŠÙ† ØªØ®Ø²ÙŠÙ† Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡ (Ù…Ø­Ø±Ùƒ Ù…Ù†ÙØµÙ„). <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">systemctl stop docker rm -rf /var/lib/docker/* <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"STORAGE_DRIVER=overlay2"</span></span> &gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"DEVS=/dev/sdc"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONTAINER_ROOT_LV_NAME=dockerlv"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONTAINER_ROOT_LV_SIZE=100%FREE"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONTAINER_ROOT_LV_MOUNT_PATH=/var/lib/docker"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"VG=docker-vg"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> docker docker-storage-setup systemctl is-active docker systemctl restart docker docker info | grep Filesystem</code> </pre><br>  ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">yum -y install atomic atomic trust show yum -y install docker-novolume-plugin systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> docker-novolume-plugin systemctl start docker-novolume-plugin yum -y install openshift-ansible</code> </pre> <br>  Ø¥Ù†Ø´Ø§Ø¡ ØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… ØŒ ÙˆÙƒØ°Ù„Ùƒ Ù…ÙØ§ØªÙŠØ­. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">useradd --create-home --groups users,wheel ocp sed -i <span class="hljs-string"><span class="hljs-string">'s/# %wheel/%wheel/'</span></span> /etc/sudoers mkdir -p /home/ocp/.ssh <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"ssh-rsa AAAAB3NzaC........8Ogb3Bv ocp SSH Key"</span></span> &gt;&gt; /home/ocp/.ssh/authorized_keys</code> </pre> <br>  ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ ØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø¨Ø§Ù„ÙØ¹Ù„ - Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{ "bip": "172.26.0.1/16" }'</span></span> &gt; /etc/docker/daemon.json systemctl restart docker</code> </pre> <br>  ØªÙƒÙˆÙŠÙ† Ù…Ø¯ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©.  (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù†Ø¸Ø§Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ù‚Ø§Ø¯Ø±Ø§Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ) <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">nmcli connection modify ens192 ipv4.dns 172.17.70.140 nmcli connection modify ens192 ipv4.dns-search cluster.local +ipv4.dns-search test.osh +ipv4.dns-search cpgu systemctl stop firewalld systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> firewalld systemctl restart network</code> </pre> <br>  ØªØ­Ø±ÙŠØ± ØŒ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± ØŒ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">hhh=$(cat /etc/hostname) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$hhh</span></span></span><span class="hljs-string">"</span></span>.test.osh &gt; /etc/hostname</code> </pre> <br>  Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© ØŒ Ø£Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…. <br><br><h3 style=";text-align:right;direction:rtl">  ØªØ­Ø¶ÙŠØ± Ø¹Ù‚Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… dkr </h3><br>  Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø¹Ù‚Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ù‡Ùˆ Ø£Ù†Ù‡ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ø¬Ø© Ù„ØªÙˆØµÙŠÙ„ Ø¹Ø§Ù…Ù„ Ù…ÙŠÙ†Ø§Ø¡ Ø¥Ù„Ù‰ Ù‚Ø±Øµ Ù…Ù†ÙØµÙ„. <br><br>  Ù‡Ù†Ø§Ùƒ Ø£ÙŠØ¶Ø§ Ø­Ø§Ø¬Ø© Ù„ØªÙƒÙˆÙŠÙ† NTP. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">yum install ntp -y systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> ntpd service ntpd start service ntpd status ntpq -p chmod 777 -R /usr/share/ansible/openshift-ansible/</code> </pre> <br>  ØªØ­ØªØ§Ø¬ Ø£ÙŠØ¶Ù‹Ø§ Ø¥Ù„Ù‰ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¥Ù„Ù‰ ocp. <br><br>  ÙˆØµÙˆÙ„ SSH ÙƒÙ…Ø§ ocp Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø¯. <br><br>  <b>ØªØ­Ø¶ÙŠØ± Ù…Ù„Ù Ø§Ù„Ø¬Ø±Ø¯ ÙˆØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙƒØªÙ„Ø©.</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">host-poc.yaml [OSEv3:children] masters nodes etcd lb nfs [OSEv3:vars] ansible_ssh_user=ocp ansible_become=yes openshift_override_hostname_check=True openshift_master_cluster_method=native openshift_disable_check=memory_availability,disk_availability,package_availability openshift_deployment_type=openshift-enterprise openshift_release=v3.10 oreg_url=registry.access.redhat.com/openshift3/ose-${component}:${version} debug_level=2 os_firewall_use_firewalld=True openshift_install_examples=true openshift_clock_enabled=True openshift_router_selector='node-role.kubernetes.io/infra=true' openshift_registry_selector='node-role.kubernetes.io/infra=true' openshift_examples_modify_imagestreams=true os_sdn_network_plugin_name='redhat/openshift-ovs-multitenant' openshift_master_identity_providers=[{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider'}] openshift_master_htpasswd_users={'admin': '$apr1$pQ3QPByH$5BDkrp0m5iclRske.M0m.0'} openshift_master_default_subdomain=apps.openshift.test.osh openshift_master_cluster_hostname=api-openshift.test.osh openshift_master_cluster_public_hostname=openshift.test.osh openshift_enable_unsupported_configurations=true openshift_use_crio=true openshift_crio_enable_docker_gc=true # registry openshift_hosted_registry_storage_kind=nfs openshift_hosted_registry_storage_access_modes=['ReadWriteMany'] openshift_hosted_registry_storage_nfs_directory=/exports openshift_hosted_registry_storage_nfs_options='*(rw,root_squash)' openshift_hosted_registry_storage_volume_name=registry openshift_hosted_registry_storage_volume_size=30Gi # cluster monitoring openshift_cluster_monitoring_operator_install=true openshift_cluster_monitoring_operator_node_selector={'node-role.kubernetes.io/master': 'true'} #metrics openshift_metrics_install_metrics=true openshift_metrics_hawkular_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_metrics_cassandra_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_metrics_heapster_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_metrics_storage_kind=nfs openshift_metrics_storage_access_modes=['ReadWriteOnce'] openshift_metrics_storage_nfs_directory=/exports openshift_metrics_storage_nfs_options='*(rw,root_squash)' openshift_metrics_storage_volume_name=metrics openshift_metrics_storage_volume_size=20Gi #logging openshift_logging_kibana_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_logging_curator_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_logging_es_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_logging_install_logging=true openshift_logging_es_cluster_size=1 openshift_logging_storage_kind=nfs openshift_logging_storage_access_modes=['ReadWriteOnce'] openshift_logging_storage_nfs_directory=/exports openshift_logging_storage_nfs_options='*(rw,root_squash)' openshift_logging_storage_volume_name=logging openshift_logging_storage_volume_size=20Gi #ASB ansible_service_broker_install=true openshift_hosted_etcd_storage_kind=nfs openshift_hosted_etcd_storage_nfs_options="*(rw,root_squash,sync,no_wdelay)" openshift_hosted_etcd_storage_nfs_directory=/opt/osev3-etcd openshift_hosted_etcd_storage_volume_name=etcd-vol2 openshift_hosted_etcd_storage_access_modes=["ReadWriteOnce"] openshift_hosted_etcd_storage_volume_size=30G openshift_hosted_etcd_storage_labels={'storage': 'etcd'} ansible_service_broker_local_registry_whitelist=['.*-apb$'] #cloudforms #openshift_management_install_management=true #openshift_management_app_template=cfme-template # host group for masters [masters] rnd-osh-dkm-t0[1:3].test.osh # host group for etcd [etcd] rnd-osh-dkm-t0[1:3].test.osh [lb] rnd-osh-bln-t01.test.osh containerized=False [nfs] rnd-osh-shd-t01.test.osh [nodes] rnd-osh-dkm-t0[1:3].test.osh openshift_node_group_name='node-config-master' rnd-osh-ifr-t0[1:3].test.osh openshift_node_group_name='node-config-infra' rnd-osh-dk0-t0[1:3].test.osh openshift_node_group_name='node-config-compute'</code> </pre> <br>  ØªØ´ØºÙŠÙ„ ÙƒØªØ¨ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">ansible-playbook -i host-poc.yaml /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml ansible-playbook -i host-poc.yaml /usr/share/ansible/openshift-ansible/playbooks/openshift-checks/pre-install.yml ansible-playbook -i host-poc.yaml /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml</code> </pre> <br>  Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ù„Ù‰ Ù…Ø§ÙŠØ±Ø§Ù… ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø³ÙŠÙƒÙˆÙ† Ø´ÙŠØ¡ Ù…Ø«Ù„ Ø§Ù„ØªØ§Ù„ÙŠ. <br><br><img src="https://habrastorage.org/webt/n8/5h/sh/n85hshlwjuugbzqsaottl3foscg.jpeg"><br><br>  ØªØ­Ø±ÙŠØ± Ù…Ù„Ù Ø§Ù„Ù…Ø¶ÙŠÙ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡ Ø¨Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø±ÙØ¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù† Ø·Ø±ÙŠÙ‚ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆÙŠØ¨. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">10.19.86.18 rnd-osh-dk0-t01.test.osh 10.19.86.19 rnd-osh-dk0-t02.test.osh 10.19.86.20 rnd-osh-dk0-t03.test.osh 10.19.86.21 rnd-osh-dkm-t01.test.osh 10.19.86.22 rnd-osh-dkm-t02.test.osh 10.19.86.23 rnd-osh-dkm-t03.test.osh 10.19.86.24 rnd-osh-ifr-t01.test.osh 10.19.86.25 rnd-osh-ifr-t02.test.osh 10.19.86.26 rnd-osh-ifr-t03.test.osh 10.19.86.27 rnd-osh-bln-t01.test.osh openshift.test.osh 10.19.86.28 rnd-osh-shd-t01.test.osh 10.19.86.29 rnd-osh-dkr-t01.test.osh</code> </pre><br>  Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¹Ù„Ù‰ url <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">openshift.test.osh</a> : 8443 <br><br><h3 style=";text-align:right;direction:rtl">  <b>2. Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª</b> </h3><br>  Ø£Ø¯Ø®Ù„ dkm. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc login -u system:admin oc adm policy add-cluster-role-to-user cluster-admin admin --rolebinding-name=cluster-admin</code> </pre> <br>  ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù‡ Ù…Ù† Ø§Ù„Ù…Ù…ÙƒÙ† Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø®ÙÙŠ Ù…Ø³Ø¨Ù‚Ù‹Ø§ (openhift ØŒ Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„) ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆÙŠØ¨. <br><br><h3 style=";text-align:right;direction:rtl">  <b>3. Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙˆØµÙŠÙ„ Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ©</b> </h3><br>  Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… NFS. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mkdir -p /exports/examplpv chmod -R 777 /exports/examplpv chown nfsnobody:nfsnobody -R /exports/examplpv <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/examplpv" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre> <br>  Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ© Ø¥Ù„Ù‰ openshift. <br><br>  ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹ oc. <br><br>  Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‚Ø¯ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ ØŒ ÙØ§Ù†ØªÙ‚Ù„ Ø¥Ù„ÙŠÙ‡ oc project examplv-project.  Ø¥Ù†Ø´Ø§Ø¡ yaml Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: examplpv-ts1 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteOnce nfs: path: /exports/examplpv server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre> <br>  ÙˆØªØ·Ø¨ÙŠÙ‚.  ØªØ·Ø¨ÙŠÙ‚ oc -f filename.yaml <br><br>  Ø¨Ø¹Ø¯ Ø§Ù„Ù‚ÙŠØ§Ù… <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc get pv</code> </pre> <br>  Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ© ØªÙƒÙˆÙ† Ù…Ø±Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. <br><br><h3 style=";text-align:right;direction:rtl">  <b>4. Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ†Ø´Ø± Ù…Ø´Ø±ÙˆØ¹ Red Hat Decision Manager (Ø§Ù„ØªÙ†Ø§Ø¸Ø±ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ù…Ù† Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ù…Ù„)</b> </h3><br>  ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc get imagestreamtag -n openshift | grep rhdm</code> </pre> <br><img src="https://habrastorage.org/webt/qj/ta/tc/qjtatcty6wmkrszyiromshu6zum.png"><br><br>  Ø¥Ø¶Ø§ÙØ© Ù‚ÙˆØ§Ù„Ø¨ - ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· ÙˆÙˆØµÙ Ø£ÙƒØ«Ø± Ø§ÙƒØªÙ…Ø§Ù„Ø§ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">unzip rhdm-7.2.1-openshift-templates.zip -d ./rhdm-7.2.1-openshift-templates</code> </pre> <br>  Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc new-project rhdm72</code> </pre> <br>  Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker login registry.redhat.io cat ~/.docker/config.json oc create secret generic pull-secret-name --from-file=.dockerconfigjson=/root/.docker/config.json --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=kubernetes.io/dockerconfigjson oc secrets link default pull-secret-name --<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>=pull oc secrets link builder pull-secret-name</code> </pre> <br>  Ø§Ø³ØªÙŠØ±Ø§Ø¯ imagetream ØŒ Ù…ÙØªØ§Ø­ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø§Ø¯Ù… Ø§Ù„Ù‚Ø±Ø§Ø± ØŒ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">keytool -genkeypair -<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> jboss -keyalg RSA -keystore keystore.jks -storepass mykeystorepass --dname <span class="hljs-string"><span class="hljs-string">"CN=STP,OU=Engineering,O=POC.mos,L=Raleigh,S=NC,C=RU"</span></span> oc create -f rhdm72-image-streams.yaml oc create secret generic kieserver-app-secret --from-file=keystore.jks oc create secret generic decisioncentral-app-secret --from-file=keystore.jks</code> </pre> <br>  Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… NFS. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mkdir -p /exports/rhdm72 chmod -R 777 /exports/rhdm72 chown nfsnobody:nfsnobody -R /exports/rhdm72 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/rhamq72" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre> <br>  Ø£Ø¶Ù pv Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: rhdm72-pv1 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteMany nfs: path: /exports/rhdm72 server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre> <br>  Rhdm70 Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ© <br>  Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ÙˆØµÙˆÙ„: <br>  - ReadWriteOnce <br>  Ù„ÙƒÙ† 7.2 ÙŠØªØ·Ù„Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ <br>  Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ÙˆØµÙˆÙ„: <br>  - ReadWriteMany <br>  Apply - oc Apply -f filename.yaml <br>  + ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ© Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø£ØµØ¨Ø­Øª Ù…ØªØ§Ø­Ø©. <br><img src="https://habrastorage.org/webt/yz/jd/kj/yzjdkjxx8h-_hh-ivjflfg6zk0u.png"><br>  Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø±Ø³Ù…ÙŠØ©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc new-app -f rhdm-7.2.1-openshift-templates/templates/rhdm72-authoring.yaml -p DECISION_CENTRAL_HTTPS_SECRET=decisioncentral-app-secret -p KIE_SERVER_HTTPS_SECRET=kieserver-app-secret</code> </pre> <br>  Ø³ÙŠØªÙ… Ù†Ø´Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø³Ø¬Ù„ Ø¹Ø§Ù…Ù„ Ù…ÙŠÙ†Ø§Ø¡. <br>  Ø­ØªÙ‰ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø© ØŒ ÙØ¥Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø³ÙŠÙƒÙˆÙ† ÙƒØ°Ù„Ùƒ. <br><br><img src="https://habrastorage.org/webt/mq/f_/76/mqf_76tvlkrevnb1i0ko-c5geog.png"><br><br>  Ø¥Ø°Ø§ Ù†Ù‚Ø±Øª Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ØµÙˆØ±Ø© ØŒ ÙØ³ÙŠÙƒÙˆÙ† Ø§Ù„Ø®Ø·Ø£ Ø§Ù„ØªØ§Ù„ÙŠ <br><br><img src="https://habrastorage.org/webt/ja/tt/fk/jattfkbexppthirthvr4olxo3j4.png"><br><br>  ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØºÙŠÙŠØ± Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ø®ØªÙŠØ§Ø± ØªØ­Ø±ÙŠØ± yaml Ù…Ù† registry.redhat.io Ø¥Ù„Ù‰ registry.access.redhat.com <br><br><img src="https://habrastorage.org/webt/i7/au/7q/i7au7qlcag2vyzowpvah_curhhy.png"><br><br>  Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø§ ØŒ Ø£Ø¶Ù Ø¹Ù†ÙˆØ§Ù† url Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ù…Ø¶ÙŠÙÙŠÙ† <img src="https://habrastorage.org/webt/eu/_p/mj/eu_pmjasouvshqh4sljl4chcs_k.png"><br>  Ø¥Ù„Ù‰ Ø£ÙŠ Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯ Ø£Ø¯Ù†Ø§Ù‡ <br><blockquote style=";text-align:right;direction:rtl">  10.19.86.25 rnd-osh-ifr-t02.test.osh myapp-rhdmcentr-rhdm72.apps.openshift.test.osh </blockquote><br><br><img src="https://habrastorage.org/webt/uq/ce/03/uqce03lnqjk7-snzah8dy1jljhc.png"><br><br><h3 style=";text-align:right;direction:rtl">  <b>5. Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ†Ø´Ø± Ù…Ø´Ø§Ø±ÙŠØ¹ AMQ (red hat active mq) Ùˆ postgressql Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø«Ø§Ø¨ØªØ©</b> </h3><br><br>  <b>Ø±Ù‡Ø§Ù…Ù‚</b> <br><br>  Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc new-project rhamq-and-pgsql</code> </pre><br>  Ù†Ø­Ù† Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø­Ø§Ù„Ø© ØºÙŠØ§Ø¨Ù‡Ø§. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc replace --force -f https://raw.githubusercontent.com/jboss-container-images/jboss-amq-7-broker-openshift-image/72-1.1.GA/amq-broker-7-image-streams.yaml oc replace --force -f https://raw.githubusercontent.com/jboss-container-images/jboss-amq-7-broker-openshift-image/72-1.1.GA/amq-broker-7-scaledown-controller-image-streams.yaml oc import-image amq-broker-72-openshift:1.1 oc import-image amq-broker-72-scaledown-controller-openshift:1.0</code> </pre> <br>  ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ù‚Ø§Ù„Ø¨ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> amq-broker-72-basic.yaml \ amq-broker-72-ssl.yaml \ amq-broker-72-custom.yaml \ amq-broker-72-persistence.yaml \ amq-broker-72-persistence-ssl.yaml \ amq-broker-72-persistence-clustered.yaml \ amq-broker-72-persistence-clustered-ssl.yaml; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> oc replace --force -f \ https://raw.githubusercontent.com/jboss-container-images/jboss-amq-7-broker-openshift-image/72-1.1.GA/templates/<span class="hljs-variable"><span class="hljs-variable">${template}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ± Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø®Ø¯Ù…Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc policy add-role-to-user view -z default</code> </pre> <br>  Ø®Ù„Ù‚ Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ© Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… NFS <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mkdir -p /exports/pgmq chmod -R 777 /exports/pgmq chown nfsnobody:nfsnobody -R /exports/pgmq <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/pgmq" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre><br>  Ø¥Ù†Ø´Ø§Ø¡ yaml <br><br>  pgmq_storage.yaml <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: pgmq-ts1 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteOnce nfs: path: /exports/pgmq server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre> <br>  ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙ‡Ø±ÙˆØ¶ÙˆØ¦ÙŠØ© <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">oc apply -f pgmq_storage.yaml</code> </pre> <br>  Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨ <br><br><img src="https://habrastorage.org/webt/ft/ue/ot/ftueotubh-sihze42urwj8keoxq.png"><br><br>  ØªÙ… <br><br><img src="https://habrastorage.org/webt/3d/tj/6j/3dtj6jdf9dw6ym4bvidbznruig8.png"><br><br>  Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®ÙŠØ§Ø±Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ø¹ ØªØ¬Ù…ÙŠØ¹ ssl ØŒ Ø¥Ù„Ø®.  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">access.redhat.com/documentation/en-us/red_hat_amq/7.2/html/deploying_amq_broker_on_openshift_container_platform</a> <br><br>  Postgresql <br><br>  Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ PV Ø¢Ø®Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙŠ Ù‚Ù…Ù†Ø§ Ø¨Ù‡Ø§ Ù…Ù† Ø£Ø¬Ù„ MQ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mkdir -p /exports/pgmq2 chmod -R 777 /exports/pgmq2 chown nfsnobody:nfsnobody -R /exports/pgmq2 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/pgmq2" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre> <br>  pgmq_storage.yaml <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: pgmq-ts2 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteOnce nfs: path: /exports/pgmq2 server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre><br><img src="https://habrastorage.org/webt/sc/_b/da/sc_bda3bjxmgtonlqct5ncvzgkc.png"><br><br>  Ù†Ù…Ù„Ø£ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© <br><br><img src="https://habrastorage.org/webt/qq/qu/5a/qqqu5aqvvl4kyrocork_6zw_408.png"><br><br><img src="https://habrastorage.org/webt/ii/nj/dd/iinjdd2ye08h1qcew-yuiwum-ss.png"><br><br>  ØªÙ… <br><br><h3 style=";text-align:right;direction:rtl">  <b>6. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù†ÙØµÙ„Ø© Ù„Ù„Ø®Ø¯Ù…Ø§Øª ØŒ ÙˆÙ‚ÙˆØ§Ù„Ø¨ Ù„Ù‡Ø§ ØŒ ÙˆØ®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ ØŒ ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ gitlab ØŒ gitlab regestry</b> </h3><br>  <b>Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹.</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc new-project ttttt</code> </pre> <br><img src="https://habrastorage.org/webt/5j/ho/r9/5jhor9y3veoydqwp7d4wzlxgwa8.png"><br>  ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø¯ÙˆÙ† Ù‚Ø§Ù„Ø¨ ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¦Ù‡ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¯ÙˆÙŠ. <br>  <b>Ù‡Ù†Ø§Ùƒ Ø·Ø±ÙŠÙ‚ØªØ§Ù†.</b> <br>  <i>Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ</i> Ø¨Ø¨Ø³Ø§Ø·Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø© ØŒ ÙˆÙ„ÙƒÙ† Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ Ù„Ù† ØªÙƒÙˆÙ† Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØ± ØŒ ÙˆÙ…Ø§ Ø¥Ù„Ù‰ Ø°Ù„Ùƒ ØŒ Ù…ØªØ§Ø­Ø© ØŒ ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ø³ØªÙƒÙˆÙ† ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø°Ø§Øª ØµÙ„Ø©. <br><br>  Ø¨Ø§Ø¯Ø¦ Ø°ÙŠ Ø¨Ø¯Ø¡ ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.  Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© ÙƒÙ…Ø«Ø§Ù„ ÙÙŠ Gitlab ØŒ ÙŠØªÙ… Ø°Ù„Ùƒ Ù…Ø«Ù„ Ù‡Ø°Ø§. <br><img src="https://habrastorage.org/webt/80/t9/dp/80t9dpkvstrfb3-a-45dypptupo.png"><br><br>  ØªØ­ØªØ§Ø¬ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø³Ø±Ø§Ø± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø¹Ø§Ù…Ù„ Ù…ÙŠÙ†Ø§Ø¡ - Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ù…Ù„Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc create secret docker-registry</code> </pre> <br>  Ø«Ù… Ø®Ù„Ù‚ Ø³Ø± <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc create secret docker-registry gitlabreg --docker-server=<span class="hljs-string"><span class="hljs-string">'gitlab.xxx.com:4567'</span></span> --docker-username=<span class="hljs-string"><span class="hljs-string">'gitlab+deploy-token-1'</span></span> --docker-password=<span class="hljs-string"><span class="hljs-string">'syqTBSMjHtT_t-X5fiSY'</span></span> --docker-email=<span class="hljs-string"><span class="hljs-string">'email'</span></span></code> </pre> <br>  Ø«Ù… Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc new-app --docker-image=<span class="hljs-string"><span class="hljs-string">'gitlab.xxx.com:4567/oko/oko-service:latest'</span></span></code> </pre> <br>  Ø¥Ø°Ø§ Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§ ØŒ ÙˆÙ„Ù… ØªÙ…ØªØ¯ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØŒ ÙØ­Ø¯Ø¯ Ø³Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ø¯ÙŠÙ†Ø§. <br><br><img src="https://habrastorage.org/webt/cl/bh/0_/clbh0_c9htdaqd1rgqvfgearvuw.png"><br><br>  Ø«Ù… Ù†Ø¶ÙŠÙ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù„Ø§Ø²Ù…Ø©. <br><br><img src="https://habrastorage.org/webt/of/tl/kq/oftlkqo4eq-xizgq1jjngv2p2ae.png"><br><br>  ÙØ¹Ù„Øª - Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø©. <br><br>  Ø«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ ÙÙŠ ØªØ­Ø±ÙŠØ± yaml ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø§ÙØ°. <br><br><img src="https://habrastorage.org/webt/0o/tc/-3/0otc-3ewuzgidcqb2b43hltjeyy.png"><br><br>  Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ ØŒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Ø§ ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø± ØŒ ÙˆÙ„ÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¯ÙˆÙ† Ø®Ø¯Ù…Ø© ØŒ ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ ÙØ¥Ù† Ø£ÙˆÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø¯Ù…Ø©. <br><br>  Ø®Ø¯Ù…Ø© <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">kind: Service apiVersion: v1 metadata: name: oko-service spec: type: ClusterIP ports: - port: <span class="hljs-number"><span class="hljs-number">9000</span></span> protocol: TCP targetPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> selector: app: oko-service sessionAffinity: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: loadBalancer: {}</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc apply -f service.yaml</code> </pre> <br>  Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ø±ÙŠÙ‚. <br><br><img src="https://habrastorage.org/webt/tn/tr/st/tntrstju-zih92pce1renqfbkzk.png"><br><br>  Ø³Ø¬Ù„ Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ù…Ø¶ÙŠÙÙŠÙ† Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ØªØ¨Ø­Ø« ÙÙŠ ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯ Ø£Ø¯Ù†Ø§Ù‡. <br><br><img src="https://habrastorage.org/webt/te/xj/51/texj51gumi95cwkxcsnaygudih8.png"><br><br>  Ø³Ø¬Ù„ Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ù…Ø¶ÙŠÙÙŠÙ† Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ØªØ¨Ø­Ø« ÙÙŠ ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯ Ø£Ø¯Ù†Ø§Ù‡. <br><br>  ØªÙ… <br><br>  <b>Ù‚Ø§Ù„Ø¨.</b> <br><br>  ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªÙØ±ÙŠØº yaml Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©. <br><br>  ÙˆÙ‡ÙŠ ØŒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ù‡Ùˆ Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø© Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚. <br><br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¤ÙŠØ© ÙƒÙ„ Ù…Ø§ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡ ÙÙŠ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø­Ø¯Ø¯ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc get all</code> </pre> <br>  ØªÙØ±ÙŠØº Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc get deploymentconfig.apps.openshift.io oko-service -o yaml</code> </pre> <br>  Ø§Ùˆ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc get d oko-service -o yaml</code> </pre> <br>  Ø«Ù… ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªØ£Ø®Ø° ÙƒØ£Ø³Ø§Ø³ Ù„Ø£ÙŠ Ù‚Ø§Ù„Ø¨ Ù„Ù€ openihft ÙˆØ¯Ù…Ø¬ Ù…Ø§ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù…Ù‡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨. <br><br>  ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© ØŒ Ø³ØªØ¨Ø¯Ùˆ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØªØ§Ù„ÙŠ: <br><br>  Ø§Ù„Ù‚Ø§Ù„Ø¨ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"Template"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: oko-service-template objects: - kind: DeploymentConfig apiVersion: v1 metadata: name: oko-service annotations: description: <span class="hljs-string"><span class="hljs-string">"ImageStream Defines how to build the application oko-service"</span></span> labels: app: oko-service spec: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> revisionHistoryLimit: <span class="hljs-number"><span class="hljs-number">10</span></span> selector: matchLabels: app: oko-service deploymentconfig: oko-service template: metadata: labels: app: oko-service spec: selector: app: oko-service deploymentconfig: oko-service containers: - env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trCsm5"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> ports: - containerPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> name: acces protocol: TCP readinessProbe: failureThreshold: <span class="hljs-number"><span class="hljs-number">3</span></span> httpGet: path: / port: <span class="hljs-number"><span class="hljs-number">9000</span></span> scheme: HTTP initialDelaySeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> periodSeconds: <span class="hljs-number"><span class="hljs-number">10</span></span> successThreshold: <span class="hljs-number"><span class="hljs-number">1</span></span> timeoutSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> image: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service imagePullPolicy: Always name: oko-service imagePullSecrets: - name: gitlab.xxx.com type: ImageChange strategy: activeDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">21600</span></span> resources: {} rollingParams: intervalSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> maxSurge: <span class="hljs-number"><span class="hljs-number">25</span></span>% maxUnavailable: <span class="hljs-number"><span class="hljs-number">25</span></span>% timeoutSeconds: <span class="hljs-number"><span class="hljs-number">600</span></span> updatePeriodSeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> type: Rolling triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> imageChangeParams: automatic: true containerNames: - <span class="hljs-string"><span class="hljs-string">"oko-service"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStream name: <span class="hljs-string"><span class="hljs-string">'oko-service:latest'</span></span> - kind: ImageStream apiVersion: v1 metadata: name: oko-service annotations: openshift.io/generated-by: OpenShiftNewApp labels: app: oko-service deploymentconfig: oko-service spec: dockerImageRepository: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service tags: - annotations: openshift.io/imported-<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: DockerImage name: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service importPolicy: insecure: <span class="hljs-string"><span class="hljs-string">"true"</span></span> name: latest referencePolicy: type: Source forcePull: true - kind: Service apiVersion: v1 metadata: name: oko-service spec: type: ClusterIP ports: - port: <span class="hljs-number"><span class="hljs-number">9000</span></span> protocol: TCP targetPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> selector: app: oko-service sessionAffinity: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: loadBalancer: {} - kind: Route apiVersion: route.openshift.io/v1 metadata: name: oko-service spec: host: oko-service.moxs.ru to: kind: Service name: oko-service weight: <span class="hljs-number"><span class="hljs-number">100</span></span> wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: ingress: - conditions: host: oko-service.xxx.com routerName: router wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> <br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø±Ø§Ø± Ù‡Ù†Ø§ ØŒ ÙÙŠ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ ØŒ Ø³Ù†Ù†Ø¸Ø± ÙÙŠ Ø®ÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ø¹ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ù‰ Ø¬Ø§Ù†Ø¨ openhift Ø­ÙŠØ« Ø³ØªÙƒÙˆÙ† Ø§Ù„Ø£Ø³Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ù„Ø¨. <br><br>  <i>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</i> <br><br>  Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± ØŒ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø¨Ø³ÙŠØ· ÙˆØªØ¬Ù…ÙŠØ¹ Ø¨ÙˆØ§Ø³Ø·Ø© Push. <br><br>  Ø£ÙˆÙ„Ø§Ù‹ ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯. <br><br>  ØªØ­ØªØ§Ø¬ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Buildconfig Ù…Ù† git (ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© ØŒ ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù„Ù‰ Ø«Ù„Ø§Ø«Ø© Ù…Ù„ÙØ§Øª docker ÙˆÙ…Ù„Ù docker Ù…Ù†ØªØ¸Ù… ØªÙ… ØªØµÙ…ÙŠÙ…Ù‡ Ù…Ù† Ø£Ø¬Ù„ Ø¹Ø§Ù…Ù„ docker Ø§Ù„Ø¥ØµØ¯Ø§Ø± 1.17 Ø£Ø¹Ù„Ø§Ù‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø«Ù†ÙŠÙ† Ù…Ù† FROMs ÙˆØ§Ø«Ù†ÙŠÙ† Ù…Ù† dockerfiles Ù…Ù†ÙØµÙ„ÙŠÙ† Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù‡Ø¯Ù.) <br><br>  Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙˆØ§Ø¨Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø®Ø§ØµØ© ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø°Ù†.  Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø± Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc create secret generic sinc-git --from-literal=username=gitsinc --from-literal=password=Paaasssword123</code> </pre><br>  Ø¯Ø¹Ù†Ø§ Ù†Ù…Ù†Ø­ Ø¨Ø§Ù†ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø³Ø±Ù†Ø§ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc secrets link builder sinc-git</code> </pre> <br>  Ø±Ø¨Ø· Ø³Ø± Ø¹Ù†ÙˆØ§Ù† url <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc annotate secret sinc-git <span class="hljs-string"><span class="hljs-string">'build.openshift.io/source-secret-match-uri-1=https://gitlab.xxx.com/*'</span></span></code> </pre> <br>  ÙˆØ£Ø®ÙŠØ±Ù‹Ø§ ØŒ Ø¯Ø¹ÙˆÙ†Ø§ Ù†Ø­Ø§ÙˆÙ„ Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† gita Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ - allow-missing-images ØŒ Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø© Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø¬Ù…Ø¹Ø© Ø¨Ø¹Ø¯. <br><br>  oc new-app <a href="">gitlab.xxx.com/OKO/oko-service.git</a> --strategy = docker - allow-missing-images <br>  Ø«Ù… ØŒ ÙÙŠ buildconfig Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ù„ dockerfile Ø§Ù„Ø°ÙŠ Ù†Ø­ØªØ§Ø¬Ù‡. <br><img src="https://habrastorage.org/webt/rf/_k/_m/rf_k_myzec3x1ao-x18cl3oznci.png"><br>  ØµØ­ÙŠØ­ <br><img src="https://habrastorage.org/webt/kd/xy/4o/kdxy4ophl95y8kk0maiyzz65mlo.png"><br><img src="https://habrastorage.org/webt/af/2f/zd/af2fzdlg49hshegumeacnpupdsg.png"><br>  Ù†Ø­Ù† Ø£ÙŠØ¶Ø§ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©. <br><img src="https://habrastorage.org/webt/yq/tw/1t/yqtw1taajm-0ikv3cxg92l4gvcs.png"><br>  Ø¯Ø¹Ù†Ø§ Ù†Ø­Ø§ÙˆÙ„ Ø£Ù† Ù†Ø¬Ø¹Ù„ Ø§Ø«Ù†ÙŠÙ† Buildcconfig Ù…Ù† Ù‡Ø°Ø§ ÙˆØ§Ø­Ø¯.ØªØ­Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ØŒ ØªÙØ±ÙŠØº ÙÙŠ yaml ÙˆØ§ØªØ®Ø§Ø° Ù…Ø§ ÙŠÙ„Ø²Ù…. <br><br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø«Ù†ÙŠÙ† Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙÙŠ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬. <br><br>  Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø­Ù…Ø± <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build-pyton-ml"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.com/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-python-ml forcePull: true output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span></code> </pre> <br>  Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø£ÙˆÙƒÙˆ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.xom/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStreamTag name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span> forcePull: true env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trCsn5"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"oko-service:latest"</span></span></code> </pre> <br><br>  Ù†Ø­ØªØ§Ø¬ Ø£ÙŠØ¶Ù‹Ø§ Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ù†Ø´Ø± ØªÙƒÙˆÙŠÙ† Ø§Ø«Ù†ÙŠÙ† Ù…Ù† Ø§Ù„ØµÙˆØ± ÙˆØ¥ÙƒÙ…Ø§Ù„ Ù†Ø´Ø± Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ø·Ø±ÙŠÙ‚. <br>  ÙØ¶Ù„Øª Ø¹Ø¯Ù… Ø¥Ù†ØªØ§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ ØŒ ÙˆÙ„ÙƒÙ† Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ ÙŠØªØ¶Ù…Ù† Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ± Ø¬Ù…ÙŠØ¹ Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©.  Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø¥ØµØ¯Ø§Ø± Ø¨Ø¯ÙˆÙ† ØªØ¬Ù…ÙŠØ¹. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">template kind: <span class="hljs-string"><span class="hljs-string">"Template"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: oko-service-template objects: - kind: Secret apiVersion: v1 type: kubernetes.io/basic-auth metadata: name: git-oko annotations: build.openshift.io/source-secret-match-uri<span class="hljs-number"><span class="hljs-number">-1</span></span>: https://gitlab.xxx.com/* data: password: R21ZFSw== username: Z2l0cec== - kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build-pyton-ml"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.com/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-python-ml forcePull: true output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span> - kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.com/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStreamTag name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span> forcePull: true env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trC"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"oko-service:latest"</span></span> - kind: DeploymentConfig apiVersion: v1 metadata: name: oko-service annotations: description: <span class="hljs-string"><span class="hljs-string">"ImageStream Defines how to build the application oko-service"</span></span> labels: app: oko-service spec: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> revisionHistoryLimit: <span class="hljs-number"><span class="hljs-number">10</span></span> selector: matchLabels: app: oko-service deploymentconfig: oko-service template: metadata: labels: app: oko-service spec: selector: app: oko-service deploymentconfig: oko-service containers: - env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trCsn5"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> ports: - containerPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> name: acces protocol: TCP readinessProbe: failureThreshold: <span class="hljs-number"><span class="hljs-number">3</span></span> httpGet: path: / port: <span class="hljs-number"><span class="hljs-number">9000</span></span> scheme: HTTP initialDelaySeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> periodSeconds: <span class="hljs-number"><span class="hljs-number">10</span></span> successThreshold: <span class="hljs-number"><span class="hljs-number">1</span></span> timeoutSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> image: docker-registry.default.svc:<span class="hljs-number"><span class="hljs-number">5000</span></span>/oko-service-p/oko-service imagePullPolicy: Always name: oko-service type: ImageChange strategy: activeDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">21600</span></span> resources: {} rollingParams: intervalSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> maxSurge: <span class="hljs-number"><span class="hljs-number">25</span></span>% maxUnavailable: <span class="hljs-number"><span class="hljs-number">25</span></span>% timeoutSeconds: <span class="hljs-number"><span class="hljs-number">600</span></span> updatePeriodSeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> type: Rolling triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> imageChangeParams: automatic: true containerNames: - <span class="hljs-string"><span class="hljs-string">"oko-service"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStreamTag name: <span class="hljs-string"><span class="hljs-string">'oko-service:latest'</span></span> - kind: ImageStream apiVersion: v1 metadata: name: oko-service annotations: openshift.io/generated-by: OpenShiftNewApp labels: app: oko-service deploymentconfig: oko-service spec: dockerImageRepository: <span class="hljs-string"><span class="hljs-string">""</span></span> tags: - annotations: openshift.io/imported-<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: DockerImage name: oko-service importPolicy: insecure: <span class="hljs-string"><span class="hljs-string">"true"</span></span> name: latest referencePolicy: type: Source - kind: ImageStream apiVersion: v1 metadata: name: python-ml spec: dockerImageRepository: <span class="hljs-string"><span class="hljs-string">""</span></span> tags: - annotations: openshift.io/imported-<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: oko-service-build <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: DockerImage name: python-ml importPolicy: insecure: <span class="hljs-string"><span class="hljs-string">"true"</span></span> name: latest referencePolicy: type: Source - kind: Service apiVersion: v1 metadata: name: oko-service spec: type: ClusterIP ports: - port: <span class="hljs-number"><span class="hljs-number">9000</span></span> protocol: TCP targetPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> selector: app: oko-service sessionAffinity: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: loadBalancer: {} - kind: Route apiVersion: route.openshift.io/v1 metadata: name: oko-service spec: host: oko-service.xxx.com to: kind: Service name: oko-service weight: <span class="hljs-number"><span class="hljs-number">100</span></span> wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: ingress: - conditions: host: oko-service.xxx.com routerName: router wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre><br>  ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù„Ù…Ø´Ø±ÙˆØ¹ oko-service-p ØŒ Ù„Ø°Ù„Ùƒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„ØªÙÙƒÙŠØ± ÙÙŠ Ø°Ù„Ùƒ. <br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. <br>  Ø£ÙƒØ±Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Yaml Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… oc get ... -o yaml <br><br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù„Ù„Ù…Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„ØªØ§Ù„ÙŠ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc process -f oko-service-templatebuild.yaml | oc create -f -</code> </pre> <br>  Ø«Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ <br><br>  oko-service-pipeline.yaml <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> type: <span class="hljs-string"><span class="hljs-string">"GitLab"</span></span> gitlab: secret: <span class="hljs-string"><span class="hljs-string">"secret101"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-sample-pipeline"</span></span> spec: strategy: jenkinsPipelineStrategy: jenkinsfile: |- // path of the template to use // <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">templatePath</span></span></span><span class="hljs-function"> = '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">https</span></span></span><span class="hljs-function">:</span></span>//raw.githubusercontent.com/openshift/nodejs-ex/master/openshift/templates/nodejs-mongodb.json<span class="hljs-string"><span class="hljs-string">' // name of the template that will be created def templateName = '</span></span>oko-service-template<span class="hljs-string"><span class="hljs-string">' // NOTE, the "pipeline" directive/closure from the declarative pipeline syntax needs to include, or be nested outside, pipeline { agent any environment { DEV_PROJECT = "oko-service"; } stages { stage('</span></span>deploy<span class="hljs-string"><span class="hljs-string">') { steps { script { openshift.withCluster() { openshift.withProject() { echo "Hello from project ${openshift.project()} in cluster ${openshift.cluster()}" def dc = openshift.selector('</span></span>dc<span class="hljs-string"><span class="hljs-string">', "${DEV_PROJECT}") openshiftBuild(buildConfig: '</span></span>oko-service-build<span class="hljs-string"><span class="hljs-string">', waitTime: '</span></span><span class="hljs-number"><span class="hljs-number">3000000</span></span><span class="hljs-string"><span class="hljs-string">') openshiftDeploy(deploymentConfig: '</span></span>oko-service<span class="hljs-string"><span class="hljs-string">', waitTime: '</span></span><span class="hljs-number"><span class="hljs-number">3000000</span></span><span class="hljs-string"><span class="hljs-string">') } } } } } } // stages } // pipeline type: JenkinsPipeline triggers: - type: GitLab gitlab: secret: ffffffffk</span></span></code> </pre> <br>  Ø¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ ØªÙƒÙˆÙŠÙ† Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªØ´ØºÙŠÙ„ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc describe buildconfig oko-service-sample-pipeline</code> </pre> <br>  ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† url Ù„ webhook ÙÙŠ Ø¬ÙŠØªÙ„Ø§Ø¨. <br><br><img src="https://habrastorage.org/webt/_l/ee/bk/_leebk_a59h1kbzn8widsczafsk.png"><br><br>  Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ø³Ø± Ø¨Ø§Ù„Ø³Ø±ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„ØªÙƒÙˆÙŠÙ†. <br><img src="https://habrastorage.org/webt/nt/63/ce/nt63ceczqzpqujqysq0caka5yle.png"><br><br>  Ø£ÙŠØ¶Ù‹Ø§ ØŒ Ø¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ Pipeline openshift Ù†ÙØ³Ù‡ Ø³ÙŠØ¨Ø¯Ø£ ØªØ«Ø¨ÙŠØª jenkins ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ø¥Ø·Ù„Ø§Ù‚ Pipeline.  Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø·ÙˆÙŠÙ„ ØŒ Ù„Ø°Ø§ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª. <br><br>  Ø«Ù… ÙÙŠ Gitlab ÙÙŠ Ù…Ø´Ø±ÙˆØ¹Ù†Ø§: <br><br><img src="https://habrastorage.org/webt/nt/63/ce/nt63ceczqzpqujqysq0caka5yle.png"><br><br>  Ø§Ù…Ù„Ø£ Ø¹Ù†ÙˆØ§Ù† Url ØŒ Ø§Ù„Ø³Ø±ÙŠ ØŒ Ù‚Ù… Ø¨Ø¥Ø²Ø§Ù„Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ø³ Ø§Ù„Ø¢Ù…Ù†Ø© (SSL) ÙˆØªÙ…ÙƒÙ‘Ù† webhook Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø§. <br><br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥Ù„Ù‚Ø§Ø¡ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ¬Ù…Ø¹ <br><br><img src="https://habrastorage.org/webt/c4/sd/at/c4sdatvqowwtgn_rjyzqvjj_hd4.png"><br><br>  Ù„Ø§ ØªÙ†Ø³Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø¹Ù†ÙˆØ§Ù† URL Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¬Ù†ÙƒÙŠÙ†Ø² Ù†ÙØ³Ù‡Ø§ Ø¹Ù„Ù‰ infranode. <br><br><img src="https://habrastorage.org/webt/zj/d_/1n/zjd_1nqxegz1jrodji6wmsi8ebm.png"><br><br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ù‹Ø§ Ø±Ø¤ÙŠØ© ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ¬Ù…ÙŠØ¹. <br><br><img src="https://habrastorage.org/webt/-o/ru/zq/-oruzqelmtrzyhwairvn8t8am_u.png"><br><br><h4 style=";text-align:right;direction:rtl">  Ù…Ù„Ø­ÙˆØ¸Ø©: Ø¢Ù…Ù„ Ø£Ù† ÙŠØ³Ø§Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„ÙƒØ«ÙŠØ±ÙŠÙ† Ø¹Ù„Ù‰ ÙÙ‡Ù… ÙƒÙŠÙÙŠØ© ØªÙ†Ø§ÙˆÙ„ openhift ÙˆÙ…Ø§ ÙŠØ£ÙƒÙ„ÙˆÙ†Ù‡ ØŒ ÙˆØ³ÙˆÙ ÙŠÙˆØ¶Ø­ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ Ù„ÙŠØ³Øª ÙˆØ§Ø¶Ø­Ø© Ù„Ù„ÙˆÙ‡Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰. <br><br>  PSS Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù„ÙˆÙ„ Ù„Ø­Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ </h4><br>  Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ØŒ Ø¥Ù„Ø®. <br>  - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø®Ø¯Ù…Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc create serviceaccount oko-serviceaccount oc adm policy add-scc-to-user privileged system:serviceaccount:__:oko-serviceaccount oc adm policy add-scc-to-group anyuid system:authenticated oc adm policy add-scc-to-user anyuid system:serviceaccount:__:oko-serviceaccount</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ù…Ø´Ø§ÙƒÙ„ ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ¹Ø¯Ù… Ø­Ø°ÙÙ‡ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø¥ÙƒØ±Ø§Ù‡ Ø§Ù„Ù‚Ø³Ø±ÙŠ (Ù…Ø±Ø¶ Ø®Ù„Ù‚ÙŠ)</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(oc get projects | grep Terminating| awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span>; oc get serviceinstance -n <span class="hljs-variable"><span class="hljs-variable">$i</span></span> -o yaml | sed <span class="hljs-string"><span class="hljs-string">"/kubernetes-incubator/d"</span></span>| oc apply -f - ; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">oc adm policy add-role-to-group system:image-puller system:serviceaccounts:__ oc adm policy add-role-to-user system:image-puller system:serviceaccount:__::default oc adm policy add-role-to-group system:image-puller system:serviceaccounts:__ oc policy add-role-to-user system:image-puller system:serviceaccount:__::default oc policy add-role-to-group system:image-puller system:serviceaccounts:__</code> </pre> <br><img src="https://habrastorage.org/webt/ij/zc/kp/ijzckpza-dz2ninhkmak58f0sj0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ØªØ¬Ø§ÙˆØ² Ø£ÙŠØ¶Ù‹Ø§ Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª NFS. </font><font style="vertical-align: inherit;">(Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØŒ ÙˆØ§Ù„Ø¨Ù†Ø§Ø¡ Ù…Ø¹Ù„Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¶ØºØ·).</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">chmod 777 -r /exports/registry/docker/registry/ chmod -R 777 /exports/registry/docker/registry/ chown nfsnobody:nfsnobody -R /exports/registry/ hown -R 1001 /exports/registry/ restorecon -RvF exportfs -ar</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar441360/">https://habr.com/ru/post/ar441360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar441348/index.html">Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙˆØ§Ù„ØªÙˆØ§Ø²Ù† Ù…Ø¹ NFT Ù…Ù‚Ø§Ø¨Ù„ Nginx</a></li>
<li><a href="../ar441350/index.html">Ù‡Ù„ Ø­Ù‚Ø§ Ù‡Ø§Ø³ÙƒÙ„ Ù‡ÙŠ Ù„ØºØ© Ø§Ù„Ø¹Ø¨Ø§Ù‚Ø±Ø© ÙˆØ§Ù„Ø£ÙˆØ³Ø§Ø· Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©ØŸ</a></li>
<li><a href="../ar441352/index.html">Ø£Ù†Ù…Ø§Ø· CI / CD ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø¶Ø§Ø¯Ø©. Ø§Ù„Ø¬Ø²Ø¡ 2</a></li>
<li><a href="../ar441356/index.html">ÙƒÙŠÙ Ù†ÙÙ‡Ù… Ø§Ù„ÙƒÙˆØ¯ "Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠ" ÙˆØ§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ÙØ±ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ØŸ</a></li>
<li><a href="../ar441358/index.html">ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø£ÙˆÙ„ Ù…Ø±ÙƒØ¨Ø© Ø¥Ù†Ø²Ø§Ù„ Ø¨ÙŠØ±ÙŠØ³ÙŠØª Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù‚Ù…Ø±</a></li>
<li><a href="../ar441362/index.html">Kibana Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. Ø§Ù„ØªØµÙˆØ±. Ø§Ù„Ø¬Ø²Ø¡ 3</a></li>
<li><a href="../ar441364/index.html">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø¤ØªÙ…Ø± Ù„ÙˆØ§ ÙÙŠ Ù…ÙˆØ³ÙƒÙˆ 2019</a></li>
<li><a href="../ar441366/index.html">Ù‡Ù„ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù…ØªØ¬Ø± Ø¥Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Stylish Crossell: Retail Rocket ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ù„ØªØ´ÙƒÙŠÙ„ ØªÙˆØµÙŠØ§Øª</a></li>
<li><a href="../ar441368/index.html">ÙƒÙŠÙ ÙŠØ¨Ø¯Ùˆ Ù‚Ù…Ø± Ù†Ø¨ØªÙˆÙ† Ø§Ù„Ø®ÙÙŠ Ø³Ø§Ø¨Ù‚Ù‹Ø§ØŸ</a></li>
<li><a href="../ar441370/index.html">Ø­Ù…Ø§ÙŠØ© Ø¨Ù„Ø§ Ø®ÙˆÙ. Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙÙŠ Ø§Ù„ØµØ¯Ø£</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>