<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó≥Ô∏è üë± üçå Infrastructure System.Transactions dans le monde .NET üñãÔ∏è üö£üèæ üë©‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avez-vous vu une construction comme l' using (var scope = new TransactionScope(TransactionScopeOption.Required)) en C #? Cela signifie que le code ex√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Infrastructure System.Transactions dans le monde .NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/custis/blog/433136/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ct/df/aq/ctdfaqnuvdjaw6tobyxja78mk-s.png"></div><br>  Avez-vous vu une construction comme l' <code>using (var scope = new TransactionScope(TransactionScopeOption.Required))</code> en C #?  Cela signifie que le code ex√©cut√© dans le bloc <code>using</code> est dans la transaction et apr√®s avoir quitt√© ce bloc, les modifications seront valid√©es ou annul√©es.  Cela semble compr√©hensible jusqu'√† ce que vous commenciez √† creuser plus profond√©ment.  Et plus vous creusez profond√©ment, plus cela devient ¬´√©trange et √©trange¬ª.  En tout cas, lorsque je me suis familiaris√© avec la classe <code>TransactionScope</code> et, en g√©n√©ral, avec les transactions .NET, tout un tas de questions se sont pos√©es. <br><br>  Qu'est-ce que la classe <code>TransactionScope</code> ?  D√®s que nous utilisons la construction <code>using (var scope = new TransactionScope())</code> , tout dans notre programme devient-il imm√©diatement transactionnel?  Que sont ¬´Resource Manager¬ª et ¬´Transaction Manager¬ª?  Puis-je √©crire mon propre gestionnaire de ressources et comment ¬´se connecter¬ª √† l'instance <code>TransactionScope</code> cr√©√©e?  Qu'est-ce qu'une transaction distribu√©e et est-il vrai qu'une transaction distribu√©e dans SQL Server ou Oracle Database est identique √† une transaction .NET distribu√©e? <br><br>  Dans cette publication, j'ai essay√© de collecter des informations qui aident √† trouver des r√©ponses √† ces questions et √† mieux comprendre les transactions dans le monde .NET. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©sentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Que sont les transactions et quels probl√®mes r√©solvent-elles?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quelles transactions sont consid√©r√©es ici</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Section TL; DR</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transactions bas√©es sur System.Transactions</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est ce que c'est</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestionnaires de ressources</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Types de gestionnaires de ressources</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Utilisation de TransactionScope</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Applicabilit√© des transactions logicielles</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un exemple de gestionnaire de ressources volage</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Section TL; DR</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transactions distribu√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est ce que c'est</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Protocoles transactionnels</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fixation biphasique</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Aide-m√©moire de System.Transations</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Limitations et alternatives des transactions distribu√©es par logiciel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Est-ce donc dans .NET Core?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transactions distribu√©es et WCF</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Section TL; DR</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lit d'enfant</a> </div></div><br><a name="Introduction"></a><h2>  Pr√©sentation </h2><br><a name="Transactions"></a><h4>  Que sont les transactions et quels probl√®mes r√©solvent-elles? </h4><br>  Les transactions en question ici sont des op√©rations qui transf√®rent le syst√®me d'un √©tat acceptable √† un autre et sont garanties de ne pas laisser le syst√®me dans un √©tat inacceptable m√™me en cas de situations impr√©vues.  Le type de conditions acceptables dans le cas g√©n√©ral d√©pend du contexte.  Nous consid√©rerons ici une situation acceptable dans laquelle les donn√©es que nous traitons font partie int√©grante.  Il est entendu que les modifications qui composent la transaction sont engag√©es ensemble ou non engag√©es.  De plus, les modifications apport√©es √† une transaction peuvent √™tre isol√©es des modifications apport√©es au syst√®me par une autre transaction.  Les exigences de base pour les transactions sont d√©sign√©es par l'acronyme ACID.  Pour la premi√®re connaissance avec eux, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article sur Wikipedia</a> convient. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4r/p7/2b/4rp72bf2l_qdxmlhawxsjslkj-i.png" width="250"></div><br>  Un exemple classique de transaction est le transfert d'argent entre deux comptes.  Dans cette situation, retirer de l'argent du compte n ¬∞ 1 sans cr√©diter sur le compte n ¬∞ 2 est inacceptable, de la m√™me mani√®re que d√©poser sur le compte n ¬∞ 2 sans retirer du compte n ¬∞ 1. En d'autres termes, nous voulons que les deux op√©rations soient √† la fois des retraits et des cr√©dits - effectu√©e imm√©diatement.  Si l'un d'eux √©choue, la deuxi√®me op√©ration ne doit pas √™tre effectu√©e.  Vous pouvez appeler ce principe ¬´tout ou rien¬ª.  De plus, il est souhaitable que les op√©rations soient effectu√©es de mani√®re synchrone m√™me en cas de pannes syst√©miques telles qu'une coupure de courant, c'est-√†-dire que nous voyons le syst√®me dans un √©tat acceptable d√®s qu'il devient disponible apr√®s restauration. <br><br>  En termes math√©matiques, nous pouvons dire qu'en ce qui concerne le syst√®me, il y a un invariant que nous aimerions certainement conserver.  Par exemple, le montant sur les deux comptes: il est n√©cessaire qu'apr√®s la transaction (virement) le montant reste le m√™me qu'avant.  Soit dit en passant, dans l'exemple classique du transfert d'argent, la comptabilit√© appara√Æt √©galement - un domaine o√π le concept de transaction est apparu naturellement. <br><br>  Nous illustrons l'exemple du transfert d'argent entre deux comptes.  La premi√®re image montre la situation o√π le transfert de 50 roubles du compte n ¬∞ 1 au compte n ¬∞ 2 s'est termin√© avec succ√®s.  La couleur verte indique que le syst√®me est dans un √©tat acceptable (les donn√©es sont compl√®tes). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sn/az/ra/snazracqgy0u8fdxtrtksb8jc7g.png"></div><br>  Imaginez maintenant que le transfert soit effectu√© en dehors de la transaction et apr√®s avoir retir√© de l'argent du compte n ¬∞ 1, une d√©faillance s'est produite, en raison de laquelle l'argent retir√© n'a pas √©t√© cr√©dit√© sur le compte n ¬∞ 2. Le syst√®me sera dans un √©tat inacceptable (couleur rouge). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yj/8h/ph/yj8hphqu7cszpcdvnboh97h3xfe.png"></div><br>  Si une erreur s'est produite entre les op√©rations de retrait et de cr√©dit, mais que le transfert a √©t√© effectu√© dans le cadre d'une transaction, l'op√©ration de retrait sera annul√©e.  Par cons√©quent, le syst√®me restera dans son √©tat acceptable d'origine. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3d/6b/wi/3d6bwim5vko1yam5mhiv1ekl9ve.png"></div><br>  Je vais donner des exemples de situations tir√©es de l'exp√©rience de notre entreprise dans lesquelles les transactions sont utiles: comptabilisation des marchandises (comptabilisation du nombre de marchandises de diff√©rents types qui se trouvent dans certains magasins et en cours de route), comptabilisation des ressources de stockage (comptabilisation du volume d'une pi√®ce occup√©e par des marchandises d'un certain type, volume d'une gratuit pour le placement de marchandises, la quantit√© de marchandises que les employ√©s et les syst√®mes de stockage automatis√©s peuvent d√©placer par jour). <br><br>  Les probl√®mes qui surviennent lorsque l'int√©grit√© des donn√©es est viol√©e sont √©vidents.  Les informations fournies par le syst√®me ne deviennent pas seulement fausses - elles perdent contact avec la r√©alit√© et se transforment en b√™tises. <br><br><a name="KindsOfTransactions"></a><h4>  Quelles transactions sont consid√©r√©es ici </h4><br>  Les avantages procur√©s par les transactions sont connus.  Donc, pour maintenir l'int√©grit√© des donn√©es, avons-nous besoin d'une base de donn√©es relationnelle, car c'est l√† que les transactions sont effectu√©es?  Pas vraiment.  Il a √©t√© dit plus haut que le concept de transaction d√©pend du contexte, et maintenant nous allons bri√®vement examiner de quelles transactions nous pouvons parler lorsque nous discutons des syst√®mes d'information. <br><br>  Pour commencer, nous s√©parons les concepts de transactions du domaine sujet (transactions commerciales) et de transactions syst√®me.  Le second peut √™tre mis en ≈ìuvre √† diff√©rents endroits et de diff√©rentes mani√®res. <br><br>  Allons du plus haut niveau - le domaine.  La personne int√©ress√©e peut d√©clarer qu'il existe des √©tats acceptables et ne souhaite pas voir le syst√®me d'information en dehors de ces √©tats.  Nous ne proposerons pas d'exemples suppl√©mentaires: le transfert d'argent entre les comptes convient ici.  Nous pr√©cisons seulement qu'un transfert n'est pas n√©cessairement un transfert d'argent entre les comptes de r√®glement de deux clients bancaires.  La t√¢che de comptabilit√© est tout aussi importante, lorsque les comptes doivent refl√©ter les sources et l‚Äôobjet des fonds de l‚Äôorganisation, et que le transfert doit refl√©ter le changement dans la r√©partition des fonds par ces sources et cet objectif.  Il s'agit d'un exemple de <b>transaction de domaine sujet</b> . <br><br>  Voyons maintenant les exemples les plus courants et les plus int√©ressants de la mise en ≈ìuvre de transactions syst√®me.  Dans les transactions syst√®me, divers moyens techniques r√©pondent aux exigences du domaine.  Une solution √©prouv√©e classique de ce type est une <strong>transaction SGBD relationnelle</strong> (premier exemple).  Les syst√®mes de gestion de base de donn√©es modernes (√† la fois relationnels <a href="">et pas tr√®s</a> ) fournissent un m√©canisme de transaction qui vous permet soit d'enregistrer (valider) toutes les modifications apport√©es au cours de la p√©riode de travail sp√©cifi√©e, soit de les annuler (annuler).  Lors de l'utilisation d'un tel m√©canisme, des op√©rations de retrait d'argent d'un compte et de cr√©dit sur un autre compte qui composent la transaction du domaine concern√©, les moyens SGBD seront combin√©s en une transaction syst√®me et seront ex√©cut√©s ensemble ou ne seront pas ex√©cut√©s du tout. <br><br>  Bien entendu, l'utilisation d'un SGBD n'est pas n√©cessaire.  En gros, vous pouvez g√©n√©ralement impl√©menter le m√©canisme de transaction SGBD dans votre langage de programmation pr√©f√©r√© et profiter de l'analogue instable et bogu√© des outils existants.  Mais votre ¬´v√©lo¬ª peut √™tre optimis√© pour des situations sp√©cifiques dans le domaine. <br><br>  Il existe des options plus int√©ressantes.  Les langages de programmation industrielle modernes (C # et Java en premier lieu) offrent des outils con√ßus sp√©cifiquement pour organiser des transactions impliquant des sous-syst√®mes compl√®tement diff√©rents, et pas seulement le SGBD.  Dans cette publication, nous appellerons ces logiciels de transactions.  Dans le cas de C #, il s'agit de <b>transactions √† partir de l'espace de noms System.Transactions</b> (le deuxi√®me exemple), et elles sont d√©crites ci-dessous. <br><br>  Avant de passer aux transactions <code>System.Transactions</code> , on ne peut manquer de mentionner un autre ph√©nom√®ne int√©ressant.  <code>System.Transactions</code> outils <code>System.Transactions</code> permettent au programmeur d'impl√©menter ind√©pendamment la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©moire de transaction programmatique</a> .  Dans ce cas, les op√©rations de programme qui affectent l'√©tat du syst√®me (dans le cas des langages de programmation imp√©ratifs classiques, il s'agit d'une op√©ration d'affectation) sont incluses par d√©faut dans les transactions qui peuvent √™tre valid√©es et annul√©es de la m√™me mani√®re que les transactions SGBD.  Avec cette approche, la n√©cessit√© d'utiliser des m√©canismes de synchronisation (en C # - <code>lock</code> , en Java - <code>synchronized</code> ) est consid√©rablement r√©duite.  Un autre d√©veloppement de cette id√©e est la <strong>m√©moire transactionnelle logicielle, prise en charge au niveau de la plate-forme</strong> (troisi√®me exemple).  Un tel miracle devrait se trouver dans une langue dont l'√©l√©gance d√©passe son applicabilit√© industrielle - Clojure.  Et pour les langues ouvri√®res-paysannes, il existe des biblioth√®ques de plug-ins qui fournissent les fonctionnalit√©s de la m√©moire transactionnelle programmatique. <br><br>  Les transactions syst√®me peuvent inclure plusieurs syst√®mes d'information, auquel cas elles sont distribu√©es.  Distribu√© peut √™tre √† la fois des transactions SGBD et des logiciels;  tout d√©pend de la fonctionnalit√© prise en charge par un outil de transaction particulier.  Des transactions r√©parties plus d√©taill√©es sont d√©crites dans la section correspondante.  Je vais donner une image pour faciliter la compr√©hension des sujets abord√©s. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/di/yd/4s/diyd4spwelqhd61eoetfacuncjm.png"></div><br><a name="TLDR1"></a><h4>  Section TL; DR </h4><br>  Il existe des processus qui consistent en plusieurs op√©rations indivisibles (atomiques) appliqu√©es au syst√®me, dans le cas g√©n√©ral pas n√©cessairement informatives.  Chaque op√©ration indivisible peut laisser le syst√®me dans un √©tat inacceptable lorsque l'int√©grit√© des donn√©es est compromise.  Par exemple, si un transfert d'argent entre deux comptes est repr√©sent√© par deux op√©rations indivisibles de retrait du compte n ¬∞ 1 et de cr√©dit sur le compte n ¬∞ 2, alors une seule de ces op√©rations violera l'int√©grit√© des donn√©es.  L'argent dispara√Æt au milieu de nulle part, ou appara√Æt au milieu de nulle part.  Une transaction combine des op√©rations indivisibles afin qu'elles soient ex√©cut√©es toutes ensemble (bien s√ªr, s√©quentiellement, si n√©cessaire) ou non ex√©cut√©es du tout.  Nous pouvons parler des transactions de domaine et des transactions dans les syst√®mes techniques qui impl√©mentent g√©n√©ralement les transactions de domaine. <br><br><a name="SystemTransactions"></a><h2>  Transactions bas√©es sur System.Transactions </h2><br><a name="WhatIsIt1"></a><h4>  Qu'est ce que c'est </h4><br>  Dans le monde .NET, il existe un cadre logiciel con√ßu par les cr√©ateurs d'une plateforme de gestion des transactions.  Du point de vue d'un programmeur transactionnel, ce cadre comprend les <code>System.Transactions</code> <code>TransactionScope</code> , <code>TransactionScopeOption</code> , <code>TransactionScopeAsyncFlowOption</code> et <code>TransactionOptions</code> <code>System.Transactions</code> espace de noms <code>System.Transactions</code> .  Si nous parlons de .NET Standard, tout cela est disponible √† partir de la <a href="">version 2.0</a> . <br><br>  Les transactions √† partir de l'espace de noms <code>System.Transactions</code> sont bas√©es sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la norme X / Open XA de The Open Group</a> .  Cette norme introduit de nombreux termes abord√©s ci-dessous et, plus important encore, d√©crit les transactions distribu√©es, qui sont √©galement couvertes dans cette publication dans une section sp√©ciale.  L'impl√©mentation de transactions logicielles sur d'autres plateformes, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java, est</a> bas√©e sur le m√™me standard. <br><br>  Un cas d'utilisation de transaction typique pour un programmeur C # est le suivant: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Transactions.TransactionScope(System.Transactions.TransactionScopeOption.Required)) { <span class="hljs-comment"><span class="hljs-comment">// -  ,    . scope.Complete(); }</span></span></code> </pre> <br>  √Ä l'int√©rieur du bloc <code>using</code> trouve le code qui effectue le travail, dont les r√©sultats doivent √™tre valid√©s ou annul√©s tous ensemble.  Des exemples classiques d'un tel travail sont la lecture et l'√©criture dans la base de donn√©es ou l'envoi et la r√©ception de messages de la file d'attente.  Lorsque le contr√¥le quitte le bloc <code>using</code> , la transaction sera valid√©e.  Si vous supprimez l'appel <code>Complete</code> , la transaction sera annul√©e.  Assez simple. <br><br>  Il s'av√®re que lors d'une annulation de transaction, toutes les op√©rations effectu√©es √† l'int√©rieur d'un tel bloc <code>using</code> seront annul√©es?  Et si j'ai assign√© √† une variable une valeur diff√©rente, alors cette variable restaurera l'ancienne valeur?  Quand j'ai vu un design similaire pour la premi√®re fois, je le pensais.  En fait, bien s√ªr, tous les changements ne seront pas annul√©s, mais seulement des changements tr√®s <i>sp√©ciaux</i> .  Si toutes les modifications √©taient annul√©es, ce serait la m√©moire transactionnelle logicielle d√©crite ci-dessus.  Voyons maintenant quelles sont ces modifications sp√©ciales qui peuvent participer aux transactions de programme bas√©es sur <code>System.Transactions</code> . <br><br><a name="ResourceManagers"></a><h4>  Gestionnaires de ressources </h4><br>  Pour que quelque chose prenne en charge les transactions bas√©es sur <code>System.Transactions</code> , il est n√©cessaire qu'il poss√®de des informations qu'une transaction est actuellement en cours et qu'il est enregistr√© dans un registre des participants aux transactions.  Vous pouvez obtenir des informations indiquant si le travail transactionnel est en cours en v√©rifiant la propri√©t√© statique <code>Current</code> de la classe <code>System.Transactions.Transaction</code> .  La saisie du bloc <code>using</code> du type indiqu√© ci-dessus ne fait que d√©finir cette propri√©t√©, si elle n'a pas √©t√© d√©finie auparavant.  Et pour vous inscrire en tant que participant √† une transaction, vous pouvez utiliser des m√©thodes de type <code>Transaction.Enlist <i>Smth</i></code> .  De plus, vous devez impl√©menter l'interface requise par ces m√©thodes.  Gestionnaire de ressources - c'est juste un ¬´quelque chose¬ª qui prend en charge l'interaction avec les transactions de <code>System.Transactions</code> (une d√©finition plus sp√©cifique est donn√©e ci-dessous). <br><br>  Que sont les gestionnaires de ressources?  Si nous travaillons √† partir de C # avec un SGBD, par exemple, SQL Server ou Oracle Database, nous utilisons g√©n√©ralement les pilotes appropri√©s et ce sont les ressources de gestion.  Dans le code, ils sont repr√©sent√©s par les types <code>System.Data.SqlClient.SqlConnection</code> et <code>Oracle.ManagedDataAccess.Client.OracleConnection</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ils disent √©galement</a> que MSMQ prend en charge les transactions bas√©es sur <code>System.Transactions</code> .  Guid√© par des connaissances et des exemples tir√©s d'Internet, vous pouvez cr√©er votre propre gestionnaire de ressources.  L'exemple le plus simple est donn√© dans la section suivante. <br><br>  En plus des gestionnaires de ressources, nous devons √©galement avoir un gestionnaire de transactions, qui surveillera la transaction et donnera des ordres aux gestionnaires de ressources en temps opportun.  Selon les gestionnaires de ressources impliqu√©s dans la transaction (leurs caract√©ristiques et leur emplacement), diff√©rents gestionnaires de transactions sont connect√©s au travail.  Dans ce cas, la s√©lection de la version appropri√©e est automatique et ne n√©cessite pas l'intervention d'un programmeur. <br><br>  Plus pr√©cis√©ment, le gestionnaire de ressources est une instance d'une classe qui impl√©mente l'interface sp√©ciale <code>System.Transactions.IEnlistmentNotification</code> .  L'instance de classe, selon les instructions du client, est enregistr√©e en tant que participant √† la transaction √† l'aide de la propri√©t√© statique <code>System.Transactions.Transaction.Current</code> .  Par la suite, le gestionnaire de transactions appelle les m√©thodes de l'interface sp√©cifi√©e si n√©cessaire. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tw/ea/vp/tweavpimeod539do_fkzpr6yzrw.png"></div><br>  Il est clair qu'au moment de l'ex√©cution, l'ensemble des gestionnaires de ressources impliqu√©s dans la transaction peut changer.  Par exemple, apr√®s avoir entr√© le bloc <code>using</code> , nous pouvons d'abord faire quelque chose dans SQL Server, puis dans Oracle Database.  En fonction de cet ensemble de gestionnaires de ressources, le gestionnaire de transactions utilis√© est d√©termin√©.  Pour √™tre plus pr√©cis, le protocole de transaction utilis√© est d√©termin√© par l'ensemble des gestionnaires de ressources, et le gestionnaire de transaction qui le prend en charge est d√©termin√© sur la base du protocole.  Nous examinerons les protocoles transactionnels <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus tard</a> lorsque nous parlerons de transactions distribu√©es.  Le m√©canisme de s√©lection automatique du gestionnaire de transactions appropri√© au moment de l'ex√©cution lors du changement des gestionnaires de ressources impliqu√©s dans la transaction est appel√© Promotion des transactions. <br><br><a name="KindsOfResourceManagers"></a><h4>  Types de gestionnaires de ressources </h4><br>  Les gestionnaires de ressources peuvent √™tre divis√©s en deux grands groupes: durables et variables. <br><br>  Durable Resource Manager - un gestionnaire de ressources qui prend en charge une transaction m√™me si le syst√®me d'information n'est pas disponible (par exemple, lorsque l'ordinateur red√©marre).  Volatile Resource Manager - Un gestionnaire de ressources qui ne prend pas en charge une transaction si le syst√®me d'information n'est pas disponible.  Un gestionnaire de ressources incoh√©rent prend uniquement en charge les transactions en m√©moire. <br><br>  Les gestionnaires de ressources classiques √† long terme sont le SGBD (ou le pilote SGBD pour la plate-forme logicielle).  Quoi qu'il arrive - au moins un dysfonctionnement du syst√®me d'exploitation, au moins une panne de courant - le SGBD garantira l'int√©grit√© des donn√©es apr√®s son retour en √©tat de fonctionnement.  Pour cela, bien s√ªr, vous devez payer quelques inconv√©nients, mais dans cet article, nous ne les consid√©rerons pas.  Un exemple de gestionnaire de ressources non persistant est la m√©moire transactionnelle logicielle mentionn√©e ci-dessus. <br><br><a name="TransactionScope"></a><h4>  Utilisation de TransactionScope </h4><br>  Lors de la cr√©ation d'un objet de type <code>TransactionScope</code> vous pouvez sp√©cifier certains param√®tres. <br><br>  Tout d'abord, il existe un param√®tre qui indique au runtime ce dont il a besoin: <br><br><ol><li>  Utilisez une transaction qui existe d√©j√† √† ce moment; </li><li>  Assurez-vous d'en cr√©er un nouveau; </li><li>  √† l'inverse, ex√©cutez du code √† l'int√©rieur d'un bloc <code>using</code> dehors d'une transaction. </li></ol><br>  L'√©num√©ration <code>System.Transactions.TransactionScopeOption</code> est responsable de tout cela. <br><br>  Deuxi√®mement, vous pouvez d√©finir le niveau d'isolement des transactions.  C'est un param√®tre qui vous permet de trouver un compromis entre l'ind√©pendance du changement et la vitesse.  Le niveau le plus ind√©pendant - s√©rialisable - garantit qu'il n'y a pas de situations o√π des modifications apport√©es dans une transaction qui n'ont pas encore √©t√© valid√©es peuvent √™tre vues dans une autre transaction.  Chaque niveau suivant ajoute une telle situation sp√©cifique, lorsque l'ex√©cution simultan√©e de transactions peut s'influencer mutuellement.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par d√©faut, une transaction est ouverte au niveau s√©rialisable, ce qui peut √™tre d√©sagr√©able (voir par exemple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce commentaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La d√©finition du niveau d'isolement des transactions lors de la cr√©ation </font></font><code>TransactionScope</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est conseill√©e aux gestionnaires de ressources. Ils peuvent m√™me ne pas prendre en charge tous les niveaux r√©pertori√©s </font></font><code>System.Transactions.IsolationLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En outre, il convient de garder √† l'esprit que lors de l'utilisation du pool de connexions pour travailler avec la base de donn√©es, la connexion pour laquelle le niveau d'isolement des transactions a √©t√© modifi√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conservera ce niveau</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors du retour au pool </font><font style="vertical-align: inherit;">. D√©sormais, lorsque le programmeur re√ßoit cette connexion du pool et s'appuie sur les valeurs par d√©faut, il observe un comportement inattendu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sc√©narios de travail typiques c</font></font><code>TransactionScope</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et les pi√®ges importants (√† savoir, les transactions imbriqu√©es) sont bien couverts dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article sur "Habr"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="Applicability"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Applicabilit√© des transactions logicielles </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il faut dire que dans presque tous les syst√®mes d'information en exploitation commerciale, des processus sont lanc√©s qui peuvent conduire le syst√®me √† un √©tat inacceptable. </font><font style="vertical-align: inherit;">Par cons√©quent, il peut √™tre n√©cessaire de contr√¥ler ces processus, de d√©terminer si l'√©tat actuel du syst√®me est acceptable et, sinon, de le restaurer. </font><font style="vertical-align: inherit;">Transactions logicielles - un outil pr√™t √† l'emploi pour maintenir le syst√®me dans un √©tat acceptable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans chaque cas, il serait constructif de consid√©rer le co√ªt:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int√©grer les processus dans l'infrastructure de transaction logicielle (ces processus doivent √©galement √™tre conscients </font></font><code>TransactionScope</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de bien d'autres choses);</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'entretien de cette infrastructure (par exemple, le co√ªt de location d'√©quipement avec Windows √† bord); </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la formation des employ√©s (car le sujet des transactions .NET n'est pas courant). </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous ne devons pas oublier que le processus de transaction peut √™tre tenu de rendre compte de ses progr√®s au "monde ext√©rieur", par exemple, pour tenir un journal des actions en dehors de la transaction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De toute √©vidence, le rejet des transactions logicielles n√©cessitera la cr√©ation ou la mise en ≈ìuvre de certains autres moyens de maintenir l'int√©grit√© des donn√©es, qui auront √©galement leur valeur. </font><font style="vertical-align: inherit;">En fin de compte, il peut y avoir des cas o√π les violations de l'int√©grit√© des donn√©es sont si rares qu'il est plus facile de restaurer un √©tat acceptable du syst√®me par des interventions chirurgicales que de maintenir un m√©canisme de r√©cup√©ration automatique.</font></font><br><br><a name="Example"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un exemple de gestionnaire de ressources volage </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyons maintenant un exemple de gestionnaire de ressources simple qui ne prend pas en charge la r√©cup√©ration apr√®s une d√©faillance du syst√®me. Nous aurons un bloc de m√©moire transactionnelle logicielle qui stocke une certaine valeur qui peut √™tre lue et √©crite. En l'absence de transaction, ce bloc se comporte comme une variable normale, et en pr√©sence d'une transaction, il stocke la valeur initiale, qui peut √™tre restaur√©e apr√®s l'annulation de la transaction. Le code d'un tel gestionnaire de ressources est pr√©sent√© ci-dessous:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Stm</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">System</span></span>.<span class="hljs-title"><span class="hljs-title">Transactions</span></span>.<span class="hljs-title"><span class="hljs-title">IEnlistmentNotification</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _current; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _original; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _enlisted; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _current; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Enlist()) { _original = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } _current = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { _current = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; _original = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enlist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_enlisted) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentTx = System.Transactions.Transaction.Current; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentTx == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; currentTx.EnlistVolatile(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, System.Transactions.EnlistmentOptions.None); _enlisted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> IEnlistmentNotification public void Commit(System.Transactions.Enlistment enlistment) { _original = _current; _enlisted = false; } public void InDoubt(System.Transactions.Enlistment enlistment) { _enlisted = false; } public void Prepare(System.Transactions.PreparingEnlistment preparingEnlistment) { preparingEnlistment.Prepared(); } public void Rollback(System.Transactions.Enlistment enlistment) { _current = _original; _enlisted = false; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> IEnlistmentNotification }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On peut voir que la seule exigence formelle est l'impl√©mentation de l'interface </font></font><code>System.Transactions.IEnlistmentNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Parmi les int√©ressantes, les m√©thodes </font></font><code>Enlist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(qui ne font pas partie </font></font><code>System.Transactions.IEnlistmentNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et </font></font><code>Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La m√©thode </font></font><code>Enlist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√©rifie simplement si le code donn√© fonctionne dans le cadre de la transaction et, si c'est le cas, enregistre une instance de sa classe en tant que gestionnaire de ressources non constant. La m√©thode </font></font><code>Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est appel√©e par le gestionnaire de transactions avant de valider les modifications. Notre gestionnaire de ressources signale sa disponibilit√© pour la validation en appelant une m√©thode </font></font><code>System.Transactions.PreparingEnlistment.Prepared</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui suit est un code montrant un exemple d'utilisation de notre gestionnaire de ressources:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stm&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Transactions.TransactionScope(System.Transactions.TransactionScopeOption.Required)) { stm.Value = <span class="hljs-number"><span class="hljs-number">2</span></span>; scope.Complete(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous </font></font><code>using</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lisez la propri√©t√© </font><font style="vertical-align: inherit;">imm√©diatement apr√®s avoir quitt√© le bloc </font></font><code>stm.Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la valeur attendue y sera attendue </font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Et si vous supprimez l'appel </font></font><code>scope.Complete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la transaction sera annul√©e et la propri√©t√© </font></font><code>stm.Value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aura la valeur </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©finie avant le d√©but de la transaction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une s√©quence d'appels simplifi√©e lors de l'utilisation de transactions est </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">illustr√©e dans le diagramme ci-dessous.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/09/je/1d/09je1dkghhmmwts6rvaufuntpna.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On peut voir que dans cet exemple, toutes les possibilit√©s offertes par l'infrastructure ne sont pas prises en compte </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous les examinerons plus en d√©tail apr√®s avoir pris connaissance des protocoles transactionnels et des transactions distribu√©es dans la section suivante.</font></font><br><br><a name="TLDR2"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Section TL; DR </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un programmeur peut utiliser une classe </font></font><code>TransactionScope</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ex√©cuter du code dans une transaction existante ou nouvelle. Une transaction est valid√©e si et seulement si la </font></font><code>TransactionScope</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©thode est appel√©e </font><font style="vertical-align: inherit;">sur une instance existante de la classe </font></font><code>Dispose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, m√™me si la m√©thode a √©t√© appel√©e avant</font></font><code>Complete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Un programmeur peut indiquer s'il souhaite d√©marrer une nouvelle transaction, tirer parti d'une transaction existante ou, √† l'inverse, ex√©cuter du code en dehors d'une transaction existante. Seuls les gestionnaires de ressources sont impliqu√©s dans la transaction - des composants logiciels qui impl√©mentent certaines fonctionnalit√©s. Les gestionnaires de ressources peuvent √™tre √† long terme (se remettre d'une d√©faillance du syst√®me) et intermittents (ne pas se remettre). Un SGBD est un exemple de gestionnaire de ressources √† longue dur√©e de vie. Le gestionnaire de ressources est coordonn√© par un gestionnaire de transactions - un composant logiciel qui est automatiquement s√©lectionn√© par le runtime sans la participation d'un programmeur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le gestionnaire de ressources incoh√©rent est une classe qui impl√©mente l'interface </font></font><code>System.Transactions.IEnlistmentNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la m√©thode</font></font><code>Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">confirmant sa volont√© de valider les modifications ou, inversement, signalant une annulation des modifications. </font><font style="vertical-align: inherit;">Lorsque l'appelant fait quelque chose avec le gestionnaire de ressources, il v√©rifie si la transaction est ouverte maintenant et si elle est ouverte, elle est enregistr√©e √† l'aide de la m√©thode </font></font><code>System.Transactions.Transaction.EnlistVolatile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><a name="DistributedTransactions"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transactions distribu√©es </font></font></h2><br><a name="WhatIsIt2"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qu'est ce que c'est </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une transaction distribu√©e implique plusieurs sous-syst√®mes d'information (en fait, tout n'est pas aussi simple, voir plus loin ci-dessous). </font><font style="vertical-align: inherit;">Il est entendu que les modifications de tous les syst√®mes impliqu√©s dans une transaction distribu√©e doivent √™tre valid√©es ou annul√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Divers moyens de mise en ≈ìuvre des transactions ont √©t√© pr√©sent√©s ci-dessus: SGBD, infrastructure </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et m√©moire transactionnelle programmatique int√©gr√©e √† la plate-forme. </font><font style="vertical-align: inherit;">Les transactions distribu√©es peuvent √©galement √™tre fournies avec ces outils. </font><font style="vertical-align: inherit;">Par exemple, dans la base de donn√©es Oracle, la modification (et la lecture effective) des donn√©es de plusieurs bases de donn√©es au sein d'une m√™me transaction les transforme automatiquement en donn√©es distribu√©es. </font><font style="vertical-align: inherit;">Ensuite, nous parlerons des transactions distribu√©es par logiciel, qui peuvent inclure des gestionnaires de ressources h√©t√©rog√®nes.</font></font><br><br><a name="TransactionProtocols"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Protocoles transactionnels </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un protocole transactionnel est un ensemble de principes par lesquels les applications impliqu√©es dans une transaction interagissent. Dans le monde .NET, les protocoles suivants sont les plus courants. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√©ger.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pas plus d'un gestionnaire de ressources durable n'est utilis√©. Toutes les interactions transactionnelles se produisent dans le m√™me domaine d'application ou le gestionnaire de ressources prend en charge la promotion et la validation en une seule phase (impl√©mente </font></font><code>IPromotableSinglePhaseNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OleTx.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'interop√©rabilit√© entre plusieurs domaines d'application et plusieurs ordinateurs est autoris√©e. Vous pouvez utiliser de nombreux gestionnaires de ressources durables. Tous les ordinateurs participants doivent ex√©cuter Windows. Utilisez les appels de proc√©dure √† distance (RPC). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WS-AT.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interop√©rabilit√© entre plusieurs domaines d'application et plusieurs ordinateurs est autoris√©e. Vous pouvez utiliser de nombreux gestionnaires de ressources durables. Les ordinateurs participants peuvent ex√©cuter diff√©rents syst√®mes d'exploitation, pas seulement Windows. Le protocole HTTP (Hypertext Transmission Protocol) est utilis√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il a √©t√© not√© ci-dessus que le protocole de transaction actuel affecte le choix du gestionnaire de transactions, et les caract√©ristiques des ressources de contr√¥le impliqu√©es dans la transaction influencent le choix du protocole. Nous listons maintenant les gestionnaires de transactions bien connus. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestionnaire de transactions l√©ger (LTM)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Introduit dans le .NET Framework 2.0 et versions ult√©rieures. G√®re les transactions √† l'aide du protocole l√©ger. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestionnaire de transactions du noyau (KTM)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Introduit dans Windows Vista et Windows Server 2008. G√®re les transactions √† l'aide du protocole l√©ger. Il peut appeler un syst√®me de fichiers transactionnels (TxF) et un registre transactionnel (TxR) sur Windows Vista et Windows 2008. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coordinateur de transactions distribu√©es (MSDTC)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . G√®re les transactions √† l'aide des protocoles OleTx et WS-AT. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il convient √©galement de garder √† l'esprit que certains gestionnaires de ressources ne prennent pas en charge tous les protocoles r√©pertori√©s. Par exemple, MSMQ et SQL Server 2000 ne prennent pas en charge Lightweight, donc les transactions impliquant MSMQ ou SQL Server 2000 seront g√©r√©es par MSDTC, m√™me s'ils sont les seuls participants. Techniquement, cette limitation provient du fait que les gestionnaires de ressources sp√©cifi√©s, impl√©mentant, bien s√ªr, l'interface</font></font><code>System.Transactions.IEnlistmentNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'impl√©mentez pas l'interface </font></font><code>System.Transactions.IPromotableSinglePhaseNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il contient, entre autres, une m√©thode </font></font><code>Promote</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que le runtime invoque, si n√©cessaire, pour basculer vers un gestionnaire de transactions plus raide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ambigu√Øt√© du concept de transaction distribu√©e devrait maintenant devenir √©vidente. </font><font style="vertical-align: inherit;">Par exemple, vous pouvez d√©finir une transaction distribu√©e comme une transaction √† laquelle elle participe:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moins deux des gestionnaires de ressources; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> des gestionnaires de ressources arbitrairement variables et au moins deux √† long terme; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moins deux des gestionnaires de ressources n√©cessairement situ√©s sur des ordinateurs diff√©rents. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par cons√©quent, il est pr√©f√©rable de toujours clarifier quelles transactions particuli√®res sont impliqu√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et dans ce contexte, MSDTC est principalement discut√©. </font><font style="vertical-align: inherit;">Il s'agit d'un composant logiciel de Windows qui g√®re les transactions distribu√©es. </font><font style="vertical-align: inherit;">Il existe une interface graphique pour configurer et surveiller les transactions, qui se trouve dans l'utilitaire ¬´Services de composants¬ª, en suivant le chemin ¬´Ordinateurs - Poste de travail - Coordinateur de transactions distribu√©es - DTC local¬ª.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vo/35/gc/vo35gcdta3c9qx5w5cnsuxkbzz8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour la configuration, s√©lectionnez l'√©l√©ment ¬´Propri√©t√©s¬ª dans le menu contextuel du n≈ìud ¬´Local DTC¬ª, et pour surveiller les transactions distribu√©es, s√©lectionnez l'√©l√©ment ¬´Statistiques de transaction¬ª dans le panneau central. </font></font><br><br><a name="TwoPhaseCommit"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fixation biphasique </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si plusieurs gestionnaires de ressources participent √† la transaction, les r√©sultats de leur travail peuvent diff√©rer: par exemple, l'un d'eux s'est termin√© avec succ√®s, et il est pr√™t √† valider les modifications, et l'autre a une erreur, et il va annuler les modifications. Cependant, l'essence d'une transaction distribu√©e r√©side dans le fait que les changements dans toutes les ressources de contr√¥le impliqu√©es dans la transaction sont soit valid√©s tous ensemble, soit annul√©s. Par cons√©quent, dans de tels cas, un protocole de fixation en deux phases est g√©n√©ralement utilis√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En g√©n√©ral, l'essence de ce protocole est la suivante. Pendant la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premi√®re phase</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les gestionnaires de ressources impliqu√©s dans la transaction pr√©parent des informations suffisantes pour se remettre de l'√©chec (s'il s'agit d'un gestionnaire de ressources √† long terme) et pour une ex√©cution r√©ussie √† la suite d'une validation. D'un point de vue technique, le gestionnaire de ressources signale qu'il a termin√© la premi√®re phase en appelant la m√©thode </font></font><code>System.Transactions.PreparingEnlistment.Prepared</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la m√©thode </font></font><code>Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ou le gestionnaire de ressources peut vous informer que les modifications ont √©t√© annul√©es en appelant la m√©thode </font></font><code>ForceRollback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque tous les gestionnaires de ressources impliqu√©s dans la transaction ont ¬´vot√©¬ª, c'est-√†-dire qu'ils ont inform√© le gestionnaire de transactions s'ils souhaitaient valider ou annuler les modifications, la </font><b><font style="vertical-align: inherit;">deuxi√®me phase</font></b><font style="vertical-align: inherit;"> commence</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. √Ä ce stade, les gestionnaires de ressources sont invit√©s √† valider leurs modifications (si tous les participants ont vot√© pour la correction) ou √† refuser les modifications (si au moins un participant a vot√© pour la restauration). Techniquement, cela se traduit par l'invocation des m√©thodes </font></font><code>Commit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Rollback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que les gestionnaires de ressources impl√©mentent et dans lesquelles ils invoquent la m√©thode </font></font><code>System.Transactions.Enlistment.Done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le gestionnaire de ressources peut √©galement appeler la m√©thode </font></font><code>System.Transactions.Enlistment.Done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lors de la premi√®re phase. Dans ce cas, il est entendu qu'il n'engagera aucun changement (par exemple, ne fonctionne que pour la lecture) et ne participera pas √† la deuxi√®me phase. En savoir plus sur la validation en deux phases </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chez Microsoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la connexion entre le gestionnaire de transactions et au moins l'un des gestionnaires de ressources est perdue, la transaction devient gel√©e (¬´dans le doute¬ª, dans le doute). </font><font style="vertical-align: inherit;">Le gestionnaire de transactions, en appelant des m√©thodes </font></font><code>InDoubt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, avertit les gestionnaires de ressources disponibles de cet √©v√©nement qui peuvent r√©pondre de mani√®re appropri√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe encore une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fixation triphas√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ses modifications avec ses avantages et ses inconv√©nients. </font><font style="vertical-align: inherit;">Le protocole de validation en trois phases est moins courant, peut-√™tre parce qu'il n√©cessite encore plus de co√ªts de communication entre les sous-syst√®mes en interaction.</font></font><br><br><a name="Interfaces"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aide-m√©moire sur les interfaces System.Transactions </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelque chose est difficile. Pour trier un peu les choses, je vais bri√®vement d√©crire les principales interfaces d'espace de noms </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√©cessaires pour cr√©er un gestionnaire de ressources. Voici un diagramme de classes.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bs/rj/sx/bsrjsxptqz6w3g7l6zxawrzeyco.png"></div><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IEnlistmentNotification.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le gestionnaire de ressources impl√©mente cette interface. Le gestionnaire de transactions appelle les m√©thodes impl√©ment√©es dans l'ordre suivant. Au cours de la premi√®re phase, il appelle la m√©thode </font></font><code>Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sauf si les √©toiles se sont r√©unies pour appeler la m√©thode </font></font><code>ISinglePhaseNotification.SinglePhaseCommit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme d√©crit dans le paragraphe suivant). Selon cette m√©thode, le gestionnaire de ressources enregistre les informations n√©cessaires pour se remettre d'un √©chec, pr√©pare la validation finale des modifications de son c√¥t√© et vote pour valider ou annuler les modifications. S'il arrive une deuxi√®me phase, en </font><font style="vertical-align: inherit;">fonction de la disponibilit√© des ressources et le </font><font style="vertical-align: inherit;">contr√¥le des r√©sultats du vote de l'op√©ration de contr√¥le est l' </font><font style="vertical-align: inherit;">une des trois m√©thodes: </font></font><code>Commit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>InDoubt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Rollback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISinglePhaseNotification.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le gestionnaire de ressources impl√©mente cette interface s'il souhaite fournir au gestionnaire de transactions l'opportunit√© d'optimiser l'ex√©cution en r√©duisant la deuxi√®me phase de validation. Si le gestionnaire de transactions ne voit qu'un seul gestionnaire de ressources, dans la premi√®re phase de validation, il essaie d'appeler la m√©thode du gestionnaire de ressources </font></font><code>SinglePhaseCommit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(√† la place </font></font><code>IEnlistmentNotification.Prepare</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et d'exclure ainsi le vote et la transition vers la deuxi√®me phase. Cette approche pr√©sente des avantages et des inconv√©nients, dont Microsoft a le plus clairement parl√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ITransactionPromoter.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le gestionnaire de ressources impl√©mente cette interface (non seulement directement, mais via l'interface</font></font><code>IPromotableSinglePhaseNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), s'il souhaite fournir au gestionnaire de transactions la possibilit√© d'adh√©rer au protocole Lightweight m√™me lors d'un appel √† distance, jusqu'√† ce que d'autres conditions surviennent n√©cessitant une complication du protocole. Lorsque vous devez compliquer le protocole, la m√©thode sera appel√©e </font></font><code>Promote</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPromotableSinglePhaseNotification.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le gestionnaire de ressources impl√©mente cette interface afin, d'une part, de mettre en ≈ìuvre l'interface </font></font><code>ITransactionPromoter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et d'autre part, afin que le gestionnaire de transactions puisse utiliser la validation en une seule phase, les m√©thodes d'appel </font></font><code>IPromotableSinglePhaseNotification.SinglePhaseCommit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>IPromotableSinglePhaseNotification.Rollback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le gestionnaire de transactions appelle une m√©thode </font></font><code>IPromotableSinglePhaseNotification.Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour marquer l'enregistrement r√©ussi du gestionnaire de ressources de mani√®re simplifi√©e. Plus ou moins, cela peut √™tre compris √† partir d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un document Microsoft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regardons un peu plus</font></font><code>System.Transactions.Enlistment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ses h√©ritiers. Ce type d'instance est fourni par le gestionnaire de transactions lorsqu'il invoque les m√©thodes d'interface impl√©ment√©es par le gestionnaire de ressources.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qi/bd/xc/qibdxcddktegq5h2xnpuaelygj0.png"></div><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enr√¥lement. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le gestionnaire de ressources peut appeler une seule m√©thode de ce type - </font></font><code>Done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, - pour signaler la r√©ussite de sa partie du travail. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©paration de l'inscription. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä l'aide d'une instance de ce type lors de la premi√®re phase de validation, le gestionnaire de ressources peut signaler son intention de valider ou d'annuler les modifications. </font><font style="vertical-align: inherit;">Un gestionnaire de ressources √† longue dur√©e de vie peut √©galement obtenir les informations n√©cessaires pour r√©cup√©rer d'une d√©faillance du syst√®me. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SinglePhaseEnlistment. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä l'aide d'une instance de ce type, le gestionnaire de ressources peut transmettre au gestionnaire de transactions des informations sur les r√©sultats de son travail √† l'aide d'un sch√©ma simplifi√© (validation en une phase).</font></font><br><br><a name="LimitationsAndAlternatives"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Limitations et alternatives des transactions distribu√©es par logiciel </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une br√®ve √©tude des opinions trouv√©es sur Internet montre que dans de nombreux domaines, les transactions distribu√©es sont d√©mod√©es. Jetez un ≈ìil √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce commentaire malveillant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , par exemple </font><font style="vertical-align: inherit;">. L'objet principal de la critique, qui est bri√®vement mentionn√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , est la nature synchrone (bloquante) des transactions distribu√©es. Si l'utilisateur a envoy√© une demande au cours du traitement de laquelle une transaction distribu√©e a √©t√© organis√©e, il ne recevra une r√©ponse qu'apr√®s (avec succ√®s ou avec une erreur) que tous les sous-syst√®mes inclus dans la transaction aient fini de fonctionner. Dans le m√™me temps, il existe une opinion soutenue par la recherche selon laquelle le protocole de validation en deux phases affiche de mauvaises performances, en particulier avec une augmentation du nombre de sous-syst√®mes impliqu√©s dans la transaction, comme cela est mentionn√©, par exemple, dans</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette publication sur "Habr√©"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le cr√©ateur du syst√®me pr√©f√®re renvoyer la r√©ponse √† l'utilisateur le plus t√¥t possible, en diff√©rant la coordination des donn√©es pour plus tard, alors une autre solution lui conviendra mieux. Dans le contexte du th√©or√®me de Brewer (th√©or√®me </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), nous pouvons dire que les transactions distribu√©es conviennent aux cas o√π la coh√©rence des donn√©es est plus importante que la disponibilit√©.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe d'autres restrictions pratiques sur l'utilisation des transactions distribu√©es par logiciel. Par exemple, il a √©t√© √©tabli exp√©rimentalement que les transactions distribu√©es utilisant le protocole OleTx ne devaient pas traverser des domaines r√©seau. En tout cas, de longues tentatives pour les faire travailler n'ont pas abouti. De plus, il a √©t√© r√©v√©l√© que l'interaction entre plusieurs instances d'Oracle Database (transactions de bases de donn√©es distribu√©es) impose de s√©rieuses restrictions sur l'applicabilit√© des transactions logicielles distribu√©es (l√† encore, n'a pas pu d√©marrer).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelles sont les alternatives aux transactions distribu√©es? Tout d'abord, je dois dire qu'il sera tr√®s difficile de se passer de transactions techniques (normales, non distribu√©es). Il y a probablement des processus dans le syst√®me qui peuvent temporairement perturber l'int√©grit√© des donn√©es, et il sera n√©cessaire d'assurer en quelque sorte la surveillance de ces processus. De la m√™me mani√®re, en termes de domaine, un concept peut surgir qui inclut un processus mis en ≈ìuvre par un ensemble de processus dans diff√©rents syst√®mes techniques, qui devrait commencer et se terminer dans le domaine des donn√©es int√©grales. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En passant √† des alternatives aux transactions distribu√©es, nous pouvons noter des solutions bas√©es sur des services de messagerie, tels que RabbitMQ et Apache Kafka. Dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette publication sur "Habr√©",</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quatre de ces solutions sont envisag√©es:</font></font><br><br><ol><li>   ,        ,    ; </li><li>    ,           (Transaction Log Tailing); </li><li>       ,       ; </li><li>             (Event Sourcing). </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre alternative est le mod√®le Saga. Il implique une cascade de sous-syst√®mes avec ses transactions locales. √Ä la fin des travaux, chaque syst√®me appelle les √©l√©ments suivants (soit ind√©pendamment, soit avec l'aide d'un coordinateur). Pour chaque transaction, il existe une transaction d'annulation correspondante, et au lieu de transf√©rer le contr√¥le, le sous-syst√®me peut initier l'annulation des modifications apport√©es pr√©c√©demment par les sous-syst√®mes pr√©c√©dents. Sur "Habr√©" il y a de bons articles sur le mod√®le "Saga". Par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette publication</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournit des informations g√©n√©rales sur le maintien des principes d'ACID dans les microservices, et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©taille un exemple d'impl√©mentation du mod√®le Saga avec un coordinateur.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans notre entreprise, certains produits utilisent avec succ√®s les transactions distribu√©es par logiciel via WCF, mais il existe d'autres options. Une fois, lorsque nous avons essay√© de nous faire des amis un nouveau syst√®me avec des transactions distribu√©es, nous avons eu de nombreux probl√®mes, y compris une collision avec les limitations d√©crites ci-dessus et des probl√®mes parall√®les avec la mise √† jour de l'infrastructure logicielle. Par cons√©quent, dans des conditions de p√©nurie de ressources pour ex√©cuter une autre d√©cision de capital, nous avons appliqu√© les tactiques suivantes. L'appel√© capture les modifications dans tous les cas, mais note qu'elles sont √† l'√©tat de brouillon, de sorte que ces modifications n'affectent pas encore le fonctionnement du syst√®me appel√©. Ensuite, l'appelant, lorsqu'il termine son travail via une transaction distribu√©e, le SGBD active les modifications apport√©es par le syst√®me appel√©. De cette fa√ßonau lieu de transactions distribu√©es par logiciel, nous avons utilis√© des transactions SGBD distribu√©es, qui dans ce cas se sont r√©v√©l√©es beaucoup plus fiables.</font></font><br><br><a name="NetCore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Est-ce donc dans .NET Core? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans .NET Core (et m√™me dans .NET Standard), il existe tous les types n√©cessaires pour organiser les transactions et cr√©er votre propre gestionnaire de ressources. </font><font style="vertical-align: inherit;">Malheureusement, dans .NET Core, les transactions bas√©es </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ont une s√©rieuse limitation: elles ne fonctionnent qu'avec le protocole Lightweight. </font><font style="vertical-align: inherit;">Par exemple, si deux gestionnaires de ressources durables sont utilis√©s dans le code, lors de l'ex√©cution, l'environnement l√®vera une exception d√®s que le deuxi√®me gestionnaire sera appel√©.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fait est qu'ils essaient de rendre .NET Core ind√©pendant du syst√®me d'exploitation, de sorte que le lien vers les gestionnaires de transactions tels que KTM et MSDTC est exclu, √† savoir qu'ils sont n√©cessaires pour prendre en charge les transactions avec les propri√©t√©s sp√©cifi√©es. </font><font style="vertical-align: inherit;">Il est possible que la connexion des gestionnaires de transactions soit impl√©ment√©e sous la forme de plugins, mais jusqu'√† pr√©sent, cela a √©t√© √©crit avec une fourche, vous ne pouvez donc pas encore compter sur l'utilisation industrielle des transactions distribu√©es dans .NET Core. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exp√©rience, vous pouvez v√©rifier les diff√©rences dans les transactions distribu√©es dans .NET Framework et .NET Core en √©crivant le m√™me code, en le compilant et en l'ex√©cutant sur diff√©rentes plates-formes.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple d'un tel code qui appelle SQL Server et Oracle Database de mani√®re s√©quentielle.</font></font></b> <div class="spoiler_text"><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Transactions.TransactionScope(System.Transactions.TransactionScopeOption.Required)) { MsSqlServer(); Oracle(); scope.Complete(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Oracle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Oracle.ManagedDataAccess.Client.OracleConnection(<span class="hljs-string"><span class="hljs-string">"User Id=some_user;Password=some_password;Data Source=some_db"</span></span>)) { conn.Open(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = conn.CreateCommand()) { cmd.CommandText = <span class="hljs-string"><span class="hljs-string">"update t_hello set id_hello = 2 where id_hello = 1"</span></span>; cmd.ExecuteNonQuery(); } conn.Close(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MsSqlServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Data.SqlClient.SqlConnectionStringBuilder { DataSource = <span class="hljs-string"><span class="hljs-string">"some_computer\\some_db"</span></span>, UserID = <span class="hljs-string"><span class="hljs-string">"some_user"</span></span>, Password = <span class="hljs-string"><span class="hljs-string">"some_password"</span></span>, InitialCatalog = <span class="hljs-string"><span class="hljs-string">"some_scheme"</span></span>, Enlist = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Data.SqlClient.SqlConnection(builder.ConnectionString)) { conn.Open(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = conn.CreateCommand()) { cmd.CommandText = <span class="hljs-string"><span class="hljs-string">"update t_hello set id_hello = 2 where id_hello = 1"</span></span>; cmd.ExecuteNonQuery(); } conn.Close(); } }</code> </pre> </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les projets pr√™ts pour la construction </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont sur GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ex√©cution de l'exemple pour .NET Core √©choue. </font><font style="vertical-align: inherit;">L'emplacement et le type de l'exception lev√©e d√©pendent de l'ordre de l'appel du SGBD, mais dans tous les cas, cette exception indique une op√©ration de transaction non valide. </font><font style="vertical-align: inherit;">L'ex√©cution de l'exemple pour .NET Framework r√©ussit si MSDTC est en cours d'ex√©cution √† ce moment; </font><font style="vertical-align: inherit;">cependant, dans l'interface graphique de MSDTC, vous pouvez observer l'enregistrement d'une transaction distribu√©e.</font></font><br><br><a name="WCF"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transactions distribu√©es et WCF </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Communication Foundation (WCF) est le cadre .NET pour l'organisation et l'appel des services r√©seau. Compar√© aux approches REST et ASP.NET Web API les plus en vogue, il pr√©sente ses propres avantages et inconv√©nients. WCF est un tr√®s bon ami des transactions .NET, et dans le monde du .NET Framework, il est pratique de l'utiliser pour organiser les transactions r√©parties entre le client et le service. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans .NET Core, cette technologie ne fonctionne que du c√¥t√© client, c'est-√†-dire que vous ne pouvez pas cr√©er un service, mais vous pouvez uniquement faire r√©f√©rence √† un service existant. Cependant, cela n'est pas tr√®s important, car, comme mentionn√© ci-dessus, avec les transactions distribu√©es dans .NET Core, les choses ne vont pas du tout bien. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionne WCF</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour les lecteurs qui ne sont pas familiers avec WCF, voici les informations g√©n√©rales les plus courtes sur ce que cette technologie est en pratique. Contexte - deux syst√®mes d'information appel√©s client et service. Au moment de l'ex√©cution, le client acc√®de √† un autre syst√®me d'information qui prend en charge le service qui l'int√©resse et n√©cessite qu'une op√©ration soit effectu√©e. La gestion est ensuite retourn√©e au client.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour cr√©er un service sur WCF, vous devez g√©n√©ralement √©crire une interface qui d√©crit le contrat pour le service en cours de cr√©ation et une classe qui impl√©mente cette interface. La classe et l'interface sont marqu√©es avec des attributs WCF sp√©ciaux qui les distinguent du reste des types et sp√©cifient certains d√©tails du comportement lors de la d√©couverte et de l'appel du service. Ces types sont envelopp√©s dans quelque chose qui fonctionne comme un serveur (par exemple, dans une DLL sur laquelle IIS est d√©fini) et sont compl√©t√©s par un fichier de configuration (il existe des options), o√π les d√©tails de l'impl√©mentation du service sont indiqu√©s. Apr√®s le d√©marrage, le service est accessible, par exemple, √† l'adresse r√©seau; dans le navigateur Internet, vous pouvez voir les contrats que le service demand√© met en ≈ìuvre.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un programmeur qui souhaite acc√©der √† un service WCF existant utilise un utilitaire de console ou une interface graphique int√©gr√©e √† l'environnement de d√©veloppement afin de former des types en C # (ou dans un autre langage pris en charge) qui correspondent aux contrats de service √† l'adresse du service. Le fichier avec les types obtenus est inclus dans le projet d'application client, et ensuite le programmeur utilise les m√™mes termes que ceux contenus dans l'interface de service, profitant des avantages de la progression (typage statique). De plus, le fichier de configuration du client pr√©cise les caract√©ristiques techniques du service appel√© (il peut √©galement √™tre configur√© dans le code, sans le fichier de configuration).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WCF prend en charge diff√©rents types de transport, de chiffrement et d'autres param√®tres techniques plus subtils. </font><font style="vertical-align: inherit;">La plupart d'entre eux sont unis par le concept de "liaison" (Reliure). </font><font style="vertical-align: inherit;">Le service WCF comporte trois param√®tres importants:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'adresse √† laquelle il est disponible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contraignant </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contrat (interfaces). </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous ces param√®tres sont d√©finis dans les fichiers de configuration du service et du client. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans notre entreprise, WCF (avec et sans transactions distribu√©es) est largement utilis√© dans les produits mis en ≈ìuvre, cependant, √©tant donn√© les tendances de la mode, son utilisation dans les nouveaux produits est toujours en question. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment lancer des transactions distribu√©es dans WCF</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Afin d'initier des transactions bas√©es dans WCF </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le programmeur doit d√©finir plusieurs attributs dans le code, s'assurer que les liaisons utilis√©es prennent en charge les transactions distribu√©es, qu'elles sont √©crites sur le client et dans le service, </font></font><code>transactionFlow="true"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et qu'un gestionnaire de transactions appropri√© s'ex√©cute sur tous les ordinateurs impliqu√©s (le plus probable , ce sera MSDTC).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liaisons de transactions distribu√©es: NetTcpBinding, NetNamedPipeBinding, WSHttpBinding, WSDualHttpBinding et WSFederationHttpBinding. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode (op√©ration) de l'interface de service doit √™tre marqu√©e d'un attribut </font></font><code>System.ServiceModel.TransactionFlowAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ensuite, avec certains param√®tres d'attribut et lors de la d√©finition du param√®tre d' </font></font><code>TransactionScopeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribut </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">la </font></font><code>System.ServiceModel.OperationBehaviorAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transaction sera r√©partie entre le client et le service. </font><font style="vertical-align: inherit;">De plus, par d√©faut, le service est consid√©r√© comme votant pour valider la transaction, sauf si une exception est lev√©e au moment de l'ex√©cution. </font><font style="vertical-align: inherit;">Pour modifier ce comportement, vous devez d√©finir la valeur de param√®tre d' </font></font><code>TransactionAutoComplete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribut </font><font style="vertical-align: inherit;">correspondante </font></font><code>System.ServiceModel.OperationBehaviorAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code d'un service WCF simple qui prend en charge les transactions distribu√©es.</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">System.ServiceModel.ServiceContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { [System.ServiceModel.OperationContract] [System.ServiceModel.TransactionFlow(System.ServiceModel.TransactionFlowOption.Mandatory)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyService</span></span> : <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { [System.ServiceModel.OperationBehavior(TransactionScopeRequired = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [System.ServiceModel.TransactionFlow(System.ServiceModel.TransactionFlowOption.Mandatory)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(input)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input.Length; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De toute √©vidence, il ne diff√®re du code de service normal que par l'utilisation de l'attribut </font></font><code>System.ServiceModel.TransactionFlow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et par le r√©glage sp√©cial de l'attribut </font></font><code>System.ServiceModel.OperationBehavior</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de configuration pour ce service.</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs">&lt;system.serviceModel&gt; &lt;services&gt; &lt;service name=<span class="hljs-string"><span class="hljs-string">"WcfWithTransactionsExample.MyService"</span></span> behaviorConfiguration=<span class="hljs-string"><span class="hljs-string">"serviceBehavior"</span></span>&gt; &lt;endpoint address=<span class="hljs-string"><span class="hljs-string">""</span></span> binding=<span class="hljs-string"><span class="hljs-string">"wsHttpBinding"</span></span> bindingConfiguration=<span class="hljs-string"><span class="hljs-string">"mainWsBinding"</span></span> contract=<span class="hljs-string"><span class="hljs-string">"WcfWithTransactionsExample.IMyService"</span></span>/&gt; &lt;endpoint address=<span class="hljs-string"><span class="hljs-string">"mex"</span></span> contract=<span class="hljs-string"><span class="hljs-string">"IMetadataExchange"</span></span> binding=<span class="hljs-string"><span class="hljs-string">"mexHttpBinding"</span></span>/&gt; &lt;/service&gt; &lt;/services&gt; &lt;bindings&gt; &lt;wsHttpBinding&gt; &lt;binding name=<span class="hljs-string"><span class="hljs-string">"mainWsBinding"</span></span> maxReceivedMessageSize=<span class="hljs-string"><span class="hljs-string">"209715200"</span></span> maxBufferPoolSize=<span class="hljs-string"><span class="hljs-string">"209715200"</span></span> transactionFlow=<span class="hljs-string"><span class="hljs-string">"true"</span></span> closeTimeout=<span class="hljs-string"><span class="hljs-string">"00:10:00"</span></span> openTimeout=<span class="hljs-string"><span class="hljs-string">"00:10:00"</span></span> receiveTimeout=<span class="hljs-string"><span class="hljs-string">"00:10:00"</span></span> sendTimeout=<span class="hljs-string"><span class="hljs-string">"00:10:00"</span></span>&gt; &lt;security mode=<span class="hljs-string"><span class="hljs-string">"None"</span></span>/&gt; &lt;readerQuotas maxArrayLength=<span class="hljs-string"><span class="hljs-string">"209715200"</span></span> maxStringContentLength=<span class="hljs-string"><span class="hljs-string">"209715200"</span></span>/&gt; &lt;/binding&gt; &lt;/wsHttpBinding&gt; &lt;/bindings&gt; &lt;/system.serviceModel&gt;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notez que la liaison est de type WSHttpBinding et l'attribut est utilis√© </font></font><code>transactionFlow="true"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br></div></div><br><a name="TLDR3"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Section TL; DR </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les transactions distribu√©es incluent plusieurs gestionnaires de ressources et toutes les modifications doivent √™tre valid√©es ou annul√©es. Certains SGBD modernes impl√©mentent des transactions distribu√©es qui fournissent un m√©canisme pratique pour connecter plusieurs bases de donn√©es. Les transactions distribu√©es par logiciel (non impl√©ment√©es dans le SGBD) peuvent inclure diff√©rentes combinaisons de gestionnaires de ressources sur diff√©rents ordinateurs ex√©cutant des syst√®mes d'exploitation diff√©rents, mais elles ont des limites qui doivent √™tre prises en compte avant de se fier √† elles. Les solutions de messagerie constituent une alternative moderne aux transactions distribu√©es. Dans .NET Core, les transactions distribu√©es ne sont pas encore prises en charge.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WCF est l'un des outils standard et √©prouv√©s de cr√©ation et d'acc√®s aux services dans le monde .NET, prenant en charge plusieurs types de transport et de chiffrement. </font><font style="vertical-align: inherit;">WCF est tr√®s proche des transactions distribu√©es bas√©es sur </font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La configuration des transactions distribu√©es pour WCF consiste √† baliser le code avec plusieurs attributs et √† ajouter quelques mots dans les fichiers de configuration du service et du client. </font><font style="vertical-align: inherit;">Toutes les liaisons WCF ne prennent pas en charge les transactions distribu√©es. </font><font style="vertical-align: inherit;">De plus, il est clair que les transactions dans WCF ont les m√™mes limitations que sans utiliser WCF. </font><font style="vertical-align: inherit;">Jusqu'√† pr√©sent, la plate-forme .NET Core vous permet uniquement d'acc√©der aux services sur WCF, plut√¥t que de les cr√©er.</font></font><br><br><a name="Conclusion"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lit d'enfant </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article est un aper√ßu des bases des transactions logicielles .NET. Certaines conclusions concernant les tendances des transactions de logiciels peuvent √™tre trouv√©es dans les sections sur l'applicabilit√© et les limites des sujets discut√©s, et en conclusion, les principales th√®ses de la publication sont rassembl√©es. Je suppose qu'ils peuvent √™tre utilis√©s comme une feuille de triche lorsque l'on consid√®re les transactions logicielles comme l'une des options pour la mise en ≈ìuvre d'un syst√®me technique ou pour actualiser les informations pertinentes en m√©moire. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transactions (domaine, SGBD, logiciels)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les exigences de domaine sont parfois formul√©es sous la forme de transactions - op√©rations qui, commen√ßant dans le domaine des donn√©es int√©grales, une fois termin√©es (y compris infructueuses) devraient √©galement entrer dans le domaine des donn√©es int√©grales (√©ventuellement d√©j√† diff√©rentes). Ces exigences sont g√©n√©ralement impl√©ment√©es en tant que transactions syst√®me. Un exemple classique de transaction est le transfert d'argent entre deux comptes, consistant en deux op√©rations indivisibles - retirer de l'argent d'un compte et cr√©diter un autre. En plus des transactions bien connues impl√©ment√©es par le SGBD, il existe √©galement des transactions logicielles, par exemple, dans le monde .NET. Les gestionnaires de ressources sont des composants logiciels qui sont conscients de l'existence de telles transactions et peuvent y √™tre inclus, c'est-√†-dire valider ou annuler les modifications apport√©es.Les gestionnaires de ressources re√ßoivent des instructions sur la validation et l'annulation des modifications du gestionnaire de transactions, qui est le fondement de l'infrastructure</font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestionnaires de ressources durables et intermittents.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les gestionnaires de ressources √† long terme prennent en charge la r√©cup√©ration de donn√©es apr√®s une d√©faillance du syst√®me. Les pilotes de SGBD pour .NET offrent g√©n√©ralement de telles fonctionnalit√©s. Les gestionnaires de ressources intermittents </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prennent </font><b><font style="vertical-align: inherit;">pas en</font></b><font style="vertical-align: inherit;"> charge la reprise apr√®s sinistre. La m√©moire transactionnelle programmatique - un moyen de g√©rer des objets en RAM - peut √™tre consid√©r√©e comme un exemple de gestionnaire de ressources volage. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transactions et gestionnaires de ressources .NET.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le programmeur .NET utilise des transactions logicielles et cr√©e ses propres gestionnaires de ressources √† l'aide de types de l'espace de noms</font></font><code>System.Transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette infrastructure permet d'utiliser des transactions d'imbrication et d'isolement diverses (avec des limitations connues). L'utilisation des transactions n'est pas compliqu√©e, et elle consiste √† encapsuler le code dans un bloc </font></font><code>using</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec certaines caract√©ristiques. Cependant, les gestionnaires de ressources inclus de cette mani√®re dans la transaction doivent conserver pour leur part les fonctionnalit√©s requises. L'utilisation de gestionnaires de ressources h√©t√©rog√®nes dans une transaction ou l'utilisation d'un gestionnaire de diff√©rentes mani√®res peut automatiquement transformer une transaction en transaction distribu√©e. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transactions distribu√©es (SGBD, logiciels).</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une transaction distribu√©e couvre plusieurs sous-syst√®mes, dont les changements doivent √™tre synchronis√©s, c'est-√†-dire qu'ils sont soit valid√©s tous ensemble, soit annul√©s. Les transactions distribu√©es sont impl√©ment√©es dans certains SGBD modernes. Les transactions distribu√©es par logiciel (ce ne sont pas celles qui sont impl√©ment√©es par le SGBD) imposent des restrictions suppl√©mentaires sur les processus et les plates-formes en interaction. Les transactions distribu√©es se d√©gradent progressivement pour laisser place √† des solutions bas√©es sur les services de messagerie. Pour transformer une transaction ordinaire en transaction distribu√©e, le programmeur n'a rien √† faire: lorsqu'un gestionnaire de ressources avec certaines caract√©ristiques est inclus dans la transaction au moment de l'ex√©cution, le gestionnaire de transaction fera automatiquement tout ce qu'il faut. Les transactions logicielles r√©guli√®res sont disponibles dans .NET Core et .NET Standard, et les transactions distribu√©es ne sont pas disponibles.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transactions distribu√©es via WCF. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WCF est l'un des outils .NET standard pour cr√©er et appeler des services, qui prend √©galement en charge des protocoles standardis√©s. </font><font style="vertical-align: inherit;">En d'autres termes, les services WCF configur√©s d'une mani√®re sp√©cifique sont accessibles √† partir de n'importe quelle application, pas seulement .NET ou Windows. </font><font style="vertical-align: inherit;">Pour cr√©er une transaction distribu√©e au-dessus de WCF, vous devez baliser les types qui composent le service avec des attributs suppl√©mentaires et apporter des modifications minimales aux fichiers de configuration du service et du client. </font><font style="vertical-align: inherit;">Vous ne pouvez pas cr√©er de services WCF dans .NET Core et .NET Standard, mais vous pouvez cr√©er des clients WCF. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de v√©rification de System.Transactions sur GitHub</font></font></a> <br><br><div class="spoiler">  <b class="spoiler_title">Les r√©f√©rences</b> <div class="spoiler_text"><h4>  Concepts de base </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ACID</a> ( ¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ( Microsoft) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ( Microsoft) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ( ¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ( ¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ( ¬´¬ª) <br><br><h4>     </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   X/Open XA</a> ( The Open Group) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java Transaction API</a> ( ¬´¬ª) <br> <a href="">     Cache</a> (  InterSystems) <br><br><h4>   .NET </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   .NET</a> (   Tech Blog Collection) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     TransactionScope</a> (¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  ,     </a> ( Microsoft) <br> <a href="">   .NET Standard 2.0</a> ( .NET Standard  GitHub) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">       </a> ( YarFullStack) <br><br><h4>    </h4><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     </a> (¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     </a> (¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    ¬´¬ª     </a> (¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     ¬´¬ª  </a> (¬´¬ª) <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    </a> (¬´¬ª) <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âditorial</font></font></b> <div class="spoiler_text"><ul><li> 20.12.2018 . </li><li> 21.12.2018  .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">OlegAxenow</a> . </li><li> 23.12.2018      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">qw1</a> . </li></ul><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433136/">https://habr.com/ru/post/fr433136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433122/index.html">React-Hot-Loader v4.6</a></li>
<li><a href="../fr433126/index.html">Revue Zabbix: Comment organiser une revue de code pour surveiller la configuration</a></li>
<li><a href="../fr433128/index.html">Ce que les professionnels de l'informatique jouent et ne jouent pas (Bulletin 2018)</a></li>
<li><a href="../fr433130/index.html">Que la force soit avec nous: notre propre immunit√© contre le cancer</a></li>
<li><a href="../fr433132/index.html">"Calendrier des testeurs" pour d√©cembre. Essayez une approche diff√©rente</a></li>
<li><a href="../fr433138/index.html">Cinq principes de conception de produits lors de la r√©servation</a></li>
<li><a href="../fr433140/index.html">Module client Google Pay pr√™t</a></li>
<li><a href="../fr433142/index.html">Des classiques intemporels ou un aper√ßu des nouveaux vecteurs d'attaque via Microsoft Office</a></li>
<li><a href="../fr433144/index.html">Sortie de .NET Core 2.2. Quoi de neuf (1 sur 3)</a></li>
<li><a href="../fr433146/index.html">[comp√©tition] Top 25 des consoles de jeux (secouez les temps anciens)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>