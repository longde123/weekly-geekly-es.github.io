<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèº üßëüèø‚Äçü§ù‚Äçüßëüèº üëèüèø Implementaci√≥n de la plantilla de estado en Unity ‚è∫Ô∏è ü§ñ ü§ûüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el proceso de programaci√≥n de entidades en el juego, surgen situaciones en las que deben actuar en diferentes condiciones de diferentes maneras, lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementaci√≥n de la plantilla de estado en Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484176/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png" alt="imagen"></div><br>  En el proceso de programaci√≥n de entidades en el juego, surgen situaciones en las que deben actuar en diferentes condiciones de diferentes maneras, lo que sugiere el uso de <i>estados</i> . <br><br>  Pero si decide usar la fuerza bruta, el c√≥digo se convertir√° r√°pidamente en un caos enredado con muchas declaraciones if-else anidadas. <br><br>  Para una soluci√≥n elegante a este problema, puede usar el patr√≥n de dise√±o de estado.  ¬°Le dedicaremos este tutorial! <br><br>  Del tutorial usted: <br><br><ul><li>  Aprenda los conceptos b√°sicos de la plantilla de estado en Unity. </li><li>  Aprender√° qu√© es una m√°quina de estado y cu√°ndo usarla. </li><li>  Aprende a usar estos conceptos para controlar el movimiento de tu personaje. </li></ul><br><blockquote>  <em>Nota</em> : este tutorial es para usuarios avanzados;  se asume que ya sabe c√≥mo trabajar en Unity y tiene un nivel promedio de conocimiento de C #.  Adem√°s, este tutorial utiliza Unity 2019.2 y C # 7. </blockquote><a name="habracut"></a><br><h2>  Llegar al trabajo </h2><br>  Descargar <a href="">materiales del proyecto</a> .  Descomprima el <em>archivo zip</em> y abra el proyecto de <em>inicio</em> en Unity. <br><br>  Hay varias carpetas en el proyecto que lo ayudar√°n a comenzar.  La carpeta <em>Assets / RW</em> contiene las carpetas <em>Animaciones</em> , <em>Materiales</em> , <em>Modelos</em> , <em>Prefabs</em> , <em>Recursos</em> , <em>Escenas</em> , <em>Scripts</em> y <em>Sonidos</em> , nombrados de acuerdo con los recursos que contienen. <br><br>  Para completar el tutorial, trabajaremos solo con <em>escenas</em> y <em>guiones</em> . <br><br>  Vaya a <em>RW / Scenes</em> y abra <em>Main</em> .  En el modo Juego, ver√°s un personaje en una capucha dentro de un castillo medieval. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/478/f1b/4e1/478f1b4e1ec3a2e8702e365e4082a605.png"></div><br>  Haga clic en <em>Reproducir</em> y observe c√≥mo se mueve la <em>c√°mara</em> para ajustarse al marco del <em>personaje</em> .  Por el momento, en nuestro peque√±o juego no hay interacciones, trabajaremos en ellas en el tutorial. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/62c/536/ba362c53682371294f90576b5fd5adc6.gif"></div><br><h2>  Explora el personaje </h2><br>  En la <em>jerarqu√≠a,</em> seleccione <em>Car√°cter</em> .  Echa un vistazo al <em>inspector</em> .  Ver√° un <em>componente</em> con el mismo nombre que contiene la l√≥gica de control de <em>caracteres</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/ffd/2ba/957ffd2ba0299d4b509b75bedb094581.png"></div><br>  Abra <em>Character.cs</em> ubicado en <em>RW / Scripts</em> . <br><br>  El script realiza muchas acciones, pero la mayor√≠a de ellas no son importantes para nosotros.  Por ahora, prestemos atenci√≥n a los siguientes m√©todos. <br><br><ul><li> <code>Move</code> : mueve el personaje, recibiendo valores de tipo <code>speed</code> flotaci√≥n como la velocidad de movimiento y <code>rotationSpeed</code> Velocidad como la velocidad angular. </li><li>  <code>ResetMoveParams</code> : este m√©todo restablece los par√°metros utilizados para <i>animar el movimiento</i> y la velocidad angular del personaje.  Se usa solo para limpiar. </li><li>  <code>SetAnimationBool</code> : establece el par√°metro de animaci√≥n <code>param</code> de tipo Bool en valor. </li><li>  <code>CheckCollisionOverlap</code> : recibe un <code></code> tipo <code>Vector3</code> y devuelve un <code>bool</code> que determina si hay colisionadores dentro del radio especificado desde el <code></code> . </li><li>  <code>TriggerAnimation</code> : <code>TriggerAnimation</code> el par√°metro de animaci√≥n del par√°metro de entrada. </li><li>  <code>ApplyImpulse</code> : <code>ApplyImpulse</code> pulso al car√°cter igual a la <code>force</code> par√°metro de entrada <code>force</code> tipo <code>Vector3</code> . </li></ul><br>  A continuaci√≥n ver√° estos m√©todos.  En nuestro tutorial, sus contenidos y trabajo interno no son importantes. <br><br><h2>  ¬øQu√© son las m√°quinas de estado? </h2><br>  Una m√°quina de estados es un concepto en el que un contenedor almacena el estado de algo en un momento dado en el tiempo.  Basado en los datos de entrada, puede proporcionar una conclusi√≥n dependiendo del estado actual, pasando este proceso a un nuevo estado.  Las m√°quinas de estado se pueden representar como un <a href="https://www.geeksforgeeks.org/unified-modeling-language-uml-state-diagrams/" rel="noopener">diagrama de estado</a> .  La preparaci√≥n de un diagrama de estado le permite pensar en todos los estados posibles del sistema y las transiciones entre ellos. <br><br><h3>  M√°quinas de estado </h3><br>  <em>Las m√°quinas de estado finito</em> o <em>FSM (m√°quina de estado finito)</em> es una de las cuatro familias principales de <em>m√°quinas</em> .  Los aut√≥matas son modelos abstractos de m√°quinas simples.  Se estudian en el marco de la <a href="https://cs.stanford.edu/people/eroberts/courses/soco/projects/2004-05/automata-theory/basics.html" rel="noopener"><em>teor√≠a de los aut√≥matas</em></a> , la rama te√≥rica de la inform√°tica. <br><br>  En pocas palabras: <br><br><ul><li>  FSM consiste en una cantidad finita de <em>condici√≥n</em> .  En un momento dado <em>,</em> solo uno de estos estados est√° <em>activo</em> . </li><li>  Cada estado determina en qu√© estado entrar√° como <em>salida en</em> funci√≥n de la secuencia recibida de <em>informaci√≥n entrante</em> . </li><li>  El estado de salida se convierte en el nuevo estado activo.  En otras palabras, hay una <em>transici√≥n entre estados</em> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/111/f04/c43111f045f3727ab5f3b02c05c6ecc2.png"></div><br>  Para comprender mejor esto, considere el car√°cter de un juego de plataformas que est√° en el terreno.  El personaje est√° en el estado de <i>pie</i> .  Este ser√° su <em>estado activo</em> hasta que el jugador presione el bot√≥n para que el personaje salte. <br><br>  El estado <i>Permanente</i> identifica una pulsaci√≥n de bot√≥n como una <em>entrada</em> importante y, como <em>salida</em> , cambia al estado de <i>Salto</i> . <br><br>  Supongamos que hay un cierto n√∫mero de tales estados de movimiento y un personaje solo puede estar en uno de los estados a la vez.  Este es un ejemplo de FSM. <br><br><h3>  M√°quinas de estado jer√°rquico </h3><br>  Considere un juego de plataformas con FSM, en el que varios estados comparten una l√≥gica f√≠sica com√∫n.  Por ejemplo, puede moverse y saltar en los estados <em>agachado</em> y de <em>pie</em> .  En este caso, varias variables entrantes conducen al mismo comportamiento y salida de informaci√≥n para dos estados diferentes. <br><br>  En tal situaci√≥n, ser√≠a l√≥gico delegar el comportamiento general a alg√∫n otro estado.  Afortunadamente, esto se puede lograr utilizando m√°quinas de estado <em>jer√°rquicas</em> . <br><br>  En un FSM jer√°rquico, hay <em>subestados</em> que <em>delegan</em> informaci√≥n entrante sin <i>procesar</i> a sus <em>subestados</em> .  Esto a su vez le permite reducir con gracia el tama√±o y la complejidad de la FSM, manteniendo su l√≥gica. <br><br><h2>  Plantilla de estado </h2><br>  En su libro <i>Design Patterns: Elements of Reusable Object-Oriented Software,</i> Erich Gamma, Richard Helm, Ralph Johnson y John Vlissidis ( <em>The Gang of Four</em> ) definieron la <i>tarea</i> de la plantilla del Estado de la siguiente manera: <br><br>  ‚ÄúDebe permitir que el objeto cambie su comportamiento cuando cambia su estado interno.  En este caso, parecer√° que el objeto ha cambiado su clase ". <br><br>  Para comprender mejor esto, considere el siguiente ejemplo: <br><br><ul><li>  Un script que recibe informaci√≥n entrante para la l√≥gica del movimiento se adjunta a una entidad en el juego. </li><li>  Esta clase almacena una variable de <i>estado actual</i> que simplemente se refiere a una instancia de la clase de <i>estado</i> . </li><li>  La informaci√≥n entrante se delega a este estado actual, que la procesa y crea un comportamiento definido dentro de s√≠ mismo.  Tambi√©n maneja las transiciones de estado requeridas. </li></ul><br>  Por lo tanto, debido al hecho de que en diferentes momentos la variable de <i>estado actual se</i> refiere a diferentes estados, parecer√° que la misma clase de script se comporta de manera diferente.  Esta es la esencia de la plantilla de "Estado". <br><br>  En nuestro proyecto, la clase de <em>personaje</em> antes mencionada se comportar√° de manera diferente dependiendo de los diferentes estados.  ¬°Pero necesitamos que se comporte! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/d20/f59/3d8d20f5921bf342b2ac84b5677e9a3b.png"></div><br>  En el caso general, hay tres puntos clave para cada clase de estado que permiten el comportamiento del estado en su conjunto: <br><br><ul><li>  <em>Entrada</em> : este es el momento en que una entidad ingresa a un estado y realiza acciones que deben realizarse solo una vez al ingresar al estado. </li><li>  <em>Salida</em> : similar a la entrada: todas las operaciones de reinicio se realizan aqu√≠, que deben realizarse solo antes de que cambie el estado. </li><li>  <em>Update Loop</em> : Aqu√≠ est√° la <i>l√≥gica</i> b√°sica de <i>actualizaci√≥n</i> que se ejecuta en cada cuadro.  Se puede dividir en varias partes, por ejemplo, un ciclo para actualizar la f√≠sica y un ciclo para procesar la entrada del jugador. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/847/8e6/a268478e6da2566cc58d1083fefed27f.png"></div><br><h3>  Definir un estado y una m√°quina de estados </h3><br>  Vaya a <em>RW / Scripts</em> y abra <em>StateMachine.cs</em> . <br><br>  <em>La m√°quina de estado</em> , como puede suponer, proporciona una abstracci√≥n para la m√°quina de estado.  Tenga en cuenta que <code>CurrentState</code> ubicado correctamente dentro de esta clase.  Almacenar√° un enlace al estado actual activo de la m√°quina de estado. <br><br>  Ahora, para definir el concepto del <i>estado</i> , vayamos a <em>RW / Scripts</em> y abramos el script <em>State.cs</em> en el IDE. <br><br>  <em>El estado</em> es una clase abstracta que usaremos como <i>modelo</i> del cual se derivan todas las <i>clases de estados del</i> proyecto.  Parte del c√≥digo en los materiales del proyecto ya est√° listo. <br><br>  <code>DisplayOnUI</code> solo muestra el nombre del estado actual en la IU en pantalla.  No es necesario que conozca su estructura interna, solo comprenda que recibe un enumerador de tipo <code>UIManager.Alignment</code> como par√°metro de entrada, que puede ser <code>Left</code> o <code>Right</code> .  La visualizaci√≥n del nombre del estado en la parte inferior izquierda o derecha de la pantalla depende de ello. <br><br>  Adem√°s, hay dos variables protegidas, <code>character</code> y <code>stateMachine</code> .  La variable de <code>character</code> refiere a una instancia de la clase <em>Character</em> , y <code>stateMachine</code> refiere a una instancia <em>de la m√°quina de estados</em> asociada con el estado. <br><br>  Al crear una instancia de estado, el constructor enlaza <code>character</code> y <code>stateMachine</code> . <br><br>  Cada una de las muchas instancias de <code>Character</code> en una escena puede tener su propio conjunto de estados y m√°quinas de estados. <br><br>  Ahora agregue los siguientes m√©todos a <em>State.cs</em> y guarde el archivo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DisplayOnUI(UIManager.Alignment.Left); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br>  Estos m√©todos virtuales definen los puntos de estado clave descritos anteriormente.  Cuando <em>la m√°quina de estados</em> realiza una transici√≥n entre estados, llamamos a <code>Exit</code> para el estado anterior e <code>Enter</code> nuevo <i>estado activo</i> . <br><br>  <code>HandleInput</code> , <code>LogicUpdate</code> y <code>PhysicsUpdate</code> juntos definen <i>un ciclo de actualizaci√≥n</i> .  <code>HandleInput</code> maneja la entrada del jugador.  <code>LogicUpdate</code> procesa l√≥gica b√°sica, mientras que <code>PhyiscsUpdate</code> procesa <code>PhyiscsUpdate</code> l√≥gica y f√≠sica. <br><br>  Ahora abra <em>StateMachine.cs</em> nuevamente, agregue los siguientes m√©todos y guarde el archivo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State startingState</span></span></span><span class="hljs-function">)</span></span> { CurrentState = startingState; startingState.Enter(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State newState</span></span></span><span class="hljs-function">)</span></span> { CurrentState.Exit(); CurrentState = newState; newState.Enter(); }</code> </pre> <br>  <code>Initialize</code> configura la m√°quina de estado estableciendo <code>CurrentState</code> en <code>startingState</code> y llamando a <code>Enter</code> para ello.  Esto inicializa la m√°quina de estado, por primera vez configurando el estado activo. <br><br>  <code>ChangeState</code> maneja <em>las</em> transiciones de <em>estado</em> .  Llama a <code>Exit</code> para el <code>CurrentState</code> anterior antes de reemplazar su referencia con <code>newState</code> .  Al final, llama a <code>Enter</code> para <code>newState</code> . <br><br>  Por lo tanto, configuramos el <em>estado</em> y <em>la m√°quina de estados</em> . <br><br><h3>  Crear estados de movimiento </h3><br>  Echa un vistazo al siguiente diagrama de estado, que muestra los diferentes <i>estados de movimiento de la</i> esencia <i>del</i> jugador en el juego.  En esta secci√≥n, implementamos la plantilla "Estado" para el <i>movimiento que se</i> muestra en la figura <i>FSM</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png"></div><br>  Preste atenci√≥n a los estados de movimiento, es decir, de <em>pie</em> , <em>agach√°ndose</em> y <em>saltando</em> , as√≠ como a c√≥mo los datos entrantes provocan transiciones entre los estados.  Este es un FSM jer√°rquico en el que <em>Grounded</em> es un <em>subestado</em> para los <em>subestados Ducking</em> y <em>Standing</em> . <br><br>  Regrese a Unity y vaya a <em>RW / Scripts / States</em> .  All√≠ encontrar√° varios archivos C # con nombres que terminan en <i>Estado</i> . <br><br>  Cada uno de estos archivos define una clase, cada una de las cuales se hereda de <code>State</code> .  Por lo tanto, estas clases definen los estados que utilizaremos en el proyecto. <br><br>  Ahora abra <em>Character.cs</em> desde la carpeta <em>RW / Scripts</em> . <br><br>  Despl√°cese sobre el archivo <code>#region Variables</code> y agregue el siguiente c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StateMachine movementSM; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StandingState standing; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DuckingState ducking; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> JumpingState jumping;</code> </pre> <br>  Este <code>movementSM</code> refiere a una m√°quina de estados que procesa la l√≥gica de movimiento para la instancia de <code>Character</code> .  Tambi√©n agregamos enlaces a tres estados que implementamos para cada tipo de movimiento. <br><br>  Vaya a <code>#region MonoBehaviour Callbacks</code> en el mismo archivo.  Agregue los siguientes m√©todos <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" rel="noopener">MonoBehaviour</a> y luego guarde <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateMachine(); standing = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); ducking = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DuckingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); jumping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JumpingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); movementSM.Initialize(standing); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.HandleInput(); movementSM.CurrentState.LogicUpdate(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.PhysicsUpdate(); }</code> </pre> <br><ul><li>  En <code>Start</code> c√≥digo crea una instancia de la <em>M√°quina de estado</em> y la asigna a <code>movementSM</code> , y tambi√©n crea una instancia de varios estados de movimiento.  Al crear cada uno de los estados de movimiento, pasamos referencias a la instancia de <code>Character</code> utilizando la <code>this</code> , as√≠ como la instancia de motionSM.  Al final, llamamos <code>Initialize</code> para <code>movementSM</code> y pasamos <code>Standing</code> como estado inicial. </li><li>  En el m√©todo de <code>Update</code> , llamamos a <code>HandleInput</code> y <code>LogicUpdate</code> para <code>LogicUpdate</code> de la m√°quina <code>movementSM</code> .  Del mismo modo, en <code>FixedUpdate</code> llamamos a <code>PhysicsUpdate</code> para el <code>CurrentState</code> de la m√°quina <code>movementSM</code> .  En esencia, esto delega tareas a un estado activo;  Este es el significado de la plantilla "Estado". </li></ul><br>  Ahora necesitamos establecer el comportamiento dentro de cada uno de los estados de movimiento.  Prep√°rate, ¬°habr√° mucho c√≥digo! <br><br><h3>  Firmeza permanente </h3><br>  Regrese a <em>RW / Scripts / States</em> en la ventana Proyecto. <br><br>  Abra <em>Grounded.cs</em> y observe que esta clase tiene un constructor que coincide con el constructor <code>State</code> .  Esto es l√≥gico porque esta clase hereda de ella.  Ver√° lo mismo en todas las dem√°s clases de <i>estado</i> . <br><br>  Agregue el siguiente c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); horizontalInput = verticalInput = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.ResetMoveParams(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); verticalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); horizontalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); character.Move(verticalInput * speed, horizontalInput * rotationSpeed); }</code> </pre> <br>  Esto es lo que pasa aqu√≠: <br><br><ul><li>  Redefinimos uno de los m√©todos virtuales definidos en la clase padre.  Para preservar toda la funcionalidad que puede existir en el padre, llamamos al m√©todo <code>base</code> con el mismo nombre de cada m√©todo anulado.  Esta es una plantilla importante que continuaremos usando. </li><li>  La siguiente l√≠nea, <code>Enter</code> establece <code>horizontalInput</code> y <code>verticalInput</code> sus valores predeterminados. </li><li>  Dentro de <code>Exit</code> nosotros, como se mencion√≥ anteriormente, llamamos al m√©todo <code>ResetMoveParams</code> <code></code> para restablecerlo cuando se cambia a otro estado. </li><li>  En el m√©todo <code>HandleInput</code> , las variables <code>horizontalInput</code> y <code>verticalInput</code> <code>HandleInput</code> valores de los ejes de entrada horizontal y vertical.  Gracias a esto, el jugador puede controlar al personaje usando las teclas <em>W</em> , <em>A</em> , <em>S</em> y <em>D.</em> </li><li>  En <code>PhysicsUpdate</code> realizamos una llamada <code>Move</code> , pasando las variables <code>horizontalInput</code> y <code>verticalInput</code> multiplicadas por las velocidades correspondientes.  En la <code>speed</code> variable <code>speed</code> la velocidad de movimiento se almacena, y en velocidad de <code>rotationSpeed</code> , la velocidad angular. </li></ul><br>  Ahora abra <em>Standing.cs</em> y preste atenci√≥n al hecho de que hereda de <code>Grounded</code> .  Sucedi√≥ porque, como dijimos anteriormente, <em>Standing</em> es un subestado para <em>Grounded</em> .  Hay diferentes formas de implementar esta relaci√≥n, pero en este tutorial usamos la herencia. <br><br>  Agregue los siguientes m√©todos de <code>override</code> y guarde el script: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); speed = character.MovementSpeed; rotationSpeed = character.RotationSpeed; crouch = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; jump = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouch = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); jump = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Jump"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (crouch) { stateMachine.ChangeState(character.ducking); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jump) { stateMachine.ChangeState(character.jumping); } }</code> </pre> <br><ul><li>  En <code>Enter</code> configuramos las variables heredadas de <code>Grounded</code> .  Aplica la <code>speed</code> <code>MovementSpeed</code> y <code>RotationSpeed</code> <code>speed</code> <code>RotationSpeed</code> personaje a la <code>speed</code> y <code>speed</code> <code>rotationSpeed</code> .  Luego se relacionan, respectivamente, con la velocidad <i>normal</i> de movimiento y la velocidad angular destinada a la esencia del personaje. <br><br>  Adem√°s, las variables para almacenar la entrada de <code>crouch</code> y <code>jump</code> se restablecen a falso. </li><li>  Dentro de <code>HandleInput</code> , las variables <code>crouch</code> y <code>jump</code> almacenan la entrada del jugador para las sentadillas y saltos.  Si en la escena Principal el jugador presiona la <em>tecla May√∫s, la posici√≥n en</em> cuclillas se establece en verdadera.  Del mismo modo, un jugador puede usar la tecla <em>Espacio</em> para <code>jump</code> . </li><li>  En <code>LogicUpdate</code> verificamos las variables <code>LogicUpdate</code> y <code>jump</code> de tipo <code>bool</code> .  Si <code>crouch</code> es verdadero, entonces <code>movementSM.CurrentState</code> cambia a <code>character.ducking</code> .  Si <code>jump</code> es verdadero, el estado cambia a <code>character.jumping</code> . </li></ul><br>  Guarde y ensamble el proyecto, luego haga clic en <em>Reproducir</em> .  Puede moverse por la escena con las teclas <em>W</em> , <em>A</em> , <em>S</em> y <em>D.</em>  Si intenta presionar <em>May√∫s</em> o <em>Barra</em> <em>espaciadora</em> , se producir√° un comportamiento inesperado, porque los estados correspondientes a√∫n no est√°n implementados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/89a/564/45089a5640a8d492b20ac5948e0fdf69.gif"></div><br>  Intenta moverte debajo de los objetos de la mesa.  Ver√°s que, debido a la altura del colisionador del personaje, esto no es posible.  Para que el personaje haga esto, debes agregar un comportamiento en cuclillas. <br><br><h3>  Subimos debajo de la mesa </h3><br>  Abra el script <em>Ducking.cs</em> .  Tenga en cuenta que <code>Ducking</code> tambi√©n hereda de la clase <code>Grounded</code> por los mismos motivos que <code>Standing</code> .  Agregue los siguientes m√©todos de <code>override</code> y guarde el script: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); speed = character.CrouchSpeed; rotationSpeed = character.CrouchRotationSpeed; character.ColliderSize = character.CrouchColliderHeight; belowCeiling = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); character.ColliderSize = character.NormalColliderHeight; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouchHeld = Input.GetButton(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(crouchHeld || belowCeiling)) { stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); belowCeiling = character.CheckCollisionOverlap(character.transform.position + Vector3.up * character.NormalColliderHeight); }</code> </pre> <br><ul><li>  Dentro de <code>Enter</code> par√°metro que provoca que la animaci√≥n de sentadilla se active se pone en cuclillas, lo que permite la animaci√≥n de sentadilla.  Las propiedades <code>character.CrouchSpeed</code> y <code>character.CrouchRotationSpeed</code> tienen asignados los valores de <code>speed</code> y <code>rotation</code> , que devuelven el movimiento del personaje y la velocidad angular cuando se <i>mueve en cuclillas</i> . <br><br>  Siguiente <code>character.CrouchColliderHeight</code> CrouchColliderHeight establece el tama√±o del colisionador del personaje, que devuelve la altura deseada del colisionador cuando se pone en cuclillas.  Al final, <code>belowCeiling</code> restablece a falso. </li><li>  Dentro de <code>Exit</code> el par√°metro de animaci√≥n en cuclillas se establece en falso.  Esto deshabilita la animaci√≥n en cuclillas.  Luego se establece la altura normal del colisionador, devuelta por <code>character.NormalColliderHeight</code> . </li><li>  Dentro de <code>HandleInput</code> variable <code>crouchHeld</code> establece el valor de entrada del reproductor.  En la escena <em>Principal</em> , mantener <em>Shift</em> establece <code>crouchHeld</code> en verdadero. </li><li>  Dentro de <code>PhysicsUpdate</code> variable <code>belowCeiling</code> asigna un valor al pasar un punto en formato <code>Vector3</code> con la cabeza del objeto del juego del personaje al m√©todo <code>CheckCollisionOverlap</code> .  Si hay una colisi√≥n cerca de este punto, esto significa que el personaje est√° bajo alg√∫n tipo de techo. </li><li>  Internamente, <code>LogicUpdate</code> comprueba si <code>crouchHeld</code> o <code>belowCeiling</code> es verdadero.  Si ninguno de ellos es cierto, entonces <code>movementSM.CurrentState</code> cambia a <code>character.standing</code> . </li></ul><br>  Construye el proyecto y haz clic en <em>Reproducir</em> .  Ahora puedes moverte por la escena.  Si presionas <em>Shift</em> , el personaje se sentar√° y podr√°s moverte en la sentadilla. <br><br>  Tambi√©n puedes subir debajo de la plataforma.  Si sueltas <em>Shift</em> mientras est√°s debajo de las plataformas, el personaje seguir√° en cuclillas hasta que abandone su refugio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee4/dce/657/ee4dce657ae6be49244106652a168a3a.gif"></div><br><h3>  ¬°Alzate! </h3><br>  Open <em>Jumping.cs</em> .  Ver√° un m√©todo llamado <code>Jump</code> .  No te preocupes por c√≥mo funciona;  es suficiente entender que se usa para que el personaje pueda saltar teniendo en cuenta la f√≠sica y la animaci√≥n. <br><br>  Ahora agregue los m√©todos de <code>override</code> habituales y guarde el script <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); SoundManager.Instance.PlaySound(SoundManager.Instance.jumpSounds); grounded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Jump(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (grounded) { character.TriggerAnimation(landParam); SoundManager.Instance.PlaySound(SoundManager.Instance.landing); stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); grounded = character.CheckCollisionOverlap(character.transform.position); }</code> </pre> <br><ul><li>  Dentro de <code>Enter</code> Singleton <code>SoundManager</code> reproduce el sonido del salto.  Luego a <code>grounded</code> restablece a su valor predeterminado.  Al final, se llama <code>Jump</code> . </li><li>  Dentro de <code>PhysicsUpdate</code> punto <code>PhysicsUpdate</code> al lado de las piernas del personaje se env√≠a a <code>CheckCollisionOverlap</code> , lo que significa que cuando el personaje est√° en el suelo, <code>grounded</code> se establecer√° en verdadero. </li><li>  En <code>LogicUpdate</code> , si la <code>grounded</code> es verdadera, llamamos a <code>TriggerAnimation</code> para habilitar la animaci√≥n de la toma de contacto, se reproduce el sonido de la toma de contacto y el <code>movementSM.CurrentState</code> cambia a <code>character.standing</code> . </li></ul><br>  Entonces, en esto hemos completado la implementaci√≥n completa del desplazamiento FSM utilizando <em>la plantilla "Estado"</em> .  Construye el proyecto y ejec√∫talo.  Presiona <em>la</em> barra <em>espaciadora</em> para hacer que el personaje salte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/e16/05d/ebde1605dc739588529c51509e19c0a8.gif"></div><br><h2>  ¬øA d√≥nde ir despu√©s? </h2><br>  Los <a href="">materiales del proyecto</a> tienen un proyecto borrador y un proyecto terminado. <br><br>  A pesar de su utilidad, las m√°quinas de estado tienen limitaciones.  Las m√°quinas de estado concurrente y las m√°quinas Pushdown Automaton pueden manejar algunas de estas limitaciones.  Puedes leer sobre ellos en el libro de Robert Nystrom <a href="https://gameprogrammingpatterns.com/state.html" rel="noopener"><em>Game Programming Patterns</em></a> . <br><br>  Adem√°s, el tema se puede explorar m√°s profundamente al examinar los <a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)" rel="noopener"><em>√°rboles de comportamiento</em></a> utilizados para crear entidades m√°s complejas en el juego. </div></div><p>Source: <a href="https://habr.com/ru/post/484176/">https://habr.com/ru/post/484176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../484168/index.html">Escribimos nuestra estrategia para el desplazamiento virtual desde Angular CDK</a></li>
<li><a href="../484170/index.html">Actualizar punto de control de R77.30 a 80.20</a></li>
<li><a href="../484172/index.html">Integraci√≥n continua en Unity: c√≥mo reducir el tiempo de montaje y ahorrar recursos + l√≠nea de pago como regalo</a></li>
<li><a href="../484174/index.html">Castle bebe en condiciones "extremas" o c√≥mo participamos en el espect√°culo "DOZOR"</a></li>
<li><a href="../484178/index.html">Conmutador Ethernet inteligente para el planeta Tierra</a></li>
<li><a href="../484180/index.html">PBX virtual Rostelecom: qu√© y c√≥mo se puede hacer a trav√©s de la API</a></li>
<li><a href="../484182/index.html">Xenobots: nanorobots vivos de c√©lulas de rana</a></li>
<li><a href="../484186/index.html">LDAP - "autenticaci√≥n" es un antipatr√≥n</a></li>
<li><a href="../484188/index.html">Est√°ndares de dise√±o de bases de datos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>