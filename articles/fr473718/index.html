<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéØ ‚úâÔ∏è üçî Comment ajouter des ch√®ques √† NoVerify sans √©crire une seule ligne de code Go üêπ ü•® üë©üèº‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une fonctionnalit√© de tueur est apparue dans l'analyseur statique NoVerify : une fa√ßon d√©clarative de d√©crire les inspections qui ne n√©cessitent pas d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment ajouter des ch√®ques √† NoVerify sans √©crire une seule ligne de code Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/473718/"><p>  Une fonctionnalit√© de tueur est apparue dans l'analyseur statique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NoVerify</a> : une fa√ßon d√©clarative de d√©crire les inspections qui ne n√©cessitent pas de programmation Go ni de compilation de code. </p><br><p>  Pour vous intriguer, je vais vous montrer une description d'une inspection simple mais utile: </p><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> duplicated sub-expressions inside boolean expression */</span></span> $x &amp;&amp; $x;</code> </pre> <br><p>  Cette inspection trouve toutes les expressions logiques <code>&amp;&amp;</code> o√π les op√©randes gauche et droit sont identiques. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NoVerify</a> est un analyseur statique pour PHP √©crit en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Go</a> .  Vous pouvez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lire</a> dans l'article ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NoVerify: Linter pour PHP de l'√©quipe VKontakte</a> ¬ª.  Et dans cette revue, je parlerai de la nouvelle fonctionnalit√© et de la fa√ßon dont nous y sommes arriv√©s. </p><br><p><img src="https://habrastorage.org/webt/gv/ru/74/gvru74yeqcbjdphiuwj4tieehoq.png"></p><a name="habracut"></a><br><h1 id="predposylki">  Contexte </h1><br><p>  Quand m√™me pour une simple nouvelle v√©rification vous avez besoin d'√©crire quelques dizaines de lignes de code sur Go, vous commencez √† vous demander: est-ce possible autrement? </p><br><p>  Sur Go, nous avons √©crit l'inf√©rence de type, l'ensemble du pipeline du linter, le cache de m√©tadonn√©es et de nombreux autres √©l√©ments importants sans lesquels NoVerify est impossible.  Ces composants sont uniques, mais les t√¢ches comme ¬´interdire d'appeler une fonction X avec un ensemble d'arguments Y¬ª ne le font pas.  Juste pour ces t√¢ches simples, le m√©canisme des r√®gles dynamiques a √©t√© ajout√©. </p><br><p>  Les r√®gles dynamiques vous permettent de s√©parer les composants internes complexes de la r√©solution de probl√®mes typiques.  Le fichier de d√©finition peut √™tre stock√© et versionn√© s√©par√©ment - il peut √™tre √©dit√© par des personnes qui ne sont pas li√©es au d√©veloppement de NoVerify lui-m√™me.  Chaque r√®gle met en ≈ìuvre une inspection de code (que nous appellerons parfois v√©rification). </p><br><p>  Oui, si nous avons un langage pour d√©crire ces r√®gles, vous pouvez toujours √©crire un mod√®le s√©mantiquement incorrect ou ignorer certaines restrictions de type - et cela conduit √† des faux positifs.  N√©anmoins, la course aux donn√©es ou le d√©r√©f√©rencement du pointeur <code>nil</code> travers le langage des r√®gles n'est pas entr√©. </p><br><h1 id="yazyk-opisaniya-shablonov">  Langage de description du mod√®le </h1><br><p>  Le langage de description est syntaxiquement compatible avec PHP.  Cela simplifie son √©tude et permet √©galement d'√©diter des fichiers de r√®gles en utilisant le m√™me PhpStorm. </p><br><p>  Au tout d√©but du fichier de r√®gles, il est recommand√© d'ins√©rer une directive apaisant votre IDE pr√©f√©r√©: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *      , *        PHP-. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@noinspection</span></span></span><span class="hljs-comment"> ALL */</span></span> <span class="hljs-comment"><span class="hljs-comment">// ...  ‚Äî   .</span></span></code> </pre> <br><p>  Ma premi√®re exp√©rience avec la syntaxe et les filtres possibles pour les mod√®les a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">phpgrep</a> .  Il peut √™tre utile en soi, mais dans NoVerify, il est devenu encore plus int√©ressant, car il a d√©sormais acc√®s aux informations de type. </p><br><p>  Certains de mes coll√®gues ont d√©j√† essay√© phpgrep dans leur travail, et c'√©tait un autre argument en faveur du choix d'une telle <a href="">syntaxe</a> . </p><br><p>  Phpgrep lui-m√™me est une adaptation gogrep pour PHP (vous pouvez √©galement √™tre int√©ress√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cgrep</a> ).  En utilisant ce programme, vous pouvez rechercher du code via des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®les de syntaxe</a> . </p><br><p>  Une alternative serait la syntaxe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">structurelle de recherche et de remplacement</a> (SSR) de PhpStorm.  Les avantages sont √©vidents - il s'agit d'un format existant, mais j'ai d√©couvert cette fonctionnalit√© apr√®s avoir impl√©ment√© phpgrep.  Vous pouvez bien s√ªr fournir une explication technique: il existe une syntaxe incompatible avec PHP et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre analyseur</a> ne la ma√Ætrisera pas, mais cette "vraie" raison convaincante a √©t√© d√©couverte apr√®s avoir √©crit le v√©lo. </p><br><div class="spoiler">  <b class="spoiler_title">En fait, il y avait une autre option</b> <div class="spoiler_text"><hr><br><p>  Il pourrait √™tre n√©cessaire d'afficher un mod√®le avec du code PHP presque un √† un - ou d'aller dans l'autre sens: inventer un nouveau langage, par exemple avec la syntaxe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">expressions S.</a> </p><br><pre> <code class="plaintext hljs">PHP-like Lisp-like ----------------------------- $x = $y | (expr = $x $y) fn($x, 1) | (expr call fn $x 1)          : (or (expr == (type string (expr)) (expr)) (expr == (expr) (type string (expr))))</code> </pre> <br><p>  Au final, j'ai pens√© que la lisibilit√© des mod√®les est toujours importante, et nous pouvons ajouter des filtres via les attributs phpdoc. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">clang-query</a> est un exemple d'une id√©e similaire, mais il utilise une syntaxe plus traditionnelle. </p><br><hr></div></div><br><h1 id="sozdayom-i-zapuskaem-svoyu-diagnostiku">  Nous cr√©ons et ex√©cutons nos propres diagnostics! </h1><br><p>  Essayons d'impl√©menter nos nouveaux diagnostics pour l'analyseur. </p><br><p>  Pour ce faire, vous devez installer NoVerify.  Prenez la <a href="">version binaire</a> si vous n'avez pas de cha√Æne d'outils Go dans le syst√®me (si vous en avez une, vous pouvez tout compiler √† partir de la source). </p><br><div class="scrollable-table"><table><tbody><tr><td>  Si vous n'installez pas NoVerify, vous pouvez continuer √† lire plus loin, mais faites semblant de reproduire les √©tapes r√©pertori√©es et admirez le r√©sultat! <br></td></tr></tbody></table></div><br><h2 id="postanovka-zadachi">  √ânonc√© du probl√®me </h2><br><p>  PHP a de nombreuses fonctions int√©ressantes, dont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parse_str</a> .  Sa signature: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   encoded_string,     //   URL,      //   (  ,    result). parse_str ( string $encoded_string [, array &amp;$result ] ) : void</span></span></code> </pre> <br><p>  Vous comprendrez ce qui ne va pas ici si vous regardez cet exemple dans la documentation: </p><br><pre> <code class="php hljs">$str = <span class="hljs-string"><span class="hljs-string">"first=value&amp;arr[]=foo+bar&amp;arr[]=baz"</span></span>; parse_str($str); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $first; <span class="hljs-comment"><span class="hljs-comment">// value echo $arr[0]; // foo bar echo $arr[1]; // baz</span></span></code> </pre> <br><p>  Mmm, les param√®tres de la cha√Æne √©taient dans la port√©e actuelle.  Pour √©viter cela, nous aurons besoin dans notre nouveau test d'utiliser le deuxi√®me param√®tre de la fonction, <code>$result</code> , pour que le r√©sultat soit √©crit dans ce tableau. </p><br><h2 id="sozdanie-svoey-diagnostiki">  Cr√©ez vos propres diagnostics </h2><br><p>  Cr√©ez le fichier <code>myrules.php</code> : </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> parse_str without second argument */</span></span> parse_str($_);</code> </pre> <br><p>  Le fichier de r√®gles en g√©n√©ral est une liste d'expressions au niveau sup√©rieur, chacune √©tant interpr√©t√©e comme un mod√®le phpgrep.  Un commentaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">phpdoc</a> sp√©cial est attendu pour chacun de ces mod√®les.  Un seul attribut est requis - une cat√©gorie d'erreur avec un texte d'avertissement. </p><br><p>  Il y a maintenant quatre niveaux au total: <code>error</code> , <code>warning</code> , <code>info</code> et <code>maybe</code> - <code>maybe</code> .  Les deux premiers sont critiques: le linter retournera un code diff√©rent de z√©ro apr√®s l'ex√©cution si au moins une des r√®gles critiques fonctionne.  Apr√®s l'attribut lui-m√™me, un texte d'avertissement sera √©mis par le linter en cas de d√©clenchement du mod√®le. </p><br><p>  Le mod√®le que nous avons √©crit utilise <code>$_</code> - il s'agit d'une variable de mod√®le sans nom.  Nous pourrions l'appeler, par exemple, <code>$x</code> , mais comme nous ne faisons rien avec cette variable, nous pouvons lui donner un nom ¬´vide¬ª.  La diff√©rence entre les variables de mod√®le et les variables PHP est que les premi√®res co√Øncident avec absolument n'importe quelle expression, et pas seulement avec une variable ¬´litt√©rale¬ª.  C'est pratique: nous devons souvent chercher des expressions inconnues plut√¥t que des variables sp√©cifiques. </p><br><h2 id="zapusk-novoy-diagnostiki">  D√©marrage d'un nouveau diagnostic </h2><br><p>  Cr√©ez un petit fichier de test pour le d√©bogage, <code>test.php</code> : </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($x)</span></span></span><span class="hljs-function"> </span></span>{ parse_str($x); <span class="hljs-comment"><span class="hljs-comment">//      }</span></span></code> </pre> <br><p>  Ensuite, ex√©cutez NoVerify avec nos r√®gles sur ce fichier: </p><br><pre> <code class="bash hljs">$ noverify -rules myrules.php test.php</code> </pre> <br><p>  Notre avertissement ressemblera √† ceci: </p><br><pre> <code class="plaintext hljs">WARNING myrules.php:4: parse_str without second argument at test.php:4 parse_str($x); ^^^^^^^^^^^^^</code> </pre> <br><p>  Le nom de la v√©rification par d√©faut est le nom du fichier de r√®gles et la ligne qui d√©finit cette v√©rification.  Dans notre cas, c'est <code>myrules.php:4</code> . </p><br><p>  Vous pouvez d√©finir votre nom √† l'aide de l' <code>@name &lt;name&gt;</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Exemple @Name</b> <div class="spoiler_text"><hr><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@name</span></span></span><span class="hljs-comment"> parseStrResult * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> parse_str without second argument */</span></span> parse_str($_);</code> </pre> <br><pre> <code class="plaintext hljs">WARNING parseStrResult: parse_str without second argument at test.php:4 parse_str($x); ^^^^^^^^^^^^^</code> </pre> <br><p>  Les r√®gles nomm√©es succombent aux lois des autres diagnostics: </p><br><ul><li>  Peut √™tre d√©sactiv√© via <code>-exclude-checks</code> </li><li>  <code>-critical</code> niveau de <code>-critical</code> peut √™tre red√©fini via <code>-critical</code> </li></ul><br><hr></div></div><br><h1 id="rabota-s-tipami">  Travailler avec des types </h1><br><p>  L'exemple pr√©c√©dent est bon pour hello world - mais souvent nous devons conna√Ætre les types d'expressions afin de r√©duire le nombre d'op√©rations de diagnostic </p><br><p>  Par exemple, pour la fonction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">in_array,</a> nous demandons l'argument <code>$strict=true</code> lorsque le premier argument ( <code>$needle</code> ) est de type cha√Æne. </p><br><p>  Pour cela, nous avons des filtres de r√©sultats. </p><br><p>  Un tel filtre est <code>@type &lt;type&gt; &lt;var&gt;</code> .  Il vous permet de supprimer tout ce qui ne correspond pas aux types √©num√©r√©s. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> 3rd arg of in_array must be true when comparing strings * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> string $needle */</span></span> in_array($needle, $_);</code> </pre> <br><p>  Ici, nous avons donn√© le nom du premier argument √† l'appel <code>in_array</code> pour lui <code>in_array</code> un filtre de type.  Un avertissement ne sera √©mis que lorsque le type de <code>$needle</code> est une <code>string</code> . </p><br><p>  Les jeux de filtres peuvent √™tre combin√©s avec l'op√©rateur <code>@or</code> : </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     -. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> strings must be compared using '===' operator * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> string $x * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@or</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> string $y */</span></span> $x == $y;</code> </pre> <br><p>  Dans l'exemple ci-dessus, le mod√®le ne correspondra qu'√† ces expressions <code>==</code> , o√π l'un des op√©randes est de type <code>string</code> .  On peut supposer que sans <code>@or</code> tous les filtres sont combin√©s via <code>@and</code> , mais cela n'a pas besoin d'√™tre explicitement indiqu√©. </p><br><h1 id="ogranichivaem-oblast-deystviya-diagnostiki">  Limiter la port√©e du diagnostic </h1><br><p>  Pour chaque test, vous pouvez sp√©cifier <code>@scope &lt;name&gt;</code> : </p><br><ul><li>  <code>@scope all</code> - la valeur par d√©faut, la validation fonctionne partout; </li><li>  <code>@scope root</code> - lancement uniquement au niveau sup√©rieur; </li><li>  <code>@scope local</code> - s'ex√©cute uniquement √† l'int√©rieur des fonctions et m√©thodes. </li></ul><br><p>  Supposons que nous voulons signaler un <code>return</code> dehors du corps de la fonction.  En PHP, cela a parfois du sens - par exemple, lorsqu'un fichier est connect√© √† partir d'une fonction ... Mais dans cet article, nous condamnons cela. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> don't use return outside of functions * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@scope</span></span></span><span class="hljs-comment"> root */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_;</code> </pre> <br><p>  Voyons comment cette r√®gle va se comporter: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"OK"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"NOT OK"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Gives a warning class C { public function m() { return "ALSO OK"; } }</span></span></code> </pre> <br><p>  De m√™me, vous pouvez demander d'utiliser <code>*_once</code> au lieu d' <code>require</code> et <code>include</code> : </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@maybe</span></span></span><span class="hljs-comment"> prefer require_once over require * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@scope</span></span></span><span class="hljs-comment"> root */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $_; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@maybe</span></span></span><span class="hljs-comment"> prefer include_once over include * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@scope</span></span></span><span class="hljs-comment"> root */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $_;</code> </pre> <br><blockquote>  D√©sormais, lors de l'appariement des motifs, les parenth√®ses ne sont pas prises en compte de mani√®re assez coh√©rente.  Le mod√®le <code>(($x))</code> ne trouvera pas ¬´toutes les expressions entre crochets¬ª, mais simplement toutes les expressions, en ignorant les crochets.  Cependant, <code>$x+$y*$z</code> et <code>($x+$y)*$z</code> se comportent comme ils le devraient.  Cette fonctionnalit√© provient des difficult√©s de travail avec les jetons <code>(</code> et <code>)</code> , mais il est possible que l'ordre soit restaur√© dans l'une des prochaines versions. </blockquote><br><h1 id="gruppirovanie-shablonov">  Mod√®les de regroupement </h1><br><p>  Lorsque la duplication des commentaires phpdoc appara√Æt sur les mod√®les, la possibilit√© de combiner des mod√®les vient √† la rescousse. </p><br><p>  Un exemple simple pour d√©montrer: </p><br><div class="scrollable-table"><table><tbody><tr><th>  √âtait </th><th>  C'est devenu (avec groupement) </th></tr><tr><td><pre> / ** @mais ne pas utiliser exit ou mourir * /
 mourir ($ _);<font></font>
<font></font>
 / ** @mais ne pas utiliser exit ou mourir * /
 exit ($ _);
</pre></td><td><pre> / ** @mais ne pas utiliser exit ou mourir * /
 {
   mourir ($ _);
   exit ($ _);
 }
</pre></td></tr></tbody></table></div><br><p>  Imaginez maintenant combien il serait d√©sagr√©able de d√©crire une r√®gle dans l'exemple suivant sans cette fonctionnalit√©! </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> don't compare arrays with numeric types * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> array $x * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> int|float $y * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@or</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> int|float $x * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@type</span></span></span><span class="hljs-comment"> array $y */</span></span> { $x &gt; $y; $x &lt; $y; $x &gt;= $y; $x &lt;= $y; $x == $y; }</code> </pre> <br><p>  Le format d'enregistrement sp√©cifi√© dans l'article n'est qu'une des options propos√©es.  Si vous souhaitez participer au choix, alors vous avez une telle opportunit√©: vous devez mettre +1 aux offres que vous aimez plus que les autres.  Pour plus de d√©tails, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cliquez ici</a> . </p><br><h1 id="kak-integrirovany-dinamicheskie-pravila">  Comment les r√®gles dynamiques sont int√©gr√©es </h1><br><p><img src="https://habrastorage.org/webt/1l/hl/x4/1lhlx4vcasmxii4zhwf6fmzlgn8.jpeg"></p><br><p>  Au moment du lancement, NoVerify essaie de trouver le fichier de r√®gles sp√©cifi√© dans l'argument de <code>rules</code> . </p><br><p>  Ensuite, ce fichier est analys√© comme un script PHP normal, et √† partir de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AST</a> r√©sultant, un ensemble d'objets de r√®gle avec des mod√®les phpgrep li√©s √† eux est collect√©. </p><br><p>  Ensuite, l'analyseur d√©marre le travail selon le sch√©ma habituel - la seule diff√©rence est que pour certaines sections de code v√©rifi√©es, il d√©marre un ensemble de r√®gles li√©es.  Si la r√®gle est d√©clench√©e, un avertissement s'affiche. </p><br><p>  Le succ√®s est consid√©r√© comme la mise en correspondance du mod√®le phpgrep et le passage d'au moins un des ensembles de filtres (ils sont s√©par√©s par <code>@or</code> ). </p><br><p>  √Ä ce stade, le m√©canisme de r√®gles ne ralentit pas de mani√®re significative le fonctionnement du linter, m√™me s'il y a beaucoup de r√®gles dynamiques. </p><br><h2 id="algoritm-matchinga">  Algorithme de correspondance </h2><br><p>  Avec l'approche na√Øve, pour chaque n≈ìud AST, nous devons appliquer toutes les r√®gles dynamiques.  Il s'agit d'une impl√©mentation tr√®s inefficace, car la plupart du travail sera fait en vain: de nombreux mod√®les ont un pr√©fixe sp√©cifique par lequel nous pouvons regrouper les r√®gles. </p><br><p>  Ceci est similaire √† l'id√©e de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">appariement parall√®le</a> , mais au lieu de construire honn√™tement le NFA, nous ne ¬´parall√©lisons¬ª que la premi√®re √©tape des calculs. </p><br><p>  Consid√©rez ceci avec un exemple avec trois r√®gles: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> duplicated then/else parts of ternary */</span></span> $_ ? $x : $x; <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> don't call explode with delim="" */</span></span> explode(<span class="hljs-string"><span class="hljs-string">""</span></span>, ${<span class="hljs-string"><span class="hljs-string">"*"</span></span>}); <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@maybe</span></span></span><span class="hljs-comment"> suspicious empty body of the if statement */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_);</code> </pre> <br><p>  Si nous avons N √©l√©ments et M r√®gles, avec une approche na√Øve nous avons N * M op√©rations √† effectuer.  En th√©orie, cette complexit√© peut √™tre r√©duite √† lin√©aire et obtenir <code>O(N)</code> - si vous combinez tous les mod√®les en un seul et effectuez la correspondance comme elle le fait, par exemple, le package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">regexp</a> de Go. </p><br><p>  Cependant, dans la pratique, je me suis jusqu'√† pr√©sent concentr√© sur la mise en ≈ìuvre partielle de cette approche.  Il permettra de r√©partir les r√®gles du fichier ci-dessus en trois cat√©gories, et aux √©l√©ments AST auxquels aucune r√®gle ne correspond, d'attribuer une quatri√®me cat√©gorie vide.  Pour cette raison, pas plus d'une r√®gle n'est ex√©cut√©e pour chaque √©l√©ment. </p><br><p>  Si nous avons des milliers de r√®gles et que nous ressentons un ralentissement significatif, l'algorithme sera finalis√©.  En attendant, la simplicit√© de la solution et l'acc√©l√©ration qui en r√©sulte me conviennent. </p><br><h2 id="muki-vybora-ili-nemnogo-o-forme-zapisi-type">  Le tourment du choix, ou un peu sur la <code>@type</code> type </h2><br><div class="scrollable-table"><table><tbody><tr><td>  T√¢che: s√©lectionner une bonne syntaxe pour les filtres dans les annotations phpdoc. <br></td></tr></tbody></table></div><br><p>  La syntaxe actuelle duplique <code>@var</code> et <code>@var</code> , mais nous pouvons avoir besoin de nouveaux op√©rateurs, par exemple, "le type n'est pas √©gal".  Imaginez √† quoi cela pourrait ressembler. </p><br><p>  Nous avons au moins deux priorit√©s importantes: </p><br><ol><li>  La syntaxe lisible et concise des annotations. </li><li>  Le soutien le plus √©lev√© possible de l'IDE sans effort suppl√©mentaire. </li></ol><br><p>  Pour PhpStorm, il existe un plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">php-annotations</a> qui ajoute l'auto-compl√©tion, la transition vers les classes d'annotation et d'autres utilit√©s pour travailler avec des commentaires phpdoc. </p><br><p>  La priorit√© (2) signifie en pratique que vous prenez des d√©cisions qui ne contredisent pas les attentes de l'IDE et des plugins.  Par exemple, vous pouvez faire des annotations dans un format que le plugin php-annotations peut reconna√Ætre: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Type is a filter that checks that $value * satisfies the given type constraints. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Annotation</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Filter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** Variable name that is being filtered */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $value; <span class="hljs-comment"><span class="hljs-comment">/** Check that value type is equal to $type */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $type; <span class="hljs-comment"><span class="hljs-comment">/** Check that value text is equal to $text */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $text; }</code> </pre> <br><p>  Ensuite, appliquer un filtre aux types ressemblerait √† ceci: </p><br><pre> <code class="plaintext hljs">@Type($needle, eq=string) @Type($x, not_eq=Foo)</code> </pre> <br><p>  Les utilisateurs pourraient aller √† la d√©finition du <code>Filter</code> , une liste des param√®tres possibles (type / texte / etc) serait demand√©e. </p><br><p>  M√©thodes d'enregistrement alternatives, dont certaines ont √©t√© sugg√©r√©es par des coll√®gues: </p><br><pre> <code class="plaintext hljs">@type string $needle @type !Foo $x @type $needle == string @type $x != Foo @type(==) string $needle @type(!=) Foo $x @type($needle) == string @type($x) != Foo @filter type($needle) == string @filter type($x) != Foo</code> </pre> <br><p>  Ensuite, nous avons √©t√© un peu distraits et avons oubli√© que tout √©tait √† l'int√©rieur de phpdoc, et cela est apparu: </p><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">eq</span></span> string (<span class="hljs-name"><span class="hljs-name">typeof</span></span> $needle)) (<span class="hljs-name"><span class="hljs-name">neq</span></span> Foo (<span class="hljs-name"><span class="hljs-name">typeof</span></span> $x))</code> </pre> <br><p>  Bien que l'option avec enregistrement postfix pour le plaisir ait √©galement √©t√© √©mise.  Un langage pour d√©crire les contraintes de type et de valeur pourrait √™tre appel√© sixi√®me: </p><br><pre> <code class="plaintext hljs">@eval string $needle typeof = @eval Foo $x typeof &lt;&gt;</code> </pre> <br><p>  La recherche de la meilleure option n'est pas encore termin√©e ... </p><br><h1 id="sravnenie-rasshiryaemosti-s-phan">  Comparaison d'extensibilit√© avec Phan </h1><br><p>  Comme l'un des avantages de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Phan</a> , l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Analyse statique du code PHP en utilisant l'exemple de PHPStan, Phan et Psalm</a> " indique l'extensibilit√©. </p><br><p>  Voici ce qui a √©t√© impl√©ment√© dans l'exemple de plugin: </p><br><blockquote>  Nous voulions √©valuer dans quelle mesure notre code est pr√™t pour PHP 7.3 (en particulier, pour savoir s'il a des constantes insensibles √† la casse).  Nous √©tions presque s√ªrs qu'il n'y avait pas de telles constantes, mais tout pouvait arriver en 12 ans - cela devrait √™tre v√©rifi√©.  Et nous avons √©crit un plugin pour Phan qui jurerait si le troisi√®me param√®tre √©tait utilis√© dans define (). </blockquote><p>  Voici √† quoi ressemble le code du plugin (le formatage est optimis√© pour la largeur): </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phan</span></span>\<span class="hljs-title"><span class="hljs-title">AST</span></span>\<span class="hljs-title"><span class="hljs-title">ContextNode</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phan</span></span>\<span class="hljs-title"><span class="hljs-title">CodeBase</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phan</span></span>\<span class="hljs-title"><span class="hljs-title">Language</span></span>\<span class="hljs-title"><span class="hljs-title">Context</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phan</span></span>\<span class="hljs-title"><span class="hljs-title">Language</span></span>\<span class="hljs-title"><span class="hljs-title">Element</span></span>\<span class="hljs-title"><span class="hljs-title">Func</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phan</span></span>\<span class="hljs-title"><span class="hljs-title">PluginV2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phan</span></span>\<span class="hljs-title"><span class="hljs-title">PluginV2</span></span>\<span class="hljs-title"><span class="hljs-title">AnalyzeFunctionCallCapability</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ast</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefineThirdParamTrue</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginV2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnalyzeFunctionCallCapability</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAnalyzeFunctionCallClosures</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CodeBase $code_base)</span></span></span><span class="hljs-function"> </span></span>{ $def = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CodeBase $cb, Context $ctx, Func $fn, $args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($args) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;emitIssue( $cb, $ctx, <span class="hljs-string"><span class="hljs-string">'PhanDefineCaseInsensitiv'</span></span>, <span class="hljs-string"><span class="hljs-string">'define with 3 arguments'</span></span>, [] ); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'define'</span></span> =&gt; $def]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefineThirdParamTrue();</code> </pre> <br><p>  Et voici comment cela pourrait √™tre fait dans NoVerify: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@warning</span></span></span><span class="hljs-comment"> define with 3 arguments */</span></span> define($_, $_, $_);</code> </pre> <br><p>  Nous voulions obtenir √† peu pr√®s le m√™me r√©sultat - afin que les choses triviales puissent √™tre faites aussi simplement que possible. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><ul><li>  Essayez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NoVerify</a> dans votre projet. </li><li>  Si vous avez des id√©es d'am√©liorations ou de rapports de bogues, faites <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-nous part de vos commentaires</a> . </li><li>  Si vous souhaitez participer au d√©veloppement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bienvenue</a> ! </li></ul><br><h1 id="ssylki-poleznye-materialy">  Liens, documents utiles </h1><br><p>  Des liens importants sont rassembl√©s ici, dont certains ont peut-√™tre d√©j√† √©t√© mentionn√©s dans l'article, mais pour plus de clart√© et de commodit√©, je les ai rassembl√©s en un seul endroit. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'article sur NoVerify sur Habr√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'article sur phpgrep sur Habr√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Phpgrep talk video avec IT Nights</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gogrep</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lancer la</a> recherche de code par des mod√®les de syntaxe </li><li>  Concept de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©lecteurs</a> ESLint <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AST</a> similaire aux mod√®les de syntaxe </li></ul><br><p>  Si vous avez besoin de plus d'exemples de r√®gles pouvant √™tre impl√©ment√©es, vous pouvez jeter un ≈ìil aux <a href="">tests NoVerify</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473718/">https://habr.com/ru/post/fr473718/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473706/index.html">Zoia: CMS r√©actif l√©ger pour un d√©veloppement rapide de sites Web</a></li>
<li><a href="../fr473708/index.html">Voiture √©lectrique faite maison - tout n'est pas ce que vous pensez</a></li>
<li><a href="../fr473710/index.html">Les principes de documentation et de localisation, ou comment obtenir une bonne localisation √† moindre co√ªt</a></li>
<li><a href="../fr473714/index.html">Comment je suis arriv√© √† la sp√©cification formelle d'un processeur RISC-V en F #</a></li>
<li><a href="../fr473716/index.html">Widgets pilot√©s par la souris. Glissez et d√©posez dans la fen√™tre</a></li>
<li><a href="../fr473720/index.html">Deux fa√ßons de r√©aliser des tests unitaires fiables</a></li>
<li><a href="../fr473722/index.html">Isolement √† distance, anxi√©t√© et d√©pression</a></li>
<li><a href="../fr473726/index.html">Il ne suffit pas de savoir ce que sont Mutex, Semaphore et async / wait. Vous devez tout savoir des quanta</a></li>
<li><a href="../fr473728/index.html">Mise en ≈ìuvre typique de la surveillance. Nikolay Sivko</a></li>
<li><a href="../fr473732/index.html">L'histoire de la fraude dans la construction d'un r√©seau c√¢bl√© sous l'Arctique pour 1 milliard de dollars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>