<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌐 😢 🕯️ 找到了无痛过渡到.Net Core的公式 🚗 ⛓️ 👨‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="对于每样东西，每杯50杯咖啡就足够了。 


 除了上面概述的经验法则外，我们还发布了有关需要密切注意的要点的简短说明，以便在战斗和过程中一切顺利。 进行此注释是为了紧追移动服务的发布，该服务已完全迁移到.Net Core（开始于此处 ）。 我们设法在没有停止主要开发过程的情况下就执行了客户未注意到...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>找到了无痛过渡到.Net Core的公式</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/422441/"><p> 对于每样东西，每杯50杯咖啡就足够了。 </p><br><p> 除了上面概述的经验法则外，我们还发布了有关需要密切注意的要点的简短说明，以便在战斗和过程中一切顺利。 进行此注释是为了紧追移动服务的发布，该服务已完全迁移到.Net Core（开始于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> ）。 我们设法在没有停止主要开发过程的情况下就执行了客户未注意到的操作。 </p><br><p> 下面是一个现成的行动计划，将有一个非常宽敞的测试列表，此图片适合您： </p><br><p><img src="https://habrastorage.org/webt/pt/yp/6s/ptyp6szarkzymkgf34tz0ide3r8.jpeg"></p><a name="habracut"></a><br><h3 id="itak-po-shagam"> 因此，分步进行： </h3><br><h4 id="1-zaplanirovat-dlinnyy-sprint-s-bolshimi-fichami-iili-regressom">  1.规划具有重要功能和/或回归的长距离冲刺 </h4><br><p> 通过基本代码重写，该服务将需要时间来保持尽可能长的时间，以便有时间修复测试环境上的所有缺陷。 </p><br><h4 id="2-v-akkurat-k-sprintu-perepisat-kod-na-net-core">  2.在精确的Sprint中重写.Net Core上的代码 </h4><br><p> 为什么不提前开展这项业务很重要？ 因为您必须使用新的和旧的.net来拉出两个代码分支，所以在任何时候都可能出现紧急情况，否则您将需要进行新功能的演示，然后需要对旧的稳定分支进行更改。 为了尽量减少对此的担忧，最好缩短过渡状态的时间。 </p><br><p> 顺便说一句，在使用代码时，我们很快得出结论，在本地保留两个版本的存储库更加方便。 比切换两个大型分支更容易，更方便。 </p><br><ul><li> 如果可能，请在使用的服务中的webapi中重写WCF接口 </li></ul><br><p>  WCF客户端的.Net Core实现仍远非理想。 尽管事实上旧<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">疮</a>在某种程度上是固定的，但在新版本中，您仍然必须使用变通方法（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1，2</a> ）。 </p><br><blockquote> 故事：在.Net Core 2.0上，myget存储库中的WCF稳定工作版本为4.4.2。 例如，她在提前超时方面没有任何问题 </blockquote><p> 在迁移开始时，我们使用了.Net Core 2.0版本。 同时，Microsoft已发布.Net Core 2.1。 谁有兴趣欣赏Redmond家伙在优化平台方面的成功，请阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bing</a>搜索引擎在升级到新版本时取得的进展（剧透：latensi下降了34％！） </p><br><p> 我们还升级到了.Net Core 2.1和WCF 4.5.3。 我们也没有忘记在Dockerfile中指定新的基础microsoft / dotnet映像：2.1-aspnetcore-runtime。 令人惊讶的是，他们看到的图像大小为0.5GB，而不是1.4GB（如果是突然的话，我们所说的是Windows图像）。 </p><br><h4 id="3-zadeploit-na-test-i-demo">  3.进行测试和演示 </h4><br><p> 我们有两个环境可供选择。 我们以旧版本作为参考离开了该演示。 一项新服务已部署到测试环境-在开发人员和测试人员上运行。 </p><br><p>由于开发人员通常使用测试，而测试人员主要使用演示，因此造成了一些混乱。 如果有必要更新旧服务，则情况与正常情况完全相反。 因此，方便的讨论和备忘单就在哪里和要寻找的东西上。 </p><br><ul><li> 配置IIS </li></ul><br><p> 要在IIS中运行.Net Core服务，必须安装运行时附带的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">模块</a> 。 </p><br><p>  AppPool切换到CLR运行时=无托管代码。 </p><br><p> 在标准<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">web.config</a>中的解决方案中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>重要的是不要忘记设置所需的requestTimeout并禁用WebDAV模块（如果有DELETE方法）。 </p><br><p> 此外，有两种选择可用于在IIS中发布服务： </p><br><ul><li> 您执行MSDeploy同步-这意味着您还需要-enableRule开关：AppOffline </li><li> 您要进行文件发布-这意味着恰好在发布之前需要将文件app_offline.htm放在服务目录中，并在发布之后将其删除 </li></ul><br><p> 两者都允许停止工作进程并打开可执行文件。 否则，将发生错误，指出文件不可用于覆盖。 </p><br><blockquote> 我们拒绝通过Nlog支持Serilog进行日志记录，并且丢失了日志的自动压缩功能-在Serilog中根本没有这样的功能。 在这种情况下，可以使用常规Windows工具进行保存，并在目录属性中安装NTFS压缩。 </blockquote><br><h4 id="4-protestirovat">  4.测试 </h4><br><p> 这是最脆弱的地方最缩小的清单： </p><br><ul><li> 检查状态码的返回错误的请求，未授权，未修改，未找到-API可以提供的所有功能 </li><li> 检查请求日志以获取所有状态代码 </li><li> 绘制外部依赖关系图； 通常，所有必要的信息都在设置中 <br><ul><li> 消除影响他们工作的方法 </li><li> 检查外部请求的日志记录 </li></ul></li><li> 检查appsettings参数的设置的功能； 尝试将它们变热 </li><li> 检查http缓存中的正负状态代码 <br><ul><li>  ETag标头 </li><li> 标头缓存控制 </li></ul></li><li> 检查长请求和超时 </li><li> 用空答案检查请求 </li><li> 检查DELETE方法（是否禁用WebDAV） </li><li> 用原始内容检查工作 <br><ul><li> 上传并下载一个/几个文件 </li><li> 上传大小超出限制的文件 </li><li> 标头布局Content-Disposition </li></ul></li><li> 检查所有其他标题； 将它们全部整合到代码中非常容易 </li><li> <code>if (env.IsDevelopment())</code>在切换环境时检查条件代码执行 </li><li> 检查与客户端和服务器的断开连接 </li><li> 与标准swagger.json比较-将有助于检测传输字段中的差异 <br><blockquote> 我们的移动应用程序基于swagger.json的描述使用代码生成器与API配合使用，因此与原始描述的差异最小是很重要的。 在最新版本的Swashbuckle.AspNetCore中，界面和生成的swagger.json发生了很大变化。 我必须回滚到Swashbuckle.AspNetCore 1.2.0的破旧版本，并添加几个过滤器。 <br></blockquote></li></ul><br><h4 id="5-zadeploit-na-boy-popivaya-kofeek">  5.边喝咖啡边打架 </h4><br><p> 在我们的案例中，战斗环境由两个节点组成：主动节点和被动节点。 <br> 为了不引起切换到新服务的麻烦，我们在每个节点上复制了池和站点，并编写了脚本来切换旧站点和新站点之间的绑定。 </p><br><p> 因此，在紧急情况下，我们能够快速切换到旧版本。 </p><br><p> 此外，在部署到战斗中之后，我们在一周内就对服务的可行性深信不疑，并为发布移动应用程序开了绿灯。 该项目的生命安全地恢复了以前的过程。 </p><br><h3 id="promezhutochnyy-itog"> 小计 </h3><br><p> 现在，我们的服务已准备就绪，可以扩展Docker容器以交付给集群。 我们已经准备好在Kubernetes和Service Fabric中进行部署。 </p><br><p> 现在正在准备向客户展示新基础架构。 我们将在下一个系列中介绍我们的成就，保持同步；） </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN422441/">https://habr.com/ru/post/zh-CN422441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN422431/index.html">日本仙女在数字电子产品的新漫画中显示了主从触发</a></li>
<li><a href="../zh-CN422433/index.html">太阳能电池板和柏油马路。 技术共生</a></li>
<li><a href="../zh-CN422435/index.html">计时器-开始</a></li>
<li><a href="../zh-CN422437/index.html">用户体验游戏以及网站和应用程序的速度</a></li>
<li><a href="../zh-CN422439/index.html">与Yandex的斗争：我如何花了一年多的时间将网站推向最高点</a></li>
<li><a href="../zh-CN422443/index.html">Corona SDK精确计时器</a></li>
<li><a href="../zh-CN422445/index.html">BottomAppBar实现。 第3部分：Android行为</a></li>
<li><a href="../zh-CN422447/index.html">Go中的bytes.Buffer：无效的优化</a></li>
<li><a href="../zh-CN422449/index.html">参议员与亚马逊：在线商店做了什么</a></li>
<li><a href="../zh-CN422451/index.html">9月26日在VShBI上聆听游戏营销和编剧在游戏行业中的地位</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>