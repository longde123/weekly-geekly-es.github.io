<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÑπÔ∏è üî© üó≥Ô∏è Desarrollo del "firmware" m√°s simple para FPGAs instalados en Redd, y depuraci√≥n utilizando la prueba de memoria como ejemplo üéà üåî üç¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De alguna manera no puedo expresar mis pensamientos brevemente. El oto√±o pasado, hubo un deseo de contar con m√°s detalles sobre la arquitectura de PSo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo del "firmware" m√°s simple para FPGAs instalados en Redd, y depuraci√≥n utilizando la prueba de memoria como ejemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452656/">  De alguna manera no puedo expresar mis pensamientos brevemente.  El oto√±o pasado, hubo un deseo de contar con m√°s detalles sobre la arquitectura de PSoC que domin√©, lo que result√≥ en una serie de art√≠culos al respecto.  Ahora estoy involucrado en la preparaci√≥n del hardware para nuestro complejo de depuraci√≥n remota de Redd, que se describi√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , y quiero descartar la experiencia acumulada en forma de texto.  Todav√≠a no estoy seguro, pero me parece que nuevamente no es un art√≠culo, sino un ciclo.  En primer lugar, as√≠ es como documentar√© los m√©todos de desarrollo desarrollados que pueden ser √∫tiles para alguien cuando se trabaja con el complejo y, en general, y en segundo lugar, el concepto a√∫n es nuevo, no est√° completamente establecido.  Quiz√°s, en el proceso de discusi√≥n de art√≠culos, aparezcan algunos comentarios, de los cuales uno puede sacar algo para expandirlo (o incluso cambiarlo).  Por lo tanto, procedemos. <br><img src="https://habrastorage.org/webt/lk/xe/c9/lkxec9ijefezvvydvjbmi49ahny.jpeg"><br><a name="habracut"></a><br><br><h2>  Larga introducci√≥n </h2><br>  Realmente no me gusta teorizar, prefiero exponer algunas cosas pr√°cticas a la vez.  Pero al comienzo del primer art√≠culo, sin una larga introducci√≥n en ning√∫n lado.  En √©l, justifico el enfoque actual del desarrollo.  Y todo girar√° en torno a una cosa: la hora hombre es un recurso muy costoso.  Y el asunto no es solo en los t√©rminos asignados para el proyecto.  √âl es f√≠sicamente caro.  Si se gasta en el desarrollo del producto final, bueno, ¬øqu√© puede hacer sin √©l en ninguna parte?  Pero cuando se gasta en trabajo auxiliar, esto, en mi opini√≥n, es malo.  Recuerdo que tuve una disputa con un desarrollador que dijo que al hacer prototipos por su cuenta, ahorrar√≠a dinero para su empresa nativa.  Argument√© que pasar√≠a unos 3 d√≠as en la fabricaci√≥n.  Eso es 24 horas hombre.  Tomamos su salario por estas horas, agregamos el impuesto social que "paga el empleador", as√≠ como el alquiler de la oficina por esas horas.  Y estamos sorprendidos de ver que al ordenar tableros en el lateral, puede obtener costos m√°s bajos.  Pero ese soy yo, exagero.  En general, si se pueden evitar los costos laborales, deber√≠an evitarse. <br><br>  ¬øCu√°l es el desarrollo de "firmware" para el complejo Redd?  Este es un trabajo auxiliar.  El proyecto principal vivir√° feliz para siempre; debe hacerse de la manera m√°s eficiente posible, con una excelente optimizaci√≥n, etc.  Pero gastar tiempo y energ√≠a en cosas auxiliares que ir√°n al archivo despu√©s del desarrollo es un desperdicio.  Fue con un ojo en este principio que se llev√≥ a cabo el desarrollo del equipo Redd.  Todas las funciones, si es posible, se implementan como elementos est√°ndar.  Los autobuses SPI, I2C y UART se implementan en microcircuitos FTDI est√°ndar y se programan a trav√©s de controladores est√°ndar, sin lujos.  La gesti√≥n de los carretes se implementa en el formato de un puerto COM virtual.  Se puede modificar, pero al menos todo se ha hecho para que tal deseo no surja.  En general, todo lo est√°ndar, si es posible, se implementa de manera est√°ndar.  De proyecto en proyecto, los desarrolladores simplemente necesitan escribir r√°pidamente el c√≥digo t√≠pico para que la PC acceda a estos buses.  La t√©cnica de desarrollo en C ++ deber√≠a ser obvia para quienes desarrollan programas para microcontroladores (hablaremos de algunos detalles t√©cnicos en otro art√≠culo). <br><br>  Pero FPGA est√° solo en el complejo.  Se agrega al sistema para casos en los que es necesario implementar protocolos no est√°ndar con un requisito de alto rendimiento.  Si se requieren, tendr√° que hacer el "firmware" para ello.  Se trata de la programaci√≥n FPGA y quiero hablar espec√≠ficamente, todo con el mismo prop√≥sito: reducir el tiempo de desarrollo de las cosas auxiliares. <br><br>  Para no confundir al lector, formular√© el pensamiento en un marco: <br><blockquote>  No es necesario llevar a cabo el desarrollo de FPGA en cada proyecto.  Si hay suficientes controladores de bus conectados directamente al procesador central para trabajar con el dispositivo de destino, debe usarlos. <br>  FPGA agregado al complejo para la implementaci√≥n de protocolos no est√°ndar. </blockquote><br><br><h2>  Diagrama de bloques del complejo. </h2><br>  Veamos el diagrama de bloques del complejo. <br><br><img src="https://habrastorage.org/webt/vf/hv/da/vfhvda1kmsax-zkxaue4xu_ysmk.png"><br><br>  En la parte inferior del circuito hay una "calculadora".  En realidad, esta es una PC est√°ndar con Linux.  Los desarrolladores pueden escribir programas regulares en C, C ++, Python, etc., que ser√°n ejecutados por la computadora.  En la parte superior derecha est√°n los puertos est√°ndar de los neum√°ticos est√°ndar.  A la izquierda hay un interruptor para dispositivos est√°ndar (SPI Flash, tarjeta SD y varios rel√©s de estado s√≥lido de baja corriente, que pueden, por ejemplo, simular presionar botones).  Y en el centro est√° precisamente esa parte, el trabajo con el que se planea considerar en esta serie de art√≠culos.  Su coraz√≥n es un FPGA de clase FPGA, del cual salen las l√≠neas rectas (pueden usarse como pares diferenciales o l√≠neas ordinarias sin b√∫fer), l√≠neas GPIO con un nivel l√≥gico configurable, as√≠ como un bus USB 2.0 implementado a trav√©s de un chip ULPI. <br><br><h2>  Continuaci√≥n de la introducci√≥n sobre el enfoque de programaci√≥n FPGA </h2><br>  Cuando se desarrolla una l√≥gica de control de alto rendimiento para FPGA, generalmente Su Majestad toca el primer viol√≠n en una m√°quina de estado.  En las m√°quinas es posible implementar una l√≥gica compleja pero de alta velocidad.  Pero, por otro lado, un aut√≥mata se desarrolla m√°s lentamente que un programa para un procesador, y su modificaci√≥n es otro proceso.  Existen sistemas que simplifican el desarrollo y mantenimiento de m√°quinas.  Uno de ellos incluso fue desarrollado por nuestra empresa, pero a√∫n as√≠, el proceso de dise√±o para cualquier tipo de l√≥gica compleja no es r√°pido.  Cuando el sistema desarrollado es el producto final, tiene sentido prepararse, dise√±ar una buena m√°quina de control y dedicar tiempo a su implementaci√≥n.  Pero como ya se se√±al√≥, el desarrollo para Redd es un trabajo auxiliar.  Est√° dise√±ado para facilitar el proceso, no para complicarlo.  Por lo tanto, se decidi√≥ que el desarrollo no ser√° autom√°tico, sino sistemas de procesador. <br><br>  Pero por otro lado, al desarrollar el hardware, la opci√≥n m√°s moderna hasta la fecha, FPGA con el n√∫cleo ARM, fue rechazada.  En primer lugar, por razones de precio.  Una placa prototipo basada en SoC de Cyclone V es moderadamente costosa, pero curiosamente, una FPGA separada es mucho m√°s costosa.  Lo m√°s probable es que el precio de las placas de creaci√≥n de prototipos se descargue para atraer a los desarrolladores a usar datos FPGA, y las placas se venden individualmente.  La serie tendr√° que tomar fichas individuales.  Pero adem√°s, tambi√©n hay un "segundo".  En segundo lugar, cuando estaba experimentando con Cyclone V SoC, result√≥ que este sistema de procesador no es as√≠ y es productivo cuando se trata de acceso √∫nico a los puertos.  Lote: s√≠, el trabajo es r√°pido.  Y en el caso de accesos √∫nicos a una frecuencia de reloj del n√∫cleo del procesador de 925 MHz, puede obtener acceso a los puertos a una frecuencia de unos pocos megahercios.  Para todos, propongo llamar a la funci√≥n est√°ndar de ingresar datos en el FIFO del bloque UART, que verifica el desbordamiento de la cola, pero lo llama cuando la cola est√° obviamente vac√≠a, es decir, nada interfiere con las operaciones.  Mi productividad pas√≥ de un mill√≥n a quinientas mil llamadas por segundo (por supuesto, trabajar con la memoria fue a la velocidad normal, se ajustaron todas las memorias cach√©, incluso la opci√≥n de funci√≥n que no verific√≥ FIFO por hacinamiento funcion√≥ m√°s r√°pido, solo la funci√≥n en discusi√≥n se ha mezclado abundantemente escribir y leer desde los puertos).  Este es FIFO!  De hecho, FIFO se invent√≥ para dejar caer datos all√≠ y olvidar.  ¬°Salga r√°pido!  Y no con rendimiento, menos de una mega operaci√≥n por segundo a una frecuencia de procesador de 925 MHz ... <br><br>  La latencia es la culpable.  Entre el n√∫cleo del procesador y el equipo se encuentra desde tres puentes o m√°s.  Adem√°s, la velocidad de acceso a los puertos depende del contexto (varios registros seguidos ir√°n r√°pidamente, pero la primera lectura detendr√° el proceso hasta que los datos en cach√© se descarguen por completo, demasiados registros seguidos tambi√©n se ralentizar√°n, ya que las memorias intermedias de escritura est√°n agotadas).  Finalmente, el examen de las trazas acumuladas en el b√∫fer de depuraci√≥n mostr√≥ que la arquitectura <b>Cortex A</b> puede ejecutar la misma parte para un n√∫mero diferente de ciclos de reloj debido al complejo sistema de cach√©.  En resumen, teniendo en cuenta todos estos factores (precio, reducciones de rendimiento cuando se trabaja con el equipo, inestabilidad de la velocidad de acceso al equipo, dependencia general del contexto), se decidi√≥ no colocar dicho chip en el complejo. <br><br>  Los experimentos con el PSoC de Cypress mostraron que all√≠ el n√∫cleo <b>Cortex M</b> proporciona resultados m√°s predecibles y repetibles, pero la capacidad l√≥gica y la frecuencia m√°xima de funcionamiento de estos controladores no correspond√≠an a las especificaciones t√©cnicas, por lo que tambi√©n se descartaron. <br><br>  Se decidi√≥ instalar un FPGA Cyclone IV t√≠pico de bajo costo y recomendar el uso de un n√∫cleo de procesador NIOS II sintetizado.  Bueno, y si es necesario, para llevar a cabo el desarrollo utilizando cualquier otro m√©todo (m√°quinas autom√°ticas, l√≥gica r√≠gida, etc.). <br><br><blockquote>  Mencionar√© por separado (e incluso destacar√© este p√°rrafo) que el procesador principal del complejo es x86 (x64).  Es √©l quien es el procesador central del sistema.  Es all√≠ donde se ejecuta la l√≥gica principal del complejo.  El sistema de procesador, que se analizar√° a continuaci√≥n, est√° dise√±ado para proporcionar simplemente la l√≥gica del funcionamiento del equipo "flasheado" en el FPGA.  Adem√°s, este equipo se vende solo si los desarrolladores no tienen suficientes m√≥dulos de tiempo completo conectados directamente al procesador central. </blockquote><br><br><h2>  El proceso de desarrollo y depuraci√≥n de "firmware" </h2><br>  Si el complejo Redd est√° ejecutando Linux, esto no significa que el desarrollo deba llevarse a cabo en este sistema operativo.  Redd es un ejecutor remoto, y el desarrollo debe llevarse a cabo en su computadora, sea cual sea el sistema operativo.  Quien tenga Linux es el m√°s f√°cil, pero qui√©n est√° acostumbrado a Windows (no me gustaba mucho WIN 3.1, pero me vi obligado a trabajar, pero en alg√∫n momento cuando WIN95 OSR2 se acostumbr√≥, y ahora es in√∫til luchar contra √©l, es m√°s f√°cil de aceptar) , esos pueden continuar liderando el desarrollo en √©l. <br><br>  Como mi amistad con Linux no funcion√≥, no dar√© instrucciones paso a paso para configurar el entorno, pero me limitar√© a las palabras generales.  Qui√©n trabaje con este sistema operativo ser√° suficiente para eso, y para el resto ... Cr√©ame, es m√°s f√°cil contactar a los administradores del sistema.  Al final, hice exactamente eso.  Pero no obstante. <br><br>  Debe descargar e instalar Quartus Prime Programmer and Tools de la misma versi√≥n que su entorno de desarrollo.  Si las versiones no coinciden, puede haber sorpresas.  Pas√© toda la tarde para comprender este hecho.  Por lo tanto, solo descargue la herramienta de la misma versi√≥n que el entorno de desarrollo. <br><br>  Despu√©s de la instalaci√≥n, ingrese el directorio donde se instal√≥ el programa, el subdirectorio bin.  En general, el archivo m√°s importante debe ser jtagconfig.  Si lo ejecuta sin argumentos (por cierto, solicit√© persistentemente ingresar ./jtagconfig y solo as√≠), se mostrar√° una lista de programadores disponibles en el sistema y los FPGA conectados a ellos.  Deber√≠a haber un USB Blaster.  Y el primer problema que arroja el sistema es que no hay suficientes derechos de acceso para trabajar con USB.  Aqu√≠ se describe c√≥mo resolverlo sin recurrir al sudo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">radiotech.kz/threads/nastrojka-altera-usb-blaster-v-ubuntu-16-04.1244</a> <br><br>  Pero aqu√≠ hay una lista de dispositivos que se muestran.  Ahora deber√≠as escribir: <br><pre><code class="plaintext hljs">./jtagconfig --enableremote &lt;password&gt;</code> </pre> <br>  despu√©s de lo cual se inicia el servidor, accesible desde cualquier lugar de la red. <br><br>  Todo estar√≠a bien, pero el firewall del sistema no permitir√° que nadie vea este servidor.  Una verificaci√≥n en Google mostr√≥ que para cada tipo de Linux (de los cuales hay muchos), los puertos en el firewall se abren a su manera, y se deben lanzar tantos hechizos que prefiero contactar a los administradores. <br>  Tambi√©n vale la pena considerar que si jtagd no se registr√≥ en la ejecuci√≥n autom√°tica, cuando abra el acceso remoto, se le informar√° que es imposible establecer una contrase√±a.  Para evitar que esto suceda, jtagd debe iniciarse no mediante jtagconfig, sino antes. <br><br>  En general, el chamanismo es sobre el chamanismo.  Perm√≠tanme arreglar la tesis: <br><ul><li>  el puerto entrante 1309 debe estar abierto en el sistema. Qu√© protocolo, no entend√≠ completamente, por confiabilidad, puede abrir tcp y udp; </li><li>  al iniciar jtagconfig sin argumentos, se debe mostrar el USB Blaster y el FPGA conectado, y no un mensaje de error; </li><li>  Antes de abrir un trabajo remoto, se debe ejecutar jtagd con suficientes derechos.  Si ya se ha lanzado jtagd con derechos insuficientes, su proceso debe completarse antes de un nuevo comienzo; de lo contrario, no tendr√° lugar un nuevo inicio; </li><li>  En realidad, el acceso remoto se abre con la l√≠nea <pre> <code class="plaintext hljs">jtagconfig --enableremote &lt;password&gt;</code> </pre> </li></ul><br>  Existe, por supuesto, una ruta similar que pasa por la interfaz GUI, pero es m√°s l√≥gico hacer todo por lotes.  Por lo tanto, describ√≠ una versi√≥n por lotes.  Cuando se han completado todas estas tesis (y los administradores del sistema las han completado), lanzamos el programador en nuestra m√°quina, vemos un mensaje sobre la falta de equipo.  Haga clic en Configuraci√≥n de hardware: <br><img src="https://habrastorage.org/webt/cj/bq/jh/cjbqjhzydanq__godqnyhq8_ah8.png"><br><br>  Vaya a la pesta√±a Configuraci√≥n de JTAG y haga clic en Agregar servidor: <br><img src="https://habrastorage.org/webt/xn/36/8a/xn368ajq_d5kjx-nxyyvculmpus.png"><br><br>  Ingrese la direcci√≥n de red de Redd (la tengo 192.168.1.100) y la contrase√±a: <br><img src="https://habrastorage.org/webt/kd/ro/7y/kdro7ya9kr8od0uwvcv6hycn0eu.png"><br><br>  Nos aseguramos de que la conexi√≥n haya sido exitosa. <br><br>  Pas√© tres vacaciones de mayo para lograr esto, y luego los administradores decidieron todo. <br><img src="https://habrastorage.org/webt/8h/gp/x0/8hgpx0r19klfwbp7fqd0atfesvq.png"><br><br>  Cambie a la pesta√±a Configuraci√≥n de hardware, abra la lista desplegable y seleccione el programador remoto all√≠: <br><img src="https://habrastorage.org/webt/-2/cf/te/-2cfteubqycs6lr1h8bniz92epi.png"><br><br>  Todo, ahora se puede usar.  El bot√≥n de inicio est√° desbloqueado. <br><img src="https://habrastorage.org/webt/a_/9m/t9/a_9mt9509lhs8muotyfcxh9wwtw.png"><br><br><h2>  El primer "firmware" </h2><br>  Pues bien.  Para que el art√≠culo tenga un valor pr√°ctico real, analicemos el "firmware" m√°s simple realizado con los m√©todos anteriores.  Lo m√°s simple que realmente logr√© implementar para el complejo es una prueba del chip SDRAM.  Aqu√≠ en este ejemplo y pr√°ctica. <br><br>  Hay varios n√∫cleos de aficionados para admitir SDRAM, pero todos se activan de alguna manera complicado.  Y dar cuenta de todos los trucos es trabajo.  Intentaremos usar soluciones listas para usar que se puedan insertar en el sistema inform√°tico NIOS II, por lo que utilizaremos el controlador est√°ndar SDRAM.  El n√∫cleo en s√≠ se describe en el documento <b>Embedded Peripherals IP User Guide</b> , y se dedica mucho espacio en la descripci√≥n al cambio de reloj para SDRAM en relaci√≥n con el reloj del n√∫cleo.  Se dan c√°lculos y f√≥rmulas te√≥ricas complejas, pero no se informa particularmente qu√© hacer.  Se puede encontrar qu√© hacer en el documento <b>Uso de la SDRAM en la placa DE0 de Altera con Verilog Designs</b> .  En el curso del an√°lisis, aplicar√© el conocimiento de este documento. <br><br>  Estar√© desarrollando en la versi√≥n gratuita de Quartus Prime 17.0.  Me concentro en esto, ya que durante la asamblea, me dicen que en el futuro, el n√∫cleo del <b>controlador SDRAM</b> ser√° expulsado de la versi√≥n gratuita.  Si esto ya sucedi√≥ en su entorno de desarrollo, nadie se molestar√° en descargar la versi√≥n gratuita 17 e instalarla en una m√°quina virtual.  El trabajo principal se realiza donde sea que est√© acostumbrado, y el firmware para Redd con SDRAM est√° en la versi√≥n 17.  Bueno, eso es si usas las opciones gratuitas.  Nadie amenaz√≥ con echarlo de los pagados todav√≠a.  Pero estaba distra√≠do.  Crea un nuevo proyecto: <br><img src="https://habrastorage.org/webt/qv/sw/eq/qvsweqv-lktrkcs5keaxu8q_5se.png"><br><br>  Llam√©moslo SDRAM_DEMO.  El nombre debe recordarse: voy a llevar a cabo un desarrollo s√∫per r√°pido, por lo que el sistema del procesador deber√≠a estar en el nivel superior, sin ninguna capa Verilog.  Y para que esto suceda, el nombre del sistema del procesador debe coincidir con el nombre del proyecto.  As√≠ que recu√©rdalo. <br><img src="https://habrastorage.org/webt/fv/yf/-p/fvyf-p3vwrjspjlvvd5tqdm2ndi.png"><br><br>  De acuerdo con los valores predeterminados en unos pocos pasos, llegamos a la elecci√≥n de un cristal.  Seleccionamos el EP4CE10E22C7 utilizado en el complejo. <br><img src="https://habrastorage.org/webt/n6/du/8e/n6du8ejpw_xysdx7dui4f_rc2qi.png"><br><br>  En el siguiente paso, por costumbre, elijo modelar en ModelSim-Altera.  Hoy no modelaremos nada, pero todo puede ser √∫til.  Es mejor desarrollar tal h√°bito y seguirlo: <br><img src="https://habrastorage.org/webt/ym/on/v2/ymonv28mmot9o4frulumjznujk8.png"><br><br>  El proyecto est√° creado.  Vaya inmediatamente a la creaci√≥n del sistema de procesador (Herramientas-&gt; Dise√±ador de plataforma): <br><img src="https://habrastorage.org/webt/qv/tb/t8/qvtbt8vbulg78qybfcpdb1jqaja.png"><br><br>  Hemos creado un sistema que contiene un reloj y un m√≥dulo de reinicio: <br><img src="https://habrastorage.org/webt/xg/bz/o3/xgbzo3yoi-jrtmaiqhd_fz1vp_q.png"><br><br>  Pero como ya mencion√©, se requiere un reloj especial para el n√∫cleo SDRAM.  Por lo tanto, el m√≥dulo est√°ndar se tira sin piedad <br><img src="https://habrastorage.org/webt/2e/yv/_0/2eyv_0ufhrwtnap8vdyryftspus.png"><br><br>  Y en su lugar, agregue el Programa de la Universidad-&gt; Sistema y Reloj SDRAM para el bloque de placas de la serie DE: <br><img src="https://habrastorage.org/webt/ho/tf/nd/hotfndwnreutxuoycv3rh-lhz_m.png"><br><br>  En las propiedades, seleccione DE0-Nano, ya que la inspiraci√≥n para el circuito de conmutaci√≥n SDRAM se extrajo de esta placa de pruebas: <br><img src="https://habrastorage.org/webt/lc/0f/tl/lc0ftl82cyh0yjpj4baklxmyddc.png"><br><br>  Comenzamos a rellenar nuestro sistema de procesador.  Por supuesto, lo primero que debe agregar es el n√∫cleo del procesador en s√≠.  D√©jalo ser Procesador y perif√©ricos-&gt; Procesadores integrados-&gt; Procesador NIOS II. <br><img src="https://habrastorage.org/webt/28/sl/n4/28sln4t0khej0gnfh9v9honohu4.png"><br><br>  Para √©l, todav√≠a no completamos ninguna propiedad.  Simplemente haga clic en Finalizar, aunque hayamos formado una serie de mensajes de error.  Hasta ahora, no hay equipos que eliminen estos errores. <br><br>  Ahora agregue la SDRAM real.  Interfaces y controladores de memoria-&gt; SDRAM-&gt; Controlador SDRAM. <br><img src="https://habrastorage.org/webt/ov/ro/fk/ovrofkityrsnw3vcttpjnwcwhzw.png"><br><br>  Aqu√≠ tenemos que aferrarnos a completar las propiedades.  Seleccione el microcircuito m√°s cercano similar en la organizaci√≥n de la lista y haga clic en Apppy.  Sus propiedades caen en los campos Perfil de memoria: <br><img src="https://habrastorage.org/webt/de/hv/e_/dehve_t_smpdsm3ailji3mhf0u8.png"><br><br>  Ahora cambiamos el ancho del bus de datos a 16, el n√∫mero de l√≠neas de direcci√≥n a 13 y las columnas a 9. <br><img src="https://habrastorage.org/webt/2m/7h/0o/2m7h0otrg1pjp_jchcdmfa1uzvg.png"><br><br>  Todav√≠a no estoy corrigiendo los tiempos, quiz√°s en el futuro esta recomendaci√≥n cambie. <br>  El sistema procesador implica un programa.  El programa debe almacenarse en alg√∫n lugar.  Probaremos el chip SDRAM.  Por el momento, no podemos confiar en ella.  Por lo tanto, para almacenar el programa, agregue memoria basada en el bloque RAM FPGA.  Funciones b√°sicas-&gt; Memoria en chip-&gt; Memoria en chip (RAM o ROM): <br><img src="https://habrastorage.org/webt/ry/ot/-e/ryot-emahnalpamwnkyn1xwcihc.png"><br><br>  Volumen ... Bueno, que sea de 32 kilobytes. <br><img src="https://habrastorage.org/webt/mk/jc/gb/mkjcgbjb57ibhy0xeob8mg84nfo.png"><br><br>  Esta memoria debe estar cargando desde alg√∫n lugar.  Para que esto suceda, marque la casilla Habilitar archivo de inicializaci√≥n no predeterminado e ingrese alg√∫n nombre de archivo significativo.  Digamos firmware.hex: <br><img src="https://habrastorage.org/webt/bh/mf/7a/bhmf7ajkwxp8gixms4bgvy9cp08.png"><br><br>  El art√≠culo ya es complicado, por lo que no lo sobrecargaremos.  Simplemente mostraremos el resultado f√≠sico de la prueba en forma de l√≠neas PASS / FAIL (y veremos el resultado l√≥gico con mi depuraci√≥n JTAG favorita).  Para hacer esto, agregue el puerto GPIO.  Procesadores y perif√©ricos-&gt; Perif√©ricos-&gt; PIO (Parallel IO): <br><img src="https://habrastorage.org/webt/_p/qn/tw/_pqntwmv-ivkyl3zkrwnxcb5wum.png"><br><br>  En las propiedades que configuramos 2 bits, tambi√©n me gusta marcar la casilla para el control individual de bits.  Tambi√©n solo un h√°bito. <br><img src="https://habrastorage.org/webt/a7/bk/j4/a7bkj4ophwwlkeog2laba81emds.png"><br><br>  Tenemos un sistema as√≠ con muchos errores: <br><img src="https://habrastorage.org/webt/w_/4p/o2/w_4po2omowqkf35ge_6-ygmdpl4.png"><br><br>  Comenzamos a eliminarlos.  Para empezar, romperemos el reloj y reiniciaremos.  En el reloj y la unidad de reinicio, las entradas deben desecharse.  Para hacer esto, hay campos que dicen "Haga doble clic para exportar": <br><img src="https://habrastorage.org/webt/bw/gx/w1/bwgxw1cczmqvwzfy3iruazvzzn8.png"><br><br>  Hacemos clic, pero damos nombres m√°s o menos cortos. <br><img src="https://habrastorage.org/webt/be/xc/id/bexcidwci8wqdctpttm_uqnsgwo.png"><br><br>  Tambi√©n debe desechar la salida del reloj SDRAM: <br><img src="https://habrastorage.org/webt/bs/bp/6j/bsbp6j_uz7vlmsnpwvg17cbcqko.png"><br><br>  Ahora dividimos sys_clk en todas las entradas de reloj y reset_source en todas las l√≠neas de reinicio.  Puede golpear suavemente los puntos que conectan las l√≠neas correspondientes con el "mouse", o puede ir a la salida correspondiente, presionar el bot√≥n derecho del mouse y luego ir al submen√∫ Conexiones en el men√∫ desplegable y seleccionar las conexiones all√≠. <br><img src="https://habrastorage.org/webt/8t/2q/v4/8t2qv4btxo3ygqw6q3bjqa23hae.png"><br><br><img src="https://habrastorage.org/webt/ag/as/sz/agasszsc45aobhbaephagupfwja.png"><br><br>  Luego conectamos los neum√°ticos juntos.  Conectamos Data Master a todos los buses de todos los dispositivos, e Inctruction Master a casi todos.  No es necesario conectarlo al bus PIO_0.  A partir de ah√≠, las instrucciones definitivamente no se leer√°n. <br><img src="https://habrastorage.org/webt/rb/fl/av/rbflavgwws5gsdpmtqrrqlp-v0s.png"><br><br>  Ahora puede resolver conflictos de direcciones.  Para hacer esto, seleccione el elemento del men√∫ Sistema-&gt; Asignar direcciones base: <br><img src="https://habrastorage.org/webt/ri/pk/te/ripkteta-ftnbrdgjtyj8cabtq8.png"><br><br>  Y cuando tenemos direcciones, tambi√©n podemos asignar vectores.  Para hacer esto, vaya a las propiedades del n√∫cleo del procesador (ap√∫ntelo, presione el bot√≥n derecho del mouse y seleccione el elemento del men√∫ Editar) y configure los vectores en la Memoria Onchip all√≠.  Simplemente seleccione este tipo de memoria en las listas desplegables, los n√∫meros se sustituir√°n ellos mismos. <br><img src="https://habrastorage.org/webt/aj/om/nn/ajomnnjye5kuskwbtquacdxqbkw.png"><br><br>  No quedan errores.  Pero quedan dos advertencias.  Olvid√© exportar las l√≠neas SDRAM y PIO. <br><img src="https://habrastorage.org/webt/gn/ux/2m/gnux2mk6ikcgsuzin6xbpmyoiwe.png"><br><br>  Como ya hicimos para el restablecimiento y el bloqueo del reloj, haga doble clic en las patas requeridas y as√≠gneles los nombres m√°s cortos (pero comprensibles): <br><img src="https://habrastorage.org/webt/ea/bp/pq/eabppqnnarmd3fqbtytqbfoxteg.png"><br><br>  Todo, no hay m√°s errores o advertencias.  Guarda el sistema.  Adem√°s, el nombre debe coincidir con el nombre del proyecto, de modo que el sistema procesador se convierta en un elemento del nivel superior del proyecto.  ¬øNo has olvidado c√≥mo lo llamamos? <br><img src="https://habrastorage.org/webt/hc/gh/7v/hcgh7vmhtfvsziy7idu7pdgbbuo.png"><br><br><img src="https://habrastorage.org/webt/3w/pl/rr/3wplrrqclfbkfquzndakoonrmdw.png"><br><br>  Bueno, presionamos el bot√≥n m√°s importante: generar HDL. <br><img src="https://habrastorage.org/webt/1t/hm/im/1thmimhmf_xc3taykvi8ct1t6ae.png"><br><br>  Todo, se crea la parte del procesador.  Haz clic en Finalizar.  Se nos recuerda que ser√≠a bueno agregar este sistema de procesador al proyecto: <br><img src="https://habrastorage.org/webt/d1/cf/lv/d1cflvqskri1-jrh1ybgflbmglg.png"><br><br>  A√±adir: <br><img src="https://habrastorage.org/webt/3n/yj/gl/3nyjglrcg5dxdngcghpufpgmot8.png"><br><br>  Y all√≠, usando el bot√≥n Agregar, logramos la siguiente imagen: <br><img src="https://habrastorage.org/webt/wm/jl/p8/wmjlp82jua7ilcvlosa65g98iqy.png"><br><br>  El archivo SIP a√∫n no se ha creado.  S√≠, y no lo necesitamos en el marco de este art√≠culo. <br><br>  Uhhhh  El primer paso ha sido tomado.  Redactamos el proyecto para que el sistema descubra la jerarqu√≠a del proyecto y las patas utilizadas.  Los errores de compilaci√≥n no dan miedo.  Solo en la versi√≥n gratuita del entorno, se crearon n√∫cleos que funcionan solo mientras el adaptador JTAG est√° conectado.  Pero en el complejo Redd, siempre est√° conectado, ya que est√° divorciado en una junta com√∫n, es decir, no tenemos nada que temer.  Entonces ignoramos estos errores. <br><img src="https://habrastorage.org/webt/0b/hk/jo/0bhkjo904iqlqnjcpaf-iinssba.png"><br><br>  Ahora volvamos a la descripci√≥n del n√∫cleo SDRAM.  Dice que la l√≠nea CKE no se usa y siempre est√° conectada a la unidad.  De hecho, dentro del marco del complejo, las piernas FPGA no solo son caras, sino un recurso precioso.  Y ser√≠a una tonter√≠a separar la pierna, que siempre est√° en la unidad (y en el tablero DE0-NANO tampoco est√° divorciada).  Habr√≠a una capa Verilog, la cadena correspondiente podr√≠a cortarse all√≠, pero ahorro tiempo (risas nerviosas, mirando el volumen del documento ya obtenido, pero sin guardarlo habr√≠a resultado a√∫n m√°s).  Por lo tanto, no hay capa.  Como ser  Vaya al Editor de tareas.  Est√° en √©l, ya que en Pin Planner, a juzgar por las descripciones, no hay una funcionalidad similar. <br><img src="https://habrastorage.org/webt/wa/mn/li/wamnlimpfzqz8n4xguihx3jciwe.png"><br><br>  Todav√≠a no hay l√≠nea.  Bueno  Crea uno nuevo <br><img src="https://habrastorage.org/webt/nd/hr/b_/ndhrb_1xgzvlhllnqj2zjrrq50i.png"><br><br>  Seleccionamos el siguiente icono: <br><img src="https://habrastorage.org/webt/_c/mg/o5/_cmgo53jkcsq4z4i5lzfdvn_s-a.png"><br><br>  En el sistema de b√∫squeda que configuramos, haga clic en Lista y en los resultados de b√∫squeda encontramos nuestro CKE: <br><img src="https://habrastorage.org/webt/s2/r8/9t/s2r89tiymksz4ohpxv_6mudnqoy.png"><br><br>  Agr√©guelo a la columna derecha, haga clic en Aceptar. <br><img src="https://habrastorage.org/webt/xv/fd/jy/xvfdjyxtnasndf8a_xara0wzpom.png"><br><br>  Obtenemos la siguiente lista: <br><img src="https://habrastorage.org/webt/g7/qn/-k/g7qn-kbokf172_5s4o0gvyjk2fk.png"><br><br>  En el campo amarillo, haga clic en la lista desplegable y busque Pin virtual.  Nosotros elegimos  La amarillez se traslad√≥ a otra celda: <br><img src="https://habrastorage.org/webt/x0/1h/4a/x01h4aaksdrgol8_wyoe3cnwaji.png"><br><br>  All√≠ seleccionamos On: <br><img src="https://habrastorage.org/webt/qw/5b/bl/qw5bblpjq2fswujalhmvlcgpew0.png"><br><br>  Toda la amarillez se ha ido.  Y la cadena ahora est√° marcada como virtual, lo que significa que no requiere una pierna f√≠sica.  Por lo tanto, no podemos asignarlo a la conclusi√≥n f√≠sica de la FPGA.  Cierre el Editor de tareas, abra el Planificador de clavijas.  Puede asignar las piernas, haciendo referencia a la figura, o puede tomar la lista del archivo * .qsf, que es parte del proyecto, que adjuntar√© al art√≠culo. <br><br><img src="https://habrastorage.org/webt/wn/aj/kc/wnajkcjd97ko1cd7hmasi67ifq0.png"><br><br>  Eso es todo, cierre Pin Planner, llevamos a cabo la compilaci√≥n final del proyecto.  El hardware est√° listo, procedemos al desarrollo del software para el sistema de procesador resultante.  Pero el art√≠culo result√≥ tan grande que lo haremos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pr√≥xima vez</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452656/">https://habr.com/ru/post/452656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452642/index.html">La fuerza de la multitud. C√≥mo Chicago desarroll√≥ un robot de basura: un limpiador de r√≠os</a></li>
<li><a href="../452644/index.html">Conferencia de desarrolladores web DevConf X - 21 de junio</a></li>
<li><a href="../452646/index.html">Lo que vio la red neuronal en la primera fotograf√≠a de un agujero negro</a></li>
<li><a href="../452648/index.html">PHP: c√≥mo analizar un archivo XML complejo y no ahogarse en c√≥digo nativo</a></li>
<li><a href="../452652/index.html">Semana de la seguridad 21: un agujero en Whatsapp, una nueva vulnerabilidad en los procesadores Intel, Zero-Day en Windows</a></li>
<li><a href="../452662/index.html">Servidores HPE en Selectel</a></li>
<li><a href="../452664/index.html">Factur√© $ 18,000 por una p√°gina web est√°tica ... y me sal√≠ con la suya</a></li>
<li><a href="../452666/index.html">C√≥mo hacer posibles micropagos en tu aplicaci√≥n</a></li>
<li><a href="../452668/index.html">C√≥mo verificar las cookies para el cumplimiento de GDPR: una nueva herramienta abierta ayudar√°</a></li>
<li><a href="../452670/index.html">¬øQui√©nes son los ingenieros de datos y c√≥mo se convierten?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>