<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐พ ๐จ๐พโ๐ ๐คต๐ฝ ุฃุชูุชุฉ ุนูููุฉ ูุฑุงูุจุฉ ุฌูุฏุฉ ุจูุงูุงุช ุงูุชุฎุฒูู ููุดุฑูุงุช ๐ฉ๐ปโ๐ค ๐ผ ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู Rostelecom ุ ููุง ูู ุงูุญุงู ูู ุฃู ุดุฑูุฉ ูุจูุฑุฉ ุ ููุฌุฏ ูุณุชูุฏุน ุจูุงูุงุช ุฎุงุต ุจุงูุดุฑูุฉ (WCD). WCD ูุฏููุง ูููู ููุชูุณุน ุจุงุณุชูุฑุงุฑ ุ ููุญู ูุจูู ูุงุฌูุงุช ุนุฑุถ ูููุฏุฉ ูุงูุช...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุชูุชุฉ ุนูููุฉ ูุฑุงูุจุฉ ุฌูุฏุฉ ุจูุงูุงุช ุงูุชุฎุฒูู ููุดุฑูุงุช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rostelecom/blog/434542/" style=";text-align:right;direction:rtl"> ูู Rostelecom ุ ููุง ูู ุงูุญุงู ูู ุฃู ุดุฑูุฉ ูุจูุฑุฉ ุ ููุฌุฏ ูุณุชูุฏุน ุจูุงูุงุช ุฎุงุต ุจุงูุดุฑูุฉ (WCD).  WCD ูุฏููุง ูููู ููุชูุณุน ุจุงุณุชูุฑุงุฑ ุ ููุญู ูุจูู ูุงุฌูุงุช ุนุฑุถ ูููุฏุฉ ูุงูุชูุงุฑูุฑ ูููุนุจุงุช ุงูุจูุงูุงุช ุนูู ุฐูู.  ูู ูุฑุญูุฉ ูุง ุ ูุงุฌููุง ุญูููุฉ ุฃู ุงูุจูุงูุงุช ุฐุงุช ุงูุฌูุฏุฉ ุงูุฑุฏูุฆุฉ ุชุชุฏุงุฎู ูุนูุง ุนูุฏ ุนุฑุถ ูุงูุฐุฉ ุ ูุง ุชุชูุงูู ุงููุญุฏุงุช ุงููุงุชุฌุฉ ูุน ูุญุฏุงุช ุฃูุธูุฉ ุงููุตุฏุฑ ูุชุชุณุจุจ ูู ุนุฏู ููู ุงูุนูู.  ุนูู ุณุจูู ุงููุซุงู ุ ุงูุจูุงูุงุช ุฐุงุช ุงูููู ุงูุฎุงููุฉ ูู ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ (ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ) ุบูุฑ ูุชุตูุฉ ุจุจูุงูุงุช ูู ุฌุฏุงูู ุฃุฎุฑู. <br>  ุฑุณู ุชุฎุทูุทู ููุฌุฒ WCD: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd8/4e9/34f/bd84e934f59ab39d8142ed7c18b397a8.png"><br><br>  ููุฏ ููููุง ุฃูู ูุถูุงู ุงูุซูุฉ ูู ุฌูุฏุฉ ุงูุจูุงูุงุช ุ ูุญุชุงุฌ ุฅูู ุนูููุฉ ุชุณููุฉ ููุชุธูุฉ.  ุจุทุจูุนุฉ ุงูุญุงู ุ ุฃุชูุชุฉ ูุงูุณูุงุญ ููู ูู ุงููุณุชููุงุช ุงูุชูููููุฌูุฉ ููุชุฃูุฏ ูู ุฌูุฏุฉ ุงูุจูุงูุงุช ูุชูุงุฑุจูุง ุ ุนููุฏูุง ูุฃูููุง.  ูุชูุฌุฉ ูุฐูู ุ ูููุง ูู ููุช ูุงุญุฏ ุจูุฑุงุฌุนุฉ ุซูุงุซุฉ ููุตุงุช ุฌุงูุฒุฉ ูุฅุฏุงุฑุฉ ุนูููุงุช ุงูุชุณููุฉ ูู ูุฎุชูู ุงูุจุงุฆุนูู ููุชุจูุง ุฃูุธูุฉูุง ุงูุฎุงุตุฉ.  ููุญู ูุดุงุฑู ุชุฌุฑุจุชูุง ูู ูุฐุง ุงูููุตุจ. <br><a name="habracut"></a><br>  ูุนุฑู ุงูุฌููุน ุงูุณูุจูุงุช ุงูุฎุงุตุฉ ุจุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ: ุงูุณุนุฑ ุ ูุงููุฑููุฉ ุงููุญุฏูุฏุฉ ุ ูุงููุฏุฑุฉ ุนูู ุฅุถุงูุฉ ูุฅุตูุงุญ ุงููุธุงุฆู.  ุงูุงูุฌุงุจูุงุช - ุฃุฌุฒุงุก MDM (ุงูุจูุงูุงุช ุงูุฐูุจูุฉ ุ ูุบูุฑูุง) ุ ูุงูุชุฏุฑูุจ ูุงูุฏุนู ูุบููุฉ ุฃูุถุง.  ุจุนุฏ ุชูุฏูุฑ ูุฐุง ุงูุฃูุฑ ุ ูุณููุง ุนูููุฉ ุงูุดุฑุงุก ูุฑูุฒูุง ุนูู ุชุทููุฑ ุญููููุง. <br><br>  ุชุชู ูุชุงุจุฉ ุฌููุฑ ูุธุงููุง ูู Python ุ ููุชู ูุชุงุจุฉ ูุงุนุฏุฉ ุจูุงูุงุช ุงูุจูุงูุงุช ุงูุฃูููุฉ ูุชุฎุฒูู ูุชุณุฌูู ูุชุฎุฒูู ุงููุชุงุฆุฌ ูู Oracle.  ููุงู ุงูุนุฏูุฏ ูู ุงูููุชุจุงุช ูุจูุซูู ุ ูุณุชุฎุฏู ุงูุญุฏ ุงูุฃุฏูู ุงูุถุฑูุฑู ูุงุชุตุงูุงุช Hive (pyhive) ู GreenPlum (pgdb) ู Oracle (cx_Oracle).  ูุง ููุจุบู ุฃู ูููู ุชูุตูู ููุน ุขุฎุฑ ูู ุงููุตุฏุฑ ูุดููุฉ. <br><br>  ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุงุชุฌุฉ (ูุฌููุนุฉ ุงููุชุงุฆุฌ) ุงูุชู ูุถุนูุง ูู ุฌุฏูู Oracle ุงููุงุชุฌ ุ ุฃุซูุงุก ุชูููู ุญุงูุฉ ุงูุชูููู (SUCCESS / ERROR).  ุชู ุชูููู APEX ุนูู ุงูุฌุฏุงูู ุงููุงุชุฌุฉ ุงูุชู ุชู ูููุง ุชูููู ุชุตูุฑ ุงููุชุงุฆุฌ ุ ููู ููุงุณุจ ููู ูู ุงูุตูุงูุฉ ูุงูุฅุฏุงุฑุฉ. <br><br>  ูุชุดุบูู ุนูููุงุช ุงูุชุญูู ูู ุงููุณุชูุฏุน ุ ูุชู ุงุณุชุฎุฏุงู ุฃูุฑูุณุชุฑุง ุฅูููุฑูุงุชููุง ุงูุชู ุชููู ุจุชูุฒูู ุงูุจูุงูุงุช.  ุนูุฏ ุงุณุชูุงู ุญุงูุฉ ูุฌุงุญ ุงูุชูุฒูู ุ ุณุชุจุฏุฃ ุงูุชุญูู ูู ูุฐู ุงูุจูุงูุงุช ุชููุงุฆููุง.  ูุณูุญ ุงุณุชุฎุฏุงู ูุนููุงุช ุงูุงุณุชุนูุงู ูุจูุงูุงุช WCD ุงูุฃูููุฉ ุจุงุณุชุฎุฏุงู ููุงูุจ ุชุณููุฉ ุงูุงุณุชุนูุงู ููุฌููุนุงุช ุงูุฌุฏุงูู. <br><br>  ุงูุขู ุนู ุงูุชุณููุงุช ุงููููุฐุฉ ุนูู ูุฐู ุงูููุตุฉ. <br><br>  ููุฏ ุจุฏุฃูุง ุจุงูุชุณููุงุช ุงููููุฉ ุ ูุงูุชู ุชูุงุฑู ูููุฉ ุงูุจูุงูุงุช ูู ูุฏุฎูุงุช ูุทุจูุงุช WCD ูุน ุชุทุจูู ุจุนุถ ุงููุฑุดุญุงุช.  ูุฃุฎุฐ ููู ctl ุงูุฐู ุฌุงุก ุฅูู ูุฏุฎูุงุช WCD ุ ููุฑุงุกุฉ ุนุฏุฏ ุงูุณุฌูุงุช ููู ูููุงุฑูุชู ูุน ุงูุฌุฏูู ุนูู Stage ODL ู / ุฃู Stage ODS (1 ุ 2 ุ 3 ูู ุงูุฑุณู ุงูุชุฎุทูุทู).  ูุชู ุชุนุฑูู ูุนูุงุฑ ุงูุชุญูู ูู ุงููุณุงูุงุฉ ุจูู ุนุฏุฏ ุงูุณุฌูุงุช (ุงูุนุฏ).  ุฅุฐุง ุชูุงุฑุจุช ุงููููุฉ ุ ูุฅู ุงููุชูุฌุฉ ูู ุงููุฌุงุญ ุ ูุง - ุงูุฎุทุฃ ูุงูุชุญููู ุงููุฏูู ููุฎุทุฃ. <br><br>  ุชูุชุฏ ุณูุณูุฉ ุงูุชุณููุงุช ุงูุชูููุฉ ูุฐู ุ ููุงุฑูุฉ ุจุนุฏุฏ ุงูุณุฌูุงุช ุ ุฅูู ุทุจูุฉ ADS (8 ูู ุงูุฑุณู ุงูุชุฎุทูุทู).  ูุชู ุชุบููุฑ ุงููุฑุดุญุงุช ุจูู ุงูุทุจูุงุช ุ ูุงูุชู ุชุนุชูุฏ ุนูู ููุน ุงูุชุญููู - DIM (ูุชุงุจ ูุฑุฌุนู) ุ HDIM (ูุชุงุจ ูุฑุฌุนู ุชุงุฑูุฎู) ุ FACT (ุฌุฏุงูู ุงูุชุฑุงูู ุงููุนููุฉ) ุ ุฅูุฎ - ููุฐูู ุนูู ุฅุตุฏุงุฑ SCD ูุงูุทุจูุฉ.  ูููุง ุงูุชุฑุจูุง ูู ุทุจูุฉ ุงูุนุฑุถ ุ ุฎูุงุฑุฒููุงุช ุงูุชุตููุฉ ุงูุฃูุซุฑ ุชุทูุฑุง ุงูุชู ูุณุชุฎุฏููุง. <br><br>  ุชู ุฅุฌุฑุงุก ูุญุต ุชููู ุฃูุถูุง ุนูู ุงููุฏุฎูุงุช ูู Python ุ ุงูุชู ุชูุชุดู ุงูุชูุฑุงุฑุงุช ูู ุงูุญููู ุงูุฑุฆูุณูุฉ.  ูู GreenPlum ูุฏููุง ุ ุงูุญููู ุงูุฑุฆูุณูุฉ (PK) ุบูุฑ ูุญููุฉ ุถุฏ ุงูุชูุฑุงุฑุงุช ุจูุงุณุทุฉ ุฃุฏูุงุช ูุธุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุฐูู ูููุง ุจูุชุงุจุฉ ุจุฑูุงูุฌ Python ุงูุฐู ููุฑุฃ ุญููู ุงูุฌุฏูู ุงูุฐู ุชู ุชุญูููู ูู ุงูุจูุงูุงุช ุงูุฃูููุฉ ูู PK ููููู ุจุฅูุดุงุก ุจุฑูุงูุฌ ูุตู SQL ูุชุญูู ูู ุนุฏู ูุฌูุฏ ูุฃุฎุฐ ุนูููุง.  ุชุณูุญ ููุง ูุฑููุฉ ุงูููุฌ ุจุงุณุชุฎุฏุงู PK ุงููููู ูู ุญูู ูุงุญุฏ ุฃู ุนุฏุฉ ุญููู ุ ููู ุฃูุฑ ูุฑูุญ ููุบุงูุฉ.  ุชูุชุฏ ูุฐู ุงูุชุณููุฉ ุฅูู ุทุจูุฉ STG ADS. <br><br><pre style=";text-align:right;direction:rtl"><code class="python hljs">unique_check  <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime log_tmstmp = datetime.now().strftime(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args, context)</span></span></span><span class="hljs-function">:</span></span> tab = args[<span class="hljs-number"><span class="hljs-number">0</span></span>] data = [] fld_str = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: sql = <span class="hljs-string"><span class="hljs-string">"""SELECT 't_'||lower(table_id) as tn, lower(column_name) as cn FROM src_column@meta_data WHERE  table_id = '%s' and is_primary_key = 'Y'"""</span></span> % (tab,) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fld <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> context[<span class="hljs-string"><span class="hljs-string">'ora_get_data'</span></span>](context[<span class="hljs-string"><span class="hljs-string">'ora_con'</span></span>], sql): fld_str = fld_str + (fld_str <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">","</span></span>) + fld[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fld_str: config = context[<span class="hljs-string"><span class="hljs-string">'script_config'</span></span>] con_gp = context[<span class="hljs-string"><span class="hljs-string">'pg_open_con'</span></span>](config[<span class="hljs-string"><span class="hljs-string">'user'</span></span>], config[<span class="hljs-string"><span class="hljs-string">'pwd'</span></span>], config[<span class="hljs-string"><span class="hljs-string">'host'</span></span>], config[<span class="hljs-string"><span class="hljs-string">'port'</span></span>], config[<span class="hljs-string"><span class="hljs-string">'dbname'</span></span>]) sql = <span class="hljs-string"><span class="hljs-string">"""select %s as pkg_id, 't_%s' as table_name, 'PK fields' as column_name, coalesce(sum(cnt), 0) as NOT_UNIQUE_PK, to_char(current_timestamp, 'YYYY-MM-DD HH24:MI:SS') as sys_creation from (select 1 as cnt from edw_%s.t_%s where %s group by %s  having count(*) &gt; 1 ) sq; """</span></span> % (context[<span class="hljs-string"><span class="hljs-string">"package"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'0'</span></span>,tab.lower(), args[<span class="hljs-number"><span class="hljs-number">1</span></span>], tab.lower(), (context[<span class="hljs-string"><span class="hljs-string">"package"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-string"><span class="hljs-string">"package_id = "</span></span> + context[<span class="hljs-string"><span class="hljs-string">"package"</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"1=1"</span></span>), fld_str ) data.extend(context[<span class="hljs-string"><span class="hljs-string">'pg_get_data'</span></span>](con_gp, sql)) con_gp.close() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [[(context[<span class="hljs-string"><span class="hljs-string">"package"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>),<span class="hljs-string"><span class="hljs-string">'t_'</span></span>+tab.lower(), <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, log_tmstmp]] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: sys.exit(do_check([sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]], {}))</code> </pre> <br>  <i>ุงูุชูุฑุฏ ุงููุตุงูุญุฉ ุจูุซูู ุฑูุฒ ุงููุซุงู.</i>  <i>ูุชู ุชูููุฐ ุงูููุงููุฉ ูููู ูุนููุงุช ุงูุงุชุตุงู ููุถุน ุงููุชุงุฆุฌ ูู ุงูุฌุฏูู ุงููุงุชุฌ ุจูุงุณุทุฉ ูุญุฏุฉ ุงูุชุญูู ูู ุจูุซูู.</i> <br><br>  ูุชู ุจูุงุก ุงููุตุงูุญุฉ ูุนุฏู ูุฌูุฏ ููู ูุงุฑุบุฉ (NULL) ุจุดูู ูุดุงุจู ูุชูู ุงูุณุงุจูุฉ ููุฐูู ูู ุจูุซูู.  ููุฑุฃ ูู ุญููู ุจูุงูุงุช ุชุนุฑูู ุงูุชุญููู ุงูุชู ูุง ูููู ุฃู ุชุญุชูู ุนูู ููู ูุงุฑุบุฉ (ูุงุฑุบุฉ) ูุงูุชุญูู ูู ููุฆูุง.  ูุชู ุงุณุชุฎุฏุงู ุงููุตุงูุญุฉ ูุจู ุทุจูุฉ DDS (6 ูู ุงูุฑุณู ุงูุชุฎุทูุทู ุงูุฃูู). <br><br>  ุนูุฏ ูุฏุฎู ุงูุชุฎุฒูู ุ ูุชู ุฃูุถูุง ุชุญููู ุงุชุฌุงู ุญุฒู ุงูุจูุงูุงุช ุงูุชู ุชุตู ุฅูู ุงููุฏุฎูุงุช.  ูุชู ุฅุฏุฎุงู ููุฏุงุฑ ุงูุจูุงูุงุช ุงููุณุชููุฉ ุนูุฏ ูุตูู ุญุฒูุฉ ุฌุฏูุฏุฉ ูู ุฌุฏูู ุงููุญููุธุงุช.  ูุน ุญุฏูุซ ุชุบููุฑ ูุจูุฑ ูู ูููุฉ ุงูุจูุงูุงุช ุ ูุชููู ุงูุดุฎุต ุงููุณุคูู ุนู ุงูุฌุฏูู ู SI (ูุธุงู ุงููุตุฏุฑ) ุฅุดุนุงุฑูุง ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูู ุงูุฎุทุท) ุ ููุฑู ุฎุทุฃ ูู APEX ูุจู ุฃู ุชุฏุฎู ุญุฒูุฉ ุงูุจูุงูุงุช ุฅูู ุงููุณุชูุฏุน ุ ูุชูุชุดู ุณุจุจ ุฐูู ูุน SI. <br><br>  ุจูู STG (STAGE) _ODS ู ODS (ุทุจูุฉ ุงูุจูุงูุงุช ุงูุชุดุบูููุฉ) (3 ู 4 ูู ุงูุฑุณู ุงูุชุฎุทูุทู) ุ ุชุธูุฑ ุญููู ุงูุญุฐู ุงูููู (ูุคุดุฑ ุงูุญุฐู = delete_ind) ุ ูุตุญุชูุง ุงูุชู ูุชุญูู ูููุง ุฃูุถูุง ุนู ุทุฑูู ุงุณุชุนูุงูุงุช SQL.  ูุฌุจ ูุถุน ุนูุงูุฉ ุนูู ุงููุฏุฎูุงุช ุงูููููุฏุฉ ุงููุญุฐููุฉ ูู ูุธุงู ุงููุซุงุฆู ุงูุฑุณููุฉ. <br><br>  ูู ุงููุชููุน ุฃู ุชุธูุฑ ูุชูุฌุฉ ุงูุจุฑูุงูุฌ ุงููุตู ููุชุณููุฉ ุฃุฎุทุงุก ุตูุฑูุฉ.  ูู ูุซุงู ุงูุชุณููุฉ ุงูููุฏูุฉ ุ ูุชู ุชูุฑูุฑ ุงููุนููุงุช ~ # PKG_ID # ~ ุนุจุฑ ูุชูุฉ ุงูุชุญูู Python ุ ููุชู ุชุนุจุฆุฉ ุงููุนููุงุช ูู ุงูููุน ~ P_JOIN_CONDITION ~ ู ~ PERIOD_COL ~ ูู ุจูุงูุงุช ุชุนุฑูู ุงูุฌุฏูู ุ ุงุณู ุงูุฌุฏูู ููุณู ~ TABLE ~ ูู ูุนููุงุช ุงูุฅุทูุงู. <br><br>  ูุง ููู ูู ุชุณููุฉ ุงููุนููุงุช.  ูุซุงู ููุฏ ุชูููู SQL ุจูู STG_ODS ู ODS ููููุน HDIM: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> package_id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pkg_id, <span class="hljs-string"><span class="hljs-string">'T_~TABLE~'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> table_name, to_char(<span class="hljs-keyword"><span class="hljs-keyword">current_timestamp</span></span>, <span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(empty_in_ods, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> empty_in_ods, <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(not_equal_md5, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> not_equal_md5, <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(deleted_in_ods, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> deleted_in_ods, <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(not_deleted_in_ods, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> not_deleted_in_ods, max_load_dttm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">max</span></span> (src.package_id) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> package_id,    <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> tgt.md5 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> empty_in_ods,    <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> src.md5&lt;&gt;tgt.md5 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> tgt.~PK~ <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> tgt.deleted_ind = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> not_equal_md5,    <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> tgt.deleted_ind = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> src.md5=tgt.md5 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> deleted_in_ods <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> EDW_STG_ODS.T_~<span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>~  src <span class="hljs-keyword"><span class="hljs-keyword">left</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> EDW_ODS.T_~<span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>~  tgt       <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ~P_JOIN_CONDITION~ <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> tgt.active_ind =<span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> ~<span class="hljs-comment"><span class="hljs-comment">#PKG_ID#~ = 0   or src.package_id = ~#PKG_ID#~ ) aa, (select sum (case when src.~PK~ is null then 1 else 0 end) as not_deleted_in_ods, max (tgt.load_dttm) as max_load_dttm from EDW_STG_ODS.T_~TABLE~  src right join EDW_ODS.T_~TABLE~  tgt        on ~P_JOIN_CONDITION~ where tgt.deleted_ind = 0 and tgt.active_ind ='Y'  and tgt.~PERIOD_COL~ between (select min(~PERIOD_COL~) from EDW_STG_ODS.T_~TABLE~ where ~#PKG_ID#~ = 0 or package_id = ~#PKG_ID#~)                           and (select max(~PERIOD_COL~) from EDW_STG_ODS.T_~TABLE~ where ~#PKG_ID#~ = 0 or package_id = ~#PKG_ID#~) ) bb where 1=1</span></span></code> </pre> <br>  ูุซุงู ุนูู ููุฏ ุชุณููุฉ SQL ุจูู STG_ODS ู ODS ูููุน HDIM ูุน ุงุณุชุจุฏุงู ุงููุนููุงุช: <br><br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--------------HDIM_CHECKS--------------- select package_id as pkg_id, 'TABLE_NAME' as table_name, to_char(current_timestamp, 'YYYY-MM-DD HH24:MI:SS'), coalesce(empty_in_ods, 0) as empty_in_ods, coalesce(not_equal_md5, 0) as not_equal_md5, coalesce(deleted_in_ods, 0) as deleted_in_ods, coalesce(not_deleted_in_ods, 0) as not_deleted_in_ods, max_load_dttm from (select    max (src.package_id) as package_id,    sum (case when tgt.md5 is null then 1 else 0 end) as empty_in_ods,    sum (case when src.md5&lt;&gt;tgt.md5 and tgt.ACTION_ID is not null and tgt.deleted_ind = 0 then 1 else 0 end) as not_equal_md5,    sum (case when tgt.deleted_ind = 1 and src.md5=tgt.md5 then 1 else 0 end) as deleted_in_ods from EDW_STG_ODS.TABLE_NAME  src left join EDW_ODS.TABLE_NAME  tgt       on SRC.PK_ID=TGT.PK_ID and tgt.active_ind ='Y' where 709083887 = 0   or src.package_id = 709083887 ) aa, (select sum (case when src.PK_ID is null then 1 else 0 end) as not_deleted_in_ods, max (tgt.load_dttm) as max_load_dttm from EDW_STG_ODS.TABLE_NAME  src right join EDW_ODS.TABLE_NAME  tgt        on SRC.PK_ID =TGT.PK_ID where tgt.del_ind = 0 and tgt.active_ind ='Y'  and tgt.DATE_SYS between (select min(DATE_SYS) from EDW_STG_ODS.TABLE_NAME where 70908 = 0 or package_id = 70908)                           and (select max(DATE_SYS) from EDW_STG_ODS.TABLE_NAME where 70908 = 0 or package_id = 70908) ) bb where 1=1</span></span></code> </pre> <br>  ุจุฏุกูุง ูู ูุธุงู ุงููุซุงุฆู ุงูุฑุณููุฉ (ODS) ุ ูุชู ุงูุญูุงุธ ุนูู ุงูุณุฌู ูู ุงูุฃุฏูุฉ ุ ูุจุงูุชุงูู ุ ูุฌุจ ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุชูุงุทุนุงุช ูุซุบุฑุงุช.  ูุชู ุฐูู ุนู ุทุฑูู ุญุณุงุจ ุนุฏุฏ ุงูููู ุบูุฑ ุงูุตุญูุญุฉ ูู ุงูุณุฌู ููุชุงุจุฉ ุนุฏุฏ ุงูุฃุฎุทุงุก ุงููุงุชุฌ ุฅูู ุงูุฌุฏูู ุงููุงุชุฌ.  ุฅุฐุง ูุงูุช ููุงู ุฃุฎุทุงุก ูุญููุธุงุช ูู ุงูุฌุฏูู ุ ููุฌุจ ุงูุจุญุซ ุนููุง ูุฏูููุง.  ุชุนุชูุฏ ุงููุตุงูุญุฉ ุนูู ููุน ุงูุชูุฒูู - HDIM (ุฏููู ูุฑุฌุน ุงูุณุฌู) ูู ุงูููุงู ุงูุฃูู.  ูุฌุฑู ุชุณููุงุช ุตุญุฉ ุงูุชุงุฑูุฎ ููุฃุฏูุฉ ุญุชู ุทุจูุฉ ADS. <br><br>  ูู ุทุจูุฉ DDS (6 ูู ุงูุฑุณู ุงูุชุฎุทูุทู ุงูุฃูู) ุ ูุชู ุฏูุฌ SIs ูุฎุชููุฉ (ุฃูุธูุฉ ุงููุตุฏุฑ) ูู ุฌุฏูู ูุงุญุฏ ุ ุชุธูุฑ ุฌุฏุงูู HUB ูุฅูุดุงุก ููุงุชูุญ ุจุฏููุฉ ูุฑุจุท ุงูุจูุงูุงุช ูู ุฃูุธูุฉ ูุตุฏุฑ ูุฎุชููุฉ.  ูุญู ูุชูุญุตูุง ุจุญุซูุง ุนู ุงูุชูุฑุฏ ูู ุฎูุงู ูุญุต ุจูุซูู ููุงุซู ูุทุจูุฉ ุงููุณุฑุญ. <br><br>  ูู ุทุจูุฉ DDS ุ ุชุญุชุงุฌ ุฅูู ุงูุชุญูู ูู ุฃูู ุจุนุฏ ุงูุฏูุฌ ูุน ุฌุฏูู HUB ุ ูู ุชุธูุฑ ููู ุงูุฃููุงุน 0 ู -1 ู -2 ูู ุญููู ุงูููุงุชูุญ ุ ููุง ูุนูู ุฑุจุท ุฌุฏูู ุบูุฑ ุตุญูุญ ูููุต ุงูุจูุงูุงุช.  ูููู ุฃู ุชุธูุฑ ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุงูุจูุงูุงุช ุงููุงุฒูุฉ ูู ุฌุฏูู HUB.  ููุฐุง ุฎุทุฃ ููุชุญููู ุงููุฏูู. <br><br>  ุงูุชุณููุงุช ุงูุฃูุซุฑ ุชุนููุฏูุง ูุจูุงูุงุช ุทุจูุฉ ูุงูุฐุฉ ADS (8 ูู ุงููุฎุทุท ุงูุฃูู).  ูู ุฃุฌู ุงูุซูุฉ ุงูุชุงูุฉ ูู ุชูุงุฑุจ ุงููุชูุฌุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุ ูุชู ูุดุฑ ุงูุชุญูู ุจุงุณุชุฎุฏุงู ูุธุงู ูุตุฏุฑ ูุชุฌููุน ูุจูุบ ุงูุฑุณูู ููุง.  ูู ูุงุญูุฉ ุ ููุงู ูุฆุฉ ูู ุงููุคุดุฑุงุช ุงูุชู ุชุดูู ุงููุณุชุญูุงุช ุงูุฅุฌูุงููุฉ.  ูููู ุจุฌูุนูุง ููุฏุฉ ุดูุฑ ูู ููุงูุฐ WCD.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฅููุง ูุฃุฎุฐ ูุฌุงููุน ููุณ ุงูุฑุณูู ูู ูุธุงู ุงููุตุฏุฑ.  ููุงู ุชุจุงูู ูุง ูุฒูุฏ ุนู 1ูช ุฃู ูููุฉ ูุทููุฉ ูุนููุฉ ููุชูู ุนูููุง.  ูุชู ูุถุน ูุฌููุนุงุช ุงููุชุงุฆุฌ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุนู ุทุฑูู ุงูุชุณููุฉ ูู ูุฌููุนุงุช ุจูุงูุงุช ุชู ุฅูุดุงุคูุง ุฎุตูุตูุง ูุชุชููู ุฌุฏุงูู Oracle.  ุชุชู ููุงุฑูุฉ ุงูุจูุงูุงุช ูู ุทุฑููุฉ ุนุฑุถ Oracle.  ุชุตูุฑ ุงููุชุงุฆุฌ ูู APEX.  ุฅู ูุฌูุฏ ูุฌููุนุฉ ูุงููุฉ ูู ุงูุจูุงูุงุช (ูุฌููุนุฉ ุงููุชุงุฆุฌ) ูุชูุญ ููุง ุ ุฅุฐุง ูุงูุช ููุงู ุฃุฎุทุงุก ุ ุฃู ูุนูู ุฃุนูู ููุญูู ุงูุจูุงูุงุช ุงูุชูุตูููุฉ ูููุชูุฌุฉ ุ ููุฌุฏ ููุงููุง ูุญุฏุฏูุง ุญุฏุซ ููู ุงูุชูุงูุถ ุ ูุงุจุญุซ ุนู ุฃุณุจุงุจู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/097/e40/ec3/097e40ec3c68bb49522d89aa228dbd5e.jpg"><br>  <i>ุนุฑุถ ูุชุงุฆุฌ ุงูุชุณููุฉ ูููุณุชุฎุฏููู ูู APEX</i> <br><br>  ูู ุงูููุช ุงูุญุงูู ุ ุญุตููุง ุนูู ุชุทุจูู ุนููู ููุณุชุฎุฏู ุจูุดุงุท ููุชูููู ุจูู ุงูุจูุงูุงุช.  ุจุงูุทุจุน ุ ูุฏููุง ุฎุทุท ูููุงุตูุฉ ุชุทููุฑ ูู ูู ูููุฉ ูููุนูุฉ ุงูุชุณููุงุช ุ ูุชุทููุฑ ุงููุธุงู ุงูุฃุณุงุณู ููุณู.  ุงูุชูููุฉ ุงูุฎุงุตุฉ ุจูุง ุชุณูุญ ููุง ุจุชุบููุฑ ูุชุนุฏูู ุงููุธููุฉ ุจุณุฑุนุฉ ูุงููุฉ. <br><br>  <i>ุฃุนุฏ ูุฐุง ุงูููุงู ูุฑูู Rostelecom ูุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar434542/">https://habr.com/ru/post/ar434542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar434530/index.html">ุงูุชูููู ุงูุงูุชุฑุงุถู ุ ุฅุตูุงุญุงุช ูู LDAP ูุงูุงุจุชูุงุฑุงุช ุงูุฃุฎุฑู ูู Zimbra 8.8.11</a></li>
<li><a href="../ar434532/index.html">ูุตุฉ ูุดุฑูุน ูุงุญุฏ: ุนูุฏูุง ูุง ูููู ูุฏู ูุฑูู ูุทูุฑ ูุจูุฑ</a></li>
<li><a href="../ar434534/index.html">ONYX BOOX "ูุชุงุจู ุงูุฃูู": ูุฑุงุกุฉ ุบูุฑ ูุคุฐูุฉ ูุฃูู ูุงูุทูู</a></li>
<li><a href="../ar434538/index.html">ุงูููุงุญ ูู ุฃุฌู ุงููุถุงุก: ูุง ูุญุฏุซ ูู ุณูู ุงูุฅูุชุฑูุช ุนุจุฑ ุงูุฃููุงุฑ ุงูุตูุงุนูุฉ</a></li>
<li><a href="../ar434540/index.html">ูุงุฐุง ุชูุนู ูุน ุงูุฃุดุฎุงุต ุงูุฐูู ุณูุชู ุงุณุชุจุฏุงููู ุจุงูุฑูุจูุชุงุชุ</a></li>
<li><a href="../ar434544/index.html">"ูุง ูุฑูุฏ ุงูุญุฑุจ" - ููุงุจูุฉ ูุน ูุฏูุฑ Adblock Plus ุจู ููููุงูุฒ</a></li>
<li><a href="../ar434548/index.html">ุฒููุจุงุจูู ุจุงุชุฑููุช ุชููู 5000 ุฏููุงุฑ ูุฑูููุฉ ุงูุจูุฏ ุงูุฃุตูู ุนูู ุฌูุฌู ุณุชุฑูุช ููู</a></li>
<li><a href="../ar434550/index.html">The Insides of Retro Games: Punch-Out for NES</a></li>
<li><a href="../ar434552/index.html">GDG SPb. ูุง ุชูููุง ูู ุงูููุงู ุจู ูู ุบุถูู ุนุงู</a></li>
<li><a href="../ar434558/index.html">ูุฌุชูุน ุงูุฏุนู ุงูุณูุจูุฑู: ุงูุจุฏุงูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>