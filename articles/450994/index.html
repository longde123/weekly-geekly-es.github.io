<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏üèª ‚ò¢Ô∏è üéôÔ∏è Citymobil: un manual para mejorar la disponibilidad en medio del crecimiento del negocio para las nuevas empresas. Parte 5 üìî üíÜ üßëüèø‚Äçü§ù‚Äçüßëüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta es la parte final de la serie que describe c√≥mo estamos aumentando la disponibilidad de nuestro servicio en Citymobil (puede leer la parte anteri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Citymobil: un manual para mejorar la disponibilidad en medio del crecimiento del negocio para las nuevas empresas. Parte 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/450994/"><img src="https://habrastorage.org/getpro/habr/post_images/69d/ea9/db3/69dea9db332a69e8d7f992ab82102329.png"><br><br>  Esta es la parte final de la serie que describe c√≥mo estamos aumentando la disponibilidad de nuestro servicio en Citymobil (puede leer la parte anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ).  Ahora voy a hablar sobre otro tipo de interrupciones y las conclusiones que sacamos sobre ellas, c√≥mo modificamos el proceso de desarrollo, qu√© automatizaci√≥n introdujimos. <br><a name="habracut"></a><br><h2>  1. Mala versi√≥n: error </h2><br>  Este es el tipo m√°s desagradable de interrupciones e incidentes.  El √∫nico tipo que no tiene s√≠ntomas visibles adem√°s de las quejas de los usuarios finales o usuarios comerciales.  Es por eso que tal incidente, especialmente uno peque√±o, puede pasar desapercibido en la producci√≥n por un tiempo. <br><br>  Todos los otros tipos de interrupciones son m√°s o menos similares a "Mala versi√≥n: 500 errores internos del servidor".  Lo √∫nico es que no se desencadenan por una versi√≥n, sino por una carga de trabajo, operaci√≥n manual o un problema de servicio externo. <br><br>  Para describir el m√©todo de lidiar con este tipo de interrupciones, debemos recordar un viejo chiste: <br><br><blockquote>  Un matem√°tico y un f√≠sico tienen la misma tarea: hervir agua.  Se les dan algunas herramientas auxiliares: una estufa, un hervidor de agua, un grifo con agua, f√≥sforos.  Ambos se turnan para llenar el hervidor con agua, encender el gas y comenzar a calentar el hervidor.  Luego la tarea se simplifica: se les da un hervidor de agua, lleno de agua y una estufa que ya est√° encendida.  La tarea es la misma: hervir agua.  El f√≠sico pone la tetera en la estufa.  El matem√°tico vac√≠a la tetera, apaga el gas y dice: "El problema se reduce a uno que ya se ha resuelto".  ¬© anekdotov.net </blockquote><br>  Este tipo de interrupci√≥n debe reducirse a "Mala versi√≥n: 500 errores internos del servidor" a toda costa.  Idealmente, los errores deben registrarse de la misma manera que 500 errores.  Sin embargo, por supuesto, no puede registrar el evento de un error porque, si pudiera, no har√≠a un error en primer lugar. <br><br>  Una de las ideas para rastrear un error es buscar rastros en la base de datos.  Estos rastros nos permiten ver que hay un error y enviar alertas.  ¬øC√≥mo podemos ayudar a esto?  Comenzamos a investigar cada gran error y a encontrar soluciones: ¬øqu√© tipo de monitoreo / alerta por SMS se puede crear para que este error se revele como un error 500 de inmediato?  Aqu√≠ hay algunos ejemplos. <br><br><h4>  1.1.  Ejemplo de una interrupci√≥n causada por un error </h4><br>  De repente, recib√≠amos una gran cantidad de quejas de nuestros usuarios: los pedidos pagados a trav√©s de Apple Pay no pod√≠an cerrarse.  Comenzamos nuestra investigaci√≥n;  El problema se reprodujo en el entorno de prueba.  Se encontr√≥ la causa ra√≠z: actualizamos el formato de la fecha de vencimiento de las tarjetas de cr√©dito porque fue modificado por un servicio de procesamiento de pagos, pero no lo hicimos correctamente para los pagos a trav√©s de Apple Pay;  por lo tanto, todos los pagos de Apple Pay fueron rechazados.  Lo arreglamos tan pronto como supimos sobre el problema, lo implementamos y el problema desapareci√≥.  Sin embargo, este problema estuvo en vivo durante 45 minutos. <br><br>  A ra√≠z de este problema, monitoreamos una serie de pagos fallidos de Apple Pay y creamos alertas por SMS e IVR con un umbral distinto de cero (dado que el servicio considera que algunos pagos fallidos son normales; por ejemplo, si un cliente no tiene dinero en su cuenta o su tarjeta de cr√©dito est√° bloqueada).  Desde ese momento, nos enterar√≠amos inmediatamente del cruce del umbral.  Si una nueva versi√≥n presenta alg√∫n problema en el procesamiento de Apple Pay, lo descubriremos de inmediato debido a la supervisi√≥n y revertiremos la liberaci√≥n en 3 minutos (el proceso de reversi√≥n manual se describe en uno de los art√≠culos anteriores).  Por lo tanto, sol√≠an ser 45 minutos de tiempo de inactividad parcial, y ahora son 3 minutos.  Beneficio! <br><br><h4>  1.2.  Otros ejemplos </h4><br>  Un error en la lista de pedidos.  Implementamos una optimizaci√≥n de la lista de pedidos en la aplicaci√≥n del controlador.  El c√≥digo ten√≠a un error.  Como resultado, a veces los conductores vieron la lista de pedidos vac√≠a.  Descubrimos este error por casualidad: uno de los ingenieros estaba jugando con la aplicaci√≥n del controlador y se encontr√≥ con este problema.  Identificamos r√°pidamente el lanzamiento incorrecto y fue revertido de inmediato.  En consecuencia, creamos un gr√°fico de un n√∫mero promedio de pedidos en la lista basado en la informaci√≥n de la base de datos.  Luego miramos este gr√°fico retrospectivamente mes a mes.  Notamos un barranco reciente causado por ese error y creamos una alerta por SMS a trav√©s de una consulta SQL.  Construye este gr√°fico cuando un n√∫mero promedio de pedidos en la lista cruza el umbral inferior que se estableci√≥ en funci√≥n del m√≠nimo para el mes actual. <br><br>  Un error en cachback.  Est√°bamos alterando la l√≥gica del sorteo de devoluci√≥n de dinero del usuario.  Entre otras cosas, lo enviamos al grupo de clientes equivocado.  Se solucion√≥ el problema, se cre√≥ el gr√°fico de devoluci√≥n de dinero regalado;  vimos un aumento dr√°stico y tambi√©n notamos que esto nunca antes hab√≠a sucedido, y creamos una alerta por SMS con un umbral apropiado. <br><br>  De nuevo un error en los pagos.  El nuevo lanzamiento caus√≥ el error: tomar√≠a una eternidad hacer un pedido, el pago con tarjeta no funcionaba, los conductores solicitaron a los clientes que pagaran en efectivo.  Descubrimos el problema a trav√©s de quejas de call center.  Implementamos una soluci√≥n y creamos una alerta para el tiempo de cierre de pedidos con umbrales, descubiertos mediante an√°lisis de gr√°ficos hist√≥ricos. <br><br>  Como puede ver, estamos utilizando el mismo enfoque para hacer frente a todos los incidentes de este tipo: <br><br><ol><li>  Nos enteramos de un problema. </li><li>  Lo solucionamos y encontramos un error en el c√≥digo. </li><li>  Lo arreglamos </li><li>  Descubrimos los rastros en la base de datos (tambi√©n se pueden encontrar rastros en los registros del servidor web o Kibana) que pueden se√±alar los signos del problema. </li><li>  Construimos un gr√°fico de estos rastros. </li><li>  Retrocedemos en el tiempo y observamos los altibajos en el gr√°fico. </li><li>  Seleccionamos un buen umbral para una alerta. </li><li>  Cuando el problema surge nuevamente, nos enteramos de inmediato a trav√©s de una alerta por SMS. </li></ol><br>  Lo bueno de este m√©todo: un gr√°fico y una alerta resuelven todo el gran grupo de problemas (ejemplos de grupos de problemas: los pedidos no se pueden cerrar, las bonificaciones adicionales, los pagos de Apple Pay no pasan, etc.) <br><br>  Finalmente, implementamos alertas y monitoreo para cada gran error como parte de nuestra cultura de ingenier√≠a.  Para no perder esta cultura, la formalizamos solo un poco.  Comenzamos a obligarnos a crear un informe para cada interrupci√≥n.  El informe es un formulario lleno de respuestas a las siguientes preguntas: causa ra√≠z, c√≥mo lo solucionamos, impacto comercial, conclusiones.  Todos los campos son obligatorios.  Entonces, tuvimos que concluir si nos gust√≥ o no.  Este cambio de proceso obviamente se escribi√≥ en lo que se debe hacer y lo que no. <br><br><h2>  2. Kotan </h2><br>  Nuestro nivel de automatizaci√≥n de procesos estaba aumentando, y decidimos que era hora de crear una interfaz web que mostrara el estado actual del proceso de desarrollo.  Llamamos a esta interfaz web "Kotan" (de la palabra rusa "roll", "roll out" :-) <br><br>  "Kotan" tiene la siguiente funcionalidad: <br><br>  <b>Lista de incidentes</b> .  Contiene la lista de todos los activados en alertas pasadas, lo que requiera una reacci√≥n humana inmediata.  Para cada incidente registramos la hora en que comenz√≥, la hora en que termin√≥ (si ya termin√≥), el enlace a un informe (si el incidente termin√≥ y hay un informe) y el enlace de la gu√≠a de alertas para ver qu√© tipo de alerta este incidente pertenece a <br><br>  <b>El directorio de alertas</b> .  Esta es pr√°cticamente una lista de todas las alertas.  Para aclararlo, la diferencia entre una alerta y un incidente es la siguiente: la alerta es como una clase, mientras que el incidente es un objeto.  Por ejemplo, "la cantidad de 500 errores es mayor que 1" es la alerta.  Y "el n√∫mero de 500 errores es mayor que 1 y ocurrieron en esta fecha, en este momento, duraron tanto", es un incidente.  Cada alerta se agrega al sistema manualmente a trav√©s del proceso descrito anteriormente despu√©s de que se resuelve un problema espec√≠fico que nunca antes ha sido detectado por el sistema de alerta.  Tal enfoque iterativo garantiza un bajo riesgo de alertas falsas positivas (que no requieren ninguna acci√≥n).  El directorio contiene un historial de informes completo para cada tipo de alerta;  eso ayuda a diagnosticar un problema m√°s r√°pido: recibe una alerta, va a "Kotan", hace clic en el Directorio, revisa todo el historial y tiene una idea sobre d√≥nde bucear.  Una clave para una soluci√≥n de problemas exitosa es tener toda la informaci√≥n a la mano.  El enlace al c√≥digo fuente de la alerta (para saber con certeza de qu√© situaci√≥n se trata esta alerta).  Una descripci√≥n escrita de los mejores m√©todos actuales para combatir esta alerta. <br><br>  <b>Informes</b>  Estos son todos los informes en la historia.  Cada informe tiene enlaces para todos los incidentes con los que est√° asociado (a veces los incidentes vienen en grupos; la causa ra√≠z es la misma, y ‚Äã‚Äãcreamos un informe para todo el grupo), la fecha en que se escribi√≥ este informe, el indicador de confirmaci√≥n de la soluci√≥n del problema y la mayor√≠a importante: la causa ra√≠z, c√≥mo se solucion√≥, el impacto en los negocios, las conclusiones. <br><br>  <b>Lista de comida para llevar</b> .  Cada conclusi√≥n tiene una nota que indica si se ha implementado, si la implementaci√≥n a√∫n est√° por llegar o si no es necesaria (con una explicaci√≥n de por qu√© no). <br><br><h2>  3. ¬øQu√© ha cambiado en el proceso de desarrollo de software? </h2><br>  Un componente cr√≠tico de la mejora de la disponibilidad es un proceso de desarrollo de software.  El proceso est√° cambiando constantemente.  El objetivo de tales cambios es disminuir la posibilidad de incidentes.  Las decisiones para enmendar el proceso no deben tomarse de manera abstracta, sino que deben basarse en la experiencia, los hechos y los n√∫meros.  El proceso no debe construirse de manera direccional hacia abajo, sino de abajo hacia arriba con la participaci√≥n activa de todos los miembros del equipo, ya que muchos jefes de todo el equipo son mejores que un jefe de un gerente.  El proceso debe ser seguido y monitoreado;  de lo contrario, no tiene sentido tenerlo.  Los miembros del equipo deben corregirse entre s√≠ en caso de divergencia: ¬øqui√©n m√°s lo har√≠a por ellos?  Debe haber una automatizaci√≥n m√°xima cuidando las funciones principales, ya que un humano comete errores constantemente, especialmente en el trabajo creativo. <br><br>  Para estar seguros de que cada incidente tiene resultados, hemos hecho lo siguiente: <br><br><ul><li>  Cada alerta bloquea autom√°ticamente los lanzamientos. </li><li>  Cuando recibimos una alerta de cierre (un mensaje de texto que indica que el incidente ha terminado), no desbloqueamos los comunicados de inmediato, sino que nos ofrecen crear un informe sobre el accidente. </li><li>  Un informe debe contener la siguiente informaci√≥n: la causa ra√≠z de un accidente, c√≥mo se solucion√≥, el impacto comercial, las conclusiones. </li><li>  El informe fue escrito por el equipo que resolvi√≥ el problema.  Los armados con la informaci√≥n completa sobre el accidente. </li><li>  Las versiones se bloquean autom√°ticamente hasta que se crea y aprueba dicho informe.  Eso motiva al equipo a concentrarse r√°pidamente y crear un informe justo despu√©s de que se solucione un accidente. </li><li>  El informe debe ser aprobado por alguien que no est√© en el equipo, para asegurarse de que contiene toda la informaci√≥n necesaria para comprenderlo. </li></ul><br>  Al hacerlo, nosotros, por un lado, logramos autodisciplina para guardar cada incidente en la historia, y por otro, proporcionamos un control automatizado.  Ahora es imposible no sacar conclusiones o no escribir un informe. <br><br><h2>  4. En lugar de un ep√≠logo </h2><br>  En lugar de un ep√≠logo, perm√≠tanme resumir r√°pidamente lo que cambiamos en el proceso de desarrollo de software para disminuir una cantidad de viajes perdidos. <br><br><div class="scrollable-table"><table><tbody><tr><th>  ¬øQu√© cambiamos? <br></th><th>  ¬øPor qu√© lo cambiamos? <br></th></tr><tr><td>  Comenzamos a mantener el registro de accidentes. <br></td><td>  Tener comida para llevar y prevenir futuros accidentes. <br></td></tr><tr><td>  Creamos una autopsia para cada gran interrupci√≥n (la que tiene muchos viajes perdidos). <br></td><td>  Para aprender c√≥mo solucionar y solucionar r√°pidamente tales interrupciones en el futuro. <br></td></tr><tr><td>  Creamos el archivo Do's and Dont's. <br></td><td>  Compartir las pepitas de la sabidur√≠a con todos los ingenieros. <br></td></tr><tr><td>  Solo un lanzamiento por cada cinco minutos. <br></td><td>  Para reducir la duraci√≥n de la resoluci√≥n de problemas. <br></td></tr><tr><td>  Primero, implementamos c√≥digo en un servidor web de baja prioridad y solo entonces, en todos los dem√°s. <br></td><td>  Para reducir el impacto de una mala versi√≥n. <br></td></tr><tr><td>  Reversi√≥n automatizada de mal lanzamiento. <br></td><td>  Para reducir el impacto de una mala versi√≥n. <br></td></tr><tr><td>  Sin despliegues durante una interrupci√≥n. <br></td><td>  Para acelerar la resoluci√≥n de problemas. <br></td></tr><tr><td>  Escribimos sobre liberaciones y accidentes en el chat grupal. <br></td><td>  Para acelerar la resoluci√≥n de problemas. <br></td></tr><tr><td>  Monitoreamos los gr√°ficos durante 3 minutos despu√©s de cada lanzamiento. <br></td><td>  Para acelerar la resoluci√≥n de problemas. <br></td></tr><tr><td>  Alertas por SMS e IVR sobre problemas. <br></td><td>  Para acelerar la resoluci√≥n de problemas. <br></td></tr><tr><td>  Cada error (especialmente uno grande) es seguido por monitoreo y alertas. <br></td><td>  Para acelerar la resoluci√≥n de problemas de una situaci√≥n similar en un futuro. <br></td></tr><tr><td>  Revisi√≥n de optimizaci√≥n de c√≥digo. <br></td><td>  Para reducir la posibilidad de accidentes debido a la sobrecarga de bases de datos. <br></td></tr><tr><td>  Optimizaci√≥n de c√≥digo regular (con MySQL slow.log como entrada). <br></td><td>  Para reducir una serie de accidentes debido a los "huevos de Pascua". <br></td></tr><tr><td>  Cada accidente debe tener una comida para llevar. <br></td><td>  Reduce la posibilidad de tal accidente en el futuro. <br></td></tr><tr><td>  Cada accidente debe tener una alerta. <br></td><td>  Reduce la duraci√≥n de la resoluci√≥n de problemas y la reparaci√≥n de dichos accidentes en el futuro. <br></td></tr><tr><td>  Bloqueo autom√°tico de nuevas versiones despu√©s de un accidente antes de que se redacte y apruebe un informe. <br></td><td>  Aumenta la posibilidad de tener comida para llevar adecuada, reduciendo as√≠ la posibilidad de tales accidentes en el futuro. <br></td></tr><tr><td>  "Kotan" - herramienta automatizada para mejorar el servicio. <br></td><td>  Reduce la duraci√≥n de las interrupciones;  Reduce la posibilidad de ocurrencia de interrupciones. <br></td></tr><tr><td>  Directorio de incidentes. <br></td><td>  Reduce la duraci√≥n de la resoluci√≥n de problemas <br></td></tr></tbody></table></div><br>  Gracias por leer hasta el final.  ¬°Buena suerte a tu negocio!  ¬°Le deseo menos pedidos perdidos, transacciones, compras, viajes y todo lo que sea crucial para usted! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450994/">https://habr.com/ru/post/450994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450984/index.html">Te invitamos a la segunda transmisi√≥n de Camunda BPM Meetup Raiffeisenbank UPD</a></li>
<li><a href="../450986/index.html">Los nombres largos son demasiado largos</a></li>
<li><a href="../450988/index.html">Atajos de JavaScript: una gu√≠a b√°sica</a></li>
<li><a href="../450990/index.html">Puente del mundo .NET al mundo JavaScript</a></li>
<li><a href="../450992/index.html">¬øC√≥mo descargar JDK 12? Explicaci√≥n de 7 caracteres</a></li>
<li><a href="../450996/index.html">Marcos de juego: tendencias de JavaScript en 2019</a></li>
<li><a href="../450998/index.html">Una breve historia de texturas 3D en juegos</a></li>
<li><a href="../451002/index.html">Ensamblaje de computadora personalizado, Parte 1</a></li>
<li><a href="../451004/index.html">Tecnosfera. Conferencia "Proyecto de TI y gesti√≥n de productos"</a></li>
<li><a href="../451006/index.html">El resumen de eventos para profesionales de recursos humanos en el campo de TI para mayo de 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>