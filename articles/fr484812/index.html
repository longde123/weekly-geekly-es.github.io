<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê∞ üèùÔ∏è üç∏ Mon exp√©rience avec Plesk üëáüèº ü§Ωüèº ü•ê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux partager quelques impressions sur la n√©cessit√© ou l'inutilit√© d'une telle chose comme un panneau de contr√¥le pour un projet Web commercial √† s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mon exp√©rience avec Plesk</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484812/">  Je veux partager quelques impressions sur la n√©cessit√© ou l'inutilit√© d'une telle chose comme un panneau de contr√¥le pour un projet Web commercial √† serveur unique avec un administrateur √† temps partiel.  L'histoire a commenc√© il y a quelques ann√©es lorsque des connaissances de connaissances m'ont demand√© d'accompagner l'achat d'une entreprise - un site d'actualit√©s - d'un point de vue technique.  Il √©tait n√©cessaire de comprendre un peu ce qui fonctionnait, de s'assurer que tous les d√©tails n√©cessaires √©taient transf√©r√©s sous la forme et le volume appropri√©s, et de d√©terminer strat√©giquement ce qui pouvait √™tre am√©lior√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h_/nh/e1/h_nhe1ce2n1r02nwfk-v2coszz0.png"></div><br>  L'accord a eu lieu, le violoniste n'√©tait plus n√©cessaire.  La fin.  Pas vraiment. <br><a name="habracut"></a><br>  Le site tournait sur un VMk dual-core 4-gig sur Linode, sur un Debian5 moussu avec une disponibilit√© de 400 jours et une telle liste de paquets non mis √† jour.  Partie Web sur Samopisny TsMSke, nginx, php5.3 FPM, mysql r√©gl√© Percona.  En principe, cela a fonctionn√©. <br><br>  Parall√®lement aux conversations avec moi, le nouveau propri√©taire recherchait un programmeur pour amener le projet √† ses attentes.  Je l'ai trouv√©.  Le programmeur a √©valu√© le trafic et les volumes et a d√©cid√© qu'il √©tait en mesure d'optimiser et de g√©rer les co√ªts.  Il a migr√© l'ensemble du site vers un h√©bergement partag√© de 700 roubles sous le contr√¥le de son habituel IS **** er.  Quelques jours plus tard, encore un appel du propri√©taire: "tout ralentit et il semble que nous soyons cass√©s".  J'ai essay√© de r√©soudre la situation via le panneau, mais apr√®s quelques tentatives infructueuses pour changer la version du PCP ou du gestionnaire de fcgi en fpm, j'ai abandonn√© et j'ai grimp√© dans le shell.  L√†, j'ai trouv√© le d√©bogage inclus, qui brillait sur tout Internet avec un mot de passe d'un muscle, 777 sur certains dossiers qui, √† ce moment-l√†, craquaient d'un flot de malvari et de jeux similaires.  Le propri√©taire s'est rendu compte et a d√©cid√© qu'il √©tait mal d'√©conomiser sur l'h√©bergement, le programmeur et l'administrateur, qui regarderaient d'un ≈ìil sur la fa√ßon dont les choses se passent. <br><br>  Nous allons √† RuVDS.  Un peu plus proche que le Linode britannique, et si vous voulez soudainement stocker des donn√©es personnelles et tout cela, vous n'avez pas √† vous d√©placer ailleurs.  Le projet devant √™tre √©tendu, ils ont pris le VMKU "pour la croissance": 4 c≈ìurs, 8 Go de m√©moire, 80 Go de disque.  Ce n'est pas que je ne sais pas comment utiliser les configs nginx avec mes mains, je n'ai tout simplement pas eu l'enthousiasme pour faire ce projet si intimement (voir ci-dessus √† propos du temps partiel).  Parce que - mettez Plesk (ici, je vais omettre les d√©tails d'installation, car ils ne sont g√©n√©ralement pas l√†: j'ai lanc√© l'installateur, d√©fini le mot de passe de l'administrateur, entr√© la cl√© - tout), √† l'√©poque c'√©tait 17.0.  Les param√®tres de base fonctionnent raisonnablement hors de la bo√Æte, il y a fail2ban et les derni√®res versions disponibles de PHP, nginx. <br><br>  Il vaut probablement la peine de s'arr√™ter et d'expliquer pourquoi.  Comme je fais rarement de telles choses, et je n'ai pas d'outils sp√©ciaux et un ensemble de blancs pour chaque cas, il √©tait clair qu'une sorte d'automatisation des choses de base √©tait n√©cessaire, premi√®rement, rapidement, deuxi√®mement en toute s√©curit√©, troisi√®mement toutes les meilleures pratiques quelqu'un a d√©j√† mis en ≈ìuvre. <br><br>  Alors, partez.  Il a √©conomis√© du temps d√©cemment, le red√©marrage du site sur le nouveau serveur s'est av√©r√© presque instantan√©.  Il restait √† jouer avec la configuration musculaire, en lui donnant la moiti√© de la m√©moire et en augmentant le nombre de pools de tampons, et en donnant √† nginx la moiti√© des c≈ìurs (Splash ne touche pas aux configurations globales), et aller dans le shell pendant quelques jours pour consulter les statistiques de mysqltuner.  Oui, et j'ai achet√© un ImunifyAV payant dans le catalogue d'extension pour se d√©barrasser des malvari inond√©s.  Il y avait quelque 11 000 fichiers infect√©s.  L'abomination est que des morceaux de code obscurcis vers√©s dans la statique, et le brosser avec vos mains seraient compl√®tement ennuyeux.  Au d√©but, j'ai essay√© ClamAV, mais il s'est av√©r√© qu'il n'a pas pris de telles choses, mais ImunifyAV le pouvait.  De plus, les fichiers durcis restent en √©tat de marche, juste un morceau avec le malware est supprim√©. <br><br>  L'arithm√©tique est simple: 50 $ par mois pour VMKu, 10 $ pour Splash (en fait moins, car vous l'avez achet√© imm√©diatement pendant un an avec une remise de deux mois) et 3 $ pour un antivirus.  Ou beaucoup de valises d'argent pour mon temps, que je d√©pensais d'abord sur le serveur, ratissant manuellement ces √©curies.  Le propri√©taire est tr√®s satisfait de cet alignement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bed/f5c/257/bedf5c257f2211a4c9a20db4f3662354.png"></div><br>  Pendant ce temps, ils ont trouv√© un nouveau programmeur.  Nous nous sommes mis d'accord avec lui sur la r√©partition des responsabilit√©s, avons cr√©√© un sous-domaine pour la version de test et les travaux ont commenc√©.  Il a vu une nouvelle version du site sur Laravel, et j'ai regard√© fail2ban%). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/567/ed3/0eb/567ed30eba271841e9ba2ca1628c908c.png"></div><br>  Fait int√©ressant, le flux des curieux ne s'arr√™te pas, et il y a toujours une centaine d'adresses dans la liste des interdits.  L'effet est int√©ressant: en particulier, g√©n√©ralement, lorsque je vais dans le shell, je vois environ 20000-30000 tentatives infructueuses pour entrer via SSH lors du message d'accueil.  Avec fail2ban activ√©, environ 70. Effort investi: 0. Malheureusement, il y a eu une goutte de goudron.  Par d√©faut, WAF (modsecurity) √©tait ¬´semi-activ√©¬ª: en mode d√©couverte.  Autrement dit, il a √©crit une activit√© suspecte dans le journal, mais n'a en fait pris aucune mesure.  Et fail2ban a lu sans discernement tous les journaux, selon les prisons incluses, et a tremp√© tout ce qui bougeait.  Nous avons ainsi banni la moiti√© de la r√©daction: D.  J'ai d√ª d√©sactiver cette prison et mettre les adresses IP n√©cessaires dans la liste blanche pour plus de fiabilit√©.  L'effort est investi: piquez deux fois avec la souris et apprenez aux r√©dacteurs √† dire leur adresse IP. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2a/59f/5d9/e2a59f5d93ccd9a0345d82631cfed146.png"></div><br>  Ce que le programmeur a imm√©diatement aim√©, c'est la possibilit√© de t√©l√©charger des bases de donn√©es directement dans le panneau et un acc√®s rapide √† phpMyAdmin <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cca/0ef/a51/cca0efa516535e771efaa46456b891b9.png"></div><br>  Ce que j'ai aim√© - journaux et sauvegardes.  Les journaux sont √©crits et se tournent hors de la bo√Æte;  les sauvegardes sont configur√©es tr√®s simplement.  Dans le temps le plus lent, une sauvegarde compl√®te est effectu√©e, quelque part en 10 concerts, puis tous les jours en incr√©mental, 200 m√©gaoctets, pendant une semaine.  Restauration granulaire vers un fichier ou une base de donn√©es sp√©cifique.  Si vous devez restaurer √† partir d'incr√©ments, vous n'avez pas besoin de vous tortiller d'abord avec le plein et le restaurateur de la cha√Æne enti√®re, Splash fait tout lui-m√™me.  Vous pouvez t√©l√©charger des sauvegardes n'importe o√π: sur ftp, sur dropbox, s3 bucket, google drive, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f1/46d/d83/9f146dd83e49e565596513bb1b32bea2.png"></div><br>  Jour F: le programmeur a finalement termin√© le nouveau moteur, nous l'avons vers√© dans le produit, import√© les anciennes donn√©es et nous sommes assis pour choisir la couleur de leur future Maserati.  Nous choisissons toujours. <br><br>  Les premiers probl√®mes ont commenc√©.  Le nouveau site √©tait cens√© √™tre plus lourd que l'ancien, mais le v√©ritable avantage √©tait que Yandex.Zen √©tait utilis√© entre autres pour attirer du trafic, qui rattrapait les visiteurs par lots.  Le site √©tait pli√© √† 150 connexions simultan√©es (je ne parle pas de RPS, car je ne l'ai pas mesur√©).  Nous avons commenc√© √† pousser les boutons et les boutons rotatifs dans la zone des param√®tres php_fpm: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c0/f96/3b3/8c0f963b3771a9452e8dee1ea82ac6cc.png"></div><br>  Op, d√©tient d√©j√† 500 connexions.  Au fur et √† mesure que la carte de cr√©dit est appliqu√©e aux moyens de promotion, les vagues de trafic deviennent plus importantes.  Le prochain jalon est de 1000 connexions simultan√©es.  Ici, j'ai d√ª m'abstenir de coder et regarder le muscle de mon √¢me.  Le splash n'a pas aid√©, mais ils ne s'y attendaient pas vraiment.  Ils ont activ√© le journal des requ√™tes lentes, suspendu les index sur la base de donn√©es, supprim√© les requ√™tes inutiles du code, r√©examin√© la configuration mysql sur les conseils de mysqltuner. <br><br>  Nouveau d√©fi - 2000 connexions.  Je viens de sortir la version Plesk 17.8, dans laquelle, entre autres, la mise en cache nginx viss√©e.  Mise √† jour (√©tonnamment facile).  Nous essayons.  √áa marche!  Et puis ils sont entr√©s doucement, le flux Yandex.Zen a cess√© de fonctionner.  Le site fonctionne, le flux ne fonctionne pas.  Le flux ne fonctionne pas, pas de trafic.  L'atmosph√®re se r√©chauffe.  Sous la pression des circonstances et le manque d'imagination, je suis imm√©diatement mont√© sur nginx et j'ai trouv√© ce que je cherchais.  Il s'av√®re qu'√† un moment donn√©, le stupide nginx a mis en cache la 500e erreur √† la vol√©e en r√©ponse au Yandex get feed.xml.  Corrig√© en ajoutant des exceptions aux param√®tres de cache: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c5/168/69b/8c516869b5e3fdb0ef6c79774d829940.png"></div><br>  Il est clair que le propri√©taire a toujours besoin, les vagues augmentent lentement.  Pendant que nous traitons avec, mais nous avons commenc√© √† exp√©rimenter avec memcached √† l'avance, car Laravel le prend en charge presque hors de la bo√Æte.  Je ne voulais pas, en quelque sorte, mettre le memcached avec mes mains pour "jouer", alors j'ai install√© l'image de docker.  Directement du panneau. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07e/083/342/07e083342590e63f033747c7dfe7f013.png"></div><br>  Eh bien, je mens, je devais aller dans le shell et mettre le module √† travers pecl.  Directement selon les <a href="https://support.plesk.com/hc/en-us/articles/115001544133-Unable-to-install-memcached-PHP-module-memcached-support-requires-libmemcached">instructions</a> .  Il n'y a rien √† dire sur l'augmentation du d√©bit, il n'y a pas eu suffisamment d'afflux importants.  Le moteur du site a d√©marr√© sur localhost: 11211, les statistiques sont affich√©es, la m√©moire est en train de manger.  Si vous l'aimez, voyons quoi faire ensuite.  Soit vous laissez les choses de cette fa√ßon, soit vous placez le ¬´vrai¬ª dans l'axe.  Ou essayez redis de la m√™me mani√®re <br><br>  Ensuite, je devais joindre une liste de diffusion.  Pas de relais, juste une authentification smtp.  J'ai obtenu une adresse postale, gr√¢ce √† ses d√©tails via PHP, nous faisons la newsletter. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/107/53e/269/10753e269e8ea0736ba771a506e04c28.png"></div><br>  Il n'y a pas si longtemps, Plesk Obsidian (18.0) est sorti, mis √† jour en fonction de l'exp√©rience pass√©e sans crainte.  Tout s'est tr√®s bien pass√©, il n'y a m√™me rien √† dire.  De l'agr√©able - l'interface s'est consid√©rablement am√©lior√©e en qualit√©, s'est modernis√©e et est devenue plus pratique √† certains endroits.  Cool Monitoring avanc√© sur Grafana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/921/e9d/230/921e9d230ede253edc7e479a3a435c94.png"></div><br>  Je ne l'ai pas encore compris, mais vous pouvez, par exemple, configurer des alertes pour n'importe quel param√®tre dans l'e-mail.  Au propri√©taire, lol. <br><br>  Puisque je parle de l'interface, elle est adaptative et fonctionne tr√®s bien au t√©l√©phone.  Au d√©but, alors que nous essayions de trouver les param√®tres PHP optimaux et d'autres choses, cela a beaucoup aid√©.  Et surtout quand un programmeur enthousiaste au travail fait quelque chose √† 23 heures, et que je bois de la vodka dans un bain avec un enthousiasme au travail, et que j'ai urgemment besoin de changer quelque chose. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/865/dbc/dd9/865dbcdd9b452936c3450cae4067bbc9.png"></div><br>  Oh au fait.  Dans l'image, PHP Composer est apparu.  Nous n'avons pas encore jou√© avec lui, mais, disons, pour le m√™me Laravel, il peut enregistrer quelques connexions dans le shell et un certain temps pour installer les d√©pendances.  Le m√™me syst√®me existe pour Node.JS et Ruby. <br><br>  Avec SSL, tout est simple.  Si le domaine r√©sout o√π il devrait √™tre, Let's Encrypt se fait en un seul clic et est mis √† jour par lui-m√™me, √† la fois sur le domaine lui-m√™me, sur les sous-domaines et m√™me sur les services de messagerie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/e59/c84/ffee59c848d2cdc814028a527fbeeda7.png"></div><br>  Plesk lui-m√™me, en tant que logiciel, est actuellement assez agr√©able et stable.  Se met √† jour et l'Axe est silencieux, consomme peu de ressources, fonctionne correctement.  Je ne me souviens m√™me pas que quelque part j'ai march√© sur quelque chose, ce qui serait clairement un d√©faut du produit.  Bien s√ªr, il y avait des probl√®mes, mais ils √©taient soit dus √† l'imperfection de la configuration, soit quelque part √† la jonction, donc il n'y avait rien √† redire.  Les impressions de travailler avec Splash sont g√©n√©ralement agr√©ables.  Ce qui manque, et il faut le comprendre, c'est tout (tout) clustering.  Ni LB ni HA.  Vous pouvez essayer, mais il y aura tellement d'efforts investis qu'il vaut mieux faire quelque chose de diff√©rent au d√©part. <br><br>  Je pense que vous pouvez r√©sumer.  Dans le cas o√π il n'y a pas d'administrateur, ou ce n'est pas suffisant, lorsque le prix de l'h√©bergement et du ou des sites qui y sont h√©berg√©s d√©passe, disons 100u.e. cela vaut la peine de choisir d'embaucher un administrateur √† temps partiel, ou d'acheter un logiciel et d'obtenir un administrateur pour les "demi-bosses", ou de ne pas le d√©marrer du tout - cela a vraiment du sens.  Du point de vue de l'administrateur distant - la m√™me chose.  10 $ par mois, et permet de gagner du temps et donne de la flexibilit√© dans le travail pour une tr√®s grande quantit√©.  Si, par exemple, on me demande fortement de prendre un projet similaire sous l'aile, j'insisterai sur le transport jusqu'√† Plesk. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484812/">https://habr.com/ru/post/fr484812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484798/index.html">Pourquoi le tri rapide est-il vraiment lent? Nouvelle m√©thode de tri de tableau</a></li>
<li><a href="../fr484800/index.html">Analyseur de code source de Microsoft Application Inspector</a></li>
<li><a href="../fr484802/index.html">Mode d'autodestruction: d√©composition de la capsule endoscopique due √† la lumi√®re</a></li>
<li><a href="../fr484804/index.html">Que chiffrer dans un syst√®me d'entreprise? Et pourquoi faire √ßa?</a></li>
<li><a href="../fr484806/index.html">Diff√©rence entre cPanel et Plesk Obsidian</a></li>
<li><a href="../fr484814/index.html">6. Mise en route de Fortinet v6.0. Filtrage Web et contr√¥le des applications</a></li>
<li><a href="../fr484816/index.html">Utilisation de hooks d'op√©rations pour sauvegarder des fichiers sur macOS √† la vol√©e</a></li>
<li><a href="../fr484818/index.html">Le livre "C ++. La pratique de la programmation multithread "</a></li>
<li><a href="../fr484820/index.html">FAQ.Net - un programme de prise de notes gratuit pour Windows avec une conception mise √† jour</a></li>
<li><a href="../fr484822/index.html">Blazor: comment emp√™cher un composant de tomber malade ou deux approches pour s√©parer le code du balisage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>