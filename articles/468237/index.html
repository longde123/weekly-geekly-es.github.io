<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî° üöü üéÄ La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 3 üë©üèæ‚Äç‚öñÔ∏è üßõüèΩ üë®üèæ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Presentamos a su atenci√≥n la tercera parte de la traducci√≥n del material en el camino que ha tomado Dropbox, presentando un sistema para verificar los...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468237/">  Presentamos a su atenci√≥n la tercera parte de la traducci√≥n del material en el camino que ha tomado Dropbox, presentando un sistema para verificar los tipos de c√≥digo Python. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/jl/mz/yu/jlmzyu7qhqkzvqcq-k_qznbk65s.jpeg"></a> <br><br>  ‚Üí Partes anteriores: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segunda</a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Alcanzando 4 millones de l√≠neas de c√≥digo escrito</font> </h2><br>  Otra tarea importante (este fue el segundo problema m√°s popular que preocup√≥ a quienes participaron en encuestas internas) fue aumentar la cantidad de c√≥digo en Dropbox cubierto con verificaciones de tipo.  Intentamos varios enfoques para resolver este problema, desde el crecimiento natural del volumen de la base de c√≥digo escrito hasta el foco de los esfuerzos del equipo mypy en la inferencia de tipos automatizada est√°tica y din√°mica.  Como resultado, parec√≠a que no existe una estrategia ganadora simple, pero pudimos lograr un r√°pido crecimiento en el volumen de c√≥digo anotado combinando muchos enfoques. <br><br>  Como resultado, en nuestro repositorio m√°s grande de Python (con c√≥digo de fondo), el n√∫mero de l√≠neas de c√≥digo anotado ha alcanzado casi 4 millones.  El trabajo de tipeo est√°tico del c√≥digo se llev√≥ a cabo en aproximadamente tres a√±os.  Mypy ahora admite varios tipos de informes de cobertura de c√≥digo que facilitan el monitoreo del progreso de escritura.  En particular, podemos generar informes sobre el c√≥digo con incertidumbres en los tipos, como, por ejemplo, el uso expl√≠cito del tipo <code>Any</code> en anotaciones que no se pueden verificar, o como la importaci√≥n de bibliotecas de terceros en las que no hay anotaciones de tipos.  Como parte de un proyecto para aumentar la precisi√≥n de la verificaci√≥n de tipos en Dropbox, hemos contribuido a mejorar las definiciones de tipo (los llamados archivos stub) para algunas bibliotecas populares de c√≥digo abierto en el repositorio Python centralizado. <br><br>  Hemos implementado (y estandarizado en PEP posteriores) nuevas caracter√≠sticas del sistema de tipos, que nos permiten utilizar tipos m√°s precisos para algunos patrones espec√≠ficos de Python.  Un ejemplo notable de esto es <code>TypeDict</code> , que proporciona tipos para diccionarios similares a JSON que tienen un conjunto fijo de claves de cadena, cada uno de los cuales tiene un valor de su propio tipo.  Continuaremos expandiendo el sistema de tipos.  Probablemente nuestro pr√≥ximo paso ser√° mejorar el soporte para la capacidad de Python de trabajar con n√∫meros. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/91a/311/364/91a3113642c30b04ee935cc424016d17.png"></div><br>  <i><font color="#999999">N√∫mero de l√≠neas de c√≥digo anotado: servidor</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/606/b7c/251/606b7c251a21e1acd55f6bf8efc41d9a.png"></div><br>  <i><font color="#999999">N√∫mero de l√≠neas de c√≥digo anotado: cliente</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af0/149/f38/af0149f383cd8ff599b6e6d590ac1f29.png"></div><br>  <i><font color="#999999">El n√∫mero total de l√≠neas de c√≥digo anotado.</font></i> <br><br>  Aqu√≠ hay una descripci√≥n general de las caracter√≠sticas principales de las acciones que realizamos para aumentar el volumen de c√≥digo anotado en Dropbox: <br><br>  El rigor de la anotaci√≥n.  Aumentamos gradualmente los requisitos para el rigor de anotar el nuevo c√≥digo.  Comenzamos con consejos de linter que suger√≠an agregar anotaciones a los archivos que ya tienen algunas anotaciones.  Ahora requerimos anotaciones de tipo en los nuevos archivos de Python y en la mayor√≠a de los archivos existentes. <br><br>  Escribiendo informes.  Enviamos informes semanales a los equipos sobre el nivel de mecanograf√≠a de su c√≥digo y damos consejos sobre lo que debe anotarse en primer lugar. <br><br>  Popularizando mypy.  Hablamos sobre mypy en varios eventos y nos comunicamos con los equipos para ayudarlos a comenzar a usar anotaciones de tipo. <br><br>  Encuestas  Realizamos encuestas peri√≥dicas a los usuarios para identificar problemas importantes.  Estamos listos para llegar lo suficientemente lejos como para resolver estos problemas (¬°hasta crear un nuevo lenguaje para acelerar mypy!). <br><br>  Rendimiento  Hemos mejorado mucho el rendimiento de mypy mediante el uso del daemon y mypyc.  Esto se hizo para suavizar los inconvenientes que surgen durante el proceso de anotaci√≥n y para poder trabajar con grandes cantidades de c√≥digo. <br><br>  Integraci√≥n con editores.  Hemos creado herramientas para apoyar el lanzamiento de mypy en editores que son populares en Dropbox.  Esto incluye PyCharm, Vim y VS Code.  Esto simplific√≥ enormemente el proceso de anotar el c√≥digo y verificar su rendimiento.  Dichas acciones suelen ser t√≠picas cuando se anota c√≥digo existente. <br><br>  An√°lisis est√°tico  Creamos una herramienta para generar firmas de funciones utilizando herramientas de an√°lisis est√°tico.  Esta herramienta solo puede funcionar en situaciones relativamente simples, pero nos ha ayudado a aumentar la cobertura de tipos con poco esfuerzo. <br><br>  Soporte para bibliotecas de terceros.  Muchos de nuestros proyectos utilizan el kit de herramientas SQLAlchemy.  Utiliza las capacidades din√°micas de Python, que los tipos PEP 484 no pueden modelar directamente.  De acuerdo con PEP 561, creamos el archivo stub correspondiente y escribimos un complemento para mypy ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo abierto</a> ) que mejora el soporte de SQLAlchemy. <br><br><h2>  <font color="#3AC1EF">Las dificultades que encontramos</font> </h2><br>  El camino a 4 millones de l√≠neas de c√≥digo escrito no siempre fue f√°cil para nosotros.  En este camino nos encontramos con muchos agujeros y cometimos algunos errores.  Estos son algunos de los problemas que hemos encontrado.  Esperamos que la historia sobre ellos ayude a otros a evitar tales problemas. <br><br>  Archivos omitidos  Comenzamos comprobando solo una peque√±a cantidad de archivos.  Todo lo que no est√° incluido en el n√∫mero de estos archivos no se verific√≥.  Los archivos se agregaron a la lista de verificaci√≥n cuando aparecieron las primeras anotaciones en ellos.  Si algo se import√≥ de un m√≥dulo ubicado fuera del alcance de la verificaci√≥n, entonces est√°bamos hablando de trabajar con valores de tipo <code>Any</code> , que no se verificaron en absoluto.  Esto condujo a una p√©rdida significativa de precisi√≥n de escritura, especialmente en las primeras etapas de la migraci√≥n.  Este enfoque hasta ahora ha funcionado sorprendentemente bien, aunque era t√≠pico que agregar archivos al √°rea de escaneo revelara problemas en otras partes de la base del c√≥digo.  En el peor de los casos, cuando se combinaron dos √°reas aisladas de c√≥digo, en las cuales, independientemente uno del otro, los tipos ya estaban verificados, result√≥ que los tipos de estas √°reas eran incompatibles entre s√≠.  Esto hizo que fuera necesario realizar muchos cambios en las anotaciones.  Ahora, mirando hacia atr√°s, entendemos que debemos agregar los m√≥dulos b√°sicos de la biblioteca al √°rea de verificaci√≥n de tipo mypy lo antes posible.  Esto har√≠a nuestro trabajo mucho m√°s predecible. <br><br>  Anotando c√≥digo antiguo.  Cuando comenzamos, ten√≠amos alrededor de 4 millones de l√≠neas de c√≥digo Python existente.  Estaba claro que anotar todo este c√≥digo no era tarea f√°cil.  Creamos una herramienta llamada PyAnnotate, que puede recopilar informaci√≥n de tipo durante la ejecuci√≥n de la prueba y puede agregar anotaciones de tipo al c√≥digo en funci√≥n de la informaci√≥n recopilada.  Sin embargo, no notamos una introducci√≥n particularmente extendida de esta herramienta.  Escribir informaci√≥n sobre los tipos era lento, las anotaciones autogeneradas a menudo requer√≠an muchas ediciones manuales.  Pensamos en lanzar autom√°ticamente esta herramienta cada vez que revisa el c√≥digo, o en recopilar informaci√≥n de tipo basada en un an√°lisis de una peque√±a cantidad de solicitudes de red reales, pero decidimos no hacerlo, porque cualquiera de estos enfoques es demasiado arriesgado. <br><br>  Como resultado, se puede notar que la mayor√≠a del c√≥digo fue anotado manualmente por sus propietarios.  Para dirigir este proceso en la direcci√≥n correcta, estamos preparando informes sobre m√≥dulos y funciones especialmente importantes que deben ser anotados.  Por ejemplo, es importante proporcionar anotaciones de tipo con el m√≥dulo de biblioteca utilizado en cientos de lugares.  Pero el antiguo servicio, que est√° siendo reemplazado por uno nuevo, ya no es tan importante.  Tambi√©n estamos experimentando el uso de an√°lisis est√°tico para generar anotaciones de tipo para c√≥digo antiguo. <br><br>  Importaciones en bucle.  Anteriormente, habl√© sobre las importaciones c√≠clicas ("mara√±a de dependencias"), cuya existencia complic√≥ la aceleraci√≥n de mypy.  Adem√°s, tuvimos que trabajar duro para proporcionar a mypy soporte para todo tipo de expresiones idiom√°ticas causadas por estas importaciones c√≠clicas.  Recientemente completamos un importante proyecto de redise√±o del sistema que solucion√≥ la mayor√≠a de los problemas de importaci√≥n c√≠clica de mypy.  Estos problemas, de hecho, surgieron desde los primeros d√≠as del proyecto, desde Alore, el lenguaje educativo al que mypy se orient√≥ originalmente.  La sintaxis de Alore facilita la resoluci√≥n de los problemas de los comandos de importaci√≥n c√≠clicos.  Modern mypy ha heredado algunas limitaciones de su temprana implementaci√≥n ingenua (que funcion√≥ muy bien para Alore).  Python hace que sea dif√≠cil trabajar con importaciones circulares, principalmente debido a la ambig√ºedad de las expresiones.  Por ejemplo, durante una operaci√≥n de asignaci√≥n, se puede determinar un alias de tipo.  Mypy no siempre puede detectar tales cosas hasta que se haya procesado la mayor parte del ciclo de importaci√≥n.  Alore no ten√≠a tales ambig√ºedades.  Las decisiones fallidas tomadas en las primeras etapas del desarrollo del sistema pueden presentar una sorpresa desagradable para un programador despu√©s de muchos a√±os. <br><br><h2>  <font color="#3AC1EF">Resumen: el camino hacia 5 millones de l√≠neas de c√≥digo y nuevos horizontes</font> </h2><br>  El proyecto mypy ha recorrido un largo camino: desde los primeros prototipos hasta un sistema que controla los tipos de c√≥digo de producci√≥n con un volumen de 4 millones de l√≠neas.  A medida que mypy progresaba, las sugerencias de tipo se estandarizaron en Python.  Un poderoso ecosistema ha evolucionado alrededor de escribir c√≥digo Python en estos d√≠as.  Encontr√≥ un lugar para soportar bibliotecas, contiene herramientas auxiliares para IDE y editores, tiene varios sistemas de control de tipo, cada uno de los cuales tiene sus pros y sus contras. <br><br>  A pesar de que la verificaci√≥n de tipos ya se da por sentado en Dropbox, estoy seguro de que todav√≠a vivimos en los albores de escribir c√≥digo Python.  Creo que las tecnolog√≠as de verificaci√≥n de tipos continuar√°n evolucionando y mejorando. <br><br>  Si no ha utilizado verificaciones de tipo en su proyecto de Python a gran escala, debe saber que ahora es un buen momento para comenzar la transici√≥n a la escritura est√°tica.  Habl√© con aquellos que hicieron una transici√≥n similar.  Ninguno de ellos se arrepinti√≥.  El control de tipo convierte Python en un lenguaje que es mucho mejor que "Python normal" para desarrollar proyectos grandes. <br><br>  <b>Estimados lectores!</b>  ¬øUtiliza el control de tipo en sus proyectos de Python? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468237/">https://habr.com/ru/post/468237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468227/index.html">Aceleraci√≥n instagram.com. Parte 1</a></li>
<li><a href="../468229/index.html">Una nota sobre vac√≠o en JavaScript y TypeScript</a></li>
<li><a href="../468231/index.html">¬øEs la seguridad en AEM un problema de plataforma o implementaci√≥n?</a></li>
<li><a href="../468233/index.html">La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 1</a></li>
<li><a href="../468235/index.html">La forma de escribir comprobando 4 millones de l√≠neas de c√≥digo Python. Parte 2</a></li>
<li><a href="../468239/index.html">Elegir la estructura de datos correcta en Swift</a></li>
<li><a href="../468241/index.html">TR-069 en Mikrotik. Prueba de Freeacs como un servidor de autoconfiguraci√≥n para RouterOS</a></li>
<li><a href="../468245/index.html">No necesitamos correcciones de traducci√≥n: nuestro traductor sabe mejor c√≥mo se debe traducir</a></li>
<li><a href="../468251/index.html">No hay futuro</a></li>
<li><a href="../468253/index.html">Control deslizante de imagen simple en CSS y Javascript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>