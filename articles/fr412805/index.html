<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçè üë®üèΩ‚Äçü§ù‚Äçüë®üèª ü•ï Mes √©tapes, mes succ√®s et mes erreurs dans le monde du d√©veloppement de jeu par l'exemple d'un bot de jeu dans Telegram üë† üëåüèæ üî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Je m'appelle Maxim et je veux vous raconter l'histoire de la cr√©ation du projet Wasteland Wars. J'esp√®re que vous serez int√©ress√©, et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mes √©tapes, mes succ√®s et mes erreurs dans le monde du d√©veloppement de jeu par l'exemple d'un bot de jeu dans Telegram</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412805/">  Bonjour √† tous!  Je m'appelle Maxim et je veux vous raconter l'histoire de la cr√©ation du projet Wasteland Wars.  J'esp√®re que vous serez int√©ress√©, et peut-√™tre que cela peut vous aider √† √©viter mes erreurs. <br><a name="habracut"></a><br><h2>  S√©lection de la plateforme </h2><br>  Telegram est une plateforme tr√®s non standard pour cr√©er des jeux en ligne.  Surtout en ce qui concerne les MMORPG.  Je me demandais s'il √©tait possible de cr√©er un produit de qualit√© sur cette plate-forme, et si oui, y aurait-il une demande pour cela.  Donc, en juin 2017, j'ai commenc√© √† d√©velopper Wasteland Wars. <br><br><h2>  Viralit√© </h2><br>  Au d√©but du d√©veloppement, il a √©t√© d√©cid√© de r√©unir un groupe de discussion de mes amis pour un test de jeu.  Apr√®s tout, lorsqu'il s'agissait de l'OMI, les tests seuls √©taient probl√©matiques.  J'ai donc lanc√© le test b√™ta ferm√© du jeu, rendant l'acc√®s au bot √† l'aide de touches uniques.  Ayant g√©n√©r√© ces 10 pi√®ces, je les ai envoy√©es √† mes amis dans TG.  Le syst√®me de r√©f√©rence a d√©j√† √©t√© ajout√© √† ce point, bien qu'il ne fonctionne pas en fait compte tenu des tests cl√¥tur√©s.  Son essence est que pour chaque personne inscrite au jeu selon votre r√©f√©rence.  Link, le joueur obtient +1 √† l'endurance maximale et quelques plafonds (monnaie locale) pour les d√©penses de poche.  Cela a conduit au fait qu'apr√®s 2 semaines depuis le d√©but du PTA, 50 personnes y ont particip√©, et mes messages priv√©s ont √©t√© bloqu√©s avec des demandes de personnes pour leur donner encore 1-2-10 cl√©s pour leurs amis.  Au lieu de g√©n√©rer constamment de nouvelles cl√©s, j'ai d√©cid√© de me concentrer sur la correction des bogues trouv√©s dans les tests et de lancer un test b√™ta ouvert, en vous d√©sinscrivant par cl√©s.  Le premier jour du MBT, 120 personnes se sont inscrites au jeu.  Un mois plus tard, le quotidien en ligne √©tait de 200 √† 250 personnes par jour, et le nombre total de joueurs inscrits approchait 800. Et tout cela sans aucun mouvement de ma part du jeu PR, le jeu est devenu connu exclusivement gr√¢ce au bouche √† oreille et au syst√®me de r√©f√©rence. <br><br><h2>  Fonctionnalit√©s du projet que les joueurs ont appr√©ci√©es </h2><br>  Au cours des tests, les joueurs ont not√© un genre de jeu qui √©tait extr√™mement inhabituel pour ce format, des batailles PVP √† part enti√®re et un syst√®me de pompage d'un joueur sans points de comp√©tence classiques et niveaux.  Mais, ce qui m'a surpris - la plupart des gens ont fait l'√©loge des textes du jeu, notant en particulier la qualit√© de l'humour, les r√©f√©rences √† la culture populaire et aux situations atmosph√©riques, contrastant avec l'humour noir avec leur drame. <br><br><h2>  D√©tails techniques </h2><br>  Les premi√®res difficult√©s li√©es √† la plateforme API Bot sont apparues d√®s les premiers jours de d√©veloppement.  Telegram dispose de 2 syst√®mes principaux pour connecter leurs bots √† votre serveur: les soi-disant longues interrogations et les webhooks.  Le premier implique que votre serveur interrogera constamment Telegram √† un certain intervalle pour les nouvelles demandes, et s'il y en a, il le traitera en renvoyant une r√©ponse de l'API Bot.  La seconde est un peu plus difficile √† impl√©menter - elle consiste dans le fait que votre serveur dit √† Telegram "si vous avez des demandes, d√©posez-les √† cette adresse".  En cons√©quence, pour impl√©menter le bot √† l'aide de la technologie Webhooks, une adresse IP permanente et un certificat SSL sont requis, au moins auto-sign√©s.  Ayant commenc√© le d√©veloppement bas√© sur Long Polling, au d√©but, je n'ai remarqu√© aucun probl√®me associ√© √† cette m√©thode.  Cependant, apr√®s une journ√©e de fonctionnement continu, le bot s'est √©cras√© de mani√®re inattendue.  Le t√©l√©gramme a commenc√© √† renvoyer une erreur lorsqu'il a re√ßu une demande.  Il s'est av√©r√© que ce probl√®me affectait absolument tous les bots bas√©s sur une interrogation longue - le t√©l√©gramme ferme le traitement des demandes du bot apr√®s un certain temps, √† cause duquel vous devez constamment le red√©marrer.  Tout d'abord, j'ai d√©cid√© d'essayer d'automatiser le processus de ¬´r√©animation¬ª du bot en √©crivant un script cron pour v√©rifier le pouls du processus et red√©marrer si le patient ne r√©pondait pas √† un coup de b√¢ton.  Cependant, ce processus de red√©marrages constants a caus√© des inconv√©nients aux joueurs, car  a pris un certain temps et a √©galement r√©initialis√© les minuteurs actuels du jeu.  En cons√©quence, le projet a √©t√© transf√©r√© √† Webhooks et ce probl√®me a imm√©diatement disparu. <br><br>  Plus loin en termes de complexit√© de l'API Bot elle-m√™me, tout √©tait calme.  Jusqu'√† un instant. <br><br>  Le projet prend de l'ampleur, construit son audience et √©volue constamment.  √Ä un moment donn√©, le bot a soudainement commenc√© √† "s'√©mousser" √† la r√©ception de la demande.  Plus pr√©cis√©ment, il y a eu un retard dans la r√©ponse du bot au joueur.  Tout d'abord, je suis mont√© sur le serveur, pensant qu'il avait cess√© de faire face au nombre croissant de demandes.  Mais non, la charge du serveur n'a pas d√©pass√© 30% aux heures de pointe, il n'y a eu aucun probl√®me de m√©moire libre, il n'y a pas eu d'erreurs et d'avertissements dans le journal syst√®me.  Mais les freins ont continu√© de cro√Ætre.  Il s'est av√©r√© que le bot a commenc√© √† se reposer sur la limite de l'API Bot en termes de nombre de demandes simultan√©es.  Au d√©but, j'ai r√©ussi √† r√©duire et √† optimiser le bot pour r√©duire ce montant.  Cependant, au fur et √† mesure que le jeu se propage aux masses, c'est devenu √©vident: tr√®s bient√¥t, le bot atteindra ce plafond et aucune optimisation ne m'aidera.  Ensuite, il a √©t√© d√©cid√© d'√©crire en faveur de Telegram avec une demande d'augmentation des limites sp√©cifiquement pour mon bot.  Et √† ma grande surprise, ils ont r√©pondu d√®s le lendemain, et la limite a √©t√© augment√©e, bien qu'ils n'aient pas nomm√© de nouveau seuil.  De plus, ils m'ont inform√© que le bot repose sur la limite d'un type sp√©cifique de demande - Rappel sur le soi-disant.  Boutons en ligne.  Il s'agit du clavier de Telegram, qui s'affiche sous un message sp√©cifique.  Pour les demandes de texte (y compris celles avec des boutons ordinaires), la limite est beaucoup plus √©lev√©e, et il n'y a pas non plus de limite de 15 secondes pour une r√©ponse du serveur.  Le probl√®me √©tait que 70% de l'interface du jeu √©tait construit sur des boutons en ligne.  J'ai d√ª le traiter compl√®tement pour me d√©barrasser de ce mal, si pratique et beau. <br><br>  Le probl√®me suivant que le projet a rencontr√© √©tait d√©j√† dans mon environnement de d√©veloppement et mon code.  Plus pr√©cis√©ment, dans Python 3 et comment cela fonctionne avec les threads.  Chaque nouveau thread dans Python 3 est cr√©√© avec des variables d'environnement, consommant une grande quantit√© de m√©moire.  Le jeu est plein de minuteries (2 minutes pour basculer entre les emplacements, attendre une bataille, etc.), et les lancer dans des flux s√©par√©s a cr√©√© une fuite de m√©moire.  Au fur et √† mesure que le jeu en ligne se d√©veloppe, la fuite a atteint une √©chelle folle, d√©vorant toute la RAM possible et gonflant la m√©moire restante du serveur SSD.  Bien s√ªr, le probl√®me a √©t√© r√©solu en cr√©ant des files d'attente de minuteries qui sont trait√©es dans un thread pour chaque type. <br><br><h2>  Partie visuelle dans un jeu de texte </h2><br>  L'une des principales caract√©ristiques de Wasteland Wars par rapport √† d'autres jeux similaires dans Telegram √©tait l'introduction de la partie visuelle.  Un avatar interactif du personnage a √©t√© ajout√© au jeu, ainsi qu'un affichage visuel de chaque √©quipement du jeu.  Comme dans les RPG en taille r√©elle sur les plateformes de jeu, un joueur peut habiller son personnage avec une armure diff√©rente, lui donner diff√©rentes armes, puis voir visuellement tous les changements.  Un peu plus tard, j'ai d√©velopp√© cette id√©e, maintenant quand un autre joueur se rencontre dans le jeu, son avatar est √©galement affich√© - de cette fa√ßon, il devient possible de ne pas conna√Ætre le pompage de l'ennemi, d'√©valuer son danger en apparence.  En plus de l'√©quipement, des ¬´masques¬ª sont √©galement affich√©s sur l'avatar - ils peuvent √™tre achet√©s pour un don, ils ne donnent aucun avantage au joueur, mais ils changent son apparence dans l'avatar.  De plus, une carte interactive compl√®te est apparue dans le jeu.  Lorsqu'un emplacement est trouv√©, il est ajout√© au joueur sur la carte. <br><br>  Toutes les images sont affich√©es dans une r√©solution assez basse, suffisante pour comprendre leur contenu.  Cela est d√ª au fait que les avatars et les cartes sont collect√©s √† partir de nombreux √©l√©ments diff√©rents pour chaque joueur, et avec un grand nombre de demandes simultan√©es, leur assemblage en haute r√©solution peut charger consid√©rablement le serveur de jeu. <br><br><h2>  Plans de d√©veloppement de projets </h2><br>  Pour le moment, le jeu est en train d'√™tre copi√© sur Go - ce langage s'est av√©r√© bien mieux adapt√© au d√©veloppement d'un tel projet.  Avoir mon propre serveur Web dans Go et sa vitesse m'ont permis de commencer √† cr√©er ma propre API pour le projet afin de le d√©tacher d'une seule plateforme dans Telegram.  L'API vous permettra de recevoir et de traiter les demandes de n'importe quel client, et toute la logique sera trait√©e uniquement sur le serveur. <br><br>  Ainsi, le d√©veloppement d'un client pour n'importe quelle plate-forme sera aussi simple que le client lui-m√™me, cela √©vitera de nombreuses limitations de Telegram, des difficult√©s √† le bloquer et attirera un grand nombre de nouveaux publics dans le jeu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412805/">https://habr.com/ru/post/fr412805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412795/index.html">Et tirons les conclusions de la discussion de l'article "Qu'est-ce qui ne va pas avec le retour des Geektimes √† Habr"</a></li>
<li><a href="../fr412797/index.html">√Ä propos des dangers du CDN, des services et des polices de Google</a></li>
<li><a href="../fr412799/index.html">Toujours en contact: Mango Talker - messenger et softphone</a></li>
<li><a href="../fr412801/index.html">√âtude: des pirates informatiques volent des millions de dollars en raison de la faible s√©curit√© des √©changes de crypto-monnaie</a></li>
<li><a href="../fr412803/index.html">Un regard plus approfondi sur les diff√©rentes plateformes de contrats intelligents</a></li>
<li><a href="../fr412807/index.html">Notes du fournisseur IoT. Propri√©t√©</a></li>
<li><a href="../fr412809/index.html">Authentification √† deux facteurs sur le site √† l'aide d'un jeton USB. Comment s√©curiser l'acc√®s au portail de services?</a></li>
<li><a href="../fr412811/index.html">C DevTools sur Elbrus: rapports vifs de HolyJS 2018 Piter</a></li>
<li><a href="../fr412813/index.html">En-t√™tes HTTP inutiles</a></li>
<li><a href="../fr412815/index.html">Cl√©s client OpenVPN Web Manager VPNFace Lite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>