<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏏️ 👇🏼 👘 Un proyecto abierto de un módulo de control de motor eléctrico. Tecnología de desarrollo de software 🤟🏾 🤙🏽 🔱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Escribir firmware para los interiores de la electrónica integrada moderna es prácticamente imposible de escribir desde cero. Simplemente no dan tiempo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un proyecto abierto de un módulo de control de motor eléctrico. Tecnología de desarrollo de software</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403525/"><img src="https://habrastorage.org/getpro/geektimes/post_images/f61/dfd/0b2/f61dfd0b289e32b873cb88a6ce541cc5.png"><br>  Escribir firmware para los interiores de la electrónica integrada moderna es prácticamente imposible de escribir desde cero.  Simplemente no dan tiempo para esto.  Por lo tanto, el software para sistemas integrados se basa en <br>  plataformas de software listas para usar - marcos.  Cuanto más desarrollado sea el marco, más rápido será el desarrollo.  Aquí hablaremos sobre el marco que creé específicamente para los módulos de control de motores y que se ha utilizado con éxito durante algún tiempo. <br><a name="habracut"></a><br><h2>  <b>La arquitectura del marco.</b> <br></h2><br>  El marco está diseñado para funcionar en la plataforma abierta del módulo de control de motor universal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DMC v2.0</a> . <br><br>  La arquitectura lógica del marco se puede representar como un diagrama de bloques, como se muestra a continuación.  En el diagrama de flujo, se omite una lista completa de todos los componentes del marco, ya que esto dañaría la claridad, pero para una idea general, creo, la granularidad es suficiente. <br><br> <a href=""><img align="left" width="973" src="https://habrastorage.org/getpro/geektimes/post_images/b68/4a6/a74/b684a6a74fe172cfde9fc7b6dcdd4aec.png"><br clear="left"></a>  <a href=""><em>(Click para ampliar)</em></a> <br><br>  El marco no tiene versiones, está en constante desarrollo, y aquí solo intenté arreglar su estado actual, que está publicado en GitHub. <br><br>  Desde el punto de vista de los módulos de software, el marco contiene las siguientes partes clave: <br><br>  - Un conjunto de módulos de soporte a nivel de aplicación <br>  - Sistema operativo en tiempo real <b>MQX</b> . <br>  - Middleware: <b>sistema de archivos, shell de comandos, pilas de protocolos de comunicación</b> , etc. <br>  - Un paquete de soporte de placa de bajo nivel (BSP), que incluye el <b>acceso a los periféricos</b> de las placas del módulo BLEZ66V1 y el módulo de alimentación. <br>  - Paquete de software para <b>monitoreo, depuración y diagnóstico</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FreeMaster</a> . <br>  - Herramientas de depuración que incluyen <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTT</a> ,</b> rastreo de herramientas <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ITM</a> , registradores,</b> terminal <b>VT100</b> . <br>  - Módulo para <b>generar archivos de</b> parámetros. <br>  - Módulos de códigos fuente generados basados ​​en algoritmos en <b>Matlab</b> . <br><br><h2>  <b>¿Por qué se selecciona MQX?</b> <br></h2><br>  El sistema operativo en tiempo real (RTOS) MQX se conoce desde hace mucho tiempo, pero <br>  apareció en el dominio público hace un par de años.  Freescal subió este sistema operativo antes de que NXP los comprara.  RTOS inicialmente tenía una licencia solo para su uso en microcontroladores Freescale, ahora la licencia también se extiende a los productos NXP.  RTOS sobrevivió a la explosiva popularidad, pasó por varias actualizaciones a la versión 4.2, después de lo cual Freescale decidió volver a comercializar sus versiones posteriores.  Entonces resultaron dos versiones, una abierta y congelada en desarrollo llamada MQX Classic (también conocida como MQX v4.2) y una MQX 5.0 comercial cerrada. <br><br>  En el marco descrito, se utiliza la rama MQX Classic v4.2.  Esta es una versión estable y bien probada.  La licencia permite al desarrollador modificar el código fuente de MQX Classic y usarlo en productos comerciales, sin embargo, no permite la publicación de MQX Classic en forma de fuente.  Pero esto no debería ser un problema, ya que MQX Classic está disponible para descarga gratuita. <br><br>  La estructura de RTOS en términos generales se ve así: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/d89/752/c84/d89752c84e3a24d03198b581116e4f47.png"><br><br><h2>  <b>¿Por qué necesito RTOS?</b> <br></h2><br>  Una aplicación compleja donde, en particular, se requiere control motor es bastante compleja y consta de muchas tareas asincrónicas, cada una con su propio ciclo de repetición y sus eventos de activación y detención.  Si realizamos todas estas tareas en un superciclo, inevitablemente nos encontramos con el problema de retrasar la ejecución de algunas tareas por otras tareas. <br>  Usando RTOS, como MQX, es posible deshacerse de la interdependencia de tareas individuales en el eje de tiempo sin reescribirlas o incluso mirar sus códigos fuente. <br><br>  Por ejemplo, nuestra tarea de registro puede tratar de escribir un mensaje durante el tiempo que desee en una tarjeta SD esperando su respuesta, la tarea de USB puede pasar a transferir una gran cantidad de datos a una computadora, pero al mismo tiempo la tarea PID del algoritmo del motor se realizará estrictamente en un intervalo específico, y la tarea de medición de velocidad la rotación no perderá un solo evento de cambio de señal del codificador. <br><br>  Aunque debo admitirlo, hay otra forma cada vez más popular de deshacerse de la complejidad en un chip: cambiar a multiprocesamiento, pero en este caso RTOS proporcionará un buen servicio. <br><br><h2>  <b>Las principales ventajas de RTOS MQX.</b> <br><br></h2>  - El núcleo del sistema viene con una amplia gama de middleware que incluye un sistema de archivos, pila TCP / IP, pila USB, shell de comandos, etc.  Todo en el código fuente. <br><br>  - Conjuntos BSP listos para usar para diferentes placas, eliminando la necesidad de escribir sus propias bibliotecas de trabajo periférico. <br>  - Documentación detallada en archivos pdf con fácil navegación. <br>  - La presencia de un complemento para el banco de trabajo integrado IDE IAR con información muy detallada sobre las estructuras internas de RTOS es mucho más detallada que para otros RTOS conocidos: uCOS y FreeRTOS. <br>  - Muchos ejemplos de aplicaciones RTOS y casos de prueba. <br><br>  Cuando se habla de RTOS, siempre enfatizan su capacidad para completar tareas a tiempo, pero las estimaciones cuantitativas a menudo no se dan o se dan para algunas plataformas de terceros seleccionadas por separado.  Claramente, esto no es suficiente para implementar un control en tiempo real mediante RTOS.  Y para controlar los motores necesita exactamente un tiempo real difícil. <br><br>  MQX tiene un maravilloso caso de prueba a este respecto, que le permite obtener una tabla detallada del tiempo de ejecución de todos los servicios en la plataforma en la que inició la prueba. <br><br>  A continuación se muestra una tabla del tiempo de ejecución de los servicios en el microcontrolador de nuestro módulo de control del motor, con la optimización máxima para la velocidad de ejecución del código incluida en el compilador. <br><br><div class="spoiler">  <b class="spoiler_title">Tiempo de ejecución del servicio RTOS MQX Classic</b> <div class="spoiler_text"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3f4/79a/2e6/3f479a2e65fd274ca81b27321ae31978.png"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/51d/f91/32d/51df9132da3b6d09656d6ee7b2021ebc.png"><br></div></div><br>  La tabla también da una idea de qué servicios son compatibles con RTOS y qué opciones de kernel están disponibles.  El proyecto de prueba en IDE IAR se incluye en el marco publicado. <br><br><h2>  <b>Composición del directorio de proyectos</b> <br></h2><br>  El directorio raíz del marco se ve así: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/04e/fde/4a0/04efde4a059a9ba99ba39c7d6c275a8e.png"></div><br>  <b>APP_SRC</b> : un directorio que contiene todas las fuentes, excepto las que pertenecen a la distribución MQX. <br>  <b>FreeMaster_apps</b> : archivos de proyecto para su ejecución en el entorno <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FreeMaster</a> . <br>  <b>IAR_proj</b> : espacio de trabajo y archivos de proyecto para el entorno de trabajo integrado IAR para el entorno ARM v7.70.2.  En este entorno, la aplicación final se compila y se depura. <br>  <b>MQX_SRC</b> es un directorio que contiene todas las fuentes de MQX y middleware suministrados con MQX.  Como la licencia no permite la publicación de código abierto desde la distribución MQX, no hay archivos ' <b>.s'</b> y ' <b>.s'</b> en este directorio.  Pero aquellos que aceptan los términos de la licencia NXP pueden recibir los archivos que faltan. <br>  <b>ParametersManager</b> - directorio del programa administrador de parámetros.  Con este programa, se crean listas de parámetros de la aplicación y se generan archivos ' <b>.s'</b> y ' <b>.h'</b> con declaraciones de parámetros para incrustar en la aplicación. <br>  <b>PRUEBAS</b> - un directorio con proyectos de prueba marco.  Aquí está el proyecto <b>MQX_benchmark</b> para generar un informe con tiempos MQX. <br><br>  Los archivos <b>MQX_LIBRARY_O0.a</b> y <b>MQX_LIBRARY_O3.a</b> son los contenidos del directorio <b>MQX_SRC</b> compilados en bibliotecas con una optimización mínima y una optimización máxima, respectivamente. <br><br><h2>  <b>El contenido del directorio IAR_proj</b> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/ea2/d23/744/ea2d23744775a8daec5cbddff606db11.png"></div><br>  Los archivos <b>U3HB_full.eww</b> y <b>U3HB_MQXLib.eww</b> son los archivos del <b>espacio de trabajo IAR</b> . <br>  Mientras no haya fuentes en el directorio MQX, solo funcionará el archivo <b>U3HB_MQXLib.eww</b> .  Este espacio de trabajo utiliza bibliotecas MQX compiladas.  En el <b>espacio de trabajo U3HB_full.eww,</b> se compilan las fuentes MQX completas.  El directorio <b>OUT</b> sirve como el lugar donde el IAR coloca sus productos de trabajo, en particular mapas y archivos hexadecimales. <br><br>  El directorio de <b>configuración</b> es creado automáticamente por el IAR.  Almacena específicamente la configuración del depurador.  Si algo no se puede configurar durante la depuración en el IAR, entonces a veces vale la pena borrar este directorio. <br><br>  El archivo <b>INT_FLASH_MK66FX1M0LVQ18.icf</b> es un archivo de configuración del vinculador IAR.  Determina las direcciones de las regiones de memoria donde el enlazador coloca código, datos, vectores de interrupción, pilas, etc. <br><br><h2>  <b>El contenido del directorio MQX_SRC</b> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/a90/137/f84/a90137f8413885b24fa795dff7397501.png"></div><br>  Los archivos del espacio de trabajo <b>MQX_LIBRARY.eww</b> se utilizan para crear bibliotecas MQX.  Hasta que los archivos ' <b>.s</b> <b>'</b> y ' <b>.s'</b> se coloquen en los directorios, este proyecto no se compilará. <br>  <b>config</b> : el directorio con los archivos de configuración MQX.  La composición de los servicios y controladores MQX se especifica en el <b>archivo de</b> configuración <b>user_config.h</b> . <br>  <b>mfs</b> : sistema de archivos MQX, incluye FAT32 y RAM FS <br>  <b>mqx</b> : el núcleo MQX incluye los siguientes subdirectorios: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/640/df2/547/640df25474118976fe26e5f2b609924d.png"></div><br>  <b>rtcs</b> : pila TCP / IP.  Incluye los siguientes subdirectorios: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3d4/164/e18/3d4164e187a5d013aab6cf24e159d8d2.png"></div><br>  <b>shell</b> : un directorio con archivos shell. <br>  <b>usb</b> - directorio con archivos de pila USB <br><br>  La funcionalidad de cada módulo de software MQX está bien documentada por el fabricante.  Como ejemplo, proporcionaré enlaces a dos documentos: <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instrucciones para usar el MQX</a> . <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Guía de referencia de MQX.</a> <br>  El resto debe buscarse en la distribución, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">que está disponible en el sitio web de NXP</a> . <br><br>  El marco en sí está en el repositorio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> . <br><br>  Puede encontrar una descripción más detallada sobre cómo trabajar con software y ejemplos de aplicaciones en los siguientes artículos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es403525/">https://habr.com/ru/post/es403525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es403513/index.html">¿Cómo elegir una impresora 3D?</a></li>
<li><a href="../es403515/index.html">Algunos archivos del sistema de Windows están obstruidos con basura de metadatos de Adobe</a></li>
<li><a href="../es403517/index.html">Se inventa un método más barato de fotosíntesis artificial</a></li>
<li><a href="../es403521/index.html">Una breve historia de la teoría física de la gran unificación.</a></li>
<li><a href="../es403523/index.html">Batería solar en el balcón, experiencia usando</a></li>
<li><a href="../es403531/index.html">Desde la infancia sobre ruedas: bicicleta eléctrica y drifter Razor para niños y adolescentes</a></li>
<li><a href="../es403533/index.html">Pseudociencia La industria de la carne está tratando de convencer al público de la inocuidad de las grasas saturadas.</a></li>
<li><a href="../es403535/index.html">Tokamak de inicio termonuclear</a></li>
<li><a href="../es403537/index.html">Yates con Smart Home a bordo. Hecho en rusia</a></li>
<li><a href="../es403539/index.html">Tratamos con un abogado: es legal descargar torrents, comprar juegos en Steam brasileño y no solo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>