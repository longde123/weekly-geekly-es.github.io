<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏻 💃🏻 👩🏿‍🔬 Pengontrol DIY panel LED pada CPLD menggunakan modulasi BAM 🤦🏽 🧓🏿 ✡️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa waktu lalu, ia berpartisipasi dalam diskusi tentang proyek DIY dari arloji LED matriks. 
 Dan yang mengejutkan saya - matriks LED monokromati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengontrol DIY panel LED pada CPLD menggunakan modulasi BAM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409743/">  Beberapa waktu lalu, ia berpartisipasi dalam diskusi tentang proyek DIY dari arloji LED matriks. <br>  Dan yang mengejutkan saya - matriks LED monokromatik 8x8 kuno dengan langkah 5 milimeter digunakan sebagai perangkat tampilan.  Terlebih lagi, papan sirkuit tercetak yang kompleks dibuat untuknya, indikasi dinamis yang lembut dibuat.  Dan ini adalah saat ketika panel LED 64x32 penuh warna yang siap pakai dengan pitch 3 mm telah lama tersedia dengan harga $ 10-20.  Dan bermacam-macam panel seperti itu sangat besar dan memiliki pitch pixel 2 hingga 10 mm dan hampir semua ukuran. <br><a name="habracut"></a><br>  Pada saat yang sama, menggunakan panel seperti itu dalam desain DIY cukup sulit - pengontrol siap pakai harganya cukup mahal dan tidak memiliki API normal.  Sangat sulit untuk melakukan pemindaian panel yang cukup cepat pada mikrokontroler yang biasa digunakan di DIY.  Selain itu, interval waktu harus dijaga dengan akurasi tinggi - jika tidak, ketidakrataan kecerahan yang terlihat dimulai. <br><br>  Ada solusi bagus di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Adafruit</a> , tetapi semuanya cukup mahal dan kompleks. <br><br>  Setelah beberapa pemikiran, muncul pemikiran - mengapa tidak membuat papan yang sangat murah yang akan menjadi jembatan antara papan sen biasa seperti arduino dan panel LED?  Setelah beberapa bulan ribut-ribut, sesuatu yang berhasil lahir. <br><br>  Artikel ini menjelaskan versi kedua dari pengontrol yang ditingkatkan. <br><cut><br><h2>  Tantangan </h2><br>  Sebagai tugas dasar, saya ingin dapat mengontrol panel dengan ukuran total setidaknya 64x64, sementara memiliki kemampuan untuk bekerja setidaknya di Highcolor (RGB565) sambil mempertahankan kecepatan refresh layar yang dapat diterima (setidaknya 50Hz).  Dalam versi pertama dari pengontrol, tugas dasar sepenuhnya dilaksanakan, tetapi muncul ide untuk mengimplementasikan tugas dengan metode lain yang sangat menjanjikan, dari mana versi kedua lahir. <br><br><h2>  Penjelasan dasar tentang desain panel LED yang khas </h2><br>  Input antarmuka HUB75: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2d/yn/gt/2dyngtqqelfmxsb9iseipe2c29u.jpeg"></div><br>  Pada setiap input warna ada rantai register tipe HC595 (tetapi versi khusus 16-channel untuk LED).  Ada begitu banyak register yang cukup untuk lebar panel.  Rusak, boot paralel, dan izin output umum untuk semua register.  Input ABCDE - ini adalah pilihan seri - pergi ke dekoder konvensional. <br><br>  Prinsip kerja: <br><br><ul><li>  atur data ke input RGB, klik tombol CLK.  Ulangi sampai kami memuat seluruh baris </li><li>  matikan output OE = 1 (sehingga tidak ada gangguan) </li><li>  berikan kepada decoder nomor baris yang dimuat </li><li>  klik paralel load LAT - data garis ditransfer ke register keluaran <br>  aktifkan keluaran OE = 0 </li><li>  ulangi untuk baris berikutnya </li></ul><br>  Itu adalah indikasi dinamis klasik.  Jelas bahwa dengan metode ini dalam satu siklus seperti itu kita hanya dapat menghidupkan / mematikan setiap LED tertentu. <br><br>  Untuk mendapatkan gradasi kecerahan dengan PWM klasik, siklus seperti itu harus diulang N-1 kali, di mana N adalah jumlah gradasi kecerahan (256 untuk RGB888).  Dan mengingat bahwa pada saat yang sama masih berkedip - semua ini harus dilakukan dengan sangat, sangat cepat. <br><br>  Ada solusi - Bit Angle Modulation (BAM).  Dalam hal ini, waktu cahaya dalam setiap siklus sebanding dengan bobot bit yang ditampilkan.  Artinya, untuk RGB888 Anda hanya perlu 8 siklus tampilan.  Sedikit lebih rinci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Versi pertama dari pengontrol menggunakan PWM klasik, yang menerapkan batasan ketat pada jumlah siklus pemindaian.  Dalam versi kedua, BAM diimplementasikan, yang memberi keuntungan besar dalam kecepatan. <br><br><h2>  Implementasi </h2><br>  Cukup jelas bahwa mikrokontroler konvensional hanya menarik panel kecil - yang besar tidak memiliki kecepatan yang cukup.  Oleh karena itu, CPLD atau FPGA sangat diperlukan di sini - secara fisik tidak mungkin untuk menghasilkan puluhan MB / s pada mikrokontroler berbiaya rendah. <br><br>  Sebagai memori, saya direkomendasikan di forum IXBT oleh FIFO memory Averlogic AL422B yang sangat menarik, yang memiliki sekitar 400kbytes memori dan dapat beroperasi pada frekuensi hingga 50MHz. <br><br>  Mempertimbangkan bahwa persyaratan utama saya adalah biaya rendah maksimum dari komponen, sehingga syal jadi dapat diakses oleh produsen buatan sendiri, Altera EPM3064 - CPLD dengan 64 macrocell dipilih.  Pada saat yang sama, sejumlah kecil sel makro tidak memungkinkan membuat papan yang dapat dikonfigurasi secara dinamis - konfigurasi harus dikompilasi langsung ke dalam CPLD. <br><br>  → Sirkuit yang dihasilkan terletak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> <br><br>  Detail: <br><br><ul><li>  CPLD EPM3064ATC44-10 - harga Ali adalah sekitar $ 13-15 untuk selusin </li><li>  FIFO RAM AL422B - harga Ali adalah sekitar $ 15 per lusin </li><li>  Osilator kristal 50MHz.  Papan menyediakan untuk instalasi dalam kasus DIP14 / DIP8 / 7050.  Harga Ali adalah sekitar $ 6-7 per lusin </li><li>  Stabilizer 3.3V dalam paket SOT223.  Harga dalam bentuk Chip dan Dip - 40r </li><li>  Konektor IDC-10MS.  Harga dalam Chip &amp; Dip - 3 p / potong </li><li>  Konektor IDC-16MS.  Harga dalam Chip &amp; Dip - 8 r / potong </li><li>  Konektor IDC-14MS.  Harga dalam Chip &amp; Dip - 7 r / potong </li><li>  Kapasitor 1 mikrofarad 0805 - 8 buah sekitar 1 r / potong </li><li>  Kapasitor 0,1 uF 0805 - sekitar 1 r / potong </li><li>  Resistor 10k 0805 - satu sen </li></ul><br>  Total detail diperoleh 1,5 + 1,5 + 0,7 = $ 3,7 dan 40 + 3 + 8 + 7 + 8 * 1 + 1 = 67 p.  Semuanya dalam $ 5 - satu sen. <br><br>  → Gambar papan asli ada <a href="">di sini</a> <br><br>  → <a href="">File</a> gerber yang disiapkan <a href="">untuk pemesanan</a> <br><br>  Papan disiapkan untuk versi pertama, di mana tidak ada kontrol RE.  Untuk menggunakannya dengan versi kedua, Anda harus memotong jumper antara terminal 23 dan 24 dari AL422B dan membuang kabel dari terminal 28 EPM3064 (dibawa ke blok terminal) ke terminal 24 dari AL422B. <br><br>  Saat menyolder papan, jangan lupa untuk menyolder jumper listrik di bagian belakang papan. <br><br><img src="https://habrastorage.org/webt/y6/hy/i6/y6hyi6obrqqyyybfvractvmtuqy.jpeg"><br><br><img src="https://habrastorage.org/webt/u1/n1/jr/u1n1jr2zzs7sqfwpzxji2xpg2pg.jpeg"><br><br><h2>  Perhitungan </h2><br>  Perhitungan parameter yang diperlukan cukup rumit. <br><br>  Faktanya adalah bahwa dalam pengontrol dua proses dilakukan secara paralel - memuat data dari baris berikutnya / menunjukkan jalur yang sudah dimuat. <br><br>  Proses dimulai secara bersamaan, tetapi berakhir pada waktu yang berbeda, sehingga proses yang lebih cepat menunggu selesainya proses yang lebih lama. <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tablet Excel</a> dibuat untuk perhitungan <br><br>  Sumber data: <br><br><ul><li>  CRYSTAL_FRQ (MHz) - frekuensi generator (50 MHz) </li><li>  PIXEL_COUNT - jumlah piksel di bilah unduhan.  Lebih detail di bagian switching. </li><li>  RGB_INPUTS - jumlah input RGB yang digunakan dalam antarmuka HUB75E dari panel yang digunakan.  1 atau 2 </li><li>  BYTES_PER_PIXEL - byte per piksel.  Dalam kasus kami, selalu 3 - RGB888 </li><li>  SCAN_LINES - jumlah garis pindai di panel yang digunakan.  8/16/32 </li></ul><br>  Parameter yang dipilih: <br><br><ul><li>  PRE_DELAY - tunda dari sinyal LAT sampai OE dihidupkan, atur ticks </li><li>  PRESCALER - prescaler untuk penghitung utama.  Yaitu, jika daftar harga adalah 8 dan berat bit saat ini adalah 4, maka OE akan dihidupkan selama 8 * 4 = 32 siklus </li><li>  POST_DELAY - jeda minimum dari mematikan OE ke sinyal LAT berikutnya, atur ticks </li></ul><br>  Misalnya, kami memiliki panel 32x32 yang memiliki 8 garis pindai dan 2 input RGB.  Panel semacam itu memiliki dua konektor HUB75E, yaitu, secara fisik ini adalah dua panel 32x16.  Kami menghubungkan panel-panel ini secara seri, yaitu, secara logis panel ini akan terlihat seperti 64x16. <br><br>  PRE_DELAY dan POST_DELAY mengosongkan interval sebelum dan sesudah output diaktifkan (OE) sehingga multiplexer dapat mengalihkan output dan kunci membuka / menutup.  Tanpa mereka, akan ada "trik" dari membakar piksel ke garis yang berdekatan.  Nilai dipilih secara eksperimental untuk panel tertentu.  Biasanya 15 langkah sudah cukup (diatur dalam langkah-langkah). <br><br>  Ini menimbulkan pertanyaan memilih prescaler - bagaimana memilihnya. <br><br>  Nilai prescaler rendah memberikan waktu tampilan bingkai pendek, tetapi mengurangi kecerahan keseluruhan.  Nilai tinggi dari prescaler meningkatkan waktu tampilan frame, yaitu, ketika menghitung, itu berkedip layar. <br><br>  Mari kita coba PRESCALER = 1 <br><br>  Kami mendapatkan: <br><br>  OE_EFFICIENCY - 8,3%, mis. Panel hanya akan bekerja 8,3% dari kemungkinan kecerahan maksimum <br>  FRAMES_PER_SECOND - 2034 fps - tetapi kecepatan refresh gambar akan sangat besar - lebih dari 2000 fps. <br><br>  Hilangnya kecerahan sudah sangat besar. <br><br>  Mari kita coba PRESCALER = 16 <br><br>  Kami mendapatkan: <br><br>  OE_EFFICIENCY - 72,9% artinya, panel akan bekerja pada 72,9% dari kemungkinan kecerahan maksimum <br>  FRAMES_PER_SECOND - 1117 - dan kecepatan refresh gambar sangat baik - lebih dari 1000 fps. <br>  Yah, itu cukup normal - efisiensi lebih dari 50% cukup normal dan frame rate sangat baik. <br><br>  Aturan umum praktis adalah PRESCALER sekitar 8 kali lebih kecil dari produk PIXEL_COUNT * RGB_INPUTS <br><br>  Baiklah, terus menghitung dan memeriksa. <br><br><h2>  Berpindah panel LED </h2><br>  Semua panel terhubung secara seri.  Diagram koneksi: pertama dari kanan ke kiri, lalu dari bawah ke atas.  Artinya, pertama kita hubungkan horizontal secara seri, kemudian output dari baris bawah ke pintu masuk baris kedua dari bawah, dll.  ke baris paling atas. <br><br>  Kontroler menempel di panel kanan bawah. <br><br>  Ada panel yang memiliki dua input dan dua konektor output.  Panel semacam itu pada dasarnya hanyalah rakitan mekanis dua panel secara vertikal.  Diganti sebagai dua panel independen. <br><br>  Setelah perakitan, kita perlu menghitung panjang total rantai dalam piksel - untuk ini kita lihat - berapa banyak total panel dalam rantai dan kalikan angka ini dengan lebar panel dalam piksel.  Jumlah ini kemudian perlu didorong ke nilai PIXEL_COUNT selama konfigurasi CPLD dan ke dalam kalkulator waktu. <br><br><h2>  Firmware FPGA </h2><br>  Semua file yang diperlukan ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> .  Anda perlu mengunduh langsung dengan folder tersebut. <br><br>  Setelah mendaftar, Anda harus mengunduh dan menginstal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Quartus II 13.0sp1</a> dari situs web Altera.  Anda perlu mengunduh PERSIS versi INI - versi yang lebih baru tidak lagi mendukung seri MAX3000.  Tidak perlu untuk memecahkannya - versi edisi Web (gratis) sudah cukup.  Saat mengunduh, pastikan untuk mencentang kotak untuk MAX3000 dan dukungan Programmer.  Untuk jaga-jaga, saya memperingatkan Anda - paket besar, sekitar dua pertunjukan.  Anda juga membutuhkan Altera USB Blaster - harga yang biasa untuk ali adalah sekitar $ 3. <br><br>  Buka proyek al422_bam.qpf.  Di sebelah kiri, buka tab file dan buka file al422_bam.v - ini adalah file proyek utama.  Di dalamnya Anda perlu mengkonfigurasi parameter: <br><br>  Berapa banyak input RGB pada panel - pada panel dengan input HUB75 mungkin ada 1 atau 2 input RGB.  Untuk mengetahui dengan tepat berapa banyak input yang mungkin dengan cara ini - kami mengambil jumlah piksel dalam panel secara vertikal.  Membaginya dengan jumlah garis pindai (ditunjukkan dalam penunjukan panel sebagai 8S, misalnya).  Dibagi dengan jumlah konektor input (1 atau 2).  Misalnya - Saya memiliki panel 32x32, pemindaian 8S, dan dua konektor input - 32/8/2 = 2 - yang berarti dua input RGB. <br><br><pre><code class="hljs powershell">`define RGB_outs <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Berapa banyak garis pindai pada panel - karena standar HUB75E didukung, dapat mencapai 32x.  Jumlah garis pindai biasanya dalam nama panel masing-masing dalam bentuk 8S / 16S / 32S. <br><br>  Hanya satu baris yang harus dihapus komentar: <br><br><pre> <code class="hljs powershell">`define SCAN_x8 <span class="hljs-number"><span class="hljs-number">1</span></span> //`define SCAN_x16 <span class="hljs-number"><span class="hljs-number">1</span></span> //`define SCAN_x32 <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Jumlah total piksel horizontal dalam rantai.  Piksel dipertimbangkan dalam seluruh rantai panel - lihat bagian di atas “Mengalihkan panel LED” <br><br><pre> <code class="hljs powershell">`define PIXEL_COUNT <span class="hljs-number"><span class="hljs-number">64</span></span></code> </pre><br>  Fase-fase sinyal keluaran.  Konfigurasi yang paling umum adalah ini: OE aktif pada level rendah (komentar dihapus), CLK berjalan di depan (komentar aktif), LAT aktif pada level tinggi (komentar aktif).  Segala macam opsi aneh mungkin terjadi.  Cari tahu yang mana yang Anda miliki hanya secara eksperimen atau dengan menghapus sirkuit dan mencari lembar data untuk chip yang digunakan). <br><br><pre> <code class="hljs powershell">//`define LED_LAT_ACTIVE_LOW <span class="hljs-number"><span class="hljs-number">1</span></span> `define LED_OE_ACTIVE_LOW <span class="hljs-number"><span class="hljs-number">1</span></span> //`define LED_CLK_ON_FALL <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Pra dan pasca tunda sinyal OE relatif terhadap LAT dan prescaler untuk penghitung utama.  Lihat di atas. <br><br><pre> <code class="hljs powershell">`define OE_PRESCALER <span class="hljs-number"><span class="hljs-number">16</span></span> `define OE_PREDELAY <span class="hljs-number"><span class="hljs-number">31</span></span> `define OE_POSTDELAY <span class="hljs-number"><span class="hljs-number">31</span></span></code> </pre><br>  Semua, tekan ctrl-L - proyek dikompilasi.  Jika Anda tidak mengacaukannya di mana saja, akan ada beberapa peringatan, tetapi seharusnya tidak ada kesalahan.  Selanjutnya, kita kaitkan papan solder ke USB Blaster, berikan daya ke papan.  Di Quartus, buka tools - programmer.  Pilih USB-blaster di pengaturan Perangkat Keras, klik Mulai.  Itu dia, CPLD diprogram. <br><br><h2>  Bagian mikrokontroler </h2><br>  Output data ke controller, secara umum, sangat sederhana - kami mereset alamat tulis dan kemudian secara berurutan mengeluarkan byte data, membelai mereka dengan sinyal WCLK.  Dan tampaknya arduinka dangkal pun cukup untuk bekerja.  Tetapi ada dua masalah: <br><br>  a) Membutuhkan banyak memori.  Bahkan panel 32x32 kecil dalam mode RGB888 membutuhkan 3kBytes memori untuk buffer layar.  Atmega328 berbasis Arduino biasa hanya mengandung 2kbytes RAM.  Anda dapat, tentu saja, menggunakan papan Mega berdasarkan Atmega2560, yang mengandung RAM sebanyak 8 kB, tetapi bahkan ini tidak cukup untuk panel berukuran normal - panel 128x64 dalam mode RGB565 membutuhkan memori 16kB. <br><br>  b) Dalam proses bekerja dengan AL422B, kesalahan yang tidak didokumentasikan keluar - ketika menulis data dengan kecepatan kurang dari 2MB / s, penghitung alamat tidak berfungsi dengan benar dan menulis data "tidak ada".  Mungkin ini adalah kesalahan pesta saya.  Mungkin tidak.  Tapi kesalahan ini harus dielakkan.  Mengingat bahwa AVR8 beroperasi pada 16 MHz, hampir mustahil untuk memperoleh data darinya pada kecepatan yang diinginkan. <br><br>  Solusi yang diusulkan adalah menggunakan syal murah berdasarkan pengontrol STM32F103C8T6 32-bit.  Syal semacam itu berharga Ali sekitar $ 2,5 per potong, atau sekitar $ 1,7 ketika membeli selusin, yaitu, bahkan lebih murah daripada Arduino Nano.  Pada saat yang sama, kami mendapatkan mikrokontroler 32-bit penuh yang beroperasi pada 72 MHz dan memiliki 20 kB RAM dan 64 kB flash (bandingkan dengan Atmega328 2kB / 8kB, yang ada di Nano). <br><br>  Pada saat yang sama, papan semacam itu cukup berhasil diprogram di lingkungan Arduino.  Tentang ini ada artikel bagus di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jam</a> , jadi saya tidak akan menduplikatnya.  Secara umum, lakukan semuanya seperti yang dijelaskan dalam artikel. <br><br>  Di lingkungan Arduino, pilih Generic STM32F103C, varian STM32F103C8 board.  Data melewati DMA, sehingga Anda dapat menggunakan opsi pengoptimalan apa pun. <br><br>  Perpindahan terjadi sebagai berikut: <br><br>  Dipaku dengan kuat di perpustakaan: <br>  A0..A7 → DI0..DI7 AL422B <br>  B0 → WCLK AL422B <br>  B1 → WRST AL422B <br><br>  Ditetapkan dalam sketsa ke controller: <br>  B10 → KAMI AL422B <br><br>  Kawat biasa: <br>  G → GND <br><br>  Nah, jangan lupa untuk memasok daya 5V / GND dari panel ke pin pengontrol yang sesuai. <br><br>  Ambil pinout konektor pada pengontrol dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sirkuit</a> . <br><br><img src="https://habrastorage.org/webt/nh/p7/_y/nhp7_ygm9hqmkawess06ypt1oy4.jpeg"><br><br><h2>  Bagian perangkat lunak </h2><br>  Karena tugasnya adalah membuat semuanya sesederhana dan semurah mungkin, semua perangkat lunak dibuat untuk lingkungan Arduino dan dirancang sebagai perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LED_PANEL</a> . <br><br>  Perpustakaan LED-PANEL aktif menggunakan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Adafruit GFX</a> , sehingga perlu diinstal. <br><br>  Saya sangat merekomendasikan untuk tidak meletakkan pustaka LED_PANEL di direktori pustaka, tetapi meninggalkannya di folder sketsa.  Faktanya adalah bahwa ada banyak parameter terikat-besi, dan jika Anda ingin mentransfer pekerjaan ke mikrokontroler yang lebih "gemuk", Anda harus mengubah banyak hal dalam kode itu sendiri. <br><br>  Inisialisasi kira-kira dalam bentuk berikut: <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"LED_PANEL.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> width 32 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> height 32 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> bpp 3 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> scan_lines 8 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RGB_inputs 2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> we_out_pin PB10 LED_PANEL led_panel = LED_PANEL(width, height, bpp, scan_lines, RGB_inputs, we_out_pin);</span></span></code> </pre><br>  yaitu, kita membuat turunan dari kelas LED_PANEL, yang kami tentukan parameternya: <br><br>  width - total lebar panel dalam piksel (total) <br>  tinggi - tinggi total panel dalam piksel (total) <br>  bpp - byte per pixel, 3 untuk RGB888.  Versi BAM hanya berfungsi di RGB888 <br>  scan_lines - jumlah garis pindai adalah 8/16/32.  Itu harus sesuai dengan mode flash ke controller. <br>  RGB_inputs - jumlah input RGB pada konektor HUB75 adalah 1/2.  Itu harus sesuai dengan mode flash ke controller. <br>  we_out_pin - pin yang terhubung dengan output WE <br><br>  Harap dicatat bahwa selama inisialisasi, hanya pin WE yang ditentukan.  Semua pin lainnya terdaftar secara kaku dalam kode, karena mereka terikat pada timer dan saluran DMA yang digunakan dan perubahan mereka akan memerlukan perubahan signifikan dalam kode. <br><br>  Memulai dan membersihkan layar di bagian pengaturan: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">led_panel</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.begin</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">led_panel</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.clear</span></span>();</code> </pre><br>  mulai inisialisasi pin yang diperlukan untuk output, menghubungkan timer dan DMA <br>  hapus membersihkan buffer <br><br>  Untuk menggambar, Anda dapat menggunakan semua prosedur standar perpustakaan Adafruit GFX - dari drawPixel yang paling sederhana hingga keluaran teks.  Untuk menampilkan ditarik ke prosedur buffer digunakan: <br><br><pre> <code class="hljs pgsql">led_panel.<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>();</code> </pre><br>  Dalam bentuk ini, tunjukkan memulai transfer data ke controller melalui DMA dan segera mengembalikan kontrol.  Cari tahu apakah transfer telah berakhir dengan bantuan fungsi led_panel.OutIsFree () - jika dikatakan benar, maka transfer telah berakhir.  Ada fitur - jika Anda memanggil acara saat transfer belum selesai - itu hanya akan diabaikan. <br><br><pre> <code class="hljs pgsql">led_panel.<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);</code> </pre><br>  analog dari show (), tetapi jika Anda memanggil show (false), dan transfer belum selesai, prosedur akan menunggu transfer selesai, kemudian mulai transfer baru dan kontrol kembali: <br><br><pre> <code class="hljs pgsql">led_panel.<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  analog dengan show (false), tetapi jika Anda memanggil show (true), maka setelah dimulainya transfer baru, prosedur tidak akan mengembalikan kontrol sampai transfer selesai. <br><br>  Secara umum, itu saja. <br><br><img src="https://habrastorage.org/webt/pn/-a/of/pn-aofhwnhuuzszuk_mcf9upqje.jpeg"><br><br>  Beberapa catatan pada perangkat lunak: <br><br>  a) Koreksi Gamma diperkenalkan saat menghitung ulang warna dari RGB565 (yang digunakan perpustakaan) dengan fungsi ExpandColor.  Dalam semua kasus lain, fungsi transfer linier digunakan, yaitu, kecerahan berbanding lurus dengan nilai. <br>  b) Perangkat lunak memungkinkan Anda untuk menghubungkan beberapa pengendali LED ke satu papan mikrokontroler.  Untuk melakukan ini, kirim jalur data bus, RST, dan CLK ke pengontrol secara paralel.  Pengontrol yang diinginkan dipilih melalui jalur WE.  Dalam perangkat lunak, Anda perlu membuat instance terpisah dari kelas LED_PANEL untuk setiap pengontrol, dan setiap instance harus memiliki baris WE yang berbeda (parameter terakhir) selama inisialisasi. <br><br><h2>  HARUS DILAKUKAN </h2><br>  - Berurusan dengan "pickup" bunga di baris tetangga.  Sepertinya kabel yang buruk dari panel itu sendiri (tombolnya berserakan), tetapi Anda perlu memeriksa.  Baru saja tiba panel baru - saya akan periksa; <br>  - Buat versi baru papan - dengan RE yang sudah bercerai dan penambahan konverter level output dalam 5V; <br>  - Buat kelas META_LED_PANEL, yang akan memungkinkan menggabungkan beberapa LED_PANEL menjadi satu layar virtual - ini akan memungkinkan untuk membuat layar yang sangat besar dengan beberapa pengontrol; <br>  - Di masa mendatang, buka seri CPLD yang lebih kuat, misalnya CycloneIV.  Ini akan secara signifikan memperluas kemampuan sambil mempertahankan biaya rendah (EP4CE6E22 biaya sekitar $ 5 untuk Cina, sementara ada macrocell 100 kali lebih banyak dan sekitar 32 kB memori internal).  Tapi saya akan melakukan ini suatu hari nanti.  Jika saya mau.  Karena perkembangan seperti itu terlalu banyak waktu. </cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id409743/">https://habr.com/ru/post/id409743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id409731/index.html">Ulasan profitabilitas Hashflare. Pengalaman saya dalam 6 bulan</a></li>
<li><a href="../id409733/index.html">Perlu data yang lebih cepat dan planet yang lebih bersih? Mulai kembangkan asteroid</a></li>
<li><a href="../id409735/index.html">Ilusi Tingkat Konsensus</a></li>
<li><a href="../id409739/index.html">Bloomberg: Telegram berencana untuk mendapatkan lebih dari $ 1 miliar selama ICO</a></li>
<li><a href="../id409741/index.html">Gedung Putih tertarik untuk meluncurkan Falcon Heavy</a></li>
<li><a href="../id409745/index.html">Spesialis AI mengklaim bahwa ia berhasil memahami bahasa naskah Naskah Voynich</a></li>
<li><a href="../id409747/index.html">Jaringan saraf AttnGAN menggambar objek dalam beberapa bagian, menggunakan ruang vektor tidak hanya kalimat, tetapi juga kata-kata</a></li>
<li><a href="../id409749/index.html">Ketel pirolisis di rumah, atau ketika harga gas tidak masalah</a></li>
<li><a href="../id409751/index.html">Surat AudioFilkina: musik gigi biru - bukan untuk sensasi, tapi untuk kebaikan</a></li>
<li><a href="../id409753/index.html">PBB dapat menyelesaikan percobaan acak skala besar untuk mengurangi pemanasan global</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>