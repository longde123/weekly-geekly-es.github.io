<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüé§ ü§±üèª üóØÔ∏è Applications TDD sur Spring Boot: travailler avec une base de donn√©es üíÑ üîé üñêüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le deuxi√®me article de la s√©rie "D√©veloppement pilot√© par les tests d'applications sur Spring Boot" et cette fois je vais parler du test d'acc√®s √† la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Applications TDD sur Spring Boot: travailler avec une base de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433958/"><p>  Le deuxi√®me article de la s√©rie "D√©veloppement pilot√© par les tests d'applications sur Spring Boot" et cette fois je vais parler du test d'acc√®s √† la base de donn√©es, un aspect important des tests d'int√©gration.  Je vais vous expliquer comment utiliser les tests pour d√©terminer l'interface d'un futur service d'acc√®s aux donn√©es, comment utiliser les bases de donn√©es en m√©moire int√©gr√©es pour les tests, travailler avec les transactions et t√©l√©charger les donn√©es de test dans la base de donn√©es. </p><a name="habracut"></a><br><p>  Je ne parlerai pas beaucoup de TDD et des tests en g√©n√©ral, j'invite tout le monde √† lire le premier article - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment construire une pyramide dans le tronc ou le d√©veloppement pilot√© par les tests d'applications sur Spring Boot / geek magazine</a> </p><br><p>  Je vais commencer, comme la derni√®re fois, par une petite partie th√©orique, et passer au test de bout en bout. </p><br><h1 id="piramida-testirovaniya">  Test de la pyramide </h1><br><p>  Pour commencer, une petite mais n√©cessaire description d'une entit√© aussi importante dans les tests que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la pyramide de test</a> ou <em>la pyramide de test</em> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f6c/930/f2d/f6c930f2d4ae8a6068696ace34e9566e.png" alt="image"></p><br><p>  (extrait de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la pyramide des tests pratiques</a> ) </p><br><p>  La pyramide des tests est l'approche lorsque les tests sont organis√©s √† plusieurs niveaux. </p><br><ul><li>  <strong>Les</strong> tests d' <strong>interface utilisateur</strong> (ou de bout en bout, <strong>E2E</strong> ) sont peu nombreux et ils sont lents, mais ils testent l'application r√©elle - pas de simulacres et testent des homologues.  Les entreprises pensent souvent √† ce niveau et tous les cadres BDD vivent ici (voir Cucumber dans un article pr√©c√©dent). </li><li>  Ils sont suivis de <strong>tests d'int√©gration</strong> (service, composant - chacun a sa propre terminologie), qui se concentrent d√©j√† sur un composant sp√©cifique (service) du syst√®me, l'isolant des autres composants via moki / doubles, mais v√©rifiant toujours l'int√©gration avec de vrais syst√®mes externes - ces tests sont connect√©s √† la base de donn√©es, envoyer des demandes REST, je travaille avec une file d'attente de messages.  En fait, ce sont des tests qui v√©rifient l'int√©gration de la logique m√©tier avec le monde ext√©rieur. </li><li>  Tout en bas se trouvent des <strong>tests unitaires</strong> rapides qui testent les blocs minimum de code (classes, m√©thodes) de mani√®re compl√®tement isol√©e. </li></ul><br><p>  Spring aide √† √©crire des tests pour chaque niveau - <em>m√™me pour les tests unitaires</em> , bien que cela puisse sembler √©trange, car dans le monde des tests unitaires, aucune connaissance du framework ne devrait exister.  Apr√®s avoir √©crit le test E2E, je vais simplement montrer comment Spring permet m√™me √† des choses purement ¬´d'int√©gration¬ª comme les contr√¥leurs de tester de mani√®re isol√©e. </p><br><p>  Mais je vais commencer tout en haut de la pyramide - le test de l'interface utilisateur lente, qui d√©marre et teste une application √† part enti√®re. </p><br><h1 id="end-to-end-test">  Test de bout en bout </h1><br><p>  Donc, une nouvelle fonctionnalit√©: </p><br><pre><code class="plaintext hljs">Feature: A list of available cakes Background: catalogue is updated Given the following items are promoted | Title | Price | | Red Velvet | 3.95 | | Victoria Sponge | 5.50 | Scenario: a user visiting the web-site sees the list of items Given a new user, Alice When she visits Cake Factory web-site Then she sees that "Red Velvet" is available with price ¬£3.95 And she sees that "Victoria Sponge" is available with price ¬£5.50</code> </pre> <br><blockquote>  Et voici un aspect imm√©diatement int√©ressant - que faire du test pr√©c√©dent, √† propos du message d'accueil sur la page principale?  Cela ne semble plus pertinent, apr√®s le lancement du site sur la page principale, il y aura d√©j√† un r√©pertoire, pas un message d'accueil.  Il n'y a pas de r√©ponse unique, je dirais - cela d√©pend de la situation.  Mais le principal conseil - ne vous attachez pas aux tests!  Supprimez-les lorsqu'ils perdent leur pertinence, r√©√©crivez pour en faciliter la lecture.  Surtout les tests E2E - cela devrait √™tre, en fait, une <strong>sp√©cification vivante et actuelle</strong> .  Dans mon cas, je viens de supprimer les anciens tests et de les remplacer par de nouveaux, en utilisant certaines des √©tapes pr√©c√©dentes et en ajoutant des tests inexistants. </blockquote><p>  J'en arrive maintenant √† un point important - le choix de la technologie pour le stockage des donn√©es.  Conform√©ment √† l'approche <em>Lean</em> , je voudrais reporter le choix jusqu'au tout dernier moment - quand je saurai avec certitude si le mod√®le relationnel ou non, quelles sont les exigences de coh√©rence, de transactionnalit√©.  En g√©n√©ral, il existe des solutions pour cela - par exemple, la cr√©ation de <strong>jumeaux</strong> de <strong>test</strong> et de divers stockages en <strong>m√©moire</strong> , mais jusqu'√† pr√©sent, je ne veux pas compliquer l'article et choisir imm√©diatement la technologie - les bases de donn√©es relationnelles.  Mais afin de conserver au moins une certaine possibilit√© de choisir une base de donn√©es, j'ajouterai une abstraction - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spring Data JPA</a> .  JPA lui-m√™me est une sp√©cification assez abstraite pour acc√©der aux bases de donn√©es relationnelles, et Spring Data rend son utilisation encore plus facile. </p><br><blockquote>  Spring Data JPA utilise Hibernate comme fournisseur par d√©faut, mais prend √©galement en charge d'autres technologies, telles que EclipseLink et MyBatis.  Pour les personnes peu familiaris√©es avec l'API Java Persistence - JPA est comme une interface et Hibernate est une classe qui l'impl√©mente. </blockquote><p>  Donc, pour ajouter le support JPA, j'ai ajout√© quelques d√©pendances: </p><br><pre> <code class="plaintext hljs">implementation('org.springframework.boot:spring-boot-starter-data-jpa') runtime('com.h2database:h2')</code> </pre> <br><p>  En tant que base de donn√©es, j'utiliserai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">H2</a> - une base de donn√©es int√©gr√©e √©crite en Java, avec la possibilit√© de travailler en mode en m√©moire. </p><br><p>  En utilisant Spring Data JPA, je d√©finis imm√©diatement une interface pour acc√©der aux donn√©es: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CakeRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CakeEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre> <br><p>  Et l'essence: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Builder</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cakes"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CakeEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CakeEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) Long id; <span class="hljs-meta"><span class="hljs-meta">@NotBlank</span></span> String title; <span class="hljs-meta"><span class="hljs-meta">@Positive</span></span> BigDecimal price; <span class="hljs-meta"><span class="hljs-meta">@NotBlank</span></span> <span class="hljs-meta"><span class="hljs-meta">@NaturalId</span></span> String sku; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> promoted; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == o) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getClass() != o.getClass()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; CakeEntity cakeEntity = (CakeEntity) o; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.equals(title, cakeEntity.title); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.hash(title); } }</code> </pre> <br><p>  Il y a quelques √©l√©ments moins √©vidents dans la description de l'entit√©. </p><br><ul><li>  <code>@NaturalId</code> pour le champ <code>sku</code> .  Ce champ est utilis√© comme ¬´identifiant naturel¬ª pour v√©rifier l'√©galit√© des entit√©s - utiliser tous les champs ou les champs <code>@Id</code> dans les m√©thodes <code>equals</code> / <code>hashCode</code> est plut√¥t un anti-mod√®le.  Il est bien √©crit sur la fa√ßon de v√©rifier correctement l'√©galit√© des entit√©s, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </li><li>  Pour r√©duire un peu le code passe-partout, j'utilise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Project Lombok</a> - processeur d'annotation pour Java.  Il vous permet d'ajouter diverses choses utiles, comme <code>@Builder</code> - pour g√©n√©rer automatiquement un g√©n√©rateur pour une classe et <code>@AllArgsConstructor</code> pour cr√©er un constructeur pour tous les champs. </li></ul><br><p>  Une impl√©mentation d'interface sera fournie automatiquement par Spring Data. </p><br><h1 id="vniz-po-piramide">  En bas de la pyramide </h1><br><p>  Il est maintenant temps de descendre au niveau suivant de la pyramide.  En r√®gle g√©n√©rale, je vous recommande de <strong>toujours commencer par le test e2e</strong> , car cela vous permettra de d√©terminer le "but final" et les limites de la nouvelle fonctionnalit√©, mais il n'y a pas de r√®gles strictes plus loin.  Il n'est pas n√©cessaire d'√©crire un test d'int√©gration avant de passer au niveau unitaire.  C'est le plus souvent que c'est plus pratique et plus simple - et c'est tout √† fait naturel de descendre. </p><br><p>  Mais sp√©cifiquement maintenant, je voudrais briser imm√©diatement cette r√®gle et √©crire un test unitaire qui aidera √† d√©terminer l'interface et le contrat d'un nouveau composant qui n'existe pas encore.  Le contr√¥leur doit renvoyer un mod√®le qui sera rempli √† partir d'un certain composant X, et j'ai √©crit ce test: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ExtendWith</span></span>(MockitoExtension.class) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Mock</span></span> CakeFinder cakeFinder; <span class="hljs-meta"><span class="hljs-meta">@InjectMocks</span></span> IndexController indexController; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;Cake&gt; cakes = Set.of(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cake(<span class="hljs-string"><span class="hljs-string">"Test 1"</span></span>, <span class="hljs-string"><span class="hljs-string">"¬£10"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cake(<span class="hljs-string"><span class="hljs-string">"Test 2"</span></span>, <span class="hljs-string"><span class="hljs-string">"¬£10"</span></span>)); <span class="hljs-meta"><span class="hljs-meta">@BeforeEach</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(cakeFinder.findPromotedCakes()).thenReturn(cakes); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldReturnAListOfFoundPromotedCakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ModelAndView index = indexController.index(); assertThat(index.getModel()).extracting(<span class="hljs-string"><span class="hljs-string">"cakes"</span></span>).contains(cakes); } }</code> </pre> <br><p>  Il s'agit d'un test unitaire pur - pas de contextes, pas de bases de donn√©es ici, seulement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mockito</a> pour mok.  Et ce test est juste une bonne d√©monstration de la fa√ßon dont Spring aide les tests unitaires - le <em>contr√¥leur dans Spring MVC est juste une classe dont les m√©thodes acceptent des param√®tres de types ordinaires et renvoient des objets POJO - Afficher les mod√®les</em> .  Il n'y a pas de requ√™tes HTTP, pas de r√©ponses, en-t√™tes, JSON, XML - tout cela sera automatiquement appliqu√© sur la pile sous la forme de convertisseurs et de s√©rialiseurs.  Oui, il y a un petit "indice" √† Spring sous la forme de <code>ModelAndView</code> , mais c'est un POJO r√©gulier et vous pouvez m√™me vous en d√©barrasser si vous le souhaitez, il est n√©cessaire sp√©cifiquement pour les contr√¥leurs d'interface utilisateur. </p><br><blockquote>  Je ne parlerai pas beaucoup de Mockito, vous pouvez tout lire dans la documentation officielle.  Plus pr√©cis√©ment, il n'y a que des points int√©ressants dans ce test - j'utilise <code>MockitoExtension.class</code> comme <code>MockitoExtension.class</code> de test, et il g√©n√©rera automatiquement des mokas pour les champs annot√©s par <code>@Mock</code> , puis injectera ces mokas en tant que d√©pendances dans le constructeur de l'objet dans le champ marqu√© <code>@InjectMocks</code> .  Vous pouvez faire tout cela manuellement en utilisant la m√©thode <code>Mockito.mock()</code> , puis cr√©er une classe. </blockquote><p>  Et ce test permet de d√©terminer la m√©thode du nouveau composant - <code>findPromotedCakes</code> , une liste de g√¢teaux que nous voulons afficher sur la page principale.  Il ne d√©termine pas ce que c'est ni comment cela devrait fonctionner avec la base de donn√©es.  La seule responsabilit√© du contr√¥leur est de prendre ce qui lui a √©t√© transf√©r√© et de retourner les mod√®les ("g√¢teaux") dans un champ sp√©cifique.  N√©anmoins, <code>CakeFinder</code> d√©j√† la premi√®re m√©thode dans mon interface, ce qui signifie que vous pouvez √©crire un test d'int√©gration pour cela. </p><br><blockquote>  J'ai d√©lib√©r√©ment rendu toutes les classes √† l'int√©rieur du <strong>paquet</strong> <code>cakes</code> <strong>priv√©es</strong> afin que personne en dehors du paquet ne puisse les utiliser.  La seule fa√ßon d'obtenir des donn√©es de la base de donn√©es est avec l'interface CakeFinder, qui est mon ¬´composant X¬ª pour acc√©der √† la base de donn√©es.  Il devient un ¬´connecteur¬ª naturel, que je peux facilement verrouiller si je dois tester quelque chose isol√©ment et ne pas toucher la base.  Et sa seule impl√©mentation est JpaCakeFinder.  Et si, par exemple, le type de base de donn√©es ou la source de donn√©es change √† l'avenir, vous devrez ajouter une impl√©mentation de l'interface <code>CakeFinder</code> sans changer le code qui l'utilise. </blockquote><br><h1 id="integracionnyy-test-dlya-jpa-ispolzuya-datajpatest">  Test d'int√©gration pour JPA √† l'aide de @DataJpaTest </h1><br><p>  Les tests d'int√©gration sont le pain et le beurre de printemps.  En fait, tout a √©t√© si bien fait pour les tests d'int√©gration que les d√©veloppeurs ne veulent parfois pas aller au niveau de l'unit√© ou n√©gliger le niveau de l'interface utilisateur.  Ce n'est ni mauvais ni bon - je r√©p√®te que l'objectif principal des tests est la confiance.  Et un ensemble de tests d'int√©gration rapides et efficaces peut suffire √† fournir cette confiance.  Cependant, il existe un risque qu'avec le temps, ces tests soient plus lents ou plus lents, ou commencent simplement √† tester les composants de mani√®re isol√©e, au lieu de l'int√©gration. </p><br><p>  Les tests d'int√©gration peuvent ex√©cuter l'application telle qu'elle est ( <code>@SpringBootTest</code> ) ou son composant distinct (JPA, Web).  Dans mon cas, je veux √©crire un test cibl√© pour JPA - donc je n'ai pas besoin de configurer de contr√¥leurs ou d'autres composants.  L'annotation <code>@DataJpaTest</code> est responsable dans le Spring Boot Test.  Il s'agit d'une <em>m√©ta</em> annotation, c'est-√†-dire  Il combine plusieurs annotations diff√©rentes qui configurent diff√©rents aspects du test. </p><br><ul><li>  @AutoConfigureDataJpa </li><li>  @AutoConfigureTestDatabase </li><li>  @AutoConfigureCache </li><li>  @AutoConfigureTestEntityManager </li><li>  @Transactional </li></ul><br><p>  Je vais d'abord vous parler de chacun individuellement, puis je vais vous montrer le test termin√©. </p><br><p>  <strong>@AutoConfigureDataJpa</strong> <br>  Il charge un ensemble complet de configurations et met en place des r√©f√©rentiels (g√©n√©ration automatique d'impl√©mentations pour <code>CrudRepositories</code> ), des outils de migration pour les bases de donn√©es FlyWay et Liquibase, se connectant √† la base de donn√©es √† l'aide de DataSource, du gestionnaire de transactions et enfin d'Hibernate.  En fait, ce n'est qu'un ensemble de configurations pertinentes pour acc√©der aux donn√©es - ni <code>DispatcherServlet</code> de Web MVC, ni d'autres composants ne sont inclus ici. </p><br><p>  <strong>@AutoConfigureTestDatabase</strong> <br>  C'est l'un des aspects les plus int√©ressants du test JPA.  Cette configuration <em>recherche le chemin de classe pour l'une des bases de donn√©es incorpor√©es prises en charge et reconfigure le contexte afin que le DataSource pointe vers une base de donn√©es en m√©moire cr√©√©e de fa√ßon al√©atoire</em> .  Depuis que j'ai ajout√© la d√©pendance √† la base H2, je n'ai pas besoin de faire autre chose, le fait d'avoir cette annotation automatiquement pour chaque test fournira une base vide, et c'est tout simplement incroyablement pratique. </p><br><p>  Il convient de rappeler que cette base sera compl√®tement vide, sans sch√©ma.  Pour g√©n√©rer le circuit, il existe deux options. </p><br><ol><li>  Utilisez la fonction <strong>DDL</strong> automatique d'Hibernate.  Le Spring Boot Test d√©finira automatiquement cette valeur sur <code>create-drop</code> afin qu'Hibernate g√©n√®re un sch√©ma √† partir de la description de l'entit√© et le supprime √† la fin de la session.  Il s'agit d'une fonctionnalit√© incroyablement puissante d'Hibernate, qui est tr√®s utile pour les tests. </li><li>  Utilisez les migrations cr√©√©es par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flyway</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liquibase</a> . </li></ol><br><p>  Vous pouvez en savoir plus sur les diff√©rentes approches d'initialisation de la base de donn√©es dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . </p><br><p>  <strong>@AutoConfigureCache</strong> <br>  Il configure simplement le cache pour utiliser NoOpCacheManager - c'est-√†-dire  ne cache rien.  Ceci est utile pour √©viter les surprises lors des tests. </p><br><p>  <strong>@AutoConfigureTestEntityManager</strong> <br>  Ajoute un objet <code>TestEntityManager</code> sp√©cial au <code>TestEntityManager</code> , qui en soi est une b√™te int√©ressante.  <code>EntityManager</code> est la classe principale de JPA, qui est responsable de l'ajout d'entit√©s √† la session, de la suppression et d'autres choses similaires.  Ce n'est que lorsque, par exemple, Hibernate entre en service - l'ajout d'une entit√© √† une session ne signifie pas qu'une demande √† la base de donn√©es sera ex√©cut√©e et le chargement √† partir d'une session ne signifie pas qu'une demande de s√©lection sera ex√©cut√©e.  En raison des m√©canismes internes d'Hibernate, les op√©rations r√©elles avec la base de donn√©es seront effectu√©es au bon moment, ce que le cadre lui-m√™me d√©terminera.  Mais dans les tests, il peut √™tre n√©cessaire d'envoyer de force quelque chose √† la base de donn√©es, car le but des tests est de tester l'int√©gration.  Et <code>TestEntityManager</code> est juste une aide qui aidera √† effectuer de force certaines op√©rations avec la base de donn√©es - par exemple, <code>persistAndFlush()</code> forcera Hibernate √† ex√©cuter toutes les requ√™tes. </p><br><p>  <strong>@Transactional</strong> <br>  Cette annotation rend tous les tests de la classe transactionnels, avec restauration automatique de la transaction √† la fin du test.  Il s'agit simplement d'un m√©canisme de ¬´nettoyage¬ª de la base de donn√©es avant chaque test, car sinon vous devrez supprimer manuellement les donn√©es de chaque table. </p><br><blockquote>  La question de savoir si un test doit g√©rer une transaction n'est pas une question aussi simple et √©vidente que cela puisse para√Ætre.  Malgr√© la commodit√© de l'√©tat ¬´propre¬ª de la base de donn√©es, la pr√©sence de <code>@Transactional</code> dans les tests peut √™tre une surprise d√©sagr√©able si le code de ¬´bataille¬ª ne d√©marre pas la transaction lui-m√™me, mais n√©cessite un code existant.  Cela peut conduire au fait que le test d'int√©gration r√©ussit, mais lorsque le code r√©el est ex√©cut√© √† partir du contr√¥leur, et non √† partir du test, le service n'aura pas de transaction active et la m√©thode l√®vera une exception.  Bien que cela semble dangereux, avec des tests de haut niveau de tests d'interface utilisateur, les tests transactionnels ne sont pas si mauvais.  D'apr√®s mon exp√©rience, je n'ai vu qu'une seule fois, lors d'un test d'int√©gration r√©ussi, le code de production s'est √©cras√©, ce qui a clairement exig√© l'existence d'une transaction existante.  Mais si vous devez toujours v√©rifier que les services et les composants g√®rent eux-m√™mes correctement les transactions, vous pouvez ¬´bloquer¬ª l'annotation <code>@Transactional</code> sur le test avec le mode souhait√© (par exemple, ne d√©marrez pas la transaction). </blockquote><br><h1 id="integracionnyy-test-so-springboottest">  Test d'int√©gration avec @SpringBootTest </h1><br><p>  Je tiens √©galement √† noter que <code>@DataJpaTest</code> n'est pas un exemple unique de test d'int√©gration focale, il existe <code>@WebMvcTest</code> , <code>@DataMongoTest</code> et bien d'autres.  Mais l'une des annotations de test les plus importantes reste <code>@SpringBootTest</code> , qui lance l'application <em>¬´telle</em> quelle <em>¬ª</em> pour les tests - avec tous les composants et int√©grations configur√©s.  Une question logique se pose - si vous pouvez ex√©cuter l'application enti√®re, pourquoi faire des tests focaux DataJpa, par exemple?  Je dirais qu'il n'y a pas de r√®gles strictes ici encore. </p><br><p>  S'il <em>est possible</em> d'ex√©cuter des applications √† chaque fois, d'isoler les plantages dans les tests, de ne pas surcharger et de ne pas compliquer √† nouveau la configuration du test, alors bien s√ªr, vous pouvez et devez utiliser @SpringBootTest. </p><br><p>  Cependant, dans la vie r√©elle, les applications peuvent n√©cessiter de nombreux param√®tres diff√©rents, se connecter √† diff√©rents syst√®mes et je ne voudrais pas que mes tests d'acc√®s √† la base de donn√©es tombent, car  la connexion √† la file d'attente des messages n'est pas configur√©e.  Par cons√©quent, il est important d'utiliser le bon sens, et si pour que le test avec l'annotation @SpringBootTest fonctionne, vous devez verrouiller la moiti√© du syst√®me - est-ce que cela a du sens alors dans @SpringBootTest? </p><br><h1 id="podgotovka-dannyh-dlya-testa">  Pr√©paration des donn√©es pour le test </h1><br><p>  L'un des points cl√©s des tests est la pr√©paration des donn√©es.  Chaque test doit √™tre effectu√© de mani√®re isol√©e et pr√©parer l'environnement avant de d√©marrer, amenant le syst√®me √† son √©tat d'origine souhait√©.  L'option la plus simple pour ce faire consiste √† utiliser les annotations <code>@BeforeEach</code> / <code>@BeforeAll</code> et √† y ajouter des entr√©es √† la base de donn√©es √† l'aide du r√©f√©rentiel, <code>TestEntityManager</code> ou <code>TestEntityManager</code> .  Mais il existe une autre option qui vous permet d'ex√©cuter un script pr√©par√© ou d'ex√©cuter la requ√™te SQL souhait√©e, c'est l'annotation <code>@Sql</code> .  Avant d'ex√©cuter le test, le Spring Boot Test ex√©cutera automatiquement le script sp√©cifi√©, √©liminant la n√©cessit√© d'ajouter le bloc <code>@BeforeAll</code> , et <code>@Transactional</code> se chargera du <code>@Transactional</code> donn√©es. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@DataJpaTest</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaCakeFinderTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PROMOTED_CAKE = <span class="hljs-string"><span class="hljs-string">"Red Velvet"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String NON_PROMOTED_CAKE = <span class="hljs-string"><span class="hljs-string">"Victoria Sponge"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CakeFinder finder; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> CakeRepository cakeRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> TestEntityManager testEntityManager; <span class="hljs-meta"><span class="hljs-meta">@BeforeEach</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.testEntityManager.persistAndFlush(CakeEntity.builder().title(PROMOTED_CAKE) .sku(<span class="hljs-string"><span class="hljs-string">"SKU1"</span></span>).price(BigDecimal.TEN).promoted(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.testEntityManager.persistAndFlush(CakeEntity.builder().sku(<span class="hljs-string"><span class="hljs-string">"SKU2"</span></span>) .title(NON_PROMOTED_CAKE).price(BigDecimal.ONE).promoted(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>).build()); finder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JpaCakeFinder(cakeRepository); } ... }</code> </pre> <br><h1 id="red-green-refactor-cikl">  Cycle de refactorisation rouge-vert </h1><br><p>  Malgr√© cette quantit√© de texte, pour le d√©veloppeur, le test ressemble toujours √† une classe simple avec l'annotation @DataJpaTest, mais j'esp√®re que j'ai pu montrer combien de choses utiles se passent sous le capot, auxquelles le d√©veloppeur ne peut pas penser.  Nous pouvons maintenant passer au cycle TDD et cette fois, je vais montrer quelques it√©rations TDD, avec des exemples de refactoring et de code minimal.  Pour le rendre plus clair, je vous recommande fortement de regarder l'historique dans Git, o√π chaque commit est une √©tape distincte et significative avec une description de ce qu'il fait et comment il le fait. </p><br><h2 id="podgotovka-dannyh">  Pr√©paration des donn√©es </h2><br><p>  J'utilise l'approche avec <code>@BeforeAll</code> / <code>@BeforeEach</code> et cr√©e manuellement tous les enregistrements de la base de donn√©es.  L'exemple avec l'annotation <code>@Sql</code> a √©t√© d√©plac√© dans une classe distincte <code>JpaCakeFinderTestWithScriptSetup</code> , il duplique les tests, ce qui, bien s√ªr, ne devrait pas l'√™tre, et existe dans le seul but de d√©montrer l'approche. </p><br><p>  L'√©tat initial du syst√®me - il y a deux entr√©es dans le syst√®me, un g√¢teau participe √† la promotion et doit √™tre inclus dans le r√©sultat retourn√© par la m√©thode, le second - non. </p><br><h2 id="pervyy-test-integracionnyy-test">  Premier test test d'int√©gration </h2><br><p>  Le premier test est le plus simple - <code>findPromotedCakes</code> doit inclure une description et le prix du g√¢teau participant √† la promotion. </p><br><h3 id="red">  Rouge </h3><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldReturnPromotedCakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Iterable&lt;Cake&gt; promotedCakes = finder.findPromotedCakes(); assertThat(promotedCakes).extracting(Cake::getTitle).contains(PROMOTED_CAKE); assertThat(promotedCakes).extracting(Cake::getPrice).contains(<span class="hljs-string"><span class="hljs-string">"¬£10.00"</span></span>); }</code> </pre> <br><p>  Le test se bloque, bien s√ªr, l'impl√©mentation par d√©faut renvoie un ensemble vide. </p><br><h3 id="green">  Vert </h3><br><p>  Naturellement, nous aimerions √©crire imm√©diatement le filtrage, faire une demande √† la base de donn√©es avec <code>where</code> et ainsi de suite.  Mais suivant la pratique TDD, je dois √©crire le <em>code minimum pour que le test r√©ussisse</em> .  Et ce code minimal consiste √† renvoyer tous les enregistrements de la base de donn√©es.  Oui, si simple et ringard. </p><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Set&lt;Cake&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findPromotedCakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Spliterator&lt;CakeEntity&gt; cakes = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cakeRepository.findAll() .spliterator(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StreamSupport.stream(cakes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>).map( cakeEntity -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cake(cakeEntity.title, formatPrice(cakeEntity.price))) .collect(Collectors.toSet()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal price)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"¬£"</span></span> + price.setScale(<span class="hljs-number"><span class="hljs-number">2</span></span>, RoundingMode.DOWN).toPlainString(); }</code> </pre> <br><blockquote>  Certains diront probablement qu'ici, vous pouvez rendre le test vert m√™me sans base - il suffit de coder en dur le r√©sultat attendu par le test.  J'entends parfois un tel argument, mais je pense que tout le monde comprend que le TDD n'est pas un dogme ou une religion, cela n'a aucun sens d'amener cela au point d'absurdit√©.  Mais si vous le voulez vraiment, vous pouvez, par exemple, randomiser des donn√©es sur l'installation afin qu'elles ne soient pas cod√©es en dur. </blockquote><br><h3 id="refactor">  Refactor </h3><br><p>  Je ne vois pas beaucoup de refactoring ici, donc cette phase peut √™tre ignor√©e pour ce test particulier.  Mais je ne recommanderais toujours pas d'ignorer cette phase, il vaut mieux s'arr√™ter et penser √† chaque fois dans l'√©tat ¬´vert¬ª du syst√®me - est-il possible de refactoriser quelque chose pour le rendre meilleur et plus facile? </p><br><h2 id="vtoroy-test">  Deuxi√®me test </h2><br><p>  Mais le deuxi√®me test v√©rifiera d√©j√† qu'aucun g√¢teau promu ne tombera dans le r√©sultat renvoy√© par <code>findPromotedCakes</code> . </p><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldNotReturnNonPromotedCakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Iterable&lt;Cake&gt; promotedCakes = finder.findPromotedCakes(); assertThat(promotedCakes).extracting(Cake::getTitle) .doesNotContain(NON_PROMOTED_CAKE); }</code> </pre> <br><h3 id="red-1">  Rouge </h3><br><p>  Comme pr√©vu, le test se bloque - il y a deux enregistrements dans la base de donn√©es et le code les renvoie simplement tous. </p><br><h3 id="green-1">  Vert </h3><br><p>  Et encore une fois, vous pouvez penser - et quel est le code minimum que vous pouvez √©crire pour r√©ussir le test?  Puisqu'il y a d√©j√† un flux et son assemblage, vous pouvez simplement y ajouter un bloc de <code>filter</code> . </p><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Set&lt;Cake&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findPromotedCakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Spliterator&lt;CakeEntity&gt; cakes = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cakeRepository.findAll() .spliterator(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StreamSupport.stream(cakes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) .filter(cakeEntity -&gt; cakeEntity.promoted) .map(cakeEntity -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cake(cakeEntity.title, formatPrice(cakeEntity.price))) .collect(Collectors.toSet()); }</code> </pre> <br><p>  Nous recommen√ßons les tests - les tests d'int√©gration sont d√©sormais verts.  Un moment important est venu - gr√¢ce √† la combinaison du test unitaire du contr√¥leur et du test d'int√©gration pour travailler avec la base de donn√©es, ma fonctionnalit√© est pr√™te - et le test de l'interface utilisateur passe maintenant! </p><br><h3 id="refactor-1">  Refactor </h3><br><p>  Et puisque tous les tests sont verts - il est temps de refactoriser.  Je pense qu'il n'est pas n√©cessaire de pr√©ciser que le filtrage en m√©moire n'est pas une bonne id√©e, il vaut mieux le faire dans la base de donn√©es.  Pour ce faire, j'ai ajout√© une nouvelle m√©thode dans le <code>CakesRepository</code> - <code>CakesRepository</code> : </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CakeRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CakeEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">Iterable&lt;CakeEntity&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByPromotedIsTrue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  Pour cette m√©thode, Spring Data a g√©n√©r√© automatiquement une m√©thode qui ex√©cutera une requ√™te du formulaire de <code>select from cakes where promoted = true</code> .  En savoir plus sur la g√©n√©ration de requ√™tes dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> Spring Data. </p><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Set&lt;Cake&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findPromotedCakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Spliterator&lt;CakeEntity&gt; cakes = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cakeRepository.findByPromotedIsTrue() .spliterator(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StreamSupport.stream(cakes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>).map( cakeEntity -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cake(cakeEntity.title, formatPrice(cakeEntity.price))) .collect(Collectors.toSet()); }</code> </pre> <br><p>  C'est un bon exemple de la flexibilit√© offerte par les tests d'int√©gration et l'approche par bo√Æte noire.  Si le r√©f√©rentiel √©tait verrouill√©, il n'√©tait pas impossible d'ajouter une nouvelle m√©thode sans modifier les tests. </p><br><h1 id="podklyuchenie-k-production-baze">  Connexion √† la base de production </h1><br><p>  Pour ajouter un peu de ¬´r√©alisme¬ª et montrer comment s√©parer la configuration des tests et l'application principale, j'ajouterai une configuration d'acc√®s aux donn√©es pour l'application ¬´production¬ª. </p><br><p>  Tout est traditionnellement ajout√© par la section dans <code>application.yml</code> : </p><br><pre> <code class="plaintext hljs">datasource: url: jdbc:h2:./data/cake-factory</code> </pre><br><p>  Cela enregistrera automatiquement les donn√©es du syst√®me de fichiers dans le dossier <code>./data</code> .  Je note que ce dossier ne sera pas cr√©√© dans les tests - <code>@DataJpaTest</code> remplacera automatiquement la connexion √† la base de donn√©es de fichiers par une base de donn√©es al√©atoire en m√©moire en raison de la pr√©sence de l'annotation <code>@AutoConfigureTestDatabase</code> . </p><br><blockquote>   ,    ‚Äî   <code>data.sql</code>  <code>schema.sql</code> .   , Spring Boot             .          ,   , ,    . </blockquote><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p> ,               ,    ,       TDD . </p><br><p>      Spring Security ‚Äî                Spring,       . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433958/">https://habr.com/ru/post/fr433958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433946/index.html">Aide-m√©moire pour l'intelligence artificielle - jetez l'exc√©dent, enseignez l'essentiel. Technique de traitement des s√©quences de formation</a></li>
<li><a href="../fr433948/index.html">Comment rendre le paiement plus pratique: l'exp√©rience d'un fournisseur IaaS</a></li>
<li><a href="../fr433952/index.html">10 raisons de choisir une solution pour SAP HANA de HPE. 2e partie</a></li>
<li><a href="../fr433954/index.html">Huit technologies audio et gadgets audio qui entreront au Temple de la renomm√©e de TECnology en 2019</a></li>
<li><a href="../fr433956/index.html">Les modders ont utilis√© l'IA pour am√©liorer la texture dans les jeux</a></li>
<li><a href="../fr433964/index.html">Modules ECMAScript dans Node.js: un nouveau plan</a></li>
<li><a href="../fr433966/index.html">Carte de No√´l de Mars. L'ESA a montr√© une grande accumulation de glace √† la surface de la plan√®te rouge</a></li>
<li><a href="../fr433968/index.html">Le jeu de communication le plus d√©g√©n√©r√©</a></li>
<li><a href="../fr433972/index.html">HolyJS 2018 Moscou √† travers les yeux du participant</a></li>
<li><a href="../fr433974/index.html">Chatbot fait entendre ou souffre amateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>