<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéôÔ∏è üë∂üèº üëÜüèª Dix choses que vous pouvez faire avec GraalVM üëèüèø ‚ö™Ô∏è üòØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Du traducteur: GraalVM est une nouvelle technologie int√©ressante, mais sur Habr√© il n'y a pas beaucoup d'articles sur elle qui pourraient montrer des ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dix choses que vous pouvez faire avec GraalVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/433432/"><p><img src="https://habrastorage.org/webt/7z/5d/ap/7z5dap05rvptsue50u6ajtsxsmw.png"><br>  <em>Du traducteur: GraalVM est une nouvelle technologie int√©ressante, mais sur Habr√© il n'y a pas beaucoup d'articles sur elle qui pourraient montrer des exemples de capacit√©s Graal.</em>  <em>L'article ci-dessous n'est pas seulement une liste de ce que GraalVM peut faire, mais aussi une petite master class similaire √† celle que Chris Seaton et Oleg Shelaev ont dirig√©e √† Oracle CodeOne 2018. Apr√®s l'auteur, je vous exhorte √† essayer de faire des exemples √† partir de l'article, c'est vraiment int√©ressant.</em> </p><br><p>  Il <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">y a</a> beaucoup de choses diff√©rentes dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GraalVM</a> , et si vous avez d√©j√† entendu ce nom, ou m√™me vu des rapports, il y a encore beaucoup de choses que vous ne savez probablement pas encore, mais que GraalVM peut faire.  Dans cet article, nous examinerons les diff√©rentes fonctionnalit√©s fournies par GraalVM et montrerons ce que vous pouvez en faire. </p><br><ol><li>  Ex√©cution rapide Java </li><li>  Diminuez l'heure de d√©but et l'utilisation de la m√©moire pour Java </li><li>  Combiner JavaScript, Java, Ruby et R </li><li>  Ex√©cution de programmes √©crits dans des langages sp√©cifiques √† la plateforme </li><li>  Outils communs √† tous les langages de programmation </li><li>  Suppl√©ment d'application JVM </li><li>  Applications d√©pendantes de la plateforme </li><li>  Code Java en tant que biblioth√®que sp√©cifique √† la plate-forme </li><li>  Prise en charge de plusieurs langages de programmation dans la base de donn√©es </li><li>  Cr√©ation de langages de programmation pour GraalVM </li></ol><a name="habracut"></a><br><p>  Vous pouvez faire tout ce qui est montr√© dans cet article en utilisant GraalVM 1.0.0 RC1, qui est disponible via le lien <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du site Web de GraalVM</a> .  J'ai utilis√© MacOS Enterprise Edition, mais le code ici fonctionne sur Linux et GraalVM Community Edition. </p><br><p>  Lorsque vous lisez l'article, ex√©cutez les programmes qui y sont d√©crits!  Le code peut √™tre t√©l√©charg√© depuis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . </p><br><h2 id="ustanovka">  L'installation </h2><br><p> Apr√®s avoir t√©l√©charg√© depuis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://graalvm.org/downloads,</a> j'ai ajout√© le chemin vers les ex√©cutables GraalVM dans <code>$PATH</code> .  Par d√©faut, cela ajoute la prise en charge de l'ex√©cution Java et JavaScript. </p><br><pre> <code class="plaintext hljs">$ git clone https://github.com/chrisseaton/graalvm-ten-things.git $ cd foo $ tar -zxf graalvm-ee-1.0.0-rc1-macos-amd64.tar.gz # or graalvm-ee-1.0.0-rc1-linux-amd64.tar.gz on Linux $ export PATH=graalvm-1.0.0-rc1/Contents/Home/bin:$PATH # or PATH=graalvm-1.0.0-rc1/bin:$PATH on Linux</code> </pre> <br><p>  GraalVM est livr√© avec une prise en charge JavaScript int√©gr√©e et contient un gestionnaire de packages appel√© <code>gu</code> qui ajoute la possibilit√© d'installer la prise en charge de langues autres que Java et JavaScript.  J'ai √©galement install√© Ruby, Python et R, ils sont t√©l√©charg√©s depuis GitHub. </p><br><pre> <code class="plaintext hljs">$ gu install -c org.graalvm.ruby $ gu install -c org.graalvm.python $ gu install -c org.graalvm.R</code> </pre> <br><p>  Maintenant, si vous ex√©cutez la commande <code>java</code> ou <code>js</code> , vous verrez les versions GraalVM de ces moteurs. </p><br><pre> <code class="plaintext hljs">$ java -version java version "1.8.0_161" Java(TM) SE Runtime Environment (build 1.8.0_161-b12) GraalVM 1.0.0-rc1 (build 25.71-b01-internal-jvmci-0.42, mixed mode) $ js --version Graal JavaScript 1.0 (GraalVM 1.0.0-rc1)</code> </pre> <br><h2 id="1-bystroe-vypolnenie-java">  1. Ex√©cution Java rapide </h2><br><p>  ¬´Graal¬ª dans GraalVM est le nom du compilateur.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lui seul est cr√©√© pour tout gouverner</a> !  Cela signifie qu'il s'agit d'une impl√©mentation de compilateur √©crite sous la forme d'une biblioth√®que qui peut √™tre utilis√©e pour beaucoup de choses diff√©rentes.  Par exemple, nous utilisons Graal pour compiler √† la fois √† l' <em>avance</em> et <em>juste √† temps</em> pour compiler du code √©crit dans diff√©rents langages de programmation, y compris pour diff√©rentes architectures de processeur. </p><br><p>  La premi√®re et la plus simple fa√ßon d'utiliser Graal est de l'utiliser comme compilateur Java JIT. </p><br><p>  √Ä titre d'exemple, nous utiliserons un programme qui produit 10 des mots les plus courants dans un document.  Le programme utilise les capacit√©s du langage Java moderne, telles que les flux et les collections. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Files; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Paths; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Function; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Arrays.stream(args) .flatMap(TopTen::fileLines) .flatMap(line -&gt; Arrays.stream(line.split(<span class="hljs-string"><span class="hljs-string">"\\b"</span></span>))) .map(word -&gt; word.replaceAll(<span class="hljs-string"><span class="hljs-string">"[^a-zA-Z]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) .filter(word -&gt; word.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .map(word -&gt; word.toLowerCase()) .collect(Collectors.groupingBy(Function.identity(), Collectors.counting())) .entrySet().stream() .sorted((a, b) -&gt; -a.getValue().compareTo(b.getValue())) .limit(<span class="hljs-number"><span class="hljs-number">10</span></span>) .forEach(e -&gt; System.out.format(<span class="hljs-string"><span class="hljs-string">"%s = %d%n"</span></span>, e.getKey(), e.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Stream&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Files.lines(Paths.get(path)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(e); } } }</code> </pre> <br><p>  GraalVM inclut le compilateur <code>javac</code> , mais il n'y a aucune diff√©rence pour cette d√©mo que ce soit pour l'utiliser ou pour le compilateur standard.  Par cons√©quent, vous pouvez utiliser le compilateur <code>javac</code> standard si vous le souhaitez. </p><br><pre> <code class="plaintext hljs">$ javac TopTen.java</code> </pre> <br><p>  Si nous ex√©cutons la commande <code>java</code> , qui est incluse dans GraalVM, alors le compilateur Grait JIT sera utilis√© automatiquement - aucune √©tape suppl√©mentaire n'est requise.  J'utiliserai la commande <code>time</code> afin d'obtenir des donn√©es r√©elles sur le temps pass√© √† ex√©cuter le programme du d√©but √† la fin, au lieu de d√©ployer un micro-benchmark complexe.  Une grande quantit√© d'entr√©e sera √©galement utilis√©e afin qu'il n'y ait aucune insinuation sur les quelques secondes enregistr√©es ici ou l√†.  La taille du fichier <code>large.txt</code> est de 150 Mo. </p><br><pre> <code class="plaintext hljs">$ make large.txt $ time java TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m17.367s user 0m32.355s sys 0m1.456s</code> </pre> <br><p>  Graal est √©crit en Java, pas en C ++, comme la plupart des autres compilateurs JIT pour Java.  Nous pensons que cela nous permet de l'am√©liorer plus rapidement que les compilateurs existants, en ajoutant de nouvelles optimisations puissantes (comme, par exemple, l'analyse d'√©chappement partielle) qui ne sont pas disponibles dans le compilateur JIT standard pour HotSpot. <br>  Et cela peut rendre vos programmes Java beaucoup plus rapides. </p><br><p>  √Ä des fins de comparaison, pour ex√©cuter des programmes sans le compilateur Grait JIT, j'utiliserai l' <code>-XX:-UseJVMCICompiler</code> .  JVMCI est l'interface entre Graal et la JVM.  Vous pouvez √©galement ex√©cuter l'exemple sur une machine virtuelle Java standard et comparer les r√©sultats. </p><br><pre> <code class="plaintext hljs">$ time java -XX:-UseJVMCICompiler TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m23.511s user 0m24.293s sys 0m0.579s</code> </pre> <br><p>  Ce test montre que Graal ex√©cute notre programme Java dans environ les trois quarts du temps qu'il faut pour l'ex√©cuter avec le compilateur HotSpot standard.  Lorsque nous pensons que l'am√©lioration de la productivit√© par unit√©s de pourcentage est une r√©alisation importante, 25% est une grosse affaire. </p><br><p>  Twitter est aujourd'hui la seule entreprise √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utiliser Graal sur des serveurs ¬´de combat¬ª</a> , et ils disent que c'est justifi√© pour eux, en termes d'√©conomies d'argent r√©el.  Twitter utilise Graal pour ex√©cuter des applications √©crites en Scala - Graal fonctionne au niveau JVM du bytecode, c'est-√†-dire  applicable √† tout langage JVM. </p><br><p>  Il s'agit du premier cas d'utilisation de GraalVM - il suffit de remplacer le compilateur JIT par une meilleure version pour vos applications Java existantes. </p><br><h2 id="2-umenshenie-vremeni-starta-i-potrebleniya-pamyati-dlya-java">  2. Diminuez l'heure de d√©but et l'utilisation de la m√©moire pour Java </h2><br><p>  Les atouts de la plate-forme Java sont particuli√®rement √©vidents lorsque vous travaillez avec des processus de longue dur√©e et des charges de pointe.  Les processus de courte dur√©e, en revanche, souffrent de longs temps de d√©marrage et d'une utilisation relativement √©lev√©e de la m√©moire. </p><br><p>  Par exemple, si nous ex√©cutons l'application de la section pr√©c√©dente, en lui fournissant une quantit√© beaucoup plus petite de donn√©es d'entr√©e - environ 1 Ko au lieu de 150 Mo, il semble que cela prendra un temps excessivement long et beaucoup de m√©moire - environ 60 Mo, afin de traiter un si petit fichier. .  Nous utilisons l'option <code>-l</code> pour imprimer la quantit√© de m√©moire utilis√©e en plus du temps d'ex√©cution. </p><br><pre> <code class="plaintext hljs">$ make small.txt $ /usr/bin/time -l java TopTen small.txt # -v on Linux instead of -l sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.32 real 0.49 user 0.05 sys 59846656 maximum resident set size</code> </pre> <br><p>  GraalVM nous donne un outil qui r√©sout ce probl√®me.  Nous avons dit que Graal est une biblioth√®que de compilation et qu'elle peut √™tre utilis√©e de diff√©rentes mani√®res.  L'un d'eux consiste √† compiler √† l' <em>avance</em> dans une image ex√©cutable <em>d√©pendante de la</em> plate-forme, au lieu de compiler <em>juste √† temps</em> au <em>moment</em> de l'ex√©cution.  Ceci est similaire au fonctionnement d'un compilateur classique, tel que <code>gcc</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server TopTen classlist: 1,513.82 ms (cap): 2,333.95 ms setup: 3,584.09 ms (typeflow): 4,642.13 ms (objects): 3,073.58 ms (features): 156.34 ms analysis: 8,059.94 ms universe: 353.02 ms (parse): 1,277.02 ms (inline): 1,412.08 ms (compile): 10,337.76 ms compile: 13,776.23 ms image: 2,526.63 ms write: 1,525.03 ms [total]: 31,439.47 ms</code> </pre> <br><p>  Cette commande cr√©e un <code>topten</code> plate-forme appel√© <code>topten</code> .  Ce fichier ne d√©marre pas la JVM, il n'est pas li√© √† la JVM et il n'inclut en aucune fa√ßon la JVM.  La commande <code>native-image</code> compile v√©ritablement votre code Java et les biblioth√®ques Java que vous utilisez en code machine complet.  Pour les composants d'ex√©cution tels que le garbage collector, nous lan√ßons notre propre nouvelle machine virtuelle appel√©e SubstrateVM, qui, comme Graal, est √©galement √©crite en Java. </p><br><p>  Si vous regardez les d√©pendances <code>topten</code> par <code>topten</code> , vous verrez que ce ne sont que des biblioth√®ques syst√®me standard.  Nous ne pouvons transf√©rer que ce seul fichier vers un syst√®me dans lequel la JVM n'a jamais √©t√© install√©e et l'ex√©cuter l√†-bas pour v√©rifier qu'il n'utilise pas la JVM ou tout autre fichier.  <code>Topten</code> √©galement assez petit - le code ex√©cutable prend moins de 6 Mo. </p><br><pre> <code class="plaintext hljs">$ otool -L topten # ldd topten on Linux topten: .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h topten 5.7M topten</code> </pre> <br><p>  Si nous ex√©cutons cet ex√©cutable, nous verrons qu'il d√©marre environ un ordre de grandeur plus rapidement et utilise environ un ordre de grandeur moins de m√©moire que le m√™me programme ex√©cut√© sous la JVM.  Le lancement est si rapide que vous ne remarquerez pas combien de temps cela a pris.  Si vous utilisez la ligne de commande, vous ne ressentirez pas la pause qui est g√©n√©ralement pr√©sente lorsque vous ex√©cutez un petit programme de courte dur√©e sous la JVM </p><br><pre> <code class="plaintext hljs">$ /usr/bin/time -l ./topten small.txt sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.02 real 0.00 user 0.00 sys 4702208 maximum resident set size</code> </pre> <br><p>  L'utilitaire d' <code>native-image</code> a certaines <a href="">limites</a> .  Ainsi, au moment de la compilation, toutes les classes doivent √™tre pr√©sentes, il existe √©galement des restrictions sur l'utilisation de l'API Reflection.  Mais il existe certains avantages suppl√©mentaires par rapport √† la compilation de base, tels que l'ex√©cution d'initialiseurs statiques au moment de la compilation.  Ainsi, la quantit√© de travail effectu√©e √† chaque t√©l√©chargement de l'application est r√©duite. </p><br><p>  Il s'agit de la deuxi√®me application de GraalVM - la distribution et l'ex√©cution de programmes Java existants, avec un d√©marrage rapide et moins de consommation de m√©moire.  Cette m√©thode r√©sout les probl√®mes de configuration tels que la recherche du bon bocal au moment de l'ex√©cution et vous permet √©galement de cr√©er des images Docker plus petites. </p><br><h2 id="3-kombinirovanie-javascript-java-ruby-i-r">  3. Combiner JavaScript, Java, Ruby et R </h2><br><p>  Avec Java, GraalVM inclut de nouvelles impl√©mentations de moteurs JavaScript, Ruby, R et Python.  Ils sont √©crits √† l'aide d'un nouveau framework appel√© <em>Truffle</em> .  Ce framework permet de cr√©er des interpr√©teurs de langage √† la fois simples et performants.  Lorsque vous √©crivez un interpr√©teur de langue √† l'aide de Truffle, il utilise automatiquement Graal pour fournir une compilation JIT pour votre langue.  Ainsi, Graal n'est pas seulement un compilateur JIT et un compilateur AOT pour Java, il peut √©galement √™tre un compilateur JIT pour JavaScript, Ruby, R et Python. </p><br><p>  La prise en charge des langues tierces dans GraalVM vise √† remplacer de mani√®re transparente les moteurs existants pour l'ex√©cution de diff√©rentes langues.  Par exemple, nous pouvons installer le module ¬´couleur¬ª pour Node.js: </p><br><pre> <code class="plaintext hljs">$ npm install --global color ... + color@3.0.0 added 6 packages in 14.156s</code> </pre> <br><p>  Ensuite, √©crivez un programme utilisant ce module pour convertir les couleurs HTML RVB en HSL: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Color = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color'</span></span>); process.argv.slice(<span class="hljs-number"><span class="hljs-number">2</span></span>).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ print(Color(val).hsl().string()); });</code> </pre> <br><p>  Et ex√©cutez-le de la mani√®re habituelle: </p><br><pre> <code class="plaintext hljs">$ node color.js '#42aaf4' hsl(204.89999999999998, 89%, 60.8%)</code> </pre> <br><p>  Les moteurs d'ex√©cution de diff√©rents langages dans GraalVM fonctionnent ensemble - il existe une API qui vous permet d'ex√©cuter du code √† partir d'un langage dans un programme √©crit dans un autre langage.  Et cela vous permet d'√©crire des programmes multilingues - des programmes √©crits dans plus d'un langage de programmation. </p><br><p>  Cela peut √™tre n√©cessaire si vous √©crivez la plupart de votre programme dans une langue, mais que vous souhaitez utiliser une biblioth√®que √©crite dans un autre langage de programmation.  Par exemple, supposons que nous devions √©crire une application pour convertir un nom de couleur de CSS en sa repr√©sentation num√©rique dans Node.js, mais nous voulons utiliser une biblioth√®que de couleurs Ruby au lieu d'√©crire la conversion nous-m√™mes. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = express(); color_rgb = Polyglot.eval(<span class="hljs-string"><span class="hljs-string">'ruby'</span></span>, <span class="hljs-string"><span class="hljs-string">` require 'color' Color::RGB `</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'/css/:name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ color = color_rgb.by_name(req.params.name).html() res.send(<span class="hljs-string"><span class="hljs-string">'&lt;h1 style="color: '</span></span> + color + <span class="hljs-string"><span class="hljs-string">'" &gt;'</span></span> + color + <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;'</span></span>); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'serving at http://localhost:8080'</span></span>) });</code> </pre> <br><p>  Dans ce code, nous avons √©crit que nous devons ex√©cuter le code Ruby en tant que cha√Æne, mais notez que nous n'avons pas fait grand chose ici - nous venons de connecter les biblioth√®ques puis de renvoyer l'objet Ruby.  Dans Ruby, nous l'utiliserions comme ceci: <code>Color::RGB.by_name (name).html</code> .  Si vous regardez comment <code>color_rgb</code> utilis√© plus tard dans JavaScript, vous verrez que nous appelons en fait les m√™mes m√©thodes √† partir de JavaScript, bien qu'il s'agisse d'objets et de m√©thodes Ruby.  Et nous les passons en tant que cha√Ænes JavaScript et combinons le r√©sultat, qui est une cha√Æne Ruby, avec une cha√Æne JavaScript. </p><br><p>  Installez les deux d√©pendances - Ruby et JavaScript. </p><br><pre> <code class="plaintext hljs">$ gem install color Fetching: color-1.8.gem (100%) Successfully installed color-1.8 1 gem installed $ npm install express + express@4.16.2 updated 1 package in 10.393s</code> </pre> <br><p>  Ensuite, vous devez d√©marrer le <code>node</code> avec quelques options suppl√©mentaires: <code>--polyglot</code> , pour dire que nous avons besoin d'acc√©der √† d'autres langues et <code>--jvm</code> , car l'image de <code>node</code> ex√©cutable par d√©faut n'inclut rien d'autre que JavaScript. </p><br><pre> <code class="plaintext hljs">$ node --polyglot --jvm color-server.js serving at http://localhost:8080</code> </pre> <br><p>  Ensuite, acc√©dez √† l'URL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8080 / css / orange</a> (ou une autre couleur), comme d'habitude, dans votre navigateur. <br><img src="https://habrastorage.org/webt/_h/uz/e2/_huze29ugzgpz8ecll22rpv6s1w.png"><br>  Essayons de faire un exemple plus s√©rieux, qui utilise plus de langues et de modules. </p><br><p>  JavaScript ne prend pas en charge les tr√®s grands nombres entiers.  J'ai trouv√© plusieurs modules tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">big-integer</a> , mais ils sont tous inefficaces car  stocker les composants d'un nombre sous forme de nombres √† virgule flottante JavaScript.  La classe <code>BigInteger</code> en Java est plus efficace, utilisons-la pour effectuer quelques op√©rations arithm√©tiques avec de grands nombres entiers. </p><br><p>  JavaScript n'a pas non plus de support int√©gr√© pour dessiner des graphiques, tandis que R dessine parfaitement des graphiques.  Utilisons le module <code>svg</code> de R pour dessiner un nuage de points d'une fonction trigonom√©trique dans l'espace 3D. </p><br><p>  Dans les deux cas, nous utiliserons l'API pour prendre en charge le multilinguisme de GraalVM (ci-apr√®s d√©nomm√©e API Polyglot) et nous pouvons simplement ins√©rer les r√©sultats de l'ex√©cution de programmes dans d'autres langues en JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BigInteger = Java.type(<span class="hljs-string"><span class="hljs-string">'java.math.BigInteger'</span></span>) app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">'Hello World from Graal.js!&lt;br&gt; '</span></span> <span class="hljs-comment"><span class="hljs-comment">// Using Java standard library classes text += BigInteger.valueOf(10).pow(100) .add(BigInteger.valueOf(43)).toString() + '&lt;br&gt;' // Using R interoperability to create graphs text += Polyglot.eval('R', `svg(); require(lattice); x &lt;- 1:100 y &lt;- sin(x/10) z &lt;- cos(x^1.3/(runif(1)*5+10)) print(cloud(x~y*z, main="cloud plot")) grDevices:::svg.off() `); res.send(text) }) app.listen(3000, function () { console.log('Example app listening on port 3000!') })</span></span></code> </pre> <br><p>  Ouvrez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 3000 /</a> dans votre navigateur pour voir le r√©sultat: <br><img src="https://habrastorage.org/webt/1o/so/fj/1osofjuimjcfd7pv1qhcikonupo.png"><br>  C'est la troisi√®me chose que nous pouvons faire avec les programmes ex√©cut√©s par GraalVM √©crits en plusieurs langues et utiliser des modules de ces langues ensemble dans un seul programme.  Nous pr√©sentons cela comme un moyen d'unifier les environnements d'ex√©cution et les biblioth√®ques - vous pouvez utiliser le langage de programmation qui vous semble le mieux adapt√© pour r√©soudre la t√¢che actuelle et n'importe quelle biblioth√®que de votre choix, quel que soit le langage de programmation dans lequel il est √©crit. </p><br><h2 id="4-ispolnenie-programm-napisannyh-na-platformo-zavisimyh-yazykah">  4. Ex√©cution de programmes √©crits dans des langages sp√©cifiques √† la plate-forme </h2><br><p>  Un autre langage pris en charge par GraalVM est C. GraalVM peut ex√©cuter du code C de la m√™me mani√®re qu'il ex√©cute des programmes √©crits en JavaScript et Ruby. </p><br><p>  Ce que GraalVM prend r√©ellement en charge, c'est l'ex√©cution du code r√©sultant de l'ex√©cution des utilitaires LLVM, c'est-√†-dire  bitcode, pas de prise en charge directe de C. Cela signifie que vous pouvez utiliser les outils existants pour le langage C et d'autres qui prennent en charge LLVM, tels que C ++, Fortran et, potentiellement, plus de langues √† l'avenir.  Pour simplifier la d√©monstration, je lance une version sp√©ciale de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gzip</a> , qui est assembl√©e dans un seul fichier ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Stephen McCamant</a> prend en charge cette version).  C'est juste le code source <code>gzip</code> et la configuration <code>autoconf</code> combin√©s en un seul fichier pour plus de simplicit√©.  J'ai d√ª patcher quelques √©l√©ments pour le faire fonctionner sur macOS et avec clang, mais je n'ai rien fait sp√©cifiquement pour prendre en charge GraalVM. </p><br><p>  Nous <code>clang</code> gzip en utilisant le <code>clang</code> standard (compilateur LLVM pour C) et voulons qu'il fasse de nous un bitcode LLVM, et non une construction sp√©cifique √† la plate-forme, car GraalVM ne le lancera pas.  J'utilise <code>clang</code> 4.0.1. </p><br><pre> <code class="plaintext hljs">$ clang -c -emit-llvm gzip.c</code> </pre> <br><p>  Et puis ex√©cutez le r√©sultat, en utilisant directement la commande lli (interpr√®te de code binaire LLVM) de GraalVM.  Essayons de compresser le fichier √† l'aide de mon archiveur syst√®me gzip, puis d√©compressez-le √† l'aide de gzip ex√©cut√© sous GraalVM. </p><br><pre> <code class="plaintext hljs">$ cat small.txt Lorem ipsum dolor sit amet... $ gzip small.txt $ lli gzip.bc -d small.txt.gz $ cat small.txt Lorem ipsum dolor sit amet...</code> </pre> <br><p>  Les impl√©mentations Ruby et Python dans GraalVM utilisent la m√™me technique pour ex√©cuter des extensions √©crites en C pour ces langages.  Cela signifie que vous pouvez ex√©cuter ces extensions √† l'int√©rieur de la machine virtuelle et cela nous permet de maintenir une vitesse d'ex√©cution √©lev√©e m√™me si nous utilisons des interfaces d'extension sp√©cifiques √† la plate-forme obsol√®tes. </p><br><p>  C'est la quatri√®me fa√ßon d'utiliser GraalVM - en ex√©cutant des programmes √©crits dans des langages sp√©cifiques √† la plate-forme, tels que C ou C ++, ainsi qu'en ex√©cutant des extensions de langages tels que Python ou Ruby, qui ne sont pas en mesure de r√©aliser des impl√©mentations JVM de ces langages, tels que JRuby. </p><br><h2 id="5-obschie-instrumenty-dlya-vseh-yazykov-programmirovaniya">  5. Outils g√©n√©raux pour tous les langages de programmation </h2><br><p>  Si vous programmez en Java, vous utilisez probablement des outils de tr√®s haute qualit√© tels que les IDE, les d√©bogueurs et les profileurs.  Toutes les langues ne disposent pas de cette bo√Æte √† outils, mais vous pouvez en obtenir une si vous utilisez des langues prises en charge par GraalVM. </p><br><p>  La prise en charge de tous les langages dans GraalVM (sauf Java, pour le moment) est impl√©ment√©e √† l'aide d'un cadre commun - Truffle.  Cela nous permet de cr√©er une fonctionnalit√©, par exemple, un d√©bogueur, et de l'utiliser pour toutes les langues. </p><br><p>  Pour essayer cela, nous allons √©crire le programme le plus simple - <em>FizzBuzz</em> , car il est visuel (il imprime quelque chose √† l'√©cran) et il a des branches claires qui ne sont utilis√©es que dans certaines it√©rations.  Ainsi, il nous sera plus facile de d√©finir des points d'arr√™t.  Commen√ßons par une impl√©mentation JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fizzbuzz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'FizzBuzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Fizz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Buzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; n &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>; n++) { print(fizzbuzz(n)); }</code> </pre> <br><p>  Nous d√©marrons le programme comme d'habitude, en utilisant l'utilitaire <code>js</code> , sous GraalVM. </p><br><pre> <code class="plaintext hljs">$ js fizzbuzz.js 1 2 Fizz 4 Buzz Fizz</code> </pre> <br><p>  Nous pouvons √©galement ex√©cuter le programme avec le drapeau <code>--inspect</code> .  Cela nous donnera un lien que vous pouvez ouvrir dans Chrome et arr√™ter le programme dans le d√©bogueur. </p><br><pre> <code class="plaintext hljs">$ js --inspect fizzbuzz.js Debugger listening on port 9229. To start debugging, open the following URL in Chrome: chrome-devtools://devtools/bundled/inspector.html?ws=127.0.0.1:9229/6c478d4e-1350b196b409</code> </pre> <br><p>  Vous pouvez d√©finir un point d'arr√™t dans le code <em>FizzBuzz</em> puis poursuivre l'ex√©cution.  Lorsque le programme interrompt l'ex√©cution, nous verrons la valeur de la variable <code>n</code> dans le d√©bogueur et nous pouvons continuer l'ex√©cution du programme ou √©tudier l'interface du d√©bogueur. <br><img src="https://habrastorage.org/webt/kn/nq/so/knnqsotzl0j-k8e4y83a1ziz97w.png"><br>  Le d√©bogueur dans Chrome est g√©n√©ralement utilis√© pour JavaScript, mais pour GraalVM en JavaScript, il n'y a rien de diff√©rent des autres langues.  L'indicateur <code>--inspect</code> √©galement disponible et fonctionne dans les impl√©mentations Python, Ruby et R. Je ne vous montrerai pas la source de chaque programme, mais ils fonctionnent de la m√™me mani√®re et vous obtenez le m√™me d√©bogueur dans Chrome pour chacun d'eux. </p><br><pre> <code class="plaintext hljs">$ graalpython --jvm --inspect fizzbuzz.py</code> </pre> <br><p><img src="https://habrastorage.org/webt/6t/fx/2m/6tfx2m4btthox9mxxkweqehwjgm.png"></p><br><pre> <code class="plaintext hljs">$ ruby --inspect fizzbuzz.rb</code> </pre> <br><p><img src="https://habrastorage.org/webt/2z/_z/ti/2z_ztia4yk9fqomzo_vxj9c7mb0.png"></p><br><pre> <code class="plaintext hljs">$ Rscript --inspect fizzbuzz.r</code> </pre> <br><p><img src="https://habrastorage.org/webt/rg/12/wn/rg12wnspfc176rtrz7uww4qymo0.png"><br>  VisualVM est un autre outil que vous connaissez peut-√™tre depuis Java.  Il fournit une interface utilisateur √† travers laquelle vous pouvez rejoindre une JVM en cours d'ex√©cution sur votre machine locale ou via un r√©seau pour inspecter divers aspects de l'ex√©cution du programme, tels que l'utilisation de la m√©moire ou l'ex√©cution du thread. </p><br><p>  GraalVM inclut VisualVM en tant qu'utilitaire <code>jvisualvm</code> standard. </p><br><pre> <code class="plaintext hljs">$ jvisualvm &amp;&gt; /dev/null &amp;</code> </pre> <br><p>  Si nous ex√©cutons VisualVM pendant que le programme Java <code>TopTen</code> est en <code>TopTen</code> , nous pouvons observer l'utilisation de la m√©moire ou, par exemple, prendre un instantan√© du contenu de la m√©moire et voir quels types d'objets nous utilisons de la m√©moire sur le tas. </p><br><pre> <code class="plaintext hljs">$ java TopTen large.txt</code> </pre> <br><p><img src="https://habrastorage.org/webt/gd/-5/ld/gd-5ldwlrn3y9szdaoqrmd_7res.png"><br>  J'ai √©crit ce programme en Ruby pour g√©n√©rer des ordures en m√©moire lors de l'ex√©cution. </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'erb'</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span> template = ERB.new &lt;&lt;-EOF The value of x <span class="hljs-symbol"><span class="hljs-symbol">is:</span></span> &lt;%= x %&gt; EOF loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> puts template.result(binding) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Si vous ex√©cutez l'impl√©mentation Ruby standard sur la JVM - JRuby, vous serez d√©√ßu de VisualVM car vous ne verrez que des objets Java internes au lieu d'objets dans votre langage. </p><br><p>  Si vous utilisez la version de Ruby pour GraalVM, VisualVM reconna√Æt les objets Ruby.  Nous devons utiliser l'option <code>--jvm</code> pour utiliser VisualVM, comme  il ne prend pas en charge les versions natives de Ruby. </p><br><pre> <code class="plaintext hljs">$ ruby --jvm render.rb</code> </pre> <br><p> ,  ,       Java ,    , ,   Summary,   Ruby Heap       Ruby . <br><img src="https://habrastorage.org/webt/ge/d4/xc/ged4xcxp5ylkaxjxyxd5b8v3kyo.png"><br>  Truffle ‚Äî  -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nexus</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> .         Truffle      ,  ,   API Truffle'  ,         ,   Truffle,         . </p><br><p> ,   GraalVM ‚Äî         ,       .   Truffle  GraalVM      ,       VisualVM. </p><br><h2 id="6-dopolnenie-jvm-prilozheniy"> 6.  JVM  </h2><br><p>   ,   ,   ,        Java .  API   <code>org.graalvm.polyglot</code>      ,         . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendJava</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String language = <span class="hljs-string"><span class="hljs-string">"js"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (Context context = Context.newBuilder().allowNativeAccess(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String arg: args) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) { language = arg.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Value v = context.eval(language, arg); System.out.println(v); } } } } }</code> </pre> <br><p>    <code>javac</code>  <code>java</code>   GraalVM,   <code>org.graalvm.*</code>     <code>classpath</code> , ..          . </p><br><pre> <code class="plaintext hljs">$ javac ExtendJava.java $ java ExtendJava '14 + 2' 16 $ java ExtendJava -js 'Math.sqrt(14)' 3.7416573867739413 $ java ExtendJava -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128] $ java ExtendJava -ruby '[4, 2, 3].sort' [2, 3, 4]</code> </pre> <br><p> ,        ‚Äî     ,      <code>node</code>  <code>ruby</code> ,  GraalVM. </p><br><p>     GraalVM ‚Äî             Java . Polyglot API     ‚Äú‚Äù      Java ,       . </p><br><h2 id="7-dopolnenie-platformo-zavisimyh-prilozheniy"> 7.  -  </h2><br><p>  GraalVM    ,  ,    ‚Äî  ,        ,  GraalVM,  - . ,  JavaScript ,  V8,  Python ‚Äî CPython     , ..          . GraalVM           ‚Äî      Polyglot . </p><br><p>    GraalVM,       ,         JavaScript.    Polyglot ,    ,  : </p><br><pre> <code class="plaintext hljs">$ graalvm-1.0.0-rc1/Contents/Home/jre/lib/svm/bin/rebuild-images libpolyglot</code> </pre> <br><p>     C,   ,    ,  GraalVM,     .       <code>ExtendJava</code>   ,    ,   . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;polyglot_api.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } poly_context context = NULL; if (poly_create_context(thread, NULL, 0, &amp;context) != poly_ok) { fprintf(stderr, "initialization error\n"); return 1; } char* language = "js"; for (int n = 1; n &lt; argc; n++) { if (argv[n][0] == '-') { language = &amp;argv[n][1]; } else { poly_value result = NULL; if (poly_context_eval(thread, context, language, "unicalc", argv[n], &amp;result) != poly_ok) { fprintf(stderr, "eval error\n"); return 1; } char buffer[1024]; size_t length; if (poly_value_to_string_utf8(thread, result, buffer, sizeof(buffer), &amp;length) != poly_ok) { fprintf(stderr, "to string error\n"); return 1; } buffer[length] = '\0'; printf("%s\n", buffer); poly_destroy_handle(thread, result); } } return 0; }</span></span></span></span></code> </pre> </div></div><br><p>      ,       polyglot   GraalVM.  , ,    JVM. </p><br><pre> <code class="plaintext hljs">$ clang -Igraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -rpath graalvm-1.0.0-rc1/Contents/Home / -Lgraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -lpolyglot extendc.c -o extendc $ otool -L extendc extendc: .../libpolyglot.dylib ... .../libSystem.B.dylib ...</code> </pre> <br><pre> <code class="plaintext hljs">$ ./extendc '14 + 2' 16 $ ./extendc -js 'Math.sqrt(14)' 3.7416573867739413 $ ./extendc -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128]</code> </pre> <br><p>   ,      GraalVM ‚Äî  -    ,    ,  GraalVM. </p><br><h2 id="8-kod-na-java-kak-platformo-zavisimaya-biblioteka"> 8.   Java  -  </h2><br><p>  Java        , , ,    ,  - ,      .     Java   - ,     JVM   ,         . </p><br><p> GraalVM    Java ,   ,      - ,          .      ,    ,    Java    JVM. </p><br><p>   ,     Apache SIS    ,     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> )     .   SIS 0.8,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://sis.apache.org/</a>     jar. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.sis.distance.DistanceUtils; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">3</span></span>]); System.out.printf(<span class="hljs-string"><span class="hljs-string">"%.2f km%n"</span></span>, DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLong, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLong)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong); } }</code> </pre> <br><p>      ,       - </p><br><pre> <code class="plaintext hljs">$ javac -cp sis.jar -parameters Distance.java $ java -cp sis.jar:. Distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>       ,      <code>topten</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. Distance ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>      ,    .   ,        <code>@CEntryPoint</code> </p><br><pre> <code class="java hljs">... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.IsolateThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.c.function.CEntryPoint; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@CEntryPoint</span></span>(name = <span class="hljs-string"><span class="hljs-string">"distance"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_long, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_long)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(a_lat, a_long, b_lat, b_long); } ... }</code> </pre> <br><p>      <code>javac</code> ,   GraalVM    API  <code>classpath</code> . C         . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. -H:Kind=SHARED_LIBRARY \ -H:Name=libdistance $ otool -L libdistance.dylib # .so on Linux libdistance.dylib: .../libdistance.dylib ... .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h libdistance.dylib 4.8M libdistance.dylib</code> </pre> <br><p>      ,     .     ,    :   VM   ,      ,           . </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;libdistance.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } double a_lat = strtod(argv[1], NULL); double a_long = strtod(argv[2], NULL); double b_lat = strtod(argv[3], NULL); double b_long = strtod(argv[4], NULL); printf("%.2f km\n", distance(thread, a_lat, a_long, b_lat, b_long)); return 0; }</span></span></span></span></code> </pre> <br><p>       ,       (  <code>LD_LIBRARY_PARTH=.</code>  Linux) </p><br><pre> <code class="plaintext hljs">$ clang -I. -L. -ldistance distance.c -o distance $ otool -L distance distance: .../libdistance.dylib ... .../libSystem.B.dylib ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>     GraalVM ‚Äî   java  - ,         JVM </p><br><h2 id="9-podderzhka-neskolkih-yazykov-programmirovaniya-v-baze-dannyh"> 9.        </h2><br><p>     Polyglot  ‚Äî     Oracle.      Oracle Database Multilingual Engine (MLE),         GraalVM   SQL. </p><br><p> ,    front-end,    JavaScript     email ,  JavaScript  <code>validator</code> .     -       ,      SQL  PL/SQL.         ,    . </p><br><p>  MLE  Docker  : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://oracle.github.io/oracle-db-mle/releases/0.2.7/docker/</a> </p><br><p>     Docker Daemon. </p><br><pre> <code class="plaintext hljs">$ docker load --input mle-docker-0.2.7.tar.gz</code> </pre> <br><p>  ,  Docker,  ,    (    ),  Bash   . </p><br><pre> <code class="plaintext hljs">$ docker run mle-docker-0.2.7 $ docker ps $ docker exec -ti &lt;container_id&gt; bash -li</code> </pre> <br><p>    <code>sqlplus</code> ( SQL ),   Bash,     ,   ,     . </p><br><pre> <code class="plaintext hljs">$ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>    ,    <code>sqlplus</code> . ,   Bash  Docker,         <code>dbjs</code> ,       .   <code>sqlplus</code> . </p><br><pre> <code class="plaintext hljs">$ npm install validator $ npm install @types/validator $ dbjs deploy -u scott -p tiger -c localhost:1521/ORCLCDB validator $ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>         <code>validator</code>   SQL . </p><br><pre> <code class="plaintext hljs">SQL&gt; select validator.isEmail('hello.world@oracle.com') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD@ORACLE.COM') ------------------------------------------- 1 SQL&gt; select validator.isEmail('hello.world') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD') -------------------------------- 0</code> </pre> <br><p>    ,     GraalVM ‚Äî  ,  GraalVM,   Oracle.  ,     front-end  back-end,    ,  ,           . </p><br><h2 id="10-sozdanie-yazykov-programmirovaniya-dlya-graalvm"> 10.     GraalVM </h2><br><p> Oracle Labs            JavaScript, R, Ruby, Python  C   ,      Truffle,       GraalVM. </p><br><p> Truffle ‚Äî  java ,     <em>  </em> (AST).  AST ‚Äî ,     ,                ,   , ,  .     ,    ,   Truffle  Graal   JIT  ,       AST . </p><br><p>    Truffle,    GraalVM    ,      ,  DSL.      Truffle  Graal   ,     ,  Truffle ‚Äî         GraalVM.        , , , , . ,         ,        . Oracle labs    Ruby ,    ,         . </p><br><p>       ,     ,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimpleLanguage</a> ‚Äî         Truffle,       JavaScript.  ,  ,   , , , <a href="">   if</a> . </p><br><p>  ,    Truffle   Oracle Labs,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SmallTalk</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Newspeak</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lisp</a> .    Lisp  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ,         . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p> GraalVM        ‚Äî  ,         ,       .       ,  ,    ,      ,    . </p><br><p>   GraalVM,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.graalvm.org/</a> .          ,  ,      . </p><br><p>    ,              ,    .     ,     GraalVM         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ChrisGSeaton</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@shelajev</a> . </p><br><p> <em>:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Oleg ≈†elajev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Olya Gupalo</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Doug Simon</a> </p><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433432/">https://habr.com/ru/post/fr433432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433414/index.html">Test du moniteur r√©seau PRTG et comparaison avec Zabbix</a></li>
<li><a href="../fr433420/index.html">R√©sultats ZeroNights 2018</a></li>
<li><a href="../fr433424/index.html">Est-il possible de charger un niveau infranchissable dans Super Mario Maker?</a></li>
<li><a href="../fr433428/index.html">D'o√π vient la cr√©ativit√©: analyse de l'activit√© des ondes alpha c√©r√©brales lors des tests RAT</a></li>
<li><a href="../fr433430/index.html">Bo√Æte Android Mecool KM9 sur le nouveau SoC Amlogic S905X2 avec 4 Go de RAM et Android TV 8.1 - comprendre et pardonner</a></li>
<li><a href="../fr433434/index.html">¬´Pascal et encore moins Basic ne sont absolument pas n√©cessaires¬ª: un entretien avec des formateurs en programmation sportive</a></li>
<li><a href="../fr433436/index.html">Introduction √† la recherche sur le rendement</a></li>
<li><a href="../fr433438/index.html">La Douma d'√âtat limitera le financement participatif</a></li>
<li><a href="../fr433442/index.html">Sortie de Entity Framework Core 2.2. Quoi de neuf (3 sur 3)</a></li>
<li><a href="../fr433446/index.html">Security Week 51: bug dans WordPress 5.0 et Logitech, vuln√©rabilit√© de photo Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>