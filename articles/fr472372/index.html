<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😀 🌳 🎞️ Automatisation Android Guide super simple pour créer votre premier test Espresso 👩🏿‍🤝‍👩🏼 👨🏽‍🎤 👕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour mes amis. En prévision du début du cours d' Ingénieur QA Mobile , nous souhaitons partager avec vous une traduction de matériel intéressant. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisation Android Guide super simple pour créer votre premier test Espresso</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/472372/">  Bonjour mes amis.  En prévision du début du cours d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ingénieur QA Mobile</a> , nous souhaitons partager avec vous une traduction de matériel intéressant. <br><br><img src="https://habrastorage.org/webt/he/52/7b/he527bnnfyevgfpavom-jhtt-c8.png"><br><hr><br><h3>  Qu'est-ce que l'Espresso? </h3><br>  Non, ce n'est pas une boisson que vous buvez tous les jours pour égayer.  Espresso est un framework de test open source développé par Google.  Il vous permet d'effectuer des tests d'interface utilisateur complexes sur un véritable appareil ou émulateur.  Faut-il du temps pour commencer à écrire des tests complexes pour Android? <br><br>  C'est possible.  Mais rien ne vous empêche de faire le premier pas et d'apprendre à écrire des cas de test simples pour Android en utilisant le framework Espresso dès maintenant. <br><a name="habracut"></a><br><h3>  Parlez-nous de l'automatisation? </h3><br>  Bien sûr.  L'automatisation est un moyen d'accélérer les tests, de les rendre plus efficaces et évolutifs.  Les tests manuels sont très importants, mais avoir des tests automatisés est une bien meilleure option à l'avenir. <br><br>  Il existe essentiellement deux types de cadres de test: <br><br><ol><li>  Cadres qui n'ont pas besoin d'accéder au code source et qui ne sont pas intégrés dans le cadre du projet.  Par exemple, <b>WebDriver, Appium, QTP</b> . </li><li>  Cadres qui ont besoin d'accéder au code source.  Par exemple, <b>Espresso, KIF (Keep It Functional)</b> . </li></ol><br>  Espresso est un framework qui a besoin d'accéder au code source, donc pour l'automatisation nous avons besoin d'accéder au code du projet.  Puisque nous avons besoin d'un projet pour travailler, créons-le! <br><br><h3>  Composants principaux d'Espresso </h3><br>  Il existe trois types de méthodes disponibles dans Espresso: <br><br><ol><li>  <b>ViewMatchers</b> - vous permettent de trouver un objet dans la hiérarchie actuelle des vues </li><li>  <b>ViewAssertions</b> - vous permet de vérifier l'état de l'objet et de confirmer que l'état répond aux critères </li><li>  <b>ViewActions</b> - ces méthodes vous permettent d'effectuer diverses actions avec des objets. </li></ol><br>  Allons plus loin et voyons comment tout cela fonctionne avec un exemple réel. <br><br><h4>  Créez une application d'automatisation simple </h4><br>  La première chose que nous devons faire est de créer une application que nous automatiserons.  Créons un projet dans Android Studio.  Pour cela, bien sûr, vous devez installer Android Studio sur votre ordinateur. <br><br>  <b>1. Ouvrez Android Studio et créez une activité de navigation inférieure.</b> <br><br><img src="https://habrastorage.org/webt/xg/uo/n8/xguon8rdo7fubabo4t6v-l2r5o4.png"><br>  <i>Android Studio.</i>  <i>Créer une nouvelle fenêtre de projet</i> <br><br>  <b>2. Nommez le projet et sélectionnez un langage de programmation.</b> <br><br><img src="https://habrastorage.org/webt/uh/ua/lq/uhualqvx5pe7nd5qsrqfogx9z00.png"><br>  <i>Android Studio.</i>  <i>Nom du projet</i> <br><br>  <b>3. Accédez au dossier androidTest</b> <br><br><img src="https://habrastorage.org/webt/ay/ha/j4/ayhaj4hexlnyhsfj4vhgiy5mkv0.png"><br>  <i>Android Studio.</i>  <i>Test instrumental.</i> <br><br>  Comme vous pouvez le voir, un seul test y est écrit, et ce n'est pas un test d'interface utilisateur, mais un test JUnit. <br><br>  Maintenant, nous devons ajouter un test d'interface utilisateur simple.  Pour ce faire, créez d'abord une règle pour ouvrir <i>MainActivity</i> . <br><br>  Ajoutons une importation d'annotation de règle <b>JUnit</b> : <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Rule;</code> </pre> <br>  La prochaine chose à faire est d'ajouter la ligne de code ci-dessous pour compléter l'annotation <b>RunWith</b> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@Rule public ActivityTestRule&lt;MainActivity&gt; activityActivityTestRule = new ActivityTestRule&lt;&gt;(MainActivity.class);</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/sp/qo/mv/spqomvmsf_qcyud5wvqhnkaautq.png"><br><br>  Nous voyons maintenant que <b>ActivityTestRule est</b> surligné en rouge.  Cela signifie que nous devons importer la fonction <b>ActivityTestRule</b> .  Mais d'abord, nous devons ajouter une bibliothèque qui peut le faire.  En bref, pour cette tâche, nous avons besoin de l'aide de <b>Gradle</b> - un système d'automatisation d'assemblage créé spécialement à cet effet. <br><br>  Allons dans le fichier de configuration <b>Gradle</b> et ajoutons cette bibliothèque.  Ouvrez un fichier appelé <b>build.gradle (Module: app)</b> et ajoutez la ligne ci-dessous: <br><br><pre> <code class="python hljs">androidTestImplementation <span class="hljs-string"><span class="hljs-string">'com.android.support.test:rules:1.0.2'</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/u0/j0/db/u0j0dbsn9nfp0ch1kzc2ls1kg44.png"><br>  <i>Android Studio.</i>  <i>Ajoutez une dépendance.</i> <br><br>  Après l'ajout, vous devez cliquer sur le bouton pour synchroniser le projet, puis revenir au fichier avec l'implémentation du test. <br><br>  Maintenant que la bibliothèque a été ajoutée, l'étape suivante consiste à l'importer dans le fichier avec le test instrumental: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.test.rule.ActivityTestRule;</code> </pre><br><img src="https://habrastorage.org/webt/y0/2n/in/y02ninubbghtx5-satkczvbchaa.png"><br>  <i>Android Studio.</i>  <i>Importez ActivityTestRule.</i> <br><br>  Ok, maintenant nous sommes prêts à ajouter notre premier test.  Entrez ce code dans <b>ExampleInstrumentedTest</b> : <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@Test public void clickButtonHome(){ onView(withId(R.id.navigation_home)).perform(click()).check(matches(isDisplayed())); }</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/wx/mx/sc/wxmxscovvmszyncpeloi3adugzm.png"><br>  <i>Android Studio.</i>  <i>Ajout d'un test et importation d'éléments supplémentaires</i> <br><br>  Pour notre test, nous devons importer des éléments supplémentaires avant qu'il ne commence à fonctionner.  Cliquez sur <b>le bouton OK</b> et nous sommes en fait prêts à lancer notre test! <br><br><h3>  Exécution de tests d'espresso </h3><br>  Faites un clic droit sur notre test à gauche et sélectionnez <b>«Exécuter l'exempleInstrumentedTest»</b> . <br><br><img src="https://habrastorage.org/webt/wf/lt/kr/wfltkr-p33ettdkkjwyufp4gf0u.png"><br><br>  Comme il s'agit d'un <b>test d'interface utilisateur</b> , et non d'un test <b>unitaire</b> , nous verrons alors une fenêtre avec un choix d'appareil sur lequel nous aimerions l'exécuter.  J'ai déjà «Nexus 5X» comme appareil, il me suffit donc de le sélectionner. <br><br><img src="https://habrastorage.org/webt/gu/ix/7r/guix7ri_bswxzv0jqytwa59lrr0.png"><br><br>  Dans votre cas, si vous n'avez jamais déployé de projet Android, sélectionnez votre véritable appareil Android ou cliquez sur <b>«Créer un nouvel appareil virtuel»</b> et créez un nouvel appareil émulé pour exécuter les tests.  Il peut s'agir de n'importe quel appareil de la liste sur lequel vous souhaitez exécuter des tests. <br><br>  Cliquez sur <b>OK</b> et préparez-vous à voir la magie! <br><br><img src="https://habrastorage.org/webt/4r/b5/ad/4rb5adnhp7rbv4vr1ji9zuvpw68.png"><br>  <i>Android Studio.</i>  <i>Résultats des tests</i> <br><br>  Comme vous pouvez le voir, nous avons réussi un ensemble de deux tests: le test unitaire, qui était déjà là après la création du projet, et notre test <i>clickHomeButton</i> , que nous venons d'écrire. <br><br><img src="https://habrastorage.org/webt/9a/rr/we/9arrwejmr_cf7edvwh8uojyt5qu.png"><br>  <i>Android Studio.</i>  <i>Le test terminé.</i> <br><br>  Comme son nom l'indique, nous n'avons cliqué que sur un bouton dans la barre de navigation inférieure, qui est appelé <b>«navigation_home»</b> dans la hiérarchie <b>MainActivity</b> . <br><br>  Analysons ce que nous avons fait dans cette chaîne de méthodes: <br><br><pre> <code class="python hljs">public void clickButtonHome(){ onView(withId(R.id.navigation_home)).perform(click()).check(matches(isDisplayed())); }</code> </pre> <br><ol><li>  1. Appelez <b>onView</b> .  Cette méthode est une méthode de type <b>ViewMatchers</b> .  Nous trouvons un objet dans notre Activité pour faire quelque chose. </li><li>  2. Ensuite, nous appelons <b>perform (cliquez sur ())</b> .  Cette méthode est une méthode de type <b>ViewActions</b> .  Nous indiquons l'action spécifique qui doit être effectuée dans ce cas - pour faire un clic (clic).  Il existe de nombreuses autres méthodes d'action disponibles dans Espresso, par exemple: </li><li>  3. La dernière chose que nous devons faire est de confirmer que l'action que nous avons effectuée correspond vraiment à nos critères, et pour cela nous <b>exécutons la</b> méthode <b>check (isDisplayed ())</b> , qui est une méthode de type <b>ViewAssertions</b> .  Dans ce cas, nous vérifions que cet objet (vue) était bien affiché à l'écran après que l'action de clic ait été effectuée. </li></ol><br><h3>  Hiérarchie des vues Android </h3><br>  Cher lecteur, j'espère avoir pu vous expliquer comment écrire des <b>tests d'interface utilisateur de</b> base <b>pour Android à l'</b> aide d'Espresso. <br><br>  Cependant, il n'est probablement pas si simple de comprendre ce qui s'est exactement passé ici si vous ne savez pas où se trouvent tous ces boutons et d'où ils viennent.  Pour le savoir, nous devons aller dans le dossier <b>"res"</b> sur le côté gauche, ouvrir le dossier <b>"menu"</b> et sélectionner <b>"bottom_nav_menu.xml"</b> . <br>  Voici ce que nous y verrons: <br><br><img src="https://habrastorage.org/webt/yc/fe/a8/ycfea8uzwehgirzskb2cn8ysszc.png"><br>  <i>Android Studio.</i>  <i>Hiérarchie de présentation du menu de navigation inférieur.</i> <br>  Comme vous pouvez le voir, c'est la ligne qui attribue un nom à l'élément de menu: <br><br><pre> <code class="plaintext hljs">android:id="@+id/navigation_home"</code> </pre> <br>  C'est ce que nous utilisons dans notre code pour exécuter les tests.  Il y a aussi des boutons de menu <b>«navigation_dashboard»</b> et <b>«navigation_notifications»</b> , disponibles en bas, alors continuons et utilisons-les dans nos tests. <br><br><h3>  Plus de tests Espresso </h3><br>  Nous devons revenir au fichier <b>ExampleInstrumentedTest</b> et ajouter quelques fonctions de test supplémentaires: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@Test public void clickButtonDashboard(){ onView(withId(R.id.navigation_dashboard)).perform(click()).check(matches(isDisplayed())); } @Test public void clickButtonNotification(){ onView(withId(R.id.navigation_notifications)).perform(click()).check(matches(isDisplayed())); }</span></span></code> </pre> <br>  La seule chose que nous avons ajoutée était de vérifier plusieurs autres éléments de menu: <b>"navigation_dashboard"</b> et <b>"navigation_notifications"</b> . <br><br><img src="https://habrastorage.org/webt/e9/0o/zf/e90ozfefjwmrpzurm8i0958jllk.png"><br>  <i>Android Studio.</i>  <i>Ajoutez deux tests supplémentaires.</i> <br><br>  Bien sûr, ces tests pourraient être simplifiés encore plus, mais afin de montrer comment tout cela fonctionne, supposons qu'ils conviennent parfaitement à nos besoins. <br><br>  Continuons et exécutons à nouveau ces tests.  Cliquez sur <b>le</b> bouton <b>Exécuter</b> . <br><br><img src="https://habrastorage.org/webt/2s/nm/19/2snm19yru3-sthnx3rs9q6v24oc.png"><br>  <i>Android Studio.</i>  <i>Résultats des tests.</i> <br><br>  Les 4 tests ont réussi.  Toutes les vues ont été trouvées, cliquées et confirmées dans la hiérarchie des vues. <br><br><h3>  Conclusion </h3><br>  Espresso est une solution puissante pour exécuter des tests d'interface utilisateur.  Maintenant que vous savez comment ils sont créés, vous êtes prêt à écrire des tests beaucoup plus puissants et complexes. <br><br>  Bon test! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472372/">https://habr.com/ru/post/fr472372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472360/index.html">Analyse du code d'Orchard CMS pour les bogues</a></li>
<li><a href="../fr472362/index.html">Nous recherchons et analysons les erreurs dans le code CMS Orchard</a></li>
<li><a href="../fr472364/index.html">PostgreSQL et les paramètres de cohérence des enregistrements pour chaque connexion particulière</a></li>
<li><a href="../fr472366/index.html">Nouvel algorithme de recherche de chemin dans Factorio</a></li>
<li><a href="../fr472368/index.html">Pêche vocale: nous analysons les méthodes d'attaque et les méthodes de protection contre celles-ci</a></li>
<li><a href="../fr472374/index.html">Pourquoi nous avons déplacé des serveurs en Islande</a></li>
<li><a href="../fr472378/index.html">Fiabilité du flash: attendue et inattendue. Partie 2. XIV conférence de l'association USENIX. Technologies de stockage de fichiers</a></li>
<li><a href="../fr472380/index.html">MIRO - une plateforme robotique intérieure ouverte</a></li>
<li><a href="../fr472384/index.html">Un aperçu des mises à jour Android du point de vue d'un développeur</a></li>
<li><a href="../fr472386/index.html">ZIO & Cats Effect: une alliance réussie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>