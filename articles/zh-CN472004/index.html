<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤³ğŸ¾ ğŸ›¡ï¸ ğŸ‘‚ Boost.Spiritï¼Œæˆ–å°†â€œ Spiritualityâ€æ·»åŠ åˆ°åˆ—è¡¨è¿‡æ»¤å™¨ ğŸ˜¬ ğŸ’º ğŸ‘©ğŸ¾â€ğŸš’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ æˆ‘ä»ç„¶æ˜¯ISPsystemå¼€å‘äººå‘˜ï¼Œæˆ‘çš„åå­—ä»ç„¶æ˜¯Dmitry Smirnovã€‚ åœ¨è¿‡å»ï¼ˆç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ï¼‰é‡Œï¼Œæˆ‘æ— æ³•å†³å®šä¸‹ä¸€ä¸ªå‡ºç‰ˆç‰©çš„ä¸»é¢˜ï¼Œå› ä¸ºåœ¨è¿‡å»å‡ ä¸ªæœˆä¸Boost.Asioåˆä½œçš„è¿‡ç¨‹ä¸­ç§¯ç´¯äº†å¾ˆå¤šææ–™ã€‚ ç”šè‡³åœ¨æŠ›ç¡¬å¸ä¼¼ä¹æ›´å®¹æ˜“çš„é‚£ä¸€åˆ»ï¼Œä¸€é¡¹ä»»åŠ¡ä¹Ÿæ”¹å˜äº†ä¸€åˆ‡ã€‚ æœ‰å¿…è¦å¼€å‘ä¸€ç§å·¥å…·ï¼Œä½¿å‰ç«¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Boost.Spiritï¼Œæˆ–å°†â€œ Spiritualityâ€æ·»åŠ åˆ°åˆ—è¡¨è¿‡æ»¤å™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/472004/"><p><img src="https://habrastorage.org/webt/qv/yu/6-/qvyu6-kaqci3ha5ivctj0nvbwco.png" alt="å›¾ç‰‡"></p><br><p> å¤§å®¶å¥½ æˆ‘ä»ç„¶æ˜¯ISPsystemå¼€å‘äººå‘˜ï¼Œæˆ‘çš„åå­—ä»ç„¶æ˜¯Dmitry Smirnovã€‚ åœ¨è¿‡å»ï¼ˆç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´ï¼‰é‡Œï¼Œæˆ‘æ— æ³•å†³å®šä¸‹ä¸€ä¸ªå‡ºç‰ˆç‰©çš„ä¸»é¢˜ï¼Œå› ä¸ºåœ¨è¿‡å»å‡ ä¸ªæœˆä¸Boost.Asioåˆä½œçš„è¿‡ç¨‹ä¸­ç§¯ç´¯äº†å¾ˆå¤šææ–™ã€‚ ç”šè‡³åœ¨æŠ›ç¡¬å¸ä¼¼ä¹æ›´å®¹æ˜“çš„é‚£ä¸€åˆ»ï¼Œä¸€é¡¹ä»»åŠ¡ä¹Ÿæ”¹å˜äº†ä¸€åˆ‡ã€‚ æœ‰å¿…è¦å¼€å‘ä¸€ç§å·¥å…·ï¼Œä½¿å‰ç«¯å¯ä»¥è¿‡æ»¤è¯·æ±‚åˆ—è¡¨ä¸­çš„æ•°æ®ã€‚ æ¥è‡ªåç«¯çš„åˆ—è¡¨æœ¬èº«æ˜¯ä¸€ä¸ªæ™®é€šçš„json_arrayã€‚ æ¬¢è¿æ¥åˆ°å‡¯ç‰¹ï¼Œæœ€è¿‘å‡ å¤©éƒ½æœ‰è·Œå®•èµ·ä¼ã€‚ </p><a name="habracut"></a><br><h3 id="diskleymer"> å…è´£å£°æ˜ </h3><br><p> æˆ‘å¿…é¡»é©¬ä¸Šè¯´ï¼Œä½œè€…ä¸Šä¸€æ¬¡â€œæ„Ÿè§‰â€åå¹´å‰çš„ä¸Šä¸‹æ–‡æ— å…³è¯­æ³•ã€‚ é‚£æ—¶ï¼Œå®ƒä¼¼ä¹æ˜¯ä¸€ç§ç›¸å½“å«ç³Šä¸”ä¸å¿…è¦çš„å·¥å…·ï¼Œä½†åœ¨è§£å†³é—®é¢˜çš„é‚£ä¸€å¤©ï¼Œæˆ‘å°±äº†è§£äº†Boost.Spiritåº“ã€‚ </p><br><h3 id="zadacha"> æŒ‘æˆ˜èµ› </h3><br><p> éœ€è¦è¿›è¡Œå¦‚ä¸‹æŸ¥è¯¢ï¼š </p><br><pre><code class="cpp hljs">(string_field CP value AND int_field NOT LT <span class="hljs-number"><span class="hljs-number">150</span></span>) OR bool_field EQ <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p> è¿›å…¥æŸç§ç»“æ„ï¼Œè¯¥ç»“æ„å°†æ£€æŸ¥jsonå¯¹è±¡å¹¶æŠ¥å‘Šå…¶æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚ </p><br><h3 id="pervye-shagi"> ç¬¬ä¸€æ­¥ </h3><br><p> é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®å®šæœªæ¥è¿‡æ»¤å™¨çš„æ¥å£ã€‚ å¿…é¡»ä»æ•°ç»„ä¸­åˆ é™¤ä¸å¿…è¦çš„å¯¹è±¡ï¼Œå› æ­¤å¿…é¡»å°†å…¶ä¸STLç®—æ³•ç»“åˆä½¿ç”¨ï¼Œå°¤å…¶æ˜¯std :: remove_ifã€‚ </p><br><p> å‡½å­å°†æ˜¯å®Œç¾çš„ï¼Œå®ƒå°†ç›´æ¥æ ¹æ®å‰ç«¯çš„è¯·æ±‚è¿›è¡Œæ„å»ºã€‚ ç”±äºè¯¥é¡¹ç›®ä½¿ç”¨nlohmann :: jsonï¼Œå› æ­¤è®¾è®¡å°†éå¸¸ä¼˜é›…ï¼š </p><br><pre> <code class="cpp hljs">filter = <span class="hljs-string"><span class="hljs-string">"(string_field CP value AND int_field NOT LT 150) OR bool_field EQ true"</span></span>; json.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove_if(json.begin(), json.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::not_fn(JsonFilter{filter})), json.end());</code> </pre> <br><p> ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œæˆ‘é€‰æ‹©å°†æ¡ä»¶æ‹†åˆ†ä¸ºäºŒå‰æ ‘ã€‚ æœ€ä½é¡¶ç‚¹åº”åŒ…å«æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œä½†å…¶ä½™é¡¶ç‚¹åº”ä¸ºé€»è¾‘è¿ç®—ç¬¦ã€‚ è¿™æ˜¯ä¸Šé¢çš„è¿‡æ»¤å™¨åœ¨çˆ†ç‚¸çŠ¶æ€ä¸‹çš„å¤–è§‚ï¼š </p><br><p><img src="https://habrastorage.org/webt/if/yc/zk/ifyczkjiznmiebrxvof3oxgnur4.jpeg" alt="ç­›é€‰æ ‘"></p><br><p> ç»“æœæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ASTçš„</a>ä¸€ç§å½¢å¼ï¼Œå¦‚æœå¯ä»¥è¿™æ ·ç§°å‘¼çš„è¯ã€‚ æ—¢ç„¶å³å°†å‡ºç°çš„é€»è¾‘å›¾æ™¯å·²ç»æˆå½¢ï¼Œé‚£ä¹ˆæœ€æœ‰è¶£ï¼Œæœ€å¯æ€•çš„æ—¶åˆ»å·²ç»æ¥ä¸´ã€‚ è¿™å¿…é¡»å†™åœ¨...å…³äºç²¾ç¥... </p><br><h3 id="znakomstvo"> ç†Ÿäºº </h3><br><p> æœ€å›°éš¾çš„é—®é¢˜å‡ºç°äº†ï¼šä»å“ªé‡Œå¼€å§‹ï¼Ÿ ä¸Asioä¸åŒï¼Œé˜…è¯»Spiritæ ‡å¤´å¹¶æ²¡æœ‰ç»™å‡ºä»»ä½•æ˜ç¡®çš„çº¿ç´¢ï¼Œæ¢å¥è¯è¯´ï¼Œå­˜åœ¨â€œæŸç§é­”æœ¯â€ã€‚ éšåï¼Œå¯¹boostå®˜æ–¹æ–‡æ¡£ä¸­çš„ç¤ºä¾‹è¿›è¡Œäº†ç ”ç©¶ï¼Œå¹¶ç ”ç©¶äº†ç½‘ç»œä¸Šçš„å„ç§ç¤ºä¾‹ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œå®ƒä»¬ä¸ä»…å–å¾—äº†æˆæœï¼Œè€Œä¸”ä½¿è§£å†³æ–¹æ¡ˆå°½å¯èƒ½æ¥è¿‘æˆ‘çš„éœ€æ±‚ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ASTè®¡ç®—å™¨</a> </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹ä¸­æ˜¾ç¤ºçš„è¯­æ³•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">è¯­æ³•è®¡ç®—å™¨</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArithmeticGrammar1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> qi::grammar&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator, ASTNodePtr(), qi::space_type&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Iterator = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator; ArithmeticGrammar1() : ArithmeticGrammar1::base_type(start) { start = (product &gt;&gt; <span class="hljs-string"><span class="hljs-string">'+'</span></span> &gt;&gt; start) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'+'</span></span>&gt;&gt; (qi::_1, qi::_2)] | product[qi::_val = qi::_1]; product = (factor &gt;&gt; <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt;&gt; product) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'*'</span></span>&gt;&gt; (qi::_1, qi::_2)] | factor[qi::_val = qi::_1]; factor = group[qi::_val = qi::_1] | qi::int_[qi::_val = phx::new_&lt;ConstantNode&gt;(qi::_1)]; group %= <span class="hljs-string"><span class="hljs-string">'('</span></span> &gt;&gt; start &gt;&gt; <span class="hljs-string"><span class="hljs-string">')'</span></span>; } qi::rule&lt;Iterator, ASTNodePtr(), qi::space_type&gt; start, group, product, factor; };</code> </pre> </div></div><br><p> è¯­æ³•æ˜¯ä»åŸºæœ¬qi ::è¯­æ³•ç»§æ‰¿çš„ã€‚  <em>ASTNodePtrï¼ˆï¼‰</em>ä¸æ˜¯ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„æ–¹æ³•ï¼Œä½†æ˜¯å°†é¢„æœŸç»“æœçš„å¯¹è±¡ä¼ é€’åˆ°è¯­æ³•å¯¹è±¡ä¸­çš„æ–¹æ³•éå¸¸æ–¹ä¾¿ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ASTèŠ‚ç‚¹è®¡ç®—å™¨</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ASTNode</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~ASTNode() {} }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ASTNodePtr = ASTNode*; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Operator&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OperatorNode</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ASTNode { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: OperatorNode(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASTNodePtr &amp;left, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASTNodePtr &amp;right) : left(left) , right(right) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operator == <span class="hljs-string"><span class="hljs-string">'+'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left-&gt;evaluate() + right-&gt;evaluate(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operator == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left-&gt;evaluate() * right-&gt;evaluate(); } ~OperatorNode() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> left; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> right; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: ASTNodePtr left, right; <span class="hljs-comment"><span class="hljs-comment">//  }; class ConstantNode : public ASTNode { public: ConstantNode(double value) : value(value) {} double evaluate() { return value; } private: double value; };</span></span></code> </pre> </div></div><br><p> ä½¿ç”¨Boost.Phoenixåº“ï¼Œæ‚¨å¯ä»¥åœ¨è§£ææœŸé—´ä»ä¸€ä¸ªæˆ–å¤šä¸ªéç»ˆç«¯åˆ›å»ºä¸€ä¸ªç°æˆçš„ASTèŠ‚ç‚¹ï¼Œå¹¶ç›´æ¥å†™å…¥ç»“æœã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹è®¡ç®—å™¨çš„ç»„æˆï¼š </p><br><pre> <code class="cpp hljs">start = (product &gt;&gt; <span class="hljs-string"><span class="hljs-string">'+'</span></span> &gt;&gt; start)[qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'+'</span></span>&gt;&gt; (qi::_1, qi::_2)] | product[qi::_val = qi::_1];</code> </pre> <br><p>  start-å¼€å§‹åˆ†æå¥å­ã€‚ èµ·ç‚¹ã€‚ å®ƒå¯ä»¥é€šè¿‡ä¹˜ç§¯ä¸å¼€å§‹ä¹‹å’Œè¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¹˜ç§¯æ¥è¡¨ç¤ºã€‚ </p><br><p> æ³¨æ„æ¯ä¸ªè¡¨è¾¾å¼çš„æ–¹æ‹¬å·ä¸­çš„æ“ä½œã€‚ å¦‚æœè§£ææˆåŠŸï¼Œå¹¶ä¸”æ‰€æœ‰å†…å®¹éƒ½åŒ¹é…ï¼Œåˆ™åº”æ‰§è¡Œæ­¤æ“ä½œã€‚  <em>qi :: _ val</em>å®é™…ä¸Šæ˜¯<em>å¢å¼º::ç²¾ç¥:: qi :: _ val</em>æ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚ åœ¨å…¶å¸®åŠ©ä¸‹ï¼Œç­”æ¡ˆå°†è®°å½•åœ¨ç»“æœä¸­ã€‚ åœ¨å¯åŠ¨çš„æƒ…å†µä¸‹ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªOperatorNodeå¯¹è±¡ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°å°†æ˜¯è§£æä¹˜ç§¯çš„ç»“æœï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è§£æå¼€å§‹çš„ç»“æœã€‚ </p><br><p> æˆ‘ä»¬è¿›ä¸€æ­¥çœ‹ã€‚ å‡è®¾æˆ‘ä»¬é‡åˆ°ç¬¬äºŒç§é€‰æ‹©ï¼Œå¼€å§‹ä¸æ˜¯ä¸€ä¸ªå’Œï¼Œè€Œæ˜¯ä¸€ä¸ªä¹˜ç§¯ã€‚ ä»–å¦‚ä½•è¡¨è¾¾ï¼Ÿ </p><br><pre> <code class="cpp hljs">product = (factor &gt;&gt; <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt;&gt; product) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'*'</span></span>&gt;&gt; (qi::_1, qi::_2)] | factor[qi::_val = qi::_1];</code> </pre> <br><p> é‡å¤å‰ä¸€å¼ å›¾ç‰‡ï¼Œå·®å¼‚æœ€å°ã€‚ å†æ¬¡é‡åˆ°æŸç§è¡¨è¾¾å¼ï¼Œå†æ¬¡åœ¨ç»“æœä¸­å†™å…¥OperatorNodeå¯¹è±¡ï¼Œæˆ–è€…åªæ˜¯æŸç§å› æ•°ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹ã€‚ </p><br><pre> <code class="cpp hljs">factor = group[qi::_val = qi::_1] | qi::int_[qi::_val = phx::new_&lt;ConstantNode&gt;(qi::_1)];</code> </pre> <br><p> å½“æˆ‘ä»¬æ²¿ç€æœ€çŸ­çš„è·¯å¾„å‰è¿›æ—¶ï¼Œæˆ‘ä»¬å‡è®¾é‡åˆ°äº†intã€‚ ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä¼ªä»£ç æè¿°å‰é¢çš„æ‰€æœ‰æ­¥éª¤ï¼Œæˆ‘ä»¬å°†å¾—åˆ°å¦‚ä¸‹æ‰©å±•å½¢å¼ï¼š </p><br><pre> <code class="cpp hljs">factor1 = ConstantNode(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   ,    factor2 = ConstantNode(3) product = OperatorNode&lt;'*'&gt;(factor1, factor2) start = product</span></span></code> </pre> <br><p> ä»é¡¶éƒ¨å¼€å§‹çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆæœ€ä½çš„èŠ‚ç‚¹é™¤å¤–ï¼Œæ­¤å¤„æœ¬è´¨ä¸Šæ˜¯æ•´æ•°ï¼‰é€šè¿‡åç»­èŠ‚ç‚¹è¡¨ç¤ºã€‚ å”¯ä¸€è°ƒç”¨æ ¹å…ƒç´ ä¸Šçš„validate <em>ï¼ˆï¼‰</em>æ–¹æ³•è§£å†³äº†æ•´ä¸ªé—®é¢˜ï¼Œå¤ªå¥½äº†ï¼ </p><br><p> ç„¶å<em>qi :: space_type</em>å¼•èµ·æ‚¨çš„æ³¨æ„-æ­¤å‚æ•°æ˜¯è§£ææ—¶å¿½ç•¥çš„å…ƒç´ åˆ—è¡¨ã€‚ è¿™ä»ç„¶ä¼šåœ¨æˆ‘èº«ä¸Šå‘æŒ¥ä½œç”¨:-)ã€‚ </p><br><p> æ­¤å¤„å¼•äººæ³¨ç›®çš„æ˜¯é€šè¿‡ç®€å•åœ°é€šè¿‡ä¹˜ç§¯ï¼ˆ*ï¼‰è¡¨ç¤ºéç»“æŸèµ·å§‹ï¼ˆä»…åŒ…å«+ï¼‰æ¥ä¼˜å…ˆäºä¹˜æ³•è¿›è¡ŒåŠ æ³•çš„æ–¹æ³•ã€‚ åœ¨æˆ‘çš„è¯­æ³•å˜ä½“ä¸­ï¼Œç”±äºç¡®å®šâ€œä¸â€å°†ä¼˜å…ˆäºâ€œæˆ–â€ï¼Œå› æ­¤æˆ‘åªåœ¨æ­£ç¡®çš„ä½ç½®æ›¿æ¢æ‰€éœ€çš„é€»è¾‘è¿ç®—ç¬¦ã€‚ å¦‚æœå¾ˆéš¾åœ¨ç¼–å†™æ•°å­¦è¿ç®—ç¬¦æ—¶çŠ¯é”™è¯¯ï¼Œé‚£ä¹ˆæ–‡æœ¬é€»è¾‘è¿ç®—ç¬¦å°±æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„æ•…äº‹ã€‚ å¸Œæœ›è§£å†³è‡³å°‘éƒ¨åˆ†å¯èƒ½çš„é—®é¢˜ï¼Œä¾‹å¦‚å¯„å­˜å™¨ã€‚ ä¸ºæ­¤ï¼ŒSpiritå…·æœ‰å†…ç½®ç±»å‹<em>qi :: no_case</em> </p><br><p> æ­¤å¤–ï¼Œé™¤äº†æ•°å­—ä»¥å¤–ï¼Œæˆ‘è¿˜éœ€è¦è¿™äº›å­—æ®µçš„åç§°ï¼Œå› æ­¤æˆ‘ä»¬æ·»åŠ äº†ç›¸åº”çš„éç»ˆç»“ç¬¦ï¼Œè€Œä¸æ˜¯å†…ç½®çš„<em>qi :: int_</em> spiritï¼š </p><br><pre> <code class="cpp hljs">field = qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_"</span></span>) &gt;&gt; *qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_0-9"</span></span>);</code> </pre> <br><p> æˆ‘ä»¬åœ¨è¿™é‡Œå¾—åˆ°äº†è¿™æ ·ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰è¯­ä¹‰è¿ç®—ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">start = product &gt;&gt; qi::no_case["OR"] &gt;&gt; start | product; product = factor &gt;&gt; qi::no_case["AND"] &gt;&gt; product | factor; factor = group | field; group %= '(' &gt;&gt; start &gt;&gt; ')';</code> </pre> <br><p> ç°åœ¨ï¼Œä¸€åˆ‡å°±ç»ªï¼Œå¯ä»¥è§£ææœ€ç®€å•çš„å¥å­<em>â€œ field And field2â€</em> ã€‚ æˆ‘ä»¬å¼€å§‹äº†ï¼Œâ€¦â€¦ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ </p><br><p> é—®é¢˜å‡ºåœ¨ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„åœ°æ–¹ï¼š <em>qi :: space_type</em>ä¸ä»…ä¼šå¿½ç•¥ç©ºæ ¼ï¼Œ <em>è¿˜ä¼š</em>åœ¨è§£æä¹‹å‰å°†å…¶ä»å¥å­ä¸­åˆ é™¤ï¼Œå¹¶ä¸”åˆå§‹è¿‡æ»¤å™¨è¡¨è¾¾å¼å·²ç»ä»¥ä»¥ä¸‹å½¢å¼è§£æï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">"fieldAndfield2"</span></span> \\        ,    <span class="hljs-string"><span class="hljs-string">"(5 * 5) + 11 "</span></span> \\  <span class="hljs-string"><span class="hljs-string">"(5*5)+11"</span></span></code> </pre> <br><p> è¿™ä»…ä»…æ˜¯ä¸€ä¸ªé¢†åŸŸã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦ä¸€äº›é˜Ÿé•¿ï¼š </p><br><pre> <code class="cpp hljs">skipper = +qi::lit(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . ,    ,   ,  ,  C++ . start = product &gt;&gt; skipper &gt;&gt; qi::no_case["OR"] &gt;&gt; skipper &gt;&gt; start | product; ...</span></span></code> </pre> <br><p> åœ¨åˆ†æå®Œå­—æ®µä¹‹åï¼Œå°±å¯ä»¥å­¦ä¹ å¦‚ä½•ä»è¡¨è¾¾å¼ä¸­è·å–å€¼ï¼Œå¹¶äº†è§£å¦‚ä½•æ ¹æ®è¯¥å€¼å¯¹å­—æ®µè¿›è¡ŒéªŒè¯ã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œæ¥è¡¨ç¤ºæ‰€æœ‰æ¯”è¾ƒé€‰é¡¹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Operator</span></span></span><span class="hljs-class"> {</span></span> EQ, <span class="hljs-comment"><span class="hljs-comment">//  LT, //  GT, //  CP //  (  ) }; unary = qi::no_case["NOT"]; // ,         </span></span></code> </pre> <br><p> å€¼æœ¬èº«ä»¥è¿™æ ·çš„éç»ˆç»“ç¬¦è¡¨ç¤ºï¼š </p><br><pre> <code class="cpp hljs">value = qi::double_ | qi::int_ | qi::bool_ | <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>) &gt;&gt; +qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z0-9_. "</span></span>) &gt;&gt; qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>);</code> </pre> <br><p> ç°åœ¨è°ˆåˆ°è¿™ç§è·å–ä»·å€¼çš„æ–¹æ³•æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚  Spiritå°†ä»¥<em>boost :: variant &lt;intï¼Œdoubleï¼Œboolï¼Œstd :: string&gt;</em>çš„å½¢å¼è¿”å›å®ƒï¼Œå¹¶ä¸”å½“éœ€è¦å°†å…¶ä¸æŸäº›æ•°æ®è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå°†éœ€è¦ä¸€äº›æŠ€å·§æ¥è·å–æ‰€éœ€ç±»å‹çš„å€¼ã€‚ è¿™æ˜¯æˆ‘æ¥åˆ°çš„é€‰é¡¹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ValueType = boost::variant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValueGetter</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> boost::static_visitor&lt;Json&gt; { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Type&gt; <span class="hljs-function"><span class="hljs-function">Json </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Type &amp;value)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } };</code> </pre> <br><p> ä¸ºä»€ä¹ˆå¸æ°”å‰‚ä¼šè¿”å›Jsonå¯¹è±¡ï¼Ÿ å› æ­¤ï¼Œå½“åœ¨è¿‡æ»¤è¿‡ç¨‹ä¸­æ¯”è¾ƒå€¼æ—¶ï¼Œæˆ‘å°†é¿å…å¿…é¡»å¼„æ¸…æ¥šæ¯”è¾ƒæ‰€ç»å†çš„æ•°æ®ç±»å‹ï¼Œè€Œå°†æ‰€æœ‰å·¥ä½œç•™ç»™jsonåº“ã€‚ </p><br><p> ç»ˆç‚¹çº¿ã€‚ åŒ¹é…è€…æœ¬äººçš„æè¿°ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ä¸è®¡ç®—å™¨ç›¸åŒçš„ç¤ºä¾‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠ½è±¡ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°è¯­æ³•ä¸­ï¼ŒSpiritä¼šç”¨æˆ‘ä»¬å°†å…¶å¡«å……ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMatcher</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: AbstractMatcher() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~AbstractMatcher() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       }; using MatcherPtr = std::shared_ptr&lt;AbstractMatcher&gt;;</span></span></code> </pre> <br><p> å…¶ä»–é€»è¾‘èŠ‚ç‚¹æ˜¯ä¸»è¦è¿‡æ»¤å™¨èŠ‚ç‚¹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">é€»è¾‘èŠ‚ç‚¹</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logic</span></span></span><span class="hljs-class"> {</span></span> AND, OR }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;Logic Operator&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogicNode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractMatcher { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: LogicNode(MatcherPtr &amp;left, MatcherPtr &amp;right) : m_left(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(left)) , m_right(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(right)) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Operator) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Logic::AND: m_evaluator = &amp;LogicNode::And; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Logic::OR: m_evaluator = &amp;LogicNode::Or; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> final </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::invoke(m_evaluator, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, object); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: MatcherPtr m_left; MatcherPtr m_right; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EvaluateType = <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(LogicNode::*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json &amp;); EvaluateType m_evaluator = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">And</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_left-&gt;evaluate(object) &amp;&amp; m_right-&gt;evaluate(object); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_left-&gt;evaluate(object) || m_right-&gt;evaluate(object); } };</code> </pre> </div></div><br><p> æœ€åï¼Œæœ€åº•å±‚çš„èŠ‚ç‚¹ </p><br><div class="spoiler">  <b class="spoiler_title">ä»·å€¼æ¯”è¾ƒ</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectNode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractMatcher { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ObjectNode(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> field, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ValueType &amp;value, boost::optional&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; &amp;unary, Operator oper) : m_field(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(field)) , m_json_value(boost::apply_visitor(ValueGetter(), value)) , m_reject(unary.has_value()) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (oper) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::EQ: m_evaluator = &amp;ObjectNode::Equal; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::LT: m_evaluator = &amp;ObjectNode::LesserThan; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::GT: m_evaluator = &amp;ObjectNode::GreaterThan; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::CP: m_evaluator = &amp;ObjectNode::Substr; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> final </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;value = object.at(m_field); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::invoke(m_evaluator, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_reject ? !result : result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EvaluateType = <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(ObjectNode::*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json &amp;); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> m_field; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json m_json_value; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> m_reject; EvaluateType m_evaluator = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json == m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LesserThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json &lt; m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json &gt; m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Substr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Str(json).find(Str(m_json_value)) != <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::npos; } };</code> </pre> </div></div><br><p> å‰©ä¸‹çš„åªæ˜¯å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ°æ£®è¿‡æ»¤å™¨</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonFilterGrammar</span></span></span><span class="hljs-class"> :</span></span> qi::grammar&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator, MatcherPtr()&gt; { JsonFilterGrammar() : JsonFilterGrammar::base_type(expression) { skipper = +qi::lit(<span class="hljs-string"><span class="hljs-string">' '</span></span>); unary = qi::no_case[<span class="hljs-string"><span class="hljs-string">"NOT"</span></span>]; compare.add (<span class="hljs-string"><span class="hljs-string">"eq"</span></span>, Operator::EQ) (<span class="hljs-string"><span class="hljs-string">"lt"</span></span>, Operator::LT) (<span class="hljs-string"><span class="hljs-string">"gt"</span></span>, Operator::GT) (<span class="hljs-string"><span class="hljs-string">"cp"</span></span>, Operator::CP); expression = (product &gt;&gt; skipper &gt;&gt; qi::no_case[<span class="hljs-string"><span class="hljs-string">"OR"</span></span>] &gt;&gt; skipper &gt;&gt; expression) [qi::_val = make_shared_&lt;LogicNode&lt;Logic::OR&gt;&gt;()(qi::_1, qi::_2)] | product[qi::_val = qi::_1]; product = (term &gt;&gt; skipper &gt;&gt; qi::no_case[<span class="hljs-string"><span class="hljs-string">"AND"</span></span>] &gt;&gt; skipper &gt;&gt; product) [qi::_val = make_shared_&lt;LogicNode&lt;Logic::AND&gt;&gt;()(qi::_1, qi::_2)]| term[qi::_val = qi::_1]; term = group[qi::_val = qi::_1] | (field &gt;&gt; -(skipper &gt;&gt; unary)&gt;&gt; skipper &gt;&gt; qi::no_case[compare] &gt;&gt; skipper &gt;&gt; value) [qi::_val = make_shared_&lt;ObjectNode&gt;()(qi::_1, qi::_4, qi::_2, qi::_3)]; field = qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_"</span></span>) &gt;&gt; *qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_0-9"</span></span>); value = qi::double_ | qi::int_ | qi::bool_ | <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>) &gt;&gt; +qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z0-9_. \u20BDâ‚¬$Â¥-"</span></span>) &gt;&gt; qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>); group %= <span class="hljs-string"><span class="hljs-string">'('</span></span> &gt;&gt; expression &gt;&gt; <span class="hljs-string"><span class="hljs-string">')'</span></span>; } qi::rule&lt;Iterator&gt; skipper; qi::rule&lt;Iterator, MatcherPtr()&gt; product, term, expression, group; qi::rule&lt;Iterator, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>()&gt; field, unary, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; qi::rule&lt;Iterator, ValueType()&gt; value; qi::symbols&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>, Operator&gt; compare; <span class="hljs-comment"><span class="hljs-comment">//      enum };</span></span></code> </pre> </div></div><br><p> ä»…æ­¤è€Œå·²ã€‚ ç°åœ¨ï¼Œè·å–å®Œæˆçš„è¿‡æ»¤å™¨å·²æˆä¸ºç›¸å½“ç®€å•çš„æ“ä½œï¼š </p><br><pre> <code class="cpp hljs">MatcherPtr matcher; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filter = <span class="hljs-string"><span class="hljs-string">"int not LT 15"</span></span>; JsonFilterGrammar grammar; qi::parse(filter.begin(), filter.end(), grammar, matcher); <span class="hljs-comment"><span class="hljs-comment">//     matcher   .</span></span></code> </pre> <br><p> æˆ‘å°†çœç•¥å°†è¯­æ³•åŒ…è£…åœ¨å‡½å­ä¸­çš„è¿‡ç¨‹ï¼ˆæˆ‘è®¤ä¸ºè¿™å¯¹ä»»ä½•äººéƒ½ä¸ä¼šå¾ˆæœ‰è¶£ï¼‰ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨æœ€ç®€å•çš„ç¤ºä¾‹æ¥æ›´å¥½åœ°è€ƒè™‘å®é™…ä½¿ç”¨çš„å·¥å…·ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filter = <span class="hljs-string"><span class="hljs-string">"int not LT 15"</span></span>; Json json{ {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}} }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; json.dump() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; json.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove_if(json.begin(), json.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::not_fn(JsonFilter{filter})), json.end()); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; json.dump() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre> <br><p> è¿™æ˜¯è¾“å‡ºï¼š </p><br><pre> <code class="bash hljs">[{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:10},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:11},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:20},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:30},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:9}] [{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:20},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:30}]</code> </pre> <br><p> äº²çˆ±çš„è¯»è€…ï¼Œæˆ‘å¸Œæœ›æ‚¨ä¹Ÿå¯¹å’Œæˆ‘ä¸€æ ·äº†è§£çµçš„åŸºæœ¬çŸ¥è¯†æ„Ÿå…´è¶£ã€‚ ç„¶åæˆ‘ç•™ä¸‹æ¥ã€‚ å¾…ä¼šå„¿è§ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN472004/">https://habr.com/ru/post/zh-CN472004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471992/index.html">å®æ–½PEGçš„å…¶ä½™åŠŸèƒ½</a></li>
<li><a href="../zh-CN471994/index.html">åœ¨æ ¸å¿ƒå¼€å‘è€…Sprintä¸Šè¿›è¡ŒPEGå·¥ä½œ</a></li>
<li><a href="../zh-CN471998/index.html">Fï¼ƒ10ï¼šåˆ—è¡¨</a></li>
<li><a href="../zh-CN472000/index.html">â€œç¤¾åŒºåˆ¶å®šæ ‡å‡†è‡³å…³é‡è¦â€ï¼šMarchin Moskalaå…³äºKotlin</a></li>
<li><a href="../zh-CN472002/index.html">åœ¨Gradleä¸­é‡æ–°åŒ…è£…åŒ…è£¹</a></li>
<li><a href="../zh-CN472006/index.html">ä¸ºä»€ä¹ˆé‡æ–°å‘æ˜è½®å­å¾ˆæœ‰ç”¨</a></li>
<li><a href="../zh-CN472012/index.html">åŠå°æ—¶å†…çœ‹æ¿</a></li>
<li><a href="../zh-CN472014/index.html">OTUSã€‚ æˆ‘ä»¬æœ€å–œæ¬¢çš„é”™è¯¯</a></li>
<li><a href="../zh-CN472018/index.html">Flask-Potionä¸Šçš„åº“æ§åˆ¶ç³»ç»Ÿï¼Œç¬¬0éƒ¨åˆ†ï¼šå‡†å¤‡æ‰€éœ€çš„ä¸€åˆ‡</a></li>
<li><a href="../zh-CN472020/index.html">åå¤§ï¼šHolyJS 2019 Piterçš„æœ€ä½³æŠ¥å‘Š</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>