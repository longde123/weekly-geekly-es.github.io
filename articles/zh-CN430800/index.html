<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📽️ 📡 🕜 在Godot Engine上创建游戏“ Like Coins”。 第二部分 👨🏻‍⚖️ 🧑🏻 📊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我希望您已经厌倦了等待本文的第二部分，该部分涉及使用Godot Engine和游戏示例（如《硬币》）来处理使用Godot Engine进行游戏开发的各个方面？ 议程上已经准备了许多“美味”和“健康”的东西。 立即预约，在本文中我们将完成先前开始的游戏，您可以在此处开始阅读它的开始- 在Godot E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在Godot Engine上创建游戏“ Like Coins”。 第二部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430800/"><p> 我希望您已经厌倦了等待本文的第二部分，该部分涉及使用Godot Engine和游戏示例（如《硬币》）来处理使用Godot Engine进行游戏开发的各个方面？ 议程上已经准备了许多“美味”和“健康”的东西。 立即预约，在本文中我们将完成先前开始的游戏，您可以在此处开始阅读它的开始- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在Godot Engine上创建游戏“ Like Coins”。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分</a> ，但是系列文章将继续，因为 有太多的材料使我放弃了其中的一部分，但是我们一定会在稍后再讲。 让“ gamedev”开始！ </p><a name="habracut"></a><br><h3 id="scena-main"> 场景“主要” </h3><br><p>在本文的上半部分，我们停在了主要阶段（ <code>Main</code> ），从那以后，也许我们将继续。 我们将删除之前添加的所有内容（如果您添加了一些内容来检查所有内容的工作原理），如果没有任何内容加载到场景中，则应添加<code>Node</code> ，它将是下面列出的节点的父级，依次还应该添加到场景中： </p><br><p>  <code>ColorRect</code> （“背景”）-填充背景色； <br>  <code>Player</code> “ Player”对象（希望您不要困惑，因为我将<code>Player</code>场景称为对象？）； <br>  <code>Node</code> （“容器”）-用于临时存放硬币的“容器”； <br>  <code>Position2D</code> （“ PlayerStart”）-在游戏开始时设置“ Player”对象的初始位置； <br>  <code>Timer</code> （“ GameTimer”）-时间限制计数器； </p><br><p> 选择<code>ColorRect</code>并在工具栏上选择： <code>Layout -&gt; Full Rect</code>将其拉伸到屏幕的整个区域（以后，我们通常会使用此功能，因此，我建议您自己研究<code>Layout</code>列表中指定的其他操作），为此节点，在属性“颜色”中指定所需的填充颜色。 您可以使用<code>TextureRect</code>进行相同的<code>TextureRect</code> ，只是需要填充“ Texture”属性来填充图像，而不是填充图像。 对于<code>Position2D</code> ，在“ position”属性中，指定“ x”和“ y”的值-这将用作<code>Player</code>的初始位置。 当然，借助脚本，您可以直接在<code>Player</code>本身中设置定位值，但我们不仅学习开发游戏，而且还学习“ Godot”，因此，考虑解决一个问题的不同选项将是多余的。 </p><br><h4 id="skript-dlya-main">  “主要”脚本 </h4><br><p> 为<code>Node</code>添加脚本并打印以下内容： </p><br><pre> <code class="python hljs">extends Node <span class="hljs-comment"><span class="hljs-comment">#PackedScene        export (PackedScene) var Coin export (int) var playtime var level #  var score # var left_time #     var window_size #   var playing = false #   </span></span></code> </pre> <br><p> 属性“硬币”和“播放时间”将显示在<code>Inspector</code> 。 将场景“ Coin.tscn”拖到“ Coin”属性，并将值“ playtime”设置为“ 40”（游戏时间以秒为单位）。 </p><br><p> 游戏开始时，每次都应该进行初始化-准备工作，确定应用程序的高质量和无错误操作所需的参数。 这是必不可少的步骤，因此您首先应注意这一点。 </p><br><pre> <code class="python hljs">func _ready(): randomize() <span class="hljs-comment"><span class="hljs-comment">#        window_size = get_viewport().get_visible_rect().size #    $Player.window_size = window_size #    "" $Player.hide() #  </span></span></code> </pre> <br><p> 请注意，当指定<code>Player</code>对象的名称时，将使用“ $”符号-这是“语法糖”，它使您可以直接访问当前场景中的节点，这是<code>get_node("Node1")</code>方法的一种很好的替代方法（尽管不禁止使用后者）。 如果“ Node1”的后代是“ Node2”，则也可以使用此方法- <code>$Node1/Node2</code> 。 请注意，自动填充功能在Godot中非常有用，因此请不要忽略它。 不希望在节点名称中使用空格，但仍然有效，在这种情况下，请使用引号- <code>$"My best Node1"</code> 。 </p><br><h4 id="novaya-igra"> 新游戏 </h4><br><p> 要开始新游戏，我们将为此确定相应的功能，然后例如可以通过按下按钮来调用该功能。 </p><br><pre> <code class="python hljs">func new_game(): playing = true <span class="hljs-comment"><span class="hljs-comment">#   level = 1 score = 0 time_left = playtime $Player.start($PlayerStart.position) $Player.show() $GameTimer.start() #    spawn_coins() # </span></span></code> </pre> <br><p> 函数“ start（）”（其参数为<code>$PlayerStart.position</code>会将播放器移至起始位置，而函数“ spawn_coins（）”负责在运动场上生成硬币。 </p><br><pre> <code class="python hljs">func spawn_coins(): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">4</span></span> + level): var c = Coin.instance() $CoinContainer.add_child(c) c.window_size = window_size c.position = Vector2(rand_range(<span class="hljs-number"><span class="hljs-number">0</span></span>, window_size.x), rand_range(<span class="hljs-number"><span class="hljs-number">0</span></span>, window_size.y))</code> </pre> <br><p>  <code>range(4 + level)</code>函数将返回一个具有给定范围的数组，该数组的值等于硬币数量和当前级别的值之和。 一个范围可以包含一个参数，例如在我们的例子中，可以是两个参数或三个参数（第三个参数将是一个数组步骤）。 在此函数中，我们创建“ Coin”对象的几个实例，并将<code>CoinContainer</code>添加为子元素（希望您不要忘记我们已经可以访问该对象，这要归功于<code>PackedScene</code> ）。 请记住，每次创建新节点的<code>instance()</code>方法）时，都必须使用<code>add_child()</code>将其添加到树中。 接下来，我们设置可能产生硬币的区域，以使它们不会意外出现在屏幕后面，然后随机分配位置。 最后一行看起来不太美观，因此我建议通过使用Singleton来简化它。 </p><br><h3 id="singltony"> 辛格尔顿 </h3><br><p>  Singleton的中间名称是“启动”。 已经暗示了吧？ 我告诉你，一个单例的工作方式如下：我们可以在其中编写所需内容的脚本（从声明变量开始，以场景的“切换”结束，包括加载和卸载它们），然后运行应用程序，并且可以从任何位置访问其所有内容。项目要点。 从某种意义上讲，这是一种在任何给定时间可用的自定义全局存储库。 </p><br><blockquote> 注意，该项目有其自己的全局存储库，我们也可以使用其内容，您可以使用<code>ProjectSettings.get_setting(name)</code>来访问它，其中<code>name</code>是所需参数的名称。 </blockquote><p> 现在，要使用存储库“ _G”中的某些内容，只需按名称调用它，然后指定要调用的方法，或那里的所有内容即可。 因此，创建一个空脚本并在其中编写如下所示的函数： </p><br><pre> <code class="python hljs">extends Node func rand(): var rrand = Vector2(rand_range(<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">760</span></span>), rand_range(<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">540</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rrand <span class="hljs-comment"><span class="hljs-comment">#  </span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/qm/te/or/qmteord9ofi1wxjimdhwqm-kexi.png"></p><br><p> 接下来，保存它并转到项目设置： <code>Project -&gt; Project Settings -&gt; AutoLoad</code> 。 我们选择新创建的脚本，为其设置一个名称，例如“ _G”，然后返回“ spawn_coins（）”函数以略微调整期限，将其替换为以下代码： </p><br><pre> <code class="python hljs"> ... c.position = _G.rand()</code> </pre> <br><p> 现在值得通过将“ spawn_coins（）”放入“ _ready（）”块并在F5上运行应用程序来检查发生了什么。 并且不要忘记选择<code>Main.tscn</code>作为主场景，如果由于某种原因选择错误，则可以手动更改主场景，为此，您需要转到项目设置： <code>General -&gt; Run -&gt; MainScene</code> 。 它行得通吗？ 然后继续前进。 </p><br><h4 id="skolko-monet-ostalos"> 还剩几枚硬币？ </h4><br><p> 让我们继续。 接下来，您需要检查还剩下多少硬币才能将玩家转移到下一个级别，以增加5秒的时间的形式给他一个小的“奖励”，然后重新生成硬币。 </p><br><pre> <code class="python hljs">func _process(delta): <span class="hljs-comment"><span class="hljs-comment">#   ?     ? if playing and $CoinContainer.get_child_count() == 0: #    level += 1 # ""   time_left += 5 #  spawn_coins()</span></span></code> </pre> <br><h3 id="polzovatelskiy-interfeys"> 使用者介面 </h3><br><p> 我们的整个界面将由以下元素组成：得分指示器，当前级别，时间，游戏名称以及将触发游戏启动的按钮。 使用<code>CanvasLayer</code>父级创建一个场景（ <code>HUD.tscn</code> ）（允许您在运动场上方绘制用户界面）。 展望未来，我要说，管理用户界面元素并不是很方便，至少对我来说是这样，但是相当广泛的元素列表和积极的发展在光明的未来激发了人们对引擎这一方面发展的积极情绪。 </p><br><p><img src="https://habrastorage.org/webt/id/ql/pj/idqlpjnvonb1aegarnbxj1_zzpg.png"></p><br><p> 在Godot中，有所谓的“控制节点”，使您可以根据父级的指定参数自动设置子元素的格式。 每种类型的“控制节点”都有特殊的属性，可控制它们如何控制其后代的位置。  <code>MarginContainer</code>是这种类型的一个鲜明代表，必须将其添加到场景中。 借助<code>Layout -&gt; Top Wide</code>在窗口顶部拉伸它，并在此对象的属性的<code>Margin</code>部分中，从边缘（左，上和右）指定缩进。  <code>MarginContainer</code>应该具有三个具有以下名称的子<code>Label</code> ： <code>ScoreLabel</code> ， <code>LevelLabel</code>和<code>TimeLabel</code> 。 将它们添加到场景中。 使用<code>Align</code>属性，使它们与左，中和右对齐。 仍然需要添加另一个<code>Label</code> （ <code>Messagelabel</code> ），将其放置在中间，所有这些都借助<code>Layout</code> ，将按钮（ <code>StartButton</code> ） <code>StartButton</code> 。 </p><br><p><img src="https://habrastorage.org/webt/2i/qd/2i/2iqd2ir5i51-kzycvac2mr-mmk8.png"></p><br><p> 现在，让界面具有响应性，我们需要更新时间，收集的硬币数量并突出显示当前水平。 为<code>HUD</code>节点添加脚本。 </p><br><pre> <code class="python hljs">extends CanvasLayer signal start_game func update_score(value): $MarginContainer/ScoreLabel.text = str(value) func update_level(value): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(str(value)) == <span class="hljs-number"><span class="hljs-number">1</span></span>: $MarginContainer/TimeLabel.text = <span class="hljs-string"><span class="hljs-string">"0: 0"</span></span> + str(value) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: $MarginContainer/TimeLabel.text = <span class="hljs-string"><span class="hljs-string">"0: "</span></span> + str(value) func update_timer(value): $MarginContainer/TimeLabel.txt = str(value)</code> </pre> <br><p> 对于<code>MessageLabel</code>我们需要一个计时器，以便在短时间内更改消息的文本。 添加一个<code>Timer</code>节点，并将其名称替换为<code>MessageTimer</code> 。 在检查器中，将等待时间设置为2秒，然后选中“ <code>One Shot</code>字段中的复选框。 这样可以确保计时器在启动时仅运行一次。 </p><br><pre> <code class="python hljs">func show_message(text): $MessageLabel.text = text $MessageLabel.show() $MessageTimer.start()</code> </pre> <br><p> 将<code>timeout()</code>信号连接到“ MessageTimer”并添加以下内容： </p><br><pre> <code class="python hljs">func _on_MessageTimer_timeout(): $MessageLabel.hide()</code> </pre> <br><p> 在<code>StartButton</code>的“节点”选项卡上，连接<code>pressed()</code>信号。 当您单击<code>StartButton</code>按钮时<code>StartButton</code>该按钮应与<code>MessageLabel</code>一起消失，然后向主场景发送信号，随后我们将通过滑动执行函数“ new_game（）”来成功拦截该场景。 我们使用以下代码实现此目的。 不要忘记<code>Text</code>属性中的按钮来设置任何文字来启动游戏。 </p><br><pre> <code class="python hljs">func _on_StartButton_pressed(): $StartButton.hide() $MessageLabel.hide() emit_signal(<span class="hljs-string"><span class="hljs-string">"start_game"</span></span>)</code> </pre> <br><p> 为了最终完成界面，我们将编写最后一个final函数-该函数显示有关游戏结束的消息。 在此功能中，我们需要显示“ Game Over”字样不超过两秒钟，然后消失，这要归功于功能“ show_message（）”。 但是，一旦通知游戏结束的消息消失，您必须再次显示新游戏的开始按钮。  <code>yield()</code>暂停该函数的执行，直到收到<code>MessageTimer</code>的信号，并从<code>MessageTimer</code>接收到有关其执行的信号为止，该函数将继续执行，使我们返回其原始状态，以便我们可以再次开始新游戏。 </p><br><pre> <code class="python hljs">func show_game_over(): show_message(<span class="hljs-string"><span class="hljs-string">"Game Over"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>($MessageTimer, <span class="hljs-string"><span class="hljs-string">"timeout"</span></span>) $StartButton.show() $MessageLabel.text = <span class="hljs-string"><span class="hljs-string">"LIKE COINS!"</span></span> $MessageLabel.show()</code> </pre> <br><h3 id="ending"> 结局？ </h3><br><p> 让我们在<code>HUD</code>和<code>Main</code>之间设置反馈。 将<code>HUD</code>场景添加到主场景，并通过添加以下内容通过主场景上的<code>timeout()</code>连接<code>GameTimer</code>信号： </p><br><pre> <code class="python hljs">func _on_GameTimer_timeout(): time_left -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">#  $HUD.update_timer(time_left) #   if time_left &lt;= 0: game_over() #    </span></span></code> </pre> <br><p> 然后连接播放<code>pickup()</code>和<code>die()</code>信号。 </p><br><pre> <code class="python hljs">func _on_Player_pickup(): score += <span class="hljs-number"><span class="hljs-number">1</span></span> $HUD.update_score(score) func _on_Player_die(): game_over()</code> </pre> <br><p> 在游戏结束时，应该发生更多不可忽视的事情。 编写以下代码，我将进行解释。 </p><br><pre> <code class="python hljs">func game_over(): playing = false $GameTimer.stop() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> coin <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $CoinContainer.get_children(): coin.queue_free() $HUD.show_game_over() $Player.die()</code> </pre> <br><p> 此函数将停止游戏，然后<code>show_game_over()</code>计算剩余的硬币并<code>show_game_over()</code>剩余的硬币，然后<code>show_game_over()</code> <code>HUD</code>调用<code>show_game_over()</code> 。 下一步是启动动画并停止执行<code>Player</code>节点的过程。 </p><br><p> 最后，您必须激活<code>StartButton</code> ，该<code>StartButton</code>必须连接到<code>new_game()</code>函数。 单击<code>HUD</code>节点，然后在连接对话框中单击“ <code>Make Function to Off</code> （这将阻止创建新功能），然后在“ <code>Method In Node</code>字段中，指定所连接功能的名称<code>new_game</code> 。 这会将信号连接到现有功能，而不是创建一个新功能。 </p><br><p> 最后<code>new_game()</code>是从<code>_ready()</code>函数中删除<code>new_game()</code>并将以下两行添加到<code>new_game()</code>函数中： </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>$HUD.update_score(score) $HUD.update_timer(time_left)</code> </pre> <br><p> 现在我们可以充满信心地说游戏已经准备就绪，现在已经可以“玩”了，但是没有效果。 我们将在下一篇文章中讨论后者，它将极大地关注各种“装饰”，以使游戏玩法多样化并进一步探索“ Godot”的可能性。 因此，不要忘记关注文章的发布。 祝你好运！ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN430800/">https://habr.com/ru/post/zh-CN430800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN430788/index.html">我在伦敦的IB IT（Java开发人员，投资银行）的采访历史，以及典型任务的示例</a></li>
<li><a href="../zh-CN430790/index.html">Ledger Nano S：通往710个代币和加密货币所在空间的钥匙</a></li>
<li><a href="../zh-CN430792/index.html">在Unity中为LWRP创建大纲</a></li>
<li><a href="../zh-CN430794/index.html">课程的故事</a></li>
<li><a href="../zh-CN430798/index.html">锂离子UPS：要选择哪种电池，LMO或LFP？</a></li>
<li><a href="../zh-CN430802/index.html">PMI RU：2017年俄罗斯项目经理的薪水研究</a></li>
<li><a href="../zh-CN430804/index.html">特斯拉/松下电池是市场上最实惠的电动汽车电池</a></li>
<li><a href="../zh-CN430806/index.html">我们开始学习英语-编写了一个应用程序：EWM-创建培训项目的经验</a></li>
<li><a href="../zh-CN430808/index.html">演讲者理论：关于演讲者和演讲者如何工作的16种材料</a></li>
<li><a href="../zh-CN430810/index.html">用蝗虫进行负荷测试。 第二部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>