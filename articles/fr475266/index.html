<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé´ üë®üèø‚Äçüî¨ üòû Nous inversons les mobiles 1 sous Android. Comment ajouter un peu de fonctionnalit√© et abandonner quelques soir√©es üëÜüèΩ üé≤ üìØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je dois dire tout de suite que malgr√© le titre fort, comme quelqu'un pourrait le penser, de l'article - il n'y aura pas du tout de hardcore direct. Et...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous inversons les mobiles 1 sous Android. Comment ajouter un peu de fonctionnalit√© et abandonner quelques soir√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475266/"><p>  Je dois dire tout de suite que malgr√© le titre fort, comme quelqu'un pourrait le penser, de l'article - il n'y aura pas du tout de hardcore direct.  Et aussi, bien que l'inversion soit le plus souvent associ√©e √† la s√©curit√© de l'information, il n'y aura encore rien de tel, car il n'√©tait pas n√©cessaire de contourner les protections (√† l'exception d'une petite minification).  Il n'y en a pas.  Mobile 1s est un produit gratuit dans lequel aucun ch√®que, protection et fonction payante n'est int√©gr√©. </p><br><p>  Je lance donc un appel √† ceux qui esp√®rent voir l'utilisation de d√©sobfuscateurs, l'utilisation de Frida / Xposed, d'autres logiciels d√©licats - vous ne trouverez rien d'int√©ressant pour vous.  Ici, nous allons simplement utiliser apktool, baksmali, apksigner, adb, jadx, console, √©diteur de texte, javac, d8 et tout. </p><br><p> Je veux √©galement d√©cevoir √† l'avance ceux qui attendaient une analyse approfondie de la plateforme, ou sa forte modification.  Seules de petites modifications seront apport√©es √† quelques fichiers, et en fait, m√™me ces quelques fichiers que je n'ai pas bien compris, tout en haut. </p><a name="habracut"></a><br><h1 id="s-chego-vse-nachalos">  Comment tout a commenc√© </h1><br><p>  Je vais vous expliquer pourquoi j'ai soudain eu l'id√©e de me lancer dans le t√©l√©phone mobile pendant 1 seconde.  Pour le moment, je fais du d√©veloppement natif pour Android depuis un an maintenant, mais avant cela, je travaillais en tant que programmeur depuis 4 ans, et au cours de la derni√®re ann√©e et demie, nous avons souvent travaill√© sp√©cifiquement avec la plate-forme mobile.  Malgr√© le fait qu'elle r√©pondait aux besoins de base, elle avait √©galement de nombreux inconv√©nients (en plus du langage de programmation).  En particulier, il √©tait impossible d'int√©grer humainement une biblioth√®que externe, au moins par des moyens r√©guliers et avec notre r√©serve de connaissances d'alors.  Tout √©tait √©galement tr√®s triste, par exemple, avec la fonctionnalit√© d'afficher des √©tiquettes sur une carte.  Toute la possibilit√© de sa configuration √©tait de sp√©cifier du texte pour les √©tiquettes lorsque vous appuyez dessus.  √Ä cette √©poque, la seule fa√ßon de contourner ce probl√®me √©tait d'utiliser l'objet sp√©cial ¬´Champ de document HTML¬ª, mais il y avait des probl√®mes.  Au moment de travailler avec 1s, toutes mes connaissances dans le d√©veloppement natif pour Android √©taient dans une paire HelloWorld, donc je n'ai m√™me pas pens√© √† inverser le t√©l√©phone mobile avec 1s, nous n'avons pas r√©solu diverses questions des clients sur l'extension non standard de 1s, ou nous avons vu des natifs tr√®s simples les applications qui ont √©t√© plac√©es √† c√¥t√© et int√©gr√©es de mani√®re crois√©e / oblique avec 1s (et l'accord de licence 1s semble interdire les modifications dans la plate-forme elle-m√™me). </p><br><p>  Donc, la premi√®re raison de l'inversion 1c √©tait que je me suis int√©ress√© et ce que je peux faire avec la base de connaissances actuelle.  Je dois dire tout de suite que l'exp√©rience du d√©veloppement natif n'√©tait pas de dire ce qui est n√©cessaire, dans le travail quotidien presque rien de ce qui sera d√©crit ci-dessous n'est trouv√©.  Donc, en principe, tout 1snik moyen assis pendant plusieurs jours / semaines serait en mesure de tout comprendre. </p><br><p>  La deuxi√®me raison est que je voulais juste essayer de choisir l'apk des autres, parce qu'avant cela, il me manquait cette couche de connaissances assez large, et puisque je devais commencer quelque part, je me suis dit qu'il n'y avait que 1s. </p><br><h1 id="pervye-shagi">  Premiers pas </h1><br><p>  La premi√®re chose que j'ai faite, m√™me lorsque l'id√©e d'inverser les 1 ne vaguait que vaguement dans ma t√™te, j'ai simplement fait glisser le fichier apk de l'application sur la fen√™tre AndroidStudio avec la souris.  Je veux dire tout de suite que je me sentais un peu triste, car la plupart du code 1c est √©crit en C ++ et se trouve dans les biblioth√®ques .so, et il est plus difficile de les inverser, et ce n'√©tait pas int√©ressant.  Mais le fichier classes.dex a compl√®tement attir√© mon attention, d'autant plus que sa taille modeste m'a donn√© l'occasion de supposer qu'il serait facile de l'inverser.  En g√©n√©ral, cela s'est av√©r√© de cette fa√ßon.  Soit dit en passant, une cons√©quence int√©ressante du fait que la plupart du code en C ++ est que de nombreuses m√©thodes et classes ont √©vit√© le traitement avec ProGuard.  Il est difficile de faire une interop√©rabilit√© avec un code minifi√©;). </p><br><div class="spoiler">  <b class="spoiler_title">Voici ce que j'ai vu dans la fen√™tre du studio (d√©mont√© la version x86 pour fonctionner avec l'√©mulateur et non le vrai appareil)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ry/dx/6l/rydx6lnrt7oix0nqa63bftv2-8y.png"></p></div></div><br><p>  Comme vous pouvez le voir dans la capture d'√©cran ci-dessus, l'application a √©t√© √† peine r√©duite (en termes de changement de nom des classes et des m√©thodes).  De plus, vous pouvez voir qu'il y a tr√®s peu de code en Java et que les biblioth√®ques occupent presque tout l'espace. </p><br><p>  Apr√®s avoir pouss√© une liste de classes pendant un certain temps, j'ai vu une curieuse classe MapImpl qui jette le soup√ßon que c'est lui qui √©tait responsable d'une situation aussi triste avec la personnalisation de l'affichage des √©tiquettes. </p><br><div class="spoiler">  <b class="spoiler_title">Structure de MapImpl</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ya/rl/xh/yarlxho_dqjalx6euv2g57bddn8.png"></p></div></div><br><p>  La liste des m√©thodes et leurs signatures ont inspir√© l'espoir que tout serait tr√®s simple, et j'ai d√©cid√© d'examiner le code smali, apr√®s quoi je suis devenu tr√®s tendu et suis all√© lire la liste des commandes smali, et comment le lire / √©crire.  Cependant, c'est √† ce stade que j'ai d√©cid√© que la question s'annon√ßait simple et de courte dur√©e et, en cons√©quence, la voici, l'occasion de jouer avec le renversement.  Ayant d√©cid√© de lui consacrer quelques nuits (√† quel point je me trompais cruellement), je me suis couch√© avec une √¢me calme. </p><br><h1 id="stroyu-plany">  Faire des plans </h1><br><p>  Apr√®s m'√™tre r√©veill√© le matin, j'ai d√©cid√© que jusqu'√† ce point je n'avais m√™me jamais √©t√© engag√© dans la substitution de ressources dans les applications, pas comme les changements de logique, je n'avais rien √† escroquer tout de suite pour remplacer l'activit√© par une carte, il valait mieux aborder la solution du probl√®me par petites √©tapes.  Apr√®s cela, je me suis fait une courte liste d'√©tapes qui devaient me conduire au point final de mon voyage sous la forme d'une plate-forme mobile fonctionnelle avec mes modifications.  Cette liste √©tait la suivante: </p><br><ol><li>  Pr√©parez la configuration 1c pour la plate-forme mobile, dont toutes les fonctionnalit√©s sont d'afficher deux √©tiquettes sur la carte. </li><li>  D√©ballez l'apk de la plate-forme mobile, emballez sans modifications, assurez-vous que la configuration fonctionne. </li><li>  Apportez de petits changements aux fichiers smali qui ne changent presque rien, mais qui peuvent √™tre vus dans les journaux ou modifiez la logique de travail, assemblez et assurez-vous que cela fonctionne. </li><li>  Pour d√©passer l'activit√© smali avec une carte en java, ou √©crire une activit√© avec la m√™me interface, remplacez l'activit√© dans l'application sans changer de fonctionnalit√©.  Comme alternative, si la premi√®re est trop paresseuse ou compliqu√©e, √©crivez une classe qui fera une partie du travail pour MapImpl et ajoutez un appel √† ses m√©thodes depuis smali MapImpl. </li><li>  Ecrivez cet article (j'ai longtemps voulu √©crire quelque chose, mais d'autres id√©es me trottent encore dans la t√™te, mais il semblait que c'√©tait finalement un sujet assez digne) </li></ol><br><p>  Eh bien, au moins avec le premier paragraphe, je n'ai eu aucun probl√®me.  J'ai t√©l√©charg√© la version √©ducative gratuite de la plate-forme, t√©l√©charg√© la plate-forme mobile, d√©ploy√© le tout sur mon ordinateur (1C, avez-vous d√©j√† une version de formation pour linux, j'ai juste une autre impulsion pour quitter Windows, et maintenant je dois y travailler).  La configuration est tr√®s simple, au d√©marrage elle appelle la fonction ShowOnMap (), qui transmet deux points sur la carte.  C‚Äôest tout. </p><br><p>  Mais avec le deuxi√®me point, cela s'est av√©r√© plus triste √† cause de mon analphab√©tisme.  Mais quoi, les probl√®mes √©taient avec tous les points sauf le premier. </p><br><h1 id="perepakovyvayu-prilozhenie-bez-izmeneniy-koda">  Je reconditionne l'application sans changer le code </h1><br><p>  Google m'a imm√©diatement dit qu'il existe un excellent outil apktool qui permet litt√©ralement deux commandes pour analyser apk dans des fichiers .smali, ainsi que pour les r√©assembler.  J'ai d√©cid√© de l'utiliser.  J'ai d√©ball√© apk avec la commande suivante (ci-apr√®s, malgr√© le fait que parfois j'ai fait une partie du travail sur linux, je vais donner toutes les commandes pour Windows): </p><br><pre><code class="plaintext hljs">apktool.bat d .\sourceApk\1cem-x86.apk -o .\build\unpacked</code> </pre> <br><p>  et a obtenu le r√©pertoire d√©compress√© dans lequel un tas de fichiers se trouvait, c'√©tait pour travailler avec eux √† l'avenir.  Apk emball√© en arri√®re avec la commande </p><br><pre> <code class="plaintext hljs">apktool.bat b .\build\unpacked -o .\build\1cem-x86.apk</code> </pre> <br><p>  Essayer de l'installer sur un √©mulateur </p><br><pre> <code class="plaintext hljs">adb install .\build\1cem-x86.apk</code> </pre> <br><p>  J'ai eu l'erreur suivante: </p><br><pre> <code class="plaintext hljs">Performing Streamed Install adb: failed to install .\build\1cem-x86.apk: Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES: Failed to collect certificates from /data/app/vmdl1115375036.tmp/base.apk: Attempt to get length of null array]</code> </pre> <br><p>  En g√©n√©ral, il fallait accorder plus d'attention √† la base.  Bien s√ªr, je savais qu'il y avait des signatures, et qu'elles √©taient divis√©es en ventes et en versions, mais je ne savais pas que les applications n'√©taient pas install√©es sans signatures du tout.  J'ai d√©cid√© d'utiliser ma signature de d√©bit et de signer l'√©quipe apk </p><br><pre> <code class="plaintext hljs">apksigner.bat sign --ks C:\Users\neikist\.android\debug.keystore .\build\1cem-x86.apk</code> </pre> <br><p>  J'ai r√©ussi √† ex√©cuter l'application.  Certes, au lieu d'une carte √† deux points, un √©cran gris avec une signature google ci-dessous m'attendait.  Apr√®s avoir gratt√© le navet, j'ai d√©cid√© que le fait est que la cl√© pour Google maps √† partir de 1s est utilis√©e, ce qui ne fonctionne pas avec ma signature.  Par cons√©quent, en acc√©dant √† la console du d√©veloppeur sur le site Web Google, j'ai cr√©√© un nouveau projet pour travailler avec Google Maps API sur Android, j'ai re√ßu une cl√© API, que j'ai sp√©cifi√©e dans res / values ‚Äã‚Äã/ strings.xml dans la ligne google_maps_key, et j'ai √©galement ajout√© ma cl√© de partage aux autorisations pour le projet .  J'ai remball√© et re-sign√© apk, je l'ai lanc√©, et finalement tout a fonctionn√© √† nouveau. </p><br><h1 id="dobavlyayu-svoi-logi">  J'ajoute mes logs </h1><br><p>  La prochaine chose que je voulais faire √©tait d'automatiser le lancement de l'application et d'ajouter la configuration 1c √† la plate-forme.  Manuellement, apr√®s chaque montage, cela serait toujours un g√¢chis. </p><br><p>  Au d√©but, j'ai googl√© et essay√© d'utiliser les utilitaires jadx ou dex2jar, afin de ne pas d√©ranger la lecture de smali, mais de lire le code java plus familier, mais pour une raison quelconque, cela n'a pas fonctionn√© (plus tard, jadx a r√©ussi √† entrer dans une sorte de chamanisme).  J'ai d√ª d√©monter Smali, car il s'est av√©r√© que ce n'√©tait pas aussi terrible que j'avais peur. </p><br><p>  Pour comprendre comment la plate-forme mobile re√ßoit une commande de la plate-forme de bureau pour lancer la configuration lors de la connexion via adb, j'ai d√©cid√© de regarder les points d'entr√©e de l'application et d'ajouter la sortie aux journaux d'intentions et autres informations utiles.  J'ai d√©cid√© de commencer avec l'application ( <code>com.e1c.mobile.E1cApplication</code> ) et l'activit√© ayant <code>android.intent.action.MAIN</code> dans le filtre d'intention ( <code>com.e1c.mobile.App</code> ).  J'√©tais √©galement int√©ress√© par le r√©cepteur <code>com.e1c.mobile.Starter</code> avec un filtre d'intention int√©ressant sur <code>com.e1c.mobile.START_TEMPLATE</code> et <code>com.e1c.mobile.START_CMD</code> .  C'est tr√®s similaire au fait qu'il accepte des intentions avec des commandes 1s, et c'est lui qui d√©marre la configuration √† partir du mod√®le. </p><br><p>  Malheureusement, je n'ai rien trouv√© d'int√©ressant dans <code>E1cApplication</code> , tout ce qui se passe l√†-bas est d'installer votre gestionnaire sur les caches. </p><br><p>  Mais dans les deux autres classes, <code>Starter</code> et <code>App</code> , il y avait beaucoup plus d'informations et cela s'est av√©r√© tr√®s utile.  La <code>App.onCreate(Landroid/os/Bundle;)V</code> est assez grande, donc je ne la donnerai pas dans son int√©gralit√©, je ne donnerai que les parties qui m'int√©ressent. </p><br><div class="spoiler">  <b class="spoiler_title">App onCreate, tranche de m√©thode</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">invoke-virtual {p0}, Lcom/e1c/mobile/App;-&gt;getIntent()Landroid/content/Intent; #     p1 move-result-object p1 new-instance v0, Ljava/lang/StringBuilder; invoke-direct {v0}, Ljava/lang/StringBuilder;-&gt;&lt;init&gt;()V invoke-virtual {v0, p0}, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/Object;)Ljava/lang/StringBuilder; const-string v1, ".onCreate() " invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder; invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/Object;)Ljava/lang/StringBuilder; invoke-virtual {v0}, Ljava/lang/StringBuilder;-&gt;toString()Ljava/lang/String; move-result-object v0 # ,  ? invoke-static {v0}, Lcom/e1c/mobile/Utils;-&gt;V(Ljava/lang/String;)V</code> </pre> </div></div><br><p>  Il peut √™tre vu √† partir de la section de code ci-dessus que l'application re√ßoit l'intention, met un lien vers elle dans le registre <code>p1</code> , ajoute la <code>StringBuilder</code> au nom et √† la m√©thode de classe via <code>StringBuilder</code> et transmet <code>V(Ljava/lang/String;)V</code> de la classe <code>Utils</code> √† la m√©thode statique.  Apparemment, une sorte de votre propre enregistreur.  Apr√®s cela, l'intention est v√©rifi√©e pour des donn√©es suppl√©mentaires, et, si disponible, <code>Uri</code> obtenu √† partir de celle-ci, √† partir de laquelle, √† son tour, une cha√Æne est obtenue par la m√©thode <code>getQuery()</code> et transmise √† la classe <code>Starter</code> .  <code>onCreate</code> n'ai vu aucune autre √©tude sur <code>onCreate</code> , j'ai jet√© un coup d'≈ìil et je me suis assur√© que les actions √©taient assez standard.  Sauf si la vue semble √™tre cr√©√©e par programme par une classe compl√®tement diff√©rente, au lieu d'utiliser <code>LayoutInflater</code> , mais je n'ai pas creus√© tr√®s profond√©ment, donc tout est possible et pas comme je le pensais.  La prochaine classe o√π je suis all√© est <code>Starter</code> .  Heureusement, il a √©t√© mentionn√© dans l'activisme et m'a int√©ress√© au manifeste. </p><br><p>  Malheureusement, la m√©thode qui a √©t√© appel√©e √† partir de l'activit√© s'est av√©r√©e √™tre native ( <code>.method static native startCmd(Ljava/lang/String;)V</code> ), j'ai donc fait attention √† la m√©thode <code>onRecieve</code> (dans laquelle l'application accepte les √©v√©nements auxquels elle est abonn√©e).  Je ne donnerai pas le code, cela m'int√©ressait que l'intention soit √©galement enregistr√©e en utilisant la m√©thode <code>V(Ljava/lang/String;)V</code> de la classe <code>Utils</code> .  Il s‚Äôav√®re qu‚Äôil suffit d‚Äôajouter un peu de code smali √† cette m√©thode - et je vais d'ailleurs r√©cup√©rer mes logs aux m√™mes endroits o√π les d√©veloppeurs de la plateforme les ont con√ßus.  En allant √† la classe Utils, j'ai imm√©diatement vu 2 m√©thodes vides, V et W. Apparemment, elles sont vides car lors de la compilation de la version finale, elles ont √©t√© supprim√©es.  Je viens d'ajouter un enregistrement de la cha√Æne pass√©e au <code>android.utils.Log</code> standard.  Pour ce faire, modifiez le nombre de registres locaux requis de 0 √† 1 (pour le slogan), placez cette cha√Æne dans le registre <code>v0</code> et enregistrez √©galement l'appel aux m√©thodes <code>Log</code> </p><br><div class="spoiler">  <b class="spoiler_title">Impl√©mentation des m√©thodes W et V</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> .method public static V(Ljava/lang/String;)V .locals 1 const-string v0, "neikist_V" invoke-static {v0, p0}, Landroid/util/Log;-&gt;v(Ljava/lang/String;Ljava/lang/String;)I return-void .end method .method public static W(Ljava/lang/String;)V .locals 1 const-string v0, "neikist_W" invoke-static {v0, p0}, Landroid/util/Log;-&gt;w(Ljava/lang/String;Ljava/lang/String;)I return-void .end method</code> </pre> </div></div><br><p>  J'ai lanc√© le mobile √† partir du bureau 1s et j'ai re√ßu les journaux suivants </p><br><div class="spoiler">  <b class="spoiler_title">R√©sultats de lancement</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> 2019-10-25 19:21:31.537 29960-29960/? V/neikist_V: com.e1c.mobile.Starter@139df1c.onReceive( android.app.ReceiverRestrictedContext@346b725, Intent { act=com.e1c.mobile.START_TEMPLATE flg=0x400010 cmp=com.e1c.mobile/.Starter (has extras) } ) 2019-10-25 19:21:31.537 29960-29960/? V/neikist_V: context.getPackageName() = com.e1c.mobile 2019-10-25 19:21:31.537 29960-29960/? V/neikist_V: intent.getAction() = com.e1c.mobile.START_TEMPLATE 2019-10-25 19:21:31.537 29960-29960/? V/neikist_V: App.sActivity = null 2019-10-25 19:21:31.537 29960-29960/? V/neikist_V: templatePath = /sdcard/Download/mobilegeoMA/1cema.xml 2019-10-25 19:21:31.537 29960-29960/? V/neikist_V: debugUrl = tcp://127.0.0.1:1560 2019-10-25 19:21:42.216 29960-29960/com.e1c.mobile V/neikist_V: com.e1c.mobile.App@423609b.onCreate() Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=0x10200000 cmp=com.e1c.mobile/.App bnds=[35,252][237,505] } 2019-10-25 19:21:42.651 29960-29960/com.e1c.mobile V/neikist_V: com.e1c.mobile.App$4@4c70381.run() adMobAppId = ca-app-pub-3940256099942544~3347511713 2019-10-25 19:21:42.687 29960-30009/com.e1c.mobile V/neikist_V: App.requestPermission() shouldShowRequestPermissionRationale = false 2019-10-25 19:21:46.138 29960-30009/com.e1c.mobile V/neikist_V: App.isLowBattery() sLastBatteryPercent = 1.0</code> </pre> </div></div><br><p>  Comme vous pouvez le voir, il y a toutes les informations n√©cessaires pour automatiser le lancement de l'application via adb.  Certes, √† ce stade, j'ai attrap√© un double visage.  Tout d'abord, j'ai finalement r√©cup√©r√© les cl√©s avec lesquelles jadx a ma√Ætris√© la traduction en java (il est clair que je devrais quand m√™me √©crire en smali, mais quand m√™me).  Et le deuxi√®me facespalm s'est av√©r√© √™tre le fait que j'ai r√©alis√© que je tourmentais la plate-forme du d√©veloppeur en vain (n√©cessaire uniquement pour le d√©veloppement et le d√©bogage des configurations), il serait plus correct d'inverser la version de g√©n√©ration des applications 1s, et il y a des projets gradle semi-pr√™ts pour l'assemblage, il y a un fichier avec une liste de d√©pendances et d'autres petits pains.  J'√©tais un peu triste √† ce sujet - et j'ai quand m√™me d√©cid√© de terminer ce que j'avais commenc√©.  Quoi qu'il en soit, pour le bien du fan, je fais tout cela, et pas pour des raisons pratiques. </p><br><h1 id="zapusk-platformy-cherez-adb">  Lancement de la plateforme via adb </h1><br><p>  J'ai d√©cid√© d'automatiser l'installation et le lancement via l'application adb en utilisant gradle.  Quoi qu'il en soit, √† ce moment-l√†, j'avais d√©j√† √©crit une petite liste de shuffles (d√©compression, copie des ressources modifi√©es et des fichiers smali dans le r√©pertoire avec l'application d√©compress√©e, empaquetage, signature, en fait, toutes les t√¢ches ne sont que des coureurs pour les commandes de la console).  Aux t√¢ches existantes ont ajout√© les commandes suivantes </p><br><pre> <code class="plaintext hljs"> adb install ./build/1cem-x86.apk adb shell pm grant com.e1c.mobile android.permission.READ_EXTERNAL_STORAGE adb push src/1cConfiguration /storage/emulated/0/Download adb shell am start -n com.e1c.mobile/.App -a android.intent.action.MAIN -c android.intent.category.LAUNCHER adb shell am broadcast -n com.e1c.mobile/.Starter -a com.e1c.mobile.START_TEMPLATE -e templatepath /storage/emulated/0/Download/1cConfiguration/1cema.xml</code> </pre> <br><p>  Par la s√©quence de commandes ci-dessus, nous installons apk, donnons √† l'application install√©e l'autorisation de lire le disque, copions la configuration 1s sur le p√©riph√©rique et donnons des commandes pour d√©marrer 1s et charger la configuration.  Cela ne fonctionne pas en passant sur toutes les versions de l'andro√Øde, mais j'ai test√© sur l'api 28, et en cons√©quence, cette s√©quence fait tout correctement.  Sur les versions plus r√©centes, il peut y avoir des probl√®mes avec la d√©livrance des droits. </p><br><h1 id="vnedryayus-v-obrabotku-dannyh-ot-1s-i-modificiruyu-metki">  Je suis impliqu√© dans le traitement des donn√©es √† partir de 1s et modifie les tags </h1><br><p>  Ici, j'avais plusieurs options pour le d√©veloppement ult√©rieur des √©v√©nements. </p><br><ol><li>  Je r√®gle directement MapImpl.smali, ce qui promettait d'√™tre une t√¢che assez difficile, √©tant donn√© que la biblioth√®que pour travailler avec Google maps est tr√®s s√©rieusement minimis√©e, et je devrais tout √©crire dans la syntaxe smali. </li><li>  J'utilise le fichier MapImpl.java obtenu gr√¢ce √† jadx, j'y apporte des modifications, j'utilise les classes que j'utilise pour le remplacer par des talons, distiller en smali, remplacer le fichier et l'emballer.  L'option m'a sembl√© tendue car cela faisait vraiment mal d'avoir beaucoup de prises, en plus il y avait des probl√®mes avec certaines d'entre elles que je ne voulais pas choisir. </li><li>  Je combine les approches 1 et 2, j'ins√®re les appels d'une classe d'extension sp√©ciale MapImplExtenstion.java dans du code smali qui √©tend une partie de la logique - en cons√©quence j'ai choisi cette option, tout simplement parce qu'elle est plus simple que les premi√®re et deuxi√®me options, et me semblait encore plus compliqu√©e que l'option 4, mais moins laborieux (ouais, r√™ve, na√Øf). </li><li>  En g√©n√©ral, remplacez Google maps par autre chose, par exemple Yandex.  Pour effectuer tout le travail dans un autre projet, simplement en r√©p√©tant les signatures MapImpl, puis r√©duisez la d√©compression et d√©posez simplement les fichiers smali finis avant de compresser l'application aux endroits appropri√©s.  Il n'y a aucun probl√®me avec les biblioth√®ques minifi√©es, mais je devrais m'inscrire pour obtenir une cl√© pour les cartes, cr√©er un projet s√©par√©, s'emb√™ter avec la connexion des ressources et plus encore. </li><li>  Identique √† l'option 4, mais remplacez Google par ... Google.  Mais ici, je soup√ßonnais qu'il serait possible de minimiser les cartes SDK 1 en 1, et il n'y avait aucune envie d'exp√©rimenter. </li></ol><br><p>  Apr√®s la troisi√®me option, j'ai cr√©√© 2 sous-r√©pertoires dans src: java, pour MapImplExtenstion.java et stubJava pour les fichiers qui sont n√©cessaires uniquement pour la compilation.  Depuis que j'ai d√©cid√© de modifier un peu les √©tiquettes, je me suis int√©ress√© aux deux domaines suivants: </p><br><div class="spoiler">  <b class="spoiler_title">Champs Xj: Ljava / util / ArrayList et Xk: Ljava / util / ArrayList</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> .field private final Xj:Ljava/util/ArrayList; .annotation system Ldalvik/annotation/Signature; value = { "Ljava/util/ArrayList&lt;", "Lcom/google/android/gms/maps/model/LatLng;", "&gt;;" } .end annotation .end field .field private Xk:Ljava/util/ArrayList; .annotation system Ldalvik/annotation/Signature; value = { "Ljava/util/ArrayList&lt;", "Lcom/google/android/gms/maps/model/MarkerOptions;", "&gt;;" } .end annotation .end field</code> </pre> </div></div><br><p>  En utilisant jadx pour d√©compiler en java, j'ai trouv√© dans le code d√©compil√© une m√©thode charg√©e de les remplir </p><br><div class="spoiler">  <b class="spoiler_title">M√©thode KN</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Bundle extras = getIntent().getExtras(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (extras != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Sd = extras.getLong(<span class="hljs-string"><span class="hljs-string">"native"</span></span>); String[] stringArray = extras.getStringArray(<span class="hljs-string"><span class="hljs-string">"titles"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[] doubleArray = extras.getDoubleArray(<span class="hljs-string"><span class="hljs-string">"coords"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doubleArray != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; doubleArray.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; stringArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i2 = i * <span class="hljs-number"><span class="hljs-number">2</span></span>; LatLng latLng = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LatLng(doubleArray[i2], doubleArray[i2 + <span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Xj.add(latLng); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Xk.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarkerOptions().c(latLng).dS(stringArray[i])); } } } }</code> </pre></div></div><br><p>  En cons√©quence, la classe MapImplExtension a ajout√© la m√©thode ArrayList [] kN (titres String [], coordonn√©es [] doubles) qui, dans le premier √©l√©ment du tableau, renverra une liste qui devra √™tre plac√©e dans Xj, et dans le second une liste pour Xk. </p><br><div class="spoiler">  <b class="spoiler_title">Classe MapImplExtension</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.e1c.mobile; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.android.gms.maps.model.LatLng; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.android.gms.maps.model.MarkerOptions; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MapImplExtension</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MapImpl mapImpl; MapImplExtension(MapImpl mapImpl){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mapImpl = mapImpl; } ArrayList[] kN(String[] titles, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[] coordinates) { ArrayList[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList[<span class="hljs-number"><span class="hljs-number">2</span></span>]; ArrayList&lt;LatLng&gt; xj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); ArrayList&lt;MarkerOptions&gt; xk = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); result[<span class="hljs-number"><span class="hljs-number">0</span></span>] = xj; result[<span class="hljs-number"><span class="hljs-number">1</span></span>] = xk; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> coordinatesOffset; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (coordinates != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; coordinates.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; titles.length; i++) { coordinatesOffset = i * <span class="hljs-number"><span class="hljs-number">2</span></span>; LatLng latlng = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LatLng(coordinates[coordinatesOffset], coordinates[coordinatesOffset + <span class="hljs-number"><span class="hljs-number">1</span></span>]); xj.add(latlng); xk.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarkerOptions().c(latlng).dS(<span class="hljs-string"><span class="hljs-string">" \n"</span></span> + titles[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre></div></div><br><p>  Compil√© avec les commandes suivantes, d'abord en classe, puis en dex, puis d√©compil√© en smali pour ensuite emballer avec le reste des fichiers </p><br><pre> <code class="plaintext hljs"> javac -encoding UTF-8 -d .\build -source 1.8 -target 1.8 -sourcepath .\src\stubJava .\src\java\com\e1c\mobile\MapImplExtenstion.java d8.bat .\build\com\e1c\mobile\MapImplExtension.class --output .\build java -jar C:\Path\to\baksmali\baksmali.jar d .\build\classes.dex -o .\build\unpackedOwn</code> </pre> <br><p>  Ajout du champ d'extension de type de notre nouvelle classe √† MapImpl.smali, et ajout de son initialisation </p><br><div class="spoiler">  <b class="spoiler_title">Ajout d'un champ</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    .field private extension:Lcom/e1c/mobile/MapImplExtension; #  ,  return-void new-instance v0, Lcom/e1c/mobile/MapImplExtension; invoke-direct {v0, p0}, Lcom/e1c/mobile/MapImplExtension;-&gt;&lt;init&gt;(Lcom/e1c/mobile/MapImpl;)V iput-object v0, p0, Lcom/e1c/mobile/MapImpl;-&gt;extension:Lcom/e1c/mobile/MapImplExtension;</code> </pre> </div></div><br><p>  Et √©galement remplac√© le traitement dans la classe MapImpl des donn√©es de 1 par le traitement dans la classe MapImplExtension </p><br><div class="spoiler">  <b class="spoiler_title">Modifications de MapImpl.kN ()</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> # v0 - ; v1 - ; v2 - extension; #  MapImplExtension.kN(...) iget-object v2, p0, Lcom/e1c/mobile/MapImpl;-&gt;extension:Lcom/e1c/mobile/MapImplExtension; invoke-virtual {v2, v1, v0}, Lcom/e1c/mobile/MapImplExtension;-&gt;kN([Ljava/lang/String;[D)[Ljava/util/ArrayList; # v0 -   ; v1 - | ; v2 -    move-result-object v0 const/4 v2, 0x0 aget-object v1, v0, v2 iput-object v1, p0, Lcom/e1c/mobile/MapImpl;-&gt;Xj:Ljava/util/ArrayList; const/4 v2, 0x1 aget-object v1, v0, v2 iput-object v1, p0, Lcom/e1c/mobile/MapImpl;-&gt;Xk:Ljava/util/ArrayList;</code> </pre> </div></div><br><p>  Apr√®s avoir emball√© et lanc√© l'application, j'ai vu avec joie que tout fonctionnait.  Mais pour le moment, je n'ai rien fait qui puisse √©tendre les capacit√©s de la plate-forme mobile.  Je viens de changer les en-t√™tes des marques sur la carte.  Mais voulant changer l'image des tags, je me suis bien d√©tach√© et enfoui assez longtemps dans les sources et la documentation. </p><br><h1 id="dobavlenie-novoy-funkcionalnosti">  Ajout de nouvelles fonctionnalit√©s </h1><br><p>  Tout d'abord, une petite explication de la fa√ßon dont le marqueur de l'√©tiquette est d√©fini.  La classe <code>MarkerOptions</code> poss√®de une <code>public MarkerOptions icon (BitmapDescriptor iconDescriptor)</code> √† laquelle un objet cr√©√© par l'une des m√©thodes statiques de la classe <code>BitmapDescriptorFactory</code> est <code>BitmapDescriptorFactory</code> . </p><br><p>  Et ici, en fait, une d√©ception m'attendait.  Comme 1c n'utilise pas cette activit√©, les classes correspondantes ont simplement √©t√© supprim√©es lors de la minification.  J'ai d√ª les restaurer, et c'√©tait douloureux et long.  Plus pr√©cis√©ment, les classes √©taient l√†, mais elles ont √©t√© renomm√©es et ne contenaient pas les m√©thodes n√©cessaires.  En s√©lectionnant les types de biblioth√®que compl√®te pour travailler avec les cartes - par des signatures et des constantes, j'ai d√©couvert la correspondance des classes de biblioth√®que avec les classes d'application, ajout√© les m√©thodes et les champs n√©cessaires, reconstruit, et j'√©tais heureux que cette qu√™te soit finalement termin√©e, car elle a finalement fonctionn√©, mais pas d√®s la premi√®re tentative (plusieurs fois tondu avec des signatures et des classes minifi√©es confuses). </p><br><div class="spoiler">  <b class="spoiler_title">Le r√©sultat (ext√©rieurement pas tr√®s impressionnant).</b>  <b class="spoiler_title">Deux points avec les coordonn√©es (45; 45) et (46; 46)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/pv/cz/lu/pvczlujpmwuu2y2bauzieeszkby.png"></p></div></div><br><p>  √âtant donn√© que le volume du code modifi√© est assez important - je ne l'inclurai pas dans l'article, je ne donnerai que des modifications de signature.  Si quelqu'un s'int√©resse √† toutes les modifications que j'ai apport√©es √† cette √©tape - vous pouvez regarder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans ce commit</a> . </p><br><pre> <code class="java hljs">   Lcom/google/android/gms/maps/model/MarkerOptions -   .<span class="hljs-function"><span class="hljs-function">method </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">icon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Lcom/google/android/gms/maps/model/a;)</span></span></span><span class="hljs-function">Lcom/google/android/gms/maps/model/MarkerOptions</span></span>;   com.google.android.gms.internal.fh   : <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zza</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>; <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zza</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>; <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zzb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>; <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zzi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>; <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zza</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>; <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zza</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bitmap)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>; <span class="hljs-function"><span class="hljs-function">b </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zzc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException</span></span>;   com.google.android.gms.internal.fj     h       com.google.android.gms.maps.model.b (BitmapDescriptorFactory)    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromResource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromAsset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defaultMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> a </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromBitmap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bitmap)</span></span></span><span class="hljs-function">      MapImplExtension.java   xk.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(new MarkerOptions()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(latlng)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"  "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> + titles[i])</span></span></span><span class="hljs-function">)</span></span>;     MarkerOptions markerOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarkerOptions() .c(latlng) .dS(<span class="hljs-string"><span class="hljs-string">"  "</span></span> + titles[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      markerOptions.icon(b.defaultMarker(b.HUE_YELLOW)); } xk.add(markerOptions);</span></span></code> </pre><br><p>  Pour r√©sumer - l'exp√©rience a √©t√© assez int√©ressante.  Du moins pour moi.  J'ai aid√© √† comprendre certains outils, j'ai appris un peu mieux le travail du format android et bytecode pour dalvik / art, l'exp√©rience de la s√©lection de code minifi√© serait √©galement utile (il y avait d√©j√† un cas o√π dans la version finale de R8 je coupais les champs de classe qui √©taient r√©ellement utilis√©s, √† l'√©poque uniquement par la m√©thode Je l'ai compris, maintenant cela ne causerait pas de probl√®mes). </p><br><p>  Si quelqu'un est int√©ress√© √† tout r√©p√©ter lui-m√™me et √©ventuellement √† le ramasser encore plus - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">j'ai post√© sur github</a> toutes les sources avec un script gradle tordu qui se construit √† partir de l'apk original modifi√©. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475266/">https://habr.com/ru/post/fr475266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475254/index.html">Architecture AERODISK vAIR ou caract√©ristiques de la construction d'un cluster national</a></li>
<li><a href="../fr475258/index.html">Une repr√©sentation visuelle des √©lections √† Saint-P√©tersbourg - la magie de l'habillage vocal</a></li>
<li><a href="../fr475260/index.html">La diff√©rence entre une fonction asynchrone et une fonction qui renvoie une promesse</a></li>
<li><a href="../fr475262/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 388 (4-10 novembre 2019)</a></li>
<li><a href="../fr475264/index.html">Des renifleurs qui pourraient: comment la famille FakeSecurity a infect√© les boutiques en ligne</a></li>
<li><a href="../fr475268/index.html">Param√©trage incertain comme m√©thode universelle pour construire l'architecture d'application en C ++ et Java pour un minimum. le prix</a></li>
<li><a href="../fr475270/index.html">SwiftUI: cr√©ation de sections extensibles / r√©ductibles en mode liste</a></li>
<li><a href="../fr475272/index.html">Migration vers une infrastructure d'attente asynchrone √† Rust</a></li>
<li><a href="../fr475276/index.html">Comment √©crire assert correctement</a></li>
<li><a href="../fr475280/index.html">Mots de passe Cisco, migration de zone DNS, z√©ro requ√™te LDAP, nous collectons des paquets Ethernet. R√©solution de probl√®mes sur un r√©seau avec r0ot-mi. 2e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>