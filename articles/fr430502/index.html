<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎲 🤱🏻 👩🏽‍🔬 Test de charge avec le criquet 🤲 🙅🏾 ✨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les tests de charge ne sont pas tant demandés et répandus que les autres types de tests - il n'y a pas tellement d'outils qui vous permettent d'effect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test de charge avec le criquet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/infopulse/blog/430502/">  Les tests de charge ne sont pas tant demandés et répandus que les autres types de tests - il n'y a pas tellement d'outils qui vous permettent d'effectuer de tels tests, mais généralement simples et pratiques peuvent être comptés sur les doigts d'une main. <br><br>  En ce qui concerne les tests de performances - tout d'abord, tout le monde pense à JMeter - il reste sans aucun doute l'outil le plus célèbre avec le plus grand nombre de plugins.  Je n'ai jamais aimé JMeter en raison de son interface non évidente et de son seuil d'entrée élevé, dès qu'il devient nécessaire de tester une application non Hello World. <br><br>  Et maintenant, inspiré par le succès des tests dans deux projets différents, j'ai décidé de partager des informations sur un logiciel relativement simple et pratique - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Locust</a> <br><br>  Pour ceux qui sont trop paresseux pour passer sous la coupe, j'ai enregistré une vidéo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ZYKIyyY1qvY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h2>  Qu'est ce que c'est </h2><br>  Outil open source qui vous permet de spécifier des scénarios de charge avec du code Python qui prend en charge la charge distribuée et, comme le prétendent les auteurs, a été utilisé pour tester la charge de Battlelog pour une série de jeux Battlefild (immédiatement captivant) <br><br>  Des pros: <br><br><ul><li>  documentation simple avec exemple copier-coller.  Vous pouvez commencer à tester, même sans presque aucune compétence en programmation. </li><li>  «Under the hood» utilise la bibliothèque de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">requêtes</a> (HTTP pour les personnes).  Sa documentation peut être utilisée comme un cheat sheet étendu et des tests de débits </li><li>  Prise en charge de Python - j'aime juste le langage </li><li>  Le paragraphe précédent donne plusieurs plates-formes pour exécuter des tests </li><li>  Propre serveur Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flask</a> pour afficher les résultats des tests </li></ul><br>  Des inconvénients: <br><br><ul><li>  Pas de capture et de relecture - toutes les mains </li><li>  Le résultat du paragraphe précédent - vous avez besoin d'un cerveau.  Comme pour Postman, vous devez comprendre le fonctionnement de HTTP. </li><li>  Compétences minimales en programmation nécessaires </li><li>  Modèle de charge linéaire - qui bouleverse immédiatement les fans pour générer des utilisateurs "selon Gauss" </li></ul><br><h2>  Processus de test </h2><br>  Tout test est une tâche complexe qui nécessite une planification, une préparation, un suivi de la mise en œuvre et une analyse des résultats.  Pendant les tests de résistance, si possible, il est possible et nécessaire de collecter toutes les données possibles susceptibles d'affecter le résultat: <br><br><ul><li>  Matériel serveur (CPU, RAM, ROM) </li><li>  Logiciel serveur (OS, version serveur, JAVA, .NET, etc., la base de données et la quantité de données elle-même, serveur et journaux des applications de test) </li><li>  Bande passante réseau </li><li>  La présence de serveurs proxy, d'équilibreurs de charge et de protection DDOS </li><li>  Charger les données de test (nombre d'utilisateurs, temps de réponse moyen, nombre de requêtes par seconde) </li></ul><br>  Les exemples décrits ci-dessous peuvent être classés comme des tests de charge fonctionnelle en boîte noire.  Même sans rien savoir de l'application testée et sans accès aux journaux, nous pouvons mesurer ses performances. <br><br><h2>  Avant de commencer </h2><br>  Afin de tester les tests de charge dans la pratique, j'ai déployé un serveur Web localement simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/typicode/json-server</a> .  Je vais lui donner presque tous les exemples suivants.  J'ai pris les données du serveur à partir d'un exemple en ligne déployé - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://jsonplaceholder.typicode.com/</a> <br>  Pour l'exécuter, nodeJS est requis. <br><br>  <b>Spoiler évident</b> : comme avec les tests de sécurité - il est préférable de mener des expériences avec des tests de stress sur les chats localement, sans charger les services en ligne pour ne pas être banni <br><br>  Pour commencer, Python est également requis - dans tous les exemples, j'utiliserai la version 3.6, ainsi que le criquet lui-même (au moment de la rédaction, la version 0.9.0).  Il peut être installé avec la commande <br><br><pre><code class="bash hljs">python -m pip install locustio</code> </pre> <br>  Les détails d'installation peuvent être trouvés dans la documentation officielle. <br><br><h2>  Analyser un exemple </h2><br>  Ensuite, nous avons besoin d'un fichier de test.  J'ai pris un exemple de la documentation, car il est très simple et direct: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.post(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.post(<span class="hljs-string"><span class="hljs-string">"/logout"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.get(<span class="hljs-string"><span class="hljs-string">"/profile"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> tasks = {index: <span class="hljs-number"><span class="hljs-number">2</span></span>, profile: <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> login(self) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> logout(self) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">5000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">9000</span></span></code> </pre> <br>  C’est tout!  C'est vraiment suffisant pour commencer le test!  Regardons un exemple avant de commencer. <br><br>  En sautant les importations, au tout début, nous voyons 2 fonctions de connexion et de déconnexion presque identiques, constituées d'une seule ligne.  <b>l.client</b> - un objet de session HTTP avec lequel nous allons créer une charge.  Nous utilisons la méthode POST, qui est presque identique à celle de la bibliothèque de requêtes.  Presque - parce que dans cet exemple, nous passons comme premier argument non pas une URL complète, mais seulement une partie de celle-ci - un service spécifique. <br><br>  Le deuxième argument transmet les données - et je ne peux m'empêcher de remarquer qu'il est très pratique d'utiliser des dictionnaires Python, qui sont automatiquement convertis en json <br><br>  Vous pouvez également noter que nous ne traitons en aucun cas le résultat de la demande - si elle réussit, les résultats (par exemple, les cookies) seront enregistrés dans cette session.  Si une erreur se produit, elle sera enregistrée et ajoutée aux statistiques sur la charge. <br><br>  Si nous voulons savoir si nous avons correctement écrit la demande, nous pouvons toujours la vérifier comme suit: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> r response=r.post(base_url+<span class="hljs-string"><span class="hljs-string">"/login"</span></span>,{<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>,<span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) print(response.status_code)</code> </pre> <br>  J'ai ajouté uniquement la variable <b>base_url</b> , qui devrait contenir l'adresse complète de la ressource testée. <br><br>  Les fonctions suivantes sont des requêtes, qui créeront une charge.  Encore une fois, nous n'avons pas besoin de traiter la réponse du serveur - les résultats iront immédiatement aux statistiques. <br><br>  Vient ensuite la classe <b>UserBehavior</b> (le nom de la classe peut être n'importe lequel).  Comme son nom l'indique, il décrira le comportement d'un utilisateur sphérique dans le vide de l'application testée.  Nous passons à la propriété des <b>tâches</b> un dictionnaire de méthodes que l'utilisateur appellera et leur fréquence d'appels.  Maintenant, malgré le fait que nous ne savons pas quelle fonction et dans quel ordre chaque utilisateur appellera - ils sont sélectionnés au hasard, nous garantissons que la fonction d' <b>index</b> sera appelée en moyenne 2 fois plus souvent que la fonction de <b>profil</b> . <br><br>  En plus du comportement, la classe parent TaskSet vous permet de spécifier 4 fonctions qui peuvent être effectuées avant et après les tests.  L'ordre des appels sera le suivant: <br><br><ol><li>  <b>setup</b> - est appelé 1 fois au début de <b>UserBehavior (TaskSet)</b> - ce n'est pas dans l'exemple </li><li>  <b>on_start</b> - appelé 1 fois par chaque nouvel utilisateur de la charge au démarrage </li><li>  <b>tâches</b> - exécution des tâches elles-mêmes </li><li>  <b>on_stop</b> - appelé une fois par chaque utilisateur une fois le test terminé </li><li>  <b>démontage</b> - est appelé 1 fois à la <b>sortie</b> du <b>TaskSet</b> - il n'est pas non plus dans l'exemple </li></ol><br>  Il convient de mentionner ici qu'il existe 2 façons de déclarer le comportement de l'utilisateur: la première est déjà indiquée dans l'exemple ci-dessus - les fonctions sont annoncées à l'avance.  La deuxième façon consiste à déclarer des méthodes directement dans la classe <b>UserBehavior</b> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.post(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.post(<span class="hljs-string"><span class="hljs-string">"/logout"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/profile"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">5000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">9000</span></span></code> </pre> <br>  Dans cet exemple, les fonctions utilisateur et la fréquence de leur appel sont définies à l'aide de l'annotation de <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">tâche</a></b> .  Fonctionnellement, rien n'a changé. <br><br>  La dernière classe de l'exemple est <b>WebsiteUser</b> (le nom de la classe peut être quelconque).  Dans cette classe, nous définissons le modèle de comportement utilisateur <b>UserBehavior</b> *** +, ainsi que les temps d'attente minimum et maximum entre les appels à des tâches individuelles par chaque utilisateur.  Pour le rendre plus clair, voici comment le visualiser: <br><br><img src="https://habrastorage.org/webt/mv/ss/7j/mvss7jfvob_tufawwbx-41w6i8y.png"><br><br><h2>  Pour commencer </h2><br>  Exécutez le serveur dont nous testerons les performances: <br><br><pre> <code class="bash hljs">json-server --watch sample_server/db.json</code> </pre> <br>  Nous modifions également le fichier d'exemple pour qu'il puisse tester le service, supprimer la connexion et la déconnexion, définir le comportement de l'utilisateur: <br><br><ol><li>  Ouvrez la page principale 1 fois au début du travail </li><li>  Obtenez une liste de tous les messages x2 </li><li>  Rédiger un commentaire sur le premier message x1 </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> data = { <span class="hljs-string"><span class="hljs-string">"postId"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"my comment"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"test@user.habr"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"Author is cool. Some text. Hello world!"</span></span> } self.client.post(<span class="hljs-string"><span class="hljs-string">"/comments"</span></span>, data) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre><br>  Pour démarrer à l'invite de commandes, exécutez la commande <br><br><pre> <code class="bash hljs">locust -f my_locust_file.py --host=http://localhost:3000</code> </pre> <br>  où hôte est l'adresse de la ressource testée.  C'est à lui que seront ajoutées les adresses de services indiquées dans le test. <br><br>  S'il n'y a aucune erreur dans le test, le serveur de chargement démarrera et sera disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8089 /</a> <br><br><img src="https://habrastorage.org/webt/p9/km/lc/p9kmlc3hqgi3_gupjrvkhduhl2a.png"><br><br>  Comme vous pouvez le voir, le serveur que nous allons tester est indiqué ici - c'est à cette URL que seront ajoutées les adresses des services du fichier de test. <br><br>  Ici aussi, nous pouvons indiquer le nombre d'utilisateurs pour la charge et leur croissance par seconde. <br>  Sur le bouton, on démarre la charge! <br><br><img src="https://habrastorage.org/webt/di/d8/xt/did8xtea9mlpfzzxwlfq1lcofne.png"><br><br><h2>  Résultats </h2><br>  Après un certain temps, nous arrêtons le test et examinons les premiers résultats: <br><br><ol><li>  Comme prévu, chacun des 10 utilisateurs créés au début est allé à la page principale </li><li>  La liste des articles a été ouverte en moyenne 2 fois plus souvent qu'un commentaire n'a été écrit </li><li>  Il y a un temps de réponse moyen et médian pour chaque opération, le nombre d'opérations par seconde est déjà des données utiles, même si maintenant les prendre et les comparer avec le résultat attendu des exigences </li></ol><br>  Sur le deuxième onglet, vous pouvez voir les graphiques de charge en temps réel.  Si le serveur plante à une certaine charge ou si son comportement change, cela sera immédiatement visible sur le graphique. <br><br><img src="https://habrastorage.org/webt/qm/ym/pd/qmympdj2picpcms6mkdb7eonenu.png"><br><br>  Sur le troisième onglet, vous pouvez voir les erreurs - dans mon cas, il s'agit d'une erreur client.  Mais si le serveur renvoie une erreur 4XX ou 5XX, son texte sera écrit ici <br>  Si une erreur se produit dans le code de votre texte, elle tombera dans l'onglet Exceptions.  Jusqu'à présent, j'ai l'erreur la plus courante liée à l'utilisation de la commande print () dans le code - ce n'est pas la meilleure façon de se connecter :) <br><br>  Sur le dernier onglet, vous pouvez télécharger tous les résultats des tests au format csv <br><br>  Ces résultats sont-ils pertinents?  Voyons cela.  Le plus souvent, les exigences de performances (le cas échéant) sont similaires à ceci: le temps de chargement moyen des pages (réponse du serveur) doit être inférieur à N secondes avec une charge de M utilisateurs.  Ne spécifiant pas vraiment ce que les utilisateurs doivent faire.  Et j'aime le criquet pour cela - cela crée l'activité d'un nombre spécifique d'utilisateurs qui effectuent au hasard les actions attendues qu'ils attendent des utilisateurs. <br><br>  Si nous devons effectuer un benchmark - pour mesurer le comportement du système à différentes charges, nous pouvons créer plusieurs classes de comportement et effectuer plusieurs tests à différentes charges. <br><br>  C'est suffisant pour commencer.  Si vous avez aimé l'article, j'ai l'intention d'écrire sur: <br><br><ul><li>  scénarios de test complexes dans lesquels les résultats d'une étape sont utilisés dans les éléments suivants </li><li>  traitement des réponses du serveur, comme  cela peut être faux même si HTTP 200 OK est arrivé </li><li>  difficultés évidentes qui peuvent être rencontrées et comment les contourner </li><li>  tester sans utiliser l'interface utilisateur </li><li>  test de charge distribuée </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430502/">https://habr.com/ru/post/fr430502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430492/index.html">Intel Neural Compute Stick. Esprit artificiel sur une clé USB - 2</a></li>
<li><a href="../fr430494/index.html">InfoWatch Traffic Monitor. Au bord des bugs et des fonctionnalités</a></li>
<li><a href="../fr430496/index.html">NB-IoT: comment ça marche? Partie 1</a></li>
<li><a href="../fr430498/index.html">Contourner le contrôle de compte d'utilisateur (UAC) en imitant les répertoires approuvés</a></li>
<li><a href="../fr430500/index.html">Éviter le chaos de la base de connaissances d'entreprise: notre expérience Confluence</a></li>
<li><a href="../fr430504/index.html">Méthodes de pensée junior et rationnelle</a></li>
<li><a href="../fr430506/index.html">Art sombre de la résurrection: comment récupérer des données à partir de supports endommagés</a></li>
<li><a href="../fr430508/index.html">DevOps: qu'est-ce que c'est vraiment</a></li>
<li><a href="../fr430510/index.html">Comment écrire du code que tout le monde comprendra?</a></li>
<li><a href="../fr430512/index.html">Comment vivent les pigistes: ne travaillez pas avec des clients omniscients et laissez-vous tergiverser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>