<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≤ ü§±üèª üë©üèΩ‚Äçüî¨ Test de charge avec le criquet ü§≤ üôÖüèæ ‚ú®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les tests de charge ne sont pas tant demand√©s et r√©pandus que les autres types de tests - il n'y a pas tellement d'outils qui vous permettent d'effect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test de charge avec le criquet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/infopulse/blog/430502/">  Les tests de charge ne sont pas tant demand√©s et r√©pandus que les autres types de tests - il n'y a pas tellement d'outils qui vous permettent d'effectuer de tels tests, mais g√©n√©ralement simples et pratiques peuvent √™tre compt√©s sur les doigts d'une main. <br><br>  En ce qui concerne les tests de performances - tout d'abord, tout le monde pense √† JMeter - il reste sans aucun doute l'outil le plus c√©l√®bre avec le plus grand nombre de plugins.  Je n'ai jamais aim√© JMeter en raison de son interface non √©vidente et de son seuil d'entr√©e √©lev√©, d√®s qu'il devient n√©cessaire de tester une application non Hello World. <br><br>  Et maintenant, inspir√© par le succ√®s des tests dans deux projets diff√©rents, j'ai d√©cid√© de partager des informations sur un logiciel relativement simple et pratique - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Locust</a> <br><br>  Pour ceux qui sont trop paresseux pour passer sous la coupe, j'ai enregistr√© une vid√©o: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ZYKIyyY1qvY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h2>  Qu'est ce que c'est </h2><br>  Outil open source qui vous permet de sp√©cifier des sc√©narios de charge avec du code Python qui prend en charge la charge distribu√©e et, comme le pr√©tendent les auteurs, a √©t√© utilis√© pour tester la charge de Battlelog pour une s√©rie de jeux Battlefild (imm√©diatement captivant) <br><br>  Des pros: <br><br><ul><li>  documentation simple avec exemple copier-coller.  Vous pouvez commencer √† tester, m√™me sans presque aucune comp√©tence en programmation. </li><li>  ¬´Under the hood¬ª utilise la biblioth√®que de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">requ√™tes</a> (HTTP pour les personnes).  Sa documentation peut √™tre utilis√©e comme un cheat sheet √©tendu et des tests de d√©bits </li><li>  Prise en charge de Python - j'aime juste le langage </li><li>  Le paragraphe pr√©c√©dent donne plusieurs plates-formes pour ex√©cuter des tests </li><li>  Propre serveur Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flask</a> pour afficher les r√©sultats des tests </li></ul><br>  Des inconv√©nients: <br><br><ul><li>  Pas de capture et de relecture - toutes les mains </li><li>  Le r√©sultat du paragraphe pr√©c√©dent - vous avez besoin d'un cerveau.  Comme pour Postman, vous devez comprendre le fonctionnement de HTTP. </li><li>  Comp√©tences minimales en programmation n√©cessaires </li><li>  Mod√®le de charge lin√©aire - qui bouleverse imm√©diatement les fans pour g√©n√©rer des utilisateurs "selon Gauss" </li></ul><br><h2>  Processus de test </h2><br>  Tout test est une t√¢che complexe qui n√©cessite une planification, une pr√©paration, un suivi de la mise en ≈ìuvre et une analyse des r√©sultats.  Pendant les tests de r√©sistance, si possible, il est possible et n√©cessaire de collecter toutes les donn√©es possibles susceptibles d'affecter le r√©sultat: <br><br><ul><li>  Mat√©riel serveur (CPU, RAM, ROM) </li><li>  Logiciel serveur (OS, version serveur, JAVA, .NET, etc., la base de donn√©es et la quantit√© de donn√©es elle-m√™me, serveur et journaux des applications de test) </li><li>  Bande passante r√©seau </li><li>  La pr√©sence de serveurs proxy, d'√©quilibreurs de charge et de protection DDOS </li><li>  Charger les donn√©es de test (nombre d'utilisateurs, temps de r√©ponse moyen, nombre de requ√™tes par seconde) </li></ul><br>  Les exemples d√©crits ci-dessous peuvent √™tre class√©s comme des tests de charge fonctionnelle en bo√Æte noire.  M√™me sans rien savoir de l'application test√©e et sans acc√®s aux journaux, nous pouvons mesurer ses performances. <br><br><h2>  Avant de commencer </h2><br>  Afin de tester les tests de charge dans la pratique, j'ai d√©ploy√© un serveur Web localement simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/typicode/json-server</a> .  Je vais lui donner presque tous les exemples suivants.  J'ai pris les donn√©es du serveur √† partir d'un exemple en ligne d√©ploy√© - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://jsonplaceholder.typicode.com/</a> <br>  Pour l'ex√©cuter, nodeJS est requis. <br><br>  <b>Spoiler √©vident</b> : comme avec les tests de s√©curit√© - il est pr√©f√©rable de mener des exp√©riences avec des tests de stress sur les chats localement, sans charger les services en ligne pour ne pas √™tre banni <br><br>  Pour commencer, Python est √©galement requis - dans tous les exemples, j'utiliserai la version 3.6, ainsi que le criquet lui-m√™me (au moment de la r√©daction, la version 0.9.0).  Il peut √™tre install√© avec la commande <br><br><pre><code class="bash hljs">python -m pip install locustio</code> </pre> <br>  Les d√©tails d'installation peuvent √™tre trouv√©s dans la documentation officielle. <br><br><h2>  Analyser un exemple </h2><br>  Ensuite, nous avons besoin d'un fichier de test.  J'ai pris un exemple de la documentation, car il est tr√®s simple et direct: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.post(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.post(<span class="hljs-string"><span class="hljs-string">"/logout"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l)</span></span></span><span class="hljs-function">:</span></span> l.client.get(<span class="hljs-string"><span class="hljs-string">"/profile"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> tasks = {index: <span class="hljs-number"><span class="hljs-number">2</span></span>, profile: <span class="hljs-number"><span class="hljs-number">1</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> login(self) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> logout(self) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">5000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">9000</span></span></code> </pre> <br>  C‚Äôest tout!  C'est vraiment suffisant pour commencer le test!  Regardons un exemple avant de commencer. <br><br>  En sautant les importations, au tout d√©but, nous voyons 2 fonctions de connexion et de d√©connexion presque identiques, constitu√©es d'une seule ligne.  <b>l.client</b> - un objet de session HTTP avec lequel nous allons cr√©er une charge.  Nous utilisons la m√©thode POST, qui est presque identique √† celle de la biblioth√®que de requ√™tes.  Presque - parce que dans cet exemple, nous passons comme premier argument non pas une URL compl√®te, mais seulement une partie de celle-ci - un service sp√©cifique. <br><br>  Le deuxi√®me argument transmet les donn√©es - et je ne peux m'emp√™cher de remarquer qu'il est tr√®s pratique d'utiliser des dictionnaires Python, qui sont automatiquement convertis en json <br><br>  Vous pouvez √©galement noter que nous ne traitons en aucun cas le r√©sultat de la demande - si elle r√©ussit, les r√©sultats (par exemple, les cookies) seront enregistr√©s dans cette session.  Si une erreur se produit, elle sera enregistr√©e et ajout√©e aux statistiques sur la charge. <br><br>  Si nous voulons savoir si nous avons correctement √©crit la demande, nous pouvons toujours la v√©rifier comme suit: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> r response=r.post(base_url+<span class="hljs-string"><span class="hljs-string">"/login"</span></span>,{<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>,<span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) print(response.status_code)</code> </pre> <br>  J'ai ajout√© uniquement la variable <b>base_url</b> , qui devrait contenir l'adresse compl√®te de la ressource test√©e. <br><br>  Les fonctions suivantes sont des requ√™tes, qui cr√©eront une charge.  Encore une fois, nous n'avons pas besoin de traiter la r√©ponse du serveur - les r√©sultats iront imm√©diatement aux statistiques. <br><br>  Vient ensuite la classe <b>UserBehavior</b> (le nom de la classe peut √™tre n'importe lequel).  Comme son nom l'indique, il d√©crira le comportement d'un utilisateur sph√©rique dans le vide de l'application test√©e.  Nous passons √† la propri√©t√© des <b>t√¢ches</b> un dictionnaire de m√©thodes que l'utilisateur appellera et leur fr√©quence d'appels.  Maintenant, malgr√© le fait que nous ne savons pas quelle fonction et dans quel ordre chaque utilisateur appellera - ils sont s√©lectionn√©s au hasard, nous garantissons que la fonction d' <b>index</b> sera appel√©e en moyenne 2 fois plus souvent que la fonction de <b>profil</b> . <br><br>  En plus du comportement, la classe parent TaskSet vous permet de sp√©cifier 4 fonctions qui peuvent √™tre effectu√©es avant et apr√®s les tests.  L'ordre des appels sera le suivant: <br><br><ol><li>  <b>setup</b> - est appel√© 1 fois au d√©but de <b>UserBehavior (TaskSet)</b> - ce n'est pas dans l'exemple </li><li>  <b>on_start</b> - appel√© 1 fois par chaque nouvel utilisateur de la charge au d√©marrage </li><li>  <b>t√¢ches</b> - ex√©cution des t√¢ches elles-m√™mes </li><li>  <b>on_stop</b> - appel√© une fois par chaque utilisateur une fois le test termin√© </li><li>  <b>d√©montage</b> - est appel√© 1 fois √† la <b>sortie</b> du <b>TaskSet</b> - il n'est pas non plus dans l'exemple </li></ol><br>  Il convient de mentionner ici qu'il existe 2 fa√ßons de d√©clarer le comportement de l'utilisateur: la premi√®re est d√©j√† indiqu√©e dans l'exemple ci-dessus - les fonctions sont annonc√©es √† l'avance.  La deuxi√®me fa√ßon consiste √† d√©clarer des m√©thodes directement dans la classe <b>UserBehavior</b> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.post(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.post(<span class="hljs-string"><span class="hljs-string">"/logout"</span></span>, {<span class="hljs-string"><span class="hljs-string">"username"</span></span>:<span class="hljs-string"><span class="hljs-string">"ellen_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"education"</span></span>}) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/profile"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">5000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">9000</span></span></code> </pre> <br>  Dans cet exemple, les fonctions utilisateur et la fr√©quence de leur appel sont d√©finies √† l'aide de l'annotation de <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">t√¢che</a></b> .  Fonctionnellement, rien n'a chang√©. <br><br>  La derni√®re classe de l'exemple est <b>WebsiteUser</b> (le nom de la classe peut √™tre quelconque).  Dans cette classe, nous d√©finissons le mod√®le de comportement utilisateur <b>UserBehavior</b> *** +, ainsi que les temps d'attente minimum et maximum entre les appels √† des t√¢ches individuelles par chaque utilisateur.  Pour le rendre plus clair, voici comment le visualiser: <br><br><img src="https://habrastorage.org/webt/mv/ss/7j/mvss7jfvob_tufawwbx-41w6i8y.png"><br><br><h2>  Pour commencer </h2><br>  Ex√©cutez le serveur dont nous testerons les performances: <br><br><pre> <code class="bash hljs">json-server --watch sample_server/db.json</code> </pre> <br>  Nous modifions √©galement le fichier d'exemple pour qu'il puisse tester le service, supprimer la connexion et la d√©connexion, d√©finir le comportement de l'utilisateur: <br><br><ol><li>  Ouvrez la page principale 1 fois au d√©but du travail </li><li>  Obtenez une liste de tous les messages x2 </li><li>  R√©diger un commentaire sur le premier message x1 </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> data = { <span class="hljs-string"><span class="hljs-string">"postId"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"my comment"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"test@user.habr"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"Author is cool. Some text. Hello world!"</span></span> } self.client.post(<span class="hljs-string"><span class="hljs-string">"/comments"</span></span>, data) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre><br>  Pour d√©marrer √† l'invite de commandes, ex√©cutez la commande <br><br><pre> <code class="bash hljs">locust -f my_locust_file.py --host=http://localhost:3000</code> </pre> <br>  o√π h√¥te est l'adresse de la ressource test√©e.  C'est √† lui que seront ajout√©es les adresses de services indiqu√©es dans le test. <br><br>  S'il n'y a aucune erreur dans le test, le serveur de chargement d√©marrera et sera disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8089 /</a> <br><br><img src="https://habrastorage.org/webt/p9/km/lc/p9kmlc3hqgi3_gupjrvkhduhl2a.png"><br><br>  Comme vous pouvez le voir, le serveur que nous allons tester est indiqu√© ici - c'est √† cette URL que seront ajout√©es les adresses des services du fichier de test. <br><br>  Ici aussi, nous pouvons indiquer le nombre d'utilisateurs pour la charge et leur croissance par seconde. <br>  Sur le bouton, on d√©marre la charge! <br><br><img src="https://habrastorage.org/webt/di/d8/xt/did8xtea9mlpfzzxwlfq1lcofne.png"><br><br><h2>  R√©sultats </h2><br>  Apr√®s un certain temps, nous arr√™tons le test et examinons les premiers r√©sultats: <br><br><ol><li>  Comme pr√©vu, chacun des 10 utilisateurs cr√©√©s au d√©but est all√© √† la page principale </li><li>  La liste des articles a √©t√© ouverte en moyenne 2 fois plus souvent qu'un commentaire n'a √©t√© √©crit </li><li>  Il y a un temps de r√©ponse moyen et m√©dian pour chaque op√©ration, le nombre d'op√©rations par seconde est d√©j√† des donn√©es utiles, m√™me si maintenant les prendre et les comparer avec le r√©sultat attendu des exigences </li></ol><br>  Sur le deuxi√®me onglet, vous pouvez voir les graphiques de charge en temps r√©el.  Si le serveur plante √† une certaine charge ou si son comportement change, cela sera imm√©diatement visible sur le graphique. <br><br><img src="https://habrastorage.org/webt/qm/ym/pd/qmympdj2picpcms6mkdb7eonenu.png"><br><br>  Sur le troisi√®me onglet, vous pouvez voir les erreurs - dans mon cas, il s'agit d'une erreur client.  Mais si le serveur renvoie une erreur 4XX ou 5XX, son texte sera √©crit ici <br>  Si une erreur se produit dans le code de votre texte, elle tombera dans l'onglet Exceptions.  Jusqu'√† pr√©sent, j'ai l'erreur la plus courante li√©e √† l'utilisation de la commande print () dans le code - ce n'est pas la meilleure fa√ßon de se connecter :) <br><br>  Sur le dernier onglet, vous pouvez t√©l√©charger tous les r√©sultats des tests au format csv <br><br>  Ces r√©sultats sont-ils pertinents?  Voyons cela.  Le plus souvent, les exigences de performances (le cas √©ch√©ant) sont similaires √† ceci: le temps de chargement moyen des pages (r√©ponse du serveur) doit √™tre inf√©rieur √† N secondes avec une charge de M utilisateurs.  Ne sp√©cifiant pas vraiment ce que les utilisateurs doivent faire.  Et j'aime le criquet pour cela - cela cr√©e l'activit√© d'un nombre sp√©cifique d'utilisateurs qui effectuent au hasard les actions attendues qu'ils attendent des utilisateurs. <br><br>  Si nous devons effectuer un benchmark - pour mesurer le comportement du syst√®me √† diff√©rentes charges, nous pouvons cr√©er plusieurs classes de comportement et effectuer plusieurs tests √† diff√©rentes charges. <br><br>  C'est suffisant pour commencer.  Si vous avez aim√© l'article, j'ai l'intention d'√©crire sur: <br><br><ul><li>  sc√©narios de test complexes dans lesquels les r√©sultats d'une √©tape sont utilis√©s dans les √©l√©ments suivants </li><li>  traitement des r√©ponses du serveur, comme  cela peut √™tre faux m√™me si HTTP 200 OK est arriv√© </li><li>  difficult√©s √©videntes qui peuvent √™tre rencontr√©es et comment les contourner </li><li>  tester sans utiliser l'interface utilisateur </li><li>  test de charge distribu√©e </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430502/">https://habr.com/ru/post/fr430502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430492/index.html">Intel Neural Compute Stick. Esprit artificiel sur une cl√© USB - 2</a></li>
<li><a href="../fr430494/index.html">InfoWatch Traffic Monitor. Au bord des bugs et des fonctionnalit√©s</a></li>
<li><a href="../fr430496/index.html">NB-IoT: comment √ßa marche? Partie 1</a></li>
<li><a href="../fr430498/index.html">Contourner le contr√¥le de compte d'utilisateur (UAC) en imitant les r√©pertoires approuv√©s</a></li>
<li><a href="../fr430500/index.html">√âviter le chaos de la base de connaissances d'entreprise: notre exp√©rience Confluence</a></li>
<li><a href="../fr430504/index.html">M√©thodes de pens√©e junior et rationnelle</a></li>
<li><a href="../fr430506/index.html">Art sombre de la r√©surrection: comment r√©cup√©rer des donn√©es √† partir de supports endommag√©s</a></li>
<li><a href="../fr430508/index.html">DevOps: qu'est-ce que c'est vraiment</a></li>
<li><a href="../fr430510/index.html">Comment √©crire du code que tout le monde comprendra?</a></li>
<li><a href="../fr430512/index.html">Comment vivent les pigistes: ne travaillez pas avec des clients omniscients et laissez-vous tergiverser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>