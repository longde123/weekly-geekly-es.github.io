<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòØ üÖ∞Ô∏è üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ D√©ploiement automatique de fonctions sans serveur depuis Git ü§òüèæ üë®üèª‚Äçüíº üîû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En utilisant le bot gitlab comme exemple, je montrerai comment automatiser le processus de publication des fonctions sans serveur en les mettant autom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©ploiement automatique de fonctions sans serveur depuis Git</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rusonyx/blog/439920/"><img src="https://habrastorage.org/webt/l-/2e/f7/l-2ef7pv_cpsvc8_t3svqrwm_jm.png" alt="image"><br><br>  En utilisant le bot gitlab comme exemple, je montrerai comment automatiser le processus de publication des fonctions sans serveur en les mettant automatiquement √† jour √† partir du r√©f√©rentiel git.  On passe des jeux au d√©veloppement pratique sur serveur sans serveur. <a name="habracut"></a><br><br><h3>  Qu'est-ce qu'un bot gitlab? </h3><br>  Imaginez que vous ayez besoin d'automatiser le processus de r√©action pour cr√©er des t√¢ches / bugs dans votre tracker, par exemple Gitlab (Issues) ou Jira.  Vous devrez peut-√™tre ajouter automatiquement un artiste en fonction des balises, d√©placer la t√¢che vers un jalon sp√©cifique, ajouter un commentaire ou simplement fermer un bug ind√©sirable.  Tout cela se fait tr√®s facilement en utilisant des fonctions sans serveur.  Par exemple, nous ajouterons un commentaire (note dans la terminologie Gitlab) √† une t√¢che nouvellement cr√©√©e (probl√®me). <br><br>  Et comme le bot peut changer fr√©quemment, nous automatiserons sa publication en synchronisant automatiquement la fonction avec le r√©f√©rentiel git o√π il se trouve. <br><br><h3>  R√©glage de l'environnement </h3><br>  Nous devons d'abord cr√©er un projet sur Gitlab.  Si vous n'avez pas de compte Gitlab, vous pouvez en cr√©er un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Vous pouvez cr√©er un nouveau projet public, par exemple, en for√ßant mon projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://gitlab.com/bbelky/gitbotswf</a> en cliquant sur le bouton <b>Fork</b> dans le coin sup√©rieur droit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qc/7w/xx/qc7wxxt0399rb2of3zusdpkegc0.png" alt="image"></div><br>  Pour pouvoir modifier le code du bot, vous devez le cloner localement.  En fait, pour les besoins de ce guide, nous pouvons le faire en ligne, mais nous serons plus proches de la vie r√©elle.  Ouvrez votre terminal et clonez le r√©f√©rentiel git.  Le lien se trouve dans le coin sup√©rieur droit de votre projet <b>Clone</b> &gt; <b>Clone with HTTPS</b> .  Enregistrez-le comme <i>URL Gitlab</i> , il nous sera toujours utile. <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> &lt;link to your repo&gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gitbotswf/ ls README.md main.go</code> </pre> <br>  Il existe un fichier main.go dans le r√©f√©rentiel clon√©.  Ceci est notre bot √©crit en golang.  Le bot est tr√®s simple: il re√ßoit un webhook de Gitlab sur l'√©v√©nement de la cr√©ation d'une nouvelle t√¢che (Issue) et ajoute un commentaire (note dans la terminologie Gitlab) √† la t√¢che cr√©√©e.  Il y a des commentaires dans main.go pour vous aider √† comprendre comment fonctionne le bot.  Nous n'y reviendrons pas plus en d√©tail. <br><br>  Ne fermez pas le terminal - un peu plus tard, nous devrons modifier le fichier <i>main.go.</i> <br><br>  Nous devons √©galement cr√©er l'API Gitlab Token pour acc√©der √† l'API hitlab. <br><br><ol><li>  Acc√©dez √† votre profil Gitlab&gt; <b>Param√®tres</b> &gt; <b>Jetons d'acc√®s.</b> </li><li>  Cr√©ez un nouveau jeton avec une port√©e API. </li><li>  Copiez-le et enregistrez-le sous <i>GITLABTOKEN</i> . </li></ol><br><h3>  Le bot </h3><br>  Il est temps de cr√©er le bot lui-m√™me.  Cr√©ons une fonction sans serveur avec le code de notre bot bas√© sur la plateforme sans serveur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Swifty</a> .  Si vous n'avez pas encore de compte sur Rusonyx Swifty, il est temps d'en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©er un</a> .  Nous voulons automatiser le processus de d√©ploiement d'une nouvelle fonction, alors faisons la s√©quence suivante: connectez notre r√©f√©rentiel git, cr√©ez une fonction bas√©e sur le code du git, et placez le token api gitlab dans un magasin s√©curis√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5b/hx/lg/5bhxlgenzy54-ah5z3ynwu7unhq.png" alt="image"></div><br><ol><li>  Connectez-vous √† Swifty et s√©lectionnez <b>R√©f√©rentiels</b> </li><li>  Cliquez sur <b>Attach Repo</b> , s√©lectionnez le type d' <b>URL Git</b> et collez votre <i>URL Gitlab</i> . </li><li>  N'oubliez pas de s√©lectionner automatiquement l'option R√©f√©rentiel miroir et cliquez sur Termin√©. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9m/s2/lp/9ms2lps7qejn9txqu6boa5r5zly.png" alt="image" width="400" height="233"></div><br>  Maintenant, Swifty se synchronisera automatiquement avec votre r√©f√©rentiel (faites git pull) toutes les 30 minutes.  Cr√©ez maintenant la fonction elle-m√™me: <br><br><ol><li>  Acc√©dez √† l'onglet <b>Fonctions</b> &gt; <b>Nouvelle fonction</b> &gt; <b>Du r√©f√©rentiel (mod√®les)</b> . </li><li>  S√©lectionnez le r√©f√©rentiel nouvellement ajout√©, par exemple, <i><a href="">gitlab.com/bbelky/gitbotswf.git</a></i> .  Vous voyez maintenant les fichiers de votre r√©f√©rentiel. </li><li>  S√©lectionnez le fichier <i>main.go</i> , cliquez sur Suivant. </li><li>  S√©lectionnez l'option <b>Synchroniser avec le r√©f√©rentiel</b> , entrez le nom de la fonction <i>gitbotswf</i> et cliquez sur <b>Cr√©er</b> . </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tf/xk/a3/tfxka3smbke9wx6tfzr6djlpm3g.png" alt="image"></div><br>  Maintenant, nous avons besoin d'un d√©clencheur API HTTP, lorsqu'elle est appel√©e, la fonction se d√©clenche: <br><br><ol><li>  Acc√©dez √† l'onglet <b>D√©clencheurs</b> &gt; <b>Ajouter un d√©clencheur</b> &gt; <b>API REST (URL)</b> . </li><li>  Copiez l'URL r√©sultante et enregistrez-la sous <i>BOT_URL</i> . </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/nv/8l/obnv8lijs7rvetcb2gbj6lb7_ho.png" alt="image"></div><br>  Tr√®s bien, nous avons maintenant un r√©f√©rentiel et une fonction qui se synchronise automatiquement avec lui.  Ajoutez maintenant notre jeton API Gitlab aux comptes Swifty - un r√©f√©rentiel s√©curis√© et crypt√© pour les mots de passe et les jetons. <br><br><ol><li>  Acc√©dez √† <b>Comptes</b> &gt; <b>Cr√©er un compte</b> . </li><li>  S√©lectionnez un type <b>g√©n√©rique</b> . </li><li>  Nommez <i>GITLABTOKEN</i> et copiez votre jeton.  Enregistrez. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vb/sj/63/vbsj63gl3bssog5ilr9fs2apvzu.png" alt="image" width="400" height="233"></div><br>  Ajoutez maintenant le jeton √† la fonction: <br><br><ol><li>  Acc√©dez √† <b>Fonctions</b> &gt; <b>Fonction</b> <i>gitbotswf</i> &gt; <b>Acc√®s</b> et cliquez sur <b>Ajouter</b> . </li><li>  S√©lectionnez le type <b>Comptes</b> , <b>GITLABTOKEN</b> et cliquez sur <b>Ajouter</b> . </li></ol><br><h3>  Activer le webhook </h3><br>  √Ä la derni√®re √©tape, nous devons cr√©er un webhook sur Gitlab qui se d√©clenchera chaque fois qu'un nouveau probl√®me est cr√©√©.  Passons √† Gitlab. <br><br><ol><li>  S√©lectionnez votre projet&gt; <b>Param√®tres</b> &gt; <b>Int√©grations</b> . </li><li>  Ajoutez le <i>BOT_URL</i> pr√©c√©demment enregistr√© dans le champ <b>URL</b> . </li><li>  Cochez la case en <b>regard des</b> <i>√©v√©nements de probl√®mes</i> et cliquez sur <b>Ajouter un webhook</b> . </li></ol><br><h3>  Test </h3><br>  Passons au projet sur Gitlab, dans l'onglet <b>Probl√®mes</b> et cr√©ons un nouveau <b>probl√®me</b> .  V√©rifiez les commentaires.  Ouais!  Si tout a bien fonctionn√©, nous verrons le commentaire <i>"Merci d'avoir signal√© un nouveau probl√®me!"</i>  .  Si une erreur s'est produite quelque part, demandez-nous ici ou posez une question dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">emplacement</a> . <br><br><h3>  Mise √† jour et lib√©ration automatique du bot </h3><br>  Et si nous devons mettre √† jour notre bot?  Gr√¢ce √† l'int√©gration avec git, il vous suffit de mettre √† jour votre code (changez le texte de la note par exemple), lancez le code dans Gitlab et Swifty mettra automatiquement √† jour votre fonction! <br><br>  Alors, ouvrez le fichier <i>main.go</i> dans le terminal et changez la variable <i>note</i> : <br><br><pre> <code class="go hljs">note := <span class="hljs-string"><span class="hljs-string">"Comments%20changed!"</span></span></code> </pre> <br>  Mettre √† jour git: <br><br><pre> <code class="bash hljs">git add * git commit -m <span class="hljs-string"><span class="hljs-string">"changes"</span></span> git push origin master</code> </pre> <br>  Allez sans serveur! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439920/">https://habr.com/ru/post/fr439920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439910/index.html">Le Digital Rights Center invite √† la Journ√©e de la confidentialit√© 2019</a></li>
<li><a href="../fr439912/index.html">Myst√®re de la vue non r√©solu</a></li>
<li><a href="../fr439914/index.html">Organisation des r√©ducteurs - aller plus loin</a></li>
<li><a href="../fr439916/index.html">D√©ballage: Dridex bootloader</a></li>
<li><a href="../fr439918/index.html">Sur la montagne se dresse Spring Boot ...</a></li>
<li><a href="../fr439922/index.html">Fiscalit√© de la propri√©t√© intellectuelle au Kazakhstan: comment devenir pigiste?</a></li>
<li><a href="../fr439924/index.html">Le volume de colis provenant de boutiques en ligne √©trang√®res a augment√© de 25%</a></li>
<li><a href="../fr439926/index.html">Conserver le ViewModel √† l'int√©rieur et √† l'ext√©rieur</a></li>
<li><a href="../fr439928/index.html">Conduite autonome sur les trottoirs avec OpenCV et Tensorflow</a></li>
<li><a href="../fr439932/index.html">Comment nous avons ouvert des bureaux de d√©veloppement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>