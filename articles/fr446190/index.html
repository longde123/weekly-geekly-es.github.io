<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕢 🎯 🤸🏾 Mon système domotique. Création d'une image de système d'exploitation 👨🏽‍🔧 🗞️ 📕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Présentation 

 Installation du système sur un Raspberry Pi 2.3 

 Je décrirai la manière la plus simple, à mon avis, pour les débutants. 

 Toutes le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mon système domotique. Création d'une image de système d'exploitation</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446190/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Présentation</a> <br><br>  Installation du système sur un Raspberry Pi 2.3 <br><br>  Je décrirai la manière la plus simple, à mon avis, pour les débutants. <br><br>  Toutes les actions se produiront dans Ubuntu 18.04. <br><br>  Pour obtenir de l'aide sur les commandes, utilisez la commande «man» + la commande souhaitée. <br><br><pre><code class="bash hljs">man ls</code> </pre> <br>  Ou la commande nécessaire avec la clé --help <br><br><pre> <code class="bash hljs">ls --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre> <br><a name="habracut"></a><br>  1. Installation du système d'exploitation Raspbian Stretch Lite sur une carte microSD. <br><br>  La carte MicroSD doit être de classe 10 et avoir une capacité de 8 gigaoctets. <br>  Insérez la carte SD dans l'ordinateur et entrez la commande: <br><br><pre> <code class="bash hljs">lsblk</code> </pre> <br><img src="https://habrastorage.org/webt/li/ti/y4/litiy47g_6lk1faubuj78odw3vi.png"><br><br>  Dans l'exemple, la carte est définie comme mmcblk0, alors j'utiliserai ce nom. <br><br>  Ensuite, pour effacer la carte des informations précédemment enregistrées (nous ferons ensuite une image disque), vous devez l'effacer avec la commande: <br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero of=/dev/mmcblk0</code> </pre> <br>  Cette commande nécessite des droits de superutilisateur, pour cela vous devez ajouter le mot clé <i>"sudo"</i> au début.  Ci-après, je donne des commandes sans <i>sudo</i> .  Lors de la saisie de commandes, utilisez la saisie semi-automatique (touche Tab), cela est nécessaire pour contrôler l'entrée correcte des commandes et des chemins de fichiers.  Pendant l'exécution de la commande, vous pouvez télécharger une nouvelle distribution du système d'exploitation. <br><br>  Téléchargez ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">raspberrypi.org</a> <br>  Nous avons besoin de Raspbian Stretch Lite.  Décompressez le zip téléchargé, nous avons besoin d'un fichier avec l'extension img - c'est l'image disque que nous allons copier sur la carte.  Donc, si nous avons une image disque et que la commande dd est terminée, passez à autre chose. <br><br>  Copiez l'image sur la carte: <br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/path/to/raspbian.img of=/dev/mmcblk0 bs=4M status=progress</code> </pre> <br>  une fois terminé, entrez la commande: <br><br><pre> <code class="bash hljs">sync</code> </pre> <br>  Nous sortons la carte et la réinsérons. <br><br>  Créez un fichier vide sur le disque de démarrage de notre carte: <br><br><pre> <code class="bash hljs">touch /media/<span class="hljs-variable"><span class="hljs-variable">$USER</span></span>/boot/ssh</code> </pre> <br>  Ceci est nécessaire pour qu'un serveur ssh soit lancé sur Raspberry. <br><br>  La carte doit être retirée en toute sécurité, insérée dans le Raspberry, connectée à un réseau câblé et alimentée.  S'il n'y a pas d'alimentation 2 apmera, vous pouvez l'alimenter à partir d'un ordinateur avec USB3.  Au premier démarrage, le système augmentera la taille des disques à la taille de la carte, cela prendra un certain temps. <br><br>  Pour connaître l'adresse IP de notre RPi, vous pouvez utiliser l'utilitaire arp-scan.  S'il n'est pas installé, définissez: <br><br><pre> <code class="bash hljs">apt install arp-scan</code> </pre> <br>  Nous découvrons le nom de notre carte réseau: <br><br><pre> <code class="bash hljs">ip a</code> </pre> <br>  ou <br><br><pre> <code class="bash hljs">netstat -i</code> </pre> <br><img src="https://habrastorage.org/webt/sg/kr/6w/sgkr6wb793k2l4dmscvleeo_4pa.png"><br><br>  J'ai une carte wifi nommée wlp1s0. <br><br>  Exécutez arp-scan: <br><br><pre> <code class="bash hljs">arp-scan -I wlp1s0 -l</code> </pre> <br><img src="https://habrastorage.org/webt/vk/fz/oh/vkfzohdrqybskrape13_qijsf8e.png"><br><br>  J'ai besoin d'un RPi avec IP 192.168.0.114, l'adresse est attribuée par DHCP et peut être n'importe quoi. <br><br>  On passe à RPi par ssh: <br><br><pre> <code class="bash hljs">ssh pi@192.168.0.114</code> </pre> <br>  vous devez saisir <i>oui</i> lors de la première authentification, puis saisir le mot de passe pour pi - <i>framboise</i> . <br><br>  Si nous avons réussi à nous connecter à Raspberry, entrez la commande: <br><br><pre> <code class="bash hljs">init 0</code> </pre> <br>  Cette commande désactive RPi. <br><br>  Vous devez réinsérer la carte dans l'ordinateur.  Maintenant, nous avons besoin du programme «gparted», s'il n'est pas installé, définissez: <br><br><pre> <code class="bash hljs">apt install gparted</code> </pre> <br>  Nous commençons par répartir, vous devez changer la taille du disque mmcblk0p2, laisser à la fin une zone non allouée de 300 à 500 mégaoctets ou 2-3% de la taille de la carte, cela est nécessaire pour que notre image tienne sur des cartes de différents fabricants, et leur taille peut varier.  Le résultat devrait être quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/pi/gq/y1/pigqy1qfzik2laujmitutxwzn8g.png"><br><br>  Après avoir terminé le travail avec gparted, vous pouvez faire une copie de sauvegarde de la carte, de sorte qu'en cas de problèmes dans d'autres expériences, vous disposez d'une image prête à l'emploi. <br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/mmcblk0 | bzip2 &gt; raspbian.bz2</code> </pre> <br>  maintenant, nous pouvons toujours restaurer notre disque avec la commande: <br><br><pre> <code class="bash hljs">bzcat raspbian.bz2 | dd bs=4M of=/dev/mmcblk0</code> </pre> <br>  En conséquence, nous avons une carte microSD avec un système d'exploitation prêt à l'emploi et sa copie de sauvegarde. <br><br>  2. Configuration de Raspbian Stretch Lite. <br><br>  Nous allons à RPi par ssh.  Pour configurer les adresses statiques du réseau filaire et du wifi, ajoutez les paramètres suivants à la fin du fichier /etc/dhcpcd.conf: <br><br>  <i>interface eth0</i> <i><br></i>  <i>adresse IP statique = 192.168.0.10 / 24</i> <i><br></i>  <i>routeurs statiques = 192.168.0.1</i> <i><br></i>  <i>serveurs_nom_domaine statiques = 8.8.8.8, 8.8.4.4</i> <i><br></i>  <i>interface wlan0</i> <i><br></i>  <i>adresse IP statique = 192.168.0.10 / 24</i> <i><br></i>  <i>routeurs statiques = 192.168.0.1</i> <i><br></i>  <i>serveurs_nom_domaine statiques = 8.8.8.8, 8.8.4.4</i> <br><br>  Avec ces paramètres, RPi aura la même IP sur un réseau filaire ou wifi. <br><br>  Fichier pour configurer le wifi - /etc/wpa_supplicant/wpa_supplicant.conf <br>  ajoutez-y les paramètres suivants: <br><br>  <i>réseau = {</i> <i><br></i>  <i>ssid = "NAME"</i> <i><br></i>  <i>psk = "PASS"</i> <i><br></i>  <i>}</i> <br>  où NOM et PASS nom d'utilisateur et mot de passe du réseau wifi.  Si vous ne savez pas à l'avance où utiliser notre RPi, le nom et le mot de passe peuvent être entrés ultérieurement. <br><br>  Ajouter des tâches au programme cron <br><br><pre> <code class="bash hljs">crontab -e</code> </pre> <br>  Au premier démarrage, vous devrez sélectionner un éditeur de texte, nano - sera le plus familier. <br><br><img src="https://habrastorage.org/webt/ki/dr/an/kidranxamlfdaux2i76x5c0vjf4.png"><br><br>  Pour que les plannings fonctionnent, ajoutez les paramètres suivants: <br><br>  <i>CHEMIN = / usr / sbin: / usr / bin: / sbin: / bin</i> <i><br></i>  <i>SHELL = / bin / bash</i> <br><br>  Et les tâches elles-mêmes, nous enregistrerons l'heure de chaque téléchargement et la durée de fonctionnement continu, ce seront des informations utiles à l'avenir. <br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">redémarrer</a> sleep 60 &amp;&amp; date &gt;&gt; my-reboot.txt</i> <i><br></i>  <i>@ uptime hebdomadaire &gt;&gt; my-uptime.txt</i> <br><br>  Pour quitter, la combinaison de touches Ctrl + x, Y, Entrée <br><br>  Le réglage du fuseau horaire se fait par la commande: <br><br><pre> <code class="bash hljs">dpkg-reconfigure tzdata</code> </pre> <br>  Pour augmenter les ressources de la carte SD, vous pouvez arrêter la journalisation et supprimer le fichier d'échange: <br><br>  (Je pense que cela devrait réduire la probabilité de défaillance de la carte SD ou de corruption de données lors des arrêts brusques de RPi pendant le fonctionnement): <br><br><pre> <code class="bash hljs">apt update apt purge dphys-swapfile apt autoremove --purge apt install busybox-syslogd dpkg --purge rsyslog</code> </pre> <br>  Installation de programmes: <br><br><pre> <code class="bash hljs">apt install mosquitto mosquitto-clients sqlite3 libsqlite3-dev mc htop arp-scan vim supervisor python-pip python3-pip python-virtualenv python-dev</code> </pre> <br><pre> <code class="bash hljs">pip install psutil paho-mqtt pip3 install psutil paho-mqtt</code> </pre> <br>  Pour homekit2mqtt, vous devez installer nodejs: <br><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash - apt-get install -y nodejs</code> </pre> <br>  Vérification de la version installée <br><br><pre> <code class="bash hljs">node -v nodejs -v</code> </pre> <br>  Installez node-red: <br><br><pre> <code class="bash hljs">npm install -g --unsafe-perm node-red</code> </pre> <br>  Nous lançons: <br><br><pre> <code class="bash hljs">node-red</code> </pre> <br><img src="https://habrastorage.org/webt/m7/es/jj/m7esjjrer1ip2vflmp_bgqagxle.png"><br><br>  Dans la barre d'adresse du navigateur, saisissez l'adresse IP du RPi 192.168.0.10:1880 <br><br><img src="https://habrastorage.org/webt/ki/u_/qk/kiu_qkhawjr3-za-urpaetmamj4.png"><br><br>  Terminez node-red, appuyez sur Ctrl + c, accédez au répertoire .node-red <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .node-red</code> </pre> <br>  Et installez des packages pour node-red, ils peuvent être nécessaires pour les tests, la configuration et la communication de divers appareils. <br><br><pre> <code class="bash hljs">npm i node-red-dashboard node-red-contrib-sonos node-red-contrib-knx node-red-node-serialport node-red-contrib-globalcache node-red-contrib-counter</code> </pre> <br>  Nous revenons au répertoire personnel <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span></code> </pre> <br>  Installez homekit2mqtt: <br><br><pre> <code class="bash hljs">apt install libavahi-compat-libdnssd-dev npm install -g homekit2mqtt --unsafe-perm</code> </pre> <br>  Vous pouvez essayer d'exécuter homekit avec la commande <br><br><pre> <code class="bash hljs">homekit2mqtt</code> </pre> <br><img src="https://habrastorage.org/webt/o_/nr/wb/o_nrwbgde08t8wxz1f40goswfhc.png"><br><br>  Il commencera avec les paramètres par défaut et vous pouvez ajouter un nouvel appareil dans le programme Home sur votre iPhone ou iPad <br><br>  Le mot de passe <i>pi</i> laissera celui actuel. <br><br>  Maintenant que tout est installé et vérifié, vous devez sauvegarder notre carte SD de la même manière qu'auparavant.  Maintenant, tout est prêt pour installer le système d'automatisation. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446190/">https://habr.com/ru/post/fr446190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446176/index.html">Reconnaissance de réservoir dans un flux vidéo à l'aide de méthodes d'apprentissage automatique (+2 vidéos sur les plates-formes Elbrus et Baikal)</a></li>
<li><a href="../fr446180/index.html">MongoDB était-il le bon choix?</a></li>
<li><a href="../fr446184/index.html">Applications TDD sur Spring Boot: affiner les tests et travailler avec le contexte</a></li>
<li><a href="../fr446186/index.html">Comment Elon Musk a tenté de détruire l'informateur dans les rangs de Tesla, et ce qu'il en est advenu</a></li>
<li><a href="../fr446188/index.html">Est-il temps pour les URL emoji?</a></li>
<li><a href="../fr446192/index.html">Sauvegarde historique: sept inventeurs dont vous n'avez peut-être pas entendu parler</a></li>
<li><a href="../fr446194/index.html">Nouveau Galatea ou animez une fille androïde pour un roman de science-fiction</a></li>
<li><a href="../fr446196/index.html">Présentation de 3CX V16 avec le widget de communication de site Web</a></li>
<li><a href="../fr446198/index.html">Destruction des données du disque dur</a></li>
<li><a href="../fr446200/index.html">Frontend Weekly Digest (25 - 31 mars 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>