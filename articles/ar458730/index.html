<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐ฟ ๐ฉ๐พโ๐คโ๐ฉ๐ผ ๐ ููุงูุญุฉ ุงูุชุนููุฏ ูู ุชุทููุฑ ุงูุจุฑูุฌูุงุช ๐จ๐ปโโ๏ธ ๐ก๏ธ โฃ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุง ูุฐุงุ 


 ุจุนุฏ ุงูุนูู ูู ูุดุงุฑูุน ูุฎุชููุฉ ุ ูุงุญุธุช ุฃู ูู ูุงุญุฏ ูููู ูุฏูู ุจุนุถ ุงููุดุงูู ุงูุดุงุฆุนุฉ ุ ุจุบุถ ุงููุธุฑ ุนู ุงููุฌุงู ุ ุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ ุ ุงุตุทูุงุญ ุงูููุฏ ููุง ุฅ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุงูุญุฉ ุงูุชุนููุฏ ูู ุชุทููุฑ ุงูุจุฑูุฌูุงุช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458730/" style=";text-align:right;direction:rtl"><h2 id="whats-this-about" style=";text-align:right;direction:rtl">  ูุง ูุฐุงุ </h2><br><p style=";text-align:right;direction:rtl"> ุจุนุฏ ุงูุนูู ูู ูุดุงุฑูุน ูุฎุชููุฉ ุ ูุงุญุธุช ุฃู ูู ูุงุญุฏ ูููู ูุฏูู ุจุนุถ ุงููุดุงูู ุงูุดุงุฆุนุฉ ุ ุจุบุถ ุงููุธุฑ ุนู ุงููุฌุงู ุ ุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ ุ ุงุตุทูุงุญ ุงูููุฏ ููุง ุฅูู ุฐูู.  ูู ุชูู ุชูู ุงููุดุงูู ุตุนุจุฉ ุ ุฅููุง ูุฌุฑุฏ ุฑูุชูู ุดุงู: ุงูุชุฃูุฏ ูู ุฃูู ูู ุชููุช ุฃู ุดูุก ุบุจู ููุงุถุญ.  ุจุฏูุงู ูู ุงูููุงู ุจูุฐุง ุงูุฑูุชูู ูููููุง ุ ุฃุตุจุญุช ููููุณูุง ุจุงูุจุญุซ ุนู ุญู: ุจุนุถ ููุฌ ุงูุชุทููุฑ ุฃู ุงุตุทูุงุญ ุงูููุฏ ุฃู ุฃู ุดูุก ูู ุดุฃูู ุฃู ูุณุงุนุฏูู ูู ุชุตููู ูุดุฑูุน ุจุทุฑููุฉ ุชููุน ุญุฏูุซ ุชูู ุงููุดุงูู ุ ูุฐูู ูููููู ุงูุชุฑููุฒ ุนูู ุงูุฃุดูุงุก ุงููุซูุฑุฉ ููุงูุชูุงู .  ูุฐุง ูู ุงููุฏู ูู ูุฐู ุงูููุงูุฉ: ููุตู ูุฐู ุงููุดููุงุช ูุฅุธูุงุฑ ูุฐุง ุงููุฒูุฌ ูู ุงูุฃุฏูุงุช ูุงูุฃุณุงููุจ ุงูุชู ูุฌุฏุชูุง ูุญููุง. </p><a name="habracut"></a><br><h2 id="problems-we-face" style=";text-align:right;direction:rtl">  ุงููุดุงูู ุงูุชู ููุงุฌููุง </h2><br><p style=";text-align:right;direction:rtl">  ุฃุซูุงุก ุชุทููุฑ ุงูุจุฑุงูุฌ ุ ููุงุฌู ุงูุนุฏูุฏ ูู ุงูุตุนูุจุงุช ุนูู ุทูู ุงูุทุฑูู: ุงููุชุทูุจุงุช ุบูุฑ ุงููุงุถุญุฉ ูุณูุก ุงูููู ูุณูุก ุนูููุฉ ุงูุชุทููุฑ ููุง ุฅูู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ููุงุฌู ุฃูุถูุง ุจุนุถ ุงูุตุนูุจุงุช ุงููููุฉ: ูุนูู ุงูุฑูุฒ ุงููุฏูู ุนูู ุฅุจุทุงุก ูุดุงุทูุง ุ ูุงูุชูุณุน ุฃูุฑ ุตุนุจ ุ ูุจุนุถ ุงููุฑุงุฑุงุช ุงูุณูุฆุฉ ุงูุชู ุงุชุฎุฐูุงูุง ูู ุงููุงุถู ุชุซูุฑ ุนูููุง ุงูููู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุชุฎูุต ูููุง ุฌููุนูุง ุ ุซู ุชูููููุง ุจุดูู ูุจูุฑ ุ ูููู ููุงู ูุดููุฉ ุฃุณุงุณูุฉ ูุงุญุฏุฉ ูุง ููููู ูุนู ุดูุก ุญูุงููุง: ุชุนููุฏ ูุธุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุฅู ููุฑุฉ ุงููุธุงู ุงูุฐู ุชููู ุจุชุทููุฑู ุจููุณู ูุนูุฏุฉ ุฏุงุฆููุง ุ ุณูุงุก ูููุช ุฐูู ุฃู ูุง. <br>  ุญุชู ุนูุฏ ููุงูู <em>ุจุฅูุดุงุก ุชุทุจูู CRUD ุขุฎุฑ</em> ุ ููุงู ุฏุงุฆููุง ุจุนุถ ุงูุญุงูุงุช ุงููุชูุฏูุฉ ูุจุนุถ ุงูุฃุดูุงุก ุงูุตุนุจุฉ ุ ููู ููุช ูุขุฎุฑ ูุณุฃู ุฃุญุฏูู "ูููุง ุ ูุงุฐุง ุณูุญุฏุซ ุฅุฐุง ููุช ุจุฐูู ููุฐุง ูู ุธู ูุฐู ุงูุธุฑููุ"  ูุฃูุช ุชููู "ุฌูุงูุฉ ุงูููู ุ ูุฐุง ุณุคุงู ุฌูุฏ ููุบุงูุฉ". </p><br><p style=";text-align:right;direction:rtl">  ุชูู ุงูุญุงูุงุช ุงูุตุนุจุฉ ูุงูููุทู ุงููุดุจูู ูุงูุชุญูู ูู ุงูุตุญุฉ ูุฅุฏุงุฑุฉ ุงููุตูู - ูู ูุง ูุถูู ุฅูู ููุฑุชู ุงููุจูุฑุฉ. <br>  ุบุงูุจูุง ูุง ุชููู ูุฐู ุงูููุฑุฉ ูุจูุฑุฉ ุฌุฏูุง ุจุญูุซ ูุง ุชุชูุงุณุจ ูุน ุฑุฃุณ ูุงุญุฏ ุ ููุฐู ุงูุญูููุฉ ูุญุฏูุง ุชุฌูุจ ูุดุงูู ูุซู ุณูุก ุงูููู. </p><br><p style=";text-align:right;direction:rtl">  ููู ูููู ูุฑูุงุก ูููุชุฑุถ ุฃู ูุฐุง ุงููุฑูู ูู ุฎุจุฑุงุก ุงููุฌุงู ููุญููู ุงูุฃุนูุงู ูุชูุงุตููู ุจูุถูุญ ูููุชุฌูู ูุชุทูุจุงุช ุฌูุฏุฉ ููุชุณูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุชุนูู ุนูููุง ุชูููุฐูุง ุ ููุชุนุจูุฑ ุนู ูุฐู ุงูููุฑุฉ ุงููุนูุฏุฉ ูู ูุธุงููุง.  ุงูุขู ุฃุตุจุญ ูุฐุง ุงูุฑูุฒ ูุธุงููุง ุขุฎุฑ ุ ุจุทุฑููุฉ ุฃูุซุฑ ุชุนููุฏูุง ูู ุงูููุฑุฉ ุงูุฃุตููุฉ ุงูุชู ูุถุนูุงูุง ูู ุงูุงุนุชุจุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ููู ุฐููุ  ููุงุฌู ุงููุงูุน: ุงููููุฏ ุงูุชูููุฉ ุชุฌุจุฑู ุนูู ุงูุชุนุงูู ูุน ุงูุฃุญูุงู ุงููุจูุฑุฉ ูุชูุงุณู ุงูุจูุงูุงุช ูุชูุงูุฑูุง ุจุงูุฅุถุงูุฉ ุฅูู ุชูููุฐ ููุทู ุงูุฃุนูุงู ุงููุนูู. </p><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑู ุ ูุฅู ุงููููุฉ ุตุนุจุฉ ููุบุงูุฉ ุ ูุงูุขู ูุญุชุงุฌ ุฅูู ุงูุฃุฏูุงุช ุงูููุงุณุจุฉ ููุชุนุงูู ูุนูุง. <br>  ูุบุฉ ุงูุจุฑูุฌุฉ ูู ูุฌุฑุฏ ุฃุฏุงุฉ ุฃุฎุฑู ุ ูููุง ูู ุงูุญุงู ูุน ูู ุฃุฏุงุฉ ุฃุฎุฑู ุ ููู ูุง ุชุชุนูู ููุท ุจุฌูุฏุชูุง ุ ุจู ุฑุจูุง ุชููู ุฃูุซุฑ ุญูู ุงูุฃุฏุงุฉ ุงูุชู ุชูุงุฆู ุงููููุฉ.  ูุฏ ูููู ูุฏูู ุฃูุถู ููู ุจุฑุงุบู ุ ูููู ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุถุน ุจุนุถ ุงููุณุงููุฑ ูู ุงูุฎุดุจ ุ ูุณุชููู ุงููุทุฑูุฉ ุงููุฑุจู ุฃูุถู ุ ุฃููุณ ูุฐููุ </p><br><h2 id="technical-aspects" style=";text-align:right;direction:rtl">  ุงูุฌูุงูุจ ุงููููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูุนุธู ุงููุบุงุช ุงูุดุนุจูุฉ ุงูููู ูุฌูู ุงูููุญู.  ุนูุฏูุง ููุฏู ุดุฎุต ูุง ููุฏูุฉ ุฅูู OOP ุ ุนุงุฏุฉ ูุง ูุณุชุฎุฏููู ุงูุฃูุซูุฉ: <br>  ุงููุธุฑ ูู ุณูุงุฑุฉ ุ ููู ูุงุฆู ูู ุงูุนุงูู ุงูุญูููู.  ูุฏููุง ุงูุนุฏูุฏ ูู ุงูุฎุตุงุฆุต ูุซู ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ ุ ุงููุฒู ุ ุงูููู ุ ุงูุณุฑุนุฉ ุงููุตูู ุ ุงูุณุฑุนุฉ ุงูุญุงููุฉ ูููู ุฌุฑุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฅุธูุงุฑ ูุฐุง ุงููุงุฆู ูู ุจุฑูุงูุฌูุง ุ ูุฌูุน ูุฐู ุงูุฎุตุงุฆุต ูู ูุตู ูุงุญุฏ.  ูููู ุฃู ุชููู ุงูุฎุตุงุฆุต ุฏุงุฆูุฉ ุฃู ูุงุจูุฉ ููุชุบููุฑ ุ ูุงูุชู ุชุดูู ูุนูุง ุงูุญุงูุฉ ุงูุญุงููุฉ ููุฐุง ุงููุงุฆู ูุจุนุถ ุงูุญุฏูุฏ ุงูุชู ูุฏ ุชุฎุชูู ูููุง.  ููุน ุฐูู ุ ูุฅู ุงูุฌูุน ุจูู ูุฐู ุงูุฎุตุงุฆุต ูุง ูููู ุ ุญูุซ ูุชุนูู ุนูููุง ุงูุชุญูู ูู ุฃู ุงูุญุงูุฉ ุงูุญุงููุฉ ููุทููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุงูุณุฑุนุฉ ุงูุญุงููุฉ ูุง ุชุชุฌุงูุฒ ุงูุณุฑุนุฉ ุงููุตูู.  ููุชุฃูุฏ ูู ุฃููุง ูุนูู ุจุนุถ ุงูููุทู ููุฐู ุงููุฆุฉ ุ ูู ุจุชูููุฒ ุงูุฎุตุงุฆุต ูุฎุงุต ูููุน ุฃู ุดุฎุต ูู ุฅูุดุงุก ุญุงูุฉ ุบูุฑ ูุงููููุฉ. <br>  ููุง ุชุฑู ุงูุฃุดูุงุก ุชุฏูุฑ ุญูู ุญุงูุชูุง ุงูุฏุงุฎููุฉ ูุฏูุฑุฉ ุญูุงุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ูุฅู ูุฐู ุงูุฑูุงุฆุฒ ุงูุซูุงุซ ู OOP ููุง ูุนูู ูุซุงูู ูู ูุฐุง ุงูุณูุงู: ูุญู ูุณุชุฎุฏู ุงูููุฑุงุซ ูุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุจุนุถ ุงูุชูุงุนุจ ุจุงูุญุงูุฉ ุ ูุชุบููู ูุญูุงูุฉ ุงูุฏููุฉ ูุชุนุฏุฏ ุงูุฃุดูุงู ูุนูุงุฌ ุงูุฃุฌุณุงู ุงููุชุดุงุจูุฉ ุจุงูุทุฑููุฉ ููุณูุง.  ุงูุชุฏุงุฎู ูุฅุนุฏุงุฏ ุงูุชุฑุงุถู ุฃูุฑ ููุทูู ุฃูุถูุง ุ ูุฃูู ูู ูุฐุง ุงูุณูุงู ูุง ูููู ุฃู ูููู ูููุงุฆู ุงูุซุงุจุช ุฏูุฑุฉ ุญูุงุฉ ููุฏูู ุฏุงุฆููุง ุญุงูุฉ ูุงุญุฏุฉ ุ ููู ููุณุช ุงูุญุงูุฉ ุงูุฃูุซุฑ ุดููุนูุง. </p><br><p style=";text-align:right;direction:rtl"> ุงูุดูุก ุนูุฏูุง ุชูุธุฑ ุฅูู ุชุทุจูู ููุจ ูููุฐุฌู ูู ูุฐู ุงูุฃูุงู ุ ููู ูุง ูุชุนุงูู ูุน ุงูุฃุดูุงุก.  ูุญุชูู ูู ุดูุก ุชูุฑูุจูุง ูู ุงูููุฏ ูุฏููุง ุนูู ูุฏู ุงูุญูุงุฉ ุงูุฃุจุฏูุฉ ุฃู ุงูุนูุฑ ุงูุงูุชุฑุงุถู ุนูู ุงูุฅุทูุงู.  ุฃูุซุฑ ุฃููุงุน "ุงููุงุฆูุงุช" ุดููุนูุง ูู ููุน ูู ุงูุฎุฏูุงุช ูุซู <code>UserService</code> ุฃู <code>EmployeeRepository</code> ุฃู ุจุนุถ ุงูุทุฑุฒ / ุงูููุงูุงุช / DTOs ุฃู ุฃู ุดูุก ุชุณููู.  ุงูุฎุฏูุงุช ููุณ ููุง ุฃู ุญุงูุฉ ููุทููุฉ ุจุฏุงุฎููุง ุ ููู ุชููุช ูุชููุฏ ูู ุฌุฏูุฏ ุชูุงููุง ููุง ูุนูุฏ ุฅูุดุงุก ุงูุฑุณู ุงูุจูุงูู ููุงุนุชูุงุฏ ูู ุฎูุงู ุงุชุตุงู ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ููุณ ูุฏู ุงูููุงูุงุช ูุงูููุงุฐุฌ ุฃู ุณููู ูุฑุชุจุท ุจูุง ุ ููู ูุฌุฑุฏ ุญุฒู ูู ุงูุจูุงูุงุช ุ ููุง ูุณุงุนุฏ ูุงุจููุชูุง ููุชุบูุฑ ูููู ุงูุนูุณ ุชูุงููุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ูุง ุชุนุฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ ูู OOP ูููุฏุฉ ูู ุชุทููุฑ ูุฐุง ุงูููุน ูู ุงูุชุทุจููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุญุฏุซ ูู ุชุทุจูู ููุจ ูููุฐุฌู ูู ุชุฏูู ุงูุจูุงูุงุช: ุงูุชุญูู ุ ูุงูุชุญููู ุ ูุงูุชูููู ุ ููุง ุฅูู ุฐูู.  ูููุงู ูููุฐุฌ ููุงุณุจ ุชูุงููุง ููุฐุง ุงูููุน ูู ุงููุธุงุฆู: ุงูุจุฑูุฌุฉ ุงููุธูููุฉ.  ูููุงู ุฏููู ุนูู ุฐูู: ุฌููุน ุงูููุฒุงุช ุงูุญุฏูุซุฉ ูู ุงููุบุงุช ุงูุดุนุจูุฉ ุงูููู ุชุฃุชู ูู ููุงู: <code>async/await</code> ุ lambdas ูุงูููุฏูุจูู ุ ุงูุจุฑูุฌุฉ ุงูุชูุงุนููุฉ ุ ุงูููุงุจุงุช ุงูุชูููุฒูุฉ (ุงูุชุนุฏุงุฏุงุช ุงูุณุฑูุนุฉ ุฃู ุงูุตุฏุฃ ุ ูุง ูุฌุจ ุงูุฎูุท ุจูููุง ูุจูู ุงูุชุนุฏุงุฏุงุช ูู java ุฃู .net. ) ุ tuples - ูู ูุง ูู ูู FP. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ูุฐู ูุฌุฑุฏ ุชุฏููุฑ ุ ูู ุงูุฌูุฏ ุฌุฏูุง ุงูุชูุงููุง ุ ููู ููุงู ุงููุฒูุฏ ูุงููุฒูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ูุจู ุฃู ุฃุฐูุจ ุฅูู ุฃู ุนูู ุ ููุงู ููุทุฉ ูุฌุจ ุชูุถูุญูุง.  ูุนุฏ ุงูุชุญูู ุฅูู ูุบุฉ ุฌุฏูุฏุฉ ุ ุฎุงุตุฉู ุงููููุฐุฌ ุงูุฌุฏูุฏ ุ ุงุณุชุซูุงุฑูุง ูููุทูุฑูู ูุจุงูุชุงูู ููุนูู.  ุฅู ุงูููุงู ุจุงุณุชุซูุงุฑุงุช ุญููุงุก ูู ูุนุทูู ุดูุฆูุง ุณูู ุงููุดุงูู ุ ูููู ูุฏ ุชููู ุงูุงุณุชุซูุงุฑุงุช ุงููุนูููุฉ ูู ุงูุดูุก ุงูุฐู ุณูุจููู ูุงูููุง. </p><br><h2 id="tools-we-have-and-what-they-give-us" style=";text-align:right;direction:rtl">  ุงูุฃุฏูุงุช ุงูุชู ูุฏููุง ููุง ููุฏูููู ููุง </h2><br><p style=";text-align:right;direction:rtl">  ุงููุซูุฑ ููุง ููุถู ุงููุบุงุช ุฐุงุช ุงููุชุงุจุฉ ุงูุซุงุจุชุฉ.  ุงูุณุจุจ ูู ุฐูู ุจุณูุท: ุงููุญูู ุงูุจุฑูุฌู ูุนุชูู ุจุงููุญูุตุงุช ุงููููุฉ ูุซู ุชูุฑูุฑ ุงููุนููุงุช ุงูููุงุณุจุฉ ุฅูู ุงููุธุงุฆู ุ ูุจูุงุก ููุงูุงุชูุง ุจุดูู ุตุญูุญ ูููู ุฌุฑุง.  ูุฐู ุงูุดููุงุช ุชุฃุชู ูุฌุงูุง.  ุงูุขู ุ ุจุงููุณุจุฉ ููุฃุดูุงุก ุงูุชู ูุง ูุณุชุทูุน ุงููุชุฑุฌู ุงูุชุญูู ูููุง ุ ูุฏููุง ุฎูุงุฑ: ุงูุฃูู ูู ุงูุฃูุถู ุฃู ุฅุฌุฑุงุก ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช.  ุงุฎุชุจุงุฑุงุช ุงููุชุงุจุฉ ุชุนูู ุงููุงู ุ ููุง ุชุฏูุน ูุฑุฉ ูุงุญุฏุฉ ููุท ููู ุงุฎุชุจุงุฑ ุ ูุฌุจ ุนููู ุงูุงุญุชูุงุธ ุจูุง.  ุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุตุงุจ ุงููุงุณ ุจุงูุฐุนุฑ ุ ูุฐูู ุชุญุตู ุจูู ุงูุญูู ูุงูุขุฎุฑ ุนูู ูุชุงุฆุฌ ุณูุจูุฉ ูุฅูุฌุงุจูุฉ ุฎุงุทุฆุฉ.  ูููุง ุฒุงุฏ ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูุชู ูุชุนูู ุนููู ูุชุงุจุชูุง ุ ูุงู ูุชูุณุท โโุฌูุฏุฉ ุชูู ุงูุงุฎุชุจุงุฑุงุช.  ููุงู ูุดููุฉ ุฃุฎุฑู: ูู ุฃุฌู ุงุฎุชุจุงุฑ ุดูุก ูุง ุ ูุฌุจ ุฃู ุชุนุฑู ูุชุฐูุฑ ุฃู ูุฐุง ุงูุดูุก ูุฌุจ ุงุฎุชุจุงุฑู ุ ูููู ูููุง ูุงู ูุธุงูู ุฃูุจุฑ ูููุง ูุงู ูู ุงูุณูู ุนููู ุชูููุช ุดูุก ูุง. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ุงููุชุฑุฌู ูููู ุฌูุฏูุง ูุซู ูุธุงู ูุชุงุจุฉ ุงููุบุฉ.  ุฅุฐุง ูู ูุณูุญ ูู ุจุงูุชุนุจูุฑ ุนู ุดูุก ูุง ุจุทุฑู ุซุงุจุชุฉ ุ ูุนููู ุงูููุงู ุจุฐูู ูู ููุช ุงูุชุดุบูู.  ููู ูุง ูุนูู ุงูุงุฎุชุจุงุฑุงุช ุ ูุนู.  ูุง ููุชุตุฑ ุงูุฃูุฑ ุนูู ูุธุงู ุงููุชุงุจุฉ ุนูู ุงูุฑุบู ูู ุฃู ููุฒุงุช ุจูุงุก ุงูุฌููุฉ ูุงูุณูุฑ ุงูุตุบูุฑ ูููุฉ ุฌุฏูุง ุฃูุถูุง ุ ูุฃููุง ูู ููุงูุฉ ุงูููู ูุฑุบุจ ูู ูุชุงุจุฉ ุฃูู ุนุฏุฏ ูููู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูุฐูู ุฅุฐุง ูุงูุช ุจุนุถ ุงูุฃุณุงููุจ ุชุชุทูุจ ููู ูุชุงุจุฉ ุนุดุฑุฉ ุฃุถุนุงู ุงูุณุทูุฑ ุ ุญุณููุง ุ ูุง ุฃุญุฏ ุณูุณุชุฎุฏููุง.  ููุฐุง ุงูุณุจุจ ูู ุงูููู ุฃู ุชุญุชูู ุงููุบุฉ ุงูุชู ุชุฎุชุงุฑูุง ุนูู ูุฌููุนุฉ ููุงุณุจุฉ ูู ุงูููุฒุงุช ูุงูุญูู - ุญุณููุง ุ ุงูุชุฑููุฒ ุงูุตุญูุญ ุจุดูู ุนุงู.  ุฅุฐุง ูู ูุญุฏุซ ุฐูู - ูุจุฏูุงู ูู ุงุณุชุฎุฏุงู ููุฒุงุชู ููุญุงุฑุจุฉ ุงูุชุญุฏูุงุช ุงูุฃุตููุฉ ูุซู ุชุนููุฏ ูุธุงูู ููุชุทูุจุงุชู ุงููุชุบูุฑุฉ ุ ุณุชูุงุชู ุงููุบุฉ ุฃูุถูุง.  ูู ุฐูู ูุนูุฏ ุฅูู ุงููุงู ุ ูุฃูู ุชุฏูุน ูููุทูุฑูู ููุชูู.  ูููุง ุฒุงุฏ ุนุฏุฏ ุงููุดููุงุช ุงูุชู ูุชุนูู ุนูููู ุญููุง ุ ุฒุงุฏ ุงูููุช ุงูุฐู ูุญุชุงุฌูู ุฅููู ูุงููุฒูุฏ ูู ุงููุทูุฑูู ุงูุฐูู ุณุชุญุชุงุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ุฃุฎูุฑูุง ุ ูุญู ุนูู ูุดู ุฑุคูุฉ ุจุนุถ ุงูููุฏ ูุฅุซุจุงุช ูู ุฐูู.  ููุฏ ุฃุตุจุญุช ูุทูุฑูุง .NET ุ ูุฐุง ุณุชุธูุฑ ููุงุฐุฌ ุงูููุฏ ูู C # ู F # ุ ููู ุงูุตูุฑุฉ ุงูุนุงูุฉ ุณุชุจุฏู ููุง ูู ุฃู ุฃูุซุฑ ูู ูุบุงุช OOP ู FP ุงูุดุงุฆุนุฉ ุงูุฃุฎุฑู. </p><br><h2 id="let-the-coding-begin" style=";text-align:right;direction:rtl">  ุฏุน ุงูุชุฑููุฒ ูุจุฏุฃ </h2><br><p style=";text-align:right;direction:rtl">  ุณูุนูู ุนูู ุฅูุดุงุก ุชุทุจูู ููุจ ูุฅุฏุงุฑุฉ ุจุทุงูุงุช ุงูุงุฆุชูุงู. </p><br><p style=";text-align:right;direction:rtl">  ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก / ูุฑุงุกุฉ ุงููุณุชุฎุฏููู </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก / ูุฑุงุกุฉ ุจุทุงูุงุช ุงูุงุฆุชูุงู </li><li style=";text-align:right;direction:rtl">  ุชูุดูุท / ุฅูุบุงุก ุชูุดูุท ุจุทุงูุงุช ุงูุงุฆุชูุงู </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุงูุญุฏ ุงููููู ููุจุทุงูุงุช </li><li style=";text-align:right;direction:rtl">  ุฒูุงุฏุฉ ุงูุฑุตูุฏ </li><li style=";text-align:right;direction:rtl">  ูุฏููุนุงุช ุงูุนูููุฉ (ูุน ูุฑุงุนุงุฉ ุงูุฑุตูุฏ ูุชุงุฑูุฎ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุจุทุงูุฉ ูุงูุญุงูุฉ ุงููุดุทุฉ / ุบูุฑ ุงููุดุทุฉ ูุงูุญุฏ ุงููููู) </li></ul><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุงูุจุณุงุทุฉ ุ ุณูุณุชุฎุฏู ุจุทุงูุฉ ูุงุญุฏุฉ ููู ุญุณุงุจ ูุณูุชุฎุทู ุงูุชูููุถ.  ููู ุจุงููุณุจุฉ ููุจุงูู ุ ุณูุนูู ุนูู ุฅูุดุงุก ุชุทุจูู ูุงุฏุฑ ุนูู ุงูุชุญูู ูู ุงูุตุญุฉ ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก ููุงุนุฏุฉ ุงูุจูุงูุงุช ู api ุนูู ุงูููุจ.  ูุฐูู ุฏุนููุง ููุชูู ุฅูู ูููุชูุง ุงูุฃููู: ุชุตููู ุจุทุงูุงุช ุงูุงุฆุชูุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุฏุนูุง ูุฑู ููู ุณูุจุฏู ูู C # </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Card</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> CardNumber {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ExpirationMonth {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ExpirationYear {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AccountInfo AccountInfo {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AccountInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> Balance {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> CardNumber {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> DailyLimit {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูุฐุง ูุง ูููู ุ ูุฌุจ ุนูููุง ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุตุญุฉ ุ ูุนุงุฏุฉ ูุง ูุชู ุฐูู ูู ุจุนุถ <code>Validator</code> ุ ูุซู ุฐูู ูู <code>FluentValidation</code> . </p><br><p style=";text-align:right;direction:rtl">  ุงูููุงุนุฏ ุจุณูุทุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฑูู ุงูุจุทุงูุฉ ูุทููุจ ููุฌุจ ุฃู ูููู ุณูุณูุฉ ููููุฉ ูู 16 ุฑูููุง. </li><li style=";text-align:right;direction:rtl">  ุงูุงุณู ูุทููุจ ููุฌุจ ุฃู ูุญุชูู ุนูู ุญุฑูู ููุท ููููู ุฃู ูุญุชูู ุนูู ูุณุงูุงุช ูู ุงูููุชุตู. </li><li style=";text-align:right;direction:rtl">  ุงูุดูุฑ ูุงูุณูุฉ ูุฌุจ ุฃู ุชูู ุจุงูุญุฏูุฏ. </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชููู ูุนูููุงุช ุงูุญุณุงุจ ููุฌูุฏุฉ ุนูุฏูุง ุชููู ุงูุจุทุงูุฉ ูุดุทุฉ ูุชุบูุจ ุนูุฏูุง ูุชู ุฅูุบุงุก ุชูุดูุท ุงูุจุทุงูุฉ.  ุฅุฐุง ููุช ุชุชุณุงุกู ุนู ุงูุณุจุจ ุ ููุฐุง ุจุณูุท: ุนูุฏูุง ูุชู ุฅูุบุงุก ุชูุดูุท ุงูุจุทุงูุฉ ุ ููู ูููู ูู ุงููููู ุชุบููุฑ ุงูุฑุตูุฏ ุฃู ุงูุญุฏ ุงููููู. </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CardValidator</span></span> : <span class="hljs-title"><span class="hljs-title">IValidator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CardNumberRegex = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(<span class="hljs-string"><span class="hljs-string">"^[0-9]{16}$"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NameRegex = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(<span class="hljs-string"><span class="hljs-string">"^[\w]+[\w ]+[\w]+$"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CardValidator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RuleFor(x =&gt; x.CardNumber) .Must(c =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(c) &amp;&amp; CardNumberRegex.IsMatch(c)) .WithMessage(<span class="hljs-string"><span class="hljs-string">"oh my"</span></span>); RuleFor(x =&gt; x.Name) .Must(c =&gt; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(c) &amp;&amp; NameRegex.IsMatch(c)) .WithMessage(<span class="hljs-string"><span class="hljs-string">"oh no"</span></span>); RuleFor(x =&gt; x.ExpirationMonth) .Must(x =&gt; x &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; x &lt;= <span class="hljs-number"><span class="hljs-number">12</span></span>) .WithMessage(<span class="hljs-string"><span class="hljs-string">"oh boy"</span></span>); RuleFor(x =&gt; x.ExpirationYear) .Must(x =&gt; x &gt;= <span class="hljs-number"><span class="hljs-number">2019</span></span> &amp;&amp; x &lt;= <span class="hljs-number"><span class="hljs-number">2023</span></span>) .WithMessage(<span class="hljs-string"><span class="hljs-string">"oh boy"</span></span>); RuleFor(x =&gt; x.AccountInfo) .Null() .When(x =&gt; !x.IsActive) .WithMessage(<span class="hljs-string"><span class="hljs-string">"oh boy"</span></span>); RuleFor(x =&gt; x.AccountInfo) .NotNull() .When(x =&gt; x.IsActive) .WithMessage(<span class="hljs-string"><span class="hljs-string">"oh boy"</span></span>); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ููุงู ุงูุนุฏูุฏ ูู ุงููุดููุงุช ูู ูุฐุง ุงูููุฌ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ูุตู ุงูุชุญูู ูู ุงูุตุญุฉ ุนู ุฅุนูุงู ุงูููุน ุ ููุง ูุนูู ุฃู ูุฑู ุงูุตูุฑุฉ ุงููุงููุฉ <em>ููุจุทุงูุฉ</em> ุงูุชู ูุชุนูู ุนูููุง <em>ูุนูุงู</em> ุฃู ูุชุตูุญูุง ููุนูุฏ ุฅูุดุงุก ูุฐู ุงูุตูุฑุฉ ูู ุฑุฃุณูุง.  ุฅููุง ููุณุช ูุดููุฉ ูุจูุฑุฉ ุนูุฏูุง ูุญุฏุซ ุฐูู ูุฑุฉ ูุงุญุฏุฉ ููุท ุ ูููู ุนูุฏูุง ูุชุนูู ุนูููุง ุงูููุงู ุจุฐูู ููู ููุงู ูู ูุดุฑูุน ูุจูุฑ ุ ููู ูุณุชุบุฑู ููุชูุง ุทูููุงู ููุบุงูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุง ูุชู ูุฑุถ ูุฐุง ุงูุชุญูู ูู ุงูุตุญุฉ ุ ูุฌุจ ุฃู ูุถุน ูู ุงุนุชุจุงุฑูุง ุงุณุชุฎุฏุงูู ูู ูู ููุงู.  ูููููุง ุงูุชุฃูุฏ ูู ุฐูู ูู ุฎูุงู ุงูุงุฎุชุจุงุฑุงุช ุ ูููู ูุฑุฉ ุฃุฎุฑู ุ ูุฌุจ ุฃู ุชุชุฐูุฑูุง ุนูุฏ ูุชุงุจุฉ ุงูุงุฎุชุจุงุฑุงุช. </li><li style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุฑูุฏ ุงูุชุญูู ูู ุตุญุฉ ุฑูู ุงูุจุทุงูุฉ ูู ุฃูุงูู ุฃุฎุฑู ุ ุนูููุง ุฃู ููุนู ุงูุดูุก ููุณู ูู ุฌุฏูุฏ.  ุจุงูุชุฃููุฏ ุ ูููููุง ุฃู ูุจูู regex ูู ููุงู ูุดุชุฑู ุ ูููู ูุง ูุฒุงู ูุชุนูู ุนูููุง ุฃู ูุณูููุง ูู ูู ูุฏูู. </li></ul><br><p style=";text-align:right;direction:rtl">  ูู F # ุ ูููููุง ุงูููุงู ุจุฐูู ุจุทุฑููุฉ ูุฎุชููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs">(*<span class="hljs-comment"><span class="hljs-comment">{- First we define a type for CardNumber with private constructor and public factory which receives string and returns `Result&lt;CardNumber, string&gt;`. Normally we would use `ValidationError` instead, but string is good enough for example -}</span></span>*) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> = private </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> of string with member this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class"> = match this with </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> s -&gt; s static member create str = match str with | (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class">|"") -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Error</span></span></span><span class="hljs-class"> "card number can't be empty" | str -&gt; if cardNumberRegex.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IsMatch</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">str</span></span></span><span class="hljs-class">) then </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> str |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ok</span></span></span><span class="hljs-class"> else </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Error</span></span></span><span class="hljs-class"> "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> number must be a 16 digits string" (*</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">{- Then in here we express this logic "when card is deactivated, balance and daily limit manipulations aren't available". Note that this is way easier to grasp that reading `RuleFor()` in validators. -}</span></span></span><span class="hljs-class">*) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardAccountInfo</span></span></span><span class="hljs-class"> = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Active</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountInfo</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Deactivated</span></span></span><span class="hljs-class"> (*</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">{- And then that's it. The whole set of rules is here, and it's described in a static way. We don't need tests for that, the compiler is our test. And we can't accidentally miss this validation. -}</span></span></span><span class="hljs-class">*) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LetterString</span></span></span><span class="hljs-class"> //</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- LetterString is another type with built-in validation HolderId: UserId Expiration: (Month * Year) AccountDetails: CardAccountInfo }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุจุนุถ ุงูุฃุดูุงุก ูู ููุง ูููููุง ุงูููุงู ุจูุง ูู C #.  ูููููุง ุฅูุดุงุก ูุฆุฉ <code>CardNumber</code> ูุงูุชู ุณุชููู <code>ValidationException</code> ููุงู ุฃูุถูุง.  ูููู ูุฐู ุงูุฎุฏุนุฉ ุจุงุณุชุฎุฏุงู <code>CardAccountInfo</code> ูุง ูููู ุงูููุงู ุจูุง ุจุทุฑููุฉ C # ุจุทุฑููุฉ ุณููุฉ. <br>  ุดูุก ุขุฎุฑ - ุฌูู # ุชุนุชูุฏ ุงุนุชูุงุฏุง ูุจูุฑุง ุนูู ุงูุงุณุชุซูุงุกุงุช.  ููุงู ุงูุนุฏูุฏ ูู ุงููุดุงูู ูู ุฐูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุงุณุชุซูุงุกุงุช ููุง "ุงูุงูุชูุงู ุฅูู" ุฏูุงูุงุช.  ูุญุธุฉ ูุงุญุฏุฉ ููุช ููุง ูู ูุฐู ุงูุทุฑููุฉ ุ ูุขุฎุฑ - ุงูุชูู ุจู ุงูุฃูุฑ ูู ุจุนุถ ูุนุงูุฌ ุงูุนุงูููุฉ. </li><li style=";text-align:right;direction:rtl">  ูุง ุชุธูุฑ ูู ุชูููุน ุงูุทุฑููุฉ.  ุชุนุชุจุฑ ุงูุงุณุชุซูุงุกุงุช ูุซู <code>ValidationException</code> ุฃู <code>InvalidUserOperationException</code> ุฌุฒุกูุง ูู ุงูุนูุฏ ุ ูููู ูุง ุชุนุฑู ุฐูู ุญุชู ุชูุฑุฃ <em>ุงูุชูููุฐ</em> .  ุฅููุง ูุดููุฉ ูุจูุฑุฉ ุ ูุฃูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ูุชุนูู ุนููู ุงุณุชุฎุฏุงู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูููุชูุจุฉ ูู ูุจู ุดุฎุต ุขุฎุฑ ุ ูุจุฏูุงู ูู ูุฑุงุกุฉ ุงูุชูููุน ููุท ุ ุนููู ุงูุชููู ุทูุงู ุงูุทุฑูู ุฅูู ุฃุณูู ููุฏุณ ุงูุงุชุตุงู ุ ูุงูุฐู ูุณุชุบุฑู ุงููุซูุฑ ูู ุงูููุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุฐุง ูู ูุง ูุฒุนุฌูู: ุนูุฏูุง ุฃููู ุจุชูููุฐ ุจุนุถ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุ ูุฅู ุนูููุฉ ุงูุชูููุฐ ููุณูุง ูุง ุชุณุชุบุฑู ุงููุซูุฑ ูู ุงูููุช ุ ููุนุธููุง ูุฐูุจ ุฅูู ุดูุฆูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ุฑูุฒ ุงูุขุฎุฑูู ููุนุฑูุฉ ููุงุนุฏ ููุทู ุงูุฃุนูุงู. </li><li style=";text-align:right;direction:rtl">  ุงูุชุฃูุฏ ูู ุนุฏู ูุณุฑ ุฃู ุดูุก. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุฏ ูุจุฏู ูุฃูู ุนุฑุถ ูู ุฃุนุฑุงุถ ุชุตููู ุฑูุฒ ุณูุฆ ุ ูููู ููุณ ุงูุดูุก ูุญุฏุซ ุญุชู ูู ุงููุดุฑูุนุงุช ุงูููุชูุจุฉ ุจุดูู ูุงุฆู. <br>  ุญุณููุง ุ ูููู ูููููุง ุชุฌุฑุจุฉ ุงุณุชุฎุฏุงู ููุณ <code>Result</code> ูู C #.  ุณูุจุฏู ุงูุชูููุฐ ุงูุฃูุซุฑ ูุถูุญูุง ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Result</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TOk</span></span>, <span class="hljs-title"><span class="hljs-title">TError</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TOk Ok {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TError Error {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ููุงูุฉ ุฎุงูุตุฉ ุ ููุง ุชููุนูุง ูู ุถุจุท ูู ูู " <code>Ok</code> ู " <code>Error</code> ูุชุณูุญ ุจุชุฌุงูู ุงูุฎุทุฃ ุจุงููุงูู.  ุณูููู ุงูุฅุตุฏุงุฑ ุงูููุงุณุจ ุดูุก ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Result</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TOk</span></span>, <span class="hljs-title"><span class="hljs-title">TError</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsOk { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OkResult</span></span> : <span class="hljs-title"><span class="hljs-title">Result</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TOk</span></span>, <span class="hljs-title"><span class="hljs-title">TError</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> TOk _ok; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OkResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TOk ok</span></span></span><span class="hljs-function">)</span></span> { _ok = ok; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsOk =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ErrorResult</span></span> : <span class="hljs-title"><span class="hljs-title">Result</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TOk</span></span>, <span class="hljs-title"><span class="hljs-title">TError</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> TError _error; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ErrorResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TError error</span></span></span><span class="hljs-function">)</span></span> { _error = error; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsOk =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Result&lt;TOk, TError&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ok</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TOk ok</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkResult(ok); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Result&lt;TOk, TError&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Error</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TError error</span></span></span><span class="hljs-function">)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResult(error); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Result&lt;T, TError&gt; Map&lt;T&gt;(Func&lt;TOk, T&gt; map) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsOk) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = ((OkResult)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)._ok; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result&lt;T, TError&gt;.Ok(map(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = ((ErrorResult)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)._error; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result&lt;T, TError&gt;.Error(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Result&lt;TOk, T&gt; MapError&lt;T&gt;(Func&lt;TError, T&gt; mapError) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsOk) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = ((OkResult)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)._ok; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result&lt;TOk, T&gt;.Ok(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = ((ErrorResult)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)._error; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result&lt;TOk, T&gt;.Error(mapError(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑููุฉ ุฌุฏุง ุ ุฃููุณ ูุฐููุ  ููู <code>MapError</code> ุญุชู ุจุชุทุจูู ุงูุฅุตุฏุงุฑุงุช <code>void</code> ูู <code>Map</code> ู <code>MapError</code> .  ุณูุจุฏู ุงูุงุณุชุฎุฏุงู ูุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Result&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; result</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> squareResult = result.Map(x =&gt; x * x); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุณ ุณูุฆุง ููุบุงูุฉ ุ ุงูุ  ุญุณููุง ุ ุชุฎูู ุงูุขู ุฃู ูุฏูู ุซูุงุซ ูุชุงุฆุฌ ูุชุฑูุฏ ุฃู ุชูุนู ุดูุฆูุง ูุนูู ุนูุฏูุง ุชููู ุฌููุนูุง ุนูู ูุง <code>Ok</code> .  ููุฑู.  ูุฐุง ุจุงููุงุฏ ุฎูุงุฑ. <br>  ูุณุฎุฉ F #: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs">//<span class="hljs-comment"><span class="hljs-comment">-- this type is in standard library, but declaration looks like this: type Result&lt;'ok, 'error&gt; = | Ok of 'ok | Error of 'error //-- and usage: let test res1 res2 res3 = match res1, res2, res3 with | Ok ok1, Ok ok2, Ok ok3 -&gt; printfn "1: %A 2: %A 3: %A" ok1 ok2 ok3 | _ -&gt; printfn "fail"</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุฃุณุงุณ ุ ุนููู ุฃู ุชุฎุชุงุฑ ูุง ุฅุฐุง ููุช ุชูุชุจ ูุฏุฑูุง ูุนููููุง ูู ุงูุดูุฑุฉ ุ ููู ุงูุดูุฑุฉ ุบุงูุถุฉ ุ ูุชุนุชูุฏ ุนูู ุงูุงุณุชุซูุงุกุงุช ุ ูุงูุชุฃูู ุ ูุงูุชุนุจูุฑุงุช ูุบูุฑูุง ูู "ุงูุณุญุฑ" ุ ุฃู ุชูุชุจ ุฑูุฒูุง ุฃูุซุฑ ูู ุฐูู ุจูุซูุฑ ุ ููู ุฃูุฑ ุตุนุจ ูุฑุงุกุชู ุ ูููู ุฃูุซุฑ ูุชุงูุฉ ููุจุงุดุฑุฉ ุฅูู ุงูุฃูุงู.  ุนูุฏูุง ูุตุจุญ ูุซู ูุฐุง ุงููุดุฑูุน ูุจูุฑูุง ุ ูุง ููููู ูุญุงุฑุจุชู ุ ุจู ุจูุบุงุช ูุน ุฃูุธูุฉ C # ุงููุดุงุจูุฉ ููุฃููุงุน.  ุฏุนูุง ูููุฑ ูู ุณููุงุฑูู ุจุณูุท: ูุฏูู ุจุนุถ ุงูููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู ููุชุฑุฉ ูู ุงูููุช.  ุงูููู ุชุฑูุฏ ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ ูุทููุจ.  ูู ุงูุทุจูุนู ุฃู ุชุญุชุงุฌ ุฅูู ุชููุฆุฉ ูุฐุง ุงูุญูู ูู ูู ููุงู ูุชู ููู ุฅูุดุงุก ูุฐุง ุงูููุงู ุ ููู ุงููุชุฑุฌู ูุง ูุณุงุนุฏู ุนูู ุงูุฅุทูุงู ุ ูุฃู ุงููุตู ูุงุจู ููุชุบููุฑ ููุงุบูุฉ ูููุฉ ุตุงูุญุฉ.  ูุงูููุชุจุงุช ูุซู <code>AutoMapper</code> ุชุฌุนู ุงูุฃูุฑ ุฃูุซุฑ ุตุนูุจุฉ.  ุชุณูุญ ููุง ูุงุจููุฉ ุงูุชุญููู ูุฐู ุจุชููุฆุฉ ุงููุงุฆูุงุช ุฌุฒุฆููุง ูู ููุงู ูุงุญุฏ ุ ุซู ุฏูุนูุง ุฅูู ููุงู ุขุฎุฑ ูููุงุตูุฉ ุงูุชููุฆุฉ ููุงู.  ูุฐุง ูุตุฏุฑ ุขุฎุฑ ูู ุงูุฃุฎุทุงุก. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุฃุซูุงุก ุ ุชุนุฏ ููุงุฑูุฉ ููุฒุงุช ุงููุบุฉ ุฃูุฑูุง ุฑุงุฆุนูุง ุ ุฅูุง ุฃููุง ููุณุช ูุง ุชุชูุงููู ูุฐู ุงูููุงูุฉ.  ุฅุฐุง ููุช ููุชููุง ุจู ุ ููุฏ ุบุทูุช ูุฐุง ุงูููุถูุน ูู ููุงูุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุณุงุจูุฉ</a> .  ููู ูุง ููุจุบู ุฃู ุชููู ููุฒุงุช ุงููุบุฉ ููุณูุง ุณุจุจูุง ูุชุจุฏูู ุงูุชูููููุฌูุง. </p><br><p style=";text-align:right;direction:rtl">  ููุฐุง ูููุฏูุง ุฅูู ูุฐู ุงูุฃุณุฆูุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงุฐุง ูุญุชุงุฌ ุญูุง ุฅูู ุงูุชุญูู ูู OOP ุงูุญุฏูุซุฉุ </li><li style=";text-align:right;direction:rtl">  ููุงุฐุง ูุฌุจ ุฃู ูุชุญูู ุฅูู FPุ </li></ol><br><p style=";text-align:right;direction:rtl">  ุงูุฅุฌุงุจุฉ ุนูู ุงูุณุคุงู ุงูุฃูู ูู ุฃู ุงุณุชุฎุฏุงู ูุบุงุช OOP ุงูุดุงุฆุนุฉ ููุชุทุจููุงุช ุงูุญุฏูุซุฉ ูููุญู ุงููุซูุฑ ูู ุงููุชุงุนุจ ุ ูุฃููุง ูุตููุฉ ูุฃุบุฑุงุถ ูุฎุชููุฉ.  ููุชุฌ ุนู ุฐูู ุงูููุช ูุงููุงู ุงูุฐู ุชูููู ููุญุงุฑุจุฉ ุชุตููููุง ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุชุนููุฏ ุงููุชุงู ูู ุชุทุจููู. </p><br><p style=";text-align:right;direction:rtl">  ูุงูุฅุฌุงุจุฉ ุงูุซุงููุฉ ูู ุฃู ูุบุงุช FP ุชููุญู ุทุฑููุฉ ุณููุฉ ูุชุตููู ููุฒุงุชู ุจุญูุซ ุชุนูู ูุซู ุงูุณุงุนุฉ ุ ูุฅุฐุง ุฎุฑูุช ููุฒุฉ ุฌุฏูุฏุฉ ุงูููุทู ุงูุญุงูู ุ ูุฅููุง ุชุฎุงูู ุงูุดูุฑุฉ ุ ููู ุซู ุชุนุฑู ุฐูู ููุฑูุง. </p><br><hr><br><p style=";text-align:right;direction:rtl">  ููู ุชูู ุงูุฅุฌุงุจุงุช ููุณุช ูุงููุฉ.  ููุง ุฃุดุงุฑ ุตุฏููู ุฎูุงู ุฅุญุฏู ููุงูุดุงุชูุง ุ ูุฅู ุงูุชุญูู ุฅูู FP ุณูููู ุนุฏูู ุงููุงุฆุฏุฉ ุนูุฏูุง ูุง ุชุนุฑู ุฃูุถู ุงูููุงุฑุณุงุช.  ุฃูุชุฌุช ุตูุงุนุชูุง ุงููุจูุฑุฉ ุงูุนุฏูุฏ ูู ุงูููุงูุงุช ูุงููุชุจ ูุงูุฏุฑูุณ ุญูู ุชุตููู ุชุทุจููุงุช OOP ุ ููุฏููุง ุชุฌุฑุจุฉ ุฅูุชุงุฌ ูุน OOP ุ ูุฐูู ูุญู ูุนุฑู ูุง ูููู ุชููุนู ูู ุงูุทุฑู ุงููุฎุชููุฉ.  ูุณูุก ุงูุญุธ ุ ููุณ ูุฐุง ูู ุงูุญุงู ุจุงููุณุจุฉ ููุจุฑูุฌุฉ ุงููุธูููุฉ ุ ูุฐูู ุญุชู ูู ุชุญููุช ุฅูู FP ุ ูุฅู ูุญุงููุงุชู ุงูุฃููู ุณุชููู ุนูู ุงูุฃุฑุฌุญ ูุญุฑุฌุฉ ูุจุงูุชุฃููุฏ ูู ุชุฌูุจ ูู ุงููุชูุฌุฉ ุงููุฑุฌูุฉ: ุชุทููุฑ ุณุฑูุน ูุบูุฑ ูุคูู ููุฃูุธูุฉ ุงููุนูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุฐุง ุจุงูุถุจุท ูุง ูุฏูุฑ ุญููู ูุฐุง ุงูููุงู.  ููุง ููุช ุ ุณูุนูู ุนูู ุฅูุดุงุก ุชุทุจูู ูุดุจู ุงูุฅูุชุงุฌ ููุนุฑูุฉ ุงููุฑู. </p><br><h2 id="how-do-we-design-application" style=";text-align:right;direction:rtl">  ููู ูุตูู ุงูุชุทุจููุ </h2><br><p style=";text-align:right;direction:rtl">  ุงููุซูุฑ ูู ูุฐู ุงูุฃููุงุฑ ุงูุชู ุงุณุชุฎุฏูุชูุง ูู ุนูููุฉ ุงูุชุตููู ุงูุชู ุงุณุชุนุงุฑุชูุง ูู ุงููุชุงุจ ุงูุนุธูู " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุน ููุงุฐุฌ ุงููุฌุงู ุงููุธูููุฉ"</a> ุ ูุฐูู ุฃุดุฌุนู ุจุดุฏุฉ ุนูู ูุฑุงุกุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ุดูุฑุฉ ุงููุตุฏุฑ ุงููุงูู ูุน ุงูุชุนูููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุจุทุจูุนุฉ ุงูุญุงู ุ ูู ุฃุถุน ูู ุฐูู ููุง ุ ูุฐูู ุณูู ุฃูุดู ููุท ุนุจุฑ ุงูููุงุท ุงูุฑุฆูุณูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ูุฏููุง 4 ูุดุงุฑูุน ุฑุฆูุณูุฉ: ุทุจูุฉ ุงูุฃุนูุงู ุ ุทุจูุฉ ุงููุตูู ุฅูู ุงูุจูุงูุงุช ุ ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ูุจุทุจูุนุฉ ุงูุญุงู ุ ูุดุชุฑูุฉ.  ูู ุญู ูู ุ ุฃููุณ ูุฐููุ </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ูุน ููุฐุฌุฉ ูุฌุงููุง.  ูู ูุฐู ุงููุฑุญูุฉ ูุง ูุนุฑู ููุง ููุชู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุชู ุงูููุงู ุจู ุนู ูุตุฏ ุ ูุฃู ูุฌูุฏ ูุงุนุฏุฉ ุจูุงูุงุช ูุญุฏุฏุฉ ูู ุงูุงุนุชุจุงุฑ ูููู ุฅูู ุชุตููู ูุทุงููุง ููููุง ูุฐูู ุ ูุถุน ุนูุงูุฉ ุฌุฏูู ุงูููุงู ูุฐู ูู ุทุจูุฉ ุงูุนูู ุ ููุง ูุคุฏู ุฅูู ุญุฏูุซ ูุดููุงุช ูููุง ุจุนุฏ.  ูุง ุนููู ุณูู ุชูููุฐ <code>domain -&gt; DAL</code> ุงูุชุนููู <code>domain -&gt; DAL</code> ูุฑุฉ ูุงุญุฏุฉ ุ ูู ุญูู ุฃู ุงูุชุตููู ุงูุฎุงุทุฆ ุณูู ูุฒุนุฌูุง ุจุงุณุชูุฑุงุฑ ุญุชู ุงูููุทุฉ ุงูุชู ูุตูุญูุง.  ุฅููู ูุง ูููู ุจู: ูููู ุจุฅูุดุงุก ูุดุฑูุน ุจุงุณู <code>CardManagement</code> (ูุจุฏุน ููุบุงูุฉ ุ ูุฃูุง ุฃุนูู) ุ <code>&lt;TreatWarningsAsErrors&gt;true&lt;/TreatWarningsAsErrors&gt;</code> ุนูู ุงูููุฑ ุจุชุดุบูู ุงูุฅุนุฏุงุฏ <code>&lt;TreatWarningsAsErrors&gt;true&lt;/TreatWarningsAsErrors&gt;</code> ูู ููู ุงููุดุฑูุน.  ููุงุฐุง ูุญุชุงุฌ ูุฐุงุ  ุญุณููุง ุ ุณูุณุชุฎุฏู ุงูููุงุจุงุช ุงูุชูููุฒูุฉ ุจุดุฏุฉ ุ ูุนูุฏูุง ุชูุนู ูุทุงุจูุฉ ุงูุฃููุงุท ุ ูุฅู ุงููุชุฑุฌู ูุนุทููุง ุชุญุฐูุฑูุง ุ ุฅุฐุง ูู ูุบุทู ุฌููุน ุงูุญุงูุงุช ุงููุญุชููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> fail result = match result with | <span class="hljs-type"><span class="hljs-type">Ok</span></span> v -&gt; printfn <span class="hljs-string"><span class="hljs-string">"%A"</span></span> v //<span class="hljs-comment"><span class="hljs-comment">-- warning: Incomplete pattern matches on this expression. //-- For example, the value 'Error' may indicate a case not covered by the pattern(s).</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุนุฏุงุฏ ุ ูู ูุชู ุชุฌููุน ูุฐุง ุงูุฑูุฒ ุ ููู ุจุงูุถุจุท ูุง ูุญุชุงุฌ ุฅููู ุ ุนูุฏูุง ููุณุน ุงููุธุงุฆู ุงูุญุงููุฉ ููุฑูุฏ ุชุนุฏูููุง ูู ูู ููุงู.  ุงูุดูุก ุงูุชุงูู ุงูุฐู ูููู ุจู ูู ุฅูุดุงุก ูุญุฏุฉ ููุทูุฉ (ูุชู <code>CardDomain</code> ูุฆุฉ ุซุงุจุชุฉ) <code>CardDomain</code> .  ูู ูุฐุง ุงูููู ูุตููุง ุฃููุงุน ุงููุฌุงู ูููุณ ุฃูุซุฑ.  ุถุน ูู ุงุนุชุจุงุฑู ุฃูู ูู F # ุ ููู ุงูููุฏ ูุชุฑุชูุจ ุงููููุงุช: ุงูุชุฑุงุถููุง ุ ููููู ููุท ุงุณุชุฎุฏุงู ูุง ุฃุนููุชู ุณุงุจููุง. </p><br><h3 id="domain-types" style=";text-align:right;direction:rtl">  ุฃููุงุน ุงููุฌุงู </h3><br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ูู ุชุญุฏูุฏ <code>CardNumber</code> ุจุงุณุชุฎุฏุงู <code>CardNumber</code> ุงูุฐู ุฃุธูุฑุชู ูู ูุจู ุ ุนูู ุงูุฑุบู ูู ุฃููุง ุณูุญุชุงุฌ ุฅูู <code>Error</code> ุนููู ุฃูุซุฑ ูู ูุฌุฑุฏ ุณูุณูุฉ ุ ูุฐูู ุณูุณุชุฎุฏู <code>ValidationError</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidationError</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FieldPath</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> } let validationError field message = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FieldPath</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">field</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class"> } (*</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">{- Actually we should use here Luhn's algorithm, but I leave it to you as an exercise, so you can see for yourself how easy is updating code to new requirements. -}</span></span></span><span class="hljs-class">*) let private cardNumberRegex = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Regex</span></span></span><span class="hljs-class">("^[0-9]{16}$", </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RegexOptions</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Compiled</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> = private </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> of string with member this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class"> = match this with </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> s -&gt; s static member create fieldName str = match str with | (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class">|"") -&gt; validationError fieldName "card number can't be empty" | str -&gt; if cardNumberRegex.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IsMatch</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">str</span></span></span><span class="hljs-class">) then </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> str |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ok</span></span></span><span class="hljs-class"> else validationError fieldName "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> number must be a 16 digits string"</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูุญู ุจุงูุทุจุน ุชุญุฏูุฏ <code>Card</code> ุงูุชู ูู ููุจ ูุฌุงููุง.  ูุญู ูุนูู ุฃู ุงูุจุทุงูุฉ ุชุญุชูู ุนูู ุจุนุถ ุงูุณูุงุช ุงูุฏุงุฆูุฉ ูุซู ุงูุฑูู ูุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ ูุงูุงุณู ุนูู ุงูุจุทุงูุฉ ูุจุนุถ ุงููุนูููุงุช ุงููุงุจูุฉ ููุชุบููุฑ ูุซู ุงูุฑุตูุฏ ูุงูุญุฏ ุงููููู ุ ูุฐูู ูููู ุจุชุบููู ูุฐู ุงููุนูููุงุช ุงููุงุจูุฉ ููุชุบููุฑ ูู ููุน ุขุฎุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HolderId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Balance</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Money</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DailyLimit</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DailyLimit</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LetterString</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HolderId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Expiration</span></span></span><span class="hljs-class">: (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Month</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Year</span></span></span><span class="hljs-class">) </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountDetails</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardAccountInfo</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ููุงู ุนุฏุฉ ุฃููุงุน ููุง ุ ูุงูุชู ูู ูุนูู ุนููุง ุจุนุฏ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ูููุฏ</strong> </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูุณุชุฎุฏู <code>decimal</code> (ูุณูููู ุจุฐูู ุ ูููู ูุง ุจุดูู ูุจุงุดุฑ) ุ ููู <code>decimal</code> ุฃูู ูุตููุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุงุณุชุฎุฏุงูู ูุชูุซูู ุฃุดูุงุก ุฃุฎุฑู ุบูุฑ ุงูุฃููุงู ุ ููุญู ูุง ูุฑูุฏ ุฎูุทูุง.  ูุฐูู ูุญู ูุณุชุฎุฏู ููุน <code>type [&lt;Struct&gt;] Money = Money of decimal</code> ุงููุฎุตุต <code>type [&lt;Struct&gt;] Money = Money of decimal</code> . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>DailyLimit</strong> </p><br><p style=";text-align:right;direction:rtl">  ูููู ุถุจุท ุงูุญุฏ ุงููููู ุนูู ูุจูุบ ูุนูู ุฃู ูุชุบูุจ ุนูู ุงูุฅุทูุงู.  ุฅุฐุง ูุงู ููุฌูุฏุง ุ ูุฌุจ ุฃู ูููู ุฅูุฌุงุจูุง.  ุจุฏูุงู ูู ุงุณุชุฎุฏุงู <code>decimal</code> ุฃู <code>Money</code> ูุญุฏุฏ ูุฐุง ุงูููุน: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs">[&lt;<span class="hljs-type"><span class="hljs-type">Struct</span></span>&gt;] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DailyLimit</span></span></span><span class="hljs-class"> = private //</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- private constructor so it can't be created directly outside of module | Limit of Money | Unlimited with static member ofDecimal dec = if dec &gt; 0m then Money dec |&gt; Limit else Unlimited member this.ToDecimalOption() = match this with | Unlimited -&gt; None | Limit limit -&gt; Some limit.Value</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃูุซุฑ ูุตููุฉ ูู ูุฌุฑุฏ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู <code>0M</code> ูุนูู ุฃูู ูุง ููุฌุฏ ุญุฏ ุ ูุฃูู ูุฏ ูุนูู ุฃูุถูุง ุฃูู ูุง ููููู ุฅููุงู ุงูุฃููุงู ุนูู ูุฐู ุงูุจุทุงูุฉ.  ุงููุดููุฉ ุงููุญูุฏุฉ ูู ุฃููุง ูุฏ ุฃุฎูููุง ุงููููุดุฆ ุ ููุง ูููููุง ุงูููุงู ุจูุทุงุจูุฉ ุงูุฃููุงุท.  ูููู ูุง ุชููู ุ ูููููุง ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃููุงุท ูุดุทุฉ</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> (|<span class="hljs-type"><span class="hljs-type">Limit</span></span>|<span class="hljs-type"><span class="hljs-type">Unlimited</span></span>|) limit = match limit with | <span class="hljs-type"><span class="hljs-type">Limit</span></span> dec -&gt; <span class="hljs-type"><span class="hljs-type">Limit</span></span> dec | <span class="hljs-type"><span class="hljs-type">Unlimited</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Unlimited</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ููุท ูุทุงุจูุฉ <code>DailyLimit</code> ูู ููุงู ุจุงุนุชุจุงุฑู DU ุงูุนุงุฏูุฉ. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>LetterString</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุงุญุฏ ุจุณูุท.  ูุญู ูุณุชุฎุฏู ููุณ ุงูุฃุณููุจ ููุง ูู <code>CardNumber</code> .  ุดูุก ูุงุญุฏ ุนูู ุงูุฑุบู ูู ุฐูู: ูุง ุชูุงุฏ <code>LetterString</code> ุญูู ุงูุจุทุงูุงุช ุงูุงุฆุชูุงููุฉ ุ ุจู ูู ุดูุก ููุฌุจ ุฃู <code>CommonTypes</code> ูู ูุดุฑูุน <code>Common</code> ูู ูุญุฏุฉ <code>CommonTypes</code> .  ูุฃุชู ุงูููุช ุงูุฐู ููุชูู ููู <code>ValidationError</code> ุฅูู ููุงู ูููุตู ุฃูุถูุง. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ูุนุฑู ุงููุณุชุฎุฏู</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุงุญุฏ ูู ูุฌุฑุฏ ุงุณู ูุณุชุนุงุฑ <code>type UserId = System.Guid</code> .  ูุณุชุฎุฏููุง ููุตู ููุท. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุงูุดูุฑ ูุงูุณูุฉ</strong> </p><br><p style=";text-align:right;direction:rtl">  ุชูู ูุฌุจ ุฃู ุชุฐูุจ ุฅูู <code>Common</code> ุฃูุถุง.  ุณูุตุจุญ <code>Month</code> ุงุชุญุงุฏูุง <code>unsigned int16</code> ุจุทุฑู ูุชุญูููู ูู ูุฅูู <code>unsigned int16</code> ุ <code>unsigned int16</code> <code>Year</code> ูุซู <code>CardNumber</code> ูููู ุจุงููุณุจุฉ ูู <code>CardNumber</code> ุจุฏูุงู ูู ุงูุณูุณูุฉ. </p><br></li></ol><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนูุง ูููู ุฅุนูุงู ุฃููุงุน ูุทุงููุง.  ูุญุชุงุฌ ุฅูู <code>User</code> ูุฏูู ุจุนุถ ูุนูููุงุช ุงููุณุชุฎุฏู ูุฌูุน ุงูุจุทุงูุงุช ุ ููุญุชุงุฌ ุฅูู ุนูููุงุช ุงูุชูุงุฒู ูุนูููุงุช ุงูุดุญู ูุงููุฏููุนุงุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserInfo</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LetterString</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Address</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Address</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserInfo</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cards</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> } [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Struct</span></span></span><span class="hljs-class">&gt;] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BalanceChange</span></span></span><span class="hljs-class"> = //</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- another common type with validation for positive amount | Increase of increase: MoneyTransaction | Decrease of decrease: MoneyTransaction with member this.ToDecimal() = match this with | Increase i -&gt; i.Value | Decrease d -&gt; -d.Value [&lt;Struct&gt;] type BalanceOperation = { CardNumber: CardNumber Timestamp: DateTimeOffset BalanceChange: BalanceChange NewBalance: Money }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฌูุฏ ุ ููุฏ ุตูููุง ุฃููุงุนูุง ุจุทุฑููุฉ ูุง ูููู ุชูุซูููุง ูู ุญุงูุฉ ุบูุฑ ุตุงูุญุฉ.  ุงูุขู ูููุง ุชุนุงูููุง ูุน ูุซูู ูุฃู ูู ูุฐู ุงูุฃููุงุน ุ ูุญู ุนูู ูููู ูู ุฃู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ููู ุตุงูุญุฉ ูููุณ ูู ุงูุถุฑูุฑู ุงูุชุญูู ูู ุตุญุชูุง ูุฑุฉ ุฃุฎุฑู.  ุงูุขู ูููููุง ุงููุถู ูุฏูุง ูู ููุทู ุงูุฃุนูุงู! </p><br><h3 id="business-logic" style=";text-align:right;direction:rtl">  ููุทู ุงูุนูู </h3><br><p style=";text-align:right;direction:rtl">  ุณูููู ูุฏููุง ูุงุนุฏุฉ ุบูุฑ ูุงุจูุฉ ูููุณุฑ ููุง: ุณูุชู ุชุฑููุฒ ูู ููุทู ุงูุนูู ูู <strong>ูุธุงุฆู ุฎุงูุตุฉ</strong> .  ุงููุธููุฉ ุงูุจุญุชุฉ ูู ูุธููุฉ ุชุณุชููู ุงููุนุงููุฑ ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุดูุก ุงููุญูุฏ ุงูุฐู ููุนูู ูู ูุญุณุจ ูููุฉ ุงูุฅุฎุฑุงุฌ.  ููุณ ูู ุฃู ุขุซุงุฑ ุฌุงูุจูุฉ ุนูู ุงูุฅุทูุงู. </li><li style=";text-align:right;direction:rtl">  ุชูุชุฌ ุฏุงุฆูุง ููุณ ุงููุงุชุฌ ูููุณ ุงููุฏุฎูุงุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ููู ุซู ุ ูุง ุชุทุฑุญ ุงููุธุงุฆู ุงูุฎุงูุตุฉ ุงุณุชุซูุงุกุงุช ุ ููุง ุชูุชุฌ ููููุง ุนุดูุงุฆูุฉ ุ ููุง ุชุชูุงุนู ูุน ุงูุนุงูู ุงูุฎุงุฑุฌู ุจุฃู ุดูู ูู ุงูุฃุดูุงู ุ ุณูุงุก ุฃูุงูุช ูุงุนุฏุฉ ุจูุงูุงุช ุฃู <code>DateTime.Now</code> ุจุณูุทูุง.  ุจุงูุทุจุน ุงูุชูุงุนู ูุน ูุธููุฉ ูุฌุณ ุชููุงุฆูุง ูุฌุนู ุงุณุชุฏุนุงุก ูุธููุฉ ูุฌุณ.  ุฅุฐู ูุง ุงูุฐู ูุฌุจ ุนูููุง ุชูููุฐูุ </p><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ูุงุฆูุฉ ุจุงููุชุทูุจุงุช ุงูุชู ูุฏููุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุชูุดูุท / ุฅูุบุงุก ุชูุดูุท ุงูุจุทุงูุฉ</strong> </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุงููุฏููุนุงุช ุงูุนูููุฉ</strong> </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ูุนุงูุฌุฉ ุงูุฏูุน ุฅุฐุง: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุจุทุงูุฉ ููุณุช ููุชููุฉ ุงูุตูุงุญูุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุจุทุงูุฉ ูุดุทุฉ </li><li style=";text-align:right;direction:rtl">  ููุงู ูุง ูููู ูู ุงููุงู ููุฏูุน </li><li style=";text-align:right;direction:rtl">  ุงูุฅููุงูุงุช ููุฐุง ุงูููู ูู ุชุชุฌุงูุฒ ุงูุญุฏ ุงููููู. </li></ol><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุฒูุงุฏุฉ ุงูุฑุตูุฏ</strong> </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุชุนุจุฆุฉ ุฑุตูุฏ ุงูุจุทุงูุฉ ุงููุดุทุฉ ูุบูุฑ ุงูููุชููุฉ ุงูุตูุงุญูุฉ. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ุชุนููู ุงูุญุฏ ุงููููู</strong> </p><br><p style=";text-align:right;direction:rtl">  ูููู ูููุณุชุฎุฏู ุชุญุฏูุฏ ุงูุญุฏ ุงููููู ุฅุฐุง ูุงูุช ุงูุจุทุงูุฉ ุบูุฑ ููุชููุฉ ุงูุตูุงุญูุฉ ููุดุทุฉ. </p><br></li></ul><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุชุนุฐุฑ ุฅููุงู ุงูุนูููุฉ ุ ูุชุนูู ุนูููุง ุฅุฑุฌุงุน ุฎุทุฃ ุ ูุฐูู ูุญุชุงุฌ ุฅูู ุชุนุฑูู <code>OperationNotAllowedError</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OperationNotAllowedError</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Operation</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Reason</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> } //</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- and a helper function to wrap it in `Error` which is a case for `Result&lt;'ok,'error&gt; type let operationNotAllowed operation reason = { Operation = operation; Reason = reason } |&gt; Error</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุญุฏุฉ ุ ูููู ููุทู ุงูุฃุนูุงู ูู ููุน ุงูุฎุทุฃ <em>ุงููุญูุฏ</em> ุงูุฐู ูุนูุฏ ุฅููู.  ูุญู ูุง ูููู ุจุงูุชุญูู ูู ููุง ุ ูุง ูุชูุงุนู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช - ููุท ูููุฐ ุงูุนูููุงุช ุฅุฐุง ูุงู ุจุฅููุงููุง ุฅุฑุฌุงุน <code>OperationNotAllowedError</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุญุฏุฉ ูุงููุฉ ููููู ุงูุงุทูุงุน <a href="">ููุง</a> .  ุณุฃุฏุฑุฌ ููุง ุฃุตุนุจ ุงูุญุงูุงุช ููุง: <code>processPayment</code> .  ูุชุนูู ุนูููุง ุงูุชุญูู ูู ุงูุชูุงุก ุงูุตูุงุญูุฉ ูุงูุญุงูุฉ ุงููุดุทุฉ / ุบูุฑ ุงููุดุทุฉ ูุงูุฃููุงู ุงูุชู ูุชู ุฅููุงููุง ุงูููู ูุงูุชูุงุฒู ุงูุญุงูู.  ูุธุฑูุง ูุฃููุง ูุง ูุณุชุทูุน ุงูุชูุงุนู ูุน ุงูุนุงูู ุงูุฎุงุฑุฌู ุ ูุชุนูู ุนูููุง ุชูุฑูุฑ ุฌููุน ุงููุนูููุงุช ุงููุงุฒูุฉ ููุนููุงุช.  ุจูุฐู ุงูุทุฑููุฉ ุณูููู ูุฐุง <em>ุงูููุทู</em> ุณููุงู ููุบุงูุฉ ุ ููุณูุญ ูู ุจุฅุฌุฑุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุฎุชุจุงุฑ ูุงุฆู ุนูู ุงูููุชููุงุช</a> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> processPayment (currentDate: <span class="hljs-type"><span class="hljs-type">DateTimeOffset</span></span>) (spentToday: <span class="hljs-type"><span class="hljs-type">Money</span></span>) card (paymentAmount: <span class="hljs-type"><span class="hljs-type">MoneyTransaction</span></span>) = //<span class="hljs-comment"><span class="hljs-comment">-- first check for expiration if isCardExpired currentDate card then cardExpiredMessage card.CardNumber |&gt; processPaymentNotAllowed else //-- then active/deactivated match card.AccountDetails with | Deactivated -&gt; cardDeactivatedMessage card.CardNumber |&gt; processPaymentNotAllowed | Active accInfo -&gt; //-- if active then check balance if paymentAmount.Value &gt; accInfo.Balance.Value then sprintf "Insufficent funds on card %s" card.CardNumber.Value |&gt; processPaymentNotAllowed else //-- if balance is ok check limit and money spent today match accInfo.DailyLimit with | Limit limit when limit &lt; spentToday + paymentAmount -&gt; sprintf "Daily limit is exceeded for card %s with daily limit %M. Today was spent %M" card.CardNumber.Value limit.Value spentToday.Value |&gt; processPaymentNotAllowed (*{- We could use here the ultimate wild card case like this: | _ -&gt; but it's dangerous because if a new case appears in `DailyLimit` type, we won't get a compile error here, which would remind us to process this new case in here. So this is a safe way to do the same thing. -}*) | Limit _ | Unlimited -&gt; let newBalance = accInfo.Balance - paymentAmount let updatedCard = { card with AccountDetails = Active { accInfo with Balance = newBalance } } //-- note that we have to return balance operation, //-- so it can be stored to DB later. let balanceOperation = { Timestamp = currentDate CardNumber = card.CardNumber NewBalance = newBalance BalanceChange = Decrease paymentAmount } Ok (updatedCard, balanceOperation)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง <code>spentToday</code> - ุณูุญุชุงุฌ ุฅูู ุญุณุงุจู ูู ูุฌููุนุฉ <code>BalanceOperation</code> ุจูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุฐูู ุณูุญุชุงุฌ ุฅูู ูุญุฏุฉ ูุฐูู ุ ูุงูุชู ุณูููู ููุง ุฃุณุงุณูุง ูุธููุฉ ุนุงูุฉ ูุงุญุฏุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> private isDecrease change = match change with | <span class="hljs-type"><span class="hljs-type">Increase</span></span> _ -&gt; false | <span class="hljs-type"><span class="hljs-type">Decrease</span></span> _ -&gt; true <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> spentAtDate (date: <span class="hljs-type"><span class="hljs-type">DateTimeOffset</span></span>) cardNumber operations = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> date = date.<span class="hljs-type"><span class="hljs-type">Date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> operationFilter { <span class="hljs-type"><span class="hljs-type">CardNumber</span></span> = number; <span class="hljs-type"><span class="hljs-type">BalanceChange</span></span> = change; <span class="hljs-type"><span class="hljs-type">Timestamp</span></span> = timestamp } = isDecrease change &amp;&amp; number = cardNumber &amp;&amp; timestamp.<span class="hljs-type"><span class="hljs-type">Date</span></span> = date <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> spendings = <span class="hljs-type"><span class="hljs-type">List</span></span>.filter operationFilter operations <span class="hljs-type"><span class="hljs-type">List</span></span>.sumBy (fun s -&gt; -s.<span class="hljs-type"><span class="hljs-type">BalanceChange</span></span>.<span class="hljs-type"><span class="hljs-type">ToDecimal</span></span>()) spendings |&gt; <span class="hljs-type"><span class="hljs-type">Money</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฌูุฏุฉ.  ุงูุขู ูุจุนุฏ ุฃู ุงูุชูููุง ูู ุชูููุฐ ููุทู ุงูุฃุนูุงู ุ ุญุงู ุงูููุช ููุชูููุฑ ูู ุฑุณู ุงูุฎุฑุงุฆุท.  ูุณุชุฎุฏู ุงููุซูุฑ ูู ุฃููุงุนูุง ููุงุจุงุช ุชุชููุฒ ุจุงูุชูููุฒ ุ ูุจุนุถ ุฃููุงุนูุง ููุณ ููุง ููุดุฆ ุนุงู ุ ูุฐูู ูุง ูููููุง ุชุนุฑูุถูุง ููุง ูู ููุนุงูู ุงูุฎุงุฑุฌู.  ุณูุญุชุงุฌ ุฅูู ุงูุชุนุงูู ูุน (de) ุงูุชุณูุณู.  ุฅูู ุฌุงูุจ ุฐูู ุ ูุฏููุง ุงูุขู ุณูุงู ูุงุญุฏ ูุญุฏูุฏ ูู ุทูุจูุง ุ ูููู ูู ููุช ูุงุญู ูู ุงูุญูุงุฉ ุงูุญููููุฉ ูุฏ ุชุฑุบุจ ูู ุจูุงุก ูุธุงู ุฃูุจุฑ ูุน ุณูุงูุงุช ูุชุนุฏุฏุฉ ุงูุญุฏูุฏ ุ ูุนูููู ุงูุชูุงุนู ูุน ุจุนุถูู ุงูุจุนุถ ูู ุฎูุงู ุงูุนููุฏ ุงูุนุงูุฉ ุ ูุงูุชู ููุจุบู ุฃู ุชููู ูููููุฉ ููุฌููุน ุ ุจูุง ูู ุฐูู ูุบุงุช ุงูุจุฑูุฌุฉ ุงูุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูุชุนูู ุนูููุง ุงูููุงู ุจุชุนููู ุงูุงุชุฌุงููู: ูู ุงูููุงุฐุฌ ุงูุนุงูุฉ ุฅูู ุงููุฌุงู ูุงูุนูุณ ุจุงูุนูุณ.  ุนูู ุงูุฑุบู ูู ุฃู ุงูุชุนููู ูู ุงููุฌุงู ุฅูู ุงูููุงุฐุฌ ูุถูู ุฅูู ุงูุฃูุงู ุ ูุฅู ุงูุงุชุฌุงู ุงูุขุฎุฑ ูุญุชูู ุนูู ุงููููู ูู ุงููุฎูู: ูููู ุฃู ุชุญุชูู ุงูููุงุฐุฌ ุนูู ุจูุงูุงุช ุบูุฑ ุตุงูุญุฉ ุ ุจุนุฏ ูู ุดูุก ูุณุชุฎุฏู ุฃููุงุนูุง ุนุงุฏูุฉ ูููู ุชุณูุณููุง ุฅูู json.  ูุง ุชููู ุ ุณูุชุนูู ุนูููุง ุฅูุดุงุก ุงูุชุญูู ูู ุงูุตุญุฉ ูู ูุฐุง ุงูุชุนููู.  ุญูููุฉ ุฃููุง ูุณุชุฎุฏู ุฃููุงุนูุง ูุฎุชููุฉ ูุจูุงูุงุช ูุจูุงูุงุช ุฑุจูุง ุชููู ุบูุฑ ุตุงูุญุฉ ุ ููุฐุง ูุนูู <strong>ุฏุงุฆููุง</strong> ุฃู ูุฐุง ุงููุชุฑุฌู ูู ูุณูุญ ููุง ุจุฃู ููุณู ุชูููุฐ ุนูููุฉ ุงูุชุญูู ูู ุงูุตุญุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฅููู ูุง ูุจุฏู ุนููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs">(*<span class="hljs-comment"><span class="hljs-comment">{- You can use type aliases to annotate your functions. This is just an example, but sometimes it makes code more readable -}</span></span>*) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidateCreateCardCommand</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCardCommandModel</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidationResult</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class">&gt; let validateCreateCardCommand : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidateCreateCardCommand</span></span></span><span class="hljs-class"> = fun cmd -&gt; (*</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">{- that's a computation expression for `Result&lt;&gt;` type. Thanks to this we don't have to chose between short code and strait forward one, like we have to do in C# -}</span></span></span><span class="hljs-class">*) result { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LetterString</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cardNumber</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">month</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Month</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">expirationMonth</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExpirationMonth</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">year</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Year</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">expirationYear</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExpirationYear</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HolderId</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Expiration</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">month</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">year</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountDetails</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountInfo</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Default</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Active</span></span></span><span class="hljs-class"> } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุฏุฉ ูุงููุฉ ููุชุนูููุงุช ูุงูุชุญูู ูู ุตุญุฉ <a href="">ููุง</a> ููุญุฏุฉ ููุชุนููู ููููุงุฐุฌ <a href="">ููุง</a> . </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ูุฏููุง ุชุทุจูู ููู ููุทู ุงูุฃุนูุงู ูุงูุชุนูููุงุช ูุงูุชุญูู ูู ุงูุตุญุฉ ููุง ุฅูู ุฐูู ุ ููู ูุฐุง ูุนุฒูู ุชูุงููุง ุนู ุงูุนุงูู ุงููุงูุนู: ุฅูู ููุชูุจ ูู ูุธุงุฆู ุฎุงูุตุฉ ุชูุงููุง.  ุฃูุช ุงูุขู ุฑุจูุง ุชุชุณุงุกู ุ ููู ุจุงูุถุจุท ุณูุณุชููุฏ ูู ูุฐุงุ  ูุฃู ูุฏููุง ููุชูุงุนู ูุน ุงูุนุงูู ุงูุฎุงุฑุฌู.  ุฃูุซุฑ ูู ุฐูู ุ ุฎูุงู ุชูููุฐ ุณูุฑ ุงูุนูู ุ ูุชุนูู ุนูููุง ุงุชุฎุงุฐ ุจุนุถ ุงููุฑุงุฑุงุช ุจูุงุกู ุนูู ูุชุงุฆุฌ ุชูู ุงูุชูุงุนูุงุช ูู ุงูุนุงูู ุงูุญูููู.  ูุฐุง ูุฅู ุงูุณุคุงู ูู ููู ูููููุง ุชุฌููุน ูู ูุฐุงุ  ูู OOP ูุณุชุฎุฏููู ุญุงููุงุช IoC ูุฑุนุงูุฉ ุฐูู ุ ูููู ููุง ูุง ูููููุง ุงูููุงู ุจุฐูู ุ ูุธุฑูุง ูุฃููุง ูุง ูููู ุญุชู ูุงุฆูุงุช ุ ูุฏููุง ูุธุงุฆู ุซุงุจุชุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณูู ูุณุชุฎุฏู <code>Interpreter pattern</code> ูุฐูู!  ุฅูู ุฃูุฑ ุตุนุจ ุจุนุถ ุงูุดูุก ุ ูุฃูู ูู ุงูุบุงูุจ ุบูุฑ ูุฃููู ุ ููููู ุณุฃุจุฐู ูุตุงุฑู ุฌูุฏู ูุดุฑุญ ูุฐุง ุงูููุท.  ุฃููุงู ุ ุฏุนูุง ูุชุญุฏุซ ุนู ุชูููู ุงููุธููุฉ.  ุนูู ุณุจูู ุงููุซุงู ูุฏููุง ุฏุงูุฉ <code>int -&gt; string</code> .  ูุฐุง ูุนูู ุฃู ุงูุฏุงูุฉ ุชุชููุน <code>int</code> ููุนููุฉ ูุฅุฑุฌุงุน ุงูุณูุณูุฉ.  ุงูุขู ุฏุนูุง ูููู ูุฏููุง <code>string -&gt; char</code> ูุธููุฉ ุฃุฎุฑู <code>string -&gt; char</code> .  ูู ูุฐู ุงููุฑุญูุฉ ุ ูููููุง ุฃู ูุฑุจุทูุง ุจุณูุณูุฉ ุ ุฃู ุฃู ูููุฐ ุฃููุงู ุ ููุฎุฑุฌู ููุบุฐูู ุฅูู ุงููุธููุฉ ุงูุซุงููุฉ ุ ูููุงู ุญุชู ูุดุบู ูุฐูู: <code>&gt;&gt;</code> .  ุฅููู ููู ุชุนูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> intToString (i: int) = i.<span class="hljs-type"><span class="hljs-type">ToString</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstCharOrSpace (s: string) = match s with | (null| <span class="hljs-string"><span class="hljs-string">""</span></span>) -&gt; ' ' | s -&gt; s.[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstDigitAsChar = intToString &gt;&gt; firstCharOrSpace //<span class="hljs-comment"><span class="hljs-comment">-- And you can chain as many functions as you like let alwaysTrue = intToString &gt;&gt; firstCharOrSpace &gt;&gt; Char.IsDigit</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุง ูููููุง ุงุณุชุฎุฏุงู ุชุณูุณู ุจุณูุท ูู ุจุนุถ ุงูุณููุงุฑูููุงุช ุ ูุซู ุจุทุงูุฉ ุงูุชูุดูุท.  ุฅููู ุณูุณูุฉ ูู ุงูุฅุฌุฑุงุกุงุช: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุตุญุฉ ุฑูู ุจุทุงูุฉ ุงูุฅุฏุฎุงู.  ุฅุฐุง ูุงู ุตุญูุญุง ุ ุซู </li><li style=";text-align:right;direction:rtl">  ูุญุงููุฉ ููุญุตูู ุนูู ุจุทุงูุฉ ูู ูุฐุง ุงูุฑูู.  ุฅุฐุง ูุงู ููุงู ูุงุญุฏ </li><li style=";text-align:right;direction:rtl">  ุชูุนูููุง. </li><li style=";text-align:right;direction:rtl">  ุญูุธ ุงููุชุงุฆุฌ.  ุฅุฐุง ูุงู ูู ุดูุก ุนูู ูุงูุฑุงู </li><li style=";text-align:right;direction:rtl">  ุฎุฑูุทุฉ ููููุฐุฌ ูุงูุนูุฏุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุฃูู ุฎุทูุชูู ููุง ุฃู <code>If it's ok then...</code>  ูุฐุง ูู ุงูุณุจุจ ูู ุฃู ุงูุชุณูุณู ุงููุจุงุดุฑ ูุง ูุนูู. </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุจุจุณุงุทุฉ ุญูู ูุฐู ุงููุธุงุฆู ููุนููุงุช ุ ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">let</span></span> activateCard getCardAsync saveCardAsync cardNumber = ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ููุงู ุจุนุถ ุงููุดุงูู ูู ุฐูู.  ุฃููุงู ุ ูููู ุฃู ูููู ุนุฏุฏ ุงูุชุจุนูุงุช ุงููุจูุฑุฉ ูุณูุธูุฑ ุชูููุน ุงููุธููุฉ ุจุดูู ูุจูุญ.  ุซุงููุงู ุ ูุญู ูุฑุชุจุทูู ุจุชุฃุซูุฑุงุช ูุญุฏุฏุฉ ููุง: ูุฌุจ ุฃู ูุฎุชุงุฑ ูุง ุฅุฐุง ูุงูุช <code>Task</code> ุฃู <code>Async</code> ุฃู ููุงููุงุช ูุฒุงููุฉ ุนุงุฏูุฉ ููุท.  ุซุงูุซูุง ุ ูู ุงูุณูู <code>createUserAsync</code> ุงูุฃููุฑ ุนูุฏูุง ูููู ูุฏูู ุงูุนุฏูุฏ ูู ุงููุธุงุฆู ูุชูุฑูุฑูุง: ุนูู ุณุจูู ุงููุซุงู ุ ูุฏู <code>replaceUserAsync</code> ู <code>replaceUserAsync</code> ููุณ ุงูุชูููุน ูููู ูู ุชุฃุซูุฑุงุช ูุฎุชููุฉ ุ ูุฐูู ุนูุฏูุง ุชุถุทุฑ ุฅูู ุงุฌุชูุงุฒ ูุฐู ุงููุฆุงุช ูู ุงููุฑุงุช ุ ููููู ุงุฑุชูุงุจ ุฎุทุฃ ุจุฃุนุฑุงุถ ุบุฑูุจุฉ ุญููุง.  ุจุณุจุจ ูุฐู ุงูุฃุณุจุงุจ ูุฐูุจ ูููุชุฑุฌููู ุงูููุฑููู. </p><br><p style=";text-align:right;direction:rtl">  ูุงูููุฑุฉ ูู ุฃููุง ููุณู ุฑูุฒ ุงูุชูููู ุงูุฎุงุต ุจูุง ุฅูู ูุณููู: ุดุฌุฑุฉ ุงูุชูููุฐ ููุชุฑุฌู ูุชูู ุงูุดุฌุฑุฉ.  ูู ุนูุฏุฉ ูู ูุฐู ุงูุดุฌุฑุฉ ูู ููุงู ููุธููุฉ ุฐุงุช ุชุฃุซูุฑ ูุฑูุฏ <code>getUserFromDatabase</code> ุ ูุซู <code>getUserFromDatabase</code> .  ูุชู ุชุนุฑูู ูุฐู ุงูุนูุฏ ุจุงูุงุณู ุ ุนูู ุณุจูู ุงููุซุงู <code>getCard</code> ุ ููุน ูุนููุฉ ุงูุฅุฏุฎุงู ุ ุนูู ุณุจูู ุงููุซุงู <code>CardNumber</code> ูููุน ุงูุฅุฑุฌุงุน ุ ูุซู <code>Card option</code> .  ูุง ูุญุฏุฏ ููุง <code>Task</code> ุฃู <code>Async</code> ุ ููุฐุง ููุณ ุฌุฒุก ุงูุดุฌุฑุฉ ุ <em>ุฅูู ุฌุฒุก ูู ุงููุชุฑุฌู ุงูููุฑู</em> .  ูู ุญุงูุฉ ูุฐู ุงูุดุฌุฑุฉ ุนุจุงุฑุฉ ุนู ุณูุณูุฉ ูู ุงูุชุญููุงุช ุงูุฎุงูุตุฉ ุ ูุซู ุงูุชุญูู ูู ุงูุตุญุฉ ุฃู ุชูููุฐ ูุธููุฉ ููุทู ุงูุฃุนูุงู.  ุชุญุชูู ุงูุญูุงู ุฃูุถูุง ุนูู ุจุนุถ ุงููุฏุฎูุงุช ุ ูุซู ุฑูู ุจุทุงูุฉ ุงูุณูุณูุฉ ุงูุฎุงู ุ ุซู ููุงู ุนูููุฉ ุชุญูู ุ ูุงูุชู ูููู ุฃู ุชุนุทููุง ุฎุทุฃ ุฃู ุฑูู ุจุทุงูุฉ ุตุงูุญ.  ุฅุฐุง ูุงู ููุงู ุฎุทุฃ ุ ูุณูู ููุทุน ูุฐู ุงูุญุงูุฉ ุ ูุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ <code>getCard</code> ุจูุง ุฅูู ุงูุนูุฏุฉ ุงูุชุงููุฉ: <code>getCard</code> .  ุฅุฐุง ูุงูุช ูุฐู ุงูุนูุฏุฉ ุณุชุนูุฏ <code>Some card</code> ุ ููููููุง ุงููุชุงุจุนุฉ ุฅูู ุงูุญุงูุฉ ุงูุชุงููุฉ ุ ูุงูุชู ุณุชููู ุงูุชูุดูุท ุ ูููุฐุง. </p><br><p style=";text-align:right;direction:rtl">  ููู ุณููุงุฑูู ูุซู <code>activateCard</code> ุฃู <code>topUp</code> ุฃู <code>topUp</code> ุณูุนูู ุนูู ุจูุงุก ุดุฌุฑุฉ ูููุตูุฉ.  ุนูุฏูุง ูุชู ุจูุงุก ุชูู ุงูุฃุดุฌุงุฑ ุ ุชููู ุงูุนูุฏ ุงูุฎุงุตุฉ ุจูุง ุฎุงููุฉ ููุนูุง ูุง ุ ูููุณ ูุฏููุง ูุธุงุฆู ุญููููุฉ ูููุง ุ <em>ุจู ููุง ููุงู</em> ูุชูู ุงููุธุงุฆู.  ูุฏู ุงููุชุฑุฌู ุงูุดููู ูู ููุก ูุฐู ุงูุนูุฏ ุ ุจูุฐู ุงูุจุณุงุทุฉ.  ูุนุฑู ุงููุชุฑุฌู ุงูุขุซุงุฑ ุงูุชู ูุณุชุฎุฏููุง ุ ุนูู ุณุจูู ุงููุซุงู <code>Task</code> ุ ููุนุฑู ุงููุธููุฉ ุงูุญููููุฉ ุงูุชู ูุฌุจ ูุถุนูุง ูู ุนูุฏุฉ ูุนููุฉ.  ุนูุฏูุง ูุฒูุฑ ุนูุฏุฉ ุ ูุฅูู ูููุฐ ุงููุธููุฉ ุงูุญููููุฉ ุงูููุงุจูุฉ ุ ูููุชุธุฑูุง ูู ุญุงูุฉ <code>Task</code> ุฃู <code>Async</code> ุ ูููุฑุฑ ุงููุชูุฌุฉ ุฅูู ุงูุญุงูุฉ ุงูุชุงููุฉ.  ูุฏ ุชุคุฏู ูุฐู ุงูุญุงูุฉ ุฅูู ุนูุฏุฉ ุฃุฎุฑู ุ ููู ุซู ููู ุนูู ูููุชุฑุฌู ุงูููุฑู ูุฑุฉ ุฃุฎุฑู ุ ุญุชู ูุตู ูุฐุง ุงููุชุฑุฌู ุฅูู ุนูุฏุฉ ุงูุฅููุงู ุ ุฃุณูู ุงูุนูุฏูุฉ ุ ุญูุซ ูุนูุฏ ููุท ูุชูุฌุฉ ุงูุชูููุฐ ุงููุงูู ูุดุฌุฑุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ุณูุชู ุชูุซูู ุงูุดุฌุฑุฉ ุจุฃููููุง ุจููุงุจุฉ ุชูููุฒูุฉ ุ ูุณุชุจุฏู ุงูุนูุฏุฉ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'a&gt; = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) //</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- &lt;- THE NODE | ... //-- ANOTHER NODE</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณุชููู ุฏุงุฆููุง ุนุจุงุฑุฉ ุนู tuple ุ ุญูุซ ูููู ุงูุนูุตุฑ ุงูุฃูู ูู ูุฏุฎูุงุช ููุชุจุนูุฉ ุ ูุงูุนูุตุฑ ุงูุฃุฎูุฑ ูู <em>ูุธููุฉ</em> ุ ุชุชููู ูุชูุฌุฉ ูุฐู ุงูุชุจุนูุฉ.  ูุฐู "ุงููุณุงูุฉ" ุจูู ุนูุงุตุฑ tuple ูู ุงูููุงู ุงูุฐู ุณุชูุงุณุจ ููู ุงูุชุจุนูุฉ ุงูุฎุงุตุฉ ุจู ุ ููุง ูู ุงูุญุงู ูู ุฃูุซูุฉ ุงูุชูููู ูุฐู ุ ุญูุซ ูุฏูู ูุธููุฉ <code>'a -&gt; 'b</code> <code>'c -&gt; 'd</code> ุ <code>'c -&gt; 'd</code> ุ ูุชุญุชุงุฌ ุฅูู ูุถุน ุนูุตุฑ ุขุฎุฑ <code>'b -&gt; 'c</code> ุจูู ุจููููุง ููุงุชุตุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง ุฏุงุฎู ุณูุงููุง ุงููุญุตูุฑ ุ ููู ูููู ูุฏููุง ุงููุซูุฑ ูู ุงูุชุจุนูุงุช ุ ูุฅุฐุง ูุนููุง ุฐูู - ูุฑุจูุง ุญุงู ุงูููุช ูุชูุณูู ุณูุงููุง ุฅูู ูุณุชูุฏุงุช ุฃุตุบุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุฅููู ูุง ูุจุฏู ุนููู ุ ุงููุตุฏุฑ ุงููุงูู <a href="">ููุง</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'a&gt; = | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> * ((</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class">*</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountInfo</span></span></span><span class="hljs-class">) option -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'a&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> of (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class">*</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountInfo</span></span></span><span class="hljs-class">) * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Result</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataRelatedError</span></span></span><span class="hljs-class">&gt; -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Result</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataRelatedError</span></span></span><span class="hljs-class">&gt; -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserInfo</span></span></span><span class="hljs-class"> * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Result</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataRelatedError</span></span></span><span class="hljs-class">&gt; -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> of (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateTimeOffset</span></span></span><span class="hljs-class"> * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateTimeOffset</span></span></span><span class="hljs-class">) * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BalanceOperation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BalanceOperation</span></span></span><span class="hljs-class"> * (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Result</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataRelatedError</span></span></span><span class="hljs-class">&gt; -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class"> of 'a (*</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">{- This bind function allows you to pass a continuation for current node of your expression tree the code is basically a boiler plate, as you can see. -}</span></span></span><span class="hljs-class">*) let rec bind f instruction = match instruction with | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">)) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class"> x -&gt; fx (*</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">{- This is a set of basic functions. Use them in your expression tree builder to represent dependency call -}</span></span></span><span class="hljs-class">*) let stop x = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class"> x let getCardByNumber number = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stop</span></span></span><span class="hljs-class">) let getCardWithAccountInfo number = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stop</span></span></span><span class="hljs-class">) let createNewCard (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">acc</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> ((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">acc</span></span></span><span class="hljs-class">), stop) let replaceCard card = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stop</span></span></span><span class="hljs-class">) let getUserById id = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stop</span></span></span><span class="hljs-class">) let createNewUser user = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stop</span></span></span><span class="hljs-class">) let getBalanceOperations (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fromDate</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toDate</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> ((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fromDate</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toDate</span></span></span><span class="hljs-class">), stop) let saveBalanceOperation op = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stop</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> With a help of <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">computation expressions</a> , we now have a very easy way to build our workflows without having to care about implementation of real-world interactions. We do that in <a href="">CardWorkflow module</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs">(*<span class="hljs-comment"><span class="hljs-comment">{- `program` is the name of our computation expression. In every `let!` binding we unwrap the result of operation, which can be either `Program&lt;'a&gt;` or `Program&lt;Result&lt;'a, Error&gt;&gt;`. What we unwrap would be of type 'a. If, however, an operation returns `Error`, we stop the execution at this very step and return it. The only thing we have to take care of is making sure that type of error is the same in every operation we call -}</span></span>*) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> processPayment (currentDate: <span class="hljs-type"><span class="hljs-type">DateTimeOffset</span></span>, payment) = program { (*<span class="hljs-comment"><span class="hljs-comment">{- You can see these `expectValidationError` and `expectDataRelatedErrors` functions here. What they do is map different errors into `Error` type, since every execution branch must return the same type, in this case `Result&lt;'a, Error&gt;`. They also help you quickly understand what's going on in every line of code: validation, logic or calling external storage. -}</span></span>*) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>! cmd = validateProcessPaymentCommand payment |&gt; expectValidationError <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>! card = tryGetCard cmd.<span class="hljs-type"><span class="hljs-type">CardNumber</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> today = currentDate.<span class="hljs-type"><span class="hljs-type">Date</span></span> |&gt; <span class="hljs-type"><span class="hljs-type">DateTimeOffset</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tomorrow = currentDate.<span class="hljs-type"><span class="hljs-type">Date</span></span>.<span class="hljs-type"><span class="hljs-type">AddDays</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span> |&gt; <span class="hljs-type"><span class="hljs-type">DateTimeOffset</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>! operations = getBalanceOperations (cmd.<span class="hljs-type"><span class="hljs-type">CardNumber</span></span>, today, tomorrow) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> spentToday = <span class="hljs-type"><span class="hljs-type">BalanceOperation</span></span>.spentAtDate currentDate cmd.<span class="hljs-type"><span class="hljs-type">CardNumber</span></span> operations <span class="hljs-keyword"><span class="hljs-keyword">let</span></span>! (card, op) = <span class="hljs-type"><span class="hljs-type">CardActions</span></span>.processPayment currentDate spentToday card cmd.<span class="hljs-type"><span class="hljs-type">PaymentAmount</span></span> |&gt; expectOperationNotAllowedError <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>! saveBalanceOperation op |&gt; expectDataRelatedErrorProgram <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>! replaceCard card |&gt; expectDataRelatedErrorProgram return card |&gt; toCardInfoModel |&gt; <span class="hljs-type"><span class="hljs-type">Ok</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl"> This module is the last thing we need to implement in business layer. Also, I've done some refactoring: I moved errors and common types to <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Common project</a> . About time we moved on to implementing data access layer. </p><br><h3 id="data-access-layer" style=";text-align:right;direction:rtl"> Data access layer </h3><br><p style=";text-align:right;direction:rtl"> The design of entities in this layer may depend on our database or framework we use to interact with it. Therefore domain layer doesn't know anything about these entities, which means we have to take care of mapping to and from domain models in here. Which is quite convenient for consumers of our DAL API. For this application I've chosen MongoDB, not because it's a best choice for this kind of task, but because there're many examples of using SQL DBs already and I wanted to add something different. We are gonna use C# driver. </p><br><p style=";text-align:right;direction:rtl"> For the most part it's gonna be pretty strait forward, the only tricky moment is with <code>Card</code> . When it's active it has an <code>AccountInfo</code> inside, when it's not it doesn't. So we have to split it in two documents: <code>CardEntity</code> and <code>CardAccountInfoEntity</code> , so that deactivating card doesn't erase information about balance and daily limit. </p><br><p style=";text-align:right;direction:rtl"> Other than that we just gonna use primitive types instead of discriminated unions and types with built-in validation. </p><br><p style=";text-align:right;direction:rtl"> There're also few things we need to take care of, since we are using C# library: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Convert <code>null</code> s to <code>Option&lt;'a&gt;</code> </li><li style=";text-align:right;direction:rtl"> Catch expected exceptions and convert them to our errors and wrap it in <code>Result&lt;_,_&gt;</code> </li></ul><br><p style=";text-align:right;direction:rtl"> We start with <a href="">CardDomainEntities module</a> , where we define our entities: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> [&lt;<span class="hljs-type"><span class="hljs-type">CLIMutable</span></span>&gt;] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardEntity</span></span></span><span class="hljs-class"> = { [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BsonId</span></span></span><span class="hljs-class">&gt;] </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CardNumber</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Name</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IsActive</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExpirationMonth</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uint16</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExpirationYear</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uint16</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UserId</span></span></span><span class="hljs-class"> } with //</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- we're gonna need this in every entity for error messages member this.EntityId = this.CardNumber.ToString() (*{- we use this Id comparer quotation (F# alternative to C# Expression) for updating entity by id, since for different entities identifier has different name and type -}*) member this.IdComparer = &lt;@ System.Func&lt;_,_&gt; (fun c -&gt; c.CardNumber = this.CardNumber) @&gt;</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> Those fields <code>EntityId</code> and <code>IdComparer</code> we are gonna use with a help of <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SRTP</a> . We'll define functions that will retrieve them from any type that has those fields define, without forcing every entity to implement some interface: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> inline (|<span class="hljs-type"><span class="hljs-type">HasEntityId</span></span>|) x = fun () -&gt; (^a : (member <span class="hljs-type"><span class="hljs-type">EntityId</span></span>: string) x) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> inline entityId (<span class="hljs-type"><span class="hljs-type">HasEntityId</span></span> f) = f() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> inline (|<span class="hljs-type"><span class="hljs-type">HasIdComparer</span></span>|) x = fun () -&gt; (^a : (member <span class="hljs-type"><span class="hljs-type">IdComparer</span></span>: <span class="hljs-type"><span class="hljs-type">Quotations</span></span>.<span class="hljs-type"><span class="hljs-type">Expr</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Func</span></span>&lt; ^a, bool&gt;&gt;) x) //<span class="hljs-comment"><span class="hljs-comment">-- We need to convert F# quotations to C# expressions //-- which C# mongo db driver understands. let inline idComparer (HasIdComparer id) = id() |&gt; LeafExpressionConverter.QuotationToExpression |&gt; unbox&lt;Expression&lt;Func&lt;_,_&gt;&gt;&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> As for <code>null</code> and <code>Option</code> thing, since we use record types, F# compiler doesn't allow using <code>null</code> value, neither for assigning nor for comparison. At the same time record types are just another CLR types, so technically we can and will get a <code>null</code> value, thanks to C# and design of this library. We can solve this in 2 ways: use <code>AllowNullLiteral</code> attribute, or use <code>Unchecked.defaultof&lt;'a&gt;</code> . I went for the second choice since this <code>null</code> situation should be localized as much as possible: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> isNullUnsafe (arg: 'a when 'a: not struct) = arg = <span class="hljs-type"><span class="hljs-type">Unchecked</span></span>.defaultof&lt;'a&gt; //<span class="hljs-comment"><span class="hljs-comment">-- then we have this function to convert nulls to option, //-- therefore we limited this toxic null thing in here. let unsafeNullToOption a = if isNullUnsafe a then None else Some a</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> In order to deal with expected exception for duplicate key, we use Active Patterns again: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> //<span class="hljs-comment"><span class="hljs-comment">-- First we define a function which checks, whether exception is about duplicate key let private isDuplicateKeyException (ex: Exception) = ex :? MongoWriteException &amp;&amp; (ex :?&gt; MongoWriteException).WriteError.Category = ServerErrorCategory.DuplicateKey //-- Then we have to check wrapping exceptions for this let rec private (|DuplicateKey|_|) (ex: Exception) = match ex with | :? MongoWriteException as ex when isDuplicateKeyException ex -&gt; Some ex | :? MongoBulkWriteException as bex when bex.InnerException |&gt; isDuplicateKeyException -&gt; Some (bex.InnerException :?&gt; MongoWriteException) | :? AggregateException as aex when aex.InnerException |&gt; isDuplicateKeyException -&gt; Some (aex.InnerException :?&gt; MongoWriteException) | _ -&gt; None //-- And here's the usage: let inline private executeInsertAsync (func: 'a -&gt; Async&lt;unit&gt;) arg = async { try do! func(arg) return Ok () with | DuplicateKey ex -&gt; return EntityAlreadyExists (arg.GetType().Name, (entityId arg)) |&gt; Error }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> After mapping is implemented we have everything we need to assemble <a href="">API for our data access layer</a> , which looks like this: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> //<span class="hljs-comment"><span class="hljs-comment">-- `MongoDb` is a type alias for `IMongoDatabase` let replaceUserAsync (mongoDb: MongoDb) : ReplaceUserAsync = fun user -&gt; user |&gt; DomainToEntityMapping.mapUserToEntity |&gt; CommandRepository.replaceUserAsync mongoDb let getUserInfoAsync (mongoDb: MongoDb) : GetUserInfoAsync = fun userId -&gt; async { let! userInfo = QueryRepository.getUserInfoAsync mongoDb userId return userInfo |&gt; Option.map EntityToDomainMapping.mapUserInfoEntity }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> The last moment I mention is when we do mapping <code>Entity -&gt; Domain</code> , we have to instantiate types with built-in validation, so there can be validation errors. In this case we won't use <code>Result&lt;_,_&gt;</code> because if we've got invalid data in DB, it's a bug, not something we expect. So we just throw an exception. Other than that nothing really interesting is happening in here. The full source code of data access layer you'll find <a href="">here</a> . </p><br><h3 id="composition-logging-and-all-the-rest" style=";text-align:right;direction:rtl"> Composition, logging and all the rest </h3><br><p style=";text-align:right;direction:rtl"> As you remember, we're not gonna use DI framework, we went for interpreter pattern. If you want to know why, here's some reasons: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> IoC container operates in runtime. So until you run your program you can't know that all the dependencies are satisfied. </li><li style=";text-align:right;direction:rtl"> It's a powerful tool which is very easy to abuse: you can do property injection, use lazy dependencies, and sometimes even some business logic can find it's way in dependency registering/resolving (yeah, I've witnessed it). All of that makes code maintaining extremely hard. </li></ul><br><p style=";text-align:right;direction:rtl"> That means we need a place for that functionality. We could place it on a top level in our Web Api, but in my opinion it's not a best choice: right now we are dealing with only 1 bounded context, but if there's more, this global place with all the interpreters for each context will become cumbersome. Besides, there's single responsibility rule, and web api project should be responsible for web, right? So we create <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CardManagement.Infrastructure project</a> . </p><br><p style=";text-align:right;direction:rtl"> Here we will do several things: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Composing our functionality </li><li style=";text-align:right;direction:rtl"> App configuration </li><li style=";text-align:right;direction:rtl"> Logging </li></ul><br><p style=";text-align:right;direction:rtl"> If we had more than 1 context, app configuration and log configuration should be moved to global infrastructure project, and the only thing happening in this project would be assembling API for our bounded context, but in our case this separation is not necessary. </p><br><p style=";text-align:right;direction:rtl"> Let's get down to composition. We've built execution trees in our domain layer, now we have to interpret them. Every node in that tree represents some dependency call, in our case a call to database. If we had a need to interact with 3rd party api, that would be in here also. So our interpreter has to know how to handle every node in that tree, which is verified in compile time, thanks to <code>&lt;TreatWarningsAsErrors&gt;</code> setting. Here's what it looks like: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs">(*<span class="hljs-comment"><span class="hljs-comment">{- Those `bindAsync (next &gt;&gt; interpretCardProgram mongoDb)` work pretty simple: we execute async function to the left of this expression, await that operation and pass the result to the next node, after which we interpret that node as well, until we reach the bottom of this recursion: `Stop a` node. -}</span></span>*) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rec</span></span> private interpretCardProgram mongoDb prog = match prog with | <span class="hljs-type"><span class="hljs-type">GetCard</span></span> (cardNumber, next) -&gt; cardNumber |&gt; getCardAsync mongoDb |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">GetCardWithAccountInfo</span></span> (number, next) -&gt; number |&gt; getCardWithAccInfoAsync mongoDb |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">CreateCard</span></span> ((card,acc), next) -&gt; (card, acc) |&gt; createCardAsync mongoDb |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">ReplaceCard</span></span> (card, next) -&gt; card |&gt; replaceCardAsync mongoDb |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">GetUser</span></span> (id, next) -&gt; getUserAsync mongoDb id |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">CreateUser</span></span> (user, next) -&gt; user |&gt; createUserAsync mongoDb |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">GetBalanceOperations</span></span> (request, next) -&gt; getBalanceOperationsAsync mongoDb request |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">SaveBalanceOperation</span></span> (op, next) -&gt; saveBalanceOperationAsync mongoDb op |&gt; bindAsync (next &gt;&gt; interpretCardProgram mongoDb) | <span class="hljs-type"><span class="hljs-type">Stop</span></span> a -&gt; async.<span class="hljs-type"><span class="hljs-type">Return</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> interpret prog = try <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> interpret = interpretCardProgram (getMongoDb()) interpret prog with | failure -&gt; <span class="hljs-type"><span class="hljs-type">Bug</span></span> failure |&gt; <span class="hljs-type"><span class="hljs-type">Error</span></span> |&gt; async.<span class="hljs-type"><span class="hljs-type">Return</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> Note that this interpreter is the place where we have this <code>async</code> thing. We can do another interpreter with <code>Task</code> or just a plain sync version of it. Now you're probably wondering, how we can cover this with unit-test, since familiar mock libraries ain't gonna help us. Well, it's easy: you have to make another interpreter. Here's what it can look like: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveResult</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Result</span></span></span><span class="hljs-class">&lt;unit, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataRelatedError</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TestInterpreterConfig</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class">: (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Card</span></span></span><span class="hljs-class">*</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AccountInfo</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveResult</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveResult</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveResult</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BalanceOperation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveResult</span></span></span><span class="hljs-class"> } let defaultConfig = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">accountInfo</span></span></span><span class="hljs-class">) |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ok</span></span></span><span class="hljs-class">() </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">balanceOperations</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ok</span></span></span><span class="hljs-class">() </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ok</span></span></span><span class="hljs-class">() </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ok</span></span></span><span class="hljs-class">() } let testInject a = fun _ -&gt; a let rec interpretCardProgram config (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prog</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Program</span></span></span><span class="hljs-class">&lt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;) = match prog with | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cardNumber</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; cardNumber |&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCard</span></span></span><span class="hljs-class"> |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; number |&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCardWithAccountInfo</span></span></span><span class="hljs-class"> |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> ((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">acc</span></span></span><span class="hljs-class">), next) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">acc</span></span></span><span class="hljs-class">) |&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCard</span></span></span><span class="hljs-class"> |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; card |&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ReplaceCard</span></span></span><span class="hljs-class"> |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; id |&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetUser</span></span></span><span class="hljs-class"> |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; user |&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateUser</span></span></span><span class="hljs-class"> |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">request</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetBalanceOperations</span></span></span><span class="hljs-class"> request |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class">) -&gt; testInject config.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SaveBalanceOperation</span></span></span><span class="hljs-class"> op |&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> &gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interpretCardProgram</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">) | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Stop</span></span></span><span class="hljs-class"> a -&gt; a</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> We've created <code>TestInterpreterConfig</code> which holds desired results of every operation we want to inject. You can easily change that config for every given test and then just run interpreter. This interpreter is sync, since there's no reason to bother with <code>Task</code> or <code>Async</code> . </p><br><p style=";text-align:right;direction:rtl"> There's nothing really tricky about the logging, but you can find it in <a href="">this module</a> . The approach is that we wrap the function in logging: we log function name, parameters and log result. If result is ok, it's info, if error it's a warning and if it's a <code>Bug</code> then it's an error. That's pretty much it. </p><br><p style=";text-align:right;direction:rtl"> One last thing is to make a facade, since we don't want to expose raw interpreter calls. Here's the whole thing: </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> createUser arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.createUser &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.createUser"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> createCard arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.createCard &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.createCard"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> activateCard arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.activateCard &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.activateCard"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> deactivateCard arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.deactivateCard &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.deactivateCard"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> processPayment arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.processPayment &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.processPayment"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> topUp arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.topUp &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.topUp"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> setDailyLimit arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.setDailyLimit &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.setDailyLimit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> getCard arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.getCard &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpret |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.getCard"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> getUser arg = arg |&gt; (<span class="hljs-type"><span class="hljs-type">CardWorkflow</span></span>.getUser &gt;&gt; <span class="hljs-type"><span class="hljs-type">CardProgramInterpreter</span></span>.interpretSimple |&gt; logifyResultAsync <span class="hljs-string"><span class="hljs-string">"CardApi.getUser"</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl"> All the dependencies here are injected, logging is taken care of, no exceptions is thrown โ that's it. For web api I used <a href="">Giraffe</a> framework. Web project is <a href="">here</a> . </p><br><h2 id="conclusion" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl"> We have built an application with validation, error handling, logging, business logic โ all those things you usually have in your application. The difference is this code is way more durable and easy to refactor. Note that we haven't used reflection or code generation, no exceptions, but still our code isn't verbose. It's easy to read, easy to understand and hard to break. As soon as you add another field in your model, or another case in one of our union types, the code won't compile until you update every usage. Sure it doesn't mean you're totally safe or that you don't need any kind of testing at all, it just means that you're gonna have fewer problems when you develope new features or do some refactoring. The development process will be both cheaper and more interesting, because this tool allows you to focus on your domain and business tasks, instead of drugging focus on keeping an eye out that nothing is broken. </p><br><p style=";text-align:right;direction:rtl"> Another thing: I don't claim that OOP is completely useless and we don't need it, that's not true. I'm saying that we don't need it for solving <em>every single task</em> we have, and that a big portion of our tasks can be better solved with FP. And truth is, as always, in balance: we can't solve everything efficiently with only one tool, so a good programming language should have a decent support of both FP and OOP. And, unfortunately, a lot of most popular languages today have only lambdas and async programming from functional world. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458730/">https://habr.com/ru/post/ar458730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458718/index.html">ููุงุจูุฉ ูุจูุฑุฉ ูุน ูููู ูููู ุ ูุงูุฏ ุชุฌููุน JIT ูู ุฌุงูุฉ</a></li>
<li><a href="../ar458720/index.html">ุชูุชุญ ูุฏุฑุณุฉ ูุจุฑูุฌ hh.ru ูููุฑุฉ ุงูุนุงุดุฑุฉ ูุฌููุนุฉ ูู ุงููุชุฎุตุตูู ูู ุชูููููุฌูุง ุงููุนูููุงุช</a></li>
<li><a href="../ar458724/index.html">ุงูุดุจูุงุช ุงูุนุตุจูุฉ ูุงูุชุนูู ุงูุนููู ุ ุงููุตู 3 ุ ุงูุฌุฒุก 1: ุชุญุณูู ุทุฑููุฉ ุชุฏุฑูุจ ุงูุดุจูุงุช ุงูุนุตุจูุฉ</a></li>
<li><a href="../ar458726/index.html">ูุจุฑ ุงูุฎุงุตุฉ // ุจูุฏูุงุณุช ูุน ูุคูู ุงูุบุฒู. ุชุงุฑูุฎ ููุฌุฒ ูููุฑุงุตูุฉ ุงูุฑูุณ</a></li>
<li><a href="../ar458728/index.html">ูุง ูู ุงูุฏุฑุงุฌุงุช ุงูููุฑุจุงุฆูุฉ (ุงุณุชุนุฑุงุถ ุงููุฌููุนุฉ ูู ุฎูุณุฉ ููุงุฐุฌ ูู ุงุซููู ูู ุงูุดุฑูุงุช ุงููุตูุนุฉ) ุ ุงูุฌุฒุก 2</a></li>
<li><a href="../ar458732/index.html">GISุ ุฃู ุบูุฑ ูุธุงู ุงููุนูููุงุช ุงูุฌุบุฑุงููุฉุ ูุฐุง ูู ุงูุณุคุงู</a></li>
<li><a href="../ar458734/index.html">ุฃูุงู ุงูุฃุณุจูุน ูู ูุฑูุฒ ุงูุจูุงูุงุช: ุชูุงูุงุช ุบูุฑ ูุงุถุญุฉ ููุฏุฉ 7 ุณููุงุช ูู ุงูุชุดุบูู. ูุงุณุชูุฑุงุฑ ุงููุฃุฑ</a></li>
<li><a href="../ar458738/index.html">ุงููุงุฏุฉ ูุงููุงุฏุฉ ุงููุถุงุฏุฉ: ูุง ูู ุนููู ุ ูุง ูู ุงููุฑู ููุง ุนูุงูุฉ ุงููููุชุฑููู ุจู</a></li>
<li><a href="../ar458740/index.html">ูุฃูุฑ ุงูุฑุจ: "ููุงุจูุฉ ููุจูู ุงูุนุฑูุถ"</a></li>
<li><a href="../ar458742/index.html">ููุฑูู ุชูููุงุดูู ูููุณูู ุบูุฑูููููู ุนู ุงูุญุฐุงุก ุงูุฑุจูุนู ุนูู jug.msk.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>