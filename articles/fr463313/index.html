<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè£ üèÅ ‚èèÔ∏è Une approche alternative pour vous abonner √† des √©v√©nements, ou EventObject est-il vraiment n√©cessaire? ‚ú°Ô∏è üê∂ üë©üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©sum√© 


 Le but de cet article est une tentative de regarder, d'un point de vue diff√©rent, une description des syst√®mes de distribution d'√©v√©nements...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une approche alternative pour vous abonner √† des √©v√©nements, ou EventObject est-il vraiment n√©cessaire?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463313/"><h2 id="rezyume">  R√©sum√© </h2><br><p>  Le but de cet article est une tentative de regarder, d'un point de vue diff√©rent, une description des syst√®mes de distribution d'√©v√©nements. <br><br>  Au moment d'√©crire ces lignes, la plupart des principaux frameworks <strong>php</strong> impl√©mentent un syst√®me d'√©v√©nements bas√© sur la description d'un <em>EventObject</em> . <br><br>  C'est devenu la norme en php, ce qui a √©t√© r√©cemment confirm√© par l'adoption de la norme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">psr / event-dispatcher</a> . <br><br>  Mais il s'av√®re que la description de l'objet d'√©v√©nement aide peu √† d√©velopper l'auditeur.  Pour plus de d√©tails sous cat. </p><a name="habracut"></a><br><h2 id="v-chyom-problema">  Quel est le probl√®me </h2><br><p>  Examinons les r√¥les et les objectifs de ceux qui utilisent <em>EventObject</em> dans le d√©veloppement. </p><br><ol><li><p>  Un d√©veloppeur (A) qui d√©finit la possibilit√© d'injecter des instructions tierces dans son processus en g√©n√©rant un √©v√©nement. </p><br><p>  Le d√©veloppeur d√©crit l' <em>EventObject</em> ou sa signature via une interface. </p><br><p>  Lors de la description d'un <em>EventObject, l'objectif</em> du d√©veloppeur <em>est</em> de donner aux autres d√©veloppeurs une description de l'objet de donn√©es et, dans certains cas d'utilisation, de d√©crire le m√©canisme d'interaction avec le thread principal via cet objet. </p><br></li><li><p>  D√©veloppeur (B) qui d√©crit "l'auditeur". </p><br><p>  Le d√©veloppeur s'abonne √† l'√©v√©nement sp√©cifi√©.  Dans la plupart des cas, la description de l'√©couteur doit satisfaire le type <strong>appelable</strong> . </p><br><p>  Dans le m√™me temps, le d√©veloppeur n'h√©site pas √† nommer les classes ou les m√©thodes de l'auditeur.  Mais il y a une restriction plus par convention que le gestionnaire re√ßoit un <em>EventObject</em> comme argument. </p><br></li></ol><br><p>  Lorsque le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">psr / r√©partiteur d'√©v√©nements a √©t√©</a> adopt√© par le groupe de travail, de nombreuses options d'utilisation des syst√®mes de distribution d'√©v√©nements ont √©t√© analys√©es. </p><br><p>  La norme psr mentionne les cas d'utilisation suivants: </p><br><ol><li>  avis √† sens unique - "J'ai fait quelque chose si vous √™tes int√©ress√©" </li><li>  am√©lioration d'objet - "Voici une chose, veuillez la changer avant de faire quelque chose avec elle" </li><li>  collection - ¬´Donnez-moi toutes vos affaires pour que je puisse faire quelque chose avec cette liste¬ª </li><li>  cha√Æne alternative - "Voici la chose, le premier d'entre vous √† y faire face, faites-le, puis arr√™tez" </li></ol><br><p>  Dans le m√™me temps, le groupe de travail a soulev√© de nombreuses questions sur l'utilisation similaire des syst√®mes de distribution d'√©v√©nements, li√©es au fait que chacun des cas d'utilisation a une ¬´incertitude¬ª qui d√©pend de la mise en ≈ìuvre de l'objet <em>Dispatcher</em> . </p><br><p>  Dans les r√¥les d√©crits ci-dessus pour le d√©veloppeur (B), il n'existe aucun moyen pratique et bien lisible de comprendre laquelle des options d'utilisation du syst√®me d'√©v√©nements a √©t√© choisie par le d√©veloppeur (A).  Le d√©veloppeur devra toujours examiner le code de description non seulement de l' <em>EventObject</em> , mais √©galement le code o√π cet √©v√©nement est g√©n√©r√©. </p><br><p>  Par cons√©quent, la signature est une description de l'objet √©v√©nement, qui est con√ßue pour faciliter le travail du d√©veloppeur (B). Ce travail ne fonctionne pas bien. </p><br><p>  Un autre probl√®me est la pr√©sence pas toujours justifi√©e d'un objet s√©par√©, qui d√©crit en plus les entit√©s d√©j√† d√©crites dans les syst√®mes. </p><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">CustomerNameInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">MyFramevork</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">SomeEventInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedEvent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEventInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomerId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomerName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomerNameInterface</span></span></span></span>; }</code> </pre> <br><p>  Dans l'exemple ci-dessus, l'objet <em>CustomerNameInterface</em> a d√©j√† √©t√© d√©crit dans le syst√®me. </p><br><p>  Cela rappelle l'introduction excessive de nouveaux concepts.  Apr√®s tout, lorsque nous devons impl√©menter une m√©thode, par exemple, en √©crivant dans le journal des changements de nom du client, nous ne combinons pas les arguments de la m√©thode dans une entit√© distincte, nous utilisons la description standard d'une m√©thode du formulaire: </p><br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToLogCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  En cons√©quence, nous voyons les probl√®mes suivants: </p><br><ol><li>  mauvaise signature du code d'auditeur </li><li>  Incertitude du r√©partiteur </li><li>  incertitude du type de retour </li><li>  introduction de nombreuses entit√©s suppl√©mentaires telles que <em>SomeEventObject</em> </li></ol><br><h2 id="posmotrim-na-eto-s-inoy-tochki-zreniya">  Regardons les choses sous un angle diff√©rent </h2><br><p>  Si l'un des probl√®mes est une mauvaise description de l'√©couteur, examinons le syst√®me de distribution d'√©v√©nements non pas √† partir de la description de l'objet √©v√©nement, mais √† partir de la description de l'√©couteur. </p><br><p>  Le d√©veloppeur (A) d√©crit la mani√®re dont l'auditeur doit √™tre d√©crit. </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span></span>; }</code> </pre> <br><p>  Un excellent d√©veloppeur (A) a pu transmettre une description de l'auditeur et des donn√©es transmises √† des d√©veloppeurs tiers. </p><br><p>  Lors de l'√©criture d'un √©couteur, le d√©veloppeur (B) tape <em>CustomerNameChangedListener</em> dans les <em>impl√©mentations d'</em> environnement et l'EDI peut ajouter une description de la m√©thode d'√©coute √† sa classe.  <strong>L'ach√®vement du code est</strong> excellent. </p><br><p>  Jetons un coup d'≈ìil √† la nouvelle signature de la m√©thode d'√©coute.  Un simple coup d'≈ìil suffit pour comprendre que la version du syst√®me de distribution d'√©v√©nements utilis√© est: "notification √† sens unique". </p><br><p>  Les donn√©es d'entr√©e ne sont pas transmises par r√©f√©rence, ce qui signifie qu'il n'y a aucun moyen de les modifier de quelque mani√®re que ce soit pour que les modifications tombent dans le flux principal.  Valeur de retour manquante; aucune r√©troaction du thread principal. </p><br><p>  Qu'en est-il des autres cas d'utilisation?  Jouons avec la description de l'interface de l'√©couteur d'√©v√©nements. </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomerNameInterface</span></span></span></span>; }</code> </pre> <br><p>  Il y avait une exigence pour la valeur de retour, ce qui signifie que l'√©couteur peut (mais n'est pas oblig√© de) retourner une valeur diff√©rente si elle correspond √† l'interface sp√©cifi√©e.  Cas d'utilisation: "am√©lioration d'objet". </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> ItemInterface[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span></span>; }</code> </pre> <br><p>  Il y avait une exigence pour la valeur de retour d'un certain type par lequel il peut √™tre compris que c'est un √©l√©ment de la collection.  Cas d'utilisation: "collection". </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName )</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VoteInterface</span></span></span></span>; }</code> </pre> <br><p>  Cas d'utilisation: "cha√Æne alternative, vote". </p><br><hr><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyFramework</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventControllInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyApp</span></span>\<span class="hljs-title"><span class="hljs-title">Customer</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerNameChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCustomerNameChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( int $customerId, CustomerNameInterface $customerName, EventControllInterface &amp;$eventControll )</span></span></span></span>; }</code> </pre><br><p>  <em>Sans discussion, arr√™ter la propagation des √©v√©nements est bon ou mauvais.</em> </p><br><p>  Cette option est lue sans ambigu√Øt√©, le thread principal fournit √† l'auditeur l'occasion d'arr√™ter l'√©v√©nement. </p><br><p>  Donc, si nous passons √† la description de l'√©couteur, nous obtenons de meilleures signatures lisibles des m√©thodes d'√©coute lors de leur d√©veloppement. </p><br><p>  De plus, nous avons la possibilit√© pour le thread principal de pointer explicitement vers: </p><br><ol><li>  acceptabilit√© des modifications des donn√©es entrantes </li><li>  types de retour autres que les types entrants </li><li>  transfert explicite d'un objet avec lequel arr√™ter la propagation d'un √©v√©nement </li></ol><br><h2 id="kak-realizovat-podpisku-na-sobytie">  Comment impl√©menter un abonnement √† un √©v√©nement </h2><br><p>  Les options peuvent √™tre diff√©rentes.  La signification g√©n√©rale de toutes les options se r√©sume au fait que nous devons en quelque sorte informer l'objet <em>ListenerProvider</em> (l'objet qui donne la possibilit√© de s'abonner √† l'√©v√©nement), auquel √©v√©nement appartient l'interface sp√©cifique. </p><br><p>  Vous pouvez consid√©rer la conversion de l'objet pass√© en un type appelable comme exemple.  Il faut comprendre qu'il peut y avoir de nombreuses options pour obtenir des m√©ta-informations suppl√©mentaires: </p><br><ol><li>  peut √™tre pass√© explicitement, comme dans l'exemple </li><li>  peut √™tre stock√© dans des annotations d'interfaces d'√©coute </li><li>  vous pouvez utiliser le nom de l'interface d'√©coute comme nom des √©v√©nements </li></ol><br><hr><br><p>  <strong>Exemple de mise en ≈ìuvre de l'abonnement</strong> </p><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyFramework</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListenerProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $handlerAssociation = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHandlerAssociation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( string $handlerInterfaceName, string $handlerMethodName, string $eventName )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;handlerAssociation[$handlerInterfaceName] = [ <span class="hljs-string"><span class="hljs-string">'methodName'</span></span> =&gt; $handlerMethodName, <span class="hljs-string"><span class="hljs-string">'eventName'</span></span> =&gt; $eventName ]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object $handler)</span></span></span><span class="hljs-function"> </span></span>{ $hasAssociation = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;handlerAssociation <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $handlerInterfaceName =&gt; $handlerMetaData ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $handler interfaceof $handlerInterfaceName ) { $methodName = $handlerMetaData[<span class="hljs-string"><span class="hljs-string">'methodName'</span></span>]; $eventName = $handlerMetaData[<span class="hljs-string"><span class="hljs-string">'eventName'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addListener($eventName, [$handler, $methodName]); $hasAssociation = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !$hasAssociation ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'Unknown handler object'</span></span>); } } }</code> </pre> <br><p>  Nous ajoutons une m√©thode de configuration √† l'objet d'abonnement qui, pour chaque interface d'√©coute, d√©crit ses m√©tadonn√©es, telles que la m√©thode appel√©e et le nom de l'√©v√©nement. </p><br><p>  Selon ces donn√©es, au moment de l'abonnement, nous transformons le gestionnaire $ pass√© en un objet <strong>appelable</strong> indiquant la m√©thode appel√©e. </p><br><p>  Si vous remarquez, le code implique qu'un objet $ handler peut impl√©menter de nombreuses interfaces d'√©couteur d'√©v√©nements et sera abonn√© √† chacune d'entre elles.  Il s'agit d'un analogue de <em>SubscriberInterface</em> pour l'abonnement en masse d'un objet √† plusieurs √©v√©nements.  Comme vous pouvez le voir, l'impl√©mentation ci-dessus ne n√©cessite pas de m√©canisme s√©par√© comme <code>addSubscriber(SubscriberInterface $subscriber)</code> il s'est av√©r√© fonctionner hors de la bo√Æte. </p><br><h2 id="dispatcher">  Dispatcher </h2><br><p>  H√©las, l'approche d√©crite va √† l'encontre de l'interface accept√©e comme la norme psr / event-dispatcher </p><br><p>  Puisque nous n'avons pas besoin de passer d'objet √† Dispatcher.  Oui, vous pouvez passer un objet comme le sucre: </p><br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $eventName, ...$arguments)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } public function getEventName(): string { // ... } public function getArguments(): array { // ... } }</span></span></code> </pre> <br><p>  Et utilisez-le lors de la g√©n√©ration d'un √©v√©nement sur l'interface psr, mais c'est tout simplement laid. </p><br><p>  Dans le bon sens, l'interface Dispatcher ressemblerait mieux √† ceci: </p><br><pre> <code class="php hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventDispatcherInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $eventName, ...$arguments)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchStopabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $eventName, ...$arguments)</span></span></span></span>; }</code> </pre> <br><p>  Pourquoi deux m√©thodes?  Il est difficile de combiner tous les cas d'utilisation en une seule impl√©mentation.  Il est pr√©f√©rable d'ajouter votre propre m√©thode pour chaque cas d'utilisation, il y aura une interpr√©tation sans ambigu√Øt√© de la fa√ßon dont Dispatcher traitera les valeurs renvoy√©es par les √©couteurs. </p><br><p>  C‚Äôest tout.  Il serait int√©ressant de discuter avec la communaut√© si l'approche d√©crite a droit √† la vie. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463313/">https://habr.com/ru/post/fr463313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463301/index.html">Gonkey - Outil de test de microservices</a></li>
<li><a href="../fr463303/index.html">Facebook arr√™te enfin de cibler les annonces pour les num√©ros de t√©l√©phone que les gens saisissent pour 2FA</a></li>
<li><a href="../fr463305/index.html">Outils d'analyse et de d√©bogage des applications .NET</a></li>
<li><a href="../fr463307/index.html">√âtude de cas sur la communication avec un client ¬´lourd¬ª</a></li>
<li><a href="../fr463311/index.html">CTT dans les solutions serveur. La deuxi√®me version + l'annonce de la troisi√®me, avec la possibilit√© de toucher</a></li>
<li><a href="../fr463317/index.html">D√©tails techniques du piratage de Capital One Bank sur AWS</a></li>
<li><a href="../fr463321/index.html">Paniers et caisses de convivialit√©: analyse des 20 meilleurs magasins de niche russes en ligne</a></li>
<li><a href="../fr463325/index.html">R√©flexion de Game Designer: Personnages pour un jeu qui n'est pas sorti</a></li>
<li><a href="../fr463327/index.html">Vue.js: 3 anti-patterns</a></li>
<li><a href="../fr463329/index.html">D√©veloppement de diagrammes d'arbres dynamiques √† l'aide de SVG et Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>