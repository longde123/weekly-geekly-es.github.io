<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ½â€âš–ï¸ â›ªï¸ ğŸ‘©ğŸ½ æ‰©å±•PHPå’ŒKotlinæœ¬æœºã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå¯èƒ½æ˜¯æœ€ç»ˆçš„ ğŸ†— ğŸ™€ ğŸšª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ ï¼Œè®²è¿°äº†æœ‰å…³è®¾ç½®å·¥å…·å’Œä¸€èˆ¬æ¦‚å¿µçš„åŸºæœ¬çŸ¥è¯†ã€‚ 

 å¯ä»¥è¯´ï¼Œ ç¬¬äºŒéƒ¨åˆ†æ˜¯å…³äºå¼¹ä¸¸ï¼Œæ€æƒ³ï¼Œè®¡åˆ’ï¼Œè®¡åˆ’çš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚ 

 åœ¨æœ¬æ–‡ä¸­ï¼Œæœ‰å…³Cå’ŒK / Näº’æ“ä½œï¼Œæ›´å¤šçš„å®ï¼Œç—›è‹¦ï¼Œç»æœ›å’Œâ€œå–„è‰¯ä¹‹å…‰â€çš„å†…å®¹å°†æ›´åŠ ä¸¥æ ¼ã€‚ å½“ç„¶ï¼Œä¼šæœ‰ä¸€ç« è®²è¿°æœ‰å…³æˆå°±çš„æ•…äº‹ï¼ˆæ‚¨ä¸ä¼šç§°èµè‡ªå·±â€¦â€¦æ­¤å¤–ï¼Œè¿˜æœ‰å…³äºå²è¯—èˆ¬çš„fa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æ‰©å±•PHPå’ŒKotlinæœ¬æœºã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå¯èƒ½æ˜¯æœ€ç»ˆçš„</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/423145/"><img align="right" src="https://habrastorage.org/webt/o7/db/cw/o7dbcwsbe8kad4jkw84guc_2n4m.png"> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†ä¸­</a> ï¼Œè®²è¿°äº†æœ‰å…³è®¾ç½®å·¥å…·å’Œä¸€èˆ¬æ¦‚å¿µçš„åŸºæœ¬çŸ¥è¯†ã€‚ <br><br> å¯ä»¥è¯´ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬äºŒéƒ¨åˆ†æ˜¯</a>å…³äºå¼¹ä¸¸ï¼Œæ€æƒ³ï¼Œè®¡åˆ’ï¼Œè®¡åˆ’çš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæœ‰å…³Cå’ŒK / Näº’æ“ä½œï¼Œæ›´å¤šçš„å®ï¼Œç—›è‹¦ï¼Œç»æœ›å’Œâ€œå–„è‰¯ä¹‹å…‰â€çš„å†…å®¹å°†æ›´åŠ ä¸¥æ ¼ã€‚ å½“ç„¶ï¼Œä¼šæœ‰ä¸€ç« è®²è¿°æœ‰å…³æˆå°±çš„æ•…äº‹ï¼ˆæ‚¨ä¸ä¼šç§°èµè‡ªå·±â€¦â€¦æ­¤å¤–ï¼Œè¿˜æœ‰å…³äºå²è¯—èˆ¬çš„fakapçš„æ•…äº‹ã€‚ <br><a name="habracut"></a><br>  <b>å…è´£å£°æ˜ï¼š</b>åœ¨ä¸ºPHPç¼–å†™åº“çš„ä¸Šä¸‹æ–‡ä¸­è€ƒè™‘äº†ä»¥ä¸‹æ‰€æœ‰å†…å®¹ã€‚ <br><br><h2> ç¬¬ä¸€ç«  å¤©çœŸçƒ‚æ¼« </h2><br> åœ¨å¾ªç¯çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ä»‹ç»äº†å¦‚ä½•åœ¨Cä¸­ä½¿ç”¨K / Nå‡½æ•°ã€‚ å› æ­¤ï¼Œåœ¨è¿™é‡Œæˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•åœ¨K â€‹â€‹/ Nä¸­ä½¿ç”¨Cå‡½æ•°ã€‚ <br><br>  <a href="">å®˜æ–¹æ–‡æ¡£</a>ç›¸å½“å°å·§ç®€æ´ï¼Œä½†æ˜¯å¯¹äºç®€å•çš„é¡¹ç›®æ¥è¯´ï¼Œå·²ç»è¶³å¤Ÿäº†ã€‚ <br><br> ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ‰©å±•åä¸º<b>.def</b>çš„ç‰¹æ®Šæ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å®šå¿…è¦çš„å¤´æ–‡ä»¶ã€‚ <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">headers</span></span> = php.h</code> </pre> <br> ç„¶åå°†å…¶æä¾›ç»™åä¸º<b>cinterop</b>çš„ç¨‹åºã€‚ <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># cinterop -def php.def -o php</span></span></code> </pre><br> åœ¨è¾“å‡ºä¸­ï¼Œæ‚¨å°†è·å¾—åŒ…å«llvmä½ä»£ç å’Œå„ç§å…ƒä¿¡æ¯çš„<b>libphp.klib</b>åº“ã€‚ <br><br> ç„¶åï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨å¤´æ–‡ä»¶ï¼ˆ <code>#define</code> ï¼‰ä¸­æè¿°çš„å‡½æ•°å’Œå®ï¼Œè€Œä¸å¿…å¿˜è®°åœ¨ç¼–è¯‘é˜¶æ®µè¿æ¥åº“ã€‚ <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># kotlinc -opt -produce static ${SOURCES} -l libphp.klib -o myLib</span></span></code> </pre><br> ä½†æ˜¯æœ‰ç»†å¾®å·®åˆ«ã€‚ æ²¡æœ‰ä¸€ä¸ªã€‚ <br><br><h3> ä»¥ä¸Šè¿°å½¢å¼ï¼Œåº“å°†ä¸ä¼šè¢«ç»„è£… </h3><br> æ€ä¹ˆäº† ä½†æ˜¯å› ä¸ºä»¥ä¸‹è¡Œå‡ºç°åœ¨php.hä¸­ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"php_version.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"zend.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"zend_sort.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"php_compat.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"zend_API.h"</span></span></span></span></code> </pre><br> åœ¨è¿™é‡Œåº”è¯¥æ³¨æ„ï¼Œllvmä»åœ¨ç¼–è¯‘åº“ï¼Œå®ƒå…·æœ‰<b>-Iå¼€å…³</b> ï¼Œè€Œcinteropå…·æœ‰<b>-coptå¼€å…³</b> ã€‚ å¥½å§ï¼Œä½ æ˜ç™½äº†ã€‚ ç»“æœï¼Œè¿™æ ·çš„å‘½ä»¤è¶³ä»¥ç¼–è¯‘<b>php.hã€‚</b> <br><br><pre> <code class="hljs mel"># cinterop -def my.def -o myLib -I${PHP_LIB_ROOT} -copt -I${PHP_LIB_ROOT} \ -copt -I${PHP_LIB_ROOT}/main \ -copt -I${PHP_LIB_ROOT}/Zend \ -copt -I${PHP_LIB_ROOT}/TSRM</code> </pre><br><h3> å®ã€‚ æˆ‘çˆ±ä½ ï¼Œæ¨ä½ ï¼ ä¸ï¼Œæˆ‘åªæ˜¯è®¨åŒã€‚ </h3><br> å…³äºC&gt; K / Näº’æ“ä½œï¼Œæ‚¨éœ€è¦äº†è§£çš„<code>#define</code>æ˜¯ <br><blockquote> æ¯ä¸ªæ‰©å±•ä¸ºå¸¸æ•°çš„Cå®éƒ½è¡¨ç¤ºä¸ºKotlinå±æ€§ã€‚ ä¸æ”¯æŒå…¶ä»–å®ã€‚ </blockquote><br> ç„¶åæˆ‘ä»¬å›æƒ³èµ·PHPæ‰©å±•æ˜¯å®ä¸Šçš„ä¸€ä¸ªå®ï¼Œå®ƒé©±åŠ¨ä¸€ä¸ªå®ï¼Œå¹¶å°½é‡ä¸è¦å“­æ³£ã€‚ <br><br> ä½†æ˜¯ï¼Œå¹¶éä¸€åˆ‡éƒ½é‚£ä¹ˆç³Ÿç³•ã€‚ ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼ŒK / Nå¼€å‘äººå‘˜æä¾›äº†ä¸€å·è“è‰²ç”µæ°”èƒ¶å¸¦ï¼Œç”¨äºç²˜è´´åˆ°<b>è‡ªå®šä¹‰å£°æ˜</b> defæ–‡ä»¶ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨å®<code>Z_TYPE_P</code> ï¼‰ <br><br><pre> <code class="cpp hljs">headers = php.h --- <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> zend_uchar __zp_get_arg_type(zval *z_value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Z_TYPE_P(z_value); }</code> </pre> <br> ç°åœ¨åœ¨K / Nä»£ç ä¸­å¯ä»¥ä½¿ç”¨<code>__zp_get_arg_type</code>å‡½æ•° <br><br><h2> ç¬¬äºŒç«   PHP INIè®¾ç½®æˆ–å­å­å®ã€‚ </h2><br> è¿™æ˜¯å¯¹PHPæºä»£ç çš„ä¸€ç§â€œç¾å¥½çš„ç¥æ„¿â€ã€‚ <br><br> æœ‰4ä¸ªå®å¯ç”¨äºæå–è®¾ç½®ï¼š <br><br><pre> <code class="cpp hljs">INI_INT(val) INI_FLT(val) INI_STR(val) INI_BOOL(val)</code> </pre><br> å…¶ä¸­<code>val</code>æ˜¯å¸¦æœ‰è®¾ç½®åç§°çš„å­—ç¬¦ä¸²ã€‚ <br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>INI_STR</code>çš„ç¤ºä¾‹ï¼Œä»¥äº†è§£å¦‚ä½•å®šä¹‰æ­¤å®ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> INI_STR(name) zend_ini_string_ex((name), sizeof(name)-1, 0, NULL)</span></span></code> </pre> <br> å·²ç»æ³¨æ„åˆ°ä»–çš„â€œè‡´å‘½ç¼ºé™·â€äº†å—ï¼Ÿ <br><br> å¦‚æœæ²¡æœ‰ï¼Œè®©æˆ‘å‘Šè¯‰æ‚¨-è¿™æ˜¯<code>sizeof</code>å‡½æ•°ã€‚ å½“ç›´æ¥ä½¿ç”¨å®æ—¶ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ï¼š <br><br><pre> <code class="cpp hljs">php_printf(<span class="hljs-string"><span class="hljs-string">"The value is : %s"</span></span>, INI_STR(<span class="hljs-string"><span class="hljs-string">"my.ini"</span></span>));</code> </pre> <br> å½“æ‚¨é€šè¿‡<b>.def</b>æ–‡ä»¶ä¸­çš„ä»£ç†å‡½æ•°ä½¿ç”¨å®ƒæ—¶ï¼Œç¬”æ¶å˜æˆå—ç“œï¼Œå¹¶ä¸”<b>sizeofï¼ˆåç§°ï¼‰</b>è¿”å›æŒ‡é’ˆçš„å¤§å°ã€‚ å°†å†›ç§‘ç‰¹æ—åŸç”Ÿã€‚ <br><br> å®é™…ä¸Šï¼Œè§„é¿åªæœ‰ä¸¤ç§é€‰æ‹©ã€‚ <br><br><ol><li> ä¸è¦ä½¿ç”¨å®ï¼Œè€Œè¦ä½¿ç”¨å®ƒä»¬æ‰€é™„åŠ çš„åŠŸèƒ½ã€‚ </li><li> æ¯ä¸ªå¿…éœ€è®¾ç½®çš„ç¡¬åŒ…è£…ç¨‹åºåŠŸèƒ½ã€‚ </li></ol><br> ç¬¬ä¸€ä¸ªé€‰é¡¹å¯¹æ¯ä¸ªäººéƒ½æ¯”ç¬¬äºŒä¸ªé€‰é¡¹æ›´å¥½ï¼Œé™¤äº†ä¸€ç‚¹ä»¥å¤–-æ²¡æœ‰äººå¯ä»¥ä¿è¯å®å£°æ˜ä¸ä¼šæ›´æ”¹ã€‚ å› æ­¤ï¼Œå¯¹äºæˆ‘çš„é¡¹ç›®ï¼Œæˆ‘æ„Ÿåˆ°éå¸¸ä¸æ»¡ï¼Œé€‰æ‹©äº†ç¬¬äºŒä¸ªé€‰é¡¹ã€‚ <br><br><h2> ç¬¬ä¸‰ç«  è°ƒè¯•ï¼Ÿ ä»€ä¹ˆè¡Œæ </h2><br><h3> è¡ŒåŠ¨1-äº’æ“ä½œã€‚ </h3><br> æ›¾ç»ï¼Œåœ¨å°†è“å¸¦é™„åŠ åˆ°20ä¸ªè¿ç»­ä»£ç†åŠŸèƒ½çš„defæ–‡ä»¶ä¹‹åï¼Œæˆ‘æ”¶åˆ°äº†ä¸€ä¸ªå¥‡å¦™çš„é”™è¯¯ã€‚ <br><br><pre> <code class="hljs powershell">Exception <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> thread <span class="hljs-string"><span class="hljs-string">"main"</span></span> java.lang.Error: /tmp/tmp399964332777824085.c:<span class="hljs-number"><span class="hljs-number">103</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>: error: too many arguments to <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">2</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">have</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">native</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UtilsKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensureNoCompileErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Utils.kt:137)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">native</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexDeclarations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Indexer.kt:902)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">native</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildNativeIndexImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Indexer.kt:892)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">native</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NativeIndexKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildNativeIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NativeIndex.kt:56)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">native</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jvm</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCLib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(main.kt:283)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">native</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jvm</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(main.kt:38)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cli</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">utilities</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InteropCompilerKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invokeInterop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InteropCompiler.kt:100)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">org</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jetbrains</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kotlin</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cli</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">utilities</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainKt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(main.kt:29)</span></span></span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m_/sg/xb/m_sgxb-qifca4cx1tccuvbxa6ra.png"></div><br> å¯¹ä¸€åŠå‘è¡¨è¯„è®ºï¼Œç„¶åé‡æ–°ç¼–è¯‘ï¼Œå¦‚æœå¯¹å…¶ä½™ä¸€åŠå‘è¡¨è¯„è®ºï¼Œåˆ™æˆ‘ä»¬æ”¶é›†...å¹¶ä¸”é‰´äºç¼–è¯‘æ ‡å¤´çš„è¿‡ç¨‹è¶³å¤Ÿé•¿...ï¼ˆæ˜¯çš„ï¼Œè¿™ä¼¼ä¹æ¯”åäºŒä¸ªæºæ–‡ä»¶çš„çˆ¬å–è¦å¿«ï¼Œå¹¶ä¸”ç”¨æ”¾å¤§é•œç²¾å¿ƒåœ°è°ƒå’Œï¼‰ã€‚ <br><br> ç¬¬äºŒä¸ªâ€œç¾å¥½ä¹‹å…‰â€è¿›å…¥äº†JetBrainsã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q0/9u/dd/q09uddpi04rrxoc76xnk5meecow.png"></div><br><h3> è¡ŒåŠ¨2-è¿è¡Œæ—¶ã€‚ </h3><br> æˆ‘é‡åˆ°è¿è¡Œæ—¶<b>åˆ†æ®µé”™è¯¯</b> ã€‚ å¥½å§ï¼Œå®ƒå‘ç”Ÿäº†ã€‚ æˆ‘æ­£åœ¨è¿›å…¥è°ƒè¯•å™¨ã€‚ å—¯... STAï¼Ÿ <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Program</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">received</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signal</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SIGSEGV</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Segmentation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fault</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">kfun</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:kotlinx.cinterop.toKString</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">kotlinx</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">cinterop</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">CPointer</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">kotlinx</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">cinterop</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">ByteVarOf</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">kotlin</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Byte</span></span>&gt;&gt;.()<span class="hljs-keyword"><span class="hljs-keyword">kotlin</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">String</span></span> () at /opt/buildAgent/work/<span class="hljs-number"><span class="hljs-number">4</span></span>d622a065c544371/Interop/Runtime/src/main/kotlin/kotlinx/cinterop/Utils.kt:<span class="hljs-number"><span class="hljs-number">402</span></span> <span class="hljs-number"><span class="hljs-number">402</span></span> /opt/buildAgent/work/<span class="hljs-number"><span class="hljs-number">4</span></span>d622a065c544371/Interop/Runtime/src/main/kotlin/kotlinx/cinterop/Utils.kt: No such file or directory.</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cr/nq/ek/crnqekwr9fheufvuxcc9ixhnsjc.png"></div><br><h2> ç¬¬å››ç«  æˆ‘å°†èŒ¶å€’å…¥æ‚¨çš„èŒ¶ä¸­ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åœ¨å–èŒ¶çš„åŒæ—¶å–èŒ¶ã€‚ </h2><br> åœ¨è¿™é‡Œæœ‰å¿…è¦å‘Šè¯‰æˆ‘æˆ‘æ‰€åšçš„é‚£ç§èƒ¡æ‰¯ã€‚ <br><br> æ‚¨ç¼–å†™ä¸€ä¸ªæè¿°æœªæ¥PHPæ‰©å±•çš„DSLï¼Œç¼–å†™åŒ…å«åŠŸèƒ½ï¼Œç±»å’Œæ–¹æ³•çš„å®ç°çš„K / Nä»£ç ï¼Œç„¶åè¿è¡Œ<code>make</code> ï¼Œç„¶åå¥‡è¿¹èˆ¬åœ°è·å¾—å¯ä»¥è¿æ¥åˆ°PHPçš„ç°æˆçš„åº“ã€‚ <br><br> ç»„è£…å¯åˆ†ä¸º4ä¸ªé˜¶æ®µï¼š <br><br><ol><li> åœ¨Cå’ŒK / Nä¹‹é—´åˆ›å»ºä¸€ä¸ªå›¾å±‚ï¼ˆç›¸åŒçš„<code>cinterop</code> ï¼‰ </li><li> æ‰©å±•Cä»£ç ç”Ÿæˆ </li><li> ç”¨é€»è¾‘ç¼–è¯‘åº“ </li><li> ç¼–è¯‘ç›®æ ‡åº“ </li></ol><br> ç›®çš„æ˜¯å¢åŠ ä»¥K / Nä»£ç åˆ›å»ºPHPç±»å®ä¾‹çš„åŠŸèƒ½ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¾¿è¯¥ç±»å¯ä»¥å®šä¹‰<code>getInstance()</code>æ–¹æ³•ã€‚ æˆ‘æƒ³åˆ¶é€ å®ƒä»¥ä¾¿äºä½¿ç”¨ã€‚ <br><br> åœ¨Cè¯­è¨€ä¸­ï¼Œæ­¤é—®é¢˜è§£å†³äº†ä¸€æ¬¡æˆ–ä¸¤æ¬¡ã€‚ <br><br><pre> <code class="cpp hljs">zval *obj = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(zval)); object_init_ex(obj, myClass);</code> </pre> <br> è¿™çœ‹èµ·æ¥å¾ˆç®€å•-å°†å…¶è½¬ç§»åˆ°K / Nï¼Œä½†è¿™æ˜¯<code>myClass</code> ... <br><br> ä½†æ˜¯<code>myClass</code>æ˜¯<code>zend_class_entry*</code>ç±»å‹çš„å…¨å±€å˜é‡ï¼Œåœ¨é¡¹ç›®çš„Cä»£ç ä¸­å£°æ˜ï¼Œå¹¶ä¸”äº‹å…ˆå…·æœ‰æœªçŸ¥åç§°ã€‚ <br><br> å°å¿ƒä½ çš„æ‰‹ã€‚ æ‚¨éœ€è¦ä»K / Nä»£ç ç¼–è¯‘è¯¥åº“ï¼Œå…¶ä¸­å°†æœ‰ä¸€ä¸ªå‡½æ•°éœ€è¦è®¿é—®<code>myClass</code> ï¼Œè¯¥å‡½æ•°åœ¨ç”Ÿæˆçš„ä½†æœªç¼–è¯‘çš„Cä»£ç ä¸­å®šä¹‰ï¼Œç„¶åä»è¯¥ä»£ç ä¸­è°ƒç”¨è¯¥å‡½æ•°ã€‚ <br><br> æœ€ç»ˆï¼Œæ­¤åŠŸèƒ½çš„å®ç°å¯¼è‡´æ·»åŠ äº†ä¸¤ä¸ªæ–°å·¥ä»¶ï¼šä»£ç ç”Ÿæˆé˜¶æ®µçš„<b>.h</b>å’Œ<b>.kt</b> ï¼Œcinteropé˜¶æ®µçš„å¤æ‚æ€§å’Œå²è¯—èˆ¬çš„phakapï¼Œæˆ‘å°†åœ¨æœ€åè®¨è®ºã€‚ <br><br><h2> ç¬¬äº”ç«  æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ </h2><br> ä¸ºä»€ä¹ˆçš„æ•…äº‹ï¼š <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ArgumentType</span></span> { PHP_STRING, PHP_LONG, PHP_DOUBLE, PHP_NULL, ... }</code> </pre> <br> ä¼˜äºï¼š <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArgumentType</span></span></span><span class="hljs-class"> {</span></span> STRING, LONG, DOUBLE, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ... }</code> </pre> <br> æ˜¯çš„ï¼Œç”šè‡³æ— éœ€è§£é‡Šã€‚ è¿™æ˜¯<code>ArgumentType.NULL</code>åœ¨Kotlinåº“çš„å¤´æ–‡ä»¶ä¸­å˜æˆçš„å†…å®¹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> extension_kt_kref_php_extension_dsl_ArgumentType (*get)(); <span class="hljs-comment"><span class="hljs-comment">/* enum entry for NULL. */</span></span> } <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br> è¿™å°±æ˜¯gccå¯¹æ­¤çš„ååº”ã€‚ <br><br><pre> <code class="hljs pgsql">/root/simpleExtension/phpmodule/extension_kt_api.h:<span class="hljs-number"><span class="hljs-number">113</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>: error: expected identifier <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">before</span></span> <span class="hljs-string"><span class="hljs-string">'void'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; ^</code> </pre><br> çª—å¸˜ï¼ å½“å¿ƒåå­—ã€‚ <br><br><h2> å€’æ•°ç¬¬äºŒç« ã€‚ æ‚¨ä¸ä¼šèµç¾è‡ªå·±-æ²¡æœ‰äººä¼šèµç¾æ‚¨ã€‚ </h2><br> æ€»çš„æ¥è¯´ï¼Œæˆ‘å·²ç»å®ç°äº†æˆ‘çš„ç›®æ ‡ã€‚ æ²‰æµ¸åœ¨è¯¥ä¸»é¢˜ä¸­çš„â€œæ¡†æ¶â€é€šå¸¸å°±å¯ä»¥åœ¨Kotlin Nativeä¸Šç¼–å†™PHPæ‰©å±•äº†ã€‚ ä»ç„¶éœ€è¦æ·»åŠ ä¸€äº›ï¼ˆè€Œä¸æ˜¯æœ€å…³é”®çš„ï¼‰åŠŸèƒ½å’Œä¿®é¥°ã€‚ <br><br> æˆ‘å¸Œæœ›è¯¥é¡¹ç›®æœ¬èº«ä»¥åŠå¾ˆå¥½çš„æ–‡æ¡£å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨github</a>ä¸ŠæŸ¥çœ‹ã€‚ <br><br> å…³äºK / Næˆ‘èƒ½è¯´äº›ä»€ä¹ˆï¼Ÿ å¾ˆå¥½ åœ¨ä¸Šé¢å†™ä¸œè¥¿æ˜¯ä¸€ç§äº«å—ï¼Œè€Œæµ…æµ…çš„æ²™å“‘å’Œç²—ç³™å¯ä»¥å½’å› äºä»–ç”šè‡³è¿˜æ²¡æœ‰çˆ¬å‡ºæ‘‡ç¯®çš„äº‹å®ï¼šï¼‰ <br><br><h2> æœ€åä¸€ç« ã€‚ å…‰çº¿å¾ˆå¥½ï¼Œæ²¡æœ‰å¼•å·ã€‚ </h2><br> ç°åœ¨ï¼Œæˆ‘è¦éå¸¸è®¤çœŸå¹¶æ·±åˆ‡åœ°æ„Ÿè°¢JetBrainsçš„å®¶ä¼™å’ŒKotlin Nativeæ¾å¼›é¢‘é“çš„å±…æ°‘ã€‚ ä½ çœŸå‰å®³ï¼ <br><br> è¿˜è¦ç‰¹åˆ«æ„Ÿè°¢<b>Nicholas Igotti</b> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tn/gr/px/tngrpxjotuvwziojqifyaxff5-y.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d1/5r/sn/d15rsndzgsxzin-aeglanekvtv4.png"></div><br><h2> çº¢åˆ© å²è¯—èˆ¬çš„Fakapã€‚ </h2><br> ä¸Šä¸‹æ–‡åœ¨ç¬¬å››ç« ä¸­è¿›è¡Œäº†æè¿°ã€‚ <br><br> å®é™…ä¸Šï¼Œå½“å°†æ‰€æœ‰å†…å®¹æ·»åŠ åˆ°å¯ä»¥æ— é”™è¯¯ç¼–è¯‘çš„çŠ¶æ€æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜-åœ¨æµ‹è¯•æœŸé—´ï¼ŒPHPä»ä¸€ä¸ªå®Œå…¨é™Œç”Ÿçš„è§’åº¦å‘æˆ‘å¼€æ”¾ã€‚ <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># php -dextension=./phpmodule/modules/extension.so -r </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"var_dump(ExampleClass::getInstance());"</span></span></span><span class="hljs-meta"> *RECURSION* #</span></span></code> </pre><br>  â€œè²åŠ æ–¯ï¼â€  -æˆ‘æƒ³ï¼Œæˆ‘è¿›å…¥äº†PHPæºä»£ç ï¼Œå‘ç°äº†è¿™æ ·çš„ç‰‡æ®µã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IS_OBJECT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Z_IS_RECURSIVE_P(struc)) { PUTS(<span class="hljs-string"><span class="hljs-string">"*RECURSION*\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br> æ·»åŠ è°ƒè¯•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%u"</span></span>, Z_IS_RECURSIVE_P(struc))</code> </pre> <br> å¯¼è‡´ï¼š <br><br><pre> <code class="hljs pgsql">undefined symbol: Z_IS_RECURSIVE_P <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-type"><span class="hljs-type">Unknown</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  â€œè²åŠ æ–¯ï¼â€ æˆ‘åˆæƒ³äº†ã€‚ <br><br> é‚£æ—¶ï¼Œæˆ‘çŒœæƒ³çœ‹ä¸€ä¸‹Linuxä¸»æœºä¸Šå®é™…ä½¿ç”¨çš„php.hï¼ˆ7.1.8ï¼‰ï¼Œè€Œä¸æ˜¯ä»æ—©åˆé¤ï¼ˆ7.3.xï¼‰çš„githubä¸Šæ‹‰æ¥çš„é‚£ä¸ªã€‚ ç›´asæ„§ã€‚ <br><br> ä½†æ˜¯ï¼Œäº‹å®è¯æ˜ï¼Œå®ƒä¸æ˜¯æ¢­èŠ¯ã€‚ <br><br> åœ¨æˆ‘æ§åˆ¶çš„å¯¹è±¡ç”Ÿå‘½çš„æ‰€æœ‰é˜¶æ®µï¼Œæ­£ç¡®çš„é€’å½’æ£€æŸ¥ä»£ç æŠ¥å‘Šä¸€åˆ‡æ­£å¸¸ã€‚ è¿™æ„å‘³ç€æ‚¨åº”è¯¥ä»”ç»†æŸ¥çœ‹é‚£äº›æˆ‘æ— æ³•æ§åˆ¶çš„åœ°æ–¹ã€‚ æ°å¥½æœ‰ä¸€ä»¶äº‹-å°†æˆ‘çš„å¯¹è±¡è¿”å›ç»™<code>var_dump</code>å‡½æ•° <br><br><pre> <code class="cpp hljs">RETURN_OBJ( example_symbols()-&gt;kotlin.root.php.extension.proxy.objectToZval( example_symbols()-&gt;kotlin.root.exampleclass.getInstance(<span class="hljs-comment"><span class="hljs-comment">/* */</span></span>) ) )</code> </pre> <br> å°†å®RETURN_OBJæ‰“å¼€åˆ°æœ€åã€‚ è¿œç¦»ç›‘æŠ¤äººç´§å¼ å’Œæ€€å­•ï¼ <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>) RETURN_OBJ(r) <span class="hljs-number"><span class="hljs-number">2</span></span>) { RETVAL_OBJ(r); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-number"><span class="hljs-number">3</span></span>) { ZVAL_OBJ(return_value, r); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { zval *__z = (return_value); Z_OBJ_P(__z) = (r); Z_TYPE_INFO_P(__z) = IS_OBJECT_EX; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-number"><span class="hljs-number">5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { zval *__z = (return_value); Z_OBJ(*(__z)) = (r); Z_TYPE_INFO(*(__z)) = (IS_OBJECT | (IS_TYPE_REFCOUNTED &lt;&lt; Z_TYPE_FLAGS_SHIFT)); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-number"><span class="hljs-number">6</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { zval *__z = (return_value); (*(__z)).value.obj = (r); (*(__z)).u1.type_info = (<span class="hljs-number"><span class="hljs-number">8</span></span> | ((<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ç¬¬äºŒæ¬¡æ„Ÿåˆ°asæ„§ã€‚ æˆ‘å®Œå…¨<code>zend_object*</code> ï¼Œå°†<code>zval*</code>æ¨åˆ°<code>zend_object*</code>ç­‰å¾…çš„åœ°æ–¹ï¼ŒèŠ±äº†å°†è¿‘ä¸¤å¤©çš„æ—¶é—´æŸ¥æ‰¾é”™è¯¯ã€‚ <br><br> è°¢è°¢å¤§å®¶ç§‘ç‰¹æ—ï¼  :) <br><br>  PSã€‚ å¦‚æœæœ‰ä¸€ä¸ªå–„è‰¯çš„äººèƒ½è¯»æ‡‚æˆ‘ç¬¨æ‹™çš„è‹±è¯­å¹¶æ›´æ­£æ–‡æ¡£ï¼Œé‚£ä¹ˆæˆ‘çš„æ„Ÿæ¿€ä¹‹æƒ…å°†æ— æ­¢å¢ƒã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423145/">https://habr.com/ru/post/zh-CN423145/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423135/index.html">ç¨‹åºå‘˜å¿«ä¹æ—¥ï¼šå‡ ä½å„¿ç«¥æ•™è‚²æœºå™¨äººè®¾è®¡å¸ˆ</a></li>
<li><a href="../zh-CN423137/index.html">GitHubæµè§ˆå™¨æ‰©å±•å¯æé«˜æ‚¨çš„å·¥ä½œæ•ˆç‡</a></li>
<li><a href="../zh-CN423139/index.html">å›´å¢™ï¼Œæœ‰æ•ˆçš„ç»ç†å’Œå·¥ç¨‹å¸ˆ</a></li>
<li><a href="../zh-CN423141/index.html">å…‹åŠ³å¾·Â·é¦™å†œï¼ˆClaude Shannonï¼‰ï¼šå¤©æ‰å¦‚ä½•è§£å†³é—®é¢˜</a></li>
<li><a href="../zh-CN423143/index.html">October Slermï¼šå¼ºåŒ–Kubernetes</a></li>
<li><a href="../zh-CN423147/index.html">å…³äºHadoopæ—¶ä»£çš„å­˜å‚¨ç­–ç•¥å’Œæ ¼å¼</a></li>
<li><a href="../zh-CN423149/index.html">ç›´æ¥æ¯”è¾ƒæ¿€å…‰è¿‘è§†çŸ«æ­£æ–¹æ³•æˆ–é€‰æ‹©ReLEx SMILEæ—¶éœ€è¦æ”¯ä»˜çš„è´¹ç”¨</a></li>
<li><a href="../zh-CN423151/index.html">PHPä¸­çš„å…¨å±€å¯¹è±¡</a></li>
<li><a href="../zh-CN423153/index.html">Node.jsæŒ‡å—ï¼Œç¬¬2éƒ¨åˆ†ï¼šJavaScriptï¼ŒV8ï¼Œä¸€äº›å¼€å‘æŠ€å·§</a></li>
<li><a href="../zh-CN423155/index.html">éº»çœç†å·¥å­¦é™¢çš„è¯¾ç¨‹â€œè®¡ç®—æœºç³»ç»Ÿå®‰å…¨â€ã€‚ è®²åº§8ï¼šç½‘ç»œå®‰å…¨æ¨¡å‹ï¼Œç¬¬2éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>