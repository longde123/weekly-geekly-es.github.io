<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš¶ğŸ¼ ğŸ… â© Server pesan push ğŸ–ï¸ ğŸ”­ ğŸš°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam setiap layanan Internet modern, hanya ada dua fungsi utama: 



- Yang pertama adalah otorisasi pengguna. 
- Yang kedua adalah pengiriman instan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Server pesan push</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438388/">  Dalam setiap layanan Internet modern, hanya ada dua fungsi utama: <br><br><ul><li>  Yang pertama adalah otorisasi pengguna. </li><li>  Yang kedua adalah pengiriman instan suatu peristiwa dari server ke klien. </li></ul><br>  Poin pertama, saya pikir, tidak perlu penjelasan. <br><br>  Poin kedua adalah teknologi client-server, tetapi sebaliknya.  Klien tidak secara berkala membuat permintaan ke server - apakah ada pesan baru.  Server, ketika suatu peristiwa tertentu terjadi, segera mengirim pesan ke klien. <br><br>  Untuk pemahaman yang lebih baik, layanan ini bukan bola tertentu dalam ruang hampa.  Layanan dapat direpresentasikan sebagai: <br><br><ul><li>  Folder dengan file di cloud.  Informasi tentang mengubah, menambah dan menghapus dikirim ke pengguna lain atau pengguna saat ini, tetapi ke perangkat lain. </li><li>  Program komputer untuk membaca log server, ketika catatan "kesalahan" muncul, mengirimkan konten catatan ke pengguna di ponsel. </li><li>  Lubang intip video (kamera) mengambil gambar saat bergerak di dekat pintu apartemen. </li><li>  Layanan yang menerima telemetri dari aplikasi Android-otomatis. </li><li>  Layanan yang mirip dengan paragraf sebelumnya, yang memungkinkan Anda mengetahui apakah seorang anak telah mencapai sekolah atau telah pulang dari sekolah. </li></ul><br>  Daftar dapat diperluas tanpa batas waktu, sebagai contoh, hanya kasus penggunaan yang paling terkenal yang diberikan. <br><br>  Hampir semua contoh layanan dapat disajikan dalam bentuk "messenger".  Sebagian contoh dijelaskan persis seperti ini, saya melihat artikel tentang cara menghubungkan kamera dan mengirim gambar ke satu kurir terkenal. <br><br>  Belum lama ini ada sebuah artikel yang orang luar menonton layanan kamera di mata pintu, bukan kecerdasan buatan.  Saya tidak akan fokus pada layanan gratis dari perusahaan besar "baik".  Seperti yang mereka katakan dalam pepatah terkenal "Keju gratis terjadi di perangkap tikus" dan dipandu oleh pepatah lain "Kemeja Anda lebih dekat ke tubuh Anda", "layanan" Anda lebih baik. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode skrip server terbuka dan gratis</a> <br><br><img src="https://habrastorage.org/webt/wx/2d/a4/wx2da4acw9c3g_x0a_mxj8dukju.png"><br><a name="habracut"></a><br>  Saya memilih node.js socket.io postgreSQL untuk implementasi, saya mengimplementasikan versi pertama lebih dari dua tahun yang lalu, dan layanan ini terhubung erat dengan 1c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://infostart.ru/public/545047/</a> , mereka belum mengumumkan server interaksi di mana saja.  Tetapi itu sudah lama sekali, pada saat ini, bagian server sama sekali tidak terhubung dengan program yang disebutkan, bagian klien dapat diintegrasikan sebagai pemrosesan eksternal atau ekstensi. <br><br>  Nama yang dipilih signifikan - "push0k".  Bagian pertama diambil dari frasa "pesan push", bahasa Inggris kedua yang terkenal baik-baik saja dalam bentuk disingkat, tetapi ditulis sampai nol untuk yang paling signifikan. <br><br>  Dalam hal ini, ini bukan "keju gratis dalam perangkap tikus", karena ini membutuhkan komputer windows, linux, macOS (server) untuk bekerja melalui Internet, Anda memerlukan alamat ip eksternal, mungkin diteruskan.  Lebih disukai nama domain yang terkait dengan alamat ip eksternal.  Juga, itu diinginkan, tetapi tidak perlu, bukan sertifikat yang ditandatangani sendiri terkait dengan nama domain. <br><br>  Tidak ada persyaratan perangkat keras seperti itu, dapat bekerja di rumah nas, di mana ada buruh pelabuhan.  Docker di nas berarti arsitektur x86-64, dan postgreSQL tidak dapat diinstal di nas tersebut tanpa docker.  Pemahaman yang akurat tentang berapa banyak klien yang dapat didukung server seperti itu tergantung pada tugas - logika layanan dan lalu lintas yang ditransmisikan antara klien. <br><br><h4>  Deskripsi Server: </h4><br>  Server menggunakan modul tambahan: <br><br><ul><li>  socket.io - modul menambahkan protokol websocket dengan satu ton ext.  peluang. </li><li>  node-postgres - modul untuk komunikasi dengan server database postgreSQL. </li><li>  pm2 adalah modul untuk memulai beberapa proses server dengan load balancer. </li></ul><br><h4>  File Server: </h4><br><ul><li>  layanan starter.js - http, Anda dapat mengatakan panel admin server.  Melalui layanan ini, pengaturan diubah dan proses server websocket utama diluncurkan. </li><li>  push0k.js adalah server websocket utama. </li><li>  starter_cfg.js - pengaturan skrip administrasi server.  Koneksi ke postgreSQL dan file untuk koneksi https.  File untuk koneksi https, serta nama domain, mungkin berbeda dari server utama, untuk keamanan yang lebih besar.  Itu diubah secara manual pada awal pertama. </li><li>  config.js - pengaturan dasar seluruh server. </li><li>  package.js - modul pembuat versi deskripsi file yang diperlukan untuk pekerjaan. </li><li>  push0kStructure.sql - deskripsi file dari database postgreSQL untuk inisialisasi awal, sebuah database kosong. </li></ul><br><h4>  Instalasi: </h4><br>  1. Awalnya, Anda perlu menginstal node.js <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nodejs.org/en/download</a> <br><br>  2. PostgreSQL juga harus diinstal pada komputer jaringan lokal atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">postgrespro.ru/products/download yang</a> sama <br><br>  Pada server postgreSQL, perlu untuk mengeksekusi file "push0kStructure.sql" atau hampir semua pertanyaan dari file ini untuk membuat database dengan tabel yang diperlukan. <br><br>  3. Unduh lima file server pertama, kecuali push0kStructure.sql, ke direktori komputer mana pun. <br><br>  4. Dalam editor teks apa pun, edit file "starter_cfg.js".  Penting untuk menentukan parameter untuk menghubungkan ke server postgreSQL dan mengatur port untuk menghubungkan ke bagian administratif dari server push0k. <br><br>  5. Mulai terminal (konsol) dan gunakan perintah "cd / path / direktori / Anda /" untuk pergi ke direktori file server.  Jalur yang ditentukan dalam perintah terminal harus dari titik 3. <br><br>  6. Jalankan perintah di terminal â€œnpm installâ€ untuk menginstal modul tambahan. <br>  Jalankan perintah di terminal "simpul starter.js" untuk memulai layanan administrasi. <br><br>  7. Unduh dan instal program admin push0k.  Dalam "push0k admin" parameter dasar websocket, port server, jumlah proses dan banyak lainnya dikonfigurasi.  Anda dapat mengontrol awal dan berhenti proses server, membuat dan mengelola pengguna dan kamar mereka (grup). <br><br><h4>  Aplikasi admin Push0k </h4><br><img src="https://habrastorage.org/webt/fk/fo/go/fkfogovxziochbj901ouycltfjq.png"><br><br>  Aplikasi ini dibuat pada elektron menggunakan vue.js.  Di dalam, semacam sistem jendela diterapkan, dialog modal kecil dapat diseret dan dijatuhkan seperti windows, judul jendela untuk windows dibuat mirip dengan windows 10, untuk Mac OS seperti dalam versi terbaru, tetapi sejauh ini tanpa memperhitungkan tema gelap.  Untuk linux, saya akan kompilasi nanti, itu sedikit lebih rumit dengan judul dialog, saya pikir itu akan seperti di ubuntu dan, jika tidak ubuntu, maka menangkan 10 gaya.  Konsumsi memori pada win 10 dan Mac OS lebih dari 150 megabyte tidak melihat. <br><br>  Pada versi sebelumnya tidak mungkin menambahkan animasi, melakukan sedikit tanpa fanatisme.  Dialog yang dijelaskan sebelumnya - jendela muncul dari tengah jendela aplikasi, secara bertahap meningkat, ketika terbang, terbang ke tengah, menurun.  Juga, penekanan tombol dan bidang yang diperlukan akan dianimasikan. <br><br><img src="https://habrastorage.org/webt/rn/ts/vr/rntsvrtjjhvvsnpu6vf_oyguwou.gif"><br><br>  Selama implementasi, ada keinginan besar untuk membuat tema gelap, tetapi karena belum ada tema terang, saya harus puas dengan hanya panel tombol di sebelah kanan.  Pada Mac OS, ini hanya bagian gelap yang memiliki efek semangat, yaitu, sebagian transparan, mirip dengan sebagian besar jendela antarmuka standar.  Sayangnya, di Windows, efek serupa yang disebut desain lancar tidak dapat dilakukan karena tidak ada fungsi serupa di Windows untuk elektron. <br><br>  Seperti disebutkan sebelumnya, kontrol menggunakan protokol http dan ws (websocket).  Dimungkinkan untuk menggunakan koneksi https dan wss aman.  Dengan koneksi yang aman, Anda dapat melihat data sertifikat yang digunakan.  Sama halnya dengan browser, ikon "Kunci" digunakan - koneksi aman, "Kunci terbuka" - koneksi tidak aman.  Dan tanpa ikon, masing-masing - koneksi aman tidak digunakan. <br><br><img src="https://habrastorage.org/webt/xz/mt/ew/xzmtew2kpyuhppeugz2fth2lxvm.png"><br><br><h4>  Logika umum </h4><br>  Saya belum pernah melihat aplikasi seperti itu.  Selama pengembangan, saya dibimbing oleh fakta bahwa saya sendiri akan tertarik untuk memantau dan parameter apa yang harus dilihat dalam statistik. <br><br>  Misalnya, dalam tabel koneksi untuk setiap koneksi terdapat data "waktu koneksi", "waktu otorisasi", "waktu sinkronisasi".  Yang pertama memungkinkan Anda untuk memahami seberapa cepat koneksi "ws: //" atau "wss: //" yang diproteksi terbentuk.  Yang kedua - setelah koneksi, pesan dengan data otorisasi dikirim secara terpisah, selama otorisasi, permintaan verifikasi pengguna dilakukan dan cek hash kata sandi unik untuk setiap koneksi.  Ketiga adalah waktu untuk menerima pesan baru dan data referensi baru atau diperbarui.  Juga, versi node.js, socket.io, dan data yang dijelaskan lainnya umumnya disimpan, yang memungkinkan untuk memahami bagaimana pembaruan node.js atau modul secara terpisah memengaruhi kecepatan, atau beberapa perbaikan server dapat memengaruhi. <br><br><img src="https://habrastorage.org/webt/xs/_h/ak/xs_haktlpy5r-gb_6ktxpf9_osa.png"><br><br>  Dalam contoh di atas, hanya sebagian kecil dari data tersebut yang dijelaskan.  Juga, dalam tabel yang terpisah, waktu, ukuran dan kecepatan MB / s disimpan.  Unduh sinkronisasi data.  Tabel yang sama menyimpan data mengunduh file lampiran ke server dan mengunduh data ini dari server. <br><br>  Waktu untuk menghitung kecepatan dihitung pada klien atau server, tergantung pada situasinya.  Tidak mungkin menggunakan waktu dari server dan klien karena tidak dapat disinkronkan dengan sempurna.  Ini memberlakukan kelambatan ukuran ping kecil (konfirmasi pengiriman) antara klien dan server.  Saat mengunggah atau mengunduh file besar, lag yang dijelaskan tidak signifikan. <br><br>  Di tabel koneksi, Anda dapat melihat koneksi tertutup dengan data "byte yang dikirimkan", "byte yang diterima" dan "ukuran" dari data sinkronisasi lebih dari "byte yang ditransmisikan".  Saat menyinkronkan data, kompresi otomatis socket.io digunakan, saat mengunduh atau mengunduh lampiran, kompresi otomatis dinonaktifkan, karena sering mengompresi yang telah dikompres secara negatif mempengaruhi kecepatan. <br><br>  Seperti yang ditulis di awal artikel, tidak pernah ada tujuan untuk membuat satu layanan umum dan menghubungkan pengguna sebanyak mungkin ke sana.  Tapi itu selalu menarik berapa banyak secara teoritis ada pengguna dan jenis server apa yang akan ditahan. <br><br>  Untuk melakukan ini, saya membuat tes sederhana: Online ke klien dari ruangan tertentu (grup), pesan dikirim dengan parameter uji (dalam parameter hanya ada satu parameter utama - jumlah pesan), yang akan dikirim masing-masing klien ke klien lain secara online.  Setelah distribusi pengujian, total waktu semua pesan, notifikasi, entri dalam tabel postgresql, jumlah semua pesan, notifikasi dan entri dihitung, dan dengan demikian, kecepatan dihitung, termasuk total semua operasi di server. <br><br><img src="https://habrastorage.org/webt/mj/ir/eo/mjireosal4qxzjintjlz4rddhao.png"><br><br>  <i>Contoh dari tangkapan layar:</i> <i><br><br></i>  <i>Terkadang paling mengejutkan, hanya 10.000 pesan dan 390.000 isyarat,</i> <i><br></i>  <i>mengirim 50.000 pesan: Proses server: 4 Pengguna: 3</i> <i><br></i>  <i>Total pesan yang diterima 10.000 * 3 = 30.000</i> <i><br></i>  <i>Penerusan ke proses server lain 30.000 * Proses server: 4 - 1 = 90.000</i> <i><br></i>  <i>Dikirim ke penerima 30.000 * Pengguna: 3 - 1 = 60.000</i> <i><br></i>  <i>Pesan ditulis ke tabel postgreSQL 30.000</i> <i><br></i>  <i>90.000 pemberitahuan pengiriman diterima</i> <i><br></i>  <i>Tercatat dalam tabel notifikasi pengiriman postgreSQL 90.000</i> <i><br></i>  <i>Semua operasi 390.000</i> <br><br><h4>  Logika data di admin push0k </h4><br>  Dengan setiap koneksi, semua data referensi diperoleh: pengguna, ruang, perangkat, basis data, serta 300 entri terakhir dari "jurnal-statistik": Koneksi, Sinkronisasi Data, Penerusan lampiran, Pesan, Jurnal. <br><br>  Pesan praktis mengulangi tabel postgresql dan tidak memiliki filter, pengaturan dan formulir di mana Anda dapat melihat pesan sepenuhnya.  Logika tabel adalah debugging, adalah mungkin untuk dengan cepat melihat selama pengembangan apakah pesan telah mencapai tabel atau belum. <br><br><img src="https://habrastorage.org/webt/6y/ra/gj/6yragjyt0ycnvzmiy8cvbspfpsc.png"><br><br>  Tabel "Pengguna", "Kamar (grup)", "Koneksi" dan "Jurnal" diperbarui secara otomatis.  Untuk sisa data, tidak ada gunanya memperbarui online. <br><br>  Aplikasi admin push0k dapat diunduh di sini: <br><br>  Windows: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengaturan push0kadmin 19.1.11.exe</a> <br>  Mac OS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">push0kadmin-19.1.11.dmg</a> <br><br>  Ini gratis, tetapi tidak seperti server, saya belum berencana untuk membuka kode sumber. <br><br>  Pada artikel selanjutnya saya akan menjelaskan bagian klien dari klien desctop push0k, serta contoh kecil, kode dan cara menghubungkan, masuk dan menerima data dari server. <br><br>  Untuk versi sebelumnya yang disebutkan sebelumnya ada juga klien android, hidup abadi di latar belakang pada versi android ke-7 dan ke-8.  Tetapi untuk saat ini, saya pikir saya tidak ketinggalan lama.  Nantinya, saya pikir akan ada artikel ketiga dengan klien android, dan di sana Anda melihat dan iOS tidak jauh. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id438388/">https://habr.com/ru/post/id438388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id438376/index.html">Rekayasa terbalik. Ceritanya Milik saya</a></li>
<li><a href="../id438380/index.html">Pria, jeda pada pengecualian yang tertangkap</a></li>
<li><a href="../id438382/index.html">Organisasi pencarian di halaman web dalam JavaScript (tanpa jQuery)</a></li>
<li><a href="../id438384/index.html">Pelajaran kimia: cara mengekspos kristal microchip untuk fotografi</a></li>
<li><a href="../id438386/index.html">Dalam perjalanan ke prinsip fisik evolusi biologis</a></li>
<li><a href="../id438390/index.html">Mengapa pengembang lebih mahal daripada uang, bagaimana cara menyimpan dan meningkatkannya</a></li>
<li><a href="../id438392/index.html">Sejarah singkat dari satu "pita pintar"</a></li>
<li><a href="../id438394/index.html">Yii 2.0.16</a></li>
<li><a href="../id438396/index.html">Mengapa Anda harus memikirkan pemrograman fungsional</a></li>
<li><a href="../id438398/index.html">How I Keras in C ++ Diluncurkan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>