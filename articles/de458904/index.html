<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêò üèä üà∑Ô∏è Visualisierung der Anzahl der Siege f√ºr NBA-Teams mithilfe animierter Balkendiagramme in R. üèä ‚ùáÔ∏è üå≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zun√§chst einige Hintergrundinformationen. Mein Name ist Vladislav und meine Bekanntschaft mit R fand im August letzten Jahres statt. Ich habe mich auf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visualisierung der Anzahl der Siege f√ºr NBA-Teams mithilfe animierter Balkendiagramme in R.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458904/"><p>  Zun√§chst einige Hintergrundinformationen.  Mein Name ist Vladislav und meine Bekanntschaft mit R fand im August letzten Jahres statt.  Ich habe mich aufgrund der angewandten Natur entschieden, eine Programmiersprache zu lernen.  Seit meiner Kindheit habe ich gerne Sportstatistiken gef√ºhrt.  Mit zunehmendem Alter verwandelte sich dieses Hobby in den Wunsch, diese Zahlen irgendwie zu analysieren und auf der Grundlage der Datenanalyse, wenn m√∂glich, kluge Gedanken auszusprechen.  Das Problem ist, dass in den letzten Jahren der Sport von einer Datenwelle erfasst wurde, Dutzende von Unternehmen miteinander konkurrieren und versuchen, jede Aktion eines Fu√üballspielers, Basketballspielers oder Baseballspielers auf dem Platz zu berechnen, zu beschreiben und in das Neuron zu schieben.  Und Excel ist nicht kategorisch f√ºr die Analyse geeignet.  Also habe ich beschlossen, R zu studieren, damit die einfachste Analyse nicht einen halben Tag dauert.  Bereits im Verlauf der Studie wurde ein Interesse an der Programmierung als solcher hinzugef√ºgt, aber dies ist bereits der Text. </p><a name="habracut"></a><br><p>  Ich m√∂chte sofort bemerken, wie viel ich in Zukunft schreiben werde <del>  war schon in den simpsons </del>  war auf Habr in dem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir erstellen animierte Histogramme mit R.</a> Dieser Artikel ist wiederum eine √úbersetzung des Artikels <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen von trendigen animierten Balkendiagrammen mit R</a> aus Medium.  Um mich irgendwie von den obigen Artikeln zu unterscheiden, werde ich versuchen, genauer zu beschreiben, was ich tue, sowie jene Momente, die nicht im Originalartikel enthalten sind.  Zum F√ºllen der Spalten habe ich beispielsweise die Farben der NBA-Befehle verwendet, nicht die Standardpalette <code>ggplot2</code> , sondern in der Datenverarbeitung das Paket <code>data.table</code> , nicht <code>dplyr</code> .  Ich habe all diese Arbeit als Funktion erledigt. Jetzt reicht es aus, einfach den Namen des Teams und die Jahre zu schreiben, f√ºr die Sie die Anzahl der Siege z√§hlen m√ºssen. </p><br><h2 id="dannye">  Daten </h2><br><p>  Um den Zeitplan zu erstellen, habe ich Daten zur Anzahl der Siege f√ºr jedes der 30 NBA-Teams in den letzten 15 Spielzeiten verwendet.  Sie wurden von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stats.nba.com</a> mit der <strong>NBA Data Retriever-</strong> Erweiterung gesammelt, die mithilfe der NBA-API CSV-Dateien mit den erforderlichen Statistiken erstellt.  Hier sind die vollst√§ndigen Details aus meinem Projekt <a href="">auf Github</a> . </p><br><h2 id="ispolzuemye-biblioteki">  Verwendete Bibliotheken </h2><br><pre> <code class="plaintext hljs">library(data.table) library(tidyverse) library(gganimate)</code> </pre> <br><p>  F√ºr die Datenverarbeitung verwende ich <code>data.table</code> (einfach weil ich dieses Paket zuvor getroffen habe).  Ich <code>tidyverse</code> auch eine Reihe von <code>tidyverse</code> Paketen herunter und kein separates <code>ggplot2</code> um <code>ggplot2</code> keine Sorgen zu machen, wenn w√§hrend der Analyse eine Idee auftaucht, die das zus√§tzliche Laden eines Pakets aus dieser Menge erfordert.  In diesem speziellen Fall kann auf <code>ggplot2</code> verzichtet <code>ggplot2</code> , andere Set-Pakete sind nicht beteiligt.  Nun, <code>gganimate</code> setzt die Grafiken in Bewegung. </p><br><h2 id="rabota-s-dannymi">  Mit Daten arbeiten </h2><br><p>  Zuerst m√ºssen Sie die Daten in Ordnung bringen.  Grunds√§tzlich ben√∂tigen wir zum Erstellen von Diagrammen 2 von 79 Spalten einer Tabelle mit Rohdaten.  Sie k√∂nnen zuerst die erforderlichen Spalten ausw√§hlen und zuerst einige Werte ersetzen.  Ich ging den zweiten Weg. </p><br><p>  Die Tabelle in <code>data.table</code> hat die Form <code>dt[i, j, by]</code> , wobei by f√ºr die Gruppierung von Elementen "verantwortlich" ist.  Ich werde nach der TeamName-Spalte gruppieren.  Und da ist ein Haken.  In dieser Spalte werden die Namen der Teams angezeigt: Lakers, Celtics, Heat usw.  Im Berichtszeitraum (ab der Saison 2004/05) √§nderten mehrere Teams ihren Namen: New Orleans Hornets wurden zu New Orleans Pelicans, Charlotte Bobcats gab den historischen Namen Charlotte Hornets zur√ºck und Seattle Supersonics wurde Oklahoma City Thunder.  Dies kann zu Verwirrung f√ºhren.  Die folgenden Konvertierungen helfen, dies zu vermeiden: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table[TeamCity == "New Orleans" &amp; TeamName == "Hornets", TeamName := "Pelicans"][ TeamCity == "New Orleans/Oklahoma City" &amp; TeamName == "Hornets", TeamName := "Pelicans"][ TeamName == "Bobcats", TeamName := "Hornets"][ TeamName == "SuperSonics", TeamName := "Thunder"]</code> </pre> <br><p>  In diesem Zeitraum sind die √Ñnderungen minimal. Wenn Sie sie jedoch erweitern, wird es sehr schwierig, sie nach TeamName zu gruppieren, und Sie m√ºssen eine zuverl√§ssigere Spalte verwenden.  In diesen Daten ist dies TeamID. </p><br><p>  Zun√§chst werden die "zus√§tzlichen" Informationen entfernt, und es bleiben nur die Spalten √ºbrig, die wir f√ºr die Arbeit ben√∂tigen: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[ , .(TeamName, WINS)]</code> </pre> <br><p>  In <code>data.table</code> ersetzt das Konstrukt. () Die <code>data.table</code> .  Eine "klassischere" Option zum Ausw√§hlen von Spalten ist <code>table1 &lt;- table1[, c("TeamName", "WINS")]</code> .  Danach hat die Tabelle die folgende Form: </p><br><div class="scrollable-table"><table><thead><tr><th>  Teamname </th><th>  GEWINNT </th></tr></thead><tbody><tr><td>  Sonnen </td><td>  62 </td></tr><tr><td>  Hitze </td><td>  59 </td></tr><tr><td>  Sporen </td><td>  59 </td></tr><tr><td>  Kolben </td><td>  54 </td></tr></tbody></table></div><br><p>  F√ºr die Animation f√ºr jede Saison ist dies ausreichend. Um jedoch die Gesamtzahl der Siege f√ºr einen ausgew√§hlten Zeitraum zu berechnen, m√ºssen Sie die kumulierte Gesamtzahl der Siege berechnen. </p><br><p> <code>table1 &lt;- table1[, CumWins := cumsum(WINS), by = "TeamName"]</code> </p> <br><p>  Mit der <code>cumsum</code> Funktion erhalten wir die Zahlen, die wir brauchen.  Wenn Sie: = anstelle von = verwenden, k√∂nnen Sie der Tabelle eine neue Spalte hinzuf√ºgen. Ich √ºberschreibe sie nicht mit derselben CumWins-Spalte.  <code>by = "TeamName"</code> gruppiert die Daten nach dem Namen des Teams und der kumulierte Betrag wird f√ºr jedes der 30 Teams separat <code>by = "TeamName"</code> . </p><br><p>  Als n√§chstes f√ºge ich eine Spalte mit dem Jahr hinzu, in dem jede Saison begann.  Die NBA-Saison dauert von Oktober bis Mai und f√§llt in zwei Kalenderjahre.  In der Bezeichnung der Jahreszeit ist das Jahr ihres Beginns, d.h.  Saison: 2018 in der Tabelle ist die Saison 2018/19 in der Realit√§t. </p><br><p>  Die Originaltabelle enth√§lt diese Daten.  Die SeasonID-Spalte zeigt eine Zahl in Form von 2 (dem Jahr, in dem die Saison begann), z. B. 22004. Sie k√∂nnen die ersten beiden mit dem <code>stringr</code> Paket oder den grundlegenden R-Funktionen entfernen, aber ich bin einen etwas anderen Weg gegangen.  Es stellte sich heraus, dass ich diese Spalte zuerst verwende, um die erforderlichen Jahreszeiten anzugeben, dann eine Spalte mit Datumsangaben l√∂sche und erneut erstelle.  Zus√§tzliche Aktionen. </p><br><p>  Ich habe es wie folgt gemacht: </p><br><p> <code>table1 &lt;- table1[,year := rep(seq(2004, 2018), each = length(unique(table1$TeamName)))]</code> </p> <br><p>  Ich hatte ‚ÄûGl√ºck‚Äú, dass sich die Anzahl der Teams in der NBA f√ºr den ausgew√§hlten Zeitraum nicht ge√§ndert hat. Deshalb habe ich die Zahlen von 2004 bis 2018 nur 30 Mal wiederholt.  Wenn Sie in die Geschichte eingehen, ist diese Methode aufgrund der Tatsache, dass die Anzahl der Teams in jeder Saison unterschiedlich ist, unpraktisch. Daher ist es vorzuziehen, die Option zum L√∂schen der Spalte SeasonID zu verwenden. </p><br><p>  F√ºgen Sie dann die Cumrank-Spalte hinzu. </p><br><p> <code>table1 &lt;- table1[, cumrank := frank(-CumWins, ties.method = "random"), by = "year"]</code> </p> <br><p>  Es stellt die Rangfolge der Teams in jeder Saison nach der Anzahl der Siege dar und wird als Wert f√ºr die X-Achse verwendet. <code>frank</code> ein schnelleres <code>data.table</code> Analogon zum <code>data.table</code> , minus bedeutet Rangfolge in absteigender Reihenfolge (dies kann auch mit dem Argument <code>decreasing = TRUE</code> . Welche Reihenfolge die Teams mit der gleichen Anzahl von Siegen gehen werden, daher <code>ties.method = "random"</code> Nun, all dies ist in einem Jahr zusammengefasst. </p><br><p>  Bei der letzten Tabellenkonvertierung wird die Spalte <code>value_rel</code> . </p><br><p> <code>table1 &lt;- table1[, value_rel := CumWins/CumWins[cumrank==1], by = "year"]</code> </p> <br><p>  In dieser Spalte wird das Verh√§ltnis der Anzahl der Siege jedes Teams zum h√∂chsten Indikator f√ºr das Jahr ber√ºcksichtigt.  F√ºr die beste Mannschaft ist dieser Indikator 1, f√ºr den Rest ist er weniger, abh√§ngig vom Erfolg der Saison. </p><br><p>  Nach allen Erg√§nzungen hat die Tabelle die folgende Form: </p><br><div class="scrollable-table"><table><thead><tr><th>  Teamname </th><th>  GEWINNT </th><th>  Cumwins </th><th>  Jahr </th><th>  cumrank </th><th>  value_rel </th></tr></thead><tbody><tr><td>  Sporen </td><td>  59 </td><td>  59 </td><td>  2004 </td><td>  3 </td><td>  0,9516129 </td></tr><tr><td>  Sporen </td><td>  63 </td><td>  122 </td><td>  2005 </td><td>  1 </td><td>  1.0000000 </td></tr><tr><td>  Sporen </td><td>  58 </td><td>  180 </td><td>  2006 </td><td>  2 </td><td>  0,9729730 </td></tr><tr><td>  Sporen </td><td>  56 </td><td>  236 </td><td>  2007 </td><td>  1 </td><td>  1.0000000 </td></tr></tbody></table></div><br><p>  In der Tabelle ist nur ein Team dargestellt, um die Kumulativit√§t zu veranschaulichen.  Alle diese Aktionen werden wie bei der Namens√§nderung mit einer Kaskade eckiger Klammern ausgef√ºhrt </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[ ,.(TeamName, WINS)][ , CumWins := cumsum(WINS), by = "TeamName"][ ,year := rep(seq(2004, 2018), each = length(unique(table1$TeamName)))][ , cumrank := frank(-CumWins, ties.method = "random"), by = "year"][ , value_rel := CumWins/CumWins[cumrank==1], by = "year"]</code> </pre> <br><h2 id="izmenenie-zalivki-stolbcov-so-standartnoy-na-cveta-komand">  √Ñndern Sie die F√ºllung der Spalten vom Standard in die Farben der Teams. </h2><br><p>  Sie k√∂nnen sofort mit der Erstellung von Diagrammen fortfahren, aber es gibt, wie mir scheint, einen wichtigen Punkt: die Farbe der Spalten im Diagramm.  Sie k√∂nnen die Standard-Palette <code>ggplot2</code> verlassen, dies ist jedoch eine schlechte Option.  Erstens scheint es mir, dass sie h√§sslich ist.  Und zweitens ist es schwierig, ein Team in der Tabelle zu finden.  F√ºr NBA-Fans ist jedes Team einer bestimmten Farbe zugeordnet: Boston ist gr√ºn, Chicago ist rot, Sacramento ist lila usw.  Daher hilft die Verwendung der Farbe des Befehls in den F√ºllspalten, ihn trotz der F√ºlle an Blau und Rot schneller zu identifizieren. </p><br><p>  Erstellen Sie dazu eine Tabelle <code>table_color</code> mit dem Namen des Befehls und seiner Hauptfarbe.  Farben von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">teamcolorcodes.com</a> . </p><br><div class="scrollable-table"><table><thead><tr><th>  Teamname </th><th>  TEAM_color </th></tr></thead><tbody><tr><td>  Hawks </td><td>  # E03A3E </td></tr><tr><td>  Celtics </td><td>  # 007A33 </td></tr><tr><td>  Netze </td><td>  # 000000 </td></tr></tbody></table></div><br><p>  Mit der Farbtabelle m√ºssen Sie noch eine Manipulation durchf√ºhren.  Weil  Wenn Plotfaktoren verwendet werden, √§ndert sich die Reihenfolge der Teams.  Der erste auf der Liste ist Philadelphia 76 als alleiniger Eigent√ºmer des "digitalen" Namens und dann nach dem Alphabet.  Wir m√ºssen also die Farben in derselben Reihenfolge anordnen und dann den Vektor, der sie enth√§lt, aus der Tabelle extrahieren.  Ich habe es wie folgt gemacht: </p><br><pre> <code class="plaintext hljs"> table_color &lt;- table_color[order(TeamName)] cols &lt;- table_color[, "TEAM_color"]</code> </pre> <br><h2 id="postroenie-grafika">  Plotten </h2><br><p>  Wir erstellen wirklich nur ein Diagramm, das alle 450 (15 Spielzeiten * 30 Teams) Indikatoren f√ºr Siege enth√§lt, und "dividieren" es dann durch die erforderliche Variable (in unserem Fall durch Jahre) unter Verwendung der Funktionen aus dem <code>gganimate</code> Paket. </p><br><pre> <code class="plaintext hljs">gg &lt;- ggplot(table1, aes(cumrank, group = TeamName, fill = as.factor(TeamName), color = as.factor(TeamName))) + geom_tile(aes(y = CumWins/2, height = CumWins, width = 0.7), color = NA, alpha = 0.8)</code> </pre> <br><p>  Zuerst erstellen wir eine Grafik mit der Funktion <code>ggplot</code> .  <code>aes</code> Argument <code>aes</code> , wie die Variablen aus der Tabelle im Diagramm angezeigt werden sollen.  Wir gruppieren sie nach Teamname, <code>fill</code> und <code>color</code> sind f√ºr die Farbe der Spalten verantwortlich. </p><br><p>  Wahre Spalten nennen es nicht ganz wahr.  Mit <code>geom_tile</code> "teilen" wir die Daten im Diagramm in Rechtecke.  Hier ist ein Beispiel f√ºr ein Diagramm dieses Typs: <br><img src="https://habrastorage.org/getpro/habr/post_images/210/405/916/2104059165b8000275951025c2020b5b.jpg"><br>  Es ist zu sehen, wie der Graph in Quadrate "unterteilt" wird (sie werden aus Rechtecken unter Verwendung der <code>coord_equal()</code> ), drei in jeder Spalte.  Dank der Argumentbreite von weniger als eins hat unsere Kachel die Form von Spalten. </p><br><pre> <code class="plaintext hljs"> geom_text(aes(y = 0, label = paste(TeamName, " ")), vjust = 0.2, hjust = 1, size = 6) + geom_text(aes(y = CumWins, label = paste0(" ",round(CumWins))), hjust = 0, size = 7) + coord_flip(clip = "off", expand = FALSE) + scale_fill_manual(values = cols) + scale_color_manual(values = cols) + scale_y_continuous(labels = scales::comma) + scale_x_reverse() + guides(color = FALSE, fill = FALSE) +</code> </pre> <br><p>  Als n√§chstes f√ºge ich mit <code>geom_text</code> zwei Signaturen <code>geom_text</code> : den Namen des Teams und die Anzahl der Siege.  <code>coord_flip</code> die Achsen, <code>scale_fill_manual</code> und <code>scale_color_manual</code> √§ndern die Farbe der Spalten, <code>scale_x_reverse</code> "erweitert" die X-Achse. Beachten Sie, dass wir die Farben aus dem zuvor erstellten <code>cols</code> . </p><br><p>  Die Themenebene gibt Optionen zum Anpassen der Anzeige des Diagramms an.  Hier wird angegeben, wie die √úberschriften und Beschriftungen der Achsen angezeigt werden sollen (in keiner Weise, was <code>element_blank</code> auf der rechten Seite der Gleichheit sagt).  Wir entfernen die Legenden-, Hintergrund-, Rahmen- und Gitterlinien entlang der Y-Achse. <code>plot.title</code> Argumenten <code>plot.title</code> , <code>plot.subtitle</code> , <code>plot.caption</code> wir die Anzeigeoptionen f√ºr Titel, Untertitel und Diagrammsignatur fest.  Weitere Einzelheiten zur Bedeutung aller Parameter finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gglot2</a> </p><br><pre> <code class="plaintext hljs">theme(axis.line=element_blank(), axis.text.x=element_blank(), axis.text.y=element_blank(), axis.ticks=element_blank(), axis.title.x=element_blank(), axis.title.y=element_blank(), legend.position="none", panel.background=element_blank(), panel.border=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.grid.major.x = element_line( size=.1, color="grey" ), panel.grid.minor.x = element_line( size=.1, color="grey" ), plot.title=element_text(size=25, hjust=0.5, face="bold", colour="black", vjust=-1), plot.subtitle = element_text(size = 15), plot.caption =element_text(size=15, hjust=0.5, color="black"), plot.background=element_blank(), plot.margin = margin(2,2, 2, 4, "cm"))</code> </pre> <br><h2 id="sozdanie-animacii">  Animation erstellen </h2><br><p>  Ich werde nicht auf die Verwendung der Funktion <code>transition_states</code> eingehen, dieser Teil ist identisch mit meiner fr√ºheren Ver√∂ffentlichung √ºber Habr√©.  In <code>labs</code> Titel, Untertitel und Signatur des Diagramms erstellt.  Mit <code>{closest_state}</code> k√∂nnen Sie jedes bestimmte Jahr in der Tabelle anzeigen, deren Spalten derzeit angezeigt werden. </p><br><pre> <code class="plaintext hljs"> anim &lt;- gg + transition_states(year, transition_length = 4, state_length = 1) + view_follow(fixed_x = TRUE) + labs(title = "Cumulative Wins by teams in seasons", subtitle = "Season: {closest_state}", caption = "Telegram: @NBAatlantic, Twitter: @vshufiskiy\n Data sourse: stats.nba.com")</code> </pre> <br><h2 id="funkciya-nba_cumulative_wins-dlya-sozdaniya-grafikov">  <code>nba_cumulative_wins</code> Funktion zum Erstellen von Diagrammen. </h2><br><p>  Das Schreiben von Funktionen vereinfacht und beschleunigt das Abrufen des Ergebnisses, wenn Sie den Code mehrmals verwenden m√ºssen.  Normalerweise hat eine Funktion in R die folgende Form: </p><br><pre> <code class="plaintext hljs">_ &lt;- function( ) { _ }</code> </pre> <br><p>  Zuerst m√ºssen Sie verstehen, welche Parameter Sie mit der Funktion √§ndern m√∂chten. Die Argumente h√§ngen davon ab.  Das erste Argument ist der Name der Datentabelle, die eingegeben wird.  Auf diese Weise k√∂nnen Sie es umbenennen, wenn ein solcher Wunsch auftritt, ohne die Funktion selbst zu √§ndern.  Ich m√∂chte auch, dass eine beliebige Anzahl von Befehlen in der Tabelle angezeigt wird: von einem (was sinnlos ist) bis 30 (es gibt einfach keine mehr).  Ich m√∂chte auch in der Lage sein, alle Zeitr√§ume innerhalb der 15 Jahre zu ber√ºcksichtigen, f√ºr die ich Daten habe.  All dies wird in dieser Funktionsform implementiert: </p><br><pre> <code class="plaintext hljs">nba_cumulative_wins &lt;- function(table, elements, first_season, last_season){ ... }</code> </pre> <br><p>  Dabei ist <code>table</code> der Name der Tabelle mit den Eingabedaten. <br>  <code>elements</code> - die Namen der Teams, die in der Tabelle angezeigt werden sollen <br>  <code>first_season</code> - Die erste Saison, die in der Tabelle angezeigt wird <br>  <code>last_season</code> - Die letzte Saison, die in der Tabelle angezeigt wird. </p><br><p>  Wenn das Argument sehr h√§ufig mit einem bestimmten Wert verwendet wird, k√∂nnen Sie es standardm√§√üig festlegen.  Wenn es dann unter den Argumenten der Funktion weggelassen wird, wird dieser Wert ersetzt.  Zum Beispiel, wenn Sie sich registrieren </p><br><p> <code>nba_cumulative_wins &lt;- function(table, elements, first_season, last_season = 2018)</code> </p> <br><p>  dann werden die Zeitpl√§ne bis zur Saison 2018/19 erstellt, sofern nicht anders angegeben. </p><br><h2 id="rabota-s-argumentami-elements-first_season-last_season">  Arbeiten mit Argumentelementen, <code>first_season</code> , <code>last_season</code> </h2><br><p>  Mit dem Argument <code>elements</code> k√∂nnen wir den Namen der Teams angeben, die im Diagramm angezeigt werden sollen.  Dies ist sehr praktisch, wenn es 2 oder 3 solcher Teams gibt. Wenn wir jedoch die gesamte Liga anzeigen m√∂chten, m√ºssen wir <code>elements = c()</code> und den Namen aller 30 Teams in Klammern schreiben. </p><br><p>  Deshalb habe ich beschlossen, die Eingabewerte f√ºr das Elementargument in mehrere Gruppen aufzuteilen. <br>  Mit der Funktion <code>nba_cumulative_wins</code> k√∂nnen Diagramme f√ºr einzelne Teams, Abteilungen, Konferenzen oder die NBA als Ganzes erstellt werden.  Daf√ºr habe ich folgende Konstruktion verwendet: </p><br><pre> <code class="plaintext hljs"> select_teams &lt;- unique(table1$TeamName) select_div &lt;- unique(table1$Division) select_conf &lt;- unique(table1$Conference) select_nba &lt;- "NBA" table1 &lt;- if(elements %in% select_teams){ table1[TeamName %in% elements] } else if (elements %in% select_div){ table1[Division %in% elements] } else if(elements %in% select_conf){ table1[Conference %in% elements] } else if(elements == "NBA"){ table1 } else { NULL }</code> </pre> <br><p>  <code>select_</code> Symbolvektoren enthalten die Namen aller 30 Teams, 6 Abteilungen, 2 Konferenzen und der NBA, und die <code>unique</code> Funktion hinterl√§sst nur einen eindeutigen Namen anstelle von 15 (nach der Anzahl der Jahre in den Daten). </p><br><p>  Anschlie√üend wird mithilfe des <code>if...else</code> √ºberpr√ºft, ob das eingegebene Elementargument zu einer der Klassen geh√∂rt ( <code>%in%</code> verwendet, um zu bestimmen, ob das Element zum Vektor geh√∂rt), und die Datentabelle wird entsprechend ge√§ndert.  Nun, wenn ich stattdessen die Ergebnisse von Teams sehen m√∂chte, die in der Southwest Division spielen </p><br><p> <code>elements = c("Mavericks", "Spurs", "Rockets", "Grillies", "Pelicans")</code> </p> <br><p>  einfach eintreten </p><br><p>  <code>elements = "Southwest"</code> , was viel schneller und bequemer ist. </p><br><p>  Aufgrund der M√∂glichkeit, Jahreszeiten zu w√§hlen, √§ndert sich auch die Arbeit mit Daten.  Ganz am Anfang wird die Zeile hinzugef√ºgt: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[SeasonID &gt;= as.numeric(paste(2, first_season, sep = "")) &amp; SeasonID &lt;= as.numeric(paste(2, last_season, sep = ""))]</code> </pre> <br><p>  Daher lasse ich in der Tabelle nur die Zeilen, die in das von uns gew√§hlte Zeitintervall fallen.  Der Code zum Erstellen der Jahresspalte √§ndert sich ebenfalls.  Jetzt sieht es so aus: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[ ,year := rep(seq(first_season, last_season), each = length(unique(table1$TeamName)))]</code> </pre> <br><p>  Im Zusammenhang mit der Gruppierung von Elementen ist das Verfahren zum Erhalten der gew√ºnschten Farben kompliziert.  Tatsache ist, dass in der Tabelle <code>table_color</code> nur die Namen der Befehle angegeben sind.  Daher m√ºssen wir unsere Kontraktionen wieder ‚Äûeinsetzen‚Äú.  Verwenden Sie dazu das Konstrukt <code>if...else</code> erneut. </p><br><pre> <code class="plaintext hljs"> elements1 &lt;- if (elements == "NBA"){ c("Hawks", "Celtics", "Nets", "Hornets", "Bulls", "Cavaliers", "Mavericks", "Nuggets", "Pistons", "Warriors", "Rockets", "Pacers", "Clippers", "Lakers", "Grizzlies", "Heat", "Bucks", "Timberwolves", "Pelicans", "Knicks", "Thunder", "Magic", "76ers", "Suns", "Trail Blazers","Kings", "Spurs", "Raptors", "Jazz", "Wizards") } else if (elements == "West") { c("Mavericks","Nuggets", "Warriors", "Rockets", "Clippers", "Lakers", "Grizzlies","Timberwolves", "Pelicans", "Thunder", "Suns", "Trail Blazers","Kings", "Spurs", "Jazz") } else if (elements == "East") { c("Hawks", "Celtics", "Nets", "Hornets", "Bulls", "Cavaliers","Pistons", "Pacers", "Heat", "Bucks", "Knicks", "Magic", "76ers", "Raptors", "Wizards") } else if (elements == "Pacific") { c("Warriors", "Clippers", "Lakers", "Suns", "Kings") } else if (elements == "Southeast") { c("Magic", "Hornets", "Heat", "Hawks", "Wizards") } else if (elements == "Southwest") { c("Mavericks", "Grizzlies", "Pelicans", "Rockets", "Spurs") } else if (elements == "Central") { c("Bucks", "Pacers", "Pistons", "Bulls", "Cavaliers") } else if (elements == "Atlantic") { c("Knicks", "Nets", "Celtics", "Raptors", "76ers") } else if (elements == "Northwest") { c("Nuggets", "Trail Blazers", "Jazz", "Thunder", "Suns") } else { elements }</code> </pre> <br><p>  Erstellen Sie als N√§chstes eine Tabelle mit den Namen der ben√∂tigten Befehle und verbinden Sie diese Tabelle mit <code>table_color</code> mithilfe der Funktion <code>inner_join</code> aus dem Paket <code>dplyr</code> .  <code>inner_join</code> enth√§lt nur F√§lle, die in beiden Tabellen √ºbereinstimmen. </p><br><pre> <code class="plaintext hljs"> table_elements1 &lt;- data.table(TeamName = elements1) table_color &lt;- table_color[order(TeamName)] inner_table_color &lt;- inner_join(table_color, table_elements1) cols &lt;- inner_table_color[, "TEAM_color"]</code> </pre> <br><p>  Die Funktion √§ndert die Schreibweise von Titel und Untertitel.  Sie nehmen diesen Blick an: </p><br><pre> <code class="plaintext hljs">anim &lt;- gg + transition_states(year, transition_length = 4, state_length = 1) + view_follow(fixed_x = TRUE) + labs(title = paste("Cumulative Wins by teams in seasons", first_season, "-", last_season, sep = " "), subtitle = paste(if (elements %in% select_div ){ paste(elements, "Division", sep = " ") } else if (elements %in% select_conf ){ paste("Conference", elements, sep = " ") }, "Season: {closest_state}", sep = " "), caption = "Telegram: @NBAatlantic, Twitter: @vshufiskiy\nData sourse: stats.nba.com")</code> </pre> <br><h2 id="rendering">  Rendern </h2><br><p>  Weiter wird dies alles visualisiert. </p><br><pre> <code class="plaintext hljs">animate(anim, nframes = (last_season - first_season + 1) * (length(unique(table1$TeamName)) + 20), fps = 20, width = 1200, height = 1000, renderer = gifski_renderer(paste(elements[1], "cumwins.gif", sep = "_")))</code> </pre> <br><p>  Ich habe die Anzahl in <code>nframes</code> empirisch ausgew√§hlt, sodass die Geschwindigkeit abh√§ngig von der Anzahl der ausgew√§hlten Befehle zunimmt / abnimmt. </p><br><h2 id="grafik">  Grafik </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e15/803/11d/e1580311d19d5f814b201c32237a3ed5.gif"></p><br><p>  Ich hoffe mein Beitrag ist interessant.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-</a> Projektcode. </p><br><p>  Wenn Sie an der Sportkomponente dieser Visualisierungen interessiert sind, k√∂nnen Sie meinen Blog auf sports.ru "Auf beiden Seiten des Atlantiks" besuchen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458904/">https://habr.com/ru/post/de458904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458892/index.html">Vorschl√§ge f√ºr Sicherheitsl√ºcken und den Schutz von Modellen f√ºr maschinelles Lernen</a></li>
<li><a href="../de458894/index.html">Typische Menschen und die Netzwerke, in denen sie leben</a></li>
<li><a href="../de458896/index.html">Funktionales JavaScript: Was sind Funktionen h√∂herer Ordnung und warum werden sie ben√∂tigt?</a></li>
<li><a href="../de458900/index.html">Konsolenpatronen als Modems</a></li>
<li><a href="../de458902/index.html">5 H√§ufige Python-Anf√§ngerfehler</a></li>
<li><a href="../de458906/index.html">[Jekaterinburg, Ank√ºndigung] Flutteron - ein Workshop zur Entwicklung von Flutter</a></li>
<li><a href="../de458908/index.html">Scannen von Dokumenten √ºber das Netzwerk</a></li>
<li><a href="../de458910/index.html">Benchmarking von PostgreSQL mit gro√üen Linux-Seiten</a></li>
<li><a href="../de458912/index.html">Mit Imapsync nach Zimbra migrieren</a></li>
<li><a href="../de458914/index.html">Was (nicht) Sie wissen m√ºssen, um Spiele auf Unity zu erstellen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>