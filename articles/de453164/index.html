<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç§ üë®üèæ‚Äçüè´ üèÅ Kryptografische Token PKCS # 11. Grafikdienstprogramm "mit der Funktion zum Signieren und Hinzuf√ºgen eines Zeitstempels." Teil 1 üëßüèæ üêÅ üå±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In den Kommentaren zum Artikel ‚ÄûVerwenden von kryptografischen Token-Mechanismen von PKCS # 11 in Skriptsprachen‚Äú schrieb der kovserg- Leser: 
 "Wir f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kryptografische Token PKCS # 11. Grafikdienstprogramm "mit der Funktion zum Signieren und Hinzuf√ºgen eines Zeitstempels." Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453164/"><img src="https://habrastorage.org/webt/xh/tq/ph/xhtqphqpspdmceylr6o1duj5vpu.png" align="left">  In den Kommentaren zum Artikel ‚ÄûVerwenden von kryptografischen Token-Mechanismen von PKCS # 11 in Skriptsprachen‚Äú schrieb der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">kovserg-</a> Leser: <br><blockquote>  "Wir freuen uns auf einen Artikel mit der Funktion, ein Dokument zu signieren und einen Zeitstempel hinzuzuf√ºgen." </blockquote>  Zuvor schrieb ein anderer Teilnehmer des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Pas</a> Habr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,</a> dass es gro√üartig w√§re, wenn PKCS # 11-Token, "die jeder z√§hlen kann" (dh haupts√§chlich kryptografische Operationen zum Generieren von Schl√ºsseln, Generieren und √úberpr√ºfen elektronischer), alle Arten von Zwischenschichten loswerden und haben w√ºrden Ein Dienstprogramm, das mithilfe der Mechanismen des Tokens selbst eine Zertifikatanforderung bilden und Dokumente signieren, die Signatur von Dokumenten √ºberpr√ºfen, die Signatur und G√ºltigkeit von Zertifikaten √ºberpr√ºfen kann. <br><a name="habracut"></a><br><h3>  <font color="1368c2">Bekanntschaft mit dem Dienstprogramm</font> </h3><br>  Infolgedessen pr√§sentieren wir das Dienstprogramm dem Benutzergericht <br><br><div class="spoiler">  <b class="spoiler_title">guipkcs7_tclpkcs11:</b> <div class="spoiler_text"><ul><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">OS X.</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div><br><img src="https://habrastorage.org/webt/3a/zo/ob/3azoobtvrkbo6boo_tvquyt03ns.png"><br><br>  Die treibende Kraft dieses Dienstprogramms ist das kryptografische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PKCS # 11-Token</a> mit Unterst√ºtzung f√ºr die russische Kryptografie mindestens GOST R 34.10-2012.  Wenn Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√∂ffentliche Dienste</a> usw. nutzen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">m√∂chten</a> , m√ºssen Sie dennoch ein Token erwerben, das zertifizierte Tests im Zertifizierungssystem des FSB von Russland bestanden hat.  Wenn dies Ihre interne elektronische Dokumentenverwaltung ist, liegt dies nat√ºrlich in Ihrem Ermessen.  PKCS # 11-Token k√∂nnen unterschiedlich sein: Software, Hardware oder sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud</a> .  Das Dienstprogramm ist in der Skriptsprache <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tcl / Tk geschrieben</a> .  Vergessen Sie beim Kauf eines PKCS # 11-Tokens nicht, zu erfahren, wo Sie die Bibliotheken f√ºr das gekaufte Token f√ºr verschiedene Plattformen herunterladen k√∂nnen.  Bibliotheken sind in der Regel frei verf√ºgbar.  Das Dienstprogramm verwendet das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TclPKCS11-</a> Paket, um auf kryptografische und andere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tokenfunktionen</a> zuzugreifen.  Das Dienstprogramm w√§hlt zun√§chst eine Bibliothek aus, die Ihre Token unterst√ºtzt.  Beachten Sie, dass Bibliotheksbibliotheken gleichzeitig mit mehreren Token arbeiten k√∂nnen (Kombinationsfeld ‚ÄûToken / Smartcard ausw√§hlen‚Äú): <br><br><img src="https://habrastorage.org/webt/hr/1j/zc/hr1jzcxcrdug57at8an0in9ahik.png"><br><br>  Die Frage kann sich stellen, aber was soll ich tun, wenn das Token nicht initialisiert ist oder ich PIN-Codes usw. √§ndern muss?  Die Antwort ist einfach: Verwenden Sie das Token-Konfigurationsprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">p11conf</a> . <br><br>  Um die Liste der Token zu aktualisieren (deaktivieren Sie das Token, f√ºgen Sie ein neues hinzu), klicken Sie einfach auf <br>  nach Symbol <img src="https://habrastorage.org/webt/wj/dj/xy/wjdjxy2orhsi7op3stcjzpogisa.png">  befindet sich rechts neben der Combobox "W√§hlen Sie einen Token / eine Smartcard" <br>  Die Combox ‚ÄûZertifikat‚Äú enth√§lt Beschriftungen aller Zertifikate, die auf dem ausgew√§hlten (aktuellen) Token gespeichert sind: <br><br><img src="https://habrastorage.org/webt/ws/ew/bx/wsewbxr_8nksvtk9j-ckfs_ixwe.png"><br><br>  Wenn Sie auf das Symbol klicken <img src="https://habrastorage.org/webt/ko/sk/sc/koskscpianfsm5kgw_1peg91t6u.png">  Rechts neben dem Combobox-Zertifikat wird ein Fenster mit dem Inhalt des Zertifikats angezeigt: <br><br><img src="https://habrastorage.org/webt/9x/tg/qi/9xtgqiqpbgtwhu1nyb7p0ttkii4.png"><br><br>  Wenn Sie im Anzeigefenster auf die Schaltfl√§che ‚ÄûSpeichern / Speichern‚Äú klicken, wird der Inhalt des analysierten Zertifikats im Textformat in der von Ihnen angegebenen Datei gespeichert. <br>  Um Informationen zum aktuellen Token anzuzeigen, k√∂nnen Sie auf die Schaltfl√§che "6. Informationen zum Token" klicken oder den Cursor auf die Token-Bezeichnung bewegen: <br><br><img src="https://habrastorage.org/webt/cb/hn/5y/cbhn5yy0qyyremnetuakmcreoia.png"><br><br>  Um herauszufinden, welche kryptografischen Mechanismen das aktuelle Token unterst√ºtzt, klicken Sie einfach auf die Schaltfl√§che ‚Äû5. Liste der Mechanismen‚Äú: <br><br><img src="https://habrastorage.org/webt/0z/d2/d_/0zd2d_rk1jpetlsa883wthvye0e.png"><br><br><h3>  <font color="1368c2">Erstellen Sie eine Zertifikatanforderung</font> </h3>  Wir gehen zu den Hauptfunktionen des Dienstprogramms √ºber.  Und die erste solche Funktion besteht darin, eine Zertifikatanforderung zu erstellen (Schaltfl√§che "3. Zertifikatanforderung"): <br><br><img src="https://habrastorage.org/webt/z9/ef/lf/z9eflfzgcrus2an8mc86t9djsv8.png"><br><br>  Die Meldung "Token unterst√ºtzt keine Schl√ºssel ..." wird angezeigt, wenn das ausgew√§hlte Token die Generierung dieses Schl√ºsseltyps nicht unterst√ºtzt.  In diesem Fall m√ºssen Sie einen anderen Schl√ºsseltyp oder ein anderes Token ausw√§hlen.  In diesem Beispiel k√∂nnen Sie das RuToken ECP 2.0-Token verwenden (siehe den zweiten Screenshot).  In der Combobox "Zertifikatsinhaber" k√∂nnen Sie angeben, wem das Zertifikat geh√∂rt: einer Person, einer juristischen Person oder einem einzelnen Unternehmer.  Abh√§ngig davon werden die auszuf√ºllenden Felder auf den folgenden Seiten gebildet. <br><br>  Ein wichtiges Feld ist hier das Feld "Name CIPF".  Es ist ein wesentlicher Bestandteil eines qualifizierten Zertifikats und gibt an, wie das kryptografische Informationsschutzsystem das Schl√ºsselpaar generiert.  Den Namen des Schutzzertifikats f√ºr kryptografische Informationen finden Sie im Produktformular oder zum Zeitpunkt des Kaufs des Tokens.  Stimmt das Typfeld in den Token-Informationen mit dem Namen des kryptografischen Informationsschutzsystems √ºberein, f√§llt es mir schwer zu sagen.  Es ist also besser, das Formular zu sehen.  Klicken Sie auf Weiter und f√ºllen Sie die erforderlichen Felder aus: <br><br><img src="https://habrastorage.org/webt/gj/vi/rx/gjvirxly5zr2gy1d22h-ifdzoei.png"><br><br>  Beim Ausf√ºllen versucht das Dienstprogramm, die Richtigkeit des Ausf√ºllens der Felder (E-Mail, PSRN usw.) durch entsprechende Warnungen zu √ºberpr√ºfen.  Nach dem Ausf√ºllen der Hauptfelder werden Sie aufgefordert, das Format und den Speicherort der Zertifikatanforderung auf Ihrem Computer zu bestimmen.  Sie m√ºssen au√üerdem den PIN-Code Ihres Tokens eingeben: <br><br><img src="https://habrastorage.org/webt/kg/xm/bm/kgxmbm_2xtski-x5fhh4jzkyeys.png"><br><br>  Nachdem Sie auf die Schaltfl√§che "Weiter" geklickt haben, werden Sie aufgefordert, die eingegebenen Daten erneut zu √ºberpr√ºfen und Ihre Entscheidung durch Dr√ºcken der Taste "Fertig stellen" zu best√§tigen: <br><br><img src="https://habrastorage.org/webt/kk/yv/gr/kkyvgr2ayqktgluvfms_ooxhn5w.png"><br><br>  Wenn Sie auf die Schaltfl√§che Fertig stellen klicken, wird auf Ihrem Token ein Schl√ºsselpaar generiert, eine Anforderung erstellt und signiert: <br><br><img src="https://habrastorage.org/webt/uo/hj/nr/uohjnrhhbt6ih9qbsbdxzu3wqg0.png"><br><br>  Und k√∂nnen Sie sicherstellen, dass die Schl√ºssel generiert und auf dem Token gespeichert werden?  Ja  Wir dr√ºcken die Schaltfl√§che ‚Äû7. Token-Objekte‚Äú, geben den PIN-Code ein, um auf das Token zuzugreifen, und suchen nach den Objekten SKO_PRIVATE_KEY und CKO_PUBLIV_KEY, deren Beschriftungen mit dem Feld ‚ÄûCOMMON NANE‚Äú (CN) √ºbereinstimmen, das Sie beim Erstellen der Zertifikatanforderung ausgef√ºllt haben.  In unserem Beispiel war es der "Allm√§chtige Habr": <br><br><img src="https://habrastorage.org/webt/vv/rp/jm/vvrpjmoqxpgjfolr_mzino1uwhc.png"><br><br>  Sah und ging sofort zu einer anderen Seite.  Der beste Beweis daf√ºr, dass ein Schl√ºsselpaar erfolgreich erstellt wurde, ist das Vorhandensein der signierten Anforderung selbst.  Um dies zu √ºberpr√ºfen, klicken Sie auf die Schaltfl√§che "Anforderung / Zertifikat anzeigen", w√§hlen Sie die gespeicherte Anforderung aus, klicken Sie auf die Schaltfl√§che "Anforderung f√ºr Zertifikat anzeigen" und sehen Sie sich die Informationen zum Schl√ºsselpaar an: <br><br><img src="https://habrastorage.org/webt/hn/xq/o7/hnxqo7b6iqsoa0mcqwxwtjfg5da.png"><br><br>  Nachdem Sie sichergestellt haben, dass die Anfrage erfolgreich erstellt wurde, verstecken Sie das Token sicher mit dem privaten Schl√ºssel oder legen Sie es n√§her an das Herz (Menschen der √§lteren Generation wissen, wie man Party- oder Komsomol-Tickets speichert), kopieren Sie die Anfrage auf das Flash-Laufwerk, nehmen Sie die erforderlichen Dokumente (Reisepass usw.). und gehen Sie zur Zertifizierungsstelle, um ein Zertifikat zu erhalten.  Ja, wenn dies keine Abteilungs-Zertifizierungsstelle ist, m√ºssen Sie trotzdem Geld bezahlen.  Alles ist wie mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Reisepass</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Wir streben ein Zertifikat in CA an</b> <div class="spoiler_text">  In diesem Fall verwenden wir f√ºr die Ausstellung eines Zertifikats an den ehrw√ºrdigen Habr auch die Zertifizierungsstelle von den Seiten aller Habr.  CA beginnt mit der Pr√ºfung unserer Anwendung: <br><br><img src="https://habrastorage.org/webt/nj/za/wt/njzawtbm3ze91qnj2widi-if4wg.png"><br><br>  Nachdem die Anwendung in die CA-Datenbank eingegeben wurde, ber√ºcksichtigt der autorisierte Administrator sie und lehnt Folgendes ab oder genehmigt sie: <br><br><img src="https://habrastorage.org/webt/so/pr/zq/soprzqefs9b5w0_5phvien6amog.png"><br><br>  Nachdem der Antrag genehmigt wurde, bestimmt der Antragsteller zusammen mit der autorisierten Person der Zertifizierungsstelle die Zwecke der Verwendung des Zertifikats: <br><br><img src="https://habrastorage.org/webt/tw/kx/ex/twkxex2i3htjet9bkxm1kdoiuya.png"><br><br>  Und danach hindert nichts die Ausstellung des Zertifikats: <br><br><img src="https://habrastorage.org/webt/hb/ox/1c/hbox1clfovnx8ghzsvne5fvsmys.png"><br></div></div><br>  Nach Ausstellung des Zertifikats exportiert der CA-Mitarbeiter das ausgestellte Zertifikat auf das Flash-Laufwerk von Hon. Habr: <br><br><img src="https://habrastorage.org/webt/71/3r/zi/713rzi-nn3sd1v0ockcyfpwphie.png"><br><br><h3>  <font color="1368c2">Wir legen das Token-Zertifikat</font> </h3><br>  Und so kehrt der gl√ºckliche Inhaber des Zertifikats in seine Heimat zur√ºck und beschlie√üt zun√§chst, das Zertifikat f√ºr den Token neben das Schl√ºsselpaar zu stellen.  Klicken Sie dazu im Hauptfenster des Dienstprogramms auf die Schaltfl√§che "4. Anforderung / Zertifikat anzeigen", w√§hlen Sie die Datei mit dem Zertifikat und die Operation "Zertifikat anzeigen" aus und klicken Sie auf die Schaltfl√§che, um die Operation auszuf√ºhren ": <br><br><img src="https://habrastorage.org/webt/vp/uh/1n/vpuh1n5xtmcgzri4vf1im1wfq64.png"><br><br>  Wir k√∂nnen auch die G√ºltigkeit des Zertifikats (aber wir hatten noch keine Zeit, es zu widerrufen) oder die Richtigkeit seiner Signatur √ºberpr√ºfen, indem wir den entsprechenden Vorgang ausw√§hlen: <br><br><img src="https://habrastorage.org/webt/4x/en/yf/4xenyfg6oq0uem5e24pskrf8qgk.png"><br><br><div class="spoiler">  <b class="spoiler_title">Dienstprogrammcode zur √úberpr√ºfung der Zertifikatsignatur</b> <div class="spoiler_text"><pre><code class="plaintext hljs">#!/usr/bin/env tclsh package require pki load ./tclpkcs11.so Tclpkcs11 #     PKCS#11 #set pkcs11_module "/usr/local/lib64/librtpkcs11ecp_2.0.so" set pkcs11_module "/usr/local/lib64/libls11sw2016.so" puts "Connect the Token and press Enter" gets stdin yes set handle [pki::pkcs11::loadmodule $pkcs11_module] set slots [pki::pkcs11::listslots $handle] set i 0 foreach slotinfo $slots { set slotid [lindex $slotinfo 0] set slotlabel [lindex $slotinfo 1] set slotflags [lindex $slotinfo 2] if {[lsearch -exact $slotflags TOKEN_PRESENT] != -1} { set token_slotlabel $slotlabel set token_slotid $slotid #    incr i break } } if {$i == 0} { puts "   . ." exit } # PEM  DER proc ::cert_to_der {data} { if {[string first "-----BEGIN CERTIFICATE-----" $data] != -1} { set data [string map {"\r\n" "\n"} $data] } array set parsed_cert [::pki::_parse_pem $data "-----BEGIN CERTIFICATE-----" "-----END CERTIFICATE-----"] if {[string range $parsed_cert(data) 0 0 ] == "0" } { #   DER- "0" == 0x30 set asnblock $parsed_cert(data) } else { set asnblock "" } return $asnblock } proc usage {use error} { puts "Copyright(C) Orlov Vladimir (http://museum.lissi-crypto.ru/) 2019" if {$use == 1} { puts $error puts "Usage:\nverify_cert_with_pkcs11 &lt;file with certificate&gt; \[&lt;file with CA certificate&gt;\]\n" } } set countcert [llength $argv] if { $countcert &lt; 1 || $countcert &gt; 2 } { usage 1 "Bad usage!" exit } set file [lindex $argv 0] if {![file exists $file]} { usage 1 "File $file not exist" exit } #  cert_user puts "Loading user certificate: $file" set fd [open $file] chan configure $fd -translation binary set cert_user [read $fd] close $fd if {$cert_user == "" } { usage 1 "Bad file with certificate user: $file" exit } set cert_user [cert_to_der $cert_user] if {$cert_user == ""} { puts "User certificate bad" exit } catch {array set cert_parse [::pki::x509::parse_cert $cert_user]} if {![info exists cert_parse]} { puts "User certificate bad" exit } #parray cert_parse if {$countcert == 1} { if {$cert_parse(issuer) != $cert_parse(subject)} { puts "Bad usage: not self signed certificate" } else { set cert_CA $cert_user } } else { set fileca [lindex $argv 1] if {![file exists $fileca]} { usage 1 "File $fileca not exist" exit } #  cert_CA puts "Loading CA certificate: $fileca" set fd [open $fileca] chan configure $fd -translation binary set cert_CA [read $fd] close $fd if {$cert_CA == "" } { usage 1 "Bad file with certificate CA=$fileca" exit } set cert_CA [cert_to_der $cert_CA] if {$cert_CA == ""} { puts "CA certificate bad" exit } } foreach slotinfo $slots { set slotid [lindex $slotinfo 0] set slotlabel [lindex $slotinfo 1] set slotflags [lindex $slotinfo 2] if {[lsearch -exact $slotflags TOKEN_PRESENT] != -1} { set token_slotlabel $slotlabel set token_slotid $slotid } } #    catch {array set cert_parse_CA [::pki::x509::parse_cert $cert_CA]} if {![info exists cert_parse_CA]} { puts "CA certificate bad" exit } #  if {$cert_parse(issuer) != $cert_parse_CA(subject)} { puts "Bad issuer" exit } set aa [dict create pkcs11_handle $handle pkcs11_slotid $token_slotid] set tbs_cert [binary format H* $cert_parse(cert)] catch {set signature_algo_number [::pki::_oid_name_to_number $cert_parse(signature_algo)]} if {![info exists signature_algo_number]} { set signature_algo_number $cert_parse(signature_algo) } switch -- $signature_algo_number { "1.2.643.2.2.3" - "1 2 643 2 2 3" { # "GOST R 34.10-2001 with GOST R 34.11-94" set digest_algo "gostr3411" } "1.2.643.7.1.1.3.2" - "1 2 643 7 1 1 3 2" { # "GOST R 34.10-2012-256 with GOSTR 34.11-2012-256" set digest_algo "stribog256" } "1.2.643.7.1.1.3.3" - "1 2 643 7 1 1 3 3" { # "GOST R 34.10-2012-512 with GOSTR 34.11-2012-512" set digest_algo "stribog512" } default { puts "  :$signature_algo_number" exit } } #   tbs-!!!! set digest_hex [pki::pkcs11::digest $digest_algo $tbs_cert $aa] # asn-   #    binary scan $cert_CA H* cert_CA_hex array set infopk [pki::pkcs11::pubkeyinfo $cert_CA_hex [list pkcs11_handle $handle pkcs11_slotid $token_slotid]] set lpk [dict create pkcs11_handle $handle pkcs11_slotid $token_slotid] # pybkeyinfo     lappend lpk "pubkeyinfo" lappend lpk $infopk(pubkeyinfo) array set lpkar $lpk puts "Enter PIN user for you token \"$token_slotlabel\":" gets stdin password if { [pki::pkcs11::login $handle $token_slotid $password] == 0 } { puts "Bad PIN" exit } if {[catch {set verify [pki::pkcs11::verify $digest_hex $cert_parse(signature) $lpk]} res] } { puts "  =$res" exit } if {$verify != 1} { puts "BAD SIGNATURE=$verify" } else { puts "SIGNATURE OK=$verify" }</code> </pre> <br></div></div><br>  Wir sind jetzt jedoch daran interessiert, das empfangene Zertifikat in unser Token zu importieren.  W√§hlen Sie den Vorgang "Zertifikat f√ºr Token importieren" und klicken Sie auf die Schaltfl√§che "Vorgang ausf√ºhren".  Das Dienstprogramm √ºberpr√ºft die elektronische Signatur des Zertifikats.  Dazu m√ºssen Sie den PIN-Code f√ºr das Token eingeben.  Und wenn alles gut geht, wird das Zertifikat in das Token importiert: <br><br><img src="https://habrastorage.org/webt/vn/o5/q0/vno5q0k5jrvwic9p_4uzqfpjyte.png"><br><br>  Die Bezeichnung (Spitzname) des Zertifikats ist in der Liste der Zertifikate aufgef√ºhrt: <br><br><img src="https://habrastorage.org/webt/ov/ja/kk/ovjakktrr_aco5_y75htmflyp68.png"><br><br>  Dies ist unser pers√∂nliches Zertifikat, ein Zertifikat, f√ºr das es ein Schl√ºsselpaar gibt.  Wenn Sie sich die Liste der Objekte auf dem Token noch einmal ansehen, finden Sie drei Objekte mit der Bezeichnung "Allm√§chtiger Habr von UTs 12_512" und derselben CKA_ID.  Diese <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">drei Objekte</a> sind das Zertifikat selbst (CKO_CERTIFICATE), der √∂ffentliche (CKO_PUBLIC_KEY) und der private (CKO_PRIVATE_KEY) Schl√ºssel.  Die Bezeichnung f√ºr dieses Dreifach von Objekten lautet wie folgt: <br>  &lt;Inhaber eines CN-Zertifikats&gt; von &lt;Herausgeber eines CN-Zertifikats&gt;. <br><br>  Im Folgenden zeigen wir, wie Sie das Etikett √§ndern k√∂nnen. <br><br>  Wie kann ich darauf zugreifen, nachdem wir das Zertifikat auf das Token gelegt haben?  Um Zugriff auf die Funktionen zum Arbeiten mit Zertifikaten auf dem Token zu erhalten, bewegen Sie den Cursor einfach auf die Beschriftung ‚ÄûZertifikat‚Äú und dr√ºcken Sie die rechte Maustaste: <br><br><img src="https://habrastorage.org/webt/kd/he/cb/kdhecbhcpq7frlxxaa2lw77nhv4.png"><br><br><h3>  <font color="1368c2">Wir unterschreiben das erste Dokument mit elektronischer Signatur</font> </h3><br>  Warten wir auf den n√§chsten Artikel.  Du musst ein paar Tage warten.  Was dort noch ber√ºcksichtigt wird, geht aus dem Screenshot hervor: <br><br><img src="https://habrastorage.org/webt/q-/bq/sp/q-bqspoaaal056weiylzz4wchek.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fortsetzung hier</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453164/">https://habr.com/ru/post/de453164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453148/index.html">AirBnb vernachl√§ssigt seine Konten</a></li>
<li><a href="../de453154/index.html">Internet-Verlauf: Verbesserung der Interaktivit√§t</a></li>
<li><a href="../de453156/index.html">General Motors wird all seinen neuen Autos eine Seele geben (digitale H√ºlle)</a></li>
<li><a href="../de453158/index.html">Ich wusste nicht, wie Prozessoren funktionieren, also schrieb ich einen Software-Simulator</a></li>
<li><a href="../de453162/index.html">Antiquit√§ten: ThinkPad 380E, 90er Economy Class und Windows 95</a></li>
<li><a href="../de453168/index.html">Forschung: Erstellen eines blockierenden Proxy-Dienstes mithilfe der Spieltheorie</a></li>
<li><a href="../de453170/index.html">Brainstorming: Wie man Aufgaben aus einem anderen Blickwinkel betrachtet</a></li>
<li><a href="../de453174/index.html">Acht Gr√ºnde f√ºr den Wechsel zur neuen Yandex. Cashier API</a></li>
<li><a href="../de453178/index.html">Die Hauptkompetenz des Entwicklers, der Ihren Code verbessern wird</a></li>
<li><a href="../de453180/index.html">Wie kann man eine verteilte papierlose viertelj√§hrliche Planung durchf√ºhren und nicht vermasseln?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>