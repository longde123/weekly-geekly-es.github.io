<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîó üë≥ üçç H√§ufige Fehler beim Schreiben von Komponententests. Yandex Vortrag üßíüèΩ üñ§ üí§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn Sie eine kleine Liste typischer Fehler beherrschen, die beim Schreiben von Komponententests auftreten, k√∂nnen Sie sie sogar gerne schreiben. Heut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>H√§ufige Fehler beim Schreiben von Komponententests. Yandex Vortrag</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/436850/">  Wenn Sie eine kleine Liste typischer Fehler beherrschen, die beim Schreiben von Komponententests auftreten, k√∂nnen Sie sie sogar gerne schreiben.  Heute wird der Leiter der Yandex.Browser-Entwicklungsgruppe f√ºr Android Konstantin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">kzaikin</a> Zaikin seine Erfahrungen mit Habr-Lesern teilen. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ZyGZjpxF9Fo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Ich habe einen praktischen Bericht.  Ich hoffe, dass es Ihnen allen zugute kommt - denen, die bereits Unit-Tests schreiben, und denen, die nur an das Schreiben denken, und denen, die es versuchen und denen es nicht gelungen ist. <a name="habracut"></a><br><br>  Wir haben ein ziemlich gro√ües Projekt.  Eines der gr√∂√üten mobilen Projekte in Russland.  Wir haben viel Code, viele Tests.  Tests werden bei jeder Poolanforderung verfolgt, sie fallen nicht gleichzeitig ab. <br><br>  Wer wei√ü, welche Testabdeckung er im Projekt hat?  Null, okay.  Wer hat Unit-Tests im Projekt?  Und wer glaubt, dass Unit-Tests nicht ben√∂tigt werden?  Daran sehe ich nichts auszusetzen, es gibt Menschen, die aufrichtig davon √ºberzeugt sind, und meine Geschichte sollte ihnen helfen, davon √ºberzeugt zu sein. <br><br>  Gl√ºcklicherweise Tausende von gr√ºnen Tests - wir kamen nicht sofort.  Es gibt keine Silberkugel und die Hauptidee meines Berichts auf dem Bildschirm: <br><br><img src="https://habrastorage.org/webt/w1/0y/wm/w10ywme1xumvi5asap7gp0a5iee.jpeg"><br><br>  Das chinesische Sprichwort steht in Hieroglyphen, dass eine Reise von ungef√§hr tausend mit einem Schritt beginnt.  Es scheint, dass es ein solches Analogon zu diesem Sprichwort gibt. <br><br>  Wir haben vor langer Zeit entschieden, dass wir unser Produkt und unseren Code verbessern m√ºssen, und wir gehen gezielt darauf zu.  Auf diesem Weg trafen wir viele Unebenheiten, einen Unterwasserschwader, und sammelten zusammen mit diesen einige √úberzeugungen. <br><br><img src="https://habrastorage.org/webt/ks/9z/5w/ks9z5wmzmkghfc-vireaf5rdvvg.jpeg"><br><br>  Warum brauchen wir Tests? <br><br>  Damit alte Funktionen nicht fallen, wenn wir neue einf√ºhren.  Ein Abzeichen auf GitHub haben.  Um vorhandene Funktionen umzugestalten - ein tiefer Gedanke, muss er denjenigen offenbart werden, die keine Tests schreiben.  Damit vorhandene Funktionen beim Refactoring nicht ausfallen, sch√ºtzen wir uns mit Tests.  Damit der Chef eine Poolanfrage sendet, ja. <br><br>  Meine Meinung - bitte verbinden Sie sie nicht mit der Meinung meines Teams - dass die Tests uns helfen.  Mit ihnen k√∂nnen Sie Ihren Code ausf√ºhren, ohne ihn in Produktion zu bringen, ohne ihn auf Ger√§ten zu installieren. Sie starten ihn und f√ºhren ihn sehr schnell aus.  Sie k√∂nnen alle Eckf√§lle weglaufen lassen, die Sie im Leben auf dem Ger√§t und in der Produktion nicht bekommen, und Ihr Tester wird sie nicht finden.  Aber Sie als Entwickler werden sie erfinden, √ºberpr√ºfen und Fehler fr√ºhzeitig beheben. <br><br>  Sehr wichtig: Tests zeigen, wie der Code laut Entwickler funktionieren sollte und was Ihre Methoden laut Entwickler tun sollten.  Dies sind keine Kommentare, die wegfahren und nach einer Weile von n√ºtzlichen sch√§dlich werden.  Es kommt vor, dass in den Kommentaren eine Sache geschrieben ist und im Code v√∂llig anders.  Unit Tests in diesem Sinne k√∂nnen nicht l√ºgen.  Wenn der Test gr√ºn ist, dokumentiert er, was dort passiert.  Der Test ist fehlgeschlagen - Sie haben die prim√§re Absicht des Entwicklers verletzt. <br><br>  Vertr√§ge festlegen.  Hierbei handelt es sich nicht um unterzeichnete und abgestempelte Vertr√§ge, sondern um Softwarevertr√§ge f√ºr das Klassenverhalten.  Wenn Sie umgestalten, werden in diesem Fall die Vertr√§ge verletzt und die Tests fallen, wenn Sie sie brechen.  Wenn die Vertr√§ge gespeichert werden, bleiben die Tests gr√ºn, und Sie haben mehr Vertrauen, dass Ihr Refactoring korrekt ist. <br><br><img src="https://habrastorage.org/webt/pr/z0/fc/prz0fclospeod5fnxeum2bi19gw.jpeg"><br><br>  Dies ist die allgemeine Idee meines gesamten Berichts.  Sie k√∂nnen die erste Zeile anzeigen und verlassen. <br><br>  Viele Leute denken, dass der Testcode so lala Code ist, er ist nicht f√ºr die Produktion, also k√∂nnen Sie ihn so lala schreiben.  Ich bin damit nicht einverstanden und denke, dass die Tests zun√§chst verantwortungsbewusst angegangen werden sollten, ebenso wie der Produktionscode.  Wenn Sie sich ihnen auf die gleiche Weise n√§hern, profitieren Sie von den Tests.  Andernfalls wird es ein Schmutz sein. <br><br>  Insbesondere beziehen sich die beiden folgenden Zeilen anscheinend auf jeden Code. <br><br>  KISS - halte es einfach, dumm.  Keine Notwendigkeit zu komplizieren.  Tests sollten einfach sein.  Und der Produktionscode sollte einfach sein, aber die Tests sind besonders.  Wenn Sie Tests haben, die leicht zu lesen sind, dann sind dies Tests, die h√∂chstwahrscheinlich gut geschrieben sind, gut ausgedr√ºckt sind und leicht zu testen sind.  Selbst w√§hrend der Poolanfrage wird eine Person, die sich Ihre brandneuen Tests ansieht, verstehen, was Sie sagen wollten.  Und wenn etwas kaputt geht, k√∂nnen Sie leicht verstehen, was passiert ist. <br><br>  DRY - wiederhole dich nicht.  In Tests neigt der Entwickler h√§ufig dazu, die verbotene Technik zu verwenden, die niemand in der Produktion zu verwenden scheint - Kopieren und Einf√ºgen.  Bei der Produktion eines Entwicklers, der aktiv kopiert und einf√ºgt, werden sie es einfach nicht verstehen.  In Tests ist dies leider √ºblich.  Keine Notwendigkeit, dies zu tun, weil - die erste Zeile.  Wenn Sie die Tests ehrlich schreiben, wie wirklich guten Code, sind die Tests f√ºr Sie n√ºtzlich. <br><br>  W√§hrend wir Hunderttausende von Codezeilen entwickelten, Tausende von Tests schrieben und Rechen sammelten, hatte ich typische Kommentare zu den Tests gesammelt.  Ich bin ziemlich faul und als ich zu den Pool-Anfragen ging und die gleichen Fehler beobachtete, basierend auf dem DRY-Prinzip, habe ich beschlossen, diese typischen Probleme aufzuschreiben. Ich habe es zuerst im internen Wiki gemacht und dann praktische Testger√ºche auf GitHub gepostet, denen Sie folgen k√∂nnen wenn Sie Tests schreiben. <br><br><img src="https://habrastorage.org/webt/oj/k1/u2/ojk1u2fjmy269sioq4vin6yylua.jpeg"><br><br>  Ich werde nach Punkten auflisten.  Erh√∂hen Sie einen Z√§hler in Ihrem Kopf, wenn Sie sich an einen solchen Testgeruch erinnern.  Wenn Sie bis f√ºnf z√§hlen, k√∂nnen Sie Ihre Hand heben und "Bingo!" Schreien.  Und am Ende frage ich mich, wer wie viel gez√§hlt hat.  Mein Z√§hler entspricht der Anzahl der Punkte, ich habe sie alle selbst gesammelt. <br><br><img src="https://habrastorage.org/webt/nm/pw/8n/nmpw8nk89hl6gmggyims0llmn28.jpeg"><br><h5>  <sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub Link</a></sub></sup> </h5><br>  Das Schwierigste an der Programmierung, das Sie kennen.  Und in Tests ist das wirklich wichtig.  Wenn Sie den Test nicht gut benennen, k√∂nnen Sie h√∂chstwahrscheinlich nicht formulieren, was der Test √ºberpr√ºft. <br><br>  Menschen sind ziemlich einfache Wesen, sie sind leicht in Namen gefangen.  Deshalb bitte ich Sie, Tests gut anzurufen.  Formulieren Sie einen Test, um einfache Regeln zu √ºberpr√ºfen und zu befolgen. <br><br><h4>  no_action_or_assertion </h4><br>  Wenn der Name des Tests keine Beschreibung dessen enth√§lt, was der Test √ºberpr√ºft, haben Sie beispielsweise die Controller-Klasse und schreiben den testController-Test. Was √ºberpr√ºfen Sie?  Was soll dieser Test tun?  H√∂chstwahrscheinlich entweder nichts oder zu viele Dinge, um sie zu √ºberpr√ºfen.  Weder der eine noch der andere passt zu uns.  Daher ist es notwendig, im Namen des Tests zu schreiben, was wir pr√ºfen. <br><br><h4>  langer_name </h4><br>  Sie k√∂nnen nicht zum anderen Extrem gehen.  Der Name des Tests sollte kurz genug sein, damit eine Person ihn leicht analysieren kann.  In diesem Sinne ist Kotlin gro√üartig, da Sie damit Testnamen in Anf√ºhrungszeichen mit Leerzeichen in normalem Englisch schreiben k√∂nnen.  Sie sind leichter zu lesen.  Trotzdem riechen lange Namen. <br><br>  Wenn Ihr Testname zu lang ist, haben Sie h√∂chstwahrscheinlich zu viele Testmethoden in eine Testklasse eingef√ºgt, und Sie m√ºssen klarstellen, was Sie √ºberpr√ºfen.  In diesem Fall m√ºssen Sie Ihre Testklasse in mehrere aufteilen.  Keine Angst davor.  Sie haben einen Testklassennamen, der den Namen Ihres Produktionscodes √ºberpr√ºft, und es gibt kurze Testnamen. <br><br><h4>  old_prefix </h4><br>  Das ist Atavismus.  Zuvor testeten alle in Java mit JUnit, wo bis zur vierten Version vereinbart wurde, dass Testmethoden mit dem Wort test beginnen sollten.  Es ist so passiert, jeder nennt es immer noch so.  Aber es gibt ein Problem, im Englischen ist das Wort test das Verb ‚Äûcheck‚Äú.  Menschen sind leicht in dieser Falle gefangen und schreiben keine anderen Verben mehr.  Schreiben Sie testController.  Es ist einfach, sich selbst zu √ºberpr√ºfen: Wenn Sie kein Verb geschrieben haben, was Ihre Testklasse tun sollte, haben Sie h√∂chstwahrscheinlich etwas nicht √ºberpr√ºft, Sie haben es nicht gut genug geschrieben.  Deshalb bitte ich Sie immer, das Wort test aus den Namen der Testmethoden zu entfernen. <br><br>  Ich erz√§hle sehr einfache Dinge, aber seltsamerweise helfen sie.  Wenn die Tests gut aufgerufen werden, sehen sie h√∂chstwahrscheinlich unter der Haube gut aus.  Es ist sehr einfach. <br><br><img src="https://habrastorage.org/webt/1e/_h/b3/1e_hb3te9onmzprsqcvilm2i_cc.jpeg"><br><br>  Ich habe tats√§chlich Testgeruchs-IDs wie auf GitHub gelesen.  Der Link ist unten, Sie k√∂nnen gehen und verwenden. <br><br><h4>  multiple_asserts </h4><br>  In der Testmethode gibt es viele Aussagen.  Also vielleicht oder nicht?  Kann sein.  Ist es gut oder schlecht?  Ich finde das sehr schlecht.  Wenn Sie mehrere Aussagen in eine Testmethode geschrieben haben, √ºberpr√ºfen Sie mehrere Aussagen.  Wenn Sie Ihren Test testen und die erste Behauptung f√§llt, erreicht der Test die zweite Behauptung?  Wird nicht erreichen.  Sie erhalten bereits nach dem Sturz Ihrer Baugruppe irgendwo auf dem CI, dass der Test gefallen ist, gehen Sie, reparieren Sie etwas, f√ºllen Sie es erneut, es wird bei der n√§chsten Behauptung fallen.  Es k√∂nnte sehr gut sein. <br><br>  In diesem Fall w√§re es viel cooler, wenn Sie diese Testmethode in mehrere zerlegen w√ºrden und alle Methoden mit mehreren Asserts gleichzeitig fallen w√ºrden, da sie unabh√§ngig voneinander gestartet w√ºrden. <br><br>  Einige weitere Zusicherungen k√∂nnen die verschiedenen Aktionen maskieren, die mit der Testklasse ausgef√ºhrt werden.  Ich empfehle, einen Test zu schreiben - einen Assert.  Verm√∂genswerte k√∂nnen sehr kompliziert sein.  Mein Kollege hat im allerersten Bericht einen Code demonstriert, in dem er die hervorragende assertThat-Konstruktion und den Matcher verwendet hat.  Ich liebe Matchups bei JUnit sehr, also kannst du das auch nutzen.  F√ºr den Testleser ist dies nur eine kurze Aussage.  GitHub hat Beispiele f√ºr all diese Ger√ºche und wie man sie behebt.  Es gibt ein Beispiel f√ºr schlechten Code und guten Code.  Dies alles geschieht in Form eines Projekts, das Sie herunterladen, √∂ffnen, kompilieren und alle Tests ausf√ºhren k√∂nnen. <br><br><h4>  many_tests_in_one </h4><br>  Der n√§chste Geruch ist eng mit dem vorherigen verwandt.  Sie machen etwas mit dem System - Sie machen eine Behauptung.  Etwas anderes mit dem System machen, einige lange Operationen - eine Behauptung machen - etwas anderes machen.  Tats√§chlich haben Sie einfach mehrere Methoden untersucht und erhalten solide, gute Testmethoden. <br><br><h4>  repeating_setup </h4><br>  Dies bezieht sich auf Ausf√ºhrlichkeit.  Wenn Sie eine Testklasse haben und jede Testmethode zu Beginn dieselben Methoden ausf√ºhrt. <br><br>  Eine Testklasse, in der zu Beginn dieselben Methoden ausgef√ºhrt werden.  Dies scheint ein bisschen, aber in jeder Testmethode ist dieser M√ºll vorhanden.  Und wenn es allen Testmethoden gemeinsam ist, ziehen Sie es in JUnit 5 in den Konstruktor oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Before-</a> Block oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Before</a> Each-Block. Wenn Sie dies tun, verbessert sich die Lesbarkeit jeder Methode und Sie werden DRY sin los.  Solche Tests sind leichter zu warten und leichter zu lesen. <br><br><img src="https://habrastorage.org/webt/jz/e6/pt/jze6ptgcma9s-f62hobgcoj5jbu.jpeg"><br><br>  Die Zuverl√§ssigkeit der Tests ist sehr wichtig.  Es gibt Anzeichen, anhand derer festgestellt werden kann, dass der Test weint, gr√ºn oder rot ist.  Wenn der Entwickler es schreibt, ist er sicher, dass es gr√ºn ist, und dann werden die Tests aus irgendeinem Grund gr√ºn oder rot, was uns im Allgemeinen Schmerzen und Unsicherheit dar√ºber gibt, dass die Tests n√ºtzlich sind.  Wir sind uns bei den Tests nicht sicher, was bedeutet, dass wir nicht sicher sind, ob sie n√ºtzlich sind. <br><br><h4>  zuf√§llig </h4><br>  Ich selbst habe einmal Tests geschrieben, in denen Math.random () enthalten war, Zufallszahlen gemacht und etwas damit gemacht.  Keine Notwendigkeit, dies zu tun.  Wir erwarten, dass das Testsystem in derselben Konfiguration in das Testsystem eintritt und dass die Ausgabe von diesem auch dieselbe sein muss.  Daher m√ºssen Sie beispielsweise bei Komponententests niemals Vorg√§nge mit dem Netzwerk ausf√ºhren.  Da der Server m√∂glicherweise nicht antwortet, kann es zu unterschiedlichen Zeiten kommen, etwas anderes. <br><br>  Wenn Sie einen Test ben√∂tigen, der mit dem Netzwerk funktioniert, f√ºhren Sie einen lokalen Proxy durch, aber gehen Sie auf keinen Fall zu einem echten Netzwerk.  Dies ist der gleiche Zufall.  Und nat√ºrlich k√∂nnen Sie keine zuf√§lligen Daten verwenden.  Wenn Sie etwas tun m√ºssen, machen Sie einige Beispiele mit Randbedingungen, mit schlechten Bedingungen, aber sie sollten fest codiert sein. <br><br><h4>  tread_sleep </h4><br>  Ein klassisches Problem, mit dem Entwickler konfrontiert sind, wenn sie versuchen, asynchronen Code zu testen.  Es ist so, dass ich im Test etwas gemacht habe und dann warten muss, bis es abgeschlossen ist.  Wie macht man?  Thread.sleep () nat√ºrlich. <br><br>  Es gibt ein Problem.  Wenn Sie Ihren Test entwickelt haben, haben Sie ihn beispielsweise auf einer Ihrer Schreibmaschinen durchgef√ºhrt. Er funktioniert mit einer gewissen Geschwindigkeit.  Sie f√ºhren die Tests auf einem anderen Computer aus.  Und was passiert, wenn Ihr System w√§hrend der Thread.sleep () -Zeit nicht funktioniert?  Der Test wird rot.  Das ist unerwartet.  Daher wird hier empfohlen, wenn Sie asynchrone Vorg√§nge ausf√ºhren, diese √ºberhaupt nicht zu testen.  Fast jede asynchrone Operation kann bereitgestellt werden, sodass Sie √ºber einen bedingten Mechanismus verf√ºgen, der eine asynchrone Operation und einen synchron ausgef√ºhrten Codeblock bereitstellt.  Beispielsweise verf√ºgt AsyncTask im Inneren √ºber einen synchron ausgef√ºhrten Codeblock.  Sie k√∂nnen es problemlos synchron und ohne Asynchronit√§t testen.  Es ist nicht erforderlich, AsyncTask selbst zu testen. Es handelt sich um eine Framework-Klasse. Warum sollten Sie es testen?  Halte es fest und dein Leben wird einfacher. <br><br>  Thread.sleep () ist sehr schmerzhaft.  Zus√§tzlich zu der Tatsache, dass es die Zuverl√§ssigkeit von Tests verschlechtert, da es ihnen erm√∂glicht, aufgrund unterschiedlicher Timings auf Ger√§ten zu weinen, verlangsamt es auch die Ausf√ºhrung Ihrer Tests.  Wer m√∂chte, dass seine Unit-Tests, die in Millisekunden ausgef√ºhrt werden sollen, f√ºnf Sekunden lang ausgef√ºhrt werden, weil ich den Profilschlaf eingestellt habe? <br><br><h4>  modify_global </h4><br>  Es ist typisch, dass wir zu Beginn des Tests eine globale statische Variable ge√§ndert haben, um zu √ºberpr√ºfen, ob unser System ordnungsgem√§√ü funktioniert, aber am Ende nicht zur√ºckgekehrt sind.  Dann kommt eine coole Situation: Auf dem Computer f√ºhrte der Entwickler die Tests in einer Sequenz aus, √ºberpr√ºfte zuerst die globale Variable mit dem Standardwert, dann √§nderte er sie im Test und tat dann etwas anderes.  Beide Tests sind gr√ºn.  Und auf CI begannen die Tests in umgekehrter Reihenfolge.  Und einer oder beide Tests sind rot, obwohl sie alle gr√ºn waren. <br><br>  Sie m√ºssen nach sich selbst aufr√§umen.  Scout-Regeln in diesem Sinne: Die globale Variable wurde ge√§ndert - in den urspr√ºnglichen Zustand zur√ºckkehren.  Besser noch, stellen Sie sicher, dass globale Staaten nicht verwendet werden.  Aber das ist ein tieferer Gedanke.  Es geht um die Tatsache, dass Tests manchmal Fehler in der Architektur aufzeigen.  Wenn wir globale Zust√§nde √§ndern und sie in ihren urspr√ºnglichen Zustand zur√ºckversetzen m√ºssen, um Tests zu schreiben, sind wir alle in unserer Architektur gut?  Brauchen wir zum Beispiel wirklich globale Variablen?  In der Regel k√∂nnen Sie auf sie verzichten, indem Sie einige Kontextklassen oder √§hnliches einf√ºgen, sodass Sie sie jedes Mal im Test neu initialisieren, einf√ºgen und neu initialisieren k√∂nnen. <br><br><h4>  @VisibleForTesting </h4><br>  Testgeruch f√ºr Fortgeschrittene.  Die Notwendigkeit, so etwas zu benutzen, entsteht in der Regel nicht am ersten Tag.  Sie haben bereits etwas getestet und mussten dann die Klasse in einen bestimmten Zustand √ºbersetzen.  Und du machst dir eine Hintert√ºr.  Sie haben eine Produktionsklasse und erstellen eine bestimmte Methode, die in der Produktion niemals aufgerufen wird. Dadurch injizieren Sie etwas in die Klasse oder √§ndern ihren Status.  Somit wird die Kapselung b√∂swillig unterbrochen.  In der Produktion funktioniert Ihre Klasse irgendwie, aber in Tests ist es tats√§chlich eine andere Klasse, Sie kommunizieren mit ihr √ºber andere Ein- und Ausg√§nge.  Und hier k√∂nnen Sie eine Situation bekommen, in der Sie die Produktion √§ndern, aber die Tests bemerken es nicht.  Tests gehen weiterhin durch die Hintert√ºr und haben nicht bemerkt, dass beispielsweise Ausnahmen im Konstruktor ausgel√∂st wurden, da sie einen anderen Konstruktor durchlaufen. <br><br>  Im Allgemeinen sollten Sie Ihre Klassen mit denselben Ein- und Ausg√§ngen wie in der Produktion testen.  Es sollte keinen Zugriff auf Methoden nur f√ºr Tests geben. <br><br><img src="https://habrastorage.org/webt/dy/sf/s0/dysfs0rl9n6ftff4nt3ftwpy988.jpeg"><br><br>  Wie viele unserer 15.000 Tests werden durchgef√ºhrt?  Bei jeder Poolanforderung in Team City m√ºssen Entwickler etwa 20 Minuten warten.  Nur weil 15 Tausend viele Tests sind.  Und in diesem Abschnitt habe ich Ger√ºche zusammengestellt, die Tests verlangsamen.  Obwohl thread_sleep schon da war. <br><br><h4>  unn√∂tiger_android_test </h4><br>  Android hat Instrumentierungstests, sie sind wundersch√∂n, sie laufen auf einem Ger√§t oder Emulator.  Dies wird Ihr Projekt wirklich vollst√§ndig anheben, aber sie sind sehr langsam.  Und f√ºr sie m√ºssen Sie sogar einen ganzen Emulator erh√∂hen.  Selbst wenn Sie sich vorstellen, dass Sie einen erh√∂hten Emulator auf CI haben - es stimmt nur so √ºberein, dass Sie einen haben -, dauert das Ausf√ºhren des Tests auf dem Emulator viel l√§nger als auf dem Host-Computer, beispielsweise mit Robolectric.  Obwohl es andere Methoden gibt.  Dies ist ein solches Framework, mit dem Sie mit Klassen aus dem Android-Framework auf dem Host-Computer in reinem Java arbeiten k√∂nnen.  Wir nutzen es ziemlich aktiv.  Fr√ºher war Google etwas cool, aber jetzt sprechen Googler selbst in verschiedenen Berichten dar√ºber. Es wird f√ºr die Verwendung empfohlen. <br><br><h4>  unn√∂tig_robolektrisch </h4><br>  Das Android-Framework von Robolectric wird emuliert.  Es ist dort nicht vollst√§ndig, obwohl die Implementierung umso weiter, je vollst√§ndiger sie ist.  Es ist fast echtes Android und l√§uft nur auf Ihrem Desktop, Laptop oder CI.  Es muss aber auch nicht √ºberall eingesetzt werden.  Robolectric ist nicht kostenlos.  Wenn Sie einen Test haben, den Sie heldenhaft von der Android-Instrumentierung auf Robolectric √ºbertragen haben, sollten Sie sich √ºberlegen: Gehen Sie vielleicht noch weiter, entfernen Sie Robolectric und machen Sie ihn zum einfachsten JUnit-Test.  Robolektrische Tests ben√∂tigen Zeit zum Initialisieren, zum Laden von Ressourcen, zum Initialisieren Ihrer Aktivit√§t, Anwendung und alles andere.  Es dauert einige Zeit.  Dies ist keine Sekunde, es sind Millisekunden, manchmal Zehn und Hunderte.  Aber wenn es viele Tests gibt, ist auch das wichtig. <br><br>  Es gibt Techniken, die Robolectric loswerden.  Sie k√∂nnen Ihren Code √ºber Schnittstellen isolieren, indem Sie den gesamten Plattformteil mit Schnittstellen umschlie√üen.  Dann gibt es nur noch einen JUnit-Host-Test.  JUnit auf dem Host-Computer ist sehr schnell, es gibt einen minimalen Overhead, solche Tests k√∂nnen zu Tausenden und Zehntausenden ausgef√ºhrt werden, sie werden eine Minute, einige Minuten ausgef√ºhrt.  ,  ,  ,      Android instrumentation-,                   .   . <br><br>     .    smells?   .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> ,  . <br><br><img src="https://habrastorage.org/webt/ph/cs/52/phcs52po2jsf1lbjumu1um2e3ha.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436850/">https://habr.com/ru/post/de436850/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436838/index.html">Faltungsneurale Netze durch Visualisierungen in PyTorch verstehen</a></li>
<li><a href="../de436840/index.html">Der Weg vom Glanz zur Neurowissenschaft: Ein thematischer Podcast √ºber Karrieren im Medien- und Content-Marketing</a></li>
<li><a href="../de436842/index.html">Veeam-L√∂sung zur Sicherung und Wiederherstellung virtueller Maschinen auf der Nutanix AHV-Plattform. Teil 2</a></li>
<li><a href="../de436846/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 348 (14. - 20. Januar 2019)</a></li>
<li><a href="../de436848/index.html">Die NSA k√ºndigt die Ver√∂ffentlichung eines internen Tools f√ºr das Reverse Engineering an</a></li>
<li><a href="../de436852/index.html">Verlangsamung, um die Entwicklung voranzutreiben</a></li>
<li><a href="../de436854/index.html">Rust 1.32 Release</a></li>
<li><a href="../de436856/index.html">IT-Entwicklungsplan nach Angaben des Kommunikationsministeriums: digitale Souver√§nit√§t, Blockchain im Wohnungsbau und kommunale Dienstleistungen, Software f√ºr ‚Äûver√§nderte Realit√§t‚Äú</a></li>
<li><a href="../de436858/index.html">Esperanto, Elven und Klingon</a></li>
<li><a href="../de436860/index.html">Dell und Alienware auf der CES 2019: Ein Leitfaden f√ºr alle wichtigen Innovationen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>