<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüöí üë©üèΩ‚Äçüåæ üßëüèæ‚Äçü§ù‚Äçüßëüèæ IBM System i (tambi√©n conocido como AS / 400): c√≥mo realizamos las pruebas autom√°ticas de aplicaciones de pantalla verde üöÜ üîù üíà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Mi nombre es Anton Vorobyov, soy responsable en Alfa Bank del desarrollo de aplicaciones para un sistema bancario centralizado. 

 En esta public...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IBM System i (tambi√©n conocido como AS / 400): c√≥mo realizamos las pruebas autom√°ticas de aplicaciones de pantalla verde</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/446332/"> Hola  Mi nombre es Anton Vorobyov, soy responsable en Alfa Bank del desarrollo de aplicaciones para un sistema bancario centralizado. <br><br>  En esta publicaci√≥n, le contar√© sobre qu√© son las aplicaciones de pantalla verde, por qu√© son necesarias y c√≥mo hicimos las pruebas autom√°ticas para ellas escribiendo nuestra propia soluci√≥n para esto, lo que nos permiti√≥ acelerar las pruebas autom√°ticas 11 veces. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/ui/j8/z2/uij8z2alj0kcdqv2wtd_uo4yghq.jpeg"></a> <br><br>  La plataforma AS / 400 (Application System / 400) naci√≥ en 1988.  El primer sistema operativo para esta plataforma es OS / 400, luego renombrado a i5 / OS e incluso m√°s tarde a IBM i.  No hace mucho tiempo, celebr√≥ su trig√©simo cumplea√±os. <br><br>  Al sumergirse en el mundo del desarrollo bajo el sistema operativo IBM i, comprende que esto en realidad no es "legado" en el sentido cl√°sico de la palabra.  Este es un entorno diferente, completamente diferente, que es poco similar a los sistemas habituales de Windows o Unix.  La tarea principal de este sistema operativo es ser lo m√°s productivo posible en el equipo con el que trabaja, y no ser conveniente para el usuario. <br><br>  En mi humilde opini√≥n, este sistema operativo puede volverte loco por lo ineficaces que son los m√©todos habituales para escribir c√≥digo C ++ (hasta decenas de veces la p√©rdida de CPU), que algunos antipatrones demostrados en los libros de texto son la mejor pr√°ctica de c√≥digo efectivo, y la fuente con la fecha de escritura ¬°para 1978 no solo se ensambla sin problemas, sino que tambi√©n funciona como est√° dise√±ado!  Todo esto nos hace echar un vistazo a los enfoques modernos para el desarrollo de software. <br><a name="habracut"></a><br><h2>  Introduccion </h2><br>  La cuesti√≥n de mejorar la calidad del software en desarrollo excita las mentes de cada equipo de desarrollo.  Uno de nuestros equipos de cr√©dito, cuya tarea es desarrollar y desarrollar la parte posterior del m√≥dulo para el sistema bancario automatizado Misys Equation, tampoco ha pasado por alto este momento.  La peculiaridad de este ABS es que: <br><br><ul><li>  las primeras versiones del ABS funcionaron bajo el predecesor AS / 400 - la plataforma IBM System / 38 (apareci√≥ en 1978) bajo el sistema operativo CPF - "Control Program Facility"; </li><li>  Se ha desarrollado desde los a√±os 70 del siglo XX, y es posible que encuentre un c√≥digo escrito antes de su nacimiento (muchos c√≥digos antiguos); </li><li>  Las caracter√≠sticas de trabajar con ABS se deben a la estrecha integraci√≥n con IBM i, y debido a la colosal compatibilidad hacia atr√°s de este √∫ltimo, parece que est√° trabajando como arque√≥logo en las excavaciones de la Gran Pir√°mide. </li></ul><br><br><img src="https://habrastorage.org/webt/wu/va/gc/wuvagcwh4kmqi-fgc1sz_faezp0.jpeg"><br>  <i>IBM i (logotipo)</i> <br><br>  El desarrollo de aplicaciones para este ABS (opciones de ABS) se lleva a cabo de acuerdo con el est√°ndar del paquete de desarrollador de Misys ITP, Paquete T√©cnico del Integrador, que estipula que la opci√≥n debe consistir en un programa interactivo para la interacci√≥n del terminal con el usuario final e implementar la API utilizando la interfaz instalada para la ejecuci√≥n en segundo plano. . <br><br>  Tales programas interactivos desarrollados bajo el sistema operativo IBM i se llaman hist√≥ricamente aplicaciones de pantalla verde y son la √∫nica interfaz de usuario con la que interact√∫a el usuario de este ABS. <br><br><h2>  ¬øQu√© es una aplicaci√≥n de pantalla verde? </h2><br>  La respuesta simple es una aplicaci√≥n que se ve as√≠: <br><br><img src="https://habrastorage.org/webt/6m/gq/gy/6mgqgy4eklp7fvboyyeunnnazgy.jpeg"><br><br>  M√°s o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">menos</a> : <br><br><img src="https://habrastorage.org/webt/cu/d2/km/cud2kmgmxlpe_9eqgxyymmqp9iy.png"><br><br><h2>  ¬øPor qu√© aplicaciones de pantalla verde? </h2><br>  Hist√≥ricamente, las √∫nicas aplicaciones interactivas que se ejecutan en los sistemas de rango bajo y medio de la familia AS / 400 y otros mainframes de IBM que le permitieron solicitar cualquier entrada del usuario son las aplicaciones de pantalla verde.  La instalaci√≥n, administraci√≥n, configuraci√≥n y desarrollo en el sistema operativo IBM i (y sus predecesores i5 / OS y AS400) se llevaron a cabo (y todav√≠a se llevan a cabo en alg√∫n lugar) utilizando exclusivamente aplicaciones de pantalla verde. <br><br>  La imagen de la aplicaci√≥n de pantalla verde tiene dos tama√±os: 24x80 y 27x132 caracteres y 16 colores posibles.  Dentro de esta escala, se realiza la mayor parte del trabajo de los desarrolladores y usuarios de este sistema operativo. <br><br>  Tales tama√±os de pantalla son el resultado de la evoluci√≥n de las "estaciones de trabajo" que se conectaron a los progenitores AS400 de los segmentos de gama baja y media de las computadoras comerciales IBM System / 32, System / 34, System / 36 y System / 38.  Estas estaciones de trabajo se llamaron terminales y consist√≠an en una pantalla en una caja de metal con un teclado y equipo adicional en forma de un bol√≠grafo ligero.  Inicialmente, solo se admit√≠an dos colores de la pantalla: verde y verde brillante, lo que condujo a la conocida frase "aplicaci√≥n de pantalla verde" (aplicaci√≥n de pantalla verde en la literatura inglesa).  En la d√©cada de 1970, el n√∫mero de colores admitidos aument√≥ a 16. <br><br><img src="https://habrastorage.org/webt/i-/is/u6/i-isu68vczilipq75gx8jnq8xzs.png"><br>  <i>5251 Display Station Modelo 11</i> <br><br>  Las opciones de terminal m√°s comunes fueron 5251 Display Station Modelo 1 (960 caracteres en la pantalla) y Modelo 11 (1920 caracteres en la pantalla) con dimensiones Ancho / Profundidad / Altura igual a 530/400/400 mm, respectivamente, y un peso de 34 kg.  La resoluci√≥n de pantalla del Modelo 1 era 12x80, Modelo 11 - 24x80.  El terminal estaba conectado directamente al sistema host. <br><br>  Los terminales 5251 Display Station Model 2 (960 caracteres en la pantalla) y Model 12 (1920 caracteres en la pantalla) con grandes dimensiones y un peso de 45 kg tambi√©n fueron bastante comunes.  Se distinguen del Modelo 1 y el Modelo 11 por la posibilidad de reenviar la conexi√≥n aguas arriba a la m√°quina host desde clientes m√°s baratos en forma de terminales Modelo 1 (u 11) con impresoras de escritorio o una impresora de piso separada.  Por lo tanto, los modelos 2 y 12 actuaron como un concentrador, representando la conexi√≥n al host desde dispositivos que requieren una conexi√≥n directa a la m√°quina host, y cuestan significativamente m√°s. <br><br>  Los terminales de la serie 5252 Dual Display Station tambi√©n le parecer√°n inusuales al lego moderno. <br><br><img src="https://habrastorage.org/webt/qq/nf/qx/qqnfqxfkc_sddfyxg1nq6i-v154.png"><br>  <i>Imagen promocional del folleto de IBM System / 38 Equipment and Programs (5252 Dual Display Station)</i> <br><br>  El precio de un kit de terminal con una impresora conectada podr√≠a alcanzar varios miles de d√≥lares estadounidenses. <br><br>  Los terminales se conectaron mediante un cable <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">twinaxial</a> a la m√°quina host con una topolog√≠a de bus en modo semid√∫plex con una velocidad de transmisi√≥n de hasta 1 Mbps.  El n√∫mero m√°ximo de terminales admitidos por twinaxial es de hasta 6 terminales, y el terminal m√°s alejado del host debe ubicarse a una distancia de no m√°s de 1500 metros. <br><br>  El n√∫mero de cada terminal se establece durante su instalaci√≥n mediante tres interruptores, por lo que se determina una direcci√≥n √∫nica dentro del bus.  En presencia de una red coaxial existente, es posible usar adaptadores de un cable twinaxial a un cable coaxial y un conjunto apropiado de terminaciones de cable para engarzar.  Con este esquema, era posible conectar solo dos dispositivos en el bus con una longitud m√°xima de segmento de hasta 30 metros.  El n√∫mero total de dispositivos conectados vari√≥ de una docena a varias docenas, seg√∫n el modelo. <br><br>  Con el desarrollo de los sistemas de escritorio y las redes de acceso, los terminales voluminosos fueron reemplazados por estaciones de trabajo, donde se utilizaron varias tarjetas de expansi√≥n de compa√±√≠as externas como medios de acceso a la m√°quina host, lo que permite la conexi√≥n directa a trav√©s de twinaxial.  Despu√©s de que IBM desarroll√≥ la tecnolog√≠a Token Ring en 1984, aparecieron soluciones de software para acceder a la m√°quina, incluso a trav√©s de esta interfaz. <br><br><img src="https://habrastorage.org/webt/5d/ek/m2/5dekm2mgcz43rgjiaxyjje3lyas.jpeg"><br>  <i>Adaptador 5250 al bus ISA (fabricante desconocido)</i> <br><br><img src="https://habrastorage.org/webt/mm/sr/0a/mmsr0av497ergmgdj4hjtd4a-84.png"><br>  <i>Tarjetas adaptadoras Blackbox 5250 (PC470C, PC471C, PC472C, PC473C, PC478C)</i> <br><br>  Los emuladores para MS-DOS y MS Windows aparecen tanto de IBM como de terceros, incluidas las implementaciones de OpenSource (por ejemplo, tn5250j.sourceforge.net). A mediados de los 90, la pila TCP / IP llega a la mitad del mundo -m√°quinas comerciales de gama baja y baja.  Para admitir el acceso de host a trav√©s del nuevo protocolo, IBM est√° desarrollando emuladores de terminal de la serie 5250. <br><br>  Para crear un protocolo de host, IBM est√° desarrollando <br>  Extensiones de protocolo Telnet (RFC 854, RFC 855, RFC 856, RFC 860, RFC 885, RFC 1091, RFC 1205, RFC 1572, RFC 2877), colectivamente denominado Telnet5250 (TN5250), que describe el proceso de recepci√≥n y transmisi√≥n de flujos Flujos de datos 5250 (flujos de datos 5250) a trav√©s del protocolo Telnet est√°ndar. <br><br><img src="https://habrastorage.org/webt/8w/gg/_i/8wgg_idu8zojbdf5_1u-gweewkm.gif"><br>  <i>IBM Client Access / 400 para el instalador de Windows 3.1</i> <br><br><h2>  ¬øQu√© tiene de especial el IBM 5250? </h2><br>  Una caracter√≠stica de los terminales IBM 5250 (y, en consecuencia, el protocolo TN5250) es su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">orientaci√≥n de bloque,</a> en contraste con los terminales habituales * nix, que est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">orientados a s√≠mbolos</a> .  Esto significa que los flujos de datos 5250 por los cuales el host se comunica con el terminal son transmitidos por bloques de datos, y un s√≠mbolo separado en √©l sin el contexto del bloque transmitido no tiene sentido. <br><br>  Por ejemplo, la m√°quina host transmite al terminal un bloque de datos que contiene la informaci√≥n est√°tica que se muestra en la pantalla junto con los atributos y coordenadas de los campos de entrada y una indicaci√≥n del desplazamiento en este bloque, donde escribir el resultado de la entrada del usuario en los campos.  Despu√©s de eso, la m√°quina host espera mensajes del terminal y no participa en el proceso de entrada del usuario. <br><br><img src="https://habrastorage.org/webt/kg/ld/ha/kgldha8aef46matytdr3ugjm7ce.png"><br>  <i>Pantalla de inicio de sesi√≥n para IBM i host RZKH.de (pub400.com)</i> <br><br>  Adem√°s, la tarea del emulador de terminal es interpretar el bloque de datos de la m√°quina y formar la pantalla de entrada para el usuario, donde se le da la oportunidad de ingresar cualquier informaci√≥n en los campos permitidos.  Adem√°s, las tareas del emulador de terminal incluyen una reacci√≥n a las acciones del usuario.  Las teclas F1-F24 (F13-F24 se simulan mediante SHIFT + Fx), Enter, Home, End, PageUp, PageDn y algunas otras teclas especiales que no est√°n disponibles en los teclados modernos se consideran teclas de host.  Esto significa que al presionar esta tecla, un b√∫fer de flujo con informaci√≥n de los campos de entrada y la posici√≥n del cursor en la pantalla, previamente llena con el emulador de terminal, se enviar√° al host para su procesamiento. <br><br><img src="https://habrastorage.org/webt/nf/oe/vx/nfoevxx5yvr-kbzcnejytv9hk4q.png"><br>  <i>WIreshark 5250 Data Stream intento de inicio de sesi√≥n volcado en pub400.com</i> <br><br>  El host recibe el b√∫fer, lo analiza y el resultado de entrada se pasa al programa que solicit√≥ la respuesta del usuario para una validaci√≥n de datos adicional y la aplicaci√≥n contin√∫a funcionando, mientras la aplicaci√≥n recibe el c√≥digo de la tecla de host presionada. <br><br><h2>  ¬øPor qu√© es autotesting aqu√≠? </h2><br>  Pensamos en automatizar las pruebas manuales de las aplicaciones de pantalla verde cuando nos enfrentamos a la necesidad de probar cientos de pantallas de un m√≥dulo desarrollado, donde podr√≠an ocurrir hasta ochenta comprobaciones comerciales diferentes (validaciones) en una pantalla. <br><br>  El dolor particular del equipo fue la ausencia casi completa en 2017 de herramientas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prueba autom√°tica de</a> pantalla verde, a excepci√≥n de la soluci√≥n patentada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UIPath</a> .  Incluso hoy en d√≠a no hay muchas soluciones similares, el autor sabe Automatizar desde HelpSystems y la extensi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JMeter</a> para BlazeMeter (estar√© encantado de recibir informaci√≥n sobre otros productos similares). <br><br><h2>  La primera investigaci√≥n sobre el problema. </h2><br>  El emulador est√°ndar del terminal TN5250 instalado en los lugares de trabajo en el banco es IBM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Personal Communications</a> para Windows 6.0 (PCOMM 6.0).  Los colegas descubrieron que este producto tiene medios regulares para automatizar su administraci√≥n en forma de una API diversa, a saber: <br><br><ol><li>  Interfaz de programa de aplicaci√≥n de lenguaje de alto nivel (HLLAPI); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HLLAPI mejorado;</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Windows HLLAPI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Host Client Client Library (HACL).</a> </li></ol><br>  Las tres primeras interfaces son las m√°s antiguas y se admiten desde las versiones de DOS y Windows de 16 bits.  El trabajo en la interfaz EHLLAPI se implementa llamando a una √∫nica funci√≥n de acuerdo con el siguiente prototipo: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hllapi</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LPWORD, LPSTR, LPWORD, LPWORD)</span></span></span></span>;</code> </pre> <br>  donde el primer par√°metro es un puntero al n√∫mero num√©rico de la funci√≥n que se ejecuta, los otros dos son sus argumentos sensibles al contexto de la funci√≥n que se llama, y ‚Äã‚Äãel √∫ltimo es el resultado de la funci√≥n.  Es decir, para solicitar el estado de conexi√≥n 'A' (las sesiones en el emulador est√°n numeradas con una letra latina del rango de 'A' a 'Z'), debe ejecutar el siguiente c√≥digo (tomado de la documentaci√≥n de IBM): <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hapi_c.h"</span></span></span><span class="hljs-meta"> struct HLDQuerySessionStatus QueryData; int Func, Len, Rc; long Rc; memset(QueryData, 0, sizeof(QueryData)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Init buffer QueryData.qsst_shortname = 'A'; // Session to query Func = HA_QUERY_SESSION_STATUS; // Function number Len = sizeof(QueryData); // Len of buffer Rc = 0; // Unused on input hllapi(&amp;Func, (char *)&amp;QueryData, &amp;Len, &amp;Rc); // Call EHLLAPI if (Rc != 0) { // Check return code // ...Error handling }</span></span></span></span></code> </pre><br>  El n√∫mero de funciones disponibles para llamar de esta manera es de aproximadamente 60. <br><br>  La interfaz WinHLLAPI expande ligeramente esta funcionalidad con varias funciones adicionales que permiten registrar funciones de devoluci√≥n de llamada para llamadas as√≠ncronas para notificar sobre eventos de establecer una conexi√≥n con el host, desconectarse del host, cambiar datos en la pantalla del terminal, etc. <br><br>  La interfaz de Host Access Client Library (HACL) parec√≠a ser m√°s f√°cil de usar porque, en contraste con llamar a la "funci√≥n del mismo nombre", se proporcion√≥ una variante de la jerarqu√≠a de clases orientada a objetos que imitaba completamente cualquier acci√≥n del usuario. <br><br><img src="https://habrastorage.org/webt/bv/km/nx/bvkmnxfp3dcskk9uiw9kzbtyffo.gif"><br>  <i>HACL Emulator Class Library Jerarqu√≠a de clases (C ++)</i> <br><br>  Hay implementaciones de HACL para C ++, Java, LotusScript y un servidor de automatizaci√≥n COM para Windows (conveniente para Visual Basic y .NET). <br><br><h2>  Primer prototipo </h2><br>  Debido a la enorme complejidad del protocolo de flujo de datos 5250 y la informaci√≥n extremadamente escasa sobre su dispositivo interno con enlaces a literatura paga cerrada de IBM, se hizo evidente que desarrollar su propio emulador es extremadamente no trivial y consume mucho tiempo.  En este sentido, surgi√≥ la idea de utilizar una capa de middleware que le permita controlar el emulador de terminal dentro de la funcionalidad m√≠nima requerida, en particular "ingrese un valor en el campo", "compare parte de la pantalla con el est√°ndar" o "presione la tecla host F22". <br><br>  Los colegas que anteriormente usaban interfaces HACL afirmaron (y una b√∫squeda en StackOverflow confirm√≥) que el objeto COM ten√≠a problemas de estabilidad y pod√≠a bloquearse despu√©s de que se ejecutara un cierto n√∫mero de comandos.  Solo reiniciar el proceso del servidor de automatizaci√≥n ayud√≥.  Un an√°lisis r√°pido de la versi√≥n de Java mostr√≥ que Wrapper se usa sobre la interfaz C ++ a trav√©s de JNI.  Por lo tanto, la elecci√≥n recay√≥ en la interfaz C ++.  Los archivos de encabezado y archivos .lib correspondientes estaban disponibles en el directorio de instalaci√≥n de Personal Communications para Windows. <br><br>  El primer prototipo se bas√≥ en Qt5, donde fue posible ejecutar c√≥digo JavaScript a trav√©s de QtScript.  En el entorno de la secuencia de comandos ejecutable, se registr√≥ un objeto con una peque√±a cantidad de m√©todos que permitieron ejecutar comandos en el emulador de terminal como si fueran ejecutados por una persona (ingresando un campo, presionando las teclas del host, esperando que aparezca una l√≠nea en la pantalla).  Demostramos una "demostraci√≥n" en vivo, donde escribimos un gui√≥n de un caso de usuario para iniciar una aplicaci√≥n de pantalla verde desde ABS Equation con una prueba de la reacci√≥n de la aplicaci√≥n a la entrada incorrecta en los campos.  La demostraci√≥n mostr√≥ que el prototipo fue exitoso y que podemos seguir adelante. <br><br><h2>  La aparici√≥n de un vecino. </h2><br>  Junto con la demostraci√≥n del primer prototipo, los colegas de otro departamento reunieron un grupo de m√≥dulos Ruby + Pepino + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Quick3270</a> + Ruby ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cheeze / te3270</a> ).  La opci√≥n propuesta utiliza un m√≥dulo Ruby que interact√∫a con el emulador de terminal Quick3270 Computing DN32 a trav√©s de sus objetos COM especializados (incompatible con las interfaces HACL).  Era una soluci√≥n completa para aplicaciones de prueba autom√°tica de pantalla verde estilo BDD, con unos pocos pasos descritos previamente.  Sin embargo, en la soluci√≥n propuesta nos alarm√≥ lo siguiente: <br><br><ol><li>  Utilizamos un emulador pago de terceros que no es de IBM (todos los emuladores funcionan de manera un poco diferente, pero necesitamos verificar el trabajo en los est√°ndares utilizados en el banco, el precio del error es incre√≠blemente alto); </li><li>  Las implementaciones de los pasos de Cucumber para Quick3270 utilizaron una gran cantidad de durmientes para esperar una respuesta de la m√°quina; </li><li>  Muy mal rendimiento de Quick3270 a trav√©s de la interfaz de automatizaci√≥n (trabajar con HACL en el prototipo a trav√©s de la interfaz C ++ parec√≠a mucho m√°s din√°mico). </li></ol><br><img src="https://habrastorage.org/webt/wy/j3/2u/wyj32ub0tvoxzbh-va3yxajiqfs.jpeg"><br>  <i>Emulador de terminal Quick3270</i> <br><br>  Con base en el prototipo, decidimos intentar implementar nuestro propio servidor de automatizaci√≥n para conectar Cucumber a Personal Communications para Windows y dise√±ar los pasos para que el tiempo de inactividad entre las acciones en la pantalla del emulador sea m√≠nimo. <br><br>  <i><b>Digresi√≥n l√≠rica</b> .</i>  <i>A pesar del hecho de que hay una gran cantidad de problemas t√©cnicos en torno al supuesto "legado" de IBM, que, al parecer, ya deber√≠a haberse resuelto para sistemas de nivel medio y empresarial, la relevancia de adaptar y transferir las soluciones t√©cnicas existentes es muy alta simplemente por su ausencia en la plataforma.</i>  <i>A menudo, la ausencia est√° relacionada con las caracter√≠sticas de este sistema operativo, que es fundamentalmente diferente de las modernas * nix, Windows o MacOS X, que requieren una optimizaci√≥n significativa del software para esta pila.</i> <br><br><h2>  Decisi√≥n propia </h2><br>  Como nuestra propia soluci√≥n, creamos un servidor de automatizaci√≥n como desarrollo del prototipo previamente demostrado.  Este servidor ejecuta comandos para automatizar la interacci√≥n de los consumidores a trav√©s de un servidor RPC (Qt5 WebSocket).  Interact√∫a con Personal Communications para Windows, que es parte de la imagen corporativa del sistema operativo Windows, y le permite: <br><br><ul><li>  iniciar / detener sesiones del emulador de terminal; </li><li>  Realizar Screen Scraping Green Screen; </li><li>  buscar campos de entrada en la pantalla; </li><li>  controlar el cursor y simular pulsaciones de teclas (incluido el host); </li><li>  y otros </li></ul><br><img src="https://habrastorage.org/webt/ub/qf/xp/ubqfxpqwu5q9pz3ievcpkfb0_sm.png"><br>  <i>Iniciar servidor de automatizaci√≥n</i> <br><br>  Sin embargo, para todas las ventajas de la API HACL, tiene un inconveniente: no sabe c√≥mo trabajar con DB2 para i DBMS integrado en el sistema operativo y no permite ejecutar comandos que son vitales para crear un entorno simulado donde se ejecutar√≠a un script de prueba.  Si el cliente de DB2 para Ruby existe de IBM, entonces el cliente para el servidor de comando remoto y de llamada de programa distribuido es solo para Java en forma de biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JTOpen</a> : la versi√≥n de c√≥digo abierto de IBM Toolbox para Java (tambi√©n conocida como jt400 )  "Observamos" la soluci√≥n a este problema en IBM al analizar el comportamiento de sus productos con una funcionalidad similar (en particular, Comunicaciones personales para Windows Data Transfer, iSeries a PC / PC a iSeries Transfer, etc.).  Result√≥ que estos productos, por su implementaci√≥n, ejecutan IBM JRE 6 u 8, dependiendo de la versi√≥n de la aplicaci√≥n, y utilizan la biblioteca jt400. <br><br>  Para el servidor de automatizaci√≥n, decidimos hacer lo mismo.  JNI lanza IBM JVM, que se entrega con Personal Communications para Windows.  Usando m√©todos de envoltura especiales, los comandos del servidor RPC que provienen del exterior se ejecutan mediante proxy en llamadas a la funcionalidad jt400 necesaria.  Como este √∫ltimo tambi√©n contiene un controlador JDBC para DB2, se decidi√≥ utilizarlo para acceder al DBMS en IBM i. <br><br>  Es importante tener en cuenta que no puede usar Oracle JVM cuando usa HACL.  Si ejecuta una sesi√≥n de emulador de terminal, se bloquear√° el intento de crear una instancia de la m√°quina virtual.  Del mismo modo, si ejecuta Oracle JVM en el espacio de direcciones de un proceso que interact√∫a con el HACL, este √∫ltimo se bloquea sin explicaci√≥n. <br><br>  Con el tiempo, la soluci√≥n se implement√≥ en un n√∫mero creciente de trabajos.  Funcion√≥ m√°s r√°pido que la soluci√≥n con Quick3270.  La popularidad creci√≥, al igual que el n√∫mero de autotests.  Sin embargo, durante la operaci√≥n, surgieron dificultades adicionales: <br><br><ol><li>  Congelaciones terminales ocasionales; </li><li>  Incapacidad para trabajar en un soporte de regresi√≥n debido a que el emulador de terminal se niega a iniciarse si el escritorio del usuario bajo el cual se inicia el emulador est√° bloqueado o su sesi√≥n RDP est√° bloqueada; </li><li>  Solo para Windows; </li><li>  Un procedimiento complejo para instalar, configurar y actualizar herramientas (a trav√©s de un paquete msi); </li><li>  Nuestro ciclo de regresi√≥n para 130 pruebas autom√°ticas (aproximadamente 4000 pasos) comenz√≥ a tomar de 7 a 8 horas. </li></ol><br><h2>  Algo debe hacerse ... </h2><br>  Al analizar los registros de seguimiento de numerosos lanzamientos de pruebas autom√°ticas, buscando cuellos de botella en el desempe√±o de los pasos utilizados con frecuencia, el tiempo total de ejecuci√≥n de la regresi√≥n se redujo a 4-5 horas.  Pero estaba claro que usar la capa de middleware en forma de un servidor RPC de automatizaci√≥n junto con la interfaz HACL, que tambi√©n tiene errores "flotantes" que se acumulan durante todo el sistema, no ayudar√° a mejorar el rendimiento de la soluci√≥n. <br><br>  Por otro lado, como alternativa a IBM Personal Communications para Windows, el proveedor proporciona una soluci√≥n multiplataforma llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IBM i Access - Soluciones de cliente.</a> <br><br><img src="https://habrastorage.org/webt/et/8d/kr/et8dkrlouhhuuqe3ew3krvyjq6u.png"><br>  <i>IBM i Access - Soluciones de cliente</i> <br><br>  El an√°lisis de su estructura interna los s√°bados y domingos por la ma√±ana con una taza de caf√© mostr√≥ que su c√≥digo base se basa en otro producto de IBM llamado IBM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Host on-Demand</a> (IBM HOD).  Esta es una soluci√≥n completa para acceder a IBM i, desarrollada en Java 6, que no solo tiene la implementaci√≥n completa de varios protocolos de comunicaci√≥n utilizados en m√°quinas IBM (TN3270, TN5250, VTxxx, etc.), sino tambi√©n componentes de interfaz de usuario java-swing de alto nivel, sol√≠an construir sus propios emuladores de terminal en forma de constructor, que pueden ensamblarse a partir de la escasa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n de</a> IBM.  Un estudio m√°s detallado de IBM HOD mostr√≥ que los componentes de la interfaz de usuario se basan en la implementaci√≥n de Java de la interfaz HACL, cuya documentaci√≥n est√° abierta.  Su comportamiento coincide con solo ligeras diferencias con respecto a la documentaci√≥n de C ++ HACL. <br><br><img src="https://habrastorage.org/webt/8u/fx/7-/8ufx7-3eikew1kjwcr0h-3uuw40.png"><br>  <i>IBM Host On-Demand (logotipo)</i> <br><br>  A continuaci√≥n, creamos una biblioteca Java para uso interno, que implementa la misma interfaz que el servidor de automatizaci√≥n C ++ RPC, pero internamente utiliza IBM HOD.  Para reducir la sobrecarga durante la ejecuci√≥n de los pasos de la prueba autom√°tica, migramos de Ruby Cucumber a cucumber-jvm con la reimplementaci√≥n de todos los pasos similares a las opciones de Ruby.  En presencia de una interfaz de software similar al servidor RPC, esto no fue un gran problema, especialmente teniendo en cuenta que tratamos de frenar el crecimiento incontrolado en el n√∫mero de pasos en s√≠ mismos y ten√≠amos este valor en la regi√≥n de 30 unidades. <br><br><h2>  Cual es el resultado </h2><br>  Como resultado, logramos la operatividad de todas las pruebas autom√°ticas sin cambiarlas, y la velocidad del trabajo se hizo tan alta que tuvimos que introducir un retraso artificial entre los pasos para que al desarrollar una prueba autom√°tica, pudieras observar su trabajo, de lo contrario la interfaz de usuario no tuvo tiempo de dibujar la pantalla hasta el final. <br><br>  Las 180 pruebas autom√°ticas ya existentes con m√°s de 16,000 pasos con un retraso establecido de 60 ms entre pasos comenzaron a ejecutarse aproximadamente 30 minutos contra 5 horas 30 minutos, lo que corresponde a un aumento de once veces en el rendimiento del soporte de regresi√≥n. <br><br>  Los resultados excedieron todas las expectativas.  Estamos cerca de los l√≠mites f√≠sicos del protocolo TN5250. <br><br>  Hasta la fecha, la decisi√≥n se ha publicado en todo el banco, y colegas de otras ciudades se han unido a la mejora.  De los cambios recientes, los colegas est√°n integrando la soluci√≥n con Jenkins, en la versi√≥n de prueba, la prueba del lanzamiento en un servidor Linux con Xvfb se complet√≥ y comenz√≥ la etapa de operaci√≥n piloto de ejecuci√≥n de pruebas autom√°ticas. <br><br>  ¬°Gracias por leer hasta el final! <br>  Todo el exito! <br><br>  PD En diciembre de 2018, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se celebr√≥</a> la pr√≥xima <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conferencia de desarrolladores de IBMi,</a> en la que se realiz√≥ un informe sobre el tema de este art√≠culo. <br><br>  Hasta ahora, hemos celebrado la Conferencia anualmente solo para empleados del Banco.  A partir de 2019, invitaremos a participantes de otras empresas.  Es muy interesante ampliar el c√≠rculo de comunicaci√≥n profesional y personal, compartir emociones, conocimientos y experiencias. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446332/">https://habr.com/ru/post/446332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446322/index.html">Criptograf√≠a en Java. Keytool Utility</a></li>
<li><a href="../446324/index.html">Navegaci√≥n en DataGrip con Yandex.Navigator</a></li>
<li><a href="../446326/index.html">Resolviendo problemas de tr√°fico</a></li>
<li><a href="../446328/index.html">¬øPor qu√© necesitamos servicios de recepci√≥n de SMS y con qu√© comen?</a></li>
<li><a href="../446330/index.html">M√°quinas autom√°ticas contra el c√≥digo de espagueti</a></li>
<li><a href="../446334/index.html">Reflexiones sobre una carrera en TI y consejos para principiantes</a></li>
<li><a href="../446336/index.html">C√≥mo prohibir las contrase√±as est√°ndar y hacer que todos te odien</a></li>
<li><a href="../446338/index.html">SVG 3D: crear, rotar y animar</a></li>
<li><a href="../446340/index.html">Sistemas operativos: tres piezas f√°ciles. Parte 1: Introducci√≥n (traducci√≥n)</a></li>
<li><a href="../446342/index.html">El impacto de las p√°ginas transparentes enormes en el rendimiento del sistema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>