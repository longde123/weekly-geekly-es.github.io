<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП╜тАНЁЯФм тЪЦя╕П ЁЯСПЁЯП╛ Boost.Spirit, рдпрд╛ рд╕реВрдЪреА рдлрд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "рдЖрдзреНрдпрд╛рддреНрдорд┐рдХрддрд╛" рдЬреЛрдбрд╝реЗрдВ ЁЯжМ ЁЯСТ ЁЯжЖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрдЪреНрдЫреЗ рджрд┐рди, рд╕рд╣рдХрд░реНрдорд┐рдпреЛрдВред рдореИрдВ рдЕрднреА рднреА рдПрдХ ISPystem рдбреЗрд╡рд▓рдкрд░ рд╣реВрдВ, рдФрд░ рдореЗрд░рд╛ рдирд╛рдо рдЕрднреА рднреА рджрд┐рдорд┐рддреНрд░реА рд╕реНрдорд┐рд░рдиреЛрд╡ рд╣реИред рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП (рдмрд▓реНрдХрд┐ рд▓рдВрдмреЗ рд╕рдордп рдХреЗ рд▓рд┐рдП) рдореИрдВ рдЕрдЧрд▓реЗ рдкреНрд░...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Boost.Spirit, рдпрд╛ рд╕реВрдЪреА рдлрд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "рдЖрдзреНрдпрд╛рддреНрдорд┐рдХрддрд╛" рдЬреЛрдбрд╝реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/472004/"><p><img src="https://habrastorage.org/webt/qv/yu/6-/qvyu6-kaqci3ha5ivctj0nvbwco.png" alt="рдЫрд╡рд┐"></p><br><p>  рдЕрдЪреНрдЫреЗ рджрд┐рди, рд╕рд╣рдХрд░реНрдорд┐рдпреЛрдВред  рдореИрдВ рдЕрднреА рднреА рдПрдХ ISPystem рдбреЗрд╡рд▓рдкрд░ рд╣реВрдВ, рдФрд░ рдореЗрд░рд╛ рдирд╛рдо рдЕрднреА рднреА рджрд┐рдорд┐рддреНрд░реА рд╕реНрдорд┐рд░рдиреЛрд╡ рд╣реИред  рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП (рдмрд▓реНрдХрд┐ рд▓рдВрдмреЗ рд╕рдордп рдХреЗ рд▓рд┐рдП) рдореИрдВ рдЕрдЧрд▓реЗ рдкреНрд░рдХрд╛рд╢рди рдХреЗ рд╡рд┐рд╖рдп рдкрд░ рдлреИрд╕рд▓рд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛, рдХреНрдпреЛрдВрдХрд┐ рдмреВрд╕реНрдЯ.рд╕рд┐рдпреЛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдкрд┐рдЫрд▓реЗ рдорд╣реАрдиреЛрдВ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реА рд╕рд╛рдордЧреНрд░реА рдЬрдорд╛ рд╣реЛ рдЧрдИ рд╣реИред  рдФрд░ рдЙрд╕ рдкрд▓ рдореЗрдВ рднреА рдЬрдм рдРрд╕рд╛ рд▓рдЧрддрд╛ рдерд╛ рдХрд┐ рдПрдХ рд╕рд┐рдХреНрдХрд╛ рдЙрдЫрд╛рд▓рдирд╛ рдЖрд╕рд╛рди рдерд╛, рдПрдХ рдХрд╛рд░реНрдп рдиреЗ рд╕рдм рдХреБрдЫ рдмрджрд▓ рджрд┐рдпрд╛ред  рдПрдХ рдЙрдкрдХрд░рдг рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛, рдЬреЛ рджреГрд╢реНрдпрдкрдЯрд▓ рдХреЛ рдЕрдиреБрд░реЛрдзрд┐рдд рд╕реВрдЪрд┐рдпреЛрдВ рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдмреИрдХрдПрдВрдб рд╕реЗ рд╣реА рд╕реВрдЪреА рдПрдХ рд╕рд╛рдзрд╛рд░рдг json_array рд╣реИред  Kat рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ, рд╣рд╛рд▓ рдХреЗ рджрд┐рдиреЛрдВ рдХреЗ рд╕рднреА рдЙрддрд╛рд░-рдЪрдврд╝рд╛рд╡ рд╣реИрдВред </p><a name="habracut"></a><br><h3 id="diskleymer">  рддреНрдпрд╛рдЧ </h3><br><p>  рдореБрдЭреЗ рддреБрд░рдВрдд рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдкрд┐рдЫрд▓реА рдмрд╛рд░ рд▓реЗрдЦрдХ рдиреЗ "рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛" рдХреБрдЫ рд╕рд╛рд▓ рдкрд╣рд▓реЗ рд╕рдВрджрд░реНрдн-рдореБрдХреНрдд рд╡реНрдпрд╛рдХрд░рдг рдЬреИрд╕рд╛ рдерд╛ред  рддрдм рдРрд╕рд╛ рд▓рдЧрддрд╛ рдерд╛ рдХрд┐ рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрдЬрд╛рдп рд╕реНрд▓реЗрдб рдФрд░ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдЙрдкрдХрд░рдг рд╣реИрдВ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рд╕рдорд╕реНрдпрд╛ рдмрдпрд╛рди рдХреЗ рджрд┐рди Boost.Spirit рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрд╛ред </p><br><h3 id="zadacha">  рдХрд╛рд░реНрдп </h3><br><p>  рдЬреИрд╕реЗ рдХреЛрдИ рдХреНрд╡реЗрд░реА рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre><code class="cpp hljs">(string_field CP value AND int_field NOT LT <span class="hljs-number"><span class="hljs-number">150</span></span>) OR bool_field EQ <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p>  рдХреБрдЫ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдЬреЛ рдХрд┐ json рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдЧрд╛ рдФрд░ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдЧрд╛ рдХрд┐ рдпрд╣ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред </p><br><h3 id="pervye-shagi">  рдкрд╣рд▓рд╛ рдХрджрдо </h3><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рднрд╡рд┐рд╖реНрдп рдХреЗ рдлрд┐рд▓реНрдЯрд░ рдХреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкрд░ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╕рд░рдгреА рд╕реЗ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдПрд╕рдЯреАрдПрд▓ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ std :: remove_if рдореЗрдВред </p><br><p>  рдПрдХ рдлрд╝рдирдХрд╛рд░ рд╕рд╣реА рд╣реЛрдЧрд╛, рдЬреЛ рд╕реАрдзреЗ рд╕рд╛рдордиреЗ рд╕реЗ рдЕрдиреБрд░реЛрдз рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЪреВрдВрдХрд┐ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдиреЛрд╣рдорди :: json рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдбрд┐рдЬрд╛рдЗрди рдХрд╛рдлреА рд╕реБрд░реБрдЪрд┐рдкреВрд░реНрдг рд╣реЛрдЧрд╛: </p><br><pre> <code class="cpp hljs">filter = <span class="hljs-string"><span class="hljs-string">"(string_field CP value AND int_field NOT LT 150) OR bool_field EQ true"</span></span>; json.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove_if(json.begin(), json.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::not_fn(JsonFilter{filter})), json.end());</code> </pre> <br><p>  рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдмрд╛рдЗрдирд░реА рдЯреНрд░реА рдореЗрдВ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪреБрдирд╛ред  рд╕рдмрд╕реЗ рдХрдо рдХреЛрдиреЗ рдореЗрдВ рддреБрд▓рдирд╛ рдСрдкрд░реЗрдЯрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдмрд╛рдХреА рддрд╛рд░реНрдХрд┐рдХ рдСрдкрд░реЗрдЯрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣ рдЙрдкрд░реЛрдХреНрдд рдлрд╝рд┐рд▓реНрдЯрд░ рдЕрд╕рдВрддреБрд╖реНрдЯ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рджрд┐рдЦреЗрдЧрд╛: </p><br><p><img src="https://habrastorage.org/webt/if/yc/zk/ifyczkjiznmiebrxvof3oxgnur4.jpeg" alt="рдлрд╝рд┐рд▓реНрдЯрд░ рдЯреНрд░реА"></p><br><p>  рдкрд░рд┐рдгрд╛рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдПрд╕рдЯреА</a> рдХрд╛ рдПрдХ рд░реВрдк рдерд╛, рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред  рдЕрдм рдЬрдм рдЖрдЧрд╛рдореА рддрд░реНрдХ рдХреА рддрд╕реНрд╡реАрд░ рдЖрдХрд╛рд░ рд▓реЗ рдЪреБрдХреА рд╣реИ, рддреЛ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдФрд░ рднрдпрд╛рдирдХ рдХреНрд╖рдг рдЖ рдЧрдпрд╛ рд╣реИред  рдпрд╣ рд▓рд┐рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП ... рдЖрддреНрдорд╛ рдкрд░ ... </p><br><h3 id="znakomstvo">  рдкрд░рд┐рдЪрд┐рдд </h3><br><p>  рд╕рдмрд╕реЗ рдХрдард┐рди рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ: рдХрд╣рд╛рдВ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ?  рдЕрд╕рд┐рдпреЛ рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╕реНрдкрд┐рд░рд┐рдЯ рд╣реЗрдбрд░ рдкрдврд╝рдиреЗ рд╕реЗ рдХреЛрдИ рд╕реНрдкрд╖реНрдЯ рд╕рдВрдХреЗрдд рдирд╣реАрдВ рдорд┐рд▓рддрд╛ рдерд╛, рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ - "рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЬрд╛рджреВ" рд╣реИред  рдЗрд╕рдХреЗ рдмрд╛рдж рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдмреВрд╕реНрдЯ рдФрд░ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдореЗрдВ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рдПрдХ рдЕрдзреНрдпрдпрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рдХреБрдЫ рд╕рдордп рдмрд╛рдж рди рдХреЗрд╡рд▓ рдЙрдирдХреЗ рдлрд▓реЛрдВ рдХреЛ рд▓рд╛рдпрд╛, рдмрд▓реНрдХрд┐ рдореЗрд░реА рдЬрд░реВрд░рддреЛрдВ рдХреЗ рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЙрддрдирд╛ рд╕рдорд╛рдзрд╛рди: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдПрд╕рдЯреА рдХреИрд▓рдХреБрд▓реЗрдЯрд░</a> </p><br><p>  рдЖрдЗрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рд╡реНрдпрд╛рдХрд░рдг рдХреЛ рджреЗрдЦреЗрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рд╡реНрдпрд╛рдХрд░рдг рдХреИрд▓рдХреБрд▓реЗрдЯрд░</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArithmeticGrammar1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> qi::grammar&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator, ASTNodePtr(), qi::space_type&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Iterator = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator; ArithmeticGrammar1() : ArithmeticGrammar1::base_type(start) { start = (product &gt;&gt; <span class="hljs-string"><span class="hljs-string">'+'</span></span> &gt;&gt; start) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'+'</span></span>&gt;&gt; (qi::_1, qi::_2)] | product[qi::_val = qi::_1]; product = (factor &gt;&gt; <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt;&gt; product) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'*'</span></span>&gt;&gt; (qi::_1, qi::_2)] | factor[qi::_val = qi::_1]; factor = group[qi::_val = qi::_1] | qi::int_[qi::_val = phx::new_&lt;ConstantNode&gt;(qi::_1)]; group %= <span class="hljs-string"><span class="hljs-string">'('</span></span> &gt;&gt; start &gt;&gt; <span class="hljs-string"><span class="hljs-string">')'</span></span>; } qi::rule&lt;Iterator, ASTNodePtr(), qi::space_type&gt; start, group, product, factor; };</code> </pre> </div></div><br><p>  рд╡реНрдпрд╛рдХрд░рдг рдХреЛ рдЖрдзрд╛рд░ qi :: рд╡реНрдпрд╛рдХрд░рдг рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ рд╣реИред  <em>ASTNodePtr ()</em> рдПрдХ рд╕реНрдкрд╖реНрдЯ, рд▓реЗрдХрд┐рди рд╡реНрдпрд╛рдХрд░рдг рдХреА рд╡рд╕реНрддреБ рдореЗрдВ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрд░рд┐рдгрд╛рдо рдХреА рд╡рд╕реНрддреБ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдПрдПрд╕рдЯреА рдиреЛрдб рдХреИрд▓рдХреБрд▓реЗрдЯрд░</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ASTNode</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~ASTNode() {} }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ASTNodePtr = ASTNode*; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Operator&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OperatorNode</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ASTNode { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: OperatorNode(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASTNodePtr &amp;left, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASTNodePtr &amp;right) : left(left) , right(right) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operator == <span class="hljs-string"><span class="hljs-string">'+'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left-&gt;evaluate() + right-&gt;evaluate(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operator == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left-&gt;evaluate() * right-&gt;evaluate(); } ~OperatorNode() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> left; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> right; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: ASTNodePtr left, right; <span class="hljs-comment"><span class="hljs-comment">//  }; class ConstantNode : public ASTNode { public: ConstantNode(double value) : value(value) {} double evaluate() { return value; } private: double value; };</span></span></code> </pre> </div></div><br><p>  Boost.Phoenix рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЖрдк рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди рдПрдХ рдпрд╛ рдХрдИ рдЧреИрд░-рдЯрд░реНрдорд┐рдирд▓реЛрдВ рд╕реЗ рдПрдХ рддреИрдпрд╛рд░ рдПрдПрд╕рдЯреА рдиреЛрдб рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реАрдзреЗ рдкрд░рд┐рдгрд╛рдо рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдХреИрд▓рдХреБрд▓реЗрдЯрд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs">start = (product &gt;&gt; <span class="hljs-string"><span class="hljs-string">'+'</span></span> &gt;&gt; start)[qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'+'</span></span>&gt;&gt; (qi::_1, qi::_2)] | product[qi::_val = qi::_1];</code> </pre> <br><p>  start - рд╡рд╛рдХреНрдп рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВред  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдмрд┐рдВрджреБред  рдЗрд╕реЗ рдЙрддреНрдкрд╛рдж рдХреЗ рдпреЛрдЧ рдФрд░ рдкреНрд░рд╛рд░рдВрдн, рдпрд╛ рдХреЗрд╡рд▓ рдЙрддреНрдкрд╛рдж рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдкреНрд░рддреНрдпреЗрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рд╡рд░реНрдЧ рдХреЛрд╖реНрдардХ рдореЗрдВ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред  рдпрд╣ рд╡рд╣ рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдпрджрд┐ рд╕рдм рдХреБрдЫ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рд╕рдлрд▓ рд╣реЛрдиреЗ рдкрд░ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  <em>рдХреНрдпреВрдИ :: _ рд╡реИрд▓</em> рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ <em>рдмрдврд╝рд╛рд╡рд╛ рд╣реИ :: рднрд╛рд╡рдирд╛ :: рдХреНрдпреВрдИ :: _ рд╡реИрд▓</em> рдПрдХ рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░ рд╣реИред  рдЗрд╕рдХреА рдорджрдж рд╕реЗ, рдкрд░рд┐рдгрд╛рдо рдореЗрдВ рдЬрд╡рд╛рдм рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдкреНрд░рд╛рд░рдВрдн рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдПрдХ рдСрдкрд░реЗрдЯрд░-рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рдХрд╛ рдкрд╣рд▓рд╛ рддрд░реНрдХ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдЙрддреНрдкрд╛рдж рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрдЧрд╛, рдФрд░ рджреВрд╕рд░рд╛ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдкреНрд░рд╛рд░рдВрдн рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИред </p><br><p>  рд╣рдо рдЖрдЧреЗ рджреЗрдЦрддреЗ рд╣реИрдВред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдо рджреВрд╕рд░реЗ рд╡рд┐рдХрд▓реНрдк рдкрд░ рдЖрддреЗ рд╣реИрдВ, рддреЛ рдкреНрд░рд╛рд░рдВрдн рдПрдХ рд░рд╛рд╢рд┐ рдирд╣реАрдВ рд╣реИ, рдмрд▓реНрдХрд┐ рдПрдХ рдЙрддреНрдкрд╛рдж рд╣реИред  рдЙрд╕реЗ рдХреИрд╕реЗ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ? </p><br><pre> <code class="cpp hljs">product = (factor &gt;&gt; <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt;&gt; product) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'*'</span></span>&gt;&gt; (qi::_1, qi::_2)] | factor[qi::_val = qi::_1];</code> </pre> <br><p>  рдкрд┐рдЫрд▓реА рддрд╕реНрд╡реАрд░ рдХреЛ рдиреНрдпреВрдирддрдо рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рджреЛрд╣рд░рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдлрд┐рд░ рд╕реЗ рд╣рдо рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдкреВрд░рд╛ рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ рд╕реЗ рд╣рдо рдкрд░рд┐рдгрд╛рдо рдореЗрдВ OperatorNode рдСрдмреНрдЬреЗрдХреНрдЯ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рдпрд╛ рдмрд╕ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдХрд╛рд░рдХред  рдЖрдЗрдП рдЗрд╕реЗ рджреЗрдЦреЗрдВред </p><br><pre> <code class="cpp hljs">factor = group[qi::_val = qi::_1] | qi::int_[qi::_val = phx::new_&lt;ConstantNode&gt;(qi::_1)];</code> </pre> <br><p>  рдЬреИрд╕реЗ рд╣реА рд╣рдо рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рд░рд╛рд╕реНрддреЗ рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ, рд╣рдо рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдЗрдВрдЯ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐рд╕реА рд╕реЗ рдирд╣реАрдВ рдорд┐рд▓реЗред  рдЕрдм, рдпрджрд┐ рд╣рдо рдЫрджреНрдо рдХреЛрдб рдХреЗ рд╕рднреА рдкрд┐рдЫрд▓реЗ рдЪрд░рдгреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд░реВрдк рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="cpp hljs">factor1 = ConstantNode(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   ,    factor2 = ConstantNode(3) product = OperatorNode&lt;'*'&gt;(factor1, factor2) start = product</span></span></code> </pre> <br><p>  рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб, рдКрдкрд░ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ (рд╕рдмрд╕реЗ рдХрдо рд╡рд╛рд▓реЗ рдХреЛ рдЫреЛрдбрд╝рдХрд░, рдЬреЛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдпрд╣рд╛рдВ рдкреВрд░реНрдгрд╛рдВрдХ рд╣реИрдВ), рдмрд╛рдж рдХреЗ рдиреЛрдбреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рдореВрд▓ рддрддреНрд╡ рдкрд░ <em>рдореВрд▓реНрдпрд╛рдВрдХрди ()</em> рд╡рд┐рдзрд┐ <em>рдХрд╛</em> рдПрдХрдорд╛рддреНрд░ рдХреЙрд▓ рдкреВрд░реА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ, рдЕрджреНрднреБрдд! </p><br><p>  рддрдм <em>qi :: space_type</em> рдЖрдкрдХреА рдЖрдВрдЦ рдХреЛ рдкрдХрдбрд╝рддрд╛ рд╣реИ - рдпрд╣ рддрд░реНрдХ рдкрд╛рд░реНрд╕ рдХрд░рддреЗ рд╕рдордп рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд┐рдП рдЧрдП рддрддреНрд╡реЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╣реИред  рдпрд╣ рдЕрднреА рднреА рдореБрдЭ рдкрд░ рдПрдХ рдЪрд╛рд▓ рдЦреЗрд▓реЗрдВрдЧреЗ :-)ред </p><br><p>  рдпрд╣рд╛рдВ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдЙрддреНрдкрд╛рдж (*) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдиреЙрдирдЯрд░реНрдорд┐рдирд▓ рд╕реНрдЯрд╛рд░реНрдЯ (рдмрд╕ рдпреБрдХреНрдд +) рдХреЛ рд╡реНрдпрдХреНрдд рдХрд░рдХреЗ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЧреБрдгрд╛ рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИред  рдореЗрд░реЗ рд╡реНрдпрд╛рдХрд░рдг рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рддрдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдФрд░ рдкрд░ рд╣рд╛рд╡реА рд╣реЛрдЧрд╛ рдпрд╛, рдореИрдВ рдмрд╕ рд╕рд╣реА рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рддрд╛рд░реНрдХрд┐рдХ рдСрдкрд░реЗрдЯрд░реЛрдВ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реВрдВред  рдпрджрд┐ рдЧрдгрд┐рддреАрдп рдСрдкрд░реЗрдЯрд░реЛрдВ рдХреЛ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рдЧрд▓рддреА рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ, рддреЛ рдкрд╛рда рддрд╛рд░реНрдХрд┐рдХ рддрд╛рд░реНрдХрд┐рдХ рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рдХрд╣рд╛рдиреА рд╣реИред  рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдХрдо рд╕реЗ рдХрдо рднрд╛рдЧ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд░рдЬрд┐рд╕реНрдЯрд░ред  рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрддреНрдорд╛ рдореЗрдВ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рдХрд╛рд░ <em>qi :: no_case рд╣реИ</em> </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рдмрдЬрд╛рдп, рдореБрдЭреЗ рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЗ рдирд╛рдореЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рд╣рдо рдмрд┐рд▓реНрдЯ-рдЗрди <em>qi :: int_</em> рд╕реНрдкрд┐рд░рд┐рдЯ рдХреЗ рдмрдЬрд╛рдп рд╕рдВрдмрдВрдзрд┐рдд <em>рдиреЙрдирдЯрд░реНрдорд┐рдирд▓ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ</em> : </p><br><pre> <code class="cpp hljs">field = qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_"</span></span>) &gt;&gt; *qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_0-9"</span></span>);</code> </pre> <br><p>  рдФрд░ рд╣рдо рдпрд╣рд╛рдБ рдЗрд╕ рддрд░рд╣ рдХреА рдПрдХ рд╕рд░рд▓ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ (рдЕрдм рддрдХ рдХреЛрдИ рд╢рдмреНрджрд╛рд░реНрде рд╕рдВрдЪрд╛рд▓рди рдирд╣реАрдВ): </p><br><pre> <code class="plaintext hljs">start = product &gt;&gt; qi::no_case["OR"] &gt;&gt; start | product; product = factor &gt;&gt; qi::no_case["AND"] &gt;&gt; product | factor; factor = group | field; group %= '(' &gt;&gt; start &gt;&gt; ')';</code> </pre> <br><p>  рдЕрдм рд╕рдм рдХреБрдЫ рд╕рд░рд▓рддрдо рд╡рд╛рдХреНрдп <em>"рдлрд╝реАрд▓реНрдб рдФрд░ рдлрд╝реАрд▓реНрдб 2"</em> рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИред  рд╣рдо рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ ... рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рд╕рдорд╕реНрдпрд╛ рдПрдХ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╕реНрдерд╛рди рдкрд░ рдереА: <em>рдХреНрдпреВрдИ :: space_type</em> рдХреЗрд╡рд▓ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рдЙрдиреНрд╣реЗрдВ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╡рд╛рдХреНрдп рд╕реЗ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдлрд╝рд┐рд▓реНрдЯрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдлреЙрд░реНрдо рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдореЗрдВ рдЖрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">"fieldAndfield2"</span></span> \\        ,    <span class="hljs-string"><span class="hljs-string">"(5 * 5) + 11 "</span></span> \\  <span class="hljs-string"><span class="hljs-string">"(5*5)+11"</span></span></code> </pre> <br><p>  рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рд╕рд┐рдВрдЧрд▓ рдлреАрд▓реНрдб рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдЖрдкрдХреЛ рдХреБрдЫ рд╕реНрдХрд┐рдкрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs">skipper = +qi::lit(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . ,    ,   ,  ,  C++ . start = product &gt;&gt; skipper &gt;&gt; qi::no_case["OR"] &gt;&gt; skipper &gt;&gt; start | product; ...</span></span></code> </pre> <br><p>  рдЦреЗрддреЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рднрд╛рд╡реЛрдВ рд╕реЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдФрд░ рдпрд╣ рд╕рдордЭрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдореВрд▓реНрдп рдХреЗ рдЦрд┐рд▓рд╛рдл рдХреНрд╖реЗрддреНрд░ рдХреЛ рдХреИрд╕реЗ рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╕рднреА рддреБрд▓рдирд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Operator</span></span></span><span class="hljs-class"> {</span></span> EQ, <span class="hljs-comment"><span class="hljs-comment">//  LT, //  GT, //  CP //  (  ) }; unary = qi::no_case["NOT"]; // ,         </span></span></code> </pre> <br><p>  рдФрд░ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рдЧреИрд░ рдореЗрдВ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs">value = qi::double_ | qi::int_ | qi::bool_ | <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>) &gt;&gt; +qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z0-9_. "</span></span>) &gt;&gt; qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>);</code> </pre> <br><p>  рдЕрдм рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрд┐ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдРрд╕рд╛ рддрд░реАрдХрд╛ рд▓рд╛рддрд╛ рд╣реИред  рдЖрддреНрдорд╛ рдЗрд╕реЗ <em>рдмрдврд╝рд╛рд╡рд╛</em> рдХреЗ рд░реВрдк рдореЗрдВ <em>рд▓реМрдЯрд╛рдПрдЧреА :: рд╕рдВрд╕реНрдХрд░рдг &lt;int, double, bool, std :: string&gt;</em> , рдФрд░ рдЬрдм рдХреБрдЫ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдЗрд╕рдХреА рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдЖрддрд╛ рд╣реИ, рддреЛ рд╡рд╛рдВрдЫрд┐рдд рдкреНрд░рдХрд╛рд░ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЯреНрд░рд┐рдХреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рдпрд╣рд╛рдБ рдореЗрд░реЗ рдкрд╛рд╕ рдХреНрдпрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИ: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ValueType = boost::variant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValueGetter</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> boost::static_visitor&lt;Json&gt; { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Type&gt; <span class="hljs-function"><span class="hljs-function">Json </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Type &amp;value)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } };</code> </pre> <br><p>  рдПрдХ рдЧреЙрдЯрд░ рдПрдХ рдЬрд╕рди рд╡рд╕реНрддреБ рдХреНрдпреЛрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИ?  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди рдореВрд▓реНрдпреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рддреЗ рд╕рдордп, рдореИрдВ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдмрдЪреВрдВрдЧрд╛ рдХрд┐ рдХреМрди рд╕рд╛ рдбреЗрдЯрд╛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рд╕реЗ рдЧреБрдЬрд░ рд░рд╣рд╛ рд╣реИ, рдЬреЛ рд╕рднреА рдХрд╛рдореЛрдВ рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдЬрд╕ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ рдЬрд╛ рд░рд╣рд╛ рд╣реИред </p><br><p>  рдлрд┐рдирд┐рд╢ рд▓рд╛рдЗрдиред  рдореИрдЪрд░ рдХрд╛ рд╡рд┐рд╡рд░рдг рд╕реНрд╡рдпрдВред  рд╣рдо рдПрдХ рдХреИрд▓рдХреБрд▓реЗрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╣реА рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдЕрдореВрд░реНрддрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдо рд╡реНрдпрд╛рдХрд░рдг рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдЖрддреНрдорд╛ рдХреГрдкрдпрд╛ рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рд╕рд╛рде рднрд░ рджреЗрдЧреА: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMatcher</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: AbstractMatcher() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~AbstractMatcher() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       }; using MatcherPtr = std::shared_ptr&lt;AbstractMatcher&gt;;</span></span></code> </pre> <br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рддрд╛рд░реНрдХрд┐рдХ рдиреЛрдбреНрд╕ рдореБрдЦреНрдп рдлрд┐рд▓реНрдЯрд░ рдиреЛрдбреНрд╕ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рддрд╛рд░реНрдХрд┐рдХ рдиреЛрдб</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logic</span></span></span><span class="hljs-class"> {</span></span> AND, OR }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;Logic Operator&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogicNode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractMatcher { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: LogicNode(MatcherPtr &amp;left, MatcherPtr &amp;right) : m_left(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(left)) , m_right(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(right)) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Operator) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Logic::AND: m_evaluator = &amp;LogicNode::And; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Logic::OR: m_evaluator = &amp;LogicNode::Or; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> final </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::invoke(m_evaluator, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, object); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: MatcherPtr m_left; MatcherPtr m_right; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EvaluateType = <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(LogicNode::*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json &amp;); EvaluateType m_evaluator = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">And</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_left-&gt;evaluate(object) &amp;&amp; m_right-&gt;evaluate(object); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_left-&gt;evaluate(object) || m_right-&gt;evaluate(object); } };</code> </pre> </div></div><br><p>  рдФрд░ рдЕрдВрдд рдореЗрдВ, рдиреАрдЪреЗ рдиреЛрдб </p><br><div class="spoiler">  <b class="spoiler_title">рдорд╛рди рддреБрд▓рдирд╛</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectNode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractMatcher { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ObjectNode(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> field, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ValueType &amp;value, boost::optional&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; &amp;unary, Operator oper) : m_field(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(field)) , m_json_value(boost::apply_visitor(ValueGetter(), value)) , m_reject(unary.has_value()) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (oper) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::EQ: m_evaluator = &amp;ObjectNode::Equal; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::LT: m_evaluator = &amp;ObjectNode::LesserThan; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::GT: m_evaluator = &amp;ObjectNode::GreaterThan; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::CP: m_evaluator = &amp;ObjectNode::Substr; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> final </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;value = object.at(m_field); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::invoke(m_evaluator, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_reject ? !result : result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EvaluateType = <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(ObjectNode::*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json &amp;); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> m_field; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json m_json_value; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> m_reject; EvaluateType m_evaluator = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json == m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LesserThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json &lt; m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json &gt; m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Substr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Str(json).find(Str(m_json_value)) != <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::npos; } };</code> </pre> </div></div><br><p>  рдпрд╣ рдХреЗрд╡рд▓ рдЗрд╕реЗ рдПрдХ рд╕рд╛рде рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реА рд░рд╣рддрд╛ рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рдЬреИрд╕рди рдлрд┐рд▓реНрдЯрд░</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonFilterGrammar</span></span></span><span class="hljs-class"> :</span></span> qi::grammar&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator, MatcherPtr()&gt; { JsonFilterGrammar() : JsonFilterGrammar::base_type(expression) { skipper = +qi::lit(<span class="hljs-string"><span class="hljs-string">' '</span></span>); unary = qi::no_case[<span class="hljs-string"><span class="hljs-string">"NOT"</span></span>]; compare.add (<span class="hljs-string"><span class="hljs-string">"eq"</span></span>, Operator::EQ) (<span class="hljs-string"><span class="hljs-string">"lt"</span></span>, Operator::LT) (<span class="hljs-string"><span class="hljs-string">"gt"</span></span>, Operator::GT) (<span class="hljs-string"><span class="hljs-string">"cp"</span></span>, Operator::CP); expression = (product &gt;&gt; skipper &gt;&gt; qi::no_case[<span class="hljs-string"><span class="hljs-string">"OR"</span></span>] &gt;&gt; skipper &gt;&gt; expression) [qi::_val = make_shared_&lt;LogicNode&lt;Logic::OR&gt;&gt;()(qi::_1, qi::_2)] | product[qi::_val = qi::_1]; product = (term &gt;&gt; skipper &gt;&gt; qi::no_case[<span class="hljs-string"><span class="hljs-string">"AND"</span></span>] &gt;&gt; skipper &gt;&gt; product) [qi::_val = make_shared_&lt;LogicNode&lt;Logic::AND&gt;&gt;()(qi::_1, qi::_2)]| term[qi::_val = qi::_1]; term = group[qi::_val = qi::_1] | (field &gt;&gt; -(skipper &gt;&gt; unary)&gt;&gt; skipper &gt;&gt; qi::no_case[compare] &gt;&gt; skipper &gt;&gt; value) [qi::_val = make_shared_&lt;ObjectNode&gt;()(qi::_1, qi::_4, qi::_2, qi::_3)]; field = qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_"</span></span>) &gt;&gt; *qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_0-9"</span></span>); value = qi::double_ | qi::int_ | qi::bool_ | <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>) &gt;&gt; +qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z0-9_. \u20BDтВм$┬е-"</span></span>) &gt;&gt; qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>); group %= <span class="hljs-string"><span class="hljs-string">'('</span></span> &gt;&gt; expression &gt;&gt; <span class="hljs-string"><span class="hljs-string">')'</span></span>; } qi::rule&lt;Iterator&gt; skipper; qi::rule&lt;Iterator, MatcherPtr()&gt; product, term, expression, group; qi::rule&lt;Iterator, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>()&gt; field, unary, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; qi::rule&lt;Iterator, ValueType()&gt; value; qi::symbols&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>, Operator&gt; compare; <span class="hljs-comment"><span class="hljs-comment">//      enum };</span></span></code> </pre> </div></div><br><p>  рд╡рд╣ рд╕рдм рд╣реИред  рдЕрдм рд╕рдорд╛рдкреНрдд рдлрд┐рд▓реНрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдХрд╛рдлреА рд╕рд░рд▓ рдСрдкрд░реЗрд╢рди рдмрди рдЧрдпрд╛ рд╣реИ: </p><br><pre> <code class="cpp hljs">MatcherPtr matcher; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filter = <span class="hljs-string"><span class="hljs-string">"int not LT 15"</span></span>; JsonFilterGrammar grammar; qi::parse(filter.begin(), filter.end(), grammar, matcher); <span class="hljs-comment"><span class="hljs-comment">//     matcher   .</span></span></code> </pre> <br><p>  рдореИрдВ рд╡реНрдпрд╛рдХрд░рдг рдХреЛ рдПрдХ рдлрд╝рдирдХрд╛рд░ рдореЗрдВ рд▓рдкреЗрдЯрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЫреЛрдбрд╝ рджреВрдВрдЧрд╛ (рдореБрдЭреЗ рдирд╣реАрдВ рд▓рдЧрддрд╛ рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛)ред  рд╣рдо рд╕рд░рд▓рддрдо рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреЗрд╣рддрд░ рддрд░реАрдХреЗ рд╕реЗ рдЯреВрд▓ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filter = <span class="hljs-string"><span class="hljs-string">"int not LT 15"</span></span>; Json json{ {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}} }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; json.dump() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; json.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove_if(json.begin(), json.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::not_fn(JsonFilter{filter})), json.end()); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; json.dump() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre> <br><p>  рдпрд╣рд╛рдБ рдЙрддреНрдкрд╛рджрди рд╣реИ: </p><br><pre> <code class="bash hljs">[{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:10},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:11},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:20},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:30},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:9}] [{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:20},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:30}]</code> </pre> <br><p>  рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ, рдкреНрд░рд┐рдп рдкрд╛рдардХреЛрдВ, рдЖрдк рдЖрддреНрдорд╛ рдХреЗ рдореВрд▓ рддрддреНрд╡ рдХреЛ рдЬрд╛рдирдиреЗ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдореБрдЭреЗ рднреА рдЬрд╛рдирдиреЗ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рдереЗред  рддрдм рдореИрдВ рд░рд╣рддрд╛ рд╣реВрдВред  рдЬрд▓реНрдж рдорд┐рд▓рддреЗ рд╣реИрдВред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi472004/">https://habr.com/ru/post/hi472004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi471992/index.html">рдЦреВрдВрдЯреА рдХреА рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛</a></li>
<li><a href="../hi471994/index.html">рдХреЛрд░ рдбреЗрд╡рд▓рдкрд░ рд╕реНрдкреНрд░рд┐рдВрдЯ рдкрд░ рдЦреВрдВрдЯреА рдкрд░ рдХрд╛рдо рдХрд░реЗрдВ</a></li>
<li><a href="../hi471998/index.html">рдПрдл # 10: рд╕реВрдЪреА</a></li>
<li><a href="../hi472000/index.html">"рд╕рдореБрджрд╛рдп рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ": рдХреЛрдЪрд▓рд┐рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдорд╛рд░реНрдЪрд┐рди рдореЛрд╕реНрдХрд▓рд╛</a></li>
<li><a href="../hi472002/index.html">рдЧреНрд░реЗрдЬрд▓ рдореЗрдВ рдкреИрдХреЗрдЬ рд░реАрдкреИрдХрд┐рдВрдЧ</a></li>
<li><a href="../hi472006/index.html">рдкрд╣рд┐рдпреЛрдВ рдХреЛ рд╕реБрджреГрдврд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЙрдкрдпреЛрдЧреА рдХреНрдпреЛрдВ рд╣реИ</a></li>
<li><a href="../hi472012/index.html">рдЖрдзреЗ рдШрдВрдЯреЗ рдореЗрдВ рдХрд╛рдирдмрди</a></li>
<li><a href="../hi472014/index.html">Otusред рд╣рдорд╛рд░реА рдкрд╕рдВрджреАрджрд╛ рдЧрд▓рддрд┐рдпрд╛рдБ</a></li>
<li><a href="../hi472018/index.html">рдлреНрд▓рд╛рд╕реНрдХ-рдкреЛрд╢рди, рднрд╛рдЧ 0 рдкрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрдВрдЯреНрд░реЛрд▓ рд╕рд┐рд╕реНрдЯрдо: рдЖрдкрдХреА рдЬрд╝рд░реВрд░рдд рдХреА рд╣рд░ рдЪреАрдЬрд╝ рддреИрдпрд╛рд░ рдХрд░рдирд╛</a></li>
<li><a href="../hi472020/index.html">рд╢реАрд░реНрд╖ 10: рдкрд╡рд┐рддреНрд░рдЬреЗрдПрд╕ 2019 рдкрд╛рдЗрдЯрд░ рдХреА рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреА рд░рд┐рдкреЛрд░реНрдЯ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>