<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÅâÔ∏è üë©üèø‚Äçüîß üë®‚Äçüé® Zabbix - surveillance des voisins OSPF √† l'aide de pi√®ges SNMPv3, douleur et d√©sespoir üöß üë®‚Äçüë®‚Äçüë¶‚Äçüë¶ üî†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mandat 
 Il existe un r√©seau de centres de donn√©es g√©ographiquement dispers√©s avec une voiture VRF et une liste en constante √©volution de voisins OSPF...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix - surveillance des voisins OSPF √† l'aide de pi√®ges SNMPv3, douleur et d√©sespoir</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417813/"><h2>  Mandat </h2><br>  Il existe un r√©seau de centres de donn√©es g√©ographiquement dispers√©s avec une voiture VRF et une liste en constante √©volution de voisins OSPF.  Vous devez les suivre: <br><br><ol><li>  √âtat, faire l'alarme si l'√©tat voisin n'est pas PLEIN </li><li>  Quantit√©, c'est-√†-dire que si le voisin manque, vous devez √©galement faire une alarme </li></ol><br>  Un syst√®me de surveillance existe d√©j√† - Zabbix 3.4, il est souhaitable de l'utiliser, Linux OS Debian 9.x <br><a name="habracut"></a><br><h2>  Nous essayons en un clin d'≈ìil </h2><br>  Le protocole est r√©pandu, le syst√®me de surveillance est connu, je ne suis probablement pas le premier √† vouloir r√©soudre ce probl√®me, et il a probablement d√©j√† √©t√© r√©solu. <br><br>  Nous entrons dans la recherche de ¬´zabbix ospf¬ª et le premier lien m√®ne au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le</a> .  Le bonheur est quoi - maintenant je l'importe, le peigne selon mes besoins et tout sera OK. <br>  Nous v√©rifions comment cela fonctionne - tout semble aller bien, les √©tats sont surveill√©s, mais lorsque le voisin passe √† l'√©tat BAS, nous recevons un message ¬´tr√®s¬ª informatif de Zabbix <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">No</span></span> Such Instance currently <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> at this <span class="hljs-type"><span class="hljs-type">OID</span></span></code> </pre> <br>  et info <br><br><pre> <code class="hljs pgsql">The item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> discovered anymore <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> will be deleted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span>d <span class="hljs-number"><span class="hljs-number">23</span></span>h <span class="hljs-number"><span class="hljs-number">57</span></span>m (<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-19</span></span> at <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>)</code> </pre> <br>  Ce qui s'est pass√© - le probl√®me est ancien et connu dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.opennet.ru/openforum/vsluhforumID3/109102.html)%2520%255B%25D0%25B4%25D0%25B2%25D0%25B0%255D(">forums</a> - lorsque le voisin OSPF dispara√Æt, alors tous les OID qui lui sont associ√©s sont simplement supprim√©s sur le mat√©riel r√©seau. <br><br>  Oui, il existe une solution - cr√©ez un d√©clencheur nodata, ok cr√©ez: <br><br><pre> <code class="hljs objectivec">{Template - SNMPv3 - OSPF Discovery:ospfNbrState[{<span class="hljs-meta"><span class="hljs-meta">#SNMPVALUE}].nodata(120)}=0</span></span></code> </pre> <br>  On voit dans le tableau de bord: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">missing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">data</span></span></code> </pre> <br>  Fondamentalement ... utilisable <br><br>  Mais pr√™t √† l'emploi, le LLD ne d√©tecte que les voisins du VRF par d√©faut.  Bien s√ªr, cela peut √™tre r√©solu en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contexte SNMP</a> , mais d'une mani√®re ou d'une autre, je ne voulais pas du tout - nous avons d√ª parcourir toutes les pi√®ces de fer, injecter un contexte dans chaque processus OSPF ou VRF, puis faire des copies de Discovery pour chaque contexte dans notre mod√®le, en g√©n√©ral c'est un peu beaucoup et en ajoutant de nouveaux processus OSPF, vous devez changer quelque chose √† plusieurs endroits.  Bien s√ªr, vous pouvez √™tre entour√© de scripts et tout cela peut √™tre modifi√© via l'API Zabbix, mais je ne voulais pas de personnalisation sp√©ciale, mais je voulais utiliser uniquement les fonctionnalit√©s int√©gr√©es √† Zabbix.  Il y a une mention d'un certain CISCO-CONTEXT-MAPPING-MIB, √† partir duquel vous pouvez extraire toute la correspondance entre les contextes et OSPF / VRF, mais je n'ai pas compris comment attacher cette conception au LLD.  Si quelqu'un sait comment cuisiner Zabbix si cool, alors bienvenue dans les commentaires, et de pr√©f√©rence dans un article s√©par√© √† part enti√®re. <br><br><h2>  Nous essayons de la deuxi√®me attaque </h2><br>  Apr√®s quelques heures de recherche sur Internet des indices dans les forums et les bacs de m√©moire, un sujet est apparu sur SNMP TRAP - c'est √† ce moment-l√† que nous n'interrogons pas le morceau de fer, mais le morceau de fer envoie des informations sur le changement de quelque chose.  Oui, et le support de campagne pour ce genre de choses est dans notre syst√®me de surveillance pr√™t √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">emploi</a> , l'√©quipement peut √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">imm√©diatement</a> et juste pour mon cas. <br><br>  D√®s les premi√®res lignes, la documentation de suivi a √©t√© confondue par une longue liste: <br><br><pre> <code class="hljs pgsql">The workflow <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> receiving a trap: <span class="hljs-number"><span class="hljs-number">1.</span></span> snmptrapd receives a trap <span class="hljs-number"><span class="hljs-number">2.</span></span> snmptrapd passes the trap <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> SNMPTT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> calls Perl trap receiver <span class="hljs-number"><span class="hljs-number">3.</span></span> SNMPTT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Perl trap receiver parses, formats <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> writes the trap <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a file <span class="hljs-number"><span class="hljs-number">4.</span></span> Zabbix SNMP trapper reads <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> parses the trap file <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> trap Zabbix finds <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> ‚ÄúSNMP trapper‚Äù items <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> host interfaces matching the received trap address. Note that <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> the selected ‚ÄúIP‚Äù <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ‚ÄúDNS‚Äù <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> host interface <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> used during the matching. <span class="hljs-number"><span class="hljs-number">6.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> item, the trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> compared <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> regexp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ‚Äúsnmptrap[regexp]‚Äù. The trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> matched items. <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> matching item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an ‚Äúsnmptrap.fallback‚Äù item, the trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> that. <span class="hljs-number"><span class="hljs-number">7.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the trap was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> item, Zabbix <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> logs the unmatched trap. (This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> configured <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ‚Äú<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> unmatched SNMP traps‚Äù <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Administration ‚Üí General ‚Üí Other.)</code> </pre> <br>  Autrement dit, un d√©mon accepte TRAP, le transmet √† un autre d√©mon, il l'analyse, le place dans le journal au format souhait√©, et le zabix lit d√©j√† le journal et d√©cide quoi faire ensuite.  D'une certaine mani√®re, cela ne semble d√©j√† jamais plus facile que de marcher avec les mains et de dessiner un contexte SNMP partout, mais bon, essayons.  Nous lisons attentivement le document de surveillance et comprenons que ce n'est qu'avec son aide que rien ne peut √™tre configur√©, en g√©n√©ral Zabbix a une telle blague - la documentation d√©crit les capacit√©s et les nuances du syst√®me de mani√®re si minimale qu'il est plus d√©routant qu'enseign√©.  Bien qu'ils puissent √™tre compris - le logiciel est gratuit, mais vous devez en quelque sorte gagner de l'argent, mais ils gagnent de l'argent sur le support.  Il y a des articles sur Internet avec une description de la fa√ßon de configurer cela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une ou</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux fois</a> , mais je n'ai pas r√©ussi √† configurer d'un article √† l'autre, j'ai d√ª collecter des informations de diff√©rentes sources petit √† petit.  Ce sont toutes les paroles, ils ont conduit pour faire du hardcore. <br><br><h2>  Nous configurons un morceau de fer en r√©seau </h2><br>  Avant de tordre quelque chose sur l'h√¥te avec la surveillance, je vous recommande fortement de configurer d'abord le mat√©riel r√©seau et de vous assurer que TRAP arrive vraiment du mat√©riel au serveur - au d√©but, je n'ai pas v√©rifi√© qu'il buvait beaucoup de nerfs, de sang et de temps.  J'ai une voiture Cisco Nexus sous la main, je vais donc vous donner des exemples pour cette s√©rie.  Quiconque a Catalyst, ASR, ASA et ainsi de suite - d√©sol√©, je ne suis pas le soleil, je ne chaufferai pas tout le monde, lisez les quais sur la fa√ßon de le configurer vous-m√™me, la syntaxe sera similaire, mais avec ses propres nuances. <br><br><pre> <code class="hljs pgsql">snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> contact noc@example.com snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> Room1 snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> source-interface traps loopback1</code> </pre> <br>  Il est important √† l'avenir, lors de la configuration de TRAP dans Zabbix, que l'adresse √† partir de laquelle TRAP est envoy√©e soit √©gale √† l'adresse SNMP de l'interface dans les param√®tres de l'h√¥te dans Zabbix. <br><br><pre> <code class="hljs cs">snmp-server user Zabbix network-<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> auth sha <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> priv aes<span class="hljs-number"><span class="hljs-number">-128</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span></code> </pre> <br>  Utilisez la version 3 du protocole autant que possible, en mode authPriv (cryptage et authentification), ce n'est pas aussi difficile √† configurer qu'il n'y para√Æt.  Oubliez la version 1 et la version 2 du protocole - lorsqu'une personne inattendue arrive en raison du manque de chiffrement et essentiellement d'authentification dans ces versions de protocole - ce n'est qu'une question de temps (la cha√Æne communautaire est transmise sous forme claire, d'ailleurs, je vois r√©guli√®rement qu'elle est configur√©e public / priv√©).  Le param√®tre op√©rateur de r√©seau vous permet d'accorder √† l'utilisateur des autorisations en lecture seule. <br><br><pre> <code class="hljs sql">snmp-server host 192.168.192.168 traps version 3 priv Zabbix snmp-server host 192.168.192.168 <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>-vrf <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> host <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.192</span></span><span class="hljs-number"><span class="hljs-number">.168</span></span> <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> loopback1 <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps ospf lsa snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps ospf <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_mib_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_power_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_inserted <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_removed <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_unrecognised_module <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_fan_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_power_out_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> linkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> linkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extended</span></span>-linkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extended</span></span>-linkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> cieLinkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> cieLinkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> connUnitPortStatusChange <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps bfd <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>-up <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delayed</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">link</span></span>-state-<span class="hljs-keyword"><span class="hljs-keyword">change</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps bfd <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>-down <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rf redundancy_framework <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-license-expiry <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-license-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-feature <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-licensefile-<span class="hljs-keyword"><span class="hljs-keyword">missing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-license-expiry-<span class="hljs-keyword"><span class="hljs-keyword">warning</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> UpgradeOpNotifyOnCompletion <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> UpgradeJobStatusNotify <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon risingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon fallingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon hcRisingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon hcFallingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_sensor <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps generic coldStart <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps generic warmStart</code> </pre> <br>  J'ai sp√©cifiquement d√©sactiv√© tous les TRAP sauf OSPF, de sorte que lors du diagnostic de la raison pour laquelle quelque chose ne fonctionne pas, je n'ai pas eu √† lire beaucoup d'informations inutiles du d√©bogage. <br><br>  Comment v√©rifier si TRAP fonctionne est tr√®s simple - vous devez casser quelque chose.  Nous d√©marrons le renifleur sur l'h√¥te avec surveillance: <br><br><pre> <code class="hljs pgsql">root@dc-zbx:~# tcpdump -i bond0 udp port <span class="hljs-number"><span class="hljs-number">162</span></span> tcpdump: <span class="hljs-keyword"><span class="hljs-keyword">verbose</span></span> output suppressed, use -v <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> -vv <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">full</span></span> protocol decode listening <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> bond0, link-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> EN10MB (Ethernet), capture size <span class="hljs-number"><span class="hljs-number">262144</span></span> bytes</code> </pre> <br>  On retrouve sur un morceau de fer des voisins vivants: <br><br><pre> <code class="hljs pgsql">SW# <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip ospf neighbors vrf <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> OSPF Process ID <span class="hljs-number"><span class="hljs-number">10</span></span> VRF <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">4</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.242</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> Vlan1427 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.222</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>w1d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span> Vlan1426 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">5</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.30</span></span> Vlan1473 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.146</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">3</span></span>d00h <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.58</span></span> Vlan1404 OSPF Process ID <span class="hljs-number"><span class="hljs-number">100</span></span> VRF OSPF100 Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">4</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">5</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.34</span></span> Vlan1474 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">13</span></span>w3d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.54</span></span> Vlan1479 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.240</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">13</span></span>w3d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.46</span></span> Vlan1477 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.146</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">3</span></span>d00h <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.62</span></span> Vlan1405 OSPF Process ID <span class="hljs-number"><span class="hljs-number">200</span></span> VRF Dia Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">10.65</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">17</span></span>w2d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.18</span></span> Vlan1450 <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.26</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">17</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.26</span></span> Vlan1452 OSPF Process ID <span class="hljs-number"><span class="hljs-number">216</span></span> VRF Dev Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">10.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.94</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.73</span></span> Vlan1641 <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.82</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.82</span></span> Vlan1643</code> </pre><br>  Et laisse tomber quelqu'un <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vlan</span></span></span><span class="hljs-class"> 1643 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shutdown</span></span></span></span></code> </pre> <br>  On voit dans le renifleur: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">20.001942</span></span> IP <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.169</span></span>.<span class="hljs-number"><span class="hljs-number">22095</span></span> &gt; dc<span class="hljs-literal"><span class="hljs-literal">-zbx</span></span>.example.com.snmp<span class="hljs-literal"><span class="hljs-literal">-trap</span></span>: F=ap U=<span class="hljs-string"><span class="hljs-string">"Zabbix"</span></span> [!<span class="hljs-type"><span class="hljs-type">scoped</span></span> <span class="hljs-type"><span class="hljs-type">PDU</span></span>]<span class="hljs-number"><span class="hljs-number">39</span></span>_d1_7c_19_b3_d9_f8_31_32_8e_c9_39_c2_3a_db_d8_28_26_c6_0b_01_55_b6_fa_5e_f5_38_66_f9_6f_3f_c0_98_cb_57_93_5a_50_8e_50_90_79_f3_9b_ec_ec_d7_9f_e8_ac_f6_fd_79_ac_95_ff_71_73_32_70_52_66_a5_7d_b3_c4_39_d0_1c_7f_a6_38_ea_d7_61_c0_2f_12_ee_db_d9_07_40_8c_a8_48_57_e9_e5_56_12_3f_ec_f9_34_65_09_96_86_f6_d2_93_06_45_fa_95_ea_36_5a_82_2f_30_8f_02_03_59_07_5f_d8_a6_1c_f2_5a_be_7d_09_15_ef_05_00_83_fd_ea_ac_2a_3b_86_0f_86_e5_3b_93_3a_68_6d_33_99_e2_46_2b_9d_6a_1e_5d_9e_d9_93_56_51_5e_ff_9e_77_4c_cb</code> </pre> <br>  Si vous n'avez rien vu dans le renifleur, diagnostiquez-le, car sinon il n'y a aucune raison de continuer, vous ne comprendrez simplement pas √† quel stade quelque chose ne fonctionne pas pour vous. <br>  S'il n'y a aucun morceau de fer √† port√©e de main ou si la production ne peut pas √™tre touch√©e, alors TRAP peut √™tre g√©n√©r√© √† partir de n'importe quelle autre voiture, par exemple, comme ceci: <br><br><pre> <code class="hljs powershell">snmptrap <span class="hljs-literal"><span class="hljs-literal">-v</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> neveruseme <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-string"><span class="hljs-string">'.1.3.6.1.6.3.1.1.5.3'</span></span> <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-string"><span class="hljs-string">'55'</span></span> .<span class="hljs-number"><span class="hljs-number">1.3</span></span>.<span class="hljs-number"><span class="hljs-number">6.1</span></span>.<span class="hljs-number"><span class="hljs-number">6.3</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span>.<span class="hljs-number"><span class="hljs-number">5.3</span></span> s <span class="hljs-string"><span class="hljs-string">"teststring000"</span></span> snmptrap <span class="hljs-literal"><span class="hljs-literal">-v3</span></span> <span class="hljs-literal"><span class="hljs-literal">-l</span></span> authPriv <span class="hljs-literal"><span class="hljs-literal">-u</span></span> Zabbix <span class="hljs-literal"><span class="hljs-literal">-a</span></span> SHA <span class="hljs-literal"><span class="hljs-literal">-A</span></span> abyrvalg <span class="hljs-literal"><span class="hljs-literal">-x</span></span> AES <span class="hljs-literal"><span class="hljs-literal">-X</span></span> pechka <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x8000000001020305 <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.168</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> linkUp.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><h2>  Configurer SNMPd, SNMPTRAPd, SNMPTT </h2><br>  Nous aurons besoin de packages dans le syst√®me: <br><br><pre> <code class="hljs powershell">apt install snmp snmp<span class="hljs-literal"><span class="hljs-literal">-mibs</span></span><span class="hljs-literal"><span class="hljs-literal">-downloader</span></span> snmpd snmptrapd snmptt</code> </pre> <br>  Je ne me suis pas concentr√© sur le r√©cepteur de pi√®ge Perl, mais j'ai choisi SNMPTT pour des raisons personnelles et subjectives.  Ainsi, le dock dit: <br><br><pre> <code class="hljs markdown"><span class="hljs-bullet"><span class="hljs-bullet">1. </span></span>snmptrapd receives a trap</code> </pre> <br>  Il faut commencer par sa configuration, et ne pas grimper imm√©diatement pour cr√©er Item dans la face Zabbix.  Pourquoi? Vous devez gravir les m√™mes marches que celles utilis√©es pour TRAP.  Dans la section pr√©c√©dente, nous nous sommes assur√©s que TRAP arrive essentiellement √† partir d'un morceau de fer, nous allons maintenant nous assurer qu'il est au moins accept√© par le premier d√©mon - snmptrapd.  &lt;lyric&gt; Je me souviens d'avoir install√© postfix + pigeonnier + quelque chose d'autre il y a longtemps.  Et j'ai boud√© pendant deux semaines - l√† aussi, un d√©mon accepte la connexion, l'autre analyse la lettre, le troisi√®me la met dans la file d'attente, le quatri√®me dans le dossier de l'utilisateur, et ainsi de suite, et je n'ai pas r√©ussi.  Et tout cela parce que je me suis connect√© depuis le milieu, depuis la fin, depuis le d√©but, mais j'ai d√ª commencer avec telnet sur le port 25 et afficher le d√©bogueur du foxer &lt;/ lyric&gt; <br><br>  Nous montons dans /etc/snmp/snmptrapd.conf et le supprimons, mais plut√¥t nous commentons tout ce que nous ne comprenons pas et ne sommes pas int√©ress√©s, nous laissons une ligne <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">disableAuthorization</span></span> <span class="hljs-literal"><span class="hljs-literal">yes</span></span></code> </pre> <br>  Arr√™tez le service <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> snmptrapd.service</code> </pre> <br>  Ex√©cuter en mode manuel <br><br><pre> <code class="hljs pgsql">root@dc-zbx:~# snmptrapd -f -Lo NET-SNMP <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">5.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> AgentX subagent connected NET-SNMP <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">5.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br>  Encore une fois, essayez de casser OSPF comme dans l'exemple ci-dessus et voyez: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-literal"><span class="hljs-literal">-07</span></span><span class="hljs-literal"><span class="hljs-literal">-20</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span> UNKNOWN [<span class="hljs-type"><span class="hljs-type">UDP</span></span>: [<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-type"><span class="hljs-type">.192.169</span></span>]:<span class="hljs-number"><span class="hljs-number">22095</span></span>-&gt;[<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-type"><span class="hljs-type">.192.168</span></span>]:<span class="hljs-number"><span class="hljs-number">162</span></span>]: DISMAN<span class="hljs-literal"><span class="hljs-literal">-EVENT</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::sysUpTimeInstance = Timeticks: (<span class="hljs-number"><span class="hljs-number">1355817272</span></span>) <span class="hljs-number"><span class="hljs-number">156</span></span> days, <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">32.72</span></span> SNMPv2<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::snmpTrapOID.<span class="hljs-number"><span class="hljs-number">0</span></span> = OID: OSPF<span class="hljs-literal"><span class="hljs-literal">-TRAP</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrStateChange OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfRouterId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.74</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrIpAddr = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrAddressLessIndex = INTEGER: <span class="hljs-number"><span class="hljs-number">0</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrRtrId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrState = INTEGER: down(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Si nous ne voyons pas, alors nous cherchons la raison.  Si vous voulez avoir les m√™mes beaux enregistrements, et non un ensemble d'OID de la forme 1.3.6.1.2.1.14.10.1.6, ajoutez ce qui suit √† /etc/snmp/snmp.conf: <br><br><pre> <code class="hljs powershell">mibs +OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibs +OSPF<span class="hljs-literal"><span class="hljs-literal">-TRAP</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibs +OSPFV3<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibdirs +/usr/share/snmp/mibs/ietf/</code> </pre><br>  Et d√©former SNMPd <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> snmpd.service</code> </pre> <br>  Plus en d√©tail comment t√©l√©charger les fichiers MIB avec le moins de douleur et les alimenter sur votre SNMPd peut √™tre lu [ici] (https://wiki.debian.org/SNMP). <br><br>  Maintenant, nous attachons l'authentification, nous montons √† nouveau dans /etc/snmp/snmptrapd.conf <br><br><pre> <code class="hljs vbscript">traphandle <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> snmptthandler #disableAuthorization yes # <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.192</span></span><span class="hljs-number"><span class="hljs-number">.169</span></span> createUser -e <span class="hljs-number"><span class="hljs-number">0x80000009038d604a6a82a3</span></span> Zabbix SHA <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> AES authuser <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>,net Zabbix</code> </pre> <br>  -e 0x80000009038d604a6a82a3 est l'ID du moteur, il peut √™tre affich√© sur le mat√©riel r√©seau: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SW</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">engineID</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SNMP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">engineID</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Hex]</span></span> 80000009038<span class="hljs-selector-tag"><span class="hljs-selector-tag">F604D6A82A1</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Dec]</span></span> 128<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:040</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:000</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:109</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:003</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:096</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:079</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:106</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:160</span></span></code> </pre> <br>  Nous r√©p√©tons √† nouveau l'exp√©rience, mais maintenant nous continuons √† attraper un d√©bogage sur USM: <br><br><pre> <code class="hljs rust">root@dc-zbx:~# snmptrapd -f -Lo -Dusm registered debug token usm, <span class="hljs-number"><span class="hljs-number">1</span></span> usmUser: created a new user Zabbix at <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 NET-SNMP version <span class="hljs-number"><span class="hljs-number">5.7</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> AgentX subagent connected NET-SNMP version <span class="hljs-number"><span class="hljs-number">5.7</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> usm: USM processing begun... usm: <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on user Zabbix usm: no <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on engineID (<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 ) usm: <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on user Zabbix usm: Verification succeeded. usm: USM processing completed. <span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> UNKNOWN [UDP: [<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.169</span></span>]:<span class="hljs-number"><span class="hljs-number">22095</span></span>-&gt;[<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.168</span></span>]:<span class="hljs-number"><span class="hljs-number">162</span></span>]: DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (<span class="hljs-number"><span class="hljs-number">1355886163</span></span>) <span class="hljs-number"><span class="hljs-number">156</span></span> days, <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">01.63</span></span> SNMPv2-MIB::snmpTrapOID.<span class="hljs-number"><span class="hljs-number">0</span></span> = OID: OSPF-TRAP-MIB::ospfNbrStateChange OSPF-MIB::ospfRouterId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.74</span></span> OSPF-MIB::ospfNbrIpAddr = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF-MIB::ospfNbrAddressLessIndex = INTEGER: <span class="hljs-number"><span class="hljs-number">0</span></span> OSPF-MIB::ospfNbrRtrId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF-MIB::ospfNbrState = INTEGER: down(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Si √† ce stade vous voyez des erreurs d'autorisation dans le d√©bogage, v√©rifiez soigneusement l'ID moteur et que les utilisateurs cr√©√©s sur le mat√©riel correspondent √† ceux que nous avons dessin√©s dans la configuration /etc/snmp/snmptrapd.conf.  Soit dit en passant, oui, pour chaque morceau de fer, vous devrez cr√©er votre propre utilisateur avec son ID moteur, ou le faire de la m√™me mani√®re sur tous les morceaux de fer avec les mains, si les morceaux de fer le permettent. <br><br>  Je peux voir la ligne dans le d√©bogage: <br><br><pre> <code class="hljs pgsql">usm: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> match <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> engineID (<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 )</code> </pre> <br>  Pourquoi n'ai-je pas compris, bien qu'avec tout cela, TRAP soit accept√© et obtienne un traitement ult√©rieur.  Si vous savez ce que j'ai fait de mal, veuillez commenter. <br><br>  Maintenant, nous prenons SNMPTT - il a deux config ini et conf.  Dans le premier, nous d√©terminons les param√®tres du d√©mon lui-m√™me, dans le second, nous d√©terminons les param√®tres de r√©ception et de traitement de chaque √©chelle sp√©cifique. <br><br>  Nous montons dans le fichier /etc/snmp/snmptt.ini et dessinons les choses suivantes: <br><br><pre> <code class="hljs perl">mode = daemon net_snmp_perl_enable = <span class="hljs-number"><span class="hljs-number">1</span></span> date_time_format = %Y %m %d %H:%M:%S</code> </pre> <br>  Le format de la date et de l'heure est une question commerciale, surtout utilisez-le partout. <br><br><pre> <code class="hljs pgsql">log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmptt.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> log_system_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmpttsystem.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> unknown_trap_log_enable = <span class="hljs-number"><span class="hljs-number">1</span></span> unknown_trap_log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmpttunknown.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre> <br>  Pourquoi le journal n'est-il pas le m√™me que dans de nombreux articles sur Internet?  Parce que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dock a</a> dit: "Si le param√®tre systemd PrivateTmp est utilis√©, ce fichier ne fonctionnera probablement pas dans / tmp.", Je ne veux pas entrer de nouveau dans le r√¢teau s'il est averti √† l'avance, donc je vais imm√©diatement changer pour le chemin normal du fichier. <br><br>  Ensuite, allez dans /etc/snmp/snmptt.conf, supprimez tout ce dont nous n'avons pas besoin et / ou ne comprenons pas, nous ne laissons que ceci: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EVENT</span></span> ospfNbrStateChange .<span class="hljs-number"><span class="hljs-number">1.3.6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1.14.16</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"OSPF"</span></span> Normal FORMAT ZBXTRAP <span class="hljs-variable"><span class="hljs-variable">$aA</span></span> OSPF neighbor with IP addr <span class="hljs-variable"><span class="hljs-variable">$2</span></span> changed state to <span class="hljs-variable"><span class="hljs-variable">$5</span></span></code> </pre> <br>  Sous cette forme, car Zabbix attendra exactement un tel format dans le journal.  D'o√π viennent 2 $ et 5 $, vous pouvez savoir si vous regardez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le format de message TRAP</a> , regardez: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrStateChange</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OID</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MIB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF-TRAP-MIB</span></span> ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Trap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Components</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfRouterId</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrIpAddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrAddressLessIndex</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrRtrId</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrState</span></span></code> </pre> <br>  Ces composants d'interruption sont les param√®tres qui peuvent √™tre ins√©r√©s dans le format de journal dans l'ordre de $ 1, $ 2 ... <br><br>  Pendant l'√©preuve de force avec toutes ces choses, j'ai remarqu√© qu'apr√®s avoir chang√© les param√®tres SNMPTT, c'est comme si les changements n'√©taient pas appliqu√©s.  Il s'est av√©r√© qu'apr√®s leur changement, il √©tait n√©cessaire de red√©marrer non pas snmptt.serivce, mais snmpd.service - cette nuance a d√©cemment bu mon sang et bu mes nerfs pendant le d√©bogage. <br><br>  V√©rifiez que tous les d√©mons sont en cours d'ex√©cution: <br><br><pre> <code class="hljs lua">systemctl <span class="hljs-built_in"><span class="hljs-built_in">status</span></span> snmpd snmptrapd snmptt</code> </pre> <br>  Si tout va bien, essayez √† nouveau de casser OSPF et acc√©dez au journal /var/log/snmptt/snmptt.log, il ressemblera √† ceci: <br><br><pre> <code class="hljs css">2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:52</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">down</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:28</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">full</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:22</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:41</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">down</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:38</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br>  Les TRAP que nous n'avons pas configur√©s dans la configuration /etc/snmp/snmptt.conf iront dans le journal /var/log/snmptt/snmpttunknown.log, mais uniquement √† partir du mat√©riel pour lequel l'utilisateur et l'ID moteur correct sont configur√©s dans la m√™me configuration.  C'est, √† partir de glandes gauche TRAP sera silencieusement √©limin√©s, si vous voulez Mata et d√©briefing, vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> - Station d' accueil extr√™mement IMPUT√âE pour net-snmp, il y a encore une bonne id√©e de d√©crire les diff√©rences entre les TRAP et INFORM, l' avenir, il est pr√©f√©rable d'utiliser INFORMER, t. k. il y a une sorte de contr√¥le de livraison l√†-bas, mais cela fonctionne via UDP sur UDP. <br><br>  Et seulement maintenant, nous montons pour configurer notre moniteur. <br><br><h2>  Configuration de Zabbix </h2><br><br>  Tout d'abord, assurez-vous que dans la configuration /etc/zabbix/zabbix_server.conf, la surveillance est d√©finie sur le bon journal SNMPTT et que Zabbix lui-m√™me d√©marre au moins un trappeur SNMP: <br><br> <code>SNMPTrapperFile=/var/log/snmptt/snmptt.log <br> StartSNMPTrapper=1</code> <br> <br>  Pour commencer, j'ai cr√©√© Item directement sur l'h√¥te, afin qu'il soit plus rapide et plus facile d'attraper des effets sp√©ciaux, ici j'√©crirai tout de suite comment cr√©er un mod√®le, car ce sont les mod√®les qui doivent √™tre utilis√©s chaque fois que possible.  Je vais vous montrer les photos, le cadeau de copier-coller est termin√©, mais je vais peindre les endroits auxquels vous devez faire attention. <br><br>  Cr√©ez un mod√®le: <br><br><img src="https://habrastorage.org/webt/h_/ne/mw/h_nemwwcsrjzr1dvlqimgrmsq5e.png" alt="image"><br><br>  Ici, nous donnons juste un nom sain <br><br>  Cr√©er un √©l√©ment <br><br><img src="https://habrastorage.org/webt/-c/hz/8k/-chz8klwqft17k391xp7epqusfs.png" alt="image"><br><br>  Important - la cl√© devrait √™tre comme √ßa, ce qui est indiqu√© entre crochets est ce que Zabbix recherchera dans le journal, nous avons configur√© le format du journal dans /etc/snmp/snmptt.conf et y avons √©crit: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EVENT</span></span> ospfNbrStateChange .<span class="hljs-number"><span class="hljs-number">1.3.6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1.14.16</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"OSPF"</span></span> Normal FORMAT ZBXTRAP <span class="hljs-variable"><span class="hljs-variable">$aA</span></span> OSPF neighbor with IP addr <span class="hljs-variable"><span class="hljs-variable">$2</span></span> changed state to <span class="hljs-variable"><span class="hljs-variable">$5</span></span></code> </pre> <br>  En fait dans le journal, c'est le mot magique "OSPF" et appara√Æt: <br><br><pre> <code class="hljs css">2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:38</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br>  Le format de date que nous avons d√©fini dans la configuration /etc/snmp/snmptt.ini: <br><br><pre> <code class="hljs perl">date_time_format = %Y %m %d %H:%M:%S</code> </pre> <br>  Ce que j'ai √©crit ci-dessus - utilisez n'importe quel format qui vous convient, l'essentiel est qu'il corresponde aux bons endroits. <br><br>  Cr√©er un d√©clencheur <br><br><img src="https://habrastorage.org/webt/7q/ci/b4/7qcib4j6sxnym61nykigci8gyac.png" alt="image"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un</a> voisin peut avoir plusieurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tats</a> : <br><br><pre> <code class="hljs swift"><span class="hljs-number"><span class="hljs-number">1</span></span> : down <span class="hljs-number"><span class="hljs-number">2</span></span> : attempt <span class="hljs-number"><span class="hljs-number">3</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> : twoWay <span class="hljs-number"><span class="hljs-number">5</span></span> : exchangeStart <span class="hljs-number"><span class="hljs-number">6</span></span> : exchange <span class="hljs-number"><span class="hljs-number">7</span></span> : loading <span class="hljs-number"><span class="hljs-number">8</span></span> : full</code> </pre> <br>  Peu importe le type d'√©tat dans lequel se trouve le voisin, si cet √©tat n'est pas PLEIN, car pour diagnostiquer cela, vous devez toujours aller sur le morceau de fer, lire les journaux, entrer certaines commandes.  Le d√©clencheur sera donc un et ne sera excit√© que lorsque dans TRAP l'√©tat du voisin n'est pas PLEIN. <br><br>  Avant de suspendre le mod√®le sur un h√¥te sp√©cifique, assurez-vous que l'h√¥te est configur√© avec la bonne interface SNMP avec la bonne adresse IP, sinon les √©chelles seront dans le journal /var/log/snmptt/snmptt.log, mais Zabbix ne les liera pas √† l'h√¥te.  Dans ce cas, dans le journal Zabbix du serveur /var/log/zabbix/zabbix_server.log, il y aura un message de la forme: <br><br><pre> <code class="hljs css">19972<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20180720</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:091722.896</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">unmatched</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">trap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">received</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> "192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span>": 2018 07 20 09<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:17</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:21</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.64</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br><br>  Allez √† Derni√®res donn√©es, voir <br><br><img src="https://habrastorage.org/webt/pu/gj/w9/pugjw9j9ccjdnkj6x50trsfqeoc.png" alt="image"><br><br>  Trigger a √©galement fonctionn√© <br><br><img src="https://habrastorage.org/webt/fm/wc/gp/fmwcgp5pjammodrcqjsrj3zpebe.png" alt="image"><br><br>  Maintenant, mettez deux voisins <br><br><img src="https://habrastorage.org/webt/7e/uh/d5/7euhd5pegn-7b_6ofpxmbctzt8c.png" alt="image"><br><br>  Dans le tableau de bord, nous voyons que deux probl√®mes se sont produits, c'est bien, et m√™me deux lettres arriveront sur ce sujet avec la notification configur√©e. <br><br>  Tout est super, tout fonctionne, et voici la cerise sur le g√¢teau √† la fin. <br><br><div class="spoiler">  <b class="spoiler_title">D√©sespoir</b> <div class="spoiler_text">  Maintenant, nous prenons et √©levons un voisin.  Dans le m√™me temps, les deux probl√®mes dispara√Ætront dans le tableau de bord.  Ce n'est pas un bug, c'est une fonctionnalit√©.  J'ai accidentellement remarqu√© une telle nuance lorsque j'ai test√© le mod√®le.  En cons√©quence, il s'av√®re que si plusieurs voisins tombent, puis l'un d'eux augmente, ou m√™me si un voisin augmente, ce qui n'existait pas auparavant, la surveillance deviendra verte. <br>  Bien s√ªr, vous pouvez configurer Item avec vos mains pour suivre un voisin sp√©cifique, vous pouvez toujours √©crire quelque chose, vous pouvez revenir aux contextes SNMP d√®s le d√©but de l'article.  Il y a toujours une id√©e pour dessiner un script qui passera par SSH / API pour les glandes de r√©seau, collectera des informations sur tous les voisins, fera un casting "fonctionnel", analysera les diff√©rences entre les v√©rifications et √©crit ce qui ne va pas dans le journal, puis le journal peut √™tre aliment√© sur le moniteur ... c'est difficile.  Je voulais un minimum de b√©quilles et de custom.  Si vous connaissez un moyen raisonnable de r√©soudre ce probl√®me ou pensez que j'ai tout mal fait, je le redemande dans les commentaires, mais plut√¥t dans l'article de r√©ponse. <br></div></div><br><br>  UPD: nos coll√®gues nous ont conseill√© de faire le tri et d'essayer de mettre en ≈ìuvre nos plans en utilisant des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contextes SNMP</a> .  Il y a une demande, il y aura une offre.  Pour l'avenir, je peux dire - le diable n'est pas si terrible, allons-y. <br>  Sur un morceau de fer en r√©seau, nous dessinons une commande magique: <br><br> <code>snmp-server context {snmp context name} instance {protocol instance} vrf {vrf name}</code> <br> <br>  Les noms des param√®tres doivent √™tre clarifi√©s <br>  {nom du contexte snmp} - le nom du contexte SNMP qui sera utilis√© dans les requ√™tes. <br>  {instance de protocole} et {nom vrf} nous prenons de la configuration du processus OSPF configur√©: <br><br> <code>router ospf {protocol instance} <br> .. <br> vrf {vrf name} <br> ..</code> <br> <br>  On craignait qu'apr√®s de tels param√®tres, nous cassions l'√©l√©ment d√©j√† configur√© via SNMP avec un contexte vide, mais j'ai v√©rifi√© que le param√®tre affecte uniquement la sortie des donn√©es via OSPF-MIB, tandis que, par exemple, √† partir de la section IF-MIB, tout continue d'√™tre renvoy√© comme auparavant avec un contexte vide.  Si vous n'avez pas Nexus, je vous recommande de v√©rifier √† nouveau ce point - il est probable que le comportement sera diff√©rent. <br><br>  Maintenant, tordez le mod√®le dans Zabbix. <br>  Vous devez cr√©er une nouvelle r√®gle de d√©couverte avec le contexte: <br><br><img src="https://habrastorage.org/webt/by/xd/ph/byxdpha64kwdstjxoipfjr3avl0.png" alt="image"><br><br>  Nouveau prototype d'article √©galement avec contexte <br><br><img src="https://habrastorage.org/webt/oy/e1/2x/oye12xxe-ec-ohifymjb-zizpom.png" alt="image"><br><br>  Et deux d√©clencheurs - le premier - pour l'alarme si le voisin est dans n'importe quel √©tat sauf FULL: <br><br><img src="https://habrastorage.org/webt/rj/gs/os/rjgsosmcwivhwhxjtnjheyymhza.png" alt="image"><br><br>  et le second - si le voisin manque: <br><br><img src="https://habrastorage.org/webt/sb/cx/i3/sbcxi3qrz-d-c82vyk_khmaw6im.png" alt="image"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417813/">https://habr.com/ru/post/fr417813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417795/index.html">Mon obsession des jeux vid√©o √† l'adolescence n'est pas un "trouble du jeu"</a></li>
<li><a href="../fr417797/index.html">4 raisons pour lesquelles les projets de la NASA d√©passent les d√©lais et gonflent le budget</a></li>
<li><a href="../fr417801/index.html">Comment j'ai d√©m√©nag√© en Isra√´l apr√®s avoir bloqu√© Telegram</a></li>
<li><a href="../fr417803/index.html">Traitement photo en lot dans Blender</a></li>
<li><a href="../fr417809/index.html">AI, cours pratique. Architectures modernes de r√©seaux de neurones profonds pour la classification d'images</a></li>
<li><a href="../fr417821/index.html">Network Digest: 20 documents d'experts sur les protocoles, les normes et la s√©curit√© de l'information</a></li>
<li><a href="../fr417823/index.html">Nouvelle g√©n√©ration: lancement du premier r√©seau commercial 5G au monde</a></li>
<li><a href="../fr417825/index.html">"Repousser les limites": la gamme 6 GHz sera donn√©e aux besoins du Wi-Fi</a></li>
<li><a href="../fr417827/index.html">Wi-Fi gratuit: un tribunal allemand abolit les peines impos√©es aux caf√©s pour violation des droits d'auteur des clients</a></li>
<li><a href="../fr417829/index.html">R√©duisez le nombre de couches d'architecture de 5 √† 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>