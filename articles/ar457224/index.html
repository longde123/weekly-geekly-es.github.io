<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ง ๐คณ๐ฟ ููุงุฑุจุฉ ุญุฏูุซุฉ ููููุงูุณุฉ ูู Android: Corotins at Kotlin ๐ฉโ๐ ๐๐ฟ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ูุง ูุจุฑ! 

 ูุฐูุฑู ุฃู ูุฏููุง ุจุงููุนู ุทูุจ ูุณุจู ูููุชุงุจ ุงูุฐู ุทุงู ุงูุชุธุงุฑู ุนู ูุบุฉ Kotlin ูู ุณูุณูุฉ Big Nerd Ranch Guides ุงูุดููุฑุฉ. ูุฑุฑูุง ุงูููู ุฃู ูููุช ุงูุชุจ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุงุฑุจุฉ ุญุฏูุซุฉ ููููุงูุณุฉ ูู Android: Corotins at Kotlin</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/457224/" style=";text-align:right;direction:rtl"> ูุฑุญุจุง ูุง ูุจุฑ! <br><br>  ูุฐูุฑู ุฃู ูุฏููุง ุจุงููุนู ุทูุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุณุจู ูููุชุงุจ ุงูุฐู ุทุงู ุงูุชุธุงุฑู</a> ุนู ูุบุฉ Kotlin ูู ุณูุณูุฉ Big Nerd Ranch Guides ุงูุดููุฑุฉ.  ูุฑุฑูุง ุงูููู ุฃู ูููุช ุงูุชุจุงููู ุฅูู ุชุฑุฌูุฉ ูููุงู ูุฎุจุฑูุง ุนู corotines Kotlin ูุนู ุงูุนูู ุงูุตุญูุญ ูุน ุชุฏููุงุช ูู Android.  ุชุชู ููุงูุดุฉ ุงูููุถูุน ุจูุดุงุท ูุจูุฑ ุ ูุจุงูุชุงูู ุ ููุชุฃูุฏ ูู ุงูุชูุงูู ุ ููุตู ุฃูุถูุง ุจุงูุงุทูุงุน ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐู ุงูููุงูุฉ</a> ูู Habr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฐู ุงููุดุงุฑูุฉ ุงูููุตูุฉ</a> ูู ูุฏููุฉ ุจุฑุงูุฌ Axmor. <br><a name="habracut"></a><br>  ูุนูู ุงูุฅุทุงุฑ ุงูุชูุงูุณู ุงูุญุฏูุซ ูู Java / Android ุนูู ุฅูุญุงู ุงูุฌุญูู ุจุงูุฑุฏูุฏ ููุคุฏู ุฅูู ุญุงูุงุช ุงูุญุธุฑ ุ ูุธุฑูุง ูุฃู Android ููุณ ูุฏูู ุทุฑููุฉ ุจุณูุทุฉ ุฅูู ุญุฏ ูุง ูุถูุงู ุฃูุงู ุณูุงุณู ุงูุฑุณุงุฆู. <br><br>  corotines Kotlin ูู ูุฌููุนุฉ ุฃุฏูุงุช ูุนุงูุฉ ููุงููุฉ ููุบุงูุฉ ููุง ูุฌุนู ุฅุฏุงุฑุฉ ุงูููุงูุณุฉ ุฃุณูู ุจูุซูุฑ ูุฃูุซุฑ ุฅูุชุงุฌูุฉ. <br><br>  <b>ูููุฉ ูุญุธุฑ: ูุง ูู ุงููุฑู</b> <br><br>  ูุง ูุญู Coroutines ูุญู ุงูุฎููุท ุ ููููู ูููุฑ ุฅุทุงุฑูุง ูุฅุฏุงุฑุชูุง.  ุชุชูุซู ููุณูุฉ corutin ูู ุชุญุฏูุฏ ุณูุงู ูุชูุญ ูู <b>ุงูุงูุชุธุงุฑ</b> ุญุชู ุชูุชูู ุนูููุงุช ุงูุฎูููุฉ ุฏูู ุญุธุฑ ุงูุฎูุท ุงูุฑุฆูุณู. <br><br>  ูุฏู Corutin ูู ูุฐู ุงูุญุงูุฉ ูู ุงูุงุณุชุบูุงุก ุนู ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช ูุชุจุณูุท ุงูููุงูุณุฉ. <br><br>  <b>ูุซุงู ุฃุจุณุท</b> <br><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฏุนูุง ูุฃุฎุฐ ุฃุจุณุท ูุซุงู: ุชุดุบูู coroutine ูู ุณูุงู <code>Main</code> (ุณูุณูุฉ ุฑุฆูุณูุฉ).  ูู ุฐูู ุ ุณูููู ุจุงุณุชุฎุฑุงุฌ ุงูุตูุฑุฉ ูู ุฏูู <code>IO</code> ูุฅุฑุณุงู ูุฐู ุงูุตูุฑุฉ ูููุนุงูุฌุฉ ูุฑุฉ ุฃุฎุฑู ุฅูู <code>Main</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs">launch(Dispatchers.Main) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> image = withContext(Dispatchers.IO) { getImage() } <span class="hljs-comment"><span class="hljs-comment">//    IO imageView.setImageBitmap(image) //     }</span></span></code> </pre> <br>  ุงูููุฏ ุจุณูุท ูุฏุงูุฉ ููุฑุฏุฉ ุงูุชุฑุงุจุท.  ุนูุงูุฉ ุนูู ุฐูู ุ ูู ุญูู ูุชู ุชูููุฐ <code>getImage</code> ูู ุงููุฌููุนุฉ ุงููุฎุตุตุฉ ูู ูุคุดุฑุงุช ุชุฑุงุจุท <code>IO</code> ุ ูุฅู ุงูุฎูุท ุงูุฑุฆูุณู ูุฌุงูู ูููููู ุงูููุงู ุจุฃู ูููุฉ ุฃุฎุฑู!  ุงูุฏุงูุฉ withContext ุชููู ูุคูุชูุง coroutine ุงูุญุงูู ุฃุซูุงุก ุชุดุบูู ุงูุฅุฌุฑุงุก ุงูุฎุงุต ุจู ( <code>getImage()</code> ).  ุจูุฌุฑุฏ ุฅุฑุฌุงุน <code>getImage()</code> ูุชุตุจุญ <code>looper</code> ูู ุงูุฎูุท ุงูุฑุฆูุณู ุ ุณูุณุชุฃูู coroutine ุงูุนูู ูู ุงูุฎูุท ุงูุฑุฆูุณู ููุฏุนู <code>imageView.setImageBitmap(image)</code> . <br><br>  ุงููุซุงู ุงูุซุงูู: ุงูุขู ูุญุชุงุฌ ุฅูู ุฅูุฌุงุฒ ูููุชูู ูู ุงูุฎูููุฉ ุญุชู ูููู ุงุณุชุฎุฏุงูููุง.  ุณูุณุชุฎุฏู duet async / ุงูุชุธุงุฑ ุจุญูุซ ูุชู ุชูููุฐ ูุงุชูู ุงููููุชูู ุจุงูุชูุงุฒู ุ ูุงุณุชุฎุฏุงู ูุชูุฌุชููุง ูู ุณูุณูุฉ ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ ุจูุฌุฑุฏ ุฃู ุชููู ููุชุง ุงููููุชูู ุฌุงูุฒุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> job = launch(Dispatchers.Main) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deferred1 = async(Dispatchers.Default) { getFirstValue() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deferred2 = async(Dispatchers.IO) { getSecondValue() } useValues(deferred1.await(), deferred2.await()) } job.join() <span class="hljs-comment"><span class="hljs-comment">//    ,     </span></span></code> </pre> <br>  <code>async</code> ุบูุฑ <code>async</code> ูุดุงุจู <code>launch</code> ุ ููููู ูุนูุฏ <code>deferred</code> (ููุงู Kotlin ููุงูุฆ <code>Future</code> ) ุ ูุฐูู ูููู ุงูุญุตูู ุนูู ุงููุชูุฌุฉ ุจุงุณุชุฎุฏุงู <code>await()</code> .  ุนูุฏ ุงุณุชุฏุนุงุก ุจุฏูู ูุนููุงุช ุ ูุนูู ูู ุงูุณูุงู ุงูุงูุชุฑุงุถู ูููุทุงู ุงูุญุงูู. <br><br>  ูุฑุฉ ุฃุฎุฑู ุ ูุจูู ุงูุฎูุท ุงูุฑุฆูุณู ูุฌุงูููุง ุจูููุง ููุชุธุฑ ูููุชูู. <br>  ููุง ุชุฑู ุ ุชููู ูุธููุฉ <code>launch</code> ุจุฅุฑุฌุงุน <code>Job</code> ุ ูุงูุชู ูููู ุงุณุชุฎุฏุงููุง ููุงูุชุธุงุฑ ุญุชู ุชูุชูู ุงูุนูููุฉ - ูุชู ุฐูู ุจุงุณุชุฎุฏุงู ุฏุงูุฉ <code>join()</code> .  ุฅูู ูุนูู ููุง ูู ุงูุญุงู ูู ุฃู ูุบุฉ ุฃุฎุฑู ุ ูุน ุชุญุฐูุฑ ุฃูู ุจุจุณุงุทุฉ <b>ูุนูู coroutine ุ ููุง ูููุน ุงูุชุฏูู</b> . <br><br>  <b>ุฅููุงุฏ</b> <br><br>  ุฅููุงุฏ ูู ููููู ุฑุฆูุณู ุนูุฏ ุงูุนูู ูุน coroutines.  ูุชูุญ ูู ูุฐุง ุงูุฅุฌุฑุงุก "ุงูุงูุชูุงู" ูู ุณูุณูุฉ ุฑุณุงุฆู ุฅูู ุฃุฎุฑู. <br><br>  ููุฑ ูู ุงูุดูู ุงูููุงูุฆ ููุฅุฑุณุงู ูู <code>Main</code> ูู java ุ ุฃู ุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs">runOnUiThread: <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> void runOnUiThread(Runnable action) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Thread.currentThread() != mUiThread) { mHandler.post(action); <span class="hljs-comment"><span class="hljs-comment">//  } else { action.run(); //   } }</span></span></code> </pre> <br>  ุชูููุฐ ุงูุณูุงู <code>Main</code> ููุธุงู Android ูู <code>Handler</code> ูุงุฆู ุนูู <code>Handler</code> .  ูุฐูู ูุฐุง ูู ูู ุงููุงูุน ุชูููุฐ ููุงุณุจ ููุบุงูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs">launch(Dispatchers.Main) { ... } vs launch(Dispatchers.Main, CoroutineStart.UNDISPATCHED) { ... } <span class="hljs-comment"><span class="hljs-comment">//   kotlinx 0.26: launch(Dispatchers.Main.immediate) { ... }</span></span></code> </pre> <br>  <code>launch(Dispatchers.Main)</code> ูุฑุณู <code>Runnable</code> ุฅูู <code>Handler</code> ุ ูุฐูู ูุง ูุชู ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจู ุนูู ุงูููุฑ. <br><br>  <code>launch(Dispatchers.Main, CoroutineStart.UNDISPATCHED)</code> ุณูููุฐ ุนูู ุงูููุฑ ุชุนุจูุฑ lambda ูู ุงูุฎูุท ุงูุญุงูู. <br><br>  <code>Dispatchers.Main</code> <b>ูุถูู ุฃูู ุนูุฏูุง ูุณุชุฃูู coroutine ุงูุนูู ุ ุณูุชู ุชูุฌููู ุฅูู ุงูููุถูุน ุงูุฑุฆูุณู</b> .  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุชู ุงุณุชุฎุฏุงู Handler ููุง ูุชุทุจูู Android ุฃุตูู ูุฅุฑุณุงูู ุฅูู ุญููุฉ ุญุฏุซ ุงูุชุทุจูู. <br><br>  ุงูุชูููุฐ ุงูุฏููู ูุดุจู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> Main: HandlerDispatcher = HandlerContext(mainHandler, <span class="hljs-string"><span class="hljs-string">"Main"</span></span>)</code> </pre> <br>  ุฅููู ููุงูุฉ ุฌูุฏุฉ ููุณุงุนุฏุชู ูู ููู ุชุนููุฏุงุช ุงูุฅุฑุณุงู ูู Android: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู Android Core: Looper ู Handler ู HandlerThread</a> . <br><br>  <b>ุงูุณูุงู Coroutine</b> <br><br>  ูุญุฏุฏ ุณูุงู coroutine (ุงููุนุฑูู ุฃูุถูุง ุจุงุณู ูุฏูุฑ coroutine) ูู ุณูุณูุฉ ุงูุฑุณุงุฆู ุงูุชู ุณูุชู ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูุง ุ ููุง ุงูุฐู ูุฌุจ ูุนูู ูู ุญุงูุฉ ุทุฑุญ ุงุณุชุซูุงุก ุ ููุดูุฑ ุฅูู ุงูุณูุงู ุงูุฃุตูู ููุดุฑ ุงูุฅูุบุงุก. <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> job = Job() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> exceptionHandler = CoroutineExceptionHandler { coroutineContext, throwable -&gt; whatever(throwable) } launch(Disaptchers.Default+exceptionHandler+job) { ... }</code> </pre> <br>  <code>job.cancel()</code> ุจุฅูุบุงุก ุฌููุน coroutines ุงูุฐู ูููู ุงููุงูุฏ ูู <code>job</code> .  ุณูู ุชุญุตู ุนูู ุงุณุชุซูุงุก ููุฏูุฑ ุฌููุน ุงูุงุณุชุซูุงุกุงุช ุงูุชู ุฃูููุช ูู ูุฐู coroutines. <br><br>  <b>ูุฌุงู</b> <br><br>  ุชุจุณุท ูุงุฌูุฉ <code>coroutineScope</code> ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก: <br>  ุฅุฐุง ูุดู ุฃู ูู ุงุจูุชูุง coroutines ุ ุซู ุณูุชู ุฅูุบุงุก ุงููุทุงู ุจุฃูููู ูุฌููุน coroutines ุงูุทูู. <br><br>  ูู ุงููุซุงู ุบูุฑ <code>async</code> ุ ุฅุฐุง ูู ููู ูู ุงููููู ุงุณุชุฎุฑุงุฌ ุงููููุฉ ุ ุจูููุง ุงุณุชูุฑุช ูููุฉ ุฃุฎุฑู ูู ุงูุนูู ุ ููุฏููุง ุญุงูุฉ ุชุงููุฉ ุ ูุนูููุง ุงูููุงู ุจุดูุก ุญูุงู ุฐูู. <br><br>  ุนูุฏ ุงูุนูู ูุน <code>coroutineScope</code> ุ ูู ูุชู ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ <code>useValues</code> ุฅูุง ูู ุญุงูุฉ ูุฌุงุญ ุงุณุชุฎุฑุงุฌ ููุง ุงููููุชูู.  ุฃูุถุง ุ ุฅุฐุง ูุดู <code>deferred1</code> ุ ุณูุชู ุฅูุบุงุก <code>deferred1</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs">coroutineScope { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deferred1 = async(Dispatchers.Default) { getFirstValue() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deferred2 = async(Dispatchers.IO) { getSecondValue() } useValues(deferred1.await(), deferred2.await()) }</code> </pre> <br>  ููููู ุฃูุถูุง "ูุถุน ูุทุงู" ูุตููุง ุจุฃูููู ูุชุนููู <code>CoroutineContext</code> ุงูุชุฑุงุถููุง ูู ูุงุณุชุฎุฏุงูู. <br><br>  ูุฆุฉ ุงููุซุงู ุงูุชู ุชููุฐ ูุงุฌูุฉ <code>CoroutineScope</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScopedViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span></span>(), CoroutineScope { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> job = Job() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> coroutineContext = Dispatchers.Main+job <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCleared</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCleared() job.cancel() } }</code> </pre> <br>  ุชุดุบูู Corutin ูู <code>CoroutineScope</code> : <br><br>  ุงูุชุดุบูู ุงูุงูุชุฑุงุถู ุฃู ูุฏูุฑ <code>async</code> ูุตุจุญ ุงูุขู ูุฏูุฑ ุงููุทุงู ุงูุญุงูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs">launch { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> foo = withContext(Dispatchers.IO) { โฆ } <span class="hljs-comment"><span class="hljs-comment">// -    CoroutineContext   โฆ } launch(Dispatchers.Default) { // -        โฆ }</span></span></code> </pre> <br>  ุงูุฅุทูุงู ุงููุณุชูู ู coroutine (ุฎุงุฑุฌ ุฃู CoroutineScope): <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs">GlobalScope.launch(Dispatchers.Main) { <span class="hljs-comment"><span class="hljs-comment">// -    . โฆ }</span></span></code> </pre> <br>  ููููู ุญุชู ุชุญุฏูุฏ ูุทุงู ุชุทุจูู ูุง ุนู ุทุฑูู ุชุนููู ุงููุฑุณู <code>Main</code> ุงูุงูุชุฑุงุถู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> AppScope : CoroutineScope <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> GlobalScope { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> coroutineContext = Dispatchers.Main.immediate }</code> </pre><br>  <b>ุชุตุฑูุญุงุช</b> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Coroutines ุชุญุฏ ุงูุชุดุบูู ุงููุชุฏุงุฎู ูุน ุฌุงูุง </li><li style=";text-align:right;direction:rtl">  ุงูุญุฏ ูู ูุงุจููุฉ ุงูุชุญููู ูุชุฌูุจ ุงูุฃููุงู </li><li style=";text-align:right;direction:rtl">  ุชู ุชุตููู Coroutines ููุงูุชุธุงุฑ ุ ูููุณ ูุชูุธูู ุงูููุงุถูุน </li><li style=";text-align:right;direction:rtl">  ุชุฌูุจ ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ูู <code>Dispatchers.Default</code> (ู <code>Main</code> ...) - ูุฐุง ูู ูุง Dispatchers.IO </li><li style=";text-align:right;direction:rtl">  ุงูุชุฏููุงุช ุชุณุชููู ุงูููุงุฑุฏ ุ ูุฐูู ูุชู ุงุณุชุฎุฏุงู ุงูุณูุงูุงุช ุฐุงุช ุณูุงุณู ุงูุชุฑุงุจุท ุงูููุฑุฏุฉ </li><li style=";text-align:right;direction:rtl">  ูุณุชูุฏ <code>Dispatchers.Default</code> ุฅูู <code>ForkJoinPool</code> ุ ุงูุฐู ุชู ุชูุฏููู ูู Android 5+ </li><li style=";text-align:right;direction:rtl">  Coroutines ูููู ุงุณุชุฎุฏุงููุง ูู ุฎูุงู ุงููููุงุช </li></ul><br>  <b>ุงูุชุฎูุต ูู ุงูุฃููุงู ูุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช ุจุงุณุชุฎุฏุงู ุงููููุงุช</b> <br><br>  ุชุนุฑูู ุงูููุงุฉ ูู ูุซุงุฆู JetBrains: <br><br><blockquote style=";text-align:right;direction:rtl">  ููุงุฉ <code>Channel</code> ุงููุงุญูุฉ ุงููุธุฑูุฉ ุชุดุจู ุฅูู ุญุฏ ุจุนูุฏ <code>BlockingQueue</code> .  ูุชูุซู ุงูุงุฎุชูุงู ุงูุฑุฆูุณู ูู ุฃูู ูุง ูุญุธุฑ ุนูููุฉ ุงูุจูุน ุ ููู ูููุฑ <code>send</code> ุชุนููู (ุฃู ุนุฑุถ ุบูุฑ ูุญุธูุฑ) ุ ูุจุฏูุงู ูู ุญุธุฑ ุนูููุฉ <code>receive</code> ุ ูุฅูู ููุต ุนูู <code>receive</code> ุชุนููู <code>receive</code> . </blockquote><br><br>  <b>ุงูุฌูุงุช ุงููุงุนูุฉ</b> <br><br>  ุงููุธุฑ ูู ุฃุฏุงุฉ ุจุณูุทุฉ ููุนูู ูุน ุงููููุงุช: <code>Actor</code> . <br><br>  <code>Actor</code> ุ ูุฑุฉ ุฃุฎุฑู ุ ูุดุจู ุฅูู ุญุฏ ูุจูุฑ <code>Handler</code> : ูุญู ูุนุฑูู ุณูุงู coroutine (ุฃู ุ ุงูุฎูุท ุงูุฐู ุณูููู ููู ุจุชูููุฐ ุงูุฅุฌุฑุงุกุงุช) ููุนูู ูุนู ุจุชุฑุชูุจ ูุชุณูุณู. <br><br>  ุงููุฑู ุ ุจุงูุทุจุน ุ ูู ุฃู ููุฑููุฒ ุชุณุชุฎุฏู ููุง ุ  <b>ููููู ุชุญุฏูุฏ ุงูุณูุทุฉ ุ ูุฑูุฒ ุชูููุฐูุง - ุชููู ูุคูุช</b> . <br><br>  ูู ุญูุซ ุงููุจุฏุฃ ุ ุณูููู <code>actor</code> ุจุฅุนุงุฏุฉ ุชูุฌูู ุฃู ุฃูุฑ ุฅูู ููุงุฉ coroutine.  ุฅูู <b>ูุถูู ุชูููุฐ ุฃูุฑ ููููุฏ ุงูุนูููุงุช ูู ุณูุงููุง</b> .  ูุณุงุนุฏ ูุฐุง ุงูููุฌ ุชูุงููุง ุนูู ุงูุชุฎูุต ูู <code>synchronize</code> ุงูููุงููุงุช ูุงูุญูุงุธ ุนูู ุฌููุน ุงูููุงุถูุน ูุฌุงููุฉ! <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> updateActor <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { actor&lt;Update&gt;(capacity = Channel.UNLIMITED) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (update <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> channel) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (update) { Refresh -&gt; updateList() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Filter -&gt; filter.filter(update.query) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MediaUpdate -&gt; updateItems(update.mediaList <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> List&lt;T&gt;) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MediaAddition -&gt; addMedia(update.media <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MediaListAddition -&gt; addMedia(update.mediaList <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> List&lt;T&gt;) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MediaRemoval -&gt; removeMedia(update.media <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T) } } } <span class="hljs-comment"><span class="hljs-comment">//  fun filter(query: String?) = updateActor.offer(Filter(query)) //  suspend fun filter(query: String?) = updateActor.send(Filter(query))</span></span></code> </pre> <br>  ูู ูุฐุง ุงููุซุงู ุ ูุณุชุฎุฏู ูุฆุงุช Kotlin ุงููุฎุชููุฉ ุ ููุฎุชุงุฑ ุงูุฅุฌุฑุงุก ุงูุฐู ูุฌุจ ุงูููุงู ุจู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Update</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Refresh</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Update</span></span></span></span>() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Filter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> query: String?) : Update() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MediaAddition</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> media: Media) : Update()</code> </pre> <br>  ุนูุงูุฉ ุนูู ุฐูู ุ ุณูุชู ูุถุน ุฌููุน ูุฐู ุงูุฅุฌุฑุงุกุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุ ููู ูุชู ุชูููุฐูุง ุฃุจุฏูุง ุจุงูุชูุงุฒู.  ูุฐู ุทุฑููุฉ ููุงุฆูุฉ ูุชุญููู <b>ุญุฏูุฏ ุงูุชุจุงูู</b> . <br><br>  <b>ุฏูุฑุฉ ุญูุงุฉ ุฃูุฏุฑููุฏ + ููุฑูุชูู</b> <br><br>  ูููู ุฃู ุชููู ุงูุฌูุงุช ุงููุงุนูุฉ ุฃูุถูุง ูููุฏุฉ ุฌุฏูุง ููุชุญูู ูู ูุงุฌูุฉ ูุณุชุฎุฏู Android ุ ูุชุจุณูุท ุฅูุบุงุก ุงูููุงู ุ ูููุน ุงูุชุญููู ุงูุฒุงุฆุฏ ููุฎูุท ุงูุฑุฆูุณู. <br>  ุฏุนูุง ูููุฐ ูุฐุง ููุฏุนู <code>job.cancel()</code> ุนูุฏูุง ูุชู ุชุฏููุฑ ุงููุดุงุท. <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>(), CoroutineScope { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> job = SupervisorJob() <span class="hljs-comment"><span class="hljs-comment">//  Job    override val coroutineContext = Dispatchers.Main.immediate+job override fun onDestroy() { super.onDestroy() job.cancel() //      } }</span></span></code> </pre> <br>  ุชุดุจู ูุฆุฉ <code>SupervisorJob</code> <code>Job</code> ุงูุนุงุฏูุฉ ุจุงุณุชุซูุงุก ุฃู ุงูุฅูุบุงุก ููุชุฏ ููุท ูู ุงุชุฌุงู ุงููุตุจ. <br><br>  ูุฐูู ุ ูุง ูููู ุจุฅูุบุงุก ุฌููุน coroutines ูู <code>Activity</code> ุนูุฏูุง ููุดู ุฃุญุฏูู. <br><br>  ุงูุฃููุฑ ุฃูุถู ููููุงู ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธููุฉ ููุญู</a> ุชุชูุญ ูู ุงููุตูู ุฅูู <code>CoroutineContext</code> ูู ุฃู <code>View</code> ูู <code>CoroutineScope</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> View.coroutineContext: CoroutineContext? <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = (context <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? CoroutineScope)?.coroutineContext</code> </pre> <br>  ุงูุขู ูููููุง ุงูุฌูุน ุจูู ูู ูุฐุง ุ ุชููู ูุธููุฉ <code>setOnClick</code> ุจุฅูุดุงุก ููุซู ูุดุชุฑู ููุชุญูู ูู ุชุตุฑูุงุช <code>onClick</code> ุงูุฎุงุตุฉ ุจู.  ูู ุญุงูุฉ ุงูุตูุงุจูุฑ ุงููุชุนุฏุฏุฉ ุ ุณูุชู ุชุฌุงูู ุงูุฅุฌุฑุงุกุงุช ุงููุณูุทุฉ ุ ูุจุงูุชุงูู ุงูุชุฎูุต ูู ุฃุฎุทุงุก ANR (ูุง ูุณุชุฌูุจ ุงูุชุทุจูู) ุ ูุณูุชู ุชูููุฐ ูุฐู ุงูุฅุฌุฑุงุกุงุช ูู ูุทุงู <code>Activity</code> .  ูุฐูู ุ ุนูุฏูุง ูุชู ุชุฏููุฑ ุงููุดุงุท ุ ุณูุชู ุฅูุบุงุก ูู ูุฐุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">suspend</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//         val scope = (context as? CoroutineScope)?: AppScope val eventActor = scope.actor&lt;Unit&gt;(capacity = Channel.CONFLATED) { for (event in channel) action() } //       setOnClickListener { eventActor.offer(Unit) } }</span></span></code> </pre> <br>  ูู ูุฐุง ุงููุซุงู ุ ูููุง ุจุชุนููู <code>Channel</code> ุนูู <code>Conflated</code> ุจุญูุซ ุชุชุฌุงูู ุจุนุถ ุงูุฃุญุฏุงุซ ุฅุฐุง ูุงู ููุงู ุงููุซูุฑ ูููุง.  ููููู ุงุณุชุจุฏุงูู ุจู <code>Channel.UNLIMITED</code> ุฅุฐุง ููุช ุชูุถู ูุถุน ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฃุญุฏุงุซ ุฏูู ููุฏ ุฃู ูููุง ุ ูููู ูุง ุชุฒุงู ุชุฑุบุจ ูู ุญูุงูุฉ ุงูุชุทุจูู ูู ุฃุฎุทุงุก ANR. <br><br>  ููููู ุฃูุถูุง ุงูุฌูุน ุจูู coroutines ูุฅุทุงุฑุงุช Lifecycle ูุฃุชูุชุฉ ุฅูุบุงุก ุงูููุงู ุงููุชุนููุฉ ุจูุงุฌูุฉ ุงููุณุชุฎุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> LifecycleOwner.untilDestroy: Job <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> job = Job() lifecycle.addObserver(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: LifecycleObserver { <span class="hljs-meta"><span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { job.cancel() } }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> job } <span class="hljs-comment"><span class="hljs-comment">//  GlobalScope.launch(Dispatchers.Main, parent = untilDestroy) { /*    ! */ }</span></span></code> </pre> <br>  <b>ุชุจุณูุท ุงููููู ูุน ุงูุงุณุชุฑุฌุงุนุงุช (ุงูุฌุฒุก 1)</b> <br><br>  ุฅููู ููููุฉ ุชุญููู ุงุณุชุฎุฏุงู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงููุณุชูุฏุฉ ุฅูู ุฑุฏ ุงูุงุชุตุงู ูุน <code>Channel</code> . <br><br>  ูุนูู API ูุซู ูุฐุง: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>requestBrowsing(url, listener)</code> ููุฒุน ุงููุฌูุฏ ุงูููุฌูุฏ ุนูู <code>url</code> . </li><li style=";text-align:right;direction:rtl">  <code>listener</code> ุนูู <code>onMediaAdded(media: Media)</code> ูุฃู ููู ูุณุงุฆุท ููุฌูุฏ ูู ูุฐุง ุงููุฌูุฏ. </li><li style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฏุนุงุก <code>listener.onBrowseEnd()</code> ุนูุฏ ุชุญููู ุงููุฌูุฏ </li></ol><br>  ูููุง ููู ูุธููุฉ <code>refresh</code> ุงููุฏููุฉ ูู ูููุฑ ุงููุญุชูู ููุชุตูุญ VLC: <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refreshList = mutableListOf&lt;Media&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = requestBrowsing(url, refreshListener) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refreshListener = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : EventListener{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMediaAdded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(media: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Media</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { refreshList.add(media)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBrowseEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list = refreshList.toMutableList() refreshList.clear() launch { dataset.value = list parseSubDirectories() } } }</code> </pre> <br>  <b>ููููุฉ ุชุญุณูููุ</b> <br><br>  ูู ุจุฅูุดุงุก ููุงุฉ ุณุชุนูู ูู <code>refresh</code> .  ุงูุขู ุณุชููู ุนูููุงุช ูุนุงูุฏุฉ ุงูุงุชุตุงู ุจุงููุชุตูุญ ุจุชูุฌูู ุงููุณุงุฆุท ุฅูู ูุฐู ุงูููุงุฉ ููุท ุ ุซู ุฅุบูุงููุง. <br><br>  ุงูุขู ุฃุตุจุญุช ูุธููุฉ <code>refresh</code> ุฃูุซุฑ ูุถูุญูุง.  ุฅููุง ุชูุดุฆ ููุงุฉ ุ ูุชุฏุนู ูุชุตูุญ VLC ุ ุซู ุชุดูู ูุงุฆูุฉ ุจูููุงุช ุงููุณุงุฆุท ูุชุนุงูุฌูุง. <br><br>  ุจุฏูุงู ูู <code>select</code> ุฃู <code>consumeEach</code> ููููู ุงุณุชุฎุฏุงู ุงูุชุธุงุฑ ุงููุณุงุฆุท ุ ูุณูู ุชููุทุน ูุฐู ุงูุญููุฉ ุจูุฌุฑุฏ ุฅุบูุงู <code>browserChannel</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> browserChannel : Channel&lt;Media&gt; <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMediaAdded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(media: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Media</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { browserChannel.offer(media) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBrowseEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { browserChannel.close() } <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { browserChannel = Channel(Channel.UNLIMITED) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> refreshList = mutableListOf&lt;Media&gt;() requestBrowsing(url) <span class="hljs-comment"><span class="hljs-comment">//        for (media in browserChannel) refreshList.add(media) //   dataset.value = refreshList parseSubDirectories() }</span></span></code> </pre> <br>  <b>ุชุจุณูุท ุงููููู ูู ุฎูุงู ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช (ุงูุฌุฒุก 2): ุงูุชุญุฏูุซูุฉ</b> <br><br>  ุงูุทุฑููุฉ ุงูุซุงููุฉ: ูุญู ูุง ูุณุชุฎุฏู kotlinx coroutines ุนูู ุงูุฅุทูุงู ุ ููููุง ูุณุชุฎุฏู ุฅุทุงุฑ coroutine ุงูุฃุณุงุณู. <br><br>  ุชุฑู ููู ุชุนูู coroutines ูุนูุง! <br><br>  ุงูุชูุงู ูุธููุฉ <code>retrofitSuspendCall</code> ุทูุจ <code>Retrofit Call</code> ูุฌุนูู ูุธููุฉ <code>suspend</code> . <br><br>  ุจุงุณุชุฎุฏุงู <code>suspendCoroutine</code> ูุฏุนู ุทุฑููุฉ <code>Call.enqueue</code> ูุคูุชูุง ุนู coroutine.  ุณูู ุงุณุชุฏุนุงุก ุฑุฏ ุงูุงุชุตุงู ุจูุฐู ุงูุทุฑููุฉ ุงุณุชุฏุนุงุก <code>continuation.resume(response)</code> ูุงุณุชุฆูุงู coroutine ูุน ุงุณุชุฌุงุจุฉ ูู ุงูุฎุงุฏู ุจูุฌุฑุฏ ุชููููุง. <br><br>  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ููุท ุฅูู ุฏูุฌ ูุธุงุฆู Retrofit ูู <code>retrofitSuspendCall</code> ูุฅุฑุฌุงุน ูุชุงุฆุฌ ุงูุงุณุชุนูุงู ุจุงุณุชุฎุฏุงููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-type"><span class="hljs-keyword">reified</span></span></span></span><span class="hljs-function"><span class="hljs-type"> T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrofitSuspendCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: ()</span></span></span></span> -&gt; Call &lt;T&gt; ) : Response &lt;T&gt; = suspendCoroutine { continuation -&gt; request.invoke().enqueue(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : Callback&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(call: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Call</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, response: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Response</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { continuation.resume(response) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(call: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Call</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, t: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Throwable</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { continuation.resumeWithException(t) } }) } <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">browse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> = retrofitSuspendCall { ApiClient.browse(path) } <span class="hljs-comment"><span class="hljs-comment">//  (   Main) livedata.value = Repo.browse(path)</span></span></code> </pre> <br>  ูุจุงูุชุงูู ุ ูุชู ุฅุฌุฑุงุก ุญุธุฑ ุงูููุงููุงุช ุนูู ุงูุดุจูุฉ ูู ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุชุญุฏูุซู ุงููุฎุตุต ุ ูุงููููุน ููุง ุ ูู ุงูุชุธุงุฑ ุงุณุชุฌุงุจุฉ ูู ุงูุฎุงุฏู ุ ูููุณ ููุงู ููุงู ูุงุณุชุฎุฏุงูู ูู ุงูุชุทุจูู! <br><br>  ูุฐุง ุงูุชุทุจูู ูุณุชูุญู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุจุฉ gildor / kotlin-coroutines-retrofit</a> . <br><br>  ููุฌุฏ ุฃูุถูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุญูู JakeWharton / retrofit2-kotlin-coroutines</a> ูุน ุชุทุจูู ุขุฎุฑ ูุนุทู ูุชูุฌุฉ ููุงุซูุฉ. <br><br>  <b>ุฎุงุชูุฉ</b> <br><br>  <code>Channel</code> ูููู ุงุณุชุฎุฏุงููุง ูู ุงูุนุฏูุฏ ูู ุงูุทุฑู ุงูุฃุฎุฑู.  ุชุญูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BroadcastChannel ููุญุตูู ุนูู</a> ุชุทุจููุงุช ุฃูุซุฑ ููุฉ ูุฏ ุชุฌุฏูุง ูููุฏุฉ. <br><br>  ููููู ุฃูุถูุง ุฅูุดุงุก ูููุงุช ุจุงุณุชุฎุฏุงู ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Produce</a> . <br><br>  ุฃุฎูุฑูุง ุ ูุนุฏ ุงุณุชุฎุฏุงู ุงููููุงุช ููุงุณุจูุง ูุชูุธูู ุงูุงุชุตุงูุงุช ุจูู ููููุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู: ูููู ูููุญูู ููู ุฃุญุฏุงุซ ุงูููุฑ ุฅูู ุฌุฒุกู / ูุดุงุทู ุนุจุฑ <code>Channel</code> ุฃู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฎูุงู <code>Actor</code> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar457224/">https://habr.com/ru/post/ar457224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar457204/index.html">ููุงูุฐ PowerShell ูุงููุณุงุฑุงุช ุงูุทูููุฉ</a></li>
<li><a href="../ar457206/index.html">SQL Index Manager - ูุตุฉ ุทูููุฉ ุญูู SQL Server ุ ูุญูุฑ ุงููุจุฑ ูุตูุงูุฉ ุงูููุฑุณ</a></li>
<li><a href="../ar457208/index.html">ุฅูุดุงุก ููู robots.txt ุจุดูู ุญููู ูููุงูุน ASP.NET Core ุงุณุชูุงุฏูุง ุฅูู ุงูุจูุฆุฉ</a></li>
<li><a href="../ar457210/index.html">ุชุฎุฒูู ุงูููุงุฑุฏ ุงูุซุงุจุชุฉ ุนูู ุงูุงุณุชุถุงูุฉ ุงูุฎุงุตุฉ ุจู</a></li>
<li><a href="../ar457212/index.html">ููุงุฐุง ูู ููุช ุงูุฃูุงู ุจุนุฏ ูุจุฏุก ุชุนูู ุฌุงูุง (ุฃู ูุบุงุช ุฌุงูุง ุงูุฃุฎุฑู)</a></li>
<li><a href="../ar457232/index.html">ุฑูุจูุช ุงููุญู "ุชูุนุซู" - ุฃูู ุฑุญูุฉ ุชุฌุฑูุจูุฉ ุฏุงุฎู ูุญุทุฉ ุงููุถุงุก ุงูุฏูููุฉ</a></li>
<li><a href="../ar457234/index.html">ุงูุชุญูุฒ ุงููุนุฑูู ุงูููุชุฌ</a></li>
<li><a href="../ar457236/index.html">ููู ุชูุงูุญ ุดุฑูุฉ ุชูููููุฌูุง ุงููุนูููุงุช ูุจูุน ุงูููุณููู</a></li>
<li><a href="../ar457240/index.html">ุฃุฎุจุงุฑ ุงูุฃุณุจูุน: ุดุจูุฉ ุนุตุจูุฉ ูุตูุฑ ููุชูุบุฑุงููุฉ ุ ูููู ุฃุณูู Yandex ุ ุชุชุทูุจ Huawei ูููุงุฑ ุฏููุงุฑ ูุจุฑุงุกุงุช ุงูุงุฎุชุฑุงุน</a></li>
<li><a href="../ar457246/index.html">ููููุฉ ูููุถ 4 ุงููุตุงุจูุญ ุนูู CortexM ุจุงุณุชุฎุฏุงู C ++ 17 ุ tuple ูููููุง ูู ุงูุฎูุงู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>