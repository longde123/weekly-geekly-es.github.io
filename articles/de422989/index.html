<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶ üëÇüèª ‚òÅÔ∏è Eine Datenbank ist nicht nur ein Data Warehouse üíª ‚ö†Ô∏è üôèüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Verwendung einer Datenbank nur zur Datenspeicherung entspricht dem Aufrufen von Unix als Schnittstelle f√ºr die Arbeit mit Dateien. Daher m√∂chte ic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine Datenbank ist nicht nur ein Data Warehouse</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422989/"><p><img src="https://habrastorage.org/webt/o1/t_/g4/o1t_g4i4iyk2wbbfyv61pq45mfa.png" align="left" height="35%" width="35%">  Die Verwendung einer Datenbank nur zur Datenspeicherung entspricht dem Aufrufen von Unix als Schnittstelle f√ºr die Arbeit mit Dateien.  Daher m√∂chte ich Sie an die bekannten und nicht sehr Datenbankfunktionen erinnern, die ich in webbasierten Kampfanwendungen h√§ufiger sehen m√∂chte. </p><a name="habracut"></a><br><h2 id="tldr">  tl; dr </h2><br><p>  Im Folgenden werden Authentifizierung, Benutzer, Zugriffsrechte, Datenintegrit√§t, FDW, Protokollierung und Statistiken beschrieben.  Nichts Neues. </p><br><h2 id="primechaniya">  Anmerkungen </h2><br><ul><li>  Ich meine Ruby on Rails und Postgres, aber die meisten Referenzen werden in anderen Sprachen und DBMS gut vertragen. </li><li> Ich werde nichts Neues sagen, all dies wurde lange in der Dokumentation und den Artikeln beschrieben.  Ich m√∂chte nur noch einmal daran erinnern, wo die Werkzeuge eingesetzt werden k√∂nnen, um das Leben ein wenig besser zu machen. </li></ul><br><h2 id="peerident-autentifikaciya">  Peer / Ident-Authentifizierung </h2><br><p> Absolut gesunde Sache, die fast niemand benutzt.  Es ordnet einen Unix-Benutzer einem Datenbankbenutzer zu.  Im ersten Fall wird der lokale Benutzer und im zweiten Fall der Remote-Benutzer zugeordnet.  Der Vorteil ist, dass Sie den Host, den Benutzernamen und das Kennwort aus der Konfiguration entfernen k√∂nnen (und der Datenbankname kann auch gel√∂scht werden), aber alles funktioniert wie zuvor.  Au√üerdem ist es bequemer, zum direkten Debuggen in die Konsole zu gehen (nur psql vom Terminal aus statt all dieser <code>-h -U -W -d</code> usw.). </p><br><p>  PG-Dokumentation zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Peer</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ident</a> . </p><br><p>  Nuancen: geeignet, wenn Sie nicht nur root und superuser auf dem Server haben;  und im Fall von ident steuern Sie das Netzwerk, die Hardware und sind sicher, dass es keine Eindringlinge und Saboteure gibt. </p><br><h3 id="primery-ispolzovaniya">  Anwendungsbeispiele </h3><br><p>  Sicherheit  Sie k√∂nnen das Kennwort nicht aus der Datenbank entfernen und von der lokalen Umgebung oder von einer anderen Stelle aus eine Verbindung herstellen.  Es gibt kein Passwort und es gibt nichts zu ziehen. </p><br><p>  Zugangskontrolle.  Wenn es mehrere Zugriffsrollen f√ºr die Produktion oder einen anderen Server gibt und diese bereits auf Unix-Ebene aufgeteilt sind, ist es zweckm√§√üig, Datenbankbenutzer an diese zu binden.  In diesem Fall wird dieselbe Codebasis unter verschiedenen Datenbankbenutzern verbunden.  Zum Beispiel klettern technischer Support und Entwickler in dieselbe Rails-Konsole, aber f√ºr einige ist es schreibgesch√ºtzt und f√ºr die zweite ist es vollwertig. </p><br><h2 id="prava-dostupa">  Zugangsrechte </h2><br><p>  In Unix denken alle an sie und sie sehen sehr verzerrt aus <code>'chmod 777'</code> sie von root oder <code>'chmod 777'</code> .  Aber in der Datenbank ist alles irgendwie anders.  Superuser und los.  Obwohl alles dort nicht weniger (und vielleicht sogar mehr) cool ist. </p><br><p>  Es gibt eine Hierarchie der Rollenvererbung (ein bisschen wie eine Gruppe in Unix), es gibt Zugriffe auf verschiedenen Ebenen: auf bestimmte Objekte (wie Dateiberechtigungen), auf bestimmte Operatoren (wie Regeln in <code>sudoers</code> ), sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf bestimmte Zeilen</a> .  Kurz gesagt, alles ist da.  Verwenden Sie es. </p><br><h3 id="oblasti-prilozheniya">  Anwendungsbereiche </h3><br><p>  In der Mindestversion k√∂nnen Sie zusammen mit dem oben genannten Peer / Ident den Benutzer f√ºr Migrationen / Bereitstellung und den Benutzer f√ºr den t√§glichen Betrieb der Anwendung trennen.  Dies sch√ºtzt zumindest zur Laufzeit vor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DDL-</a> Aufrufen.  Nat√ºrlich gibt es viele F√§lle, in denen die Datenbankstruktur "on hot" ge√§ndert wird.  Hierbei handelt es sich um Bereitstellungen ohne Ausfallzeiten und verschiedene Hotfixes sowie um die gleichzeitige (und manchmal auch nicht) Wiederherstellung von Indizes.  Im Allgemeinen sollte eine DDL-Anwendung dies jedoch nicht tun. </p><br><p>  Eine weitere Option: Wenn Sie √ºber "Microservices" verf√ºgen, diese jedoch aus irgendeinem Grund dieselbe Datenbank verwenden, ist es eine sehr gute Idee, den Zugriff auf die Datenbankobjekte eindeutig zu teilen.  In der Tat sollten die Interaktionsschnittstellen so lokal wie m√∂glich sein, und der anarchische Zugriff auf alle Daten tr√§gt zur Erosion von Logik und Verantwortung bei. </p><br><h2 id="ogranichenie-celostnosti">  Integrit√§tsbeschr√§nkung </h2><br><p>  In Rails 5 begann die Arbeit zumindest irgendwie mit Referenz und Datenintegrit√§t.  Im Allgemeinen glauben viele Entwickler jedoch, dass die Validierung im Modell oder in seiner Umgebung ausreicht, um den konsistenten Status der Daten beizubehalten.  Leider ist das √ºberhaupt nicht wahr. </p><br><p>  √úberpr√ºfungen k√∂nnen √ºbersprungen werden, Sie k√∂nnen direkt zur Datenbank gehen und SQL ausf√ºhren, Sie k√∂nnen w√§hrend der Migration aufwischen.  Im Allgemeinen kann viel getan werden.  Daher sollte alles, was auf Gesch√§ftslogik beruht, von der Datenbank erfasst werden.  Dies ist die einzige M√∂glichkeit, die Datenintegrit√§t zu erhalten und bei der n√§chsten Bereitstellung keine "√úberraschungen" zu erleben. </p><br><h2 id="foreign-data-wrapper">  Wrapper f√ºr fremde Daten </h2><br><p>  Hier geht es darum, eine Datenbank mit einer anderen Datenbank zu verbinden, um auf eigene Remote-Tabellen zuzugreifen.  Der Hauptgewinn besteht darin, dass die Webanwendung in keiner Weise beteiligt ist. Es gibt jedoch viele Optimierungen, wenn zwei identische Datenbanken funktionieren (Pushdown ist im Allgemeinen f√ºr verschiedene Adapter vorgesehen, aber dort ist alles kompliziert, sodass leichter davon ausgegangen werden kann, dass das PG-PG-Bundle gut funktioniert. und alles andere - wie es geht). </p><br><h3 id="ispolzovanie-fdw">  FDW verwenden </h3><br><p>  Anstatt mit den Koordinaten mehrerer Datenbanken in einer Webanwendung zu konfigurieren, ist es unvergleichlich einfacher, eine Verbindung zur Datenbank zu belassen und alles auf Datenbankebene zu verwalten.  Dort wird das Problem der Zugriffsrechte und der Auswahl der Objekte, auf die zugegriffen werden muss, gel√∂st. </p><br><p>  Au√üerdem k√∂nnen Sie in Zukunft die externe Tabelle durch eine materialisierte Ansicht oder nur eine Tabelle ersetzen, aber in einer Webanwendung nichts √§ndern. </p><br><p>  Sie k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sich jedoch mit dem exotischen</a> Typ von MS Access verbinden, und die Probleme mit Einschr√§nkungen bei der Verwendung von Beziehungen in Modellen verschwinden.  Wenn Sie √ºber 2+ Verbindungen verf√ºgen, werden Sie auf Webanwendungsebene keine zwei Basen verbinden, obwohl ORM (insbesondere ActiveRecord) dies ehrlich versucht ... und abf√§llt.  Auf Datenbankebene kann dies in einigen F√§llen fast ohne Overhead erfolgen. </p><br><h2 id="logirovanie">  Protokollierung </h2><br><p>  Fast jeder kennt ihn und nutzt alles.  Aber nur f√ºr den Fall, lassen Sie mich daran erinnern: Z√∂gern Sie nicht, lange Anfragen zu protokollieren.  In PG ist es sofort ausgeschaltet.  <code>log_min_duration_statement</code> .  In Bezug auf seine Bedeutung gibt es viele Holivars und vielleicht stammeln sie mich, aber nehmen Sie sich zun√§chst ein paar Sekunden Zeit.  Wenn Sie eine gro√üe Anwendung haben, ist es unwahrscheinlich, dass Sie sie lesen und selbst wissen, was zu tun ist. Wenn sie jedoch klein ist, haben Sie keine Zeit, sich mit kleinen Bremsen zu befassen, und nur t√∂dliche Dinge st√∂ren Sie. </p><br><p>  Denken Sie auch an N + 1.  Die Datenbank sagt nichts dar√ºber aus.  Verwenden Sie Tools von Drittanbietern.  Zum Beispiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kugel</a> und gesunder Menschenverstand. </p><br><h2 id="statistika">  Statistiken </h2><br><p>  Es muss daran erinnert werden, dass es ist und dass es stinken kann.  Zun√§chst ist alles in Ordnung.  Im Laufe der Zeit ergeben sich jedoch normalerweise die folgenden Ergebnisse: Die √Ñnderungsrate der Daten ist ungef√§hr gleich und die Gr√∂√üe der Tabelle ist gr√∂√üer.  Folglich treten die Vakuum- / Analysetabellen seltener auf und irgendwann beginnt der Scheduler zu verfehlen.  Im besten Fall f√§llt die Anfrage in die oben genannte Protokollierung, im schlimmsten Fall - Sie leiden einfach und verstehen nicht warum.  Schauen Sie im Allgemeinen in <code>pg_stat_user_tables</code> und korrelieren Sie die Vakuum- / Analysedaten mit der Belastung der Tabellen. </p><br><p>  Und manchmal k√∂nnen Sie Statistiken f√ºr eine ungef√§hre <code>count</code> .  Es ist selten praktisch, aber sehr treffend, da PG nicht Oracle ist und die <code>count</code> f√ºr die gesamte Tabelle nicht in O (1) erfolgt, obwohl ich es wirklich m√∂chte. </p><br><h2 id="konec">  Das Ende </h2><br><p>  Danke f√ºrs Lesen.  Wenn es nicht schwierig ist, beantworten Sie die folgende Frage.  Angesichts eines k√ºrzlich erschienenen Artikels √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GQL anstelle von SQL hat</a> es mich sehr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gest√∂rt</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422989/">https://habr.com/ru/post/de422989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422977/index.html">Mikhail Bessmeltsev und sein Kollege entwickelten neue Algorithmen zur Vektorisierung von Grafiken</a></li>
<li><a href="../de422979/index.html">Amerikanisches Analogon der DSGVO: Was Sie √ºber die CCPA wissen m√ºssen</a></li>
<li><a href="../de422981/index.html">Einfachste Implementierung des Entity Component-Systems</a></li>
<li><a href="../de422985/index.html">Schnellstart eines Webprojekts (BE - Java Spring, FE - React Redux, Interaktion - Rest, WebSocket)</a></li>
<li><a href="../de422987/index.html">Und wieder der 256. Tag des Jahres</a></li>
<li><a href="../de422993/index.html">Brennen von OLED-Fernsehern in echten Tests</a></li>
<li><a href="../de422995/index.html">QA-Mitap in Redmadrobot</a></li>
<li><a href="../de422997/index.html">Das Buch "Modern PHP"</a></li>
<li><a href="../de422999/index.html">Erstellen Sie Ihren eigenen Alien-Datensatz</a></li>
<li><a href="../de423005/index.html">Wie Yandex.Zen, das WordPress-Caching-Plugin und das Hosting, meinen Druck steigerten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>