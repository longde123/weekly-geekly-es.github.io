<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùå üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üßîüèæ Arcade Reverse Engineering: Record Michael Jordan au NBA Jam üíâ üçÑ üë®üèæ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'√©t√© dernier, j'ai √©t√© invit√© √† une f√™te √† Sunnyvale. Il s'est av√©r√© que les propri√©taires du garage avaient une machine d'arcade NBA JAM Tournament ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arcade Reverse Engineering: Record Michael Jordan au NBA Jam</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473660/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e1/f90/849/7e1f90849dee7927ad904dca4f68bf2d.png" width="150%"></div><br>  L'√©t√© dernier, j'ai √©t√© invit√© √† une f√™te √† Sunnyvale.  Il s'est av√©r√© que les propri√©taires du garage avaient une machine d'arcade NBA JAM Tournament Edition pour quatre joueurs.  Malgr√© le fait que le jeu a d√©j√† plus de 25 ans (il est sorti en 1993), il est toujours tr√®s int√©ressant de le jouer, surtout pour les fans enthousiastes. <br><br>  J'ai √©t√© surpris par la liste de joueurs des Chicago Bulls qui n'incluait pas Michael Jordan.  Selon des sources <sup>[1]</sup> , MJ a re√ßu sa propre licence et ne faisait pas partie de l'accord que Midway avait conclu avec la NBA. <br><br>  Apr√®s avoir demand√© au propri√©taire de la machine, j'ai appris que les pirates ont sorti un mod pour SNES "NBA Jam 2K17", qui permet aux nouveaux joueurs et MJ de jouer, mais personne n'analysait le fonctionnement de la version arcade.  Par cons√©quent, je devais d√©finitivement regarder √† l'int√©rieur. <br><a name="habracut"></a><br><h2>  Contexte </h2><br>  L'histoire du Jam NBA ne commence pas avec le basket-ball, mais avec Jean-Claude Van Damme.  √Ä peu pr√®s au m√™me moment o√π Universal Soldier est sorti, Midway Games a d√©velopp√© une technologie pour manipuler de grands sprites photor√©alistes num√©ris√©s qui gardent une ressemblance avec de vrais acteurs.  Ce fut une √©norme perc√©e technologique: des animations avec 60 images par seconde, des sprites in√©dits de 100x100 pixels, chacun ayant sa propre palette de 256 couleurs. <br><br>  La soci√©t√© a utilis√© cette technologie avec grand succ√®s dans le jeu de tir populaire "Terminator 2: Judgment Day" <sup>[2]</sup> , mais n'a pas pu acqu√©rir une licence pour "Universal Soldier" (les conditions financi√®res de JCVD ‚Äã‚Äã√©taient inacceptables pour Midway <sup>[3]</sup> ).  Lorsque les n√©gociations se sont sold√©es par un √©chec, Midway a chang√© de cap et a commenc√© √† d√©velopper un jeu de combat m√©ga-hit Capcom de 1991 appel√© Street Fighter II: The World Warrior. <br><br>  Une √©quipe de quatre personnes a √©t√© constitu√©e (Ed Boone a √©crit le code, John Tobias √©tait impliqu√© dans l'art et les scripts, John Vogel a dessin√© des graphiques et Dan Forden √©tait un ing√©nieur du son).  Apr√®s un an de dur labeur <sup>[4]</sup> Midway a lanc√© le Mortal Kombat en 1992. <br><br>  Le style visuel √©tait tr√®s diff√©rent du pixel art habituel, et la conception du jeu √©tait, pour le moins, "controvers√©e".  Le jeu avec des litres de sang √† l'√©cran et des pouss√©es incroyablement cruelles - la ¬´fatalit√©¬ª est instantan√©ment devenu un succ√®s mondial et a rapport√© pr√®s d'un milliard de dollars en un an <sup>[5]</sup> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/39e/38c/b3b39e38c2dc236966ea48153bd2c9fc.png"></div><br>  <i>SF2: 384 √ó 224 avec 4 096 couleurs.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/ecc/af5/8faeccaf515916b68f8b63e8a08357e9.png"></div><br>  <i>MK: 400 √ó 254 avec 32 768 couleurs.</i> <br><br>  <u><b>Fait int√©ressant:</b></u> comme en mode VGA 0x13 sur PC, dans ces jeux, les pixels n'√©taient pas carr√©s.  Bien que le tampon de trame Mortal Kombat ait une taille de 400 √ó 254, il est √©tir√© √† un rapport 4: 3 d'un √©cran CRT, offrant une r√©solution de 400 √ó 300 <sup>[6]</sup> <br><br><h2>  √âquipement Midway T-Unit </h2><br>  Le mat√©riel d√©velopp√© par Midway pour Mortal Kombat s'est av√©r√© tr√®s bon.  Tellement bon qu'il a re√ßu son propre nom T-Unit et r√©utilis√© dans d'autres jeux. <br><br><ul><li>  Mortal Kombat. </li><li>  Mortal Kombat II. </li><li>  NBA Jam. </li><li>  NBA Jam Tournament Edition. </li><li>  Le juge Dredd (n'a pas √©t√© lib√©r√©). </li></ul><br>  T-Unit se compose de deux cartes.  La plupart d'entre eux traitent de la logique et des graphismes du jeu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/753/893/a37/753893a376a67cef13cef49846d2ae82.png" width="100%"></div><br>  <i>Carte processeur NBA JAM TE Edition (environ 40x40 cm ou 15 pouces).</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/300/f9c/fb4/300f9cfb461f4833a340ad1028f9f389.png" width="55%"></div><br>  L'autre planche est moins compliqu√©e, mais aussi capable de beaucoup.  Il est con√ßu pour l'audio, mais il peut jouer non seulement de la musique en utilisant la synth√®se FM, mais aussi du son num√©rique. <br><br>  La carte son est connect√©e √† une source d'alimentation et √† une carte graphique install√©e √† l'arri√®re.  Faites attention √† l'√©norme radiateur situ√© dans le coin sup√©rieur gauche. <br><br>  Ensemble, ces deux cartes contiennent plus de deux cents puces, r√©sistances et EPROM.  Comprendre tout cela uniquement sur la base de num√©ros de s√©rie prendrait beaucoup de temps.  Mais, de fa√ßon surprenante, parfois dans des appareils des ann√©es 90, la documentation est d√©couverte accidentellement.  Et dans le cas de NBA Jam, elle √©tait tout simplement g√©niale. <br><br><h2>  Architecture de l'unit√© T √† mi-chemin </h2><br>  √Ä la recherche de donn√©es, je suis tomb√© sur un kit de confiture NBA.  Le niveau de d√©tail de ce document est √©tonnant <sup>[7]</sup> .  Entre autres choses, j'ai r√©ussi √† trouver une description d√©taill√©e des connexions de c√¢blage, y compris les EPROM et les puces. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e2/f43/ef7/3e2f43ef76224de29c2376514fdfea3b.jpg" width="100%"></div><br>  Les informations du document nous ont permis de dessiner un sch√©ma des planches et de d√©terminer la fonction de chaque pi√®ce.  Pour aider √† la recherche de composants, la carte a des coordonn√©es avec un d√©but dans le coin inf√©rieur droit (UA0), augmentant jusqu'au coin sup√©rieur gauche (UJ26). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/552/c6d/525/552c6d5257527f5a7c8655eb51acfdd9.svg" width="100%"></div><br>  Le c≈ìur de la carte principale est le Texas Instrument TMS34010 (UB21) avec une fr√©quence de 50 MHz et avec un code de 1 m√©gaoctet dans les EPROM et une DRAM de 512 kibio <sup>[8]</sup> .  34010 est une puce 32 bits avec un bus 16 bits, qui a des instructions graphiques remarquables comme PIXT et PIXBLT <sup>[9]</sup> .  Au d√©but des ann√©es 90, cette puce √©tait utilis√©e dans plusieurs cartes d'acc√©l√©ration mat√©rielle <sup>[10]</sup> , et je pensais qu'elle g√®re une quantit√© consid√©rable d'effets graphiques.  √âtonnamment, il ne traite que de la logique du jeu et ne dessine rien. <br><br>  En fait, la puce UE13 appel√©e ¬´DMA2¬ª s'est av√©r√©e √™tre un monstre graphique.  Selon les sch√©mas de la documentation, il poss√®de un impressionnant (√† l'√©poque) bus de donn√©es 32 bits et bus d'adresse 32 bits, c'est pourquoi il est devenu la plus grande puce de la carte.  Ce circuit int√©gr√© sp√©cialis√© (ASIC) est capable de nombreuses op√©rations graphiques, dont je parlerai ci-dessous. <br><br>  Toutes les puces (RAM syst√®me, EPROM GFX, SDRAM de palette, code, banques vid√©o) sont mapp√©es sur un espace d'adressage 32 bits et connect√©es au m√™me bus.  Je n'ai pas pu trouver d'informations sur le protocole de bus, donc si vous en savez quelque chose, √©crivez √† l'e-mail. <br><br>  Faites attention √† une astuce: un composant EPROM (marqu√© en bleu) est utilis√© pour cr√©er un autre syst√®me de stockage (et √©conomiser de l'argent).  Ces EPROM de 512 kb ont des broches d'adresse 32 bits et des broches de donn√©es 8 bits.  Pour le 34010, qui n√©cessite un bus de donn√©es 16 bits, deux EPROM (J12 et G12) sont connect√©es avec une double alternance d'adresses, cr√©ant une m√©moire de 1 m√©gaoctet.  De m√™me, les ressources graphiques sont connect√©es avec une alternance quadruple d'adresses pour former une adresse 32 bits avec un syst√®me de stockage 32 bits contenant 8 m√©gaoctets. <br><br>  Bien que dans cet article, je consid√®re principalement le pipeline graphique, je ne r√©siste pas √† la tentation, et je vais donc bri√®vement parler du syst√®me audio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26b/07c/c13/26b07cc13020639a04bc7f25b5ef0117.svg" width="55%"></div><br>  Le sch√©ma de la carte son montre le Motorola 6809 (U4 avec une fr√©quence de 2 MHz), qui re√ßoit des instructions d'une EPROM (U3) pour contr√¥ler la musique et les effets sonores. <br><br>  La puce de synth√®se FM 2151 (3,5 MHz) de Yamaha g√©n√®re de la musique directement √† partir des instructions re√ßues du 6809 (la musique utilise une bande passante assez petite). <br><br>  OKI6295 (1 MHz) est responsable de la lecture audio num√©rique au format ADPCM (par exemple, le l√©gendaire ¬´Boomshakalaka¬ª <sup>[11]</sup> Tim Kittsrow). <br><br>  Notez que sur la carte principale, les m√™mes EPROM bleu 512 Ko 32a / 8d sont utilis√©es dans un syst√®me 16 bits avec double entrelacement d'adresses pour stocker des voix num√©ris√©es, mais pour les instructions 8 bits, les donn√©es / adresses de Motorola 6809 ne sont pas entrelac√©es. <br><br><h2>  Dur√©e de vie du cadre </h2><br>  L'√©cran NBA Jam entier est index√© dans une palette 16 bits.  Les couleurs sont stock√©es au format xRGB 1555 dans une palette de 64 Ko.  La palette est divis√©e en 128 blocs (256 * 16 bits) de 512 octets.  Les sprites stock√©s dans l'EPROM sont marqu√©s comme ¬´GFX¬ª.  Chaque sprite a sa propre palette de couleurs jusqu'√† 256x16 bits.  Un sprite utilise souvent un bloc de palette entier, mais jamais plus d'un.  Un signal CRT est transmis au moniteur √† l'aide de RAMDAC, qui pour chaque pixel lit l'index des banques de DRAM vid√©o et effectue une recherche de couleur dans la palette. <br><br>  La dur√©e de vie de chaque image d'une vid√©o NBA Jam se d√©roule comme suit: <br><br><ol><li>  La logique de jeu consiste en un flux d'instructions 16 bits transmises de J12 / G12 √† 34010. </li><li>  34010 lit l'entr√©e du joueur, calcule l'√©tat du jeu, puis dessine un √©cran. </li><li>  Pour dessiner sur l'√©cran, 34010 trouve d'abord un bloc inutilis√© dans la palette et y √©crit la palette de sprites (les palettes de sprites sont stock√©es avec les instructions 34010 dans J12 / G12). </li><li>  34010 fait une demande √† DMA2, qui comprend l'adresse et la taille du sprite, le bloc de palette 8 bits utilis√©, la troncature, la mise √† l'√©chelle, la m√©thode de traitement des pixels transparents, etc. </li><li>  DMA2 lit les index de sprites 8 bits de la puce ROM J14-G23 GFX, combine cette valeur avec l'index d'un bloc de palette 8 bits et √©crit un index 16 bits dans les banques vid√©o.  La DRAM2 peut √™tre consid√©r√©e comme un blitter qui lit les valeurs 8 bits de l'EPROM GFX et √©crit les valeurs 16 bits dans les banques vid√©o </li><li>  Les √©tapes 3 √† 5 sont r√©p√©t√©es jusqu'√† ce que toutes les demandes de dessin de sprites soient termin√©es. </li><li>  Lorsqu'il s'agit de rafra√Æchir l'√©cran, RAMDAC convertit les donn√©es des banques vid√©o en un signal qu'un moniteur CRT peut comprendre.  Pour que la bande passante soit suffisante pour convertir l'index 16 bits en RVB 16 bits, la palette est stock√©e dans une SRAM extr√™mement co√ªteuse et extr√™mement rapide. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f95/cca/564/f95cca564f1eb585bce4cf20470590b1.jpg" width="30%"></div><br>  <u><b>Un fait int√©ressant: le</b></u> firmware flash EPROM n'est pas un processus aussi simple.  Avant d'√©crire sur la puce, vous devez effacer compl√®tement tout son contenu. <br><br>  Pour ce faire, la puce doit √™tre irradi√©e avec une lumi√®re UV.  Vous devez d'abord d√©coller l'autocollant du haut de l'EPROM pour ouvrir son diagramme.  L'EPROM est ensuite plac√©e dans un dispositif de gomme sp√©cial dans lequel se trouve une lampe UV. <br><br>  Apr√®s 20 minutes, l'EPROM sera remplie de z√©ros et pr√™te pour l'enregistrement. <br><br><h2>  Documentation MAME </h2><br>  Apr√®s avoir compris l'√©quipement, j'ai r√©alis√© quel ensemble d'EPROM vous pouviez √©crire √† Michael Jordan (la palette est stock√©e dans les EPROM de code et les indices dans les EPROM de GFX).  Cependant, je ne connaissais toujours pas l'emplacement exact ni le format utilis√©. <br><br>  Documentation manquante trouv√©e dans MAME. <br><br>  Dans le cas o√π vous ne savez pas comment fonctionne cet √©mulateur incroyable, je vais vous expliquer bri√®vement.  MAME est bas√© sur le concept de "drivers", qui sont une imitation de la planche.  Chaque pilote est compos√© de composants qui imitent (g√©n√©ralement) chaque puce.  Dans le cas de Midway T-Unit, nous sommes int√©ress√©s par les fichiers suivants: <br><br><pre>  mame / includes / midtunit.h
 mame / src / mame / video / midtunit.cpp
 mame / src / mame / drivers / midtunit.cpp
 mame / src / mame / machine / midtunit.cpp
 cpu / tms34010 / tms34010.h </pre><br>  Si vous regardez drivers / midtunit.cpp, nous verrons que chaque puce m√©moire fait partie d'un seul espace d'adressage 32 bits.  Il peut √™tre vu √† partir du code source du pilote que la palette commence √† 0x01800000, gfxrom commence √† 0x02000000 et la puce DMA2 commence √† 0x01a80000.  Pour suivre le chemin des donn√©es, nous devons suivre les fonctions C ++ ex√©cut√©es lorsque l'objet de l'op√©ration de lecture ou d'√©criture est l'adresse m√©moire. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> midtunit_state::main_map(address_map &amp;<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>.unmap_value_high(); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x00000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x003fffff</span></span>).rw(m_video, FUNC(midtunit_vram_r), FUNC(midtunit_vram_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x013fffff</span></span>).ram(); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01400000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0141ffff</span></span>).rw(FUNC(midtunit_cmos_r), FUNC(midtunit_cmos_w)).share(<span class="hljs-string"><span class="hljs-string">"nvram"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01480000</span></span>, <span class="hljs-number"><span class="hljs-number">0x014fffff</span></span>).w(FUNC(midtunit_cmos_enable_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160000f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN0"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600010</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160001f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600020</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160002f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN2"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600030</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160003f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"DSW"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01800000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0187ffff</span></span>).ram().w(m_palette, FUNC(write16)).share(<span class="hljs-string"><span class="hljs-string">"palette"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01a80000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01a800ff</span></span>).rw(m_video, FUNC(midtunit_dma_r), FUNC(midtunit_dma_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01b00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01b0001f</span></span>).w(m_video, FUNC(midtunit_control_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d0001f</span></span>).r(FUNC(midtunit_sound_state_r)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d01020</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d0103f</span></span>).rw(FUNC(midtunit_sound_r), FUNC(midtunit_sound_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d81060</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d8107f</span></span>).w(<span class="hljs-string"><span class="hljs-string">"watchdog"</span></span>, FUNC(watchdog_timer_device::reset16_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01f00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01f0001f</span></span>).w(m_video, FUNC(midtunit_control_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x02000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x07ffffff</span></span>).r(m_video, FUNC(midtunit_gfxrom_r)).share(<span class="hljs-string"><span class="hljs-string">"gfxrom"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x1f800000</span></span>, <span class="hljs-number"><span class="hljs-number">0x1fffffff</span></span>).rom().region(<span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* mirror used by MK*/</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0xff800000</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>).rom().region(<span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  √Ä la fin du m√™me fichier ¬´drivers / midtunit.cpp¬ª, nous voyons comment le contenu des EPROM est charg√© dans la RAM.  Dans le cas des ressources graphiques ¬´gfxrom¬ª (associ√©es √† l'adresse 0x02000000), nous pouvons voir qu'elles s'√©tendent sur 8 m√©gaoctets d'espace d'adressage dans les blocs de puces avec une alternance quadruple d'adresses.  Notez que les noms de fichiers correspondent √† l'emplacement des puces (par exemple, UJ12 / UG12).  L'ensemble de ces fichiers EPROM dans le monde des √©mulateurs est mieux connu sous le nom de ¬´ROM¬ª. <br><br><pre> <code class="cpp hljs">ROM_START( nbajamte ) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0x50000</span></span>, <span class="hljs-string"><span class="hljs-string">"adpcm:cpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* sound CPU*/</span></span> ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u3_sound_rom.u3"</span></span>, <span class="hljs-number"><span class="hljs-number">0x010000</span></span>, <span class="hljs-number"><span class="hljs-number">0x20000</span></span>, NO_DUMP) ROM_RELOAD( <span class="hljs-number"><span class="hljs-number">0x030000</span></span>, <span class="hljs-number"><span class="hljs-number">0x20000</span></span> ) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0x100000</span></span>, <span class="hljs-string"><span class="hljs-string">"adpcm:oki"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* ADPCM*/</span></span> ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u12_sound_rom.u12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u13_sound_rom.u13"</span></span>, <span class="hljs-number"><span class="hljs-number">0x080000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_REGION16_LE( <span class="hljs-number"><span class="hljs-number">0x100000</span></span>, <span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* 34010 code*/</span></span> ROM_LOAD16_BYTE( <span class="hljs-string"><span class="hljs-string">"l4_nba_jam_tournament_game_rom_uj12.uj12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD16_BYTE( <span class="hljs-string"><span class="hljs-string">"l4_nba_jam_tournament_game_rom_ug12.ug12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x00001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0xc00000</span></span>, <span class="hljs-string"><span class="hljs-string">"gfxrom"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug14.ug14"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj14.uj14"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug19.ug19"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj19.uj19"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug16.ug16"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj16.uj16"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug20.ug20"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj20.uj20"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug17.ug17"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj17.uj17"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug22.ug22"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj22.uj22"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug18.ug18"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj18.uj18"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug23.ug23"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj23.uj23"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_END</code> </pre> <br>  <b><u>Un fait int√©ressant:</u></b> dans l'exemple de code ci-dessus, le dernier param√®tre de la fonction a √©t√© remplac√© par ¬´NO_DUMP¬ª afin que les EPROM modifi√©es puissent √™tre charg√©es.  Ces champs sont g√©n√©ralement <sup>[12]</sup> un hachage CRC / SHA1 du contenu de l'EPROM.  C'est ainsi que MAME d√©termine quel jeu appartient √† la ROM et vous permet de savoir que l'une des ROM de l'ensemble est manquante ou endommag√©e. <br><br><h2>  Moteur vid√©o Heart: DMA2 </h2><br>  La cl√© pour comprendre le format graphique est la fonction qui traite l'√©criture / lecture DMA dans 256 registres DMA2 situ√©s aux adresses de 0x01a80000 √† 0x01a800ff.  Tout le travail acharn√© de la r√©tro-ing√©nierie a d√©j√† √©t√© effectu√© par les d√©veloppeurs de MAME.  Ils ont m√™me pris le temps de bien documenter le format de commande. <br><br><pre>  Registres DMA
  ------------------

   S'inscrire |  Bit |  Candidature
  ---------- + - FEDCBA9876543210 - + ------------
      0 |  xxxxxxxx -------- |  pixels supprim√©s au d√©but de chaque ligne
            |  -------- xxxxxxxx |  pixels supprim√©s √† la fin de chaque ligne
      1 |  x --------------- |  activer l'enregistrement (ou effacer si z√©ro)
            |  -421 ------------ |  images bpp (0 = 8)
            |  ---- 84 ---------- |  passer la taille apr√®s = (1 &lt;&lt; x)
            |  ------ 21 -------- |  passer la taille jusqu'√† = (1 &lt;&lt; x)
            |  -------- 8 ------- |  activer le saut avant / apr√®s
            |  --------- 4 ------ |  activer la troncature
            |  ---------- 2 ----- |  y miroir
            |  ----------- 1 ---- |  x mise en miroir
            |  ------------ 8 --- |  transf√©rer des pixels non nuls sous forme de couleurs
            |  ------------- 4-- |  transmission de z√©ro pixel sous forme de couleurs
            |  -------------- 2- |  transmission de pixels non nulle
            |  --------------- 1 |  transmission z√©ro pixel
      2 |  xxxxxxxxxxxxxxxx |  adresse source mot bas
      3 |  xxxxxxxxxxxxxxxx |  adresse source de mot √©lev√©e
      4 |  ------- xxxxxxxxx |  x destinataire
      5 |  ------- xxxxxxxxx |  destinataire
      6 |  ------ xxxxxxxxxx |  colonnes d'images
      7 |  ------ xxxxxxxxxx |  lignes d'image
      8 |  xxxxxxxxxxxxxxxx |  palette
      9 |  xxxxxxxxxxxxxxxx |  couleur
     10 |  --- xxxxxxxxxxxxx |  √©chelle x
     11 |  --- xxxxxxxxxxxxx |  √©chelle y
     12 |  ------- xxxxxxxxx |  coupe haut / gauche
     13 |  ------- xxxxxxxxx |  coupe en bas / √† droite
     14 |  ---------------- |  le test
     15 |  xxxxxxxx -------- |  octet de d√©tection z√©ro
            |  -------- 8 ------- |  page suppl√©mentaire
            |  --------- 4 ------ |  taille du destinataire
            |  ---------- 2 ----- |  s√©lection du bord sup√©rieur / inf√©rieur ou gauche / droit pour le registre 12/13 </pre><br>  Il existe m√™me une fonction de d√©bogage qui vous permet d'enregistrer les sprites d'origine dans le processus de transfert vers DMA2 (la fonction a √©t√© √©crite par un participant de longue date du projet MAME, Ryan Holtz <sup>[13]</sup> ).  Il me suffisait de simplement jouer au jeu pour que tous les fichiers contenant des m√©tadonn√©es soient enregistr√©s sur le disque. <br><br>  Il s'est av√©r√© que les sprites sont constitu√©s d'√©l√©ments simples d'une palette 16 bits sans compression.  Cependant, tous les sprites n'ont pas le m√™me nombre de couleurs.  Certains sprites n'utilisent que 16 couleurs avec des indices de couleur 4 bits, tandis que d'autres utilisent 256 couleurs et n√©cessitent des indices de couleur 8 bits. <br><br><h2>  Patch </h2><br>  Maintenant, je connais l'emplacement et le format des sprites, il reste donc √† effectuer le minimum d'ing√©nierie inverse.  J'ai √©crit un petit programme sur Golang pour √©liminer l'alternance des ¬´code¬ª et ¬´gfx¬ª des EPROM.  En √©liminant l'entrelacement, il est facile de rechercher des valeurs ASCII ou connues, car j'ai travaill√© exactement avec ce √† quoi ressemble la RAM pendant l'ex√©cution du programme. <br><br>  Apr√®s cela, vous pouvez facilement trouver les caract√©ristiques du lecteur.  Il s'est av√©r√© qu'ils √©taient tous stock√©s les uns apr√®s les autres au format big-endian 16 bits non sign√© (ce qui est tr√®s logique, car le 34010 fonctionne avec le big-endian).  J'ai ajout√© un patcher pour modifier les attributs du joueur.  Pas vraiment passionn√© de basket-ball, j'ai entr√© SPEED = 9, 3 PTS = 9, DUNKS = 9, PASS = 9, POWER = 9, STEAL = 9, BLOCK = 9 et CLTCH = 9. <br><br>  J'ai √©galement √©crit le code pour patcher le jeu avec de nouveaux sprites avec la seule restriction - les nouveaux sprites devraient avoir les m√™mes tailles que les rempla√ßables.  Pour la photo MJ, j'ai cr√©√© un PNG index√© de 256 couleurs (vous pouvez le voir <a href="">ici</a> ). <br><br>  Enfin, j'ai ajout√© du code pour convertir le format interm√©diaire au format entrelac√© pour l'√©criture dans des fichiers EPROM individuels. <br><br><h2>  D√©marrez le jeu </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca2/427/e60/ca2427e606192878c8c2a116b73e821e.png" width="49%"></div><br>  Apr√®s avoir corrig√© le contenu de l'EPROM, l'outil de diagnostic NBAJam a montr√© que le contenu de certaines puces est marqu√© comme ¬´BAD¬ª.  Je m'y attendais car je n'ai corrig√© que le contenu des EPROM, mais je n'ai pas pris la peine de rechercher le format CRC et m√™me leur emplacement de stockage. <br><br>  Les EPROM GFX sont marqu√©es en rouge (UG16 / UJ16, UG17 / UJ17, UG18 / UJ18, UG20 / UJ20, UG22 / UJ22 et UG23 / UJ23), car elles contiennent des images que j'ai modifi√©es.  Les deux EPROM dans lesquelles les instructions (UG12 et UJ12) sont stock√©es sont √©galement rouges, car il existe des palettes. <br><br>  Heureusement, ici, les CRC ne sont pas utilis√©s pour prot√©ger contre le contenu modifi√© et sont uniquement n√©cessaires pour v√©rifier l'int√©grit√© des puces.  Le jeu a commenc√©.  Et gagn√©! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0e/341/ad0/e0e341ad08eaace26ce47cae7a7758cb.png" width="100%"></div><br><h2>  Hasta La Vista, b√©b√©! </h2><hr><br>  Ayant fini avec des difficult√©s techniques, j'ai rapidement perdu tout int√©r√™t pour l'outil et arr√™t√© de le d√©velopper.  Id√©es pour ceux qui veulent jouer avec le code: <br><br><ul><li>  Ajoutez √† la Conf√©rence Est des Raptors de Toronto. </li><li>  Ajoutez la possibilit√© de changer les noms des joueurs.  Malheureusement, ils ne sont pas constitu√©s d'ASCII, mais sont des images pr√©-g√©n√©r√©es. </li></ul><br><h2>  Livre sur NBA Jam </h2><br>  Si vous √™tes un fan de la NBA Jam, alors Reyan Ali a √©crit un livre entier √† son sujet <sup>[14]</sup> .  Vous pouvez l'acheter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h2>  Code source </h2><br>  Si vous souhaitez contribuer ou simplement voir comment tout fonctionne, la source compl√®te est t√©l√©charg√©e sur github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h2>  Les r√©f√©rences </h2><br>  [1] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´NJA Jam¬ª par Reyan Ali</a> <br><br>  [2] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´NJA Jam¬ª par Reyan Ali</a> <br><br>  [3] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´NJA Jam¬ª par Reyan Ali</a> <br><br>  [4] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mortal Kombat 1 dans les coulisses</a> <br><br>  [5] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´NJA Jam¬ª par Reyan Ali</a> <br><br>  [6] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4: 3 contre pixels carr√©s</a> <br><br>  [7] Commentaire: Malheureusement, l'√®re de cette excellente documentation est r√©volue depuis longtemps <br><br>  [8] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©cran de d√©marrage de Mame NBA Jam</a> <br><br>  [9] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jeu d'instructions TMS34010</a> <br><br>  [10] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T34010 Guide de l'utilisateur</a> <br><br>  [11] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NBA Jam - vid√©o BoomShakaLaka</a> <br><br>  [12] Source: <a href="">MAME T-Unit driver.cpp</a> <br><br>  [13] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commit 'midtunit.cpp: Ajout d'une visionneuse DMA-blitter optionnelle'</a> <br><br>  [14] Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´NBA JAM Book¬ª par Reyan Ali</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473660/">https://habr.com/ru/post/fr473660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473648/index.html">Le cheval est mort - Cri: transition du tslint au eslint</a></li>
<li><a href="../fr473652/index.html">Cr√©ation d'une API REST avec Node.js et une base de donn√©es Oracle. Partie 5</a></li>
<li><a href="../fr473654/index.html">Compositeur PHP: corriger les d√©pendances sans douleur</a></li>
<li><a href="../fr473656/index.html">Exp√©rience de g√©n√©rateur de site statique Hugo</a></li>
<li><a href="../fr473658/index.html">G√©rer les bogues dans Go 1.13</a></li>
<li><a href="../fr473664/index.html">Exp√©rience d'apprentissage de premi√®re main. Yandex.Practicum - Analyste de donn√©es</a></li>
<li><a href="../fr473666/index.html">En tant qu'√©crivain de science-fiction, Arthur Clark a presque ferm√© la revue Tech - Youth</a></li>
<li><a href="../fr473668/index.html">Pourquoi Bitrix - Bitrix</a></li>
<li><a href="../fr473670/index.html">Stoloto: comment introduire un mobile √† la loterie</a></li>
<li><a href="../fr473672/index.html">Pourquoi, Bitrix? Ou le monde des f√©es 1C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>