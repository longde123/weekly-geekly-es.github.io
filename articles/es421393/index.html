<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöø ü§≤üèΩ üéê Abandoned Mailchimp Basket: A Guide for the Lazy üíì üëåüèø üõÄüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Primero, un poco despotricando :) Tarde o temprano, cualquier tienda en l√≠nea tiene la cuesti√≥n de configurar una canasta abandonada. Las estad√≠sticas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Abandoned Mailchimp Basket: A Guide for the Lazy</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421393/">  Primero, un poco despotricando :) Tarde o temprano, cualquier tienda en l√≠nea tiene la cuesti√≥n de configurar una canasta abandonada.  Las estad√≠sticas y la sensaci√≥n de p√©rdida de dinero chupando el est√≥mago no ahorran a nadie. <br><br><h4>  Porcentaje de cestas abandonadas de 2006 a 2017 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/77d/91a/a3977d91a0ebd3217886009fec230985.jpg" alt="Porcentaje de cestas abandonadas de 2006 a 2017"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente</a></i> <br><br>  Porcentaje de cestas abandonadas para el primer trimestre de 2018 por industria: <br><img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/be6/6332b5be64d04bbd4ca0d1defe9e7b14.jpg" alt="Porcentaje de cestas abandonadas para el primer trimestre de 2018 por industria"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente</a></i> <br><br>  Al mismo tiempo, a pesar de las estad√≠sticas generalmente disponibles, la mayor√≠a de las tiendas en l√≠nea no utilizan las funciones disponibles y no conectan una cesta abandonada.  Un reciente estudio "en casa" de EmailSoldiers muestra claramente que la mayor√≠a de las tiendas no se preocupan en absoluto. <br><a name="habracut"></a><br><h4>  Estad√≠sticas actuales de cestas abandonadas conectadas </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/b56/83f/fd4b5683f724d5004046e14523b95f69.jpg" alt="Investigaci√≥n de soldados por correo electr√≥nico"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente</a></i> <br><br>  Al mismo tiempo, todos (y nosotros tampoco somos santos) nos ponemos al d√≠a con el tr√°fico, publicamos anuncios y creatividades, pero ni siquiera intentamos devolver a la persona que rompi√≥ en el √∫ltimo momento. <br><br>  Pero en la primera iteraci√≥n puede obtener un aumento en los pedidos utilizando una carta sin contenido din√°mico, solo necesita configurarlo.  Haga un esfuerzo solo una vez para que en el fondo traiga dinero, ¬øno es esto un cuento de hadas? <br><br>  Naturalmente, una carta con contenido din√°mico en el que se extraen productos de la cesta puede funcionar mejor.  O tal vez otro gatito con ojos tristes ser√° m√°s influyente para tu audiencia.  O bien, lleva los productos recomendados a los productos en la canasta y observa que se compran con mayor frecuencia en cartas y aumenta el cheque promedio.  O podr√° obtener una serie de letras a partir de las cuales la conversi√≥n ser√° a√∫n mayor. <br><br>  Puede mejorar y probar letras de una cesta abandonada a un ideal inalcanzable, pero cualquier letra configurada ya es incomparablemente mejor que nada. <br><br><h4>  Conversi√≥n para una cesta abandonada seg√∫n RetailRocket </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/2f9/684/df22f968450761e23695591fcd2931af.jpg" alt="RetailRocket abandon√≥ la conversi√≥n de la cesta"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuente</a></i> <br><br>  Y as√≠, el camarada <a href="">Artem Aleksandrov y yo</a> comenzamos la introducci√≥n de la canasta desde dos lados. <br><br><h2>  Implementaci√≥n t√©cnica </h2><br><h4>  TOR para la integraci√≥n </h4><br>  Describa brevemente la esencia de la tarea. <br><br>  Tarea: conectar un carrito abandonado para el sitio xxx.xx con el servicio de correo Mailchimp <br><br>  Repartimos todos los materiales necesarios. <br><br>  Clave API: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-usXX <br><br>  ¬øD√≥nde conseguir la llave? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/511/fc0/f9f511fc0d1ff7d44d41d19463cd362e.jpg" alt="¬øD√≥nde conseguir la llave?"><br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Damos un enlace a la documentaci√≥n</a> <br><br>  ID de la hoja a la que conectamos la Tienda: XXXXXXXXXX <br><br>  ¬øD√≥nde puedo obtener la identificaci√≥n de la hoja? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/996/6cb/2159966cb62dc60e25079b86c5905aca.jpg" alt="¬øD√≥nde puedo obtener la identificaci√≥n de la hoja?"><br><br>  Se debe crear un servicio de correo por adelantado.  Tan pronto como el servicio de correo recibe la solicitud de API, el mensaje se genera autom√°ticamente y el destinatario se agrega a la cola para su env√≠o. <br><br>  Para nuestro caso, elegimos la siguiente l√≥gica para enviar una cesta abandonada: <br>  un usuario autorizado en el sitio agrega productos a la cesta, no completa la transacci√≥n y no completa el pedido, la cesta permanece sin cambios durante 1 hora.  Despu√©s de eso, se env√≠a una solicitud a Mailchimp, en la que se transmite el correo electr√≥nico, la composici√≥n del pedido del usuario, las im√°genes del producto, el precio de los productos y un enlace a la cesta del usuario. <br><br><h4>  Plantilla de dise√±o </h4><br>  Al crear la automatizaci√≥n para una cesta abandonada, el mailchim pregunta inmediatamente si habr√° una o varias letras y sugiere elegir una tienda conectada. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/288/b80/12d288b80aed84cc9ac1b3b81b4d3d6d.jpg" alt="Crear automatizaci√≥n para un carrito abandonado en Mailchimp"><br><br>  En las plantillas b√°sicas, mch ofrece una opci√≥n de tres piezas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f2/402/d62/7f2402d625f7174f3a18f42849080bea.jpg" alt="Seleccione letras para una cesta abandonada de Mailchimp"><br><ol><li>  Cesta abandonada con bienes din√°micos </li><li>  Canasta abandonada con recomendaciones de comestibles (debe configurarse por separado) </li><li>  Cesta abandonada sin productos (solo una carta de texto) </li></ol><br>  En las mejores tradiciones, si tienes tiempo, puedes hacer la canasta t√∫ mismo. <br><br>  Los productos din√°micos sin estilos se ven as√≠ (olv√≠date de la sangr√≠a, aqu√≠ se muestran feos): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> *|ABANDONED_CART:[$total=3]|* <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|CART:URL|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:TITLE|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:IMAGE_URL|*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> *|PRODUCT:TITLE|* ‚Äî *|PRODUCT:PRICE|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Parece que si cambia el n√∫mero en la variable <b>* | ABANDONED_CART: [$ total = 3] | *</b> , entonces la letra mostrar√° una cantidad diferente de productos, pero no, al menos 5, al menos 100, el mch se niega a mostrar otra cantidad. <br><br>  Y, lo que tambi√©n es un poco extra√±o, la variable <b>* | PRODUCTO: PRECIO | *</b> se reemplaza con los valores de formato RUB288, y por alguna raz√≥n tambi√©n es imposible cambiar esto, pero m√°s sobre eso m√°s adelante. <br><br>  Para un cambio, tratamos de sustituir las variables con el n√∫mero de juegos y con el costo total del pedido, que transmitimos a trav√©s de la API, pero el mailchimp aqu√≠ dijo que no.  Bueno, que as√≠ sea. <br><br><h4>  Una palabra para el programador :) </h4><br>  Con mailchimp hubo una experiencia hist√≥rica de integraci√≥n con su mandril de servicio de terceros, todo es simple y claro.  Documentaci√≥n muy amigable (por supuesto, en ingl√©s), pero no hubo bordes √°speros y funcion√≥ desde el primer puntapi√©. <br><br>  Adem√°s, se ha introducido un mecanismo de suscripci√≥n a trav√©s de formularios especiales en nuestro sitio.  Aqu√≠, sentimos completamente el eufemismo y la ambig√ºedad de la documentaci√≥n de mailchimp.  El ingl√©s no es un problema para un desarrollador experimentado, pero el conocimiento del dialecto klingon no est√° impl√≠cito por defecto. <br><br>  Los datos iniciales son: el lenguaje php7 y el marco yii2, que ya ha crecido abrumadoramente con su ecosistema.  Es decir  Ya tenemos 6 peque√±os proyectos que est√°n tratando de usar componentes comunes tanto en el backend como en el front-end.  En consecuencia, la implementaci√≥n de cualquier tarea requiere resolver su proyecto de forma independiente, pero esto no implica independencia del marco, porque  hay que pagarlo con horas humanas, de las cuales siempre hay escasez. <br><br>  Habiendo recibido la tarea de integraci√≥n, primero debemos mirar alrededor.  ¬øQu√© se nos da?  En primer lugar, el servicio de mailchimp con el que necesitas hacerte amigo.  Vamos al github y vemos que hay muchas implementaciones.  Pero la elecci√≥n es simple: el paquete m√°s popular de 1.5k estrellas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">drewm / mailchimp-api</a> ). <br><br>  El paquete proporciona un contenedor simple sobre la interacci√≥n de descanso con un mailchimp.  Solo podemos adquirir esto con nuestra l√≥gica. <br><br>  En segundo lugar, se nos entrega <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> .  Seg√∫n la documentaci√≥n, tenemos un recurso de Tienda con recursos anidados: Carrito, Cliente, Pedido, Producto, Regla de promoci√≥n.  Para una cesta abandonada sin productos recomendados, solo necesitamos Producto, Carrito y Cliente.  El carrito, a su vez, consiste en el conjunto de l√≠neas del carrito, y el producto contiene variantes del producto. <br><br>  Descomponemos la tarea de la siguiente manera: <br><br><ol><li>  Subir datos de la tienda a las tiendas </li><li>  Descargue todos los productos que se pueden comprar en Productos </li><li>  Configure la carga de cestas con los usuarios en un horario </li></ol><br>  Ok, vamos  En primer lugar, asumimos la esencia de la "tienda".  Decidimos usar de inmediato la versi√≥n de prueba y combate de la tienda y, dependiendo de la variable de entorno responsable del modo de soltera / producto, trabajamos con una tienda o con otra. <br><br>  Para descargar los datos de la tienda, llamamos a una solicitud posterior en / ecommerce / stores con el siguiente conjunto de par√°metros: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'list_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'****'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'*** - test'</span></span>, <span class="hljs-string"><span class="hljs-string">'domain'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'admin@***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary_locale'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'money_format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'‚ÇΩ'</span></span>, ]</code> </pre> <br>  Hay varias opciones m√°s, pero todo depende de las necesidades.  Porque  no √≠bamos a utilizar los datos de contacto de la tienda en letras, no completamos los campos de tel√©fono, direcci√≥n, zona horaria, etc. <br>  Pero nos esperaba una peque√±a sorpresa.  El campo money_format parece estar especialmente creado para poder presentar el precio en un formato conveniente para nosotros.  Pero cuando se construye una plantilla de canasta abandonada, el mailchip sustituye obstinadamente RUB antes del n√∫mero.  Mailchimp, para! <br><br>  Despu√©s de la descarga, podemos verificar los datos utilizando la solicitud get en la direcci√≥n / ecommerce / stores para ver todas las tiendas cargadas, o / ecommerce / stores / {id} para obtener datos en una tienda en particular. <br><br>  Ahora puede agregar todos los dem√°s datos, porque la Tienda es el punto ra√≠z en nuestro √°rbol de datos, porque  Subiremos todos los dem√°s datos a una tienda espec√≠fica. <br><br>  Entonces, para que el MCH pueda sustituir bienes en una canasta abandonada, necesita alimentarlos.  Para hacer esto, tenemos la direcci√≥n / ecommerce / stores / {store_id} / products, donde enviamos solicitudes posteriores para crear productos en el sistema. <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'kastrulya'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' ‚Äî    .  ,       .  ,        !           !'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vendor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'variants'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">890</span></span>, <span class="hljs-string"><span class="hljs-string">'sku'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'KA453'</span></span>, <span class="hljs-string"><span class="hljs-string">'inventory_quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'visibility'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'visible'</span></span>, ], ], ]</code> </pre><br>  ¬øQu√© es tan notable?  Bueno, en primer lugar, cada producto debe consistir en al menos una oferta de producto.  En esencia, Product es un contenedor para cargar ofertas de productos.  Adem√°s, la identificaci√≥n del producto y la oferta de productos pueden cruzarse, porque estos son recursos diferentes en la API de MCH. <br><br>  Y aqu√≠ comenz√≥ la subestimaci√≥n de la documentaci√≥n de MCH.  Ten√≠a que adivinar, aunque no fuera dif√≠cil, pero pod√≠as hacerlo normalmente, y no como siempre. <br><br>  El campo del identificador se ha descrito como "el identificador de un producto".  Ok, despu√©s de consultar, decidimos que esto es parte de la URL relacionada con el producto en s√≠ (cnc).  Pero esto se confirm√≥ solo durante las pruebas. <br><br>  Tambi√©n puede adjuntar una serie de im√°genes al producto, pero decidimos que no ser√≠a √∫til para nosotros y, por lo tanto, solo la imagen principal se carg√≥ tanto en el producto como en cada oferta de producto. <br><br>  Y aqu√≠ tuvimos un problema, por alguna raz√≥n, los productos no aparec√≠an en las plantillas de correo. <br><br>  Comenzamos a cavar en el muelle de Producto.  Y encontraron un campo de visibilidad con una lujosa descripci√≥n: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/525/123/aae/525123aae8eff2a8a1a595072d92b2f6.jpg" alt="descripci√≥n del campo de visibilidad"><br><br>  Bueno, escribe String!  ¬øY qu√© se puede transferir all√≠?  ¬øPor qu√© es imposible describir todos los significados posibles?  Puedo enviar all√≠, por ejemplo, "¬°mu√©strame por favor!". <br><br>  Afortunadamente hay una solicitud de ejemplo! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/e08/dbe/57be08dbe97502fc302cc4de5dc0e4bf.jpg" alt="solicitar ejemplo"><br><br>  Bueno, esto no cancela el problema.  No s√© qu√© otros valores pueden ser √∫tiles. <br><br>  ¬°Todos se las arreglaron con esto!  Ahora, el comercializador de correo electr√≥nico puede verificar la disponibilidad de productos en el sistema mediante la creaci√≥n de una plantilla con la participaci√≥n de productos o todo a trav√©s de las mismas solicitudes de obtenci√≥n que utilizan la consola. <br><br>  A continuaci√≥n, nos enfrentamos a la tarea de cargar cestas abandonadas en el MCH.  Inicialmente, me vinieron a la mente 2 opciones: <br><br><ol><li>  Cada vez que cambia la cesta (agregar / quitar productos), repetimos esta acci√≥n en MCH.  De las desventajas, se sugiere inmediatamente una gran cantidad de solicitudes a un servicio externo. </li><li>  Una vez cada n minutos, observe las canastas que no han cambiado hace m√°s de una hora.  Luego los enviamos al MCH.  Solo hay un problema: hacer un seguimiento de las canastas que se reanudaron despu√©s de que fueron al MCH. </li></ol><br>  Primero, solicitamos a nuestra base de datos (en lo sucesivo, DB) nuestros datos en una ventana de 1 hora a 3. ¬øPor qu√© 3?  Una hora despu√©s del √∫ltimo cambio, enviamos la cesta al sistema.  En el MCH, el intervalo m√≠nimo posible para enviar la cesta es de 1 hora.  Por lo tanto, en teor√≠a, despu√©s de 2 horas ¬± 5 minutos, se enviar√° una carta.  Entonces 3 horas es un valor incluso con un margen. <br><br>  Despu√©s de recibir los datos de la base de datos, hacemos una solicitud de obtenci√≥n en la direcci√≥n / ecommerce / stores / {store_id} / carts.  Por lo tanto, obtenemos todas las cestas que se encuentran en el sistema de comercio electr√≥nico y est√°n esperando su turno para enviar (o ya se han enviado).  ¬øPor qu√© necesitamos esto?  Es necesario para la sincronizaci√≥n con nuestros datos.  Enviaremos todas las cestas recibidas de la base de datos, pero debemos eliminar aquellas que ya no se encuentren en el rango de 1-3 horas.  Despu√©s de 3x: datos ya irrelevantes.  Hasta una hora: cestas que podr√≠an renovarse nuevamente o hacer un pedido. <br><br>  Para eliminar, solo necesitamos encontrar la diferencia entre las dos matrices / colecciones de cestas. <br>  Despu√©s de recibir las cestas que deben eliminarse, enviamos una solicitud de eliminaci√≥n / ecommerce / stores / {store_id} / carts / {cart_id}. <br><br>  A continuaci√≥n, tomamos las cestas para descargar y las enviamos por solicitud posterior al sistema en un ciclo. <br><br>  Los par√°metros de la cesta se parecen a esto: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> ? = //***.Ru/cart/abandoned/ carrito eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0% 253D', <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> </pre><br>  Y nuevamente, nuestra r√∫brica favorita es "adivina c√≥mo funcionan estos campos".  Por ejemplo, por el m√©todo de b√∫squeda cient√≠fica, se revel√≥ que es posible no crear un comprador con una solicitud por separado.  Es necesario transferir el conjunto m√≠nimo requerido de campos, y se crear√° autom√°ticamente si no estaba en el sistema.  En nuestro caso, nos limitamos a id, email, opt_in_status.  El √∫ltimo par√°metro es responsable del estado de suscripci√≥n del usuario en nuestra hoja.  Si es cierto, esto significa que el estado est√° suscrito, de lo contrario transaccional. <br><br>  La lista de productos se carga sin problemas a trav√©s de la matriz Cart Lines, que a su vez es un recurso de la entidad Cart.  Es decir  Podemos gestionar este conjunto por separado con solicitudes de descanso. <br><br>  Bueno, eso es todo, ¬øparece?  Pero no <br><br>  Al realizar la prueba, notamos que al enviar la misma canasta, se env√≠a solo una vez.  Aunque lo eliminamos del sistema y lo descargamos nuevamente.  ¬°Nada se dice en ninguna parte, ni una sola palabra!  Como resultado, emp√≠ricamente, con la ayuda de alguna madre, tomamos como base la hip√≥tesis de que una canasta con la misma identificaci√≥n solo se puede enviar una vez. <br><br>  Aqu√≠ estoy completamente de acuerdo con los creadores en que esta restricci√≥n nos evita enviar spam a los usuarios.  ¬°Pero escribe sobre eso!  No necesitamos misiones, tenemos suficientes errores m√≠sticos en el c√≥digo que escribimos. <br><br>  Despu√©s de hacer todo esto, el MCH comenz√≥ a enviarnos hermosas cartas sobre la canasta abandonada.  Y luego apareci√≥ una segunda pregunta.  Si el usuario arroj√≥ la canasta y regres√≥ de la carta a su propia cuenta, es decir, se le autoriz√≥ al momento de hacer clic en el enlace, luego ingresar√° a su canasta sin problemas.  Y resulta que la carta dice "¬°encendido!  ¬°recupera tu cesta! ", y cuando la cruzamos, decimos:" ¬°Uy, algo se perdi√≥!  ¬°No tocamos nada!  ¬°Es en s√≠ mismo! <br><br>  Se decidi√≥ codificar la composici√≥n de la cesta en una cadena y pasarla a checkout_url al enviar la cesta al MCH.  Y cuando vaya al sitio, tome esta l√≠nea, decodifique y arroje todos los productos en la canasta, sin olvidar reiniciarla por completo antes de eso. <br><br>  Por lo tanto, no importa a qu√© navegador le enviemos al usuario, √©l recibe su cesta, como prometimos.  Lo √∫nico negativo es que solo puede iniciar sesi√≥n.  Pero autorizar a trav√©s de un enlace es de mala educaci√≥n, y de hecho es un negocio peligroso, en primer lugar para nuestros clientes. <br>  Cual es el resultado?  En principio, no hubo problemas particulares durante la implementaci√≥n, ya que muy a menudo las respuestas de MCH ayudaron con errores relacionados con la validaci√≥n de los campos transferidos.  Pero habr√≠a incluso menos de ellos si normalmente describieran humanamente todas estas sutilezas del trabajo del MCH y describieran los campos con m√°s detalle. <br><br><h2>  Configuraci√≥n de informes en Google. </h2><br>  Para realizar un seguimiento del √©xito de toda la operaci√≥n, deber√° configurar y ver peri√≥dicamente el informe en an√°lisis.  Imagine que todos, como los adultos, tienen un comercio electr√≥nico conectado; de lo contrario, un milagro no funcionar√° :) <br><br>  Para recopilar un nuevo informe para una cesta abandonada, vaya a "Mis informes": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afe/749/f87/afe749f87d1c6bd4e5a0810dab40b4ef.jpg" alt="Mis informes"><br><br>  Adem√°s "Agregar informe": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/8bd/ba2/2888bdba2a5749ccc90c88c3f5c80f49.jpg" alt="Agregar informe"><br><br>  Y despu√©s de eso agregamos los par√°metros que rastrearemos.  Decidimos que mirar√≠amos la canasta abandonada en el contexto de las ciudades, es posible que tenga una visi√≥n diferente. <br><br>  Para un mailchamp, la campa√±a est√°ndar para una cesta abandonada es ABANDONED_CART_EMAIL, la sustituimos en el filtro y obtenemos un informe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/a77/b25/ca0a77b256b42242851ceaed308e02c7.jpg" alt="imagen"><br><br>  Eso es todo tenedores! <br><br>  Ahora est√° configurado para enviar la cesta abandonada y un informe mediante el cual puede ver el escape de la misma.  Y prueba, prueba, prueba!  ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421393/">https://habr.com/ru/post/es421393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421381/index.html">Curso gratuito de administrador de Cisco ASA</a></li>
<li><a href="../es421383/index.html">Epic Growth Conference Oto√±o 2018 - conferencia de marketing de productos en Mosc√∫</a></li>
<li><a href="../es421387/index.html">Entrevista con Lennart Pottering en Linux Piter sobre los cambios en Linux, sobre systemd y por qu√© asistir a conferencias</a></li>
<li><a href="../es421389/index.html">Separaci√≥n de poderes administrativos en Zimbra</a></li>
<li><a href="../es421391/index.html">HackThings: un gran hackathon en Internet de las cosas del 7 al 9 de septiembre en Skoltech</a></li>
<li><a href="../es421395/index.html">Informe del Club de Roma 2018, Cap√≠tulo 3.7: "Clima: buenas noticias, pero grandes problemas"</a></li>
<li><a href="../es421397/index.html">Lanza la Mini AI Cup # 3. Batalla de m√°quinas en espacios reducidos</a></li>
<li><a href="../es421399/index.html">An√°lisis de puerta trasera de Turla Cybergroup Outlook</a></li>
<li><a href="../es421401/index.html">Anatom√≠a de los sistemas de recomendaci√≥n. Parte dos</a></li>
<li><a href="../es421403/index.html">Semana de la seguridad 32: drama de Fortnite-Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>