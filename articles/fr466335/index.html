<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèª üïõ üòπ Cr√©ation d'une application Slack √† l'aide des fonctionnalit√©s 8base üçµ üèÄ üò∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Slack est une excellente application pour la communication interne entre les √©quipes. L'une des fonctionnalit√©s que nous pouvons facilement √©tendre en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation d'une application Slack √† l'aide des fonctionnalit√©s 8base</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466335/"><img src="https://habrastorage.org/getpro/habr/post_images/ee8/574/873/ee8574873908032aed87f5703682d618.png" alt="image"><br><br>  Slack est une excellente application pour la communication interne entre les √©quipes.  L'une des fonctionnalit√©s que nous pouvons facilement √©tendre en cr√©ant et en int√©grant des robots de discussion et des commandes de discussion slash qui permettent aux utilisateurs d'interagir avec des services externes.  Un excellent bot Slack, tr√®s populaire et utile, est le bot GitHub, qui publie des mises √† jour sur les demandes de tirage, les commits et ish sur le canal. <br><br>  Dans cet article, nous allons cr√©er un bot Slack qui publie des mises √† jour lors de la cr√©ation d'une commande sur la plateforme de commerce √©lectronique invent√©e que nous g√©rons. <br><br>  La plateforme de commerce √©lectronique est une application sans serveur cr√©√©e √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8base</a> .  Dans cet article, nous allons utiliser les fonctions 8base pour √©couter les √©v√©nements Create dans un mod√®le de donn√©es √† l'aide de d√©clencheurs. <br><br>  Un d√©clencheur est un type de fonction qui est d√©clench√©e en r√©ponse √† un √©v√©nement de mutation de donn√©es: <i>cr√©ation</i> , <i>mise √† jour</i> ou suppression d'un objet.  8base propose deux types de d√©clencheurs, selon que le d√©veloppeur souhaite ex√©cuter la fonction avant ou apr√®s la modification des donn√©es: trigger.before et trigger.after. <br><br><h4>  Vous aurez besoin </h4><br><ul><li>  Compr√©hension de base de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Node.js.</a>  Avant de commencer, assurez-vous que Node et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npm</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">yarn sont install√©s</a> . </li><li>  Nous utiliserons quelques requ√™tes GraphQL dans le projet, donc la familiarit√© avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GraphQL est utile</a> . </li><li>  Cr√©ez un compte 8base (si vous ne l'avez pas d√©j√† fait) en visitant leur <a href="http://">site Web</a> . </li></ul><br><h3>  Pr√©paration de l'environnement 8base </h3><br>  Cr√©ez un compte ou connectez-vous √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://auth.8base.com/login%3Fstate%3Dg6Fo2SBpTkZiUGl6QXJ5VFVkZS16U09yanNQU3dxNlJlQlV2NqN0aWTZIC04bGxiaENJU05ha0MzVUduT2ZuU19senhlbE5VN1l1o2NpZNkgcUdIWlZ1NUN4WTVrbGl2bTI4T1BMam9wdnNZcDBiYUQ%26client%3DqGHZVu5CxY5klivm28OPLjopvsYp0baD%26protocol%3Doauth2%26response_type%3Dtoken%2520id_token%26redirect_uri%3D">8base</a> .  Pour les nouveaux comptes, 8base offre un acc√®s gratuit de 30 jours. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/064/449/5e8/0644495e868a6e3b11bf27df93d61080.png" alt="image"><br>  ‚Äç2.  Apr√®s vous √™tre connect√©, acc√©dez √† la page de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">donn√©es</a> et cliquez sur "Nouvelle table" pour commencer √† configurer le backend. <br><img src="https://habrastorage.org/getpro/habr/post_images/011/8e4/ce6/0118e4ce63f1da4bc98b872b1e76a260.png" alt="image"><br>  ‚Äç3.  Apr√®s avoir charg√© une nouvelle table, vous verrez un diagramme et vous pourrez commencer √† d√©finir les champs.  Ensuite, cr√©ez une table appel√©e Commandes, compos√©e des champs suivants: <br>  - <b>utilisateur</b> : le type de champ est Table.  Dans la section de droite, s√©lectionnez le tableau Utilisateurs et dans le champ Nom du champ de relation, sp√©cifiez ¬´commandes¬ª.  Cochez ensuite la case ¬´Autoriser plusieurs <b>commandes</b> par <b>utilisateur</b> ¬ª. <br><img src="https://habrastorage.org/getpro/habr/post_images/64f/24f/8d0/64f24f8d0f5f626c397708980ef822ea.png" alt="image"><br>  - items: le type de champ est JSON.  Ce champ contient des informations sur les produits que l'utilisateur ach√®te, par exemple le prix, le nom et l'image. <br>  Notre sch√©ma est assez simple et devrait couvrir les fonctions n√©cessaires.  Ensuite, configurons l'application Slack et installons-la. <br><br><h3>  Cr√©er une application Slack </h3><br>  Commencez par vous connecter √† votre Slack ou cr√©ez-en un nouveau pour ce guide.  Visitez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">console API Slack</a> pour cr√©er une nouvelle application Slack. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/870/fb8/956/870fb8956f2b3b4dabceadf602df6d0d.png" alt="image"><br><br>  Appelez cette application Slack apr√®s notre plateforme de commerce √©lectronique fictive appel√©e <b>Shop Quick</b> . <br><br>  Apr√®s avoir cr√©√© l'application dans notre atelier, nous pouvons diff√©rer temporairement l'application Slack et travailler √† la cr√©ation de la fonction 8base, qui √©coutera les √©v√©nements de la cr√©ation de nouvelles commandes sur la plateforme <b>Shop Quick</b> . <br><br><h4>  Cr√©er une fonction 8base </h4><br>  La plate-forme 8base offre des fonctionnalit√©s qui facilitent la cr√©ation d'applications sans serveur.  Pour cette application Slack, nous avons besoin d'une logique et d'int√©grations personnalis√©es qui ne peuvent pas √™tre impl√©ment√©es uniquement avec CRUD.  Dans notre cas, nous souhaitons envoyer des messages √† Slack lors de la cr√©ation d'une nouvelle commande.  Nous pouvons y parvenir en utilisant les fonctions 8base, en √©coutant les √©v√©nements Create, Update et Delete, nous utiliserons des d√©clencheurs. <br><br>  Un d√©clencheur est une fonction qui est d√©clench√©e en r√©ponse √† un √©v√©nement de mutation de donn√©es: lorsqu'un objet est cr√©√©, mis √† jour ou supprim√©.  Il existe deux types de d√©clencheurs, selon qu'ils sont ex√©cut√©s avant ou apr√®s les modifications de donn√©es: trigger.before et trigger.after. <br><br>  Dans notre cas, nous appellerons notre fonction apr√®s avoir cr√©√© la commande.  Par cons√©quent, nous devons sp√©cifier Orders.create.  Les valeurs possibles pour l'√©v√©nement de donn√©es sont cr√©er, mettre √† jour et supprimer. <br><br><h4>  CLI 8base </h4><br>  CLI 8base vous permet d'√©crire du JavaScript ou du TypeScript personnalis√© pour ajouter efficacement de la logique, en se concentrant uniquement sur ce qui est unique √† votre application, tout en √©vitant le code standard. <br><br>  L'interface de ligne de commande (CLI) 8base facilite l'ajout d'une logique de serveur personnalis√©e √† vos applications directement depuis le terminal.  Installez la CLI en ex√©cutant la commande suivante dans un terminal: <br><br><pre><code class="javascript hljs">npm install -g <span class="hljs-number"><span class="hljs-number">8</span></span>base</code> </pre> <br>  Apr√®s avoir install√© la CLI globalement, vous devez √™tre connect√© pour fournir un acc√®s CLI √† votre compte 8base.  Ex√©cutez la commande suivante pour vous connecter: <br>  ‚Äç <br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">8</span></span>base login</code> </pre><br>  Lorsque vous ex√©cutez cette commande, une fen√™tre de navigateur appara√Æt pour l'autorisation CLI.  La connexion donne un acc√®s CLI √† votre compte 8base.  Vous pouvez trouver d'autres commandes propos√©es par la CLI en ex√©cutant la commande help: <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">8</span></span>base help</code> </pre><br>  Ensuite, nous initialisons le projet 8base √† l'aide de la CLI en ex√©cutant la commande suivante dans votre terminal: <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">8</span></span>base init shop-quick-functions</code> </pre><br>  Une fois la commande ex√©cut√©e, un nouveau dossier sera cr√©√©.  La structure des dossiers devrait ressembler √† ceci: <br><br><pre> <code class="javascript hljs">‚îú‚îÄ‚îÄ src/ | ‚îú‚îÄ‚îÄ function1.ts | ‚îî‚îÄ‚îÄ function2.js ‚îú‚îÄ‚îÄ <span class="hljs-number"><span class="hljs-number">8</span></span>base.yml ‚îî‚îÄ‚îÄ package.json</code> </pre> <br>  La CLI charge un projet Node r√©gulier, qui vous permet d'installer des d√©pendances √† l'aide de npm ou de fil.  De plus, l'interface CLI 8base est fournie avec Webpack et TypeScript pr√©configur√©s afin que vous puissiez √©crire du code JavaScript ou TypeScript. <br><br>  Nous avons configur√© des fonctionnalit√©s et des autorisations personnalis√©es dans 8base.yml.  Nous modifions le param√®tre actuel du fichier 8base.yml en fonction de nos besoins.  Ouvrez le fichier et apportez les modifications suivantes: <br><br><pre> <code class="javascript hljs">functions: notifySlack: handler: code: src/notifySlack.js type: trigger.after operation: Orders.create</code> </pre> <br>  La structure du fichier est similaire √† tout fichier YAML.  Le premier bloc que nous examinerons est un bloc fonctionnel;  nous mettrons toutes les d√©finitions de fonctions que nous allons cr√©er dans ce bloc.  Par exemple, la fonction notifySlack que nous avons cr√©√©e;  La fonction a les propri√©t√©s suivantes: <br><br><ul><li>  <b>gestionnaire</b> : chemin d'acc√®s relatif au fichier du gestionnaire de fonctions notifySlack. </li><li>  <b>op√©ration</b> : le param√®tre d√©termine le type de donn√©es et l'√©v√©nement que le d√©clencheur doit √©couter. </li><li>  <b>type</b> : s'ils sont d√©marr√©s avant ou apr√®s les modifications des donn√©es.  Il existe deux types: trigger.before et trigger.after. </li></ul><br>  L'√©tape suivante consiste √† cr√©er un fichier de gestionnaire pour commencer √† recevoir des √©v√©nements apr√®s le d√©clencheur.  Pour envoyer des mises √† jour √† Slack, nous utiliserons la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chat.postMessage</a> .  Les messages seront envoy√©s √† l'aide de la m√©thode de publication HTTP - chaque demande √† la m√©thode chat.postMessage sera sign√©e par le jeton d'acc√®s OAuth de votre bot.  Visitez la page de d√©tails de votre application, cliquez sur le lien OAuth &amp; Permissions dans la navigation de la barre lat√©rale. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/180/c54/94d/180c5494dcf0df2c5de56fcefbc65c2a.png" alt="image"><br><br>  ‚Äç Copiez le jeton et acc√©dez √† l'onglet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Variables d'environnement</a> sur la page des param√®tres 8base.  Vos fonctions ont acc√®s √† toutes les variables d'environnement cr√©√©es.  <b>Stockez toujours</b> vos valeurs et informations d'identification confidentielles ici, et ne les placez pas directement dans la base de donn√©es de code source.  Cr√©ez une nouvelle variable appel√©e SLACK_ACCESS_TOKEN, collez le jeton copi√© et enregistrez-le. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84a/b45/96b/84ab4596bc04520f2ae6da4675274dc4.png" alt="image"><br><br>  Ajoutons maintenant le code √† l'√©diteur.  Cr√©ez un fichier appel√© utils.js dans le r√©pertoire src.  Ouvrez le fichier dans votre √©diteur pr√©f√©r√© et copiez-y les √©l√©ments suivants: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/utils.js */</span></span><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> message = <span class="hljs-string"><span class="hljs-string">`A new order was just created`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messageBody = dataBuilder(order); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> body = { <span class="hljs-attr"><span class="hljs-attr">channel</span></span>: <span class="hljs-string"><span class="hljs-string">'general'</span></span>, <span class="hljs-attr"><span class="hljs-attr">attachments</span></span>: messageBody, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: message }; ‚Äç <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Message body'</span></span>, { body }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Sending message request'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> makeRequest(body); };‚Äç</code> </pre> <br>  Ainsi, la fonction sendMessage accepte une commande avec un argument, qui est un objet contenant les champs que nous avons cr√©√©s pour le mod√®le Order.  Maintenant, nous devons cr√©er un nouveau message en utilisant l'objet order, nous passons donc l'objet √† une fonction appel√©e dataBuilder.  La fonction dataBuilder renvoie un objet au format des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pi√®ces jointes Slack</a> . <br><br>  Ensuite, nous cr√©ons un corps de demande qui contient le canal de l'espace de travail dans lequel nous publions le message, les pi√®ces jointes renvoy√©es par dataBuilder et enfin le texte.  Ensuite, la demande de publication du message est envoy√©e par la fonction makeRequest. <br><br>  Cr√©ons la fonction dataBuilder, copions le fragment ci-dessous et mettons √† jour le fichier utils.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/utils.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { ...}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dataBuilder = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { items } = order; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> itemSections = items.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'section'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: item.name, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#3AA3E3'</span></span>, <span class="hljs-attr"><span class="hljs-attr">accessory</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'image'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image_url</span></span>: item.image, <span class="hljs-attr"><span class="hljs-attr">alt_text</span></span>: item.name, }, }; }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'section'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'mrkdwn'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">`*There are </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${items.length}</span></span></span><span class="hljs-string"> items in the order*`</span></span>, }, }, ...itemSections, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; };</code> </pre> <br>  La fonction dataBuilder accepte un objet de commande et cr√©e une section pour chaque √©l√©ment de la commande en utilisant le nom et l'image de l'√©l√©ment.  Vous pouvez utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Message Builder</a> pour pr√©visualiser la mise en forme des messages et des pi√®ces jointes en temps r√©el. <br><br>  Ensuite, nous ajoutons la fonction makeRequest, qui envoie le corps du message √† l'atelier Slack. <br><br>  Copiez l'extrait de code suivant dans le fichier utils.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/utils.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fetch'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { ... }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dataBuilder = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { ... }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeRequest = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://slack.com/api/chat.postMessage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> headers = { <span class="hljs-attr"><span class="hljs-attr">Authorization</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${process.env.SLACK_ACCESS_TOKEN}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetch(url, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(data), headers, }); };</code> </pre> <br>  Installez d'abord le package node-fetch en ex√©cutant la commande suivante: <br><br><pre> <code class="javascript hljs">npm install node-fetch</code> </pre><br>  Nous importons le package et l'utilisons dans la fonction makeRequest.  Dans le cadre de la fonction, nous ajouterons tous les en-t√™tes n√©cessaires √† la demande.  La demande doit √™tre sign√©e avec l'en-t√™te d'autorisation du porteur.  Le jeton sera obtenu √† partir de la variable d'environnement que nous avons cr√©√©e pr√©c√©demment.  Enfin, nous renvoyons la demande POST √† ‚Äã‚Äãl'aide de l'API fetch. <br><br>  Nous avons maintenant tout ce dont vous avez besoin pour envoyer un message √† l'espace de guerre Slack √† l'aide d'un bot.  Cr√©ons un gestionnaire de fonctions que nous avons r√©f√©renc√© dans le fichier 8base.yml ci-dessus. <br><br>  Cr√©ez un fichier appel√© notifySlack.js dans le r√©pertoire src, ouvrez le fichier et copiez-y le code: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/notifySlack.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { sendMessage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./utils'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (event) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Sending notification to slack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sendMessage(event.data); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Notification sent successfully'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: event.data, }; };</code> </pre> <br>  Dans le fichier, nous utilisons la fonction utilitaire sendMessage que nous avons cr√©√©e.  Le gestionnaire de fonctions 8base transmet deux arguments: un √©v√©nement et un contexte.  La structure de l'objet √©v√©nement d√©pend du type de fonction et l'objet context contient des propri√©t√©s et des m√©thodes utiles, que vous pouvez lire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Dans notre cas, l'objet d'√©v√©nement contiendra la commande cr√©√©e, qui se compose de deux champs utilisateur et articles.  L'objet Order est une propri√©t√© des donn√©es d'objet √©v√©nement et nous transmettons cet objet √† la fonction sendMessage pour informer Slack. <br><br>  L'appel de fonction est encapsul√© dans try / catch, car nous ne voulons pas que des erreurs entra√Ænent la fin de la fonction.  Enfin, nous renvoyons les donn√©es d'√©v√©nement √† la fin de la fonction. <br>  Avec ces donn√©es, nous pouvons indiquer l'objet et le corps du message, puis envoyer un courrier √† l'aide du transporteur que nous avons cr√©√©.  Enregistrez le fichier et d√©ployez la fonction √† l'aide de l'interface CLI 8base en ex√©cutant la commande suivante: <br><br>  ‚Äç <pre> <code class="javascript hljs"># deploy <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> project root directory <span class="hljs-number"><span class="hljs-number">8</span></span>base deploy</code> </pre> <br>  Apr√®s avoir correctement mis en place la fonction, vous devriez voir la sortie suivante du terminal: <br>  ‚Äç <br><pre> <code class="javascript hljs">‚ûú <span class="hljs-number"><span class="hljs-number">8</span></span>base deploy deploy done. Time: <span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">553</span></span> ms.</code> </pre> <br><h4>  Fonctionnalit√©s de d√©bogage </h4><br>  Il est important d'avoir des journaux dans vos fonctions afin que vous puissiez facilement d√©boguer des fonctions et suivre ce qui se passe l√†-bas.  8base a une page pour visualiser toutes les fonctions attach√©es √† votre profil.  Vous pouvez facilement visualiser tous les journaux provenant de chaque fonction. <br><br>  Acc√©dez au tableau de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bord</a> 8base et cliquez sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Logique</a> dans le menu lat√©ral.  Sur la page logique, vous pouvez afficher toutes les fonctions pr√©sent√©es. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a2/c20/38a/1a2c2038afb3be1b65769a05cda9482b.png" alt="image"><br>  Pour une fonction sp√©cifique, cliquez sur <b>Afficher les journaux</b> pour voir tous les journaux.  Ensuite, nous installons l'application Slack et la testons. <br><br><h3>  Installation et test de l'application Slack </h3><br>  Terminons la derni√®re √©tape et installons l'application Slack dans l'espace de travail.  Pour ce faire, revenez √† la console de l'application Slack et cliquez sur <b>Installer l'application</b> dans la barre de navigation lat√©rale. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76e/212/b74/76e212b74709411272256b422a77f653.png" alt="image"><br><br>  Sur la page, vous verrez un avertissement concernant l'ajout d'une fonction ou d'une autorit√© pour installer l'application.  Cliquez dessus et ajoutez une autorisation. <br><br>  Apr√®s avoir correctement install√© l'application, nous pouvons tester la fonction et l'application.  Acc√©dez √† la page 8base <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Data</a> , cliquez sur le tableau Orders dans la barre lat√©rale.  Dans la visionneuse de table de commande, cliquez sur l'onglet <b>DONN√âES</b> , ici nous pouvons ajouter de nouvelles lignes √† la table. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c0/fab/84c/7c0fab84c009f1f3620ab57e41086a55.png" alt="image"><br><br>  Dans le tableau de donn√©es, appuyez sur le bouton {+} et cr√©ez une nouvelle ligne. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1a/015/2bf/b1a0152bf7dad2951b3ef2d1e0a07310.png" alt="image"><br><br>  Vous pouvez remplir le champ produit avec les donn√©es suivantes: <br><br><pre> <code class="javascript hljs">[{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Food product"</span></span>, <span class="hljs-string"><span class="hljs-string">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://static.pexels.com/photos/368893/pexels-photo-368893.jpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"The real fruit"</span></span>, <span class="hljs-string"><span class="hljs-string">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://static.pexels.com/photos/368893/pexels-photo-368883.jpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> }]</code> </pre> <br>  Cliquez sur <b>Ajouter une ligne</b> pour cr√©er une nouvelle commande.  Ensuite, allez √† l'atelier o√π vous avez install√© l'application Slack, cliquez sur le canal #general et vous verrez un nouveau message du bot. <br><br>  Cela devrait ressembler √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/739/025/ef1/739025ef157a8879e5a1aa63595036de.png" alt="image"><br><br>  Nouvelle notification du bot 8base sur le canal Slack <br><br><h3>  Les derniers mots </h3><br>  La cr√©ation d'une application Slack est une bonne id√©e;  Slack est le principal moyen de communication pour la plupart des √©quipes et peut vous permettre d'avoir toutes les informations dont vous avez besoin pour le travail quotidien. <br><br>  Pour cet article, en utilisant la fonctionnalit√© 8base, nous avons cr√©√© une application Slack simple qui envoie des messages sur les nouvelles commandes dans le syst√®me.  Les messages envoy√©s √©taient assez simples.  Slack a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formatage</a> riche pour ses messages, et vous pouvez les compliquer afin qu'ils contiennent plus d'informations.  En savoir plus sur les fonctionnalit√©s de 8base <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Voir le code dans cet article sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . <br><br>  Merci d'avoir lu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466335/">https://habr.com/ru/post/fr466335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466317/index.html">Trucs et astuces de ma cha√Æne Telegram @pythonetc, ao√ªt 2019</a></li>
<li><a href="../fr466319/index.html">Deal: VMware ach√®te une startup bas√©e sur le cloud</a></li>
<li><a href="../fr466323/index.html">Nous cr√©ons un jeu de plateforme portable sur le microcontr√¥leur Cortex M0 +</a></li>
<li><a href="../fr466329/index.html">Carte √©lectronique de la vinification en Russie. Conception et contenu</a></li>
<li><a href="../fr466333/index.html">Comment organiser un lieu de travail pour vous</a></li>
<li><a href="../fr466337/index.html">De quelle couleur est ta fonction?</a></li>
<li><a href="../fr466339/index.html">Comment dans Microsoft SQL Server pour obtenir des donn√©es de Google Analytics en utilisant R</a></li>
<li><a href="../fr466341/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 33. Pr√©paration √† l'examen ICND1</a></li>
<li><a href="../fr466345/index.html">M√©thode d'onde de construction d'un jeu de couleurs</a></li>
<li><a href="../fr466347/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 34. Concept VLAN avanc√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>