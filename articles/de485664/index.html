<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üßõ üöõ Erstellen dynamischer Parameter in einem Jenkins-Job oder wie Sie Ihre Aufgabe benutzerfreundlich gestalten k√∂nnen üéæ ‚ôíÔ∏è üêî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag, Habr ! 


 Heute m√∂chte ich eine der M√∂glichkeiten vorstellen , wie Active Choices Plugin verwendet werden kann , um die Aufgabe in Jenkins...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen dynamischer Parameter in einem Jenkins-Job oder wie Sie Ihre Aufgabe benutzerfreundlich gestalten k√∂nnen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485664/"><p>  Guten Tag, <strong>Habr</strong> ! </p><br><p>  Heute m√∂chte ich eine der M√∂glichkeiten <strong><a href="https://wiki.jenkins.io/display/JENKINS/Active%2BChoices%2BPlugin">vorstellen</a></strong> , wie <strong><a href="https://wiki.jenkins.io/display/JENKINS/Active%2BChoices%2BPlugin">Active Choices Plugin verwendet werden kann</a></strong> , um die Aufgabe in <strong>Jenkins</strong> f√ºr den Benutzer am einheitlichsten und verst√§ndlichsten zu gestalten. </p><br><h4 id="vvedenie">  Einleitung </h4><br><p>  Eine solche Abk√ºrzung wie DevOps ist f√ºr die IT-Community nichts Neues mehr.  F√ºr viele Menschen ist der Ausdruck ‚Äûmake DevOps‚Äú mit einer Art magischer Schaltfl√§che verbunden. Wenn Sie darauf klicken, wird der Anwendungscode automatisch zu einer bereitgestellten und getesteten Anwendung (alles ist tats√§chlich komplizierter, aber wir abstrahieren von allen Prozessen). </p><br><p> Daher haben wir den Auftrag erhalten, einen solchen magischen Knopf zu erstellen, damit Administratoren die Anwendung mit einem Klick bereitstellen k√∂nnen.  Es gibt verschiedene Arten der Implementierung dieser Aufgabe: vom Schreiben eines Bots f√ºr einen der Messenger bis zur Entwicklung einer separaten Anwendung.  Der Zweck all dessen ist jedoch derselbe: Den Start der Zusammenstellung und Bereitstellung der Anwendung so transparent und bequem wie m√∂glich zu gestalten. </p><br><p>  In unserem Fall werden wir <strong>Jenkins verwenden</strong> . </p><a name="habracut"></a><br><div style="text-align:center;"><img height="400" width="250" src="https://habrastorage.org/webt/fz/6r/hx/fz6rhxhctiu7yeni90vsqwfav4s.png"></div><br><h4 id="zadacha">  Herausforderung </h4><br><p>  Erstellen Sie einen praktischen Jenkins-Job, der die Assembly und / oder Bereitstellung des ausgew√§hlten Microservice einer bestimmten Version ausf√ºhrt. </p><br><div style="text-align:center;"><img height="300" width="300" src="https://habrastorage.org/webt/io/fe/bh/iofebhyveat79hhs1jzvclqx8ko.png"></div><br><h4 id="vhodnye-dannye">  Daten eingeben </h4><br><p>  Wir haben mehrere Repositorys, die den Quellcode verschiedener Microservices enthalten. </p><br><h4 id="opredelenie-parametrov">  Parameterdefinition </h4><br><p>  Die folgenden Parameter sollten in die Eingabe unseres Jobs einflie√üen: </p><br><ol><li>  Die URL des Repositorys mit dem Microservice-Code, den wir beim Starten des Jobs sammeln und bereitstellen m√∂chten. </li><li>  ID des Commits, von dem aus die Assembly stattfinden wird. </li></ol><br><h4 id="as-is">  WIE BESEHEN </h4><br><p>  Am einfachsten erledigen Sie die Aufgabe, indem Sie zwei Parameter vom Typ String erstellen. </p><br><div style="text-align:center;"><img height="700" width="700" src="https://habrastorage.org/webt/ax/ns/ko/axnskog8eayycc3r32btpms9zoy.png"></div><br><p>  In diesem Fall muss der Benutzer den Pfad zum Repository und die Festschreibungs-ID manuell eingeben, was, wie Sie sehen, nicht ganz praktisch ist. </p><br><div style="text-align:center;"><img height="400" width="400" src="https://habrastorage.org/webt/v8/en/pd/v8enpd-yenawguqsdhubab1tdqq.png"></div><br><h4 id="as-to-be">  WIE ZU SEIN </h4><br><p>  Versuchen wir nun einen anderen Parametertyp, um alle seine Vorteile zu ber√ºcksichtigen. <br>  Erstellen Sie den ersten Parameter vom Typ Auswahlparameter, den zweiten - Aktive Auswahl - Reaktiver Referenzparameter.  Im Parameter mit dem Typ Auswahl f√ºgen wir die Namen der Repositorys hinzu, in denen der Code unserer Microservices manuell im Feld Auswahl gespeichert wird. </p><br><div style="text-align:center;"><img height="700" width="700" src="https://habrastorage.org/webt/ti/qh/oo/tiqhooykhwwiri560milgxkxsde.png"></div><br><blockquote>  Wenn das Publikum diesen Artikel mag, dann beschreibe ich im n√§chsten Artikel den Prozess der Konfiguration von Aufgaben in Jenkins unter Verwendung der Beschreibung durch den Code (Konfiguration als Code), d. H.  Es ist nicht erforderlich, die Namen der Repositorys manuell einzugeben und Parameter zu erstellen. Alles wird automatisch ausgef√ºhrt (unser Code erh√§lt eine Liste der Repositorys von SCM und erstellt einen Parameter mit dieser Liste). </blockquote><p>  Die Werte des zweiten Parameters werden bei uns dynamisch gef√ºllt, je nachdem, welchen Wert der erste Parameter annimmt (test1 oder test2), da jedes Repository eine eigene Liste von Commits hat. </p><br><p>  <strong>Aktive Auswahl Reaktiver Referenzparameter</strong> enth√§lt die folgenden Felder, die ausgef√ºllt werden m√ºssen: </p><br><ol><li>  <em>Name</em> - der Name des Parameters. </li><li>  <em>Skript</em> - Der Code, der jedes Mal ausgef√ºhrt wird, wenn der Wert des Parameters im Feld Referenzierter Parameter ge√§ndert wird (in unserem Fall, wenn wir zwischen Test1 und Test2 w√§hlen). </li><li>  <em>Beschreibung</em> - eine kurze Beschreibung des Parameters. </li><li>  <em>Auswahltyp</em> - der Typ des Objekts, das vom Skript zur√ºckgegeben wird (in unserem Fall geben wir den HTML-Code zur√ºck). </li><li>  <em>Referenzierter Parameter</em> - Der Name des Parameters, wenn der Wert ge√§ndert wird, f√ºr den der Code aus dem Skriptabschnitt ausgef√ºhrt wird. </li></ol><br><div style="text-align:center;"><img height="700" width="700" src="https://habrastorage.org/webt/4f/ue/n6/4fuen6d1enjbwyp36fqrtvt7w4w.png"></div><br><p>  Wir gehen direkt zum Ausf√ºllen des Hauptfeldes in diesem Parameter √ºber.  Es stehen zwei Arten der Implementierung zur Auswahl: <em>Groovy Script</em> oder <em>Scriptler Script</em> . <br>  Wir w√§hlen das erste aus, da Scriptler nur ein Plug-In ist, das bereits geschriebene Skripte speichert und es Ihnen erm√∂glicht, sie in anderen Aufgaben zu verwenden, ohne sie erneut kopieren zu m√ºssen. </p><br><p>  Groovy-Code zum Abrufen aller Commits aus dem ausgew√§hlten Repository: </p><br><pre><code class="java hljs">AUTH = <span class="hljs-string"><span class="hljs-string">"    Base64"</span></span> GIT_URL = <span class="hljs-string"><span class="hljs-string">"url   SCM (https://bitbucket.org/)"</span></span> PROJECT_NAME = <span class="hljs-string"><span class="hljs-string">"  ,   "</span></span> <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">htmlBuild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ html = <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">" &lt;html&gt; &lt;head&gt; &lt;meta charset="</span></span>windows-<span class="hljs-number"><span class="hljs-number">1251</span></span><span class="hljs-string"><span class="hljs-string">"&gt; &lt;style type="</span></span>text/css<span class="hljs-string"><span class="hljs-string">"&gt; div.grayTable { text-align: left; border-collapse: collapse; } .divTable.grayTable .divTableCell, .divTable.grayTable .divTableHead { padding: 0px 3px; } .divTable.grayTable .divTableBody .divTableCell { font-size: 13px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; "</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> def commitOptions = <span class="hljs-string"><span class="hljs-string">""</span></span> getCommitsForMicroservice(MICROSERVICE_NAME).each { commitOptions += <span class="hljs-string"><span class="hljs-string">"&lt;option style='font-style: italic' value='COMMIT=${it.getKey()}'&gt;${it}&lt;/option&gt;"</span></span> } html += <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"&lt;p style="</span></span>display: inline-block;<span class="hljs-string"><span class="hljs-string">"&gt; &lt;select id="</span></span>commit_id<span class="hljs-string"><span class="hljs-string">" size="</span></span><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">" name="</span></span>value<span class="hljs-string"><span class="hljs-string">"&gt; ${commitOptions} &lt;/select&gt;&lt;/p&gt;&lt;/div&gt;"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> html += <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">" &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; "</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> html } <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommitsForMicroservice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(microserviceRepo)</span></span></span><span class="hljs-function"> </span></span>{ def commits = [:] def endpoint = GIT_URL + <span class="hljs-string"><span class="hljs-string">"/rest/api/1.0/projects/${PROJECT_NAME}/repos/${microserviceRepo}/commits"</span></span> def conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(endpoint).openConnection() conn.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>, <span class="hljs-string"><span class="hljs-string">"Basic ${AUTH}"</span></span>) def response = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> groovy.json.JsonSlurper().parseText(conn.content.text) response.values.each { commits.put(it.displayId, it.message) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> commits } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> htmlBuild()</code> </pre> <br><p>  Wenn Sie nicht auf Details eingehen, erh√§lt dieser Code den Namen des Mikrodienstes (MICROSERVICE_NAME), sendet eine Anforderung an <em>Bitbucket</em> ( <em>getCommitsForMicroservice-</em> Methode) unter Verwendung der API und empf√§ngt die <em>ID-</em> und <em>Festschreibungsnachricht</em> aller Festschreibungen f√ºr diesen Mikrodienst. <br>  Wie bereits erw√§hnt, sollte dieser Code den HTML-Code zur√ºckgeben, der auf der Seite " <em>Mit Parametern</em> erstellen" in Jenkins angezeigt wird. Daher werden alle von Bitbucket empfangenen Werte in die Liste eingeschlossen und zur Auswahl hinzugef√ºgt. </p><br><p>  Nach Abschluss aller Schritte sollten wir eine so sch√∂ne Seite <em>mit Parametern erstellen</em> . </p><br><p>  Wenn Sie test1 microservice ausw√§hlen: </p><br><div style="text-align:center;"><img height="600" width="600" src="https://habrastorage.org/webt/xa/qo/iv/xaqoivcjirtx6yklqlcbkfsm-wy.png"></div><br><p>  Wenn Sie test2 microservice w√§hlen: </p><br><div style="text-align:center;"><img height="600" width="600" src="https://habrastorage.org/webt/qt/u9/x9/qtu9x9rpdecqm8krb-cvnk3gfpi.png"></div><br><p>  Stimmen Sie zu, dass es f√ºr den Benutzer viel bequemer ist, auf diese Weise mit Ihrer Aufgabe zu interagieren, als die URL jedes Mal zu kopieren und nach der erforderlichen Festschreibungs-ID zu suchen. </p><br><p>  <strong>PS</strong> Dieser Artikel enth√§lt ein sehr vereinfachtes Beispiel, das in dieser Form m√∂glicherweise keine praktische Anwendung findet, da Baugruppen viel andere Parameter aufweisen. Der Zweck dieses Artikels bestand jedoch darin, die Funktionsweise des Werkzeugs zu veranschaulichen und keine funktionierende L√∂sung bereitzustellen. </p><br><p>  <strong>PSS</strong> Wie ich bereits geschrieben habe, geht es in diesem Artikel um die <em>dynamische Konfiguration von Jenkins-Tasks mithilfe von Code</em> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485664/">https://habr.com/ru/post/de485664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485648/index.html">Der pythonische Ansatz f√ºr for: range () - und enumerate () - Schleifen</a></li>
<li><a href="../de485650/index.html">Docker-Bildverkleinerungstechniken</a></li>
<li><a href="../de485652/index.html">Beeinflussen Sie die Statistik der Inline-Kommentare</a></li>
<li><a href="../de485654/index.html">Eine Idee aus der Physik hilft der KI, in h√∂heren Dimensionen zu arbeiten.</a></li>
<li><a href="../de485660/index.html">Das DDoS-Schutzunternehmen selbst habe DDoS-Angriffe gestartet, gab sein Gr√ºnder zu</a></li>
<li><a href="../de485672/index.html">Redis Best Practices, Teil 1</a></li>
<li><a href="../de485682/index.html">Zeitmanagement wird nicht helfen: Aufschub ist das Problem der Regulierung von Emotionen, nicht Zeit</a></li>
<li><a href="../de485688/index.html">Myapp verl√§ngert Urlaub</a></li>
<li><a href="../de485692/index.html">Beratung des IT-Spezialisten f√ºr den Kunden oder wie das Chaos automatisiert werden kann</a></li>
<li><a href="../de485694/index.html">Embox auf Elbrus-Prozessor. Oder vergiss nie, was du an Intelligenz hast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>