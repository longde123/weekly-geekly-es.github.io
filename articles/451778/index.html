<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèº üéé üéé Otro sistema de monitoreo üò¢ üë®‚Äçüë©‚Äçüë¶ üë©üèø‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suma de velocidad en 16 m√≥dems de 4 operadores m√≥viles. Velocidad de salida en una transmisi√≥n: 933.45 Mbps 
 Introduccion 


 Hola Este art√≠culo trat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otro sistema de monitoreo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451778/"><p><img src="https://habrastorage.org/webt/rh/en/cj/rhencjkth5mkrj_l-mo9xe5dewk.png"><br>  <em>Suma de velocidad en 16 m√≥dems de 4 operadores m√≥viles.</em>  <em>Velocidad de salida en una transmisi√≥n: 933.45 Mbps</em> </p><br><h2 id="vvedenie">  Introduccion </h2><br><p>  Hola  Este art√≠culo trata sobre c√≥mo escribimos un nuevo sistema de monitoreo para nosotros mismos.  Se diferencia de las existentes por la posibilidad de adquisici√≥n s√≠ncrona de alta frecuencia de m√©tricas y muy bajo consumo de recursos.  La frecuencia de sondeo puede alcanzar 0.1 milisegundos con una precisi√≥n de sincronizaci√≥n entre m√©tricas de 10 nanosegundos.  Todos los archivos binarios ocupan 6 megabytes. </p><a name="habracut"></a><br><h2 id="o-proekte">  Sobre el proyecto </h2><br><p>  Tenemos un producto bastante espec√≠fico.  Producimos una soluci√≥n integral para resumir el rendimiento y la tolerancia a fallas de los canales de datos.  Esto es cuando hay varios canales, por ejemplo, Operador1 (40Mbit / s) + Operador2 (30Mbit / s) + Algo m√°s (5 Mbit / s), el resultado es un canal estable y r√°pido, cuya velocidad ser√° algo as√≠: (40+ 30 + 5) x0.92 = 75x0.92 = 69 Mbps. </p><br><p>  Dichas soluciones tienen demanda cuando la capacidad de cualquier canal es insuficiente.  Por ejemplo, transporte, sistemas de videovigilancia y transmisi√≥n de video en tiempo real, transmisiones de televisi√≥n y radio en vivo, cualquier objeto fuera de la ciudad donde los operadores de telecomunicaciones solo tengan representantes de los Cuatro Grandes, y la velocidad en un m√≥dem / canal no es suficiente. <br>  Para cada una de estas √°reas, producimos una l√≠nea separada de dispositivos, sin embargo, su parte de software es casi la misma y un sistema de monitoreo de alta calidad es uno de sus m√≥dulos principales, sin la implementaci√≥n correcta de la cual el producto ser√≠a imposible. </p><br><p>  Durante varios a√±os, hemos logrado crear un sistema de monitoreo multinivel, r√°pido, multiplataforma y liviano.  Lo que queremos compartir con una comunidad de buena reputaci√≥n. </p><br><h2 id="postanovka-zadachi">  Declaraci√≥n del problema. </h2><br><p>  El sistema de monitoreo proporciona m√©tricas para dos clases fundamentalmente diferentes: m√©tricas en tiempo real y todo lo dem√°s.  El sistema de monitoreo ten√≠a los siguientes requisitos: </p><br><ol><li>  Adquisici√≥n s√≠ncrona de alta frecuencia de m√©tricas en tiempo real y su transferencia al sistema de control de comunicaci√≥n sin demora. <br>  La alta frecuencia y sincronizaci√≥n de diferentes m√©tricas no solo es importante, es vital para el an√°lisis de la entrop√≠a de los canales de transmisi√≥n de datos.  Si hay un retraso promedio de 30 milisegundos en un canal de datos, entonces un error en la sincronizaci√≥n entre las m√©tricas restantes en solo un milisegundo conducir√° a la degradaci√≥n de la velocidad del canal resultante en aproximadamente un 5%.  Si cometemos un error en la sincronizaci√≥n de 1 milisegundo en 4 canales, la degradaci√≥n de la velocidad puede caer f√°cilmente al 30%.  Adem√°s, la entrop√≠a en los canales cambia muy r√°pidamente, por lo que si la medimos menos de una vez cada 0.5 milisegundos, en canales r√°pidos con un peque√±o retraso, obtendremos una degradaci√≥n de alta velocidad.  Por supuesto, dicha precisi√≥n no es necesaria para todas las m√©tricas y no en todas las condiciones.  Cuando el retraso en el canal es de 500 milisegundos, y trabajamos con eso, el error de 1 milisegundo apenas se notar√°.  Adem√°s, para las m√©tricas de los sistemas de soporte vital, las frecuencias de sondeo y sincronizaci√≥n de 2 segundos son suficientes para nosotros, sin embargo, el sistema de monitoreo en s√≠ mismo deber√≠a poder trabajar con frecuencias de sondeo ultra altas y sincronizaci√≥n m√©trica ultra precisa. </li><li>  M√≠nimo consumo de recursos y una sola pila. <br>  El dispositivo final puede ser un poderoso complejo a bordo que puede analizar la situaci√≥n en el camino o registrar la biometr√≠a de las personas, o una computadora del tama√±o de una palma de una sola placa que es usada por un soldado de las fuerzas especiales debajo de la armadura para transmitir video en tiempo real en malas condiciones de comunicaci√≥n.  A pesar de tal variedad de arquitecturas y poder de c√≥mputo, nos gustar√≠a tener la misma pila de software. </li><li>  Arquitectura de paraguas <br>  Las m√©tricas deben recopilarse y agregarse en el dispositivo final, tener un sistema de almacenamiento local y visualizaci√≥n en tiempo real y retrospectivamente.  Si hay comunicaci√≥n disponible, transfiera datos al sistema de monitoreo central.  Cuando no hay conexi√≥n, la cola de env√≠o debe acumularse y no consumir RAM. </li><li>  Una API para la integraci√≥n en el sistema de monitoreo de un cliente, porque nadie necesita muchos sistemas de monitoreo.  El cliente debe recopilar datos de cualquier dispositivo y red en un solo monitoreo. </li></ol><br><h2 id="chto-poluchilos">  Que paso </h2><br><p>  Para cargar el ya impresionante longrid, no dar√© ejemplos y mediciones de todos los sistemas de monitoreo.  Esto sacar√° otro art√≠culo.  Solo dir√© que no pudimos encontrar un sistema de monitoreo que sea capaz de tomar dos m√©tricas al mismo tiempo con un error de menos de 1 milisegundo y que funcione igualmente eficientemente tanto en una arquitectura ARM con 64 MB de RAM como en una arquitectura x86_64 con 32 GB de RAM.  Por lo tanto, decidimos escribir el nuestro, que puede hacer exactamente eso.  Esto es lo que tenemos: </p><br><h3 id="summirovanie-propusknoy-sposobnosti-treh-kanalov-dlya-raznoy-topologii-seti">  Sumar el rendimiento de tres canales para diferentes topolog√≠as de red. </h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3vPFHz7jFGM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uEk_kQBbdP0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3 id="vizualizaciya-nekotoryh-klyuchevyh-metrik">  Visualizaci√≥n de algunas m√©tricas clave. </h3><br><img src="https://habrastorage.org/webt/pl/as/15/plas151wvh-q69t6tmsmymvmszm.png"><br><img src="https://habrastorage.org/webt/8m/ta/hg/8mtahgdrualo8qowqadujgt14um.png"><br><img src="https://habrastorage.org/webt/gc/ft/3e/gcft3eah06vwztovobq_i_8bby8.png"><br><img src="https://habrastorage.org/webt/pc/mf/ke/pcmfkew11pujz3ktrss1dup0yko.png"><br><h2 id="arhitektura">  Arquitectura </h2><br><p>  Como lenguaje principal de programaci√≥n, tanto en el dispositivo como en el centro de datos, utilizamos Golang.  Simplific√≥ enormemente su vida al implementar la multitarea y la capacidad de obtener un binario ejecutable vinculado est√°ticamente para cada servicio.  Como resultado, ahorramos significativamente en recursos, m√©todos y tr√°fico de implementaci√≥n de servicios para dispositivos finales, tiempo de desarrollo y depuraci√≥n de c√≥digo. </p><br><p>  El sistema se implementa de acuerdo con el principio modular cl√°sico y contiene varios subsistemas: </p><br><ol><li>  Registro de m√©tricas. <br>  Cada m√©trica es servida por su propia secuencia y sincronizada a trav√©s de canales.  Logramos una precisi√≥n de sincronizaci√≥n de hasta 10 nanosegundos. </li><li>  Almacenamiento m√©trico <br>  Elegimos entre escribir nuestro repositorio para series temporales o usar uno de los disponibles.  La base de datos es necesaria para los datos retrospectivos, que est√°n sujetos a una visualizaci√≥n posterior, es decir, no tiene datos sobre retrasos en el canal cada 0,5 milisegundos o indicaciones de error en la red de transporte, pero hay una velocidad en cada interfaz cada 500 milisegundos.  Adem√°s de los altos requisitos para multiplataforma y bajo consumo de recursos, es extremadamente importante para nosotros poder procesar.  datos en el mismo lugar donde se almacenan.  Esto ahorra tremendamente los recursos inform√°ticos.  Desde 2016, hemos estado usando DBMS Tarantool en este proyecto y hasta ahora no vemos un reemplazo para √©l en el horizonte.  Flexible, con consumo √≥ptimo de recursos, soporte t√©cnico m√°s que adecuado.  Tarantool tambi√©n tiene un m√≥dulo SIG.  Ciertamente no es tan poderoso como PostGIS, pero es suficiente para nuestras tareas de almacenar algunas m√©tricas vinculadas a una ubicaci√≥n (relevante para el transporte). </li><li>  Visualizaci√≥n de m√©tricas <br>  Aqu√≠ todo es relativamente simple.  Tomamos los datos del almacenamiento y los mostramos en tiempo real o retrospectivamente. </li><li>  Sincronizaci√≥n de datos con un sistema de monitoreo central. <br>  El sistema de monitoreo central recibe datos de todos los dispositivos, los almacena con una retrospectiva dada y los env√≠a a trav√©s de la API al sistema de monitoreo del Cliente.  A diferencia de los sistemas de monitoreo cl√°sicos, en los que la "cabeza" camina y recopila datos, tenemos el esquema opuesto.  Los dispositivos mismos env√≠an datos cuando hay una conexi√≥n.  Este es un punto muy importante, ya que le permite recibir datos del dispositivo durante esos per√≠odos de tiempo en los que no estaba disponible y no cargar canales y recursos mientras el dispositivo no est√° disponible.  Como sistema de monitoreo central, utilizamos el servidor de monitoreo Influx.  A diferencia de los an√°logos, puede importar datos retrospectivos (es decir, con una marca de tiempo diferente al momento en que se recibi√≥ la m√©trica) Las m√©tricas recopiladas se visualizan mediante un archivo Grafana modificado.  Esta pila est√°ndar tambi√©n se eligi√≥ porque tiene API de integraci√≥n listas para usar con casi cualquier sistema de monitoreo del cliente. </li><li>  Sincronizaci√≥n de datos con un sistema central de gesti√≥n de dispositivos. <br>  El sistema de administraci√≥n de dispositivos implementa el aprovisionamiento Zero Touch (actualizaci√≥n de firmware, configuraci√≥n, etc.) y, a diferencia del sistema de monitoreo, solo recibe problemas del dispositivo.  Estos son los desencadenantes de los servicios de vigilancia de hardware a bordo y todas las m√©tricas de los sistemas de soporte vital: temperatura de CPU y SSD, carga de CPU, espacio libre y salud SMART en discos.  El subsistema de almacenamiento tambi√©n se basa en Tarantool.  Esto nos da una velocidad significativa en la agregaci√≥n de series temporales en miles de dispositivos, y tambi√©n resuelve completamente el problema de la sincronizaci√≥n de datos con estos dispositivos.  Tarantool tiene un excelente sistema de colas y entrega garantizada.  Obtuvimos esta caracter√≠stica importante de f√°brica, ¬°genial! </li></ol><br><h3 id="sistema-upravleniya-setyu">  Sistema de gesti√≥n de red </h3><br><img src="https://habrastorage.org/webt/2f/8i/o9/2f8io9alx_n41fnl9fi2wkmilwc.png"><br><h2 id="chto-dalshe">  Que sigue </h2><br><p>  Hasta ahora, el eslab√≥n m√°s d√©bil en nuestro pa√≠s es el sistema central de monitoreo.  Se implementa al 99.9% en la pila est√°ndar y tiene una serie de desventajas: </p><br><ol><li>  InfluxDB pierde datos cuando se apaga la alimentaci√≥n.  Como regla general, el Cliente toma r√°pidamente todo lo que proviene de los dispositivos y no hay datos de m√°s de 5 minutos en la base de datos, pero en el futuro esto puede ser un problema. </li><li>  Grafana tiene varios problemas con la agregaci√≥n de datos y la sincronizaci√≥n de su visualizaci√≥n.  El problema m√°s com√∫n es cuando la base de datos contiene una serie de tiempo con un intervalo de 2 segundos a partir de, digamos, 00:00:00, y Grafana comienza a mostrar datos en agregaci√≥n desde +1 segundo.  Como resultado, el usuario ve una tabla de baile. </li><li>  Exceso de c√≥digo para la integraci√≥n API con sistemas de monitoreo de terceros.  Se puede hacer mucho m√°s compacto y, por supuesto, reescribir a Go) </li></ol><br><p>  Supongo que todos vieron perfectamente c√≥mo se ve Grafana y sin m√≠ conocen sus problemas, por lo tanto, no sobrecargar√© la publicaci√≥n con fotos. </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  Deliberadamente no describ√≠ detalles t√©cnicos, sino que describ√≠ solo el dise√±o de soporte de este sistema.  En primer lugar, para describir t√©cnicamente completamente el sistema, se requiere un art√≠culo m√°s.  En segundo lugar, no todos estar√°n interesados.  Escriba en los comentarios qu√© detalles t√©cnicos le gustar√≠a saber. </p><br><p>  Si alguien tiene preguntas fuera de este art√≠culo, puedo escribir a a.rodin @ qedr.com </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451778/">https://habr.com/ru/post/451778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451766/index.html">Heisenbug 2019 Piter: lo que suceder√° en la transmisi√≥n gratuita y qu√© solo en el evento</a></li>
<li><a href="../451768/index.html">Mejorando el trabajo de Wi-Fi. Principios generales y cosas √∫tiles.</a></li>
<li><a href="../451770/index.html">Veeam Backup & Replication: consejos √∫tiles para hacer viables las copias de seguridad y r√©plicas</a></li>
<li><a href="../451772/index.html">¬øQu√© tiene de especial Cloudera y c√≥mo cocinarlo?</a></li>
<li><a href="../451776/index.html">¬øC√≥mo programo motores de juego de roles en Hojas de c√°lculo de Google</a></li>
<li><a href="../451780/index.html">Auditor√≠a en 60 minutos: compruebe la resistencia de los empleados a los ataques de phishing a trav√©s de Sophos Phish Threat de forma gratuita</a></li>
<li><a href="../451782/index.html">Subsistema de Windows para Linux (WSL) versi√≥n 2: ¬øc√≥mo ser√°? (Preguntas frecuentes)</a></li>
<li><a href="../451784/index.html">Unidades h√≠bridas para almacenamiento empresarial. Experiencia con Seagate EXOS</a></li>
<li><a href="../451786/index.html">Ejecute pruebas instrumentales en el laboratorio de pruebas de Firebase. Parte 1: proyecto iOS</a></li>
<li><a href="../451790/index.html">Los peligros de la recopilaci√≥n de datos en el juego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>