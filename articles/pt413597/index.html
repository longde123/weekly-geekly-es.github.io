<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜî üòí üë®üèª‚Äçüíª "√öltimo recurso" ou por que o Database First Design √© necess√°rio ‚òòÔ∏è üñºÔ∏è üë®‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo muito tardio, explicarei por que, na minha opini√£o, na maioria dos casos, ao desenvolver um modelo de dados para um aplicativo, voc√™ deve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"√öltimo recurso" ou por que o Database First Design √© necess√°rio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413597/"><p>  Neste artigo muito tardio, explicarei por que, na minha opini√£o, na maioria dos casos, ao desenvolver um modelo de dados para um aplicativo, voc√™ deve seguir a primeira abordagem do banco de dados.  Em vez da abordagem "Java [qualquer outra l√≠ngua] primeiro"), que leva voc√™ a uma longa trajet√≥ria cheia de dor e sofrimento, assim que o projeto come√ßa a crescer. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2ae/fcf/aaf/2aefcfaafbeb94adc7a73ec265b5feb1.png" alt="imagem"><br>  <em>" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CC</a> muito ocupado para ser melhor", <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">licenciado</a> por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alan O'Rourke / Audience Stack</a> .</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Imagem original</a></em> <em><br></em> </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este artigo foi inspirado em uma pergunta recente do StackOverflow</a> . </p><br><p>  Discuss√µes interessantes do reddit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/ r / java</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/ r / programa√ß√£o</a> . </p><br><h2 id="kodogeneraciya">  Gera√ß√£o de c√≥digo </h2><br><p>  Para minha surpresa, um pequeno grupo de usu√°rios parece ter ficado chocado com o fato de o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jOOQ estar</a> fortemente vinculado √† gera√ß√£o do c√≥digo-fonte. </p><br><p>  Embora voc√™ possa usar o jOOQ exatamente como voc√™ gosta, a maneira preferida (de acordo com a documenta√ß√£o) √© come√ßar com o esquema do banco de dados existente, gerar as classes de cliente necess√°rias (correspondentes √†s suas tabelas) usando o jOOQ e, depois disso, √© f√°cil escrever com seguran√ßa de tipo consultas para estas tabelas: </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Record2&lt;String, String&gt; record : DSL.using(configuration) <span class="hljs-comment"><span class="hljs-comment">// ^^^^^^^^^^^^^^^^^^^^^^^ Type information derived from the // generated code referenced from the below SELECT clause .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME) // vvvvv ^^^^^^^^^^^^ ^^^^^^^^^^^^^^^ Generated names .from(ACTOR) .orderBy(1, 2)) { // ... }</span></span></code> </pre> <br><p>  O c√≥digo pode ser gerado manualmente fora da montagem ou automaticamente com cada montagem.  Por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">essa gera√ß√£o pode ocorrer imediatamente ap√≥s a instala√ß√£o das migra√ß√µes do Flyway</a> , que tamb√©m podem ser iniciadas manualmente ou automaticamente. </p><br><h3 id="generaciya-ishodnogo-koda">  Gera√ß√£o de c√≥digo fonte </h3><br><p>  Existem diferentes filosofias, vantagens e desvantagens em rela√ß√£o a essas abordagens √† gera√ß√£o de c√≥digo que eu n√£o quero discutir neste artigo.  Mas, em ess√™ncia, o significado do c√≥digo gerado √© que √© uma representa√ß√£o Java do que consideramos um tipo de "padr√£o" (dentro e fora do sistema).  De certa forma, os compiladores fazem a mesma coisa quando geram bytecode, c√≥digo de m√°quina ou algum outro c√≥digo-fonte a partir da fonte - como resultado, temos uma id√©ia do nosso "padr√£o" em outro idioma espec√≠fico. </p><br><p>  Existem alguns desses geradores de c√≥digo.  Por exemplo, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XJC pode gerar c√≥digo Java a partir de arquivos XSD ou WSDL</a> .  O princ√≠pio √© sempre o mesmo: </p><br><ul><li>  Existe algum padr√£o (externo ou interno), como especifica√ß√£o, modelo de dados, etc. </li><li>  √â necess√°rio ter sua pr√≥pria id√©ia desse padr√£o em nossa linguagem de programa√ß√£o usual. </li></ul><br><p>  E quase sempre faz sentido <em>gerar</em> essa vis√£o para evitar trabalho desnecess√°rio e erros desnecess√°rios. </p><br><h3 id="type-providers-i-obrabotka-annotaciy">  Provedores de tipo e processamento de anota√ß√£o </h3><br><p>  Vale ressaltar que outra abordagem mais moderna para a gera√ß√£o de c√≥digo no jOOQ √© o Type Providers ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como √© feito em F #</a> ), onde o c√≥digo √© gerado pelo compilador durante a compila√ß√£o e nunca existe na forma original.  Uma ferramenta semelhante (mas menos sofisticada) em Java s√£o os processadores de anota√ß√£o, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lombok</a> . </p><br><p>  Nos dois casos, tudo √© igual √† gera√ß√£o normal de c√≥digo, exceto: </p><br><ul><li>  Voc√™ n√£o v√™ o c√≥digo gerado (talvez para muitos isso seja uma grande vantagem?) </li><li>  Voc√™ deve garantir que sua "refer√™ncia" esteja dispon√≠vel em todas as compila√ß√µes.  Isso n√£o causa nenhum problema no caso do Lombok, que anota diretamente o pr√≥prio c√≥digo fonte, que √© o "padr√£o" nesse caso.  Um pouco mais complicado com modelos de banco de dados que dependem de uma conex√£o ao vivo sempre ativa. </li></ul><br><h2 id="v-chem-problema-s-generaciey-koda">  Qual √© o problema com a gera√ß√£o de c√≥digo? </h2><br><p>  Al√©m da quest√£o complicada de gerar o c√≥digo manual ou automaticamente, algumas pessoas pensam que o c√≥digo n√£o precisa ser gerado.  A raz√£o pela qual eu ou√ßo com mais frequ√™ncia √© que essa gera√ß√£o √© dif√≠cil de implementar no pipeline de CI / CD.  E sim, √© verdade, porque  somos sobrecarregados por criar e oferecer suporte a infraestrutura adicional, especialmente se voc√™ √© novo nas ferramentas usadas (jOOQ, JAXB, Hibernate etc.). </p><br><p>  Se a sobrecarga de estudar o gerador de c√≥digo for muito alta, haver√° realmente poucos benef√≠cios.  Mas este √© o √∫nico argumento contra.  Na maioria dos outros casos, n√£o faz absolutamente sentido escrever c√≥digo manualmente, que √© a representa√ß√£o usual de um modelo de algo. </p><br><p>  Muitas pessoas afirmam que n√£o t√™m tempo para isso, porque  agora voc√™ precisa lan√ßar outro MVP o mais r√°pido poss√≠vel.  E eles poder√£o finalizar seu pipeline de CI / CD algum tempo depois.  Nesses casos, costumo dizer: "Voc√™ est√° ocupado demais para melhorar". </p><br><h2 id="no-ved-hibernatejpa-delaet-java-first-razrabotku-gorazdo-prosche">  "Mas o Hibernate / JPA facilita muito o primeiro desenvolvimento do Java." </h2><br><p>  Sim, √© verdade.  Isso √© uma alegria e uma dor para os usu√°rios do Hibernate.  Com ele, voc√™ pode simplesmente escrever v√°rios objetos do formul√°rio: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String title; }</code> </pre> <br><p>  E isso est√° quase pronto.  Em seguida, o Hibernate executar√° toda a rotina sobre como definir esse objeto no DDL e no dialeto SQL desejado: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALWAYS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, title <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> pk_book PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> i_book_title <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> book (title);</code> </pre> <br><p>  Esta √© realmente uma √≥tima maneira de iniciar rapidamente o desenvolvimento - voc√™ s√≥ precisa iniciar o aplicativo. </p><br><p>  Mas nem tudo √© t√£o r√≥seo.  Ainda existem muitas perguntas: </p><br><ul><li>  O Hibernate ir√° gerar o nome necess√°rio para a chave prim√°ria? </li><li>  Vou criar o √≠ndice necess√°rio no campo TITLE? </li><li>  Um valor de ID exclusivo ser√° gerado para cada registro? </li></ul><br><p>  Parece que n√£o.  Mas enquanto o projeto est√° em desenvolvimento, voc√™ sempre pode jogar fora seu banco de dados atual e gerar tudo do zero, adicionando as anota√ß√µes necess√°rias ao modelo. <br>  Portanto, a classe Book em sua forma final ser√° mais ou menos assim: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"book"</span></span>, indexes = { <span class="hljs-meta"><span class="hljs-meta">@Index</span></span>(name = <span class="hljs-string"><span class="hljs-string">"i_book_title"</span></span>, columnList = <span class="hljs-string"><span class="hljs-string">"title"</span></span>) }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = IDENTITY) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String title; }</code> </pre> <br><h2 id="no-vy-zaplatite-za-eto-chut-pozzhe">  Mas voc√™ pagar√° por isso, um pouco mais tarde </h2><br><p>  Cedo ou tarde, seu aplicativo entra em produ√ß√£o e o esquema descrito para de funcionar: </p><br><blockquote>  Em um sistema vivo e real, voc√™ n√£o pode mais simplesmente pegar e soltar seu banco de dados, porque  os dados s√£o usados ‚Äã‚Äãe podem custar muito dinheiro. </blockquote><p>  A partir de agora, voc√™ precisa escrever scripts de migra√ß√£o para cada altera√ß√£o no modelo de dados, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por exemplo, usando o Flyway</a> .  No entanto, o que acontece com suas classes de clientes?  Voc√™ pode adapt√°-los manualmente (o que levar√° ao trabalho dobrado) ou pedir ao Hibernate para ger√°-los (mas qual a probabilidade dos resultados dessa gera√ß√£o atenderem √†s expectativas?).  Como resultado, voc√™ pode esperar grandes problemas. </p><br><p>  Assim que o c√≥digo entra em produ√ß√£o, √© quase imediatamente necess√°rio fazer as corre√ß√µes e o mais r√°pido poss√≠vel. </p><br><p>  E porque  a instala√ß√£o de migra√ß√µes de banco de dados n√£o √© incorporada √† sua linha de montagem; voc√™ precisar√° instalar esses patches manualmente por sua conta e risco.  N√£o haver√° tempo suficiente para voltar e fazer tudo certo.  √â o suficiente para culpar o Hibernate por todos os seus problemas. </p><br><p>  Em vez disso, voc√™ poderia ter agido de maneira bem diferente desde o in√≠cio.  Ou seja, use rodas redondas em vez de quadradas. </p><br><h2 id="vpered-k-database-first">  Ir para o banco de dados primeiro </h2><br><p>  A refer√™ncia e o controle do esquema de dados est√£o no escrit√≥rio do seu DBMS.  Um banco de dados √© o √∫nico local em que um esquema √© definido e todos os clientes t√™m uma <em>c√≥pia</em> desse esquema, mas n√£o vice-versa.  Os dados est√£o no seu banco de dados e n√£o no seu cliente; portanto, faz sentido fornecer controle do esquema e sua integridade exatamente onde os dados est√£o. </p><br><p>  Isso √© sabedoria antiga, nada de novo.  Chaves prim√°rias e exclusivas s√£o boas.  Chaves estrangeiras s√£o lindas.  Verificar as restri√ß√µes no lado do banco de dados √© maravilhoso.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A afirma√ß√£o (quando finalmente s√£o implementadas) √©</a> √≥tima. </p><br><p>  E isso n√£o √© tudo.  Por exemplo, se voc√™ estiver usando Oracle, poder√° especificar: </p><br><ul><li>  Em que espa√ßo de tabela est√° sua tabela? </li><li>  Qual o significado do PCTFREE que ela possui </li><li>  Qual √© o tamanho do cache de sequ√™ncia? </li></ul><br><p>  Talvez tudo isso n√£o importe em sistemas pequenos, mas em sistemas maiores voc√™ n√£o precisa seguir o caminho do "big data" at√© extrair todos os sucos do seu armazenamento atual.  Nem um √∫nico ORM que eu j√° vi (incluindo o jOOQ) permitir√° que voc√™ use o conjunto completo de par√¢metros DDL que o seu DBMS fornece.  Os ORMs oferecem apenas algumas ferramentas para ajud√°-lo a escrever DDL. </p><br><p>  Por fim, um esquema bem projetado s√≥ deve ser gravado manualmente usando uma DDL espec√≠fica do DBMS.  Todos os DDLs gerados automaticamente s√£o apenas uma aproxima√ß√£o a isso. </p><br><h2 id="chto-naschet-klientskoy-modeli">  E o modelo do cliente? </h2><br><p>  Como mencionado anteriormente, voc√™ precisar√° de uma certa representa√ß√£o do esquema do banco de dados no lado do cliente.  Escusado ser√° dizer que essa vis√£o deve ser sincronizada com o modelo real.  Como fazer isso?  Obviamente, usando geradores de c√≥digo. </p><br><p>  Todos os bancos de dados fornecem acesso √†s suas meta-informa√ß√µes atrav√©s do bom e velho SQL.  Portanto, por exemplo, voc√™ pode obter uma lista de todas as tabelas de diferentes bancos de dados: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server SELECT table_schema, table_name FROM information_schema.tables -- DB2 SELECT tabschema, tabname FROM syscat.tables -- Oracle SELECT owner, table_name FROM all_tables -- SQLite SELECT name FROM sqlite_master -- Teradata SELECT databasename, tablename FROM dbc.tables</span></span></code> </pre> <br><p>  S√£o essas consultas (assim como consultas semelhantes para visualiza√ß√µes, visualiza√ß√µes materializadas e fun√ß√µes de tabela) que s√£o executadas quando o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DatabaseMetaData.getTables ()</a> de um driver JDBC espec√≠fico √© chamado, ou no m√≥dulo jOOQ-meta. </p><br><p>  A partir dos resultados dessas consultas, √© relativamente f√°cil criar qualquer representa√ß√£o de cliente do modelo de banco de dados, independentemente da tecnologia de acesso a dados usada. </p><br><ul><li>  Se voc√™ usar JDBC ou Spring, poder√° criar um grupo de constantes String </li><li>  Se estiver usando o JPA, voc√™ mesmo poder√° criar objetos </li><li>  Se voc√™ estiver usando o jOOQ, poder√° criar metamodelos do jOOQ </li></ul><br><p>  Dependendo do n√∫mero de recursos que sua API de acesso a dados oferece (jOOQ, JPA ou outra coisa), o metamodelo gerado pode ser realmente rico e completo.  Como exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a fun√ß√£o de jun√ß√£o impl√≠cita no jOOQ 3.11, que se baseia em meta-informa√ß√µes sobre os relacionamentos de chaves estrangeiras entre suas tabelas</a> . </p><br><p>  Agora, qualquer altera√ß√£o no esquema do banco de dados levar√° automaticamente a uma atualiza√ß√£o do c√≥digo do cliente. </p><br><p>  Imagine que voc√™ precise renomear uma coluna em uma tabela: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> book <span class="hljs-keyword"><span class="hljs-keyword">RENAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> book_title;</code> </pre> <br><p>  Tem certeza de que deseja fazer este trabalho duas vezes?  De jeito nenhum.  Apenas confirme esse DDL, execute a compila√ß√£o e aproveite o objeto atualizado: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"book"</span></span>, indexes = { <span class="hljs-comment"><span class="hljs-comment">// Would you have thought of this? @Index(name = "i_book_title", columnList = "book_title") }) class Book { @Id @GeneratedValue(strategy = IDENTITY) int id; @Column("book_title") String **bookTitle**; }</span></span></code> </pre> <br><p>  Al√©m disso, o cliente recebido n√£o precisa ser compilado todas as vezes (pelo menos at√© a pr√≥xima altera√ß√£o no esquema do banco de dados), o que j√° pode ser uma grande vantagem! <br>  A maioria das altera√ß√µes DDL tamb√©m s√£o altera√ß√µes sem√¢nticas, n√£o apenas sint√°ticas.  Portanto, √© √≥timo ver no c√≥digo do cliente gerado quais exatamente as altera√ß√µes mais recentes no banco de dados afetadas. </p><br><h2 id="pravda-vsegda-odna">  A verdade est√° sempre sozinha </h2><br><p>  Independentemente da tecnologia usada, sempre deve haver apenas um modelo, que √© o padr√£o para o subsistema.  Ou, pelo menos, devemos nos esfor√ßar por isso e evitar confus√£o nos neg√≥cios, onde o "padr√£o" est√° em todo lugar e em nenhum lugar ao mesmo tempo.  Isso torna tudo muito mais f√°cil.  Por exemplo, se voc√™ estiver compartilhando arquivos XML com outro sistema, provavelmente est√° usando o XSD.  Como um metamodelo INFORMATION_SCHEMA jOOQ no formato XML: <a href="">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</a> </p><br><ul><li>  XSD √© bem entendido </li><li>  XSD descreve perfeitamente o conte√∫do XML e permite a valida√ß√£o em todos os idiomas do cliente </li><li>  O XSD torna o versionamento f√°cil e compat√≠vel com vers√µes anteriores </li><li>  XSD pode ser transformado em c√≥digo Java usando XJC </li></ul><br><p>  Damos especial aten√ß√£o ao √∫ltimo ponto.  Ao se comunicar com um sistema externo por meio de mensagens XML, devemos ter certeza da validade das mensagens.  E √© realmente muito f√°cil de fazer com coisas como JAXB, XJC e XSD.  Seria louco pensar sobre a adequa√ß√£o da abordagem Java primeiro neste caso.  O XML gerado com base nos objetos XML ser√° de baixa qualidade, ser√° mal documentado e dif√≠cil de estender.  E se houver um SLA para essa intera√ß√£o, voc√™ ficar√° desapontado. </p><br><p>  Honestamente, isso √© semelhante ao que est√° acontecendo com as v√°rias APIs JSON agora, mas essa √© uma hist√≥ria completamente diferente ... </p><br><h3 id="chem-bazy-dannyh-huzhe">  O que torna os bancos de dados piores? </h3><br><p>  Ao trabalhar com um banco de dados, tudo √© o mesmo aqui.  O banco de dados possui os dados e tamb√©m deve ser o mestre do esquema de dados.  Todas as modifica√ß√µes de esquema devem ser feitas diretamente atrav√©s do DDL para atualizar a refer√™ncia. </p><br><p>  Ap√≥s atualizar a refer√™ncia, todos os clientes devem atualizar suas id√©ias sobre o modelo.  Alguns clientes podem ser gravados em Java usando jOOQ e / ou Hibernate ou JDBC.  Outros clientes podem ser escritos em Perl (boa sorte para eles) ou mesmo em C #.  Isso n√£o importa.  O modelo principal est√° no banco de dados.  Embora os modelos criados usando o ORM sejam de baixa qualidade, pouco documentados e dif√≠ceis de estender. </p><br><p>  Portanto, n√£o fa√ßa isso e desde o in√≠cio do desenvolvimento.  Em vez disso, comece com um banco de dados.  Crie um pipeline de CI / CD automatizado.  Use a gera√ß√£o de c√≥digo para gerar automaticamente um modelo de banco de dados para clientes para cada build.  E pare de se preocupar, tudo ficar√° bem.  Tudo o que √© necess√°rio √© um pequeno esfor√ßo inicial para configurar a infraestrutura, mas, como resultado, voc√™ obter√° um ganho no processo de desenvolvimento para o restante do seu projeto nos pr√≥ximos anos. </p><br><p>  N√£o, obrigado. </p><br><h2 id="poyasneniya">  Explica√ß√µes </h2><br><p>  Para consolidar: este artigo de forma alguma afirma que o modelo de banco de dados deve ser aplicado a todo o sistema (√°rea de assunto, l√≥gica de neg√≥cios etc.).  Minhas declara√ß√µes consistem apenas no fato de que o c√≥digo do cliente que interage com o banco de dados deve ser apenas uma <em>representa√ß√£o</em> do esquema do banco de dados, mas n√£o o define e forma de forma alguma. </p><br><p>  Nas arquiteturas de duas camadas que ainda existem, o esquema do banco de dados pode ser a √∫nica fonte de informa√ß√µes sobre o modelo do seu sistema.  No entanto, na maioria dos sistemas, vejo o n√≠vel de acesso a dados como um "subsistema" que encapsula um modelo de banco de dados.  Algo assim. </p><br><h2 id="isklyucheniya">  Exce√ß√µes </h2><br><p>  Como em qualquer outra boa regra, a nossa tamb√©m tem suas exce√ß√µes (e eu j√° avisei que a primeira abordagem do banco de dados e a gera√ß√£o de c√≥digo nem sempre √© a escolha certa).  Essas exce√ß√µes (talvez a lista n√£o esteja completa): </p><br><ul><li>  Quando o circuito n√£o √© conhecido antecipadamente e precisa ser investigado.  Por exemplo, voc√™ √© um provedor de uma ferramenta para ajudar os usu√°rios a navegar em qualquer esquema.  Obviamente, n√£o pode haver gera√ß√£o de c√≥digo.  Mas, em qualquer caso, voc√™ precisa lidar com o pr√≥prio banco de dados e seu esquema. </li><li>  Quando, para alguma tarefa, voc√™ precisa criar um esquema em tempo real.  Isso pode ser semelhante a uma das varia√ß√µes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">padr√£o Entity-attribute-value</a> , como  voc√™ n√£o tem um padr√£o claramente definido.  Assim como n√£o h√° certeza de que o RDBMS, neste caso, seja a escolha certa. </li></ul><br><p>  A peculiaridade dessas exce√ß√µes √© que elas raramente se encontram na vida selvagem.  Na maioria dos casos, ao usar bancos de dados relacionais, o esquema √© conhecido antecipadamente e √© o "padr√£o" do seu modelo, e os clientes devem trabalhar com uma c√≥pia desse modelo gerada usando geradores de c√≥digo. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413597/">https://habr.com/ru/post/pt413597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413585/index.html">Colabora√ß√£o Hansen: boa ou nada (parte 2)</a></li>
<li><a href="../pt413587/index.html">Avaliando a cobertura de teste de um projeto Java usando o Apache Ignite como exemplo</a></li>
<li><a href="../pt413589/index.html">Revis√£o de C√≥digo: Experi√™ncia de Sucesso</a></li>
<li><a href="../pt413591/index.html">Rob√≥tica Industrial - 57 anos! Lembre-se de onde vem a contagem</a></li>
<li><a href="../pt413593/index.html">Continuando a conquistar o fundo do mar. Microsoft e seu projeto de data center submarino Natick 2</a></li>
<li><a href="../pt413599/index.html">H√° S.L.O.N.a em partes. Introduzir ITAM e n√£o sufocar</a></li>
<li><a href="../pt413601/index.html">O data center da Microsoft aquece o mar ao redor</a></li>
<li><a href="../pt413603/index.html">Gera√ß√£o de c√≥digo no Uber</a></li>
<li><a href="../pt413605/index.html">Pergunte a Ethan: O que acontece quando uma estrela passa pelo sistema solar?</a></li>
<li><a href="../pt413607/index.html">Resumo da Fintech: as moedas digitais n√£o amea√ßam o sistema financeiro da Federa√ß√£o Russa; O PayPal descobriu quanto gastam os jogadores em jogos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>