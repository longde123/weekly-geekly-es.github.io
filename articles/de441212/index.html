<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚱 👩🏿‍⚖️ 👨🏾‍🔧 Arbeiten Sie mit kryptografischem Informationsschutz und Hardwareschlüsselträgern unter Linux 👩🏾‍🤝‍👩🏼 👨🏿‍💻 🥁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Speichern von Schlüsseln auf Token und Smartcards bietet zusätzlichen Schutz vor externen und internen Eindringlingen, einschließlich solcher, die...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arbeiten Sie mit kryptografischem Informationsschutz und Hardwareschlüsselträgern unter Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/441212/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6t/xz/yg/6txzyg12acxsce8jlw0nl-ukdqa.png" width="80%" height="80%"></div><br>  Das Speichern von Schlüsseln auf Token und Smartcards bietet zusätzlichen Schutz vor externen und internen Eindringlingen, einschließlich solcher, die einen bestimmten Zugriff auf das Informationssystem und die Ausrüstung haben. <br><br>  Heute werde ich Ihnen erklären, wie wir Verschlüsselungsschlüssel und elektronische Signaturen in unseren Informationssystemen schützen, und ich werde dies in einer detaillierten, gut illustrierten Anleitung zum Einrichten von SUSE Linux Enterprise Server 12 SP3 für die Arbeit mit dem Aladdin JaCarta PKI-Token und CryptoPro CSP KC2 4.0.9944 tun. <br><br>  Es gab mehrere Gründe für die Veröffentlichung dieses Handbuchs: <br><a name="habracut"></a><br><h4>  Grund 1 </h4><br>  Die offizielle Dokumentation zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aladdin-RD JaCarta ist</a> besser für Astra Linux- und ALT Linux-Betriebssysteme geeignet, die vom Verteidigungsministerium, FSTEC und dem FSB als Mittel zum Schutz von Informationen zertifiziert wurden. <br><br><h4>  Grund 2 </h4><br>  Die beste Anleitung zum Einrichten der Interaktion mit Hardwaremedien unter Linux stammt auch von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wiki.astralinux.ru - Arbeiten mit CryptoPro CSP</a> <br><br><h4>  Grund 3 </h4><br>  <b>UPD 16.04.2019:</b> Bei der Einrichtung der Umgebung und der Ausrüstung stellte sich heraus, dass der zuerst verfügbare Netzbetreiber erwartungsgemäß überhaupt nicht JaCarta PKI Nano war, sondern ein Gerät, das im eToken PRO-Modus des SafeNet Authentication Client betrieben wird. <br><br>  <b>UPD 16.04.2019:</b> Einmal brauchte die Bank ein Gerät, das in derselben Infrastruktur wie eToken PRO (Java) arbeiten konnte.  Als solches Gerät hat die Firma "ZAO Aladdin R.D."  bot einen JaCarta PRO-Token an, der von der Bank ausgewählt wurde.  Bei der Erstellung des Artikels und der Versanddokumente hat ein Mitarbeiter des Unternehmens jedoch einen Fehler gemacht.  Anstelle des JaCarta PRO-Modells wurde JaCarta PKI versehentlich in den Artikel und die Versanddokumente eingegeben. <br><br>  <b>UPD 16.04.2019: Ich</b> danke der Firma Aladdin R.D. für ihre Hilfe bei der <b>Ermittlung</b> und Feststellung der Wahrheit. <br><br><blockquote>  Dieser Fehler enthält keine politischen und versteckten Bedeutungen, sondern nur den technischen Fehler eines Mitarbeiters bei der Erstellung von Dokumenten.  Token JaCarta PRO ist ein Produkt der Firma Aladdin R.D.  Das Applet für den Funktionsteil wurde von der Firma „ZAO Aladdin R.D.“ entwickelt. </blockquote><br><br>  Dieser eToken PRO war für eine Party, die vor dem 1. Dezember 2017 veröffentlicht wurde. <br>  Nach diesem Datum wurde die Firma "Aladdin R.D."  Verkauf von eToken PRO (Java) -Geräten eingestellt. <br><br>  Ich muss sagen, dass die Arbeit mit ihm über die entsprechenden Treiber konfiguriert wurde - <b>SafenetAuthenticationClient-10.0.32-0.x86_64</b> , die nur zur Unterstützung von Aladdin R.D.  auf einer separaten Online-Bewerbung. <br><br>  In CryptoPro CSP musste das <b>Paket cprocsp-rdr-emv-64 |</b> installiert werden, um mit diesem Token arbeiten zu können  <b>EMV / Gemalto-Unterstützungsmodul</b> . <br><br>  Dieses Token wurde ermittelt und beantwortet.  Mit dem Dienstprogramm <b>SACTools</b> aus dem Paket <b>SafenetAuthenticationClient</b> konnte es initialisiert werden.  Bei der Arbeit mit dem Schutz kryptografischer Informationen verhielt er sich jedoch äußerst seltsam und unvorhersehbar. <br><br>  Auf dem Befehl wurde Folgendes angezeigt: <br><br><pre><code class="plaintext hljs">csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (205D325E5842) 00 00\alfa_shark' -check</code> </pre> <br>  Die Antwort war, dass alles in Ordnung war: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x00000000]</code> </pre> <br>  Unmittelbar nach dem Versuch, die Tasten programmgesteuert zu lesen, führte dieselbe Überprüfung zu einem Fehler: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x8009001a]</code> </pre> <br>  Gemäß der Liste der Fehlercodes des Objektmodells der Komponenten von Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">COM-Fehlercodes (Sicherheit und Einrichtung)</a> <br><br><pre> <code class="plaintext hljs">NTE_KEYSET_ENTRY_BAD 0x8009001A Keyset as registered is invalid.</code> </pre> <br>  "Ungültiger Schlüsselsatz" - Der Grund für diese Meldung kann entweder im alten Gemalto-Chip, in der Firmware und im Applet oder in den Treibern für das Betriebssystem liegen, die die neuen ES-Generierungsstandards und Hash-Funktionen GOST R 34.10-2012 und GOST R 34.11- nicht unterstützen. 2012. <br><br>  In diesem Zustand wurde das Token blockiert.  Der kryptografische Informationsschutzindex zeigte den irrelevanten Zustand des Lesers und des Schlüsselcontainers an.  Das Neustarten des <b>cprocsp-</b> Dienstes <b>für</b> kryptografische Anbieter, der <b>pcscd-Token-</b> und Smartcard- <b>Dienste</b> und des gesamten Betriebssystems hat nicht geholfen, sondern nur die Neuinitialisierung. <br><br>  Fairerweise sollte beachtet werden, dass SafeNet eToken PRO mit den Schlüsseln GOST R 34.10-2001 unter Windows 7 und 10 ordnungsgemäß funktioniert hat. <br><br>  Sie können versuchen, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CryptoPro CSP 4.0 FCN (Gemalto) zu</a> installieren. Ziel ist es jedoch, unsere ES- und Verschlüsselungsschlüssel mit von der JaCarta-Familie zertifizierten FSB- und FSTEC-Produkten zu schützen, die neue Standards unterstützen. <br><br>  Das Problem wurde gelöst, indem der echte JaCarta PKI-Token in das (XL) reguläre Gehäuse gesteckt wurde. <br><br>  Es wurde jedoch viel Zeit darauf verwendet, Safenet eToken PRO zum Laufen zu bringen.  Ich wollte darauf aufmerksam machen und vielleicht jemanden davor schützen. <br><br><h4>  Grund 4 </h4><br>  Manchmal müssen Sie selbst zu alten Artikeln und Anweisungen zurückkehren.  Dies ist praktisch, wenn die Informationen in einer externen Quelle gespeichert werden.  Also danke an Habr für die Gelegenheit. <br><br><h2>  Setup-Anleitung </h2><br>  Nach der Installation des JaCarta PKI-Tokens am USB-Anschluss des Servers und dem Starten des Systems überprüfen wir, ob das neue Gerät erkannt wurde und in der Liste angezeigt wird: <br><br> <code>lsusb</code> <br> <br><img src="https://habrastorage.org/webt/ge/fs/tu/gefstux3tlhb7j0pag8r_fa-ose.png"><br><br>  In unserem Fall handelt es sich um das <i>Bus 004-Gerät 003: ID 24dc: 0101</i> <br><br>  Zur Diagnose von Lesern können Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstprogramm pcsc-tools aus dem Projekt security: chipcard (software.opensuse.org) verwenden</a> . <br><br>  Es wird durch den Befehl gestartet: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/rm/v3/ki/rmv3kikfuuwmh8c9mijm3it-ieq.png"><br><br>  Bis alle erforderlichen Pakete installiert sind, werden keine Informationen zum Token angezeigt. <br><br><h3>  Installation von Treibern und Software für die Arbeit mit JaCarta PKI </h3><br>  Auf der Support-Seite der Website "Aladdin R.D."  Wir laden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation und Software</a> herunter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, um nur mit JaCarta PKI zu arbeiten</a> <br><br>  Gemäß dem JaCarta for Linux-Implementierungshandbuch, Abschnitt 4.2, besteht der erste Schritt darin, <b>pcsc-lite</b> , <b>ccid</b> und <b>libusb</b> zu installieren. <br><blockquote>  Damit das JaCarta-Verwaltungsdienstprogramm funktioniert, müssen die folgenden Komponenten installiert sein: <br><br><ul><li>  PC / SC Lite - eine Zwischenschicht für den Zugriff auf Smartcards gemäß dem PC / SC-Standard, pcsc-lite-Paket. </li><li>  Ccid- und libusb-Bibliotheken für die Arbeit mit USB-Sticks, Smartcards und Smartcard-Lesegeräten. </li></ul></blockquote>  Wir prüfen die Verfügbarkeit dieser Pakete und installieren: <br><br> <code>zypper search pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/ez/0m/n_/ez0mn_o8-hmwibwiiltr5jk34xi.jpeg"><br><br> <code>zypper search libusb</code> <br> <br><img src="https://habrastorage.org/webt/ba/jn/zt/bajnztgbtt_fsbfp0tanzfvv7hk.png"><br><br> <code>zypper install pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/qe/6i/pl/qe6ipldd5fimbo_m7j4yrmvtibw.jpeg"><br><br><img src="https://habrastorage.org/webt/1m/bo/mc/1mbomc3je9v8e82whld_0tqheje.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/mq/f4/8x/mqf48xewg61la3nuv_kumzsaxkq.png"><br><br> <code>zypper install pcsc-ccid</code> <br> <br><img src="https://habrastorage.org/webt/lx/yv/ng/lxyvngqgd1d_rdkh7tw2lofepjs.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/kq/az/ly/kqazlyxzmdusuprtyyfjhkkjick.jpeg"><br><br> <code>zypper install libusb</code> <br> <br><img src="https://habrastorage.org/webt/1f/ul/bk/1fulbklde9aj87m_ur21u8xvms0.png"><br><br>  Infolgedessen wurde das pcsc-lite-Paket aktualisiert, CCID installiert, libusb keine Aktion erforderlich. <br><br>  Die folgenden zwei Befehle installieren das Paket mit Treibern und Software direkt für die Arbeit mit JaCarta PKI: <br><br> <code>zypper install idprotectclientlib-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ux/ep/1u/uxep1uijp_2kvyix-yn6qkg5ing.jpeg"><br><br> <code>zypper install idprotectclient-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/xy/32/hq/xy32hqxgtmgwpn-pocygfs-rn3q.jpeg"><br><br>  Überprüfen Sie, ob die Treiber und die Software für JaCarta PKI installiert sind: <br><br> <code>zypper search idprotectclient</code> <br> <br><img src="https://habrastorage.org/webt/7k/os/nk/7kosnk44-yewdh9i7odevcdzqdc.jpeg"><br><br>  Beim Versuch, SafeNet eToken PRO zum Laufen zu bringen, habe ich Informationen gefunden, dass das in SLES vorinstallierte Paket <b>openct - Library for Smart Card Readers</b> möglicherweise mit der <b>PCSC Smart Cards Library von pcsc-lite</b> in Konflikt <b>steht</b> , für deren Installation Aladdin R.D. <br><br> <code>zypper search openct</code> <br> <br><img src="https://habrastorage.org/webt/g8/ja/mr/g8jamrjqjkxybghgrj8rnbfuuaw.png"><br><br>  Deshalb entfernen wir das openct-Paket: <br><br> <code>rpm -e openct</code> <br> <br>  Jetzt sind alle notwendigen Treiber und Software für die Arbeit mit dem Token installiert. <br><br>  <b>Wir führen</b> Diagnosen mit dem <b>Dienstprogramm pcsc-tools durch</b> und stellen sicher, dass JaCarta im Betriebssystem erkannt wird: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/t_/5s/ga/t_5sgar9ugi-z-mx2isjhpxfzj8.jpeg"><br><br><h3>  Installieren von CryptoPro CSP-Paketen </h3><br>  Bei der standardmäßigen Installation von CryptoPro CSP fehlen die erforderlichen Pakete für die Arbeit mit Token und Smartcards. <br><br> <code>zypper search cprocsp</code> <br> <br><img src="https://habrastorage.org/webt/kq/g7/sc/kqg7scnpbnxlbxiicva_gjejk8k.png"><br><br>  Installieren der <b>JaCarta-Komponenten für die CryptoPro CSP-</b> Unterstützungskomponente <b>im CSP</b> <br><br> <code>zypper install cprocsp-rdr-jacarta-64-3.6.408.683-4.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/9d/uu/3e/9duu3e1vs9wu3qotu6dsllot9km.jpeg"><br><br>  Einige Komponenten haben Abhängigkeiten.  Wenn Sie beispielsweise versuchen, das SafeNet eToken PRO-Supportpaket <b>cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm - EMV / Gemalto-Supportmodul</b> zu installieren, wird eine Meldung <b>angezeigt,</b> dass zuerst die Basiskomponente des CSP-Reader-Support- <b>cprocsp</b> installiert werden <b>muss -rdr-pcsc-64-4.0.9944-5.x86_64.rpm - PC / SC-Komponenten für CryptoPro CSP-Reader</b> : <br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm Loading repository data... Reading installed packages... Resolving package dependencies... Problem: nothing provides cprocsp-rdr-pcsc-64 &gt;= 4.0 needed by cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 1: do not install cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 2: break cprocsp-rdr-emv-64-4.0.9944-5.x86_64 by ignoring some of its dependencies Choose from above solutions by number or cancel [1/2/c] (c): c</code> </pre><br>  Installieren Sie die grundlegenden Support-Pakete für Leser und wichtige Medien: <br><br> <code>zypper install cprocsp-rdr-pcsc-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ku/al/eh/kualehuiobnjcc6sxcfgzlzedcu.png"><br><br> <code>zypper install lsb-cprocsp-pkcs11-64-4.0.9944-5.x86_64.rpm</code> <br> <br>  Jetzt können Sie Module für die Arbeit mit anderen Arten von Medien und GUI-Komponenten installieren: <br><br> <code>zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/b1/ka/hy/b1kahy9lzptzyp6gclxtou5775y.png"><br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-novacard-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-mskey-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-gui-gtk-64-4.0.9944-5.x86_64.rpm</code> </pre><br><img src="https://habrastorage.org/webt/gn/rs/s-/gnrss-ht0-vovsebsgfdvdioxhc.png"><br><br>  Überprüfen Sie die endgültige Konfiguration von CryptoPro CSP: <br><br><pre> <code class="plaintext hljs">zypper search cprocsp Loading repository data... Reading installed packages...</code> </pre><br><br> <code>S | Name | Summary | Type <br> ---+-----------------------------+----------------------------------------------------+-------- <br> i+ | cprocsp-curl-64 | CryptoPro Curl shared library and binaris. Build 9944. | package <br> i+ | cprocsp-rdr-emv-64 | EMV/Gemalto support module | package <br> i+ | cprocsp-rdr-gui-gtk-64 | GUI components for CryptoPro CSP readers. Build 9944. | package <br> i+ | cprocsp-rdr-jacarta-64 | JaCarta components for CryptoPro CSP. Build 683. | package <br> i+ | cprocsp-rdr-mskey-64 | Mskey support module | package <br> i+ | cprocsp-rdr-novacard-64 | Novacard support module | package <br> i+ | cprocsp-rdr-pcsc-64 | PC/SC components for CryptoPro CSP readers. Build 9944.| package <br> i+ | lsb-cprocsp-base | CryptoPro CSP directories and scripts. Build 9944. | package <br> i+ | lsb-cprocsp-ca-certs | CA certificates. Build 9944. | package <br> i+ | lsb-cprocsp-capilite-64 | CryptoAPI lite. Build 9944. | package <br> i+ | lsb-cprocsp-kc2-64 | CryptoPro CSP KC2. Build 9944. | package <br> i+ | lsb-cprocsp-pkcs11-64 | CryptoPro PKCS11. Build 9944. | package <br> i+ | lsb-cprocsp-rdr-64 | CryptoPro CSP readers. Build 9944. | package <br></code> <br><br><img src="https://habrastorage.org/webt/f-/rc/ad/f-rcadtwgu68ba6ad5wde2zke-m.jpeg"><br><br>  Um die Änderungen zu übernehmen, starten wir den Dienst für kryptografische Anbieter neu und überprüfen seinen Status: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br><img src="https://habrastorage.org/webt/vd/1a/th/vd1athcps5p7fe9cjp_ipmvvq-a.jpeg"><br><br><h3>  Einrichtung und Diagnose von CryptoPro CSP </h3><br>  Überprüfen Sie mit den folgenden Befehlen, ob der kryptografische Anbieter unser Token und andere verfügbare Medientypen sieht: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -card -enum -v –v</code> <br> <br><img src="https://habrastorage.org/webt/2m/z1/d4/2mz1d4m5oyvg9nknwbnci24wcre.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -enum -info -type PP_ENUMREADERS | iconv -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/i0/xw/ro/i0xwroly12wmu3ejps9udt4tvxs.png"><br><br> <code>/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -view -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/id/qu/rm/idqurmsxvepldfelr_w9vakfbwu.jpeg"><br><br>  <b>Aladdin RD JaCarta [SCR-Schnittstelle] (000000000000) 00 00</b> ist unser Medium. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befolgen Sie</a> die Anweisungen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CryptoPro CSP für Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfigurieren Sie</a> die Registrierung beim kryptografischen Anbieter: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -add "Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</code> </pre> <br><img src="https://habrastorage.org/webt/1v/xj/z_/1vxjz_h0nppdftdaeylhhobwt-a.png"><br><br>  Als Ergebnis der Ausführung in der Konfigurationsdatei <b>/etc/opt/cprocsp/config64.ini</b> <br>  Ein Eintrag wird zum Abschnitt [KeyDevices \ PCSC] hinzugefügt: <br><br> <code>[KeyDevices\PCSC\"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"\Default] <br></code> <br><br>  Um die Anforderungen des CryptoPro CSP-Formulars, der Nutzungsbedingungen und des Sicherheitsadministratorhandbuchs zu erfüllen: <br><blockquote>  Die Verwendung von CryptoPro CSP CIP Version 4.0 bei deaktiviertem erweiterten Schlüsselsteuerungsmodus ist nicht zulässig.  Die Aufnahme dieses Modus ist in den Dokumenten ZHTYA.00087-01 91 02 beschrieben. Sicherheitsadministratorhandbuch. </blockquote>  Es ist erforderlich, eine verbesserte Kontrolle der Schlüsselverwendung zu ermöglichen: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -ini '\config\parameters' -add long StrengthenedKeyUsageControl 1</code> </pre> <br>  Überprüfen Sie, ob der Modus aktiviert ist: <br><br> <code>cat /etc/opt/cprocsp/config64.ini | grep StrengthenedKeyUsageControl</code> <br> <br><img src="https://habrastorage.org/webt/lg/hn/mm/lghnmmk1d5g9xhmxgmyqjcsrddo.jpeg"><br><br>  Wir starten den Dienst des kryptografischen Anbieters neu: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br>  Nach dem Neustart prüfen wir, ob bei der Arbeit des Anbieters mit wichtigen Netzbetreibern keine Fehler vorliegen: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset –verifycontext</code> <br> <br><img src="https://habrastorage.org/webt/qo/5x/v7/qo5xv7ayjfqa1ssyuds6dl-f-ue.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset -verifycontext -enum –unique</code> <br> <br><pre> <code class="plaintext hljs">CSP (Type:80) v4.0.9017 KC2 Release Ver:4.0.9944 OS:Linux CPU:AMD64 FastCode:REA AcquireContext: OK. HCRYPTPROV: 16052291 alfa_shark1 |SCARD\JACARTA_4E3900154029304C\CC00\E9F6 OK. Total: SYS: 0.000 sec USR: 0.000 sec UTC: 4.560 sec [ErrorCode: 0x00000000]</code> </pre><br><h3>  Arbeiten Sie mit JaCarta PKI Token </h3><br>  Lassen Sie uns das Xming-Programm (X11-Weiterleitung) an unserer Station ausführen, damit wir die grafischen Schnittstellen der erforderlichen Dienstprogramme über SSH öffnen und damit arbeiten können. <br><br><img src="https://habrastorage.org/webt/-s/8j/r9/-s8jr9lfz0xkjurnsrgvwx71pfy.png"><br><br>  Nach der Installation der <b>IDProtectClient</b> - Software für die Arbeit mit JaCarta PKI wurden zwei Dateien auf dem Server im Ordner <b>/ usr / share / applications</b> angezeigt: <br><br>  Athena-IDProtectClient.desktop <br>  Athena-IDProtectManager.desktop <br><br>  Dies sind Verknüpfungen, in denen Sie die Startoptionen für die Dienstprogramme <i>Exec = / usr / bin / SACTools anzeigen können</i> <br><br>  Führen Sie das Dienstprogramm <b>IDProtectPINTool aus</b> . <br><br>  Damit werden PIN-Zugangscodes für das Token festgelegt und geändert. <br><br> <code>/usr/bin/IDProtectPINTool</code> <br> <br><img src="https://habrastorage.org/webt/wx/nf/-j/wxnf-jyonzkwr2hs2cnfy1wzxie.png"><br><br>  Bei der erstmaligen Initialisierung des Tokens ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">standardmäßig</a> ein Link hilfreich, der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PIN-Codes (Kennwörter) der wichtigsten Träger enthält</a> <br><br>  Mit <b>dem</b> Programm <b>IDProtect_Manager</b> können <b>Sie</b> Informationen zum Token und Container mit Schlüsseln und Zertifikat anzeigen: <br><br> <code>/usr/bin/IDProtect_Manager</code> <br> <br><img src="https://habrastorage.org/webt/nb/xb/ex/nbxbexx9njsuvpxawxszgs3lr8s.png"><br><br>  Um mit den Schlüsseln auf den Container zuzugreifen, müssen Sie das Passwort eingeben: <br><br><img src="https://habrastorage.org/webt/oh/pp/l_/ohppl_roac1knnwejckvd8afypy.png"><br><br><img src="https://habrastorage.org/webt/to/bh/vb/tobhvb23ey_zq2cdwp166-qrs5m.png"><br><br>  Für die Arbeit mit <b>SafeNet Authentication Client eToken PRO</b> gibt es ähnliche Programme - <b>SafeNet Authentication Client Monitor</b> und <b>SafeNet Authentication Client Tools</b> , die wie <b>folgt ausgeführt</b> werden: <br><br><pre> <code class="plaintext hljs">/usr/bin/SACMonitor /usr/bin/SACTools</code> </pre><br><img src="https://habrastorage.org/webt/ox/kl/by/oxklbysagi4vqp8crlzbzpmbuv8.jpeg"><br><br>  Es ist bequemer, Vorgänge direkt mit Schlüsselcontainern in der Schnittstelle des Kryptografieanbieters CryptoPro JavaCSP auszuführen: <br><br> <code>/jdk1.8.0_181/jre/bin/java ru.CryptoPro.JCP.ControlPane.MainControlPane <br></code> <br><br><img src="https://habrastorage.org/webt/yj/fi/je/yjfije_eiqqx49g1s7lvwbcwtlc.jpeg"><br><br>  Um Informationen zum Inhalt des Containers mit den Schlüsseln anzuzeigen, können Sie den folgenden Befehl ausführen: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark1' -info</code> </pre> <br>  Verwenden Sie zur Diagnose des Containers denselben Befehl mit dem Schalter –check <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark' –check</code> </pre> <br>  Sie müssen das Passwort für den Container eingeben: <br><br><img src="https://habrastorage.org/webt/m1/n4/cv/m1n4cvq78kcuqrfn1c7oxm9y3o4.png"><br><br><img src="https://habrastorage.org/webt/jr/vi/ga/jrvigahwffdkjcmfuwnwij4pdds.jpeg"><br><br><h3>  Abrufen von Software-Schlüsseln </h3><br>  Im Allgemeinen lautet ein Beispiel für das Abrufen eines privaten Schlüssels und eines Zertifikats mit öffentlichem Schlüssel aus einem Container auf einem Token mithilfe von CryptoPro Java CSP wie folgt: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.KeyStore.JCPPrivateKeyEntry; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.params.JCPProtectionParameter; KeyStore keyStore = KeyStore.getInstance(<span class="hljs-string"><span class="hljs-string">"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</span></span>, <span class="hljs-string"><span class="hljs-string">"JCSP"</span></span>); keyStore.load(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); JCPPrivateKeyEntry entry = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; X509Certificate certificate = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PrivateKey privateKey = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { entry = (JCPPrivateKeyEntry) keyStore.getEntry(keyAlias, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JCPProtectionParameter(pwd)); certificate = (X509Certificate) entry.getCertificate(); privateKey = entry.getPrivateKey(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnrecoverableEntryException | NullPointerException e) { LOGGER.log(Level.WARNING, PRIVATE_KEY_NOT_FOUND + keyAlias + ExceptionUtils.getFullStackTrace(e)); }</code> </pre><br><br>  Wenn Sie so handeln: <br><br><pre> <code class="java hljs">Key key = keyStore.getKey(keyAlias, pwd);</code> </pre><br>  Anschließend versucht der kryptografische Anbieter, eine Anforderung zur Eingabe des Kennworts für den Container über die Konsole oder das GUI-Fenster anzuzeigen. <br><br><h3>  Ergebnisse </h3><br>  Das Token-Key-Carrier-Token wird am internen USB-Anschluss des Servers installiert. <br><br>  Die Serverhardware selbst ist versiegelt und befindet sich in einem Raum mit eingeschränktem Zugriff. <br><br>  Solche Maßnahmen können den Schutz unserer Informationssysteme vor Diebstahl und Kompromittierung elektronischer Signaturen oder Verschlüsselungsschlüssel sowohl über das Netzwerk als auch physisch erhöhen. <br><br><h3>  Nützliche Links </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aladdin-RD JaCarta Dokumentation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wiki.astralinux.ru - Arbeiten Sie mit CryptoPro CSP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Liste der Fehlercodes des Objektmodells der Komponenten von Microsoft COM-Fehlercodes (Sicherheit und Einrichtung)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CryptoPro CSP 4.0 CSP 4.0 FCN (Gemalto)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pcsc-Tools Reader Diagnosedienstprogramm aus Sicherheit: Chipkartenprojekt (software.opensuse.org)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CryptoPro CSP für Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anpassung.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aladdin-RD-Standardschlüsselträger-PINs (Passwörter)</a> <br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de441212/">https://habr.com/ru/post/de441212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de441202/index.html">Träumen Dienstleistungsunternehmen von ihren Produkten? Gespräch mit Maxilect</a></li>
<li><a href="../de441204/index.html">Ein fortschrittlicher Ansatz zum Erkennen von Grenzen am Beispiel von Schiffswänden</a></li>
<li><a href="../de441206/index.html">Wolfensteiny 3D - Reverse Engineering 251 Bytes JavaScript</a></li>
<li><a href="../de441208/index.html">Wie wir die Kreditvergabe auf 2 Klicks reduziert haben</a></li>
<li><a href="../de441210/index.html">Cluster-Speicher Schrittmacher + DRBD (Dual Primary) + Samba</a></li>
<li><a href="../de441214/index.html">Kibana Benutzerhandbuch. Visualisierung. Teil 1</a></li>
<li><a href="../de441216/index.html">Schwarzer Spiegel oder Picooc-Anzeige?</a></li>
<li><a href="../de441218/index.html">OpenAI Gym + ROS + Gazebo: Training eines eigenständigen Roboters zu Hause. Teil 1</a></li>
<li><a href="../de441220/index.html">Analyse der jüngsten Massenangriffe mit DNS-Erfassung</a></li>
<li><a href="../de441222/index.html">Warum ist Kubernetes so kompliziert mit Repositories?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>