<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè° üé≥ üë©üèæ‚Äçüîß Operaci√≥n de conejos (RabbitMQ) en el modo "Sobrevivir a cualquier costo" ‚õ≥Ô∏è ü¶â üôãüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="" Empresa " - operador de telecomunicaciones PJSC "Megafon" 
 " Noda " es el servidor RabbitMQ. 
 Un " cl√∫ster " es una combinaci√≥n, en nuestro caso d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Operaci√≥n de conejos (RabbitMQ) en el modo "Sobrevivir a cualquier costo"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434016/">  " <b>Empresa</b> " - operador de telecomunicaciones PJSC "Megafon" <br>  " <b>Noda</b> " es el servidor RabbitMQ. <br>  Un " <b>cl√∫ster</b> " es una combinaci√≥n, en nuestro caso de tres, de nodos RabbitMQ que funcionan como un todo. <br>  " <b>Contorno</b> ": un conjunto de cl√∫steres RabbitMQ, cuyas reglas para trabajar se determinan en el equilibrador frente a ellos. <br>  " <b>Balanceador</b> ", " <b>hap</b> " - Haproxy - equilibrador que realiza la funci√≥n de conmutar la carga en grupos dentro del bucle.  Se utilizan un par de servidores Haproxy que se ejecutan en paralelo para cada bucle. <br>  " <b>Subsistema</b> ": el editor y / o consumidor de los mensajes transmitidos a trav√©s del conejo <br>  " <b>SISTEMA</b> ": un conjunto de subsistemas, que es una soluci√≥n √∫nica de software y hardware utilizada por la empresa, caracterizada por la distribuci√≥n en toda Rusia, pero con varios centros donde fluye toda la informaci√≥n y donde tienen lugar los principales c√°lculos y c√°lculos. <br>  <b>SYSTEM</b> - un sistema distribuido geogr√°ficamente - desde Khabarovsk y Vladivostok hasta San Petersburgo y Krasnodar.  Arquitect√≥nicamente, estos son varios contornos centrales, divididos por las caracter√≠sticas de los subsistemas conectados a ellos. <br><a name="habracut"></a><br><h3>  ¬øCu√°l es la tarea del transporte en las realidades de las telecomunicaciones? </h3><br>  En pocas palabras: sigue la respuesta de los subsistemas a la acci√≥n de cada suscriptor, que a su vez informa a los otros subsistemas sobre eventos y cambios posteriores.  Los mensajes son generados por cualquier acci√≥n con el SISTEMA, no solo de los suscriptores, sino tambi√©n del lado de los empleados de la Compa√±√≠a y de los Subsistemas (una gran cantidad de tareas se realizan autom√°ticamente). <br><br>  Caracter√≠sticas del transporte en telecomunicaciones: flujo grande, no incorrecto, GRANDE de datos diversos transmitidos a trav√©s del transporte as√≠ncrono. <br><br>  Algunos subsistemas viven en cl√∫steres separados debido a la gran cantidad de flujos de mensajes: simplemente no quedan recursos en el cl√∫ster, por ejemplo, con un flujo de mensajes de 5-6 mil mensajes / segundo, la cantidad de datos transferidos puede alcanzar 170-190 megabytes / segundo.  Con tal perfil de carga, un intento de aterrizar a cualquier otra persona en este cl√∫ster tendr√° consecuencias tristes: dado que no hay suficientes recursos para procesar todos los datos al mismo tiempo, el conejo comenzar√° a impulsar las conexiones entrantes en <b>flujo</b> ; comenzar√° un proceso de publicaci√≥n simple, con todas las consecuencias para todos los subsistemas y sistemas en todo <br><br>  Requisitos b√°sicos para el transporte: <br><br><ol><li>  La accesibilidad de los veh√≠culos debe ser del 99,99%.  En la pr√°ctica, esto se traduce en un requisito operativo 24/7 y la capacidad de responder autom√°ticamente a cualquier situaci√≥n de emergencia. </li><li>  Seguridad de los datos: el porcentaje de mensajes perdidos en el transporte debe tender a 0. </li></ol><br>  Por ejemplo, al hacer una llamada, varios mensajes diferentes vuelan a trav√©s del transporte as√≠ncrono.  algunos mensajes est√°n destinados a subsistemas que viven en el mismo circuito, y otros est√°n destinados a la transmisi√≥n a nodos centrales.  Varios subsistemas pueden reclamar el mismo mensaje, por lo tanto, en la etapa de publicaci√≥n del mensaje en el conejo, se copia y se env√≠a a diferentes consumidores.  Y en algunos casos, la copia de mensajes se implementa obligatoriamente en un circuito intermedio, cuando la informaci√≥n debe entregarse desde el circuito de Khabarovsk al circuito de Krasnodar.  La transmisi√≥n se realiza a trav√©s de uno de los Contornos centrales, donde se realizan copias de los mensajes, para los destinatarios centrales. <br><br>  Adem√°s de los eventos causados ‚Äã‚Äãpor las acciones del suscriptor, los mensajes de servicio que intercambian los subsistemas pasan por el transporte.  Por lo tanto, se obtienen varios miles de rutas de mensajer√≠a diferentes, algunas se cruzan, algunas existen de forma aislada.  Es suficiente nombrar el n√∫mero de colas involucradas en las rutas en diferentes contornos para comprender la escala aproximada del mapa de transporte: en los circuitos centrales 600, 200, 260, 15 ... y en los circuitos remotos 80-100 ... <br><br>  Con tal implicaci√≥n del transporte, los requisitos para el 100% de accesibilidad de todos los nodos de transporte ya no parecen excesivos.  Estamos avanzando hacia la implementaci√≥n de estos requisitos. <br><br><h3>  C√≥mo resolvemos tareas </h3><br>  Adem√°s del <i>propio RabbitMQ</i> , <i>Haproxy se</i> usa para equilibrar la carga y proporcionar una respuesta autom√°tica a emergencias. <br><br>  Algunas palabras sobre el entorno de hardware y software en el que existen nuestros conejos: <br><br><ul><li>  Todos los servidores de conejo son virtuales, con par√°metros de 8-12 CPU, 16 Gb Mem, 200 Gb HDD.  Como ha demostrado la experiencia, incluso el uso de servidores no virtuales espeluznantes con 90 n√∫cleos y un mont√≥n de RAM proporciona un peque√±o aumento de rendimiento a costos significativamente m√°s altos.  Versiones utilizadas: 3.6.6 (en la pr√°ctica, la m√°s estable de 3.6) con un erlang de 18.3, 3.7.6 con un erlang de 20.1. </li><li>  Para Haproxy, los requisitos son mucho menores: 2 CPU, 4 Gb Mem, la versi√≥n haproxy es 1.8 estable.  La carga de recursos en todos los servidores haproxy no supera el 15% de CPU / Mem. </li><li>  Todo el zool√≥gico est√° ubicado en 14 centros de datos en 7 sitios en todo el pa√≠s, unidos en una sola red.  En cada uno de los centros de datos hay un grupo de tres nodos y un concentrador. </li><li>  Para los circuitos remotos, se utilizan 2 centros de datos, para cada uno de los circuitos centrales: 4. </li><li>  Los circuitos centrales interact√∫an entre s√≠, as√≠ como con los circuitos remotos; a su vez, los circuitos remotos funcionan solo con los circuitos centrales; no tienen comunicaci√≥n directa entre ellos. </li><li>  Las configuraciones de Haps y Clusters dentro del mismo circuito son completamente id√©nticas.  El punto de entrada para cada circuito es un alias para m√∫ltiples registros A-DNS.  Por lo tanto, para evitar que esto suceda, al menos un hap y al menos uno de los Clusters (al menos un nodo en el Cluster) estar√°n disponibles en cada Circuito.  Dado que el caso de falla de incluso 6 servidores en dos centros de datos al mismo tiempo es extremadamente improbable, se supone que la aceptabilidad es cercana al 100%. </li></ul><br>  Parece concebido (e implementado) todo esto as√≠: <br><br><img src="https://habrastorage.org/webt/f2/rm/9i/f2rm9i0kd5jk1ikaapl2vc63yhc.jpeg" alt="imagen"><br><br><img src="https://habrastorage.org/webt/az/5t/ks/az5tkse8qkz0fl3ml6znbg4pz18.jpeg" alt="imagen"><br><br>  Ahora algunas configuraciones. <br><br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n de Haproxy</b> <div class="spoiler_text"><table><tbody><tr><td>  frontend center-rmq_5672 </td><td></td></tr><tr><td></td><td>  atar </td><td>  *: 5672 </td></tr><tr><td></td><td>  modo </td><td>  tcp </td></tr><tr><td></td><td>  maxconn </td><td>  10,000 </td></tr><tr><td></td><td>  cliente de tiempo de espera </td><td>  3h </td></tr><tr><td></td><td>  opci√≥n </td><td>  tcpka </td></tr><tr><td></td><td>  opci√≥n </td><td>  tcplog </td></tr><tr><td></td><td>  default_backend </td><td>  center-rmq_5672 </td></tr><tr><td>  frontend center-rmq_5672_lvl_1 </td><td></td></tr><tr><td></td><td>  atar </td><td>  localhost: 56721 </td></tr><tr><td></td><td>  modo </td><td>  tcp </td></tr><tr><td></td><td>  maxconn </td><td>  10,000 </td></tr><tr><td></td><td>  cliente de tiempo de espera </td><td>  3h </td></tr><tr><td></td><td>  opci√≥n </td><td>  tcpka </td></tr><tr><td></td><td>  opci√≥n </td><td>  tcplog </td></tr><tr><td></td><td>  default_backend </td><td>  center-rmq_5672_lvl_1 </td></tr><tr><td>  backend center-rmq_5672 </td></tr><tr><td></td><td>  balance </td><td>  la menos com√∫n </td></tr><tr><td></td><td>  modo </td><td>  tcp </td></tr><tr><td></td><td>  fullconn </td><td>  10,000 </td></tr><tr><td></td><td>  tiempo de espera </td><td>  servidor 3h </td></tr><tr><td></td><td>  servidor </td><td>  srv-rmq01 10/10/10/10/106767 verificar entre 5s subir 2 caer 3 sesiones de copia de seguridad de cierre marcadas </td></tr><tr><td></td><td>  servidor </td><td>  srv-rmq03 10/10/10/2011 11672 compruebe entre 5 aumentos 2 ca√≠das 3 en sesiones de copia de seguridad de cierre marcadas </td></tr><tr><td></td><td>  servidor </td><td>  srv-rmq05 10/10/10/126767 verificar entre 5s subida 2 ca√≠da 3 en-marcado-apagado-apagado-copia de seguridad-sesiones </td></tr><tr><td></td><td>  servidor </td><td>  localhost 127.0.0.1 ‚àó 6721 compruebe entre 5s subida 2 ca√≠da 3 copia de seguridad sesiones de apagado marcadas </td></tr><tr><td>  backend center-rmq_5672_lvl_1 </td></tr><tr><td></td><td>  balance </td><td>  la menos com√∫n </td></tr><tr><td></td><td>  modo </td><td>  tcp </td></tr><tr><td></td><td>  fullconn </td><td>  10,000 </td></tr><tr><td></td><td>  tiempo de espera </td><td>  servidor 3h </td></tr><tr><td></td><td>  servidor </td><td>  srv-rmq02 10/10/10/136767 verificar entre 5s subir 2 caer 3 en-marcado-apagado shutdown-backup-sessions </td></tr><tr><td></td><td>  servidor </td><td>  srv-rmq04 10/10/10/14/1067 verificar entre 5s subir 2 caer 3 en sesiones de copia de seguridad de cierre marcadas </td></tr><tr><td></td><td>  servidor </td><td>  srv-rmq06 10.10.10.5:0767 verificar entre 5s subida 2 ca√≠da 3 en-marcado-apagado shutdown-backup-sessions </td></tr></tbody></table><br></div></div><br>  La primera secci√≥n del frente describe el punto de entrada, que conduce al grupo principal, la segunda secci√≥n est√° dise√±ada para equilibrar el nivel de reserva.  Si simplemente describe todos los servidores secundarios de respaldo en la secci√≥n de back-end (instrucciones de respaldo), funcionar√° de la misma manera: si el cl√∫ster principal es completamente inaccesible, las conexiones ir√°n al respaldo, sin embargo, todas las conexiones ir√°n al PRIMER servidor de respaldo en la lista.  Para garantizar el equilibrio de carga en todos los nodos de respaldo, solo presentamos un frente m√°s, que ponemos a disposici√≥n solo con localhost, y le asignamos el servidor de respaldo. <br><br>  El ejemplo anterior describe el equilibrio del Loop remoto, que opera dentro de dos centros de datos: el servidor srv-rmq {01,03,05} - vivo en el centro de datos n. ¬∞ 1, srv-rmq {02,04,06} - en el centro de datos n. ¬∞ 2.  Por lo tanto, para implementar la soluci√≥n de cuatro codas, solo necesitamos agregar dos frentes locales m√°s y dos secciones de back-end de los servidores de conejo correspondientes. <br><br>  El comportamiento del equilibrador con esta configuraci√≥n es el siguiente: mientras al menos un servidor principal est√° vivo, lo usamos.  Si los servidores principales no est√°n disponibles, trabajamos con una reserva.  Si al menos un servidor primario est√° disponible, todas las conexiones a los servidores de respaldo se desconectan y, cuando se restablece la conexi√≥n, ya caen en el Cl√∫ster primario. <br><br>  La experiencia operativa de dicha configuraci√≥n muestra casi el 100% de disponibilidad de cada uno de los circuitos.  Esta soluci√≥n requiere que los Subsistemas sean completamente legales y simples: poder reconectarse con el conejo despu√©s de desconectarse. <br><br>  Por lo tanto, hemos proporcionado equilibrio de carga a un n√∫mero arbitrario de Clusters y cambiamos autom√°ticamente entre ellos, es hora de ir directamente a los conejos. <br><br>  Cada cl√∫ster se crea a partir de tres nodos, como muestra la pr√°ctica: el n√∫mero m√°s √≥ptimo de nodos, lo que garantiza el equilibrio √≥ptimo de disponibilidad / tolerancia a fallas / velocidad.  Dado que el conejo no se escala horizontalmente (el rendimiento del cl√∫ster es igual al rendimiento del servidor m√°s lento), creamos todos los nodos con los mismos par√°metros √≥ptimos para CPU / Mem / Hdd.  Colocamos los servidores lo m√°s cerca posible entre s√≠; en nuestro caso, estamos archivando m√°quinas virtuales dentro de la misma granja. <br><br>  En cuanto a las condiciones previas, a continuaci√≥n, los Subsistemas garantizar√°n el funcionamiento m√°s estable y el cumplimiento del requisito de guardar los mensajes recibidos: <br><br><ol><li>  El trabajo con el conejo es solo a trav√©s del protocolo amqp / amqps, a trav√©s del equilibrio.  Autorizaci√≥n bajo cuentas locales - dentro de cada grupo (pozo y todo el circuito) </li><li>  Los subsistemas est√°n conectados al conejo en modo pasivo: no se permiten y limitan las manipulaciones con las entidades de los conejos (creaci√≥n de colas / eschendzhey / bind) a nivel de derechos de cuenta, simplemente no otorgamos derechos de configuraci√≥n. </li><li>  Todas las entidades necesarias se crean de forma centralizada, no por medio de subsistemas, y en todos los cl√∫steres de cl√∫ster se realizan de la misma manera: para garantizar el cambio autom√°tico al cl√∫ster de respaldo y viceversa.  De lo contrario, podemos obtener una imagen: cambiamos a la reserva, pero la cola o el enlace no est√°n all√≠, y podemos elegir un error de conexi√≥n o p√©rdida de mensajes. </li></ol><br><h3>  Ahora directamente la configuraci√≥n en conejos: </h3><br><ol><li>  Los hosts locales no tienen acceso a la interfaz web </li><li>  El acceso a la Web se organiza a trav√©s de LDAP: nos integramos con AD y obtenemos el registro de qui√©n y d√≥nde visit√≥ la c√°mara web.  En el nivel de configuraci√≥n, restringimos los derechos de las cuentas de AD, no solo exigimos estar en un determinado grupo, sino que solo otorgamos derechos para "ver".  Los grupos de monitoreo son m√°s que suficientes.  Y colgamos los derechos de administrador en otro grupo en AD, por lo tanto, el c√≠rculo de influencia en el transporte es muy limitado. </li><li>  Para facilitar la administraci√≥n y el seguimiento: <br>  En todos los VHOST, colgamos inmediatamente una pol√≠tica de nivel 0 con aplicaci√≥n a todas las colas (patr√≥n :. *): <br><br><ul><li>  <b><i>ha-mode: all</i></b> : almacena todos los datos en todos los nodos del cl√∫ster, la velocidad de procesamiento de los mensajes disminuye, pero su seguridad y disponibilidad est√°n garantizadas. </li><li>  <b><i>ha-sync-mode: automatic</i></b> : indica al rastreador que sincronice autom√°ticamente los datos en todos los nodos del cl√∫ster: la seguridad y la disponibilidad de los datos tambi√©n aumentan. </li><li>  <b><i>modo de cola: perezoso</i></b> : quiz√°s una de las opciones m√°s √∫tiles que ha aparecido en conejos desde la versi√≥n 3.6: grabaci√≥n inmediata de mensajes en el HDD.  Esta opci√≥n reduce dr√°sticamente el consumo de RAM y aumenta la seguridad de los datos durante las paradas / ca√≠das de los nodos o del cl√∫ster en su conjunto. </li></ul><br></li><li>  Configuraciones en el archivo de configuraci√≥n ( <i>rabbitmq-main / conf / rabbitmq.config</i> ): <br><br><ul><li>  Secci√≥n <b>conejo</b> : <i>{vm_memory_high_watermark_paging_ratio, 0.5}</i> - umbral para descargar mensajes al disco 50%.  Con <b>perezoso activado,</b> sirve m√°s como seguro cuando elaboramos una p√≥liza, por ejemplo, nivel 1, en el que nos olvidamos de incluir <b>perezoso</b> . </li><li>  <i>{vm_memory_high_watermark, 0.95}</i> : limitamos el conejo al 95% de toda la RAM, ya que solo el conejo vive en los servidores, no tiene sentido introducir restricciones m√°s estrictas.  5% "gesto amplio", que as√≠ sea: abandone el sistema operativo, el monitoreo y otras peque√±as cosas √∫tiles.  Como este valor es el l√≠mite superior, hay suficiente para todos. </li><li>  <i>{cluster_partition_handling, pause_minority}</i> : describe el comportamiento del cl√∫ster cuando se produce la partici√≥n de red; para tres o m√°s cl√∫steres de nodos, se recomienda esta marca: permite que el cl√∫ster se recupere. </li><li>  <i>{disk_free_limit, "500MB"}</i> - todo es simple, cuando hay 500 MB de espacio libre en disco - la publicaci√≥n de mensajes se detendr√°, solo estar√° disponible la resta. </li><li>  <i>{auth_backends, [rabbit_auth_backend_internal, rabbit_auth_backend_ldap]}</i> - orden de autorizaci√≥n para conejos: Primero, se verifica la presencia de un ultrasonido en la base de datos local, y si no, vaya al servidor LDAP. </li><li>  Secci√≥n <b>rabbitmq_auth_backend_ldap</b> - configuraci√≥n de interacci√≥n con AD: <i>{servidores, ["srv_dc1", "srv_dc2"]}</i> - una lista de controladores de dominio en los que se realizar√° la autenticaci√≥n. </li><li>  Los par√°metros que describen directamente al usuario en AD, el puerto LDAP, etc. son puramente individuales y se describen en detalle en la documentaci√≥n. </li><li>  Lo m√°s importante para nosotros es una descripci√≥n de los derechos y restricciones sobre la administraci√≥n y el acceso a la interfaz web de conejos: tag_queries: <br>  <i>[{administrador, {en_grupo, "cn = rabbitmq-admins, ou = GRP, ou = GRP_MAIN, dc = Mi_dominio, dc = ru"}},</i> <i><br></i>  <i>{monitoreo,</i> <i><br></i>  <i>{in_group, "cn = rabbitmq-web, ou = GRP, ou = GRP_MAIN, dc = Mi_dominio, dc = ru"}</i> <i><br></i>  <i>}]</i> - este dise√±o proporciona privilegios administrativos para todos los usuarios del grupo rabbitmq-admins y derechos de monitoreo (m√≠nimamente suficiente para ver el acceso) para el grupo rabbitmq-web. <br></li><li>  <b>resource_access_query</b> : <br>  <i>{para,</i> <i><br></i>  <i>[{permiso, configurar, {en_grupo, "cn = rabbitmq-admins, ou = GRP, ou = GRP_MAIN, dc = Mi_dominio, dc = ru"}},</i> <i><br></i>  <i>{permiso, escribir, {en_grupo, "cn = rabbitmq-admins, ou = GRP, ou = GRP_MAIN, dc = Mi_dominio, dc = ru"}},</i> <i><br></i>  <i>{permiso, lectura, {constante, verdadero}}</i> <i><br></i>  <i>]</i> <i><br></i>  <i>}</i> : proporcionamos los derechos para configurar y escribir solo al grupo de administradores, a todos los dem√°s que inicien sesi√≥n correctamente, los derechos son de solo lectura: puede leer mensajes a trav√©s de la interfaz web. <br></li></ul></li></ol><br>  Obtenemos un cl√∫ster configurado (al nivel del archivo de configuraci√≥n y la configuraci√≥n en el conejo) que maximiza la disponibilidad y seguridad de los datos.  Con esto implementamos el requisito: garantizar la disponibilidad y seguridad de los datos ... en la mayor√≠a de los casos. <br><br>  Hay varios puntos que se deben considerar al operar sistemas tan cargados: <br><br><ol><li>  Es mejor organizar todas las propiedades adicionales de las colas (TTL, caducar, longitud m√°xima, etc.) por parte de los pol√≠ticos, en lugar de colgar par√°metros al crear colas.  Resulta una estructura flexiblemente personalizable que se puede personalizar sobre la marcha a las realidades cambiantes. </li><li>  Usando TTL.  Cuanto m√°s larga sea la cola, mayor ser√° la carga en la CPU.  Para evitar "romper el techo", tambi√©n es mejor limitar la longitud de la cola a trav√©s de la longitud m√°xima. </li><li>  Adem√°s del conejo en s√≠, una serie de aplicaciones de utilidad est√°n girando en el servidor, que, curiosamente, tambi√©n requieren recursos de CPU.  Un conejo glot√≥n, por defecto, ocupa todos los granos disponibles ... Una situaci√≥n desagradable puede resultar: una lucha por los recursos, que f√°cilmente puede conducir a frenos en el conejo.  Para evitar la ocurrencia de tal situaci√≥n, por ejemplo, de la siguiente manera: Cambie los par√°metros del lanzamiento del erlang: introduzca un l√≠mite obligatorio en el n√∫mero de n√∫cleos utilizados.  Hacemos esto de la siguiente manera: busque el archivo <i>rabbitmq-env</i> , busque el par√°metro SERVER_ERL_ARGS = y agregue + sct L0-Xc0-X + SY: Y.  Donde X es el n√∫mero de n√∫cleos-1 (el conteo comienza desde 0), Y - El n√∫mero de n√∫cleos -1 (el conteo es de 1).  + sct L0-Xc0-X - cambia el enlace a los n√∫cleos, + SY: Y - cambia el n√∫mero de shedulers lanzados por el erlang.  Entonces, para un sistema de 8 n√∫cleos, los par√°metros agregados tomar√°n la forma: + sct L0-6c0-6 + S 7: 7.  De esta manera, le damos al conejo solo 7 n√∫cleos y esperamos que el sistema operativo, al iniciar otros procesos, act√∫e de manera √≥ptima y los cuelgue en un n√∫cleo descargado. </li></ol><br><h3>  Los matices de operar el zool√≥gico resultante </h3><br>  De lo que ning√∫n entorno puede protegerse es de la base colapsada de mnesia; desafortunadamente, ocurre con una probabilidad distinta de cero.  Un resultado tan desastroso no es causado por fallas globales (por ejemplo, una falla completa de un centro de datos completo, la carga simplemente cambiar√° a otro cl√∫ster), sino m√°s fallas locales, dentro del mismo segmento de red. <br><br>  Adem√°s, son las fallas de la red local las que dan miedo, porque  el apagado de emergencia de uno o dos nodos no tendr√° consecuencias fatales, simplemente todas las solicitudes ir√°n a un solo nodo y, como recordamos, el rendimiento depende del rendimiento del nodo solo.  Las fallas en la red (no tenemos en cuenta las peque√±as interrupciones en la comunicaci√≥n, se experimentan sin problemas) conducen a una situaci√≥n en la que los nodos comienzan el proceso de sincronizaci√≥n entre ellos y luego la conexi√≥n se rompe una y otra vez durante unos segundos. <br><br>  Por ejemplo, el parpadeo m√∫ltiple de la red y con una frecuencia de m√°s de 5 segundos (solo se establece un tiempo de espera tal en la configuraci√≥n de Hapov, ciertamente puede reproducirlos, pero para verificar la efectividad deber√° repetir la falla, que nadie quiere). <br><br>  El cl√∫ster a√∫n puede soportar una o dos iteraciones de este tipo, pero m√°s: las posibilidades ya son m√≠nimas.  En tal situaci√≥n, una parada de un nodo ca√≠do puede guardar, pero es casi imposible hacerlo manualmente.  M√°s a menudo, el resultado no es solo la p√©rdida de un nodo del cl√∫ster con el mensaje <b>"Partici√≥n de red"</b> , sino tambi√©n la imagen cuando los datos por parte de las colas vivieron solo en este nodo y no tuvieron tiempo de sincronizarse con los restantes.  Visualmente: en la cola, los datos son <b><i>NaN</i></b> . <br><br>  Y ahora esta es una se√±al inequ√≠voca: cambie al cl√∫ster de respaldo.  El cambio proporcionar√° una suerte, solo necesita detener a los conejos en el grupo principal, una cuesti√≥n de varios minutos.  Como resultado, obtenemos la restauraci√≥n de la capacidad de trabajo del transporte y podemos proceder con seguridad al an√°lisis del accidente y su eliminaci√≥n. <br><br>  Para eliminar un racimo da√±ado debajo de la carga, para evitar una mayor degradaci√≥n, lo m√°s simple es hacer que el conejo funcione en puertos que no sean 5672. Dado que estamos monitoreando a los conejos por el puerto regular, su desplazamiento, por ejemplo, por 5673 en la configuraci√≥n del conejo, le permitir√° iniciar completamente el cl√∫ster sin problemas e intentar restaurar su operatividad y los mensajes restantes en √©l. <br><br>  Lo hacemos en unos pocos pasos: <br><br><ol><li>  Detenga todos los nodos del cl√∫ster fallido: el hap cambiar√° la carga al cl√∫ster de respaldo </li><li>  RABBITMQ_NODE_PORT=5673   <i>rabbitmq-env</i> ‚Äì       ,   Web  -    15672. </li><li>            . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al inicio, los √≠ndices se reconstruir√°n y, en la gran mayor√≠a de los casos, todos los datos se restaurar√°n por completo. Desafortunadamente, se producen bloqueos como resultado de los cuales debe eliminar f√≠sicamente todos los mensajes del disco, dejando solo la configuraci√≥n: los directorios </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msg_store_persistent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msg_store_transient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (para la versi√≥n 3.6) o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msg_stores</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (para la versi√≥n 3.7) </font><font style="vertical-align: inherit;">se eliminan en la carpeta con la base de datos </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de una terapia tan radical, el grupo se inicia con la preservaci√≥n de la estructura interna, pero sin mensajes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y la opci√≥n m√°s desagradable (observada solo una vez): el da√±o a la base fue tal que fue necesario eliminar por completo toda la base y reconstruir el grupo desde cero.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para la conveniencia de administrar y actualizar conejos, no se usa un ensamblaje listo para usar en rpm, sino un conejo desmontado usando cpio y reconfigurado (cambi√≥ las rutas en los scripts). La principal diferencia: no requiere privilegios de root para instalar / configurar, no est√° instalado en el sistema (el conejo reconstruido est√° perfectamente empaquetado en tgz) y se ejecuta desde cualquier usuario. Este enfoque le permite actualizar de manera flexible las versiones (si no requiere una parada completa del cl√∫ster; en este caso, simplemente cambie al cl√∫ster de respaldo y actualice, sin olvidar especificar el puerto desplazado para la operaci√≥n). Incluso es posible ejecutar varias instancias de RabbitMQ en la misma m√°quina; para probar la opci√≥n es muy conveniente, puede implementar una copia arquitect√≥nica reducida del zool√≥gico de batalla.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado del chamanismo con cpio y caminos en los scripts, tenemos una opci√≥n de compilaci√≥n: dos carpetas de base de conejo (en el ensamblaje original - la carpeta mnesia) y rabbimq-main - aqu√≠ pongo todos los scripts necesarios del conejo y el propio erlang. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En rabbimq-main / bin - enlaces simb√≥licos a scripts de conejo y erlang y un script de seguimiento de conejo (descripci√≥n a continuaci√≥n). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En rabbimq-main / init.d: ‚Äã‚Äãla secuencia de comandos rabbitmq-server a trav√©s de la cual los registros comienzan / detienen / giran; en lib, el conejo mismo; en lib64 - erlang (usando una versi√≥n simplificada del erlang solo para conejo)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es extremadamente f√°cil actualizar el ensamblaje resultante cuando se lanzan nuevas versiones: agregue el contenido de rabbimq-main / lib y rabbimq-main / lib64 de las nuevas versiones y reemplace los enlaces simb√≥licos en bin. Si la actualizaci√≥n tambi√©n afecta los scripts de control, simplemente cambie las rutas a la nuestra en ellos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una ventaja significativa de este enfoque es la continuidad completa de las versiones: todas las rutas, scripts, comandos de control permanecen sin cambios, lo que le permite usar cualquier script de utilidad auto-escrito sin dopaje para cada versi√≥n.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desde la ca√≠da de los conejos, aunque rara, pero ocurriendo, fue necesario implementar un mecanismo para monitorear su salud en caso de una ca√≠da (manteniendo los registros de las razones de la ca√≠da). </font><font style="vertical-align: inherit;">La falla de un nodo en el 99% de los casos va acompa√±ada de una entrada de registro, incluso matar incluso deja rastros, esto permiti√≥ implementar el monitoreo del estado del conejo usando un script simple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para las versiones 3.6 y 3.7, el script es ligeramente diferente debido a las diferencias en las entradas de registro.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para la versi√≥n 3.6</font></font></b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import subprocess import os import datetime import zipfile def LastRow(fileName,MAX_ROW=200): with open(fileName,'rb') as f: f.seek(-min(os.path.getsize(fileName),MAX_ROW),2) return (f.read().splitlines())[-1] if os.path.isfile('/data/logs/rabbitmq/startup_log'): if b'FAILED' in LastRow('/data/logs/rabbitmq/startup_log'): proc = subprocess.Popen("ps x|grep rabbitmq-server|grep -v 'grep'", shell=True, stdout=subprocess.PIPE) out = proc.stdout.readlines() if str(out) == '[]': cur_dt=datetime.datetime.now() try: os.stat('/data/logs/rabbitmq/after_crush') except: os.mkdir('/data/logs/rabbitmq/after_crush') z=zipfile.ZipFile('/data/logs/rabbitmq/after_crush/repair_log'+'-'+str(cur_dt.day).zfill(2)+str(cur_dt.month).zfill(2)+str(cur_dt.year)+'_'+str(cur_dt.hour).zfill(2)+'-'+str(cur_dt.minute).zfill(2)+'-'+str(cur_dt.second).zfill(2)+'.zip','a') z.write('/data/logs/rabbitmq/startup_err','startup_err') proc = subprocess.Popen("~/rabbitmq-main/init.d/rabbitmq-server start", shell=True, stdout=subprocess.PIPE) out = proc.stdout.readlines() z.writestr('res_restart.log',str(out)) z.close() my_file = open("/data/logs/rabbitmq/run.time", "a") my_file.write(str(cur_dt)+"\n") my_file.close()</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Para 3.7, solo se cambian dos l√≠neas</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (os.path.isfile(<span class="hljs-string"><span class="hljs-string">'/data/logs/rabbitmq/startup_log'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (os.path.isfile(<span class="hljs-string"><span class="hljs-string">'/data/logs/rabbitmq/startup_err'</span></span>)): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-string"><span class="hljs-string">b' OK '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LastRow(<span class="hljs-string"><span class="hljs-string">'/data/logs/rabbitmq/startup_log'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">b'FAILED'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LastRow(<span class="hljs-string"><span class="hljs-string">'/data/logs/rabbitmq/startup_log'</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (<span class="hljs-string"><span class="hljs-string">b'Gracefully halting Erlang VM'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> LastRow(<span class="hljs-string"><span class="hljs-string">'/data/logs/rabbitmq/startup_err'</span></span>)):</code> </pre><br></div></div><br><br>  Configuramos una cuenta de crontab en la que el conejo funcionar√° (de forma predeterminada, rabbitmq) ejecutando este script (nombre del script: check_and_run) cada minuto (primero, le pedimos al administrador que otorgue a la cuenta el derecho de usar crontab, pero si tenemos derechos de root, lo hacemos nosotros mismos): <br>  <b><i>* / 1 * * * * ~ / rabbitmq-main / bin / check_and_run</i></b> <br><br>  El segundo punto de usar el conejo reensamblado es la rotaci√≥n de los registros. <br><br>  Dado que no estamos vinculados al sistema logrotate, utilizamos la funcionalidad proporcionada por el desarrollador: el <b>script rabbitmq-server</b> de init.d (para la versi√≥n 3.6) <br>  Al hacer peque√±os cambios a <i>rotate_logs_rabbitmq ()</i> <br>  A√±adir: <br><br><pre> <code class="bash hljs"> find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/http_api/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.* -maxdepth 0 -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f ! -name <span class="hljs-string"><span class="hljs-string">"*.gz"</span></span> | xargs -i gzip --force {} find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.*.back -maxdepth 0 -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f | xargs -i gzip {} find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/*.gz -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -mtime +30 -delete find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/http_api/*.gz -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -mtime +30 -delete</code> </pre><br>  El resultado de ejecutar el script rabbitmq-server con la clave rotate-logs: los registros est√°n comprimidos por gzip y se almacenan solo durante los √∫ltimos 30 d√≠as.  <b>http_api</b> : la ruta donde el conejo coloca los registros http: configurados en el archivo de configuraci√≥n: <i>{rabbitmq_management, [{rates_mode, detallado}, {http_log_dir, path_to_logs / http_api "}]}</i> <br><br>  Al mismo tiempo, estoy prestando atenci√≥n a <i>{rates_mode, <b>detallado</b> }</i> : la opci√≥n aumenta ligeramente la carga, pero le permite ver informaci√≥n sobre el usuario que publica mensajes en el INTERCAMBIO en la interfaz WEB (y, en consecuencia, atraviesa la API).  La informaci√≥n es extremadamente necesaria, porque  todas las conexiones pasan por el equilibrador; solo veremos la IP de los equilibradores mismos.  Y si desconcierta todos los Subsistemas que trabajan con el conejo para que completen los par√°metros de propiedades del Cliente en las propiedades de sus conexiones con los conejos, entonces ser√° posible obtener informaci√≥n detallada en el nivel de conexi√≥n qui√©n exactamente, d√≥nde y con qu√© intensidad publica los mensajes. <br><br>  Con el lanzamiento de las nuevas versiones 3.7, hubo un rechazo completo del script <b>rabbimq-server</b> en init.d.  Para facilitar la operaci√≥n (la uniformidad de los comandos de control independientemente de la versi√≥n del conejo) y una transici√≥n m√°s suave entre las versiones, en el conejo reensamblado continuamos usando este script.  La verdad es otra vez: <i>cambiaremos un</i> poco <i>rotate_logs_rabbitmq ()</i> , ya que el mecanismo para nombrar registros despu√©s de la rotaci√≥n ha cambiado en 3.7: <br><br><pre> <code class="bash hljs"> mv <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/<span class="hljs-variable"><span class="hljs-variable">$NODENAME</span></span>.log.0 <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/<span class="hljs-variable"><span class="hljs-variable">$NODENAME</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.$(date +%Y%m%d-%H%M%S).back mv <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$NODENAME</span></span>)_upgrade.log.0 <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$NODENAME</span></span>)_upgrade.log.$(date +%Y%m%d-%H%M%S).back find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/http_api/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.* -maxdepth 0 -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f ! -name <span class="hljs-string"><span class="hljs-string">"*.gz"</span></span> | xargs -i gzip --force {} find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.* -maxdepth 0 -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f ! -name <span class="hljs-string"><span class="hljs-string">"*.gz"</span></span> | xargs -i gzip --force {} find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/*.gz -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -mtime +30 -delete find <span class="hljs-variable"><span class="hljs-variable">${RABBITMQ_LOG_BASE}</span></span>/http_api/*.gz -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -mtime +30 -delete</code> </pre><br>  Ahora solo queda agregar la tarea de rotaci√≥n de registros a crontab, por ejemplo, todos los d√≠as a las 23-00: <br>  <b><i>00 23 * * * ~ / rabbitmq-main / init.d / rabbitmq-server rotate-logs</i></b> <br><br>  Pasemos a las tareas que deben resolverse en el marco de la operaci√≥n de la "granja de conejos": <br><br><ol><li>  Manipulaciones con entidades de conejo: creaci√≥n / eliminaci√≥n de entidades de conejo: ekschendzhey, colas, enlaces, palas, usuarios, pol√≠ticas.  Y hacer esto es absolutamente id√©ntico en todos los Cluster Clusters. </li><li>  Despu√©s de cambiar a / desde el Cl√∫ster de respaldo, es necesario transferir los mensajes que permanecieron en √©l al Cl√∫ster actual. </li><li>  Crear copias de seguridad de las configuraciones de todos los Clusters de todos los Circuitos </li><li>  Sincronizaci√≥n completa de configuraciones de cl√∫ster dentro del contorno </li><li>  Detener / iniciar conejos </li><li>  Para analizar los flujos de datos actuales: todos los mensajes van y, si van, a d√≥nde deber√≠an ir o ... </li><li>  Encuentre y atrape los mensajes que pasan por cualquier criterio </li></ol><br>  La operaci√≥n de nuestro zool√≥gico y la soluci√≥n de tareas sonoras a trav√©s del plug-in regular <i>rabbitmq_management</i> suministrado es posible, pero extremadamente inconveniente, por lo que se desarroll√≥ e implement√≥ un caparaz√≥n para <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">controlar toda la variedad de conejos</a></b> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es434016/">https://habr.com/ru/post/es434016/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es434004/index.html">Plataforma de Wargaming: Hello World</a></li>
<li><a href="../es434006/index.html">¬øNecesitamos cookies en la era del RGPD? Discutimos la situaci√≥n y los requisitos de la ley.</a></li>
<li><a href="../es434008/index.html">C√≥mo dejar de preocuparse y comenzar a escribir pruebas basadas en propiedades</a></li>
<li><a href="../es434010/index.html">Para usted devops o configure proxies Nginx para Apache Tomcat en Ubuntu en 5 minutos con https y firewall</a></li>
<li><a href="../es434012/index.html">PVS-Studio gratuito para quienes desarrollan proyectos de c√≥digo abierto</a></li>
<li><a href="../es434018/index.html">Obtenga un certificado de desarrollador de Android asociado de Google</a></li>
<li><a href="../es434034/index.html">Buenos tutoriales en YouTube</a></li>
<li><a href="../es434036/index.html">Feliz y final: los buzones en los dominios del portal Qip.ru se han trasladado a Yandex</a></li>
<li><a href="../es434038/index.html">Ventas de veh√≠culos el√©ctricos enchufables en China para noviembre de 2018</a></li>
<li><a href="../es434040/index.html">Resumen de la Universidad ITMO: habla sobre proyectos universitarios, √©xitos y logros de nuestros graduados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>