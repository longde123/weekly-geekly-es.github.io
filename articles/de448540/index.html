<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£ ‚ö±Ô∏è ‚õé VMware NSX f√ºr die Kleinsten. Teil 5. Konfigurieren des Load Balancers ‚òòÔ∏è üëèüèΩ üí™üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Teil Eins Einf√ºhrung 
 Teil Zwei Konfigurieren Sie Firewall- und NAT-Regeln 
 Teil drei. DHCP-Setup 
 Teil vier Routing-Setup 

 Das letzte Mal haben ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VMware NSX f√ºr die Kleinsten. Teil 5. Konfigurieren des Load Balancers</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/448540/"><img src="https://habrastorage.org/webt/cs/bv/4v/csbv4vf7zldwjd6etj65xyw309o.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil Eins</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einf√ºhrung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil Zwei</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfigurieren Sie Firewall- und NAT-Regeln</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil drei.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DHCP-Setup</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil vier</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Routing-Setup</a> <br><br>  Das letzte Mal haben wir √ºber die Funktionen von NSX Edge in Bezug auf statisches und dynamisches Routing gesprochen, und heute werden wir uns mit dem Balancer befassen. <br><br>  Bevor ich mit dem Setup fortfahre, m√∂chte ich kurz auf die wichtigsten Arten des Auswuchtens eingehen. <br><a name="habracut"></a><br><h3>  Theorie </h3><br>  Alle heutigen L√∂sungen f√ºr den Nutzlastausgleich werden meist in zwei Kategorien unterteilt: Ausgleich auf der vierten (Transport) und der siebten (angewandten) Ebene des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OSI-Modells</a> .  Das OSI-Modell ist nicht der beste Bezugspunkt f√ºr die Beschreibung von Ausgleichsmethoden.  Wenn der L4-Balancer beispielsweise auch die TLS-Terminierung unterst√ºtzt, wird er dann zu einem L7-Balancer?  Aber das hei√üt, das ist. <br><br><ul><li>  <b>Der L4-Balancer ist</b> meistens derjenige, der zwischen dem Client und dem Satz verf√ºgbarer mittlerer Proxy-Backends steht, der TCP-Verbindungen beendet (dh unabh√§ngig auf SYN reagiert), ein Backend ausw√§hlt und eine neue TCP-Sitzung in seine Richtung initiiert und SYN selbst sendet.  Dieser Typ ist eine der grundlegenden, andere Optionen sind m√∂glich. </li><li>  <b>Der L7-Balancer</b> verteilt den Datenverkehr an die verf√ºgbaren Backends ‚Äûausgefeilter‚Äú als der L4-Balancer.  Er kann sich f√ºr ein Backend entscheiden, das beispielsweise auf dem Inhalt einer HTTP-Nachricht (URL, Cookie usw.) basiert. </li></ul><br>  Unabh√§ngig vom Typ kann der Balancer die folgenden Funktionen unterst√ºtzen: <br><br><ul><li>  Bei der Serviceerkennung werden die verf√ºgbaren Backends (statisch, DNS, Consul, usw.) ermittelt. </li><li>  √úberpr√ºfen des Zustands erkannter Backends (aktives "Ping" des Backends mithilfe einer HTTP-Anforderung, passive Erkennung von Problemen in TCP-Verbindungen, Vorhandensein mehrerer 503 HTTP-Codes in den Antworten in einer Reihe usw.). </li><li>  Balancing selbst (Round Robin, zuf√§llige Auswahl, Quell-IP-Hash, URI). </li><li>  TLS-Beendigung und Zertifikats√ºberpr√ºfung. </li><li>  Sicherheitsbezogene Optionen (Authentifizierung, Verhinderung von DoS-Angriffen, Geschwindigkeitsbegrenzung) und vieles mehr. </li></ul><br>  NSX Edge bietet Unterst√ºtzung f√ºr zwei Balancer-Bereitstellungsmodi: <br><br>  <b>Proxy-Modus oder einarmig</b> .  In diesem Modus verwendet NSX Edge beim Senden einer Anforderung an eines der Backends seine IP-Adresse als Quelladresse.  Somit f√ºhrt der Balancer sowohl die Quell- als auch die Ziel-NAT-Funktionen aus.  Das Backend sieht den gesamten vom Balancer gesendeten Datenverkehr und antwortet direkt darauf.  In diesem Schema muss sich der Balancer im selben Netzwerksegment wie die internen Server befinden. <br><br>  So geht's: <br><br><ol><li>  Der Benutzer sendet eine Anfrage an die VIP-Adresse (Balancer-Adresse), die auf Edge konfiguriert ist. </li><li>  Edge w√§hlt eines der Backends aus und f√ºhrt das Ziel-NAT durch, wobei die VIP-Adresse durch die Adresse des ausgew√§hlten Backends ersetzt wird. </li><li>  Edge f√ºhrt Quell-NAT aus und ersetzt die Adresse des Benutzers, der die Anforderung gesendet hat, durch eine eigene. </li><li>  Das Paket wird an das ausgew√§hlte Backend gesendet. </li><li>  Das Backend reagiert nicht direkt auf den Benutzer, sondern auf Edge, da die urspr√ºngliche Adresse des Benutzers in die Adresse des Balancers ge√§ndert wurde. </li><li>  Edge sendet die Serverantwort an den Benutzer. </li></ol><br>  Schema unten. <br><br><img src="https://habrastorage.org/webt/ta/jx/m5/tajxm5nceoc5z9oeea0_apjftvs.png"><br><br>  <b>Transparenter oder Inline-Modus.</b>  In diesem Szenario verf√ºgt der Balancer √ºber Schnittstellen im internen und externen Netzwerk.  Es gibt jedoch keinen direkten Zugriff von au√üen auf das interne Netzwerk.  Der integrierte Load Balancer fungiert als NAT-Gateway f√ºr virtuelle Maschinen im internen Netzwerk. <br><br>  Der Mechanismus ist wie folgt: <br><br><ol><li>  Der Benutzer sendet eine Anfrage an die VIP-Adresse (Balancer-Adresse), die auf Edge konfiguriert ist. </li><li>  Edge w√§hlt eines der Backends aus und f√ºhrt das Ziel-NAT durch, wobei die VIP-Adresse durch die Adresse des ausgew√§hlten Backends ersetzt wird. </li><li>  Das Paket wird an das ausgew√§hlte Backend gesendet. </li><li>  Das Backend empf√§ngt eine Anfrage mit der urspr√ºnglichen Adresse des Benutzers (Quell-NAT wurde nicht ausgef√ºhrt) und antwortet direkt darauf. </li><li>  Der Datenverkehr wird vom Load Balancer erneut akzeptiert, da er im Inline-Schema normalerweise als Standard-Gateway f√ºr die Serverfarm fungiert. </li><li>  Edge f√ºhrt Quell-NAT aus, um Datenverkehr an den Benutzer zu senden, wobei dessen VIP als Quell-IP-Adresse verwendet wird. </li></ol><br>  Schema unten. <br><br><img src="https://habrastorage.org/webt/w0/su/z0/w0suz0nii_gq5r4qcmibzge0zja.png"><br><br><h3>  √úbe </h3><br>  Auf meinem Testbed sind 3 Server mit Apache konfiguriert, die f√ºr die Arbeit mit HTTPS konfiguriert sind.  Edge gleicht HTTPS-Anforderungen mithilfe der Round-Robin-Methode aus und √ºbertr√§gt jede neue Anforderung an einen neuen Server. <br><br>  Fangen wir an. <br><br><h4>  Generieren eines SSL-Zertifikats, das NSX Edge verwendet </h4><br>  Sie k√∂nnen ein g√ºltiges CA-Zertifikat importieren oder ein selbstsigniertes Zertifikat verwenden.  In diesem Test werde ich selbstsigniert verwenden. <br><br><ol><li>  Wechseln Sie in der vCloud Director-Benutzeroberfl√§che zu den Einstellungen f√ºr die Edge-Dienste. <br><br><img src="https://habrastorage.org/webt/i-/dq/th/i-dqthihewvxbuenqctf75z02nw.png"></li><li>  Wechseln Sie zur Registerkarte Zertifikate.  W√§hlen Sie aus der Liste der Aktionen das Hinzuf√ºgen eines neuen CSR aus. <br><br><img src="https://habrastorage.org/webt/zw/jz/zy/zwjzzymdjpgwylcdi93pus7wmrk.png"></li><li>  F√ºllen Sie die erforderlichen Felder aus und klicken Sie auf Behalten. <br><br><img src="https://habrastorage.org/webt/c6/bj/zo/c6bjzodgmz0yepyhwdy00_dhoqg.png"></li><li>  W√§hlen Sie die neu erstellte CSR aus und w√§hlen Sie die Option CSR zur Selbstsignierung aus. <br><br><img src="https://habrastorage.org/webt/z2/2k/sg/z22ksgjo22tjo1dpgfr-gvutbhu.png"></li><li>  W√§hlen Sie die G√ºltigkeitsdauer des Zertifikats aus und klicken Sie auf Behalten <br><br><img src="https://habrastorage.org/webt/nl/wh/1w/nlwh1wu3amwefnuies4jxj0tiry.png"></li><li>  Ein selbstsigniertes Zertifikat wurde in der Liste der verf√ºgbaren Zertifikate angezeigt. <br><br><img src="https://habrastorage.org/webt/r9/u5/1q/r9u51qb5gt-rsf0ysyzx4byeezg.png"></li></ol><br><h4>  Anwendungsprofil konfigurieren </h4><br>  Anwendungsprofile geben Ihnen mehr Kontrolle √ºber den Netzwerkverkehr und machen die Verwaltung einfach und effizient.  Mit ihrer Hilfe k√∂nnen Sie das Verhalten f√ºr bestimmte Arten von Verkehr bestimmen. <br><br><ol><li>  Gehen Sie zur Registerkarte Load Balancer und aktivieren Sie den Balancer.  Mit der Option Beschleunigung aktiviert kann der Balancer einen schnelleren L4-Ausgleich anstelle von L7 verwenden. <br><br><img src="https://habrastorage.org/webt/tr/gy/vb/trgyvbidsrd3xyyh-g6gis9igms.png"></li><li>  Wechseln Sie zur Registerkarte Anwendungsprofil, um das Anwendungsprofil festzulegen.  Klicken Sie auf +. <br><br><img src="https://habrastorage.org/webt/nm/ng/aq/nmngaqjer2nwulb1mtrqttk0s0u.png"></li><li>  Legen Sie den Profilnamen fest und w√§hlen Sie den Verkehrstyp aus, f√ºr den das Profil angewendet werden soll.  Ich werde einige Parameter erkl√§ren. <br><br>  <b>Persistenz</b> - speichert und verfolgt Sitzungsdaten, zum Beispiel: Welcher bestimmte Server aus dem Pool bedient eine Benutzeranforderung.  Dadurch wird sichergestellt, dass Benutzeranforderungen w√§hrend der gesamten Dauer der Sitzung oder nachfolgender Sitzungen an dasselbe Poolmitglied gesendet werden. <br><br>  <b>SSL-Passthrough aktivieren</b> - Wenn diese Option ausgew√§hlt ist, beendet NSX Edge das Beenden von SSL.  Stattdessen erfolgt die Beendigung direkt auf den Servern, f√ºr die der Ausgleich durchgef√ºhrt wird. <br><br>  <b>X-Forwarded-For-HTTP-Header einf√ºgen</b> - Erm√∂glicht die Ermittlung der Quell-IP-Adresse des Clients, der √ºber den Balancer eine Verbindung zum Webserver herstellt. <br><br>  <b>Pool Side SSL aktivieren</b> - Mit dieser <b>Option</b> k√∂nnen Sie festlegen, dass der ausgew√§hlte Pool aus HTTPS-Servern besteht. <br><br><img src="https://habrastorage.org/webt/ah/bm/i9/ahbmi974xepvaiwrqwtxy4uio6u.png"></li><li>  Da ich den HTTPS-Verkehr ausgleichen werde, muss ich Pool Side SSL aktivieren und das zuvor generierte Zertifikat auf der Registerkarte Virtual Server Certificates -&gt; Service Certificate ausw√§hlen. <br><br><img src="https://habrastorage.org/webt/w2/ij/jn/w2ijjndohiaackavyj05iwjudpg.png"></li><li>  √Ñhnliches gilt f√ºr Pool-Zertifikate -&gt; Service-Zertifikat. <br><br><img src="https://habrastorage.org/webt/hn/5j/sy/hn5jsy5-tnudpfdcpome_wqwu0i.png"></li></ol><br><h4>  Wir erstellen einen Pool von Servern, deren Datenverkehr ausgeglichen wird </h4><br><ol><li>  Gehen Sie zur Registerkarte Pools.  Klicken Sie auf +. <br><br><img src="https://habrastorage.org/webt/1x/2c/e-/1x2ce--4asvoflplvlaiklfukhc.png"></li><li>  Legen Sie den Poolnamen fest, w√§hlen Sie den Algorithmus (ich verwende Round Robin) und den √úberwachungstyp f√ºr die Integrit√§tspr√ºfung des Backends aus. Die Option Transparent gibt an, ob die anf√§nglichen Quell-IP-Clients f√ºr die internen Server sichtbar sind. <br><br><ul><li>  Wenn diese Option deaktiviert ist, stammt der Datenverkehr f√ºr interne Server von der Quell-IP des Balancers. <br></li><li>  Wenn diese Option aktiviert ist, sehen interne Server die Quell-IP-Clients.  In dieser Konfiguration muss der NSX Edge als Standardgateway fungieren, um sicherzustellen, dass die zur√ºckgegebenen Pakete den NSX Edge passieren. </li></ul><br>  NSX unterst√ºtzt die folgenden Ausgleichsalgorithmen: <br><br><ul><li>  <b>IP_HASH</b> - Serverauswahl basierend auf den Ergebnissen der Hash-Funktion f√ºr die Quell- und Ziel-IP jedes Pakets. </li><li>  <b>LEASTCONN</b> - Ausgleich eingehender Verbindungen, abh√§ngig von der Anzahl der bereits auf einem bestimmten Server verf√ºgbaren Verbindungen.  Neue Verbindungen werden an den Server mit der geringsten Anzahl von Verbindungen weitergeleitet. </li><li>  <b>ROUND_ROBIN</b> - Neue Verbindungen werden nacheinander entsprechend dem angegebenen Gewicht an jeden Server gesendet. </li><li>  <b>URI</b> - Der linke Teil der URI (vor dem Fragezeichen) wird gehasht und durch das Gesamtgewicht der Server im Pool geteilt.  Das Ergebnis gibt an, welcher Server die Anforderung empf√§ngt, und stellt sicher, dass die Anforderung immer an denselben Server weitergeleitet wird, solange alle Server verf√ºgbar bleiben. </li><li>  <b>HTTPHEADER</b> - Ausgleich basierend auf einem bestimmten HTTP-Header, der als Parameter angegeben werden kann.  Wenn der Header fehlt oder keine Bedeutung hat, wird der ROUND_ROBIN-Algorithmus verwendet. </li><li>  <b>URL</b> - Jede HTTP-GET-Anforderung sucht nach dem als Argument angegebenen URL-Parameter.  Wenn auf den Parameter ein Gleichheitszeichen und ein Wert folgen, wird der Wert gehasht und durch das Gesamtgewicht der laufenden Server geteilt.  Das Ergebnis gibt an, welcher Server die Anforderung empf√§ngt.  Dieser Prozess wird verwendet, um Benutzerkennungen in Anforderungen zu verfolgen und sicherzustellen, dass immer dieselbe Benutzer-ID an denselben Server gesendet wird, solange alle Server verf√ºgbar bleiben. </li></ul><br><img src="https://habrastorage.org/webt/ru/a-/w1/rua-w1fjpzumfbu92ujeakfw0hm.png"></li><li>  Klicken Sie im Block Mitglieder auf +, um dem Pool Server hinzuzuf√ºgen. <br><br><img src="https://habrastorage.org/webt/qd/io/cf/qdiocfo-f-kjw6aot0q9ekbd37i.png"><br><br>  Hier m√ºssen Sie angeben: <br><br><ul><li>  Servername </li><li>  Server IP Adresse; </li><li>  der Port, an den der Server Datenverkehr empf√§ngt; </li><li>  Port f√ºr Gesundheitscheck (Monitor Healthcheck); </li><li>  Gewicht - Mit diesem Parameter k√∂nnen Sie die proportionale Menge des empfangenen Datenverkehrs f√ºr ein bestimmtes Mitglied des Pools anpassen. </li><li>  Max. Verbindungen - Die maximale Anzahl von Verbindungen zum Server. </li><li>  Min. Verbindungen - Die Mindestanzahl von Verbindungen, die der Server verarbeiten muss, bevor der Datenverkehr zum n√§chsten Poolmitglied umgeleitet wird. </li></ul><br><img src="https://habrastorage.org/webt/wi/re/hv/wirehvt2ivslsykeopxoeuvrhky.png"><br><br>  So sieht der endg√ºltige Pool von drei Servern aus. <br><br><img src="https://habrastorage.org/webt/u1/t1/xs/u1t1xsnzgp9-zs4odzuklgark30.png"></li></ol><br><h4>  Virtuellen Server hinzuf√ºgen </h4><br><ol><li>  Wechseln Sie zur Registerkarte Virtuelle Server.  Klicken Sie auf +. <br><br><img src="https://habrastorage.org/webt/k5/pt/j0/k5ptj0t6ziwg25ec17vcjntpgzm.png"></li><li>  Wir aktivieren den virtuellen Server mit Enable Virtual Server. <br><br>  Wir geben ihm einen Namen, w√§hlen das zuvor erstellte Anwendungsprofil und den Pool aus und geben die IP-Adresse an, an die Virtual Server Anforderungen von au√üerhalb akzeptiert.  Geben Sie das HTTPS-Protokoll und den Port 443 an. <br>  Optionale Parameter hier: <br><br>  <b>Verbindungslimit</b> - Die maximale Anzahl gleichzeitiger Verbindungen, die ein virtueller Server verarbeiten kann. <br>  <b>Verbindungsratenlimit (CPS)</b> - Die maximale Anzahl neuer eingehender Anforderungen pro Sekunde. <br><br><img src="https://habrastorage.org/webt/xa/rp/xu/xarpxupxblhb_tt0qsatlfn5b-m.png"></li></ol><br><br>  Damit ist die Balancer-Konfiguration abgeschlossen. Sie k√∂nnen die Leistung √ºberpr√ºfen.  Server haben die einfachste Konfiguration, mit der Sie nachvollziehen k√∂nnen, welcher Server aus dem Pool die Anforderung verarbeitet hat.  W√§hrend des Setups haben wir den Round Robin-Ausgleichsalgorithmus ausgew√§hlt, und der Weight-Parameter f√ºr jeden Server ist gleich eins, sodass jede n√§chste Anforderung vom n√§chsten Server aus dem Pool verarbeitet wird. <br><br>  Geben Sie die externe Adresse des Balancers in den Browser ein und sehen Sie: <br><br><img src="https://habrastorage.org/webt/nt/he/7u/nthe7uim5gmdqb9odzyub_hdkeq.png"><br><br>  Nach dem Aktualisieren der Seite wird die Anforderung vom folgenden Server verarbeitet: <br><br><img src="https://habrastorage.org/webt/ke/d1/xf/ked1xfdi_nmdye9ci5nswvgzjaq.png"><br><br>  Und noch einmal - um den dritten Server aus dem Pool zu √ºberpr√ºfen: <br><br><img src="https://habrastorage.org/webt/nu/uo/8u/nuuo8uvhb1dq2tozx2nrtjwfo68.png"><br><br>  Bei der √úberpr√ºfung k√∂nnen Sie feststellen, dass das Zertifikat, das Edge uns sendet, das gleiche ist, das wir zu Beginn generiert haben. <br><br>  √úberpr√ºfen Sie den Status des Balancers √ºber die Edge-Gateway-Konsole.  <b>Geben</b> Sie dazu den <b>Show Service Loadbalancer Pool ein</b> . <br><br><img src="https://habrastorage.org/webt/ba/_6/jq/ba_6jqyhlyemoguhvwshmhgabbq.png"><br><br><h4>  Konfigurieren Sie Service Monitor, um den Status der Server im Pool zu √ºberpr√ºfen </h4><br>  Mit Service Monitor k√∂nnen wir den Status von Servern im Backend-Pool √ºberwachen.  Wenn die Antwort auf die Anforderung nicht den Erwartungen entspricht, kann der Server aus dem Pool entfernt werden, sodass keine neuen Anforderungen empfangen werden. <br><br>  Standardm√§√üig sind drei √úberpr√ºfungsmethoden konfiguriert: <br><br><ul><li>  TCP-Monitor </li><li>  HTTP-Monitor </li><li>  HTTPS-Monitor. </li></ul><br>  Erstellen Sie eine neue. <br><br><ol><li>  Gehen Sie zur Registerkarte Service Monitoring und klicken Sie auf +. <br><br><img src="https://habrastorage.org/webt/i_/ca/e4/i_cae4kdihjj0ewts1v1d-yeeog.png"></li><li>  W√§hlen Sie: <br><br><ul><li>  Name f√ºr die neue Methode; </li><li>  Intervall, in dem Anfragen gesendet werden, </li><li>  Antwortzeitlimit </li><li>  Der √úberwachungstyp ist eine HTTPS-Anforderung mit der GET-Methode, der erwartete Statuscode ist 200 (OK) und die Anforderungs-URL. </li></ul></li><li>  Damit ist die Konfiguration des neuen Service Monitors abgeschlossen. Jetzt k√∂nnen wir ihn beim Erstellen eines Pools verwenden. <br><br><img src="https://habrastorage.org/webt/by/vj/ea/byvjea2dm23pabgtmueiedehzhq.png"></li></ol><br><h4>  Anwendungsregeln konfigurieren </h4><br>  Anwendungsregeln sind eine M√∂glichkeit, den Datenverkehr basierend auf bestimmten Triggern zu manipulieren.  Mit diesem Tool k√∂nnen wir erweiterte Lastausgleichsregeln erstellen, die m√∂glicherweise nicht √ºber Anwendungsprofile oder andere auf Edge Gateway verf√ºgbare Dienste konfiguriert werden k√∂nnen. <br><br><ol><li>  Um eine Regel zu erstellen, wechseln Sie zur Registerkarte Anwendungsregeln des Balancers. <br><br><img src="https://habrastorage.org/webt/lc/ff/uw/lcffuwfhhtf6nn1emi7_e-3cjdu.png"></li><li>  W√§hlen Sie einen Namen, ein Skript, das die Regel verwendet, und klicken Sie auf Behalten. <br><br><img src="https://habrastorage.org/webt/1y/a-/o0/1ya-o0rss2uga8gzuasij20yd70.png"></li><li>  Nachdem die Regel erstellt wurde, m√ºssen wir den bereits konfigurierten virtuellen Server bearbeiten. <br><br><img src="https://habrastorage.org/webt/xg/ha/jf/xghajfs-6ntwycerfn_nun0wvlq.png"></li><li>  F√ºgen Sie auf der Registerkarte Erweitert die von uns erstellte Regel hinzu. <br><br><img src="https://habrastorage.org/webt/le/zv/vs/lezvvste4xmuvdzj4l8jrp5trbq.png"></li></ol><br><br>  Im obigen Beispiel haben wir die Unterst√ºtzung von tlsv1 aufgenommen. <br><br>  Noch ein paar Beispiele: <br><br>  Leiten Sie den Datenverkehr in einen anderen Pool um. <br><br>  Mit diesem Skript k√∂nnen wir den Datenverkehr in einen anderen Ausgleichspool umleiten, wenn der Hauptpool nicht funktioniert.  Damit die Regel funktioniert, m√ºssen auf dem Balancer mehrere Pools konfiguriert sein und alle Mitglieder des Hauptpools m√ºssen sich im Status "Down" befinden.  Geben Sie den Namen des Pools an, nicht dessen ID. <br><br><pre><code class="plaintext hljs">acl pool_down nbsrv(PRIMARY_POOL_NAME) eq 0 use_backend SECONDARY_POOL_NAME if PRIMARY_POOL_NAME</code> </pre> <br>  Leiten Sie den Datenverkehr zu einer externen Ressource um. <br><br>  Hier leiten wir den Datenverkehr auf eine externe Website um, wenn sich alle Mitglieder des Hauptpools im Status "Down" befinden. <br><br><pre> <code class="plaintext hljs">acl pool_down nbsrv(NAME_OF_POOL) eq 0 redirect location http://www.example.com if pool_down</code> </pre> <br>  Weitere Beispiele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Das ist alles √ºber den Balancer.  Wenn Sie Fragen haben, fragen Sie, ich bin bereit zu beantworten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448540/">https://habr.com/ru/post/de448540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448530/index.html">Wie Megaphone auf Mobilabonnements geschlafen hat</a></li>
<li><a href="../de448532/index.html">Weltraum-Rechenzentrum. Das Experiment zusammenfassen</a></li>
<li><a href="../de448534/index.html">Warum brauchen wir industrielle Schalter mit verbesserter EMV?</a></li>
<li><a href="../de448536/index.html">Transparenz - Das Allheilmittel der Butcherts</a></li>
<li><a href="../de448538/index.html">Erstellen Sie eine Failover-L√∂sung, die auf der Oracle RAC- und AccelStor Shared-Nothing-Architektur basiert</a></li>
<li><a href="../de448544/index.html">B√ºndel aus Stahl. Wie entstehen sie?</a></li>
<li><a href="../de448546/index.html">UITableView automatische Kopf- und Fu√üzeilengr√∂√üen mit AutoLayout</a></li>
<li><a href="../de448548/index.html">Konstruktion in der Kunst: von Brueghel bis Vasya Lozhkin</a></li>
<li><a href="../de448550/index.html">Berichtwettbewerb bei #PAYMENTSECURITY 2019 er√∂ffnet</a></li>
<li><a href="../de448552/index.html">ProLiant Series 100 - Der verlorene j√ºngere Bruder</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>