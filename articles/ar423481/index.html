<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ถ ๐พ ุฃุญุชุงุฌ ุฅูู ุฑูุน ูุฌููุนุฉ Kubernetes ุ ููููู ูุฌุฑุฏ ูุจุฑูุฌ ููุฏ. ููุงู ูุฎุฑุฌ ๐จ๐พโ๐คโ๐จ๐ผ ๐ถ ๐๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููู ุฌูุฏ. ููุงุญุธุฉ ุฃุฎุฑู ูู ุชุฌุฑุจุชู. ูุฐู ุงููุฑุฉ ุ ูููู ุงูุฃูุฑ ุณุทุญููุง ุญูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุฃุณุงุณูุฉ ุ ุงูุชู ุฃุณุชุฎุฏููุง ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชูุฑูุบ ุดูุก ูุง ุ ูููู ูุง ููุฌ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุญุชุงุฌ ุฅูู ุฑูุน ูุฌููุนุฉ Kubernetes ุ ููููู ูุฌุฑุฏ ูุจุฑูุฌ ููุฏ. ููุงู ูุฎุฑุฌ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423481/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/j9/qc/fb/j9qcfbdq_raamw7rwyt02ci1an8.png"><br><br>  ููู ุฌูุฏ.  ููุงุญุธุฉ ุฃุฎุฑู ูู ุชุฌุฑุจุชู.  ูุฐู ุงููุฑุฉ ุ ูููู ุงูุฃูุฑ ุณุทุญููุง ุญูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุฃุณุงุณูุฉ ุ ุงูุชู <b>ุฃุณุชุฎุฏููุง</b> ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชูุฑูุบ ุดูุก ูุง ุ ูููู ูุง ููุฌุฏ ุฑุฌุงู <b>devOps ูุฑูุจูู</b> .  ููู ุงููุณุชูู ุงูุญุงูู ููุชุฌุฑูุฏ ุ ูู ุงูุชูููููุฌูุง ุ ูุณูุญ ูุญูุงูู ุนุงู ุจุงูุนูุด ูุน ูุฐู ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ุงูุชู ุฃุซูุฑุช ุฎูุงู ุงูููู ุ ุจุงุณุชุฎุฏุงู ุงูุฅูุชุฑูุช ูุงูุฃุดูุงุก ุงูุฌุงูุฒุฉ. <br><br>  ุงููููุงุช ุงูููุชุงุญูุฉ - <b>AWS</b> + <b>Terraform</b> + <b>kops</b> .  ุฅุฐุง ูุงู ูุฐุง ูููุฏูุง ุจุงููุณุจุฉ ูู ุ ูุฑุจูุง ูููู ูููุฏูุง ูุดุฎุต ุขุฎุฑ.  ูุฑุญุจูุง ุจู ูู ุงูุชุนูููุงุช. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  -1.  ูุง ูุชุนุงูู ูุนู </h2><br>  ุงููุถุน ุงูููุงุณููู - ูุชู ูุชุงุจุฉ ุงููุดุฑูุน ูู ูุซู ูุฐู ุงููุฑุญูุฉ ุนูุฏูุง ูููู ูู ุงูุถุฑูุฑู ุชูุฑูุบู ูู ููุงู ูุง ูุงูุจุฏุก ูู ุงุณุชุฎุฏุงูู.  ูุงููุดุฑูุน ุฃูุซุฑ ุชุนููุฏูุง ูู ุตูุญุฉ html ุจุณูุทุฉ.  ุฃุฑุบุจ ูู ุฅููุงููุฉ ุงูุชุญุฌูู ุงูุฃููู ุ ููููุฉ ุงูุจูุฆุฉ ุนูู ููุตุงุช ุงูููุชุฌ ุงููุญููุฉ ุ ูุงูุงุฎุชุจุงุฑูุฉ ุ ูุนูููุฉ ุงููุดุฑ ุจุดูู ุฃู ุจุขุฎุฑ. <br><blockquote style=";text-align:right;direction:rtl">  ูุชุนูู ุงูุฃูุฑ ุจุชุทุจูู ุนูู <b>Laravel</b> ูุฅุธูุงุฑ ุงูุนูููุฉ ุจุฑูุชูุง ูู ุงูุจุฏุงูุฉ ุฅูู ุงูููุงูุฉ.  ูููู ุจุทุฑููุฉ ููุงุซูุฉ ุ ููููู ูุดุฑ ุชุดุชุช ุงูุฎุฏูุงุช ุฃุซูุงุก ุงูุชููู ูุชุทุจููุงุช ุงูุซุนุจุงู ูุงูููุงูุน ุงูุตุบูุฑุฉ ุนูู WP ู html-pages ูุงููุฒูุฏ.  ุฅูู ูุณุชูู ูุนูู ุ ูุฐุง ูููู ุ ุซู ูุธูุฑ ุดุฎุต ูููุตู ูู ุงููุฑูู ุ ูุงูุฐู ุณูุญุณูู ูููููู. </blockquote>  ูู ุงูุขููุฉ ุงูุฃุฎูุฑุฉ ุ ุชูุตูุช ุฅูู ุญูููุฉ ุฃููู ููุช ุจุชุซุจูุช <b>GoLand ู PhpStorm ู Docker ู Git</b> ุนูู ุงูุฃุฌูุฒุฉ ุงููุญููุฉ <b>ูุฃูุง</b> ูุณุชุนุฏ ุชูุงููุง ููุนูู.  ูุนู ุ ูููููู ุงูุฅุฏุงุฑุฉ ูู ุฌูุงุฒ ูุงุญุฏ ูู ูุฌููุนุงุช ูุฌูุนุฉ ุ ูุฐูู ุณุฃุตู ุงูุนูููุฉ ุจุฃููููุง ุฏูู ุฃุฎุฐ ูุธุงู ุงูุชุดุบูู ุงูุฐู ุชุนูู ุนููู ูู ุงูุงุนุชุจุงุฑ ุ ูุน ุชุนุจุฆุฉ ุฌููุน ุงูุฃุดูุงุก ูู ุญุงููุฉ ุนุงูู ูููุงุก. <br><br><h2 style=";text-align:right;direction:rtl">  0. ุงูุงุณุชุนุฏุงุฏ ููุนูู. </h2><br>  ุฏุนูุง ูุชุฎูู ุฃููุง ูููุง ุจุงููุนู ุจุชุณุฌูู ุญุณุงุจ ุนูู <b>AWS</b> ุ ุทููุจ ูู ุฎูุงู ุงูุฏุนู ุงูููู ุฒูุงุฏุฉ ุญุฏูุฏ ุงูุญุณุงุจ ูู ุฎูุงู ุนุฏุฏ ุงูุฎูุงุฏู ุงูุชู ุชุนูู ูู ููุณ ุงูููุช ุ <b>ูุฃูุดุฃูุง</b> ูุณุชุฎุฏู <b>IAM</b> ูุงูุขู ูุฏููุง <b>ููุชุงุญ ุงููุตูู</b> + <b>ููุชุงุญ ุงูุณุฑ</b> .  ุฒูู- <b>us-east-1</b> . <br><br>  ูุงุฐุง ูุญุชุงุฌ ุนูู ุงูููุจููุชุฑ ุงููุญููุ  <b>AWS CLI</b> ุ <b>Terraform</b> ููุฅุฏุงุฑุฉ ุงูุชุนุฑูููุฉ ูู <b>AWS</b> ุ <b>kubectl</b> ุ <b>kops</b> ูุชูููู ุงููุฌููุนุฉ ู <b>Helm</b> ุ ููุดุฑ ุจุนุถ ุงูุฎุฏูุงุช.  ูููู ุจุฌูุน ููู <b>Dockerfile</b> (ุงูุฐู ูุฌุฏุชู ููุฐ ูุชุฑุฉ ุทูููุฉ ูู ููุงู <b>ูุงุณุน</b> ูู <b>ุงูุญุฒุงู</b> ุ ูููู ูุง ูููููู ุงูุนุซูุฑ ุนูู ููุงูู).  ููุชุจ <b>docker-compose.yml</b> ุงูุฎุงุต ุจูุง <b>ูุฃุฏูุฉ</b> ุงูุชุซุจูุช ู <b>Makefile ููุฃุณูุงุก</b> ุงููุณุชุนุงุฑุฉ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููู Dockerfile</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">FROM ubuntu:16.04 ARG AWSCLI_VERSION=1.12.1 ARG HELM_VERSION=2.8.2 ARG ISTIO_VERSION=0.6.0 ARG KOPS_VERSION=1.9.0 ARG KUBECTL_VERSION=1.10.1 ARG TERRAFORM_VERSION=0.11.0 # Install generally useful things RUN apt-get update \ &amp;&amp; apt-get -y --force-yes install --no-install-recommends \ curl \ dnsutils \ git \ jq \ net-tools \ ssh \ telnet \ unzip \ vim \ wget \ &amp;&amp; apt-get clean \ &amp;&amp; apt-get autoclean \ &amp;&amp; apt-get autoremove \ &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* # Install AWS CLI RUN apt-get update \ &amp;&amp; apt-get -y --force-yes install \ python-pip \ &amp;&amp; pip install awscli==${AWSCLI_VERSION} \ &amp;&amp; apt-get clean \ &amp;&amp; apt-get autoclean \ &amp;&amp; apt-get autoremove \ &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* # Install Terraform RUN wget -O terraform.zip https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip \ &amp;&amp; unzip terraform.zip \ &amp;&amp; mv terraform /usr/local/bin/terraform \ &amp;&amp; chmod +x /usr/local/bin/terraform \ &amp;&amp; rm terraform.zip # Install kubectl ADD https://storage.googleapis.com/kubernetes-release/release/v${KUBECTL_VERSION}/bin/linux/amd64/kubectl /usr/local/bin/kubectl RUN chmod +x /usr/local/bin/kubectl # Install Kops ADD https://github.com/kubernetes/kops/releases/download/${KOPS_VERSION}/kops-linux-amd64 /usr/local/bin/kops RUN chmod +x /usr/local/bin/kops # Install Helm RUN wget -O helm.tar.gz https://storage.googleapis.com/kubernetes-helm/helm-v${HELM_VERSION}-linux-amd64.tar.gz \ &amp;&amp; tar xfz helm.tar.gz \ &amp;&amp; mv linux-amd64/helm /usr/local/bin/helm \ &amp;&amp; chmod +x /usr/local/bin/helm \ &amp;&amp; rm -Rf linux-amd64 \ &amp;&amp; rm helm.tar.gz # Create default user "kops" RUN useradd -ms /bin/bash kops WORKDIR /home/kops USER kops # Ensure the prompt doesn't break if we don't mount the ~/.kube directory RUN mkdir /home/kops/.kube \ &amp;&amp; touch /home/kops/.kube/config</code> </pre> <br></div></div><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนุงูู ูููุงุก ุฏููุฑ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">version: '2.1' services: cluster-main: container_name: cluster.com image: cluster.com user: root stdin_open: true volumes: - ./data:/data - ./.ssh:/root/.ssh - ./.kube:/root/.kube - ./.aws:/root/.aws cluster-proxy: container_name: cluster.com-kubectl-proxy image: cluster.com user: root entrypoint: kubectl proxy --address='0.0.0.0' --port=8001 --accept-hosts='.*' ports: - "8001:8001" stdin_open: true volumes: - ./data:/data - ./.ssh:/root/.ssh - ./.kube:/root/.kube - ./.aws:/root/.aws</code> </pre><br></div></div><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Makefile</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker.build: docker build -t cluster.com . docker.run: docker-compose up -d docker.bash: docker exec -it cluster.com bash</code> </pre> <br></div></div><br>  <b>ููู ุงูุฅุฑุณุงุก</b> - ุฎุฐ ุตูุฑุฉ ุฃูุจููุชู ุงูุฃุณุงุณูุฉ ููู ุจุชุซุจูุช ุฌููุน ุงูุจุฑุงูุฌ.  <b>Makefile</b> - ููุฑุงุญุฉ ููุท ุ ููููู ุงุณุชุฎุฏุงู ุงูุขููุฉ ุงููุนุชุงุฏุฉ ููุฃุณูุงุก ุงููุณุชุนุงุฑุฉ.  <b>Docker-compose.yml</b> - ุฃุถููุง ุญุงููุฉ ุฅุถุงููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุชููู</a> ุจูุง ูู ูุชุตูุญ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุญุฉ ุงูููุงุฏุฉ K8S</a> ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุฑุคูุฉ ุดูุก ุจุตุฑููุง. <br><br>  ูููู ุจุฅูุดุงุก <b>ูุฌูุฏุงุช</b> <b>ุงูุจูุงูุงุช</b> ุ <b>.ssh</b> ุ <b>.kube</b> ุ <b>.aws</b> ูู ุงูุฌุฐุฑ ููุถุน ุงูุชูููู ุงูุฎุงุต ุจูุง ุนูู ููุงุชูุญ aws ุ ssh ููุงู ููููููุง ุฌูุน ูุชุดุบูู ุงูุญุงููุฉ ุงูุฎุงุตุฉ ุจูุง ูู ุฎูุงู <b>make docker.build &amp; docker.run</b> . <br><br>  ุญุณููุง ุ ูู ูุฌูุฏ <b>ุงูุจูุงูุงุช</b> ุ ูู ุจุฅูุดุงุก ูุฌูุฏ ูุถุน <b>ููู</b> ูููุงุช <b>yaml k8s</b> ุ ูุจุฌุงูุจ ุงููุฌูุฏ ุงูุซุงูู ุ ุงูุฐู ุณูููู ููู ุจุชุฎุฒูู ุญุงูุฉ <b>terraform</b> ูููุชูุฉ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>ุฃุถุน</b></a> ุงููุชูุฌุฉ ุงูุชูุฑูุจูุฉ ููุฐู ุงููุฑุญูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>ุนูู ุฌูุซุจ</b></a> . <br><br><h2 style=";text-align:right;direction:rtl">  1. ุฑูุน ูุฌููุนุชูุง. </h2><br><blockquote style=";text-align:right;direction:rtl">  ุงูุชุงูู ุณูููู ุชุฑุฌูุฉ ูุฌุงููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฐู</a> ุงููุฐูุฑุฉ.  ุณุฃุญุฐู ุงูุนุฏูุฏ ูู ุงูููุงุท ุงููุธุฑูุฉ ุ ุฃุญุงูู ูุตู ุถุบุท ูุตูุฑ.  ูู ููุณ ุ ุชูุณูู ููุงุญุธุชู ูู tldr. </blockquote><br>  ูู <b>ูุฌูุฏ ุงูุจูุงูุงุช / aws-cluster-init-kops-terraform ุ</b> ูุณุชูุณุฎ ูุง ูููู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง</a> ุงููุณุชูุฏุน ูููุชูู ุฅูู ูุญุฏุฉ ุชุญูู ุงูุญุงููุฉ ูู ุฎูุงู <b>make docker.bash</b> .  ูุจุฏุฃ ุชูุงุซุฑ ุงููุฑู ุงููููุฉ. <br><br><h4 style=";text-align:right;direction:rtl">  AWS CLI </h4><br>  ูููู ุจุฅูุดุงุก <b>kops</b> ุงููุณุชุฎุฏู ุ ูุฅุถุงูุฉ ุญููู ุงููุตูู ูุฅุนุงุฏุฉ ุชูููู <b>AWS CLI</b> ุนููู ุญุชู ูุง ูุชู ุชุดุบูู ุงูุฃูุงูุฑ ูู ุงููุณุชุฎุฏู ุงูุฎุงุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">aws iam create-group --group-name kops <span class="hljs-comment"><span class="hljs-comment">#   aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonRoute53FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/IAMFullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AWSCertificateManagerFullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonVPCFullAccess --group-name kops aws iam create-user --user-name kops aws iam add-user-to-group --user-name kops --group-name kops aws iam create-access-key --user-name kops</span></span></code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">aws configure</code> </pre><br><h4 style=";text-align:right;direction:rtl">  ุชููุฆุฉ Terraform </h4><br>  ูู ููู <b>ุงูุจูุงูุงุช / aws -uster-init-kops-terraform / variables.tf ุ ูู ุจุชุบููุฑ</b> ุงุณู ุงููุฌููุนุฉ ุฅูู ุงูุงุณู ุงููุทููุจ.  ูุง ุชูุณ ุฃู ุชุฃุฎุฐ ุฎูุงุฏู DNS ุงูุฎุงุตุฉ ุจูุง ูู ููู <b>update.json</b> ููู ุจุชุญุฏูุซูุง ุญูุซ ุงุดุชุฑูุช ูุทุงูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    cd /data/aws-cluster-init-kops-terraform #    AWS CLI export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id) export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key) #  terraform terraform init terraform get terraform apply #  NS  cat update-zone.json \ | jq ".Changes[].ResourceRecordSet.Name=\"$(terraform output name).\"" \ | jq ".Changes[].ResourceRecordSet.ResourceRecords=$(terraform output -json name_servers | jq '.value|[{"Value": .[]}]')" \ &gt; update-zone.json</span></span></code> </pre><br><h4 style=";text-align:right;direction:rtl">  Kops </h4><br>  ูููู ุจุฅูุดุงุก ูุชูุฉ ูู ุฎูุงู <b>kops</b> ุ ูุชุตุฏูุฑ ุงูุชูููู ุฅูู ููู <b>.tf</b> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> NAME=$(terraform output cluster_name) <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> KOPS_STATE_STORE=$(terraform output state_store) <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ZONES=$(terraform output -json availability_zones | jq -r <span class="hljs-string"><span class="hljs-string">'.value|join(",")'</span></span>) kops create cluster \ --master-zones <span class="hljs-variable"><span class="hljs-variable">$ZONES</span></span> \ --zones <span class="hljs-variable"><span class="hljs-variable">$ZONES</span></span> \ --topology private \ --dns-zone $(terraform output public_zone_id) \ --networking calico \ --vpc $(terraform output vpc_id) \ --target=terraform \ --out=. \ <span class="hljs-variable"><span class="hljs-variable">${NAME}</span></span></code> </pre><br><blockquote style=";text-align:right;direction:rtl">  ููุงู ุญุงุฌุฉ ุฅูู ููุงุญุธุฉ ุตุบูุฑุฉ ููุง.  ุณุชููู <b>Terraform</b> ุจุฅูุดุงุก <b>VPC</b> ุ ูุณูุญุชุงุฌ ุฅูู ุชุนุฏูู ุงูุชูููู ุงูุฐู <b>ุณุชููุญู ููุง Kops</b> .  ูุชู ุฐูู ุจุจุณุงุทุฉ ูู ุฎูุงู ุตูุฑุฉ ูุณุงุนุฏ <b>ุงูุฑูุงู / gensubnets: 0.1</b> <br></blockquote><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   terraform output -json &gt; subnets.json</span></span></code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     echo subnets.json | docker run --rm -i ryane/gensubnets:0.1</span></span></code> </pre><br>  ููููู ุฅุถุงูุฉ ุณูุงุณุงุช ููุฑูุฉ ููุทุฑูู 53. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">additionalPolicies: master: | [ { "Effect": "Allow", "Action": ["route53:ListHostedZonesByName"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["elasticloadbalancing:DescribeLoadBalancers"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["route53:ChangeResourceRecordSets"], "Resource": ["*"] } ] node: | [ { "Effect": "Allow", "Action": ["route53:ListHostedZonesByName"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["elasticloadbalancing:DescribeLoadBalancers"], "Resource": ["*"] }, { "Effect": "Allow", "Action": ["route53:ChangeResourceRecordSets"], "Resource": ["*"] } ]</code> </pre><br>  ุชุญุฑูุฑ ูู ุฎูุงู <b>kops ุชุญุฑูุฑ ุงููุฌููุนุฉ $ {NAME}</b> . <br><br><img src="https://habrastorage.org/webt/yw/wg/w4/ywwgw42_afdmr__elg0og_yjruk.png"><br><br>  ุงูุขู ูููููุง ุฑูุน ุงููุชูุฉ ููุณูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kops update cluster \ --out=. \ --target=terraform \ <span class="hljs-variable"><span class="hljs-variable">${NAME}</span></span> terraform apply</code> </pre><br>  ูู ุดูุก ูุณูุฑ ุนูู ูุง ูุฑุงู ุ <b>ุณูุชุบูุฑ</b> ุณูุงู <b>kubectl</b> .  ูู ุงููุฌูุฏ <b>data data / aws -uster-init-kops-terraform</b> ุ ุณูููู ุจุชุฎุฒูู ุญุงูุฉ ุงููุชูุฉ.  ููููู ููุท ูุถุน ูู ุดูุก ูู <b>ุจูุงุจุฉ</b> ูุฅุฑุณุงูู ุฅูู ูุณุชูุฏุน bitpack ุฎุงุต. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ kubectl get nodes NAME STATUS AGE ip-10-20-101-252.ec2.internal Ready,master 7m ip-10-20-103-232.ec2.internal Ready,master 7m ip-10-20-103-75.ec2.internal Ready 5m ip-10-20-104-127.ec2.internal Ready,master 6m ip-10-20-104-6.ec2.internal Ready 5m</code> </pre><br><h2 style=";text-align:right;direction:rtl">  2. ุฑูุน ุทูุจูุง </h2><br>  ุงูุขู ูุฏููุง ุดูุก ูุง ุ ูููููุง ูุดุฑ ุฎุฏูุงุชูุง ูู ูุชูุฉ.  ุณุฃุถุน ุชููููุงุช ุชูุฑูุจูุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุณ ุงููุณุชูุฏุน</a> .  ูููู ูุถุนูุง ูู ุญุฒูุฉ ูู <b>ุงูุจูุงูุงุช / k8s</b> . <br><br><h4 style=";text-align:right;direction:rtl">  ููุช ุงูุฎุฏูุฉ </h4><br>  ููุจุฏุฃ ุจุฃุดูุงุก ุงูุฎุฏูุฉ.  ูุญู ุจุญุงุฌุฉ ุฅูู <b>ุฏูุฉ ุงูููุงุฏุฉ</b> ุ <b>ูุงูุทุฑูู 53</b> ุ <b>ููุตูู</b> <b>ุงูุชุฎุฒูู</b> ูุงููุตูู ุฅูู ุณุฌููุง ุงูุฎุงุต ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">hub.docker.com</a> .  ุญุณูุง ุ ุฃู ุฅูู ุฃู ุดุฎุต ุขุฎุฑ ุ ุฅุฐุง ูุงูุช ููุงู ุฑุบุจุฉ ููุฐู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Init helm kubectl create serviceaccount --namespace kube-system tiller kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller kubectl patch deploy --namespace kube-system tiller-deploy -p '{"spec":{"template":{"spec":{"serviceAccount":"tiller"}}}}' helm init</span></span></code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl apply -f default-namespace.yaml kubectl apply -f storage-classes.yaml kubectl apply -f route53.yaml kubectl apply -f docker-hub-secret.yml kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml</code> </pre><br><h4 style=";text-align:right;direction:rtl">  PostgreSQL + Redis </h4><br>  ููุฏ ุฃุญุฑูุช ุนุฏุฉ ูุฑุงุช ุจุงุณุชุฎุฏุงู ุนุงูู ุฅุฑุณุงุก ููุณ ููุญุงููุงุช <b>ุนุฏููุฉ ุงูุฌูุณูุฉ</b> ุ ูููู ุงูุชูููู ุงูุฃุฎูุฑ ุญุชู ุงูุขู ุฃุซุจุช ุฃูู ุงูุฃูุซุฑ ููุงุกูุฉ.  ุฃุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>Stolon</b></a> ูุชูููุฑ ูุงุจููุฉ ุงูุชูุณุน.  ุญูุงูู ุนุงู ุงูุฑุญูุฉ ุฃูุฑ ุทุจูุนู. <br><br>  ููุดุฑ <b>ูุฎุทุทุงุช ุงูุฏูุฉ</b> ูุงุซููู ูู ุชููููุงุช Redis ุงูุณุฑูุนุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  etcd  stolon cd etcd-chart helm install --name global-etcd . #   stolon cd stolon-chart helm dep build helm install --name global-postgres . #  redis kubectl apply -f redis</span></span></code> </pre><br><h4 style=";text-align:right;direction:rtl">  Nginx + php </h4><br>  ุญููุฉ ุงููุนุชุงุฏุฉ.  <b>Nginx</b> ู <b>php-fpm</b> .  ูู ุฃูู ุจุชูุธูู ุงูุชููููุงุช ุจุดูู ุฎุงุต ุ ูููู ูููู ููุฌููุน ุงูุชููุฆุฉ ุจุฃููุณูู.  ูุจู ุงูุชูุฏูู ุ ูุฌุจ ุนููู ุชุญุฏูุฏ ุงูุตูุฑุฉ ุงูุชู ุณูุฃุฎุฐ ูููุง ุงูุฑูุฒ + ุฅุถุงูุฉ ุณุทุฑ ุดูุงุฏุฉ ูู <b>ูุฏูุฑ ุดูุงุฏุฉ AWS</b> .  Php ููุณูุง - ููููู ุฃุฎุฐู ูู ุงูุฑุตูู ุ ูููู ุจููุช ูุงุญุฏุฉ ุฎุงุตุฉ ุจู ุนู ุทุฑูู ุฅุถุงูุฉ ุนุฏุฏ ูููู ูู ุงูููุชุจุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl apply -f nginx kubectl apply -f php</code> </pre><br>  ูู ุตูุฑุชูุง ูุน ุงูุฑูุฒ ุ ูููู ุจุชุฎุฒููู ูู ูุฌูุฏ <b>/ crm-code</b> .  ูุญู ูุณุชุจุฏููุง ุจุตูุฑุชู ูุณุชุนูู ุจุดูู ุตุญูุญ ุชูุงููุง.  ุงูููู ูู <b>nginx / distribution.yml</b> . <br><br><img src="https://habrastorage.org/webt/xy/0k/0a/xy0k0axs4muxujs3b-dyp8ncske.png"><br><br>  ุฃุฎุฑุฌ ุงููุฌุงู.  <b>ุณุชููู</b> ุฎุฏูุฉ <b>Route53 ุจุงุณุชูุงููุง</b> ุ ูุชุบููุฑ / ุฅุถุงูุฉ ุณุฌูุงุช DNS ุ ูุณูุชู <b>ุชุญููู</b> ุงูุดูุงุฏุฉ ุฅูู <b>ELB</b> ูู <b>ูุฏูุฑ ุดูุงุฏุฉ AWS</b> .  ุงูููู ูู <b>nginx / service.yml</b> . <br><br><img src="https://habrastorage.org/webt/aw/nl/ya/awnlyaieynoajtmb_feavw2_qke.png"><br><br>  ุฅูู ุงูุฃูุงู ูุชุบูุฑุงุช env ูู php ูุฌุนููุง ูู ุงูุฏุงุฎู ูุงูุงุชุตุงู ุจู <b>PostgreSQL / Redis</b> .  ุงูููู ูู <b>php / Publishing.yml</b> . <br><br><img src="https://habrastorage.org/webt/ry/n9/v4/ryn9v42o_jvzafh16vr3m2rcpo4.png"><br><br>  ููุชูุฌุฉ ูุฐูู ุ ูุฏููุง ูุฌููุนุฉ <b>K8S</b> ุ ูุงูุชู ูููููุง ุนูู ุงููุณุชูู ุงูุฃุณุงุณู ุชูุณูุน ูุทุงููุง ูุฅุถุงูุฉ ุฎุฏูุงุช ุฌุฏูุฏุฉ ูุฎูุงุฏู ุฌุฏูุฏุฉ (ุนููุฏ) ูุชุบููุฑ ุนุฏุฏ ูุซููุงุช <b>PostgreSQL ู PHP ู Nginx</b> ูุงูุนูุด ูุจู ุธููุฑ ุดุฎุต ูููุตู ูู ุงููุฑูู ูููู ุจุฐูู . <br><br>  ูุฌุฒุก ูู ูุฐู ุงูููุงุญุธุฉ ุงููุตูุฑุฉ ุ ูู ุฃุชุทุฑู ุฅูู ูุดุงูู ุงููุณุฎ ุงูุงุญุชูุงุทู / ุงููุฑุงูุจุฉ ููู ูุฐู ุงูุฃุดูุงุก.  ูู ุงููุฑุญูุฉ ุงูุฃูููุฉ ุ ุณูููู <b>ุงููุถูู</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุญูู</a> ูุงูููุง <b>: 8001 / ui</b> ูู ุฎุฏูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุญุฉ ุงูููุงุฏุฉ K8S</a> .  ูู ููุช ูุงุญู ุณูููู ูู ุงููููู ุฑุจุท <b>Prometheus</b> ุฃู <b>Grafana</b> ุฃู <b>Barman</b> ุฃู ุฃู ุญููู ุฃุฎุฑู ููุงุซูุฉ. <br><br>  ุจุงุณุชุฎุฏุงู ูุญุทุฉ ุทุฑููุฉ ุฃู <b>Teamcity</b> ุ <b>ุณูููู</b> <b>Jenkins</b> ุจุชุญุฏูุซ ุงูุฑูุฒ ุจุนูู ุดูุก ูุซู ูุฐุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     -      Teamcity docker build -t GROUP/crm-code:latest . docker push GROUP/crm-code:latest #   (  ) kubectl set image deployment/php-fpm php-fpm=GROUP/php-fpm kubectl rollout status deployment/php-fpm kubectl set image deployment/php-fpm php-fpm=GROUP/php-fpm:latest kubectl set image deployment/nginx nginx=danday74/nginx-lua kubectl rollout status deployment/nginx kubectl set image deployment/nginx nginx=danday74/nginx-lua:latest kubectl rollout status deployment/php-fpm kubectl rollout status deployment/nginx</span></span></code> </pre><br>  ุณุฃููู ุณุนูุฏูุง ุฅุฐุง ูุงู ุฐูู ูุซูุฑูุง ููุงูุชูุงู ูุดุฎุต ูุง ูุณุนูุฏูุง ูุถุงุนููุง ุฅุฐุง ุณุงุนุฏ ุฃู ุดุฎุต.  ุดูุฑุง ููู ุนูู ุงูุชูุงููู.  ูุฑุฉ ุฃุฎุฑู ุ ุฃุฑูู ุฑุงุจุทูุง ุฅูู ุงููุณุชูุฏุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃูู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุซุงูู</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar423481/">https://habr.com/ru/post/ar423481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar423467/index.html">ุณูุตุฏุฑ ุงููุทูุฑูู ุงูุฑูุณ ูุชุงููุฌูุง ูุชูุงูู ุงูููุชุฌุงุช</a></li>
<li><a href="../ar423469/index.html">ุฃุณุฑุน ุฃุฑูุงู ุงูููุทุฉ ุงูุนุงุฆูุฉ ูู ุงูุบุฑุจ ุงููุชูุญุด</a></li>
<li><a href="../ar423475/index.html">ุงุฎุชุฑุงู ูุงููู ุงูุดูุฎูุฎุฉ: ุนูู ุฌุฏูุฏ ุนู ุงูุดูุฎูุฎุฉ ููุง ูุนููู ุฃู ุชุธู ุตุบูุฑุง</a></li>
<li><a href="../ar423477/index.html">ูู ูููุฌุง ุฃูู: ุงุจุฏุฃ ุทุฑููู ุฅูู ูุฑุชูุนุงุช ุงูุจูุงููุฑูุง ุงูุฏูููุฉ</a></li>
<li><a href="../ar423479/index.html">"ุฃููุงู": ูู ุณุชุทูุฑ ุฅูู ุงููุฑูุฎ</a></li>
<li><a href="../ar423483/index.html">ุฅูุฌุงุฏ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ ููุตู ูุญุชูู ุงููููุน ุจุงุณุชุฎุฏุงู Webpack</a></li>
<li><a href="../ar423485/index.html">ูุณูู ุชุญููู ุงูุตูุฑ ุจุงุณุชุฎุฏุงู IntersectionObserver</a></li>
<li><a href="../ar423487/index.html">Node.js ุจุฏูู ูุญุฏุงุช node_modules</a></li>
<li><a href="../ar423489/index.html">ุฃูุง ุทุจูุจ ุทูุงุฑุฆ ูุฃุฑูุฏ ุงูุชุญุฏุซ ุนู ูุฎุทุท ุงูููุจ ุงูููุฑุจุงุฆู ุงูุฌุฏูุฏ ูู Apple Watch</a></li>
<li><a href="../ar423491/index.html">ููุฎุต PHP ุฑูู 139 (3 - 17 ุณุจุชูุจุฑ 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>