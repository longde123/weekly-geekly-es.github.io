<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüë© üí° üßíüèø Construire un package RPM pour Rosa Linux en pratique üåÉ üï∑Ô∏è üè™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous utilisez le syst√®me d'exploitation Linux depuis longtemps et connaissez m√™me un peu la programmation, vous devrez peut-√™tre t√¥t ou tard compil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construire un package RPM pour Rosa Linux en pratique</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464993/"><p>  Si vous utilisez le syst√®me d'exploitation Linux depuis longtemps et connaissez m√™me un peu la programmation, vous devrez peut-√™tre t√¥t ou tard compiler le programme √† partir du code source.  Peut-√™tre que le programme souhait√© ne sera pas dans les r√©f√©rentiels de distribution.  Ou le programme a une ancienne version dans ces r√©f√©rentiels, et vous avez besoin de la derni√®re.  Ou peut-√™tre que vous avez cr√©√© un nouveau programme et que vous souhaitez le partager avec d'autres utilisateurs. <br></p><br><p>  Bien s√ªr, vous pouvez installer le programme selon les instructions fournies avec le code source.  Mais vous devrez ensuite g√©rer manuellement les fichiers du programme et surveiller ses d√©pendances.  Il est pr√©f√©rable de cr√©er un package avec le programme et d'utiliser le gestionnaire d'applications int√©gr√© au syst√®me d'exploitation. <br></p><br><p>  J'esp√®re que cet article vous aidera √† comprendre rapidement comment cr√©er un package RPM pour <em>Rosa Linux</em> ou une autre distribution qui utilise le gestionnaire de packages RPM (Mandriva, RedHat).  Ou du moins, dites-moi o√π chercher des informations. <br></p><br><p>  Ici, je vais montrer comment cr√©er des packages RPM sur mon ordinateur local, en utilisant un exemple simple.  Nous allons construire le programme <em>xkb-switch</em> dans le <em>syst√®me d'</em> exploitation <em>Rosa Linux</em> .  Nous prendrons le code source du programme de <em>GitHub</em> . <br></p><br><br><a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">L'article est divis√© en plusieurs parties courtes, donc la table des mati√®res est sous le spoiler</b> <div class="spoiler_text"><h2>  Table des mati√®res </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un peu sur Rosa Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un peu sur xkb-switch</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en place, finalisation, v√©rification du programme</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V√©rifier le code source sans votre profil sur GitHub</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V√©rification avec enregistrement du projet dans votre profil GitHub</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©ation de correctifs</a> </li></ul><br></li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©parer le "lieu de travail" pour cr√©er un package</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commen√ßons par cr√©er un fichier de sp√©cifications</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un peu sur la syntaxe du fichier spec</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En-t√™te de fichier de sp√©cifications</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©paration de la source</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Compilation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'installation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Emballage de fichiers</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est-ce que rpmlint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Types de packages RPM pour Rosa Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Notre r√©sultat</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Si vous devez diviser le colis en plusieurs parties</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ajouter des macros</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Changez un peu le titre</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©finir des packages de biblioth√®que</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©finir des fichiers pour les packages</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©solution de probl√®mes suppl√©mentaires</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âquipes principales</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commandes utiles pour construire un package</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V√©rification du colis fini</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liens utiles (sources principales)</a> </li></ul><br></div></div><br><br><a name="foreword"></a><br><h2>  Un peu sur Rosa Linux </h2><br><p>  <em>Rosa Linux</em> est une distribution cr√©√©e et support√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des d√©veloppeurs russes</a> .  Il est bas√© sur <em>Mandriva</em> , mais avec quelques fonctionnalit√©s.  J'utilise la version 32 bits de <em>Rosa Fresh R8</em> , sortie en 2014.  Maintenant, la version <em>R8</em> n'est plus prise en charge par les d√©veloppeurs (les r√©f√©rentiels ne sont pas mis √† jour), mais cela fonctionne bien sur mon ordinateur portable, donc je ne veux pas installer une nouvelle version. <br></p><br><p> <em>Rosa Fresh R8</em> Utilise le bureau <em>KDE4</em> .  Toutes les versions du package de distribution utilisent les gestionnaires <code>rpm</code> et <code>urpm</code> pour g√©rer les packages avec les applications, et les commandes correspondantes sont <code>rpm</code> , <code>urpmi</code> , <code>urpme</code> , <code>urpmq</code> , <code>urpmf</code> . <br></p><br><p>  Les principes de construction de progiciels sont g√©n√©ralement rarement modifi√©s au sein de la m√™me famille de distribution Linux.  Par cons√©quent, ce qui est d√©crit dans cet article devrait fonctionner dans toutes les versions des distributions <em>Rosa</em> . <br></p><br><p>  La construction de packages sur Rosa Linux est un peu plus simple que sur certaines autres distributions bas√©es sur <em>RPM</em> .  Certains points sont automatis√©s et n'ont pas besoin d'√™tre configur√©s. <br></p><br><br><a name="foreword-xkb-switch"></a><br><h2>  Un peu sur xkb-switch </h2><br><p>  J'ai aim√© l'id√©e d'utiliser le plugin pour l'√©diteur de texte Vim - <em>xkbswitch</em> , sur lequel il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article sur Habr√©</a> .  Il bascule automatiquement la disposition du clavier en anglais lorsque vous quittez le mode de saisie, et vice versa - √† celui sur lequel le texte a √©t√© entr√© la derni√®re fois - si vous entrez √† nouveau dans le mode de saisie.  Pour que ce plugin fonctionne, vous avez besoin du programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xkb-switch</a> , qui vous permet de changer la disposition du clavier √† partir de la ligne de commande et des plugins pour l'√©diteur <em>Vim</em> .  Ce programme n'√©tait pas dans les r√©f√©rentiels <em>Rosa Linux R8</em> (et probablement personne ne l'ajoutera, car la distribution est d√©j√† ancienne et le programme <em>xkb-switch n'est</em> pas tr√®s populaire). <br></p><br><br><a name="test_program"></a><br><h2>  Mise en place, finalisation, v√©rification du programme </h2><br><p>  Il est souvent n√©cessaire de configurer la compilation du programme pour qu'elle fonctionne correctement dans une distribution particuli√®re ou m√™me pour un syst√®me sp√©cifique.  Il arrive qu'un programme doive √™tre construit avec d'autres options ou avec le support d'un pilote sp√©cial.  Ou peut-√™tre voulez-vous corriger des erreurs dans le code du programme ou simplement v√©rifier si cela fonctionne.  Pour ce faire, il est pr√©f√©rable de copier le code source sur votre ordinateur avant de cr√©er le package RPM, essayez de le compiler et v√©rifiez le fonctionnement du programme compil√©. <br></p><br><p>  Si vous √™tes s√ªr que vous n'aurez pas besoin de modifier les fichiers du projet, vous pouvez utiliser le code source d'origine sur le site Web du projet et proc√©der imm√©diatement √† la cr√©ation du package.  Mais si vous devez modifier les param√®tres de compilation, il est g√©n√©ralement beaucoup plus facile de modifier le fichier dans le dossier source (le soi-disant <em>makefile</em> ) que de traiter ensuite les options pour les commandes de compilation et le p√©riph√©rique macro interne pour le fichier de sp√©cifications. <br></p><br><br><a name="test_program-local"></a><br><h3>  V√©rifier le code source sans votre profil sur GitHub </h3><br><p>  Si vous d√©cidez de travailler avec le code source ou les param√®tres de compilation du projet, mais que vous n'avez pas votre propre profil sur GitHub ou que vous ne souhaitez pas l'utiliser, vous pouvez simplement t√©l√©charger et d√©compresser le code source.  Dans notre cas, cela pourrait ressembler √† ceci (j'utilise le dossier <code>~/Projects/cpp</code> pour le code source <em>C ++</em> ): <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ierton/xkb-switch.git</code> </pre><br><br><p>  Cela cr√©era le dossier <code>~/Projects/cpp/xkb-switch</code> contenant le code source.  Bien s√ªr, au lieu d'utiliser <code>git</code> vous pouvez t√©l√©charger l'archive avec le programme et d√©compressez-la. <br></p><br><p>  √Ä partir du fichier <code>README.md</code> dans le dossier du projet, il est facile de deviner que l'utilitaire <code>cmake</code> est utilis√© pour cr√©er le programme.  Par cons√©quent, si vous devez modifier les param√®tres de compilation, dans notre cas, ils se trouvent dans le fichier <code>CMakeLists.txt</code> .  Et nous essayons simplement de compiler le programme et de v√©rifier s'il fonctionne.  Les commandes que vous devez utiliser pour cela sont √©crites dans le m√™me fichier <code>README.md</code> √† la racine du projet. <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> xkb-switch mkdir build &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake .. make ./xkb-switch <span class="hljs-comment"><span class="hljs-comment">#         ./xkb-switch -l #       ./xkb-switch -s ru #       (  )</span></span></code> </pre><br><br><p>  Apr√®s cela, pour utiliser le projet modifi√©, vous devrez effacer ou supprimer le dossier de construction du projet et emballer le code source dans l'archive.  Cela pourrait ressembler √† ceci: <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp/xkb-switch rm -rf ./build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp zip -r xkb-switch.zip xkb-switch</code> </pre><br><br><p>  Le fichier <code>xkb-switch.zip</code> ensuite √™tre utilis√© pour construire le package. <br></p><br><br><a name="test_program-github"></a><br><h3>  V√©rification avec enregistrement du projet dans votre profil GitHub </h3><br><p>  Je suppose que quiconque lit cette section est au moins un peu familier avec <em>Git</em> et a d√©j√† configur√© un profil sur <em>GitHub</em> .  Je pense que cette m√©thode est la meilleure, donc le reste de l'article impliquera qu'elle est utilis√©e, sauf indication contraire. <br></p><br><p>  Vous devez d'abord bifurquer le projet d'origine dans votre <em>GitHub</em> .  Apr√®s cela, comme dans la m√©thode pr√©c√©dente, nous clonons le projet sur notre ordinateur, mais √† partir de notre r√©f√©rentiel (dans mon cas, le nom d'utilisateur est <em>alexandersolovyov</em> ): <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/alexandersolovyov/xkb-switch.git</code> </pre><br><br><p>  Pour ajouter des modifications, il est pr√©f√©rable d'utiliser une nouvelle branche.  Ensuite, si vous le souhaitez, il sera possible d'utiliser diff√©rentes versions du programme.  Et il sera √©galement possible de proposer des modifications √† l'auteur du projet √† l'aide de pull-requests.  Par exemple, si vous d√©cidez de corriger un peu le fichier <code>CMakeLists.txt</code> , avant cela, vous devez cr√©er une nouvelle branche avec: <br></p><br><br><pre> <code class="bash hljs">git branch cmake_corrections</code> </pre><br><br><p>  Une fois les modifications effectu√©es, v√©rifi√©es et ajout√©es √† la branche (en utilisant <code>git commit -am " "</code> ), vous pouvez ajouter une nouvelle branche √† votre GitHub: <br></p><br><br><pre> <code class="bash hljs">git push origin cmake_corrections</code> </pre><br><br><p>  Apr√®s cela, vous pouvez faire une pull-request, si n√©cessaire. <br></p><br><p>  Vous pouvez cr√©er un lien vers le r√©f√©rentiel d'origine: <br></p><br><br><pre> <code class="bash hljs">git remote add ierton https://github.com/ierton/xkb-switch.git</code> </pre><br><br><p>  Et puis mettez √† jour la branche principale de votre r√©f√©rentiel afin qu'elle corresponde √† l'original: <br></p><br><br><pre> <code class="bash hljs">git pull ierton master</code> </pre><br><br><p>  Le code de programme correspondant √† la branche corrig√©e peut √™tre utilis√© lors de la construction du RPM.  Pour ce faire, vous devrez sp√©cifier l'adresse de l'archive sous la forme dans le fichier spec: <br></p><br><br><pre> <code class="plaintext hljs">Source0: https://github.com/-/-/archive/---.zip</code> </pre><br><br><p>  Mais, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme l'a demand√© l'utilisateur de specblog</a> , ce n'est en fait pas le cas.  Il est pr√©f√©rable de transmettre vos modifications sous forme de correctifs.  Pour ce faire, vous devez cr√©er des fichiers de correctif √† partir des modifications de votre branche et les copier dans le dossier source pour cr√©er le package ( <code>~/rpmbuild/SOURCES/</code> ).  Vous devrez ensuite les sp√©cifier dans le fichier de sp√©cifications.  Nous y r√©fl√©chirons un peu plus tard, mais si vous le souhaitez, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez le lire ici</a> .  Si vous ne savez pas comment cr√©er des patchs, vous pouvez regarder sous le spoiler. <br></p><br><br><a name="test_program-github-patches"></a><br><div class="spoiler">  <b class="spoiler_title">Comment cr√©er des correctifs √† l'aide de git</b> <div class="spoiler_text"><h4>  Cr√©ation de correctifs </h4><br><p>  <em>Les correctifs</em> , ce sont des <em>correctifs</em> - ce sont des fichiers dans lesquels les modifications sont enregistr√©es dans le code source du programme.  Ils sont utilis√©s comme alternative aux commandes <code>git pull</code> et <code>git push</code> pour la communication entre les r√©f√©rentiels de code locaux s'il n'est pas pratique de ¬´tirer¬ª les modifications d'un r√©f√©rentiel distant, ou si l'historique des modifications du projet et les principes de travail avec lui sont tels qu'il est pr√©f√©rable d'utiliser des correctifs. <br></p><br><br><p>  Imaginons que nous devons apporter des modifications au fichier <code>CMakeLists.txt</code> .  Tout d'abord, vous devez tout faire comme d√©crit ci-dessus: la branche principale de notre r√©f√©rentiel GitHub doit correspondre √† la branche principale du projet d'origine, et pour vos modifications, vous devez utiliser la branche <em>cmake_corrections</em> .  Ensuite, vous devez aller dans cette branche, apporter les modifications n√©cessaires et les enregistrer dans <em>git √† l'</em> aide de commits. <br></p><br><p>  Vous devez maintenant enregistrer les modifications sous forme de fichiers correctifs dans le dossier <code>~/rpmbuild/SOURCES</code> (si vous n'utilisez pas Rosa Linux, le chemin d'acc√®s au dossier <code>SOURCES</code> peut √™tre diff√©rent).  Par exemple, ceci (je veux dire que nous sommes dans le dossier du projet - par exemple, <code>~/Projects/cpp/xkb-switch</code> - et sur la branche <code>cmake_corrections</code> ): <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES origin/master</code> </pre><br><p>  La commande <code>git format-patch</code> cr√©e un fichier de <code>git format-patch</code> pour chaque commit.  Sous cette forme, il effectuera des correctifs √† partir de la validation sp√©cifi√©e par le dernier argument et se terminant par la derni√®re validation de la branche actuelle.  Vous pouvez sp√©cifier un commit de n'importe quelle mani√®re: au d√©but du hachage, en utilisant le pointeur <em>HEAD</em> ou le nom de la branche, qui indique maintenant le commit souhait√©.  L'essentiel est que l'un des commits visibles lorsque <code>git log</code> ex√©cut√© est pris comme d√©but.  Autrement dit, vous ne pouvez pas commencer √† cr√©er des correctifs √† partir d'une validation qui se trouve dans une autre branche. <br></p><br><p>  Et vous pouvez vous rappeler (ou voir) combien de validations nous avons ramifi√©es √† partir de la branche principale, et faire des correctifs pour un certain nombre de validations.  Par exemple, si nous avons fait deux commits, la commande serait: <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES -2</code> </pre><br><p>  Ici, le nombre de validations est d√©fini √† l'aide de <code>-2</code> .  Vous pouvez en sp√©cifier n'importe quel nombre au lieu de cette figure. <br></p><br><p>  Vous pouvez sp√©cifier la plage de validations √† partir de laquelle les correctifs doivent √™tre effectu√©s en pla√ßant deux points entre les liens vers les validations initiales et finales: <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES master..cmake_corrections</code> </pre><br><p>  Le nom de chaque fichier de correctif se compose d'un num√©ro de s√©rie et de la premi√®re ligne d'un commentaire de validation.  Par cons√©quent, il est pr√©f√©rable de renommer chaque fichier afin que la description du correctif d√©crive plus bri√®vement et clairement son essence.  Par exemple, comme ceci: <br></p><br><pre> <code class="bash hljs">mv 0001-Return-memory-allocated-by-XkbRf-getNamesProp()-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-tmp.patch 001-Fix-memory-leak.patch</code> </pre><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la convention de d√©nomination des correctifs dans l'article sur la syntaxe du fichier spec</a> recommande d'ajouter <em>package_name-version-rosa-</em> avant la description de chaque fichier patch.  C'est peut-√™tre une bonne pratique si vous envoyez des correctifs par e-mail, mais pas pour la construction de packages.  Nous cr√©ons des packages sur notre ordinateur, il est donc pr√©f√©rable de vider le dossier <code>~/rpmbuild/SOURCES</code> chaque fois avant de <code>~/rpmbuild/SOURCES</code> package avec un autre programme ou un nouveau package de version. <br></p><br><p>  Maintenant, si vous devez mettre √† jour la branche du r√©f√©rentiel principal ( <em>ma√Ætre</em> ) pour qu'elle corresponde √† l'original, alors la branche de changement ( <em>cmake_corrections</em> ) devra √™tre mise √† jour √† l'aide de la <code>git rebase</code> .  Vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pouvez voir</a> comment proc√©der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Apr√®s cela, les correctifs devront √™tre recr√©√©s. <br></p><br></div></div><br><br><a name="prepare"></a><br><h2>  Pr√©parer le "lieu de travail" pour cr√©er un package </h2><br><p>  Vous devez d'abord cr√©er une structure de r√©pertoires.  Tout l'assemblage a lieu dans le dossier <code>rpmbuild</code> dossier de d√©part de l' <code>rpmbuild</code> .  Cr√©ez la structure de r√©pertoires initiale et acc√©dez au dossier des fichiers de sp√©cifications: <br></p><br><br><pre> <code class="bash hljs">mkdir -p ~/rpmbuild/SPECS &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/SPECS</code> </pre><br><br><p>  Pour Rosa Linux, cela suffit: les dossiers restants seront cr√©√©s automatiquement. <br></p><br><p>  Une autre distribution peut utiliser un emplacement de fichier diff√©rent pour cr√©er le package.  Et vous devrez peut-√™tre cr√©er manuellement la hi√©rarchie compl√®te des dossiers.  Recherchez des informations pour votre distribution si vous n'utilisez pas Rosa Linux.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela pourrait ressembler √† ceci dans Red Hat</a> . <br></p><br><p>  Si le package a √©t√© <code>rpmbuild</code> avec des erreurs, tous les fichiers cr√©√©s par la commande <code>rpmbuild</code> ne <code>rpmbuild</code> pas supprim√©s - comme pour une g√©n√©ration r√©ussie.  Nous essaierons de r√©cup√©rer le paquet plusieurs fois, et les fichiers restants apr√®s la derni√®re fois vont interf√©rer.  Par cons√©quent, il est pr√©f√©rable de cr√©er un script simple qui vous aidera √† les supprimer rapidement.  Cr√©ez un fichier cleanup.sh et placez-le dans le <code>~/rpmbuild/SPECS</code> .  Voici son contenu: <br></p><br><br><pre> <code class="bash hljs">!<span class="hljs-comment"><span class="hljs-comment">#/bin/sh rm -rf ~/rpmbuild/BUILD/* rm -rf ~/rpmbuild/BUILDROOT/* rm -rf ~/rpmbuild/RPMS/* rm -rf ~/rpmbuild/SRPMS/*</span></span></code> </pre><br><br><p>  Bien s√ªr, il est pr√©f√©rable de lui ajouter des droits d'ex√©cution √† l'aide de la commande <code>chmod u+x cleanup.sh</code> . <br></p><br><p>  Si vous souhaitez collecter un package √† partir de fichiers qui se trouvent sur l'ordinateur local - si vous n'utilisez pas <em>GitHub</em> et avez apport√© des modifications aux fichiers de projet, ou si vous souhaitez cr√©er un package √† partir de votre propre programme qui est stock√© uniquement sur votre ordinateur - vous devez compresser le projet dans une archive ( par exemple <code>.zip</code> , <code>.tar</code> ou <code>.tar.gz</code> ) et placez-le dans le dossier <code>SOURCES</code> .  Par exemple, comme ceci: <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp/ zip -r xkb-switch.zip xkb-switch mkdir -p ~/rpmbuild/SOURCES cp xkb-switch.zip ~/rpmbuild/SOURCES/</code> </pre><br><br><p>  Si, apr√®s avoir construit le programme, vous souhaitez en cr√©er une autre ou la m√™me, mais une version diff√©rente, vous devrez supprimer tous les fichiers du dossier <code>~/rpmbuild/SOURCES</code> , puis copiez-y vos archives (si vous ne les t√©l√©chargez pas depuis <em>GitHub</em> ) et fichiers de correctifs (si utilis√©s).  Sinon, le fichier d'archive ne sera probablement pas t√©l√©charg√© depuis <em>GitHub</em> (pourquoi - voir plus tard), et il sera √©galement difficile de d√©terminer quel fichier de correctif appartient √† quel programme. <br></p><br><br><a name="specfile_start"></a><br><h2>  Commen√ßons par cr√©er un fichier de sp√©cifications </h2><br><p>  La base pour construire un package RPM est le soi-disant <em>fichier speck</em> .  Ce fichier contient les instructions du programme <code>rpmbuild</code> (ou plut√¥t <code>rpm</code> ) n√©cessaires √† la construction du package. <br></p><br><p>  Cr√©ez le fichier <code>xkb-switch.spec</code> dans le dossier <code>~/rpmbuild/SPECS/</code> .  La fa√ßon la plus simple de commencer est d'utiliser un mod√®le disponible sur le site Web des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichiers de sp√©cifications de mod√®le</a> . <br></p><br><p>  √Ä partir du <code>README</code> sur la page du projet <em>xkb-switch</em> , il <em>est</em> connu que le programme est compil√© √† l'aide de l'utilitaire <code>cmake</code> .  Par cons√©quent, nous allons s√©lectionner le <strong>fichier de sp√©cifications pour un programme cr√©√© √† l'aide de CMake</strong> et copier le mod√®le entier dans notre fichier de sp√©cifications.  Bien s√ªr, afin d'assembler correctement notre package RPM, ce mod√®le doit √™tre beaucoup chang√©, ce que nous ferons. <br></p><br><br><a name="specfile_syntax"></a><br><h2>  Un peu sur la syntaxe du fichier spec </h2><br><ul><li>  La syntaxe du fichier de sp√©cifications vous permet d'ajouter des commentaires de style bash. <br></li><li>  Vous pouvez utiliser des espaces comme espaces entre les valeurs sur la m√™me ligne pour cr√©er l'apparence de colonnes paires, mais la documentation recommande fortement d'utiliser le caract√®re de tabulation (un ou deux tant que les colonnes sont paires).  <strong>Remarque:</strong> dans tous les exemples de code de cet article, seuls les espaces sont utilis√©s, il est donc pr√©f√©rable de ne pas copier tout le texte d'ici dans votre fichier de sp√©cifications, mais de l'imprimer vous-m√™me. <br></li><li>  Les champs d'option se composent d'un nom d'option sp√©cial avec deux points et la valeur suivante via des tabulations (ou des espaces).  La casse des caract√®res dans les noms de champ n'a pas d'importance.  Par exemple: <br><pre> <code class="plaintext hljs"> Name: xkb-switch</code> </pre><br></li><li>  Si le mot est pr√©c√©d√© du symbole <code>%</code> (par exemple, <code>%description</code> ), il s'agit d'un mot-cl√© sp√©cial.  Il peut s'agir d'une commande, d'une macro ou d'un appel de script.  Ensuite, les param√®tres qu'il utilise peuvent √™tre indiqu√©s.  Et il y a des mots cl√©s qui indiquent le d√©but d'un bloc de commandes ou d'options.  Ensuite, les param√®tres peuvent √™tre indiqu√©s √† c√¥t√©, et sur les lignes suivantes, il devrait y avoir des commandes ou une liste d'options que j'ai d√©crites dans le paragraphe pr√©c√©dent.  Apr√®s un tel bloc, une ligne vide doit √™tre laiss√©e. <br></li><li>  Pour utiliser la valeur d'une constante, vous devez ins√©rer une construction de la forme <code>%{_}</code> .  Sa valeur peut √™tre pr√©d√©finie ou elle peut √™tre d√©termin√©e par une option (par exemple, <code>Name: xkb-switch</code> ) ou en utilisant le mot cl√© <code>%define</code> .  Toutes ces constantes sont √©galement consid√©r√©es comme des macros.  Leur utilisation sera discut√©e plus en d√©tail ci-dessous. <br></li></ul><br><br><a name="specfile_header"></a><br><h2>  En-t√™te de fichier de sp√©cifications </h2><br><p>  Dans le fichier de sp√©cifications, l'en-t√™te est toujours √©crit en premier.  Il s'agit d'une liste d'options qui s'appliquent au package RPM principal.  Lorsque le package est pr√™t, presque toutes ces informations seront affich√©es lors de la visualisation de sa description.  Voici ce que les lignes individuelles indiquent: <br></p><br><br>  <b>R√©sum√©:</b> <br>  Une br√®ve description du package.  J'ai espionn√© la description dans le fichier <code>README.md</code> dans le projet <em>xkb-switch</em> : <code>Query and change XKB layout state</code> . <br><br>  <b>Nom:</b> <br>  Le nom du package.  Dans notre cas, c'est <code>xkb-switch</code> . <br><br>  <b>Version:</b> <br>  Version du programme.  Pour le savoir, il est pr√©f√©rable de regarder le fichier <code>CMakeLists.txt</code> dans le dossier racine du projet.  Bien s√ªr, vous devez extraire le fichier de la copie du projet qui sera utilis√© pour l'assemblage.  Si vous utilisez le projet d'origine, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez ouvrir le fichier directement sur sa page GitHub</a> .  Comme vous pouvez le voir, la version est compos√©e de <code>MAJOR_VERSION</code> , <code>MINOR_VERSION</code> et <code>RELEASE_VERSION</code> .  J'ai utilis√© la version <code>1.6.0</code> du programme. <br><br>  <b>Communiqu√©:</b> <br>  Le num√©ro de version du package lui-m√™me.  Affiche l'heure √† laquelle un package avec un programme de la m√™me version est assembl√©.  Dans notre cas, c'est ¬´1¬ª, car personne n'a jamais assembl√© de programme de cette version.  Dans le cas id√©al, si nous avons d√©j√† essay√© de compiler le package et que l'assemblage a atteint la fin (m√™me s'il y avait des erreurs), apr√®s chaque nouvelle tentative, vous devez augmenter ce nombre de 1 et en m√™me temps ne pas supprimer les anciens packages assembl√©s des <code>rpmbuild/RPMS</code> et <code>rpmbuild/SRPMS</code> : Ensuite, de nouveaux packages avec un nouveau num√©ro de build seront cr√©√©s.  Peut-√™tre que cela devrait √™tre fait si vous utilisez un serveur sp√©cial pour l'assemblage.  Nous utilisons notre ordinateur et √† la place nous nettoierons les dossiers.  Si un package avec un programme de cette version est d√©j√† dans les r√©f√©rentiels de la distribution Linux, mais que vous compilez avec d'autres param√®tres, il est pr√©f√©rable de sp√©cifier le num√©ro de version 1 de plus que ce package. <br><br>  <b>Licence:</b> <br>  Nom abr√©g√© de la licence sous laquelle le programme est distribu√©.  Selon les r√®gles de Rosa Linux, vous ne pouvez cr√©er des packages qu'avec une licence qui permet une distribution gratuite.  <code>README.md</code> pouvez d√©couvrir dans le fichier <code>README.md</code> que la licence est <em>GNU GPLv3</em> .  Nous √©crivons donc: <code>GPLv3+</code> . <br><br>  <b>Groupe:</b> <br>  Groupe ou cat√©gorie auquel appartient le programme.  √Ä l'aide de ces groupes, les programmes sont tri√©s dans le menu de lancement de l'application et dans le gestionnaire de programmes de la fen√™tre (¬´Ajouter ou supprimer des programmes¬ª).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La liste des groupes pour Rosa Linux peut √™tre trouv√©e ici</a> .  Je pense que <code>Development\X11</code> est le meilleur pour nous, car le programme est li√© √† X11 et est principalement n√©cessaire pour cr√©er des scripts et des plugins pour Vim. <br><br>  <b>URL:</b> <br>  Adresse Internet o√π vous pouvez t√©l√©charger le code source d'origine du programme.  Il sera sp√©cifi√© lors de l'affichage des informations sur le package RPM.  Cet article est facultatif, mais nous indiquerons: <code>https://github.com/ierton/xkb-switch</code> <br><br>  <b>Source0:</b> <br>  Le nom du fichier d'archive contenant le code source ou l'adresse Internet o√π il peut √™tre t√©l√©charg√©.  Si vous sp√©cifiez une adresse sur Internet, lors du premier build, le fichier sera t√©l√©charg√© dans <code>~/rpmbuild/SOURCES/</code> .  Si un tel fichier existe d√©j√†, il ne sera plus t√©l√©charg√©, c'est-√†-dire que le programme <code>rpmbuild</code> n'utilisera que le nom de fichier sp√©cifi√© √† la fin de cette URL.  Vous pouvez sp√©cifier uniquement le nom du fichier, mais il devra ensuite √™tre plac√© manuellement dans le dossier <code>~/rpmbuild/SOURCES/</code> .  Il est pr√©f√©rable de fournir l'adresse de votre copie du projet sur GitHub.  J'ai utilis√© le fichier <code>https://github.com/alexandersolovyov/xkb-switch/archive/master.zip</code> .  Vous pouvez sp√©cifier plusieurs sources diff√©rentes pour collecter les sources de plusieurs archives √† l'aide d'un fichier speck.  Ensuite, au nom de l'option pour ajouter chaque archive suivante, le nombre doit augmenter ( <code>Source1</code> , <code>Source2</code> , etc.).  Ces adresses de fichiers ne sont pas visibles lors de l'affichage des informations sur les packages RPM. <br><br>  <b>Patch0:</b> <br>  Cette option n'est pas dans le fichier mod√®le.  Cela peut √™tre utile si vous d√©cidez de transf√©rer vos modifications dans les fichiers de projet du programme sous forme de correctifs.  Quant √† l'option <code>Source0</code> , chaque fichier doit √™tre indiqu√© sur une ligne distincte et le nombre √† la fin du nom de l'option doit augmenter √† chaque fois.  Les fichiers de correctifs doivent se trouver dans le dossier <code>~/rpmbuild/SOURCES</code> (√† c√¥t√© de l'archive source t√©l√©charg√©e).  Le nom de chaque fichier doit √™tre √©crit sans chemin d'acc√®s.  Il n'est pas n√©cessaire de sp√©cifier tous les fichiers de patch ici - seuls ceux que vous souhaitez appliquer peuvent √™tre utilis√©s. <br><br>  <b>BuildRequires:</b> <br>  Paquets requis pour construire le programme.  Le mod√®le <code>cmake</code> .  Le fichier <code>CMakeLists.txt</code> indique que la version minimale de CMake pour l'assemblage ne doit pas √™tre inf√©rieure √† <em>2.6</em> , il est donc pr√©f√©rable de sp√©cifier <code>cmake &gt;= 2.6</code> .  Vous pouvez ajouter d'autres packages, chacun d'eux sur une ligne distincte, en utilisant l'option <code>BuildRequires:</code> s√©par√©e.  La liste des packages n√©cessaires √† l'assemblage peut √™tre trouv√©e en lisant le <code>README</code> du projet et en examinant attentivement le fichier <code>CMakeLists.txt</code> (en particulier les fonctions <code>FIND_PACKAGE</code> , <code>TARGET_LINK_LIBRARY</code> , <code>FIND_PROGRAM</code> ).  Ensuite, vous devez trouver le nom de package correct dans les r√©f√©rentiels √† l'aide de la commande <code>urpmq -a __</code> .  Dans notre cas, le fichier de param√®tres de compilation ( <code>CMakeLists.txt</code> ) contient d√©j√† des lignes qui v√©rifient la pr√©sence des packages n√©cessaires dans le syst√®me.  Mais il vaut mieux sp√©cifier la liste enti√®re ici aussi: <br><pre> <code class="plaintext hljs"># CMake  2.6   BuildRequires: cmake &gt;= 2.6 #  C/C++ BuildRequires: gcc #    libxkbfile BuildRequires: libxkbfile-devel #   X11   libxkbfile, #  libx11-devel   . #    man: BuildRequires: xz</code> </pre><br><br>  <b>N√©cessite:, Fournit:</b> <br>  Ces options ne sont pas dans l'√©chantillon, mais parfois elles peuvent √™tre utiles.  Ils √©tablissent des d√©pendances entre les packages.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'option </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cifie les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionnalit√©s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournies par le package en cours de construction. Cela peut √™tre le nom de l' en- </font><font style="vertical-align: inherit;">t√™te fichier de langue </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou le </font><font style="vertical-align: inherit;">nom de la </font><font style="vertical-align: inherit;">biblioth√®que de liens dynamiques, ou une fonction sp√©ciale. Et l'option </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique de quelles </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacit√©s d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autres packages d√©pendent le package. Package Manager ( </font></font><code>rpm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>urpm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou d' </font><font style="vertical-align: inherit;">autres qui utilisent votre distribution), lors de la </font><font style="vertical-align: inherit;">recherche des d√©pendances √† la </font><font style="vertical-align: inherit;">recherche de </font><font style="vertical-align: inherit;">ces </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opportunit√©s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plut√¥t que des </font><font style="vertical-align: inherit;">noms de paquet. Par cons√©quent, </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est pr√©f√©rable d'indiquer la version de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opportunit√©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournie </font><font style="vertical-align: inherit;">et pour </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelles versions des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opportunit√©s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournies </font><font style="vertical-align: inherit;">conviennent. La version est indiqu√©e par des signes </font></font><code>&gt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entour√© d'espaces. Habituellement, toutes les options sont indiqu√©es en premier </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis - </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un nom de fonction par ligne - le m√™me que pour </font></font><code>BuildRequires:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En r√®gle g√©n√©rale, lors de la cr√©ation de packages sur Rosa Linux, les d√©pendances sont automatiquement reconnues et ces options doivent rarement √™tre sp√©cifi√©es. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoReq:, AutoProv:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si vous </font><b><font style="vertical-align: inherit;">cr√©ez un</font></b><font style="vertical-align: inherit;"> programme √©crit dans une langue que le gestionnaire </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">nouveau ou propri√©taire et si les d√©pendances ne sont pas correctement d√©tect√©es automatiquement, vous pouvez d√©sactiver la d√©tection automatique des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacit√©s</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (avec </font></font><code>AutoProv: no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et / ou des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©pendances</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (avec aide </font></font><code>AutoReq: no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% description</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce bloc ne fait plus partie de l'en-t√™te, mais lui est associ√©. </font><font style="vertical-align: inherit;">Il ajoutera une description compl√®te du programme au package RPM. </font><font style="vertical-align: inherit;">Une ligne vide doit √™tre laiss√©e apr√®s. </font><font style="vertical-align: inherit;">La description peut √™tre la suivante:</font></font><br><pre> <code class="plaintext hljs">%description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor via 'libxkbswitch.so'. It is mainly used by a plugin for Vim text editor, vim-xkbswitch. Originally ruby-based code written by J.Broomley.</code> </pre><br><br><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les lignes du mod√®le commen√ßant par </font></font><code>%files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ne </font></font><code>%find_lang</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont n√©cessaires que si vous cr√©ez une application </font><font style="vertical-align: inherit;">prenant en </font><font style="vertical-align: inherit;">charge plusieurs langues, supprimez-les.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, apr√®s le commentaire sur la ligne de division, suivi des commandes et des macros qui doivent √™tre termin√©es avant de compresser les fichiers. </font><font style="vertical-align: inherit;">Toutes ces commandes sont divis√©es en blocs d√©finis √† l'aide de mots cl√©s sp√©ciaux.</font></font></p><br><br><a name="prep"></a><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pr√©paration de la source </font></font></h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier est un bloc </font></font><code>%prep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui indique les commandes pour pr√©parer la compilation. </font><font style="vertical-align: inherit;">Il contient une macro-commande </font></font><code>%setup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Elle ex√©cute un script qui fait ce qui suit:</font></font></p><br><br><ul><li>       ,      <code>SourceX:</code>    (  ‚Äî  <code>Source0:</code> ).         ,    . <br></li><li>      <code>~/rpmbuild/SOURCES/</code> . <br></li><li>      <code>~/rpmbuild/BUILD/</code> . <br></li><li>      . <br></li></ul><br><br><p>   <code>-q</code> ,       . </p><br><p>     ,     <code>%prep</code> : </p><br><br><pre> <code class="bash hljs">rpmbuild -bp ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>     <code>rpmbuild</code> .       ,      <code>rpm</code>    : <code>rpmbuild</code>    ,      .           (   <code>root</code>    <code>sudo</code> ).    <code>rpmbuild</code>  ,  <code>man rpmbuild</code> .      ,       ,   , ‚Äî  ,          <code>rpmbuild</code> . <br></p><br><p>      : <code>xkb-switch-1.6.0: No such file or directory</code> .    ,          <code>~/rpmbuild/BUILD/xkb-switch-1.6.0</code> ,  .   <br></p><br><br><pre> <code class="bash hljs">ls ~/rpmbuild/BUILD/</code> </pre><br><br><p> ,     <code>xkb-switch-master</code> .     <code>%setup</code>    <code>-n</code> .    <code>%prep</code>  -   : <br></p><br><br><pre> <code class="bash hljs">%prep %setup -q -n xkb-switch-master</code> </pre><br><br><p>    <code>~/rpmbuild/SPECS/cleanup.sh</code> ,    <code>BUILD</code> ,     ,   <code>%prep</code> .  ,     <code>exit 0</code> .  ,     . <br></p><br><p>          ,         .       <code>%prep</code> .       ,    ,      : <br></p><br><pre> <code class="plaintext hljs">%apply_patches</code> </pre><br><p>       <code>rpmbuild -bp xkb-switch.spec</code> .    ‚Äî    . <br></p><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Maximum RPM</a> . <br></p><br><p>    . <br></p><br><br><a name="build"></a><br><h2>  </h2><br><p>      <code>%build</code> .   <code>README</code>  ,     <code>cmake ..</code>  <code>make</code> ,     -   .  :           ,     .    ,        <code>%build</code> : <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -bc ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>     <code>exit 0</code> :    . <br></p><br><p> ,         .     shell (  bash  zsh,     ).  <code>rpmbuild</code>      ,           .    shell    - ‚Äî        . (    .) <br></p><br><p>     -  , ,  ,     <code>%build</code>  shell  . <br></p><br><p>     ,    ,   .      <code>cmake</code> , , ,        <code>%cmake</code>      -  ,      ,    .         (   ‚Äî <code>CMakeLists.txt</code> ).             ,    . <br></p><br><br><a name="install"></a><br><h2>  L'installation </h2><br><p> , <em></em> .   <code>%install</code>   ,               ,     ,    <code>~/rpmbuild/BUILDROOT/__-buildroot/</code> . <br></p><br><p>  <code>__</code>    ,     <code>Name:</code>   -,   ( <code>Version:</code>  -),   ( <code>Release:</code>  -),  ,     . <br></p><br><p>   <code>README</code>  ,     <code>make install</code> ,    <code>build</code>   .  - - <code>%makeinstall_std -C build</code>    ,   .       ( ,   ): <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -bi ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>      ,       RPM.   -   ,     . <br></p><br><br><a name="packing"></a><br><h2>   </h2><br><p>         ,      -  .     ,     <code>~/rpmbild/BUILDROOT/</code> . ( , ,     <code>tree</code> ,  -      Linux.)  ,       ,       <code>.debug</code> .    , ,    :        . <br></p><br><p>  ,       ,   <code>%files</code>  -.   ,     ,      .  . <br></p><br><p>       <code>%files</code>  -.  ,    .   Rosa Linux       <code>%prep</code> (  -   ).   ,   ,     ,  ,        ‚Äî   .          - (,    ,     ). <br></p><br><p>   <code>%files</code>    ,      RPM. ,     : <br></p><br><br><pre> <code class="plaintext hljs">%files %{_bindir}/%{name} %{_libdir}/libxkbswitch.so %{_libdir}/libxkbswitch.so.1 %{_libdir}/libxkbswitch.so.%{version} %{_mandir}/man1/%{name}.1.xz</code> </pre><br><br><p>         -.   , ,     <code>/usr/lib/rpm/macros</code> .  , <code>%{_bindir}</code>     , <code>%{_libdir}</code> ‚Äî   ,  <code>%{_mandir}</code> ‚Äî    man.   <code>%{name}</code>  <code>%{version}</code>    <code>Name:</code>  <code>Version:</code>   -. <br></p><br><p>     : <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -ba ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p> ‚Ä¶   2   1 .    <code>rpmlint</code> ,      .  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Rpmlint Errors</a>  ,   : <br></p><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: E: incoherent-version-in-name (Badness: 50) 1`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erreur: La version dans le nom du package de biblioth√®que n'est pas sp√©cifi√©e correctement. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: E: ex√©cutable-dans-biblioth√®que-package (Badness: 1) / usr / bin / xkb-switch`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erreur: le package de biblioth√®que contient un fichier ex√©cutable. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: W: fichier-devel-in-non-devel-package / usr / lib / libxkbswitch.so`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avertissement qu'un fichier de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">package de d√©veloppement</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><code>-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) a √©t√© trouv√© dans un package qui n'√©tait pas destin√© au d√©veloppement.</font></font><br><br><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tout est-il clair? </font></font> Je ne pense pas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examinons de plus pr√®s ce qui se passe ici. </font></font><br></p><br><br><a name="packing-rpmlint"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qu'est-ce que rpmlint </font></font></h3><br><p>     Rosa Linux  <code>rpmbuild</code>   <code>rpmlint</code> ,    .  <code>rpmlint</code>    ,   ,      .   ,     Rosa Linux (  ,     <code>rpmlint</code> )     . <br></p><br><p>     ,     ,      .       <code>~/rpmbuild/RPMS/_/</code>         <code>rpmlint -i __</code> . <br></p><br><p> ,      RPM   - ,  ,    ,  ,      Rosa Linux,      <code>rpmlint -i __</code> . <br></p><br><br><a name="packing-package_types"></a><br><h3>   RPM  Rosa Linux </h3><br><p>   Rosa Linux   6 .   ,          . <br></p><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paquet ex√©cutable</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il est binaire. Il ne contient qu'un fichier ou script binaire destin√© directement √† l'ex√©cution. Les fichiers de ces packages sont le plus souvent install√©s dans un dossier </font></font><code>/bin/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou dans </font></font><code>/usr/bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Peut √©galement contenir des liens - pour la possibilit√© d'appeler le programme en utilisant plusieurs noms diff√©rents. Le nom du package correspond au nom du programme. Ces packages d√©pendent souvent de la biblioth√®que. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioth√®que</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Contient des fichiers compil√©s de </font><b><font style="vertical-align: inherit;">biblioth√®ques</font></b><font style="vertical-align: inherit;"> connect√©es dynamiquement ("partag√©es", "partag√©es") utilis√©es par les programmes. Il s'agit g√©n√©ralement du fichier de biblioth√®que lui-m√™me, dont le nom se termine par la version, et d'un lien vers ce fichier, dont le nom se termine par le premier num√©ro de version. Par exemple, pour une biblioth√®que </font></font><code>libxkbfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version 1.0.2, ce sera un fichier </font></font><code>libxkbfile.so.1.0.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et un lien vers celui-ci,</font></font><code>libxkbfile.so.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le nom m√™me du package de biblioth√®que, par lequel il est reconnu dans le r√©f√©rentiel du programme d'installation, se termine par le premier num√©ro de version et commence par le pr√©fixe </font></font><code>lib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La biblioth√®que a le </font></font><code>libxkbfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom correct - </font></font><code>libxkbfile1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela est d√ª au fait que le premier num√©ro de version ne change g√©n√©ralement qu'avec des modifications de biblioth√®que incompatibles, et il sera donc possible d'installer plusieurs packages avec une biblioth√®que de versions diff√©rentes si certains programmes utilisent l'ancienne version de la biblioth√®que et d'autres utilisent une version plus r√©cente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Package pour d√©veloppeurs</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fichiers n√©cessaires √† la compilation de programmes utilisant la biblioth√®que, mais inutiles pour le travail de programmes pr√™ts √† l'emploi. Pour les programmes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simples </font><font style="vertical-align: inherit;">, il s'agit d'un lien vers le fichier de biblioth√®que, mais sans versions dans le nom (par exemple,</font></font><code>libxkbfile.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ainsi que les fichiers d'en-t√™te (avec l'extension </font></font><code>.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Nom du package se </font><font style="vertical-align: inherit;">termine par </font></font><code>-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, par exemple: </font></font><code>libxkbfile-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lors de l'installation, cela d√©pend toujours de la biblioth√®que appropri√©e. Par exemple, le package </font></font><code>libxkbfile-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©pend </font></font><code>libxkbfile1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les r√©f√©rentiels Rosa Linux ont des packages RPM contenant le code source de certains programmes - principalement ceux qui ont </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment besoin d'√™tre</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reconstruits. Les noms de ces packages se terminent par </font></font><code>-src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>-source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(par exemple, </font></font><code>apache-source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><code>rpmbuild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©e toujours un tel package automatiquement et le place </font></font><code>~/rpmbuild/SRPMS/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symboles de d√©bogage</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit d'informations qui peuvent √™tre utilis√©es pour d√©boguer un programme termin√©. </font><font style="vertical-align: inherit;">Il associe les emplacements des fichiers compil√©s au code source. </font><font style="vertical-align: inherit;">Ces packages sont </font></font><code>rpmbuild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatiquement </font><font style="vertical-align: inherit;">cr√©√©s par l'√©quipe </font><font style="vertical-align: inherit;">, une fin est attribu√©e √† leur nom </font></font><code>-debuginfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je n'ai pas trouv√© de tels packages dans les r√©f√©rentiels Rosa Linux. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les r√©f√©rentiels Rosa Linux ont des packages de documentation pour divers programmes et biblioth√®ques. </font><font style="vertical-align: inherit;">Je (pour l'instant) ne connais pas les caract√©ristiques de la construction de tels packages. </font><font style="vertical-align: inherit;">Leurs noms se </font><font style="vertical-align: inherit;">terminent g√©n√©ralement par </font></font><code>doc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: par exemple </font></font><code>libx11-doc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>java-1.7.0-openjdk-javadoc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Soit dit en passant, presque tous sont cr√©√©s dans le style de sites Web, et pour les afficher, il est pr√©f√©rable d'ouvrir un navigateur, d'aller √† l'adresse </font></font><code>file:///usr/share/doc/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de s√©lectionner le dossier et le fichier souhait√©s.</font></font><br><br><br><br><a name="packing-result"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Notre r√©sultat </font></font></h3><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, tout est devenu plus clair. </font></font><br></p><br><br><ul><li>    <code>xkb-switch</code>   <code>libxkbswitch.so</code> , ,  ,    <em>  </em> .   ,          : <code>xkb-switch.i586: W: devel-file-in-non-devel-package /usr/lib/libxkbswitch.so</code> . <br></li><li>     <em></em> ,      <code>/usr/lib/libxkbswitch.so.1</code>  <code>/usr/lib/libxkbswitch.so.1.6.0</code> .       ,       .  : <code>xkb-switch.i586: E: executable-in-library-package (Badness: 1) /usr/bin/xkb-switch</code> . <br></li><li>    ,          (1).   : <code>xkb-switch.i586: E: incoherent-version-in-name (Badness: 50) 1</code> . <br></li></ul><br><br><p> ,  <code>rpmlint</code> ,     .          .   <em>xkb-switch</em> ,      <code>libxkbswitch.so.1.6.0</code>       ,        <em>Vim</em> .            <em>xkb-switch</em> ,          <em>C</em>  <em>C++</em> .  RPM-    . <br></p><br><p>       -: <br></p><br><br><div class="spoiler"> <b class="spoiler_title">-   xkb-switch</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Summary: Query and change XKB layout state Name: xkb-switch Version: 1.6.0 Release: 1 License: GPLv3+ Group: Development/X11 URL: https://github.com/ierton/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor via 'libxkbswitch.so'. It is mainly used by a plugin for Vim text editor, vim-xkbswitch. Originally ruby-based code written by J.Broomley. %files %{_bindir}/%{name} %{_libdir}/libxkbswitch.so %{_libdir}/libxkbswitch.so.1 %{_libdir}/libxkbswitch.so.%{version} %{_mandir}/man1/%{name}.1.xz #------------------------------------------------------------------ %prep %setup -q -n xkb-switch-master %build %cmake %make %install %makeinstall_std -C build</code> </pre><br></div></div><br><br><a name="subpackaging"></a><br><h2>       </h2><br><p>        ‚Äî ,         .    ,  ,       <code>xkb-switch</code>  3 : <em></em> , <em></em>   <em></em> . : <br></p><br><br><ul><li>  <em></em>     <code>/usr/bin/xkb-switch</code>    <code>/usr/share/man/man1/xkb-switch.1.xz</code> , <br></li><li>  <em></em> ‚Äî  <code>/usr/lib/libxkbswitch.so.1</code>  <code>/usr/lib/libxkbswitch.so.1.6.0</code> , <br></li><li>    <em> </em> ‚Äî <code>/usr/lib/libxkbswitch.so</code> . <br></li></ul><br><br><p>       -.  ,   , <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  - Maximum RPM</a> .     <a href=""> -  libxkbfile</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   Rosa Linux</a> . <br></p><br><p>    . <br></p><br><br><a name="subpackaging-macros"></a><br><h3>    </h3><br><p>        ‚Äî   <a href="">-  libxkbfile</a> .     -  : <br></p><br><br><pre> <code class="plaintext hljs">%define major 1 %define libname %mklibname xkbswitch %{major} %define develname %mklibname -d xkbswitch</code> </pre><br><br><p>    <code>%define</code>  .        ,    (     ) ‚Äî   ,       .     ,    <code>%{major}</code>   <code>1</code> ,      . <br></p><br><p>  <code>%mklibname</code>   ¬´lib¬ª,     ,      ‚Äî   (  ).     <code>%{libname}</code>  <em>¬´lib¬ª + ¬´xkbswitch¬ª + (  %{major}) =</em> <code>libxkbswitch1</code> ‚Äî   . <br></p><br><p>  <code>-d</code>  <code>%mklibname</code>   <code>-devel</code> .    <code>%{develname}</code>  <code>libxkbswitch-devel</code> ‚Äî    . <br></p><br><br><a name="subpackaging-change_header"></a><br><h3>    </h3><br><p>     <code>Version:</code>   <br></p><br><br><pre> <code class="plaintext hljs">Version: %{major}.6.0</code> </pre><br><br><p>  ,           -. <br></p><br><p>      -       .      .      : <br></p><br><pre> <code class="plaintext hljs">Name: xkb-switch Version: %{major}.6.0 Release: 1 Summary: Query and change XKB layout state License: GPLv3+ Group: Development/X11 URL: https://github.com/alexandersolovyov/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor, a library 'libxkbswitch'. It is mainly used for some plugins for Vim text editor, such as vim-xkbswitch. Originally ruby-based code written by J.Broomley.</code> </pre><br><br><a name="subpackaging-packages"></a><br><h3>    </h3><br><p>     <em>-</em>     . <em>-</em>   , -      (    <em>rpm</em> ).       <code>%package</code> .        -.     ,    -.          <code>Version</code> , <code>Summary</code> , <code>Group</code> .      <code>Provides</code>  <code>Requires</code>   <em></em>  <em></em> ,     .  <code>Name</code>   :    ,     <code>%package</code> . <br></p><br><p>      .     <code>%description</code>       ‚Äî   ,     <code>%package</code> . <br></p><br><p>  Rosa Linux   -   <code>%description</code>  -.    <code>libxkbswitch1</code> : <br></p><br><pre> <code class="plaintext hljs">%package -n %{libname} Version: %{version} Summary: A library for xkb-switch tool, provides API bindings for Vim text editor Group: Development/X11 %description -n %{libname} libxkbswitch library, required by xkb-switch tool. It provides bindings for API of the Vim text editor, which can be used via 'libxkbswitch.so.1'.</code> </pre><br><br><p>  <code>-n</code>    <code>%package</code>  <code>%description</code> ,       .    -        ,    <code>xkb-switch-libxkbswitch1</code> .       <code>libxkbswitch1</code> .           . <br></p><br><p>    <em> </em> : <br></p><br><pre> <code class="plaintext hljs">%package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 %description -n %{develname} Development files for libxkbswitch. Provides bindings for API of the Vim text editor via 'libxkbswitch.so'.</code> </pre><br><br><a name="subpackaging-files"></a><br><h3>     </h3><br><p>   ,      .     <code>%files</code> . <br></p><br><p>      ,     ,    <code>%package</code> , <code>%description</code>  <code>%files</code> .  ,    <code>%description</code>  -    .   ,      ,    ‚Äî <code>xkb-switch</code> . <br></p><br><p>  -  Rosa Linux     <code>%files</code>   ,    <code>%prep</code> .       : <br></p><br><pre> <code class="plaintext hljs">%files %{_bindir}/%{name} %{_mandir}/%{name}.1.xz %files -n %{libname} %{_libdir}/libxkbswitch.so.%{major} %{_libdir}/libxkbswitch.so.%{version} %files -n %{develname} %{_libdir}/libxkbswitch.so</code> </pre><br><br><p>    , : <br></p><br><br><ul><li>   <code>xkb-switch</code>   <code>~/usr/bin/xkb-switch</code>  <code>~/usr/share/man/man1/xkb-switch.1</code> , <br></li><li>   <code>libxkbswitch1</code>   <code>~/usr/lib/libxkbswitch.so.1</code>  <code>~/usr/lib/libxkbswitch.so.1.6.0</code> , <br></li><li>    <code>libxkbswitch-devel</code>   <code>~/usr/lib/libxkbswitch.so</code> . <br></li></ul><br><br><p>       <code>cleanup.sh</code>       <code>rpmbuild -ba ~/rpmbuild/SPECS/xkb-switch.spec</code> .    3 : <br></p><br><br><pre> <code class="plaintext hljs">libxkbswitch1.i586: W: no-documentation libxkbswitch-devel.i586: W: no-documentation libxkbswitch-devel.i586: W: no-dependency-on libxkbswitch/libxkbswitch-libs/liblibxkbswitch</code> </pre><br><br><p>   ,       .   ,     .     .  Essayons de le comprendre. <br></p><br><br><a name="subpackaging-problems"></a><br><h3>    </h3><br><p> ,      ,  ,        <code>README.md</code> .     <code>%files</code>      ‚Äî    <code>%doc</code> : <br></p><br><br><pre> <code class="plaintext hljs">%doc README.md</code> </pre><br><br><p>      .    <code>%doc</code> ‚Äî    .        <code>~/rpmbuild/BUILD/xkb-switdh-master/README.md</code> . <br></p><br><p>       : <code>libxkbswitch-devel.i586: W: no-dependency-on libxkbswitch/libxkbswitch-libs/liblibxkbswitch</code> .  ,    <code>libxkbswitch-devel</code>    <code>libxkbswitch</code>  . <br></p><br><p>    <code>rpm -qp  --</code>       .            : <br></p><br><pre> <code class="bash hljs">[user@pc ~] $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/RPMS/i586/ [user@pc ~/rpmbuild/RPMS/i586] $ ls libxkbswitch1-1.6.0-1-rosa2014.1.i586.rpm xkb-switch-1.6.0-1-rosa2014.1.i586.rpm libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm xkb-switch-debuginfo-1.6.0-1-rosa2014.1.i586.rpm [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --provides libxkbswitch1-1.6.0-1-rosa2014.1.i586.rpm libxkbswitch.so.1 libxkbswitch1 = 1.6.0-1:2014.1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --provides libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm devel(libxkbswitch) libxkbswitch-devel = 1.6.0-1:2014.1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --requires libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm devel(libX11) devel(libgcc_s) devel(libstdc++) devel(libxkbfile) rpmlib(PayloadIsXz) &lt;= 5.2-1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --requires xkb-switch-1.6.0-1-rosa2014.1.i586.rpm libc.so.6 libc.so.6(GLIBC_2.0) libc.so.6(GLIBC_2.1.3) libgcc_s.so.1 libgcc_s.so.1(GCC_3.0) libstdc++.so.6 libstdc++.so.6(CXXABI_1.3) libstdc++.so.6(GLIBCXX_3.4) libstdc++.so.6(GLIBCXX_3.4.11) libstdc++.so.6(GLIBCXX_3.4.20) libstdc++.so.6(GLIBCXX_3.4.9) libxkbswitch.so.1 rpmlib(PayloadIsXz) &lt;= 5.2-1</code> </pre><br><br><p>  ,    <code>libxkbswitch1</code>   <code>libxkbswitch.so.1</code>  <code>libxkbswitch1</code> .  <code>xkb-switch</code>   <code>libxkbswitch.so.1</code> ,     <code>libxkbswitch-devel</code>    <code>libxkbswitch1</code> .   ,     <code>%package</code>  <code>libxkbswitch-devel</code> .      : <br></p><br><br><pre> <code class="plaintext hljs">%package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 Requires: %{libname} &gt;= %{version}</code> </pre><br><br><p>        , ‚Ä¶       .     <code>libxkbswitch-devel</code>  ,  ,    .     ,         ,  <code>rpmbuild</code>      . <br></p><br><p> -,     (  <code>README.md</code>    ), ‚Äî  : <br></p><br><br><div class="spoiler"> <b class="spoiler_title">-    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">%define major 1 %define libname %mklibname xkbswitch %{major} %define develname %mklibname -d xkbswitch # Main package. Automaticaly requires libxkbswitch and libxkbswitch-devel Name: xkb-switch Version: %{major}.6.0 Release: 1 Summary: Query and change XKB layout state License: GPLv3+ Group: Development/X11 URL: https://github.com/alexandersolovyov/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor, a library 'libxkbswitch'. It is mainly used for some plugins for Vim text editor, such as vim-xkbswitch. Originally ruby-based code written by J.Broomley. # libxkbswitch %package -n %{libname} Version: %{version} Summary: A library for xkb-switch tool, provides API bindings for Vim text editor Group: Development/X11 %description -n %{libname} libxkbswitch library, required by xkb-switch tool. It provides bindings for API of the Vim text editor, which can be used via 'libxkbswitch.so.1'. # libxkbswitch-devel %package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 Requires: %{libname} &gt;= %{version} %description -n %{develname} Development files for libxkbswitch. Provides bindings for API of the Vim text editor via 'libxkbswitch.so'. # xkb-switch %files %{_bindir}/%{name} %{_mandir}/man1/%{name}.1.xz # libxkbswitch1 %files -n %{libname} %{_libdir}/libxkbswitch.so.%{major} %{_libdir}/libxkbswitch.so.%{version} %doc README.md # libxkbswitch-devel %files -n %{develname} %{_libdir}/libxkbswitch.so %doc README.md #------------------------------------------------------------------ %prep %setup -q -n xkb-switch-master %build %cmake %make %install %makeinstall_std -C build</code> </pre><br></div></div><br><br><a name="summary"></a><br><h2>  Conclusion </h2><br><p>  ,      RPM    <em>Rosa Linux</em> (       ).       ,   -. ,       ‚Äî ,   ,   <em>rpmrc</em> ,      <em>ABF</em>   , ‚Äî         . <br></p><br><p>        ‚Äî    ,      -,         - , ‚Äî     . <br></p><br><br><a name="commands"></a><br><h2>   </h2><br><br><a name="commands-build"></a><br><h3>     </h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bp specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ex√©cuter la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©paration</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (% prep). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bc specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compilation</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (build%) et toutes les </font><font style="vertical-align: inherit;">actions pr√©c√©dentes. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bi specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effectue une </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pseudo-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> installation (% install) et toutes les √©tapes pr√©c√©dentes. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -ba specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> G√©n√©rez des packages compl√®tement.</font></font><br><br><br><br><a name="commands-package"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√©rification du colis fini </font></font></h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmlint -i package_file_name.rpm V√©rification</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> g√©n√©rale - dans quelle mesure le package a √©t√© construit. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qp --provides package_filename.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√©rifiez quelles "fonctionnalit√©s" sont fournies par le package. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qp --requires package_filename.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√©rifiez les "capacit√©s" des autres packages dont d√©pend ce package. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qpl package_file_name.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Liste des fichiers contenus dans le package. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qpi nom-fichier-package.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Informations sur le package (√† partir de "l'en-t√™te" du fichier de sp√©cifications ou du bloc </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% package</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><br><br><p>          ,    <code>p</code> .    ,     Rosa Linux,   .     <code>urpmq</code> ,   <code>rpm -q</code> . , <code>urpmq -l _</code>    ,  <code>urpmq --requires _</code>   . <br></p><br><br><a name="links"></a><br><h2>   ( ) </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Building RPMs ‚Äî Quick Start</a> ‚Äî         RPM  Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> RPM</a> ‚Äî    ,   ,       .   . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RPM:  spec </a> ‚Äî    -  Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maximum RPM</a> ‚Äî        <code>rpm</code>   RPM-  RedHat Linux.         ,      Rosa Linux.    . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Template Spec Files</a> ‚Äî   <code>.spec</code> .  ,      -. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Automatic Build Farm (ABF)</a> ‚Äî      Rosa Linux.             ,   ,     ,    <code>.spec</code> .     -. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rpmlint Errors</a> ‚Äî    ,   <code>rpmlint</code> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Packaging Group</a> ‚Äî    Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   Rosa Linux</a> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Git ‚Äî </a> ‚Äî      <em>Git</em> . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464993/">https://habr.com/ru/post/fr464993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464981/index.html">Google fournit des arguments pour justifier le suivi des utilisateurs - l'entreprise est accus√©e de manque de sinc√©rit√© et de manipulation</a></li>
<li><a href="../fr464985/index.html">L'Internet des objets (IoT) va changer le monde. L'avenir de l'IoT</a></li>
<li><a href="../fr464987/index.html">D√©p√¥ts √† Kubernetes: OpenEBS vs Rook (Ceph) vs Rancher Longhorn vs StorageOS vs Robin vs Portworx vs Linstor</a></li>
<li><a href="../fr464989/index.html">Contexte de l'extravagance</a></li>
<li><a href="../fr464991/index.html">Des projets qui n'ont pas d√©coll√©</a></li>
<li><a href="../fr464995/index.html">Envelopper des s√©quences dans Swift</a></li>
<li><a href="../fr464997/index.html">√Ä propos du d√©veloppement des technologies VR: o√π les utilisent-elles, pourquoi les entreprises VR et quels appareils utilisent</a></li>
<li><a href="../fr464999/index.html">Comment les sp√©cificit√©s du travail avec les serveurs d'applications changent √† l'aide de l'exemple OpenLiberty</a></li>
<li><a href="../fr465001/index.html">Amazon Prime Day 2019 - Propuls√© par AWS</a></li>
<li><a href="../fr465003/index.html">Int√©r√™ts pour le genre ARPG</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>