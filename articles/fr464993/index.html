<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍❤️‍👩 💡 🧒🏿 Construire un package RPM pour Rosa Linux en pratique 🌃 🕷️ 🏪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous utilisez le système d'exploitation Linux depuis longtemps et connaissez même un peu la programmation, vous devrez peut-être tôt ou tard compil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construire un package RPM pour Rosa Linux en pratique</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464993/"><p>  Si vous utilisez le système d'exploitation Linux depuis longtemps et connaissez même un peu la programmation, vous devrez peut-être tôt ou tard compiler le programme à partir du code source.  Peut-être que le programme souhaité ne sera pas dans les référentiels de distribution.  Ou le programme a une ancienne version dans ces référentiels, et vous avez besoin de la dernière.  Ou peut-être que vous avez créé un nouveau programme et que vous souhaitez le partager avec d'autres utilisateurs. <br></p><br><p>  Bien sûr, vous pouvez installer le programme selon les instructions fournies avec le code source.  Mais vous devrez ensuite gérer manuellement les fichiers du programme et surveiller ses dépendances.  Il est préférable de créer un package avec le programme et d'utiliser le gestionnaire d'applications intégré au système d'exploitation. <br></p><br><p>  J'espère que cet article vous aidera à comprendre rapidement comment créer un package RPM pour <em>Rosa Linux</em> ou une autre distribution qui utilise le gestionnaire de packages RPM (Mandriva, RedHat).  Ou du moins, dites-moi où chercher des informations. <br></p><br><p>  Ici, je vais montrer comment créer des packages RPM sur mon ordinateur local, en utilisant un exemple simple.  Nous allons construire le programme <em>xkb-switch</em> dans le <em>système d'</em> exploitation <em>Rosa Linux</em> .  Nous prendrons le code source du programme de <em>GitHub</em> . <br></p><br><br><a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">L'article est divisé en plusieurs parties courtes, donc la table des matières est sous le spoiler</b> <div class="spoiler_text"><h2>  Table des matières </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un peu sur Rosa Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un peu sur xkb-switch</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise en place, finalisation, vérification du programme</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vérifier le code source sans votre profil sur GitHub</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vérification avec enregistrement du projet dans votre profil GitHub</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Création de correctifs</a> </li></ul><br></li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Préparer le "lieu de travail" pour créer un package</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commençons par créer un fichier de spécifications</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un peu sur la syntaxe du fichier spec</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En-tête de fichier de spécifications</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Préparation de la source</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Compilation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'installation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Emballage de fichiers</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qu'est-ce que rpmlint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Types de packages RPM pour Rosa Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Notre résultat</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Si vous devez diviser le colis en plusieurs parties</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ajouter des macros</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Changez un peu le titre</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Définir des packages de bibliothèque</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Définir des fichiers pour les packages</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Résolution de problèmes supplémentaires</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Équipes principales</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commandes utiles pour construire un package</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vérification du colis fini</a> </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liens utiles (sources principales)</a> </li></ul><br></div></div><br><br><a name="foreword"></a><br><h2>  Un peu sur Rosa Linux </h2><br><p>  <em>Rosa Linux</em> est une distribution créée et supportée par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des développeurs russes</a> .  Il est basé sur <em>Mandriva</em> , mais avec quelques fonctionnalités.  J'utilise la version 32 bits de <em>Rosa Fresh R8</em> , sortie en 2014.  Maintenant, la version <em>R8</em> n'est plus prise en charge par les développeurs (les référentiels ne sont pas mis à jour), mais cela fonctionne bien sur mon ordinateur portable, donc je ne veux pas installer une nouvelle version. <br></p><br><p> <em>Rosa Fresh R8</em> Utilise le bureau <em>KDE4</em> .  Toutes les versions du package de distribution utilisent les gestionnaires <code>rpm</code> et <code>urpm</code> pour gérer les packages avec les applications, et les commandes correspondantes sont <code>rpm</code> , <code>urpmi</code> , <code>urpme</code> , <code>urpmq</code> , <code>urpmf</code> . <br></p><br><p>  Les principes de construction de progiciels sont généralement rarement modifiés au sein de la même famille de distribution Linux.  Par conséquent, ce qui est décrit dans cet article devrait fonctionner dans toutes les versions des distributions <em>Rosa</em> . <br></p><br><p>  La construction de packages sur Rosa Linux est un peu plus simple que sur certaines autres distributions basées sur <em>RPM</em> .  Certains points sont automatisés et n'ont pas besoin d'être configurés. <br></p><br><br><a name="foreword-xkb-switch"></a><br><h2>  Un peu sur xkb-switch </h2><br><p>  J'ai aimé l'idée d'utiliser le plugin pour l'éditeur de texte Vim - <em>xkbswitch</em> , sur lequel il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article sur Habré</a> .  Il bascule automatiquement la disposition du clavier en anglais lorsque vous quittez le mode de saisie, et vice versa - à celui sur lequel le texte a été entré la dernière fois - si vous entrez à nouveau dans le mode de saisie.  Pour que ce plugin fonctionne, vous avez besoin du programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xkb-switch</a> , qui vous permet de changer la disposition du clavier à partir de la ligne de commande et des plugins pour l'éditeur <em>Vim</em> .  Ce programme n'était pas dans les référentiels <em>Rosa Linux R8</em> (et probablement personne ne l'ajoutera, car la distribution est déjà ancienne et le programme <em>xkb-switch n'est</em> pas très populaire). <br></p><br><br><a name="test_program"></a><br><h2>  Mise en place, finalisation, vérification du programme </h2><br><p>  Il est souvent nécessaire de configurer la compilation du programme pour qu'elle fonctionne correctement dans une distribution particulière ou même pour un système spécifique.  Il arrive qu'un programme doive être construit avec d'autres options ou avec le support d'un pilote spécial.  Ou peut-être voulez-vous corriger des erreurs dans le code du programme ou simplement vérifier si cela fonctionne.  Pour ce faire, il est préférable de copier le code source sur votre ordinateur avant de créer le package RPM, essayez de le compiler et vérifiez le fonctionnement du programme compilé. <br></p><br><p>  Si vous êtes sûr que vous n'aurez pas besoin de modifier les fichiers du projet, vous pouvez utiliser le code source d'origine sur le site Web du projet et procéder immédiatement à la création du package.  Mais si vous devez modifier les paramètres de compilation, il est généralement beaucoup plus facile de modifier le fichier dans le dossier source (le soi-disant <em>makefile</em> ) que de traiter ensuite les options pour les commandes de compilation et le périphérique macro interne pour le fichier de spécifications. <br></p><br><br><a name="test_program-local"></a><br><h3>  Vérifier le code source sans votre profil sur GitHub </h3><br><p>  Si vous décidez de travailler avec le code source ou les paramètres de compilation du projet, mais que vous n'avez pas votre propre profil sur GitHub ou que vous ne souhaitez pas l'utiliser, vous pouvez simplement télécharger et décompresser le code source.  Dans notre cas, cela pourrait ressembler à ceci (j'utilise le dossier <code>~/Projects/cpp</code> pour le code source <em>C ++</em> ): <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ierton/xkb-switch.git</code> </pre><br><br><p>  Cela créera le dossier <code>~/Projects/cpp/xkb-switch</code> contenant le code source.  Bien sûr, au lieu d'utiliser <code>git</code> vous pouvez télécharger l'archive avec le programme et décompressez-la. <br></p><br><p>  À partir du fichier <code>README.md</code> dans le dossier du projet, il est facile de deviner que l'utilitaire <code>cmake</code> est utilisé pour créer le programme.  Par conséquent, si vous devez modifier les paramètres de compilation, dans notre cas, ils se trouvent dans le fichier <code>CMakeLists.txt</code> .  Et nous essayons simplement de compiler le programme et de vérifier s'il fonctionne.  Les commandes que vous devez utiliser pour cela sont écrites dans le même fichier <code>README.md</code> à la racine du projet. <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> xkb-switch mkdir build &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake .. make ./xkb-switch <span class="hljs-comment"><span class="hljs-comment">#         ./xkb-switch -l #       ./xkb-switch -s ru #       (  )</span></span></code> </pre><br><br><p>  Après cela, pour utiliser le projet modifié, vous devrez effacer ou supprimer le dossier de construction du projet et emballer le code source dans l'archive.  Cela pourrait ressembler à ceci: <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp/xkb-switch rm -rf ./build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp zip -r xkb-switch.zip xkb-switch</code> </pre><br><br><p>  Le fichier <code>xkb-switch.zip</code> ensuite être utilisé pour construire le package. <br></p><br><br><a name="test_program-github"></a><br><h3>  Vérification avec enregistrement du projet dans votre profil GitHub </h3><br><p>  Je suppose que quiconque lit cette section est au moins un peu familier avec <em>Git</em> et a déjà configuré un profil sur <em>GitHub</em> .  Je pense que cette méthode est la meilleure, donc le reste de l'article impliquera qu'elle est utilisée, sauf indication contraire. <br></p><br><p>  Vous devez d'abord bifurquer le projet d'origine dans votre <em>GitHub</em> .  Après cela, comme dans la méthode précédente, nous clonons le projet sur notre ordinateur, mais à partir de notre référentiel (dans mon cas, le nom d'utilisateur est <em>alexandersolovyov</em> ): <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/alexandersolovyov/xkb-switch.git</code> </pre><br><br><p>  Pour ajouter des modifications, il est préférable d'utiliser une nouvelle branche.  Ensuite, si vous le souhaitez, il sera possible d'utiliser différentes versions du programme.  Et il sera également possible de proposer des modifications à l'auteur du projet à l'aide de pull-requests.  Par exemple, si vous décidez de corriger un peu le fichier <code>CMakeLists.txt</code> , avant cela, vous devez créer une nouvelle branche avec: <br></p><br><br><pre> <code class="bash hljs">git branch cmake_corrections</code> </pre><br><br><p>  Une fois les modifications effectuées, vérifiées et ajoutées à la branche (en utilisant <code>git commit -am " "</code> ), vous pouvez ajouter une nouvelle branche à votre GitHub: <br></p><br><br><pre> <code class="bash hljs">git push origin cmake_corrections</code> </pre><br><br><p>  Après cela, vous pouvez faire une pull-request, si nécessaire. <br></p><br><p>  Vous pouvez créer un lien vers le référentiel d'origine: <br></p><br><br><pre> <code class="bash hljs">git remote add ierton https://github.com/ierton/xkb-switch.git</code> </pre><br><br><p>  Et puis mettez à jour la branche principale de votre référentiel afin qu'elle corresponde à l'original: <br></p><br><br><pre> <code class="bash hljs">git pull ierton master</code> </pre><br><br><p>  Le code de programme correspondant à la branche corrigée peut être utilisé lors de la construction du RPM.  Pour ce faire, vous devrez spécifier l'adresse de l'archive sous la forme dans le fichier spec: <br></p><br><br><pre> <code class="plaintext hljs">Source0: https://github.com/-/-/archive/---.zip</code> </pre><br><br><p>  Mais, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme l'a demandé l'utilisateur de specblog</a> , ce n'est en fait pas le cas.  Il est préférable de transmettre vos modifications sous forme de correctifs.  Pour ce faire, vous devez créer des fichiers de correctif à partir des modifications de votre branche et les copier dans le dossier source pour créer le package ( <code>~/rpmbuild/SOURCES/</code> ).  Vous devrez ensuite les spécifier dans le fichier de spécifications.  Nous y réfléchirons un peu plus tard, mais si vous le souhaitez, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez le lire ici</a> .  Si vous ne savez pas comment créer des patchs, vous pouvez regarder sous le spoiler. <br></p><br><br><a name="test_program-github-patches"></a><br><div class="spoiler">  <b class="spoiler_title">Comment créer des correctifs à l'aide de git</b> <div class="spoiler_text"><h4>  Création de correctifs </h4><br><p>  <em>Les correctifs</em> , ce sont des <em>correctifs</em> - ce sont des fichiers dans lesquels les modifications sont enregistrées dans le code source du programme.  Ils sont utilisés comme alternative aux commandes <code>git pull</code> et <code>git push</code> pour la communication entre les référentiels de code locaux s'il n'est pas pratique de «tirer» les modifications d'un référentiel distant, ou si l'historique des modifications du projet et les principes de travail avec lui sont tels qu'il est préférable d'utiliser des correctifs. <br></p><br><br><p>  Imaginons que nous devons apporter des modifications au fichier <code>CMakeLists.txt</code> .  Tout d'abord, vous devez tout faire comme décrit ci-dessus: la branche principale de notre référentiel GitHub doit correspondre à la branche principale du projet d'origine, et pour vos modifications, vous devez utiliser la branche <em>cmake_corrections</em> .  Ensuite, vous devez aller dans cette branche, apporter les modifications nécessaires et les enregistrer dans <em>git à l'</em> aide de commits. <br></p><br><p>  Vous devez maintenant enregistrer les modifications sous forme de fichiers correctifs dans le dossier <code>~/rpmbuild/SOURCES</code> (si vous n'utilisez pas Rosa Linux, le chemin d'accès au dossier <code>SOURCES</code> peut être différent).  Par exemple, ceci (je veux dire que nous sommes dans le dossier du projet - par exemple, <code>~/Projects/cpp/xkb-switch</code> - et sur la branche <code>cmake_corrections</code> ): <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES origin/master</code> </pre><br><p>  La commande <code>git format-patch</code> crée un fichier de <code>git format-patch</code> pour chaque commit.  Sous cette forme, il effectuera des correctifs à partir de la validation spécifiée par le dernier argument et se terminant par la dernière validation de la branche actuelle.  Vous pouvez spécifier un commit de n'importe quelle manière: au début du hachage, en utilisant le pointeur <em>HEAD</em> ou le nom de la branche, qui indique maintenant le commit souhaité.  L'essentiel est que l'un des commits visibles lorsque <code>git log</code> exécuté est pris comme début.  Autrement dit, vous ne pouvez pas commencer à créer des correctifs à partir d'une validation qui se trouve dans une autre branche. <br></p><br><p>  Et vous pouvez vous rappeler (ou voir) combien de validations nous avons ramifiées à partir de la branche principale, et faire des correctifs pour un certain nombre de validations.  Par exemple, si nous avons fait deux commits, la commande serait: <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES -2</code> </pre><br><p>  Ici, le nombre de validations est défini à l'aide de <code>-2</code> .  Vous pouvez en spécifier n'importe quel nombre au lieu de cette figure. <br></p><br><p>  Vous pouvez spécifier la plage de validations à partir de laquelle les correctifs doivent être effectués en plaçant deux points entre les liens vers les validations initiales et finales: <br></p><br><pre> <code class="bash hljs">git format-patch -o ~/rpmbuild/SOURCES master..cmake_corrections</code> </pre><br><p>  Le nom de chaque fichier de correctif se compose d'un numéro de série et de la première ligne d'un commentaire de validation.  Par conséquent, il est préférable de renommer chaque fichier afin que la description du correctif décrive plus brièvement et clairement son essence.  Par exemple, comme ceci: <br></p><br><pre> <code class="bash hljs">mv 0001-Return-memory-allocated-by-XkbRf-getNamesProp()-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-tmp.patch 001-Fix-memory-leak.patch</code> </pre><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la convention de dénomination des correctifs dans l'article sur la syntaxe du fichier spec</a> recommande d'ajouter <em>package_name-version-rosa-</em> avant la description de chaque fichier patch.  C'est peut-être une bonne pratique si vous envoyez des correctifs par e-mail, mais pas pour la construction de packages.  Nous créons des packages sur notre ordinateur, il est donc préférable de vider le dossier <code>~/rpmbuild/SOURCES</code> chaque fois avant de <code>~/rpmbuild/SOURCES</code> package avec un autre programme ou un nouveau package de version. <br></p><br><p>  Maintenant, si vous devez mettre à jour la branche du référentiel principal ( <em>maître</em> ) pour qu'elle corresponde à l'original, alors la branche de changement ( <em>cmake_corrections</em> ) devra être mise à jour à l'aide de la <code>git rebase</code> .  Vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pouvez voir</a> comment procéder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Après cela, les correctifs devront être recréés. <br></p><br></div></div><br><br><a name="prepare"></a><br><h2>  Préparer le "lieu de travail" pour créer un package </h2><br><p>  Vous devez d'abord créer une structure de répertoires.  Tout l'assemblage a lieu dans le dossier <code>rpmbuild</code> dossier de départ de l' <code>rpmbuild</code> .  Créez la structure de répertoires initiale et accédez au dossier des fichiers de spécifications: <br></p><br><br><pre> <code class="bash hljs">mkdir -p ~/rpmbuild/SPECS &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/SPECS</code> </pre><br><br><p>  Pour Rosa Linux, cela suffit: les dossiers restants seront créés automatiquement. <br></p><br><p>  Une autre distribution peut utiliser un emplacement de fichier différent pour créer le package.  Et vous devrez peut-être créer manuellement la hiérarchie complète des dossiers.  Recherchez des informations pour votre distribution si vous n'utilisez pas Rosa Linux.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela pourrait ressembler à ceci dans Red Hat</a> . <br></p><br><p>  Si le package a été <code>rpmbuild</code> avec des erreurs, tous les fichiers créés par la commande <code>rpmbuild</code> ne <code>rpmbuild</code> pas supprimés - comme pour une génération réussie.  Nous essaierons de récupérer le paquet plusieurs fois, et les fichiers restants après la dernière fois vont interférer.  Par conséquent, il est préférable de créer un script simple qui vous aidera à les supprimer rapidement.  Créez un fichier cleanup.sh et placez-le dans le <code>~/rpmbuild/SPECS</code> .  Voici son contenu: <br></p><br><br><pre> <code class="bash hljs">!<span class="hljs-comment"><span class="hljs-comment">#/bin/sh rm -rf ~/rpmbuild/BUILD/* rm -rf ~/rpmbuild/BUILDROOT/* rm -rf ~/rpmbuild/RPMS/* rm -rf ~/rpmbuild/SRPMS/*</span></span></code> </pre><br><br><p>  Bien sûr, il est préférable de lui ajouter des droits d'exécution à l'aide de la commande <code>chmod u+x cleanup.sh</code> . <br></p><br><p>  Si vous souhaitez collecter un package à partir de fichiers qui se trouvent sur l'ordinateur local - si vous n'utilisez pas <em>GitHub</em> et avez apporté des modifications aux fichiers de projet, ou si vous souhaitez créer un package à partir de votre propre programme qui est stocké uniquement sur votre ordinateur - vous devez compresser le projet dans une archive ( par exemple <code>.zip</code> , <code>.tar</code> ou <code>.tar.gz</code> ) et placez-le dans le dossier <code>SOURCES</code> .  Par exemple, comme ceci: <br></p><br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Projects/cpp/ zip -r xkb-switch.zip xkb-switch mkdir -p ~/rpmbuild/SOURCES cp xkb-switch.zip ~/rpmbuild/SOURCES/</code> </pre><br><br><p>  Si, après avoir construit le programme, vous souhaitez en créer une autre ou la même, mais une version différente, vous devrez supprimer tous les fichiers du dossier <code>~/rpmbuild/SOURCES</code> , puis copiez-y vos archives (si vous ne les téléchargez pas depuis <em>GitHub</em> ) et fichiers de correctifs (si utilisés).  Sinon, le fichier d'archive ne sera probablement pas téléchargé depuis <em>GitHub</em> (pourquoi - voir plus tard), et il sera également difficile de déterminer quel fichier de correctif appartient à quel programme. <br></p><br><br><a name="specfile_start"></a><br><h2>  Commençons par créer un fichier de spécifications </h2><br><p>  La base pour construire un package RPM est le soi-disant <em>fichier speck</em> .  Ce fichier contient les instructions du programme <code>rpmbuild</code> (ou plutôt <code>rpm</code> ) nécessaires à la construction du package. <br></p><br><p>  Créez le fichier <code>xkb-switch.spec</code> dans le dossier <code>~/rpmbuild/SPECS/</code> .  La façon la plus simple de commencer est d'utiliser un modèle disponible sur le site Web des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichiers de spécifications de modèle</a> . <br></p><br><p>  À partir du <code>README</code> sur la page du projet <em>xkb-switch</em> , il <em>est</em> connu que le programme est compilé à l'aide de l'utilitaire <code>cmake</code> .  Par conséquent, nous allons sélectionner le <strong>fichier de spécifications pour un programme créé à l'aide de CMake</strong> et copier le modèle entier dans notre fichier de spécifications.  Bien sûr, afin d'assembler correctement notre package RPM, ce modèle doit être beaucoup changé, ce que nous ferons. <br></p><br><br><a name="specfile_syntax"></a><br><h2>  Un peu sur la syntaxe du fichier spec </h2><br><ul><li>  La syntaxe du fichier de spécifications vous permet d'ajouter des commentaires de style bash. <br></li><li>  Vous pouvez utiliser des espaces comme espaces entre les valeurs sur la même ligne pour créer l'apparence de colonnes paires, mais la documentation recommande fortement d'utiliser le caractère de tabulation (un ou deux tant que les colonnes sont paires).  <strong>Remarque:</strong> dans tous les exemples de code de cet article, seuls les espaces sont utilisés, il est donc préférable de ne pas copier tout le texte d'ici dans votre fichier de spécifications, mais de l'imprimer vous-même. <br></li><li>  Les champs d'option se composent d'un nom d'option spécial avec deux points et la valeur suivante via des tabulations (ou des espaces).  La casse des caractères dans les noms de champ n'a pas d'importance.  Par exemple: <br><pre> <code class="plaintext hljs"> Name: xkb-switch</code> </pre><br></li><li>  Si le mot est précédé du symbole <code>%</code> (par exemple, <code>%description</code> ), il s'agit d'un mot-clé spécial.  Il peut s'agir d'une commande, d'une macro ou d'un appel de script.  Ensuite, les paramètres qu'il utilise peuvent être indiqués.  Et il y a des mots clés qui indiquent le début d'un bloc de commandes ou d'options.  Ensuite, les paramètres peuvent être indiqués à côté, et sur les lignes suivantes, il devrait y avoir des commandes ou une liste d'options que j'ai décrites dans le paragraphe précédent.  Après un tel bloc, une ligne vide doit être laissée. <br></li><li>  Pour utiliser la valeur d'une constante, vous devez insérer une construction de la forme <code>%{_}</code> .  Sa valeur peut être prédéfinie ou elle peut être déterminée par une option (par exemple, <code>Name: xkb-switch</code> ) ou en utilisant le mot clé <code>%define</code> .  Toutes ces constantes sont également considérées comme des macros.  Leur utilisation sera discutée plus en détail ci-dessous. <br></li></ul><br><br><a name="specfile_header"></a><br><h2>  En-tête de fichier de spécifications </h2><br><p>  Dans le fichier de spécifications, l'en-tête est toujours écrit en premier.  Il s'agit d'une liste d'options qui s'appliquent au package RPM principal.  Lorsque le package est prêt, presque toutes ces informations seront affichées lors de la visualisation de sa description.  Voici ce que les lignes individuelles indiquent: <br></p><br><br>  <b>Résumé:</b> <br>  Une brève description du package.  J'ai espionné la description dans le fichier <code>README.md</code> dans le projet <em>xkb-switch</em> : <code>Query and change XKB layout state</code> . <br><br>  <b>Nom:</b> <br>  Le nom du package.  Dans notre cas, c'est <code>xkb-switch</code> . <br><br>  <b>Version:</b> <br>  Version du programme.  Pour le savoir, il est préférable de regarder le fichier <code>CMakeLists.txt</code> dans le dossier racine du projet.  Bien sûr, vous devez extraire le fichier de la copie du projet qui sera utilisé pour l'assemblage.  Si vous utilisez le projet d'origine, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez ouvrir le fichier directement sur sa page GitHub</a> .  Comme vous pouvez le voir, la version est composée de <code>MAJOR_VERSION</code> , <code>MINOR_VERSION</code> et <code>RELEASE_VERSION</code> .  J'ai utilisé la version <code>1.6.0</code> du programme. <br><br>  <b>Communiqué:</b> <br>  Le numéro de version du package lui-même.  Affiche l'heure à laquelle un package avec un programme de la même version est assemblé.  Dans notre cas, c'est «1», car personne n'a jamais assemblé de programme de cette version.  Dans le cas idéal, si nous avons déjà essayé de compiler le package et que l'assemblage a atteint la fin (même s'il y avait des erreurs), après chaque nouvelle tentative, vous devez augmenter ce nombre de 1 et en même temps ne pas supprimer les anciens packages assemblés des <code>rpmbuild/RPMS</code> et <code>rpmbuild/SRPMS</code> : Ensuite, de nouveaux packages avec un nouveau numéro de build seront créés.  Peut-être que cela devrait être fait si vous utilisez un serveur spécial pour l'assemblage.  Nous utilisons notre ordinateur et à la place nous nettoierons les dossiers.  Si un package avec un programme de cette version est déjà dans les référentiels de la distribution Linux, mais que vous compilez avec d'autres paramètres, il est préférable de spécifier le numéro de version 1 de plus que ce package. <br><br>  <b>Licence:</b> <br>  Nom abrégé de la licence sous laquelle le programme est distribué.  Selon les règles de Rosa Linux, vous ne pouvez créer des packages qu'avec une licence qui permet une distribution gratuite.  <code>README.md</code> pouvez découvrir dans le fichier <code>README.md</code> que la licence est <em>GNU GPLv3</em> .  Nous écrivons donc: <code>GPLv3+</code> . <br><br>  <b>Groupe:</b> <br>  Groupe ou catégorie auquel appartient le programme.  À l'aide de ces groupes, les programmes sont triés dans le menu de lancement de l'application et dans le gestionnaire de programmes de la fenêtre («Ajouter ou supprimer des programmes»).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La liste des groupes pour Rosa Linux peut être trouvée ici</a> .  Je pense que <code>Development\X11</code> est le meilleur pour nous, car le programme est lié à X11 et est principalement nécessaire pour créer des scripts et des plugins pour Vim. <br><br>  <b>URL:</b> <br>  Adresse Internet où vous pouvez télécharger le code source d'origine du programme.  Il sera spécifié lors de l'affichage des informations sur le package RPM.  Cet article est facultatif, mais nous indiquerons: <code>https://github.com/ierton/xkb-switch</code> <br><br>  <b>Source0:</b> <br>  Le nom du fichier d'archive contenant le code source ou l'adresse Internet où il peut être téléchargé.  Si vous spécifiez une adresse sur Internet, lors du premier build, le fichier sera téléchargé dans <code>~/rpmbuild/SOURCES/</code> .  Si un tel fichier existe déjà, il ne sera plus téléchargé, c'est-à-dire que le programme <code>rpmbuild</code> n'utilisera que le nom de fichier spécifié à la fin de cette URL.  Vous pouvez spécifier uniquement le nom du fichier, mais il devra ensuite être placé manuellement dans le dossier <code>~/rpmbuild/SOURCES/</code> .  Il est préférable de fournir l'adresse de votre copie du projet sur GitHub.  J'ai utilisé le fichier <code>https://github.com/alexandersolovyov/xkb-switch/archive/master.zip</code> .  Vous pouvez spécifier plusieurs sources différentes pour collecter les sources de plusieurs archives à l'aide d'un fichier speck.  Ensuite, au nom de l'option pour ajouter chaque archive suivante, le nombre doit augmenter ( <code>Source1</code> , <code>Source2</code> , etc.).  Ces adresses de fichiers ne sont pas visibles lors de l'affichage des informations sur les packages RPM. <br><br>  <b>Patch0:</b> <br>  Cette option n'est pas dans le fichier modèle.  Cela peut être utile si vous décidez de transférer vos modifications dans les fichiers de projet du programme sous forme de correctifs.  Quant à l'option <code>Source0</code> , chaque fichier doit être indiqué sur une ligne distincte et le nombre à la fin du nom de l'option doit augmenter à chaque fois.  Les fichiers de correctifs doivent se trouver dans le dossier <code>~/rpmbuild/SOURCES</code> (à côté de l'archive source téléchargée).  Le nom de chaque fichier doit être écrit sans chemin d'accès.  Il n'est pas nécessaire de spécifier tous les fichiers de patch ici - seuls ceux que vous souhaitez appliquer peuvent être utilisés. <br><br>  <b>BuildRequires:</b> <br>  Paquets requis pour construire le programme.  Le modèle <code>cmake</code> .  Le fichier <code>CMakeLists.txt</code> indique que la version minimale de CMake pour l'assemblage ne doit pas être inférieure à <em>2.6</em> , il est donc préférable de spécifier <code>cmake &gt;= 2.6</code> .  Vous pouvez ajouter d'autres packages, chacun d'eux sur une ligne distincte, en utilisant l'option <code>BuildRequires:</code> séparée.  La liste des packages nécessaires à l'assemblage peut être trouvée en lisant le <code>README</code> du projet et en examinant attentivement le fichier <code>CMakeLists.txt</code> (en particulier les fonctions <code>FIND_PACKAGE</code> , <code>TARGET_LINK_LIBRARY</code> , <code>FIND_PROGRAM</code> ).  Ensuite, vous devez trouver le nom de package correct dans les référentiels à l'aide de la commande <code>urpmq -a __</code> .  Dans notre cas, le fichier de paramètres de compilation ( <code>CMakeLists.txt</code> ) contient déjà des lignes qui vérifient la présence des packages nécessaires dans le système.  Mais il vaut mieux spécifier la liste entière ici aussi: <br><pre> <code class="plaintext hljs"># CMake  2.6   BuildRequires: cmake &gt;= 2.6 #  C/C++ BuildRequires: gcc #    libxkbfile BuildRequires: libxkbfile-devel #   X11   libxkbfile, #  libx11-devel   . #    man: BuildRequires: xz</code> </pre><br><br>  <b>Nécessite:, Fournit:</b> <br>  Ces options ne sont pas dans l'échantillon, mais parfois elles peuvent être utiles.  Ils établissent des dépendances entre les packages.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'option </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spécifie les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionnalités</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournies par le package en cours de construction. Cela peut être le nom de l' en- </font><font style="vertical-align: inherit;">tête fichier de langue </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou le </font><font style="vertical-align: inherit;">nom de la </font><font style="vertical-align: inherit;">bibliothèque de liens dynamiques, ou une fonction spéciale. Et l'option </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indique de quelles </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacités d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autres packages dépendent le package. Package Manager ( </font></font><code>rpm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>urpm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou d' </font><font style="vertical-align: inherit;">autres qui utilisent votre distribution), lors de la </font><font style="vertical-align: inherit;">recherche des dépendances à la </font><font style="vertical-align: inherit;">recherche de </font><font style="vertical-align: inherit;">ces </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opportunités</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plutôt que des </font><font style="vertical-align: inherit;">noms de paquet. Par conséquent, </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est préférable d'indiquer la version de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opportunité</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournie </font><font style="vertical-align: inherit;">et pour </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelles versions des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opportunités</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournies </font><font style="vertical-align: inherit;">conviennent. La version est indiquée par des signes </font></font><code>&gt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou </font></font><code>&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, entouré d'espaces. Habituellement, toutes les options sont indiquées en premier </font></font><code>Requires</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis - </font></font><code>Provides</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un nom de fonction par ligne - le même que pour </font></font><code>BuildRequires:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En règle générale, lors de la création de packages sur Rosa Linux, les dépendances sont automatiquement reconnues et ces options doivent rarement être spécifiées. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoReq:, AutoProv:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si vous </font><b><font style="vertical-align: inherit;">créez un</font></b><font style="vertical-align: inherit;"> programme écrit dans une langue que le gestionnaire </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">nouveau ou propriétaire et si les dépendances ne sont pas correctement détectées automatiquement, vous pouvez désactiver la détection automatique des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capacités</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (avec </font></font><code>AutoProv: no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et / ou des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dépendances</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (avec aide </font></font><code>AutoReq: no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% description</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce bloc ne fait plus partie de l'en-tête, mais lui est associé. </font><font style="vertical-align: inherit;">Il ajoutera une description complète du programme au package RPM. </font><font style="vertical-align: inherit;">Une ligne vide doit être laissée après. </font><font style="vertical-align: inherit;">La description peut être la suivante:</font></font><br><pre> <code class="plaintext hljs">%description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor via 'libxkbswitch.so'. It is mainly used by a plugin for Vim text editor, vim-xkbswitch. Originally ruby-based code written by J.Broomley.</code> </pre><br><br><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les lignes du modèle commençant par </font></font><code>%files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ne </font></font><code>%find_lang</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont nécessaires que si vous créez une application </font><font style="vertical-align: inherit;">prenant en </font><font style="vertical-align: inherit;">charge plusieurs langues, supprimez-les.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, après le commentaire sur la ligne de division, suivi des commandes et des macros qui doivent être terminées avant de compresser les fichiers. </font><font style="vertical-align: inherit;">Toutes ces commandes sont divisées en blocs définis à l'aide de mots clés spéciaux.</font></font></p><br><br><a name="prep"></a><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Préparation de la source </font></font></h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier est un bloc </font></font><code>%prep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui indique les commandes pour préparer la compilation. </font><font style="vertical-align: inherit;">Il contient une macro-commande </font></font><code>%setup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Elle exécute un script qui fait ce qui suit:</font></font></p><br><br><ul><li>       ,      <code>SourceX:</code>    (  —  <code>Source0:</code> ).         ,    . <br></li><li>      <code>~/rpmbuild/SOURCES/</code> . <br></li><li>      <code>~/rpmbuild/BUILD/</code> . <br></li><li>      . <br></li></ul><br><br><p>   <code>-q</code> ,       . </p><br><p>     ,     <code>%prep</code> : </p><br><br><pre> <code class="bash hljs">rpmbuild -bp ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>     <code>rpmbuild</code> .       ,      <code>rpm</code>    : <code>rpmbuild</code>    ,      .           (   <code>root</code>    <code>sudo</code> ).    <code>rpmbuild</code>  ,  <code>man rpmbuild</code> .      ,       ,   , —  ,          <code>rpmbuild</code> . <br></p><br><p>      : <code>xkb-switch-1.6.0: No such file or directory</code> .    ,          <code>~/rpmbuild/BUILD/xkb-switch-1.6.0</code> ,  .   <br></p><br><br><pre> <code class="bash hljs">ls ~/rpmbuild/BUILD/</code> </pre><br><br><p> ,     <code>xkb-switch-master</code> .     <code>%setup</code>    <code>-n</code> .    <code>%prep</code>  -   : <br></p><br><br><pre> <code class="bash hljs">%prep %setup -q -n xkb-switch-master</code> </pre><br><br><p>    <code>~/rpmbuild/SPECS/cleanup.sh</code> ,    <code>BUILD</code> ,     ,   <code>%prep</code> .  ,     <code>exit 0</code> .  ,     . <br></p><br><p>          ,         .       <code>%prep</code> .       ,    ,      : <br></p><br><pre> <code class="plaintext hljs">%apply_patches</code> </pre><br><p>       <code>rpmbuild -bp xkb-switch.spec</code> .    —    . <br></p><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Maximum RPM</a> . <br></p><br><p>    . <br></p><br><br><a name="build"></a><br><h2>  </h2><br><p>      <code>%build</code> .   <code>README</code>  ,     <code>cmake ..</code>  <code>make</code> ,     -   .  :           ,     .    ,        <code>%build</code> : <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -bc ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>     <code>exit 0</code> :    . <br></p><br><p> ,         .     shell (  bash  zsh,     ).  <code>rpmbuild</code>      ,           .    shell    - —        . (    .) <br></p><br><p>     -  , ,  ,     <code>%build</code>  shell  . <br></p><br><p>     ,    ,   .      <code>cmake</code> , , ,        <code>%cmake</code>      -  ,      ,    .         (   — <code>CMakeLists.txt</code> ).             ,    . <br></p><br><br><a name="install"></a><br><h2>  L'installation </h2><br><p> , <em></em> .   <code>%install</code>   ,               ,     ,    <code>~/rpmbuild/BUILDROOT/__-buildroot/</code> . <br></p><br><p>  <code>__</code>    ,     <code>Name:</code>   -,   ( <code>Version:</code>  -),   ( <code>Release:</code>  -),  ,     . <br></p><br><p>   <code>README</code>  ,     <code>make install</code> ,    <code>build</code>   .  - - <code>%makeinstall_std -C build</code>    ,   .       ( ,   ): <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -bi ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p>      ,       RPM.   -   ,     . <br></p><br><br><a name="packing"></a><br><h2>   </h2><br><p>         ,      -  .     ,     <code>~/rpmbild/BUILDROOT/</code> . ( , ,     <code>tree</code> ,  -      Linux.)  ,       ,       <code>.debug</code> .    , ,    :        . <br></p><br><p>  ,       ,   <code>%files</code>  -.   ,     ,      .  . <br></p><br><p>       <code>%files</code>  -.  ,    .   Rosa Linux       <code>%prep</code> (  -   ).   ,   ,     ,  ,        —   .          - (,    ,     ). <br></p><br><p>   <code>%files</code>    ,      RPM. ,     : <br></p><br><br><pre> <code class="plaintext hljs">%files %{_bindir}/%{name} %{_libdir}/libxkbswitch.so %{_libdir}/libxkbswitch.so.1 %{_libdir}/libxkbswitch.so.%{version} %{_mandir}/man1/%{name}.1.xz</code> </pre><br><br><p>         -.   , ,     <code>/usr/lib/rpm/macros</code> .  , <code>%{_bindir}</code>     , <code>%{_libdir}</code> —   ,  <code>%{_mandir}</code> —    man.   <code>%{name}</code>  <code>%{version}</code>    <code>Name:</code>  <code>Version:</code>   -. <br></p><br><p>     : <br></p><br><br><pre> <code class="bash hljs">~/rpmbuild/SPECS/cleanup.sh rpmbuild -ba ~/rpmbuild/SPECS/xkb-switch.spec</code> </pre><br><br><p> …   2   1 .    <code>rpmlint</code> ,      .  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Rpmlint Errors</a>  ,   : <br></p><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: E: incoherent-version-in-name (Badness: 50) 1`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erreur: La version dans le nom du package de bibliothèque n'est pas spécifiée correctement. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: E: exécutable-dans-bibliothèque-package (Badness: 1) / usr / bin / xkb-switch`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erreur: le package de bibliothèque contient un fichier exécutable. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`xkb-switch.i586: W: fichier-devel-in-non-devel-package / usr / lib / libxkbswitch.so`</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avertissement qu'un fichier de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">package de développement</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><code>-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) a été trouvé dans un package qui n'était pas destiné au développement.</font></font><br><br><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tout est-il clair? </font></font> Je ne pense pas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examinons de plus près ce qui se passe ici. </font></font><br></p><br><br><a name="packing-rpmlint"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qu'est-ce que rpmlint </font></font></h3><br><p>     Rosa Linux  <code>rpmbuild</code>   <code>rpmlint</code> ,    .  <code>rpmlint</code>    ,   ,      .   ,     Rosa Linux (  ,     <code>rpmlint</code> )     . <br></p><br><p>     ,     ,      .       <code>~/rpmbuild/RPMS/_/</code>         <code>rpmlint -i __</code> . <br></p><br><p> ,      RPM   - ,  ,    ,  ,      Rosa Linux,      <code>rpmlint -i __</code> . <br></p><br><br><a name="packing-package_types"></a><br><h3>   RPM  Rosa Linux </h3><br><p>   Rosa Linux   6 .   ,          . <br></p><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paquet exécutable</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il est binaire. Il ne contient qu'un fichier ou script binaire destiné directement à l'exécution. Les fichiers de ces packages sont le plus souvent installés dans un dossier </font></font><code>/bin/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou dans </font></font><code>/usr/bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Peut également contenir des liens - pour la possibilité d'appeler le programme en utilisant plusieurs noms différents. Le nom du package correspond au nom du programme. Ces packages dépendent souvent de la bibliothèque. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliothèque</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Contient des fichiers compilés de </font><b><font style="vertical-align: inherit;">bibliothèques</font></b><font style="vertical-align: inherit;"> connectées dynamiquement ("partagées", "partagées") utilisées par les programmes. Il s'agit généralement du fichier de bibliothèque lui-même, dont le nom se termine par la version, et d'un lien vers ce fichier, dont le nom se termine par le premier numéro de version. Par exemple, pour une bibliothèque </font></font><code>libxkbfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version 1.0.2, ce sera un fichier </font></font><code>libxkbfile.so.1.0.2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et un lien vers celui-ci,</font></font><code>libxkbfile.so.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le nom même du package de bibliothèque, par lequel il est reconnu dans le référentiel du programme d'installation, se termine par le premier numéro de version et commence par le préfixe </font></font><code>lib</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La bibliothèque a le </font></font><code>libxkbfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom correct - </font></font><code>libxkbfile1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cela est dû au fait que le premier numéro de version ne change généralement qu'avec des modifications de bibliothèque incompatibles, et il sera donc possible d'installer plusieurs packages avec une bibliothèque de versions différentes si certains programmes utilisent l'ancienne version de la bibliothèque et d'autres utilisent une version plus récente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Package pour développeurs</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fichiers nécessaires à la compilation de programmes utilisant la bibliothèque, mais inutiles pour le travail de programmes prêts à l'emploi. Pour les programmes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simples </font><font style="vertical-align: inherit;">, il s'agit d'un lien vers le fichier de bibliothèque, mais sans versions dans le nom (par exemple,</font></font><code>libxkbfile.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ainsi que les fichiers d'en-tête (avec l'extension </font></font><code>.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Nom du package se </font><font style="vertical-align: inherit;">termine par </font></font><code>-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, par exemple: </font></font><code>libxkbfile-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lors de l'installation, cela dépend toujours de la bibliothèque appropriée. Par exemple, le package </font></font><code>libxkbfile-devel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dépend </font></font><code>libxkbfile1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les référentiels Rosa Linux ont des packages RPM contenant le code source de certains programmes - principalement ceux qui ont </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment besoin d'être</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reconstruits. Les noms de ces packages se terminent par </font></font><code>-src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>-source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(par exemple, </font></font><code>apache-source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><code>rpmbuild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crée toujours un tel package automatiquement et le place </font></font><code>~/rpmbuild/SRPMS/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symboles de débogage</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit d'informations qui peuvent être utilisées pour déboguer un programme terminé. </font><font style="vertical-align: inherit;">Il associe les emplacements des fichiers compilés au code source. </font><font style="vertical-align: inherit;">Ces packages sont </font></font><code>rpmbuild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automatiquement </font><font style="vertical-align: inherit;">créés par l'équipe </font><font style="vertical-align: inherit;">, une fin est attribuée à leur nom </font></font><code>-debuginfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je n'ai pas trouvé de tels packages dans les référentiels Rosa Linux. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les référentiels Rosa Linux ont des packages de documentation pour divers programmes et bibliothèques. </font><font style="vertical-align: inherit;">Je (pour l'instant) ne connais pas les caractéristiques de la construction de tels packages. </font><font style="vertical-align: inherit;">Leurs noms se </font><font style="vertical-align: inherit;">terminent généralement par </font></font><code>doc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: par exemple </font></font><code>libx11-doc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>java-1.7.0-openjdk-javadoc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Soit dit en passant, presque tous sont créés dans le style de sites Web, et pour les afficher, il est préférable d'ouvrir un navigateur, d'aller à l'adresse </font></font><code>file:///usr/share/doc/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de sélectionner le dossier et le fichier souhaités.</font></font><br><br><br><br><a name="packing-result"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Notre résultat </font></font></h3><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, tout est devenu plus clair. </font></font><br></p><br><br><ul><li>    <code>xkb-switch</code>   <code>libxkbswitch.so</code> , ,  ,    <em>  </em> .   ,          : <code>xkb-switch.i586: W: devel-file-in-non-devel-package /usr/lib/libxkbswitch.so</code> . <br></li><li>     <em></em> ,      <code>/usr/lib/libxkbswitch.so.1</code>  <code>/usr/lib/libxkbswitch.so.1.6.0</code> .       ,       .  : <code>xkb-switch.i586: E: executable-in-library-package (Badness: 1) /usr/bin/xkb-switch</code> . <br></li><li>    ,          (1).   : <code>xkb-switch.i586: E: incoherent-version-in-name (Badness: 50) 1</code> . <br></li></ul><br><br><p> ,  <code>rpmlint</code> ,     .          .   <em>xkb-switch</em> ,      <code>libxkbswitch.so.1.6.0</code>       ,        <em>Vim</em> .            <em>xkb-switch</em> ,          <em>C</em>  <em>C++</em> .  RPM-    . <br></p><br><p>       -: <br></p><br><br><div class="spoiler"> <b class="spoiler_title">-   xkb-switch</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Summary: Query and change XKB layout state Name: xkb-switch Version: 1.6.0 Release: 1 License: GPLv3+ Group: Development/X11 URL: https://github.com/ierton/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor via 'libxkbswitch.so'. It is mainly used by a plugin for Vim text editor, vim-xkbswitch. Originally ruby-based code written by J.Broomley. %files %{_bindir}/%{name} %{_libdir}/libxkbswitch.so %{_libdir}/libxkbswitch.so.1 %{_libdir}/libxkbswitch.so.%{version} %{_mandir}/man1/%{name}.1.xz #------------------------------------------------------------------ %prep %setup -q -n xkb-switch-master %build %cmake %make %install %makeinstall_std -C build</code> </pre><br></div></div><br><br><a name="subpackaging"></a><br><h2>       </h2><br><p>        — ,         .    ,  ,       <code>xkb-switch</code>  3 : <em></em> , <em></em>   <em></em> . : <br></p><br><br><ul><li>  <em></em>     <code>/usr/bin/xkb-switch</code>    <code>/usr/share/man/man1/xkb-switch.1.xz</code> , <br></li><li>  <em></em> —  <code>/usr/lib/libxkbswitch.so.1</code>  <code>/usr/lib/libxkbswitch.so.1.6.0</code> , <br></li><li>    <em> </em> — <code>/usr/lib/libxkbswitch.so</code> . <br></li></ul><br><br><p>       -.  ,   , <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  - Maximum RPM</a> .     <a href=""> -  libxkbfile</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   Rosa Linux</a> . <br></p><br><p>    . <br></p><br><br><a name="subpackaging-macros"></a><br><h3>    </h3><br><p>        —   <a href="">-  libxkbfile</a> .     -  : <br></p><br><br><pre> <code class="plaintext hljs">%define major 1 %define libname %mklibname xkbswitch %{major} %define develname %mklibname -d xkbswitch</code> </pre><br><br><p>    <code>%define</code>  .        ,    (     ) —   ,       .     ,    <code>%{major}</code>   <code>1</code> ,      . <br></p><br><p>  <code>%mklibname</code>   «lib»,     ,      —   (  ).     <code>%{libname}</code>  <em>«lib» + «xkbswitch» + (  %{major}) =</em> <code>libxkbswitch1</code> —   . <br></p><br><p>  <code>-d</code>  <code>%mklibname</code>   <code>-devel</code> .    <code>%{develname}</code>  <code>libxkbswitch-devel</code> —    . <br></p><br><br><a name="subpackaging-change_header"></a><br><h3>    </h3><br><p>     <code>Version:</code>   <br></p><br><br><pre> <code class="plaintext hljs">Version: %{major}.6.0</code> </pre><br><br><p>  ,           -. <br></p><br><p>      -       .      .      : <br></p><br><pre> <code class="plaintext hljs">Name: xkb-switch Version: %{major}.6.0 Release: 1 Summary: Query and change XKB layout state License: GPLv3+ Group: Development/X11 URL: https://github.com/alexandersolovyov/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor, a library 'libxkbswitch'. It is mainly used for some plugins for Vim text editor, such as vim-xkbswitch. Originally ruby-based code written by J.Broomley.</code> </pre><br><br><a name="subpackaging-packages"></a><br><h3>    </h3><br><p>     <em>-</em>     . <em>-</em>   , -      (    <em>rpm</em> ).       <code>%package</code> .        -.     ,    -.          <code>Version</code> , <code>Summary</code> , <code>Group</code> .      <code>Provides</code>  <code>Requires</code>   <em></em>  <em></em> ,     .  <code>Name</code>   :    ,     <code>%package</code> . <br></p><br><p>      .     <code>%description</code>       —   ,     <code>%package</code> . <br></p><br><p>  Rosa Linux   -   <code>%description</code>  -.    <code>libxkbswitch1</code> : <br></p><br><pre> <code class="plaintext hljs">%package -n %{libname} Version: %{version} Summary: A library for xkb-switch tool, provides API bindings for Vim text editor Group: Development/X11 %description -n %{libname} libxkbswitch library, required by xkb-switch tool. It provides bindings for API of the Vim text editor, which can be used via 'libxkbswitch.so.1'.</code> </pre><br><br><p>  <code>-n</code>    <code>%package</code>  <code>%description</code> ,       .    -        ,    <code>xkb-switch-libxkbswitch1</code> .       <code>libxkbswitch1</code> .           . <br></p><br><p>    <em> </em> : <br></p><br><pre> <code class="plaintext hljs">%package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 %description -n %{develname} Development files for libxkbswitch. Provides bindings for API of the Vim text editor via 'libxkbswitch.so'.</code> </pre><br><br><a name="subpackaging-files"></a><br><h3>     </h3><br><p>   ,      .     <code>%files</code> . <br></p><br><p>      ,     ,    <code>%package</code> , <code>%description</code>  <code>%files</code> .  ,    <code>%description</code>  -    .   ,      ,    — <code>xkb-switch</code> . <br></p><br><p>  -  Rosa Linux     <code>%files</code>   ,    <code>%prep</code> .       : <br></p><br><pre> <code class="plaintext hljs">%files %{_bindir}/%{name} %{_mandir}/%{name}.1.xz %files -n %{libname} %{_libdir}/libxkbswitch.so.%{major} %{_libdir}/libxkbswitch.so.%{version} %files -n %{develname} %{_libdir}/libxkbswitch.so</code> </pre><br><br><p>    , : <br></p><br><br><ul><li>   <code>xkb-switch</code>   <code>~/usr/bin/xkb-switch</code>  <code>~/usr/share/man/man1/xkb-switch.1</code> , <br></li><li>   <code>libxkbswitch1</code>   <code>~/usr/lib/libxkbswitch.so.1</code>  <code>~/usr/lib/libxkbswitch.so.1.6.0</code> , <br></li><li>    <code>libxkbswitch-devel</code>   <code>~/usr/lib/libxkbswitch.so</code> . <br></li></ul><br><br><p>       <code>cleanup.sh</code>       <code>rpmbuild -ba ~/rpmbuild/SPECS/xkb-switch.spec</code> .    3 : <br></p><br><br><pre> <code class="plaintext hljs">libxkbswitch1.i586: W: no-documentation libxkbswitch-devel.i586: W: no-documentation libxkbswitch-devel.i586: W: no-dependency-on libxkbswitch/libxkbswitch-libs/liblibxkbswitch</code> </pre><br><br><p>   ,       .   ,     .     .  Essayons de le comprendre. <br></p><br><br><a name="subpackaging-problems"></a><br><h3>    </h3><br><p> ,      ,  ,        <code>README.md</code> .     <code>%files</code>      —    <code>%doc</code> : <br></p><br><br><pre> <code class="plaintext hljs">%doc README.md</code> </pre><br><br><p>      .    <code>%doc</code> —    .        <code>~/rpmbuild/BUILD/xkb-switdh-master/README.md</code> . <br></p><br><p>       : <code>libxkbswitch-devel.i586: W: no-dependency-on libxkbswitch/libxkbswitch-libs/liblibxkbswitch</code> .  ,    <code>libxkbswitch-devel</code>    <code>libxkbswitch</code>  . <br></p><br><p>    <code>rpm -qp  --</code>       .            : <br></p><br><pre> <code class="bash hljs">[user@pc ~] $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/RPMS/i586/ [user@pc ~/rpmbuild/RPMS/i586] $ ls libxkbswitch1-1.6.0-1-rosa2014.1.i586.rpm xkb-switch-1.6.0-1-rosa2014.1.i586.rpm libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm xkb-switch-debuginfo-1.6.0-1-rosa2014.1.i586.rpm [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --provides libxkbswitch1-1.6.0-1-rosa2014.1.i586.rpm libxkbswitch.so.1 libxkbswitch1 = 1.6.0-1:2014.1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --provides libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm devel(libxkbswitch) libxkbswitch-devel = 1.6.0-1:2014.1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --requires libxkbswitch-devel-1.6.0-1-rosa2014.1.i586.rpm devel(libX11) devel(libgcc_s) devel(libstdc++) devel(libxkbfile) rpmlib(PayloadIsXz) &lt;= 5.2-1 [user@pc ~/rpmbuild/RPMS/i586] $ rpm -qp --requires xkb-switch-1.6.0-1-rosa2014.1.i586.rpm libc.so.6 libc.so.6(GLIBC_2.0) libc.so.6(GLIBC_2.1.3) libgcc_s.so.1 libgcc_s.so.1(GCC_3.0) libstdc++.so.6 libstdc++.so.6(CXXABI_1.3) libstdc++.so.6(GLIBCXX_3.4) libstdc++.so.6(GLIBCXX_3.4.11) libstdc++.so.6(GLIBCXX_3.4.20) libstdc++.so.6(GLIBCXX_3.4.9) libxkbswitch.so.1 rpmlib(PayloadIsXz) &lt;= 5.2-1</code> </pre><br><br><p>  ,    <code>libxkbswitch1</code>   <code>libxkbswitch.so.1</code>  <code>libxkbswitch1</code> .  <code>xkb-switch</code>   <code>libxkbswitch.so.1</code> ,     <code>libxkbswitch-devel</code>    <code>libxkbswitch1</code> .   ,     <code>%package</code>  <code>libxkbswitch-devel</code> .      : <br></p><br><br><pre> <code class="plaintext hljs">%package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 Requires: %{libname} &gt;= %{version}</code> </pre><br><br><p>        , …       .     <code>libxkbswitch-devel</code>  ,  ,    .     ,         ,  <code>rpmbuild</code>      . <br></p><br><p> -,     (  <code>README.md</code>    ), —  : <br></p><br><br><div class="spoiler"> <b class="spoiler_title">-    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">%define major 1 %define libname %mklibname xkbswitch %{major} %define develname %mklibname -d xkbswitch # Main package. Automaticaly requires libxkbswitch and libxkbswitch-devel Name: xkb-switch Version: %{major}.6.0 Release: 1 Summary: Query and change XKB layout state License: GPLv3+ Group: Development/X11 URL: https://github.com/alexandersolovyov/xkb-switch Source0: https://github.com/alexandersolovyov/xkb-switch/archive/master.zip BuildRequires: cmake &gt;= 2.6 BuildRequires: gcc BuildRequires: libxkbfile-devel BuildRequires: xz %description xkb-switch is a C++ program that allows to query and change the keyboard layout state for X11 Window System (XKB) via command line. It provides a command 'xkb-switch', and bindings for API of the Vim text editor, a library 'libxkbswitch'. It is mainly used for some plugins for Vim text editor, such as vim-xkbswitch. Originally ruby-based code written by J.Broomley. # libxkbswitch %package -n %{libname} Version: %{version} Summary: A library for xkb-switch tool, provides API bindings for Vim text editor Group: Development/X11 %description -n %{libname} libxkbswitch library, required by xkb-switch tool. It provides bindings for API of the Vim text editor, which can be used via 'libxkbswitch.so.1'. # libxkbswitch-devel %package -n %{develname} Version: %{version} Summary: Development library libxkbswitch, provides API bindings for Vim text editor Group: Development/X11 Requires: %{libname} &gt;= %{version} %description -n %{develname} Development files for libxkbswitch. Provides bindings for API of the Vim text editor via 'libxkbswitch.so'. # xkb-switch %files %{_bindir}/%{name} %{_mandir}/man1/%{name}.1.xz # libxkbswitch1 %files -n %{libname} %{_libdir}/libxkbswitch.so.%{major} %{_libdir}/libxkbswitch.so.%{version} %doc README.md # libxkbswitch-devel %files -n %{develname} %{_libdir}/libxkbswitch.so %doc README.md #------------------------------------------------------------------ %prep %setup -q -n xkb-switch-master %build %cmake %make %install %makeinstall_std -C build</code> </pre><br></div></div><br><br><a name="summary"></a><br><h2>  Conclusion </h2><br><p>  ,      RPM    <em>Rosa Linux</em> (       ).       ,   -. ,       — ,   ,   <em>rpmrc</em> ,      <em>ABF</em>   , —         . <br></p><br><p>        —    ,      -,         - , —     . <br></p><br><br><a name="commands"></a><br><h2>   </h2><br><br><a name="commands-build"></a><br><h3>     </h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bp specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exécuter la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">préparation</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (% prep). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bc specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compilation</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (build%) et toutes les </font><font style="vertical-align: inherit;">actions précédentes. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -bi specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effectue une </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pseudo-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> installation (% install) et toutes les étapes précédentes. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmbuild -ba specfile.spec</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Générez des packages complètement.</font></font><br><br><br><br><a name="commands-package"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vérification du colis fini </font></font></h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpmlint -i package_file_name.rpm Vérification</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> générale - dans quelle mesure le package a été construit. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qp --provides package_filename.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vérifiez quelles "fonctionnalités" sont fournies par le package. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qp --requires package_filename.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vérifiez les "capacités" des autres packages dont dépend ce package. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qpl package_file_name.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Liste des fichiers contenus dans le package. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rpm -qpi nom-fichier-package.rpm</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Informations sur le package (à partir de "l'en-tête" du fichier de spécifications ou du bloc </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% package</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><br><br><p>          ,    <code>p</code> .    ,     Rosa Linux,   .     <code>urpmq</code> ,   <code>rpm -q</code> . , <code>urpmq -l _</code>    ,  <code>urpmq --requires _</code>   . <br></p><br><br><a name="links"></a><br><h2>   ( ) </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Building RPMs — Quick Start</a> —         RPM  Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> RPM</a> —    ,   ,       .   . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RPM:  spec </a> —    -  Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maximum RPM</a> —        <code>rpm</code>   RPM-  RedHat Linux.         ,      Rosa Linux.    . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Template Spec Files</a> —   <code>.spec</code> .  ,      -. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Automatic Build Farm (ABF)</a> —      Rosa Linux.             ,   ,     ,    <code>.spec</code> .     -. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rpmlint Errors</a> —    ,   <code>rpmlint</code> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Packaging Group</a> —    Rosa Linux. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   Rosa Linux</a> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Git — </a> —      <em>Git</em> . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464993/">https://habr.com/ru/post/fr464993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464981/index.html">Google fournit des arguments pour justifier le suivi des utilisateurs - l'entreprise est accusée de manque de sincérité et de manipulation</a></li>
<li><a href="../fr464985/index.html">L'Internet des objets (IoT) va changer le monde. L'avenir de l'IoT</a></li>
<li><a href="../fr464987/index.html">Dépôts à Kubernetes: OpenEBS vs Rook (Ceph) vs Rancher Longhorn vs StorageOS vs Robin vs Portworx vs Linstor</a></li>
<li><a href="../fr464989/index.html">Contexte de l'extravagance</a></li>
<li><a href="../fr464991/index.html">Des projets qui n'ont pas décollé</a></li>
<li><a href="../fr464995/index.html">Envelopper des séquences dans Swift</a></li>
<li><a href="../fr464997/index.html">À propos du développement des technologies VR: où les utilisent-elles, pourquoi les entreprises VR et quels appareils utilisent</a></li>
<li><a href="../fr464999/index.html">Comment les spécificités du travail avec les serveurs d'applications changent à l'aide de l'exemple OpenLiberty</a></li>
<li><a href="../fr465001/index.html">Amazon Prime Day 2019 - Propulsé par AWS</a></li>
<li><a href="../fr465003/index.html">Intérêts pour le genre ARPG</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>