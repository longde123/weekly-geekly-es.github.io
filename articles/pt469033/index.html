<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèª üñêÔ∏è üëãüèΩ Lan√ßamento da plataforma Elbrus para redes neurais do PuzzleLib üë©üèø‚Äçü§ù‚Äçüë©üèª üö¥üèª „ÄΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IA em ferro dom√©stico 
 Falamos sobre como portamos nossa estrutura para redes neurais e sistema de reconhecimento de rosto para os processadores russ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lan√ßamento da plataforma Elbrus para redes neurais do PuzzleLib</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ashmanov_net/blog/469033/"><h3>  IA em ferro dom√©stico </h3><br>  Falamos sobre como portamos nossa estrutura para redes neurais e sistema de reconhecimento de rosto para os processadores russos Elbrus. <br><br><img src="https://habrastorage.org/webt/e3/sq/qz/e3sqqz_1suglr-i19vtkvjaj3l4.png" alt="imagem"><br><br>  Foi uma tarefa interessante: na primavera de 2019, conversamos sobre isso no escrit√≥rio da Yandex na grande reuni√£o sobre Elbrus, agora estamos compartilhando com Habr. <br><a name="habracut"></a><br><h3>  Resumidamente - o que √© Elbrus </h3><br>  Este √© um processador russo com arquitetura pr√≥pria, desenvolvido no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MCST</a> .  Maxim Gorshenin fala bem sobre ele em seu canal: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.youtube.com/watch?v=H8eBgJ58EPY</a> <br><br><h3>  Resumidamente - o que √© o PuzzleLib </h3><br>  Esta √© a nossa plataforma para redes neurais, que desenvolvemos e usamos desde 2015.  An√°logo do Google TensorFlow e Facebook PyTorch.  Curiosamente, o PuzzleLib suporta n√£o apenas os processadores NVIDIA e Intel, mas tamb√©m as placas de v√≠deo AMD. <br><br>  Embora tenhamos uma pequena biblioteca (o TensorFlow tem cerca de 2 milh√µes de linhas, temos 100 mil), somos melhores em velocidade - um pouco, mas melhor =) <br><br>  Ainda n√£o estamos em c√≥digo aberto, a biblioteca √© usada para nossos projetos.  A biblioteca est√° completa: suporta o est√°gio de treinamento e o est√°gio de infer√™ncia das redes neurais.  Voc√™ pode criar redes neurais convolucionais e recorrentes; tamb√©m existe uma interface para a cria√ß√£o de gr√°ficos arbitr√°rios de c√°lculos. <br><br><h4>  O PuzzleLib tem </h4><br><ul><li>  M√≥dulos para montagem de redes neurais (Ativa√ß√£o (Sigmoid, Tanh, ReLU, ELU, LeakyReLU, SoftMaxPlus), AvgPool (1D, 2D, 3D), BatchNorm (1D, 2D, 3D, ND), Conv (1D, 2D, 3D, ND) , CrossMapLRN, Deconv (1D, 2D, 3D, ND), Dropout (1D, 2D) etc.) </li><li>  Otimizadores (AdaDelta, AdaGrad, Adam, Hooks, LBFGS, MomentumSGD, NesterovSGD, RMSProp, etc.) </li><li>  Redes neurais prontas para uso (Resnet, Inception, YOLO, U-Net etc.) </li></ul><br>  Estes s√£o os familiares, familiares a todos os envolvidos em redes neurais, blocos para projetistas de redes neurais (j√° que quaisquer estruturas s√£o construtoras que consistem em blocos e algoritmos t√≠picos de computa√ß√£o). <br><br>  <b>Tivemos uma ideia de lan√ßar nossa biblioteca sobre arquitetura Elbrus.</b> <b><br></b> <br><br><h3>  Por que queremos apoiar o Elbrus? </h3><br><ol><li>  Este √© o √∫nico processador russo, eu queria entender como as coisas est√£o indo, como √© f√°cil trabalhar com ele. </li><li>  Achamos que seria interessante para as organiza√ß√µes estatais que o software russo que estamos desenvolvendo funcione no hardware russo. </li><li>  E, √© claro, est√°vamos apenas interessados, porque Elbrus √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">processador VLIW</a> , ou seja, um processador com instru√ß√µes longas, e n√£o existem processadores de uso geral completos no mundo. </li></ol><br>  Tudo come√ßou com o fato de termos nos encontrado com o MCST, conversado e emprestado o computador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Elbrus 401</a> para desenvolvimento. <br><br>  <b>O que eu gostei</b> : O Linux √© executado no Elbrus, existe um python neste Linux e n√£o funciona no modo de emula√ß√£o - √© um python nativo de pleno direito, montado para o Elbrus.  H√° tamb√©m um pacote de bibliotecas python padr√£o, por exemplo, numpy, que todos os desenvolvedores adoram. <br><br>  Havia algumas tarefas para as quais tivemos que coletar adicionalmente bibliotecas: por exemplo, no PuzzleLib, usamos o formato hdf para armazenar os pesos das redes neurais e, consequentemente, tivemos que construir as bibliotecas libhdf e h5py usando o compilador lcc.  Mas n√£o tivemos problemas de montagem. <br><br>  A biblioteca de vis√£o computacional OpenCV tamb√©m j√° foi compilada, mas n√£o havia liga√ß√£o para o python - n√≥s a constru√≠mos separadamente. <br><br>  A famosa biblioteca dlib tamb√©m √© bastante f√°cil de compilar.  Havia apenas pequenas dificuldades: alguns arquivos desse projeto de c√≥digo aberto n√£o tinham um bom marcador para determinar o utf-8, o que perturbou o lexer lcc.  Na verdade, havia simplesmente um formato de arquivo incorreto, que precisava ser corrigido na fonte. <br><br>  Decidimos come√ßar o reconhecimento de rosto primeiro.  Este √© um caso de uso compreens√≠vel para muitos, onde essa tecnologia √© usada.  O PuzzleLib, como outras bibliotecas, possui uma parte de back-end bastante grande, ou seja, uma base de c√≥digo espec√≠fica para diferentes arquiteturas de processador. <br><br>  <b>Nossos back-end:</b> <br><br><ul><li>  CUDA (NVIDIA) </li><li>  Open CL + MI Open (AMD) </li><li>  mlkDNN (Intel) </li><li>  CPU (numpy) </li></ul><br>  Na Elbrus, lan√ßamos um back-end numpy, que era muito simples, porque a plataforma requer um m√≠nimo de tudo: <br><br>  <i>Plataforma -&gt; compilador c90 -&gt; python -&gt; numpy</i> <br><br>  Temos uma biblioteca sem fatores complicadores (por exemplo, sem sistemas especiais de montagem) - al√©m do fato de precisarmos coletar determinados aglutinantes.  Fizemos os testes, tudo funciona - tanto em redes convolucionais quanto em recorrentes.  O reconhecimento facial que lan√ßamos √© bastante simples, com base no Inception-ResNet. <br><br>  <b>Primeiros resultados do trabalho</b> <br><br>  No Intel Core i7 7700, o tempo de processamento de uma imagem era de 0,1 segundos, e aqui - 15. Era necess√°rio otimizar. <br><br>  Obviamente, esperar que o entorpecido funcionasse bem rapidamente seria errado. <br><br><h3>  Como otimizamos a computa√ß√£o </h3><br>  Medimos a velocidade de infer√™ncia atrav√©s do criador de perfil python e descobrimos que quase todo o tempo era gasto multiplicando matrizes em numpy.  Para a amostra, eles escreveram a multiplica√ß√£o manual mais simples da matriz, e ela j√° se mostrou mais r√°pida, embora n√£o estivesse claro o porqu√™. <br><br>  Parece que numpy.dot deveria ter sido escrito um pouco menos ing√™nuo do que uma multiplica√ß√£o t√£o simples.  No entanto, convencemos, verificamos - o resultado foi mais r√°pido (12 segundos por quadro em vez de 15). <br><br>  Em seguida, aprendemos sobre a biblioteca de √°lgebra linear EML, que est√° sendo desenvolvida no ICST, e substitu√≠mos as chamadas np.dot por cblas_sgemm.  Tornou-se 10 vezes mais r√°pido (1,5 segundos) - ficamos muito satisfeitos. <br><br>  Isso foi seguido por v√°rias otimiza√ß√µes passo a passo.  Como executamos apenas o reconhecimento de faces, e geralmente n√£o dados arbitr√°rios, decidimos aprimorar nossas opera√ß√µes apenas sob tensores 4d e transformar o Fusion - ap√≥s o qual o tempo de processamento diminuiu 2 vezes - para 0,75 segundos. <br><br>  Explica√ß√£o: Fusion √© quando v√°rias opera√ß√µes s√£o combinadas em uma, por exemplo, convolu√ß√£o, normaliza√ß√£o e ativa√ß√£o.  Em vez de fazer um passe em tr√™s ciclos, um passe √© feito. <br><br>  Essas bibliotecas est√£o dispon√≠veis na NVIDIA ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TensorRT</a> ).  Um gr√°fico computacional √© carregado nele e a biblioteca produz um gr√°fico otimizado e acelerado, em particular devido ao fato de poder recolher as opera√ß√µes em um.  A Intel tamb√©m possui uma similar (nGraph e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenVINO</a> ). <br><br>  Vimos ent√£o que, como havia muitas convolu√ß√µes 1x1 no Inception-ResNet, t√≠nhamos c√≥pia extra de dados.  Decidimos nos especializar no fato de trabalharmos em lotes de 1 foto (ou seja, n√£o processamos 100 fotos em lotes, mas fornecemos o modo de streaming) - existem casos de uso em que voc√™ n√£o precisa trabalhar com arquivos, mas com um fluxo (por exemplo, para vigil√¢ncia por v√≠deo ou ACS).  Criamos uma passagem especializada sem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">im2col</a> (removemos c√≥pias grandes) - tornou-se 0,45 segundos. <br><br>  Ent√£o olhamos novamente para o criador de perfil, t√≠nhamos tudo da mesma maneira - embora todos os est√°gios tenham diminu√≠do no tempo, ainda passamos 80% do tempo gasto no c√°lculo de blocos de infer√™ncia convolucionais. <br>  Percebemos que precis√°vamos paralelizar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gemm</a> (multiplica√ß√£o da matriz geral).  Esse gemm, que em EML, acabou por ser de thread √∫nico.  Assim, tivemos que escrever gemm multi-threaded.  A id√©ia √© a seguinte: uma matriz grande √© dividida em sub-blocos e, em seguida, h√° uma multiplica√ß√£o dessas pequenas matrizes.  N√≥s escrevemos um gemm com o OpenMP, mas n√£o funcionou, os erros travaram.  Pegamos um pool manual de threads, a paraleliza√ß√£o deu 0,33 segundos por quadro. <br><br>  Em seguida, recebemos acesso remoto a um servidor mais poderoso com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Elbrus 8C</a> , cuja velocidade aumentou para 0,2 segundos por quadro. <br><br>  O v√≠deo a seguir mostra o trabalho do suporte de demonstra√ß√£o com reconhecimento de rosto em um computador Elbrus 401-PC com um processador Elbrus 4C: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/iNMRKQqNM1Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Conclus√µes e planos futuros </h3><br><ul><li>  Trabalhamos n√£o apenas com reconhecimento de rosto, mas em princ√≠pio uma estrutura de rede neural, para que possamos coletar qualquer detector, classificador e execut√°-lo no Elbrus. </li><li>  Reunimos um stand de demonstra√ß√£o com a Web-UI para demonstrar o reconhecimento facial no PuzzleLib. <br></li><li>  O reconhecimento de rosto no Elbrus j√° √© r√°pido o suficiente para tarefas pr√°ticas, e voc√™ pode aceler√°-lo, se necess√°rio. </li><li>  Voc√™ pode trabalhar com Elbrus.  Costum√°vamos trabalhar com processadores ex√≥ticos - por exemplo, com processadores russos tensores ainda em desenvolvimento, com placas de v√≠deo AMD e seus softwares.  Tudo n√£o √© t√£o bom e simples l√°.  Ou seja, se usarmos a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MI Open</a> da AMD, essa √© uma biblioteca muito mal escrita, na qual nem todas as combina√ß√µes de passada, preenchimento e tamanho de filtro levam a c√°lculos bem-sucedidos.  A qualidade das ferramentas da Elbrus √© boa - se voc√™ tem um projeto em Python, C ou C ++, execut√°-lo no Elbrus n√£o √© nada dif√≠cil. </li><li>  Tamb√©m √© importante notar que o trabalho de otimiza√ß√£o passo a passo sobre o qual falamos n√£o √© opera√ß√µes espec√≠ficas para trabalhar na Elbrus.  Essas s√£o opera√ß√µes padr√£o do processador multin√∫cleo.  Em nossa opini√£o, este √© um bom sinal de que o processador pode ser operado como um processador normal da Intel / NVIDIA. <br></li></ul><br><h4>  Planos: </h4><br><ul><li>  Como o Elbrus tem uma peculiaridade em ser um processador VLIW, algumas otimiza√ß√µes espec√≠ficas do Elbrus podem ser realizadas. <br></li><li>  Fa√ßa a quantiza√ß√£o (trabalhando com int8 em vez de float32), que economiza mem√≥ria e aumenta a velocidade.  Portanto, nesse caso, √© claro, pode haver uma diminui√ß√£o na qualidade dos c√°lculos - mas isso pode n√£o acontecer.  Percebemos os dois casos na pr√°tica. </li></ul><br>  Planejamos entender melhor, explorar os recursos do processador VLIW.  De fato, por enquanto, apenas confiamos no compilador, pois, se escrevermos um bom c√≥digo, o compilador o otimiza bem, porque conhece os recursos do Elbrus. <br><br>  Em geral, foi interessante, vamos entender mais.  Isso n√£o levou muito tempo - todas as opera√ß√µes de transfer√™ncia levaram um total de uma semana. <br><br>  Em janeiro de 2020, planejamos colocar o PuzzleLib em c√≥digo aberto, escreveremos mais sobre isso aqui =) <br>  Obrigado pela aten√ß√£o! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt469033/">https://habr.com/ru/post/pt469033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt469021/index.html">Desenvolvimento em um monoreposit√≥rio. Relat√≥rio Yandex</a></li>
<li><a href="../pt469023/index.html">Como encontrar um emprego com realoca√ß√£o para a Europa: um guia pr√°tico para profissionais de TI</a></li>
<li><a href="../pt469025/index.html">Arrefecer o vinho rapidamente! Inven√ß√£o russa</a></li>
<li><a href="../pt469027/index.html">Ivanovo! Mitap: Como construir uma carreira em Digital?</a></li>
<li><a href="../pt469031/index.html">12 nova intelig√™ncia artificial dos Servi√ßos de M√≠dia do Azure</a></li>
<li><a href="../pt469035/index.html">Novas inova√ß√µes baseadas em IA dos Servi√ßos de M√≠dia do Azure</a></li>
<li><a href="../pt469037/index.html">Controlador industrial. Sistema de coleta de dados. ACS</a></li>
<li><a href="../pt469039/index.html">Mais do que um jogo: dominar o Mahjong com IA e aprendizado de m√°quina</a></li>
<li><a href="../pt469041/index.html">Como proteger seu sistema ERP?</a></li>
<li><a href="../pt469043/index.html">C / C ++ de Python (API C)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>