<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úèÔ∏è üë®üèº‚Äç‚öñÔ∏è üë®üèø‚Äçüé® Windows PowerShell et longs chemins üìá ‚ûñ üßíüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je pense que vous, comme moi, avez souvent vu des chemins de la forme \ !!! Important \ ____ Nouveau ____ \ !!! Ne pas supprimer !!! \ Commande n ¬∞ 98...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Windows PowerShell et longs chemins</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457204/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/zi/hg/gi/zihggini2_o9_0eqdiwrnorr54k.jpeg"></a> <br><br>  Je pense que vous, comme moi, avez souvent vu des chemins de la forme <b>\ !!!</b>  <b>Important \ ____ Nouveau ____ \ !!!</b>  <b>Ne pas supprimer !!! \ Commande n ¬∞ 98819-649-B du 30 f√©vrier 1985</b>  <b>sur la nomination de Kozlov Ivan Aleksandrovich au poste de chef par int√©rim du d√©partement charg√© d'accompagner les clients VIP d'entreprise et d'organiser des r√©unions d'affaires en marge.doc</b> . <br><br>  Et souvent, ouvrir un tel document sous Windows ne fonctionne pas tout de suite.  Quelqu'un pratique la solution de contournement sous forme de mappage de disque, quelqu'un utilise des gestionnaires de fichiers qui peuvent travailler avec de longs chemins: Far Manager, Total Commander et autres.  Et beaucoup d'autres ont malheureusement regard√© la cr√©ation d'un script PS, ce qui repr√©sentait beaucoup de travail et fonctionnait dans un environnement de test avec fracas, dans un environnement de combat, se plaignant impuissant d'une t√¢che impossible: <i>le chemin sp√©cifi√©, le nom de fichier ou les deux sont trop longs .</i>  <i>Le nom de fichier complet doit contenir moins de 260 caract√®res et le nom du r√©pertoire doit contenir moins de 248 caract√®res.</i> <br>  Il s'est av√©r√© que 260 caract√®res suffisaient "non seulement pour tout le monde".  Si vous √™tes int√©ress√© √† aller au-del√† des limites de ce qui est autoris√© - je demande chat. <br><a name="habracut"></a><br>  Voici quelques-unes des tristes cons√©quences de limiter la longueur d'un chemin de fichier: <br><br><ul><li>  il y a un dossier sur le serveur, par exemple, D: \ Data \ Shared \ Accounting, qui est partag√© via SMB et est mont√© aux utilisateurs en tant que lecteur r√©seau S;  les utilisateurs cr√©ent des fichiers qui ne pourront pas lire les administrateurs / scripts avec un acc√®s local depuis le serveur, car  le chemin absolu est plus long que le chemin r√©seau; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">erreurs de synchronisation des profils itin√©rants</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®mes de r√©cup√©ration √† partir de clich√©s instantan√©s</a> ; </li><li>  lorsque les donn√©es sont migr√©es √† partir d'autres syst√®mes dans lesquels il y a des restrictions moins strictes sur la longueur du chemin, dans un nouvel environnement, certains d'entre eux deviendront inaccessibles sans danser avec un tambourin; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Donn√©es incorrectes lors du calcul de la taille et du nombre de fichiers dans les dossiers</a> ; </li><li>  etc ... </li></ul><br>  Un peu diff√©rent du sujet, je note que pour la r√©plication DFS, le probl√®me consid√©r√© dans l'article n'est pas terrible et les fichiers avec des noms longs voyagent avec succ√®s de serveur en serveur (√† moins, bien s√ªr, que vous ayez tout fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">correctement le</a> reste). <br><br>  Je voudrais √©galement attirer l'attention sur l'utilitaire tr√®s utile de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">photocopie qui</a> m'a aid√© plus d'une fois.  Elle aussi n'a pas peur des longs chemins et elle en sait beaucoup.  Par cons√©quent, si la t√¢che se r√©sume √† copier / transf√©rer des donn√©es de fichier, vous pouvez vous y arr√™ter.  Si vous avez besoin de chamaniser avec des listes de contr√¥le d'acc√®s au syst√®me de fichiers (DACL), regardez vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">subinacl</a> .  Malgr√© son √¢ge consid√©rable, il a montr√© d'excellents r√©sultats sur Windows 2012 R2.  Les m√©thodes d'application sont discut√©es ici. <br><br>  C'√©tait int√©ressant pour moi d'enseigner √† travailler avec PowerShell de mani√®re longue.  Avec lui presque comme dans une anecdote barbue sur Ivan Tsar√©vitch et Vasilisa la Belle. <br><br><h4>  Moyen rapide </h4><br>  Acc√©dez √† <s>Linux et ne faites pas</s> fonctionner Windows 10/2016/2019 et activez le param√®tre de strat√©gie de groupe correspondant / cliquez sur le registre.  Je ne m'attarderai pas sur cette m√©thode en d√©tail, car  il y a d√©j√† beaucoup d'articles sur le r√©seau sur ce sujet, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celui-ci</a> . <br><br>  √âtant donn√© que dans la plupart des entreprises, il existe de nombreuses versions de syst√®mes d'exploitation, ce n'est pas une nouvelle version des syst√®mes d'exploitation, cette m√©thode n'est rapide que pour l'√©criture sur papier, √† moins, bien s√ªr, que vous ne soyez de ceux qui ont peu de syst√®mes h√©rit√©s et r√®gnent Windows 10/2016/2019 . <br><br><h4>  Long chemin </h4><br>  Ici, nous r√©servons imm√©diatement que les modifications n'affecteront pas le comportement de l'Explorateur Windows, mais permettront d'utiliser de longs chemins dans les applets de commande PowerShell, telles que Get-Item, Get-ChildItem, Remove-Item, etc. <br><br>  Tout d'abord, mettez √† niveau PowerShell.  C'est fait un-deux-trois. <br><br><ol><li>  Nous mettons √† jour le .NET Framework vers une version non inf√©rieure √† 4.5.  Le syst√®me d'exploitation doit √™tre au moins Windows 7 SP1 / 2008 R2.  La version actuelle peut √™tre t√©l√©charg√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , lisez plus d'informations <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√©l√©chargez</a> et installez Windows Management Framework 5.1 </li><li>  Red√©marrez la voiture. </li></ol><br>  Les personnes assidues peuvent effectuer manuellement les √©tapes d√©crites ci-dessus, paresseuses - √† l'aide de SCCM, de politiques, de scripts et d' <s>enikys d'</s> autres outils d'automatisation. <br><br>  La version actuelle de PowerShell se trouve dans la variable <i>$ PSVersionTable</i> .  Apr√®s la mise √† jour, cela devrait ressembler √† ceci: <br><br><img src="https://habrastorage.org/webt/q_/cd/wg/q_cdwg2qzweozvyt2lz5jes4o2o.png"><br><br>  Maintenant, lorsque vous utilisez les applets de commande <i>Get-ChildItem</i> et similaires, au lieu du <i>chemin</i> habituel <i>,</i> nous utiliserons <i>LiteralPath</i> . <br><br>  Le format des chemins sera l√©g√®rement diff√©rent: <br><br><pre><code class="plaintext hljs">Get-ChildItem -LiteralPath "\\?\C:\Folder" Get-ChildItem -LiteralPath "\\?\UNC\ServerName\Share" Get-ChildItem -LiteralPath "\\?\UNC\192.168.0.10\Share"</code> </pre> <br>  Pour faciliter la conversion de chemins du format familier au format <i>LiteralPath</i> , <i>vous</i> pouvez utiliser cette fonction: <br><br><pre> <code class="plaintext hljs">Function ConvertTo-LiteralPath { Param([parameter(Mandatory=$true, Position=0)][String]$Path) If ($Path.Substring(0,2) -eq "\\") {Return ("\\?\UNC" + $Path.Remove(0,1))} Else {Return "\\?\$Path"} }</code> </pre><br>  Veuillez noter que vous ne pouvez pas utiliser de caract√®res g√©n√©riques ( <i>*</i> , <i>?</i> , Etc.) lors de la sp√©cification du param√®tre <i>LiteralPath</i> . <br><br>  En plus du param√®tre <i>LiteralPath</i> , dans la version mise √† jour de PowerShell, l'applet de <i>commande Get-ChildItem a</i> re√ßu le param√®tre <i>Depth</i> , avec lequel vous pouvez d√©finir la profondeur d'imbrication pour une recherche r√©cursive, je l'ai utilis√© plusieurs fois et j'√©tais satisfait. <br><br>  Maintenant, vous ne pouvez pas avoir peur que votre script PS s'√©gare et ne distingue pas les fichiers distants.  Par exemple, cette approche m'a beaucoup aid√© lors de l'√©criture d'un script pour supprimer l'attribut ¬´temporaire¬ª sur les fichiers des dossiers DFSR.  Mais c'est une autre histoire, que j'essaierai de raconter dans un autre article. <br>  <b>UPD 07/06/2019:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article promis</a> <br>  J'attends vos commentaires int√©ressants et je vous sugg√®re de r√©pondre √† une enqu√™te. <br><br>  <b>Liens utiles:</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docs.microsoft.com/en-us/dotnet/api/microsoft.powershell.commands.contentcommandbase.literalpath?view=powershellsdk-1.1.0</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-childitem?view=powershell-5.1</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stackoverflow.com/questions/46308030/handling-path-too-long-exception-with-new-psdrive/46309524</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">luisabreu.wordpress.com/2013/02/15/theliteralpath-parameter</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457204/">https://habr.com/ru/post/fr457204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457194/index.html">Airbus atteint de nouveaux sommets avec l'aide de la technologie de r√©alit√© mixte de Microsoft</a></li>
<li><a href="../fr457196/index.html">Petty little joy # 5: Dynaconf - gestion des param√®tres dans le projet</a></li>
<li><a href="../fr457198/index.html">Le r√©seau neuronal a appris √† dessiner des sc√®nes complexes √† partir d'une description textuelle</a></li>
<li><a href="../fr457200/index.html">Un robot de dessin pour r√©aliser des sc√®nes de tous les jours et m√™me des histoires</a></li>
<li><a href="../fr457202/index.html">Comment nous choisissons les id√©es pour le d√©veloppement de nos produits: le vendeur doit pouvoir entendre ...</a></li>
<li><a href="../fr457206/index.html">SQL Index Manager - une longue histoire sur SQL Server, les fouilles et la maintenance des index</a></li>
<li><a href="../fr457208/index.html">G√©n√©ration dynamique de robots.txt pour les sites ASP.NET Core en fonction de l'environnement</a></li>
<li><a href="../fr457210/index.html">Stockez des ressources statiques sur votre h√©bergement</a></li>
<li><a href="../fr457212/index.html">Pourquoi n'est-il jamais trop tard pour commencer √† apprendre Java (ou d'autres langages Java)</a></li>
<li><a href="../fr457224/index.html">Une approche moderne de la concurrence dans Android: Corotins chez Kotlin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>