<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚ÄçüöÄ üëáüèø üì≥ Zabbix: monitore tudo em uma fileira (no exemplo do Redis) üñ§ üë®üèæ‚Äçüé® ü§ì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Zabbix √© um √≥timo produto para administradores de grandes sistemas de software e hardware. √â t√£o bom que pode ser usado n√£o apenas por grandes empre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix: monitore tudo em uma fileira (no exemplo do Redis)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485538/"><p> <a href="https://www.zabbix.com/ru/" rel="nofollow">O Zabbix</a> √© um √≥timo produto para administradores de grandes sistemas de software e hardware.  √â t√£o bom que pode ser usado n√£o apenas por grandes empresas, mas tamb√©m por pequenas e m√©dias empresas, e at√© mesmo em um projeto para <code>pet</code> .  Em geral, tenho pouca experi√™ncia com o Zabbix e posso recomend√°-lo com seguran√ßa para uso. </p><br><p>  √â verdade que n√£o posso dizer que entendo a " <em>filosofia do Zabbix</em> ".  Apesar da extensa documenta√ß√£o detalhada em russo, foi dif√≠cil para mim mergulhar no mundo do Zabbix - tive a sensa√ß√£o de que os desenvolvedores e eu chamamos as mesmas coisas por nomes diferentes.  Talvez porque o Zabbix foi criado por administradores para administradores, mas ainda sou mais desenvolvedor e usu√°rio. </p><br><p>  No entanto, para executar o Zabbix e monitorar os principais par√¢metros dos sistemas de computador (processador, mem√≥ria, etc.), as habilidades de um usu√°rio regular do Linux s√£o suficientes.  H√° um grande n√∫mero de plug-ins de desenvolvedores de terceiros que ampliam os recursos do Zabbix.  Para minhas necessidades, eu precisava configurar o monitoramento do servidor Redis.  Examinei um pouco o c√≥digo dos plug-ins dispon√≠veis e, usando o exemplo deles, descobri que a arquitetura do Zabbix permite que voc√™ se conecte simplesmente ao monitoramento de quaisquer par√¢metros de sistemas de informa√ß√£o que possam ser expressos em forma num√©rica. </p><br><p>  Sob o gato - um exemplo de um plug-in do Zabbix com minha explica√ß√£o da terminologia do Zabbix.  Para alguns, este exemplo parecer√° ing√™nuo, mas para alguns, ser√° mais f√°cil se acostumar com os conceitos.  De qualquer forma, o Zabbix <a href="http://irinagold.pro/na-kogo-pohozh-slon-pritcha/" rel="nofollow">√© grande o suficiente</a> para senti-lo de diferentes √¢ngulos. </p><a name="habracut"></a><br><h1 id="bazovye-ponyatiya">  Conceitos b√°sicos </h1><br><p>  Brevemente sobre alguns dos conceitos usados ‚Äã‚Äãno Zabbix: <em>agentes</em> , <em>itens</em> , <em>gatilhos</em> , <em>a√ß√µes</em> , <em>notifica√ß√µes</em> , <em>modelos</em> . </p><br><h2 id="server-i-agenty">  Servidor e agentes </h2><br><p>  Do ponto de vista do usu√°rio, o Zabbix √© dividido em duas grandes partes: servidor e agentes.  O servidor est√° localizado em uma m√°quina, que coleta e armazena dados estat√≠sticos e agentes nas m√°quinas nas quais os dados s√£o coletados: </p><br><p><img src="https://habrastorage.org/webt/22/cc/y2/22ccy2szuqjhs0eprqqxkn29-2e.png" alt="Servidor e agentes Zabbix"></p><br><h2 id="parametry-monitoringa">  Op√ß√µes de monitoramento </h2><br><p>  Qualquer quantidade que possa ser expressa em forma num√©rica ou de sequ√™ncia √© chamada na terminologia do Zabbix - um elemento de dados (item).  Cada elemento est√° associado a uma <a href="https://www.zabbix.com/documentation/current/ru/manual/config/items/item/key" rel="nofollow">chave</a> exclusiva (nome).  Aqui est√£o exemplos de itens de dados: </p><br><ul><li>  <strong>system.cpu.load [percpu, avg1]</strong> : 0.1167 </li><li>  <strong>system.uname</strong> : "Linux supru 4.15.0-50-generic # 54-Ubuntu SMP segunda-feira 6 de maio √†s 18:46:08 UTC 2019 x86_64" </li></ul><br><p>  Os valores desses elementos de dados (par√¢metros de monitoramento) s√£o anexados ao tempo; o hist√≥rico dos valores dos par√¢metros √© armazenado no banco de dados do servidor. </p><br><h2 id="sobytiya">  Eventos </h2><br><p>  Quando um evento ocorre no Zabbix, um gatilho √© acionado.  Por exemplo </p><br><ul><li>  <strong>{system.cpu.load [percpu, avg1] .avg (5m)}&gt; 10</strong> - o valor m√©dio do par√¢metro nos √∫ltimos 5 minutos excedeu "10" </li><li>  <strong>{system.uname.diff (0)}&gt; 0</strong> - o valor atual do par√¢metro n√£o √© igual ao valor anterior </li></ul><br><p>  De fato, gatilhos s√£o f√≥rmulas nas quais os par√¢metros de monitoramento (atuais e salvos) atuam como vari√°veis ‚Äã‚Äãe produzem <code>true</code> / <code>false</code> na sa√≠da. </p><br><h2 id="deystviya-i-opovescheniya">  A√ß√µes e alertas </h2><br><p>  No caso de um evento (gatilho), o servidor pode executar uma a√ß√£o.  Por exemplo, envie um alerta de email para um determinado endere√ßo (" <em>Problema: o host fica inacess√≠vel por 5 minutos</em> ").  Al√©m disso, uma a√ß√£o pode ser executada se o gatilho retornar ao seu estado original (" <em>Resolvido: o host est√° inacess√≠vel por 5 minutos</em> ").  Todos os eventos (comuta√ß√£o de gatilho) s√£o registrados no lado do servidor. </p><br><h2 id="shablony">  Padr√µes </h2><br><p>  O Zabbix possibilita configurar regras de monitoramento para um host individual, al√©m de criar um modelo de regra (modelo) que pode ser aplicado a v√°rios hosts: </p><br><p><img src="https://habrastorage.org/webt/4t/yt/qw/4tytqw7tog1do4nsqoizzxjbglw.png" alt="modelos do zabbix"></p><br><p>  O exemplo mostra que o modelo "Servi√ßo SSH do aplicativo de modelo" descreve um aplicativo (Aplicativos), um par√¢metro de monitoramento (Itens), um gatilho (Disparadores).  Tamb√©m est√£o dispon√≠veis descri√ß√µes de gr√°ficos, telas, regras de descoberta e scripts da web. </p><br><h1 id="postanovka-zadachi-dlya-plagina">  Configurando a Tarefa para o Plug-in </h1><br><h2 id="nachalnoe-polozhenie">  Posi√ß√£o inicial </h2><br><p>  O pr√≥prio Zabbix oferece seu <a href="https://www.zabbix.com/ru/integrations/redis" rel="nofollow">pr√≥prio plugin</a> para monitorar o status do Redis, mas na minha vers√£o do servidor (4.2.8) eu n√£o consegui us√°-lo (plugin para a vers√£o 4.4 e superior).  <a href="https://www.zabbix.com/ru/integrations/redis" rel="nofollow">Solu√ß√µes de terceiros</a> tamb√©m s√£o oferecidas (cerca de uma d√∫zia de op√ß√µes para v√°rias vers√µes do Zabbix, existem apenas as tr√™s primeiras na imagem): </p><br><p><img src="https://habrastorage.org/webt/bv/pt/tk/bvpttkxf9lkxqn2thcnwwacutyw.png" alt="Plugins redis para zabbix"></p><br><p>  Cada um deles tinha suas pr√≥prias vantagens e desvantagens, tinha que olhar para dentro para escolher.  O melhor, na minha opini√£o, foi o <a href="https://github.com/Shakeeljaveed/zabbix-redis-userparamaters" rel="nofollow">plugin Shakeeljaveed / zabbix-redis-userparamaters</a> , que consistia em dois arquivos: </p><br><ul><li>  README.md </li><li>  redis-userparameter.conf </li></ul><br><p>  Eu tive que trabalhar um pouco de "canetas", mas no exemplo dele ficou um pouco mais claro como os dados do agente v√£o para o servidor.  Por sugest√£o do autor <a href="https://github.com/Shakeeljaveed" rel="nofollow">Javeed Shakeel, o</a> estado <a href="https://github.com/Shakeeljaveed" rel="nofollow">de Redis</a> foi redefinido a cada 2 minutos pela coroa para o <code>/tmp/redismetric</code> : </p><br><pre> <code class="plaintext hljs">*/2 * * * * /usr/bin/redis-cli info &gt; /tmp/redismetric</code> </pre> <br><p>  E ent√£o cada par√¢metro de monitoramento foi extra√≠do pelo agente do <code>/tmp/redismetric</code> usando as ferramentas do pr√≥prio sistema operacional.  As instru√ß√µes para isso foram colocadas na configura√ß√£o do agente Zabbix <code>/etc/zabbix/zabbix_agent.conf.d/userparameter_redis.conf</code> .  Por exemplo, √© assim que as instru√ß√µes para recuperar o par√¢metro <code>used_memory</code> (uso de mem√≥ria pelo servidor Redis) s√£o assim: </p><br><pre> <code class="plaintext hljs">UserParameter=used_memory,grep -w 'used_memory' /tmp/redismetric | cut -d: -f2</code> </pre> <br><p>  Ou seja, no <code>/tmp/redismetric</code> com a sa√≠da do <code>redis-cli INFO</code> , a cadeia de caracteres ( <code>grep -w ...</code> ) √© pesquisada pela chave <code>used_memory</code> </p><br><pre> <code class="plaintext hljs">used_memory:7153216</code> </pre> <br><p>  que √© dividido em colunas pelo separador ":" ( <code>cut -d: -f2</code> ).  Na sa√≠da, o agente recebe o n√∫mero <code>7153216</code> e o atribui ao par√¢metro <code>used_memory</code> . </p><br><p>  Resta configurar o servidor por meio da interface baseada na Web para que periodicamente envie solicita√ß√µes ao agente para receber dados usando o par√¢metro <code>used_memory</code> , ap√≥s o qual os dados come√ßam a ser <code>used_memory</code> no servidor, armazenados no banco de dados, voc√™ pode us√°-lo para criar gr√°ficos e criar acionadores que respondem a altera√ß√µes nesse par√¢metro. </p><br><h2 id="cel">  Finalidade </h2><br><p>  A tarefa de monitorar o status de qualquer sistema n√£o √© apenas a coleta de estat√≠sticas, mas tamb√©m um aviso sobre a ocorr√™ncia de situa√ß√µes que requerem interven√ß√£o humana.  Como trabalho com o Redis como um usu√°rio muito novato, tive que procurar informa√ß√µes sobre quais par√¢metros de "sa√∫de" prestar aten√ß√£o e o que eles significam.  O artigo mais valioso foi " <a href="https://scalegrid.io/blog/6-crucial-redis-monitoring-metrics/" rel="nofollow">6 m√©tricas cruciais para o monitoramento de redis que voc√™ precisa observar</a> ".  Depois de analis√°-lo, cheguei √† conclus√£o de que "para a felicidade completa" eu preciso coletar dados para detectar os seguintes eventos: </p><br><ul><li>  Fragmenta√ß√£o da mem√≥ria: used_memory_rss / used_memory&gt; 1.5 </li><li>  Baixa taxa de acertos do cache: (keyspace_hits) / (keyspace_hits + keyspace_misses) &lt;0.8 </li><li>  Conex√µes rejeitadas: conex√µes_ rejeitadas&gt; 0 </li><li>  Chaves despejadas: evicted_keys&gt; 0 </li></ul><br><p>  Eu tamb√©m queria coletar estat√≠sticas sobre par√¢metros adicionais (vers√£o Redis, tempo de atividade etc.).  Em geral, tendo uma id√©ia geral de como os dados s√£o coletados pelo agente e transmitidos ao servidor, a Lista de desejos pode ser bastante limitada.  Como resultado, obtivemos uma lista de par√¢metros para monitoramento de 12 posi√ß√µes. </p><br><h1 id="sozdanie-sobstvennogo-plagina">  Crie seu pr√≥prio plugin </h1><br><h2 id="parametry-monitoringa-1">  Op√ß√µes de monitoramento </h2><br><p>  O plug-in que analisei assumiu a execu√ß√£o de um comando separado para obter um par√¢metro separado (item de dados, item): </p><br><pre> <code class="plaintext hljs">grep -w 'used_memory' /tmp/redismetric | cut -d: -f2</code> </pre> <br><p>  Ou seja, para obter dados sobre 12 par√¢metros, o agente precisar√° executar v√°rios conjuntos de comandos 12 vezes.  E se eu precisar monitorar par√¢metros dif√≠ceis de extrair por uma cadeia de comandos e precisar escrever um shell script separado ou um programa completo?  Para essa "Lista de desejos", o Zabbix oferece uma variante com elementos de dados dependentes.  Sua ess√™ncia √© que, no lado do agente, o script forma um conjunto de dados (por exemplo, no formato JSON), que √© transmitido ao servidor como um par√¢metro de sequ√™ncia.  Em seguida, no lado do servidor, os dados recebidos s√£o analisados ‚Äã‚Äãe par√¢metros elementares individuais s√£o extra√≠dos deles. </p><br><h3 id="osnovnoy-element-dannyh">  Item de dados principal </h3><br><p>  Descrevi o principal <code>redis.info</code> dados <code>redis.info</code> tipo de sequ√™ncia com um per√≠odo de atualiza√ß√£o de 1 min, sem salvar o hist√≥rico de altera√ß√µes: </p><br><p><img src="https://habrastorage.org/webt/hz/_m/tn/hz_mtnfj7n2uqzbssnnsdhtpgq4.png" alt="base de itens"></p><br><p>  Presumivelmente, o seguinte JSON deve ser gerado no lado do agente: </p><br><pre> <code class="plaintext hljs">{ "version": "4.0.9", "uptime": 1897336, "used_memory": 1054943416, "used_memory_rss": 1138159616, "keyspace_hits": 75810274, "keyspace_misses": 13545949, "connected_clients": 15, "rdb_last_save_time": 1580126954, "total_connections_received": 1258614, "rejected_connections": 0, "expired_keys": 60270, "evicted_keys": 0 }</code> </pre> <br><p>  ap√≥s o qual esse texto deve ser <code>redis.info</code> ao servidor como um <code>redis.info</code> dados <code>redis.info</code> , mas n√£o salvo, mas serve como base para outros elementos de dados (par√¢metros de monitoramento). </p><br><h3 id="zavisimyy-element-dannyh">  Item de dados dependente </h3><br><p>  O par√¢metro de teste <code>redis.info.version</code> depende de <code>redis.info</code> e armazena seus valores no banco de dados por 90 dias.  A frequ√™ncia do monitoramento de par√¢metros depende do elemento base ( <code>redis.info</code> ): </p><br><p><img src="https://habrastorage.org/webt/eu/3u/jy/eu3ujyhzzyful-jrh8ceyqxsoz4.png" alt="item dependente (base)"></p><br><p>  O <code>redis.info.version</code> par√¢metro <code>redis.info.version</code> √© recuperado do valor redis.info usando as instru√ß√µes JSONPath: </p><br><p><img src="https://habrastorage.org/webt/pn/3j/ad/pn3jad7k78sxnpq7pl1ubne9btk.png" alt="item dependente (pr√©-processo)"></p><br><p>  Um esquema semelhante descreve os elementos de dados dependentes restantes (par√¢metros de monitoramento), que s√£o transmitidos na forma de JSON.  Aqui est√° um exemplo da descri√ß√£o do par√¢metro num√©rico <code>redis.info.used_memory</code> : </p><br><p><img src="https://habrastorage.org/webt/rh/_t/d8/rh_td8dczrfqa2ejsihinaobiho.png" alt="item de n√∫mero dependente (base)"></p><br><p>  Tudo √© bastante transparente, com exce√ß√£o do <code>Trend storage period</code> de <code>Units</code> e <code>Trend storage period</code> .  N√£o entendi o segundo ponto, deixei-o por padr√£o e as unidades de medida s√£o explicadas na <a href="https://www.zabbix.com/documentation/current/ru/manual/appendix/suffixes" rel="nofollow">documenta√ß√£o</a> .  Nesse caso, o valor de <code>redis.info.used_memory</code> √© medido em bytes e minimizado em kilo / mega / giga /...- bytes na interface da web. </p><br><p>  A f√≥rmula para extrair um valor de JSON √©: <code>JSONPath = $.used_memory</code> </p><br><h3 id="vychislyaemyy-element-dannyh">  Item de dados computados </h3><br><p>  Para calcular a fragmenta√ß√£o da mem√≥ria, a rela√ß√£o <code>used_memory_rss</code> / <code>used_memory</code> √© usada e, com base nisso, √© determinado um gatilho que dispara quando a taxa excede 1,5.  O Zabbix possui um tipo de elemento de dados calculado: </p><br><p><img src="https://habrastorage.org/webt/iy/sd/4g/iysd4g2bqofdmwrvp9cpbguzvzo.png" alt="item de c√°lculo"></p><br><p>  O valor do par√¢metro <code>redis.info.used_memory_ratio</code> calculado a cada minuto com base nos √∫ltimos valores de dois outros par√¢metros ( <code>redis.info.used_memory_rss</code> e <code>redis.info.used_memory</code> ), √© armazenado no banco de dados por 90 dias, etc. </p><br><h2 id="triggery">  Triggers </h2><br><p>  Aqui est√° um exemplo de um gatilho que dispara quando a mem√≥ria est√° muito fragmentada: </p><br><p><img src="https://habrastorage.org/webt/bl/81/oj/bl81ojowbfvanebjn9nefzoh29w.png"></p><br><p>  Nada incomum, exceto o formato de express√£o usado na f√≥rmula de altera√ß√£o do estado do acionador.  O Zabbix possui um designer de formul√°rios, voc√™ pode us√°-lo ou consultar a <a href="https://www.zabbix.com/documentation/current/ru/manual/config/triggers/expression" rel="nofollow">documenta√ß√£o</a> / exemplos (a lista de gatilhos est√° dispon√≠vel na interface da web em " <em>Configura√ß√£o / Modelos / $ {TemplateName} / Gatilhos</em> "). </p><br><p>  Um gatilho pode ser baseado em qualquer elemento de dados (item), independentemente do seu tipo (principal, dependente, calculado). </p><br><h2 id="nastroyka-agenta">  Configura√ß√£o do agente </h2><br><h3 id="generaciya-jsona">  Gera√ß√£o JSON </h3><br><p>  Para obter os valores dos par√¢metros de monitoramento e a forma√ß√£o do JSON, eu uso este script de shell: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash ## =========================================================================== # Script to generate Redis monitoring data in JSON format # for 'zabbix-agent'. ## =========================================================================== # collect working variables/data BIN_REDIS=$(whereis -b redis-cli | cut -d" " -f2) # /usr/bin/redis-cli DATA_INFO=$(${BIN_REDIS} INFO | tr -d '\r') # get info and remove trailing '\r' from output ## # Extract stats and save it into env. vars. ## # find lines with 'grep', cut second field after ":" and put it into env. variable: ITEM_VERSION=$(grep "^redis_version:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_UPTIME=$(grep "^uptime_in_seconds:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_USED_MEMORY=$(grep "^used_memory:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_USED_MEMORY_RSS=$(grep "^used_memory_rss:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_KEYSPACE_HITS=$(grep "^keyspace_hits:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_KEYSPACE_MISSES=$(grep "^keyspace_misses:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_CONNECTED_CLIENTS=$(grep "^connected_clients:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_RDB_LAST_SAVE_TIME=$(grep "^rdb_last_save_time:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_TOTAL_CONNECTIONS_RECEIVED=$(grep "^total_connections_received:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_REJECTED_CONNECTIONS=$(grep "^rejected_connections:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_EXPIRED_KEYS=$(grep "^expired_keys:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) ITEM_EVICTED_KEYS=$(grep "^evicted_keys:" &lt;&lt;&lt;"${DATA_INFO}" | cut -d: -f2) # compose output JSON for Zabbix server: echo -n "{" echo -n "\"version\": \"${ITEM_VERSION}\"," echo -n "\"uptime\": ${ITEM_UPTIME}," echo -n "\"used_memory\": ${ITEM_USED_MEMORY}," echo -n "\"used_memory_rss\": ${ITEM_USED_MEMORY_RSS}," echo -n "\"keyspace_hits\": ${ITEM_KEYSPACE_HITS}," echo -n "\"keyspace_misses\": ${ITEM_KEYSPACE_MISSES}," echo -n "\"connected_clients\": ${ITEM_CONNECTED_CLIENTS}," echo -n "\"rdb_last_save_time\": ${ITEM_RDB_LAST_SAVE_TIME}," echo -n "\"total_connections_received\": ${ITEM_TOTAL_CONNECTIONS_RECEIVED}," echo -n "\"rejected_connections\": ${ITEM_REJECTED_CONNECTIONS}," echo -n "\"expired_keys\": ${ITEM_EXPIRED_KEYS}," echo -n "\"evicted_keys\": ${ITEM_EVICTED_KEYS}" echo -n "}"</span></span></code> </pre> <br><p>  <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> esse script no arquivo <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> no servidor com Redis, no qual o agente Zabbix j√° est√° instalado.  O usu√°rio sob o qual o agente Zabbix √© <code>zabbix</code> (geralmente <code>zabbix</code> ) deve ter permiss√£o para executar o arquivo <code>get_info.sh</code> . </p><br><h2 id="fayl-userparameter_xxxconf">  Arquivo <code>userparameter_XXX.conf</code> </h2><br><p>  No lado do agente, par√¢metros de monitoramento adicionais s√£o <code>userparameter_*.conf</code> no par√¢metro do <code>userparameter_*.conf</code> arquivos no diret√≥rio <code>userparameter_*.conf</code> .  Portanto, para que o agente descubra como ele precisa coletar dados no par√¢metro <code>redis.info</code> , criei o arquivo <code>/etc/zabbix/zabbix_agentd.d/userparameter_redis.conf</code> com o seguinte conte√∫do: </p><br><pre> <code class="plaintext hljs">UserParameter=redis.info,/var/lib/zabbix/user_parameter/redis/get_info.sh</code> </pre> <br><p>  Ou seja, para obter dados no par√¢metro <code>redis.info</code> agente deve executar o script <code>/var/lib/zabbix/user_parameter/redis/get_info.sh</code> e transferir o resultado da execu√ß√£o para o servidor. </p><br><p>  Ap√≥s reiniciar o agente Zabbix ( <code>sudo service zabbix-agent restart</code> ), torna-se poss√≠vel coletar dados para o par√¢metro <code>redis.info</code> e envi√°-los ao servidor. </p><br><h1 id="rezyume">  Sum√°rio </h1><br><p>  Compreender o Zabbix veio at√© mim (e ainda vem) bastante dif√≠cil.  No entanto, considero uma √≥tima ferramenta, especialmente ap√≥s a simplicidade de adicionar meus pr√≥prios par√¢metros de monitoramento (elementos de dados) abertos para mim.  Em geral, basta adicionar um arquivo ao servidor com o agente ( <code>userparameter_XXX.conf</code> ) com um comando shell para coletar dados e configurar o servidor Zabbix para receber esses dados pela interface da web.  E √© isso - voc√™ pode acumular dados, criar gr√°ficos, analisar altera√ß√µes e criar um gatilho que responda a essas altera√ß√µes. </p><br><p>  O c√≥digo do modelo, o arquivo <code>userparameter_redis.conf</code> e o script <code>get_info.sh</code> podem ser visualizados no <a href="https://github.com/flancer32/zabbix_plugin_redis/tree/habr" rel="nofollow">projeto flancer32 / zabbix_plugin_redis</a> . </p><br><p>  Obrigado a todos que leram at√© o fim e, especialmente, √†queles que encontraram algo √∫til para si na publica√ß√£o. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485538/">https://habr.com/ru/post/pt485538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485528/index.html">Como finalizar um projeto de desenvolvimento de software da maneira certa</a></li>
<li><a href="../pt485530/index.html">Aprendizagem Guiada</a></li>
<li><a href="../pt485532/index.html">Guia de Entrevistas para programadores que n√£o os entendem</a></li>
<li><a href="../pt485534/index.html">HighLoad ++, Mikhail Makurov (Intersvyaz): experi√™ncia na cria√ß√£o de um servi√ßo Zabbix de backup e em cluster</a></li>
<li><a href="../pt485536/index.html">√â poss√≠vel invadir um avi√£o - 2</a></li>
<li><a href="../pt485542/index.html">Adicionar gr√°ficos ao No√ß√£o</a></li>
<li><a href="../pt485544/index.html">O xadrez como um sistema din√¢mico</a></li>
<li><a href="../pt485546/index.html">O apocalipse est√° chegando</a></li>
<li><a href="../pt485548/index.html">SwiftUI nas prateleiras</a></li>
<li><a href="../pt485550/index.html">Existe vida al√©m do anel vi√°rio de Moscou? Como buscamos e preparamos desenvolvedores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>