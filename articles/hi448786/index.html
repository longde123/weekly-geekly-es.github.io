<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪгЁЯП╝ ЁЯХ╢я╕П ЁЯдЩЁЯП╛ рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░реАрдХреНрд╖рдгред рдЕрдзреНрдпрд╛рдп 3 рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░ ЁЯд▓ЁЯП╝ ЁЯСиЁЯП╗тАНтЬИя╕П ЁЯеС</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкреАрдЫреЗ рдЕрдЧрд▓рд╛ 


 рдпрд╣ рдкреБрд╕реНрддрдХ рдЧрд╛рдпрдм рдЕрдзреНрдпрд╛рдп рд╣реИ рдЬреЛ рд╣рд░ рд╡реНрдпрд╛рдкрдХ рдкрд╛рдпрдерди рдкреБрд╕реНрддрдХ рд╕реЗ рдЧрд╛рдпрдм рд╣реИред 


 рдлреНрд░реИрдВрдХ рдмрд░реНрдмрд╛рдж 
 рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рд╕рд╛рдЗрдЯ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдЗрдВрдЬреАрдирд┐рдпрд░, рдмреЙрдХреНрд╕, рдЗрдВрдХред 



...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░реАрдХреНрд╖рдгред рдЕрдзреНрдпрд╛рдп 3 рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448786/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреАрдЫреЗ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдЧрд▓рд╛</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  рдпрд╣ рдкреБрд╕реНрддрдХ рдЧрд╛рдпрдм рдЕрдзреНрдпрд╛рдп рд╣реИ рдЬреЛ рд╣рд░ рд╡реНрдпрд╛рдкрдХ рдкрд╛рдпрдерди рдкреБрд╕реНрддрдХ рд╕реЗ рдЧрд╛рдпрдм рд╣реИред </p><br><p>  рдлреНрд░реИрдВрдХ рдмрд░реНрдмрд╛рдж <br>  рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рд╕рд╛рдЗрдЯ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдЗрдВрдЬреАрдирд┐рдпрд░, рдмреЙрдХреНрд╕, рдЗрдВрдХред </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЙрджрд╛рд╣рд░рдг Python 3.6 рдФрд░ pytest 3.2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдЦреЗ рдЧрдП рд╣реИрдВред  рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ 3.2 рдкрд╛рдпрдерди 2.6, 2.7 рдФрд░ рдкрд╛рдпрдерди 3.3+ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ </p><br><blockquote> рдЯрд╛рд╕реНрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рд╕реНрд░реЛрдд рдХреЛрдб, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП, рдкреБрд╕реНрддрдХ рдХреЗ рд╡реЗрдм рдкреЗрдЬ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">рд▓рд┐рдВрдХ</a> рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред  рдкрд░реАрдХреНрд╖рдг рдХреЛрдб рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╕реНрд░реЛрдд рдХреЛрдб рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ;  рдкрд░реАрдХреНрд╖рдг рдХреЛрдб рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╛ рдЕрдкрдиреА рдЦреБрдж рдХреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░реЗрдВ (рдЖрдкрдХреЗ рд╣рд╛рде рдЕрдирдЯреВрдЯ рд╣реЛ рдЧрдП рд╣реИрдВ!), рдЖрдкрдХреЛ рдкреБрд╕реНрддрдХ рдХреЗ рд╡реЗрдм рдкреЗрдЬ рдкрд░ рдЬрд╛рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдХрд╛рдо рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рд╡рд╣рд╛рдБ, рдкреБрд╕реНрддрдХ рдХреЗ рд╡реЗрдм рдкреЗрдЬ рдкрд░, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" title="https://pragprog.com/titles/bopytest/errata">рдЗрд░реЗрдЯрд╛</a> рд╕рдВрджреЗрд╢реЛрдВ рдФрд░ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" title="https://forums.pragprog.com/forums/438">рдЪрд░реНрдЪрд╛ рдордВрдЪ рдХреЗ</a> рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рд╣реИред </blockquote><p>  рд╕реНрдкреЙрдЗрд▓рд░ рдХреЗ рддрд╣рдд рдЗрд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рд▓реЗрдЦреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рд╕рд╛рдордЧреНрд░реА рдХреА рддрд╛рд▓рд┐рдХрд╛</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдкрд░рд┐рдЪрдп</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 1: рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рд╕реЗ рд╢реБрд░реВ рд╣реЛ рд░рд╣рд╛ рд╣реИ</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 2: рдЯреЗрд╕реНрдЯ рдлрд╝рдВрдХреНрд╢рдВрд╕ рд▓рд┐рдЦрдирд╛</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 3: рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░</strong></a> (рдпрд╣ рд▓реЗрдЦ) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 4: рдмрд┐рд▓рд┐рди рдлрд┐рдХреНрд╕реНрдЪрд░</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 5: рдкреНрд▓рдЧрдЗрдиреНрд╕</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 6: рд╡рд┐рдиреНрдпрд╛рд╕</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>рдЕрдзреНрдпрд╛рдп 7: рдЕрдиреНрдп рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде pytest рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛</strong></a> </li></ul></div></div><br><p>  рдЕрдм рдЬрдм рдЖрдкрдиреЗ рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рджреЗрдЦреА рд╣реИрдВ, рддреЛ рд╣рдо рдЕрдкрдирд╛ рдзреНрдпрд╛рди рдЙрди рдлрд┐рдХреНрд╕реНрдЪрд░ рдХреА рдУрд░ рдореЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬреЛ рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдЧреИрд░-рддреБрдЪреНрдЫ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХреЛрдб рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред  рдлрд┐рдХреНрд╕реНрдЪрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкрд░реАрдХреНрд╖рдг рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ рдкрд╣рд▓реЗ (рдФрд░ рдХрднреА-рдХрднреА рдХреЗ рдмрд╛рдж) рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдп рд╣реИрдВред  рдлрд╝рд┐рдХреНрдЪрд░ рдХреЛрдб рдЖрдкрдХреЛ рдЬреЛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рд╕реЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдк рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рд╕реА рдЬреНрдЮрд╛рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХрдИ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдпрд╣рд╛рдБ рдПрдХ рд╕рд░рд▓ рд╕реНрдерд┐рд░рддрд╛ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдЬреЛ рдПрдХ рдирдВрдмрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИ: </p><br><blockquote> <strong>ch3 / <code>test_fixtures.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">import pytest @pytest.fixture() def some_data(): """Return answer to ultimate question.""" return 42 def test_some_data(some_data): """Use fixture return value in a test.""" assert some_data == 42</code> </pre> <br><p>  <code>@pytest.fixture()</code> рдбреЗрдХреЛрд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ pytest рдХреЛ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдлрд┐рдХреНрд╕реЗрдЯрд░ рд╣реИред  рдЬрдм рдЖрдк рдкрд░реАрдХреНрд╖рдг рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реВрдЪреА рдореЗрдВ рд╕реНрдерд┐рд░рддрд╛ рдирд╛рдо рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдЬрд╛рдирддрд╛ рд╣реИ рдХрд┐ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕реЗ рдХреИрд╕реЗ рдЪрд▓рд╛рдирд╛ рд╣реИред  рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рд╡реЗ рдПрдХ рдкрд░реАрдХреНрд╖рдг рд╕рдорд╛рд░реЛрд╣ рдореЗрдВ рдбреЗрдЯрд╛ рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  <code>test_some_data()</code> рдкрд░реАрдХреНрд╖рдг рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ <code>some_data</code> рдирд╛рдо <code>some_data</code> ред  рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдЧрд╛ рдФрд░ рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдЬреБрдбрд╝рд╛рд╡ рдЦреЛрдЬреЗрдЧрд╛ред  рдкрд╛рдЗрд╕реНрдЯ рдореЗрдВ рдирд╛рдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред  Pytest рдкрд░реАрдХреНрд╖рдг рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдерд┐рд░рддрд╛ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдЧрд╛ред  рдЕрдЧрд░ рд╡рд╣ рдЗрд╕рдореЗрдВ рдирд╣реАрдВ <em>рдорд┐рд▓рддрд╛ рд╣реИ</em> рддреЛ рд╡рд╣ рднреА <em>conftest.py</em> рдореЗрдВ рдЦреЛрдЬ рдХрд░реЗрдЧрд╛ред </p><br><p>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдЬреБрдбрд╝рдирд╛рд░ (рдФрд░ conftest.py рдлрд╝рд╛рдЗрд▓) рдкрд░ рдЕрдкрдирд╛ рд╢реЛрдз рд╢реБрд░реВ рдХрд░реЗрдВ, рдореБрдЭреЗ рдЗрд╕ рддрдереНрдп рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╢рдмреНрдж рдирд┐рд░реНрдзрд╛рд░рдг рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдФрд░ рдкрд░реАрдХреНрд╖рдг рд╕рдореБрджрд╛рдп рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдкрд╛рдпрдерди рд╕рдореБрджрд╛рдп рдореЗрдВ рдХрдИ рдЕрд░реНрде рд╣реИрдВред  рдореИрдВ рдЗрд╕ рдЕрдзреНрдпрд╛рдп рдореЗрдВ рд╡рд░реНрдгрд┐рдд <code>@pytest.fixture()</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>fixture</code> , <code>fixture function</code> , рдФрд░ <code>fixture method</code> рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рд╕реНрдерд┐рд░рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рд╕реНрдерд┐рд░рддрд╛ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдлрд┐рдХреНрд╕реНрдЪрд░ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдЕрдХреНрд╕рд░ рдХреБрдЫ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдпрд╛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХрднреА-рдХрднреА рдпрд╣ рдбреЗрдЯрд╛ рд╕реНрдерд┐рд░рддрд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, Django рд╕рдореБрджрд╛рдп рдЕрдХреНрд╕рд░ рдХреБрдЫ рдХрдЪреНрдЪреЗ рдбреЗрдЯрд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рдЕрдиреНрдп рдЕрд░реНрдереЛрдВ рдХреЗ рдмрд╛рд╡рдЬреВрдж, pytest рдореЗрдВ рдФрд░ рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ, рдкрд░реАрдХреНрд╖рдг рдлрд┐рдХреНрд╕реНрдЪрд░ рдЙрд╕ рддрдВрддреНрд░ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ pytest рдЖрдкрдХреЗ рдкрд░реАрдХреНрд╖рдг рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ "рдХреЛрдб рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░" рдФрд░ "рд╕рдлрд╛рдИ рдХреЗ рдмрд╛рдж" рдХреЛрдб рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </p><br><p>  pytest рдЬреБрдбрд╝рдирд╛рд░ рдЕрджреНрд╡рд┐рддреАрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ рдЬреЛ рдЕрдиреНрдп рдкрд░реАрдХреНрд╖рдг рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдкрд░ pytest рдмрдврд╝рд╛рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдмрд╣реБрдд рд╕реЗ рд╕рдореНрдорд╛рдирд┐рдд рд▓реЛрдЧ рд╕реНрд╡рд┐рдЪ рдХрд░рддреЗ рд╣реИрдВ ... рдФрд░ pytest рдХреЗ рд╕рд╛рде рд░рд╣рддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдореЗрдВ рдЬреБрдбрд╝рдирд╛рд░, Django рдореЗрдВ рдЬреБрдбрд╝рдирд╛рд░ рд╕реЗ рдЕрд▓рдЧ рд╣реИрдВ рдФрд░ рдПрдХрддрд░рдлрд╛ рдФрд░ рдирд╛рдХ рдореЗрдВ рдкрд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реЗрдЯрдЕрдк рдФрд░ рдлрд╛рдбрд╝ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рд╕реЗ рдЕрд▓рдЧ рд╣реИрдВред  рдЬреБрдбрд╝рдирд╛рд░ рдХреА рдмрд╛рдд рдЖрддреА рд╣реИ, рддреЛ рдХрдИ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рдФрд░ рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рд╣реИрдВред  рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдПрдХ рдЕрдЪреНрдЫрд╛ рдорд╛рдирд╕рд┐рдХ рдореЙрдбрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдмреЗрд╣рддрд░ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВрдЧреЗред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдкрдХреЛ рдбреНрд░рд╛рдЗрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП рдЙрдирдХреЗ рд╕рд╛рде рдЦреЗрд▓рдирд╛ рд╣реЛрдЧрд╛, рддреЛ рдЪрд▓рд┐рдП рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </p><br><h2 id="obmen-fixtures-cherez-conftestpy">  Conftest.py рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреБрдбрд╝рдирд╛рд░ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ </h2><br><p>  рдЖрдк рдЬреБрдбрд╝рдирд╛рд░ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХрдИ рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЬреБрдбрд╝рдирд╛рд░ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЗрдВрджреНрд░реАрдп рд╕реНрдерд╛рди рдкрд░, рдХрд╣реАрдВ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ <em>рдХреЙрдиреНрдЯреЗрд╕реНрдЯрд╕реНрдЯреЗрдо</em> рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реЛрддрд╛ рд╣реИред  рдХрд┐рд╕реА рдХрд╛рд░реНрдп рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП, рд╕рднреА рдлрд┐рдХреНрд╕реНрдЪрд░ <code>tasks_proj/tests/conftest.py</code> ред </p><br><p>  рд╡рд╣рд╛рдВ рд╕реЗ, рдЬреБрдбрд╝рдирд╛рд░ рдХрд┐рд╕реА рднреА рдЖрдЯреЗ рд╕реЗ рд╕рд╛рдЭрд╛ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдП, рддреЛ рдЖрдк рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЬреБрдбрд╝рдирд╛рд░ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕реА рддрд░рд╣, рдЖрдкрдХреЗ рдкрд╛рд╕ <em>рд╢реАрд░реНрд╖ рдкрд░реАрдХреНрд╖рдг</em> рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЕрдиреНрдп <em>conftest.py</em> рдлрд╛рдЗрд▓реЗрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред  рдпрджрд┐ рдЖрдк рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп conftest.py рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЬреБрдбрд╝рдирд╛рд░ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдФрд░ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрдВрдЧреЗред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рддрдХ рдЯрд╛рд╕реНрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд┐рд╕реА рднреА рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдкрд░реАрдХреНрд╖рдг рдХреЗ рдореВрд▓ рдореЗрдВ <em>conftest.py</em> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╣рдорд╛рд░реЗ рд╕рднреА рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, <code>tasks_proj/tests</code> , рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред </p><br><p>  рд╣рд╛рд▓рд╛рдБрдХрд┐ conftest.py рдПрдХ рдкрд╛рдпрдерди рдореЙрдбреНрдпреВрд▓ рд╣реИ, рдЗрд╕реЗ рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЖрдпрд╛рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдХрдм рдЖрдпрд╛рдд рдЖрдпрд╛рдд рдордд рдХрд░реЛ!  Conftest.py рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╕реНрдерд╛рдиреАрдп рдкреНрд▓рдЧ-рдЗрди рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рд╣рдо рдЕрдзреНрдпрд╛рдп 5 рдореЗрдВ рдкреНрд▓рдЧ-рдЗрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред рдкреГрд╖реНрда 95 рдкрд░ "рдкреНрд▓рдЧ-рдЗрди"ред рдЕрднреА рдХреЗ рд▓рд┐рдП, <code>tests/conftest.py</code> рдХреЛ рдЙрд╕ рдЬрдЧрд╣ рдХреЗ рд░реВрдк рдореЗрдВ <code>tests/conftest.py</code> рдЬрд╣рд╛рдВ рд╣рдо рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред рдкрд░реАрдХреНрд╖рдг рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕рднреА рдкрд░реАрдХреНрд╖рдгред  рддреЛ рдЪрд▓реЛ рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рд╕рд╣реА рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>task_proj</code> рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдХреБрдЫ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЛ <code>task_proj</code> рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </p><br><h2 id="ispolzovanie--fixtures-dlya-setup-i-teardown">  рд╕реЗрдЯрдЕрдк рдФрд░ рдЯрд┐рдпрд░рдбрд╛рдЙрди рдХреЗ рд▓рд┐рдП рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h2><br><p>  рдХрд╛рд░реНрдп рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЕрдзрд┐рдХрд╛рдВрд╢ рдкрд░реАрдХреНрд╖рдг рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХрд╛рд░реНрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░, рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рдФрд░ рддреИрдпрд╛рд░ рд╣реИред  рдФрд░ рд╣рдореЗрдВ рдЕрдВрдд рдореЗрдВ рдХреБрдЫ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ рд╣реЛрдЧрд╛, рдЕрдЧрд░ рд╕рдлрд╛рдИ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдФрд░ рдЖрдкрдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рднреА рд╣реЛ рд╕рдХрддреА рд╣реИред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдЗрд╕рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдХреЛ рдЯрд╛рд╕реНрдХ рдХреЛрдб рдореЗрдВ <code>tasks.start_tasks_db(&lt;directory to store db\&gt;, 'tiny' or 'mongo')</code> <code>tasks.stop_tasks_db()</code> <code>tasks.start_tasks_db(&lt;directory to store db\&gt;, 'tiny' or 'mongo')</code> <code>tasks.stop_tasks_db()</code> <code>tasks.start_tasks_db(&lt;directory to store db\&gt;, 'tiny' or 'mongo')</code> рдФрд░ <code>tasks.stop_tasks_db()</code> ;  рд╣рдореЗрдВ рдмрд╕ рдЙрдиреНрд╣реЗрдВ рд╕рд╣реА рд╕рдордп рдкрд░ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рд╣рдореЗрдВ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, pytest рдореЗрдВ рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рд╕реНрдерд┐рд░рддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕реЗ tmpdir рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╣рдо рдЗрд╕реЗ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдлрд╛рдИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИред  рдпрд╣ рдЬрд╛рджреВ рдирд╣реАрдВ рд╣реИ, рд╕рдмрд╕реЗ рдЬрд┐рдЬреНрдЮрд╛рд╕реБ рд▓реЛрдЧреЛрдВ рд╕реЗ рд╕рд┐рд░реНрдл рдЕрдЪреНрдЫрд╛ рдХреЛрдбрд┐рдВрдЧ рдЕрднреНрдпрд╛рд╕ рд╣реИред  (рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ; рд╣рдо tmpdir рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВрдЧреЗ рдФрд░ рдкреГрд╖реНрда "71 рдкрд░ tmpdir рдФрд░ tmpdir_factory рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ tmpdir_factory рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд▓рд┐рдЦреЗрдВрдЧреЗред) </p><br><p>  рдЗрди рд╕рднреА рдШрдЯрдХреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдпрд╣ рд╕реНрдерд┐рд░рддрд╛ рдорд╣рд╛рди рдХрд╛рдо рдХрд░рддреА рд╣реИ: </p><br><blockquote>  <strong>ch3 / a / <code>tasks_proj</code> /tests/conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">import pytest import tasks from tasks import Task @pytest.fixture() def tasks_db(tmpdir): """    ,  .""" # Setup : start db tasks.start_tasks_db(str(tmpdir), 'tiny') yield #    # Teardown : stop db tasks.stop_tasks_db()</code> </pre> <br><p>  <em>Tmpdir рдХрд╛</em> рдорд╛рди рд╕реНрдЯреНрд░рд┐рдВрдЧ рдирд╣реАрдВ рд╣реИ - рдпрд╣ рдПрдХ рдРрд╕реА рд╡рд╕реНрддреБ рд╣реИ рдЬреЛ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ <code>start_tasks_db()</code> рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <code>str()</code> рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>start_tasks_db()</code> ред  рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдо рдЕрднреА рднреА TinyDB рдХреЗ рд▓рд┐рдП рдЫреЛрдЯреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред </p><br><p>  рдлрд╝рд┐рдХреНрдЪрд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рд╕реЗ рдкрд╣рд▓реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ <em>рдЙрдкрдЬ рд╣реИ</em> , рддреЛ рдпрд╣ рд╡рд╣реАрдВ рд░реБрдХ рдЬрд╛рдПрдЧрд╛, рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдг рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж <em>рдЙрдкрдЬ</em> рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЕрдЧрд▓реА рдкрдВрдХреНрддрд┐ред  рдЗрд╕рд▓рд┐рдП, <em>рдЙрдкрдЬ</em> рдХреЗ рдКрдкрд░ рдХреЛрдб рдХреЛ "рд╕реЗрдЯрдЕрдк" рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЛрдЪреЗрдВ, рдФрд░ рдХреЛрдб рдХреЗ рдмрд╛рдж <em>рдЙрдкрдЬ</em> рдХреЛ "рдлрд╛рдбрд╝" рдХреЗ рд░реВрдк рдореЗрдВред  <em>рдкреИрджрд╛рд╡рд╛рд░</em> "рдлрд╛рдбрд╝" рдХреЗ рдмрд╛рдж рдХреЛрдб рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рджреМрд░рд╛рди рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред  рд╣рдо рдЗрд╕ рд╕реНрдерд┐рд░рддрд╛ рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЖрдЗрдП рдЗрд╕ <code>tasks.add()</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдХрд┐рд╕реА рдХрд╛рд░реНрдп рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВред </p><br><blockquote>  ch3 / a / <code>tasks_proj</code> / рдкрд░реАрдХреНрд╖рдг / func / <code>test_add</code> .py </blockquote><br><pre> <code class="plaintext hljs">import pytest import tasks from tasks import Task def test_add_returns_valid_id(tasks_db): """tasks.add(&lt;valid task&gt;)    .""" # GIVEN    # WHEN    # THEN  task_id  int new_task = Task('do something') task_id = tasks.add(new_task) assert isinstance(task_id, int)</code> </pre> <br><p>  рдпрд╣рд╛рдВ рдореБрдЦреНрдп рдкрд░рд┐рд╡рд░реНрддрди рдпрд╣ рд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрдерд┐рд░рддрд╛ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рд╣рдордиреЗ рдкрд░реАрдХреНрд╖рдг рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ <code>tasks_db</code> рдЬреЛрдбрд╝рд╛ рд╣реИред  рдореБрдЭреЗ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <em>GIVEN / WHEN / THEN</em> рдкреНрд░рд╛рд░реВрдк (DANO / WHEN / AFTER) рдореЗрдВ рд╕рдВрд░рдЪрдирд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдкрд╕рдВрдж рд╣реИ, рдЦрд╛рд╕рдХрд░ рдЕрдЧрд░ рдпрд╣ рдХреЛрдб рд╕реЗ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИред  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реИред  рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ GIVEN рдЖрд░рдВрднреАрдХреГрдд db рдХрд╛рд░реНрдп рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ <code>tasks_db</code> рдЙрдкрдпреЛрдЧ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдХрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </p><br><hr><br><p>  рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХрд╛рд░реНрдп рд╕реНрдерд╛рдкрд┐рдд рд╣реИред </p><br><hr><br><p>  рд╣рдо рдЕрднреА рднреА рдЗрд╕ рдЕрдзреНрдпрд╛рдп рдореЗрдВ рдХрд╛рд░реНрдп рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рд▓рд┐рдЦ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ рдкрд╣рд▓реЗ рдЕрдзреНрдпрд╛рдп 2 рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдпрджрд┐ рдЖрдкрдиреЗ рдЗрд╕ рдЕрдзреНрдпрд╛рдп рдХреЛ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рд╣реИ, рддреЛ рд╕реАрдбреА рдХреЛрдб рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ;  <code>pip install ./tasks_proj/</code> ред / <code>pip install ./tasks_proj/</code> ред </p><br><hr><br><h2 id="trassirovka-fixture-execution-s-setup-show">  -рд╕реЗрдЯрдЕрдк-рд╢реЛ рдХреЗ рд╕рд╛рде рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдлрд┐рдХреНрд╕реЗрд╢рди рдирд┐рд╖реНрдкрд╛рджрди </h2><br><p>  рдпрджрд┐ рдЖрдк рдЕрдВрддрд┐рдо рдЦрдВрдб рд╕реЗ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдпрд╣ рдирд╣реАрдВ рджреЗрдЦ рдкрд╛рдПрдВрдЧреЗ рдХрд┐ рдХреМрди рд╕реЗ рдЬреБрдбрд╝рдирд╛рд░ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ $ pip install ./tasks_proj/ #      $ cd /path/to/code/ch3/a/tasks_proj/tests/func $ pytest -v test_add.py -k valid_id ===================== test session starts ====================== collected 3 items test_add.py::test_add_returns_valid_id PASSED ====================== 2 tests deselected ====================== ============ 1 passed, 2 deselected in 0.02 seconds ============</code> </pre> <br><p>  рдЬрдм рдореИрдВ рдлрд┐рдХреНрд╕реНрдЪрд░ рдбрд┐рдЬрд╛рдЗрди рдХрд░рддрд╛ рд╣реВрдВ, рддреЛ рдореБрдЭреЗ рдпрд╣ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрдмред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдЗрд╕ рддрд░рд╣ рдХреА рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдлреНрд▓реИрдЧ, <code>-- setup-show</code> рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╕рд┐рд░реНрдл рдпрд╣реА рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">$ pytest --setup-show test_add.py -k valid_id ============================= test session starts ============================= collected 3 items / 2 deselected test_add.py SETUP S tmpdir_factory SETUP F tmpdir (fixtures used: tmpdir_factory) SETUP F tasks_db (fixtures used: tmpdir) func/test_add.py::test_add_returns_valid_id (fixtures used: tasks_db, tmpdir, tmpdir_factory). TEARDOWN F tasks_db TEARDOWN F tmpdir TEARDOWN S tmpdir_factory =================== 1 passed, 2 deselected in 0.18 seconds ====================</code> </pre> <br><p>  рд╣рдорд╛рд░рд╛ рдкрд░реАрдХреНрд╖рдг рдордзреНрдп рдореЗрдВ рд╣реИ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрдк рдФрд░ рдЯреАрдПрдЖрд░рдбреАрдПрдЪрдИ рднрд╛рдЧ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  <code>test_add_returns_valid_id</code> рд╢реБрд░реВ рдХрд░рддреЗ <code>test_add_returns_valid_id</code> , рдЖрдк рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдкрд╣рд▓реЗ <code>tmpdir</code> рдиреЗ рдХрд╛рдо рдХрд┐рдпрд╛ред  рдФрд░ <code>tmpdir_factory</code> рдкрд╣рд▓реЗ <code>tmpdir_factory</code> ред  <code>tmpdir</code> рдЗрд╕реЗ рдПрдХ рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред </p><br><p>  рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рдирд╛рдореЛрдВ рдХреЗ рд╕рд╛рдордиреЗ <strong>рдПрдл</strong> рдФрд░ <strong>рдПрд╕</strong> рдХреНрд╖реЗрддреНрд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╕реНрдХреЛрдк рдХреЗ рд▓рд┐рдП <strong>рдПрдл</strong> рдФрд░ рд╕рддреНрд░ рд╕реНрдХреЛрдк рдХреЗ рд▓рд┐рдП <strong>рдПрд╕</strong> ред  рдореИрдВ рдкреГрд╖реНрда релрем рдкрд░ "рд╕реНрдХреЛрдк рд╕реНрдерд┐рд░рддрд╛ рд╡рд┐рдирд┐рд░реНрджреЗрд╢" рдЦрдВрдб рдореЗрдВ рдЧреБрдВрдЬрд╛рдЗрд╢ рдХреЛ рдХрд╡рд░ рдХрд░реВрдВрдЧрд╛ред </p><br><h2 id="ispolzovanie-fixtures-dlya-test-data">  рдЯреЗрд╕реНрдЯ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h2><br><p>  рдлрд┐рдХреНрд╕реНрдЪрд░ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рд╛рдирджрд╛рд░ рдЬрдЧрд╣ рд╣реИред  рдЖрдк рдХреБрдЫ рднреА рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣рд╛рдБ рдПрдХ рдлрд╝рд┐рдХреНрд╕рдЪрд░ рд╣реИ рдЬреЛ рдорд┐рд╢реНрд░рд┐рдд рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЯрдкрд▓ рд▓реМрдЯрд╛рддрд╛ рд╣реИ: </p><br><blockquote>  <strong>ch3 / test_fixtures.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.fixture() def a_tuple(): """ -  """ return (1, 'foo', None, {'bar': 23}) def test_a_tuple(a_tuple): """Demo the a_tuple fixture.""" assert a_tuple[3]['bar'] == 32</code> </pre> <br><p>  рдЪреВрдВрдХрд┐ <code>test_a_tuple()</code> рд╡рд┐рдлрд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП <em>(23! = 32)</em> , рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╕реНрдерд┐рд░рддрд╛ рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3 $ pytest test_fixtures.py::test_a_tuple ============================= test session starts ============================= collected 1 item test_fixtures.py F [100%] ================================== FAILURES =================================== ________________________________ test_a_tuple _________________________________ a_tuple = (1, 'foo', None, {'bar': 23}) def test_a_tuple(a_tuple): """Demo the a_tuple fixture.""" &gt; assert a_tuple[3]['bar'] == 32 E assert 23 == 32 test_fixtures.py:38: AssertionError ========================== 1 failed in 0.17 seconds ===========================</code> </pre> <br><p>  рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рдЕрдиреБрднрд╛рдЧ рдХреЗ рд╕рд╛рде, рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдкрд╡рд╛рдж рдпрд╛ рдЕрд╕рдлрд▓ рджрд╛рд╡реЗ рдХрд╛ рдХрд╛рд░рдг рдмрдирддрд╛ рд╣реИред  рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЬреБрдбрд╝рдирд╛рд░ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдЕрднрд┐рдХрд░реНрддрд╛ (рдпрд╛ рдЕрдкрд╡рд╛рдж) рд╕реНрдерд┐рд░рддрд╛ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ? </p><br><pre> <code class="plaintext hljs">$ pytest -v test_fixtures.py::test_other_data ============================= test session starts ============================= test_fixtures.py::test_other_data ERROR [100%] =================================== ERRORS ==================================== ______________________ ERROR at setup of test_other_data ______________________ @pytest.fixture() def some_other_data(): """Raise an exception from fixture.""" x = 43 &gt; assert x == 42 E assert 43 == 42 test_fixtures.py:21: AssertionError =========================== 1 error in 0.13 seconds ===========================</code> </pre> <br><p>  рдПрдХ рджреЛ рдмрд╛рддреЗрдВ рд╣реЛрддреА рд╣реИрдВред  рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдПрд╕реЗрдЯ рд╕реНрдерд┐рд░рддрд╛ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╣реБрдЖред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, <code>test_other_data</code> рдХреЛ <strong>FAIL рдХреЗ</strong> рд░реВрдк рдореЗрдВ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ <strong>ERROR рдХреЗ</strong> рд░реВрдк <code>test_other_data</code> рд╕реВрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдПрдХ рдмрдбрд╝рд╛ рдЕрдВрддрд░ рд╣реИред  рдпрджрд┐ рдкрд░реАрдХреНрд╖рдг рдЕрдЪрд╛рдирдХ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╡рд┐рдлрд▓рддрд╛ рдкрд░реАрдХреНрд╖рдг рдореЗрдВ рд╣реА рд╣реБрдИ рдереА, рдФрд░ рдХреБрдЫ рд╕реНрдерд┐рд░рддрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рд▓реЗрдХрд┐рди рдЯрд╛рд╕реНрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?  рдХрд╛рд░реНрдп рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╢рд╛рдпрдж рдХреБрдЫ рдбреЗрдЯрд╛ рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдВрднрд╡рддрдГ рд╡рд┐рднрд┐рдиреНрди рдЧреБрдгреЛрдВ рдХреЗ рд╕рд╛рде рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд╛рд░реНрдп рд╕реВрдЪрд┐рдпрд╛рдВ: </p><br><blockquote>  <strong>ch3 / a / task_proj / рдкрд░реАрдХреНрд╖рдг / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">#    Task constructor # Task(summary=None, owner=None, done=False, id=None) # summary    # owner  done   # id    @pytest.fixture() def tasks_just_a_few(): """    .""" return ( Task('Write some code', 'Brian', True), Task("Code review Brian's code", 'Katie', False), Task('Fix what Brian did', 'Michelle', False)) @pytest.fixture() def tasks_mult_per_owner(): """     .""" return ( Task('Make a cookie', 'Raphael'), Task('Use an emoji', 'Raphael'), Task('Move to Berlin', 'Raphael'), Task('Create', 'Michelle'), Task('Inspire', 'Michelle'), Task('Encourage', 'Michelle'), Task('Do a handstand', 'Daniel'), Task('Write some books', 'Daniel'), Task('Eat ice cream', 'Daniel'))</code> </pre> <br><p>  рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕реАрдзреЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рд╕реЗ, рдпрд╛ рдЕрдиреНрдп рдЬреБрдбрд╝рдирд╛рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдЗрдП рдЙрдирдХреА рдорджрдж рд╕реЗ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЧреИрд░-рд░рд┐рдХреНрдд рдбреЗрдЯрд╛рдмреЗрд╕ рдмрдирд╛рдПрдВред </p><br><h2 id="ispolzovanie-multiple-fixtures">  рдПрдХрд╛рдзрд┐рдХ рдлрд┐рдХреНрд╕реНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h2><br><p>  рдЖрдк рдкрд╣рд▓реЗ рд╣реА рджреЗрдЦ рдЪреБрдХреЗ рд╣реИрдВ рдХрд┐ tmpdir tmpdir_factory рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдФрд░ рдЖрдкрдиреЗ рд╣рдорд╛рд░реЗ рдЯрд╛рд╕реНрдХ_ рдбреАрдмреА рд╕реНрдерд┐рд░рддрд╛ рдореЗрдВ tmpdir рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдЪрд▓рд┐рдП рд╢реНрд░реГрдВрдЦрд▓рд╛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдп рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдЧреИрд░-рдЦрд╛рд▓реА рдард┐рдХрд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЬреБрдбрд╝рдирд╛рд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ: </p><br><blockquote>  <strong>ch3 / a / task_proj / рдкрд░реАрдХреНрд╖рдг / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.fixture() def db_with_3_tasks(tasks_db, tasks_just_a_few): """   3 ,  .""" for t in tasks_just_a_few: tasks.add(t) @pytest.fixture() def db_with_multi_per_owner(tasks_db, tasks_mult_per_owner): """   9 , 3 owners,  3   .""" for t in tasks_mult_per_owner: tasks.add(t)</code> </pre> <br><p>  рдЗрди рд╕рднреА рдлрд┐рдХреНрд╕реНрдЪрд░ рдореЗрдВ рдЙрдирдХреА рдкреИрд░рд╛рдореАрдЯрд░ рд╕реВрдЪреА рдореЗрдВ рджреЛ рдЬреБрдбрд╝рдирд╛рд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: <code>tasks_db</code> рдФрд░ рдбреЗрдЯрд╛ рд╕реЗрдЯред  рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдкрд░реАрдХреНрд╖рдг рдЧреИрд░-рдЦрд╛рд▓реА рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рд╢реБрд░реВ рд╣реЛ, рддреЛ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><blockquote>  <strong>ch3 / a / functions_proj / рдкрд░реАрдХреНрд╖рдг / func / test_add.py</strong> </blockquote><br><pre> <code class="plaintext hljs">def test_add_increases_count(db_with_3_tasks): """Test tasks.add()    tasks.count().""" # GIVEN db  3  # WHEN     tasks.add(Task('throw a party')) # THEN    1 assert tasks.count() == 4</code> </pre> <br><p>  рдпрд╣ рднреА рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп рдХрд╛рд░рдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рддрд╛ рд╣реИ: рдкрд░реАрдХреНрд╖рдг рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЙрд╕ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЖрдкрдХреЛ рдкрд░реАрдХреНрд╖рдг рдХреА рддреИрдпрд╛рд░реА рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдХрд░рдирд╛ рдерд╛ред  рдореБрдЭреЗ GIVEN / WHEN / THEN рдХреЗ рд▓рд┐рдП рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрд╕рдВрдж рд╣реИ рдФрд░ рджреЛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдЬреБрдбрд╝рдирд╛рд░ рдореЗрдВ рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЙрддрдирд╛ рдбреЗрдЯрд╛ (GIVEN) рдкреБрд╢ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реВрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдХреЛ рдЕрдзрд┐рдХ рдкрдардиреАрдп рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд▓рд┐рдП рдЕрдзрд┐рдХ рдмрдирд╛рдП рд░рдЦрдиреЗ рдпреЛрдЧреНрдп рд╣реИред  рджреВрд╕рд░реЗ, рдПрдХ рдПрд╕реНрдЯрд░ рдпрд╛ рдЕрдкрд╡рд╛рдж рдПрдХ рддреНрд░реБрдЯрд┐ (ERROR) рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рджреЗрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдкрд░реАрдХреНрд╖рдг рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдПрдХ рдПрд╕реНрдЯрд░ рдпрд╛ рдЕрдкрд╡рд╛рдж рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рддреНрд░реБрдЯрд┐ (FAIL) рд╣реЛрддреА рд╣реИред  рдореИрдВ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рдХрд┐ <code>test_add_increases_count()</code> рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЖрд░рдВрдн рдореЗрдВ рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПред  рдпрд╣ рд╕рд┐рд░реНрдл рднреНрд░рд╛рдордХ рд╣реИред  рдореИрдВ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдХрд┐ <code>test_add_increases_count()</code> рдХреА рд╡рд┐рдлрд▓рддрд╛ (FAIL) рдХреЗрд╡рд▓ рддрднреА рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрдм <code>add ()</code> рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд╛рдЙрдВрдЯрд░ рдХреЛ рдмрджрд▓ рди рд╕рдХреЗред  рдЖрдЗрдП рджреМрдбрд╝реЗрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рд╕рднреА рдЬреБрдбрд╝рдирд╛рд░ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/a/tasks_proj/tests/func $ pytest --setup-show test_add.py::test_add_increases_count ============================= test session starts ============================= collected 1 item test_add.py SETUP S tmpdir_factory SETUP F tmpdir (fixtures used: tmpdir_factory) SETUP F tasks_db (fixtures used: tmpdir) SETUP F tasks_just_a_few SETUP F db_with_3_tasks (fixtures used: tasks_db, tasks_just_a_few) func/test_add.py::test_add_increases_count (fixtures used: db_with_3_tasks, tasks_db, tasks_just_a_few, tmpdir, tmpdir_factory). TEARDOWN F db_with_3_tasks TEARDOWN F tasks_just_a_few TEARDOWN F tasks_db TEARDOWN F tmpdir TEARDOWN S tmpdir_factory ========================== 1 passed in 0.20 seconds ===========================</code> </pre> <br><p>  рд╣рдореЗрдВ рдлрдВрдХреНрд╢рди рдФрд░ рд╕рддреНрд░ рдХреНрд╖реЗрддреНрд░ рдХреЗ рд▓рд┐рдП рдлрд┐рд░ рд╕реЗ рдПрдлрдПрд╕ рдФрд░ рдПрд╕рдПрд╕ рдХрд╛ рдПрдХ рдЧреБрдЪреНрдЫрд╛ рдорд┐рд▓рд╛ред  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреНрдпрд╛ рд╣реИред </p><br><h2 id="specifikaciya-oblasteyscope-fixture">  рд╕реНрдХреЛрдк рд╕реНрдерд┐рд░рддрд╛ рд╡рд┐рдирд┐рд░реНрджреЗрд╢ </h2><br><p>  рдлрд┐рдХреНрд╕реНрдЪрд░ рдореЗрдВ <strong>рдЧреБрдВрдЬрд╛рдЗрд╢</strong> рдирд╛рдордХ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдкреИрд░рд╛рдореАрдЯрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЬреБрдбрд╝рдирд╛рд░ рдХрд┐рддрдиреА рдмрд╛рд░ рд╕реЗрдЯрдЕрдк рдФрд░ рдЯреЙрд░рдбрд╛рдЙрди рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред  <code>@ pytest.fixture()</code> рд▓рд┐рдП <em>рдЧреБрдВрдЬрд╛рдЗрд╢</em> рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди, рд╡рд░реНрдЧ, рдореЙрдбреНрдпреВрд▓ рдпрд╛ рд╕рддреНрд░ рдорд╛рди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  <em>рд╕реНрдХреЛрдк</em> рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИред  рдХрд╛рд░реНрдп_db рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдФрд░ рд╕рднреА рдЬреБрдбрд╝рдирд╛рд░ рдЕрднреА рддрдХ рдПрдХ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╡реЗ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдЬреБрдбрд╝рдирд╛рд░ рд╣реИрдВред </p><br><p>  рдкреНрд░рддреНрдпреЗрдХ <em>рд╕реНрдХреЛрдк</em> рдорд╛рди рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИ: </p><br><ul><li><p>  <em>рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ = 'рдХрд╛рд░реНрдп'</em> </p><br><p>  рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реЗрдЯрдЕрдк рднрд╛рдЧ рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдкрд╣рд▓реЗ рд╕реНрдерд┐рд░рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд╕рд╛рде рдЕрд╢реНрд░реБ рднрд╛рдЧ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдкреИрд░рд╛рдореАрдЯрд░ рдкреИрд░рд╛рдореАрдЯрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреНрд╖реЗрддреНрд░ рд╣реИред </p><br></li><li><p>  <em>рджрд╛рдпрд░рд╛ = 'рд╡рд░реНрдЧ'</em> </p><br><p>  рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рд╡рд░реНрдЧ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХрдХреНрд╖рд╛ рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ред </p><br></li><li><p>  <em>рдЧреБрдВрдЬрд╛рдЗрд╢ = 'рдореЙрдбреНрдпреВрд▓'</em> </p><br><p>  рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдХрд┐рддрдиреЗ рдкрд░реАрдХреНрд╖рдг рдХрд╛рд░реНрдпреЛрдВ рдпрд╛ рд╡рд┐рдзрд┐рдпреЛрдВ рдпрд╛ рдЕрдиреНрдп рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдЗрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдореЙрдбреНрдпреВрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br></li><li><p>  <em>рдЧреБрдВрдЬрд╛рдЗрд╢ = 'рд╕рддреНрд░'</em> </p><br><p>  рдпрд╣ рдкреНрд░рддрд┐ рд╕рддреНрд░ рдПрдХ рдмрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рднреА рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдзрд┐рдпреЛрдВ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдЬреЛ рд╕рддреНрд░ рдЧреБрдВрдЬрд╛рдЗрд╢ рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдПрдХрд▓ рд╕реЗрдЯрдЕрдк рдФрд░ рдлрд╛рдбрд╝ рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </p><br></li></ul><br><p>  рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рдЧреБрдВрдЬрд╛рдЗрд╢ рдорд╛рди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреЗ рд╣реИрдВ: </p><br><blockquote>  <strong>ch3 / test_scope.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""Demo fixture scope.""" import pytest @pytest.fixture(scope='function') def func_scope(): """A function scope fixture.""" @pytest.fixture(scope='module') def mod_scope(): """A module scope fixture.""" @pytest.fixture(scope='session') def sess_scope(): """A session scope fixture.""" @pytest.fixture(scope='class') def class_scope(): """A class scope fixture.""" def test_1(sess_scope, mod_scope, func_scope): """   ,   .""" def test_2(sess_scope, mod_scope, func_scope): """     .""" @pytest.mark.usefixtures('class_scope') class TestSomething(): """Demo class scope fixtures.""" def test_3(self): """Test using a class scope fixture.""" def test_4(self): """Again, multiple tests are more fun."""</code> </pre> <br><p>  рдЪрд▓реЛ рдпрд╣ <code>--setup-show</code> рдХреЗ рд▓рд┐рдП <code>--setup-show</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ <code>--setup-show</code> рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝реА рдЧрдИ рд╕реНрдерд┐рд░рддрд╛ рдФрд░ рд╕реЗрдЯрдЕрдк рдХреЙрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХреА рдЬрд╛рддреА рд╣реИ: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/ $ pytest --setup-show test_scope.py ============================= test session starts ============================= collected 4 items test_scope.py SETUP S sess_scope SETUP M mod_scope SETUP F func_scope test_scope.py::test_1 (fixtures used: func_scope, mod_scope, sess_scope). TEARDOWN F func_scope SETUP F func_scope test_scope.py::test_2 (fixtures used: func_scope, mod_scope, sess_scope). TEARDOWN F func_scope SETUP C class_scope test_scope.py::TestSomething::()::test_3 (fixtures used: class_scope). test_scope.py::TestSomething::()::test_4 (fixtures used: class_scope). TEARDOWN C class_scope TEARDOWN M mod_scope TEARDOWN S sess_scope ========================== 4 passed in 0.11 seconds ===========================</code> </pre> <br><p>  рдЕрдм рдЖрдк рдлрд╝рдВрдХреНрд╢рди рдФрд░ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рди рдХреЗрд╡рд▓ <strong>рдПрдл</strong> рдФрд░ <strong>рдПрд╕</strong> рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рд╡рд░реНрдЧ рдФрд░ рдореЙрдбреНрдпреВрд▓ рдХреЗ рд▓рд┐рдП <strong>рд╕реА</strong> рдФрд░ <strong>рдПрдо</strong> рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЧреБрдВрдЬрд╛рдЗрд╢ рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдореБрдЭреЗ рдкрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХреЛрдб рд╕реЗ рд╕реНрдкрд╖реНрдЯ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдВрджреБ рд╣реИ рдХрд┐ рдЖрдк рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд░рд╛рд╣ рд░рд╣реЗ рд╣реИрдВред рд╕рдордЭ тАЭ)ред  рджрд╛рдпрд░рд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдкрд░рд┐рднрд╛рд╖рд╛ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдХреЙрд▓ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдирд╣реАрдВред  рдЬреБрдбрд╝рдирд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрд░реАрдХреНрд╖рдг рдХрд╛рд░реНрдп рдХрд┐рддрдиреА рдмрд╛рд░ (SETUP) рдФрд░ рд╕реНрдерд┐рд░рддрд╛ рдЯреВрдЯрдиреЗ (TEARDOWN) рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдлрд┐рдХреНрд╕реНрдЪрд░ рдХреЗрд╡рд▓ рдЙрд╕реА рдпрд╛ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рджрд╛рдпрд░реЗ рд╕реЗ рдЕрдиреНрдп рдЬреБрдбрд╝рдирд╛рд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдлрдВрдХреНрд╢рди рд╕реНрдХреЛрдк рдлрд┐рдХреНрд╕реЗрд╢рди рдЕрдиреНрдп рдлрдВрдХреНрд╢рди рд╕реНрдХреЛрдк рдлрд╝рд┐рдХреНрдЪрд░ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдФрд░ рдЕрднреА рднреА рдЯрд╛рд╕реНрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдкрд░ рдирд┐рд░реНрднрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдлрд╝рдВрдХреНрд╢рди рд╕реНрдХреЛрдк рдлрд┐рдХреНрд╕реЗрд╢рди рднреА рдХреНрд▓рд╛рд╕ рдХреНрд╖реЗрддреНрд░, рдореЙрдбреНрдпреВрд▓ рдФрд░ рд╕рддреНрд░ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЬреБрдбрд╝рдирд╛рд░ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрднреА рднреА рд░рд┐рд╡рд░реНрд╕ рдСрд░реНрдбрд░ рдореЗрдВ рдирд╣реАрдВред </p><br><h3 id="smena-scope-dlya-tasks-project-fixtures">  рдЯрд╛рд╕реНрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░ рдХреЗ рд▓рд┐рдП рд╕реНрдХреЛрдк рдмрджрд▓реЗрдВ </h3><br><p>  рдЧреБрдВрдЬрд╛рдЗрд╢ рдХреЗ рдЗрд╕ рдЬреНрдЮрд╛рди рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдЪрд▓реЛ рдЕрдм рдЯрд╛рд╕реНрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдХреБрдЫ рдЬреБрдбрд╝рдирд╛рд░ рдХреЗ рджрд╛рдпрд░реЗ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВред </p><br><p>  рдЕрдм рддрдХ, рд╣рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рд╕рдордп рдХреЗ рд╕рд╛рде рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реБрдИ рд╣реИред  рд▓реЗрдХрд┐рди, рдЖрдкрдХреЛ рдпрд╣ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдФрд░ рдПрдХ рдирдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдирд╛ рдмреЗрдХрд╛рд░ рд╣реИред  рдЬрдм рддрдХ рд╣рдо рдПрдХ рдЦрд╛рд▓реА рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рддрдХ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рд╕рддреНрд░ рдХреЗ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ <code>tasks_db</code> рдЬреИрд╕реА рдХрд┐рд╕реА рдЪреАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ <code>tmpdir_factory</code> рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ <code>tmpdir</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рд╣реИ рдФрд░ <code>tmpdir_factory</code> рд╕рддреНрд░ рдХрд╛ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рд╣реИред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдХреЛрдб рдкрд░рд┐рд╡рд░реНрддрди рдХреА рд╕рд┐рд░реНрдл рдПрдХ рдкрдВрдХреНрддрд┐ рд╣реИ (рдареАрдХ рд╣реИ, рджреЛ рдпрджрд┐ рдЖрдк рдкреИрд░рд╛рдореАрдЯрд░ рд╕реВрдЪреА рдореЗрдВ <code>tmpdir-&gt;tmpdir_factory</code> рдкрд░ рд╡рд┐рдЪрд╛рд░ <code>tmpdir-&gt;tmpdir_factory</code> ): </p><br><blockquote>  <strong>ch3 / b / task_proj / рдкрд░реАрдХреНрд╖рдг / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""Define some fixtures to use in the project.""" import pytest import tasks from tasks import Task @pytest.fixture(scope='session') def tasks_db_session(tmpdir_factory): """Connect to db before tests, disconnect after.""" temp_dir = tmpdir_factory.mktemp('temp') tasks.start_tasks_db(str(temp_dir), 'tiny') yield tasks.stop_tasks_db() @pytest.fixture() def tasks_db(tasks_db_session): """An empty tasks db.""" tasks.delete_all()</code> </pre> <br><p>  рдпрд╣рд╛рдВ рд╣рдордиреЗ <code>tasks_db</code> рдЖрдзрд╛рд░ рдкрд░ <code>tasks_db_session</code> рдмрджрд▓ рджрд┐рдпрд╛, рдФрд░ рд╣рдордиреЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдХрд┐ рдпрд╣ рдЦрд╛рд▓реА рд╣реИред  рдЪреВрдВрдХрд┐ рд╣рдордиреЗ рдЗрд╕рдХрд╛ рдирд╛рдо рдирд╣реАрдВ рдмрджрд▓рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдЬреБрдбрд╝рдирд╛рд░ рдпрд╛ рдкрд░реАрдХреНрд╖рдг рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИ, рдХреЛ рдмрджрд▓рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рдбреЗрдЯрд╛ рдЬреБрдбрд╝рдирд╛рд░ рдмрд╕ рдПрдХ рдореВрд▓реНрдп рд╡рд╛рдкрд╕ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрдирдХреЗ рд▓рд┐рдП рд╣рд░ рд╕рдордп рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдХрд╛рд░рдг рдирд╣реАрдВ рд╣реИред  рдПрдХ рдмрд╛рд░ рдкреНрд░рддрд┐ рд╕рддреНрд░ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ: </p><br><blockquote>  <strong>ch3 / b / task_proj / рдкрд░реАрдХреНрд╖рдг / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs"># Reminder of Task constructor interface # Task(summary=None, owner=None, done=False, id=None) # summary is required # owner and done are optional # id is set by database @pytest.fixture(scope='session') def tasks_just_a_few(): """All summaries and owners are unique.""" return ( Task('Write some code', 'Brian', True), Task("Code review Brian's code", 'Katie', False), Task('Fix what Brian did', 'Michelle', False)) @pytest.fixture(scope='session') def tasks_mult_per_owner(): """Several owners with several tasks each.""" return ( Task('Make a cookie', 'Raphael'), Task('Use an emoji', 'Raphael'), Task('Move to Berlin', 'Raphael'), Task('Create', 'Michelle'), Task('Inspire', 'Michelle'), Task('Encourage', 'Michelle'), Task('Do a handstand', 'Daniel'), Task('Write some books', 'Daniel'), Task('Eat ice cream', 'Daniel'))</code> </pre> <br><p>  рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдпреЗ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рд╣рдорд╛рд░реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/b/tasks_proj $ pytest ===================== test session starts ====================== collected 55 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py ....... tests/func/test_unique_id.py . tests/unit/test_task.py .... ================== 55 passed in 0.17 seconds ===================</code> </pre> <br><p>  рд╕рдм рдХреБрдЫ рдХреНрд░рдо рдореЗрдВ рд▓рдЧрддрд╛ рд╣реИред  рдЖрдЗрдП рдПрдХ рдПрдХрд▓ рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдЬреБрдбрд╝рдирд╛рд░ рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдорд╛рд░реА рдЙрдореНрдореАрджреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╡рд┐рднрд┐рдиреНрди рдХреНрд╖реЗрддреНрд░ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">$ pytest --setup-show tests/func/test_add.py ============================= test session starts ============================= platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 rootdir: c:\_BOOKS_\pytest_si\bopytest-code\code\ch3\b\tasks_proj\tests, inifile: pytest.ini collected 3 items tests\func\test_add.py SETUP S tmpdir_factory SETUP S tasks_db_session (fixtures used: tmpdir_factory) SETUP F tasks_db (fixtures used: tasks_db_session) func/test_add.py::test_add_returns_valid_id (fixtures used: tasks_db, tasks_db_session, tmpdir_factory). TEARDOWN F tasks_db SETUP F tasks_db (fixtures used: tasks_db_session) func/test_add.py::test_added_task_has_id_set (fixtures used: tasks_db, tasks_db_session, tmpdir_factory). TEARDOWN F tasks_db SETUP S tasks_just_a_few SETUP F tasks_db (fixtures used: tasks_db_session) SETUP F db_with_3_tasks (fixtures used: tasks_db, tasks_just_a_few) func/test_add.py::test_add_increases_count (fixtures used: db_with_3_tasks, tasks_db, tasks_db_session, tasks_just_a_few, tmpdir_factory). TEARDOWN F db_with_3_tasks TEARDOWN F tasks_db TEARDOWN S tasks_db_session TEARDOWN S tmpdir_factory TEARDOWN S tasks_just_a_few ========================== 3 passed in 0.24 seconds ===========================</code> </pre> <br><p>  рд╣рд╛рдБред  . <code>tasks_db_session</code>     ,    <code>task_db</code>        . </p><br><h3 id="specifying-fixtures-with-usefixtures"> Specifying Fixtures with usefixtures </h3><br><p>   ,   ,    ,       .  ,        <code>@pytest.mark.usefixtures('fixture1', 'fixture2')</code> . <em>usefixtures</em>  ,    ,  .          тАФ     .       : </p><br><blockquote> <strong>ch3/test_scope.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.usefixtures('class_scope') class TestSomething(): """Demo class scope fixtures.""" def test_3(self): """Test using a class scope fixture.""" def test_4(self): """Again, multiple tests are more fun."""</code> </pre> <br><p>  <em>usefixtures</em>    ,         .     ,       ,       . ,   -  <em>usefixtures</em> ,      . </p><br><h2 id="ispolzovanie--autouse-dlya-fixtures-that-always-get-used-kotorye-ispolzuyutsya-nepreryvno">  autouse  Fixtures That Always Get Used (  ) </h2><br><p>        ,  ,    (  <em>usefixtures</em>     ).     <em>autouse=True</em> ,    .     ,       ,              .    : </p><br><blockquote> <strong>ch3/test_autouse.py</strong> </blockquote><br><pre> <code class="plaintext hljs">""" autouse fixtures.""" import pytest import time @pytest.fixture(autouse=True, scope='session') def footer_session_scope(): """    session().""" yield now = time.time() print('--') print('finished : {}'.format(time.strftime('%d %b %X', time.localtime(now)))) print('-----------------') @pytest.fixture(autouse=True) def footer_function_scope(): """     .""" start = time.time() yield stop = time.time() delta = stop - start print('\ntest duration : {:0.3} seconds'.format(delta)) def test_1(): """   .""" time.sleep(1) def test_2(): """    .""" time.sleep(1.23)</code> </pre> <br><p>         ,         .     : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3 $ pytest -v -s test_autouse.py ===================== test session starts ====================== collected 2 items test_autouse.py::test_1 PASSED test duration : 1.0 seconds test_autouse.py::test_2 PASSED test duration : 1.24 seconds -- finished : 25 Jul 16:18:27 ----------------- =================== 2 passed in 2.25 seconds ===================</code> </pre> <br><p>  <em>autouse</em>  .    ,  .    ,          . </p><br><p> ,    <em>autouse</em>  ,   ,       <code>tasks_db</code>   .   Tasks  ,     ,  ,      API   .      .      ,     . </p><br><h2 id="pereimenovanie-fixtures">  Fixtures </h2><br><p>  ,        ,  ,      . , <em>pytest</em>       name  <code>@pytest.fixture()</code> : </p><br><blockquote> <strong>ch3/ <code>test_rename_fixture.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">""" fixture renaming.""" import pytest @pytest.fixture(name='lue') def ultimate_answer_to_life_the_universe_and_everything(): """  .""" return 42 def test_everything(lue): """   .""" assert lue == 42</code> </pre> <br><p>  <em>lue</em>    <code>fixture</code> ,   <code>fixture_with_a_name_much_longer_than_lue</code> .    ,       <code>--setup-show</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --setup-show test_rename_fixture.py ======================== test session starts ======================== collected 1 items test_rename_fixture.py SETUP F lue test_rename_fixture.py::test_everything (fixtures used: lue). TEARDOWN F lue ===================== 1 passed in 0.01 seconds ======================</code> </pre> <br><p>    ,   <em>lue</em> ,    pytest <code>--fixtures</code>       .     ,   ,    ,   : </p><br><pre> <code class="plaintext hljs">$ pytest --fixtures test_rename_fixture.py ======================== test session starts ======================= ... ------------------ fixtures defined from test_rename_fixture ------------------ lue Return ultimate answer. ================= no tests ran in 0.01 seconds =================</code> </pre> <br><p>      тАФ   .  , ,   ,  ,   ,   .    ,    <em>lue</em> .      ┬лTasks┬╗: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/b/tasks_proj $ pytest --fixtures tests/func/test_add.py ======================== test session starts ======================== ... tmpdir_factory Return a TempdirFactory instance for the test session. tmpdir Return a temporary directory path object which is unique to each test function invocation, created as a sub directory of the base temporary directory. The returned object is a `py.path.local`_ path object. ----------------------- fixtures defined from conftest ------------------------ tasks_db An empty tasks db. tasks_just_a_few All summaries and owners are unique. tasks_mult_per_owner Several owners with several tasks each. db_with_3_tasks Connected db with 3 tasks, all unique. db_with_multi_per_owner Connected db with 9 tasks, 3 owners, all with 3 tasks. tasks_db_session Connect to db before tests, disconnect after. =================== no tests ran in 0.01 seconds ====================</code> </pre> <br><p> !     <em>conftest.py</em> .        <code>tmpdir</code>  <code>tmpdir_factory</code> ,    . </p><br><h2 id="parametrizaciya-fikstur">   </h2><br><p>  [Parametrized Testing] ,  . 42,   .     .  -    ,      ,   : </p><br><blockquote> <code>ch3/b/tasks_proj/tests/func/test_add_variety2.py</code> <br> <br> """Test the tasks.add() API function.""" <br><br> import pytest <br> import tasks <br> from tasks import Task <br><br> tasks_to_try = (Task('sleep', done=True), <br> Task('wake', 'brian'), <br> Task('breathe', 'BRIAN', True), <br> Task('exercise', 'BrIaN', False)) <br><br> task_ids = ['Task({},{},{})'.format(t.summary, t.owner, t.done) <br> for t in tasks_to_try] <br><br> def equivalent(t1, t2): <br> """Check two tasks for equivalence.""" <br> return ((t1.summary == t2.summary) and <br> (t1.owner == t2.owner) and <br> (t1.done == t2.done)) </blockquote><p>  ,   ,      <code>a_task</code> : </p><br><blockquote> <strong>ch3/b/tasks_proj/tests/func/ <code>test_add_variety2.py</code></strong> <br><br> @pytest.fixture(params=tasks_to_try) <br> def a_task(request): <br> """ .""" <br> return request.param <br><br> def test_add_a(tasks_db, a_task): <br> """  a_task ( ids).""" <br> task_id = tasks.add(a_task) <br> t_from_db = tasks.get(task_id) <br> assert equivalent(t_from_db, a_task) </blockquote><p> ,    fixture,    ,    .      .    param,      ,  params  <code>@pytest.fixture(params=tasks_to_try)</code> . </p><br><p>  <code>a_task</code>   тАФ    <code>request.param</code>     ,  .        ,     ,       : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/b/tasks_proj/tests/func $ pytest -v test_add_variety2.py::test_add_a ===================== test session starts ====================== collected 4 items test_add_variety2.py::test_add_a[a_task0] PASSED test_add_variety2.py::test_add_a[a_task1] PASSED test_add_variety2.py::test_add_a[a_task2] PASSED test_add_variety2.py::test_add_a[a_task3] PASSED =================== 4 passed in 0.03 seconds ===================</code> </pre> <br><p>    ,  pytest   ,   ()   .        ,       : </p><br><blockquote> <strong>ch3/b/tasks_proj/tests/func/ <code>test_add_variety2.py</code></strong> <br><br> @pytest.fixture(params=tasks_to_try, ids=task_ids) <br> def b_task(request): <br> """  .""" <br> return request.param <br><br> def test_add_b(tasks_db, b_task): <br> """  b_task,  .""" <br> task_id = tasks.add(b_task) <br> t_from_db = tasks.get(task_id) <br> assert equivalent(t_from_db, b_task) </blockquote><p>      : </p><br><pre> <code class="plaintext hljs">$ pytest -v test_add_variety2.py::test_add_b ===================== test session starts ====================== collected 4 items test_add_variety2.py::test_add_b[Task(sleep,None,True)] PASSED test_add_variety2.py::test_add_b[Task(wake,brian,False)] PASSED test_add_variety2.py::test_add_b[Task(breathe,BRIAN,True)] PASSED test_add_variety2.py::test_add_b[Task(exercise,BrIaN,False)] PASSED =================== 4 passed in 0.04 seconds ===================</code> </pre> <br><p>      <code>ids</code>  ,   ,   .    ,       : </p><br><blockquote> <strong>ch3/b/tasks_proj/tests/func/ <code>test_add_variety2.py</code></strong> <br><br> def id_func(fixture_value): <br> """   .""" <br> t = fixture_value <br> return 'Task({},{},{})'.format(t.summary, t.owner, t.done) <br><br> @pytest.fixture(params=tasks_to_try, ids=id_func) <br> def c_task(request): <br> """  (id_func)   .""" <br> return request.param <br><br> def test_add_c(tasks_db, c_task): <br> """    .""" <br> task_id = tasks.add(c_task) <br> t_from_db = tasks.get(task_id) <br> assert equivalent(t_from_db, c_task) </blockquote><p>         .       Task, <code>id_func()</code>     <em>Task</em> ,       <em>namedtuple</em>      <em>Task</em>      <em>Task</em>  .   ,      ,   : </p><br><pre> <code class="plaintext hljs">$ pytest -v test_add_variety2.py::test_add_c ===================== test session starts ====================== collected 4 items test_add_variety2.py::test_add_c[Task(sleep,None,True)] PASSED test_add_variety2.py::test_add_c[Task(wake,brian,False)] PASSED test_add_variety2.py::test_add_c[Task(breathe,BRIAN,True)] PASSED test_add_variety2.py::test_add_c[Task(exercise,BrIaN,False)] PASSED =================== 4 passed in 0.04 seconds ===================</code> </pre> <br><p>          .       ,   ,    .    , ! </p><br><h3 id="parametrizaciya-fixtures-v-tasks-project">  Fixtures  Tasks Project </h3><br><p>   ,         Tasks.      <em>TinyDB</em>   .   ,        .   ,   ,   ,   ,     <em>TinyDB</em> ,    <em>MongoDB</em> . </p><br><p>  ( ),     ,    <code>start_tasks_db()</code>   <code>tasks_db_session</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ch3/b/tasks_proj/tests/conftest.py</a> <br><br> """      .""" <br><br> import pytest <br> import tasks <br> from tasks import Task <br><br> @pytest.fixture(scope='session') <br> def tasks_db_session(tmpdir_factory): <br> """    ,  .""" <br> temp_dir = tmpdir_factory.mktemp('temp') <br> tasks.start_tasks_db(str(temp_dir), 'tiny') <br> yield <br> tasks.stop_tasks_db() <br><br> @pytest.fixture() <br> def tasks_db(tasks_db_session): <br> """   tasks.""" <br> tasks.delete_all() </blockquote><p>  <code>db_type</code>   <code>start_tasks_db()</code>   .      ,        : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>tasks_proj/src/tasks/api.py</strong></a> </blockquote><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_tasks_db</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db_path, db_type)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># type: (str, str) -None """  API  .""" if not isinstance(db_path, string_types): raise TypeError('db_path must be a string') global _tasksdb if db_type == 'tiny': import tasks.tasksdb_tinydb _tasksdb = tasks.tasksdb_tinydb.start_tasks_db(db_path) elif db_type == 'mongo': import tasks.tasksdb_pymongo _tasksdb = tasks.tasksdb_pymongo.start_tasks_db(db_path) else: raise ValueError("db_type   'tiny'  'mongo'")</span></span></code> </pre> <br><p>   MongoDB,       db_type  mongo.  : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><strong>ch3/c/tasks_proj/tests/conftest.py</strong></a> </blockquote><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task <span class="hljs-comment"><span class="hljs-comment"># @pytest.fixture(scope='session', params=['tiny',]) @pytest.fixture(scope='session', params=['tiny', 'mongo']) def tasks_db_session(tmpdir_factory, request): """Connect to db before tests, disconnect after.""" temp_dir = tmpdir_factory.mktemp('temp') tasks.start_tasks_db(str(temp_dir), request.param) yield # this is where the testing happens tasks.stop_tasks_db() @pytest.fixture() def tasks_db(tasks_db_session): """An empty tasks db.""" tasks.delete_all()</span></span></code> </pre> <br><p>    params=['tiny',' mongo']  -.   <code>request</code>    <em>temp_db</em>   <em>db_type</em>  <code>request.param</code>  ,    "tiny"  "mongo". </p><br><p>   <code>--verbose</code>   <code>-v</code>    pytest     , pytest        .      ,   . </p><br><hr><br><p>  <strong>MongoDB рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛</strong> </p><br><hr><br><p>    MongoDB, ,   MongoDB  <em>pymongo</em> .       MongoDB,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://www.mongodb.com/download-center</a> . pymongo   pipтАФ <em>pip install pymongo</em> .   MongoDB       ;           <strong> 7</strong> . </p><br><hr><br><p>     : </p><br><pre> <code class="plaintext hljs"> $ cd /path/to/code/ch3/c/tasks_proj $ pip install pymongo $ pytest -v --tb=no ===================== test session starts ====================== collected 92 items test_add.py::test_add_returns_valid_id[tiny] PASSED test_add.py::test_added_task_has_id_set[tiny] PASSED test_add.py::test_add_increases_count[tiny] PASSED test_add_variety.py::test_add_1[tiny] PASSED test_add_variety.py::test_add_2[tiny-task0] PASSED test_add_variety.py::test_add_2[tiny-task1] PASSED ... test_add.py::test_add_returns_valid_id[mongo] FAILED test_add.py::test_added_task_has_id_set[mongo] FAILED test_add.py::test_add_increases_count[mongo] PASSED test_add_variety.py::test_add_1[mongo] FAILED test_add_variety.py::test_add_2[mongo-task0] FAILED ... ============= 42 failed, 50 passed in 4.94 seconds =============</code> </pre> <br><p>  рд╣рдореНрдоред . ,     ,     -   Mongo.  ,     pdb:   ,  . 125.        TinyDB. </p><br><h2 id="uprazhneniya">  рдЕрднреНрдпрд╛рд╕ </h2><br><ol><li>    <code>test_fixtures.py</code> . <br> 2.  fixturesтАФfunctions     <code>@pytest.fixture()</code> ,     . ,   ,  . </li><li>         ,   . </li><li>   ,       . </li><li>  <code>pytest --setup-show test_fixtures.py</code> .      ? </li><li>  <code>scope= 'module'</code>     4. </li><li>   <code>pytest --setup-show test_fixtures.py</code> .  рдХреНрдпрд╛ рдмрджрд▓ рдЧрдпрд╛ рд╣реИ? </li><li>     6  <code>return &lt;data&gt;</code>  <code>yield &lt;data&gt;</code> . </li><li>       <code>yield</code> . </li><li>  <code>pytest -s -v test_fixtures.py</code> .    ? </li></ol><br><h2 id="chto-dalshe">  рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реИ </h2><br><p>  pytest fixture  ,   ,   <em>building blocks</em> ,    <em>setup</em>  <em>teardown</em> ,        (,  Mongo  TinyDB).    ,      ,         . </p><br><p>       pytest,   ,    (builtin)  tmpdir  tmpdir_factory.        (builtin) . </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреАрдЫреЗ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдЧрд▓рд╛</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi448786/">https://habr.com/ru/post/hi448786/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi448774/index.html">DBMS_SQL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ CSV рдХреЛ рдПрд╕рдХреНрдпреВрдПрд▓</a></li>
<li><a href="../hi448776/index.html">RxVMS - рд╕реНрдкрдВрджрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛</a></li>
<li><a href="../hi448778/index.html">рдкреЗрд╢ рд╣реИ рд╡рд┐рдЬреБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ 2019 рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдо рдЯреНрд░реИрд╡рд▓ рдбрд┐рдмрдЧрд┐рдВрдЧ</a></li>
<li><a href="../hi448780/index.html">рдкреИрд╕реЗ рдореЗрдВ рднрд░реНрддреА рдХреЗ рд▓рд┐рдП рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреНрдпрд╛ рджреЗрддрд╛ рд╣реИ</a></li>
<li><a href="../hi448782/index.html">рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░реАрдХреНрд╖рдгред рдкрд╛рдЗрд╕реНрдЯреЗрд╕реНрдЯ, рдЕрдзреНрдпрд╛рдп 1 рдХреЗ рд╕рд╛рде рд╢реБрд░реБрдЖрдд рдХрд░рдирд╛</a></li>
<li><a href="../hi448794/index.html">рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░реАрдХреНрд╖рдгред рдкреНрд▓рдЧрдЗрдиреНрд╕ рдЕрдзреНрдпрд╛рдп 5</a></li>
<li><a href="../hi448796/index.html">рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░реАрдХреНрд╖рдгред рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдЕрдзреНрдпрд╛рдп 6</a></li>
<li><a href="../hi448798/index.html">рдкрд╛рдпрдерди рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░реАрдХреНрд╖рдгред рдЕрдиреНрдп рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде pytest рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, рдЕрдзреНрдпрд╛рдп 7</a></li>
<li><a href="../hi448800/index.html">.Vsconfig рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рд╕рдВрдЧрдарди рдореЗрдВ рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ</a></li>
<li><a href="../hi448802/index.html">рдкреЛрд░реНрдЯрд▓реНрд╕ рдХреЗ рд╕рд╛рде рд╕реЛрдЪрдирд╛: рдЕрд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЗрдВрдЬрди 4 рдореЗрдВ рдкреЛрд░реНрдЯрд▓реНрд╕ рдмрдирд╛рдирд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>