<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ† ğŸ”µ ğŸ™‹ æœ¨å¶+å¸Œæ‹‰ã€‚ æŒ¤å‹æœ€å¤§ ğŸ–ğŸ¾ ğŸ‘ŒğŸ» ğŸ‘„</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³è°ˆè°ˆæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨Puppetå’ŒHieraé…ç½®é“å’Œè™šæ‹ŸæœåŠ¡å™¨ã€‚ åŸºæœ¬ä¸Šï¼Œè¿™å°†ä¸æˆ‘ä»¬å‘æ˜çš„ä½“ç³»ç»“æ„å’Œå±‚æ¬¡ç»“æ„æœ‰å…³ï¼Œè¿™å°†ä¿ƒè¿›æœåŠ¡å™¨é…ç½®å¹¶ä½¿ä¹‹ç³»ç»ŸåŒ–ã€‚ 


 æˆ‘è¢«æç¤ºå†™è¿™ç¯‡æ–‡ç« çš„åŸå› æ˜¯ï¼Œåœ¨Internetä¸Šæˆ‘å¹¶æ²¡æœ‰ç‰¹åˆ«æ‰¾åˆ°å…³äºå¦‚ä½•ä½¿ç”¨hieraåŠå…¶ç”¨é€”çš„å¥½çš„å®é™…ç¤ºä¾‹ã€‚ åŸºæœ¬ä¸Šï¼Œè¿™äº›æ˜¯å¸¦æœ‰ç¤ºä¾‹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æœ¨å¶+å¸Œæ‹‰ã€‚ æŒ¤å‹æœ€å¤§</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/412587/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/vq/z-/bj/vqz-bjm4yx2wvhzcf-frffyuh04.png"></div><br><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³è°ˆè°ˆæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨<strong>Puppet</strong>å’Œ<strong>Hiera</strong>é…ç½®é“å’Œè™šæ‹ŸæœåŠ¡å™¨ã€‚ åŸºæœ¬ä¸Šï¼Œè¿™å°†ä¸æˆ‘ä»¬å‘æ˜çš„ä½“ç³»ç»“æ„å’Œå±‚æ¬¡ç»“æ„æœ‰å…³ï¼Œè¿™å°†ä¿ƒè¿›æœåŠ¡å™¨é…ç½®å¹¶ä½¿ä¹‹ç³»ç»ŸåŒ–ã€‚ </p><br><p> æˆ‘è¢«æç¤ºå†™è¿™ç¯‡æ–‡ç« çš„åŸå› æ˜¯ï¼Œåœ¨Internetä¸Šæˆ‘å¹¶æ²¡æœ‰ç‰¹åˆ«æ‰¾åˆ°å…³äºå¦‚ä½•ä½¿ç”¨hieraåŠå…¶ç”¨é€”çš„å¥½çš„å®é™…ç¤ºä¾‹ã€‚ åŸºæœ¬ä¸Šï¼Œè¿™äº›æ˜¯å¸¦æœ‰ç¤ºä¾‹çš„æ•™ç¨‹ï¼Œç”¨äºè¾“å…¥ä¸»é¢˜ã€‚ ä½†æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰ç¼–å†™hieraçš„å®é™…åº”ç”¨ã€‚ ä¹Ÿè®¸æˆ‘çœ‹èµ·æ¥å¹¶ä¸å¥½ï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„ä¾‹å­ï¼Œå¯èƒ½ä¼šåƒæˆ‘æ›¾ç»é‚£æ ·å¸®åŠ©æ‚¨å°†æ‰€æœ‰è¦ç‚¹æ”¾åœ¨æˆ‘èº«ä¸Šã€‚ </p><br><h3 id="dlya-kogo-byla-by-polezna-dannaya-statya"> è¿™ç¯‡æ–‡ç« å¯¹è°æœ‰ç”¨ </h3><br><p> å¦‚æœï¼š </p><br><ul><li> æ‚¨çŸ¥é“Puppetå’ŒHieraæ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯æ‚¨å¹¶æ²¡æœ‰çœŸæ­£ä¸€èµ·ä½¿ç”¨å®ƒä»¬ï¼Œå› ä¸ºä¸æ¸…æ¥šå¦‚ä½•åšä»¥åŠä¸ºä»€ä¹ˆ </li><li> æ‚¨å…¬å¸ä¸­æœ‰å¾ˆå¤šå›¢é˜Ÿï¼Œæ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼åœ¨å‘½ä»¤çº§åˆ«åŒºåˆ†æœåŠ¡å™¨é…ç½® </li><li> æ‚¨ä½¿ç”¨pappetï¼Œå¹¶ä¸”èŠ‚ç‚¹æ–‡ä»¶å·²å¢é•¿åˆ°ä»¤äººéš¾ä»¥ç½®ä¿¡çš„å¤§å° </li><li> æ‚¨æ˜¯å¦æƒ³ä»¥ç¥åœ£çš„Yamlæ ¼å¼é˜…è¯»æœåŠ¡å™¨é…ç½®ï¼šï¼‰ </li><li> æ‚¨åŸºæœ¬ä¸Šå¯¹é…ç½®ç®¡ç†å’Œç³»ç»Ÿç®¡ç†ä¸»é¢˜æ„Ÿå…´è¶£ã€‚ </li></ul><br><p> æœ¬æ–‡é€‚åˆæ‚¨ã€‚ </p><a name="habracut"></a><br><h3 id="prezhde-chem-nachat"> å¼€å§‹ä¹‹å‰ </h3><br><p> æˆ‘ä¼šç«‹å³è­¦å‘Šæ‚¨ï¼Œè¿™ç¯‡æ–‡ç« åŸæ¥å¾ˆé•¿ï¼Œä½†æ˜¯å¸Œæœ›å¯¹æ‚¨æœ‰ç”¨ã€‚ å¦å¤–ï¼Œå¯ä»¥ç†è§£çš„æ˜¯ï¼Œæ‚¨å·²ç»å°†hieraè¿æ¥åˆ°äº†puppetï¼Œå¹¶ä¸”è‡³å°‘å¯¹puppetæœ‰æ‰€äº†è§£ã€‚ å¦‚æœæœªè¿æ¥hieraï¼Œåˆ™å¹¶ä¸éš¾ã€‚ </p><br><ul><li> åœ¨æ­¤å¤„è¯¦ç»†äº†è§£Puppetï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆå­¦è€…çš„Puppet</a> ã€‚ </li><li> å¸Œæ‹‰çš„å·¥ä½œåŸç†- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¸Œæ‹‰ä»‹ç»</a> ã€‚ </li></ul><br><h3 id="vvodnye-dannye"> è¾“å…¥æ•°æ® </h3><br><ul><li>  SEMrushå¤§çº¦æœ‰30ä¸ªå¼€å‘å›¢é˜Ÿï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½æœ‰è‡ªå·±çš„æœåŠ¡å™¨ </li><li> æ¯ä¸ªå›¢é˜Ÿéƒ½ä½¿ç”¨è‡ªå·±çš„ä¸€å¥—æŠ€æœ¯ï¼ˆPLï¼ŒDBMSç­‰ï¼‰ </li><li> å›¢é˜Ÿå¯ä»¥å¹¶ä¸”åº”è¯¥ï¼ˆç†æƒ³åœ°ï¼‰ä¸ºç‰¹å®šé¡¹ç›®ä½¿ç”¨é€šç”¨é…ç½®ï¼ˆä»£ç é‡ç”¨ï¼‰ </li><li> å›¢é˜Ÿè‡ªå·±ç®¡ç†å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼ˆè¿™ä¸æ˜¯é€šè¿‡pappetå®Œæˆçš„ï¼‰ </li></ul><br><h3 id="nemnogo-istorii"> ä¸€ç‚¹å†å² </h3><br><p> æœ€åˆï¼Œæˆ‘ä»¬åœ¨ç¬¬3ç‰ˆpappetä¸­æ‹¥æœ‰æ‰€æœ‰å†…å®¹ï¼Œç„¶åæˆ‘ä»¬å†³å®šå®æ–½ç¬¬4ç‰ˆpappetï¼Œç„¶åå°†æ‰€æœ‰æ–°æœåŠ¡å™¨éƒ½æ”¾ç½®åœ¨å…¶ä¸­ï¼Œè€Œæ—§æœåŠ¡å™¨åˆ™æ…¢æ…¢ç§»æ¤åˆ°äº†ç¬¬4ç‰ˆã€‚ </p><br><p> åœ¨ç¬¬ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç»å…¸çš„èŠ‚ç‚¹æ–‡ä»¶å’Œæ¨¡å—ç³»ç»Ÿã€‚ è¿™äº›æ¨¡å—æ˜¯åœ¨Gitlabä¸­çš„ä¸€ç»„ç‰¹æ®Šé¡¹ç›®ä¸­åˆ›å»ºçš„ï¼Œå°†å®ƒä»¬å…‹éš†åˆ°pappetæœåŠ¡å™¨ï¼ˆä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">r10k</a> ï¼‰ï¼Œç„¶åpappetä»£ç†è¿›å…¥å‘å¯¼å¹¶æ”¶åˆ°ç›®å½•ä»¥å°†å…¶åº”ç”¨äºæœåŠ¡å™¨ã€‚ </p><br><p> ç„¶åï¼Œä»–ä»¬å¼€å§‹å°è¯•ä¸è¿™æ ·åšï¼Œä¸ä½¿ç”¨æœ¬åœ°æ¨¡å—ï¼Œè€Œæ˜¯å°†æŒ‡å‘å¿…è¦æ¨¡å—åŠå…¶å­˜å‚¨åº“çš„é“¾æ¥æ”¾åœ¨Puppetfileä¸­ã€‚ æ€ä¹ˆäº† å› ä¸ºè¿™äº›æ¨¡å—ä¸€ç›´å—åˆ°ç¤¾åŒºå’Œå¼€å‘äººå‘˜çš„æ”¯æŒå’Œæ”¹è¿›ï¼ˆç†æƒ³æƒ…å†µä¸‹ï¼‰ï¼Œè€Œæˆ‘ä»¬æœ¬åœ°çš„åˆ™ä¸æ˜¯ã€‚ åæ¥ï¼Œä»–ä»¬å¼•å…¥äº†hieraå¹¶å°†å…¶å®Œå…¨åˆ‡æ¢åˆ°å®ƒï¼ŒèŠ‚ç‚¹æ–‡ä»¶ï¼ˆä¾‹å¦‚nodes.ppï¼‰å·²è¢«é—å¿˜ã€‚ </p><br><p>åœ¨ç¬¬å››ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾å®Œå…¨æ”¾å¼ƒæœ¬åœ°æ¨¡å—ï¼Œè€Œä»…ä½¿ç”¨è¿œç¨‹æ¨¡å—ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œåº”è¯¥åœ¨è¿™é‡Œå†æ¬¡æ’å…¥ä¿ç•™ï¼Œå› ä¸ºå®ƒâ€œæ²¡æœ‰å®Œå…¨è§£å†³â€ï¼Œæœ‰æ—¶æ‚¨ä»ç„¶å¿…é¡»è‡ªå·±å€¾æ–œå¹¶å®Œæˆä¸€äº›æ“ä½œã€‚ å½“ç„¶ï¼Œåªæœ‰hieraï¼Œæ²¡æœ‰èŠ‚ç‚¹æ–‡ä»¶ã€‚ </p><br><p>  <strong>å½“æ‚¨æœ‰30ä¸ªå›¢é˜Ÿä¸ä¸€ä¸ªæŠ€æœ¯åŠ¨ç‰©å›­ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¦‚ä½•ä¿æŒè¶…è¿‡1000å°æœåŠ¡å™¨çš„ç®¡ç†å˜å¾—å°¤ä¸ºæ£˜æ‰‹ã€‚</strong>  <strong>æ­¤å¤–ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨hieraåœ¨è¿™æ–¹é¢å¦‚ä½•å¸®åŠ©æˆ‘ä»¬ã€‚</strong> </p><br><h3 id="ierarhiya"> å±‚æ¬¡ç»“æ„ </h3><br><p> å¸Œæ‹‰ï¼ˆäº‹å®ä¸Šï¼Œå®ƒçš„åå­—æ¥æºäºæ­¤ï¼‰å»ºç«‹äº†ä¸€ä¸ªå±‚æ¬¡ç»“æ„ã€‚ ä¸æˆ‘ä»¬ä¸€èµ·ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre><code class="hljs axapta">--- :hierarchy: - <span class="hljs-string"><span class="hljs-string">"nodes/%{::fqdn}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/nodes/%{::fqdn}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/projects/%{::project}/tiers/%{::tier}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/projects/%{::project}/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/projects/%{::project}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/roles/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"teams/%{::team}_team/%{::team}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}/tiers/%{::tier}/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}/tiers/%{::tier}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}/%{::role}"</span></span> - <span class="hljs-string"><span class="hljs-string">"projects/%{::project}"</span></span> - <span class="hljs-string"><span class="hljs-string">"tiers/%{::tier}"</span></span> - <span class="hljs-string"><span class="hljs-string">"virtual/%{::virtual}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}/%{::operatingsystemmajrelease}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}"</span></span> - users - <span class="hljs-keyword"><span class="hljs-keyword">common</span></span></code> </pre> <br><p> é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¤„ç†æ¨¡ç³Šçš„å˜é‡ï¼ˆäº‹å®ï¼‰ã€‚ </p><br><p> ç†æƒ³æƒ…å†µä¸‹ï¼ŒSEMrushä¸­çš„æ¯ä¸ªæœåŠ¡å™¨éƒ½åº”å…·æœ‰4ä¸ªå…¬å¼€çš„ç‰¹æ®Šäº‹å®ï¼Œä»¥æè¿°å…¶ä»å±å…³ç³»ï¼š </p><br><ul><li>  <strong><code>team</code></strong>äº‹å®-å®ƒå±äºå“ªä¸ªå›¢é˜Ÿ </li><li> äº‹å®<strong><code>project</code></strong> -ä¸å“ªä¸ªé¡¹ç›®æœ‰å…³ </li><li>  <strong><code>role</code></strong>äº‹å®-è¿™ä¸ªé¡¹ç›®æœ‰ä»€ä¹ˆä½œç”¨ </li><li>  <strong><code>tier</code></strong>äº‹å®-å®ƒå…·æœ‰ä»€ä¹ˆæ ·çš„é˜¶æ®µï¼ˆç”Ÿäº§ï¼Œæµ‹è¯•ï¼Œå¼€å‘ï¼‰ </li></ul><br><p> å¦‚ä½•è¿ä½œï¼Ÿ  Pappetä»£ç†è¿›å…¥Pappetä¸»æœåŠ¡å™¨ï¼Œå¹¶æ ¹æ®è¿™äº›äº‹å®ä¸ºè‡ªå·±æœç´¢æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æˆ‘ä»¬çš„å±‚æ¬¡ç»“æ„éå†æ–‡ä»¶å¤¹ã€‚ æ— éœ€æŒ‡å‡ºé…ç½®æ–‡ä»¶å±äºæœåŠ¡å™¨ã€‚ ç›¸åï¼ŒæœåŠ¡å™¨æœ¬èº«ä»…æŸ¥çœ‹å®ƒä»¬çš„è·¯å¾„å’Œäº‹å®å°±çŸ¥é“å“ªäº›æ–‡ä»¶å±äºå®ƒä»¬ã€‚ </p><br><p> åœ¨æœåŠ¡å™¨è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œç®¡ç†å‘˜ä¸å¼€å‘äººå‘˜è¿›è¡Œäº¤æµå¹¶æŒ‡å®šè¿™äº›å‚æ•°ï¼ˆé€šå¸¸ï¼ŒçŸ¥è¯†æ¸Šåšçš„äººä¼šä¸ç®¡ç†å‘˜æœ¬èº«è”ç³»ï¼‰ï¼Œä»¥ä¾¿å°†æ¥åœ¨hieraä¸­æ„å»ºå±‚æ¬¡ç»“æ„ï¼Œç„¶ååŸºäºæ­¤å±‚æ¬¡ç»“æ„æè¿°æœåŠ¡å™¨é…ç½®ã€‚ è¿™æ ·çš„ç³»ç»Ÿæœ‰åŠ©äºé‡ç”¨ä»£ç ï¼Œå¹¶åœ¨æœåŠ¡å™¨é…ç½®æ–¹é¢æ›´åŠ çµæ´»ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<em>ç‰¹æ®Šçš„</em>é¡¹ç›®ã€‚ åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œå¯èƒ½æœ‰ä¸€äº›å¸¦æœ‰nginxçš„å‰ç«¯æœåŠ¡å™¨ï¼Œä¸€ä¸ªå¸¦æœ‰pythonçš„åç«¯æœåŠ¡å™¨ï¼Œä¸€ä¸ªå¸¦æœ‰mysqlçš„æ•°æ®åº“é›†ç¾¤ï¼Œä¸€ä¸ªç”¨äºç¼“å­˜çš„redisæœåŠ¡å™¨ã€‚ æ‰€æœ‰è¿™äº›æœåŠ¡å™¨éƒ½åº”è¯¥æ”¾åœ¨ä¸€ä¸ªåä¸º<strong>specialçš„</strong>é¡¹ç›®ä¸­ï¼Œç„¶åä¸ºæœåŠ¡å™¨åˆ†é…<strong>è§’è‰²</strong> ã€‚ </p><br><p> åœ¨é¡¹ç›®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†æ•´ä¸ªé¡¹ç›®å…±æœ‰çš„å‚æ•°ã€‚ é¦–å…ˆæƒ³åˆ°çš„æ˜¯åœ¨ç”¨æˆ·çš„æ‰€æœ‰æœåŠ¡å™¨ä¸Šåˆ›å»ºè¦éƒ¨ç½²çš„ç”¨æˆ·ï¼Œå¹¶å‘å…¶å‘å‡ºå¿…è¦çš„æƒé™å¹¶æ¨å‡ºå…¶sshå¯†é’¥ã€‚ </p><br><p> åœ¨æ¯å°æœåŠ¡å™¨çš„è§’è‰²ä¸­ï¼Œé€šå¸¸ä¼šæè¿°å’Œå®šåˆ¶æœåŠ¡-é’ˆå¯¹è¯¥æœåŠ¡å™¨çš„ç”¨é€”ï¼ˆnginxï¼Œpythonï¼Œmysqlç­‰ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¿˜éœ€è¦åœ¨å¼€å‘å¹³å°ä¸Šéƒ¨ç½²ç”Ÿäº§ç¯å¢ƒçš„å‰¯æœ¬ï¼Œåˆ™è‚¯å®šéœ€è¦è¯¥æœåŠ¡ï¼Œä½†æ›´æ”¹å…¶ä¸­çš„æŸäº›å†…å®¹ï¼ˆä¾‹å¦‚å¯†ç ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdev-serverå’Œprod-serverçš„åŒºåˆ«ä»…åœ¨äºå°†å±‚è®¾ç½®ä¸ºæ‰€éœ€çš„â€œä½ç½®â€ï¼ˆprodæˆ–devï¼‰ã€‚ ç„¶åä¸€ç‚¹é­”æœ¯å’Œå¸Œæ‹‰å°±å¯ä»¥äº†ã€‚ </p><br><p> å¦‚æœæˆ‘ä»¬éœ€è¦ä»¥åŒä¸€è§’è‰²éƒ¨ç½²ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡å™¨ï¼Œä½†æ˜¯å…¶ä¸­çš„æŸäº›å†…å®¹åº”è¯¥æœ‰æ‰€ä¸åŒï¼ˆä¾‹å¦‚ï¼Œé…ç½®ä¸­çš„æŸäº›è¡Œï¼‰ï¼Œé‚£ä¹ˆå±‚æ¬¡ç»“æ„çš„å¦ä¸€éƒ¨åˆ†å°†å¯ä»¥è§£å†³ã€‚ æˆ‘ä»¬å°†åç§°ä¸º<strong><code>{fqdn }.yaml</code></strong>æ ¼å¼çš„æ–‡ä»¶æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œ <strong><code>nodes/myserver.domain.net</code></strong> ï¼‰ï¼Œåœ¨ç‰¹å®šæœåŠ¡å™¨çº§åˆ«ä¸Šè®¾ç½®å˜é‡çš„å¿…è¦å€¼ï¼Œpappetå°†ä¸ºè¯¥è§’è‰²çš„ä¸¤ä¸ªæœåŠ¡å™¨åº”ç”¨ç›¸åŒçš„é…ç½®ï¼Œå¹¶ä¸”æ¯ä¸ªè§’è‰²éƒ½å”¯ä¸€ä»æœåŠ¡å™¨ã€‚ </p><br><p> ç¤ºä¾‹ï¼šä¸¤ä¸ªå¸¦æœ‰phpä»£ç çš„åç«¯å…·æœ‰ç›¸åŒçš„è§’è‰²ï¼Œå¹¶ä¸”å®Œå…¨ç›¸åŒã€‚ æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸æƒ³åŒæ—¶å¤‡ä»½ä¸¤ä¸ªæœåŠ¡å™¨-è¿™æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè§’è‰²æ¥æè¿°ä¸¤ä¸ªæœåŠ¡å™¨çš„ç›¸åŒé…ç½®ï¼Œç„¶ååˆ›å»ºå¦ä¸€ä¸ª<strong><code>nodes/backend1.semrush.net</code></strong>æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ”¾ç½®ç”¨äºå¤‡ä»½çš„é…ç½®ã€‚ </p><br><p> æ‰¹å¤„ç†æ–‡ä»¶<strong><code>teams/team-name.yaml</code></strong>æŒ‡ç¤ºå±äºè¯¥å›¢é˜Ÿçš„æ‰€æœ‰æœåŠ¡å™¨çš„é…ç½®ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒæè¿°äº†å¯ä»¥ä¸è¿™äº›æœåŠ¡å™¨è¿›è¡Œäº¤äº’çš„ç”¨æˆ·ä»¥åŠä»–ä»¬çš„è®¿é—®æƒé™ã€‚ </p><br><p> åŸºäºè¿™äº›å˜é‡ï¼Œæˆ‘ä»¬å»ºç«‹äº†è¿™ä¸ª<strong>å±‚æ¬¡ç»“æ„</strong> ã€‚ åœ¨å±‚æ¬¡ç»“æ„ä¸­æ‰¾åˆ°çš„æ–‡ä»¶è¶Šé«˜ï¼Œåœ¨å…¶ä¸­æŒ‡å®šçš„é…ç½®çš„ä¼˜å…ˆçº§è¶Šé«˜ã€‚ </p><br><p> å› æ­¤ï¼Œå¯ä»¥åŸºäºæ­¤å±‚æ¬¡ç»“æ„<strong>è¦†ç›–</strong>å˜é‡ã€‚ å³ï¼Œè§’è‰²æ–‡ä»¶â€œ <strong><code>projects/%{::project}/%{::role}</code></strong> â€ä¸­çš„å˜é‡ä¼˜å…ˆäºé¡¹ç›®æ–‡ä»¶â€œ <strong><code>projects/%{::project}</code></strong> â€ä¸­çš„å˜é‡ã€‚ å¦‚æœæ‚¨ä»¥å…è®¸æ‚¨æ‰§è¡Œæ­¤æ“ä½œçš„æ–¹å¼ç¼–å†™æ¨¡å—å’Œ/æˆ–é…ç½®æ–‡ä»¶/è§’è‰²ï¼Œåˆ™å˜é‡ä¹Ÿå¯ä»¥åœ¨å±‚æ¬¡ç»“æ„çš„æ‰€æœ‰çº§åˆ«ä¸Šåˆå¹¶ã€‚ é€šè¿‡ä¸ºæ‰€æœ‰é¡¹ç›®æœåŠ¡å™¨æŒ‡å®šmysqlé…ç½®çš„å…¬å…±éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥å°†å…·æœ‰è¯¥è§’è‰²æƒé‡çš„ç‰¹æ®Šéƒ¨åˆ†æ·»åŠ åˆ°å…¶ä»–å±‚æ¬¡ç»“æ„çº§åˆ«çš„åŒä¸€å˜é‡ä¸­ï¼ˆä»æœåŠ¡å™¨çš„é…ç½®ä¸­å°†æœ‰ä¸€ä¸ªé™„åŠ éƒ¨åˆ†ï¼‰ã€‚ </p><br><p> äº‹å®è¯æ˜ï¼Œæ²¿ç€è·¯å¾„â€œ <strong><code>hieradata/nodes/%{::fqdn}</code></strong> â€å®šä½çš„ç‰¹å®šèŠ‚ç‚¹çš„æ–‡ä»¶å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚ æ¥ä¸‹æ¥æ˜¯èŠ‚ç‚¹æ–‡ä»¶ï¼Œä½†æ˜¯å·²ç»åœ¨å‘½ä»¤çº§åˆ«ã€‚ ä¸‹é¢çš„å—æè¿°äº†å…¶ä»–æ›´æ™®éçš„äº‹å®ï¼š </p><br><pre> <code class="hljs axapta"> - <span class="hljs-string"><span class="hljs-string">"virtual/%{::virtual}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}/%{::operatingsystemmajrelease}"</span></span> - <span class="hljs-string"><span class="hljs-string">"os/%{::operatingsystem}"</span></span> - users - <span class="hljs-keyword"><span class="hljs-keyword">common</span></span></code> </pre> <br><p> ç›¸åº”åœ°ï¼Œåœ¨æ–‡ä»¶<strong><code>common.yaml</code></strong>æˆ‘ä»¬è‚¯å®šæœ‰ä¸€ä¸ªé…ç½®åº”<strong><code>common.yaml</code></strong> <strong>æ‰€æœ‰</strong>æœåŠ¡å™¨ï¼Œåœ¨æ–‡ä»¶<strong><code>users.yaml</code></strong>æ‰€æœ‰ç”¨æˆ·å‡ä»¥<strong><code>os/%{::operatingsystem}</code></strong> <strong><code>users.yaml</code></strong>æè¿°ï¼ˆä½†å¹¶éæ‰€æœ‰ç”¨æˆ·å‡åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºï¼‰å…·æœ‰ç‰¹å®šæ“ä½œç³»ç»Ÿï¼ˆ <code>::operatingsystem</code>äº‹å®<code>::operatingsystem</code> ï¼‰çš„æœåŠ¡å™¨çš„å…¸å‹å¸¸è§„é…ç½®ï¼Œä¾æ­¤ç±»æ¨ã€‚ </p><br><p> æˆ‘è®¤ä¸ºï¼Œä»è¿™ä¸ªå±‚æ¬¡ç»“æ„æ¥çœ‹ï¼Œä¸€åˆ‡éƒ½å˜å¾—æ¸…æ™°äº†ã€‚ ä¸‹é¢ï¼Œæˆ‘å°†è€ƒè™‘ä½¿ç”¨è¿™ç§å±‚æ¬¡ç»“æ„çš„ç¤ºä¾‹ã€‚ ä½†æ˜¯é¦–å…ˆï¼Œæ‚¨éœ€è¦è°ˆè®ºé…ç½®æ–‡ä»¶ã€‚ </p><br><h3 id="profili"> ä¸ªäººèµ„æ–™ </h3><br><p> ä½¿ç”¨æ¨¡å—é…ç½®æœåŠ¡å™¨çš„é‡è¦ä¸€ç‚¹æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚ å®ƒä»¬ä½äºè·¯å¾„<strong><code>site/profiles</code></strong> ï¼Œæ˜¯æ¨¡å—çš„å…¥å£ç‚¹ã€‚ å¤šäºäº†ä»–ä»¬ï¼Œæ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ›´å¥½åœ°é…ç½®æŒ‚èµ·çš„æ¨¡å—å¹¶åˆ›å»ºå¿…è¦çš„èµ„æºã€‚ </p><br><p> è€ƒè™‘ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ æœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¨¡å—</a>å¯ä»¥å®‰è£…å’Œé…ç½®redisã€‚ è€Œä¸”æˆ‘ä»¬è¿˜æƒ³åœ¨è¿æ¥æ­¤æ¨¡å—æ—¶å°†sysctlå‚æ•°<code>vm.overcommit_memory</code>ä¸º1ï¼Œå› ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a> ã€‚ ç„¶åï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæä¾›æ­¤åŠŸèƒ½çš„å°å‹é…ç½®æ–‡ä»¶ï¼š </p><br><pre> <code class="hljs lua"># standalone redis server class profiles::db::redis ( Hash $<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = {}, String $output_buffer_limit_slave = <span class="hljs-string"><span class="hljs-string">'256mb 64mb 60'</span></span>, ) { # https://redis.<span class="hljs-built_in"><span class="hljs-built_in">io</span></span>/topics/faq#background-saving-fails-with-a-fork-<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>-under-linux-even-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-i-have-a-lot-of-free-ram sysctl { <span class="hljs-string"><span class="hljs-string">'vm.overcommit_memory'</span></span>: ensure =&gt; present, value =&gt; <span class="hljs-string"><span class="hljs-string">'1'</span></span>, } class { <span class="hljs-string"><span class="hljs-string">'::redis'</span></span>: * =&gt; $<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>, } }</code> </pre> <br><p> å¦‚ä¸Šæ‰€è¿°ï¼Œé…ç½®æ–‡ä»¶æ˜¯å…è®¸æ‚¨æ›´æ”¹/æ”¹å–„æ¨¡å—è¡Œä¸ºä»¥åŠå‡å°‘å±‚æ¬¡ç»“æ„ä¸­é…ç½®æ•°é‡çš„å·¥å…·ã€‚ å¦‚æœä½¿ç”¨è¿œç¨‹æ¨¡å—ï¼Œåˆ™ç»å¸¸ä¼šé‡åˆ°â€œç»æ‰¹å‡†â€çš„æ¨¡å—é€šå¸¸ä¸å…·å¤‡æ‰€éœ€åŠŸèƒ½æˆ–å­˜åœ¨ä¸€äº›é”™è¯¯/ç¼ºé™·çš„é—®é¢˜ã€‚ ç„¶åï¼ŒåŸåˆ™ä¸Šï¼Œæ‚¨å¯ä»¥å…‹éš†æ­¤æ¨¡å—å¹¶æ›´æ­£/æ·»åŠ åŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ­£ç¡®çš„å†³å®šæ˜¯ç¼–å†™ä¸€ä¸ªè‰¯å¥½çš„é…ç½®æ–‡ä»¶ï¼Œä»¥æ‰€éœ€çš„æ–¹å¼â€œå‡†å¤‡â€æ¨¡å—ã€‚ ä»¥ä¸‹æ˜¯é…ç½®æ–‡ä»¶çš„ä¸€äº›ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥æ›´å¥½åœ°ç†è§£ä¸ºä»€ä¹ˆéœ€è¦å®ƒä»¬ã€‚ </p><br><h3 id="sokrytie-sekretov-v-hiera"> éšè—åœ¨å¸Œæ‹‰çš„ç§˜å¯† </h3><br><p> ä¸è£¸çº¸æµ†ç›¸æ¯”ï¼Œhieraçš„é‡è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å®ƒèƒ½å¤Ÿä»¥åŠ å¯†å½¢å¼åœ¨å­˜å‚¨åº“ä¸­å°†æ•æ„Ÿæ•°æ®å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚ æ‚¨çš„å¯†ç å°†æ˜¯å®‰å…¨çš„ã€‚ </p><br><p> ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…¬å…±å¯†é’¥æ¥åŠ å¯†æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä»¥è¿™æ ·çš„ä¸€è¡Œæ”¾ç½®åœ¨hieraæ–‡ä»¶ä¸­ã€‚ å¯†é’¥çš„ç§æœ‰éƒ¨åˆ†å­˜å‚¨åœ¨pappet masterä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒè§£å¯†æ­¤æ•°æ®ã€‚ å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¡¹ç›®</a>é¡µé¢ä¸Šæ‰¾åˆ°æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ </p><br><p> åœ¨å®¢æˆ·ç«¯ï¼ˆå·¥ä½œè®¡ç®—æœºï¼‰ä¸Šï¼Œåªéœ€ä½¿ç”¨<strong><code>gem install hiera-eyaml</code></strong>å³å¯å®‰è£…è¯¥å·¥å…·ã€‚ æ­¤å¤–ï¼Œä½¿ç”¨å½¢å¼ä¸º<strong><code>eyaml encrypt --pkcs7-public-key=/path/to/public_key.pkcs7.pem -s 'hello'</code></strong>æ‚¨å¯ä»¥åŠ å¯†æ•°æ®å¹¶å°†å…¶ç²˜è´´åˆ°æ‰©å±•åä¸ºeyamlæˆ–åªæ˜¯yamlçš„æ–‡ä»¶ä¸­ï¼Œå…·ä½“å–å†³äºæ‚¨çš„æ–¹å¼é…ç½®ï¼Œç„¶åpappetå°†å¼„æ¸…æ¥šã€‚ æ‚¨å¾—åˆ°ç±»ä¼¼çš„ä¸œè¥¿ï¼š </p><br><pre> <code class="hljs ruby">roles::postrgresql::<span class="hljs-symbol"><span class="hljs-symbol">password:</span></span> <span class="hljs-string"><span class="hljs-string">'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAbIz1ihQlThMWa9T+Lq194Y6QdElMD1XTev5y+VPSHtkPTu6Al6TJaSrXF+7phJIjue+NF4ZVtJCLkHxUR6nJJqks0fcGS1vF2+6mmM9cy69sIU1A3HqpOHZLuqHAc7jUqljYxpwWSIGOK6I2FygdAp5FfOTewqfcVVmXj97EJdcv3DKrbAlSrIMO2iZRYwQvyv+qnptnZ7pilR2veOCPW2UMm6zagDLutX9Ft5vERbdaiCiEfTOpVa9Qx0GqveNRVJLV/5lfcL5ajdNBJXkvKqDbx8d3ZBtEVAAqeKlw0LqzScgmCbWQx2kUzukX5LSxbTpT0Th984Vp1sl7iPk7UTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCp5GcwidcEMA+0wjAMblkKgBCR/f9KGXUgLh3/Ok60OIT5]'</span></span></code> </pre> <br><p> æˆ–å¤šè¡Œå­—ç¬¦ä¸²ï¼š </p><br><pre> <code class="hljs powershell">roles::postgresql::password: &gt; ENC[<span class="hljs-type"><span class="hljs-type">PKCS7</span></span>,<span class="hljs-type"><span class="hljs-type">MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEw</span></span> <span class="hljs-type"><span class="hljs-type">DQYJKoZIhvcNAQEBBQAEggEAbIz1ihQlThMWa9T</span></span>+<span class="hljs-type"><span class="hljs-type">Lq194Y6QdElMD1XTev5y</span></span> +<span class="hljs-type"><span class="hljs-type">VPSHtkPTu6Al6TJaSrXF</span></span>+<span class="hljs-number"><span class="hljs-number">7</span></span><span class="hljs-type"><span class="hljs-type">phJIjue</span></span>+<span class="hljs-type"><span class="hljs-type">NF4ZVtJCLkHxUR6nJJqks0fcGS1vF</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">6</span></span><span class="hljs-type"><span class="hljs-type">mmM9cy69sIU1A3HqpOHZLuqHAc7jUqljYxpwWSIGOK6I2FygdAp5FfOTe</span></span> <span class="hljs-type"><span class="hljs-type">wqfcVVmXj97EJdcv3DKrbAlSrIMO2iZRYwQvyv</span></span>+<span class="hljs-type"><span class="hljs-type">qnptnZ7pilR2veOCPW2UM</span></span> <span class="hljs-type"><span class="hljs-type">m6zagDLutX9Ft5vERbdaiCiEfTOpVa9Qx0GqveNRVJLV</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-type"><span class="hljs-type">lfcL5ajdNBJXkv</span></span> <span class="hljs-type"><span class="hljs-type">KqDbx8d3ZBtEVAAqeKlw0LqzScgmCbWQx2kUzukX5LSxbTpT0Th984Vp1sl7</span></span> <span class="hljs-type"><span class="hljs-type">iPk7UTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCp5GcwidcEMA</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-type"><span class="hljs-type">wjAM</span></span> <span class="hljs-type"><span class="hljs-type">blkKgBCR</span></span>/<span class="hljs-type"><span class="hljs-type">f9KGXUgLh3</span></span>/<span class="hljs-type"><span class="hljs-type">Ok60OIT5</span></span>]</code> </pre> <br><p> çœ‹æ¥æˆ‘ä»¬å·²ç»åšå¥½äº†å‡†å¤‡ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸ªä¾‹å­ã€‚ </p><br><h3 id="primer-na-palcah"> æ‰‹æŒ‡ç¤ºä¾‹ </h3><br><p>  <strong>Spoiler</strong> ï¼š <em>å°†ä¼šæœ‰æ›´å¤šçš„é…ç½®ï¼Œå› æ­¤é‚£äº›å¯¹æœ¬æ–‡ä»…å‡ºäºç†è®ºä¸Šçš„å…´è¶£çš„äººå¯ä»¥è·³è¿‡æœ¬èŠ‚ï¼Œç„¶åç»§ç»­è¿›è¡Œã€‚</em> </p><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¦‚ä½•åœ¨puppet4ä¸­ä½¿ç”¨hieraé…ç½®æœåŠ¡å™¨çš„ç¤ºä¾‹ã€‚ æˆ‘ä¸ä¼šå‘å¸ƒæ‰€æœ‰é…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œå› ä¸ºå¦åˆ™è¯¥å¸–å­å¯èƒ½ä¼šå¾ˆå¤§ã€‚ æˆ‘å°†ä¸“æ³¨äºå±‚æ¬¡ç»“æ„å’Œå±‚æ¬¡ç»“æ„ã€‚ </p><br><p>  <strong>ä»»åŠ¡æ˜¯è¿™æ ·çš„ï¼š</strong>æˆ‘ä»¬éœ€è¦éƒ¨ç½²ï¼š </p><br><ul><li> åœ¨å…¶ä¸Šéƒ¨ç½²äº†postgresqlçš„ä¸¤ä¸ªç›¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ </li><li> å¦å¤–ä¸¤å°æœåŠ¡å™¨-Nginxå‰ç«¯ </li><li> ç¬¬äº”å’Œç¬¬å…­ä¸ªæœåŠ¡å™¨-Dockerä¸­çš„pythonåç«¯ </li><li> é™¤äº†æŸäº›æœåŠ¡å™¨é…ç½®å¤–ï¼Œå¼€å‘ç¯å¢ƒä¸Šçš„æ‰€æœ‰å†…å®¹éƒ½ç›¸åŒ </li></ul><br><p> æˆ‘ä»¬å°†æŒ‰é¡ºåºåˆ›å»ºå±‚æ¬¡ç»“æ„ï¼Œå¹¶ä»é¡¹ç›®æ–‡ä»¶å¼€å§‹ã€‚ </p><br><h4 id="proekt"> ä¸“æ¡ˆ </h4><br><p> åˆ›å»ºé¡¹ç›®æ–‡ä»¶<strong><code>projects/kicker.yaml</code></strong> ã€‚ æˆ‘ä»¬æ”¾å…¥äº†æ‰€æœ‰æœåŠ¡å™¨å…±æœ‰çš„ä¸œè¥¿ï¼šæˆ‘ä»¬éœ€è¦ä¸€äº›å­˜å‚¨åº“å’Œæ–‡ä»¶å¤¹æ¥è¿›è¡Œéƒ¨ç½²ï¼Œä»¥åŠéƒ¨ç½²ç”¨æˆ·æœ¬äººã€‚ </p><br><pre> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - apt::debian::semrush <span class="hljs-symbol"><span class="hljs-symbol">files:</span></span> <span class="hljs-string"><span class="hljs-string">"/srv/data"</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">ensure:</span></span> <span class="hljs-string"><span class="hljs-string">'directory'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">owner:</span></span> <span class="hljs-string"><span class="hljs-string">'deploy'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">group:</span></span> <span class="hljs-string"><span class="hljs-string">'www-data'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mode:</span></span> <span class="hljs-string"><span class="hljs-string">'0755'</span></span> <span class="hljs-string"><span class="hljs-string">'/srv/data/shared_temp'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">ensure:</span></span> <span class="hljs-string"><span class="hljs-string">'directory'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">owner:</span></span> <span class="hljs-string"><span class="hljs-string">'deploy'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">group:</span></span> <span class="hljs-string"><span class="hljs-string">'www-data'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mode:</span></span> <span class="hljs-string"><span class="hljs-string">'0775'</span></span> user_management::<span class="hljs-symbol"><span class="hljs-symbol">present:</span></span> - deploy</code> </pre> <br><h4 id="rol-db">  dbè§’è‰² </h4><br><p> ä¸º<strong><code>projects/kicker/db.yaml</code></strong>æ•°æ®åº“æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªè§’è‰²æ–‡ä»¶ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸ä¼šå°†æœåŠ¡å™¨åˆ’åˆ†ä¸ºå¤šä¸ªç¯å¢ƒï¼š </p><br><pre> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - profiles::db::postgresql profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">globals:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">manage_package_repo:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> <span class="hljs-string"><span class="hljs-string">'10'</span></span> profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">db_configs:</span></span> <span class="hljs-string"><span class="hljs-string">'listen_addresses'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">value:</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">databases:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">kicker:</span></span> {} profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">hba_rules:</span></span> <span class="hljs-string"><span class="hljs-string">'local connect to kicker'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> <span class="hljs-string"><span class="hljs-string">'local'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">database:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">auth_method:</span></span> <span class="hljs-string"><span class="hljs-string">'md5'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">order:</span></span> <span class="hljs-string"><span class="hljs-string">'001'</span></span> <span class="hljs-string"><span class="hljs-string">'allow connect from 192.168.1.100'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> <span class="hljs-string"><span class="hljs-string">'host'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">database:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">auth_method:</span></span> <span class="hljs-string"><span class="hljs-string">'md5'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">address:</span></span> <span class="hljs-string"><span class="hljs-string">'192.168.1.100/32'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">order:</span></span> <span class="hljs-string"><span class="hljs-string">'002'</span></span></code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿æ¥ä¸€ä¸ªä¾›æ‰€æœ‰å¸Œæœ›åœ¨å…¶æœåŠ¡å™¨ä¸Šå®‰è£…postgresçš„ç”¨æˆ·ä½¿ç”¨çš„é€šç”¨é…ç½®æ–‡ä»¶ã€‚ æˆ‘ä»¬é…ç½®é…ç½®æ–‡ä»¶ï¼Œå¹¶å…è®¸æ‚¨åœ¨åº”ç”¨ä¹‹å‰çµæ´»é…ç½®æ¨¡å—ã€‚ </p><br><p> æœ€ä»¤äººå¥½å¥‡çš„æ˜¯ï¼Œåœ¨æ­¤é…ç½®æ–‡ä»¶çš„ä»£ç ä¸‹æ–¹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">èµ„æ–™:: DB :: PostgreSQL</b> <div class="spoiler_text"><pre> <code class="hljs mel">class profiles::db::postgresql ( Hash $globals = {}, Hash $params = {}, Hash $recovery = {}, Hash[String, Hash[String, Variant[String, Boolean, Integer]]] $roles = {}, Hash[String, Hash[String, Variant[String, Boolean]]] $db_configs = {}, Hash[String, Hash[String, Variant[String, Boolean]]] $databases = {}, Hash[String, String] $db_grants = {}, Hash[String, Hash[String, String]] $extensions = {}, Hash[String, String] $table_grants = {}, Hash[String, Hash[String, String]] $hba_rules = {}, Hash[String, String] $indent_rules = {}, Optional[String] $role = undef, # <span class="hljs-string"><span class="hljs-string">'master'</span></span>, <span class="hljs-string"><span class="hljs-string">'slave'</span></span> Optional[String] $master_host = undef, Optional[String] $replication_password = undef, Integer $master_port = <span class="hljs-number"><span class="hljs-number">5432</span></span>, String $replication_user = <span class="hljs-string"><span class="hljs-string">'repl'</span></span>, String $trigger_file = <span class="hljs-string"><span class="hljs-string">'/tmp/pg_trigger.file'</span></span>, ){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> $role { <span class="hljs-string"><span class="hljs-string">'slave'</span></span>: { $_params = { manage_recovery_conf =&gt; true, } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $globals[<span class="hljs-string"><span class="hljs-string">'datadir'</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> { <span class="hljs-string"><span class="hljs-string">"${globals['datadir']}/recovery.done"</span></span>: ensure =&gt; absent, } } $_recovery = { <span class="hljs-string"><span class="hljs-string">'recovery config'</span></span> =&gt; { standby_mode =&gt; <span class="hljs-string"><span class="hljs-string">'on'</span></span>, primary_conninfo =&gt; <span class="hljs-string"><span class="hljs-string">"host=${master_host} port=${master_port} user=${replication_user} password=${replication_password}"</span></span>, trigger_file =&gt; $trigger_file, } } $_conf = { <span class="hljs-string"><span class="hljs-string">'hot_standby'</span></span> =&gt; { value =&gt; <span class="hljs-string"><span class="hljs-string">'on'</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> { $trigger_file: ensure =&gt; absent, } } <span class="hljs-string"><span class="hljs-string">'master'</span></span>: { $_conf = { <span class="hljs-string"><span class="hljs-string">'wal_level'</span></span> =&gt; { value =&gt; <span class="hljs-string"><span class="hljs-string">'replica'</span></span>, }, <span class="hljs-string"><span class="hljs-string">'max_wal_senders'</span></span> =&gt; { value =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, }, <span class="hljs-string"><span class="hljs-string">'wal_keep_segments'</span></span> =&gt; { value =&gt; <span class="hljs-number"><span class="hljs-number">32</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> { $trigger_file: ensure =&gt; present, } } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { $_params = {} $_recovery = {} $_conf = {} } } class { <span class="hljs-string"><span class="hljs-string">'::postgresql::globals'</span></span>: * =&gt; $globals, } class { <span class="hljs-string"><span class="hljs-string">'::postgresql::server'</span></span>: * =&gt; deep_merge($_params, $params), } create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::config_entry'</span></span>, deep_merge($_conf, $db_configs)) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::role'</span></span>, $roles) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::database'</span></span>, $databases) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::database_grant'</span></span>, $db_grants) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::extension'</span></span>, $extensions) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::table_grant'</span></span>, $table_grants) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::pg_hba_rule'</span></span>, $hba_rules) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::pg_indent_rule'</span></span>, $indent_rules) create_resources(<span class="hljs-string"><span class="hljs-string">'::postgresql::server::recovery'</span></span>, deep_merge($_recovery, $recovery)) }</code> </pre> </div></div><br><p> å› æ­¤ï¼Œæˆ‘ä»¬<code>Postgresql 10</code>å®‰è£…äº†<code>Postgresql 10</code> ï¼Œé…ç½®äº†configï¼ˆ <code>listen</code> ï¼‰ï¼Œåˆ›å»ºäº†<code>kicker</code>æ•°æ®åº“ï¼Œå¹¶åœ¨<code>pg_hba.conf</code>ç¼–å†™äº†ä¸¤ä¸ªè®¿é—®è¯¥æ•°æ®åº“çš„è§„åˆ™ã€‚ å¥½é…·ï¼ </p><br><h4 id="rol-frontend"> å‰ç«¯è§’è‰² </h4><br><p> æˆ‘ä»¬æ‰¿æ‹…<code>frontend</code> ã€‚ ä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»º<strong><code>projects/kicker/frontend.yaml</code></strong>æ–‡ä»¶ï¼š </p><br><pre> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - profiles::webserver::nginx profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">servers:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker.semrush.com'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">use_default_location:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-symbol"><span class="hljs-symbol">listen_port:</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server_name:</span></span> - <span class="hljs-string"><span class="hljs-string">'kicker.semrush.com'</span></span> profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">locations:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-root'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">location:</span></span> <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy:</span></span> <span class="hljs-string"><span class="hljs-string">'http://kicker-backend.semrush.com:8080'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_set_header:</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Real-IP $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Forwarded-for $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'Host kicker.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">location_cfg_append:</span></span> <span class="hljs-string"><span class="hljs-string">'proxy_next_upstream'</span></span>: <span class="hljs-string"><span class="hljs-string">'error timeout invalid_header http_500 http_502 http_503 http_504'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_connect_timeout:</span></span> <span class="hljs-string"><span class="hljs-string">'5'</span></span></code> </pre> <br><p> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ æˆ‘ä»¬è¿æ¥<strong><code>profiles::webserver::nginx</code></strong>æ¦‚è¦æ–‡ä»¶ï¼Œè¯¥æ¦‚è¦æ–‡ä»¶å‡†å¤‡è¿›å…¥nginxæ¨¡å—çš„æ¡ç›®ï¼Œå¹¶å®šä¹‰å˜é‡ï¼Œå°¤å…¶æ˜¯è¯¥ç«™ç‚¹çš„<code>server</code>å’Œ<code>location</code> ã€‚ </p><br><p> ç»†å¿ƒçš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œå°†ç«™ç‚¹çš„æè¿°æ”¾åœ¨å±‚æ¬¡ç»“æ„ä¸­æ›´é«˜çš„ä½ç½®æ›´åˆé€‚ï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶ä¼šæ‹¥æœ‰ä¸€ä¸ªdevç¯å¢ƒï¼Œå¹¶ä¸”åœ¨é‚£é‡Œå°†ä½¿ç”¨å…¶ä»–å˜é‡ï¼ˆ <code>server_name</code> ï¼Œ <code>proxy</code> ï¼‰ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¤ªé‡è¦ã€‚ é€šè¿‡è¿™ç§æ–¹å¼æè¿°è§’è‰²ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä½•ä»…é€šè¿‡å±‚æ¬¡ç»“æ„æ¥é‡æ–°å®šä¹‰è¿™äº›å˜é‡ã€‚ </p><br><h4 id="rol-docker">  Dockerè§’è‰² </h4><br><p>  <strong><code>projects/kicker/docker.yaml</code></strong> ï¼š </p><br><pre> <code class="hljs ruby">--- <span class="hljs-symbol"><span class="hljs-symbol">classes:</span></span> - profiles::docker profiles::docker::<span class="hljs-symbol"><span class="hljs-symbol">params:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> <span class="hljs-string"><span class="hljs-string">'17.05.0~ce-0~debian-stretch'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">packages:</span></span> <span class="hljs-string"><span class="hljs-string">'python3-pip'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">provider:</span></span> apt <span class="hljs-string"><span class="hljs-string">'Fabric3'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">provider:</span></span> pip3 <span class="hljs-symbol"><span class="hljs-symbol">ensure:</span></span> <span class="hljs-number"><span class="hljs-number">1.12</span></span>.post1 user_management::<span class="hljs-symbol"><span class="hljs-symbol">users:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">deploy:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">groups:</span></span> - docker</code> </pre> <br><p>  <strong><code>profiles/docker.pp</code></strong>éå¸¸ç®€å•ä¼˜é›…ã€‚ æˆ‘å°†ç»™å‡ºä»–çš„ä»£ç ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ä¸ªäººèµ„æ–™::ç å¤´å·¥äºº</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">profiles</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:docker </span></span></span></span>( Hash $params = {}, <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> $install_kernel = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, ){ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-string"><span class="hljs-string">'docker'</span></span>: * =&gt; $params, } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($install_kernel) { include profiles::docker::kernel } }</code> </pre> </div></div><br><p> ä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚ è¿™è¶³ä»¥å°†æˆ‘ä»¬éœ€è¦çš„äº§å“éƒ¨ç½²åˆ°è®¸å¤šæœåŠ¡å™¨ä¸Šï¼Œåªéœ€ä¸ºå®ƒä»¬åˆ†é…ç‰¹å®šçš„é¡¹ç›®å’Œè§’è‰²å³å¯ï¼ˆä¾‹å¦‚ï¼Œå°†æ–‡ä»¶ä»¥æ‰€éœ€çš„æ ¼å¼æ”¾åœ¨facts.dç›®å½•ä¸­ï¼Œè¯¥æ–‡ä»¶çš„ä½ç½®å–å†³äºå®‰è£…pçš„æ–¹æ³•ï¼‰ã€‚ </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å…·æœ‰ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š </p><br><pre> <code class="bash hljs">. â”œâ”€â”€ kicker â”‚ â”œâ”€â”€ db.yaml â”‚ â”œâ”€â”€ docker.yaml â”‚ â””â”€â”€ frontend.yaml â””â”€â”€ kicker.yaml 1 directory, 4 files</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†è®¨è®ºç¯å¢ƒå’Œç‰¹å®šç«™ç‚¹ä¸Šè§’è‰²æ‰€ç‹¬æœ‰çš„é…ç½®çš„å®šä¹‰ã€‚ </p><br><h4 id="okruzheniya-i-override"> ç¯å¢ƒä¸æ›¿ä»£ </h4><br><p> è®©æˆ‘ä»¬ä¸ºæ‰€æœ‰é”€å”®åˆ›å»ºå¸¸è§„é…ç½®ã€‚ æ–‡ä»¶<strong><code>projects/kicker/tiers/prod.yaml</code></strong>åŒ…å«ä¸€ä¸ªæŒ‡ç¤ºï¼Œè¡¨æ˜æˆ‘ä»¬éœ€è¦å°†å¸¦æœ‰é˜²ç«å¢™çš„ç±»è¿æ¥åˆ°æ­¤ç¯å¢ƒï¼ˆå½“ç„¶ï¼Œprodéƒ½ä¸€æ ·ï¼‰ï¼Œä»¥åŠæä¾›æ›´é«˜å®‰å…¨çº§åˆ«çš„æŸä¸ªç±»ï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">--- classes: - semrush_firewall - strict_security_level</span></span></code> </pre> <br><p> å¯¹äºå¼€å‘ç¯å¢ƒï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æè¿°ç‰¹å®šçš„å†…å®¹ï¼Œåˆ™ä¼šåˆ›å»ºç›¸åŒçš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­è¾“å…¥å¿…è¦çš„é…ç½®ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨ä»ç„¶éœ€è¦ä¸ºå¼€å‘ç¯å¢ƒä¸­çš„<code>frontend</code>è§’è‰²çš„nginxé…ç½®é‡æ–°å®šä¹‰å˜é‡ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åˆ›å»ºæ–‡ä»¶<strong><code>projects/kicker/tiers/dev/frontend.yaml</code></strong> ã€‚ æ³¨æ„æ–°çš„å±‚æ¬¡ç»“æ„ã€‚ </p><br><pre> <code class="hljs ruby">--- profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">servers:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-dev.semrush.com'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">use_default_location:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-symbol"><span class="hljs-symbol">listen_port:</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server_name:</span></span> - <span class="hljs-string"><span class="hljs-string">'kicker-dev.semrush.com'</span></span> profiles::webserver::nginx::<span class="hljs-symbol"><span class="hljs-symbol">locations:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-root'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">location:</span></span> <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">server:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker-dev.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy:</span></span> <span class="hljs-string"><span class="hljs-string">'http://kicker-backend-dev.semrush.com:8080'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_set_header:</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Real-IP $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'X-Forwarded-for $remote_addr'</span></span> - <span class="hljs-string"><span class="hljs-string">'Host kicker-dev.semrush.com'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">location_cfg_append:</span></span> <span class="hljs-string"><span class="hljs-string">'proxy_next_upstream'</span></span>: <span class="hljs-string"><span class="hljs-string">'error timeout invalid_header http_500 http_502 http_503 http_504'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">proxy_connect_timeout:</span></span> <span class="hljs-string"><span class="hljs-string">'5'</span></span></code> </pre> <br><p> æ‚¨ä¸å†éœ€è¦æŒ‡å®šä¸€ä¸ªç±»ï¼›å®ƒæ˜¯ä»å±‚æ¬¡ç»“æ„çš„å…ˆå‰çº§åˆ«ç»§æ‰¿çš„ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ›´æ”¹äº†<code>server_name</code>å’Œ<code>proxy_pass</code> ã€‚ å…·æœ‰äº‹å®è§’è‰²= frontendå’Œtier = devçš„æœåŠ¡å™¨å°†é¦–å…ˆä¸ºå…¶è‡ªèº«æ‰¾åˆ°<strong><code>projects/kicker/frontend.yaml</code></strong>æ–‡ä»¶ï¼Œä½†æ˜¯æ­¤æ–‡ä»¶ä¸­çš„å˜é‡å°†è¢«ä¼˜å…ˆçº§æ›´é«˜çš„<strong><code>projects/kicker/tiers/dev/frontend.yaml</code></strong>æ–‡ä»¶è¦†ç›–ã€‚ </p><br><h4 id="sokrytie-parolya-dlya-postgresql">  PostgreSQLçš„å¯†ç éšè— </h4><br><p> å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è®®ç¨‹ä¸Šæœ‰æœ€åä¸€é¡¹-è®¾ç½®PostgreSQLçš„å¯†ç ã€‚ </p><br><p> å¯†ç åœ¨ç¯å¢ƒä¸­åº”æœ‰æ‰€ä¸åŒã€‚ æˆ‘ä»¬å°†ä½¿ç”¨eyamlå®‰å…¨åœ°å­˜å‚¨å¯†ç ã€‚ åˆ›å»ºå¯†ç ï¼š </p><br><pre> <code class="bash hljs">eyaml encrypt -s <span class="hljs-string"><span class="hljs-string">'verysecretpassword'</span></span> eyaml encrypt -s <span class="hljs-string"><span class="hljs-string">'testpassword'</span></span></code> </pre> <br><p> æˆ‘ä»¬å°†ç»“æœè¡Œåˆ†åˆ«ç²˜è´´åˆ°<code>**projects/kicker/tiers/prod/db.yaml**</code>å’Œ<code>**projects/kicker/tiers/dev/db.yaml**</code> ï¼ˆæˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨eyamlæ‰©å±•åï¼Œè¿™æ˜¯å¯è‡ªå®šä¹‰çš„ï¼‰ã€‚ è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="hljs ruby">--- profiles::db::postgresql::<span class="hljs-symbol"><span class="hljs-symbol">roles:</span></span> <span class="hljs-string"><span class="hljs-string">'kicker'</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">password_hash:</span></span> &gt; <span class="hljs-string"><span class="hljs-string">'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAsdpb2P0axUJzyWr2duRKAjh0WooGYUmoQ5gw0nO9Ym5ftv6uZXv25DRMKh7vsbzrrOR5/lLesx/pAVmcs2qbhd/y0Vr1oc2ohHlZBBKtCSEYwem5VN+kTMhWPvlt93x/S9ERoBp8LrrsIvicSYZByNfpS2DXCFbogSXCfEPxTTmCOtlOnxdjidIc9Q1vfAXv7FRQanYIspr2UytScm56H/ueeAc/8RYK51/nXDMtdPOiAP5VARioUKyTDSk8FqNvdUZRqA3cl+hA+xD5PiBHn5T09pnH8HyE/39q09gE0pXRe5+mOnU/4qfqFPc/EvAgAq5mVawlCR6c/cCKln5wJTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDNKijGHBLPCth0sfwAjfl/gBAaPsfvzZQ/Umgjy1n+im0s]'</span></span></code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œå°†æä¾›<code>kicker</code>è§’è‰²çš„å¯†ç ï¼Œå¹¶å°†å…¶è§£å¯†å¹¶åº”ç”¨äºPostgreSQLä¸­çš„æ•°æ®åº“æœåŠ¡å™¨ã€‚ </p><br><p> å®é™…ä¸Šï¼Œä»…æ­¤è€Œå·²ã€‚ æ˜¯çš„ï¼Œè¿™ä¸ªä¾‹å­è¯æ˜æ˜¯å·¨å¤§çš„ï¼Œä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›å®ƒæ˜¯å¯è¡Œçš„ï¼Œä¸ä¼šç•™ä¸‹ä»»ä½•é—®é¢˜ï¼Œæ—¢æ¸…æ™°åˆæœ‰ç”¨ã€‚ åœ¨hieraä¸­å¾—åˆ°çš„å±‚æ¬¡ç»“æ„æ˜¯è¿™æ ·çš„ï¼š </p><br><pre> <code class="bash hljs">. â”œâ”€â”€ db.yaml â”œâ”€â”€ docker.yaml â”œâ”€â”€ frontend.yaml â””â”€â”€ tiers â”œâ”€â”€ dev â”‚ â”œâ”€â”€ db.yaml â”‚ â””â”€â”€ frontend.yaml â”œâ”€â”€ prod â”‚ â””â”€â”€ db.yaml â””â”€â”€ prod.yaml 3 directories, 7 files</code> </pre> <br><p> æ‚¨å¯ä»¥é€šè¿‡å…‹éš†ä¸“é—¨åˆ›å»ºçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“æ¥</a>å®æ—¶è§‚çœ‹è¿™äº›æ–‡ä»¶ </p><br><h3 id="zaklyuchenie"> ç»“è®º </h3><br><p>  Puppetå¾ˆå¥½ï¼Œå¹¶ä¸”æ˜“äºä¸hieraä¸€èµ·ä½¿ç”¨ã€‚ æˆ‘æ ¹æœ¬ä¸ä¼šç§°å®ƒä¸ºç°ä»£ä¸–ç•Œä¸­ç†æƒ³çš„é…ç½®å·¥å…·ï¼Œä½†å®ƒå€¼å¾—å…³æ³¨ã€‚ ä»–å¾ˆå¥½åœ°å¤„ç†äº†ä¸€äº›ä»»åŠ¡ï¼Œä»–çš„â€œå“²å­¦â€ä¿æŒèµ„æºå’Œé…ç½®çš„çŠ¶æ€å§‹ç»ˆç›¸åŒï¼Œå¯ä»¥åœ¨ç¡®ä¿é…ç½®çš„å®‰å…¨æ€§å’Œç»Ÿä¸€æ€§æ–¹é¢å‘æŒ¥é‡è¦ä½œç”¨ã€‚ </p><br><p> ç°ä»£ä¸–ç•Œæ­£åœ¨é€æ­¥ååŒå‘å±•ã€‚ ç°åœ¨å¾ˆå°‘æœ‰äººåªä½¿ç”¨ä¸€ä¸ªé…ç½®ç³»ç»Ÿï¼Œé€šå¸¸åœ¨devopså’Œadminçš„äººå‘˜ä¸­ï¼Œä¸€æ¬¡æœ‰å¤šä¸ªç³»ç»Ÿã€‚ è¿™å¾ˆå¥½ï¼Œå› ä¸ºæœ‰å¾ˆå¤šé€‰æ‹©ã€‚ æœ€ä¸»è¦çš„æ˜¯ï¼Œä¸€åˆ‡éƒ½åº”è¯¥æ˜¯é€»è¾‘ä¸”å¯ç†è§£çš„ï¼Œå¦‚ä½•ä»¥åŠåœ¨ä½•å¤„è¿›è¡Œé…ç½®ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬ä½œä¸ºç®¡ç†å‘˜çš„ç›®æ ‡æ˜¯è‡ªå·±ä¸é…ç½®ä»»ä½•å†…å®¹ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¿™äº›éƒ½åº”ç”±å›¢é˜Ÿè‡ªå·±å®Œæˆã€‚ æˆ‘ä»¬å¿…é¡»ç»™ä»–ä»¬æä¾›ä¸€ç§å·¥å…·æˆ–äº§å“ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå®‰å…¨ï¼Œè½»æ¾ä¸”æœ€é‡è¦çš„æ˜¯è·å¾—å‡†ç¡®çš„ç»“æœã€‚ å¥½å§ï¼Œæ¯”èµ·â€œæ‚¨éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…PostgreSQLå¹¶åˆ›å»ºç”¨æˆ·â€ï¼Œå®ƒè¿˜å¯ä»¥å¸®åŠ©è§£å†³ä½“ç³»ç»“æ„å’Œæ›´ä¸¥é‡çš„é—®é¢˜ã€‚ å¡è’™ï¼Œ2018åœ¨é™¢å­é‡Œï¼ <del> å› æ­¤ï¼Œä¸¢ä¸‹æœ¨å¶å’Œçƒ¦æ¼ï¼Œèµ°å‘æ— æœåŠ¡å™¨çš„æœªæ¥ã€‚ </del></p><br><p> éšç€äº‘ï¼Œå®¹å™¨åŒ–å’Œå®¹å™¨ç¼–æ’ç³»ç»Ÿçš„å‘å±•ï¼Œé…ç½®ç®¡ç†ç³»ç»Ÿæ­£é€æ¸é€€å›åˆ°ç”¨æˆ·å’Œå®¢æˆ·çš„åå°ã€‚ æ‚¨è¿˜å¯ä»¥åœ¨äº‘ä¸­æ„å»ºå®¹å™¨çš„æ•…éšœå®‰å…¨ç¾¤é›†ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨æ»‘åŠ¨ï¼Œå¤‡ä»½ï¼Œå¤åˆ¶ï¼Œè‡ªåŠ¨å‘ç°ç­‰å°†åº”ç”¨ç¨‹åºä¿å­˜åœ¨å®¹å™¨ä¸­ï¼Œè€Œæ— éœ€ä¸ºansibleï¼Œpuppetï¼Œchefç­‰ç¼–å†™ä¸€è¡Œã€‚ æ‚¨æ— éœ€ç…§é¡¾ä»»ä½•äº‹æƒ…ï¼ˆå¥½äº†ï¼Œå·®ä¸å¤šï¼‰ã€‚ å¦ä¸€æ–¹é¢ï¼Œç”±äºäº‘çš„åŸå› ï¼Œé“æœåŠ¡å™¨æ•°é‡è¾ƒå°‘ã€‚ åªæ˜¯æ‚¨ä¸å†éœ€è¦é…ç½®å®ƒä»¬ï¼Œæ­¤æ“ä½œæ˜¯äº‘æä¾›å•†çš„è´£ä»»ã€‚ ä½†æ˜¯ä»–ä»¬ä¸å¤ªå¯èƒ½ä½¿ç”¨ä¸æ™®é€šå‡¡äººç›¸åŒçš„ç³»ç»Ÿã€‚ </p><br><h4 id="credits"> å­¦åˆ† </h4><br><p> è°¢è°¢ï¼š </p><br><ul><li>  Dmitry Tupitsinï¼ŒDmitry Loginovï¼ŒStepan Fedorovå’Œæ•´ä¸ªç³»ç»Ÿç®¡ç†å‘˜å›¢é˜Ÿåœ¨ç¼–å†™æœ¬æ–‡æ—¶æä¾›äº†å¸®åŠ© </li><li> å¼—æ‹‰åŸºç±³å°”Â·è±æ ¼ç§‘æ–¯æ‰˜æ³¢å¤«ï¼ˆVladimir Legkostupovï¼‰çš„ç…§ç‰‡ </li><li>  Yana Tabakovaç»„ç»‡äº†æ‰€æœ‰è¿™äº›å·¥ä½œï¼Œå¹¶å¸®åŠ©å®Œæˆäº†æ‰€æœ‰é¢„å‘å¸ƒé˜¶æ®µ </li><li>  Nikita Zakharovåœ¨è®¸å¯äº‹å®œä¸Šæä¾›ååŠ© </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN412587/">https://habr.com/ru/post/zh-CN412587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN412573/index.html">Geektimesè¿”å›Habræœ‰ä»€ä¹ˆé—®é¢˜</a></li>
<li><a href="../zh-CN412575/index.html">æ¯å¹´ï¼Œæµè¡ŒéŸ³ä¹å˜å¾—è¶Šæ¥è¶Šå•è°ƒï¼Œå› ä¸ºåŒä¸€ä¸ªäººç»„æˆäº†æµè¡ŒéŸ³ä¹</a></li>
<li><a href="../zh-CN412579/index.html">å¥‡è¿¹ï¼šæ— é™æˆ˜äº‰æˆ–å¦‚ä½•åœ¨å‡ åˆ†é’Ÿå†…ä¸ºæ‚¨çš„é¡¹ç›®æ”¶é›†æ•°æ®</a></li>
<li><a href="../zh-CN412581/index.html">ä»çŸ³å™¨æ—¶ä»£åˆ°ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ï¼šå¦‚ä½•ä½¿ç”¨æœºå™¨äººç ”ç©¶å†å²æ–‡ç‰©</a></li>
<li><a href="../zh-CN412583/index.html">æˆ‘ä»¬æ‹†å¸Redmond G200Sæ°´å£¶åè®®å¹¶å°†å…¶è¿æ¥åˆ°HomeAssistant</a></li>
<li><a href="../zh-CN412591/index.html">å»ºé€ å–·æ°”èƒŒåŒ…ï¼š5æœˆ29æ—¥æ˜¯æ¸©å¾·å°”Â·æ‘©å°”çºªå¿µæ—¥</a></li>
<li><a href="../zh-CN412593/index.html">æ–°äº§å“ï¼Œå¹³å°å’Œå…¨æ–¹ä½æœåŠ¡ï¼šHPEç½‘ç»œç ”è®¨ä¼š</a></li>
<li><a href="../zh-CN412595/index.html">ã€Š 2018å¹´ç½—é©¬ä¿±ä¹éƒ¨æŠ¥å‘Šã€‹ç¬¬1.1.2ç« ï¼šâ€œè´¢åŠ¡â€</a></li>
<li><a href="../zh-CN412597/index.html">æ°å¤«Â·è´ä½æ–¯ï¼ˆJeff Bezosï¼‰å°†åœ¨æœˆçƒè¡¨é¢å»ºç«‹ä¸€ä¸ªæ®–æ°‘åœ°</a></li>
<li><a href="../zh-CN412603/index.html">å¥‡æ€ªçš„phpè¯­å¥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>