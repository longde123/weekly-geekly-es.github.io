<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçä ‚öïÔ∏è üö´ Premi√®re rencontre avec Home Assistant ‚úãüèª üà∂ üíú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Home Assistant est une application open source populaire pour organiser une maison intelligente. La premi√®re exp√©rience de l‚Äôauteur avec le Home Assis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Premi√®re rencontre avec Home Assistant</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471822/"><img width="25%" align="right" src="https://habrastorage.org/webt/sj/wt/mu/sjwtmujve5xdbroiyxjiebxbc5o.png"><br>  Home Assistant est une application open source populaire pour organiser une maison intelligente.  La premi√®re exp√©rience de l‚Äôauteur avec le Home Assistant est bas√©e sur une tentative d‚Äôy int√©grer un cuiseur √† riz intelligent.  L'auteur tentera de d√©crire les principaux composants et fonctionnalit√©s de cette application, qu'il a eu la chance de conna√Ætre pas √† pas.  L'article est en quelque sorte une revue, en quelque sorte un guide pour ceux qui veulent commencer leur connaissance de Home Assistant. <br><a name="habracut"></a><br>  Pour ceux qui ont peu de temps libre, je vous conseille de sauter le dicton - le premier chapitre - et de passer directement au second.  Vous devez seulement savoir que nous travaillerons avec un cuiseur √† riz chinois intelligent de Xiaomi. <br><br><h3>  Cuiseur √† riz intelligent </h3>  Un cuiseur √† riz est √©videmment un cuiseur √† riz.  Wiki nous montre des bateaux √† vapeur en c√©ramique du British Museum datant de 1250 av.  En 1945, Mitsubishi est devenue la premi√®re entreprise japonaise de cuiseurs √† riz √©lectriques faits maison.  Notre mod√®le - Rice Cooker de Xiaomi - peut non seulement cuisiner du riz.  ¬´C'est un excellent appareil pour faire non seulement du riz, mais d'autres types de plats.  Il peut pr√©parer des soupes, des p√¢tisseries et bien plus encore ¬ª, indique la publicit√©.  Mais le plus important est la pr√©sence d'un module Wi-Fi, d'un logiciel avec des capacit√©s d'automatisation et de plus de 200 recettes install√©es par logiciel.  "Le chemin vers une maison intelligente par l'estomac est juste", pensa l'auteur, et d√©cida. <br><br>  Xiaomi Rice Cooker, comme il sied √† un appareil num√©rique, est tr√®s attrayant √† l'ext√©rieur, pla√Æt avec sa forme ronde et son minimalisme g√©n√©ral.  Pour le configurer et l'utiliser, le constructeur propose l'application Mi Home.  Apr√®s avoir enregistr√© un compte Mi, le programme recherche facilement un nouvel appareil et vous l'enregistrez sur votre r√©seau local.  L'interface d'application n'est pas la pire, fournit des outils d'automatisation de base et peut recevoir des notifications des appareils.  Cependant, il existe des inconv√©nients importants.  Tout le monde ne peut pas √™tre content d'envoyer des informations au d√©veloppeur sur chaque clic de l'utilisateur.  Et une expression d√©sagr√©able se retrouve souvent aujourd'hui de couleur nationale.  Au lieu de plus de 200 recettes, seulement quatre sont traduites et disponibles en langues √©trang√®res.  Le reste est exclusivement r√©serv√© au peuple chinois.  Lorsque votre cuiseur √† riz ¬´intelligent¬ª n'est pas en mesure de remplir toutes les fonctions culinaires promises, alors, vous voyez, cela devient triste.  Apr√®s avoir err√© pendant un certain temps sur Internet, un triste auteur est tomb√© sur le prochain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet</a> int√©ressant (avantages √©ternels pour l'auteur).  Ce qui s'est av√©r√© √™tre d√©di√© au d√©veloppement d'un module pour un certain Home Assistant. <br><br><h3>  Assistant √† domicile </h3>  Tout d'abord, quelques informations g√©n√©rales.  Comme on nous le dit sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la page d'accueil de HA</a> , ¬´il s'agit d'un logiciel open source pour la domotique intelligente qui se concentre sur la gestion locale et la confidentialit√©.  D√©velopp√© par le travail d'une communaut√© ouverte de passionn√©s, il est id√©al pour travailler sur un Raspberry Pi ou un serveur local. ¬ª  Le projet a plus de cinq ans, il utilise python et une licence Apache 2.0.  La version finale au moment de la r√©daction de ces lignes est 0.99.3. <br><br>  HA utilise des modules distincts (int√©grations ou composants) pour g√©rer les p√©riph√©riques.  En cr√©er un est assez simple.  Sur le site, vous trouverez un catalogue des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">principaux</a> modules (approuv√©s et soutenus par la communaut√©).  Parmi leur nombre total (1485 pi√®ces), il en existe de tr√®s divers, les noms amazon, google, xiaomi, et m√™me une fois yandex figurent dans le catalogue. <br>  Essayons d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">installer</a> HA dans un environnement virtuel sur un bureau Linux.  Nous aurons besoin de python3 et du gestionnaire de paquets pip. <br><pre><code class="bash hljs">python3 -m venv homeassistant <span class="hljs-comment"><span class="hljs-comment">#    cd homeassistant source bin/activate #    python3 -m pip install homeassistant #  Home Assistant hass --open-ui #  Home Assistant</span></span></code> </pre> <br>  Apr√®s cela, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">interface graphique</a> HA deviendra disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8123</a> .  Lors de votre premi√®re connexion, vous devrez cr√©er un compte utilisateur.  L'interface Web HA est assez volumineuse.  Quelques √©l√©ments importants qui m√©ritent d'√™tre mentionn√©s au tout d√©but sont l'onglet Configuration ‚Üí G√©n√©ral, o√π vous pouvez facilement recharger les fichiers de configuration ou le serveur lui-m√™me.  Ainsi que la page Info dans la liste des outils D√©veloppeurs, o√π vous pouvez voir les journaux d'erreurs. <br><br>  HA stocke toutes les donn√©es utilisateur n√©cessaires, dans le cas de Linux, dans le dossier de param√®tres ¬´~ / .homeassistant¬ª.  Les fichiers de configuration sont √©crits au format <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">YAML</a> , et le principal est ¬´configuration.yaml¬ª.  Il combine les donn√©es des modules, l'automatisation, etc.  La fonction d'importation vous permet de diviser les param√®tres en fichiers s√©par√©s organis√©s logiquement.  Les modules sont stock√©s dans des sous-dossiers ¬´composants¬ª (int√©gr√©s) et ¬´custom_components¬ª. <br><br>  Cette connaissance devrait nous suffire pour installer un nouveau module.  Copiez le dossier ¬´xiaomi_cooker¬ª de notre r√©f√©rentiel dans nos ¬´~ / .homeassistant / custom_components¬ª.  Selon la description, ajoutez les param√®tres du module au fichier ¬´configuration.yaml¬ª: <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">xiaomi_cooker: <span class="hljs-comment"><span class="hljs-comment">#   name: 'Akari' #   host: 192.168.1.10 # IP   token: '4921def609273302248d040a24243a25' #   Xiaomi model: chunmi.cooker.normal2 #  </span></span></code> </pre> <br></div></div><br>  C'est fait.  Apr√®s le red√©marrage HA, une nouvelle entr√©e de module appara√Ætra dans la section G√©n√©ral ‚Üí Int√©grations de l'interface Web. <br><br>  Tout module est un certain ensemble d'objets (entit√©s) et de services (services, essentiellement - fonctions).  Les objets stockent diverses donn√©es re√ßues des appareils.  Par exemple, sensor.xiaomi_cooker_temperature est la temp√©rature du cuiseur √† riz, sun.sun est la position du soleil.  Les donn√©es d'un objet sont exprim√©es par une valeur de base - √©tat (√©tat) et un ensemble arbitraire d'attributs suppl√©mentaires (attributs).  Les services sont utilis√©s pour transf√©rer des commandes et des valeurs vers des appareils.  Par exemple, xiaomi_cooker.start - la commande pour d√©marrer le fonctionnement du cuiseur √† riz, ou homeassistant.check_config - initialisation de la recherche d'erreurs dans les fichiers de param√®tres HA.  La liste des outils de d√©veloppement de l'interface Web contient la section Services, o√π vous pouvez afficher la liste des services √† votre disposition et jouer avec leurs appels.  √Ä proximit√© se trouve la section √âtats, o√π, en cons√©quence, vous pouvez afficher et modifier les valeurs des objets.  Il convient de noter que les modifications des valeurs des objets dans la section √âtats sont unilat√©rales.  C'est-√†-dire  si, par exemple, vous modifiez l'√©tat de l'objet lights.state ici de off √† on, cela n'affectera pas l'√©tat r√©el de l'appareil, et la prochaine fois que les donn√©es de l'appareil seront mises √† jour, la valeur de l'objet sera remplac√©e par r√©elle. <br><br><h3>  Automatisation </h3>  Le principal outil de gestion d'une maison intelligente est l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">automatisation</a> .  Vous pouvez les ajouter et les modifier √† l'aide de l'interface graphique dans la section G√©n√©ral ‚Üí Automatisation ou directement dans le fichier ¬´automations.yaml¬ª.  L'automatisation a pour fonction principale d'appeler des services lorsque certaines conditions sont remplies.  Outils de base pour d√©finir les conditions d'appel de la valeur des objets, incl.  donn√©es de temps.  Il existe des solutions l√©g√®rement plus sp√©cifiques, comme les √©v√©nements.  √Ä titre d'exemple d'automatisation simple, nous donnerons un code qui met √† jour les donn√©es de l'auteur sur une p√©riode de 15 minutes: <br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs"> - id: <span class="hljs-string"><span class="hljs-string">'1565889970818'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ID  alias: Umpiro decharging #  trigger: #   - platform: time_pattern #   -  minutes: /15 #   (   ‚Äì    15 ) condition: [] #    action: #    - data: # ,     entity_id: sensor.umpiro_charge #  (: ) service: homeassistant.update_entity #   </span></span></code> </pre> <br></div></div><br>  Il convient de noter que jusqu'√† pr√©sent, toutes les automatisations disponibles (par exemple, ci-dessus) ne peuvent pas √™tre configur√©es sans √©diter le code yaml via l'interface graphique, mais les d√©veloppeurs disent qu'ils travaillent activement pour √©liminer cet inconv√©nient. <br><br><h3>  Templating </h3>  Apr√®s l'automatisation, il est temps de parler de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®les</a> (mod√®les).  Divers √©l√©ments de param√®tres dans les fichiers yaml vous permettent d'utiliser des insertions dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le langage de script jinja2</a> .  Beaucoup de ces √©l√©ments sont unis par le nom commun ¬´Templates¬ª, comme service_template ou trigger_template.  En utilisant des mod√®les, nous avons acc√®s aux valeurs des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">objets dans HA</a> et la possibilit√© d'utiliser ces donn√©es dans des expressions math√©matiques et logiques complexes, ce qui √©largit consid√©rablement notre potentiel.  Par exemple, prenons un code un peu plus compliqu√© de sensor.umpiro_charge √©crit dans "configuration.yaml".  Il s'agit de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">template_sensor</a> , c'est-√†-dire ¬´un capteur qui forme des donn√©es en fonction des valeurs d'autres objets¬ª.  Notre capteur sera un peu l'analogue d'une batterie d√©charg√©e progressivement: <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">sensor: <span class="hljs-comment"><span class="hljs-comment">#   platform: template #   -  sensors: #   #   ‚Äì sensor.umpiro_charge umpiro_charge: #      UI () unit_of_measurement: '%' # ,    value_template: &gt;- #    ‚Äì   'int' # +     {% if states('sensor.umpiro_charge')|int('unknown') is number %} #       #         {% set value = (states('sensor.umpiro_charge')|int - (as_timestamp(now()) - as_timestamp(states.sensor.umpiro_charge.last_updated))/60/15)|round %} #       {{ [[0, value]|max, 100]|min }} {% else %} # ,  HA   #      {{ 'unknown' }} {% endif %} # ID  ,     #      entity_id: [] friendly_name: 'Charge' #   #      UI () device_class: battery</span></span></code> </pre><br></div></div><br>  Nous avons laiss√© entity_id vide car nous avons d√©j√† ajout√© une automatisation qui provoquera ind√©pendamment la mise √† jour des donn√©es d'objet. <br><br><h3>  Scripts Python </h3>  √Ä leur tour, les scripts python sont un outil simple pour cr√©er de nouveaux services.  Apr√®s avoir ajout√© la ligne: ¬´script python:¬ª √† ¬´configuration.yaml¬ª, tous les fichiers avec l'extension ¬´.py¬ª que nous avons plac√©s dans le dossier ¬´~ / .homeassistant / python_scripts¬ª deviendront disponibles en tant que services avec les noms ¬´python_scripts. &lt; nom_fichier&gt; ¬ª.  Leur code est ex√©cut√© dans un environnement pr√©d√©fini, o√π les donn√©es et les variables hass nous donnent acc√®s aux arguments de l'appel de service, ainsi qu'aux objets et services HA.  A titre d'exemple, nous donnons le code du fichier "charge_set.py" pour le service "python_scripts.charge_set".  Sa fonction sera de r√©gler la charge de notre batterie: <br><div class="spoiler">  <b class="spoiler_title">python_scripts / charge_set.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     name = data.get('name', 'sensor.umpiro_charge') #     new_state = data.get('charge', '100') #    attributes = hass.states.get(name).attributes #    hass.states.set(name, new_state, attributes)</span></span></code> </pre> <br></div></div><br><br><h3>  Cr√©er l'int√©gration </h3>  Tout ce que nous avons fait √† l'aide de mod√®les et de scripts Python, il serait peut-√™tre plus facile de le faire en √©crivant un module s√©par√©.  Comme d√©j√† mentionn√©, les modules non officiels sont stock√©s dans le dossier ¬´custom_components¬ª.  √Ä l'avenir, nous aurons besoin d'un objet qui stocke des informations sur la recette actuelle de notre cuiseur √† riz et d'un service qui vous permet de modifier ces donn√©es.  Sur la base d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple de la documentation,</a> nous allons cr√©er un nouveau module pour cela, ¬´overmind¬ª.  La premi√®re √©tape est le fichier custom_components / overmind / __ init__.py: <br><div class="spoiler">  <b class="spoiler_title">custom_components / overmind / __ init__.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     DOMAIN = 'overmind' #       () DEFAULT_RECIPE = { "title": "Habr post", "description": "Post an article on habr.com", "profile": "471822" } #    def setup(hass, config): #    hass.states.set('overmind.current_recipe', 'on', DEFAULT_RECIPE) #       def handle_set(call): #    recipe = call.data.get('recipe', DEFAULT_RECIPE) #   -    hass.states.set('overmind.current_recipe', 'set', recipe) #   hass.services.register(DOMAIN, 'recipe_set', handle_set) return True</span></span></code> </pre> <br></div></div><br>  Apr√®s cela, nous rapporterons le nouveau module au fichier de configuration ¬´configuration.yaml¬ª, en y ajoutant une ligne avec le nom du module: ¬´overmind:¬ª.  Le probl√®me est r√©solu. <br><br><h3>  Lovelace ui </h3>  Il s'agit du nom du HA <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">frontal</a> utilis√©.  Cette interface graphique, par laquelle un utilisateur ordinaire est invit√© √† contr√¥ler une maison intelligente, est la premi√®re page de l'interface Web HA.  L'interface LUI est form√©e de cartes de diff√©rents types, qui peuvent refl√©ter les valeurs des objets, servir √† appeler des fonctions et d'autres t√¢ches.  Les cartes peuvent √™tre distribu√©es sur des pages (vue), par analogie avec les signets du navigateur.  La configuration est organis√©e de mani√®re pratique via la m√™me interface graphique, mais est √©galement accessible via le code yaml, pour lequel il existe √©galement un √©diteur de texte int√©gr√©.  Je vous recommande de consulter la page <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://demo.home-assistant.io/</a> , o√π il existe plusieurs exemples diff√©rents de param√®tres LUI, et o√π vous pouvez facilement les voir, cliquer et les modifier. <br><br><img src="https://habrastorage.org/webt/64/bd/zf/64bdzfwclc_3sqnoek13735wgqq.png"><br>  <i><font color="grey">Exemple de configuration de l'interface graphique</font></i> <br><br>  Parlant des lacunes de l'interface, malheureusement, les d√©veloppeurs eux-m√™mes admettent que le projet essaie de s'asseoir simultan√©ment sur les chaises du bureau et du smartphone.  LUI, par d√©faut, aime d√©terminer ind√©pendamment l'emplacement et la taille des cartes, ce qui peut parfois transformer une page qui semble normale sur le moniteur en un g√¢chis sur l'√©cran du smartphone, et vice versa.  Il existe des outils simples pour rationaliser l'interface, mais d'apr√®s mon exp√©rience, ils ne sont pas toujours efficaces. <br><br>  Je pense que cela n'a pas beaucoup de sens de d√©crire la cr√©ation d'une interface √† l'aide d'outils graphiques, je vais donc donner quelques exemples sous la forme du code yaml que j'ai utilis√©.  Apr√®s avoir cr√©√© une page s√©par√©e (vue) pour notre cuiseur √† riz, nous essaierons de la remplir avec les √©l√©ments les plus n√©cessaires afin qu'elle ne provoque pas de rejet lors de l'utilisation de l'√©cran du smartphone. <br><br>  Ici, nous allons essayer ces outils de commande d'interface tr√®s simples, ce sont la pile horizontale et la pile verticale.  Tout d'abord, cr√©ez une pile verticale √† partir de cartes de types bouton-entit√© et capteur.  Le premier servira √† lancer notre cuiseur √† riz, le second - pour afficher la temp√©rature: <br><div class="spoiler">  <b class="spoiler_title">pile verticale</b> <div class="spoiler_text"><pre> <code class="bash hljs">cards: <span class="hljs-comment"><span class="hljs-comment">#    - type: entity-button #      entity: sensor.xiaomi_cooker_state # ,     icon: 'mdi:selection' #     icon_height: 100px #   name: Offline #    show_icon: true # show_name: true # tap_action: #    action: call-service #  ‚Äì   service: script.turn_on #  ‚Äì   service_data: #    entity_id: script.order_cooker_start #  ‚Äì   hold_action: #    action: none # - type: sensor #      entity: sensor.xiaomi_cooker_temperature # ,     name: Temper #   type: vertical-stack #   ‚Äì  </span></span></code> </pre> <br></div></div><br>  L'assistant d'accueil comprend une archive d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ic√¥nes de conception</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mat√©riaux</a> qui, par le biais de noms appropri√©s (par exemple, mdi: s√©lection), peuvent √™tre utilis√©es dans les √©l√©ments de param√®tres.  Le script (dans ce cas, pas python-, mais yaml-), que nous appelions le service, est un autre outil HA pratique. <br><br>  Combinez maintenant la pile verticale ci-dessus avec la carte portrait de la n√¥tre dans la pile maintenant horizontale.  Tout sera aussi simple: <br><div class="spoiler">  <b class="spoiler_title">pile horizontale</b> <div class="spoiler_text"><pre> <code class="bash hljs">ards: <span class="hljs-comment"><span class="hljs-comment">#    - type: picture #   image: /local/akari_r.jpg #    - #         type: horizontal-stack #   ‚Äì  </span></span></code> </pre> <br></div></div><br>  Ici, vous devez marquer la ligne ¬´image:¬ª.  Tous les fichiers que nous mettons dans le dossier '~ / .homeassistant / www' deviennent disponibles sur le lien <a href="">http: // localhost / local / filename</a> . <br><br>  L'√©tape suivante consiste √† travailler un peu sur le bouton d'appel de service que nous avons cr√©√©.  Ce serait pratique pour nous si cela fonctionnait comme un interrupteur √† bascule, c'est-√†-dire  marche / arr√™t, et non la fa√ßon dont cela se fait maintenant.  Ceci peut √™tre r√©alis√© gr√¢ce √† l'utilisation d'une carte de type conditionnelle, dont l'affichage sur l'√©cran peut √™tre ajust√© en d√©finissant certaines conditions.  Voici le code de la carte, qui est le bouton pour √©teindre le cuiseur √† riz et n'est visible que si le cuiseur √† riz est en train de pr√©parer le plat: <br><div class="spoiler">  <b class="spoiler_title">conditionnel</b> <div class="spoiler_text"><pre> <code class="bash hljs">card: <span class="hljs-comment"><span class="hljs-comment">#    entity: sensor.xiaomi_cooker_state # icon: 'mdi:star-box-outline' # icon_height: 100px # name: Running # tap_action: # action: call-service # service: xiaomi_cooker.stop # type: entity-button # conditions: #   # ,    entity: sensor.xiaomi_cooker_mode #  ,     state: Running type: conditional #  </span></span></code> </pre> <br></div></div><br>  En r√©√©crivant le code du bouton d'alimentation pr√©c√©demment cr√©√© de la m√™me mani√®re, et en le combinant avec cela, nous obtenons un bouton qui fonctionne √† la fois en marche et en arr√™t. <br><br>  Nous compl√©tons notre int√©r√™t avec une autre carte - avec le temps jusqu'√† la fin de la cuisson (similaire √† la carte de temp√©rature), et un de plus avec les d√©tails de la recette (personnalis√©e: carte de recette) affich√©e.  En cons√©quence, nous obtenons quelque chose comme ceci: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/k6/kv/zq/k6kvzqqugn8sizjtsemxyufquo8.jpeg"></div><br><h3>  Cartes personnalis√©es </h3>  Home Assistant, en plus de la richesse de l'ensemble de types de cartes int√©gr√©s, offre bien entendu la possibilit√© de cr√©er le v√¥tre.  Ces cartes sont appel√©es cartes personnalis√©es et javascript est utilis√© pour les cr√©er.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici</a> deux exemples de code simples.  Il est facile de trouver des cartes pr√™tes √† l'emploi cr√©√©es par divers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">passionn√©s sur le</a> r√©seau, et si vous voulez vous exp√©rimenter, il sera utile de d√©couvrir qu'il existe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modules js</a> sp√©ciaux cr√©√©s pour simplifier le travail d'√©criture de nouveaux.  Mon exp√©rience avec javascript continue de vouloir moins, donc, √† titre d'exemple, je ne donnerai qu'une petite partie du code de la carte utilis√© pour s√©lectionner et afficher la recette actuelle. <br><div class="spoiler">  <b class="spoiler_title">www / recette-card.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     lit-element LitElement, html, css } from "https://unpkg.com/lit-element@latest/lit-element.js?module"; //      class RecipeCard extends LitElement { //     HA static get properties() { return { hass: {}, config: {} }; } //    callServiceEx() { this.hass.callService('persistent_notification', 'create', {message: 'example'}); } //  html-  render() { //    ,     const entityId = this.config.entity; //    const state = this.hass.states[entityId]; //    const titleStr = state ? state.attributes.title : 'unavailable'; const descrStr = state ? state.attributes.description : 'unavailable'; //    return html` &lt;ha-card&gt; &lt;div class="flex" style="margin-top:16px;"&gt; &lt;div class="icon"&gt; &lt;ha-icon icon="mdi:bowl"&gt;&lt;/ha-icon&gt; &lt;/div&gt; &lt;div class="header"&gt; &lt;span class="name"&gt;Recipe&lt;/span&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="flex info" style="margin-bottom:16px;"&gt; &lt;span class="recipe-title"&gt;${titleStr}&lt;/span&gt; &lt;span class="recipe-descr"&gt;${descrStr}&lt;/span&gt; &lt;/div&gt; &lt;/ha-card&gt; `; } //     customElements.define('recipe-card', RecipeCard);</span></span></code> </pre> <br></div></div><br><br>  Pour utiliser la nouvelle carte, vous devrez ajouter le code suivant au d√©but du fichier de param√®tres LUI: <br><div class="spoiler">  <b class="spoiler_title">carte de recette</b> <div class="spoiler_text"><pre> <code class="bash hljs">resources: <span class="hljs-comment"><span class="hljs-comment">#    - type: module #   ‚Äì  url: /local/recipe-card.js #  </span></span></code> </pre><br>  et parmi la liste des cartes: <br><pre> <code class="bash hljs"> - <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'custom:recipe-card'</span></span> <span class="hljs-comment"><span class="hljs-comment">#   entity: overmind.current_recipe # ,    </span></span></code> </pre><br><br></div></div><br><h3>  Notifications </h3>  Une partie n√©cessaire d'une maison intelligente envoie des messages √† l'utilisateur.  Dans HA, ces messages sont appel√©s notifications et il existe deux types de base de notifications.  Le premier est les notifications persistantes.  Pour les envoyer, le service int√©gr√© "persistent_notification.create" est utilis√©.  Une liste de ces messages est disponible via l'ic√¥ne en forme de cloche dans l'interface graphique, ils utilisent un balisage de d√©marque et sont essentiellement assez simples. <br><br>  Un autre outil, plus int√©ressant, est le module de notification int√©gr√© qui, gr√¢ce √† l'installation de modules suppl√©mentaires, vous permet d'envoyer des messages √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plates-formes tierces</a> .  √Ä titre d'exemple, consid√©rons un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">module pour t√©l√©gramme</a> . <br><br>  Pour utiliser le module, tout d'abord, nous devrons cr√©er un bot dans le t√©l√©gramme lui-m√™me.  Lors de la configuration, nous avons besoin du chat_id de notre utilisateur et de l'API du token bot.  Comment obtenir ces donn√©es - d√©crites en d√©tail sur le lien ci-dessus, nous supposons que nous sommes pr√™ts.  Passer directement √† l'installation du module, tout d'abord, comme nous l'avons d√©j√† fait, copiez son code source dans le dossier des composants, puis ajoutez ses param√®tres dans le fichier ¬´configuration.yaml¬ª: <br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs">telegram_bot: <span class="hljs-comment"><span class="hljs-comment">#   telegram platform: polling #   api_key: XXXXXXXXXXXXX # API Token   allowed_chat_ids: XXXXXXX # chat_id   proxy_url: socks5://XXXXXXXXXXXXX #     proxy_params: username: umpiro password: umpiro_password</span></span></code> </pre> <br>  ainsi que les param√®tres du module de notification: <br><pre> <code class="bash hljs">notify: <span class="hljs-comment"><span class="hljs-comment">#   notify name: notify_send #   (   ‚Äì  notify.notify_send) platform: telegram #   chat_id: XXXXXXX # chat_id  </span></span></code> </pre> <br></div></div><br><br>  Le module t√©l√©gramme nous permet d'envoyer des messages, des photos ou des vid√©os.  A titre d'exemple, nous allons cr√©er une automatisation pour envoyer un message avec une photo, nous informant de la fin de la cuisson. <br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="bash hljs"> - id: <span class="hljs-string"><span class="hljs-string">'1571074941908'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ID  alias: EOC #   trigger: #    # ,   - entity_id: sensor.xiaomi_cooker_mode from: Running #    #   ‚Äì    platform: state to: Waiting #    condition: [] #   action: #    - service: notify.notify_send #  ‚Äì   data: # ,     title: End of Cooking #  message: "EOC" #  data: #    photo: #   -  #   - file: /home/umpiro/.homeassistant/www/cat.jpg #   caption: ‚ÄúEOC‚Äù</span></span></code> </pre> <br></div></div><br><br><h3>  Postface </h3>  Home Assistant peut int√©resser ceux qui veulent essayer d'organiser la gestion locale d'une maison intelligente.  Il s'agit d'un projet large, int√©ressant, ouvertement et activement d√©velopp√©, gr√¢ce aux efforts de la communaut√©.  La vari√©t√© des outils Home Assistant ne peut que se r√©jouir (je n'ai pas eu le temps d'en mentionner quelques-uns importants).  Comme inconv√©nient, on peut mentionner la complexit√© relative et le caract√®re incomplet de la documentation. <br>  PS <br>  R√©cemment, le 10 octobre, il y a eu, je ne sais pas si cela peut s'appeler une release, la transition du projet de la version 0.99 √† la version 0.100. <br>  Citation des notes de publication: <br><blockquote>  Bienvenue dans les notes de version d'une autre merveilleuse version!  Non, nous n'allons pas pour 1.0, nous faisons 0.100!  Nous pensons que nous ne sommes pas encore pr√™ts avec nos objectifs pour 1.0, mais nous progressons chaque jour.  Pour un aper√ßu de ce √† quoi nous pensons, consultez notre blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mode simple dans Home Assistant 1.0.</a> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471822/">https://habr.com/ru/post/fr471822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471810/index.html">Comparer les outils d'audit des modifications dans Active Directory: Quest Change Auditor et Netwrix Auditor</a></li>
<li><a href="../fr471812/index.html">Biblioth√®que gratuite de Wolfram Engine pour les d√©veloppeurs de logiciels</a></li>
<li><a href="../fr471814/index.html">WolframClientForPython | Nouvelle biblioth√®que client Wolfram Language pour Python</a></li>
<li><a href="../fr471816/index.html">Comment signer des applications pour macOS Catalina 10.15</a></li>
<li><a href="../fr471820/index.html">Escrocs au t√©l√©phone. Troisi√®me √©tape, dans laquelle j'obtiens la documentation que ma cellule bancaire a √©t√© cr√©√©e</a></li>
<li><a href="../fr471824/index.html">Appareil photo √† disquette: 8 faits int√©ressants sur le Sony Mavica MVC-FD85 (nombreuses photos)</a></li>
<li><a href="../fr471836/index.html">Visualisation automatis√©e du code python. Quatri√®me partie: Support de documentation</a></li>
<li><a href="../fr471838/index.html">Amour math√©matique</a></li>
<li><a href="../fr471840/index.html">Pourquoi aller aux interviews</a></li>
<li><a href="../fr471844/index.html">5 raisons de visiter EPAM INSIDER au Kazakhstan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>