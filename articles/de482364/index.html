<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆔 🍿 👨🏽‍🔧 Dinge, die Sie [vielleicht] nicht über Java wussten 👨🏾‍🏫 🖋️ 💅🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grüße, Leser! 


 Dieser Artikel wird meinen Bewusstseinsstrom über Produktivität verwässern. Lassen Sie uns über lustige Dinge in Java und in Ihrer U...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dinge, die Sie [vielleicht] nicht über Java wussten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482364/"><p>  Grüße, Leser! </p><br><p> Dieser Artikel wird meinen Bewusstseinsstrom über Produktivität verwässern.  Lassen Sie uns über lustige Dinge in Java und in Ihrer Umgebung sprechen, von denen Sie <em>wahrscheinlich</em> nichts wussten.  Ich selbst habe kürzlich einige der oben genannten Dinge gelernt, daher glaube ich, dass die meisten Leser zumindest ein paar interessante Momente für sich selbst finden werden. </p><a name="habracut"></a><br><h4 id="assert-mozhet-prinimat-2-argumenta">  assert kann 2 Argumente annehmen </h4><br><p> Normalerweise wird <code>assert</code> verwendet, um eine Bedingung zu überprüfen, und löst einen <code>AssertionError</code> wenn die Bedingung nicht erfüllt ist.  Am häufigsten sieht der Scheck so aus: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> list.isEmpty();</code> </pre> <br><p>  Es kann jedoch so sein: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> list.isEmpty() : list.toString();</code> </pre> <br><p>  Der intelligente Leser hat bereits vermutet, dass der zweite Ausdruck (übrigens faul) einen Wert vom Typ <code>Object</code> zurückgibt, der an <code>AssertionError</code> und dem Benutzer zusätzliche Informationen zu dem Fehler liefert.  Eine formellere Beschreibung finden Sie im entsprechenden Abschnitt der Sprachspezifikation: <a href="https://docs.oracle.com/javase/specs/jls/se13/html/jls-14.html" rel="nofollow">https://docs.oracle.com/javase/specs/jls/se13/html/jls-14.html#jls-14.10</a> </p><br><p>  Seit fast 6 ½ Jahren arbeite ich mit Java und habe die erweiterte Verwendung des <code>assert</code> Schlüsselworts nur einmal gesehen. </p><br><h4 id="strictfp">  strictfp </h4><br><p>  Dies ist kein Schimpfwort - dies ist ein wenig bekanntes Schlüsselwort.  Gemäß der <a href="https://docs.oracle.com/javase/specs/jls/se10/html/jls-9.html" rel="nofollow">Dokumentation</a> beinhaltet seine Verwendung eine strikte Arithmetik für Gleitkommazahlen: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NonStrict</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span></span>; }</code> </pre> <br><p>  kann in verwandelt werden </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">strictfp</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Strict</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span></span>; }</code> </pre> <br><p>  Dieses Schlüsselwort kann auch auf einzelne Methoden angewendet werden: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mixed</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">strictfp</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">strictSum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span></span>; }</code> </pre> <br><p>  Lesen Sie mehr über seine Verwendung im <a href="https://en.wikipedia.org/wiki/Strictfp" rel="nofollow">Wiki-Artikel</a> .  Kurzum: Sobald dieses Schlüsselwort hinzugefügt wurde, um die Portabilität zu gewährleisten, wurde as  Die Genauigkeit der Verarbeitung von Gleitkommazahlen auf verschiedenen Prozessoren kann unterschiedlich sein. </p><br><h4 id="continue-mozhet-prinimat-argument">  Fortsetzen kann ein Argument nehmen </h4><br><p>  Ich habe es letzte Woche erfahren.  Normalerweise schreiben wir so: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Item item : items) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } use(item); }</code> </pre> <br><p>  Eine solche Verwendung setzt implizit eine Rückkehr zum Beginn des Zyklus und zum nächsten Durchlauf voraus.  Mit anderen Worten kann der obige Code wie folgt umgeschrieben werden: </p><br><pre> <code class="java hljs">loop: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Item item : items) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> loop; } use(item); }</code> </pre> <br><p>  Sie können jedoch gegebenenfalls vom Zyklus zum externen Zyklus zurückkehren: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ outer: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">10</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">15</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">13</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> outer; } } } }</code> </pre> <br><p>  Beachten Sie, dass der Zähler <code>i</code> bei der Rückkehr zum <code>outer</code> Punkt nicht zurückgesetzt wird, sodass die Schleife endlich ist. </p><br><h4 id="pri-vyzove-vararg-metoda-bez-argumentov-vsyo-ravno-sozdayotsya-pustoy-massiv">  Wenn Sie die vararg-Methode ohne Argumente aufrufen, wird trotzdem ein leeres Array erstellt </h4><br><p>  Wenn wir uns den Aufruf einer solchen Methode von außen ansehen, gibt es anscheinend nichts zu befürchten: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invokeVararg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vararg(); }</code> </pre> <br><p>  Wir haben nichts in die Methode eingegeben, oder?  Aber wenn Sie von innen schauen, ist nicht alles so rosig: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[] vararg(Object... args) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> args; }</code> </pre> <br><p>  Erfahrung bestätigt Bedenken: </p><br><pre> <code class="plaintext hljs">Benchmark Mode Cnt Score Error Units invokeVararg avgt 20 3,715 ± 0,092 ns/op invokeVararg:·gc.alloc.rate.norm avgt 20 16,000 ± 0,001 B/op invokeVararg:·gc.count avgt 20 257,000 counts</code> </pre> <br><p>  Sie können ein unnötiges Array ohne Argumente entfernen, indem Sie <code>null</code> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invokeVarargWithNull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vararg(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); }</code> </pre> <br><p>  Der Müllsammler fühlt sich wirklich besser: </p><br><pre> <code class="plaintext hljs">invokeVarargWithNull avgt 20 2,415 ± 0,067 ns/op invokeVarargWithNull:·gc.alloc.rate.norm avgt 20 ≈ 10⁻⁵ B/op invokeVarargWithNull:·gc.count avgt 20 ≈ 0 counts</code> </pre> <br><p>  Code mit <code>null</code> sieht sehr hässlich aus, der Compiler (und die Idee) werden schwören, also verwenden Sie diesen Ansatz in wirklich heißem Code und versehen Sie ihn mit Kommentaren. </p><br><h4 id="vyrazhenie-switch-case-ne-podderzhivaet-javalangclass">  Der Switch-Case-Ausdruck unterstützt java.lang.Class nicht </h4><br><p>  Dieser Code kann einfach nicht kompiliert werden: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; clazz)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (clazz) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> String.class: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Integer.class: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"int"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"obj"</span></span>; } }</code> </pre> <br><p>  Beschäftige dich damit. </p><br><h4 id="tonkosti-prisvaivaniya-i-classisassignablefrom">  Feinheiten der Zuweisung und Class.isAssignableFrom () </h4><br><p>  Es gibt einen Code: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; Integer b = <span class="hljs-number"><span class="hljs-number">10</span></span>; a = b; <span class="hljs-comment"><span class="hljs-comment">//   </span></span></code> </pre> <br><p>  Überlegen Sie nun, welchen Wert diese Methode zurückgibt: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.class.isAssignableFrom(b.getClass()); }</code> </pre> <br><p>  Nach dem Lesen des Namens der <code>Class.isAssignableFrom()</code> -Methode entsteht der falsche <em>Eindruck,</em> dass der Ausdruck <code>int.class.isAssignableFrom(b.getClass())</code> <code>true</code> <code>int.class.isAssignableFrom(b.getClass())</code> .  Wir können einer Variablen vom Typ <code>int</code> eine Variable vom Typ <code>Integer</code> zuweisen, oder? </p><br><p>  Die <code>check()</code> -Methode gibt jedoch <code>false</code> , da in der Dokumentation eindeutig Folgendes angegeben ist: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Determines if the class or interface represented by this * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> Class} object is either the same as, or is a superclass or * superinterface of, the class or interface represented by the specified * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> Class} parameter. It returns {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> true} if so; * otherwise it returns {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> false}. If this {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> Class} // &lt;---- !!! * object represents a primitive type, this method returns * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> true} if the specified {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> Class} parameter is * exactly this {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> Class} object; otherwise it returns * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> false}. * */</span></span> <span class="hljs-meta"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAssignableFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; cls)</span></span></span></span>;</code> </pre> <br><p>  Obwohl <code>int</code> nicht der Nachfolger von <code>Integer</code> (und umgekehrt), ist eine mögliche gegenseitige Zuordnung ein Merkmal der Sprache, und um Benutzer nicht irrezuführen, wird in der Dokumentation ein besonderer Vorbehalt gemacht. </p><br><p>  Moral: wenn es scheint - <del>  müssen getauft werden </del>  müssen die Dokumentation erneut lesen. </p><br><p>  Eine weitere nicht offensichtliche Tatsache ergibt sich aus diesem Beispiel: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.class != Integer.class;</code> </pre> <br><p>  Die Klasse <code>int.class</code> ist eigentlich <code>Integer.TYPE</code> , und um dies zu sehen, schauen Sie sich an, in was dieser Code kompiliert wird: </p><br><pre> <code class="java hljs">Class&lt;?&gt; toClass() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.class; }</code> </pre> <br><p>  Whack: </p><br><pre> <code class="java hljs">toClass()Ljava/lang/Class; L0 LINENUMBER <span class="hljs-number"><span class="hljs-number">11</span></span> L0 GETSTATIC java/lang/Integer.TYPE : Ljava/lang/Class; ARETURN</code> </pre> <br><p>  Wenn Sie den Quellcode für <code>java.lang.Integer</code> sehen Sie <code>java.lang.Integer</code> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Class&lt;Integer&gt; TYPE = (Class&lt;Integer&gt;) Class.getPrimitiveClass(<span class="hljs-string"><span class="hljs-string">"int"</span></span>);</code> </pre> <br><p>  Wenn Sie den Aufruf von <code>Class.getPrimitiveClass("int")</code> könnten <code>Class.getPrimitiveClass("int")</code> versucht sein, ihn auszuschneiden und durch <code>Class.getPrimitiveClass("int")</code> ersetzen: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Class&lt;Integer&gt; TYPE = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.class;</code> </pre> <br><p>  Das Erstaunlichste ist, dass das JDK mit ähnlichen Änderungen (für alle Grundelemente) zusammengesetzt wird und die virtuelle Maschine gestartet wird.  Sie wird zwar nicht lange arbeiten: </p><br><pre> <code class="plaintext hljs">java.lang.IllegalArgumentException: Component type is null at jdk.internal.misc.Unsafe.allocateUninitializedArray(java.base/Unsafe.java:1379) at java.lang.StringConcatHelper.newArray(java.base/StringConcatHelper.java:458) at java.lang.StringConcatHelper.simpleConcat(java.base/StringConcatHelper.java:423) at java.lang.String.concat(java.base/String.java:1968) at jdk.internal.util.SystemProps.fillI18nProps(java.base/SystemProps.java:165) at jdk.internal.util.SystemProps.initProperties(java.base/SystemProps.java:103) at java.lang.System.initPhase1(java.base/System.java:2002)</code> </pre> <br><p>  Der Fehler wird hier angezeigt: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringConcatHelper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ForceInline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] newArray(<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> indexCoder) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> coder = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(indexCoder &gt;&gt; <span class="hljs-number"><span class="hljs-number">32</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)indexCoder; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[]) UNSAFE.allocateUninitializedArray(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>.class, index &lt;&lt; coder); <span class="hljs-comment"><span class="hljs-comment">//&lt;-- } }</span></span></code> </pre> <br><p>  Mit den genannten Änderungen gibt <code>byte.class</code> null zurück und <code>byte.class</code> die Sicherheit. </p><br><h4 id="spring-data-jpa-pozvolyaet-obyavit-chastichno-rabotosposobnyy-repozitoriy">  Spring Data JPA kündigt ein teilweise funktionsfähiges Repository an </h4><br><p>  Ich schließe den Artikel mit einem merkwürdigen Fehler, der an der Kreuzung von Spring Date und Hibernate aufgetreten ist.  Denken Sie daran, wie wir ein Repository deklarieren, das einer bestimmten Entität dient: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre> <br><p>  Erfahrene Benutzer wissen, dass Spring Date beim Auslösen des Kontexts alle Repositorys überprüft und sofort die gesamte Anwendung zerstört, wenn beispielsweise eine Abfragekurve beschrieben werden soll: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">", ,  ?"</span></span>) <span class="hljs-function"><span class="hljs-function">Optional&lt;SimpleEntity&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findLesserOfTwoEvils</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  Nichts hindert uns jedoch daran, ein Repository mit einem linken Schlüsseltyp zu deklarieren: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre> <br><p>  Dieses Repository wird nicht nur erweitert, sondern auch teilweise in Betrieb sein. Beispielsweise <code>findAll()</code> die <code>findAll()</code> -Methode "mit einem Paukenschlag".  Es wird jedoch erwartet, dass Methoden, die den Schlüssel verwenden, mit einem Fehler fehlschlagen: </p><br><pre> <code class="plaintext hljs">IllegalArgumentException: Provided id of the wrong type for class SimpleEntity. Expected: class java.lang.Integer, got class java.lang.Long</code> </pre> <br><p>  Die Sache ist, dass Spring Date <a href="https://jira.spring.io/browse/DATACMNS-757" rel="nofollow">die</a> Klassen des Entitätsschlüssels und den Schlüssel des daran angehängten Repositorys <a href="https://jira.spring.io/browse/DATACMNS-757" rel="nofollow">nicht vergleicht</a> .  Dies geschieht nicht aus einem guten Leben heraus, sondern aufgrund der Unfähigkeit von Hibernate, in bestimmten Fällen den richtigen Schlüsseltyp auszugeben: <a href="https://hibernate.atlassian.net/browse/HHH-10690" rel="nofollow">https://hibernate.atlassian.net/browse/HHH-10690</a> </p><br><p>  In meinem Leben habe ich dies nur einmal <code>org.springframework.data.jpa.repository.query.PartTreeJpaQueryIntegrationTests$UserRepository</code> : In Tests (Trolley) von Spring Dates selbst, zum Beispiel <code>org.springframework.data.jpa.repository.query.PartTreeJpaQueryIntegrationTests$UserRepository</code> in <code>Long</code> eingegeben und <code>Integer</code> in der Entität <code>User</code> .  Und es funktioniert! </p><br><p>  Das ist alles, ich hoffe meine Rezension war nützlich und interessant für Sie. </p><br><p>  Ich gratuliere Ihnen zum neuen Jahr und wünsche Ihnen, tiefer und weiter zu graben! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482364/">https://habr.com/ru/post/de482364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482354/index.html">ConfigureAwait: Häufig gestellte Fragen</a></li>
<li><a href="../de482356/index.html">Verwenden von Windows Server ohne Explorer aus der Sicht eines normalen Windows-Benutzers</a></li>
<li><a href="../de482358/index.html">Wie Panik in Rust wirkt</a></li>
<li><a href="../de482360/index.html">Habra-Detektiv: Sie sind mit UFOs befreundet</a></li>
<li><a href="../de482362/index.html">Fast Anarchie: Eine kurze Geschichte von Fidonet, einem Projekt, bei dem es nicht darum geht, über das Internet zu gewinnen</a></li>
<li><a href="../de482366/index.html">Was halten Experten für Roboterautos von Tesla Autopilot?</a></li>
<li><a href="../de482370/index.html">nodejs: Prozessmanager und ES6-Module</a></li>
<li><a href="../de482372/index.html">Aktivieren Sie den erweiterten Sitzungsmodus für Arch Linux-Gäste in Hyper-V</a></li>
<li><a href="../de482374/index.html">Entwickeln von Spielen unter LibGDX mithilfe der Entity Component System-Vorlage</a></li>
<li><a href="../de482382/index.html">Vier Prinzipien der Übersetzung oder wie wird eine Person einem maschinellen Übersetzer nicht nachgeben?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>