<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪШ ЁЯЖЧ ЁЯСЙЁЯП╛ рдЙрдЪреНрдЪ рд╕реАрдПрдлрдПрдЪ рд▓реЗрдЯреЗрдВрд╕реА рд╕реЗ рдХрд░реНрдиреЗрд▓ рдкреИрдЪ рдХреЗ рд╕рд╛рде рдИрдЖрд░рдкреАрдПрдл / рдмреАрд╕реАрд╕реА ЁЯТв ЁЯЫл ЁЯжХ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдбреАрдмрдЧрд┐рдВрдЧ рдЯреВрд▓ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИрдВред рдЙрдирдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдкреНрд░рджрд░реНрд╢рди рдкрд░ рдкреНрд░рддрд┐рдХреВрд▓ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддреЗ рд╣реИрдВ рдФрд░ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЙрдкрдпреЛрдЧ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЙрдЪреНрдЪ рд╕реАрдПрдлрдПрдЪ рд▓реЗрдЯреЗрдВрд╕реА рд╕реЗ рдХрд░реНрдиреЗрд▓ рдкреИрдЪ рдХреЗ рд╕рд╛рде рдИрдЖрд░рдкреАрдПрдл / рдмреАрд╕реАрд╕реА</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/458592/"><img src="https://habrastorage.org/webt/-8/ok/na/-8okna9qfyroicvgoz-zenv7-si.png" alt="рдЫрд╡рд┐"><br><br>  рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдбреАрдмрдЧрд┐рдВрдЧ рдЯреВрд▓ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИрдВред  рдЙрдирдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдкреНрд░рджрд░реНрд╢рди рдкрд░ рдкреНрд░рддрд┐рдХреВрд▓ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддреЗ рд╣реИрдВ рдФрд░ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><a name="habracut"></a><br>  рдХреБрдЫ рд╕рд╛рд▓ рдкрд╣рд▓реЗ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рдФрд░ рдЙрдкрдХрд░рдг рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛</a> рдЧрдпрд╛ рдерд╛ - eBPFред  рдпрд╣ рдХрд░реНрдиреЗрд▓ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдХрдо рдУрд╡рд░рд╣реЗрдб рдХреЗ рд╕рд╛рде рдЯреНрд░реЗрд╕ рдХрд░рдирд╛ рдФрд░ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рдФрд░ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рддреГрддреАрдп-рдкрдХреНрд╖ рдореЙрдбреНрдпреВрд▓ рд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рдмрдирд╛рддрд╛ рд╣реИред <br><br>  рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рд╣реИрдВ рдЬреЛ рдХрд┐ рдИрдПрдХреНрд╕рдкреАрдПрдл рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╛рдпрдердирдмреАрд╕реАрд╕реА</a> рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдкрдиреА рд╕реНрд╡рдпрдВ рдХреА рдкреНрд░реЛрдлрд╛рдЗрд▓рд┐рдВрдЧ рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рддрд░реАрдХрд╛ рджреЗрдЦреЗрдВрдЧреЗ</a> ред  рд▓реЗрдЦ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдШрдЯрдирд╛рдУрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред  рд╣рдо рд╕рдорд╕реНрдпрд╛ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╕реЗ рд▓реЗрдХрд░ рдЙрд╕рдХреЗ рд╕реБрдзрд╛рд░ рддрдХ рдпрд╣ рдмрддрд╛рдПрдВрдЧреЗ рдХрд┐ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><h2>  рд╕рд┐рдл рдзреАрдореА рд╣реИ </h2><br>  рд╕реЗрдлрд╣ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдПрдХ рдирдпрд╛ рд╣реЛрд╕реНрдЯ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред  рдЗрд╕рдореЗрдВ рд╕реЗ рдХреБрдЫ рдбреЗрдЯрд╛ рдХреЛ рдорд╛рдЗрдЧреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рд▓рд┐рдЦрдиреЗ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЧрддрд┐ рдЕрдиреНрдп рд╕рд░реНрд╡рд░реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдХрдо рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4c/_r/yv/4c_ryvapivstw8l-nr7dipfvh8e.png"></div><br>  рдЕрдиреНрдп рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЗрд╕ рд╣реЛрд╕реНрдЯ рдкрд░ bcache рдФрд░ рдирдП linux 4.15 рдХрд░реНрдиреЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕ рд╡рд┐рдиреНрдпрд╛рд╕ рдХрд╛ рдПрдХ рдореЗрдЬрдмрд╛рди рдкрд╣рд▓реА рдмрд╛рд░ рдпрд╣рд╛рдБ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдФрд░ рдЙрд╕ рд╕рдордп рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдерд╛ рдХрд┐ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рд╕рдорд╕реНрдпрд╛ рдХреА рдЬрдбрд╝ рдХреБрдЫ рднреА рд╣реЛ рд╕рдХрддреА рд╣реИред <br><br><h3>  рдореЗрдЬрд╝рдмрд╛рди рдХреА рдЬрд╛рдБрдЪ </h3><br>  рд╢реБрд░реБрдЖрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╕реАрдл-рдУрдПрд╕рдбреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЕрдВрджрд░ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">perf</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">flamescope рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ (рдЕрдзрд┐рдХ рдЬрд┐рдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uw/gj/ox/uwgjoxekagdl-noj-wp_uy5g8q8.png"></div><br>  рдЪрд┐рддреНрд░ рд╣рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ <strong>fdatasync ()</strong> рдлрд╝рдВрдХреНрд╢рди рдиреЗ <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</strong> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдореЗрдВ рдмрд╣реБрдд рд╕рдордп рдмрд┐рддрд╛рдпрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рдХрд╛рд░рдг рдХрд╣реАрдВ рди рдХрд╣реАрдВ рдУрдПрд╕рдбреА рдбреЗрдореЙрди рдХреЗ рдмрд╛рд╣рд░ рд╣реИред  рдпрд╣ рдХрд░реНрдиреЗрд▓ рдпрд╛ рдбрд┐рд╕реНрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  Iostat рдЖрдЙрдЯрдкреБрдЯ рдиреЗ bcache рдбрд┐рд╕реНрдХ рдХреЗ рд╕рд╛рде рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдПрдХ рдЙрдЪреНрдЪ рд╡рд┐рд▓рдВрдмрддрд╛ рджрд┐рдЦрд╛рдИред <br><br>  рд╣реЛрд╕реНрдЯ рдХреА рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╕рдордп, рд╣рдордиреЗ рдкрд╛рдпрд╛ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо-рдпреВрдбрд╡реНрдб рдбреЗрдорди рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╕реАрдкреАрдпреВ рд╕рдордп рдХреА рдЦрдкрдд рдХрд░рддрд╛ рд╣реИ - рдХрдИ рдХреЛрд░ рдкрд░ рд▓рдЧрднрдЧ 20%ред  рдпрд╣ рдПрдХ рдЕрдЬреАрдм рд╡реНрдпрд╡рд╣рд╛рд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдЬрд╛рдирдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред  рдЪреВрдВрдХрд┐ Systemd-udevd uevents рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╣рдордиреЗ рдЙрдиреНрд╣реЗрдВ <strong>udvadm рдореЙрдирд┐рдЯрд░ рдХреЗ</strong> рдорд╛рдзреНрдпрдо рд╕реЗ рджреЗрдЦрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред  рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЙрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд▓рд┐рдП рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреА рдШрдЯрдирд╛рдПрдВ рдЙрддреНрдкрдиреНрди рд╣реБрдИ рдереАрдВред  рдпрд╣ рдХрд╛рдлреА рдЕрд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╣ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдХрд┐ рдЗрди рд╕рднреА рдШрдЯрдирд╛рдУрдВ рдХреЛ рдХреНрдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред <br><br><h3>  рдмреАрд╕реАрд╕реА рдЯреВрд▓рдХрд┐рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h3><br>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╣реА рдкрддрд╛ рд▓рдЧрд╛ рдЪреБрдХреЗ рд╣реИрдВ, рдХрд░реНрдиреЗрд▓ (рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдореЗрдВ <strong>рд╕реЗрдл рдбреЗрдорди) рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХреЗ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</strong> рдореЗрдВ рдмрд╣реБрдд рд╕рдордп рдмрд┐рддрд╛рддрд╛ рд╣реИред  рдЖрдЗрдП рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА рдЧрддрд┐ рдХреЛ рдорд╛рдкрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреАрд╕реАрд╕реА рдореЗрдВ</a> рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдорд╣рд╛рди рдЙрдкрдпреЛрдЧрд┐рддрд╛ рд╣реИ - <strong>рдлрдВрдЧрд▓рд╕рд┐рдЯреА</strong> ред  рд╣рдо 1 рд╕реЗрдХрдВрдб рдХреЗ рд╕реВрдЪрдирд╛ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░рд╛рд▓ рдХреЗ рд╕рд╛рде рдкреАрдЖрдИрдбреА тАЛтАЛрджреНрд╡рд╛рд░рд╛ рдбреЗрдорди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВрдЧреЗ рдФрд░ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░реЗрдВрдЧреЗред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o7/zw/rl/o7zwrly0nejoo5r7zbezws3jxmo.png"></div><br>  рдЖрдорддреМрд░ рдкрд░ рдпрд╣ рдлрдВрдХреНрд╢рди рдлрд╛рд╕реНрдЯ рд╣реЛрддрд╛ рд╣реИред  рд╡рд╣ рдЬреЛ рдХреБрдЫ рднреА рдХрд░рддреА рд╣реИ рд╡рд╣ рдбрд┐рд╡рд╛рдЗрд╕ рдбреНрд░рд╛рдЗрд╡рд░ рдХрддрд╛рд░ рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддреА рд╣реИред <br><br>  <strong>Bcache</strong> рдПрдХ рдЬрдЯрд┐рд▓ рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рддреАрди рдбрд┐рд╕реНрдХ рд╣реЛрддреЗ рд╣реИрдВ: <br><br><ul><li>  рдмреИрдХрд┐рдВрдЧ рдбрд┐рд╡рд╛рдЗрд╕ (рдХреИрд╢реНрдб рдбрд┐рд╕реНрдХ), рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рдПрдХ рдзреАрдореА рдПрдЪрдбреАрдбреА рд╣реИ; </li><li>  рдХреИрд╢рд┐рдВрдЧ рдбрд┐рд╡рд╛рдЗрд╕ (рдХреИрд╢рд┐рдВрдЧ рдбрд┐рд╕реНрдХ), рдпрд╣рд╛рдВ рдпрд╣ NVMe рдбрд┐рд╡рд╛рдЗрд╕ рдХрд╛ рдПрдХ рд╕реЗрдХреНрд╢рди рд╣реИ; </li><li>  bcache рд╡рд░реНрдЪреБрдЕрд▓ рдбрд┐рд╡рд╛рдЗрд╕ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </li></ul><br>  рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЕрдиреБрд░реЛрдз рд╕рдВрдЪрд░рдг рдзреАрдорд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕ рдЙрдкрдХрд░рдг рдХреЗ рд▓рд┐рдП?  рд╣рдо рдЗрд╕рд╕реЗ рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж рдирд┐рдкрдЯреЗрдВрдЧреЗред <br><br>  рдЕрдм рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ uevents рд╢рд╛рдпрдж рд╕рдорд╕реНрдпрд╛рдПрдВ рдкреИрджрд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрд╣ рдЬрд╛рдирдирд╛ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрдирдХреА рдкреАрдврд╝реА рдХреНрдпрд╛ рдХрд╛рд░рдг рд╣реИ, рдЗрддрдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИред  рдорд╛рди рд▓реАрдЬрд┐рдП рдпрд╣ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╣реИ рдЬреЛ рд╕рдордп-рд╕рдордп рдкрд░ рдЪрд▓рддрд╛ рд╣реИред  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреАрд╕реАрд╕реА рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ</a> рдХреЗ рдПрдХ рд╣реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реЗрдЯ</a> рд╕реЗ <strong>рдирд┐рд╖реНрдкрд╛рджрд┐рдд</strong> рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХрд┐рд╕ <strong>рддрд░рд╣</strong> рдХрд╛ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЗрд╕реЗ рдЪрд▓рд╛рдПрдБ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдВред <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣: <br><br><pre><code class="bash hljs">/usr/share/bcc/tools/execsnoop | tee ./execdump</code> </pre> <br>  рд╣рдо рдпрд╣рд╛рдБ рдкрд░ execsnoop рдХрд╛ рдкреВрд░рд╛ рдЖрдЙрдЯрдкреБрдЯ рдирд╣реАрдВ рджреЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмреНрдпрд╛рдЬ рдХреА рдПрдХ рдкрдВрдХреНрддрд┐ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИ: <br><br><pre> <code class="bash hljs">sh 1764905 5802 0 sudo arcconf getconfig 1 AD | grep Temperature | awk -F <span class="hljs-string"><span class="hljs-string">'[:/]'</span></span> <span class="hljs-string"><span class="hljs-string">'{print $2}'</span></span> | sed <span class="hljs-string"><span class="hljs-string">'s/^ \([0-9]*\) C.*/\1/'</span></span></code> </pre><br>  рддреАрд╕рд░рд╛ рдХреЙрд▓рдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ PPID (рдореВрд▓ рдкреАрдЖрдИрдбреА) рд╣реИред  рдкреАрдЖрдИрдбреА тАЛтАЛ5802 рдХреЗ рд╕рд╛рде рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣рдорд╛рд░реА рдирд┐рдЧрд░рд╛рдиреА рдкреНрд░рдгрд╛рд▓реА рдХреЗ рдзрд╛рдЧреЗ рдореЗрдВ рд╕реЗ рдПрдХ рдмрди рдЧрдИред  рдирд┐рдЧрд░рд╛рдиреА рдкреНрд░рдгрд╛рд▓реА рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╕рдордп, рдЧрд▓рдд рдкреИрд░рд╛рдореАрдЯрд░ рдкрд╛рдП рдЧрдП рдереЗред  рдПрдЪрдмреАрдП рдПрдбрд╛рдкреНрдЯрд░ рдХрд╛ рддрд╛рдкрдорд╛рди рд╣рд░ 30 рд╕реЗрдХрдВрдб рдореЗрдВ рдПрдХ рдмрд╛рд░ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рдерд╛, рдЬреЛ рдХрд┐ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реЛрддрд╛ рд╣реИред  рд╕рддреНрдпрд╛рдкрди рдЕрдВрддрд░рд╛рд▓ рдХреЛ рдПрдХ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ рдкрд╛рдпрд╛ рдХрд┐ рдЗрд╕ рдореЗрдЬрдмрд╛рди рдкрд░ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рджреЗрд░реА рдореЗрдЬрдмрд╛рди рдХреЗ рдмрд╛рдХреА рд╣рд┐рд╕реНрд╕реЛрдВ рд╕реЗ рдмрд╛рд╣рд░ рд░рд╣рдирд╛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рдпрд╣ рдЕрднреА рднреА рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ bcache рдбрд┐рд╡рд╛рдЗрд╕ рдЗрддрдирд╛ рдзреАрдорд╛ рдХреНрдпреЛрдВ рдерд╛ред  рд╣рдордиреЗ рдПрдХ рд╕рдорд░реВрдк рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдкрд░реАрдХреНрд╖рдг рдордВрдЪ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдФрд░ bcache рдкрд░ рдлрд┐рдпреЛ рдЪрд▓рд╛рдХрд░ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдкреБрди: рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рд╕рдордп-рд╕рдордп рдкрд░ uevents рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП udevadm рдЯреНрд░рд┐рдЧрд░ рд╢реБрд░реВ рдХрд┐рдпрд╛ред <br><br><h3>  рд▓реЗрдЦрди BCC- рдЖрдзрд╛рд░рд┐рдд рдЙрдкрдХрд░рдг </h3><br>  рдЖрдЗрдП <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</strong> рдХреЗ рд╕рдмрд╕реЗ рдзреАрдореЗ рдХреЙрд▓ рдХреЛ <strong>рдЯреНрд░реЗрд╕</strong> рдХрд░рдиреЗ рдФрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЙрдкрдпреЛрдЧрд┐рддрд╛ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред  рд╣рдо рдЙрд╕ рдбреНрд░рд╛рдЗрд╡ рдХреЗ рдирд╛рдо рдореЗрдВ рднреА рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛ рдЧрдпрд╛ рдерд╛ред <br><br>  рдпреЛрдЬрдирд╛ рд╕рд░рд▓ рд╣реИ: <br><br><ul><li>  <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ () рдореЗрдВ</strong> рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ <br><ul><li>  рд╣рдо рдлрд╝рдВрдХреНрд╢рди рддрд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд▓рдн рдбрд┐рд╕реНрдХ рдирд╛рдо рдХреЛ рдмрдЪрд╛рддреЗ рд╣реИрдВ; </li><li>  рд╕рдордп рдХреА рдореЛрд╣рд░ рдмрдЪрд╛рдУред </li></ul><br></li></ul><ul><li>  <strong>Generic_make_request ()</strong> рд╕реЗ рд▓реМрдЯрдиреЗ рдХреЗ рд▓рд┐рдП <strong>kretprobe</strong> рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░реЗрдВ: <br><ul><li>  рд╡рд░реНрддрдорд╛рди рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ; </li><li>  рд╣рдо рд╕рд╣реЗрдЬреЗ рдЧрдП рд╕рдордп рдЯрд┐рдХрдЯ рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╡рд░реНрддрдорд╛рди рдХреЗ рд╕рд╛рде рдЗрд╕рдХреА рддреБрд▓рдирд╛ рдХрд░рддреЗ рд╣реИрдВ; </li><li>  рдпрджрд┐ рдкрд░рд┐рдгрд╛рдо рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рд╣рдо рд╕рд╣реЗрдЬреЗ рдЧрдП рдбрд┐рд╕реНрдХ рдирд╛рдо рдХреЛ рдвреВрдВрдврддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЯрд░реНрдорд┐рдирд▓ рдкрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </li></ul><br></li></ul>  <strong>Kprobes</strong> рдФрд░ <strong>kretprobes</strong> рдордХреНрдЦреА рдкрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЖрдк рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди</a> рдФрд░ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдЪреНрдЫрд╛</a> рд▓реЗрдЦ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреАрд╕реАрд╕реА</a> рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЗ рдХреЛрдб рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рд╕рдорд╛рди рд╕рдВрд░рдЪрдирд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рд▓рд┐рдкрд┐ рддрд░реНрдХреЛрдВ рдХреЗ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗ рдФрд░ рдмреАрдкреАрдПрдл рдкреНрд░реЛрдЧреНрд░рд╛рдо рдкрд░ рд╣реА рдЖрдЧреЗ рдмрдврд╝реЗрдВрдЧреЗред <br><br>  рдкрд╛рдпрдерди рд▓рд┐рдкрд┐ рдХреЗ рдЕрдВрджрд░ рдИрдПрдХреНрд╕рдкреАрдПрдл рдкрд╛рда рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs">bpf_text = тАЬтАЭтАЭ <span class="hljs-comment"><span class="hljs-comment"># Here will be the bpf program code тАЬтАЭтАЭ</span></span></code> </pre><br>  рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЗ рдмреАрдЪ рдбреЗрдЯрд╛ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, eBPF рдкреНрд░реЛрдЧреНрд░рд╛рдо <a href="">рд╣реИрд╢ рдЯреЗрдмрд▓ рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рддреЛ рд╣рдо рдХрд░реЗрдВрдЧреЗред  рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреАрдЖрдИрдбреА тАЛтАЛрдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдореВрд▓реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рд╣рдо рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">struct data_t { u64 pid; u64 ts; char comm[TASK_COMM_LEN]; u64 lat; char disk[DISK_NAME_LEN]; }; BPF_HASH(p, u64, struct data_t); BPF_PERF_OUTPUT(events);</code> </pre><br>  рдпрд╣рд╛рдБ рд╣рдо рдПрдХ рд╣реИрд╢ рдЯреЗрдмрд▓ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ <em>p</em> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЯрд╛рдЗрдк <em>u64</em> рдХреА рдХреБрдВрдЬреА рдФрд░ рдЯрд╛рдЗрдк <em>рд╕реНрдЯреНрд░рдХреНрдЪрд░ data_t</em> рдХрд╛ рдорд╛рди рд╣реИред  рддрд╛рд▓рд┐рдХрд╛ рд╣рдорд╛рд░реЗ рдмреАрдкреАрдПрдл рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧреАред  BPF_PERF_OUTPUT рдореИрдХреНрд░реЛ <em>рдЗрд╡реЗрдВрдЯреНрд╕</em> рдирд╛рдордХ рдХрд┐рд╕реА рдЕрдиреНрдп рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдкрд░ <a href="">рдбреЗрдЯрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд</a> рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЗ рдмреАрдЪ рджреЗрд░реА рдХреЛ рдорд╛рдкрддреЗ рд╕рдордп рдФрд░ рдЙрд╕рд╕реЗ рд╡рд╛рдкрд╕ рдЖрдиреЗ рдкрд░, рдпрд╛ рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХреЗ рдмреАрдЪ, рдпрд╣ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкреНрд░рд╛рдкреНрдд рдбреЗрдЯрд╛ рдПрдХ рд╣реА рд╕рдВрджрд░реНрдн рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдЖрдкрдХреЛ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╛рдирд╛рдВрддрд░ рд▓реЙрдиреНрдЪ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдпрд╛рдж рд░рдЦрдирд╛ рд╣реЛрдЧрд╛ред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдФрд░ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд▓реМрдЯрдиреЗ рдХреЗ рдмреАрдЪ рджреЗрд░реА рдХреЛ рдорд╛рдкрдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдмреЗрдХрд╛рд░ рд╣реИред  рдпрд╣рд╛рдВ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЙрджрд╛рд╣рд░рдг рд╣реИ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд╛рдпреЛрд▓реИрдЯрд┐рдмрд┐рд▓рд┐рдЯреА рдпреВрдЯрд┐рд▓рд┐рдЯреА</a> , рдЬрд╣рд╛рдВ рдПрдХ <em>рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХрд╛</em> рдкреЙрдЗрдВрдЯрд░, рдЬреЛ рдПрдХ рд╕рд┐рдВрдЧрд▓ рдбрд┐рд╕реНрдХ <em>рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ</em> рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ, рд╣реИрд╢ рдЯреЗрдмрд▓ рдореЗрдВ рдПрдХ рдХреА рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ рдЙрд╕ рдХреЛрдб рдХреЛ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рддрдм рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд░рд╣реА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs">void start(struct pt_regs *ctx, struct bio *bio) { u64 pid = bpf_get_current_pid_tgid(); struct data_t data = {}; u64 ts = bpf_ktime_get_ns(); data.pid = pid; data.ts = ts; bpf_probe_read_str(&amp;data.disk, sizeof(data.disk), (void*)bio-&gt;bi_disk-&gt;disk_name); p.update(&amp;pid, &amp;data); }</code> </pre><br>  рдпрд╣рд╛рдВ, <a href="">рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХреЗ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</a> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рджреВрд╕рд░реЗ рддрд░реНрдХ рдХреЛ рджреВрд╕рд░реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдкреАрдЖрдИрдбреА тАЛтАЛрдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ рдиреИрдиреЛрд╕реЗрдХрдВрдб рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдкред  рдпрд╣ рд╕рдм рд╣рдо <em>рдирдП рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЧрдП рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рдбреЗрдЯрд╛_ рдбреЗрдЯрд╛ рдореЗрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВ</em> ред  рд╣рдореЗрдВ <em>рдЬреИрд╡</em> рд╕рдВрд░рдЪрдирд╛ рд╕реЗ рдбрд┐рд╕реНрдХ рдирд╛рдо рдорд┐рд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</strong> рдХрд╣рддреЗ рд╕рдордп рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реЗ рдЙрд╕реА <em>рдбреЗрдЯрд╛</em> рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЕрдВрддрд┐рдо рдЪрд░рдг рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЬреЛрдбрд╝рдирд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br><br>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</strong> рд╕реЗ рд╡рд╛рдкрд╕реА рдкрд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛: <br><br><pre> <code class="python hljs">void stop(struct pt_regs *ctx) { u64 pid = bpf_get_current_pid_tgid(); u64 ts = bpf_ktime_get_ns(); struct data_t* data = p.lookup(&amp;pid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; data-&gt;ts &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { bpf_get_current_comm(&amp;data-&gt;comm, sizeof(data-&gt;comm)); data-&gt;lat = (ts - data-&gt;ts)/<span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data-&gt;lat &gt; MIN_US) { FACTOR data-&gt;pid &gt;&gt;= <span class="hljs-number"><span class="hljs-number">32</span></span>; events.perf_submit(ctx, data, sizeof(struct data_t)); } p.delete(&amp;pid); } }</code> </pre><br>  рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреЗ рд╕рдорд╛рди рд╣реИ: рд╣рдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреАрдЖрдИрдбреА тАЛтАЛрдФрд░ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рдХреЛ рдкрд╣рдЪрд╛рдирддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдирдП рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдХреБрдВрдЬреА == рд╡рд░реНрддрдорд╛рди рдкреАрдЖрдИрдбреА тАЛтАЛрдХреЗ рд╕рд╛рде рдПрдХ рдореМрдЬреВрджрд╛ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд▓рд┐рдП рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВред  рдпрджрд┐ рд╕рдВрд░рдЪрдирд╛ рдкрд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╣рдо рдЪрд▓ рд░рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдирд╛рдо рдкрддрд╛ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЗрд╕реЗ рдЗрд╕рдореЗрдВ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред <br><br>  рдереНрд░реЗрдб GID рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдмрд╛рдЗрдирд░реА рд╢рд┐рдлреНрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╛рдиреА  рдореБрдЦреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдкреАрдЖрдИрдбреА тАЛтАЛрдЬрд┐рд╕рдиреЗ рдереНрд░реЗрдб рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд┐рд╕рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╣рдо рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред  <a href="">Bpf_get_current_pid_tgid ()</a> рдлрд╝рдВрдХреНрд╢рди <a href="">рдЬрд┐рд╕реЗ</a> рд╣рдо рдереНрд░реЗрдб рдХреЗ GID рдФрд░ рдЗрд╕рдХреЗ PID рджреЛрдиреЛрдВ рдХреЛ рдПрдХ 64-рдмрд┐рдЯ рдорд╛рди рдореЗрдВ рд░рд┐рдЯрд░реНрди <a href="">рдХрд╣</a> рд░рд╣реЗ рд╣реИрдВред <br><br>  рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рдХрд░рддреЗ рд╕рдордп, рдЕрдм рд╣рдо рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдореБрдЦреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред  рдХрд┐рд╕реА рджрд┐рдП рдЧрдП рд╕реАрдорд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рд╡рд┐рд▓рдВрдм рдХреА рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЕрдкрдиреЗ <em>рдбреЗрдЯрд╛</em> рд╕рдВрд░рдЪрдирд╛ рдХреЛ <em>рдЗрд╡реЗрдВрдЯ</em> рдЯреЗрдмрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ <em>рдкреА</em> рд╕реЗ рд░рд┐рдХреЙрд░реНрдб рд╣рдЯрд╛рддреЗ рд╣реИрдВред <br><br>  рдЗрд╕ рдХреЛрдб рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдЬрдЧрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ, рд╣рдореЗрдВ рджреЗрд░реА рд╕реАрдорд╛ рдФрд░ рд╕рдордп рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рд╕рд╛рде MIN_US рдФрд░ FACTOR рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛, рдЬрд┐рд╕реЗ рд╣рдо рддрд░реНрдХреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд░реЗрдВрдЧреЗ: <br><br><pre> <code class="python hljs">bpf_text = bpf_text.replace(<span class="hljs-string"><span class="hljs-string">'MIN_US'</span></span>,str(min_usec)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args.milliseconds: bpf_text = bpf_text.replace(<span class="hljs-string"><span class="hljs-string">'FACTOR'</span></span>,<span class="hljs-string"><span class="hljs-string">'data-&gt;lat /= 1000;'</span></span>) label = <span class="hljs-string"><span class="hljs-string">"msec"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: bpf_text = bpf_text.replace(<span class="hljs-string"><span class="hljs-string">'FACTOR'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) label = <span class="hljs-string"><span class="hljs-string">"usec"</span></span></code> </pre><br>  рдЕрдм рд╣рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">BPF рдореИрдХреНрд░реЛ рдХреЗ</a> рдорд╛рдзреНрдпрдо рд╕реЗ BPF рдкреНрд░реЛрдЧреНрд░рд╛рдо рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдФрд░ рдирдореВрдиреЛрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs">b = BPF(text=bpf_text) b.attach_kprobe(event=<span class="hljs-string"><span class="hljs-string">"generic_make_request"</span></span>,fn_name=<span class="hljs-string"><span class="hljs-string">"start"</span></span>) b.attach_kretprobe(event=<span class="hljs-string"><span class="hljs-string">"generic_make_request"</span></span>,fn_name=<span class="hljs-string"><span class="hljs-string">"stop"</span></span>)</code> </pre><br>  рд╣рдореЗрдВ рдЕрдкрдиреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ <em>рд╕рдВрд░рдЪрдирд╛рддреНрдордХ data_t</em> рдХреЛ рднреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЕрдиреНрдпрдерд╛ рд╣рдо рдХреБрдЫ рднреА рдирд╣реАрдВ рдкрдврд╝ рдкрд╛рдПрдВрдЧреЗ: <br><br><pre> <code class="python hljs">TASK_COMM_LEN = <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-comment"><span class="hljs-comment"># linux/sched.h DISK_NAME_LEN = 32 # linux/genhd.h class Data(ct.Structure): _fields_ = [("pid", ct.c_ulonglong), ("ts", ct.c_ulonglong), ("comm", ct.c_char * TASK_COMM_LEN), ("lat", ct.c_ulonglong), ("disk",ct.c_char * DISK_NAME_LEN)]</span></span></code> </pre><br>  рдЕрдВрддрд┐рдо рдЪрд░рдг рдЯрд░реНрдорд┐рдирд▓ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдЖрдЙрдЯрдкреБрдЯ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cpu, data, size)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> start event = ct.cast(data, ct.POINTER(Data)).contents <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> start == <span class="hljs-number"><span class="hljs-number">0</span></span>: start = event.ts time_s = (float(event.ts - start)) / <span class="hljs-number"><span class="hljs-number">1000000000</span></span> print(<span class="hljs-string"><span class="hljs-string">"%-18.9f %-16s %-6d %-1s %s %s"</span></span> % (time_s, event.comm, event.pid, event.lat, label, event.disk)) b[<span class="hljs-string"><span class="hljs-string">"events"</span></span>].open_perf_buffer(print_event) <span class="hljs-comment"><span class="hljs-comment"># format output start = 0 while 1: try: b.perf_buffer_poll() except KeyboardInterrupt: exit()</span></span></code> </pre><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЦреБрдж <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GItHub</a> рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред  рдЖрдЗрдП рдЗрд╕реЗ рдПрдХ рдкрд░реАрдХреНрд╖рдг рдордВрдЪ рдкрд░ рдЪрд▓рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдЬрд╣рд╛рдВ fio рдХреЛ bcache рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ udevadm рдореЙрдиреАрдЯрд░ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0q/wl/yo/0qwlyofk3ynh0ksh1rcqe_9kt6w.png"></div><br>  рдЕрдВрдд рдореЗрдВ!  рдЕрдм рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмреНрд░реЗрдХрд┐рдВрдЧ bcache рдбрд┐рд╡рд╛рдЗрд╕ рдЬреИрд╕рд╛ рджрд┐рдЦрдиреЗ рд╡рд╛рд▓рд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреИрд╢реНрдб рдбреНрд░рд╛рдЗрд╡ рдкрд░ <strong>generic_make_request () рдХреЗ</strong> рд▓рд┐рдП рдПрдХ рдмреНрд░реЗрдХрд┐рдВрдЧ рдХреЙрд▓ рд╣реИред <br><br><h3>  рдЧрд┐рд░реА рдореЗрдВ рдЦреЛрджреЛ </h3><br>  рдЕрдиреБрд░реЛрдз рдХреЗ рдкреНрд░рд╕рд╛рд░рдг рдХреЗ рджреМрд░рд╛рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреНрдпрд╛ рдзреАрдорд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ?  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╡рд┐рд▓рдВрдм рдЕрдиреБрд░реЛрдз рдХреЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╣реА рд╣реЛрддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддред  рдЗрд╕ рдкрд░ рдЖрдЧреЗ рдХреЗ рдЖрдВрдХрдбрд╝реЛрдВ (/ proc / diskstats рдпрд╛ iostat) рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рд▓реЗрдЦрд╛рдВрдХрди рдЕрднреА рддрдХ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реБрдЖ рд╣реИред  рд╕рдорд╕реНрдпрд╛ рдХреЛ рдкреБрди: рдкреЗрд╢ рдХрд░рддреЗ рд╣реБрдП, рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреАрд╕реАрд╕реА рдмрд╛рдпреЛрд▓реИрдЯреА рд▓рд┐рдкрд┐</a> рдХреЛ рдкреБрди: рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реБрдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕реЗ рдЖрдИрдУрд╕реНрдЯреЗрдЯ</a> рд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓реЗрдЦрд╛рдВрдХрди рдХреЗ рдЖрд░рдВрдн рдФрд░ рдЕрдВрдд рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред  рдЗрди рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдХреИрд╢реНрдб рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рджрд┐рдЦрд╛рдПрдЧреАред <br><br>  рдпрджрд┐ рд╣рдо <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ ()</strong> рдлрд╝рдВрдХреНрд╢рди рдкрд░ рдПрдХ рдирдЬрд╝рд░ <strong>рдбрд╛рд▓рддреЗ рд╣реИрдВ</strong> , рддреЛ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЕрдиреБрд░реЛрдз <strong>рджрд░реНрдЬ</strong> рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджреЛ рдФрд░ рдХрд╛рд░реНрдп рдХрд╣реЗ рдЬрд╛рддреЗ рд╣реИрдВред  рдкрд╣рд▓рд╛, <strong>рдЬреЗрдиреЗрд░рд┐рдХ_рдореЗрдХреЗ_рд░реЗрдХреНрд╡реЗрд╕реНрдЯ_рдЪреЗрдХ ()</strong> , рдбрд┐рд╕реНрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХреА рд╡реИрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред  рджреВрд╕рд░рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">blk_queue_enter () рд╣реИ</a> , рдЬрд┐рд╕рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Wait_event_interruptible () рдХреЗ</a> рд▓рд┐рдП рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдХреЙрд▓ рд╣реИ: <br><br><pre> <code class="python hljs">ret = wait_event_interruptible(q-&gt;mq_freeze_wq, (atomic_read(&amp;q-&gt;mq_freeze_depth) == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (preempt || !blk_queue_preempt_only(q))) || blk_queue_dying(q));</code> </pre><br>  рдЗрд╕рдореЗрдВ, рдХрд░реНрдиреЗрд▓ рдХрддрд╛рд░ рдХреЗ рдбреАрдлреНрд░реЙрд╕реНрдЯ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рд╣рдо рджреЗрд░реА <strong>blk_queue_enter () рдХреЛ рдорд╛рдкрддреЗ рд╣реИрдВ</strong> : <br><br><pre> <code class="bash hljs">~<span class="hljs-comment"><span class="hljs-comment"># /usr/share/bcc/tools/funclatency blk_queue_enter -i 1 -m Tracing 1 functions for "blk_queue_enter"... Hit Ctrl-C to end. msecs : count distribution 0 -&gt; 1 : 341 |****************************************| msecs : count distribution 0 -&gt; 1 : 316 |****************************************| msecs : count distribution 0 -&gt; 1 : 255 |****************************************| 2 -&gt; 3 : 0 | | 4 -&gt; 7 : 0 | | 8 -&gt; 15 : 1 | |</span></span></code> </pre><br>  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдПрдХ рд╕рдорд╛рдзрд╛рди рдХреЗ рдХрд░реАрдм рд╣реИрдВред  рдХрддрд╛рд░ рдХреЛ "рдлреНрд░реАрдЬ / рдЕрдирдлреНрд░реАрдЬ" рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдп <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">blk_mq_freeze_queue</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">blk_mq_unfreeze_queue рд╣реИрдВ</a> ред  рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рддрдм рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдХреНрд╡реЗрд░реА рдХрддрд╛рд░ рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдмрджрд▓рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕ рдХрддрд╛рд░ рдореЗрдВ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЦрддрд░рдирд╛рдХ рд╣реЛрддреЗ рд╣реИрдВред  рдЬрдм <strong>blk_mq_freeze_queue ()</strong> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ <strong>blk_freeze_queue_start ()</strong> рдлрд╝рдВрдХреНрд╢рди <strong>q-&gt; mq_freeze_depth рдХрд╛рдЙрдВрдЯрд░ рдмрдврд╝рд╛рддрд╛ рд╣реИ</strong> ред  рдЙрд╕рдХреЗ рдмрд╛рдж, рдХрд░реНрдиреЗрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">blk_mq_freeze_queue_wait ()</a> рдореЗрдВ рдХрддрд╛рд░ рдХреЗ рдЦрд╛рд▓реА рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИред <br><br>  рдЗрд╕ рдХрддрд╛рд░ рдХреЛ рдЦрд╛рд▓реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдбрд┐рд╕реНрдХ рд╡рд┐рд▓рдВрдмрддрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрд░реНрдиреЗрд▓ рд╕рднреА рдХрддрд╛рд░рдмрджреНрдз рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред  рдЬреИрд╕реЗ рд╣реА рдХрддрд╛рд░ рдЦрд╛рд▓реА рд╣реЛрддреА рд╣реИ, рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред  рдлрд┐рд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">blk_mq_unfreeze_queue ()</a> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХрд╛рдЙрдВрдЯрд░ <strong>рдлреНрд░реАрдЬ_рдбреЗрдк рдХреЛ рдШрдЯрд╛рдХрд░</strong> ред <br><br>  рдЕрдм рд╣рдо рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕реБрдзрд╛рд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЬрд╛рдирддреЗ рд╣реИрдВред  рдмреНрд▓реЙрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдЖрд╡реЗрджрди рдореЗрдВ udvadm рдЯреНрд░рд┐рдЧрд░ рдХрдорд╛рдВрдб рдкрд░рд┐рдгрд╛рдо рд╣реЛрддрд╛ рд╣реИред  рдЗрди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ udv рдирд┐рдпрдореЛрдВ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╣рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ "рдлреНрд░реАрдЬ" рдХрд░реЗрдВ рдЙрдиреНрд╣реЗрдВ sysfs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╛ рдХрд░реНрдиреЗрд▓ рд╕реНрд░реЛрдд рдХреЛрдб рдХреЛ рджреЗрдЦрдХрд░ рдмрджрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред  рд╣рдо BCC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреНрд░реЗрд╕</a> рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХреА рднреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ <strong>blk_freeze_queue</strong> рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдЯрд░реНрдорд┐рдирд▓ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рд╕реНрдЯреИрдХ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдХреЗ рдирд┐рд╢рд╛рди <strong>рджрд┐рдЦрд╛рддрд╛ рд╣реИ</strong> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="bash hljs">~<span class="hljs-comment"><span class="hljs-comment"># /usr/share/bcc/tools/trace blk_freeze_queue -K -U PID TID COMM FUNC 3809642 3809642 systemd-udevd blk_freeze_queue blk_freeze_queue+0x1 [kernel] elevator_switch+0x29 [kernel] elv_iosched_store+0x197 [kernel] queue_attr_store+0x5c [kernel] sysfs_kf_write+0x3c [kernel] kernfs_fop_write+0x125 [kernel] __vfs_write+0x1b [kernel] vfs_write+0xb8 [kernel] sys_write+0x55 [kernel] do_syscall_64+0x73 [kernel] entry_SYSCALL_64_after_hwframe+0x3d [kernel] __write_nocancel+0x7 [libc-2.23.so] [unknown] 3809631 3809631 systemd-udevd blk_freeze_queue blk_freeze_queue+0x1 [kernel] queue_requests_store+0xb6 [kernel] queue_attr_store+0x5c [kernel] sysfs_kf_write+0x3c [kernel] kernfs_fop_write+0x125 [kernel] __vfs_write+0x1b [kernel] vfs_write+0xb8 [kernel] sys_write+0x55 [kernel] do_syscall_64+0x73 [kernel] entry_SYSCALL_64_after_hwframe+0x3d [kernel] __write_nocancel+0x7 [libc-2.23.so] [unknown]</span></span></code> </pre><br>  рдЙрджрдп рдирд┐рдпрдо рдХрд╛рдлреА рдХрдо рдмрджрд▓рддреЗ рд╣реИрдВ рдФрд░ рдЖрдорддреМрд░ рдкрд░ рдпрд╣ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдбрд┐рд╕реНрдХ рдореЗрдВ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рджреЗрд░реА рдХрд╛ рдХрд╛рд░рдг рдмрдирддрд╛ рд╣реИред  рдмреЗрд╢рдХ, udev рдШрдЯрдирд╛рдУрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрдм рдбрд┐рд╕реНрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдХреЛрдИ рдмрджрд▓рд╛рд╡ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдбрд┐рд╡рд╛рдЗрд╕ рдХрдиреЗрдХреНрдЯ / рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ) рдПрдХ рдЕрдЪреНрдЫрд╛ рдЕрднреНрдпрд╛рд╕ рдирд╣реАрдВ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдХрд░реНрдиреЗрд▓ рдХреЛ рдмреЗрдХрд╛рд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдпрджрд┐ рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ рддреЛ рдЕрдиреБрд░реЛрдз рдХрддрд╛рд░ рдХреЛ рдлреНрд░реАрдЬ рдирд╣реАрдВ рдХрд░реЗрдВред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рддреАрди</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЫреЛрдЯреЗ-рдЫреЛрдЯреЗ</a> рд╣рд╛рд▓рд╛рдд рд╕рд╣реА рдХрд░рддреЗ рд╣реИрдВред <br><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br>  eBPF рдПрдХ рдмрд╣реБрдд рд╣реА рд▓рдЪреАрд▓рд╛ рдФрд░ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЙрдкрдХрд░рдг рд╣реИред  рд▓реЗрдЦ рдореЗрдВ, рд╣рдордиреЗ рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдорд╛рдорд▓реЗ рдХреА рдЬрд╛рдВрдЪ рдХреА рдФрд░ рдЬреЛ рд╕рдВрднрд╡ рд╣реИ рдЙрд╕рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╣рд┐рд╕реНрд╕реЗ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ред  рдпрджрд┐ рдЖрдк рдмреАрд╕реАрд╕реА рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ <a href="">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓</a> рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рдиреА рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдореВрд▓ рд░реВрдк рд╕реЗ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред <br><br>  EBPF рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рдбрд┐рдмрдЧрд┐рдВрдЧ рдФрд░ рдкреНрд░реЛрдлрд╛рдЗрд▓рд┐рдВрдЧ рдЯреВрд▓ рд╣реИрдВред  рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">bpftrace рд╣реИ</a> , рдЬреЛ рдЖрдкрдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдЬреАрдм</a> -рднрд╛рд╖рд╛ рдореЗрдВ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╕рд┐рдВрдЧрд▓-рд▓рд╛рдЗрди рдФрд░ рдЫреЛрдЯреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдПрдХ рдФрд░ рдПрдХ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ebpf_exporter</a> , рдЖрдкрдХреЛ рдирд┐рдореНрди рд╕реНрддрд░ рдХреЗ рдЙрдЪреНрдЪ-рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╕реАрдзреЗ рдЕрдкрдиреЗ рдкреНрд░реЛрдореЗрдерд┐рдпрд╕ рд╕рд░реНрд╡рд░ рдореЗрдВ рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╕реБрдВрджрд░ рджреГрд╢реНрдп рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрд▓рд░реНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi458592/">https://habr.com/ru/post/hi458592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi458574/index.html">рдПрдХ рдЯреАрдо рд▓реАрдб рдореЗрдВ рдПрдХ рдбреЗрд╡рд▓рдкрд░ рд╕реЗ рдХреИрд╕реЗ рдЖрдЧреЗ рдмрдврд╝реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рд░рд╣реЗрдВ</a></li>
<li><a href="../hi458576/index.html">рдПрдХ рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдореЗрдВ рдкрд╛рда рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг</a></li>
<li><a href="../hi458582/index.html">рдЕрдореЗрдЬрд╝реЕрди рдЗрдВрдЬреАрдирд┐рдпрд░ рдиреЗ рдПрдХ рдПрдЖрдИ рдЕрд╡рд░реЛрдзрдХ рдЙрдкрдХрд░рдг рдмрдирд╛рдпрд╛ рд╣реИ рдЬреЛ рдмрд┐рд▓реНрд▓рд┐рдпреЛрдВ рдХреЛ рд╕рдбрд╝рдХ рд╕реЗ рдмрд╛рд╣рд░ рд░рдЦрддрд╛ рд╣реИ</a></li>
<li><a href="../hi458584/index.html">11 рдЬреБрд▓рд╛рдИ, рдЧреНрд░реБрдк-рдЖрдИрдмреА рд╡реЗрдмрд┐рдирд╛рд░ "рд╢реБрд░реБрдЖрддреА рдХреЗ рд▓рд┐рдП рдореИрд▓рд╡реЗрдпрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг: рдореВрд▓ рджреГрд╖реНрдЯрд┐рдХреЛрдг"</a></li>
<li><a href="../hi458590/index.html">IOS рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╡рд╛рд╕реНрддреБрд╢рд┐рд▓реНрдк рджреГрд╖реНрдЯрд┐рдХреЛрдг</a></li>
<li><a href="../hi458594/index.html">рдПрд▓ 7 рд╕рдВрддреБрд▓рди рдореЗрдВ рдмрд╛рд░-рдмрд╛рд░ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛</a></li>
<li><a href="../hi458596/index.html">рдЫреЛрдЯрд╛ рдЖрдирдВрдж # 6: OpenAI рдЬрд┐рдо - рдЧреЗрдо рдЦреЗрд▓реЗрдВ рдФрд░ рд░реЛрдмреЛрдЯреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВ</a></li>
<li><a href="../hi458598/index.html">рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдирдХреНрд╢реЗ рдкрд░ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рдХреА рдорд╛рдиреНрдпрддрд╛</a></li>
<li><a href="../hi458600/index.html">рдЗрд▓реЗрдХреНрдЯреНрд░рд┐рдХ рдмрд╛рдЗрдХ рдХреНрдпрд╛ рд╣реИрдВ (рджреЛ рдирд┐рд░реНрдорд╛рддрд╛рдУрдВ рдХреЗ рдкрд╛рдВрдЪ рдореЙрдбрд▓ рдХреЗ рджреЛ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╕рдореВрд╣ рдХреА рд╕рдореАрдХреНрд╖рд╛), рднрд╛рдЧ 1</a></li>
<li><a href="../hi458602/index.html">рдХреИрд╕реЗ рд╣рдо рдорд╣рд╛рди рдЪреАрдиреА рдлрд╝рд╛рдпрд░рд╡реЙрд▓ (1 рднрд╛рдЧ) рдЫреЗрджрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>