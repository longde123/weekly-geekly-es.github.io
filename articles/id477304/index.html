<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏾 🚢 🌜 CDN Dinamis untuk Streaming WebRTC Latensi Rendah 😽 🏂🏽 👩‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah menganalisis kapasitas konfigurasi server standar di Digital Ocean dalam hal streaming WebRTC, kami telah memperhatikan bahwa satu server dapa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CDN Dinamis untuk Streaming WebRTC Latensi Rendah</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/477304/"><p><img src="https://habrastorage.org/webt/qp/yd/gy/qpydgy2jfifixw87t9seev0eb7o.jpeg"></p><br><p>  Setelah menganalisis kapasitas <a href="https://habr.com/en/company/flashphoner/blog/476554/">konfigurasi server</a> standar <a href="https://habr.com/en/company/flashphoner/blog/476554/">di Digital Ocean</a> dalam hal streaming WebRTC, kami telah memperhatikan bahwa satu server dapat mencakup hingga 2000 pemirsa.  Dalam kehidupan nyata, kasus-kasus ketika satu server tidak mencukupi tidak jarang. </p><br><p>  Anggaplah para amatir judi di Jerman menonton balapan kuda waktu nyata di Australia.  Mengingat bahwa pacuan kuda tidak hanya permainan olahraga tetapi juga menyiratkan keuntungan besar dengan syarat bahwa taruhan lapangan dibuat pada waktu yang tepat, video harus disampaikan dengan latensi serendah mungkin. </p><br><p>  Contoh lain: Perusahaan global, salah satu pemimpin pasar FCMG dengan anak perusahaan di Eropa, Rusia dan Asia Tenggara, menyelenggarakan pelatihan manajer penjualan pelatihan webinar dengan streaming langsung dari kantor pusat di Mediterania.  Para penonton harus dapat melihat dan mendengar presenter secara langsung. <a name="habracut"></a></p><br><p>  Contoh-contoh ini mengedepankan persyaratan yang sama: memberikan aliran media latensi rendah ke sejumlah besar pemirsa.  Ini akan membutuhkan penggelaran jaringan pengiriman konten - CDN. </p><br><p>  Perlu dicatat bahwa teknologi pengiriman aliran konvensional menggunakan HLS tidak cocok karena dapat menambah hingga 30 detik penundaan, yang sangat penting untuk acara waktu-nyata.  Bayangkan bahwa kuda sudah selesai, hasilnya telah dipublikasikan di situs web, sementara para penggemar masih menonton akhir balapan.  Teknologi WebRTC bebas dari kerugian ini dan dapat menjamin penundaan kurang dari 1 detik, yang dimungkinkan bahkan di seluruh benua berkat saluran komunikasi modern. </p><br><p>  Untuk memulainya, kita akan melihat bagaimana menggunakan CDN yang paling sederhana untuk mengirimkan aliran WebRTC dan bagaimana skala itu sesudahnya. </p><br><h2 id="cdn-principles">  Prinsip Cdn </h2><br><p>  Server di CDN dapat memainkan salah satu dari peran berikut: </p><br><ul><li>  Origin adalah server yang dibangun untuk mempublikasikan stream media.  Ini berbagi aliran ke server lain serta pengguna. </li><li>  Transcoder adalah server yang didedikasikan untuk stream transcoding.  Ini menarik stream dari server Origin dan melewati stream transcode ke Edge.  Kami akan melihat peran ini di bagian berikut. </li><li>  Edge adalah server yang dirancang untuk berbagi aliran kepada pengguna.  Ini menarik stream dari server Origin atau Transcoder dan tidak meneruskannya ke server CDN lainnya. </li></ul><br><p>  Server Asal memungkinkan penerbitan aliran WebRTC dan RTMP atau menangkap aliran dari sumber lain melalui RTMP, RTSP atau metode lain yang tersedia. </p><br><p>  Pengguna dapat memutar stream dari server Edge melalui WebRTC, RTMP, RTSP, HLS. </p><br><p>  Untuk meminimalkan latensi, diinginkan untuk mentransmisikan streaming di antara server CDN menggunakan WebRTC. </p><br><p>  CDN statis sepenuhnya dijelaskan pada tahap konfigurasi.  Bahkan, pengaturan CDN statis mirip dengan pengaturan penyeimbang beban: semua penerima tercantum dalam pengaturan server sumber arus. </p><br><p>  Misalnya, kami memiliki satu server Asal di Frankfurt, satu Edge di New York dan satu di Singapura </p><br><p><img src="https://habrastorage.org/webt/so/gg/1w/sogg1wq1m_67p9waxgdyjbtix4y.png" alt="Contoh CDN statis"></p><br><p>  Dalam hal ini Origin akan diatur kurang lebih seperti ini: </p><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loadbalancer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"roundrobin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stream_distribution</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webrtc"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span>edge1.thestaticcdn.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span>443<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span>edge2.thestaticcdn.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span>443<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loadbalancer</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Inilah masalah pertama dengan CDN statis: untuk memasukkan CDN jenis ini ke server Edge baru atau mengecualikan server dari CDN, diperlukan untuk mengubah pengaturan dan memulai kembali semua server Origin. </p><br><p>  Streaming yang diterbitkan pada Asal disiarkan ke semua server Edge yang tercantum dalam pengaturan.  Keputusan di mana server Edge pengguna akan terhubung juga diambil di server Origin.  Inilah masalah kedua: jika ada sedikit atau tidak ada pemirsa - misalnya, di Singapura masih sore, sedangkan di New York tengah malam - aliran akan disiarkan ke Edge 1 pula.  Lalu lintas sedang terbuang sia-sia, dan tidak gratis. </p><br><p>  Dua masalah ini dapat diselesaikan dengan menggunakan Dynamic CDN. </p><br><p>  Sekarang, kami ingin mengatur CDN tanpa me-restart semua server Origin dan tidak ingin mengirimkan stream ke server Edge tanpa ada pengguna yang terhubung.  Dalam hal ini, tidak perlu menyimpan seluruh daftar server CDN di suatu tempat di pengaturan.  Setiap server harus membuat daftar semacam itu secara independen.  Untuk melakukan ini, ia harus mengetahui status server lain saat ini pada waktu tertentu. </p><br><p>  Idealnya, menentukan titik masuk - server yang memulai CDN - dalam pengaturan harus cukup.  Selama startup, setiap server harus mengirim permintaan ke titik entri ini dan menanggapi daftar node CDN dan aliran yang dipublikasikan.  Jika titik masuk tidak dapat diakses, server harus menunggu pesan dari server lain. <br>  Server harus mengkomunikasikan perubahan apa pun dalam statusnya ke server lain di CDN. </p><br><h2 id="the-simplest-cdn-in-the-centre-of-europe">  CDN paling sederhana: di pusat Eropa </h2><br><p>  Sekarang kita akan mencoba mengatur dan memulai CDN dinamis.  Asumsikan pertama kita perlu mengirimkan stream media ke pemirsa di Eropa yang mencakup hingga 5000 pengguna.  Misalkan sumber aliran juga terletak di Eropa </p><br><p><img src="https://habrastorage.org/webt/xo/oi/rx/xooirxhid75yiqsfuff8sdu5xge.png"></p><br><p>  Kami akan menggunakan tiga server di pusat data yang berbasis di Eropa.  Kami akan menggunakan instance Flashphoner WebCallServer (server video stream WebRTC) sebagai komponen perakitan CDN </p><br><p><img src="https://habrastorage.org/webt/ts/de/4x/tsde4xzznh96b-15pb7pephsqlc.png"></p><br><p>  Pengaturan: </p><br><ul><li>  Asal EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin</code> </pre> <br><ul><li>  Edge 1 EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-eu1.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><ul><li>  Edge 2 EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-eu2.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><p>  Pertukaran pesan antara node CDN dinamis diimplementasikan melalui Websocket, dan Secure Websocket tentu juga didukung. </p><br><p>  Streaming di dalam CDN disiarkan melalui WebRTC.  Biasanya UDP digunakan sebagai transportasi, tetapi jika perlu untuk memastikan kualitas streaming yang baik dengan saluran antara server tidak begitu baik, dimungkinkan untuk beralih ke TCP.  Sayangnya, dalam kasus ini, latensi meningkat. <br>  Mulai ulang server, buka contoh Two Way Streaming pada server <code>o-eu1</code> , publikasikan siklus 10 menit ke 0 video penghitung waktu mundur </p><br><p><img src="https://habrastorage.org/webt/6s/s1/uq/6ss1uquwqf-a0nctys-rsc6p4xo.png"></p><br><p>  Buka contoh Player di server <code>e-eu1</code> , mainkan stream </p><br><p><img src="https://habrastorage.org/webt/fc/3p/st/fc3pst40kkeh0gh0dunrcktlksg.png"></p><br><p>  dan melakukan hal yang sama pada <code>e-eu2</code> </p><br><p><img src="https://habrastorage.org/webt/el/j5/ew/elj5ew8cqvaxpvmbmr14wwl1dvu.png"></p><br><p>  CDN berfungsi!  Seperti yang dapat Anda lihat pada tangkapan layar, waktu dalam video bertepatan dengan yang kedua pada bagian penerbitan dan pada bagian tampilan berkat WebRTC dan saluran yang baik. </p><br><h2 id="and-beyond-we-go-connecting-america">  Dan di luar kita pergi: menghubungkan Amerika </h2><br><p>  Sekarang kita akan mengirimkan streaming kepada pemirsa di benua Amerika dengan mengingat juga penerbitannya </p><br><p><img src="https://habrastorage.org/webt/y6/8r/ig/y68rigg5xu5uq32qmvrb2_6yexq.png"></p><br><p>  Kami akan mengerahkan tiga server di pusat data Amerika tanpa menutup bagian Eropa dari CDN </p><br><p><img src="https://habrastorage.org/webt/t5/q8/vh/t5q8vh5mlwgvixiq_l-zdin6bje.png"></p><br><p>  Pengaturan: </p><br><ul><li>  Asal kami </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=o-us1.flashponer.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin</code> </pre> <br><ul><li>  Edge 1 AS </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-us1.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><ul><li>  Edge 2 AS </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-us2.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><p>  Mulai ulang server Amerika, periksa penerbitan </p><br><p><img src="https://habrastorage.org/webt/6s/s1/uq/6ss1uquwqf-a0nctys-rsc6p4xo.png"></p><br><p>  dan pemutaran </p><br><p><img src="https://habrastorage.org/webt/4i/ur/_s/4iur_sn57za5_ypd9pssupfg8rm.png"></p><br><p>  Perhatikan bahwa segmen Eropa tetap berfungsi.  Kami akan memeriksa apakah pengguna Amerika akan dapat melihat aliran diterbitkan dari Eropa.  Menerbitkan aliran <code>test_eu</code> di server <code>o-eu1</code> </p><br><p><img src="https://habrastorage.org/webt/yp/dk/0o/ypdk0o9fnrje0kbmtx7-duhrkuo.png"></p><br><p>  dan memainkannya di <code>e-us1</code> </p><br><p><img src="https://habrastorage.org/webt/ld/6n/u3/ld6nu3rzicqjotfzz88goggo1lk.png"></p><br><p>  Dan ini juga berhasil!  Adapun latensi, tangkapan layar menunjukkan lagi sinkronisasi timer di video pada bagian penerbitan dan pada bagian tampilan ke yang kedua. </p><br><p>  Perhatikan bahwa bermain di server Origin stream yang dipublikasikan di server Origin lainnya tidak dimungkinkan secara default, tetapi jika perlu, ini dapat diatur sesuai. </p><br><pre> <code class="plaintext hljs">cdn_origin_to_origin_route_propagation=true</code> </pre> <br><h2 id="to-be-continued">  Untuk dilanjutkan </h2><br><p>  Singkatnya, kami telah menggunakan CDN sederhana dan kemudian berhasil menskalakannya ke dua benua penerbitan dan memainkan aliran WebRTC latensi rendah.  Untuk tujuan ini, kami tidak mengubah parameter streaming saat pemutaran, yang cukup sering diperlukan dalam kehidupan nyata: semua pemirsa memiliki saluran yang berbeda, dan untuk menjaga kualitas streaming diperlukan, misalnya, untuk mengurangi resolusi atau bitrate.  Kami akan menangani ini di bagian berikut ... </p><br><h2 id="related-links">  Tautan terkait </h2><br><p>  <a href="https://flashphoner.com/web-call-server-on-digital-ocean-marketplace">Gambar Flashphoner WebCallServer di DigitalOcean Marketplace</a> - gambar Server Panggilan Web di DigitalOcean. </p><br><p>  <a href="https://flashphoner.com/cdn-for-low-latency-webrtc-streaming">CDN untuk streaming WebRTC latensi rendah</a> - jaringan pengiriman konten berbasis Server Web. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id477304/">https://habr.com/ru/post/id477304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id477292/index.html">Acara digital di St. Petersburg dari 25 November hingga 1 Desember</a></li>
<li><a href="../id477294/index.html">Python untuk AI: Pertandingan yang dibuat di surga</a></li>
<li><a href="../id477296/index.html">Fungsi Buildargv dengan Ragel</a></li>
<li><a href="../id477298/index.html">Apa yang ada di dalam bandara: pusat kendali</a></li>
<li><a href="../id477300/index.html">Apa yang ada di dalam bandara regional terbaik di negara ini: layanan terminal</a></li>
<li><a href="../id477306/index.html">Dari Produksi-Ke-Gaji ke Produksi-Ke-Pesanan. Urutan langkah-langkah dan contoh implementasi praktis</a></li>
<li><a href="../id477308/index.html">Clone Numpy</a></li>
<li><a href="../id477310/index.html">CDN dinamis untuk streaming WebRTC latensi rendah</a></li>
<li><a href="../id477312/index.html">Pengembangan game di jejaring sosial</a></li>
<li><a href="../id477314/index.html">Mengirim acara dari ViewModel ke Aktivitas / Fragmen di MVVM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>