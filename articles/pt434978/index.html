<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏽 🏴 👨🏻‍🔬 Apresentando o HealthKit 🤡 😫 ♒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo do HealthKit, você aprenderá como solicitar permissão para acessar dados do HealthKit, além de ler e gravar dados no repositório central ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apresentando o HealthKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434978/"> Neste artigo do HealthKit, você aprenderá como solicitar permissão para acessar dados do HealthKit, além de ler e gravar dados no repositório central do HealthKit.  O artigo usa a versão Swift 4, iOS 11, Xcode 9. <br><br>  <b>O HealthKit</b> é uma API que foi introduzida no iOS 8. O <i>HealthKit</i> serve como repositório central de todos os dados relacionados à saúde, permitindo que os usuários criem um perfil biológico e armazenem dados de exercícios. <br><br>  Ao ler o artigo HealthKit, você criará o aplicativo de rastreamento de treinamento mais simples e aprenderá: <br><br><ul><li>  Como solicitar permissão e acessar dados do HealthKit </li><li>  Como ler dados do HealthKit e exibi-los em um UITableView </li><li>  Como gravar dados no repositório central do HealthKit </li></ul><br>  Pronto para começar a usar o HealthKit?  Continue lendo! <br><a name="habracut"></a><br>  <b>Nota:</b> <i>Para trabalhar neste tutorial, você precisará de uma conta de desenvolvedor iOS ativa.</i>  <i>Sem isso, você não pode ativar o HealthKit Capability e obter acesso ao repositório do HealthKit.</i> <br><br><h3>  Iniciar </h3><br>  O aplicativo inicial rastreia a queima de calorias durante um programa de exercícios.  Para pessoas de dentro e socialites de Hollywood, deve ser óbvio que estou falando de <b>Prancercise</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/rk/if/sprkif8aw8ng01gh-y4vrroags8.png" alt="Prancercise" width="764" height="430"></div><br>  <a href="">Faça o download do projeto inicial e abra-o no Xcode</a> . <br><br>  Compile e execute o aplicativo.  Você verá o "esqueleto" da interface do usuário.  Nos próximos dois artigos, você adicionará funcionalidades gradualmente a este aplicativo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8f/68a/4a5/c8f68a4a5bea9dfc34c426606e443458.png" alt="imagem" width="281" height="500"></div><br><h3>  Atribuindo uma equipe </h3><br>  <b>HealthKit</b> é uma estrutura especial.  O aplicativo não poderá usá-lo se você não tiver uma conta de desenvolvedor ativa.  Depois de ter uma conta de desenvolvedor, você pode atribuir sua equipe. <br><br>  Selecione <b>PrancerciseTracker</b> no Project Navigator e, em seguida, selecione o <b>destino PrancerciseTracker</b> .  Vá para a guia <b>Geral</b> e clique no campo <b>Equipe</b> . <br><br>  Selecione o comando associado à sua conta de desenvolvedor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/809/a3e/af2/809a3eaf2aa966919ed95ad1f8a4be38.png" alt="imagem" width="2020" height="752"></div><br><h3>  Permissões / direitos </h3><br>  O HealthKit também possui seu próprio conjunto de direitos, e você precisará habilitá-los para criar aplicativos que usam a estrutura. <br><br>  Abra a guia <b>Recursos</b> no editor de destino e ative o <b>HealthKit</b> , conforme mostrado na captura de tela abaixo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dce/374/42e/dce37442eebca83d0e6e480113dcd3fc.png" alt="imagem"><br><br>  Aguarde o Xcode configurar o HealthKit para você.  Como regra, não há problemas aqui, mas você ainda pode encontrar alguns se esquecer de especificar o Identificador de equipe e pacote corretamente. <br><br>  Agora está tudo pronto.  Você só precisa pedir permissão ao usuário para usar o HealthKit. <br><br><h3>  Permissões </h3><br>  O HealthKit trabalha com dados confidenciais e sensíveis.  Nem todo mundo se sente tão à vontade para permitir que aplicativos instalados acessem essas informações. <br><br>  É por isso que o HealthKit possui um forte sistema de privacidade.  O HealthKit tem acesso apenas aos dados que os usuários concordam em compartilhar.  Para criar um perfil para os usuários do seu Prancercise Tracker, você deve primeiro obter permissão para acessar cada tipo de dados. <br><br><h3>  Atualização da descrição de uso </h3><br>  Primeiro, você precisa descrever por que está solicitando indicadores de saúde de seus usuários.  <b>O Xcode</b> permite especificar isso no arquivo <b>Info.plist</b> do seu aplicativo. <br><br>  Abra <b>Info.plist</b> .  Em seguida, adicione as seguintes chaves: <br>  <b>Privacidade</b> - <b>Descrição do uso do compartilhamento de saúde</b> <br>  <b>Privacidade</b> - <b>Descrição do uso da atualização de integridade</b> <br><br>  Essas chaves armazenam o texto que será exibido quando a tela de login do HeathKit aparecer.  <b>Descrição do uso</b> do compartilhamento de integridade refere-se à seção de dados que deve ser lida no HealthKit.  <b>Descrição de uso da atualização</b> de integridade corresponde aos dados gravados no HealthKit. <br><br>  Você pode "adicionar" tudo o que quiser lá.  Geralmente, é uma descrição: "Usaremos suas informações de saúde para rastrear melhor seus exercícios". <br><br>  Lembre-se de que, se essas chaves não estiverem instaladas, o aplicativo falhará quando você tentar fazer login no HealthKit. <br><br><h3>  Autorização HealthKit </h3><br>  Abra o arquivo <i>HealthKitSetupAssistant.swift</i> dentro do qual é o método de classe que você usará para autorizar no HealthKit. <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">authorizeHealthKit</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bool</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ }</code> </pre> <br>  O método authorizeHealthKit (conclusão :) não aceita nenhum parâmetro e possui uma <b>conclusão</b> que retorna um booleano ( <b>êxito</b> ou <b>falha</b> ) e um erro opcional no caso de algo dar errado.  Se erros forem retornados, você os passará para conclusão em dois casos: <br><br><ol><li>  O HealthKit pode não estar disponível no seu dispositivo.  Por exemplo, se o aplicativo estiver sendo executado em um iPad. </li><li>  Alguns tipos de dados podem não estar disponíveis na versão atual do HealthKit. </li></ol><br>  Vamos quebrar esse processo.  Para autorizar HealthKit, o método <i>authorizeHealthKit (conclusão :)</i> deve concluir as quatro etapas a seguir: <br><br><ol><li>  Verifique se o Healthkit está disponível neste dispositivo.  Se não for esse o caso, retorne uma falha e um erro à conclusão. </li><li>  Prepare tipos de dados de integridade.  O Prancercise Tracker lerá e gravará no HealthKit. </li><li>  Organize esses dados em uma lista de tipos para ler e tipos para escrever. </li><li>  Solicitar autorização.  Se essa ação for bem-sucedida, todas as atividades foram corretas e concluídas corretamente. </li></ol><br><h3>  Verificação de disponibilidade do HealthKit </h3><br>  Primeiro de tudo, você precisa verificar a disponibilidade do HealthKit no dispositivo. <br>  Cole o seguinte código no início do método <i>authorizeHealthKit (conclusão :)</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1. ,      HealthKit guard HKHealthStore.isHealthDataAvailable() else { completion(false, HealthkitSetupError.notAvailableOnDevice) return }</span></span></code> </pre><br>  Você interagirá com o <b>HKHealthStore</b> com muita frequência.  É um repositório central que armazena dados de integridade do usuário.  O método <i>isHealthDataAvailable ()</i> ajudará você a entender se o dispositivo do usuário atual suporta dados do Heathkit. <br><br>  A declaração de proteção impede que o aplicativo execute o restante do método <i>authorizeHealthKit (conclusão :)</i> se o HealthKit não estiver disponível no dispositivo.  Quando isso acontece, o bloco de conclusão é <b>chamado</b> com o erro <b>notAvailableOnDevice</b> .  Você pode simplesmente enviar isso para o console ou no controlador principal para processar outras etapas em caso de erro. <br><br><h3>  Preparação de dados </h3><br>  Depois de saber que o HealthKit está disponível no dispositivo do usuário, é hora de preparar os tipos de dados que serão lidos e gravados no HealthKit. <br>  HealthKit funciona com o tipo <b>HKObjectType</b> .  Cada tipo que entra ou retorna ao repositório central do HealthKit é um tipo de <b>HKObjectType</b> .  Você também verá HKSampleType e <b>HKWorkoutType</b> .  Ambos herdam do <b>HKObjectType</b> , então basicamente é a mesma coisa. <br><br>  Cole o seguinte trecho de código imediatamente após o primeiro trecho de código: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//2.   ,     HealthKit guard let dateOfBirth = HKObjectType.characteristicType(forIdentifier: .dateOfBirth), let bloodType = HKObjectType.characteristicType(forIdentifier: .bloodType), let biologicalSex = HKObjectType.characteristicType(forIdentifier: .biologicalSex), let bodyMassIndex = HKObjectType.quantityType(forIdentifier: .bodyMassIndex), let height = HKObjectType.quantityType(forIdentifier: .height), let bodyMass = HKObjectType.quantityType(forIdentifier: .bodyMass), let activeEnergy = HKObjectType.quantityType(forIdentifier: .activeEnergyBurned) else { completion(false, HealthkitSetupError.dataTypeNotAvailable) return }</span></span></code> </pre><br>  Uau, isso é uma grande <b>guarda</b> !  Este também é um ótimo exemplo do uso de uma única proteção para recuperar várias opções. <br><br>  Para criar um <b>HKObjectType</b> para essas características, você precisa usar <i>HKObjectType.characteristicType (forIdentifier :)</i> ou <i>HKObjectType.quantityType (forIdentifier :)</i> <br>  Tipos de característica e tipos de quantidade são enumerações definidas pela estrutura.  O HealthKit é inicializado com eles. <br><br>  Você também notará que, se uma característica ou tipo de seleção não estiver disponível, o método falhará.  Isso é intencional.  Seu aplicativo sempre deve saber exatamente com que tipos de HealthKit ele pode trabalhar, se houver. <br><br><h3>  Preparando uma lista de tipos de dados para leitura e gravação </h3><br>  Agora é hora de preparar uma lista de tipos de dados para leitura e gravação. <br>  Cole esse terceiro código no método <i>authorizeHealthKit (conclusão :)</i> imediatamente após a segunda parte: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//3.   ,  HealthKit     let healthKitTypesToWrite: Set&lt;HKSampleType&gt; = [bodyMassIndex, activeEnergy, HKObjectType.workoutType()] let healthKitTypesToRead: Set&lt;HKObjectType&gt; = [dateOfBirth, bloodType, biologicalSex, bodyMassIndex, height, bodyMass, HKObjectType.workoutType()]</span></span></code> </pre><br>  O HealthKit espera que um conjunto de objetos <b>HKSampleType</b> represente os tipos de dados que seu usuário pode gravar e também espera que um conjunto de objetos HKObjectType seja exibido para seu aplicativo. <br><br>  <b>HKObjectType.workoutType ()</b> é um tipo especial de <b>HKObjectType</b> .  É qualquer treino. <br><br><h3>  Autorização HealthKit </h3><br>  A última parte é a mais fácil.  Você só precisa solicitar autorização do HealthKit.  Cole este último pedaço de código: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//4.    HKHealthStore().requestAuthorization(toShare: healthKitTypesToWrite, read: healthKitTypesToRead) { (success, error) in completion(success, error) }</span></span></code> </pre><br>  Esse código solicita autorização do HealthKit e chama a conclusão.  Eles usam variáveis ​​para operações bem-sucedidas e erros transmitidos pelo método <i>requestAuthorization (toShare: read: complete :) do HKHealthStore</i> . <br><br>  Você pode pensar nisso como um redirecionamento.  Em vez de manipular a conclusão dentro do HealthKitSetupAssistant, você passa o pacote para o controlador principal, que pode exibir um aviso ou executar outra ação. <br><br>  O projeto já possui um botão Authorize HealthKit e chama o método <i>authorizeHealthKit ()</i> no MasterViewController.  Este é o lugar perfeito para chamar o método de autorização que acabamos de escrever. <br><br>  Abra <b>MasterViewController.swift</b> , encontre o método <i>authorizeHealthKit (</i> ) e cole este código: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKitSetupAssistant</span></span>.authorizeHealthKit { (authorized, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> authorized <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> baseMessage = <span class="hljs-string"><span class="hljs-string">"HealthKit Authorization Failed"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(baseMessage). Reason: \(error.localizedDescription)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(baseMessage) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HealthKit Successfully Authorized."</span></span>) }</code> </pre><br>  Esse código usa o método <i>authorizeHealthKit (conclusão :)</i> que você acabou de implementar.  Quando concluído, ele exibirá uma mensagem no console para indicar se a autorização foi bem-sucedida no HealthKit. <br><br>  Inicie o aplicativo.  Clique em Autorizar HealthKit na janela principal e você verá uma tela de autorização pop-up: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ef/2bc/500/4ef2bc50015fda69b7d916b9231a5f1a.png" alt="imagem" width="281" height="500"></div><br>  Ligue todos os comutadores, role para vê-los e pressione <b>Permitir</b> .  No console, você verá uma mensagem como esta: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKit</span></span> <span class="hljs-type"><span class="hljs-type">Successfully</span></span> <span class="hljs-type"><span class="hljs-type">Authorized</span></span>.</code> </pre><br>  <b>Ótimo!</b>  O aplicativo tem acesso ao repositório central do HealthKit.  Agora é hora de começar a rastrear itens. <br><br><h3>  Características e amostras </h3><br>  Nesta seção, você aprenderá: <br><br><ul><li>  Como ler as características biológicas do seu usuário. </li><li>  Como ler e escrever diferentes tipos de amostras (peso, altura, etc.) </li></ul><br>  As características biológicas, em regra, são tipos de elementos que não mudam, assim como o seu tipo sanguíneo.  Amostras são elementos que mudam frequentemente, como peso. <br><br>  Para rastrear adequadamente a eficácia do <b>modo de</b> treino <b>Prancercise</b> , o aplicativo <b>Prancercise Tracker</b> deve receber uma amostra do peso e da altura do usuário.  Juntas, essas amostras podem ser usadas para calcular o índice de massa corporal (IMC). <br><br>  <b>Nota:</b> <i>O Índice de Massa Corporal (IMC) é um indicador amplamente usado de gordura corporal e é calculado com base no peso e na altura de uma pessoa.</i>  <i>Saiba mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .</i> <br><br><h3>  Especificações de leitura </h3><br>  O Prancercise Tracker não registra características biológicas.  Ele os obtém do HealthKit.  Isso significa que essas características devem primeiro ser armazenadas no repositório central do HeathKit. <br><br>  Se você ainda não o fez, é hora de falar <b>um</b> pouco mais sobre o <b>HeathKit</b> . <br><br>  Abra o aplicativo Health no seu dispositivo ou simulador.  Selecione a guia Dados de integridade.  Em seguida, clique no ícone do perfil no canto superior direito para visualizar seu perfil de saúde.  Clique em <b>Editar</b> e insira as informações da data de nascimento, sexo e tipo sanguíneo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/324/285/ea4/324285ea449bb8049ff166c1e83ec76f.png" alt="imagem" width="1732" height="1540"></div><br>  Agora que o <b>HealthKit</b> sabe sua data de nascimento, sexo e tipo sanguíneo, é hora de ler esses recursos no <b>Prancercise Tracker</b> . <br><br>  Volte ao <b>Xcode</b> e abra <i>ProfileDataStore.swift</i> .  A classe <b>ProfileDataStore</b> representa seu ponto de acesso a todos os dados relacionados à saúde de seus usuários. <br><br>  Cole o seguinte método no <b>ProfileDataStore</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAgeSexAndBloodType</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">throws</span></span></span><span class="hljs-class"> -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">biologicalSex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBiologicalSex</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bloodType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBloodType</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> healthKitStore = <span class="hljs-type"><span class="hljs-type">HKHealthStore</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1. This method throws an error if these data are not available. let birthdayComponents = try healthKitStore.dateOfBirthComponents() let biologicalSex = try healthKitStore.biologicalSex() let bloodType = try healthKitStore.bloodType() //2. Use Calendar to calculate age. let today = Date() let calendar = Calendar.current let todayDateComponents = calendar.dateComponents([.year], from: today) let thisYear = todayDateComponents.year! let age = thisYear - birthdayComponents.year! //3. Unwrap the wrappers to get the underlying enum values. let unwrappedBiologicalSex = biologicalSex.biologicalSex let unwrappedBloodType = bloodType.bloodType return (age, unwrappedBiologicalSex, unwrappedBloodType) } }</span></span></code> </pre><br>  O método <i>getAgeSexAndBloodType ()</i> chama o <b>HKHealthStore</b> , solicitando a data de nascimento, sexo e tipo de sangue do usuário.  Ele também calcula a idade do usuário usando a data de nascimento. <br><br><ol><li>  Você deve ter notado que esse método pode causar um erro.  Isso acontece sempre que uma data de nascimento, sexo ou tipo de sangue não foi armazenada no repositório central do HealthKit.  Como você acabou de inserir essas informações no seu aplicativo, não deve causar erros. </li><li>  Usando a classe <b>Calendário</b> , você pode converter qualquer data em um conjunto de <b>Componentes</b> de <b>Data</b> .  Isso é realmente conveniente quando você deseja obter um ano para um encontro.  Esse código apenas obtém seu ano de nascimento, ano atual e calcula a diferença. </li><li>  As variáveis ​​“expandidas” são nomeadas de maneira que fique claro que você precisa acessar a enumeração base da classe de wrapper ( <b>HKBiologicalSexObject</b> e <b>HKBloodTypeObject</b> ). </li></ol><br><h3>  Atualização da interface do usuário </h3><br>  Se você agora compilar e executar o aplicativo, não verá nenhuma alteração na interface do usuário, porque ainda não conectou essa lógica a ela. <br>  Abra <b>ProfileViewController.swif</b> te encontre o método <i>loadAndDisplayAgeSexAndBloodType (</i> ) <br><br>  Este método usará seu <b>ProfileDataStore</b> para carregar características biológicas na interface do usuário. <br><br>  Cole o seguinte código no método <i>loadAndDisplayAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userAgeSexAndBloodType = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getAgeSexAndBloodType() userHealthProfile.age = userAgeSexAndBloodType.age userHealthProfile.biologicalSex = userAgeSexAndBloodType.biologicalSex userHealthProfile.bloodType = userAgeSexAndBloodType.bloodType updateLabels() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) }</code> </pre><br>  Esse bloco de código carrega a idade, sexo e tipo de sangue como uma tupla.  Ele então define esses campos na instância local do modelo UserHealthProfile.  Por fim, atualiza a interface do usuário com os novos campos no <b>UserHealthProfile</b> chamando o método <i>updateLabels ()</i> . <br><br>  Como o <b>método ProfileDataStore</b> <i>getAgeSexAndBloodType ()</i> pode <b>gerar</b> um erro, o <b>ProfileViewController</b> deve tratá-lo.  Nesse caso, você apenas pega o erro e o apresenta como um aviso. <br><br>  Tudo isso é ótimo, mas há um problema.  O método <i>updateLabels () ainda</i> não <i>faz</i> nada.  Este é apenas um anúncio em branco.  Desta vez, vamos para a interface do usuário. <br><br>  Encontre o método <i>updateLabels ()</i> e cole este código nele: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> age = userHealthProfile.age { ageLabel.text = <span class="hljs-string"><span class="hljs-string">"\(age)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> biologicalSex = userHealthProfile.biologicalSex { biologicalSexLabel.text = biologicalSex.stringRepresentation } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bloodType = userHealthProfile.bloodType { bloodTypeLabel.text = bloodType.stringRepresentation }</code> </pre><br>  O código é bem simples.  Se o usuário definiu a idade, ele será formatado em um rótulo.  O mesmo vale para sexo biológico e tipo sanguíneo.  A variável stringRepresentation converte a enumeração em uma string para fins de exibição. <br><br>  Compile e execute o aplicativo.  Vá para a tela Perfil e IMC.  Clique no botão Ler dados do HealthKit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e13/3a5/ed1/e133a5ed1cd1d13016f28cc1a3452af9.png" alt="imagem" width="281" height="500"></div><br>  Se você já inseriu suas informações no aplicativo, elas devem aparecer nos atalhos dessa tela.  Se você não tiver feito isso, uma mensagem de erro será exibida. <br><br>  Uau!  Você lê e exibe dados diretamente do <b>HealthKit</b> . <br><br><h3>  Amostras de consulta </h3><br>  Agora é hora de ler o peso e a altura do usuário.  Eles serão usados ​​para calcular e exibir o IMC na visualização do perfil. <br><br>  As características biológicas estão prontamente disponíveis porque quase nunca mudam.  As amostras requerem uma abordagem muito mais complexa.  Eles usam o <b>HKQuery</b> , mais precisamente o <b>HKSampleQuery</b> . <br><br>  Para solicitar amostras do HealthKit, você precisará de: <br><br><ol><li>  Especifique o tipo de amostra que você deseja solicitar (peso, altura etc.), </li><li>  Algumas opções adicionais que ajudam a filtrar e classificar dados.  Para fazer isso, você pode transmitir um <b>NSPredicate</b> opcional ou uma matriz de <b>NSSortDescriptors</b> . </li></ol><br>  <b>Nota:</b> <i>Se você está familiarizado com o CoreData, provavelmente notou algumas semelhanças.</i>  <i><b>HKSampleQuery é</b> muito semelhante a <b>NSFetchedRequest</b> para um tipo de objeto, em que você especifica o predicado e os descritores de classificação e, em seguida, define o contexto do objeto para executar a consulta para obter os resultados.</i> <br><br>  Depois que sua consulta é configurada, basta chamar o <b>método HKHealthStore</b> <i>ExecuteQuery ()</i> para obter os resultados. <br><br>  Para o <b>Prancercise Tracker,</b> você criará uma função única e universal que baixa as amostras mais recentes de qualquer tipo.  Assim, você pode usá-lo para peso e altura. <br><br>  Abra <b>ProfileDataStore.swift</b> e cole o seguinte método na classe, logo abaixo do método <i>getAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getMostRecentSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sampleType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKSampleType</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKQuantitySample</span></span></span><span class="hljs-class">?, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.  HKQuery    . let mostRecentPredicate = HKQuery.predicateForSamples(withStart: Date.distantPast, end: Date(), options: .strictEndDate) let sortDescriptor = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: false) let limit = 1 let sampleQuery = HKSampleQuery(sampleType: sampleType, predicate: mostRecentPredicate, limit: limit, sortDescriptors: [sortDescriptor]) { (query, samples, error) in //2.       . DispatchQueue.main.async { guard let samples = samples, let mostRecentSample = samples.first as? HKQuantitySample else { completion(nil, error) return } completion(mostRecentSample, nil) } } HKHealthStore().execute(sampleQuery) }</span></span></code> </pre><br>  Este método utiliza o tipo de amostra (altura, peso, IMC, etc.).  Ele então cria uma consulta para recuperar a última amostra desse tipo.  Se você passar pelo tipo de amostra para crescimento, retornará ao seu último registro de crescimento. <br><br>  Muita coisa está acontecendo aqui.  Vou parar para explicar algumas coisas. <br><br><ol><li>  Existem vários métodos no <b>HKQuery</b> que podem ajudá-lo a filtrar os exemplos de consulta do HealthKit.  Nesse caso, usamos o predicado de data interno. </li><li>  Solicitar amostras do HealthKit é um processo assíncrono.  É por isso que o código no manipulador de conclusão é encontrado dentro do bloco Dispatch.  A conformidade é necessária no encadeamento principal.  Caso contrário, o aplicativo falhará. </li></ol><br>  Se tudo der certo, sua solicitação será executada e você obterá uma amostra limpa retornada no encadeamento <b>principal</b> , onde o <b>ProfileViewController</b> pode colocar seu conteúdo no rótulo.  Vamos fazer esta parte agora. <br><br><h3>  Exibindo amostras na interface do usuário </h3><br>  Na seção anterior, você baixou dados do <b>HealthKit</b> .  Salve-os como modelo no <b>ProfileViewController</b> e atualize o conteúdo em linhas usando o método <b>ProfileViewController</b> <i>updateLabels ()</i> <br><br>  Tudo o que você precisa fazer é expandir esse processo, adicionando uma função que carrega as amostras, as processa para a interface do usuário e chama <i>updateLabels ()</i> para preencher os rótulos com texto. <br><br>  Abra o arquivo <b>ProfileViewController.swift</b> , localize o método <i>loadAndDisplayMostRecentHeight (</i> ) e cole o seguinte código: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1.  HealthKit      guard let heightSampleType = HKSampleType.quantityType(forIdentifier: .height) else { print("Height Sample Type is no longer available in HealthKit") return } ProfileDataStore.getMostRecentSample(for: heightSampleType) { (sample, error) in guard let sample = sample else { if let error = error { self.displayAlert(for: error) } return } //2.     ,   , //    . let heightInMeters = sample.quantity.doubleValue(for: HKUnit.meter()) self.userHealthProfile.heightInMeters = heightInMeters self.updateLabels() }</span></span></code> </pre><br><ol><li>  Este método começa criando um tipo de amostra de crescimento.  Ele passa esse tipo de amostra para o método que você acabou de escrever, que retornará a amostra de crescimento de usuário mais recente registrada no HealthKit. </li><li>  Assim que a amostra retornar, o crescimento é convertido em metros e armazenado no modelo UserHealthProfile.  A <b>interface</b> do <b>usuário</b> será atualizada. </li></ol><br>  <b>Nota:</b> <i>Geralmente você deseja converter uma amostra de quantidade em uma unidade padrão.</i>  <i>Para fazer isso, o código acima usa o <i>método doubleValue (for :)</i> , que permite <b>passar os</b> dados relevantes necessários (neste caso, medidores) para o <b>HKUnit</b> .</i> <i><br><br></i>  <i>Você pode criar vários tipos de <b>HKUnits</b> usando alguns dos métodos de classe comuns disponíveis no <b>HealthKit</b> .</i>  <i>Para obter contadores, você pode simplesmente usar o método meter () no <b>HKUnit</b> , e será isso o que você precisa.</i> <br><br>  Com crescimento resolvido.  E o peso?  Tudo é bem parecido, mas você precisará preencher o método <i>loadAndDisplayMostRecentWeight ()</i> no <b>ProfileViewController</b> . <br><br>  Cole o seguinte código no método <i>loadAndDisplayMostRecentWeight ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightSampleType = <span class="hljs-type"><span class="hljs-type">HKSampleType</span></span>.quantityType(forIdentifier: .bodyMass) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Body Mass Sample Type is no longer available in HealthKit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getMostRecentSample(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: weightSampleType) { (sample, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sample = sample <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = sample.quantity.doubleValue(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">HKUnit</span></span>.gramUnit(with: .kilo)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.userHealthProfile.weightInKilograms = weightInKilograms <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updateLabels() }</code> </pre><br>  Você cria o tipo de amostra que deseja receber, solicita o <b>HealthKit</b> , <b>realiza</b> algumas conversões de unidade, salva no modelo e atualiza a interface do usuário. <br><br>  No momento, isso pode mostrar que o trabalho está concluído, mas há outra coisa.  A função <i>updateLabels ()</i> não está ciente dos novos dados que você disponibilizou para ela. <br><br>  Vamos consertar. <br><br>  Adicione as seguintes linhas à função <i>updateLabels ()</i> , logo abaixo da parte em que você expande o grupo sanguíneo para exibi-lo na interface do usuário: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weight = userHealthProfile.weightInKilograms { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightFormatter = <span class="hljs-type"><span class="hljs-type">MassFormatter</span></span>() weightFormatter.isForPersonMassUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> weightLabel.text = weightFormatter.string(fromKilograms: weight) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = userHealthProfile.heightInMeters { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightFormatter = <span class="hljs-type"><span class="hljs-type">LengthFormatter</span></span>() heightFormatter.isForPersonHeightUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> heightLabel.text = heightFormatter.string(fromMeters: height) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex { bodyMassIndexLabel.text = <span class="hljs-type"><span class="hljs-type">String</span></span>(format: <span class="hljs-string"><span class="hljs-string">"%.02f"</span></span>, bodyMassIndex) }</code> </pre><br>  Seguindo o modelo original na função <i>updateLabels ()</i> , ele expande a altura, o peso e o índice de massa corporal em seu modelo <b>UserHealthProfile</b> .  Se disponíveis, eles geram as linhas apropriadas e as atribuem aos rótulos na tela do usuário. <br><br>  <b>MassFormatter</b> e <b>LengthFormatter</b> fazem o trabalho de converter seus valores em strings. <br><br>  O índice de massa corporal não é realmente armazenado no modelo <b>UserHealthProfile</b> .  Esta é uma propriedade calculada que faz o cálculo para você. <br><br>  Clique na propriedade <b>bodyMassIndex</b> e você verá o que quero dizer: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyMassIndex: <span class="hljs-type"><span class="hljs-type">Double?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = weightInKilograms, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightInMeters = heightInMeters, heightInMeters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (weightInKilograms/(heightInMeters*heightInMeters)) }</code> </pre><br>  O índice de massa corporal é uma propriedade opcional, ou seja, ele pode retornar nulo se você não especificou altura ou peso (ou se eles estão configurados para um número que não faz sentido).  O cálculo real é simplesmente o peso dividido pela altura ao quadrado. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em breve, você mergulhará nisso tudo se não tiver adicionado dados ao </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para leitura pelo aplicativo. Se ainda não o fez, é necessário criar pelo menos amostras de altura e peso. </font></font></i> <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o aplicativo Health e vá para a guia Health Data. Lá, selecione o parâmetro Body Measurements, selecione Weight e Add Data Point para adicionar uma nova amostra de peso. Repita o processo para crescimento.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nesse ponto, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deve ser capaz de ler uma amostra recente do peso e da altura do usuário e exibi-la no texto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compile e execute os aplicativos. Vá para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil e IMC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em seguida, clique no botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ler dados do HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/d4d/35d/841d4d35d54528b5578fe32a3b163c0a.png" alt="imagem" width="281" height="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awesome! </font><font style="vertical-align: inherit;">Você acabou de ler suas primeiras amostras no repositório </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e as usou para calcular o IMC.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Salvando amostras </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Rastreador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> já tem um índice de massa corporal calculadora acessível. </font><font style="vertical-align: inherit;">Vamos usá-lo para registrar a amostra do IMC do usuário. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileDataStore.swift</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e adicione o seguinte método:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">saveBodyMassIndexSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bodyMassIndex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1. ,      guard let bodyMassIndexType = HKQuantityType.quantityType(forIdentifier: .bodyMassIndex) else { fatalError("Body Mass Index Type is no longer available in HealthKit") } //2.   HKUnit     let bodyMassQuantity = HKQuantity(unit: HKUnit.count(), doubleValue: bodyMassIndex) let bodyMassIndexSample = HKQuantitySample(type: bodyMassIndexType, quantity: bodyMassQuantity, start: date, end: date) //3.      HealthKit HKHealthStore().save(bodyMassIndexSample) { (success, error) in if let error = error { print("Error Saving BMI Sample: \(error.localizedDescription)") } else { print("Successfully saved BMI Sample") } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como em outros tipos de amostra, você deve primeiro garantir que o tipo de amostra esteja disponível no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, o código verifica se existe um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo de quantidade</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o índice de massa corporal. </font><font style="vertical-align: inherit;">Nesse caso, é usado para criar uma amostra de quantidade. </font><font style="vertical-align: inherit;">Caso contrário, o aplicativo para de funcionar.</font></font></li><li>  <i>count()</i>  <b>HKUnit</b>    ,       ,   .  -      ,    ,           . </li><li> <b>HKHealthStore</b>     ,        .      ,        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quase pronto. Para resumir a interface do usuário. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileViewController.swif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , localize o método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveBodyMassIndexToHealthKit (</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Este método é chamado quando o usuário clica no botão Salvar IMC na tabela. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cole o seguinte código no método:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">ProfileDataError</span></span>.missingBodyMassIndex) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.saveBodyMassIndexSample(bodyMassIndex: bodyMassIndex, date: <span class="hljs-type"><span class="hljs-type">Date</span></span>())</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você se lembra que o índice de massa corporal é uma propriedade calculada que retorna um valor quando amostras de altura e peso são carregadas no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este código está tentando calcular essa propriedade e, se possível, será passada para o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">método savedBodyMassIndexSample (bodyMassIndex: date :)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que </font><font style="vertical-align: inherit;">você acabou de escrever. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Também mostra um alerta conveniente se o índice de massa corporal não puder ser calculado por qualquer motivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compile e execute o aplicativo. Vá para a tela </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil e IMC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Faça o download dos dados do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeathKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e clique no botão Salvar IMC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olhe para o console. Você vê isso?</font></font><br><br><pre> <code class="swift hljs">   <span class="hljs-type"><span class="hljs-type">BMI</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se sim, parabéns! </font><font style="vertical-align: inherit;">Sua amostra de IMC agora está armazenada no repositório central do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos ver se conseguimos encontrá-lo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o aplicativo Health, toque na guia Health Data, clique em Body Measurements na exibição de tabela e clique em Body Mass Index.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/953/802/724/953802724c0ccad14b5184bd8b01b17f.png" alt="imagem" width="281" height="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt434978/">https://habr.com/ru/post/pt434978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt434966/index.html">Nova linguagem de programação Mash</a></li>
<li><a href="../pt434968/index.html">Algo sobre o espaço para nome</a></li>
<li><a href="../pt434972/index.html">Como escrever testes de unidade, se você não quiser</a></li>
<li><a href="../pt434974/index.html">Trabalhar com um formato de configurações 1C: Enterprise</a></li>
<li><a href="../pt434976/index.html">ITMO University Fablab: Coworking DIY para pessoas criativas - mostre o que há dentro</a></li>
<li><a href="../pt434982/index.html">Perspectiva: MultiClet S1</a></li>
<li><a href="../pt434984/index.html">Por que eu odeio Eloquent ORM</a></li>
<li><a href="../pt434986/index.html">Conceitos básicos da biblioteca C ++ padrão</a></li>
<li><a href="../pt434992/index.html">Atualizando o IDA Pro. Depurador para Sega Mega Drive (parte 1)</a></li>
<li><a href="../pt434994/index.html">Android: Criando sabores dinâmicos de produtos e assinando configurações</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>