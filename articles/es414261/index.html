<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•† üö° ü§∞üèΩ ¬øD√≥nde guardas los datos? üí™ ‚èÆÔ∏è üßô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Continuamos nuestra serie experimental de art√≠culos, observando que puedes influir en tiempo real en el proceso de creaci√≥n de un juego en ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øD√≥nde guardas los datos?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/414261/">  Hola Habr!  Continuamos nuestra serie experimental de art√≠culos, observando que puedes influir en tiempo real en el proceso de creaci√≥n de un juego en UWP.  Hoy hablaremos sobre la pregunta "¬øD√≥nde almacenar los datos?" Que surge constantemente en las filas de los desarrolladores.  ¬°√önete a nosotros y comparte tus pensamientos en los comentarios! <br><br><img src="https://habrastorage.org/webt/bi/xw/n9/bixwn96nclriud-rklafycm_rma.jpeg"><a name="habracut"></a><br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>Parte 1: por d√≥nde empezar</b></a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2: pantalla de bienvenida avanzada</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3: el estilo del hijo del hijo de mam√°</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 4: Obtenci√≥n de datos del usuario (voluntario)</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 5: ¬øD√≥nde almacena los datos?</a></b> </li></ul><br>  <i>Doy la palabra al autor, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Alexei Plotnikov</a> .</i> <br><br>  En un art√≠culo anterior, plante√© la cuesti√≥n de la sincronizaci√≥n conveniente de los datos del usuario entre dispositivos y, en primer lugar, resolv√≠ el problema con su identificaci√≥n, sin embargo, esta es la fracci√≥n m√°s peque√±a de lo que queda por hacer para lograr los objetivos. <br><br>  Un problema mucho m√°s complejo es la forma, y ‚Äã‚Äãlo m√°s importante, la ubicaci√≥n de los datos del usuario y, a trav√©s de los esfuerzos de Microsoft, al plantear una pregunta de este tipo, lo primero que se me ocurre es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microsoft Azure</a> .  La plataforma en la nube de Azure incluye una gama tan amplia de servicios que parece que no hay tareas que no puedan resolverse con su ayuda.  Si es cierto o no, no puedo juzgar, pero mi tarea est√° definitivamente dentro del poder de esta plataforma.  Sin embargo, lo primero es lo primero. <br><br>  Comenzamos con algo peque√±o: ¬øqu√© es una nube?  Por primera vez escuch√© sobre la nube en 2012 y luego la frase "computaci√≥n en la nube" se usaba con mayor frecuencia.  La idea inicial de tales c√°lculos era distribuir el trabajo inform√°tico entre diferentes dispositivos que est√°n alejados entre s√≠.  Particularmente impresionante habl√≥ sobre el futuro, en el que incluso las tareas m√°s dif√≠ciles se procesar√°n en un par de momentos debido al hecho de que los c√°lculos se distribuir√°n entre todas las computadoras del mundo. <br><br>  En la pr√°ctica, todo se redujo a centros de datos repartidos por todo el mundo y que proporcionaban su potencia inform√°tica a los consumidores, y el concepto inicial era solo la distribuci√≥n entre las m√°quinas dentro del centro de datos y entre los propios centros de datos (con mayor frecuencia dentro de la misma regi√≥n). <br><br>  Con base en lo anterior, podemos suponer que cuando escuche la palabra "nube", puede percibirla como un "alojamiento" m√°s familiar, con la √∫nica diferencia de que el poder de la nube puede expandirse sin ning√∫n esfuerzo adicional de su parte. <br><br>  La segunda pregunta que puede tener es ¬øpor qu√© Azure?  "Dado que este es un art√≠culo en el blog de Microsoft, entonces el autor solo hablar√° sobre sus productos" - usted dice, y se equivocar√°.  Los motivos para usar Azure son mucho m√°s comunes: dado que este es un producto de Microsoft, tiene el mayor grado posible de integraci√≥n con sus otros productos, con la ayuda de la cual se est√° desarrollando mi aplicaci√≥n. <br><br>  Sin embargo, observo que la compa√±√≠a hace todo lo posible para que el uso de Azure sea atractivo para los desarrolladores de Android o iOS.  Bueno, el √∫ltimo problema mencionado, pero no menos importante, es el costo de usar la nube.  Como soy titular de una suscripci√≥n a BizSpark, me han otorgado un pr√©stamo mensual para una bolsa con intereses m√°s que para cubrir mis necesidades en la nube, aunque las condiciones que se brindan de forma gratuita tambi√©n pueden cubrir la mayor√≠a de las necesidades de un desarrollador privado. <br><br>  Ahora pasemos a la selecci√≥n directa de un mecanismo de sincronizaci√≥n y almacenamiento de datos.  No voy a ser astuto, como persona autodidacta a menudo tengo que lidiar con tecnolog√≠as de las que no tengo idea antes de conocer UWP, resolv√≠ problemas similares usando bases de datos SQL. <br><br>  Sin embargo, UWP no tiene los medios para trabajar con los DBMS cl√°sicos de SQL, y SQLite se ofrece como una alternativa, y, despu√©s de comenzar su estudio, descubr√≠ que dicha base de datos est√° integrada, lo que es adecuado para el almacenamiento conveniente y el uso de datos locales, pero no es absolutamente adecuado para la colocaci√≥n de datos en almacenamiento remoto  Ya en el proceso de escribir este art√≠culo, cuando se eligi√≥ la tecnolog√≠a adecuada, me encontr√© con una de las soluciones de Azure en el campo del desarrollo de aplicaciones m√≥viles, que le permite sincronizar datos de la tabla SQLite entre dispositivos, pero despu√©s de pensarlo detenidamente, segu√≠ con la elecci√≥n inicial. <br><br>  Por cierto, hacer la elecci√≥n inicial no fue dif√≠cil, ya que Microsoft solicit√≥ cort√©smente una lista de tecnolog√≠as que el desarrollador de UWP probablemente tendr√≠a que enfrentar.  En las √∫ltimas versiones de Visual Studio, al crear un nuevo proyecto para UWP, ver√° una p√°gina con recomendaciones para comenzar, donde uno de los enlaces dice "Agregar un servicio recomendado".  Al hacer clic en este enlace, se abre la pesta√±a "Conectar el servicio" y ya en √©l vemos la opci√≥n "Almacenamiento en la nube con el servicio de almacenamiento de Azure". <br><br><img src="https://habrastorage.org/webt/fr/wx/k9/frwxk9themsqsxrjnxuhfnuzljw.png"><br><br>  La intuici√≥n sugiere que esto es exactamente lo que necesita, por lo que decid√≠ centrarme en un estudio en profundidad de este problema con miras a un mayor uso en el proyecto. <br><br>  El almacenamiento en la nube es un conjunto de varios productos para diferentes tareas, que se pueden leer m√°s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , pero estaba principalmente interesado en el almacenamiento de tablas, que result√≥ ser la base de datos NoSQL. <br><br>  NoSQL es una base de datos sin esquema, es decir, una en la que la tabla no necesita ser estructurada de antemano.  De hecho, la tabla en este caso es solo parte de la ruta a lo que se llama la secci√≥n, lo que significa que una sola tabla puede contener filas, por ejemplo, con tres y cinco columnas a la vez.  Para comprender completamente las caracter√≠sticas del almacenamiento de la tabla, le aconsejo que lea detenidamente el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">manual</a> , pero considerar√© este tema desde mi punto de vista mundano, porque al final el material est√° dirigido a principiantes, quienes soy yo en este tema. <br><br>  <b>Para comenzar, descubramos c√≥mo crear una tabla NoSQL:</b> <br><br>  1. Registre una cuenta de Azure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gratuita</a> .  Si tiene una suscripci√≥n a MSDN o BizSpark y ya est√° activada en Azure, puede omitir este paso.  Una cuenta gratuita le otorga un pr√©stamo de $ 200 durante el primer mes y luego acceso gratuito a una cierta cantidad de recursos de la mayor√≠a de los servicios de Azure.  Traducido a un lenguaje comprensible, todo se hace de tal manera que no tendr√° que pagar hasta que su producto gane lo suficiente para cubrir los gastos, sin mencionar el uso de Azure para la autoeducaci√≥n. <br><br>  Pero incluso si cruza el umbral libre, los precios para el almacenamiento de una tabla son mucho m√°s leales que para una cantidad similar de bases de datos SQL.  Por ejemplo, al momento de escribir este art√≠culo, he creado dos tablas, hasta ahora con solo una entrada.  Durante 18 d√≠as del per√≠odo de informe, recurr√≠ a ella en promedio 20-30 veces al d√≠a y se cancelaron 2 kopeks de la cuenta de cr√©dito para este per√≠odo.  Al aumentar dichos costos para el volumen planificado, me di cuenta de que est√°n m√°s que cubiertos por los ingresos potenciales de la aplicaci√≥n. <br><br>  2. Ahora que tiene una cuenta en Azure, procedemos a crear una cuenta de almacenamiento. <br><br><img src="https://habrastorage.org/webt/pk/zf/ci/pkzfciggnj3px9azcypmku_rgd8.png"><br><br>  Puede hacer todo esto desde la misma p√°gina de conexi√≥n de Visual Studio Services, que describ√≠ anteriormente.  Si de repente cerr√≥ esta p√°gina, puede abrirla haciendo doble clic en "Servicios conectados" en el Explorador de soluciones.  Despu√©s de seleccionar el servicio requerido, se abrir√° una ventana con las cuentas de almacenamiento disponibles y, para agregar una nueva, haga clic en el bot√≥n correspondiente. <br><br>  <b>En la nueva ventana, deber√° realizar los siguientes pasos:</b> <br><br><ul><li>  Para comenzar, deber√° iniciar sesi√≥n con su cuenta de Microsoft.  Debe usar la cuenta a la que est√°n vinculadas sus suscripciones o una cuenta de Azure gratuita. </li><li>  Despu√©s de iniciar sesi√≥n en su cuenta, su suscripci√≥n (a) aparecer√° en el campo "Suscripci√≥n".  Todo es simple con la elecci√≥n, por lo que los comentarios son superfluos. </li><li>  En el campo "Nombre", especifique el nombre deseado del servicio de almacenamiento.  Dado que este tambi√©n es el nombre de dominio del servicio, debe ser √∫nico en todas las cuentas disponibles en Azure, y no solo en el suyo. </li><li>  El campo "Categor√≠a de precios" requerir√° que comprenda las diferencias entre una plataforma en la nube y el alojamiento convencional, ya que al hacer clic en el enlace debajo del campo puede ver una lista de precios, pero no una explicaci√≥n inteligible, que le brinda cada opci√≥n.  Por supuesto, en la naturaleza de los enlaces de sitio puede encontrar informaci√≥n completa sobre todas estas abreviaturas como GRS y LRS, pero esto es superfluo para el desarrollador promedio.  Es suficiente entender que cuanto m√°s cara sea la tarifa, m√°s centros de datos estar√°n involucrados en el procesamiento y almacenamiento de sus datos y mayor ser√° la probabilidad de su seguridad.  Para un proyecto peque√±o, la tasa LRS m√°s baja est√° bien. </li><li>  Un "grupo de recursos" es una combinaci√≥n de varios servicios de Azure para una sola administraci√≥n.  En nuestro caso, cree uno nuevo, asigne cualquier nombre descriptivo y contin√∫e. </li><li>  Lo √∫ltimo que debe elegir es la "Ubicaci√≥n" de su servicio.  Por ubicaci√≥n se entiende la ubicaci√≥n real de los centros de datos que ser√°n responsables de trabajar con nuestros datos.  Tenga en cuenta que hablo en plural, ya que en una regi√≥n puede haber varios centros de datos y el trabajo se puede distribuir entre ellos (en caso de que elija una categor√≠a de precios de asesoramiento).  Elija el que est√© m√°s cerca de su base de usuarios principal.  Sin embargo, si planea crecer a la escala de todo el mundo y necesita una respuesta m√°xima en cualquier parte del mundo, nadie lo molestar√° por cada versi√≥n regional de la aplicaci√≥n para crear una cuenta de almacenamiento separada e implementar la sincronizaci√≥n de datos entre ellos.  Es un alto nivel de extensibilidad que es la principal ventaja de la nube. </li></ul><br>  3. Despu√©s de crear la cuenta de almacenamiento, se agregar√° a la lista y puede continuar haciendo clic en el bot√≥n "Agregar".  El resultado de esta acci√≥n ser√° agregar un paquete NuGet para trabajar con Azure en el proyecto y guardar la cadena de conexi√≥n en el archivo app.config del proyecto. <br><br>  Desafortunadamente, es imposible trabajar con valores de este archivo en UWP (o posiblemente con muletas terribles), as√≠ que simplemente copie la cadena de conexi√≥n al servicio de almacenamiento desde all√≠ a un lugar conveniente en el proyecto y contin√∫e con el siguiente paso. <br><br>  4. Ahora queda crear una tabla y comenzar a trabajar con ella.  Y aqu√≠ comienza el trabajo individual, dependiendo directamente de las tareas. <br><br>  El hecho es que antes de comenzar a crear tablas, debe pensar cuidadosamente sobre la arquitectura para almacenar sus datos.  Trabajar con el almacenamiento de la tabla es tan conveniente que crear una nueva tabla directamente desde el c√≥digo es solo cuesti√≥n de unas pocas l√≠neas, y con esa conveniencia existe un deseo natural de asignar una tabla separada para cada usuario, porque la tarea final es sincronizar los datos entre sus dispositivos.  Sin embargo, cuando trabaje con una tecnolog√≠a desconocida, no debe tomar decisiones apresuradas y debe sopesar cuidadosamente los pros y los contras.  Un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> especial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el manual</a> puede ayudar a tomar la decisi√≥n correcta, pero prep√°rese para tener que volver a leerlo varias veces, ya que es muy dif√≠cil aprender todos los datos de inmediato, especialmente teniendo en cuenta la gran cantidad de t√©rminos nuevos. <br><br>  Continuar√© la historia teniendo en cuenta el hecho de que a√∫n ley√≥ el manual y comprendi√≥ algunas de las caracter√≠sticas de trabajar con el almacenamiento de tablas.  Por ejemplo, me di cuenta de que conceptualmente una tabla no es una especie de unidad aislada y es m√°s bien un lugar para una agrupaci√≥n l√≥gica de registros.  Esto es f√°cil de entender si presenta la tabla como una carpeta en la que almacena archivos de datos.  Una carpeta por s√≠ sola no ocupa espacio y no es una parte integral de los archivos, sino que simplemente define una parte de la ruta a los archivos que son l√≥gicos, pero no necesarios, para guardarse en esta carpeta. <br><br>  La conclusi√≥n de esto es bastante simple: nadie se molesta en almacenar la configuraci√≥n de todos los usuarios en una tabla, lo principal es que el par de valores en las columnas PartitionKey y RowKey son √∫nicos dentro de la tabla.  Esto se implementa nuevamente en mi proyecto, ya que la ID de usuario actuar√° como PartitionKey y, por ejemplo, la cadena "UserName" como RowKey, lo que nos permitir√° determinar el registro √∫nico en el que se almacena el nombre de usuario.  Pero como dije anteriormente, debemos sopesar todos los pros y los contras, as√≠ que sopesemos: <br><br><ul><li>  "Para" una tabla separada para los datos de cada usuario es la conveniencia de percibir la estructura de datos.  Si tomamos la tabla como una carpeta con archivos, entonces es l√≥gico que todos los archivos de un usuario est√©n en la misma carpeta y es m√°s com√∫n trabajar con dicha arquitectura. </li><li>  Todos los dem√°s factores est√°n "en contra" de una tabla separada.  Datos del usuario dentro de una tabla separada: esto es convenientemente preciso hasta que el n√∫mero de tales tablas sea de miles.  Dado que la cuenta de almacenamiento est√° en un nivel superior a la tabla, no se les proporciona ninguna otra agrupaci√≥n. <br><br>  Dada la base de usuarios potenciales, corremos el riesgo de ahogarnos en miles de tablas individuales, perdiendo aquellas que tienen alg√∫n valor de prioridad.  Al mismo tiempo, almacenar la configuraci√≥n de todos los usuarios en una tabla simplifica la administraci√≥n y trabaja con datos para recopilar informaci√≥n estad√≠stica o implementar funciones sociales. <br><br>  Adem√°s, el bajo costo de usar el almacenamiento de tablas le permite duplicar cualquier dato en tablas separadas, de acuerdo con la l√≥gica requerida.  En particular, planeo crear una tabla adicional con el nombre de usuario, un enlace al avatar y una indicaci√≥n de pertenencia al pa√≠s, que se utilizar√° para clasificar tablas u otras funciones sociales que se pueden agregar a la aplicaci√≥n. </li></ul><br>  Entonces, cuando descubri√≥ la estructura de almacenamiento de datos, finalmente agreguemos una nueva tabla.  Como nos negamos a crearlo a nivel de c√≥digo, quedan dos opciones: a trav√©s del portal web de Azure o usando la herramienta especial Microsoft Azure Storage Explorer, que se puede descargar desde storageexplorer.com.  En ambos casos, es necesario seleccionar la cuenta de almacenamiento deseada y en la secci√≥n "Servicio de tablas / tablas", seleccione "+ Tabla / Crear tabla".  En el cuadro de di√°logo que aparece, ingrese el nombre deseado y confirme los cambios. <br><br><img src="https://habrastorage.org/webt/ca/0b/j9/ca0bj92etkk7v2qpp-r63wtymeq.png"><br><br>  Despu√©s de eso, puede trabajar con la nueva tabla del c√≥digo sin ning√∫n problema. <br><br>  Las operaciones principales que realizar√© con la tabla son la inserci√≥n y extracci√≥n de filas, que se denominan "entidades" en la terminolog√≠a de almacenamiento de la tabla.  Tal t√©rmino es m√°s f√°cil de entender cuando se da cuenta de que para insertar y recuperar una entidad, deber√° asignarla a una clase heredada de TableEntity de Microsoft.WindowsAzure.Storage.Table.  La clase sucesora ya contendr√° algunos campos obligatorios, como, por ejemplo, PartitionKey (nombre de secci√≥n) y RowKey (nombre de l√≠nea), y aquellos campos que implementemos independientemente ser√°n columnas en la l√≠nea (propiedades de la entidad). <br><br>  Considere un ejemplo de una tabla en la que se almacenar√° una lista de todos los jugadores con su nombre, avatar y afiliaci√≥n de pa√≠s. <br><br><pre><code class="cs hljs">    : Imports Microsoft.WindowsAzure.Storage Imports Microsoft.WindowsAzure.Storage.Table</code> </pre> <br>  Decid√≠ poner los m√©todos para trabajar con la tabla en una clase separada para la conveniencia de trabajar desde diferentes puntos de la aplicaci√≥n.  Cr√©elo e inmediatamente agregue las constantes previamente conocidas: <br><br><pre> <code class="cs hljs">Public Class AzureWorker Private Const AzureStorageConnectionString As String = <span class="hljs-string"><span class="hljs-string">"  ,     app.config"</span></span> Private Const GamerListTableNameString As String = <span class="hljs-string"><span class="hljs-string">"GamerList"</span></span> <span class="hljs-string"><span class="hljs-string">'    ‚Ä¶ End Class</span></span></code> </pre> <br>  Ahora necesitamos crear una clase que asignaremos a la entidad (fila) dentro de la tabla: <br><br><pre> <code class="cs hljs"> Private Class GamerListClodTableDataClass Inherits TableEntity Public Const RowKeyValue As String = <span class="hljs-string"><span class="hljs-string">"UserID"</span></span> <span class="hljs-function"><span class="hljs-function">Public Sub </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">New</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) RowKey</span></span> = RowKeyValue End Sub Public Property UserName As String = <span class="hljs-string"><span class="hljs-string">""</span></span> Public Property UserountryID As String = <span class="hljs-string"><span class="hljs-string">""</span></span> Public Property UserAvatar As String = <span class="hljs-string"><span class="hljs-string">""</span></span> End Class</code> </pre> <br>  La clase a mapear debe ser heredada de TableEntity y tener campos para los datos que planeamos colocar en la tabla.  Tenga en cuenta que no es necesario establecer valores para RowKey o PartitionKey en el nivel de clase, pero en mi caso, RowKey se establece porque es inmutable independientemente de otra entrada. <br><br>  Pero, dado que en esta etapa probablemente no entendiste completamente la esencia de trabajar con el almacenamiento de la tabla, explicar√© la l√≥gica establecida en esta etapa.  La forma m√°s r√°pida de trabajar con una tabla es consultar a la entidad por el nombre de la cadena y el nombre de la secci√≥n, por lo que debe conocer estos datos de antemano.  Adem√°s, la combinaci√≥n de PartitionKey y RowKey debe ser √∫nica dentro de la tabla, lo que significa que es l√≥gico escribir una ID de usuario √∫nica en una de estas teclas y asignar a la segunda clave cualquier nombre que siempre sabremos.  Esto es exactamente lo que se hace en la clase GamerListClodTableDataClass. <br><br>  La √∫ltima etapa preparatoria antes de las consultas directas a la tabla es la creaci√≥n de su objeto en una funci√≥n separada: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Private Shared Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCloudTable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tableName As String</span></span></span><span class="hljs-function">) As CloudTable Dim storageAccount As CloudStorageAccount</span></span> = CloudStorageAccount.Parse(AzureStorageConnectionString) Dim tableClient As CloudTableClient = storageAccount.CreateCloudTableClient() Dim table As CloudTable = tableClient.GetTableReference(tableName) Return table End Function</code> </pre> <br>  Esto se hace para no duplicar el c√≥digo cada vez que queremos leer o escribir datos en la tabla.  Tenga en cuenta que este c√≥digo no realiza solicitudes directas a la nube y se ejecutar√° sin problemas cuando no haya conexi√≥n.  Todo lo que hace es crear paso a paso un objeto de tabla a partir de datos existentes, como la cadena de conexi√≥n de almacenamiento y el nombre de la tabla. <br><br>  Finalmente, pasemos a trabajar directamente con la tabla y comencemos guardando los datos de usuario actuales: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavedOrUpdateUserData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">u As UserManager</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of Boolean</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.ExistsAsync Then Dim UserDataClodTableData As New GamerListClodTableDataClass With {.PartitionKey = u.UserId, .UserName = u.UserName.Trim, .UserountryID = u.UserountryID, .UserAvatar = <span class="hljs-string"><span class="hljs-string">"https://apis.live.net/v5.0/"</span></span> &amp; u.UserId &amp; <span class="hljs-string"><span class="hljs-string">"/picture"</span></span>} Dim insertOperation As TableOperation = TableOperation.InsertOrReplace(UserDataClodTableData) Await table.ExecuteAsync(insertOperation) Return True End If Catch ex As Exception End Try Return False End Function</code> </pre> <br>  La solicitud se realiza como una funci√≥n asincr√≥nica para que el c√≥digo de llamada pueda obtener el resultado de la ejecuci√≥n (True en caso de √©xito y False en caso de error).  Adem√°s, un par√°metro del tipo UserManager se pasa a la funci√≥n, que es una referencia a la clase con datos del usuario.  Creamos tal clase en un art√≠culo anterior, con la √∫nica diferencia de que en esta versi√≥n hay un campo UserountryID que almacena datos sobre el pa√≠s del usuario. <br><br>  Para consultas a la tabla, primero debe crear su objeto usando la cadena de conexi√≥n al repositorio y el nombre de la tabla (anteriormente hemos puesto este proceso en una funci√≥n separada).  A continuaci√≥n, debe verificar la existencia de la tabla y, aunque estamos seguros de que tenemos una tabla con ese nombre, puede producirse un error, por ejemplo, debido a la falta de conectividad de red o debido a una falla en la nube (por lo que este c√≥digo se coloca en Try / Captura).  Luego, antes de escribir en la tabla, debe crear una instancia de la clase UserDataClodTableData y asignar el valor requerido a sus campos y solo luego crear la operaci√≥n InsertOrReplace.  Como puede adivinar por el nombre de la operaci√≥n, insertar√° una nueva fila en la tabla si las filas con el mismo par de PartitionKey y RowKey no existen en la tabla y reemplazar√° los datos si dicha fila ya existe.  Bueno, el equipo final de ExecuteAsync, de hecho, realizar√° la acci√≥n planificada en el lado del almacenamiento de la tabla. <br><br>  Leer datos de una tabla es tan f√°cil como escribirlo.  Por ejemplo, solicitemos un nombre de usuario: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id As String</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.ExistsAsync Then Dim retrieveOperation As TableOperation = TableOperation.Retrieve(Of GamerListClodTableDataClass)(id, GamerListClodTableDataClass.RowKeyValue) Dim retrievedResult As TableResult = Await table.ExecuteAsync(retrieveOperation) If retrievedResult.<span class="hljs-function"><span class="hljs-function">Result IsNot Nothing Then Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">retrievedResult.Result, GamerListClodTableDataClass</span></span></span><span class="hljs-function">).UserName End If End If Catch ex As Exception End Try Return "" End Function</span></span></code> </pre> <br>  Este c√≥digo casi no difiere del anterior y tambi√©n comienza creando un objeto de tabla y verificando su existencia.  Adem√°s, como en la grabaci√≥n, creamos una operaci√≥n, pero esta vez una operaci√≥n de extracci√≥n, que requiere la indicaci√≥n de PartitionKey y RowKey.  Despu√©s de eso, extraemos el resultado usando ExecuteAsync y trabajamos con el objeto resultante del tipo TableResult, que en realidad se reduce a convertir la propiedad Result al tipo de la clase que se est√° asignando y extraer el nombre de usuario. <br><br>  Trabajar con una tabla no se limita a las operaciones de lectura y escritura y admite muchos scripts diferentes.  Por ejemplo, puede crear una consulta que extraiga todas las entidades con la PartitionKey especificada o todas las entidades que tengan el campo especificado, pero es importante recordar la velocidad de tales operaciones, as√≠ como la cantidad de datos que se transmitir√°n a trav√©s de la red. <br><br>  El ejemplo anterior es el m√°s √≥ptimo desde el punto de vista de la velocidad de consulta, ya que el sistema de direccionamiento probablemente encontrar√° una entidad a lo largo de la ruta "nombre de almacenamiento \ nombre de tabla \ PartitionKey + RowKey", sin embargo, para obtener solo un nombre, cargamos toda la entidad como un todo, lo que no es beneficioso sobre la cantidad de datos transferidos. <br><br>  El siguiente es un c√≥digo de funci√≥n modificado que tiene en cuenta la optimizaci√≥n m√°xima de la consulta: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id As String</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.<span class="hljs-function"><span class="hljs-function">ExistsAsync Then Dim projectionQuery As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of DynamicTableEntity</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-function"><span class="hljs-function">New </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of DynamicTableEntity</span></span></span><span class="hljs-function">)(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Where</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TableQuery.CombineFilters(TableQuery.GenerateFilterCondition(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"PartitionKey"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, QueryComparisons.Equal, id</span></span></span><span class="hljs-function">), "and", TableQuery.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateFilterCondition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"RowKey"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, QueryComparisons.Equal, GamerListClodTableDataClass.RowKeyValue</span></span></span><span class="hljs-function">))).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Select</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"UserName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">}</span></span></span><span class="hljs-function">) Dim resolver As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EntityResolver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">)</span></span> = Function(pk, rk, ts, props, etag) <span class="hljs-function"><span class="hljs-function">Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">props</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"UserName"</span></span></span></span></span><span class="hljs-function">).StringValue End Function Dim result As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuerySegment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">)</span></span> = Await table.ExecuteQuerySegmentedAsync(projectionQuery, resolver, Nothing) If result.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-function">Then Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">result</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) End If End If Catch ex As Exception End Try Return "" End Function</span></span></code> </pre> <br>  En lugar de crear un objeto de operaci√≥n, en este c√≥digo creamos un objeto de solicitud que contiene varios m√©todos para determinar qu√© debe obtenerse como resultado.  El m√©todo Where crea un filtro que indica la necesidad de devolver solo aquellas filas para las cuales PartitionKey y RowKey son iguales a los valores especificados, y la siguiente selecci√≥n indica que solo se necesita seleccionar la columna UserName. <br><br>  Con tal consulta, no tiene sentido comparar el resultado con ninguna clase, por lo tanto, IDictionary se usa como valor de retorno, donde la clave es el nombre de la columna y el valor es su contenido.  Dado que la funci√≥n ExecuteQuerySegmentedAsync no sabe qu√© resultado de su ejecuci√≥n se obtendr√°, es posible (y en este caso necesario) pasar un delegado EntityResolver, que se refiere a una funci√≥n que toma el valor deseado del diccionario.  El resultado de todo esto se convierte en TableQuerySegment en el primer √≠ndice del cual se almacena el nombre del usuario solicitado. <br><br>  En general, el uso de consultas en lugar de la operaci√≥n de extracci√≥n b√°sica le permite ampliar significativamente las posibilidades de trabajar con una tabla, pero tenga cuidado, porque a diferencia del SQL cl√°sico, aqu√≠ la velocidad de procesamiento de consultas depende directamente de sus par√°metros.  Nadie se molesta en ejecutar una consulta para recuperar todos los registros de usuario cuyos nombres son iguales al dado, pero dicha consulta ser√° m√°s larga que su contraparte en SQL.  Para aprender esto, una vez m√°s lo dirijo a la gu√≠a de dise√±o de tablas que mencion√© anteriormente, y tambi√©n le recomiendo que estudie el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> , que proporciona ejemplos sobre c√≥mo trabajar con el almacenamiento de tablas. <br><br>  <i>Importante!</i>  <i>Los art√≠culos de enlace usan c√≥digo para aplicaciones .NET cl√°sicas y son diferentes de la implementaci√≥n de UWP.</i>  <i>Afortunadamente, esta diferencia no es significativa y los an√°logos son intuitivos (la mayor√≠a de las veces est√°n en el prefijo Async).</i> <br><br>  En conclusi√≥n, compartir√© los resultados del uso del almacenamiento de Azure en mi proyecto en este momento.  En el primer inicio, despu√©s de recibir la identificaci√≥n de usuario y descargar datos de Live ID, le sugiero que elija un alias (apodo) en caso de que el nombre almacenado en el perfil no sea adecuado para √©l.  Luego, el apodo ingresado se guarda en la clase UserManager en lugar del est√°ndar, y todos estos datos se guardan en la tabla GamerList.  En el siguiente inicio, la identificaci√≥n de usuario se recibe en segundo plano y se solicita un alias de la tienda.  Como resultado, el usuario ve su apodo en el juego, y no el nombre del perfil est√°ndar. <br><br>  Tambi√©n en el futuro, una tabla con una lista de usuarios ser√° √∫til para ingresar funciones sociales en el juego y, ahora, he creado al menos una aplicaci√≥n para estos datos.  En la implementaci√≥n de esta tarea, las herramientas de Azure, como el Almacenamiento en cola y las Funciones de Azure, me ayudar√°n nuevamente, pero hablar√© sobre esto en uno de los siguientes art√≠culos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414261/">https://habr.com/ru/post/es414261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414245/index.html">Modelo de regresi√≥n polin√≥mica</a></li>
<li><a href="../es414249/index.html">Infraestructura de clave p√∫blica: biblioteca GCrypt como alternativa a OpenSSL con soporte para criptograf√≠a rusa</a></li>
<li><a href="../es414251/index.html">Desarrollo sin programaci√≥n: despu√©s de todo, ¬øtruco de vida?</a></li>
<li><a href="../es414253/index.html">Patrones para probadores. Proxy (alternativo)</a></li>
<li><a href="../es414255/index.html">Sue√±o patentado del programador - Parte II</a></li>
<li><a href="../es414263/index.html">¬øHay vida fuera del Roscosmos? Descripci√≥n general de la exploraci√≥n espacial privada rusa</a></li>
<li><a href="../es414265/index.html">Richard Hamming: Cap√≠tulo 7. Inteligencia artificial - II</a></li>
<li><a href="../es414267/index.html">¬øC√≥mo reemplazar un contador con un robot?</a></li>
<li><a href="../es414269/index.html">"20,000 IOPS por nodo tienen un buen rendimiento con 5 ms de latencia". Para OLTP: no</a></li>
<li><a href="../es414271/index.html">C√≥mo domar un disco duro en una computadora port√°til y evitar el estacionamiento en 8 segundos de tiempo de inactividad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>