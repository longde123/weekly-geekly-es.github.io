<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèæ ‚åöÔ∏è üç∏ Public Key-Infrastruktur (Fortsetzung): Zertifizierungsstelle basierend auf OpenSSL und SQLite3 üë©üèº‚Äçüöí ‚úÖ ‚ùï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn eines der Hauptobjekte der Public-Key-Infrastruktur (PKI) X509-Zertifikate sind, sind Zertifizierungsstellen (CAs) das zentrale Thema der PKI. Es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Public Key-Infrastruktur (Fortsetzung): Zertifizierungsstelle basierend auf OpenSSL und SQLite3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413493/"><img src="https://habrastorage.org/webt/60/9k/sk/609ksklwykcs1xqbwuoyvqw7wg8.png" align="left" alt="Bild">  Wenn eines der Hauptobjekte der Public-Key-Infrastruktur (PKI) X509-Zertifikate sind, sind Zertifizierungsstellen (CAs) das zentrale Thema der PKI.  Es ist die Zertifizierungsstelle, die Zertifikate ausstellt, ihre G√ºltigkeit beendet (Zertifikatsperrung) und ihre G√ºltigkeit best√§tigt.  Auf den Seiten von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Habrahabr</a> finden Sie verschiedene Ver√∂ffentlichungen zum Thema digitale Zertifikate mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenSSL</a> . <a name="habracut"></a>  Grunds√§tzlich wird in diesen Artikeln die Verwendung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">des Dienstprogramms openssl erl√§utert</a> , die Befehlszeilenschnittstelle beschrieben und mit Dateien gearbeitet, in denen alles gespeichert ist: Schl√ºssel, Anforderungen, Zertifikate, einschlie√ülich des Stammverzeichnisses usw.  Wenn Sie jedoch ein auf OpenSSL basierendes Full-Scale-Zertifizierungszentrum (CA) entwickeln, m√∂chten Sie diese Vielzahl von Dateien nat√ºrlich entfernen und mit der Arbeit mit Datenbanken fortfahren sowie √ºber eine grafische Oberfl√§che f√ºr die Ausstellung und Verwaltung von Zertifikaten verf√ºgen.  Und wenn Sie sich an das Bundesgesetz vom 6. April 2011 erinnern.  Nr. 63- Bei elektronischen Signaturen muss die zust√§ndige Beh√∂rde die Anforderungen dieses Gesetzes sowie die Anforderungen f√ºr die Form eines qualifizierten Zertifikats f√ºr einen Schl√ºssel zur √úberpr√ºfung elektronischer Signaturen erf√ºllen, der vom Beschluss des f√∂deralen Sicherheitsdienstes Russlands vom 27. Dezember 2011 Nr. 795 genehmigt wurde. <br><br>  Normale B√ºrger haben den Eindruck, dass die UTs etwas Riesiges sind (nun, das Zentrum, fast wie das Missionskontrollzentrum). <br><br><img src="https://habrastorage.org/webt/b5/3v/g7/b53vg7cflxhkndwjyavz3ppfcuy.png" align="right" alt="Bild">  Aus Sicht der Verantwortlichkeit der CA - genau das ist es.  Immerhin sind die von der CA ausgestellten Zertifikate heute im Pass tats√§chlich gleich. <br><br>  Aus Sicht eines Programmierers ist nicht alles so be√§ngstigend.  So wurde das CAFL63-Zertifizierungszentrumsprojekt geboren.  Die Implementierung des CAFL63-Projekts basiert auf drei ‚ÄûS√§ulen‚Äú, n√§mlich OpenSSL, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SQLite3</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tcl / Tk</a> . <br><br>  Was ist eine Zertifizierungsstelle heute?  Zuallererst ist es das Registrierungszentrum, in dem Vertreter von juristischen Personen, Einzelpersonen und Einzelunternehmern Zertifikate mit einem Paket notwendiger Dokumente einholen, insbesondere zur Identifizierung der Identit√§t und Autorit√§t des Antragstellers.  Sie k√∂nnen mit vorgefertigten Anwendungen elektronisch geliefert werden.  Die CR pr√ºft die Dokumente, die Anfrage (ausgef√ºllte Daten, die Richtigkeit der elektronischen Signatur usw.) und wenn alles gut gegangen ist, nimmt sie die Anfrage an, genehmigt sie und sendet sie an das Certification Center (CA).  Das ist aber ideal.  In der Praxis sieht alles anders aus. <br><br>  B√ºrger, Organisationen ben√∂tigen ein Zertifikat (f√ºr den Zugriff auf das Portal der staatlichen Dienste, f√ºr die Steuerberichterstattung, f√ºr Gebote), aber sie wissen nicht, was es ist und was sie damit tun sollen.  Sie sind aufrichtig davon √ºberzeugt, dass die Zertifizierungsstelle eine elektronische Signatur wie ein Fax erh√§lt.  Aber das sind Probleme der Erleuchtung.  Daher kommen die Antragsteller zur Zentralverwaltung der Zentralverwaltung und legen Unterlagen vor.  Zusammen mit dem Mitarbeiter der Zentrale gehen sie an einen separaten Arbeitsplatz und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bereiten eine</a> Zertifikatsanforderung vor: <br><br><img src="https://habrastorage.org/webt/-i/ni/fr/-inifrinlnabszqrmm9w11vpz98.png"><br><br>  Wie bereits erw√§hnt, geht eine vorbereitete Anfrage f√ºr elektronische Medien bei der CR ein.  Woran muss sich der Antragsteller erinnern?  Nehmen Sie in erster Linie die Medien mit dem erstellten privaten Schl√ºssel auf! <br>  Eine genehmigte Anfrage f√ºr elektronische Medien wird an die Zertifizierungsstelle gesendet, wo auf ihrer Grundlage ein Zertifikat ausgestellt wird. <br><br>  Dies ist ein schematisches Diagramm der Arbeit der Zertifizierungsstelle.  Details werden unten klar.  Eine Bemerkung zur Vereinfachung der Demonstration: Das Dienstprogramm zum Vorbereiten einer Anforderung, CR und CA, werden zu einem Demonstrationskomplex zusammengefasst.  Es gibt jedoch keine Probleme mit der Funktionsvielfalt.  Am einfachsten ist es, an jedem Arbeitsplatz eine CAFL63-Instanz zu haben und nur die erforderlichen Funktionen zu verwenden. <br><br>  Als das Projekt in vollem Gange war, fiel mir das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SimpleCA-</a> Projekt auf.  Das Studium dieses Projekts hat bei der endg√ºltigen Implementierung von CAFL63 CA sehr geholfen. <br><br>  Der Quellcode des Dienstprogramms und seiner Distributionen f√ºr Linux- und MS Windows-Plattformen finden Sie hier <div class="spoiler">  <b class="spoiler_title">hier:</b> <div class="spoiler_text"><ul><li>  <a href="">Quellcode</a> </li><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div><br>  F√ºhren Sie also das Dienstprogramm CAFL63 aus, und die Startseite wird auf dem Bildschirm angezeigt: <br><br><img src="https://habrastorage.org/webt/ej/d4/6z/ejd46z3sdsymivi7ougryho9q-g.png"><br><br>  Wir beginnen die Arbeit mit dem Dr√ºcken der Taste "Datenbank erstellen".  Die CA-Datenbank wird mit plattform√ºbergreifendem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SQLite3</a> -DBMS erstellt.  Die CA-Datenbank enth√§lt mehrere Tabellen.  Die Haupttabelle mainDB enth√§lt nur einen Datensatz, in dem das Stammzertifikat, der mit einem Kennwort verschl√ºsselte private Schl√ºssel und die CA-Einstellungen gespeichert sind.  Es gibt zwei Tabellen, die sich auf Zertifikatanforderungen beziehen: aktuelle reqDB-Anforderungen und reqDBArc-Anforderungsarchiv.  F√ºr Zertifikate werden drei Tabellen erstellt: die Tabelle der neuen Zertifikate certDBNew, die Tabelle des Archivs der Zertifikate certDB und die Tabelle der widerrufenen Zertifikate certDBRev: <br><br><pre><code class="sql hljs">. . . certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDB( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> , nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, certPEM <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, notAfter <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, notBefore <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, dateRevoke <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, state <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDBRev( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDBNew( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> reqDB (ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, datereq <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, reqpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pkcs7 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> reqDBAr (ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, datereq <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, reqpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pkcs7 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> crlDB(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> autoincrement, signtype <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, issuer <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, publishdate <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, nextdate <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, crlpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} . . .</code> </pre> <br>  Alle Anforderungs- und Zertifikatstabellen verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Hashwert</a> (sha1) des √∂ffentlichen Schl√ºssels als Schl√ºssel (Prim√§rschl√ºssel).  Der Einfachheit halber wird der Hash-Wert aus dem Wert des √∂ffentlichen Schl√ºssels in Zukunft als CKAID (PKCS # 11-Terminologie) bezeichnet.  Dies erwies sich beispielsweise bei der Suche nach einem Zertifikat auf Anfrage als sehr praktisch oder umgekehrt.  In der Datenbank befindet sich eine weitere crlDB-Tabelle, in der Listen mit gesperrten Zertifikaten gespeichert sind. <br><br>  Der Wert des √∂ffentlichen Schl√ºssels wird sowohl in der Anforderung als auch im Zertifikat gespeichert.  Daher ist es vor dem Einf√ºgen in die Datenbank erforderlich, den √∂ffentlichen Schl√ºssel aus ihnen zu extrahieren und die CKAID zu berechnen.  Um den Wert des √∂ffentlichen Schl√ºssels zu extrahieren, ist es zweckm√§√üig, das pki-Paket (package require pki) zu verwenden, das Tools zum Arbeiten mit Zertifikaten und Anforderungen enth√§lt.  Dieses Paket ist jedoch nicht f√ºr die Verwendung mit russischer Kryptographie ausgelegt.  Schreiben Sie in diesem Zusammenhang basierend auf den im Paket pki enthaltenen Prozeduren parse_cert und parse_csr die Prozeduren parce_cert_gost und parse_csr_gost: <br><br><pre> <code class="plaintext hljs">... ## Convert Pubkey type to string set pubkey_type [::pki::_oid_number_to_name $pubkey_type] # Parse public key, based on type switch -- $pubkey_type { "rsaEncryption" { set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) ::asn::asnGetSequence pubkey pubkey_parts ::asn::asnGetBigInteger pubkey_parts ret(n) ::asn::asnGetBigInteger pubkey_parts ret(e) set ret(n) [::math::bignum::tostr $ret(n)] set ret(e) [::math::bignum::tostr $ret(e)] set ret(l) [expr {int([::pki::_bits $ret(n)] / 8.0000 + 0.5) * 8}] set ret(type) rsa } "1.2.643.2.2.19" - "1.2.643.7.1.1.1.1" - "1.2.643.7.1.1.1.2" { # gost2001, gost2012-256,gost2012-512 set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) set ret(type) $pubkey_type ::asn::asnGetSequence pubkey_algoid pubalgost #OID -  ::asn::asnGetObjectIdentifier pubalgost oid1 #OID -   ::asn::asnGetObjectIdentifier pubalgost oid2 } default { error "Unknown algorithm" } } ...</code> </pre> <br>  Im Gegensatz zu den "nativen" Prozeduren k√∂nnen Sie mit Objekten nicht nur im PEM-Format, sondern auch im DER-Format arbeiten.  Um mit Sperrlisten f√ºr CRL-Zertifikate zu arbeiten, wurde die Prozedur parse_crl geschrieben.  Alle diese Prozeduren finden Sie im Quellcode, der in der Distribution gespeichert ist. <br><br>  Auch im pki-Paket gibt es keine russischen Oids, zum Beispiel TIN, SNILS usw.  Dieses Problem l√§sst sich leicht l√∂sen, indem dem Array :: pki :: oids russische oid-s hinzugef√ºgt werden: <br><br><pre> <code class="plaintext hljs">. . . set ::pki::oids(1.2.643.100.1) "OGRN" set ::pki::oids(1.2.643.100.5) "OGRNIP" set ::pki::oids(1.2.643.3.131.1.1) "INN" set ::pki::oids(1.2.643.100.3) "SNILS" #  set ::pki::oids(1.2.643.2.2.3) "  34.10-2001" set ::pki::oids(1.2.643.7.1.1.3.2) "  34.10-2012-256" set ::pki::oids(1.2.643.7.1.1.3.3) "  34.10-2012-512" . . .</code> </pre> <br>  Mit den Funktionen parse_cert_gost und parse_csr_gost werden die Werte von CKAID (Prim√§rschl√ºssel f√ºr die Datenbank) wie folgt berechnet: <br><br><pre> <code class="plaintext hljs">. . . array set b [parse_csr_gost $req] set pem $b(pem) set subject $b(subject) set pubkey $b(pubkey) set key1 [binary format H* $pubkey] set ckaID [::sha1::sha1 $key1] . . .</code> </pre> <br>  Klicken Sie also auf die Schaltfl√§che "Datenbank erstellen": <br><br><img src="https://habrastorage.org/webt/fj/uh/3q/fjuh3qvrwugzxspgjchbonu9is0.png"><br><br>  Die CA-Erstellung beginnt mit der Auswahl des Verzeichnisses, in dem die Datenbank- und Kennworteinstellungen f√ºr den Zugriff auf den privaten CA-Schl√ºssel gespeichert werden.  Das Dienstprogramm CAFL63 √ºberwacht die Kennwortl√§nge sorgf√§ltig: <br><br><img src="https://habrastorage.org/webt/dw/eb/hf/dwebhfn5hqfjh8bv3jge5jxllx8.png"><br><br>  Das Kennwort wird in der CA-Datenbank als Hash gespeichert: <br><br><pre> <code class="plaintext hljs">. . . set hash256 [::sha2::sha256 $wizData(capassword)] . . .</code> </pre> <br>  Nach dem Dr√ºcken der Taste "Trace" wird der Prozess zum Erstellen eines selbstsignierten Stammzertifikats der bereitgestellten Zertifizierungsstelle gestartet.  Im ersten Schritt dieses Prozesses werden Typ und Parameter des Schl√ºsselpaars ausgew√§hlt: <br><br><img src="https://habrastorage.org/webt/zr/e4/ag/zre4agh8ilw-tvjiy354y_o337c.png"><br><br>  Nachdem wir uns f√ºr das Schl√ºsselpaar f√ºr das Stammzertifikat des erstellten Zertifizierungszentrums entschieden haben, f√ºllen wir das Formular mit Informationen zum Eigent√ºmer aus (der erste Screenshot fehlt). <br><br>  Beachten Sie, dass das Dienstprogramm CAFL63 √ºber eine bestimmte ‚ÄûIntelligenz‚Äú verf√ºgt und daher nicht nur die Verf√ºgbarkeit von Daten in den Feldern kontrolliert, sondern auch die Richtigkeit (rote Markierung - falsch) beim Ausf√ºllen von Feldern wie TIN, PSRN, SNILS, PSRNIP, E-Mail-Adresse usw.: <br><br><img src="https://habrastorage.org/webt/4o/pt/vr/4optvrvc8o6gfd413eh5ggshby4.png"><br><br>  Nachdem Sie die Felder mit Informationen zum Eigent√ºmer der Zertifizierungsstelle ausgef√ºllt haben, wird angeboten, die Systemeinstellungen der Zertifizierungsstelle zu ermitteln: <br><br><img src="https://habrastorage.org/webt/it/wq/nc/itwqnccdburbtmsdybckzdqf1u8.png"><br><br>  Wenn Sie nicht mit russischer Kryptographie arbeiten, k√∂nnen Sie die √ºbliche OpenSSL verwenden.  Um mit russischer Kryptographie arbeiten zu k√∂nnen, m√ºssen Sie die entsprechende Version ausw√§hlen, eine Modifikation von OpenSSL.  Weitere Informationen finden Sie in der heruntergeladenen Distribution unter README.txt.  Da die Ausstellung qualifizierter Zertifikate geplant ist, m√ºssen auch Informationen zur Zertifizierung der Zertifizierungsstelle selbst und des von ihr verwendeten kryptografischen Informationsschutzsystems bereitgestellt werden (siehe ‚ÄûAnforderungen an das Formular f√ºr ein qualifiziertes Zertifikat eines Verifizierungsschl√ºssels f√ºr elektronische Signaturen‚Äú, genehmigt im Auftrag des Federal Security Service of Russia vom 27. Dezember 2011 Nr. 795). <br><br>  Nachdem Sie alle Felder korrekt ausgef√ºllt haben, wird erneut angeboten, ihre Richtigkeit zu √ºberpr√ºfen und auf die Schaltfl√§che ‚ÄûFertig stellen‚Äú zu klicken: <br><br><img src="https://habrastorage.org/webt/zo/pd/xf/zopdxfb8rtzcvoei5xuvpt7udqe.png"><br><br>  Nach dem Klicken auf die Schaltfl√§che ‚ÄûFertig stellen‚Äú wird die CA-Datenbank erstellt, in der das CA-Stammzertifikat, der private Schl√ºssel und die Systemeinstellungen gespeichert werden, und die Startseite des CAFL63-Dienstprogramms wird erneut auf dem Bildschirm angezeigt.  Nachdem wir die Datenbank der neu erstellten Zertifizierungsstelle erstellt haben, klicken wir auf die Schaltfl√§che "DB √∂ffnen", w√§hlen das Verzeichnis mit der Datenbank aus, gehen zum Hauptarbeitsfenster der Zertifizierungsstelle und klicken auf die Schaltfl√§che "CA-Zertifizierungsstelle anzeigen". Stellen Sie sicher, dass das von uns erstellte Stammzertifikat vorhanden ist :: <br><br><img src="https://habrastorage.org/webt/c-/x_/3r/c-x_3r8rrexuvvbov7ayzay6pze.png"><br><br>  Der n√§chste Schritt besteht darin, Anwendungsvorlagen / -profile f√ºr juristische Personen, Einzelpersonen und einzelne Unternehmer zu <b><i>erstellen</i></b> ( <b><i>Tools-&gt; Einstellungen-&gt; Zertifikatstypen-&gt; Neu</i></b> ): <br><br><img src="https://habrastorage.org/webt/hw/-o/ml/hw-omloedtpyfgtfq1vex8h3mug.png"><br><br>  Nach Angabe des Namens des neuen Profils wird vorgeschlagen, dessen Zusammensetzung zu bestimmen: <br><br><img src="https://habrastorage.org/webt/bf/yc/g_/bfycg_oxromnvlpisghe64bbuwe.png"><br><br>  Die Zusammensetzung des Profils wird durch den definierten Namen (eindeutiger / eindeutiger Name des Zertifikatsinhabers) bestimmt.  Jedes Profil hat seine eigene Zusammensetzung mit erforderlichen (erforderlichen) oder nicht erforderlichen Feldern / Oids.  Die Zusammensetzung des Profils f√ºr juristische Personen, Einzelpersonen und Einzelunternehmer richtet sich nach den Anforderungen des Bundesgesetzes 63 und dem FSB "Anforderungen an das qualifizierte Zertifikat eines Schl√ºsselzertifikats zur √úberpr√ºfung der elektronischen Signatur" in Russland. <br><br>  Nach der Erstellung der Profile ist die Zertifizierungsstelle bereit, Bewerber und Bewerbungen von ihnen entgegenzunehmen.  Wie oben erw√§hnt, kann der Antragsteller mit oder ohne einen fertigen Antrag auf ein Zertifikat kommen. <br>  Wenn der Antragsteller einen fertigen Antrag eingereicht hat, wird der Antrag nach Pr√ºfung seiner Unterlagen in die Datenbank der Zertifizierungsstelle importiert.  W√§hlen Sie dazu im Hauptarbeitsfenster die Registerkarte ‚ÄûAnforderungen f√ºr Zertifikate‚Äú, klicken Sie auf die Schaltfl√§che ‚ÄûImportanforderung / CSR‚Äú und w√§hlen Sie die Datei mit der Anforderung aus.  Danach erscheint ein Fenster mit Informationen zur Anfrage: <br><br><img src="https://habrastorage.org/webt/rd/dz/ry/rddzryagss1nr3eodjcs08bwero.png"><br><br>  Nachdem Sie die Anforderung √ºberpr√ºft und sichergestellt haben, dass sie korrekt ausgef√ºllt ist, k√∂nnen Sie auf die Schaltfl√§che ‚ÄûImportieren‚Äú klicken, um sie in die Datenbank einzugeben.  Sofort stellen wir fest, dass beim erneuten Versuch, eine Anforderung in der Datenbank der Zertifizierungsstelle erneut zu stellen, eine Meldung angezeigt wird: <br><br><img src="https://habrastorage.org/webt/ih/dy/q_/ihdyq_rplawbuh56jkw2czs8cto.png"><br><br>  Anforderungen an die CA-Datenbank werden entweder als "Gebietsschema" markiert, das im CA-Registrierungscenter erstellt wurde, oder als "Import", das vom Antragsteller selbst erstellt wurde, und der Zeitpunkt des Eingangs des Antrags in der CA wird ebenfalls aufgezeichnet.  Dies kann bei der L√∂sung von Konfliktsituationen hilfreich sein.  Daher sollten Sie beim Importieren einer Zertifikatanforderung angeben, wer die Anforderung erstellt hat (siehe Screenshot). <br>  Die importierte Anwendung befindet sich in der CA-Datenbank und wird im Hauptfenster auf der Registerkarte "Zertifikatanforderungen" angezeigt.  Die empfangenen Anforderungen befinden sich in der Phase "Pr√ºfung" (in der Spalte "Status" der Registerkarten "Zertifikatsanforderungen" und "Anforderungsarchiv").  F√ºr jede neu empfangene Anfrage muss eine Entscheidung getroffen werden (Dropdown-Men√º, wenn Sie mit der rechten Maustaste auf die ausgew√§hlte Anfrage klicken): <br><br><img src="https://habrastorage.org/webt/2e/08/l1/2e08l1p6pmp0ebvd_l1yi1b7aiy.png"><br><br>  Jeder Antrag muss entweder abgelehnt oder genehmigt werden: <br><br><img src="https://habrastorage.org/webt/hx/al/pt/hxalptjfajymsui_5xmtpxqnemc.png"><br><br>  Wenn die Anforderung abgelehnt wird, wird sie aus der Tabelle der aktuellen reqDB-Anforderungen in die Tabelle des reqDBArc-Anforderungsarchivs verschoben und verschwindet dementsprechend auf der Registerkarte "Zertifikatanforderungen" und wird auf der Registerkarte "Anforderungsarchiv" angezeigt. <br><br>  Der genehmigte Antrag verbleibt in der Tabelle reqDB und auf der Registerkarte ‚ÄûZertifikatanforderungen‚Äú, bis das Zertifikat ausgestellt wird, und landet dann auch im Archiv. <br><br>  Vor der Ausstellung des Zertifikats muss mit dem Antragsteller gekl√§rt werden, f√ºr welche Zwecke (z. B. f√ºr den Zugriff auf das State Services-Portal) das Zertifikat verwendet wird ( <b><i>Tools-&gt; Einstellungen-&gt; Zertifikatstypen -&gt; Individuell -&gt; Bearbeiten -&gt; Schl√ºsselnutzung</i></b> ): <br><br><img src="https://habrastorage.org/webt/2p/kt/jm/2pktjm2nczklrb2mime0exznj7u.png"><br><br>  Um ein Zertifikat auszustellen, m√ºssen Sie die genehmigte Anwendung auf der Registerkarte "Anforderung von Zertifikaten" ausw√§hlen, mit der rechten Maustaste klicken und im Dropdown-Men√º "Zertifikat ausstellen" ausw√§hlen.  Im angezeigten Widget m√ºssen Sie das Profil ausw√§hlen, dem das Profil der Anforderung / des Zertifikats entsprechen soll: <br><br><img src="https://habrastorage.org/webt/tl/b6/x0/tlb6x0l6lk9i8c01qnyvqma-4si.png"><br><br>  Beachten Sie, dass Sie bei der Ausstellung eines Zertifikats die Werte eines bestimmten Felds kl√§ren k√∂nnen: <br><br><img src="https://habrastorage.org/webt/v1/07/4k/v1074kdeoyswmznoaaxx-gi7pee.png"><br><br>  Das Verfahren zum Ausstellen eines Zertifikats selbst (Men√ºpunkt "Ausstellen eines Zertifikats") unterscheidet sich kaum von dem Verfahren zum Erstellen eines Stammzertifikats oder zum Ausstellen einer Anwendung: <br><br><img src="https://habrastorage.org/webt/xc/yk/ls/xcyklse8bwkvsqwwqfakk_o0dvu.png"><br><br>  Das ausgestellte Zertifikat wird sofort auf der Registerkarte Zertifikate angezeigt.  In diesem Fall f√§llt das Zertifikat selbst in die Tabelle certDBNew der CA-Datenbank und bleibt dort, bis es ver√∂ffentlicht wird.  Ein Zertifikat gilt als ver√∂ffentlicht, nachdem es in den SQL-Speicherauszug neuer Zertifikate exportiert wurde, der an einen √∂ffentlichen Dienst √ºbertragen wird.  Durch das Ver√∂ffentlichen eines Zertifikats wird es von der Tabelle certDBNew in die Tabelle certDB verschoben. <br><br>  Wenn Sie mit der rechten Maustaste auf die ausgew√§hlte Zeile auf der Registerkarte "Zertifikate" klicken, wird ein Men√º mit den folgenden Funktionen angezeigt: <br><br><img src="https://habrastorage.org/webt/pz/f1/yn/pzf1ynfqhicu8ferbge-gtgyc9i.png"><br><br>  Mit diesen Funktionen k√∂nnen Sie sowohl das Zertifikat selbst als auch die Anforderung anzeigen, auf deren Grundlage es ausgestellt wurde.  Sie k√∂nnen das Zertifikat auch in eine Datei oder auf das Flash-Laufwerk eines Bewerbers exportieren.  Die wichtigste Funktion hierbei ist die Zertifikatsperrfunktion!  Es gibt eine so exotische Funktion wie das Exportieren eines Zertifikats in einen sicheren PKCS # 12-Container.  Es wird verwendet, wenn der Antragsteller einen solchen Container erhalten m√∂chte.  F√ºr solche Antragsteller wird speziell eine Anforderungsgenerierungsfunktion zum Speichern des privaten Schl√ºssels in einer Datei bereitgestellt (Schaltfl√§che "Anforderung / CSR erstellen" auf der Registerkarte "Zertifikatanforderungen"). <br><br>  Also begann die CA ihr Leben und stellte das erste Zertifikat aus.  Eines der Ziele der Zertifizierungsstelle ist die Organisation des freien Zugangs zu ausgestellten Zertifikaten.  Die Ver√∂ffentlichung von Zertifikaten erfolgt normalerweise √ºber Webdienste.  CAFL63 hat auch diesen Service: <br><br><img src="https://habrastorage.org/webt/xt/a7/6w/xta76wp2bsjapckltfuqkl0pr2y.png"><br><br>  Um Zertifikate und Listen mit gesperrten Zertifikaten in einem √∂ffentlichen Dienst zu ver√∂ffentlichen, l√§dt die Zertifizierungsstelle die Zertifikate entweder vorab in Dateien <b><i>hoch</i></b> ( <b><i>Zertifikate-&gt; Zertifikate exportieren</i></b> ) oder erstellt einen SQL-Speicherauszug der gesamten Zertifikatstabelle, aus dem Sie eine Datenbank mit Zertifikaten erstellen und in diese hochladen k√∂nnen SQL-Speicherauszug neuer Zertifikate, aus denen sie der Datenbank f√ºr √∂ffentliche Dienste hinzugef√ºgt werden: <br><br><img src="https://habrastorage.org/webt/he/_d/1n/he_d1nxytwkmjwe-skvpzlzadig.png"><br><br>  Die grundlegende Funktion einer Zertifizierungsstelle besteht darin, eine Liste der widerrufenen Zertifikate zu ver√∂ffentlichen, √§hnlich wie es das Innenministerium in Bezug auf abgelaufene P√§sse tut.  Das Zertifikat kann auf Antrag des Eigent√ºmers widerrufen werden.  Der Hauptgrund f√ºr den Widerruf ist der Verlust des privaten Schl√ºssels oder der Vertrauensverlust. <br><br>  Um ein Zertifikat zu widerrufen, w√§hlen Sie es einfach auf der Registerkarte "Zertifikate" aus, klicken Sie mit der rechten Maustaste und w√§hlen Sie den Men√ºpunkt "Zertifikatssperrung": <br><br><img src="https://habrastorage.org/webt/ai/7p/hk/ai7phklvqrbu1a0z7yl-xi-5xxw.png"><br><br>  Das Widerrufsverfahren unterscheidet sich nicht vom Genehmigungsverfahren f√ºr eine Anfrage oder die Ausstellung eines Zertifikats.  Das widerrufene Zertifikat f√§llt in die Tabelle cerDBRev der CA-Datenbank und wird auf der Registerkarte "Widerrufene Zertifikate" angezeigt. <br><br>  Die letzte Funktion der Zertifizierungsstelle - die Freigabe der CRL - bleibt eine Liste der widerrufenen Zertifikate.  Die CRL-Liste wird auf der Registerkarte "Widerrufene Zertifikate" erstellt, wenn Sie auf die Schaltfl√§che "SOS / CRL erstellen" klicken.  Der Administrator muss lediglich das CA-Kennwort eingeben und Ihre Absicht best√§tigen, die CRL auszustellen: <br><br><img src="https://habrastorage.org/webt/5t/db/_c/5tdb_csh_qehcmmlaws9t75pssc.png"><br><br>  Die ausgegebene CRL f√§llt in die crlDB-Tabelle der Datenbank und wird auf der Registerkarte CRL / SOS angezeigt. <br><br>  Um die CRL vor dem Einf√ºgen in die Datenbank zu analysieren, wurde die Prozedur parse_crl geschrieben: <br><br><pre> <code class="plaintext hljs">proc parse_crl {crl} { array set ret [list] if { [string range $crl 0 9 ] == "-----BEGIN" } { array set parsed_crl [::pki::_parse_pem $crl "-----BEGIN X509 CRL-----" "-----END X509 CRL-----"] set crl $parsed_crl(data) } ::asn::asnGetSequence crl crl_seq ::asn::asnGetSequence crl_seq crl_base ::asn::asnGetSequence crl_base crl_full ::asn::asnGetObjectIdentifier crl_full ret(signtype) #puts "KEY_TYPE=$ret(signtype)" ::::asn::asnGetSequence crl_base crl_issue set ret(issue) [::pki::x509::_dn_to_string $crl_issue] #puts "ISSUE=$ret(issue)" ::asn::asnGetUTCTime crl_base ret(publishDate) ::asn::asnGetUTCTime crl_base ret(nextDate) #puts "publishDate=$ret(publishDate)" return [array get ret] }</code> </pre> <br>  Um die CRL anzuzeigen oder zur Ver√∂ffentlichung in einem √∂ffentlichen Dienst zu exportieren, m√ºssen Sie wie immer die gew√ºnschte Zeile ausw√§hlen, mit der rechten Maustaste klicken und den entsprechenden Men√ºpunkt ausw√§hlen: <br><br><img src="https://habrastorage.org/webt/np/c7/f2/npc7f2i1qb_rvyreerzj6wrbjgc.png"><br><br>  Das ist alles, die Zertifizierungsstelle ist bereit. <br><img src="https://habrastorage.org/webt/q1/i1/vs/q1i1vspugm4raux1pq5chgyysd4.png" align="left" alt="Bild">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier erfahren Sie,</a> wie Sie OpenSSL zusammenstellen und mit der russischen Kryptografie verbinden k√∂nnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413493/">https://habr.com/ru/post/de413493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413481/index.html">Exportieren Sie den Testbaum von JMeter in Text</a></li>
<li><a href="../de413485/index.html">GitLab 10.8 ver√∂ffentlicht: Open-Source-Push-Spiegelung und inkrementelle Bereitstellung</a></li>
<li><a href="../de413487/index.html">Was sollte ein Entwickler im Finanzbereich erwarten: Arbeitsbedingungen, Projekte und notwendige F√§higkeiten</a></li>
<li><a href="../de413489/index.html">Wie man einen wirklich sicheren Messenger ausw√§hlt und was die Blockchain damit zu tun hat</a></li>
<li><a href="../de413491/index.html">Food Design Digest, Mai 2018</a></li>
<li><a href="../de413495/index.html">Schnelle Bereitstellung oder Bereitstellung des Frontends in 15 Minuten</a></li>
<li><a href="../de413499/index.html">Er√∂ffnung eines gemeinsamen Masterstudiengangs bei JetBrains und ITMO</a></li>
<li><a href="../de413501/index.html">Das mit React verbrachte Jahr: Schlussfolgerungen und Empfehlungen</a></li>
<li><a href="../de413503/index.html">Patche mich, wenn du kannst: wie wir die Produktion debuggen. Teil 1</a></li>
<li><a href="../de413505/index.html">2 Freikarten f√ºr den In-Memory Computing Summit Europe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>