<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§“ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ¨ PHP untuk pemula. Sesi ğŸ¤›ğŸ» ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ•—</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Semoga harimu menyenangkan. Ini adalah artikel pertama dalam seri PHP untuk pengembang pemula. Ini akan menjadi serangkaian artikel yang tidak biasa, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP untuk pemula. Sesi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437972/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0a/389/8cf/c0a3898cf539ad6a3dc7ffb833d9715d.png" alt="ElePHPant. PHP untuk pemula. Sesi"></div><br>  Semoga harimu menyenangkan.  Ini adalah artikel pertama dalam seri PHP untuk pengembang pemula.  Ini akan menjadi serangkaian artikel yang tidak biasa, tidak akan ada <code>echo "Hello World"</code> , akan ada hardcore dari kehidupan programmer PHP dengan campuran kecil dari "pekerjaan rumah" untuk mengkonsolidasikan materi. <br><br>  Saya akan mulai dengan sesi - ini adalah salah satu komponen terpenting yang harus Anda kerjakan.  Tidak memahami prinsip kerjanya - berbisnis.  Jadi untuk menghindari masalah, saya akan mencoba berbicara tentang semua kemungkinan nuansa. <br><a name="habracut"></a><br>  Tetapi sebagai permulaan, untuk memahami mengapa kita perlu sesi, kita beralih ke asal-usul - ke protokol HTTP. <br><br><h3>  Protokol HTTP </h3><br>  Protokol HTTP adalah HyperText Transfer Protocol - "Hypertext Transfer Protocol" - yaitu.  sebenarnya - protokol teks, dan memahaminya tidak sulit. <br><blockquote>  Awalnya, dipahami bahwa di bawah protokol ini hanya HTML yang akan dikirimkan, alamat dan nama, tetapi sekarang mereka tidak akan mengirim dan = ^. ^ = Dan ï¼ˆâ€¢ _ ã…… _ â€¢ï¼‰ </blockquote><br>  Agar tidak bertele-tele, izinkan saya memberi Anda contoh komunikasi melalui protokol HTTP. <br>  Berikut adalah contoh permintaan bagaimana browser Anda mengirimkannya ketika Anda meminta halaman <code>http://example.com</code> : <br><br><pre> <code class="plaintext hljs">GET / HTTP/1.1 Host: example.com Accept: text/html &lt; &gt;</code> </pre> <br>  Dan berikut ini contoh responsnya: <br><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Length: 1983 Content-Type: text/html; charset=utf-8 &lt;html&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt;...&lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Ini adalah contoh yang sangat disederhanakan, tetapi bahkan di sini Anda dapat melihat apa yang terdiri dari permintaan dan respons HTTP: <br><br><ol><li>  <strong>garis start</strong> - untuk permintaan berisi metode dan jalur halaman yang diminta, untuk respons - versi protokol dan kode respons </li><li>  <strong>header</strong> - memiliki format nilai kunci yang dipisahkan oleh titik dua, setiap heading baru ditulis dari baris baru </li><li>  <strong>isi pesan</strong> - baik secara langsung HTML atau data dipisahkan dari header dengan dua jeda baris, mungkin tidak ada, seperti dalam permintaan di atas </li></ol><br>  Jadi, kami menemukan protokolnya - itu sederhana, protokol ini telah memimpin sejarahnya sejak tahun 1992, jadi Anda tidak akan menamakannya ideal, tetapi apa itu - kirim permintaan - dapatkan jawaban, dan hanya itu, server dan klien tidak lagi terhubung.  Tetapi skenario seperti itu tidak berarti satu-satunya yang mungkin, kita dapat memiliki otorisasi, server harus entah bagaimana memahami bahwa permintaan ini berasal dari pengguna tertentu, yaitu  klien dan server harus berkomunikasi dalam sesi tertentu.  Dan ya, mekanisme berikut diciptakan untuk ini: <br><br><ol><li>  Ketika pengguna mengotorisasi, server menghasilkan dan mengingat kunci unik - pengidentifikasi sesi, dan melaporkannya ke browser </li><li>  Browser menyimpan kunci ini, dan dengan setiap permintaan berikutnya, ia mengirim </li></ol><br>  Untuk menerapkan mekanisme ini, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cookie</a> dibuat (cookie, cookie) - file teks sederhana di komputer Anda, berdasarkan file untuk setiap domain (meskipun beberapa browser lebih maju dan menggunakan database SQLite untuk menyimpan), sementara browser memaksakan batasan jumlah catatan dan ukuran data yang disimpan (untuk sebagian besar browser ini adalah 4096 byte, lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RFC 2109</a> dari 1997) <br><blockquote>  Yaitu  Jika Anda mencuri cookie dari browser Anda, dapatkah Anda pergi ke halaman Facebook Anda atas nama Anda?  Jangan khawatir, ini tidak dapat dilakukan, setidaknya dengan facebook, dan kemudian saya akan menunjukkan kepada Anda salah satu cara yang mungkin untuk melindungi dari jenis serangan terhadap pengguna Anda. </blockquote><br>  Sekarang mari kita lihat bagaimana respons permintaan kita berubah, ada otorisasi: <br><br>  <b>Minta</b> <br><pre> <code class="plaintext hljs">POST /login/ HTTP/1.1 Host: example.com Accept: text/html login=Username&amp;password=Userpass</code> </pre> <br><br>  Metode kami telah berubah menjadi POST, dan login dan kata sandi dikirimkan dalam tubuh permintaan.  Jika Anda menggunakan metode GET, string kueri akan berisi nama pengguna dan kata sandi, yang tidak terlalu benar dari sudut pandang ideologis, dan memiliki sejumlah efek samping dalam bentuk pencatatan (misalnya, dalam <code>access.log</code> sama) dan caching kata sandi dalam bentuk yang jelas. <br><br>  <b>Tanggapan</b> <br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Type: text/html; charset=utf-8 Set-Cookie: KEY=VerySecretUniqueKey &lt;html&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt;...&lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Respons server akan berisi tajuk <code>Set-Cookie: KEY=VerySecretUniqueKey</code> , yang akan memaksa browser untuk menyimpan data ini dalam cookie, dan saat berikutnya mengakses server, itu akan dikirim dan dikenali oleh server: <br><br>  <b>Minta</b> <br><pre> <code class="plaintext hljs">GET / HTTP/1.1 Host: example.com Accept: text/html Cookie: KEY=VerySecretUniqueKey &lt; &gt;</code> </pre> <br><blockquote>  Seperti yang Anda lihat, tajuk yang dikirim oleh browser (Tajuk Permintaan) dan server (Tajuk Respons) berbeda, meskipun ada kesamaan untuk permintaan dan respons (Tajuk Umum) </blockquote><br>  Server mengenali pengguna kami dengan cookie yang dikirim dan selanjutnya akan memberinya akses ke informasi pribadi.  Jadi, well, semacam sesi dan HTTP yang diurutkan, sekarang Anda dapat kembali ke PHP dan fitur-fiturnya. <br><br><h3>  PHP dan sesi </h3><br><blockquote>  Saya harap Anda sudah menginstal PHP di komputer Anda, sebagai  Selanjutnya saya akan memberikan contoh, dan mereka harus dijalankan </blockquote><br>  Bahasa PHP dibuat agar sesuai dengan protokol HTTP - yaitu  Tugas utamanya adalah untuk memberikan jawaban atas permintaan HTTP dan untuk "mati" membebaskan memori dan sumber daya.  Oleh karena itu, mekanisme sesi tidak berfungsi dalam PHP dalam mode otomatis, tetapi dalam mode manual, dan Anda perlu tahu apa yang harus dipanggil, dan dalam urutan apa. <br><blockquote>  Di sini Anda memiliki artikel tentang topik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">yang dimaksudkan untuk mati PHP</a> , atau di sini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dalam bahasa Rusia</a> , tetapi lebih baik untuk meletakkannya di bookmark "untuk nanti". </blockquote><br>  Pertama-tama, Anda perlu "memulai" sesi - untuk ini kami menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_start ()</a> , membuat file <em>session.start.php</em> dengan konten berikut: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> session_start();</code> </pre> <br>  Jalankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">server web</a> PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bawaan</a> di folder dengan skrip Anda: <br><br><pre> <code class="bash hljs">php -S 127.0.0.1:8080</code> </pre> <br>  Buka browser dan buka Alat Pengembang (atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">apa pun</a> ), lalu buka halaman <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://127.0.0.1:8080/session.start.php</a> - Anda seharusnya hanya melihat halaman kosong, tetapi jangan buru-buru menutup - lihat ke tajuk yang dikirimkan server kepada kami: <br><br> <a href="" rel="attachment"><img src="https://habrastorage.org/getpro/habr/post_images/3e8/b2d/145/3e8b2d145c8f29ce0fe30664dcc36119.png" alt="Cookie" width="460" height="222"></a> <br><br>  Akan ada banyak hal, kami hanya tertarik pada baris ini dalam respons server (cookie bersih, jika tidak ada baris seperti itu, dan segarkan halaman): <br><br><pre> <code class="plaintext hljs">Set-Cookie: PHPSESSID=dap83arr6r3b56e0q7t5i0qf91; path=/</code> </pre> <br>  Setelah melihat ini, browser akan menyimpan cookie bernama `PHPSESSID`: <br><br> <a href="" rel="attachment wp-att-2816"><img src="https://habrastorage.org/getpro/habr/post_images/f06/d02/09e/f06d0209e68ccac4b99570758c23a2ad.png" alt="Cookie sesi browser" width="460" height="410"></a> <br><br><blockquote>  <code>PHPSESSID</code> - nama sesi default, itu disesuaikan dari konfigurasi php.ini dengan direktif <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.name</a> , jika perlu, nama dapat diubah dalam file konfigurasi itu sendiri atau menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_name ()</a> fungsi </blockquote><br>  Dan sekarang - kita me-refresh halaman, dan kita melihat bahwa browser mengirimkan cookie ini ke server, Anda dapat mencoba me-refresh halaman beberapa kali, hasilnya akan sama: <br><br> <a href="" rel="attachment wp-att-2817"><img src="https://habrastorage.org/getpro/habr/post_images/272/4e6/001/2724e60013b929e3e9e7f1bfa9212ef1.png" alt="Permintaan browser dengan cookie" width="460" height="87"></a> <br><br>  Total yang kita miliki - teorinya bertepatan dengan praktik, dan ini baik-baik saja. <br><br>  Langkah selanjutnya adalah menyimpan nilai arbitrer ke dalam sesi, untuk ini, variabel super global <code>$_SESSION</code> digunakan dalam PHP, kami akan menghemat waktu saat ini - untuk melakukan ini, panggil fungsi <a href="">date ()</a> : <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br>  Kami menyegarkan halaman dan melihat waktu server, memperbarui lagi - dan waktu telah diperbarui.  Sekarang mari kita pastikan bahwa waktu yang diset tidak berubah dengan setiap penyegaran halaman: <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>])) { $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br>  Kami memperbarui - waktu tidak berubah, apa yang dibutuhkan.  Tetapi pada saat yang sama, kita ingat bahwa PHP sedang sekarat, yang berarti ia menyimpan sesi ini di suatu tempat, dan kita akan menemukan tempat ini ... <br><br><h3>  Segalanya rahasia menjadi jelas </h3><br>  Secara default, PHP menyimpan sesi dalam file - direktif <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.save_handler</a> bertanggung jawab untuk ini, mencari path tempat file disimpan dalam direktif <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.save_path</a> , atau menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_save_path ()</a> untuk mendapatkan path yang diperlukan. <br><blockquote>  Dalam konfigurasi Anda, jalur ke file mungkin tidak ditentukan, maka file sesi akan disimpan dalam file sementara sistem Anda - panggil fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sys_get_temp_dir ()</a> dan cari tahu di mana tempat tersembunyi ini. </blockquote><br>  Jadi, kami menyusuri jalur ini dan menemukan file sesi Anda (saya punya file ini <code>sess_dap83arr6r3b56e0q7t5i0qf91</code> ), buka di editor teks: <br><br><pre> <code class="bash hljs">time|s:8:<span class="hljs-string"><span class="hljs-string">"16:19:51"</span></span>;</code> </pre> <br>  Seperti yang Anda lihat, ini saatnya kita, ini adalah format rumit sesi kita, tetapi kita dapat membuat perubahan, mengubah waktu, atau kita cukup memasukkan baris apa saja, mengapa tidak: <br><br><pre> <code class="bash hljs">time|s:13:<span class="hljs-string"><span class="hljs-string">"\m/ (@.@) \m/"</span></span>;</code> </pre> <br>  Untuk mengonversi string ini menjadi array, Anda perlu menggunakan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_decode ()</a> , untuk konversi balik - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_encode ()</a> - ini disebut serialisasi, hanya dalam PHP untuk sesi - ini sendiri - khusus, meskipun Anda dapat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">serialisasi PHP</a> standar - tulis dalam direktif konfigurasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sesi</a> - tulis dalam direktif konfigurasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sesi</a> Nilai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">.serialize_handler</a> adalah <code>php_serialize</code> dan Anda akan bahagia, dan <code>$_SESSION</code> dapat digunakan tanpa batasan - sekarang Anda dapat menggunakan angka dan karakter khusus sebagai indeks <code>|</code>  dan <code>!</code>  dalam nama (untuk semua 10+ tahun kerja, saya tidak pernah harus :) <br><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Tulis fungsi Anda, mirip fungsinya dengan <code>session_decode()</code> , di sini Anda memiliki kumpulan data uji untuk sesi (tidak diperlukan untuk menyelesaikan pengetahuan tentang ekspresi reguler), ambil teks untuk konversi dari file sesi Anda saat ini: <br><br><pre> <code class="php hljs">$_SESSION[<span class="hljs-string"><span class="hljs-string">'integer var'</span></span>] = <span class="hljs-number"><span class="hljs-number">123</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'float var'</span></span>] = <span class="hljs-number"><span class="hljs-number">1.23</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'octal var'</span></span>] = <span class="hljs-number"><span class="hljs-number">0x123</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'string var'</span></span>] = <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'array var'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'one'</span></span>, <span class="hljs-string"><span class="hljs-string">'two'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]); $object = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> stdClass(); $object-&gt;foo = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>; $object-&gt;arr = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>); $_SESSION[<span class="hljs-string"><span class="hljs-string">'object var'</span></span>] = $object; $_SESSION[<span class="hljs-string"><span class="hljs-string">'integer again'</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br></div></div><br>  Jadi apa yang belum kita coba?  Itu benar - untuk mencuri cookie, mari kita luncurkan browser lain dan tambahkan cookie yang sama ke dalamnya.  Untuk ini saya menulis javascript sederhana untuk Anda, salin ke konsol browser dan jalankan, ingatlah untuk mengubah pengidentifikasi sesi ke Anda sendiri: <br><br><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie=<span class="hljs-string"><span class="hljs-string">'PHPSESSID=dap83arr6r3b56e0q7t5i0qf91;path=/;'</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.reload();})()</code> </pre> <br>  Sekarang kedua browser Anda sedang melihat sesi yang sama.  Saya sebutkan di atas bahwa saya akan berbicara tentang metode perlindungan, pertimbangkan cara paling sederhana - kami akan mengikat sesi ke browser, lebih tepatnya, dengan bagaimana browser muncul ke server - kami akan mengingat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">User-Agent</a> dan memeriksanya setiap saat: <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>])) { $_SESSION[<span class="hljs-string"><span class="hljs-string">'ua'</span></span>] = $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]; $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_SESSION[<span class="hljs-string"><span class="hljs-string">'ua'</span></span>] != $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Wrong browser'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br>  Lebih sulit untuk dipalsukan, tetapi masih mungkin, tambahkan tabungan dan periksa <code>$_SERVER['REMOTE_ADDR']</code> dan <code>$_SERVER['HTTP_X_FORWARDED_FOR']</code> , dan ini akan lebih seperti perlindungan terhadap penyusup yang menyusup ke cookie kami. <br><br><blockquote>  Kata kunci dalam paragraf sebelumnya <b>sepertinya</b> cookie telah berjalan di atas protokol HTTPS dalam proyek nyata untuk waktu yang lama, jadi tidak ada yang bisa mencurinya tanpa akses fisik ke komputer atau smartphone Anda </blockquote><br><br>  Perlu disebutkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=http://php.net/session.configuration.php&amp;usg=ALkJrhhqWeybVGmbfajOId5wbTZgn_xUeg#ini.session.cookie-">direktif session.cookie-httponly</a> , berkat itu cookie sesi tidak dapat diakses dari JavaScript.  Selain itu, jika Anda melihat manual fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">setcookie ()</a> , Anda akan melihat bahwa parameter terakhir juga bertanggung jawab untuk HttpOnly.  Ingat ini - pengaturan ini memungkinkan Anda untuk secara efektif menangani serangan XSS di hampir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">semua browser</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Tambahkan cek ke IP pengguna dalam kode, jika cek gagal, hapus sesi yang dikompromikan. <br></div></div><br><h3>  Langkah demi langkah </h3><br>  Dan sekarang saya akan menjelaskan dalam langkah-langkah algoritma bagaimana sesi bekerja di PHP, menggunakan kode berikut sebagai contoh (pengaturan default): <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br><ol><li>  setelah memanggil <code>session_start()</code> PHP mencari cookie untuk pengidentifikasi sesi dengan nama yang ditentukan dalam <code>session.name</code> - ini adalah <code>PHPSESSID</code> </li><li>  jika tidak ada pengenal, maka itu dibuat (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_id ()</a> ), dan membuat file sesi kosong di sepanjang <code>session.save_path</code> <code>sess_{session_id()}</code> dengan nama <code>sess_{session_id()}</code> , header akan ditambahkan ke respons server, untuk mengatur cookie <code>{session_name()}={session_id()}</code> </li><li>  jika pengenal ada, maka cari file sesi di folder <code>session.save_path</code> : <br><ul><li>  kami tidak menemukannya - kami membuat file kosong dengan nama <code>sess_{$_COOKIE[session_name()]}</code> (pengidentifikasi hanya dapat berisi karakter dari rentang <code>az</code> , <code>AZ</code> , <code>0-9</code> , koma dan tanda minus) </li><li>  temukan, baca file, dan uraikan data (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_decode ()</a> ) ke variabel super global <code>$_SESSION</code> (file dikunci untuk membaca / menulis) </li></ul></li><li>  ketika skrip telah selesai bekerja, maka semua data dari <code>$_SESSION</code> dikemas menggunakan <code>session_encode()</code> ke dalam file di sepanjang path <code>session.save_path</code> bernama <code>sess_{session_id()}</code> (kunci dilepaskan) </li></ol><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Tetapkan nilai cookie sewenang-wenang di browser Anda dengan nama <code>PHPSESSID</code> , biarkan <code>1234567890</code> , segarkan halaman, periksa apakah Anda telah membuat file baru <code>sess_1234567890</code> <br></div></div><br><h3>  Apakah ada kehidupan tanpa cookie? </h3><br>  PHP dapat bekerja dengan sesi meskipun cookie dinonaktifkan di browser, tetapi kemudian semua URL di situs akan berisi parameter dengan pengidentifikasi sesi Anda, dan ya - apakah Anda masih perlu mengkonfigurasi ini, tetapi apakah Anda memerlukannya?  Saya tidak harus menggunakannya, tetapi jika saya benar-benar ingin, saya hanya akan mengatakan di mana untuk menggali: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.use_cookies</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.use_only_cookies</a> </li></ul><br><h3>  Dan jika Anda perlu menyimpan sesi dalam basis data? </h3><br>  Untuk menyimpan sesi dalam basis data, Anda perlu mengubah penyimpanan sesi dan memberi tahu PHP cara menggunakannya. Untuk tujuan ini, antarmuka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SessionHandlerInterface</a> dan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session_set_save_handler</a> telah dibuat. <br><blockquote>  Secara terpisah, saya perhatikan bahwa Anda tidak perlu menulis penangan sesi Anda sendiri untuk redis dan memcache - ketika Anda menginstal ekstensi ini, penangan yang sesuai juga ikut serta, jadi RTFM adalah segalanya.  Baiklah dan ya, pawang harus ditentukan sebelum memanggil <code>session_start()</code> ;) </blockquote><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Terapkan <code>SessionHandlerInterface</code> untuk menyimpan sesi di MySQL, periksa apakah itu berfungsi. <br>  Ini adalah tugas asterisk bagi mereka yang sudah terbiasa dengan database. <br></div></div><br><br><h3>  Kapan sesi ini mati? </h3><br>  Arahan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.gc_maxlifetime</a> bertanggung jawab atas masa pakai sesi.  Secara default, arahan ini sama dengan 1440 detik (24 menit), harus dipahami sehingga jika sesi belum diakses untuk waktu yang ditentukan, maka sesi akan dianggap "busuk" dan akan menunggu gilirannya untuk dihapus. <br><br>  Pertanyaan lain yang menarik, dapatkah Anda menanyakannya kepada pengembang yang sudah matang - kapan PHP menghapus file dari sesi yang kadaluwarsa?  Jawabannya ada di panduan resmi, tetapi tidak secara eksplisit - jadi ingat: <br><br>  Pengumpulan sampah dapat dimulai ketika fungsi <code>session_start()</code> dipanggil, probabilitas memulai tergantung pada dua arahan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.gc_probability</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">session.gc_divisor</a> , tindakan pertama sebagai dividen, tindakan kedua sebagai pembagi, dan secara default nilai-nilai ini adalah 1 dan 100, dll. e.  kemungkinan kolektor akan diluncurkan dan file sesi akan dihapus sekitar 1%. <br><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Ubah nilai direktif <code>session.gc_divisor</code> sehingga pengumpul sampah mulai setiap waktu, periksa apakah ini terjadi. <br></div></div><br><br><h3>  Kesalahan paling sepele </h3><br>  Kesalahan dengan lebih dari setengah juta hasil dalam hasil Google: <br><br><blockquote>  Tidak dapat mengirim cookie sesi - <strong>tajuk sudah dikirim</strong> oleh <br>  Tidak dapat mengirim pembatas cache sesi - <strong>tajuk sudah dikirim</strong> </blockquote><br>  Untuk memperolehnya, buat file <em>session.error.php</em> dengan konten berikut: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> str_pad(<span class="hljs-string"><span class="hljs-string">' '</span></span>, ini_get(<span class="hljs-string"><span class="hljs-string">'output_buffering'</span></span>)); session_start();</code> </pre> <br><blockquote>  Di baris kedua, "sihir" aneh adalah fokus dengan buffer output, saya akan membicarakannya di salah satu artikel berikut, sejauh ini menganggap ini hanya string dengan panjang 4.096 karakter, dalam hal ini semua spasi </blockquote><br>  Mulailah dengan menghapus cookie sebelumnya dan Anda akan mendapatkan kesalahan di atas, meskipun teks kesalahannya berbeda, tetapi intinya sama: kereta telah pergi - server telah mengirim konten halaman ke browser dan sudah terlambat untuk mengirim header, ini tidak akan berfungsi di cookie dan pengenal sesi yang disukai tidak muncul di cookie.  Jika Anda mengalami kesalahan ini - cari tempat di mana teks ditampilkan sebelumnya, mungkin ada spasi sebelum karakter <code>&lt;?php</code> , atau setelah <code>?&gt;</code> Dalam salah satu file yang terhubung, dan baik, jika itu adalah ruang, mungkin ada beberapa utas yang tidak dapat dicetak seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BOM</a> , jadi berhati-hatilah, dan infeksi ini tidak akan memengaruhi Anda (lagipula ... tawa homerik). <br><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Untuk menguji pengetahuan ini, saya ingin Anda menerapkan mekanisme sesi Anda sendiri dan membuat kode di atas berfungsi: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'include/sess.php'</span></span>; sess_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>; }</code> </pre> <br><blockquote>  Untuk mengimplementasikan rencana Anda, Anda akan memerlukan fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">register_shutdown_function ()</a> </blockquote><br></div></div><br><br><h3>  Kunci </h3><br>  Kesalahan umum lainnya di antara pemula adalah upaya untuk membaca file sesi saat dikunci oleh skrip lain.  Sebenarnya, ini bukan kesalahan, ini adalah kesalahpahaman tentang prinsip pemblokiran :) <br><br>  Tapi mari kita ambil langkah-langkahnya lagi: <br><br><ol><li>  <code>session_start()</code> tidak hanya membuat / membaca file, tetapi juga menguncinya sehingga tidak ada yang dapat membuat perubahan saat skrip dieksekusi, atau membaca data yang tidak konsisten dari file sesi </li><li>  kunci dilepaskan di akhir skrip </li></ol><br><br>  "Menempel" ke dalam kesalahan ini sangat mudah, buat dua file: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// start.php session_start(); echo "OK";</span></span></code> </pre><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// lock.php session_start(); sleep(10); echo "OK";</span></span></code> </pre><br><br>  Sekarang, jika Anda membuka halaman <code>lock.php</code> di browser, dan kemudian buka <code>start.php</code> di tab baru, Anda akan melihat bahwa halaman kedua hanya akan terbuka setelah skrip pertama dijalankan, yang memblokir file sesi selama 10 detik. <br><br>  Ada beberapa pilihan untuk menghindari fenomena seperti itu - "kikuk" dan "bijaksana". <br><br>  <b>"Kapak"</b> <br>  Gunakan pengendali sesi khusus untuk "lupa" menerapkan penguncian :) <br>  Opsi yang sedikit lebih baik adalah mengambil yang sudah jadi dan menonaktifkan kunci (misalnya, memcached memiliki opsi seperti itu - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memcached.sess_locking</a> ) O_o <br>  Luangkan berjam-jam kode debug untuk mencari kesalahan sembulan yang langka ... <br><br>  <b>"Bijaksana"</b> <br>  Di mana cara terbaik - untuk memantau sesi mengunci sendiri, dan menghapusnya ketika tidak diperlukan: <br><br>  - Jika Anda yakin tidak perlu melakukan perubahan pada data sesi, gunakan opsi <code>read_and_close</code> saat memulai sesi: <br><br><pre> <code class="php hljs">session_start([ <span class="hljs-string"><span class="hljs-string">'read_and_close'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ]);</code> </pre><br><br>  Dengan demikian, kunci akan dirilis segera setelah membaca data sesi. <br><br>  - Jika Anda masih perlu membuat perubahan pada sesi, maka setelah menutup sesi dari rekaman: <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-comment"><span class="hljs-comment">// some changes session_write_close();</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Tugas</b> <div class="spoiler_text">  Daftar dua file <code>lock.php</code> dan <code>lock.php</code> sedikit lebih tinggi. Buat lebih banyak <code>write-close.php</code> <code>read-close.php</code> dan <code>write-close.php</code> , di mana Anda akan mengontrol penguncian dengan cara yang tercantum.  Periksa cara kerja kunci (atau tidak berfungsi). <br></div></div><br><br><h3>  Kesimpulannya </h3><br>  Dalam artikel ini, Anda telah diberikan tujuh tugas, sementara itu tidak hanya bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sesi</a> , tetapi juga memperkenalkan Anda ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fungsi</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MySQL</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">string</a> .  Untuk asimilasi bahan ini - Anda tidak perlu artikel terpisah, cukup manual pada tautan yang disediakan cukup - tidak ada yang akan membacanya untuk Anda.  Lakukan itu! <br><br>  <b>PS</b> Jika Anda mempelajari sesuatu yang baru dari artikel - terima kasih penulis - bagikan artikel di jejaring sosial;) <br>  <b>PPS</b> Ya, ini adalah artikel lintas-posting dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">blog</a> saya, tetapi masih relevan :) <br><br>  <b>Serangkaian artikel "PHP untuk pemula":</b> <br><br><ul><li>  <b>Sesi</b> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Koneksi file</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id437972/">https://habr.com/ru/post/id437972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id437958/index.html">Otorisasi dalam ESIA pada server terminal dengan tanda tangan digital sesuai dengan GOST-2012</a></li>
<li><a href="../id437960/index.html">Saran dari direktur teknis perusahaan IT untuk mem-boot lulusan kamp</a></li>
<li><a href="../id437962/index.html">ROI PVS-Studio</a></li>
<li><a href="../id437964/index.html">Buku "Pembelajaran Mesin dan TensorFlow"</a></li>
<li><a href="../id437968/index.html">ROI PVS-Studio</a></li>
<li><a href="../id437974/index.html">Bagaimana cara memenangkan WorldSkills digital? Pada contoh praktis</a></li>
<li><a href="../id437976/index.html">"Vkontakte" diizinkan untuk menyembunyikan catatan individual dari polisi</a></li>
<li><a href="../id437978/index.html">Selamat datang di SuperJob SphinxSearch-meetup</a></li>
<li><a href="../id437980/index.html">Buka webinar â€œMetode Pengujian Berpasangan dalam Pengujian Kotak Hitamâ€</a></li>
<li><a href="../id437982/index.html">Serangan enkripsi baru Shade menargetkan pengguna bisnis Rusia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>