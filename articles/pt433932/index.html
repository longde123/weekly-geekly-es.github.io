<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôà ‚õπüèº üéø Atiramos no p√©, processando os dados de entrada ü•û üì™ üêÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O link no artigo de hoje √© diferente do habitual. Este n√£o √© um projeto para o qual o c√≥digo fonte foi analisado, mas uma s√©rie de respostas da mesma ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Atiramos no p√©, processando os dados de entrada</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/433932/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/jh/iw/l-/jhiwl-y02cm4bhppsrj9flbpqsi.png"></div><br>  O link no artigo de hoje √© diferente do habitual.  Este n√£o √© um projeto para o qual o c√≥digo fonte foi analisado, mas uma s√©rie de respostas da mesma regra de diagn√≥stico em v√°rios projetos diferentes.  Qual √© o interesse aqui?  O fato de que alguns dos fragmentos de c√≥digo considerados cont√™m erros que s√£o reproduz√≠veis ao trabalhar com o aplicativo, enquanto outros cont√™m completamente vulnerabilidades (CVE).  Al√©m disso, no final do artigo, discutiremos um pouco sobre o t√≥pico de defeitos de seguran√ßa. <br><a name="habracut"></a><br><h2>  Pref√°cio breve </h2><br>  Todos os erros que ser√£o considerados hoje no artigo t√™m um padr√£o semelhante: <br><br><ul><li>  o programa recebe dados do fluxo <i>stdin</i> ; </li><li>  √© feita uma verifica√ß√£o para o sucesso da leitura dos dados; </li><li>  se os dados foram lidos com √™xito, o caractere de transporte √© removido da linha. </li></ul><br>  No entanto, todos os fragmentos que ser√£o considerados cont√™m erros e s√£o vulner√°veis ‚Äã‚Äãa dados manipulados.  Como os dados s√£o recebidos do usu√°rio, que pode violar a l√≥gica de execu√ß√£o do aplicativo, houve uma grande tenta√ß√£o de tentar quebrar alguma coisa.  O que eu fiz. <br><br>  Todos os problemas abaixo foram descobertos pelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">analisador est√°tico PVS-Studio</a> , que procura erros no c√≥digo n√£o apenas para C, C ++, mas tamb√©m para C #, Java. <br><br>  Obviamente, √© bom encontrar um problema com um analisador est√°tico, mas encontrar e reproduzir √© um n√≠vel de prazer completamente diferente.  :) <br><br><h2>  Freeswitch </h2><br>  O primeiro fragmento de c√≥digo suspeito foi encontrado no c√≥digo do m√≥dulo <i>fs_cli.exe</i> , que faz parte do kit de distribui√ß√£o do FreeSWITCH: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">basic_gets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cnt)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = getchar(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fgets(command_buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(command_buf) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>) != command_buf) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } command_buf[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(command_buf)<span class="hljs-number"><span class="hljs-number">-1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* remove endline */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  <b>Aviso do PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V1010</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-20</a> Dados contaminados n√£o verificados s√£o usados ‚Äã‚Äãno √≠ndice: 'strlen (command_buf)'. <br><br>  O analisador avisa sobre uma chamada suspeita pelo √≠ndice para a matriz <i>command_buf</i> .  √â considerado suspeito pelo motivo pelo qual dados externos n√£o verificados s√£o usados ‚Äã‚Äãcomo um √≠ndice.  Externo - porque eles s√£o obtidos atrav√©s da fun√ß√£o <i>fgets</i> no fluxo <i>stdin</i> .  N√£o verificado - j√° que nenhuma verifica√ß√£o foi realizada antes do uso.  A express√£o <i>fgets (command_buf, ....)! = Command_buf</i> n√£o conta, pois dessa maneira verificamos apenas o fato de receber os dados, mas n√£o o conte√∫do. <br><br>  O problema com esse c√≥digo √© que, sob certas condi√ß√µes, '\ 0' ser√° gravado fora da matriz, o que levar√° a um comportamento indefinido.  Para fazer isso, basta inserir uma sequ√™ncia de comprimento zero (uma sequ√™ncia de comprimento zero do ponto de vista da linguagem C, ou seja, aquela na qual o primeiro caractere ser√° '\ 0'). <br><br>  Vamos estimar o que acontece se voc√™ passar uma string de comprimento zero para a entrada: <br><br><ul><li>  <i>fgets (command_buf, ....)</i> -&gt; <i>command_buf</i> ; </li><li>  <i>fgets (....)! = command_buf</i> -&gt; <i>false</i> ( <i>o</i> ramo da <i>instru√ß√£o if √©</i> ignorado); </li><li>  <i>strlen (command_buf)</i> -&gt; <i>0</i> ; </li><li>  <i>command_buf [strlen (command_buf) - 1]</i> -&gt; <i>command_buf [-1]</i> . </li></ul><br>  Opa! <br><br>  O interessante aqui √© que esse aviso do analisador pode ser "sentido com as m√£os".  Para repetir o problema, voc√™ precisa: <br><br><ul><li>  trazer o programa para esta fun√ß√£o; </li><li>  ajuste a entrada para que a chamada <i>getchar ()</i> retorne um valor negativo; </li><li>  passar para a fun√ß√£o <i>fgets</i> uma linha com um terminal zero no in√≠cio, que deve ser lido com sucesso. </li></ul><br>  Revirando um pouco a fonte, criei uma sequ√™ncia espec√≠fica para reproduzir o problema: <br><br><ul><li>  Execute <i>fs_cli.exe</i> no modo em lote ( <i>fs_cli.exe -b</i> ).  Observo que, para executar etapas adicionais, a conex√£o <i>fs_cli.exe</i> com o servidor deve ser bem-sucedida.  Para fazer isso, √© suficiente, por exemplo, executar o <i>FreeSwitchConsole.exe localmente</i> como administrador. </li><li>  Realizamos a entrada para que a chamada <i>getchar ()</i> retorne um valor negativo. </li><li>  Digite uma linha com um terminal zero no in√≠cio (por exemplo, '\ 0Oooops'). </li><li>  .... </li><li>  LUCRO! </li></ul><br>  A seguir est√° uma reprodu√ß√£o de v√≠deo do problema: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jSYJirPIK8E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Ncftp </h2><br>  Um problema semelhante foi descoberto no projeto NcFTP, mas ele j√° foi encontrado em dois locais.  Como o c√≥digo parece semelhante, considere apenas um lugar problem√°tico: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NcFTPConfirmResumeDownloadProc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fgets(newname, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(newname) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>) == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) newname[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; newname[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(newname) - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V1010</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-20</a> Dados contaminados n√£o verificados s√£o usados ‚Äã‚Äãno √≠ndice: 'strlen (newname)'. <br><br>  Aqui, diferentemente do exemplo do FreeSWITCH, o c√≥digo √© escrito pior e mais propenso a problemas.  Por exemplo, a escrita '\ 0' ocorre independentemente de a leitura ter sido bem-sucedida usando <i>fgets</i> ou n√£o.  Ou seja, existem ainda mais possibilidades de como quebrar a l√≥gica normal de execu√ß√£o.  Vamos de maneira comprovada - atrav√©s de linhas de comprimento zero. <br><br>  O problema reproduzido √© um pouco mais complicado do que com o FreeSWITCH.  A sequ√™ncia das etapas √© descrita abaixo: <br><br><ul><li>  iniciando e conectando-se ao servidor a partir do qual voc√™ pode baixar o arquivo.  Por exemplo, usei <i>speedtest.tele2.net</i> (no final, o comando de inicializa√ß√£o do aplicativo se parece com: <i>ncftp.exe <a href="">speedtest.tele2.net</a></i> ); </li><li>  baixar um arquivo do servidor.  Localmente, um arquivo com o mesmo nome, mas com propriedades diferentes, j√° deve existir.  Voc√™ pode, por exemplo, baixar um arquivo do servidor, alter√°-lo e tentar executar o comando de download novamente (por exemplo, <i>obtenha 512KB.zip</i> ); </li><li>  responda √† pergunta sobre a escolha de uma a√ß√£o com uma linha come√ßando com o caractere 'N' (por exemplo, <i>Agora vamos nos divertir</i> ); </li><li>  digite '\ 0' (ou algo mais interessante); </li><li>  .... </li><li>  LUCRO! </li></ul><br>  A reprodu√ß√£o do problema tamb√©m √© gravada em v√≠deo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8DBQjvPQ7tk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Openldap </h2><br>  No projeto OpenLDAP (mais precisamente, em um dos utilit√°rios acompanhantes), eles pisaram no mesmo rake que no FreeSWITCH.  Uma tentativa de excluir um caractere de quebra de linha ocorre apenas se a linha foi lida com √™xito, mas tamb√©m n√£o h√° prote√ß√£o contra linhas de comprimento zero. <br><br>  Snippet de c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[ <span class="hljs-number"><span class="hljs-number">4096</span></span> ]; FILE *fp = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { fp = <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>; } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( fp == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((rc == <span class="hljs-number"><span class="hljs-number">0</span></span> || contoper) &amp;&amp; fgets(buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), fp) != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { buf[ <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>( buf ) - <span class="hljs-number"><span class="hljs-number">1</span></span> ] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* remove trailing newline */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( *buf != <span class="hljs-string"><span class="hljs-string">'\0'</span></span> ) { rc = dodelete( ld, buf ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( rc != <span class="hljs-number"><span class="hljs-number">0</span></span> ) retval = rc; } } } .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V1010</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-20</a> Dados contaminados n√£o verificados s√£o usados ‚Äã‚Äãno √≠ndice: 'strlen (buf)'. <br><br>  Jogamos fora o excesso para que a ess√™ncia do problema se torne mais √≥bvia: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (.... &amp;&amp; fgets(buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), fp) != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { buf[ <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>( buf ) - <span class="hljs-number"><span class="hljs-number">1</span></span> ] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  Este c√≥digo √© melhor que o NcFTP, mas ainda √© vulner√°vel.  Se, a pedido, <i>pretende</i> passar uma sequ√™ncia de comprimento zero para a entrada: <br><br><ul><li>  <i>fgets (buf, ....)</i> -&gt; <i>buf</i> ; </li><li>  <i>fgets (....)! = NULL</i> -&gt; <i>true</i> (o corpo do <i>loop while</i> come√ßa a executar); </li><li>  <i>strlen (buf) - 1</i> -&gt; <i>0 - 1</i> -&gt; <i>-1</i> ; </li><li>  <i>buf [-1] = '\ 0'</i> . </li></ul><br><h2>  libidn </h2><br>  Apesar de os erros discutidos acima serem bastante interessantes (eles s√£o reproduzidos de forma est√°vel e podem ser "tocados" (exceto que eu n√£o pude alcan√ßar minhas m√£os no problema do OpenLDAP)), eles n√£o podem ser chamados de vulnerabilidades, apenas porque problemas n√£o recebem identificadores do CVE. <br><br>  No entanto, algumas vulnerabilidades reais t√™m o mesmo padr√£o de problema.  Ambos os trechos de c√≥digo abaixo se aplicam ao projeto libidn. <br><br>  Snippet de c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fgets (readbuf, BUFSIZ, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>) == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (feof (<span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; error (EXIT_FAILURE, errno, _(<span class="hljs-string"><span class="hljs-string">"input error"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readbuf[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (readbuf) - <span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) readbuf[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (readbuf) - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  <b>Aviso do PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V1010</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-20</a> Dados contaminados n√£o verificados s√£o usados ‚Äã‚Äãno √≠ndice: 'strlen (readbuf)'. <br><br>  A situa√ß√£o √© semelhante, exceto que, diferentemente dos exemplos anteriores, onde a grava√ß√£o foi realizada no √≠ndice <i>-1</i> , a leitura ocorre aqui.  No entanto, esse ainda √© um comportamento indefinido.  Este erro foi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">atribu√≠do ao</a> seu pr√≥prio identificador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2015-8948</a> ). <br><br>  Depois de detectar um problema, esse c√≥digo foi alterado da seguinte maneira: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getline (&amp;line, &amp;linelen, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (feof (<span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; error (EXIT_FAILURE, errno, _(<span class="hljs-string"><span class="hljs-string">"input error"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (line[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (line) - <span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) line[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (line) - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  Um pouco surpreso?  Isso acontece  Nova vulnerabilidade, identificador CVE correspondente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2016-6262</a> . <br><br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V1010</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-20</a> Dados contaminados n√£o verificados s√£o usados ‚Äã‚Äãno √≠ndice: 'strlen (line)'. <br><br>  Em outra tentativa, o problema foi corrigido adicionando uma verifica√ß√£o para o comprimento da sequ√™ncia de entrada: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (line) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (line[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (line) - <span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) line[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span> (line) - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>;</code> </pre> <br>  Vamos dar uma olhada nas datas.  O commit 'fechamento' CVE-2015-8948 - 08/10/2015.  Confirmar fechamento CVE-2016-62-62 - 14/01/2016.  Ou seja, a diferen√ßa entre as corre√ß√µes acima √© de <i>5 meses</i> !  Aqui voc√™ se lembra de uma vantagem da an√°lise est√°tica como detectar erros nos est√°gios iniciais da escrita de c√≥digo ... <br><br><h2>  An√°lise est√°tica e seguran√ßa </h2><br>  N√£o haver√° mais exemplos de c√≥digo; em vez disso, estat√≠sticas e racioc√≠nio.  Nesta se√ß√£o, a opini√£o do autor pode n√£o coincidir com a opini√£o do leitor muito mais do que antes neste artigo. <br><br>  <b>Nota</b>  Eu recomendo que voc√™ leia outro artigo sobre um t√≥pico semelhante - " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o PVS-Studio pode ajudar a encontrar vulnerabilidades?</a> ".  Existem exemplos interessantes de vulnerabilidades que parecem erros simples.  Al√©m disso, nesse artigo, falei um pouco sobre terminologia e por que a an√°lise est√°tica √© essencial se voc√™ estiver preocupado com o t√≥pico de seguran√ßa. <br><br>  Vejamos as estat√≠sticas sobre o n√∫mero de vulnerabilidades descobertas nos √∫ltimos 10 anos para avaliar a situa√ß√£o.  Peguei os dados do site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE Details</a> . <br><br><p><img src="https://habrastorage.org/webt/lu/au/2i/luau2ik1aoqytidzblkeqjy8vhs.png" alt="Quadro 2"></p><br><br>  Uma situa√ß√£o interessante se aproxima.  At√© 2014, o n√∫mero de CVEs registradas n√£o excedia a marca de 6.000 unidades e, a partir de - n√£o caiu abaixo.  Mas o mais interessante aqui, √© claro, s√£o as estat√≠sticas para 2017 - o l√≠der absoluto (14.714 unidades).  Quanto ao ano atual de 2018, ele ainda n√£o terminou, mas j√° est√° quebrando recordes - 15.310 unidades. <br><br>  Isso significa que todo novo software est√° cheio de buracos como uma peneira?  Eu n√£o acho, e aqui est√° o porqu√™: <br><br><ul><li>  Maior interesse no t√≥pico de vulnerabilidades.  Certamente, mesmo que voc√™ n√£o esteja muito perto do t√≥pico de seguran√ßa, voc√™ encontrou repetidamente artigos, notas, relat√≥rios e v√≠deos sobre o t√≥pico de seguran√ßa.  Em outras palavras, um tipo de "hype" foi criado.  Isso √© ruim?  Provavelmente n√£o.  No final, tudo se resume ao fato de que os desenvolvedores est√£o mais preocupados com a seguran√ßa dos aplicativos, o que √© bom. </li><li>  Um aumento no n√∫mero de aplicativos desenvolvidos.  Mais c√≥digo - √© mais prov√°vel que ocorra qualquer vulnerabilidade que reabaste√ßa as estat√≠sticas. </li><li>  Ferramentas aprimoradas de pesquisa de vulnerabilidades e garantia de qualidade de c√≥digo.  Mais demanda -&gt; mais oferta.  Analisadores, fuzzers e outras ferramentas est√£o se tornando mais avan√ßados, o que est√° nas m√£os de quem deseja procurar vulnerabilidades (independentemente de qual lado das barricadas estejam). </li></ul><br>  Portanto, a tend√™ncia emergente n√£o pode ser chamada de exclusivamente negativa - os editores est√£o mais preocupados com a seguran√ßa da informa√ß√£o, as ferramentas para encontrar problemas est√£o sendo aprimoradas e tudo isso √© sem d√∫vida positivo. <br><br>  Isso significa que voc√™ pode relaxar e n√£o "tomar banho"?  Eu acho que n√£o.  Se voc√™ est√° preocupado com o t√≥pico de seguran√ßa de seus aplicativos, deve tomar o maior n√∫mero poss√≠vel de medidas de seguran√ßa.  Isto √© especialmente verdade se o c√≥digo fonte estiver no dom√≠nio p√∫blico, pois: <br><br><ul><li>  mais suscet√≠vel √† incorpora√ß√£o de vulnerabilidades externas; </li><li>  mais propenso a "investigar" por aqueles "cavalheiros" que est√£o interessados ‚Äã‚Äãem falhas no seu aplicativo com o objetivo de explor√°-las.  Embora os que desejam bem neste caso possam ajud√°-lo mais. </li></ul><br>  N√£o quero dizer que voc√™ n√£o precisa traduzir seus projetos em c√≥digo aberto.  Lembre-se dos controles adequados de qualidade / seguran√ßa. <br><br>  A an√°lise est√°tica √© uma medida adicional?  Sim  A an√°lise est√°tica faz um bom trabalho ao detectar poss√≠veis vulnerabilidades que podem se tornar reais no futuro. <br><br>  Parece-me (admito que estou enganado) que muitos consideram as vulnerabilidades um fen√¥meno de alto n√≠vel.  Sim e n√£o  Problemas de c√≥digo que parecem simples erros de programa√ß√£o tamb√©m podem ser s√©rias vulnerabilidades.  Novamente, alguns exemplos dessas vulnerabilidades s√£o fornecidos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo mencionado anteriormente</a> .  N√£o subestime os erros "simples". <br><br><h2>  Conclus√£o </h2><br>  N√£o esque√ßa que os dados de entrada podem ter comprimento zero e isso tamb√©m precisa ser levado em considera√ß√£o. <br><br>  Conclus√µes sobre se todo o hype com vulnerabilidades √© apenas hype ou se o problema existe, fa√ßa voc√™ mesmo. <br><br>  Pela minha parte, a menos que eu proponha experimentar seu projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PVS-Studio</a> , se voc√™ ainda n√£o o fez. <br><br>  Tudo de bom! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: Sergey Vasiliev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">D√™ um tiro no p√© ao manusear dados de entrada</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433932/">https://habr.com/ru/post/pt433932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433918/index.html">Por que a web √© t√£o complicada?</a></li>
<li><a href="../pt433920/index.html">Gigante chin√™s de polissil√≠cio aumenta capacidade</a></li>
<li><a href="../pt433922/index.html">Kubernetes Intensive: Empregos de suporte</a></li>
<li><a href="../pt433926/index.html">Estruturas Javascript: tend√™ncias de 2019</a></li>
<li><a href="../pt433930/index.html">Perfis separados para freelancers e clientes</a></li>
<li><a href="../pt433934/index.html">Estrutura SAFe ou Scaled Agile</a></li>
<li><a href="../pt433936/index.html">Procurando um presente de alta tecnologia para uma crian√ßa? Pense em um playground, n√£o em um cercadinho</a></li>
<li><a href="../pt433938/index.html">Como Yandex e Google resumem o ano</a></li>
<li><a href="../pt433940/index.html">Quanto custa a revis√£o na AppStore</a></li>
<li><a href="../pt433944/index.html">Exce√ß√µes devastadoras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>