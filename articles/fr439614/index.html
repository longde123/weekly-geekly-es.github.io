<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚¨õÔ∏è ‚òπÔ∏è üïµüèæ Comment distinguer une bonne r√©paration d'une mauvaise, ou comment nous, dans SRG, avons cr√©√© une biblioth√®que Java multi-thread √† partir de l'analyseur Tomit üññüèº üßë‚Äçü§ù‚Äçüßë üí•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article expliquera comment nous avons int√©gr√© l'analyseur Tomita d√©velopp√© par Yandex dans notre syst√®me, l'avons transform√© en une biblioth√®que d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment distinguer une bonne r√©paration d'une mauvaise, ou comment nous, dans SRG, avons cr√©√© une biblioth√®que Java multi-thread √† partir de l'analyseur Tomit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/srg/blog/439614/">  Cet article expliquera comment nous avons int√©gr√© l'analyseur Tomita d√©velopp√© par Yandex dans notre syst√®me, l'avons transform√© en une biblioth√®que dynamique, nous sommes li√©s d'amiti√© avec Java, l'avons rendu multithread et avons r√©solu le probl√®me de la classification de texte pour l'√©valuation immobili√®re avec lui. <br><br><img src="https://habrastorage.org/webt/vi/om/ub/viomubb37jryhlbwqzqucsl583s.jpeg"><br><a name="habracut"></a><br><h3>  √ânonc√© du probl√®me </h3><br>  Dans l'√©valuation immobili√®re, l'analyse des annonces de vente est d'une grande importance.  D√®s l'annonce, vous pouvez obtenir toutes les informations n√©cessaires sur la propri√©t√©, y compris des informations sur l'√©tat de r√©paration de l'appartement.  Habituellement, ces informations sont contenues dans le texte de l'annonce.  Il est tr√®s important dans l'√©valuation, car une bonne r√©paration peut ajouter plusieurs milliers au prix du m√®tre carr√©. <br><br>  Nous avons donc un texte d'annonce qui doit √™tre class√© dans l'une des cat√©gories en fonction de l'√©tat de r√©paration dans l'appartement (inachev√©, passable, moyen, bon, excellent, exclusif).  √Ä propos des r√©parations, une annonce peut dire une ou deux phrases, quelques mots ou rien, il est donc inutile de classer compl√®tement le texte.  En raison de la sp√©cificit√© du texte et du nombre limit√© de mots li√©s au contexte de r√©paration, la seule solution raisonnable √©tait d'extraire toutes les informations n√©cessaires du texte et de les classer. <br><br><img src="https://habrastorage.org/webt/p9/jr/id/p9jrid1dluodkjquebvvr7yc5dq.png" alt="image"><br><br>  Maintenant, nous devons apprendre √† extraire du texte tous les faits sur l'√©tat de la d√©coration.  Plus pr√©cis√©ment, ce qui se rapporte directement √† la r√©paration, ainsi que tout ce qui peut indirectement parler de l'√©tat de l'appartement - la pr√©sence de plafonds suspendus, d'appareils encastr√©s, de fen√™tres en plastique, d'un jacuzzi, de l'utilisation de mat√©riaux de finition co√ªteux, etc. <br><br>  Dans ce cas, nous devons extraire uniquement des informations sur les r√©parations dans l'appartement lui-m√™me, car l'√©tat des entr√©es, des sous-sols et des greniers ne nous int√©resse pas.  Il est √©galement n√©cessaire de prendre en compte le fait que le texte est √©crit dans une langue naturelle avec toutes ses erreurs, fautes de frappe, abr√©viations et autres caract√©ristiques inh√©rentes - j'ai personnellement trouv√© trois orthographes des mots "linol√©um" et "stratifi√©" et cinq orthographes du mot "final";  certaines personnes ne comprennent pas pourquoi des espaces sont n√©cessaires entre les mots, tandis que d'autres n'ont pas entendu parler des virgules.  Par cons√©quent, l'analyseur avec des grammaires contextuellement libres est devenu la solution la plus simple et la plus raisonnable. <br><br>  Ainsi, au fur et √† mesure de la d√©cision, une deuxi√®me t√¢che importante et int√©ressante s'est form√©e - apprendre √† extraire toutes les informations suffisantes et n√©cessaires sur la r√©paration de l'annonce, √† savoir fournir une analyse syntaxique et morphologique rapide du texte, qui peut fonctionner en parall√®le sous charge en mode biblioth√®que. <br><br><h3>  Passez √† la solution </h3><br>  Parmi les moyens disponibles pour extraire des faits √† partir d'un texte bas√© sur des grammaires sans contexte pouvant fonctionner avec la langue russe, notre attention a √©t√© attir√©e sur Tomita-parser et la biblioth√®que Yagry en python.  Yagry a √©t√© imm√©diatement rejet√©, car il est enti√®rement √©crit en python et n'est gu√®re bien optimis√©.  Et Tomita avait d'abord l'air tr√®s attrayante: elle avait une documentation d√©taill√©e pour le d√©veloppeur et beaucoup d'exemples, C ++ promettait une vitesse acceptable.  Il n'√©tait pas difficile de comprendre les r√®gles d'√©criture des grammaires, et la premi√®re version du classificateur avec son utilisation √©tait pr√™te d√®s le lendemain. <br><br>  Exemples de r√®gles de nos grammaires qui extraient des adjectifs et des verbes li√©s au contexte de r√©paration: <br><br><pre><code class="javascript hljs">RepairW -&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> | <span class="hljs-string"><span class="hljs-string">""</span></span> | <span class="hljs-string"><span class="hljs-string">""</span></span>; StopWords -&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> | <span class="hljs-string"><span class="hljs-string">""</span></span> | <span class="hljs-string"><span class="hljs-string">""</span></span> | <span class="hljs-string"><span class="hljs-string">""</span></span>; Repair -&gt; RepairW&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; Adj&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt;+ interp (Repair.AdjGroup {weight = <span class="hljs-number"><span class="hljs-number">0.5</span></span>}); Repair -&gt; Verb&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; Adj&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt;* interp (Repair.Verb) RepairW&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; {weight = <span class="hljs-number"><span class="hljs-number">0.5</span></span>};</code> </pre> <br>  R√®gles utilis√©es pour garantir que les informations sur l'√©tat des espaces publics ne sont pas r√©cup√©r√©es: <br><br><pre> <code class="javascript hljs">Repair -&gt; StopWords Verb* Prep* Adj* RepairW; Repair -&gt; Adj+ RepairW Prep* StopWords;</code> </pre><br>  Par d√©faut, le poids de la r√®gle est 1, en attribuant un poids plus petit √† la r√®gle, nous d√©finissons l'ordre de leur ex√©cution. <br><br>  C'√©tait un peu g√™nant que seules l'application console et une tonne de code C ++ aient √©t√© t√©l√©charg√©es vers le public.  Mais l'avantage incontestable √©tait la facilit√© d'utilisation et les r√©sultats rapides des exp√©riences.  Par cons√©quent, il a √©t√© d√©cid√© de r√©fl√©chir aux difficult√©s √©ventuelles de son introduction dans notre syst√®me plus pr√®s de la mise en ≈ìuvre elle-m√™me. <br><br>  Presque imm√©diatement, il a √©t√© possible d'obtenir une extraction de haute qualit√© de presque toutes les informations n√©cessaires sur la r√©paration.  ¬´Presque¬ª, car au d√©part, certains mots n'√©taient extraits sous aucune condition ni grammaire.  Cependant, il a √©t√© difficile d'√©valuer imm√©diatement l'ampleur de ce probl√®me, dans quelle mesure il peut affecter la qualit√© de la solution au probl√®me de classification dans son ensemble. <br><br>  Apr√®s nous √™tre assur√©s que dans une premi√®re approximation, Tomita nous fournit les fonctionnalit√©s n√©cessaires, nous avons r√©alis√© que ce n'√©tait pas une option pour l'utiliser comme une application console: premi√®rement, l'application console s'est av√©r√©e instable et s'est √©cras√©e de temps en temps pour des raisons inconnues, et deuxi√®mement, elle ne fournirait pas la charge d'analyse requise de plusieurs millions d'annonces par jour.  Ainsi, il est devenu clairement clair de quoi faire une biblioth√®que. <br><br><h3>  Comment nous avons fait de Tomitha une biblioth√®que multithread et sommes devenus amis avec Java </h3><br>  Notre syst√®me est √©crit en Java, tomita-parser en C ++.  Nous devions √™tre en mesure d'appeler l'analyse du texte d'annonce √† partir de Java. <br><br>  Le d√©veloppement de java-bindings pour Tomita-parser peut √™tre conditionnellement divis√© en deux composants - la mise en ≈ìuvre de la possibilit√© d'utiliser Tomita comme biblioth√®que partag√©e et, en fait, l'√©criture d'une couche d'int√©gration avec jvm.  La principale difficult√© concerne la premi√®re partie.  Tomita elle-m√™me a √©t√© initialement con√ßue pour √™tre ex√©cut√©e dans un processus distinct.  Il s'ensuit que les principaux obstacles √† l'utilisation de l'analyseur dans le processus de demande sont deux facteurs. <br><br><ol><li>  L'√©change de donn√©es a √©t√© effectu√© par le biais de divers types d'E / S.  Il √©tait n√©cessaire de mettre en ≈ìuvre la possibilit√© d'√©changer des donn√©es avec l'analyseur par le biais de la m√©moire.  De plus, il √©tait n√©cessaire de le faire de mani√®re √† affecter le moins possible le code de l'analyseur lui-m√™me.  L‚Äôarchitecture de Tomita a sugg√©r√© un moyen d‚Äôimpl√©menter la lecture des documents d‚Äôentr√©e √† partir de la m√©moire en tant qu‚Äôimpl√©mentation des interfaces CDocStreamBase et CDocListRetrieverBase.  C'√©tait plus difficile avec la sortie - j'ai d√ª toucher au code du g√©n√©rateur xml. </li><li>  Le deuxi√®me facteur d√©coulant du principe ¬´un analyseur - un processus¬ª est l'√©tat global, modifi√© √† partir de diff√©rentes instances de l'analyseur.  Si vous regardez le fichier <a href="">src / util / generic / singleton.h</a> , vous pouvez voir le m√©canisme d'utilisation de l'√©tat partag√©.  Il est facile d'imaginer que lors de l'utilisation de deux instances d'analyseur dans le m√™me espace d'adressage, une condition de concurrence critique se produira.  Afin de ne pas r√©√©crire l'int√©gralit√© de l'analyseur, il a √©t√© d√©cid√© de modifier cette classe, en rempla√ßant l'√©tat global par un √©tat local par rapport au thread (thread_local).  Par cons√©quent, avant tout appel d'analyseur dans l'encapsuleur JTextMiner, nous d√©finissons ces variables thread_local sur l'instance d'analyseur en cours, apr√®s quoi le code d'analyseur fonctionne avec les adresses de l'instance d'analyseur en cours. </li></ol><br>  Apr√®s avoir √©limin√© ces deux facteurs, l'analyseur √©tait disponible pour une utilisation en tant que biblioth√®que partag√©e √† partir de n'importe quel environnement.  √âcrire des jni-binders et un wrapper java n'√©tait plus difficile. <br><br>  L'analyseur Tomita doit √™tre configur√© avant utilisation.  Les param√®tres de configuration sont similaires √† ceux utilis√©s lors de l'appel de l'utilitaire de console.  L'analyse elle-m√™me consiste √† appeler la m√©thode parse (), qui re√ßoit les documents √† analyser et renvoie xml sous forme de cha√Æne avec les r√©sultats de l'analyseur. <br><br>  La version multithread de Tomita - TomitaPooledParser utilise pour analyser un pool d'objets TomitaParser configur√©s de la m√™me mani√®re.  Pour l'analyse, le premier analyseur libre est utilis√©.  √âtant donn√© que le nombre d'analyseurs cr√©√©s est √©gal au nombre de threads dans le pool, il y aura toujours au moins un analyseur disponible pour la t√¢che.  La m√©thode d'analyse analyse de fa√ßon asynchrone les documents fournis dans le premier analyseur libre. <br><br>  Un exemple d'appel de la biblioth√®que Tomita depuis Java: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> threadAmount number of threads in the pool * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> tomitaConfigFilename tomita config.proto * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> configDirname dir with configs: grammars, gazetteer, facttypes.proto */</span></span> tomitaPooledParser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TomitaPooledParser(threadAmount, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(configDirname), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{tomitaConfigFilename}); Future&lt;String&gt; result = tomitaPooledParser.parse(documents); String response = result.get();</code> </pre><br>  En r√©ponse, une cha√Æne XML avec le r√©sultat de l'analyse. <br><br><h3>  Probl√®mes rencontr√©s et comment nous les avons r√©solus </h3><br>  Ainsi, la biblioth√®que est pr√™te, nous d√©marrons le service avec son utilisation sur une grande quantit√© de donn√©es et nous nous souvenons du probl√®me de ne pas extraire certains mots, r√©alisant que cela est tr√®s critique pour notre t√¢che. <br><br>  Parmi ces mots figuraient ¬´pr√©filtr√©¬ª, ainsi que ¬´fait¬ª, ¬´produit¬ª et d'autres participes abr√©g√©s.  Autrement dit, les mots que l'on trouve dans l'annonce tr√®s souvent, et parfois c'est la seule ou tr√®s importante information sur la r√©paration.  La raison de ce comportement - le mot ¬´pr√©filtr√©¬ª s'est av√©r√© √™tre un mot de morphologie inconnue, c'est-√†-dire que Tomita ne peut tout simplement pas d√©terminer de quelle partie du discours il s'agit et, par cons√©quent, ne peut pas l'extraire.  Et pour les participes abr√©g√©s, j'ai d√ª √©crire une r√®gle distincte, et le probl√®me a √©t√© r√©solu, mais il a fallu un certain temps pour comprendre qu'il s'agit de participes abr√©g√©s, pour l'extraction desquels une r√®gle sp√©ciale est n√©cessaire.  Et pour la finale ¬´finale¬ª qui a dur√© longtemps, j'ai d√ª √©crire une r√®gle distincte comme pour un mot de morphologie inconnue. <br><br>  Afin de r√©soudre les probl√®mes d'analyse syntaxique √† l'aide de grammaires, nous ajoutons un mot de morphologie inconnue au r√©pertoire g√©ographique: <br><br><pre> <code class="javascript hljs">TAuxDicArticle <span class="hljs-string"><span class="hljs-string">"adjNonExtracted"</span></span> { key = <span class="hljs-string"><span class="hljs-string">""</span></span> | <span class="hljs-string"><span class="hljs-string">"-"</span></span> }</code> </pre><br>  Pour les participes abr√©g√©s, nous utilisons les caract√©ristiques grammaticales de partcp, brev. <br><br>  Et maintenant, nous pouvons √©crire les r√®gles pour ces cas: <br><br><pre> <code class="javascript hljs">Repair -&gt; RepairW&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; Word&lt;gram=<span class="hljs-string"><span class="hljs-string">"partcp,brev"</span></span>,gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; interp (Repair.AdjGroup) {weight = <span class="hljs-number"><span class="hljs-number">0.5</span></span>}; Repair -&gt; Word&lt;kwtype=<span class="hljs-string"><span class="hljs-string">"adjNonExtracted"</span></span>,gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; interp (Repair.AdjGroup) RepairW&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt; Prep* Adj&lt;gnc-agr[<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt;+;</code> </pre><br>  Et le dernier des probl√®mes que nous avons d√©couverts - un service avec utilisation multithread de la biblioth√®que Tomita produit des processus myStem qui ne sont pas d√©truits et apr√®s un certain temps remplissent toute la m√©moire.  La solution la plus simple √©tait de limiter le nombre maximum et minimum de threads dans Tomcat. <br><br><h3>  Quelques mots sur le classement </h3><br>  Nous avons donc maintenant les informations de r√©paration extraites du texte.  Il n'a pas √©t√© difficile de le classer en utilisant l'un des algorithmes de renforcement de gradient.  Nous ne nous arr√™terons pas ici longtemps sur ce sujet, beaucoup a √©t√© dit et √©crit √† ce sujet, et nous n'avons rien fait de radicalement nouveau dans ce domaine.  Je ne donnerai que les indicateurs de qualit√© du classement que nous avons obtenus sur les tests: <br><br><ul><li>  Pr√©cision = 95% </li><li>  Score F1 = 93% </li></ul><br><h3>  Conclusion </h3><br>  Le service impl√©ment√© utilisant Tomita-parser en mode biblioth√®que fonctionne actuellement r√©guli√®rement, analysant et classant plusieurs millions d'annonces par jour. <br><br><h3>  PS </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tout le code Tomita</a> que nous avons √©crit dans le cadre de ce projet est t√©l√©charg√© sur le github.  J'esp√®re que cela est utile √† quelqu'un, et cette personne gagnera un peu de temps sur quelque chose d'encore plus utile. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439614/">https://habr.com/ru/post/fr439614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439604/index.html">Comment le code-barres est-il organis√©?</a></li>
<li><a href="../fr439606/index.html">Production pilote d'√©lectronique pour un prix minimum</a></li>
<li><a href="../fr439608/index.html">Religion moderne: qu'est-ce que Google, Facebook, Amazon et Apple donnent aux gens?</a></li>
<li><a href="../fr439610/index.html">Comme dans mon v√©hicule √©lectrique Chevrolet Bolt, sous garantie, deux modules de batterie ont √©t√© remplac√©s, et le troisi√®me sous surveillance</a></li>
<li><a href="../fr439612/index.html">JavaScript robuste: chasser un mythe</a></li>
<li><a href="../fr439616/index.html">Le condens√© de projets informatiques int√©ressants sur Kickstarter n ¬∞ 7</a></li>
<li><a href="../fr439618/index.html">PHP pour les d√©butants. Connexion de fichier</a></li>
<li><a href="../fr439620/index.html">Comprendre l'asynchronie en JavaScript [Traduction de Sukhjinder Arora]</a></li>
<li><a href="../fr439624/index.html">Pourquoi stocker des donn√©es en orbite</a></li>
<li><a href="../fr439626/index.html">Exp√©rience dans le d√©veloppement d'une application gratuite pour les collectionneurs OpenNumismat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>