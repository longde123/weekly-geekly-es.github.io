<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖕🏾 🎺 🔤 Jenkins untuk Android build menggunakan buruh pelabuhan ⚒️ 🖤 🖕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 

 Saya bekerja sebagai pengembang android, dan belum lama ini kami mengalami beberapa tugas rutin pada proyek kami yang ingin kamiotom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jenkins untuk Android build menggunakan buruh pelabuhan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443606/">  Halo semuanya! <br><br>  Saya bekerja sebagai pengembang android, dan belum lama ini kami mengalami beberapa tugas rutin pada proyek kami yang ingin kamiotomatiskan.  Misalnya, kami memiliki 5 rasa yang berbeda, untuk masing-masingnya kami perlu mengunggah build ke fabric, terkadang untuk gerobak yang berbeda beberapa kali sehari.  Ya, tugas ini juga dapat dilakukan dengan menggunakan tugas gradle, tetapi saya ingin tidak memulai proses ini pada mesin pengembang, tetapi melakukannya entah bagaimana secara terpusat.  Atau misalnya, secara otomatis unggah build in google play ke beta.  Yah, saya hanya ingin memilih sistem CI.  Apa yang terjadi dengan ini, dan bagaimana kita mengaturnya, mengapa ada Docker, kemudian di artikel ini. <br><br><img src="https://habrastorage.org/webt/at/pi/_v/atpi_veqcyb-lryxth_ia4m0uag.png"><br><a name="habracut"></a><br>  Dalam pemahaman saya, seluruh tugas dibagi menjadi sekitar dua tahap: <br><br><ol><li>  Instal dan konfigurasikan Jenkins sendiri dengan Android SDK </li><li>  Siapkan tugas yang sudah ada di dalam Jenkins </li></ol><br>  Pada artikel ini, saya ingin menyentuh pada poin pertama, dan jika itu akan menarik bagi siapa pun, maka pada artikel selanjutnya saya akan menjelaskan proses pengaturan tugas perakitan di Jenkins itu sendiri. <br><br><h2>  Jadi, poin pertama adalah instalasi dan konfigurasi sistem Jenkins </h2><br>  <i>Habré sudah memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel yang</a> bagus tentang topik ini, tetapi dia sudah beberapa tahun, dan beberapa hal di dalamnya sedikit ketinggalan jaman (misalnya sdkmanager), meskipun dia banyak membantu saya untuk mencari tahu apa dan bagaimana yang harus dilakukan pada tahap awal.</i> <br><br>  Jika Anda melihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> resmi untuk menginstal Jenkins, maka kita akan melihat tiga cara berbeda untuk melakukan ini: luncurkan gambar buruh pelabuhan yang sudah jadi, unduh dan jalankan file perang, dan juga cukup instal jenkins dalam sistem dengan cara lama (misalnya, <code>apt-get install jenkins</code> menggunakan ubuntu sebagai contoh).  Opsi pertama adalah yang paling benar, karena tidak membawa pengaturan dan dependensi yang tidak perlu ke sistem host kami, dan setiap saat bahkan jika terjadi kesalahan, mudah dan sederhana untuk menghapus semuanya dan mulai lagi.  Tetapi gambar buruh pelabuhan standar untuk jenkins berisi beberapa data yang tidak kita butuhkan (misalnya, plugin blueocean) dan tidak berisi apa yang pasti akan kita butuhkan (misalnya, android sdk).  Diputuskan untuk membuat gambar buruh pelabuhan kami sendiri yang di dalamnya akan mengunduh dan menjalankan file perang, mengunduh dan menginstal SDK Android, serta mengkonfigurasi semua pengaturan lain yang kita butuhkan.  Untuk memulainya nanti, kita membutuhkan sistem host dengan buruh pelabuhan diinstal.  Saya sarankan di sini untuk tidak menemukan kembali roda dan menggunakan DigitalOcean. <br><br><h4>  Buat dan konfigurasikan mesin virtual </h4><br>  Untuk memulainya, jika orang lain tidak terdaftar di sana, saya sarankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mendaftar</a> (di sini pada saat menulis artikel ada tautan rujukan, tetapi setelah membaca aturan saya membuangnya).  Setelah mendaftar, Anda dapat google satu atau kode promosi lain di Internet, dan mendapatkan sekitar 10 dolar untuk memulai. <br><br>  Setelah itu kita perlu mendapatkan tetesan baru.  Pilih item Tetesan, lalu <b>Buat Tetesan</b> . <br><br><img src="https://habrastorage.org/webt/gx/5m/th/gx5mthmcjzw-okm6ktxpfekimn8.png" alt="gambar"><br><br>  Sistem host adalah Ubuntu 18.04.  Anda dapat memilih gambar dengan Docker yang sudah diinstal dan dikonfigurasi, tetapi kami akan melakukan semuanya sendiri.  Karena rakitan Android builds masih membutuhkan banyak sumber daya, kita perlu memilih konfigurasi untuk setidaknya 20 dolar sehingga build dikumpulkan secara normal dan relatif cepat. <br><br><img src="https://habrastorage.org/webt/1e/y_/z1/1ey_z1uyjffbqocqz6i4ef8ium8.png" alt="gambar"><br><br>  Kami akan memilih lokasi yang lebih dekat (misalnya, di Jerman).  Lalu ada dua opsi untuk bagaimana kita akan terhubung ke server virtual kita.  Kita dapat menambahkan kunci ssh atau melakukannya tanpa itu.  Jika di tempat ini kami tidak menunjukkan kunci mana yang digunakan, maka kata sandi untuk pengguna root akan dikirim ke email kami. <br><br><img src="https://habrastorage.org/webt/eg/qd/hu/egqdhuamgiddwijvsfidcxu7ieq.png" alt="gambar"><br><br>  Di sini kita dapat mengubah nama server, dan menyelesaikan pembuatan dengan mengklik tombol <b>Buat</b> . <br><br><img src="https://habrastorage.org/webt/ad/mw/6w/admw6wwv2zyontaxpzx-fgp-rfg.png" alt="gambar"><br><br>  Sekarang kita masuk ke droplet yang dibuat, dan salin alamat ip untuk diri kita sendiri, untuk koneksi dan konfigurasi lebih lanjut. <br><br><img src="https://habrastorage.org/webt/q7/th/yv/q7thyvgm-hppvgrured6dogeqva.png" alt="gambar"><br><br>  Kami membutuhkan klien ssh.  Jika Anda bekerja dari bawah poppy, maka Anda dapat menggunakan terminal standar, jika dari bawah Windows kita dapat menggunakan dempul untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bekerja</a> atau menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">subsistem Linux</a> (hanya untuk Windows 10).  Saya pribadi menggunakan opsi yang terakhir, dan itu sangat cocok untuk saya. <br><br>  Terhubung ke server kami menggunakan perintah berikut <br><br><pre> <code class="bash hljs">ssh root@YOUR_IP_ADDRESS</code> </pre> <br>  Konsol akan menawarkan Anda untuk menyimpan kunci, kami setuju dengan ini.  Setelah terhubung, kami akan membuat pengguna baru untuk diri kami sendiri, menambahkannya ke pengguna super (dan memberinya kesempatan untuk menggunakan sudo tanpa kata sandi), menyalinnya kunci untuk akses melalui ssh dan mengatakan bahwa ia adalah pemilik file-file ini (jika tidak maka tidak akan berfungsi).  Nama <b>pengguna</b> diubah menjadi nyaman untuk Anda. <br><br><pre> <code class="bash hljs">useradd -m -s /bin/bash username \ &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'username ALL=(ALL) NOPASSWD:ALL'</span></span> &gt;&gt; /etc/sudoers \ &amp;&amp; mkdir /home/username/.ssh \ &amp;&amp; cp /root/.ssh/authorized_keys /home/username/.ssh/authorized_keys \ &amp;&amp; chown username:username -R /home/username/.ssh</code> </pre><br>  Putuskan koneksi dari root dengan perintah <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Dan kami akan terhubung kembali dengan bantuan pengguna baru yang dibuat <br><br><pre> <code class="bash hljs">ssh username@YOUR_IP_ADDRESS</code> </pre> <br>  Setelah kami memperbarui sistem, dan reboot server kami (jika selama proses pembaruan, sistem akan menanyakan sesuatu kepada Anda, cukup untuk selalu memilih nilai default dalam kasus ini). <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt full-upgrade -y &amp;&amp; sudo apt autoremove -y &amp;&amp; sudo reboot</code> </pre> <br>  Setup dasar selesai.  Dari sudut pandang sistem pertempuran, itu tidak terlalu aman, tetapi dalam kerangka artikel ini sangat cocok. <br><br><h4>  Instal Docker. </h4><br>  Untuk menginstal Docker di sistem kami, kami akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi resmi</a> .  Karena kami memiliki sistem yang baru diinstal, kami akan melewati titik ini, dan jika Anda memiliki sistem tempat sesuatu telah berjalan lama, atas rekomendasi orang-orang dari Docker, hapus kemungkinan versi lama <br><br><pre> <code class="bash hljs">sudo apt-get remove docker docker-engine docker.io containerd runc</code> </pre> <br>  Jangan lupa untuk terhubung kembali melalui ssh ke server kami.  Instalasi Docker sendiri dijelaskan dengan sangat terperinci dalam dokumentasi, saya akan memberikan perintah umum untuk memudahkan Anda.  Apa yang mereka lakukan dapat dibaca di sana.  Pertama-tama tambahkan repositori. <br><br><pre> <code class="bash hljs">sudo apt update \ &amp;&amp; sudo apt install -y apt-transport-https ca-certificates \ curl gnupg-agent software-properties-common \ &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \ &amp;&amp; sudo apt-key fingerprint 0EBFCD88 \ &amp;&amp; sudo add-apt-repository <span class="hljs-string"><span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(lsb_release -cs)</span></span></span><span class="hljs-string"> stable"</span></span></code> </pre> <br>  Dan kemudian instal Docker sendiri: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-ce docker-ce-cli containerd.io</code> </pre> <br>  Sehingga di masa depan kita bisa memanggil perintah buruh pelabuhan tanpa awalan sudo, jalankan perintah berikut (yang juga dijelaskan dengan seksama dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> ). <br><br><pre> <code class="bash hljs">sudo usermod -aG docker username</code> </pre> <br>  Setelah itu, Anda harus masuk kembali (menggunakan perintah keluar dan menghubungkan kembali ke server) agar ini berfungsi. <br><br>  Docker sendiri terinstal, yang bisa kita periksa dengan perintah <br><br><pre> <code class="bash hljs">docker run hello-world</code> </pre> <br>  Dia mengunduh gambar uji, menjalankannya dalam wadah.  Wadah, setelah memulai, mencetak pesan informasi dan keluar. <br><br>  Selamat, kami telah menyelesaikan tahap mempersiapkan server untuk bekerja! <br><br><h4>  Membuat Gambar Docker Anda </h4><br>  Kami akan membuat gambar Docker dengan menulis Dockerfile kami sendiri.  Contoh cara melakukan ini dengan benar di Internet gerobak dan gerobak kecil, saya akan menunjukkan versi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saya yang sudah</a> selesai, dan saya akan mencoba mengomentarinya sebanyak mungkin.  Ada juga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi manual</a> dari buruh pelabuhan itu sendiri dengan contoh pada ejaan dockerfile yang benar dan kanonik. <br><br>  Buat dan buka Dockerfile Anda untuk diedit <br><br><pre> <code class="bash hljs">touch Dockerfile &amp;&amp; nano Dockerfile</code> </pre> <br>  Di dalamnya, misalnya, kami akan meletakkan konten Dockerfile saya <br><br><div class="spoiler">  <b class="spoiler_title">Seluruh buruh pelabuhan saya dengan komentar</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    . FROM ubuntu:18.04 #      LABEL author="osipovaleks" LABEL maintainer="osipov.aleks.kr@gmail.com" LABEL version="1.0" LABEL description="Docker image for Jenkins with Android SDK" #  ,  Jenkins    ENV TZ=Europe/Kiev RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone # i386    ia32-libs RUN dpkg --add-architecture i386 #      RUN apt-get update &amp;&amp; apt-get install -y git \ wget \ unzip \ sudo \ tzdata \ locales\ openjdk-8-jdk \ libncurses5:i386 \ libstdc++6:i386 \ zlib1g:i386 #  ,       RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists /var/cache/apt #  RUN locale-gen en_US.UTF-8 ENV LANG en_US.UTF-8 ENV LANGUAGE en_US:en ENV LC_ALL en_US.UTF-8 #   Android Sdk     ARG android_home_dir=/var/lib/android-sdk/ ARG sdk_tools_zip_file=sdk-tools-linux-4333796.zip RUN mkdir $android_home_dir RUN wget https://dl.google.com/android/repository/$sdk_tools_zip_file -P $android_home_dir -nv RUN unzip $android_home_dir$sdk_tools_zip_file -d $android_home_dir RUN rm $android_home_dir$sdk_tools_zip_file &amp;&amp; chmod 777 -R $android_home_dir # environment    ENV ANDROID_HOME=$android_home_dir ENV PATH="${PATH}:$android_home_dir/tools/bin:$android_home_dir/platform-tools" ENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ #   Android SDK RUN yes | sdkmanager --licenses #    Jenkins ENV JENKINS_HOME=/var/lib/jenkins RUN mkdir $JENKINS_HOME &amp;&amp; chmod 777 $JENKINS_HOME #     jenkins,   ,         RUN useradd -m jenkins &amp;&amp; echo 'jenkins ALL=(ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers USER jenkins WORKDIR /home/jenkins #   war     Jenkins RUN wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war -nv CMD java -jar jenkins.war #      EXPOSE 8080/tcp</span></span></code> </pre><br></div></div><br>  Beberapa klarifikasi: <br><br><ul><li>  Pada awalnya, ada keinginan untuk menggunakan alpine yang lebih ringan alih-alih ubuntu, tetapi ia tidak memiliki dukungan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ia32-libs</a> , yang diperlukan untuk membangun proyek menggunakan Android SDK. </li><li>  Kami memasang openjdk-8-jdk, bukan yang lebih ringan openjdk-8-jdk-headless, karena beberapa fungsi Jenkins membutuhkan sistem yang lengkap (misalnya, menampilkan hasil tes unit). </li><li>  Diperlukan untuk menginstal locales, karena pada beberapa proyek, tanpa mereka, assembly gradle crash tanpa kesalahan dan log yang jelas, dan saya menghabiskan beberapa hari untuk sampai ke dasar alasan ini (pada ubuntu reguler yang tidak di docker, semua lokal diisi secara default) . </li><li>  Kita harus segera menerima semua lisensi untuk Android SDK, sehingga selama proses pembuatan Jenkins dapat secara mandiri menginstal komponen yang dibutuhkannya (misalnya, SDK yang dibutuhkan untuk versi api yang berbeda).  Jika perlu, nanti di dalam wadah buruh pelabuhan akan mungkin untuk mengelola SDK menggunakan sdkmanager, misalnya <code>sdkmanager --list</code> memungkinkan <code>sdkmanager --list</code> untuk melihat semua komponen yang tersedia dan semua yang diinstal, dan <code>sdkmanager --install "platforms;android-26"</code> menginstal SDK untuk versi 26 dari api. </li><li>  Secara umum, itu mungkin untuk tidak memulai pengguna jenkins, dan tetap dengan pengguna root, tapi entah bagaimana itu tidak benar, Anda juga tidak bisa memberinya hak pengguna super, tetapi ini dilakukan dalam hal kenyamanan, jika sesuatu perlu diinstal pada tahap pengaturan dan debug. </li><li>  Ukuran dasar gambar ternyata agak besar (hampir 800 mb), tetapi secara keseluruhan saya sampai pada kesimpulan bahwa bagi saya ini tidak terlalu kritis, dan lebih mudah bagi saya untuk mengunduhnya dalam bentuk ini daripada menghabiskan waktu mencari dan menghapus paket yang tidak saya butuhkan. </li></ul><br>  Setelah menulis Dockerfile, kita perlu mengubahnya menjadi gambar yang siap pakai untuk Docker, berdasarkan wadah yang akan dibuat.  Ini dilakukan hanya oleh tim <br><br><pre> <code class="bash hljs">docker build -t jenkins-image</code> </pre> <br>  di mana parameter <code>-t jenkins-image</code> bertanggung jawab atas nama gambar Anda, dan titik di akhir perintah menunjukkan bahwa Anda perlu mencari Dockerfile untuk perakitan di dalam direktori ini.  Proses perakitan itu sendiri membutuhkan waktu, dan setelah perakitan harus ada sesuatu seperti ini di konsol. <br><blockquote>  9fd8f5545c27 berhasil dibangun <br>  Berhasil menandai tag-jenkins: terbaru </blockquote>  Yang memberitahu kita bahwa gambar kita telah berhasil dirangkai, dan kita dapat melanjutkan ke langkah selanjutnya, yaitu peluncuran wadah kita <br><br><h4>  Hub Docker dan gambar yang sudah jadi </h4><br>  Ya, tentu saja, kita dapat menggunakan gambar siap pakai kami untuk meluncurkan wadah, tetapi jika kita perlu melakukan ini di lebih dari beberapa perangkat, membuat Dockerfile setiap kali dan membangun gambar yang sudah jadi dari itu tidak akan sangat nyaman.  Dan jika kita juga memperbarui konten Dockerfile kita, maka meluncurkan perubahan di semua node tidak akan nyaman sama sekali.  Untuk tujuan ini, ada repositori publik dari gambar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Docker Hub</a> .  Ini memungkinkan Anda untuk tidak mengumpulkan gambar setiap waktu, pada setiap node, tetapi cukup mengunduhnya ke diri Anda sendiri dari repositori publik, dan menggunakannya secara merata di semua mesin.  Sebagai contoh, gambar yang berfungsi sebagai contoh untuk artikel ini tersedia di repositori bernama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">osipovaleks / docker-jenkins-android</a> , dan nanti dalam artikel ini kita akan bekerja dengannya. <br><br>  Artikel ini tidak menyiratkan studi terperinci tentang Docker Hub, kami tidak akan mengerti cara mengunggah gambar kami di sana (meskipun ini tidak terlalu sulit) dan apa yang dapat dilakukan dengan mereka di sana, kami tidak akan mengerti bahwa mungkin masih ada repositori publik atau pribadi Anda sendiri, Dalam hal ini semua dapat disortir secara mandiri jika perlu. <br><br><h4>  Peluncuran kontainer </h4><br>  Ada dua cara memulai wadah. <br><br><ol><li>  Cara pertama, cukup menggunakan <code>docker run</code> , memungkinkan Anda melakukan ini dengan mudah dan cepat dengan cara berikut <br><br><pre> <code class="bash hljs">docker run --name jenkins -d -it -v jenkins-data:/var/lib/jenkins -v jenkins-home:/home/jenkins -p 8080:8080 --restart unless-stopped osipovaleks/docker-jenkins-android</code> </pre> <br>  di mana perintah <code>run</code> memiliki parameter berikut <br><br><ul><li>  <code>--name jenkins</code> - nama wadah masa depan </li><li>  <code>-d</code> - mulai wadah di latar belakang </li><li>  <code>-it</code> - flag untuk bekerja dengan STDIN dan tty </li><li>  <code>-v jenkins-data:/var/lib/jenkins</code> dan <code>-v jenkins-home:/home/jenkins</code> - buat (jika tidak dibuat) dan petakan file volume khusus ke bagian internal wadah yang akan memungkinkan kita untuk menyimpan Jenkins yang telah dikonfigurasi bahkan setelah merekonstruksi. wadah </li><li>  <code>-p 8080:8080</code> - memetakan port host ke port container sehingga kita memiliki akses ke antarmuka web (ya ini adalah port yang kita tentukan di Dockerfile) </li><li>  <code>--restart unless-stopped</code> - opsi menentukan kebijakan autorun wadah setelah <code>--restart unless-stopped</code> ulang host (dalam hal ini, autostart jika wadah tidak dimatikan secara manual) </li><li>  <code>osipovaleks/docker-jenkins-android</code> - gambar untuk ditempatkan. </li></ul><br>  Di pintu keluar ke konsol Docker, kita harus mendapatkan id dari wadah yang dibuat, dan juga menunjukkan informasi tentang bagaimana gambar dimuat ke dalam sistem (tentu saja, jika belum dimuat), sesuatu seperti ini <br><blockquote>  Tidak dapat menemukan gambar 'osipovaleks / docker-jenkins-android: terbaru' secara lokal <br>  terbaru: Menarik dari osipovaleks / docker-jenkins-android <br>  6cf436f81810: Tarik selesai <br>  987088a85b96: Tarik selesai <br>  b4624b3efe06: Tarik selesai <br>  d42beb8ded59: Tarik selesai <br>  b3896048bb8c: Tarik selesai <br>  8eeace4c3d64: tarik selesai <br>  d9b74624442c: Tarik selesai <br>  36bb3b7da419: Tarik selesai <br>  31361bd508cb: Tarik selesai <br>  cee49ae4c825: tarik lengkap <br>  868ddf54d4c1: Tarik selesai <br>  361bd7573dd0: Tarik selesai <br>  bb7b15e36ae8: Tarik selesai <br>  97f19daace79: Tarik selesai <br>  1f5eb3850f3e: Tarik selesai <br>  651e7bbedad2: Tarik selesai <br>  a52705a2ded7: Tarik selesai <br>  Intisari: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Status: Diunduh gambar yang lebih baru untuk osipovaleks / docker-jenkins-android: latest <br>  ef9e5512581da66d66103d9f6ea6ccd74e5bdb3776747441ce6a88a98a12b5a4 </blockquote></li><li>  Cara kedua untuk memulai melibatkan menulis file penulisan khusus, di mana perintah jalankan hanya dijelaskan menggunakan bahasa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">YAML</a> , dan diluncurkan menggunakan Docker Compose. <br><br>  Untuk melakukan ini, kita perlu menginstalnya: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-compose</code> </pre> <br>  Selanjutnya, buat direktori untuk proyek (ini penting jika Anda peduli apa volume yang dibuat secara otomatis untuk wadah akan dipanggil) dan pergi ke sana <br><br><pre> <code class="bash hljs">mkdir jenkinsProject &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jenkinsProject</code> </pre> <br>  dan di dalam kita membuat file menulis sendiri dan masuk ke mode edit <br><br><pre> <code class="bash hljs">touch docker-compose.yml &amp;&amp; nano docker-compose.yml</code> </pre> <br>  dan letakkan konten berikut di dalamnya <br><br><pre> <code class="markdown hljs">version: '3' services: jenkins: container_name: jenkins image: osipovaleks/docker-jenkins-android ports: - "8080:8080" restart: unless-stopped volumes: - "jenkins-data:/var/lib/jenkins" - "jenkins-home:/home/jenkins" volumes: jenkins-data: jenkins-home:</code> </pre> <br>  Di dalamnya, mungkin, hanya baris pertama yang memunculkan pertanyaan ( <code>version: '3'</code> ) yang menunjukkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">versi</a> kemampuan file penulisan, serta bagian dengan blok <code>volumes</code> yang mencantumkan daftar yang digunakan dalam wadah ini. <br><br>  Jalankan wadah Anda dengan perintah: <br><br><pre> <code class="bash hljs">docker-compose up -d</code> </pre> <br>  di mana flag <code>-d</code> juga menunjukkan bahwa kontainer akan dibuat dan diluncurkan di latar belakang.  Akibatnya, Docker harus menunjukkan sesuatu seperti berikut: <br><blockquote>  Membuat volume "jenkinsproject_jenkins-data" dengan driver default <br>  Membuat volume "jenkinsproject_jenkins-home" dengan driver default <br>  Menarik jenkins (osipovaleks / docker-jenkins-android: terbaru) ... <br>  terbaru: Menarik dari osipovaleks / docker-jenkins-android <br>  6cf436f81810: Tarik selesai <br>  987088a85b96: Tarik selesai <br>  b4624b3efe06: Tarik selesai <br>  d42beb8ded59: Tarik selesai <br>  b3896048bb8c: Tarik selesai <br>  8eeace4c3d64: tarik selesai <br>  d9b74624442c: Tarik selesai <br>  36bb3b7da419: Tarik selesai <br>  31361bd508cb: Tarik selesai <br>  cee49ae4c825: tarik lengkap <br>  868ddf54d4c1: Tarik selesai <br>  361bd7573dd0: Tarik selesai <br>  bb7b15e36ae8: Tarik selesai <br>  97f19daace79: Tarik selesai <br>  1f5eb3850f3e: Tarik selesai <br>  651e7bbedad2: Tarik selesai <br>  a52705a2ded7: Tarik selesai <br>  Intisari: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Status: Diunduh gambar yang lebih baru untuk osipovaleks / docker-jenkins-android: latest <br>  Membuat jenkins ... <br>  Membuat jenkins ... selesai </blockquote>  Ingat, saya mengatakan bahwa nama volume yang dibuat akan tergantung pada nama proyek?  Jalankan perintah: <br><br><pre> <code class="bash hljs">docker volume ls</code> </pre> <br>  dan kami mendapatkan output seperti itu <br><blockquote>  NAMA VOLUME DRIVER <br>  jenkinsproject_jenkins-data lokal <br>  jenkinsproject_jenkins-rumah lokal </blockquote>  di mana kita akan melihat bahwa meskipun fakta bahwa nama untuk volume dipilih oleh <code>jenkins-home</code> , pada kenyataannya, awalan dari nama proyek menempel padanya dan volume nama ternyata <code><b>jenkinsproject</b> _jenkins-home</code> </li></ol><br><br>  Opsi startup mana yang digunakan?  Di sini Anda dapat memilih sendiri, diyakini bahwa Docker Compose lebih merupakan alat untuk meluncurkan beberapa kontainer sekaligus, yang terikat satu sama lain, dan jika Anda hanya perlu menjalankan satu kontainer, maka Anda dapat menggunakan <code>docker run</code> . <br><br>  Sekarang setelah sub-langkah ini untuk memulai dan mengkonfigurasi server, serta memulai wadah dengan Jenkins, kita dapat melanjutkan ke konfigurasi awal <br><br><h4>  Penyiapan Jenkins awal </h4><br>  Ambil alamat ip dari server kami, tambahkan port 8080 yang ditunjukkan oleh kami kepadanya dan ikuti tautan ini di browser. <br><br> <code>http://YOUR_IP_ADDRESS:8080/</code> <br> <br>  Jika sebelumnya semuanya sudah dikonfigurasi dan dimulai dengan benar, maka di sini kita akan melihat gambar berikut <br><br><img src="https://habrastorage.org/webt/za/a5/bi/zaa5bi-5vkvscc-ww7gd2ouxjte.png"><br><br>  Untuk pengaturan pertama, kita perlu memasukkan kata sandi yang dihasilkan sistem saat instalasi.  Untuk melakukan ini, kita hanya perlu melihat isi file <code>/var/lib/jenkins/secrets/initialAdminPassword</code> .  Tetapi file ini ada di dalam wadah kami yang sedang berjalan, dan untuk membacanya, kita perlu terhubung ke wadah tersebut menggunakan perintah berikut: <br><br><pre> <code class="bash hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it jenkins /bin/bash</code> </pre> <br>  di mana opsi-itu mirip dengan menjalankan <code>docker run</code> , <code>jenkins</code> adalah nama kontainer kami, dan <code>/bin/bash</code> akan menjalankan <code>/bin/bash</code> untuk kita dalam wadah dan memberikannya akses.  Setelah itu, kita dapat melihat kata sandi awal untuk Jenkins: <br><br><pre> <code class="bash hljs">cat /var/lib/jenkins/secrets/initialAdminPassword</code> </pre> <br>  berikut ini muncul di konsol <br><blockquote>  91092b18d6ca4492a2759b1903241d2a </blockquote>  Ini kata sandinya. <br><br>  <i>Pengguna <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">ALexhha</a> menyarankan opsi yang lebih sederhana untuk membaca kata sandi ini, tanpa terhubung ke wadah itu sendiri.</i>  <i>Faktanya adalah bahwa pada saat meluncurkan Jenkins sendiri, kata sandi ini ditampilkan di log.</i>  <i>Ternyata yang kita butuhkan hanyalah membaca log kontainer.</i>  <i>Dalam kasus kami, ini dilakukan dengan perintah berikut:</i> <br><br><pre> <code class="bash hljs">docker logs jenkins</code> </pre> <br><br>  <i>di mana</i> <code>jenkins</code> <i>nama wadah kami, dan di log Anda dapat melihat yang berikut:</i> <br><br><blockquote>  *************************************************** *********** <br>  *************************************************** *********** <br>  *************************************************** *********** <br><br>  Diperlukan pengaturan awal Jenkins.  Pengguna admin telah dibuat dan kata sandi dibuat. <br>  Silakan gunakan kata sandi berikut untuk melanjutkan ke instalasi: <br><br>  91092b18d6ca4492a2759b1903241d2a <br><br>  Ini juga dapat ditemukan di: / var / lib / jenkins / secrets / initialAdminPassword <br><br>  *************************************************** *********** <br>  *************************************************** *********** </blockquote><br>  *************************************************** *********** <br><br>  <i>Opsi ini sedikit lebih sederhana dan lebih cepat.</i> <br><br>  Salin, tempel ke bidang <b>kata sandi Administrator</b> di antarmuka web dan klik <b>Lanjutkan</b> .  Pada layar berikutnya, pilih <b>Instal plugin yang disarankan</b> dan instal satu set plugin default. <br><br><img src="https://habrastorage.org/webt/bs/9d/xs/bs9dxsxd6-cddmut2bww9utxjw4.png"><br><br><img src="https://habrastorage.org/webt/r5/-m/u-/r5-mu-bgyaqswxcqnyrpds0qhic.png"><br><br>  Setelah menginstal plugin, buat pengguna untuk kami sendiri dan klik <b>Simpan dan Selesai</b> <br><br><img src="https://habrastorage.org/webt/iy/ap/jd/iyapjd__vdbys6jsjiinvzcp58q.png"><br><br>  Kami setuju dengan bagian Konfigurasi Instans, di mana kami diminta untuk mengisi URL tempat Jenkins akan bekerja (dalam kasus kami, biarkan semuanya apa adanya) <br><br><img src="https://habrastorage.org/webt/4v/w1/ie/4vw1ieq0o_tm5bkrgn4sb-m__kk.png"><br><br>  Dan di layar berikutnya, klik <b>Start yang</b> disukai <b>menggunakan Jenkins</b> <br><br><img src="https://habrastorage.org/webt/4a/iw/yq/4aiwyqwkzbxjdkjwyzowxyvsktc.png"><br><br>  Jadi, kami menginstal dan meluncurkan Jenkins! <br><br><img src="https://habrastorage.org/webt/9a/4z/tu/9a4ztunwk1gxuc8rsho2ql9-tou.png"><br><br>  Sudah cukup mungkin untuk bekerja dengannya, tetapi untuk mengumpulkan Android build kami, Anda perlu mengonfigurasi beberapa poin lagi.  Pelokalan Jenkins terkait dengan bahasa yang dipilih pada peramban Anda, dan tentu saja terjemahan ke dalam bahasa Rusia belum sepenuhnya selesai, dan kami mendapatkan campuran yang sangat besar dari bahasa Rusia dan Inggris.  Jika Anda berhasil dengan cara yang persis sama, dan itu membuat Anda marah, maka Anda dapat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plug-in</a> khusus dan mengatur bahasa antarmuka default.  Baik, atau alihkan browser Anda ke antarmuka bahasa Inggris. <br><br>  Pergi ke pengaturan Jenkins dan pilih <b>Konfigurasi Sistem.</b> <br><br><img src="https://habrastorage.org/webt/pk/xo/1d/pkxo1diloanswc7tciicxhaiidq.png"><br><br>  Periksa <b>variabel Lingkungan</b> , dan masukkan nama <b>ANDROID_HOME</b> di bidang, dan tentukan <b>/ var / lib / android-sdk /</b> di bidang (kami menentukan data ini di Dockerfile sebagai direktori home untuk Android SDK). <br><br><img src="https://habrastorage.org/webt/on/af/4j/onaf4jfhel5_ys078k5ohrxwxuu.png"><br><br>  Klik pada tombol <b>Simpan</b> , keluar dari bagian pengaturan ini dan pergi ke bagian yang disebut <b>Konfigurasi Alat Global</b> . <br><br><img src="https://habrastorage.org/webt/b9/3i/zx/b93izxlndc-utyrnewgv5kluug0.png"><br><br>  Siapkan partisi <b>JDK</b> (di mana variabel JAVA_HOME juga diisi oleh kami di Dockerfile, dan kita dapat menggunakan nilainya <b>/ usr / lib / jvm / java-8-openjdk-amd64 / di sini</b> ). <br><br><img src="https://habrastorage.org/webt/0l/wn/2p/0lwn2prv62virmofscvskc5e6_8.png"><br><br>  Juga di sini kita masih perlu mengisi bagian <b>Gradle</b> .  Kami memilih dan menginstal versi Gradle yang digunakan dalam proyek-proyek yang akan Anda bangun menggunakan sistem CI ini.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat memiliki beberapa versi. Anda juga tidak bisa memulai variabel Gradle sama sekali jika Anda memiliki gradlew di repositori, misalnya, dan Anda bisa membuatnya dengan itu. </font></font><br><br><img src="https://habrastorage.org/webt/0q/fe/wj/0qfewj73fbwr3vzudpk8woyrsmy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan ini kita bisa mengakhiri tahap pertama kita. Sistem Jenkins sepenuhnya operasional dan kita dapat beralih ke menyesuaikan tugas membangun sendiri. Harap perhatikan bahwa sistem ini disesuaikan dengan kebutuhan kami dan mungkin tidak menyediakan apa yang Anda butuhkan - misalnya, tidak ada emulator Android untuk pengujian dan NDK.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika artikel ini menarik minat siapa pun, maka saya akan melanjutkan di bagian kedua dengan contoh satu atau dua kerepotan, saya akan menjelaskan integrasi Jenkins dan Bitbucket (dialah, bukan Github, karena ada lebih mudah dengan repositori pribadi gratis dan artikel di Internet tentang lebih kecil, tapi mungkin lebih menyenangkan), saya akan memberi tahu Anda cara berteman dengan kunci ssh dari wadah kami dengan repositori, tentang pemberitahuan email, serta beberapa keripik lainnya. </font><font style="vertical-align: inherit;">Secara umum, tentang segala sesuatu yang kami konfigurasikan. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya meminta Anda untuk tidak terlalu banyak menendang, ini adalah artikel pertama saya tentang Habr. </font><font style="vertical-align: inherit;">Baik untuk semua!</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id443606/">https://habr.com/ru/post/id443606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id443594/index.html">Persimpangan Pengujian dan Arsitektur: Wawancara dengan Neil Ford</a></li>
<li><a href="../id443598/index.html">Ada pencabutan massal sertifikat TLS dari banyak CA, keliru yang dihasilkan pada RNG 63-bit, bukan 64-bit</a></li>
<li><a href="../id443600/index.html">Tren terbaik dan terburuk MWC 2019</a></li>
<li><a href="../id443602/index.html">Apa itu Aliasing Ketat dan mengapa kita harus peduli? Bagian 2</a></li>
<li><a href="../id443604/index.html">MOBILE FIRST: Hackathon di OZON</a></li>
<li><a href="../id443608/index.html">Smart Home / Pembaruan di Lazurite</a></li>
<li><a href="../id443612/index.html">Kami menggunakan HDD buruk lama</a></li>
<li><a href="../id443614/index.html">YouTrack 2019.1: pilih papan Agile, bidang kartu yang dapat disesuaikan pada papan Agile, dan banyak lagi</a></li>
<li><a href="../id443616/index.html">35% pengembalian saham pada data alternatif</a></li>
<li><a href="../id443618/index.html">Emulator komputer 80-an di browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>