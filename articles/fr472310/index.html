<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â›¹ğŸ» ğŸ¤˜ğŸ½ ğŸ… Identification des clients sur les sites sans mots de passe et cookies: application pour standard ğŸ¤¶ğŸ¼ ğŸ”Œ ğŸ‘‡ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cher habrozhitel! Chers experts! Je prÃ©sente pour votre Ã©valuation un nouveau concept d'identification des utilisateurs sur les sites Web qui, je l'es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identification des clients sur les sites sans mots de passe et cookies: application pour standard</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="image"><br><br>  Cher habrozhitel!  Chers experts!  Je prÃ©sente pour votre Ã©valuation un nouveau concept d'identification des utilisateurs sur les sites Web qui, je l'espÃ¨re, deviendra avec votre aide un standard Internet ouvert, amÃ©liorant un peu ce monde Internet.  Il s'agit d'une version provisoire du protocole d'authentification sans mot de passe, conÃ§ue comme un article gratuit.  Et si l'idÃ©e sous-jacente reÃ§oit une Ã©valuation positive de votre part, cher lecteur, je continuerai Ã  la publier sur reddit.com et rfc-editor.org.  Et j'espÃ¨re que je pourrai intÃ©resser les dÃ©veloppeurs des principaux navigateurs Ã  sa mise en Å“uvre.  Par consÃ©quent, j'attends de vous des critiques constructives. <br><br>  Attention: beaucoup de texte. <br><br><a name="habracut"></a><br>  La question est donc.  Est-il possible d'identifier sans ambiguÃ¯tÃ© les visiteurs du site sans divulguer leurs donnÃ©es personnelles et le suivi entre les diffÃ©rents sites?  Est-il possible, en rÃ©solvant un tel problÃ¨me, d'abandonner complÃ¨tement la forme d'autorisation la plus primitive par login / mot de passe et d'utiliser cookie / localStorage? <br><br>  D'une part, les sites doivent reconnaÃ®tre un client afin, par exemple, de Â«restaurerÂ» leurs paramÃ¨tres, panier de produits, publicitÃ©s, articles, etc.  D'autre part, les visiteurs souhaitent rester aussi anonymes que possible, sans rÃ©vÃ©ler leurs donnÃ©es personnelles, et empÃªcher les sites tiers de les suivre.  Et ces derniers peuvent le faire en Ã©changeant entre eux les donnÃ©es collectÃ©es. <br><br>  Cela ressemble Ã  une tÃ¢che pour s'assurer que les loups sont pleins et que les moutons sont en sÃ©curitÃ©.  Est-ce rÃ©el? <br><br>  Dans une certaine mesure, je pense - vraiment. <br><br><h1>  Table des matiÃ¨res </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1 concept d'authentification sans mot de passe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.1 ClÃ©s et jetons au lieu de connexions et mots de passe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.2 Structure des jetons</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhj7nU6O5YVJjsr21uk6tX9oIBuwVg#">1.3 En-tÃªtes de protocole HTTP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.4 Comment les clients identifient-ils les sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.4.2 Comment savoir si un site prend en charge ce protocole?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.5 Comment les clients autorisent-ils les sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.6 Comment mettre en place une identification client fiable?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.7 Autorisation sur le site vue par l'utilisateur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.8 Comment une clÃ© de site change-t-elle?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.9 Comment lâ€™autorisation interdomaines est-elle mise en Å“uvre?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.10 Comment implÃ©menter l'authentification inter-domaines?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.11 MobilitÃ© du compte</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 Description technique du protocole</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.0 Algorithme de gÃ©nÃ©ration de clÃ©s de domaine</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.1 l'algorithme de calcul du jeton source</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.2 Algorithme de protection des jetons pendant le transfert</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.3 ProcÃ©dure d'Ã©change de sel entre le navigateur et le serveur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.4 RÃ¨gles pour la formation du champ Contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.5 RÃ¨gles de dÃ©finition des champs expÃ©diteur et destinataire</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.6 DÃ©tails sur les tables de dÃ©finition de contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.7 ScÃ©narios de protocole</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.8 Traitement des jetons sur le serveur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.9 Authentification interdomaine</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3 Recommandations de sÃ©curitÃ©</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.1 Protection des informations clÃ©s contre les accÃ¨s non autorisÃ©s</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.2 Ã€ propos des mots de passe en tant que clÃ©s de domaine</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.3 Risques de perdre / compromettre des clÃ©s et de les minimiser</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4 Attaques contre le rÃ©gime d'autorisation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.1 Suivi des utilisateurs</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.2 Attaque XSS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.3 Attaque CSRF</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.4 Suivi Ã  l'aide de l'authentification unique</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.5 Compromis clÃ© pour l'authentification unique</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.6 Compromission de jetons pendant le transfert</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.7 Piratage d'un site Web et compromission de jetons</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">Quel est le problÃ¨me avec les mots de passe?</b> <div class="spoiler_text">  Oui, ce nâ€™est pas le cas.  Ils peuvent Ãªtre perdus.  Ils peuvent Ãªtre volÃ©s.  Il faut s'en souvenir.  Quoi qu'il en soit, pourquoi suis-je obligÃ© de remplir une forme d'inscription et de trouver un autre mot de passe pour voir la mÃ©tÃ©o ou tÃ©lÃ©charger ce fichier?  Enfin, les mots de passe sont lÃ©gÃ¨rement infÃ©rieurs Ã  beaucoup.  Combien de sites vous aimez, autant de mots de passe.  Et par consÃ©quent, beaucoup utilisent un seul mot de passe sur tous les sites.  Quelqu'un utilise un algorithme dÃ©licat pour s'en souvenir.  Ou un gestionnaire de mots de passe.  Ou, bÃªtement, un cahier.  Ou prÃ©fÃ¨re l'authentification entre domaines: vous vous connectez une seule fois sur un seul site, et c'est tout!  Oui, pas tous.  C'est si le site le prend en charge. <br>  Toutes ces approches prÃ©sentent des inconvÃ©nients. <br>  Utilisez un mot de passe sur diffÃ©rents sites - Moveton.  Ce que deux personnes savent, le cochon le sait aussi.  Tous les sites (mÃªme grands et rÃ©putÃ©s) ne respectent pas honnÃªtement les rÃ¨gles de sÃ©curitÃ© pour le stockage de vos mots de passe.  Certains sites stockent les mots de passe sous forme ouverte, tandis que d'autres pensent que le stockage des hachages de mot de passe les protÃ¨ge dÃ©jÃ  suffisamment.  En consÃ©quence, des fuites de mots de passe et d'autres donnÃ©es personnelles des clients se produisent rÃ©guliÃ¨rement. <br>  Avec le gestionnaire de mots de passe, c'est dÃ©jÃ  mieux.  Certes, personne ne vous garantit qu'il ne fusionne pas vos mots de passe quelque part.  Et allez trouver un gestionnaire qui peut synchroniser vos comptes sur tous les appareils (netbook domestique, tÃ©lÃ©phone, ordinateur de travail).  Je n'exclus pas que cela existe. <br>  Mais en tout cas, l'idÃ©e elle-mÃªme: inscrivez-vous d'abord sur notre site Web (en mÃªme temps, envoyez un e-mail, mobile, donnez du sang pour analyse), puis inventez / mÃ©morisez votre nom d'utilisateur et votre mot de passe et soyez assez gentil pour vous en souvenir, mais gardez-les secrets - approche, je vous le dis, so-so.  Et pas un seul gestionnaire de mots de passe ne le rÃ©soudra.  Mais cela rÃ©sout le <abbr title="Technologie d'authentification unique implÃ©mentÃ©e par divers protocoles tels que SAML, OAuth, Kerberos">SSO</abbr> . <br>  C'est juste de la malchance: si vous perdez le mot de passe du site SSO et l'oubliez, ou s'il vous a Ã©tÃ© volÃ© ... Vous perdez l'accÃ¨s Ã  tous vos sites Ã  la fois ou vous le donnez volontairement Ã  quiconque et il n'est pas clair avec quelles intentions.  <b>Ne stockez pas tous les Å“ufs dans le mÃªme panier!</b> <br>  Et ce n'est pas un fait que le site SSO est fiable.  Ou ne stocke pas vos mots de passe en texte clair.  Ou ne les fusionne pas du tout volontairement, et offre Ã©galement Ã  d'autres la possibilitÃ© de vous suivre entre les sites.  Eh bien, vous obtenez le point. <br>  Par consÃ©quent: login + mot de passe = evil.  Et tout le mal dans le monde devrait Ãªtre bu sÃ©rieusement et pendant longtemps.  Et un cookie aussi.  Avec ses crocodiles de session PHPSESSIONID, JSESSIONID et leurs analogues. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Et que faire?</b> <div class="spoiler_text">  Vous devez d'abord considÃ©rer des situations typiques, Ã  partir desquelles il sera clair: pourquoi les sites veulent-ils se souvenir de leurs clients et est-ce vraiment nÃ©cessaire pour eux? <br><ol><li>  Blog personnel "Vasya Pupkina", dans lequel, par exemple, les commentaires sont autorisÃ©s.  L'inscription n'est nÃ©cessaire que pour se protÃ©ger des bots, procÃ©der Ã  des votes gratuits, compter les Â«likesÂ» et autres Â«meow-meowÂ» et attribuer une note aux commentateurs.  C'est-Ã -dire  Ici <b>, la fonctionnalitÃ© de suivi est nÃ©cessaire exclusivement par le site</b> , et seulement dans une faible mesure - par l'utilisateur (s'il apprÃ©cie sa note Â«commentateurÂ» sur ce site). </li><li>  Sites de rÃ©seaux sociaux et autres locuteurs Internet (ICQ, skype - lÃ  aussi).  L'inscription est nÃ©cessaire pour implÃ©menter le contenu nommÃ© (auteur), pour identifier les visiteurs les uns des autres.  C'est-Ã -dire  Ici <b>, la fonctionnalitÃ© d'identification est plus largement nÃ©cessaire par les utilisateurs eux-mÃªmes</b> .  Bien que les sites de rÃ©seaux sociaux soient les premiers dans la liste des "pÃ©cheurs", ils collectent les informations les plus complÃ¨tes sur les visiteurs et se souviennent de vous sÃ©rieusement et longtemps.  On ne sait donc pas encore qui a le plus besoin d'Ãªtre identifiÃ©. </li><li>  Site d'entreprise avec contenu fermÃ©.  L'enregistrement ou l'autorisation ici est nÃ©cessaire principalement pour restreindre l'accÃ¨s au contenu.  Toutes sortes de: Ã©coles en ligne, bibliothÃ¨ques, sites privÃ©s non publics, etc.  Ici <b>, la fonctionnalitÃ© d'autorisation est plus largement nÃ©cessaire par le site</b> .  En rÃ¨gle gÃ©nÃ©rale, aucun formulaire d'inscription n'est ouvert.  Les informations d'identification sont partagÃ©es via d'autres canaux. </li><li>  Une boutique en ligne et une autre plate-forme similaire vendant des articles, des services ou du contenu.  J'inclurai Ã©galement des sites d'annonces classÃ©es payantes / gratuites.  L'inscription est principalement nÃ©cessaire pour stocker l'historique des commandes des clients, et pour qu'il puisse suivre leur statut actuel, stocker leurs prÃ©fÃ©rences (favoris);  afin de formuler des offres personnelles au client en fonction de l'historique d'achat et des prÃ©fÃ©rences.  Ici <b>, la fonctionnalitÃ© d'identification est Ã©galement nÃ©cessaire pour le client et le magasin</b> .  Mais plus, bien sÃ»r, au magasin.  Vapeur, vapeur et vapeur. </li><li>  Tous les comptes personnels des utilisateurs des services Internet: e-mail, services publics, Sberbank-online, mÃ©gaphone-online, bureaux de fournisseurs, CMS des hÃ©bergeurs, etc.  Ici <b>, l'utilisateur lui-mÃªme est principalement intÃ©ressÃ© par une identification correcte et fiable</b> .  AprÃ¨s tout, il gÃ¨re des informations importantes pour lui-mÃªme, ce qui dans certaines situations a des consÃ©quences juridiques et financiÃ¨res.  Ã‡a ne sent pas comme l'anonymat.  Elle est nuisible ici. </li><li>  Routeurs, consoles de gestion, versions Web de la gestion de quelque chose sur votre rÃ©seau domestique ou d'entreprise. </li></ol><br><br>  Il est clair que dans diffÃ©rentes situations, il peut y avoir diffÃ©rents risques.  Dans certains cas, une identification incorrecte, la perte de donnÃ©es d'authentification, voire le vol / falsification de celles-ci, n'entraÃ®nera aucune consÃ©quence significative pour le site ou pour l'utilisateur.  Dans d'autres, ce sera juste dÃ©sagrÃ©able (j'ai perdu du karma sur HabrÃ© - "c'est un dÃ©sastre ...") ou conduira Ã  des dÃ©sagrÃ©ments (je ne peux pas me laisser aller Ã  Yula, voir mes annonces; j'ai profilÃ© l'accÃ¨s Ã  mes projets sur github, - okay nouveau compte, projets fork).  TroisiÃ¨mement, elle peut entraÃ®ner des consÃ©quences juridiques et financiÃ¨res.  Par consÃ©quent, il faut supposer que le rÃ©gime d'autorisation proposÃ© n'est pas une Â«solution miracleÂ» pour tous les cas, en particulier Â«nuÂ».  <b>Lorsque des informations sensibles sont gÃ©rÃ©es, il convient d'utiliser d'autres mÃ©thodes d'identification et d'authentification</b> ou leur combinaison (authentification Ã  deux facteurs, cryptographie Ã  clÃ© asymÃ©trique, 3D-secure, eToken, OTP-Token, etc.). <br><br>  Oh bien.  Quel est votre savoir traditionnel? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Qu'offre le nouveau protocole?</b> <div class="spoiler_text">  Du point de vue de l'utilisateur final: <br><ol><li>  Le site doit se souvenir et reconnaÃ®tre le visiteur sans aucune contribution de l'utilisateur;  le site devrait vous reconnaÃ®tre Ã  la fois au sein de la session et entre les diffÃ©rentes sessions.  Pas de cookies, mots de passe ou inscriptions.  Dans le mÃªme temps, diffÃ©rents sites ne devraient pas Ãªtre en mesure <i>d'</i> identifier de maniÃ¨re unique le mÃªme visiteur, Ã©tant en mesure de suivre leur activitÃ© sur ces sites et sur d'autres.  C'est-Ã -dire  les sites ne devraient pas Ãªtre en mesure de regrouper les informations pour leurs visiteurs. </li><li>  L'utilisateur doit pouvoir Â« <b>oublier n'importe quel site</b> Â» Ã  tout moment;  et le site oubliera l'utilisateur.  Il devrait y avoir la possibilitÃ© d'accorder des droits au site pour se souvenir du client Ã  l'initiative du client (sans popup obsessionnel).  L'utilisateur doit pouvoir migrer en toute sÃ©curitÃ© son identitÃ© virtuelle entre diffÃ©rents appareils et navigateurs (s'il en a besoin) afin d'avoir une seule autorisation sur ses sites favoris. </li></ol><br><br>  Je vois.  Et quels bonus les dÃ©veloppeurs de sites devraient-ils en retirer? <br><ol><li>  Une procÃ©dure d'identification plus simple: il n'est pas nÃ©cessaire de crÃ©er pour la milliÃ¨me fois la prochaine forme de connexion, dÃ©connexion, enregistrement, modification et rÃ©cupÃ©ration de mot de passe.  Il suffit d'activer le module de support de protocole pour votre framework prÃ©fÃ©rÃ©, implÃ©mentÃ© sur la base du standard. </li><li>  Il n'est pas nÃ©cessaire qu'un concepteur dessine un formulaire de connexion et rÃ©flÃ©chisse Ã  l'endroit oÃ¹ le cacher sur un petit Ã©cran mobile.  Le protocole rend les formulaires inutiles.  Eh bien, sauf que le formulaire d'inscription.  OÃ¹ est-il alors sans eux?  HÃ©las. </li></ol><br><br>  Enfin: <br><ol><li>  Le protocole d'authentification doit Ãªtre unifiÃ© et standardisÃ©;  VÃ©rifiÃ© par des experts en sÃ©curitÃ©  ApprouvÃ© et recommandÃ© par les comitÃ©s de normalisation Web.  En consÃ©quence, la possibilitÃ© de commettre des erreurs classiques de la part des webmasters lors du dÃ©veloppement de formulaires de connexion / dÃ©connexion standard, de la modification / rÃ©cupÃ©ration de mots de passe (transmission de mots de passe sous forme claire, utilisation incorrecte du hachage, stockage de mots de passe ou hachages Â«non salÃ©sÂ» dans la base de donnÃ©es, dÃ©tournement de mots de passe utilisateur lorsque site de piratage). </li><li>  L'autorisation doit Ãªtre fiable dans une certaine mesure (protÃ©gÃ©e contre la falsification, l'accÃ¨s non autorisÃ©, avec une authentification garantie);  Ne crÃ©ez pas de nouvelles vulnÃ©rabilitÃ©s sur les pages Web et les navigateurs;  si possible, rÃ©duisez les risques d'attaques rÃ©seau connues dÃ¨s le dÃ©part.  Eh bien, ou du moins une rÃ©duction significative des risques d'une mise en Å“uvre rÃ©ussie. </li></ol><br><br>  Sur la base de ces exigences, nous nous tournons vers le plus intÃ©ressant: la conception d'un nouveau protocole. <br></div></div><br><br><a name="part1"></a><h1>  1 concept d'authentification sans mot de passe </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 ClÃ©s et jetons au lieu de connexions et mots de passe </h2><br>  Pour chaque domaine, y compris les enfants, le navigateur client gÃ©nÃ¨re alÃ©atoirement une clÃ© unique de 256 bits <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Cette clÃ© n'est jamais transmise.</b>  Reste constant dans la session de l'utilisateur.  Chaque nouvelle session crÃ©e une nouvelle clÃ©. <br>  BasÃ© sur une clÃ© <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  le navigateur gÃ©nÃ¨re un jeton 256 bits <sup>*</sup> Ã  l'aide d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">algorithme spÃ©cial</a> <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  pour identifier l'utilisateur avec un domaine spÃ©cifique.  Jeton d'identification <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  l'utilisateur (ci-aprÃ¨s simplement appelÃ© le jeton) remplace les cookies de session comme PHPSESSIONID et JSESSIONID. <br>  ClÃ© <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  peut Ãªtre " <b>corrigÃ©</b> " par l'utilisateur.  La fixation de la clÃ© permettra Ã  l'utilisateur de rester autorisÃ© sur le site pour une durÃ©e illimitÃ©e dans diffÃ©rentes sessions de navigateur et de retourner l'autorisation prÃ©cÃ©demment existante.  Il s'agit d' <b>un analogue de la fonction Â«se souvenir de moiÂ»</b> . <br>  Lorsque la validation est annulÃ©e, le navigateur Â«oublieraÂ» cette clÃ© et recommencera Ã  gÃ©nÃ©rer une clÃ© alÃ©atoire pour ce domaine pour chaque nouvelle session (Ã  partir de la session actuelle), ce qui <b>est analogue Ã  la Â«sortieÂ»</b> de l'utilisateur du site.  La sortie est instantanÃ©e, ne nÃ©cessitant pas de rechargement de page. <br>  L'utilisateur peut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crÃ©er une clÃ© permanente pour le domaine</a> .  La clÃ© permanente, ainsi que la clÃ© fixe, permettra Ã  l'utilisateur de retourner l'autorisation prÃ©cÃ©dente.  En fait, cette <b>clÃ© devient un remplacement pour la connexion login-mot de passe.</b> <br>  L'utilisateur a la possibilitÃ© de contrÃ´ler quand le navigateur du domaine utilisera une clÃ© constante et quand - alÃ©atoire.  Il s'agit d' <b>un analogue de la fonction de connexion / dÃ©connexion</b> .  Le concept <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est prÃ©sentÃ© dans les captures d'Ã©cran ci-dessous</a> . <br>  Les mÃ©thodes de gÃ©nÃ©ration de clÃ©s de domaine persistantes assurent la mobilitÃ© des comptes d'utilisateurs entre diffÃ©rents appareils.  Le protocole dÃ©finit les Ã©lÃ©ments suivants: <br><ul><li>  gÃ©nÃ©ration d'une clÃ© de domaine basÃ©e sur une clÃ© principale d'utilisateur </li><li>  formation individuelle d'une clÃ© de domaine sur la base d'un capteur biologique de nombre alÃ©atoire </li><li>  importation de clÃ©s existantes Ã  partir d'un fichier de clÃ©s Ã  partir d'un autre appareil </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Structure des jetons </h2><br>  Le jeton est une structure de 256 bits, reprÃ©sentÃ©e sous la forme d'une chaÃ®ne hexadÃ©cimale: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  piÃ¨ce d'identification </td><td>  partie d'authentification </td></tr></tbody></table></div><br>  La partie d'identification du jeton (les 128 bits les plus Ã©levÃ©s) est similaire Ã  la connexion.  Par cette sÃ©quence de bits, le serveur peut identifier de maniÃ¨re unique l'utilisateur. <br>  La partie d'authentification du jeton (les 128 bits infÃ©rieurs) est similaire au mot de passe.  Cette sÃ©quence de bits aide le serveur Ã  valider le jeton. <br>  Les rÃ¨gles de validation des jetons sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dÃ©crites ci-dessous</a> . <br><br><a name="http_headers"></a><h2>  1.3 En-tÃªtes de protocole HTTP </h2><br>  <b>En-tÃªtes utilisÃ©s par le client:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; est utilisÃ© pour envoyer un jeton au serveur <br>  <b>CSI-Token</b> : &lt;Token1&gt;;  <b>Changed-To</b> &lt;Token2&gt; est utilisÃ© pour changer le jeton actuel: <br><ul><li>  lors de l'autorisation sur une clÃ© permanente, </li><li>  lors de l'enregistrement d'une clÃ© permanente, </li><li>  lors du changement de la clÃ© permanente. </li></ul><br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Permanent est</b> utilisÃ© lors de la fixation de la clÃ© alÃ©atoire actuelle par l'utilisateur. <br>  <b>CSI-Token</b> : &lt;Token&gt; La <b>dÃ©connexion est</b> utilisÃ©e pour mettre fin prÃ©maturÃ©ment Ã  la session en cours. <br><br>  <b>En-tÃªtes utilisÃ©s par le serveur:</b> <br>  <b>Support CSI: oui</b> indique au client que le serveur prend en charge le protocole d'autorisation CSI. <br>  <b>CSI-Token-Action: le succÃ¨s est</b> utilisÃ© pour informer le navigateur de l'acceptation d'un nouveau jeton d'utilisateur (clÃ© de changement). <br>  <b>CSI-Token-Action: abandonner</b> annule la procÃ©dure de changement des jetons (retour au jeton prÃ©cÃ©dent). <br>  <b>CSI-Token-Action: l'enregistrement</b> indique au navigateur que le nouveau jeton d'utilisateur est toujours en cours d'enregistrement. <br>  <b>CSI-Token-Action:</b> erreur de vÃ©rification de jeton cÃ´tÃ© serveur <b>non valide</b> . <br><br>  Enfin <br>  <b>CSI-Salt est</b> envoyÃ© Ã  la fois par le navigateur et le serveur lors de l'Ã©change du Â«selÂ» utilisÃ© pour protÃ©ger le jeton (partie authentification).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voir ci-dessous pour</a> plus de dÃ©tails. <br><br><a name="how_site_identify_us"></a><h2>  1.4 Comment les clients identifient-ils les sites? </h2><br>  Un site peut utiliser un jeton pour identifier un visiteur du site.  Dans le mÃªme temps, le schÃ©ma de gÃ©nÃ©ration de jetons et leur capacitÃ© de 256 bits <b>garantissent des jetons uniques pour chaque paire:</b> domaine utilisateur.  Un autre domaine verra un autre jeton utilisateur.  MÃªme s'il est exÃ©cutÃ© dans le contexte du site cible (via IFRAME, IMG, LINK, SCRIPT).  De plus, un algorithme spÃ©cial de gÃ©nÃ©ration de jetons protÃ¨ge les utilisateurs contre les attaques XSS et SRF et rend impossible le suivi d'un utilisateur Ã  son insu.  Mais en mÃªme temps, la technologie <abbr title="Technologie d'authentification unique implÃ©mentÃ©e par divers protocoles tels que SAML, OAuth, Kerberos">SSO reste</abbr> possible avec sa permission et son identification inter-domaines. <br>  Le token <b>est transmis dans l'en-tÃªte HTTP CSI-Token</b> <u>avec chaque requÃªte</u> vers n'importe quelle ressource de domaine (page, document, image, script, style, police, fichier, requÃªte ajax, ...): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  Le jeton est <b>recalculÃ© <i>Ã  chaque</i> requÃªte HTTP (S)</b> : page, image, requÃªte ajax. <br>  Afin d'optimiser les calculs, la mise en cache des jetons par le navigateur est autorisÃ©e, mais uniquement pour la durÃ©e de la session et uniquement si les conditions de satisfaction de la demande restent inchangÃ©es. <br>  Comme indiquÃ© ci-dessus, le jeton peut remplacer les cookies de session tels que PHPSESSIONID et JSESSIONID.  La seule diffÃ©rence est que si le site gÃ©nÃ©rait prÃ©cÃ©demment un identifiant permettant au visiteur de suivre un utilisateur spÃ©cifique entre ses diffÃ©rentes demandes (aprÃ¨s tout, des milliers de demandes d'utilisateurs diffÃ©rents arrivent sur le site en mÃªme temps), le client lui-mÃªme remplit dÃ©sormais cette fonction. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une telle identification est tout Ã  fait suffisante pour vous permettre de faire des achats dans la boutique en ligne, de faire de la publicitÃ© sur des sites appropriÃ©s, d'Ã©crire sur des forums, sur des rÃ©seaux sociaux, sur Wikipedia ou sur des articles HabrÃ©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, l'utilisateur reste anonyme pour le site. Mais il peut s'agir d'un Â«familierÂ» anonyme du site. Et le serveur peut enregistrer le jeton d'un tel utilisateur de son cÃ´tÃ©, ainsi que ses donnÃ©es (compte personnel avec achats, prÃ©fÃ©rences, karma, brioches, likes et autres bonus). Mais seulement pour garder sous condition l'achÃ¨vement de tout processus commercial: achat, soumission de l'annonce, etc. Les conditions sont dÃ©terminÃ©es par le site lui-mÃªme.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, le protocole est aussi simple que possible pour les sites qui n'ont pas besoin de vous inscrire avant de vous donner la possibilitÃ© de prendre des mesures. </font><font style="vertical-align: inherit;">Mais ceux qui en ont besoin auront un peu plus de mal. </font><font style="vertical-align: inherit;">Mais plus Ã  ce sujet ci-dessous.</font></font><br><br><a name="how_we_know_what_sci_supported"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.4.2 Comment savoir si un site prend en charge ce protocole? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site doit transmettre le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Support: oui</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> http-header </font><font style="vertical-align: inherit;">dans la section Response Headers de sa rÃ©ponse:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En voyant un tel titre, le navigateur informera discrÃ¨tement l'utilisateur qu'il peut se sauver sur le site. </font><font style="vertical-align: inherit;">Par exemple, le symbole clÃ© dans la barre d'adresse:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un clic sur une clÃ©, par exemple, crÃ©era une clÃ© pour le domaine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La formation d'une nouvelle clÃ© ne conduit pas Ã  son utilisation automatique. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La clÃ© permanente ne commence Ã  Ãªtre utilisÃ©e que lorsqu'elle est activÃ©e par l'utilisateur. </font></font><br><br><a name="how_make_authorization"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 Comment les clients autorisent-ils les sites? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est important de comprendre que le jeton ne rend pas encore l'utilisateur autorisÃ© sur un site particulier - seulement reconnaissable. </font><font style="vertical-align: inherit;">Mais, comme cela a dÃ©jÃ  Ã©tÃ© dit, vous n'Ãªtes pour l'instant qu'une Â«personne anonymeÂ» reconnaissable. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le site doit vous associer personnellement votre token, hÃ©las, l'inscription sur un tel site ne peut Ãªtre Ã©vitÃ©e. </font><font style="vertical-align: inherit;">Mais dans le protocole proposÃ©, cela est rendu un peu plus facile.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est important que les dÃ©veloppeurs le comprennent: la plupart des sites n'ont pas besoin de questionnaire. </font><font style="vertical-align: inherit;">Ã‰vitez de forcer les visiteurs Ã  s'inscrire. </font><font style="vertical-align: inherit;">Dans la plupart des situations typiques, vous pouvez exÃ©cuter un processus mÃ©tier sans collecter de visiteurs PD.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplir des formulaires d'inscription fastidieux Â«avec ou sansÂ» est dÃ©sagrÃ©able. </font><font style="vertical-align: inherit;">Mais avec le nouveau protocole, il n'est plus nÃ©cessaire de trouver un autre identifiant et mot de passe. </font><font style="vertical-align: inherit;">Seul le bouton Confirmer et me sauver:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sÃ»r, vous devrez d'abord crÃ©er une clÃ© permanente pour le site. </font><font style="vertical-align: inherit;">Mais il s'agit de quelques clics de souris. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et, bien sÃ»r, il vous sera demandÃ© de confirmer votre tÃ©lÃ©phone ou votre adresse postale. </font><font style="vertical-align: inherit;">Mais cela dÃ©pend dÃ©jÃ  du site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AprÃ¨s une autorisation rÃ©ussie, le serveur, via un en-tÃªte HTTP spÃ©cial, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informera le navigateur qu'il a acceptÃ© la nouvelle clÃ©. </font><font style="vertical-align: inherit;">Plus de dÃ©tails au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chapitre II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="how_implement_reliable_identification"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.6 Comment mettre en place une identification client fiable? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans les situations plus graves (compte personnel du fournisseur, hÃ©bergement, banque), une authentification Ã  deux facteurs doit et peut Ãªtre effectuÃ©e, et la preuve de la possession du jeton peut Ãªtre effectuÃ©e par le biais d'une prÃ©-inscription et d'une confirmation d'identitÃ© par d'autres moyens: par e-mail, SMS ou mÃªme en fixant le jeton de l'utilisateur sur papier. </font><font style="vertical-align: inherit;">(Oui, oui. Les certificats sont enregistrÃ©s sur papier, pourquoi pas des jetons).</font></font><br><br><a name="user_view_concept"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.7 Autorisation sur le site vue par l'utilisateur </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le navigateur informe l'utilisateur que le site prend en charge l'autorisation CSI via l'icÃ´ne de verrouillage dans la barre d'adresse. </font><font style="vertical-align: inherit;">Si vous effectuez certaines actions sur le site, vous pouvez demander au site de se souvenir de vous. </font><font style="vertical-align: inherit;">A partir de ce moment, le serveur reconnaÃ®tra l'utilisateur mÃªme entre diffÃ©rentes sessions:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu de fixer la clÃ©, l'utilisateur peut crÃ©er une clÃ© permanente pour le site et s'y inscrire. </font><font style="vertical-align: inherit;">Illustration animÃ©e:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">   .   .  .      . <br>     ,  Â« Â».      . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et lorsque l'utilisateur dispose d'une clÃ© permanente pour le site et que cette clÃ© y est enregistrÃ©e, le processus de connexion est grandement simplifiÃ©: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">   . ,    .  ,  Â«Â».   ,  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plus grande puissance du protocole se manifeste lorsque l'utilisateur crÃ©e une clÃ© pour le site en fonction de la clÃ© principale. </font><font style="vertical-align: inherit;">Dans ce cas, le </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problÃ¨me de votre identification sur des sites sur d'autres appareils</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est facilement </font><u><font style="vertical-align: inherit;">rÃ©solu</font></u><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'animation suivante le dÃ©montre. </font><font style="vertical-align: inherit;">Il est supposÃ© que vous avez dÃ©jÃ  distribuÃ© votre clÃ© principale une fois entre vos appareils / navigateurs:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour les sites avec une autorisation Ã  deux facteurs, la Â«reconnaissanceÂ» peut ressembler Ã  ceci: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sortie est encore plus facile. </font><font style="vertical-align: inherit;">Cliquez sur "DÃ©connexion" dans le navigateur et c'est tout:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le navigateur envoie une demande au site (sur n'importe quelle page) avec la mÃ©thode HEAD, dans laquelle il envoie l'en-tÃªte CSI-Token &lt;&gt;; </font><font style="vertical-align: inherit;">DÃ©connexion.</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le serveur, voyant un tel en-tÃªte, se dÃ©connecte. </font><font style="vertical-align: inherit;">S'il s'agissait d'une clÃ© fixe, le site supprime toutes les informations sur l'utilisateur (plus qu'une telle clÃ© n'apparaÃ®tra jamais). </font><font style="vertical-align: inherit;">S'il s'agissait d'une clÃ© permanente, interrompt simplement la session. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute autre activitÃ© du site transforme l'utilisateur en un anonymat inconnu du site: rechargement de la page, tentative de demande ajax, tÃ©lÃ©chargement d'un fichier, etc. </font><font style="vertical-align: inherit;">- Le navigateur enverra un jeton gÃ©nÃ©rÃ© dÃ©jÃ  sur la base d'une clÃ© alÃ©atoire.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez gÃ©rer les clÃ©s dans le gestionnaire de clÃ©s: modifier la clÃ© permanente, exporter la clÃ© permanente dans un fichier, importer Ã  partir d'un fichier Ã  partir d'un autre appareil. </font><font style="vertical-align: inherit;">Configurez la Â«sortie automatiqueÂ» aprÃ¨s avoir fermÃ© un onglet ou un navigateur. </font><font style="vertical-align: inherit;">DÃ©finissez la durÃ©e d'une clÃ© fixe.</font></font></blockquote><br><br><a name="how_user_can_change_key"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.8 Comment une clÃ© de site change-t-elle? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le remplacement de la clÃ© permanente du site revient techniquement Ã  passer d'une clÃ© alÃ©atoire Ã  une clÃ© permanente. </font><font style="vertical-align: inherit;">Ceci est dÃ©crit plus en dÃ©tail au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chapitre II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cas de modification de la clÃ© permanente du site, le navigateur notifie au site la modification correspondante du jeton, en envoyant un en </font><b><font style="vertical-align: inherit;">-</font></b><font style="vertical-align: inherit;"> tÃªte </font><b><font style="vertical-align: inherit;">CSI-Token</font></b><font style="vertical-align: inherit;"> avec la clÃ© </font><b><font style="vertical-align: inherit;">Changed-To </font></b></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã  chaque demande suivante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site doit traiter correctement une telle demande. </font><font style="vertical-align: inherit;">Et, si un jeton utilisateur donnÃ© est stockÃ© dans sa base de donnÃ©es, il doit effectuer un remplacement appropriÃ©. </font><font style="vertical-align: inherit;">Dans le mÃªme temps, le site devrait rÃ©pondre au navigateur au sujet du changement rÃ©ussi du jeton de son cÃ´tÃ©. </font><font style="vertical-align: inherit;">Il le fait dans l'en-tÃªte Response Headers avec le paramÃ¨tre: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action: succÃ¨s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indiquant le jeton appliquÃ©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site a le droit de rejeter une tentative de modification du jeton (par exemple, s'il n'y en avait pas dans sa base de donnÃ©es ou s'il ne les enregistre pas du tout) avec le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paramÃ¨tre CSI-Token-Action: abandonnÃ©. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jusqu'Ã  ce que le navigateur reÃ§oive l'en-tÃªte CSI-Token-Action, il ajoutera la clÃ© Changed-To Ã  chaque demande de jeton CSI du site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un analogue du Â«changement de mot de passeÂ» de l'utilisateur.</font></font></b> <br><br><a name="how_make_cross_domain_auth"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.9 Comment lâ€™autorisation interdomaines est-elle mise en Å“uvre? </font></font></h2><script type="text/javascript">function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('ru', 'fr', function () {});}</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=gtElInit&amp;client=wt"></script><br>  L'autorisation classique entre domaines utilisant la technologie <abbr title="Technologie d'authentification unique implÃ©mentÃ©e par divers protocoles tels que SAML, OAuth, Kerberos">SSO</abbr> prÃ©sente de nombreux avantages pour l'utilisateur.  Vous n'avez pas besoin de vous souvenir d'un tas de mots de passe provenant d'un tas de sites.  Il n'est pas nÃ©cessaire de s'inscrire et de remplir les formulaires mornes.  Certains serveurs d'autorisation demandent quels droits accorder au site qui a demandÃ© l'authentification unique. <br>  Mais il y a aussi des inconvÃ©nients.  <b>Vous dÃ©pendez du fournisseur SSO.</b>  Si le serveur SSO ne fonctionne pas, vous n'obtiendrez pas le site cible.  Si vous perdez votre mot de passe ou votre compte est volÃ© - vous perdez l'accÃ¨s Ã  tous les sites Ã  la fois. <br>  Pour les dÃ©veloppeurs web, les choses sont un peu plus compliquÃ©es.  Depuis le dÃ©but, vous devez enregistrer votre site sur le serveur d'autorisation, obtenir les clÃ©s, apprendre Ã  travailler avec le protocole ( <abbr title="Un standard ouvert pour l'Ã©change de donnÃ©es d'authentification et d'autorisation entre un fournisseur de compte et un fournisseur de services">SAML</abbr> , <abbr title="Un protocole d'autorisation ouvert qui permet de fournir Ã  un tiers un accÃ¨s limitÃ© aux ressources protÃ©gÃ©es de l'utilisateur sans avoir Ã  transfÃ©rer un identifiant et un mot de passe Ã  un tiers">OAuth</abbr> , etc.) et les bibliothÃ¨ques correspondantes, assurez-vous que la clÃ© n'expire pas, que le serveur d'autorisation ne bloque pas votre site pour vos raisons et etc.  Il s'agit d'une redevance pour le fait que vous n'avez pas besoin de conserver des comptes d'utilisateurs, de faire des formulaires d'inscription, de vous connecter, etc.  La vÃ©ritÃ© augmente le coÃ»t de la maintenance (sous forme de rÃ©paration de pannes soudaines).  Encore une fois, si le serveur est soudainement indisponible pour le site, alors hÃ©las. <br>  Ce schÃ©ma d'autorisation rend SSO un peu plus sÃ»r et l'autorisation pour tous les participants est plus facile.  La sÃ©curitÃ© sera discutÃ©e ci-dessous dans la section <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Compromis clÃ© pour l'authentification unique".</a> <br><br>  Jetez un Å“il au site S, qui prend en charge l'authentification unique de Google.  Supposons que vous ayez un compte Google.  Pour vous connecter, vous cliquez sur le lien "Se connecter avec Google", qui ouvrira l'onglet d'autorisation Google.  Le navigateur vous indiquera que vous avez une clÃ© pour Google.  Et Google vous dira quels droits S. demande. <br>  Si vous Ãªtes d'accord, cliquez sur "Connexion" dans le gestionnaire de clÃ©s.  La page se rechargera.  Google recevra dÃ©jÃ  son jeton valide, vous reconnaÃ®tra et vous autorisera.  Et avec une demande inter-serveur, il informera le Site S de vos informations de compte conformÃ©ment aux champs demandÃ©s. <br>  La page rechargÃ©e contiendra un bouton Â«SuivantÂ» qui vous ramÃ¨nera au site cible. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">Dans l'illustration</b> <div class="spoiler_text">  Il donnera un exemple de cet algorithme lors de son inscription sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com Ã  l'</a> aide d'une autorisation interdomaine via accounts.google.com. <br></div></div><br>  Le site S peut dÃ©cider de sauvegarder ou non des donnÃ©es vous concernant dans sa base de donnÃ©es.  Cette question dÃ©passe le cadre du rÃ©gime d'autorisation proposÃ©.  Mais en outre, lorsque nous examinerons les risques de perdre la clÃ© pour SSO, le site est recommandÃ© de conserver le jeton et l'identifiant utilisateur de SSO de son cÃ´tÃ©, et l'utilisateur est recommandÃ© de crÃ©er une clÃ© permanente pour S. <br><blockquote>  <b>VulnÃ©rabilitÃ©:</b> AprÃ¨s une telle autorisation, les sites S1, S2, S3, ... (oÃ¹ vous vous Ãªtes connectÃ© via Google) pourront vous reconnaÃ®tre (par l'identifiant qui vous a Ã©tÃ© attribuÃ© par Google) et, par consÃ©quent, suivre votre activitÃ©. </blockquote><br><blockquote>  <b>Option de protection:</b> ne fonctionne pas simultanÃ©ment sur les sites si vous vous Ãªtes inscrit via le SSO du mÃªme fournisseur.  Si possible, dÃ©connectez-vous du serveur d'autorisation immÃ©diatement aprÃ¨s la fin de l'autorisation (Â«sortie automatiqueÂ» pour le domaine). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 Comment implÃ©menter l'authentification inter-domaines? </h2><br>  Tout cela, bien sÃ»r, est bon.  Alors que le travail est effectuÃ© sur un seul navigateur - tout va bien.  Mais qu'en est-il des rÃ©alitÃ©s modernes lorsqu'une personne a deux tÃ©lÃ©phones portables, un ordinateur de travail et plusieurs navigateurs dessus, un ordinateur personnel et un autre ordinateur portable?  Plus une tablette commune pour la femme / les enfants. <br>  Nous devrons en quelque sorte rÃ©soudre le problÃ¨me du transfert des clÃ©s de domaine entre les navigateurs et les appareils.  Et aussi rÃ©soudre le problÃ¨me de leur synchronisation correcte. <br>  L'un des mÃ©canismes pour rÃ©soudre ce problÃ¨me consiste Ã  calculer diverses clÃ©s de domaine sur la base d'une clÃ© principale commune sans possibilitÃ© de rÃ©cupÃ©ration inverse de la clÃ© principale Ã  partir d'une clÃ© de domaine connue. <br>  AprÃ¨s avoir crÃ©Ã© une clÃ© personnelle K pour le domaine D en utilisant une clÃ© principale M sur un appareil, un utilisateur peut crÃ©er la mÃªme clÃ© K pour le domaine D et sur n'importe quel autre en utilisant la mÃªme clÃ© principale M et un seul algorithme.  Plus prÃ©cisÃ©ment, cela se fera non pas par l'utilisateur, mais par son navigateur.  Avec cette approche, il suffit Ã  l'utilisateur de rÃ©partir sa clÃ© principale entre tous les navigateurs utilisÃ©s par lui et il "transfÃ¨re toutes ses clÃ©s" de domaines Ã  la fois.  Effectue en mÃªme temps des sauvegardes de cette maniÃ¨re. <br>  Confort d'utilisation maximal.  <b>Mais aussi le risque maximum</b> en cas de compromission de la clÃ© principale.  Par consÃ©quent, ces derniers doivent Ãªtre protÃ©gÃ©s en consÃ©quence.  Les risques de perte ou de compromission de la clÃ© principale et les moyens de minimiser ces risques sont dÃ©crits dans le chapitre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Â«3 Recommandations de sÃ©curitÃ©Â»</a> . <br>  L'utilisation d'une seule clÃ© principale pour gÃ©nÃ©rer toutes les clÃ©s pour tous les domaines n'est pas toujours une option pratique.  PremiÃ¨rement, que faire si la clÃ© de domaine est soudainement compromise et doit Ãªtre modifiÃ©e?  DeuxiÃ¨mement, que faire si vous devez partager une clÃ© de domaine avec une autre personne?  Par exemple, entre les membres de la famille.  Ou s'agit-il d'un compte d'accÃ¨s au courrier public d'entreprise.  Comment alors "rÃ©cupÃ©rer" votre clÃ© (car en fait elle a Ã©tÃ© compromise)? <br>  Par consÃ©quent, la gÃ©nÃ©ration de clÃ©s de domaine individuelles Ã  l'aide d'un capteur biologique de nombres alÃ©atoires doit Ãªtre prise en charge par les navigateurs.  Mais nous revenons ensuite Ã  la question de notre mobilitÃ© et des problÃ¨mes de synchronisation, des fonctions d'exportation et d'importation de clÃ©s dans le navigateur et de crÃ©ation de copies de sauvegarde. <br><br><h3>  Transfert via un appareil physique aliÃ©nable </h3><br>  Les cartes Ã  puce et les jetons USB peuvent Ãªtre tout Ã  fait appropriÃ©s comme stockage sÃ©curisÃ© des informations clÃ©s (car ils ont Ã©tÃ© crÃ©Ã©s pour cela).  L'authentification Ã  deux facteurs protÃ¨ge les clÃ©s contre tout accÃ¨s non autorisÃ© avec un accÃ¨s direct Ã  l'appareil. <br>  Certes, les cartes Ã  puce nÃ©cessitent des lecteurs spÃ©ciaux (sans parler des pilotes), ce qui limite leur utilisation uniquement aux postes de travail Ã©quipÃ©s de tels lecteurs. <br>  Avec des jetons USB un peu plus faciles.  Seuls les pilotes sont requis.  Mais vous ne pouvez pas coller un tel jeton dans le tÃ©lÃ©phone.  Et bien que pour les tÃ©lÃ©phones portables il existe des jetons rÃ©alisÃ©s sous forme de cartes SD, pour ne pas dire que cette solution ajoute Ã  la mobilitÃ©.  Essayez de tirer une carte d'un tÃ©lÃ©phone mobile, mais insÃ©rez-la dans un autre.  Et ce n'est pas que ce soit impossible.  Le truc, c'est que ce n'est pas pratique. <br>  Et si le jeton se casse?  Ensuite, toutes vos clÃ©s iront au Grand Cthulhu. <br>  Il y aura donc une tentation avec un tel schÃ©ma d'utiliser plusieurs appareils en double.  Mais vous devez encore rÃ©soudre le problÃ¨me de synchronisation des clÃ©s si vous avez plusieurs cartes Ã  puce. <br>  Et, franchement, ces appareils ne sont pas protÃ©gÃ©s contre les enregistreurs de frappe.  Maintenant, si le code PIN devait Ãªtre entrÃ© Ã  partir de la carte / du jeton lui-mÃªme.  Puis autre chose.  Mais je n'en ai pas vu dans la nature. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Avantages:</b> des clÃ©s alÃ©atoires de 256 bits peuvent Ãªtre utilisÃ©es;  haute sÃ©curitÃ© grÃ¢ce Ã  l'utilisation d'une authentification Ã  deux facteurs;  le plus haut niveau de protection contre la falsification directe. <br>  <b>InconvÃ©nients:</b> dÃ©pendance de l'appareil;  nÃ©cessite des coÃ»ts financiers;  faible mobilitÃ©;  la nÃ©cessitÃ© de rÃ©server des cartes et, par consÃ©quent, de synchroniser les donnÃ©es entre elles;  la vulnÃ©rabilitÃ© aux enregistreurs de frappe demeure. <br></blockquote><br><h3>  Synchronisation via le service en ligne </h3><br>  La Â«technologie du cloudÂ» est dÃ©sormais mise en avant dans la mesure du possible.  Il semble qu'ils, avec la blockchain, soient devenus un substitut Ã  la Â«technologie de la bananeÂ».  Naturellement, on souhaite utiliser une certaine plate-forme Internet pour l'Ã©change d'informations clÃ©s.  Une sorte de carte Ã  puce "en ligne". <br>  Quoi?  Vous vous connectez en utilisant notre systÃ¨me de maniÃ¨re anonyme sur un tel site;  envoyez-y vos clÃ©s cryptÃ©es avec un mot de passe;  Vous passez d'un autre appareil au mÃªme site avec la mÃªme clÃ© / mot de passe;  vous obtenez les clÃ©s de lÃ ;  Vous synchronisez les modifications par date de modification.  Semblable au gestionnaire de mots de passe, seul celui-ci est en ligne. <br>  C'est juste, personne ne garantit que le service en ligne ne sera pas piratÃ© ou ne fusionnera pas vos clÃ©s, bien que cryptÃ©es, Â«si nÃ©cessaireÂ».  Qui mettra en place un tel service gratuitement.  VoilÃ . <br>  Bien sÃ»r, le mot de passe protÃ¨ge les clÃ©s contre une utilisation directe.  Mais votre mot de passe rÃ©siste-t-il Ã  la force brute "hors ligne"?  VoilÃ  une autre question. <br><blockquote>  <b>Avantages:</b> haute mobilitÃ© des diplÃ´mes;  indÃ©pendance de l'appareil et du navigateur;  vous n'avez besoin que d'un seul mot de passe (bien qu'ils n'aient pas laissÃ© le mot de passe, c'est dÃ©jÃ  mieux). <br>  <b>InconvÃ©nients:</b> moins sÃ»r que de stocker des clÃ©s sur un support aliÃ©nable.  En fait, la sÃ©curitÃ© des clÃ©s repose sur la force du mot de passe Ã  sÃ©lectionner. <br></blockquote><br>  Vous pouvez bien sÃ»r utiliser une clÃ© principale pour crypter d'autres clÃ©s.  Celui avec lequel les autres clÃ©s de domaine sont calculÃ©es.  En option. <br><br><a name="part2"></a><h1>  2 Description technique du protocole </h1><br><br><a name="perm_key_algo"></a><h2>  2.0 Algorithme de gÃ©nÃ©ration de clÃ©s de domaine </h2><br>  Ce protocole dÃ©finit seulement 2 mÃ©thodes pour gÃ©nÃ©rer des clÃ©s de domaine. <br><br><ul><li>  basÃ© sur un gÃ©nÃ©rateur de nombres alÃ©atoires (de prÃ©fÃ©rence biologique) </li><li>  basÃ© sur une clÃ© principale de 256 bits </li></ul><br>  Dans ce dernier cas, la clÃ© de domaine est calculÃ©e comme suit: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {clÃ©}} (domaine) $" data-tex="display"></p>  oÃ¹ <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {clÃ©} $" data-tex="inline">  - ClÃ© maÃ®tre 256 bits, Domaine - nom de domaine pour lequel la clÃ© est crÃ©Ã©e. <br>  Ci-aprÃ¨s, <i>HMAC</i> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un algorithme cryptographique de hachage</a> basÃ© sur une implÃ©mentation de 256 bits de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonction de</a> hachage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SHA-2</a> . <br><blockquote>  La divulgation de compromis ou volontaire d'une clÃ© de domaine ne compromet pas la clÃ© principale d'origine. </blockquote><br>  La clÃ© principale fournit un mÃ©canisme pour la mobilitÃ© des informations d'identification de l'utilisateur. <br><div class="spoiler">  <b class="spoiler_title">Remarque</b> <div class="spoiler_text">  Dans la version initiale du protocole, l'option de gÃ©nÃ©ration de clÃ©s de domaine basÃ©e sur le mot de passe de l'utilisateur Ã©tait considÃ©rÃ©e comme garantissant la mobilitÃ© de l'utilisateur et la protection contre la compromission du mot de passe lors du piratage d'un site.  Mais dans le chapitre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Â«3 Consignes de sÃ©curitÃ©Â», des</a> explications seront donnÃ©es sur les raisons pour lesquelles il a Ã©tÃ© dÃ©cidÃ© de refuser un tel schÃ©ma. </div></div><br>  Si la clÃ© crÃ©Ã©e sur la base du Â«maÃ®treÂ» a Ã©tÃ© compromise ou si le jeton calculÃ© Ã  partir d'une telle clÃ© (Ã  la suite d'un piratage du site) a Ã©tÃ© compromis, la clÃ© doit Ãªtre modifiÃ©e.  Vous pouvez la changer en une clÃ© alÃ©atoire de 256 bits, ou la gÃ©nÃ©rer Ã  partir du mÃªme Â«assistantÂ», avec l'ajout d'une version: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (version Domain \ cup) $" data-tex="display"></p>  Ci-aprÃ¨s, le symbole <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  sera utilisÃ© pour l'opÃ©ration de concatÃ©nation de chaÃ®nes (tableaux d'octets). <br><br><a name="token_algo"></a><h2>  2.1 l'algorithme de calcul du jeton source </h2><br>  Le jeton d'authentification de l'utilisateur est calculÃ© avec chaque demande de n'importe quelle ressource de domaine.  Pour calculer le jeton de demande, les donnÃ©es suivantes sont prises: <br><br><ul><li>  <i>ExpÃ©diteur</i> - le nom de domaine de l'initiateur de la demande (il peut s'agir d'une page avec une iframe ou un script du domaine de quelqu'un d'autre qui effectue la rÃ©cupÃ©ration), </li><li>  <i>Destinataire</i> - nom de domaine du destinataire (oÃ¹ la demande est envoyÃ©e), </li><li>  <i>Contexte</i> - contexte d'exÃ©cution de la demande, </li><li>  <i>Protection</i> - une sÃ©quence alÃ©atoire de 32 octets (256 bits), si le contexte est vide;  sinon vide </li></ul><br>  Ces donnÃ©es sont concatÃ©nÃ©es et hachÃ©es avec SHA-2 256 bits <b>sur la clÃ© K du domaine initiant la requÃªte</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (ExpÃ©diteur \ Destinataire de la tasse \ Contexte de la tasse \ Protection de la tasse) $" data-tex="display"></p><blockquote>  Un jeton valide est obtenu lorsque le contexte n'est pas vide.  Pour une identification correcte sur le site cible, la condition Sender = Recipient = Context doit Ãªtre remplie. </blockquote><br>  Le champ Contexte, avec Protection, est utilisÃ© pour se protÃ©ger contre <abbr title="ContrefaÃ§on de demande intersite - Â«contrefaÃ§on de demande intersiteÂ»">les</abbr> attaques <abbr title="Script intersite - Â«script intersiteÂ»">XSS</abbr> et <abbr title="ContrefaÃ§on de demande intersite - Â«contrefaÃ§on de demande intersiteÂ»">CSRF</abbr> , ainsi que contre le suivi des utilisateurs. <br>  Des explications plus dÃ©taillÃ©es sur les rÃ¨gles de dÃ©termination de l'expÃ©diteur / destinataire / contexte seront fournies ci-dessous. <br><br><a name="token_validation_algo"></a><h2>  2.2 Algorithme de protection des jetons pendant le transfert </h2><br>  Le jeton client d'origine est transmis extrÃªmement rarement.  Uniquement lors du transfert d'un jeton non enregistrÃ© au moment de la crÃ©ation de la session. <br>  <b>Un jeton est considÃ©rÃ© comme non enregistrÃ©</b> s'il: est crÃ©Ã© sur la base d'une clÃ© alÃ©atoire (non fixe);  n'a pas Ã©tÃ© acceptÃ© par le serveur aprÃ¨s l'envoi de la clÃ© de remplacement ou permanente.  Pour plus de dÃ©tails, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Â«Traitement des jetons sur le serveurÂ»</a> . <br>  Le navigateur et le serveur gÃ©nÃ¨rent conjointement une paire de nombres alÃ©atoires, appelÃ©s  salt (Salt), avec lequel les 128 bits infÃ©rieurs du jeton sont hachÃ©s.  Les deux Ã©changent ces numÃ©ros selon le protocole.  Pour plus de dÃ©tails, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Â«Salt Swap Procedure Browser-ServerÂ»</a> . <br>  Ainsi, le serveur de site voit le jeton suivant: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Hi (T_s) \ cup HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  oÃ¹ <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Salut (T_s) $" data-tex="inline">  - haute 128 bits, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - les 128 bits infÃ©rieurs du jeton d'origine, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  - concatÃ©nation de chaÃ®nes.  Dans ce cas, le jeton initial <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  devrait dÃ©jÃ  Ãªtre connu du serveur. <br><br>  IdÃ©alement, CSI-Salt devrait changer chaque fois qu'un navigateur demande un serveur.  Cependant, cela peut Ãªtre une exigence coÃ»teuse en termes de ressources informatiques.  De plus, il peut Â«tuerÂ» la possibilitÃ© d'envoyer des requÃªtes parallÃ¨les au serveur. <br>  Par consÃ©quent, afin d'optimiser les calculs, il est autorisÃ© de conserver les valeurs CSI-Salt inchangÃ©es dans diffÃ©rentes demandes, <u>mais pas plus d'une session</u> .  Cela peut Ãªtre une limite de temps (changement de CSI-Salt toutes les 5 minutes), ou une rÃ©action Ã  l'intensitÃ© des requÃªtes (changement de CSI-Salt toutes les 100 requÃªtes), ou aprÃ¨s chaque sÃ©rie de requÃªtes (au moment de la pause, client-serveur), ou une version mixte.  Ici, la dÃ©cision est laissÃ©e aux dÃ©veloppeurs de navigateurs. <br>  Garder CSI-Salt inchangÃ© trop longtemps affaiblit la protection du jeton transmis, permettant Ã  l'attaquant d'intercepter le jeton pendant que l'utilisateur lÃ©gitime a terminÃ© la dÃ©connexion et d'exÃ©cuter une demande non autorisÃ©e au nom de la victime. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 ProcÃ©dure d'Ã©change de sel entre le navigateur et le serveur </h2><br>  2.3.1 Jeton basÃ© sur une clÃ© de serveur alÃ©atoire ou non enregistrÃ©e <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navigateur</b> </th><th>  <b>Serveur</b> </th></tr><tr><td colspan="2">  <b>Demande initiale (initialisation de session utilisateur)</b> </td></tr><tr><td>  Le navigateur envoie le jeton tel quel. <br>  <b>Votre demande manque CSI-Salt.</b> <br></td><td>  Le serveur voit d'abord un tel jeton. <br><div class="spoiler">  <b class="spoiler_title">au fait</b> <div class="spoiler_text">  Le serveur n'est peut-Ãªtre pas le premier Ã  voir un tel jeton.  Et le navigateur est considÃ©rÃ© comme non enregistrÃ©.  Cela peut se produire <u>lorsque vous recrÃ©ez la clÃ© en fonction de la clÃ© principale sur un autre appareil</u> .  Par consÃ©quent, cette situation doit Ã©galement Ãªtre prise en compte. </div></div><br>  Le perÃ§oit tel qu'il est (le considÃ¨re comme non protÃ©gÃ©).  Utilise ce jeton comme identifiant de session. <br>  GÃ©nÃ¨re son <i><sub>sel</sub> S.</i> <br>  <b>Le renvoie dans la rÃ©ponse de l'en-tÃªte CSI-Salt.</b> <br></td></tr><tr><td colspan="2">  <b>DeuxiÃ¨me demande</b> </td></tr><tr><td>  GÃ©nÃ¨re du sel <i>Avec du <sub>sel</sub></i> . <br>  Le navigateur connecte <sup>[3]</sup> son sel et le sel du serveur. <br>  Le navigateur envoie la demande, en passant un jeton de sel partagÃ©. <br>  <b>Envoie du sel CSI.</b> <br></td><td>  Le serveur reÃ§oit la demande et <b>rÃ©cupÃ¨re le client CSI-Salt</b> . <br>  Le serveur connecte le sel du navigateur au sien et l'utilise pour vÃ©rifier le jeton. <br><br>  Si la validation du jeton rÃ©ussit, elle fournit Ã  l'utilisateur un contenu conforme Ã  ses droits. <br><br>  En cas d'erreurs de vÃ©rification, renvoie l'en <b>-</b> tÃªte <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une rÃ©ponse vide: dÃ©pend du serveur. <br></td></tr><tr><td colspan="2">  <b>Demandes ultÃ©rieures</b> </td></tr><tr><td>  Le navigateur envoie la demande, en passant un jeton de sel partagÃ©. <br>  <b>Votre demande manque CSI-Salt.</b> <br></td><td>  Le serveur reÃ§oit la demande et vÃ©rifie son jeton. <br><br>  Si la validation du jeton rÃ©ussit, elle fournit Ã  l'utilisateur un contenu conforme Ã  ses droits. <br><br>  En cas d'erreurs de vÃ©rification, renvoie l'en <b>-</b> tÃªte <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une rÃ©ponse vide: dÃ©pend du serveur. <br></td></tr><tr><td colspan="2">  <b>AprÃ¨s un certain temps <sup>[2]</sup></b> </td></tr><tr><td>  GÃ©nÃ¨re un nouveau sel <i>C <sub>sel</sub></i> . <br>  Connectez le nouveau sel au sel du serveur. <br>  Envoie une requÃªte, en passant un jeton protÃ©gÃ© par un nouveau sel commun. <br>  <b>Envoie du sel CSI.</b> <br></td><td>  Le serveur reÃ§oit la demande et <b>rÃ©cupÃ¨re le nouveau client CSI-Salt</b> . <br>  Le serveur connecte le sel du navigateur au sien et l'utilise pour vÃ©rifier le jeton. <br><br>  Si la validation du jeton rÃ©ussit, elle fournit Ã  l'utilisateur un contenu conforme Ã  ses droits. <br><br>  En cas d'erreurs de vÃ©rification, renvoie l'en <b>-</b> tÃªte <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une rÃ©ponse vide: dÃ©pend du serveur. <br></td></tr></tbody></table></div><br>  2.3.2 Jeton basÃ© sur la clÃ© enregistrÃ©e par le serveur <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navigateur</b> </th><th>  <b>Serveur</b> </th></tr><tr><td colspan="2">  <b>Demande initiale (initialisation de session utilisateur)</b> </td></tr><tr><td>  GÃ©nÃ¨re du sel <i>Avec du <sub>sel</sub></i> . <br>  <b>Envoie du sel CSI.</b> <br>  TransfÃ¨re le jeton sous une forme protÃ©gÃ©e. <br></td><td>  Le serveur reÃ§oit la demande et <b>rÃ©cupÃ¨re le client CSI-Salt</b> . <br>  Lit un jeton protÃ©gÃ©. <br>  Recherche le jeton client complet dans sa base de donnÃ©es (utilise le premier jeton 128 bits reÃ§u dans la demande de recherche). <br>  Parce que  il s'agit de la demande initiale, le serveur n'a pas envoyÃ© de sel au client, puis la <b>validation</b> du <b>jeton Ã  ce stade est effectuÃ©e uniquement par le sel du client</b> . <br><br>  En cas d'erreurs de vÃ©rification, renvoie l'en <b>-</b> tÃªte <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une rÃ©ponse vide: dÃ©pend du serveur. <br><br>  Si la validation du jeton rÃ©ussit, elle fournit Ã  l'utilisateur un contenu conforme Ã  ses droits. <br><br>  GÃ©nÃ¨re son <i><sub>sel</sub> S.</i> <br>  <b>Le renvoie dans la rÃ©ponse de l'en-tÃªte CSI-Salt</b> . <br></td></tr><tr><td colspan="2">  <b>Demandes ultÃ©rieures</b> </td></tr><tr><td>  Le navigateur combine son sel et son sel de serveur. <br>  Le navigateur envoie la demande, en passant un jeton de sel partagÃ©. <br>  <b>Votre demande manque CSI-Salt</b> . <br></td><td>  Le serveur reÃ§oit la demande et vÃ©rifie son jeton. <br><br>  Si la validation du jeton rÃ©ussit, elle fournit Ã  l'utilisateur un contenu conforme Ã  ses droits. <br><br>  En cas d'erreurs de vÃ©rification, renvoie l'en <b>-</b> tÃªte <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une rÃ©ponse vide: dÃ©pend du serveur. <br></td></tr><tr><td colspan="2">  <b>AprÃ¨s un certain temps <sup>[2]</sup></b> </td></tr><tr><td>  GÃ©nÃ¨re un nouveau sel <i>C <sub>sel</sub></i> . <br>  Le navigateur connecte le nouveau sel au sel du serveur. <br>  Le navigateur envoie la demande, en passant un jeton protÃ©gÃ© par le nouveau sel partagÃ©. <br>  <b>Envoie du sel CSI</b> . <br></td><td>  Le serveur reÃ§oit la demande et <b>rÃ©cupÃ¨re le nouveau client CSI-Salt</b> . <br>  Le serveur connecte le sel du navigateur au sien et l'utilise pour vÃ©rifier le jeton. <br><br>  Si la validation du jeton rÃ©ussit, elle fournit Ã  l'utilisateur le contenu conformÃ©ment Ã  ses droits. <br><br>  En cas d'erreurs de vÃ©rification, renvoie l'en <b>-</b> tÃªte <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une rÃ©ponse vide: dÃ©pend du serveur. <br></td></tr></tbody></table></div><hr>  <sup>[1] Un jeton est considÃ©rÃ© comme non enregistrÃ© s'il: est crÃ©Ã© sur la base d'une clÃ© alÃ©atoire;</sup>  <sup>n'a pas Ã©tÃ© acceptÃ© par le serveur aprÃ¨s l'envoi de la clÃ© de modification ou permanente avec la rÃ©ponse CSI-Token-Action: succÃ¨s.</sup> <sup><br></sup>  <sup>[2] Le temps pendant lequel le changement CSI-Salt est effectuÃ© est dÃ©terminÃ© par les navigateurs eux-mÃªmes.</sup>  <sup>Cela peut se produire aprÃ¨s une sÃ©rie de demandes, aprÃ¨s un dÃ©lai d'attente, aprÃ¨s un certain nombre de demandes.</sup> <sup>  â€“ <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       â€“     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appellerons le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nÃ´tre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le domaine dont nous </font><i><font style="vertical-align: inherit;">chargeons</font></i><font style="vertical-align: inherit;"> la page (affichÃ©e dans la barre d'adresse du navigateur). Les domaines restants seront appelÃ©s </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . MÃªme si ce sont des domaines enfants d'un donnÃ©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appelons la ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle a Ã©tÃ© tÃ©lÃ©chargÃ©e Ã  partir d'un domaine externe. Nous appellerons la ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interne</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle a Ã©tÃ© tÃ©lÃ©chargÃ©e depuis notre domaine. La ressource peut Ãªtre un script, une image, une requÃªte ajax et tout autre fichier.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un script est considÃ©rÃ© comme externe s'il a Ã©tÃ© tÃ©lÃ©chargÃ© Ã  partir d'un domaine externe. Le script placÃ© dans la balise &lt;script&gt; crÃ©Ã©e, crÃ©Ã© par un script externe, sera Ã©galement considÃ©rÃ© comme externe. Le script situÃ© dans la balise &lt;script&gt; modifiÃ©e est dÃ©clarÃ© externe s'il a Ã©tÃ© modifiÃ© par un script externe, ou si un script externe Ã©tait prÃ©sent dans la chaÃ®ne d'appel lorsque son contenu a changÃ©. MÃªme si en mÃªme temps ce &lt;script&gt; Ã©tait Ã  l'origine sur la page ou a Ã©tÃ© crÃ©Ã© par un script interne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nommerons les balises LINK, SCRIPT, IMG, IFAME et autres, qui nÃ©cessitent que le navigateur charge une ressource dÃ¨s qu'elle est rencontrÃ©e par l'analyseur DOM - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balises de ressource</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nommerons les balises FORM, A, META et autres, qui peuvent lancer le chargement des pages sous certaines conditions (soumettre, cliquer,timeout) - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lancement de balises</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appellerons la balise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle Ã©tait Ã  l'origine prÃ©sente sur la page lors de sa premiÃ¨re Ã©mission par le serveur. Nous appellerons la balise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle a Ã©tÃ© crÃ©Ã©e lors de l'exÃ©cution des scripts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La balise FORM est dÃ©clarÃ©e dynamique, mÃªme si non seulement la balise elle-mÃªme a changÃ©, mais aussi les valeurs de tous les champs INPUT associÃ©s Ã  ce formulaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appellerons </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notre propre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> balise dynamique </font><font style="vertical-align: inherit;">si le script qui l'a crÃ©Ã©e appartient Ã  notre domaine, et la chaÃ®ne d'appel de l'instruction qui a gÃ©nÃ©rÃ© cette balise n'avait pas de fonction appartenant Ã  un script externe. Sinon, nous considÃ©rons une telle balise dynamique </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorrecte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chargement de la page est dÃ©clenchÃ© par le lancement de balises.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La balise initiatrice peut Ãªtre activÃ©e directement par l'utilisateur, ou activÃ©e par le script, en exÃ©cutant la commande click (pour le lien) et soumettre (pour le formulaire), ou par le script gÃ©nÃ©rant les Ã©vÃ©nements onclick / onsubmit correspondants. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, la balise initiatrice peut Ãªtre activÃ©e par le navigateur. </font><font style="vertical-align: inherit;">Un exemple d'une telle balise est META avec les paramÃ¨tres http-equiv = "refresh" content = "0". </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau P. Valeurs de contexte dans diffÃ©rentes conditions d'ouverture de page</font></font></sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MÃ©thode d'ouverture </font></font></th><th colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qui a dÃ©clenchÃ© le chargement de la page? </font></font></th></tr><tr><th>  Utilisateur </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propre. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le navigateur </font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Statique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1. </font><font style="vertical-align: inherit;">RÃ©fÃ©rent</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4. </font><font style="vertical-align: inherit;">HÃ©riter</font></font></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dynamique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Propre </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5. </font><font style="vertical-align: inherit;">HÃ©riter</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7 </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8. </font><font style="vertical-align: inherit;">HÃ©riter</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Incorrect </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC. </font><font style="vertical-align: inherit;">Vide</font></font></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Directement </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD. </font><font style="vertical-align: inherit;">Domaine</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pf. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mÃªme tableau, seule image</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la balise de ressource a Ã©tÃ© modifiÃ©e par un script (par exemple, l'attribut SRC d'IMG), puis que la ressource a Ã©tÃ© automatiquement chargÃ©e par le navigateur, nous pensons que le contenu / la ressource a Ã©tÃ© dÃ©clenchÃ© par l'analyseur, la mÃ©thode de chargement est la balise, mais le statut de cette balise devient Â«dynamiqueÂ». </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau R. Valeurs de contexte dans diffÃ©rentes conditions de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chargement de contenu / ressource</font></font></b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MÃ©thode de tÃ©lÃ©chargement </font></font></th><th colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qui a provoquÃ© le tÃ©lÃ©chargement du contenu? </font></font></th></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analyseur Dom </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propre. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Statique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1. </font><font style="vertical-align: inherit;">La page</font></font></td><td></td><td></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dynamique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Propre </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4. </font><font style="vertical-align: inherit;">La page</font></font></td><td></td><td></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Incorrect </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7. </font><font style="vertical-align: inherit;">Vide</font></font></td><td></td><td></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Directement </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA. </font><font style="vertical-align: inherit;">RÃ©fÃ©rent</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB. </font><font style="vertical-align: inherit;">La page</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC </font><font style="vertical-align: inherit;">RÃ©fÃ©rent</font></font></td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mÃªme tableau, seule image</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1] Balise de lancement </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2] Balise de ressource </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3] HÃ©riter de ses propres pages, vide lors de l'ouverture de pages de domaines Ã©trangers </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4] HÃ©riter lors de la redirection de serveurs vers leurs pages, vide lors de la redirection vers d'autres domaines ou lors de l'ouverture d'une page Ã  partir de sources externes (voir . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clarification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></sup> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AbrÃ©viations</font></font></b> <div class="spoiler_text"> <b>Referrer</b> â€“     Referrer. <br> <b>Page</b> â€“   (Tab)      . <br> <b>Empty</b> â€“  . <br> <b>Domain</b> â€“  Context     <br> <b>Inherit</b> â€“  Context     <br> <b>Variant</b> â€“  Context    Â«-Â»   <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Des marques de la forme P1..PF, R1..RC seront utilisÃ©es pour faire rÃ©fÃ©rence Ã  la cellule correspondante dans le tableau lors de l'analyse de situations spÃ©cifiques. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarquez le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rÃ©fÃ©rent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">domaine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font><font style="vertical-align: inherit;">surbrillance </font><font style="vertical-align: inherit;">dans le premier tableau. </font><font style="vertical-align: inherit;">Vous ne pouvez Ãªtre autorisÃ© sur un site que lorsque vous ouvrez vous-mÃªme le site Ã  une adresse directe ou par un lien Ã  partir d'un autre site, avec un rechargement ultÃ©rieur de la page de votre propre initiative.</font></font></blockquote><br><br><a name="sender_recipient_rules"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.5 RÃ¨gles de dÃ©finition des champs expÃ©diteur et destinataire </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'expÃ©diteur est le domaine de la page / du script / du style d'oÃ¹ provient la demande. </font><font style="vertical-align: inherit;">La page demande des styles, des images, des scripts. </font><font style="vertical-align: inherit;">Les scripts demandent du contenu via ajax. </font><font style="vertical-align: inherit;">Les styles peuvent charger d'autres styles. </font><font style="vertical-align: inherit;">Ce sont les initiateurs de la demande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le destinataire est le domaine auquel la demande va vraiment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour qu'il n'y ait plus de questions, considÃ©rons des exemples spÃ©cifiques. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'il y ait un site site.net. </font><font style="vertical-align: inherit;">Sur la page principale du site:</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style site.net/css/common.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les styles common.css importent les styles fonts.google.com/fonts/Roboto.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le style Roboto.css importe la police fonts.google.com/fonts/Roboto.ttf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> image menant Ã  img.site.net/picture1.jpg </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trame chargÃ©e depuis adriver.ru/frame </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adm.site.net/admin.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Laissez dans le cadre (avec adriver.ru) vous connecter: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style de adriver.ru/style.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> image de img.adriver.ru/img/01.png </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adriver.ru/libs.js </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de api.adriver.ru/v1/ad.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeurs de l'expÃ©diteur / destinataire lors du chargement des ressources avec l'analyseur DOM </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ressource tÃ©lÃ©chargeable </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeur de l'expÃ©diteur </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeur du destinataire </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/css/common.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.ttf </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net/picture1.jpg </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/frame </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/style.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru/img/01.png </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, regardons les valeurs de Sender / Recipient lors du chargement de contenu avec des scripts lors de l'exÃ©cution des requÃªtes ajax. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeurs de l'expÃ©diteur / destinataire lors du chargement de contenu avec des scripts</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script exÃ©cutable </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OÃ¹ va la demande? </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ExpÃ©diteur </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Destinataire </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru / ... </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru </font></font></td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.6 DÃ©tails sur les tables de dÃ©finition de contexte </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examinons plus en dÃ©tail les options d'ouverture de pages (onglets du navigateur) dont nous disposons et la valeur de contexte qui sera obtenue. </font></font><br><br><a name="P1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'utilisateur de la page prÃ©cÃ©dente a cliquÃ© sur le lien ou cliquez sur le bouton soumettre du formulaire. Le gestionnaire de navigateur d'Ã©vÃ©nements standard pour le lien / formulaire a redirigÃ© l'utilisateur vers cette page. Situation normale. Transition sÃ©curisÃ©e entre les pages d'un domaine ou diffÃ©rents domaines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous passez Ã  site.net Ã  partir d'un autre domaine google.com, le contexte sera Ã©gal au domaine prÃ©cÃ©dent (google.com). Et l'utilisateur sur le nouveau domaine site.net ne sera pas autorisÃ© (mÃªme si l'onglet voisin de ce site oÃ¹ l'utilisateur est autorisÃ© est ouvert). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une transition indÃ©pendante rÃ©pÃ©tÃ©e de l'utilisateur (sans l'aide de scripts) via le lien vers le mÃªme site conduira Ã  nouveau Ã  la situation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais le contexte sera dÃ©jÃ  Ã©gal au domaine site.net, car par la rÃ¨gle Context = Referrer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est fait pour protÃ©ger contre</font></font><abbr title="ross Site Request Forgery â€” Â«  Â»"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attaque </font><abbr title="ross Site Request Forgery â€” Â«  Â»"><font style="vertical-align: inherit;">CSRF</font></abbr><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P5"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'utilisateur de la page prÃ©cÃ©dente a cliquÃ© sur le lien crÃ©Ã© / modifiÃ© par un script tÃ©lÃ©chargÃ© depuis le domaine de la page prÃ©cÃ©dente; </font><font style="vertical-align: inherit;">ou l'utilisateur de la page prÃ©cÃ©dente a cliquÃ© sur le bouton d'envoi du formulaire crÃ©Ã© / modifiÃ© par le script (en changeant la balise FORM, y compris ses champs INPUT). </font><font style="vertical-align: inherit;">Le gestionnaire de navigateur d'Ã©vÃ©nements standard pour le lien / formulaire a redirigÃ© l'utilisateur vers cette page.</font></font><br><br><a name="P9"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est identique Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le script Ã©tait externe, ou il existe une fonction d'un script externe dans la chaÃ®ne d'appel (protection contre la modification des fonctions de script du script de site par un script tiers).</font></font><br><br><a name="PD"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'utilisateur a ouvert la page Ã  une adresse directe. </font><font style="vertical-align: inherit;">Ouverture sÃ»re.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisateur doit ouvrir la page en entrant l'URL dans la barre d'adresse. </font><font style="vertical-align: inherit;">Ou ouvrez un site Ã  partir des signets du navigateur.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ouverture d'un lien Ã  partir d'un raccourci sur le bureau d'un autre programme, toute autre situation oÃ¹ le systÃ¨me d'exploitation envoie une commande au navigateur pour ouvrir le lien doit Ãªtre considÃ©rÃ©e comme un cas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (l'ouverture du lien est initiÃ©e par le navigateur). MÃªme si l'utilisateur appuie sur F5 pour recharger la page, cela doit Ãªtre considÃ©rÃ© comme un cas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce n'est que si l'utilisateur entre dans la barre d'adresse et appuie sur EntrÃ©e que le navigateur sera considÃ©rÃ© comme un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est fait pour protÃ©ger les attaques CSRF contre d'autres programmes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fait de suivre le lien d'un autre programme mÃ¨nera l'utilisateur vers le site attaquÃ© avec un jeton invalide et un contexte vide, qui seront enregistrÃ©s mÃªme si l'utilisateur appuie sur F5 (actualiser la page). Vous ne pouvez pas vous connecter tant que l'utilisateur n'a ouvert aucun lien vers les pages du site (situation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, si un attaquant d'un autre programme dÃ©cide de faire glisser Ã  un utilisateur autorisÃ© un lien vers la page du site site.net qui exÃ©cute une commande, il ne pourra pas le faire facilement. Il faudra forcer l'utilisateur Ã  cliquer sur un autre lien sur cette page, puis forcer l'utilisateur Ã  s'y authentifier, et alors seulement ... Ensuite, l'utilisateur sera trÃ¨s probablement sur une autre page de site.net.</font></font><br><br><a name="P2"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sur la page prÃ©cÃ©dente pour un lien ou un formulaire placÃ© Ã  l'origine sur la page, un script natif de la page prÃ©cÃ©dente a gÃ©nÃ©rÃ© un Ã©vÃ©nement click / submit. </font><font style="vertical-align: inherit;">Aucune fonction de la chaÃ®ne d'appels n'appartenait Ã  des scripts externes. </font><font style="vertical-align: inherit;">Le navigateur a redirigÃ© l'utilisateur vers cette page. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la nouvelle page appartient au mÃªme domaine, le contexte est hÃ©ritÃ© de la page prÃ©cÃ©dente. </font><font style="vertical-align: inherit;">Si la nouvelle page appartient Ã  un domaine Ã©tranger, le contexte sera vide.</font></font><br><br><a name="P6"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le mÃªme que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a Ã©tÃ© crÃ©Ã© / modifiÃ© par son propre script.</font></font><br><br><a name="PA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le mÃªme que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a Ã©tÃ© crÃ©Ã© / modifiÃ© par un script externe.</font></font><br><br><a name="PE"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le script de la page prÃ©cÃ©dente a provoquÃ© l'ouverture de cette page avec la commande window.location.href ou window.open (...). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le script de page site.net redirige l'utilisateur vers la page du mÃªme domaine, le champ Contexte sera hÃ©ritÃ© de la page de gÃ©nÃ©ration. Dans ce cas, Context = site.net. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la page ya.ru a Ã©tÃ© ouverte et que le script nous a transfÃ©rÃ©s sur maps.ya.ru, le contexte de la nouvelle page sera dÃ©jÃ  vide. Dans les actions ultÃ©rieures de l'utilisateur, le contexte restera presque toujours vide, ce qui compliquera l'autorisation de l'utilisateur sur le site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole implique que l'ouverture d'un site sur un autre est une opÃ©ration dangereuse. Cela protÃ¨ge l'utilisateur contre le suivi non autorisÃ© par ces sites et contre les attaques CSRF.</font></font><br><br><a name="P3"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul l'Ã©vÃ©nement click / submit a Ã©tÃ© dÃ©clenchÃ© par un script externe. </font><font style="vertical-align: inherit;">Le contexte devient vide (une sÃ©quence alÃ©atoire d'octets est envoyÃ©e Ã  la place), ce qui protÃ¨ge les sites tiers du suivi du site (rÃ©seaux de banniÃ¨res).</font></font><br><br><a name="P7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a Ã©tÃ© crÃ©Ã© / modifiÃ© par un script externe.</font></font><br><br><a name="PB"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a Ã©tÃ© crÃ©Ã© / modifiÃ© par un script externe.</font></font><br><br><a name="PF"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le script provocateur Ã©tait externe.</font></font><br><br><a name="P4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le navigateur a rechargÃ© la page suite au traitement de la balise &lt;META&gt;. </font><font style="vertical-align: inherit;">La balise Ã©tait Ã  l'origine sur la page. </font><font style="vertical-align: inherit;">Redirection lÃ©gale. </font><font style="vertical-align: inherit;">Le contexte persistera Ã  partir de la page d'origine. </font><font style="vertical-align: inherit;">Comme c'est le cas avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P8"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le navigateur a rechargÃ© la page suite au traitement de la balise &lt;META&gt;. </font><font style="vertical-align: inherit;">Mais la balise a Ã©tÃ© crÃ©Ã©e / modifiÃ©e par son propre script. </font><font style="vertical-align: inherit;">Ceci est valide, mais le contexte persistera Ã  partir de la page d'origine. </font><font style="vertical-align: inherit;">Comme c'est le cas avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il ne sera pas possible d'attirer le jeton lÃ©gal de l'utilisateur de cette maniÃ¨re.</font></font><br><br><a name="PC"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul script externe. </font><font style="vertical-align: inherit;">Le site ouvert recevra un nombre alÃ©atoire comme contexte.</font></font><br><br><a name="PG"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le navigateur ouvre des liens sur commande Ã  partir du systÃ¨me d'exploitation. </font><font style="vertical-align: inherit;">Il se peut que vous cliquiez sur un lien d'un autre programme, ouvriez un raccourci sur le bureau. </font><font style="vertical-align: inherit;">Il peut s'agir d'une commande d'un autre programme, Ã  votre insu. </font><font style="vertical-align: inherit;">Dans ce cas, la source n'est pas approuvÃ©e et le champ Contexte restera vide lors de toute manipulation utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est fait pour protÃ©ger les attaques CSRF contre d'autres programmes.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si le navigateur lui-mÃªme ouvre les onglets prÃ©cÃ©demment enregistrÃ©s, le contexte de la page est dÃ©fini Ã©gal Ã  la valeur de cette page au moment de la fermeture du navigateur. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, cette catÃ©gorie comprend toutes les situations oÃ¹ le navigateur est redirigÃ© par le serveur vers une autre page (de son propre domaine ou de quelqu'un d'autre) suite au traitement de l'en-tÃªte HTTP Header. </font><font style="vertical-align: inherit;">Si la redirection va vers votre propre page, la valeur de contexte est hÃ©ritÃ©e. </font><font style="vertical-align: inherit;">Si la redirection va Ã  quelqu'un d'autre, elle est rÃ©initialisÃ©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est fait pour protÃ©ger contre le suivi des attaques des serveurs Web.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, une telle rÃ¨gle peut entraÃ®ner des problÃ¨mes avec la mise en Å“uvre actuelle de l'autorisation interdomaine. </font><font style="vertical-align: inherit;">Si aprÃ¨s autorisation, le serveur SSO redirige l'utilisateur vers le site cible, ce dernier y sera anonyme.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour Ã©viter Ã  l'utilisateur de Â«perdreÂ» l'autorisation d'origine sur le site cible, il est nÃ©cessaire de transmettre des informations d'authentification entre les requÃªtes du serveur. </font><font style="vertical-align: inherit;">L'algorithme peut Ãªtre le suivant:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur crÃ©e et active une clÃ© permanente pour le site cible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Passe du site cible au serveur SSO lui-mÃªme en cliquant sur le lien appropriÃ©; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> active la clÃ© permanente existante Ã  partir du serveur SSO; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AprÃ¨s avoir reÃ§u la clÃ© Changed-To, le serveur SSO envoie une requÃªte inter-serveur au site cible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur clique sur le bouton Â«ContinuerÂ» de la page d'autorisation, ce qui le renvoie au site cible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin de respecter la rÃ¨gle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le site cible propose Ã  l'utilisateur de cliquer Ã  nouveau sur le bouton de lien pour y accÃ©der (par exemple, vers la page d'accueil d'un participant autorisÃ©).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur clique sur le bouton de lien, la page se recharge et l'utilisateur est dÃ©jÃ  autorisÃ© sur le site cible. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description de l'algorithme semble en fait plus compliquÃ©e que sa mise en Å“uvre. </font><font style="vertical-align: inherit;">Une implÃ©mentation de l'interface utilisateur pourrait ressembler Ã  ceci:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une nouvelle entrÃ©e sur le site cible ne nÃ©cessite plus l'autorisation SSO de l'utilisateur. </font><font style="vertical-align: inherit;">Il suffit d'activer la clÃ© permanente.</font></font></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examinons maintenant de plus prÃ¨s les options de chargement de contenu sur les pages et la valeur de contexte qui sera obtenue sur demande. </font></font><br><br><a name="R1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la ressource est chargÃ©e par le navigateur suite Ã  l'analyse de la page (le navigateur a rencontrÃ© une balise de ressource). </font><font style="vertical-align: inherit;">La valeur de contexte lors de la gÃ©nÃ©ration d'une demande de ressource est extraite de la page Contexte contenant la balise de ressource. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, si site.net a un cadre adriver.ru dans lequel l'image de img.disk.com est chargÃ©e, puis lors de la gÃ©nÃ©ration d'une requÃªte HTTP vers img.disk.com, le navigateur prend la valeur calculÃ©e pour la page comme contexte site.net.</font></font><br><br><a name="R4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est identique Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Seule la balise de ressource a Ã©tÃ© crÃ©Ã©e / modifiÃ©e par son propre script, Ã  la suite de quoi le navigateur DOM Parser a fonctionnÃ©. Par exemple, sur la page site.net/index.html, notre propre script site.net/require.js a insÃ©rÃ© un autre script personnalisÃ© (&lt;script src = ...&gt; tag) site.net/min.js, ce qui a forcÃ© le navigateur Ã  gÃ©nÃ©rer une demande de tÃ©lÃ©chargement de fichier main.js. Le champ Contexte de cette demande sera dÃ©fini sur la valeur calculÃ©e pour la page site.net.</font></font><br><br><a name="R7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est identique Ã  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais comme la balise de ressource a Ã©tÃ© crÃ©Ã©e / modifiÃ©e par un script externe, lorsque la ressource est demandÃ©e, le navigateur gÃ©nÃ©rera un jeton basÃ© sur un contexte vide et une sÃ©quence alÃ©atoire de 256 bits. En consÃ©quence, le script de l'attaquant externe evil.com/drop.js, intÃ©grÃ© Ã  la page du domaine site.net attaquÃ©, essayant de rÃ©pondre Ã  une demande adressÃ©e au site.net cible au nom de la victime Ã©chouera, car le serveur recevra une demande avec un jeton alÃ©atoire et ne pourra pas identifier l'expÃ©diteur de la demande.</font></font><br><br><a name="RA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'analyseur tÃ©lÃ©charge le contenu suite Ã  l'analyse d'un autre contenu Par exemple, la feuille de style site.net/css/common.css, tÃ©lÃ©chargÃ©e pour la page site.net/index.html, importe la feuille de style fonts.google.com/fonts/Roboto.css, ce qui oblige le navigateur Ã  demander fonts.google .com au nom de Referrer = site.net/css/common.css. La valeur de contexte dans ce cas sera Ã©gale Ã  Referrer. Ensuite, le fichier de styles Roboto.css importe la police Roboto.ttf, ce qui oblige le navigateur Ã  demander fonts.google.com/fonts/Roboto.ttf au nom de Referrer = fonts.google.com/fonts/Roboto.css. La valeur de contexte sera Ã©gale Ã  Referrer dans ce cas, mais elle est diffÃ©rente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons, hypothÃ©tiquement, que le fichier Roboto.css (ressource externe) n'importe pas de police / style, mais essaie de mener une attaque CSRF avec cette instruction:</font></font><pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  dans l'espoir de rÃ©pondre Ã  la demande sur site.net au nom d'un utilisateur autorisÃ©.  Mais le problÃ¨me pour l'attaquant est que site.net s'attend Ã  recevoir un jeton de l'utilisateur: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Ensuite, comme avec une telle demande CSRF, le navigateur crÃ©era un jeton: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  Et une demande adressÃ©e au site viendra de la part d'un site anonyme qui ne dispose pas de droits d'accÃ¨s pour effectuer ces opÃ©rations. <br><br><a name="RB"></a>  <b>RB</b> - le contenu est tÃ©lÃ©chargÃ© par le propre script du site.  Dans ce cas, Context est utilisÃ© pour calculer le jeton de demande, qui est Ã©gal Ã  la page contenant le script.  Pour le script site.net/1.js de la page Contexte site.net, il sera Ã©gal au contexte de la page elle-mÃªme. <br><blockquote>  Notez que le contexte de la page elle-mÃªme n'est pas toujours Ã©gal au nom de domaine de la page et dÃ©pend de la faÃ§on dont elle a Ã©tÃ© ouverte Ã  l'origine. </blockquote>  Supposons que le site de l'attaquant evil.com ouvre la page du site attaquÃ© site.net, oÃ¹ le script site.net/util.js exÃ©cute une requÃªte avec les paramÃ¨tres transmis via l'URL de la page.  L'attaquant espÃ¨re, en glissant Â«ses paramÃ¨tresÂ» via l'URL, forcer son propre script site.net/util.js Ã  exÃ©cuter une requÃªte ajax pour effectuer des actions importantes au nom de la victime. <br><br>  Supposons que l'utilisateur lui-mÃªme soit allÃ© sur evil.com via un lien direct.  Le contexte de evil.com sera alors evil.com.  De plus evil.com ouvre le script site.net/api/payment?victim_params avec un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">script</a> , dans l'espoir de mener une attaque, mais le champ Contexte de site.net sera vide (cas PE / PF).  Le script site.net/utils.js, exÃ©cutant une requÃªte ajax, forcera le navigateur Ã  prendre Context depuis la page site.net.  Et c'est vide chez nous.  Mais alors site.net recevra une demande ajax avec ce jeton: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup random) $" data-tex="display"></p><br>  alors que pour un utilisateur autorisÃ©, il est prÃ©vu: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net verra un jeton inconnu et ne pourra pas identifier l'utilisateur.  La protection a fonctionnÃ©. <br><blockquote>  Soit dit en passant, Ã  cause d'un tel schÃ©ma, la rÃ©alisation d'une autorisation interdomaine via des fenÃªtres contextuelles sera irrÃ©aliste. </blockquote>  Pour implÃ©menter l'authentification unique sous le protocole, vous devez ouvrir un nouvel onglet pour la page du serveur d'autorisation.  Et en mÃªme temps, l'utilisateur doit ouvrir un tel onglet.  La meilleure option est d'ouvrir Ã  l'utilisateur le lien appropriÃ© depuis le site cible. <br><br><a name="RC"></a>  <b>RC</b> - le contenu est chargÃ© avec un script de site Web externe.  Dans ce cas, Context est utilisÃ© pour calculer le jeton de demande, qui est Ã©gal au champ Request Referrer. <br><br>  MalgrÃ© le fait que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RB</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RC</a> protÃ¨gent contre les attaques CSRF, ils conduisent nÃ©anmoins Ã  la gÃ©nÃ©ration de jetons constants.  Et <b>cela vous permet d'implÃ©menter l'authentification interdomaine et</b> l' <b>authentification</b> utilisateur <b>interdomaine</b> (lorsque vous devez dÃ©terminer que plusieurs demandes adressÃ©es Ã  diffÃ©rents serveurs provenaient de cet utilisateur).  Ce qui peut Ãªtre mis en Å“uvre pour lui donner une autoritÃ© Ã©gale sur un groupe de domaines connexes. <br><br>  Si la <b>page</b> du <b>site a Ã©tÃ© ouverte automatiquement Ã </b> partir d'un autre site, vous ne pourrez pas vous y connecter, mÃªme si vous rechargez ce site vous-mÃªme.  Parce que Source hÃ©ritera d'une valeur nulle.  Le navigateur doit signaler Ã  l'utilisateur ce fait (Source = alÃ©atoire): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Ceci est fait pour se protÃ©ger contre les sites qui forcent d'autres fenÃªtres contextuelles Ã  s'ouvrir (elles-mÃªmes ou leurs scripts externes), et sur les sites qui s'ouvrent, ils redÃ©marreront ou crÃ©eront de faux boutons de fermeture sur tout l'Ã©cran menant aux mÃªmes sites.  C'est-Ã -dire  cela empÃªche une tentative de suivi, dans l'espoir d'obtenir un jeton valide. <br><br>  <b>Toute tentative par le site d'imiter vos actions avec un script externe</b> , ou une tentative par un script externe de crÃ©er directement ou indirectement une balise initiatrice et de vous la glisser, conduira Ã  une source vide et Ã  l'ajout d'octets alÃ©atoires au moment du calcul du hachage de jeton. <br><br>  L'astuce pour crÃ©er ou modifier la balise &lt;script&gt; dans la page attaquÃ©e dans le DOM n'aidera pas.  Le champ Source restera vide. <br><br>  Mais dans les mÃªmes conditions, les scripts internes conduiront Ã  des requÃªtes avec Source Ã©gale Ã  sa valeur prÃ©cÃ©dente.  Et si la page d'origine avait Source = Domain, tout irait bien.  L'utilisateur restera autorisÃ© pour de telles demandes. <br><br>  Mais avec des scripts tÃ©lÃ©chargÃ©s Ã  partir de ressources tierces (CDN), des problÃ¨mes peuvent survenir dans certains cas.  Et c'est vrai, car  L'intÃ©gritÃ© du code CDN n'est pas garantie.  Si vous ne voulez pas perdre l'autorisation de l'utilisateur, conservez les scripts sur votre site et tÃ©lÃ©chargez-les depuis votre domaine.  Cela ressemble Ã  l'interdiction d'utiliser des liens http sur les pages https. <br><br>  Nous dÃ©crivons la situation dans laquelle un dÃ©veloppeur peut tomber.  Ã€ la suite des actions de l'utilisateur, votre script redirige un utilisateur autorisÃ© vers l'une des pages du site (par exemple, cela se fait par un formulaire), ce qui nÃ©cessite que l'utilisateur reste autorisÃ©.  Votre script appelle, par exemple, $ (form) .submit () Ã  l'aide d'un script jQuery chargÃ© Ã  partir du CDN.  Dans ce cas, le navigateur voit que dans la pile d'appels qui a dÃ©clenchÃ© l'Ã©vÃ©nement d'envoi du formulaire, il existe une fonction d'un script externe.  Pour empÃªcher <abbr title="ContrefaÃ§on de demande intersite - Â«contrefaÃ§on de demande intersiteÂ»">les</abbr> attaques <abbr title="Script intersite - Â«script intersiteÂ»">XSS</abbr> / <abbr title="ContrefaÃ§on de demande intersite - Â«contrefaÃ§on de demande intersiteÂ»">CSRF</abbr> , le navigateur rend le champ Source vide et ajoute des octets alÃ©atoires Ã  la gÃ©nÃ©ration du jeton (cas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">P9</a> ).  En consÃ©quence, l'utilisateur sur la nouvelle page devient soudainement non autorisÃ© et ne peut pas terminer l'opÃ©ration.  Cela peut Ãªtre dÃ©routant pour les dÃ©veloppeurs habituÃ©s Ã  utiliser les CDN. <br><br><a name="protocol_scenario"></a><h2>  2.7 ScÃ©narios de protocole </h2><br>  Voici les principaux scÃ©narios probables de l'utilisateur travaillant avec le site, affectant toutes les situations possibles et les Ã©tapes de leur mise en Å“uvre (connexion anonyme, Â«se souvenir de moiÂ», Â«oublie-moiÂ», passer Ã  l'utilisation d'une clÃ© permanente, autorisation et sortie, enregistrement et authentification Ã  deux facteurs, exportation / importation de clÃ©s, remplacement de clÃ©s, etc.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 Forum, Blog, WikipÃ©dia </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  1.1 Premier accÃ¨s Ã  ce site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.2 Afficher les pages. </td><td>  Envoie un jeton sÃ©curisÃ© contre une clÃ© alÃ©atoire. </td><td>  Fournit du contenu public.  VÃ©rifie le bit de jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  1.3 Essayer de faire des actions (ajouter des commentaires, etc.) </td><td>  Envoie un jeton sÃ©curisÃ© contre une clÃ© alÃ©atoire. </td><td>  Indique Ã  l'utilisateur qu'il doit se prÃ©senter au systÃ¨me.  Ã€ ce stade, le site est convaincu que la clÃ© est alÃ©atoire. </td></tr><tr><td>  1.4 Indique au navigateur de faire en sorte que le site s'en souvienne. </td><td>  Corrige la clÃ© actuelle.  Envoie une clÃ© permanente.  Le jeton, comme prÃ©cÃ©demment, est transmis sous une forme protÃ©gÃ©e.  Envoie cette clÃ© jusqu'Ã  ce qu'elle reÃ§oive le succÃ¨s du serveur. </td><td>  Maintenant, le site sait que la clÃ© est fixe.  Envoie CSI-Token-Action: succÃ¨s.  Il peut appliquer la technique de mÃ©morisation de l'utilisateur pendant une longue pÃ©riode: il enregistre un jeton dans la base de donnÃ©es pour la rÃ©cupÃ©ration de session future avec l'utilisateur.  Ou maintient la session plus longtemps (enregistrer dans un fichier). </td></tr><tr><td>  1.5 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton CSI sÃ©curisÃ© Ã  partir d'une clÃ© fixe. </td><td>  Enregistre les actions de cet utilisateur. </td></tr><tr><td>  1.6 Ferme l'onglet du navigateur. </td><td>  Rien. </td><td>  Il attend les demandes des utilisateurs suivantes. </td></tr><tr><td>  1.7 Retourne sur le site. </td><td>  Envoie une clÃ© fixe sÃ©curisÃ©e. </td><td>  Continue de travailler avec l'utilisateur.  Les donnÃ©es de session sont extraites de la base de donnÃ©es ou du fichier temporaire par jeton. </td></tr><tr><td>  1.8 Annule la fixation des clÃ©s (oubliez-moi sur ce site) </td><td>  Envoie une clÃ© de dÃ©connexion </td><td>  Supprime les donnÃ©es utilisateur dans la base de donnÃ©es, comme  il s'agissait d'une clÃ© fixe et l'utilisateur ne pourra plus jamais la rÃ©cupÃ©rer.  Met fin Ã  la session.  Le navigateur n'enverra plus jamais un tel jeton. </td></tr><tr><td>  1.9 Lorsque vous accÃ©dez au site pour la premiÃ¨re fois aprÃ¨s la dÃ©connexion. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Ce site est dÃ©jÃ  un nouvel utilisateur.  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons le jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.10 Parcourir les pages. </td><td>  Envoie un jeton sÃ©curisÃ© contre une clÃ© alÃ©atoire. </td><td>  Fournit du contenu public.  VÃ©rifie le bit de jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  1.11 Ferme l'onglet du navigateur. </td><td>  Rien. </td><td>  Interrompt une session aprÃ¨s une temporisation. </td></tr><tr><td>  1.12 Retourne sur le site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.13 CrÃ©e une clÃ© de site permanente. </td><td>  Rien. </td></tr><tr><td>  1.14 Activation de la clÃ© permanente. </td><td>  <b>Demande Ã  l'utilisateur: voulez-vous vraiment que le site se souvienne de votre clÃ©?</b>  <b>Assurez-vous que ce site est bien celui qu'il prÃ©tend Ãªtre.</b> <br>  Envoie le changement vers.  Ce n'est qu'Ã  ce moment que le navigateur transmet le jeton aux personnes non protÃ©gÃ©es.  Dans tous les cas suivants, le navigateur transmettra toujours un jeton protÃ©gÃ© lors de la connexion.  Mais pour cela, le site doit confirmer le changement de jetons via CSI-Token-Action: succÃ¨s. </td><td>  N'oubliez pas le nouveau jeton utilisateur dans la base de donnÃ©es.  Modifie l'ID de session.  Continue d'attendre les demandes du nouveau jeton.  Envoie CSI-Token-Action: succÃ¨s. </td></tr><tr><td>  1.15 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton sÃ©curisÃ© Ã  partir d'une clÃ© permanente </td><td>  Enregistre les actions de cet utilisateur.  VÃ©rifie le jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  1.16 Effectue la "Sortie". </td><td>  Envoie une clÃ© de dÃ©connexion </td><td>  Rompre la session </td></tr><tr><td>  1.17 Retourne sur le site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons le jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.18 Activation de la clÃ© permanente. </td><td>  Envoie le changement vers.  Le jeton est dÃ©jÃ  protÃ©gÃ©, car  la derniÃ¨re fois que le site nous a rÃ©pondu CSI-Token-Action: succÃ¨s. </td><td>  Nous chargeons les donnÃ©es utilisateur enregistrÃ©es Ã  partir de la base de donnÃ©es.  Modifie l'ID de session.  Nous travaillons avec le jeton enregistrÃ©.  Nous savons qu'un jeton est basÃ© sur une clÃ© permanente. </td></tr><tr><td>  1.19 Ferme l'onglet du navigateur. </td><td>  Rien.  Ou la clÃ© de dÃ©connexion, si "sortie automatique" est configurÃ© lorsque l'onglet est fermÃ©. </td><td>  Interrompt une session aprÃ¨s un dÃ©lai d'expiration ou Ã  la rÃ©ception d'une clÃ© de dÃ©connexion. </td></tr><tr><th colspan="3">  2 Boutique en ligne ou site d'annonces </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  2.1 D'abord inclus sur ce site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  2.2 Afficher les pages. </td><td>  Envoie un jeton sÃ©curisÃ© contre une clÃ© alÃ©atoire. </td><td>  Fournit du contenu public.  VÃ©rifie le bit de jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  2.3 Essayer de faire des actions (ajouter des publicitÃ©s, des achats, etc.) </td><td>  Envoie un jeton sÃ©curisÃ© contre une clÃ© alÃ©atoire. </td><td>  Indique Ã  l'utilisateur qu'il doit se prÃ©senter au systÃ¨me.  Ã€ ce stade, le site est convaincu que la clÃ© est alÃ©atoire. </td></tr><tr><td>  2.4 Indique au navigateur de faire en sorte que le site s'en souvienne. </td><td>  Corrige la clÃ© actuelle.  Avant la premiÃ¨re demande, il envoie un jeton CSI sÃ©curisÃ© avec la clÃ© permanente.  AprÃ¨s avoir rÃ©ussi, il arrÃªte d'envoyer cette clÃ©. </td><td>  Maintenant, le site sait que la clÃ© est fixe.  Il peut appliquer la technique de la mÃ©morisation de l'utilisateur pendant une longue pÃ©riode: soit il enregistre le jeton dans la base de donnÃ©es pour une rÃ©cupÃ©ration future de la session avec l'utilisateur.  Ou tient la session plus longtemps (plusieurs jours). </td></tr><tr><td>  2.5 Effectue des actions (ajout d'annonces, d'achats, etc.) </td><td>  Envoie un jeton CSI sÃ©curisÃ© Ã  partir d'une clÃ© fixe. </td><td>  Enregistre les actions de cet utilisateur.  VÃ©rifie le jeton. </td></tr><tr><td>  2.6 Ferme l'onglet du navigateur. </td><td>  Rien. </td><td>  Tient la session.  Avec une inactivitÃ© prolongÃ©e, il enregistre les donnÃ©es de session de la RAM dans un fichier ou une base de donnÃ©es. </td></tr><tr><td>  2.7 Se connecte Ã  nouveau au site. </td><td>  Envoie une clÃ© fixe sÃ©curisÃ©e. </td><td>  La sÃ©ance se poursuit.  Nous travaillons avec l'utilisateur, comme si de rien n'Ã©tait. </td></tr><tr><td>  2.8 <b>CrÃ©e ou importe une</b> clÃ© de site persistante. </td><td>  Rien. </td></tr><tr><td>  2.9 Activation de la clÃ© permanente.  Ici, en fait, il y a une transition de l'utilisation d'une clÃ© fixe Ã  une clÃ© permanente. </td><td>  Envoie une clÃ© de modification.  Le jeton est transmis <b>sans protection</b> pour la clÃ© nouvellement crÃ©Ã©e et le jeton non enregistrÃ© sur le serveur.  Le jeton est transfÃ©rÃ© <b>protÃ©gÃ©</b> pour la clÃ© importÃ©e. </td><td>  2.9.A.  Jeton basÃ© sur la nouvelle clÃ©. <br>  Si l'ancien jeton a Ã©tÃ© enregistrÃ© dans la base de donnÃ©es - changez simplement le jeton dans la base de donnÃ©es. <br><br>  2.9.V.  Jeton basÃ© sur la clÃ© importÃ©e. <br>  Si l'ancien jeton a Ã©tÃ© enregistrÃ© dans la base de donnÃ©es - supprimez-le.  Lors de la fusion de deux profils d'un utilisateur (ce que vous pouvez lui demander) - car  en fait, l'utilisateur a deux jetons stockÃ©s dans la base de donnÃ©es: Ã  partir d'une clÃ© fixe et d'une clÃ© importÃ©e.  Modifie l'ID de session.  Envoie CSI-Token-Action: succÃ¨s.  Il continue d'attendre les demandes du nouveau jeton. </td></tr><tr><td>  2.10 Effectue des actions (achats, affichage d'annonces, panier d'achat, favoris, avis, comparaisons) </td><td>  Envoie un jeton sÃ©curisÃ© Ã  partir d'une clÃ© permanente </td><td>  Enregistre les actions de cet utilisateur.  VÃ©rifie le jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  2.11 Ferme l'onglet du navigateur. </td><td>  Rien.  Ou la clÃ© de dÃ©connexion, si "sortie automatique" est configurÃ© lorsque l'onglet est fermÃ©. </td><td>  Interrompt une session aprÃ¨s un dÃ©lai d'expiration ou Ã  la rÃ©ception d'une clÃ© de dÃ©connexion. </td></tr><tr><th colspan="3">  3 sites avec prÃ©-inscription obligatoire (rÃ©seau social) </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  3.1 Inclus sur ce site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous ne laissons que dans les sections publiques.  Lorsque vous essayez d'accÃ©der au contenu fermÃ©, nous traduisons dans le formulaire d'autorisation. </td></tr><tr><td>  3.2 CrÃ©e une clÃ© de site permanente </td><td>  Rien </td></tr><tr><td>  3.3 Activation de la clÃ© permanente. </td><td>  <b>Demande Ã  l'utilisateur: voulez-vous vraiment que le site se souvienne de votre clÃ©?</b>  <b>Assurez-vous que ce site est bien celui qu'il prÃ©tend Ãªtre.</b> <br><br>  Envoie le changement vers. <br>  <b>Le jeton est transmis en clair</b> . </td><td>  N'oubliez pas le nouveau jeton.  Nous ne sommes pas pressÃ©s d'enregistrer dans la base de donnÃ©es tant que l'enregistrement n'est pas encore terminÃ©.  Nous gardons l'utilisateur sur le formulaire Â«InscriptionÂ» jusqu'Ã  confirmation de la propriÃ©tÃ© (par tÃ©lÃ©phone, courrier).  Envoie CSI-Token-Action: enregistrement </td></tr><tr><td>  3.4 Entrez vos coordonnÃ©es. </td><td>  Envoie des requÃªtes ajax.  Envoie le changement vers.  Ancien jeton sur la mÃªme clÃ© alÃ©atoire. <br>  <b>Le nouveau jeton est dÃ©jÃ  transfÃ©rÃ© sous une forme protÃ©gÃ©e</b> . <br><br>  DÃ¨s qu'il rÃ©ussit, il passe Ã  l'utilisation d'un nouveau jeton (clÃ© permanente). </td><td>  VÃ©rifie les coordonnÃ©es.  Si tout rÃ©ussit, il envoie CSI-Token-Action: succÃ¨s.  Sinon: CSI-Token-Action: inscription.  Si CSI-Token-Action: abandon est envoyÃ©, l'enregistrement ne rÃ©ussit pas.  Le navigateur devrait revenir Ã  l'utilisation d'un nombre alÃ©atoire (annulation de la saisie).  Et signalez cela Ã  l'utilisateur. </td></tr><tr><td>  3.5 Va dans la section fermÃ©e du site </td><td>  Envoie un jeton sÃ©curisÃ© Ã  partir d'une clÃ© permanente. </td><td>  Fournit un accÃ¨s en vÃ©rifiant le jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  3.6 Effectue des actions (achats, affichage d'annonces, panier d'achat, favoris, avis, comparaisons) </td><td>  Envoie un jeton sÃ©curisÃ© Ã  partir d'une clÃ© permanente. </td><td>  Enregistre les actions de cet utilisateur.  VÃ©rifie le jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  3.7 Ferme l'onglet du navigateur. </td><td>  Rien.  Ou la clÃ© de dÃ©connexion, si "sortie automatique" est configurÃ© lorsque l'onglet est fermÃ©. </td><td>  Interrompt une session aprÃ¨s un dÃ©lai d'expiration ou Ã  la rÃ©ception d'une clÃ© de dÃ©connexion. </td></tr><tr><td>  3.8 Inclus dans ce site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous ne laissons que dans les sections publiques.  Lorsque nous essayons d'accÃ©der Ã  un contenu fermÃ©, nous informons l'utilisateur qu'il est un utilisateur anonyme. </td></tr><tr><td>  3.9 Activation de la clÃ© permanente. </td><td>  Envoie le changement vers.  Les deux jetons sont transmis de maniÃ¨re sÃ©curisÃ©e. </td><td>  Nous chargeons les donnÃ©es utilisateur de la base de donnÃ©es par jeton (le 128 bits le plus Ã©levÃ©).  Maintenant, le site sait qui est cet utilisateur. </td></tr><tr><td>  3.10 Modifie la clÃ© permanente du domaine (en un autre permanent) </td><td>  <b>Demande Ã  l'utilisateur: voulez-vous vraiment que le site se souvienne de votre nouvelle clÃ©?</b>  <b>Assurez-vous que ce site est bien celui qu'il prÃ©tend Ãªtre.</b> <br><br>  Envoie le changement vers. <br>  <b>Le nouveau jeton est transfÃ©rÃ© en clair;</b>  <b>vieux - dans protÃ©gÃ©</b> <br></td><td>  Remplace le jeton de la base de donnÃ©es par un nouveau.  Charge les donnÃ©es de profil.  Utilise un nouveau jeton Ã  partir des demandes suivantes.  Envoie CSI-Token-Action: succÃ¨s </td></tr><tr><td>  3.11 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton sÃ©curisÃ© Ã  partir d'une nouvelle clÃ© </td><td>  Enregistre les actions de cet utilisateur.  VÃ©rifie le jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  3.12 Effectue une "sortie". </td><td>  Envoie une clÃ© de dÃ©connexion </td><td>  Rompre la session </td></tr><tr><td>  3.13 Inclus sur ce site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous traduisons vers le formulaire d'autorisation. </td></tr><tr><td>  3.14 Activation d'une clÃ© permanente </td><td>  Envoie le changement vers.  Les deux jetons sont transmis de maniÃ¨re sÃ©curisÃ©e. </td><td>  Nous chargeons les donnÃ©es utilisateur de la base de donnÃ©es par jeton (le 128 bits le plus Ã©levÃ©). </td></tr><tr><td>  3.15 Importe une clÃ© diffÃ©rente pour ce domaine. <br>  <b>Important: la clÃ© importÃ©e doit Ãªtre enregistrÃ©e sur le serveur.</b> <br></td><td>  Envoie une clÃ© DÃ©connexion Passe Ã  l'utilisation d'une clÃ© alÃ©atoire. </td><td>  Rompre la session </td></tr><tr><td>  3.16 Active une nouvelle clÃ© </td><td>  Envoie le changement vers. <br>  <b>Les deux jetons sont transmis de maniÃ¨re sÃ©curisÃ©e.</b> <br><br>  Veuillez noter que la clÃ© Â«prÃ©cÃ©denteÂ» est dÃ©jÃ  une clÃ© alÃ©atoire (voir 3.15). </td><td>  Cette clÃ© doit Ãªtre connue de la base de donnÃ©es.  <b>L'exportation</b> de <b>clÃ© Ã </b> partir du navigateur n'est autorisÃ©e que pour les jetons enregistrÃ©s.  Ainsi, le navigateur est sÃ»r que la <b>clÃ© importÃ©e est connue du serveur</b> et l'envoie sÃ©curisÃ©e.  Sinon, le serveur ne peut pas reconnaÃ®tre le jeton utilisateur et ne peut pas l'autoriser. </td></tr><tr><td>  3.17 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton sÃ©curisÃ© Ã  partir d'une nouvelle clÃ© </td><td>  Enregistre les actions de cet utilisateur.  VÃ©rifie le jeton infÃ©rieur de 128 bits. </td></tr><tr><td>  3.18 sort </td><td>  Envoie une clÃ© de dÃ©connexion </td><td>  Rompre la session </td></tr><tr><th colspan="3">  4 sites avec autorisation Ã  deux facteurs (Sberbank Online) </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  4.1 Inclus sur ce site. </td><td>  GÃ©nÃ¨re une clÃ© alÃ©atoire.  Envoie un jeton non sÃ©curisÃ© Ã  partir d'une clÃ© alÃ©atoire. </td><td>  Nous considÃ©rons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous traduisons vers le formulaire d'autorisation. </td></tr><tr><td>  4.2 CrÃ©e une clÃ© de site permanente </td><td>  Rien </td></tr><tr><td>  4.3 Activation de la clÃ© permanente. </td><td>  <b>Demande Ã  l'utilisateur: voulez-vous vraiment que le site se souvienne de votre clÃ©?</b>  <b>Assurez-vous que ce site est bien celui qu'il prÃ©tend Ãªtre.</b> <br><br>  Envoie le changement vers. <br>  <b>Le jeton est transmis en clair</b> . </td><td>  Le jeton n'est pas connu du site.  N'oubliez pas le nouveau jeton.     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  Â«Â» </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  Â«Â»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          Â«Â». </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  Â«Â»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   Â«Â»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess â€“ .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 â€“ Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   Â«Â»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  Â« Â» </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           Â«Â» </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConsidÃ¨re l'utilisateur anonyme. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affiche le message "AccÃ¨s refusÃ©"</font></font></b> <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.8 Activation de la clÃ© permanente. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoie le changement vers. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le jeton est transmis sous une forme protÃ©gÃ©e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (car il est dÃ©jÃ  connu de l'appareil; nous avons passÃ© l'enregistrement plus tÃ´t).</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifie l'utilisateur par le jeton 128 bits le plus Ã©levÃ©. </font><font style="vertical-align: inherit;">VÃ©rifie les bits faibles.</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.9 Effectue des actions privilÃ©giÃ©es </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoie un jeton sÃ©curisÃ© Ã  partir d'une clÃ© permanente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effectue des actions conformÃ©ment aux privilÃ¨ges de l'utilisateur. </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.10 Sort </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoie une clÃ© de dÃ©connexion </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rompre la session </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un exemple de configuration d'accÃ¨s aux jetons basÃ© sur le fichier .htaccess. </font></font><br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chat /etc/apache2/.csi_keys </font></font></pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.7.1 Algorithme de calcul des jetons utilisateur possibles d'un site Ã  l'aide d'une clÃ© connue </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous connaissons la clÃ© de domaine K, nous pouvons facilement calculer le jeton T "valide" possible de l'utilisateur qui viendra avec ses demandes. </font><font style="vertical-align: inherit;">Pour cela, il faut que la condition soit remplie: l'initiateur des requÃªtes, le destinataire des requÃªtes et le contexte d'exÃ©cution doivent correspondre et Ãªtre Ã©gaux au domaine. </font><font style="vertical-align: inherit;">En d'autres termes, si nous avons le nom de domaine vsphere.local, alors:</font></font><br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã€ partir de lÃ , le jeton d'origine (brut) est calculÃ© comme suit: </font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la transmission, le jeton d'origine sera davantage protÃ©gÃ©. </font><font style="vertical-align: inherit;">Les 128 bits infÃ©rieurs du jeton seront hachÃ©s avec le sel passÃ© dans l'en-tÃªte de demande CSI-Salt </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ainsi, le site verra le jeton suivant:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OÃ¹ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspond aux 128 bits supÃ©rieurs, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspond aux 128 bits infÃ©rieurs du jeton d'origine. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, pour les consoles de gestion fermÃ©es sur un rÃ©seau d'entreprise, les consoles Web ne chargent pas de scripts, de cadres, etc. externes. </font><font style="vertical-align: inherit;">Par consÃ©quent, cette condition sera remplie dans la plupart des cas.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Pour la mÃ©thode de formation du sel, voir la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«ProcÃ©dure d'Ã©change de sel entre le navigateur et le serveurÂ».</font></font></a></sup> <br><br><a name="server_token_processing"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.8 Traitement des jetons sur le serveur </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoi d'un token au serveur (sans clÃ©s) </font></font></h3><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã‰tat du jeton T dans la session de site </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Actions du serveur de site </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inconnu </font></font></td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt â€“   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    â€“  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le navigateur verrouille la clÃ© client. </font><font style="vertical-align: inherit;">L'utilisateur souhaite que le site se souvienne du client pendant plusieurs sessions. </font><font style="vertical-align: inherit;">Le stockage du jeton utilisateur dans sa base de donnÃ©es est la dÃ©cision du serveur. </font><font style="vertical-align: inherit;">Nous renvoyons CSI-Token-Action: succÃ¨s ou CSI-Token-Action: abandon au client.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoi d'un jeton avec une clÃ© de dÃ©connexion </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indique que le jeton actuel ne sera plus utilisÃ© par le navigateur. </font><font style="vertical-align: inherit;">EnvoyÃ© lorsque l'utilisateur clique sur "Quitter" dans le navigateur, ou ferme l'onglet et l'option est configurÃ©e (sortie automatique lorsque l'onglet est fermÃ©), ou refuse d'utiliser une clÃ© fixe ("oublie-moi sur ce site").</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, l'autologin ne devrait pas l'Ãªtre. </font><font style="vertical-align: inherit;">Pour des raisons de sÃ©curitÃ©.</font></font></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoi d'un jeton avec une clÃ© de modification </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appelons l'ancien jeton T, le nouveau - T '. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMPORTANT: en</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tant que nouveau jeton T ', la valeur rÃ©elle du jeton est envoyÃ©e (pour la premiÃ¨re fois, pour les non enregistrÃ©s), tandis que l'ancien jeton est envoyÃ© hachÃ© (les 128 bits infÃ©rieurs).</font></font><br><div class="scrollable-table"><table><tbody><tr><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statut du jeton dans la base de donnÃ©es du serveur </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup> </td><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Actions du serveur de site </font></font></td></tr><tr><td>  T </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T ' </font></font></td></tr><tr><td>  non </td><td>  non </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Motif: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistrement lÃ©gal de l'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplacez l'identifiant de session utilisateur par T ' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoyer le client CSI-Token-Action: succÃ¨s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisateur a crÃ©Ã© une clÃ© permanente pour le site et a effectuÃ© la Â«connexionÂ». </font><font style="vertical-align: inherit;">Le serveur peut stocker un tel jeton sur son cÃ´tÃ©. </font><font style="vertical-align: inherit;">Et avant cela, proposez de remplir le formulaire d'inscription (si nÃ©cessaire).</font></font><br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   â€“      (  ). <br></td></tr><tr><td>  non </td><td>  est lÃ  </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       Â«Â» .    <b>      </b> ,       -.  Parce que    Â«  Â»,    . <br></td></tr><tr><td>  est lÃ  </td><td>  non </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  <br>  <br></td><td>  est lÃ  </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      â€“ . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  <br>  <br> . <br></td><td>  est lÃ  </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , â€“  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme mentionnÃ© prÃ©cÃ©demment, les sites peuvent interagir avec d'autres sites partenaires ou leurs sous-domaines pour fournir Ã  l'utilisateur certaines des fonctionnalitÃ©s. L'exemple le plus courant est lorsque sur le site site.ru certaines des ressources sont chargÃ©es Ã  partir des sous-domaines img.site.ru, une partie de download.site.ru et une autre partie d'autres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, le site site.ru doit pouvoir informer ses domaines partenaires dont les demandes lui parviennent exactement. En effet, si vous Ãªtes autorisÃ© sur site.ru, cela ne vous rend pas automatiquement autorisÃ© sur d'autres sites, y compris les sous-domaines du site. Ils verront d'autres jetons de votre part. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyons comment le jeton est calculÃ© et comment cela peut nous aider. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laissez l'utilisateur se connecter Ã  site.ru avec une clÃ© permanente et y avoir un jeton:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Toutes les demandes provenant de la page du site site.ru vers le domaine site.ru et causÃ©es par: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> balises de ressource de page (dynamique statique ou native) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propres scripts </font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aura un jeton T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir rÃ¨gles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Ce sont des demandes lÃ©gitimes Ã  site.ru. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, laissez le client tÃ©lÃ©charger le fichier restreint Ã  partir de la page site.ru, mais le lien mÃ¨ne Ã  download.site.ru. </font><font style="vertical-align: inherit;">Dans ce cas, le sous-domaine recevra le jeton suivant (rÃ¨gles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactement le mÃªme jeton download.site.ru recevra si une demande ajax de la page du site site.ru est exÃ©cutÃ©e dessus (rÃ¨gles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre domaine de domaine recevra un jeton:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais, notez que si les conditions pour rÃ©pondre aux demandes ne changent pas, alors pour un ensemble donnÃ© de domaines A, B, C, le navigateur gÃ©nÃ©rera toujours un jeton constant. </font><font style="vertical-align: inherit;">Nous pouvons donc effectuer une identification interdomaines. </font><font style="vertical-align: inherit;">Par exemple, comme Ã§a. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depuis site.ru, nous faisons des demandes ajax pour les sous-domaines. </font><font style="vertical-align: inherit;">Nous passons l'identifiant ID! = T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 de l'</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisateur, qui lui est dÃ©livrÃ© par site.ru. </font><font style="vertical-align: inherit;">Les sous-domaines recevront des jetons T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le mÃªme utilisateur </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Chacun des sous-domaines fera un tas de son jeton avec l'ID utilisateur. </font><font style="vertical-align: inherit;">Les sous-domaines partageront dÃ©jÃ  des informations sur l'ID utilisateur et ses droits avec les demandes de serveur Ã  serveur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bouquet est fait une fois. </font><font style="vertical-align: inherit;">Par la suite, les sous-domaines seront guidÃ©s par leurs propres jetons, comme </font><font style="vertical-align: inherit;">ils seront Ã©galement permanents pour la clÃ© permanente site.ru.</font></font><br><br><a name="part3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 Recommandations de sÃ©curitÃ© </font></font></h1><br><div class="spoiler">  <b class="spoiler_title">Remarque</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.1 Protection des informations clÃ©s contre les accÃ¨s non autorisÃ©s </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole d'autorisation proposÃ© protÃ¨ge l'utilisateur contre les enregistreurs de frappe qui volent vos mots de passe, car le schÃ©ma proposÃ© n'utilise aucun mot de passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais les moyens de protÃ©ger les clÃ©s contre les compromis doivent Ãªtre examinÃ©s plus en dÃ©tail. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les clÃ©s peuvent Ãªtre compromises par:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> copie des informations clÃ©s par un logiciel malveillant (accÃ¨s Ã  distance) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accÃ¨s direct au fichier avec les informations clÃ©s "hors ligne" (accÃ¨s direct) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moment de la distribution entre les appareils </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En supposant que les informations clÃ©s sont stockÃ©es sur une carte Ã  puce (nous avons considÃ©rÃ© cette option dans la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«MobilitÃ© du compteÂ»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), la tÃ¢che de protection des informations clÃ©s est transfÃ©rÃ©e sur la puce. Certes, il existe une vulnÃ©rabilitÃ© aux enregistreurs de frappe qui peuvent intercepter le code PIN saisi; Eh bien, dÃ©sagrÃ©ment Ã  utiliser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus des cartes Ã  puce, le cryptage symÃ©trique peut Ãªtre utilisÃ© pour se protÃ©ger contre l'accÃ¨s direct aux informations clÃ©s. Mais la question est: quelle clÃ© prendre pour le chiffrement? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si cette clÃ© est gÃ©nÃ©rÃ©e sur la base du mot de passe de l'utilisateur, alors, d'une part, nous obtenons une vulnÃ©rabilitÃ© Ã  la sÃ©lection du mot de passe Â«hors ligneÂ», et d'autre part, en fait, de ce qu'ils ont laissÃ©, ils en sont venus Ã : Â«encore une fois, certains mots de passeÂ». </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une option plus correcte consiste Ã  </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coudre d'une maniÃ¨re spÃ©ciale </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une telle clÃ© dans l'assemblage du navigateur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou l'une de ses bibliothÃ¨ques spÃ©cialisÃ©es). Chaque mise Ã  jour du navigateur modifie Ã  la fois la clÃ© et son emplacement dans le fichier compilÃ©. Cette approche ne donnera pas une garantie de protection Ã  100%, mais compliquera sÃ©rieusement la tÃ¢che de dÃ©cryptage. Tout d'abord, l'attaquant devra trouver la version exacte de l'assemblage, puis la trouver, la dÃ©monter et dÃ©couvrir comment la clÃ© est assemblÃ©e.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, les clÃ©s de domaine elles-mÃªmes doivent Ãªtre directement stockÃ©es dans un fichier sÃ©parÃ©, et non avec la configuration pour leur utilisation (c'est-Ã -dire uniquement les clÃ©s et rien de plus). Ensuite, leur dÃ©chiffrement par sÃ©lection de clÃ© (Ã  partir d'assemblages connus) sera impossible, car il est impossible de distinguer une clÃ© correctement dÃ©chiffrÃ©e d'une sÃ©quence alÃ©atoire d'octets. Ensuite, les tentatives de rÃ©cupÃ©ration d'une clÃ© principale sans connaÃ®tre la version exacte de l'assemblage du navigateur et le dÃ©montage direct de son code deviendront impossible. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser l'option combinÃ©e: cryptage avec la clÃ© du navigateur + cryptage avec le mot de passe utilisateur du compte OS (si l'API OS le permet). De plus, la clÃ© est toujours gÃ©nÃ©rÃ©e Ã  la volÃ©e. La force brute hors ligne deviendra alors encore plus chÃ¨re.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, aprÃ¨s avoir changÃ© le mot de passe utilisateur dans le systÃ¨me d'exploitation, la clÃ© changera Ã©galement. </font><font style="vertical-align: inherit;">Et si vous ne prÃ©-dÃ©cryptez pas sur l'ancienne clÃ©, cela vous protÃ©gera contre les situations oÃ¹ l'administrateur de l'ordinateur change votre mot de passe afin d'accÃ©der Ã  votre compte et d'effectuer des actions en votre nom. </font><font style="vertical-align: inherit;">Situations du type: quitter son emploi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous allez d'abord faire une copie de sauvegarde des clÃ©s (exporter les clÃ©s dans un fichier). </font><font style="vertical-align: inherit;">Sauf si, bien sÃ»r, vous l'avez dÃ©jÃ  fait lors de la distribution de clÃ©s Ã  d'autres appareils.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Par exemple, une clÃ© de 32 octets est distribuÃ©e de maniÃ¨re alÃ©atoire dans la section 64 Ko d'un fichier exÃ©cutable. </font><font style="vertical-align: inherit;">Et seul le code source sait comment rÃ©cupÃ©rer la clÃ© prÃ©cieuse de ces octets.</font></font></sup> <br><br><a name="why_password_for_keys_not_good"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.2 Ã€ propos des mots de passe en tant que clÃ©s de domaine </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'une des versions initiales du protocole, la clÃ© de domaine pouvait Ãªtre gÃ©nÃ©rÃ©e en fonction du mot de passe de l'utilisateur. L'algorithme Ã©tait dÃ©licat, Ã  l'exclusion des clÃ©s en double pour diffÃ©rents domaines pour le mÃªme mot de passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela a Ã©tÃ© positionnÃ© comme un moyen pratique d'accÃ©der aux comptes de mobilitÃ©. Saisie d'un mot de passe et ne vous inquiÃ©tez de rien. Mais il s'est avÃ©rÃ© ce qui suit:</font></font><br><br><ol><li>     ,     Â«Â» ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  C'est-Ã -dire       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  C'est-Ã -dire      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et si je perds la clÃ© principale?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cela peut se produire si vous modifiez votre mot de passe ou rÃ©installez le systÃ¨me d'exploitation. Quels sont les risques? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, vous n'irez pas sur les sites oÃ¹ vous Ã©tiez auparavant. Perdez votre historique d'achat sur les boutiques en ligne, vos annonces sur les sites en ligne, le karma sur les forums. Peu importe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais qui empÃªche de refaire la procÃ©dure d'enregistrement avec un nouveau token et de le confirmer via le numÃ©ro de tÃ©lÃ©phone indiquÃ© dans la mÃªme annonce? Il s'avÃ¨re que le site doit faire une forme de rÃ©-enregistrement du token (un analogue de "rÃ©cupÃ©ration de mot de passe")? OÃ¹ est l'absence promise de Â«toutes sortes deÂ» formes? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, un site qui doit non seulement identifier le visiteur, mais aussi savoir qui il est, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devra</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faire un formulaire d'inscription. </font><font style="vertical-align: inherit;">En fait, ce formulaire peut Ãªtre utilisÃ© pour une rÃ©inscription. </font><font style="vertical-align: inherit;">Vous spÃ©cifiez exactement les mÃªmes donnÃ©es qu'auparavant (email, mobile). </font><font style="vertical-align: inherit;">Confirmez que vous disposez de ces donnÃ©es (lettre, SMS). </font><font style="vertical-align: inherit;">Le systÃ¨me voit qu'un tel compte existe dÃ©jÃ , les donnÃ©es vous appartiennent Ã  100%, mais le jeton est diffÃ©rent - il rÃ©Ã©crit le jeton. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais encore, il vaut mieux ne pas perdre la clÃ© principale.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment Ã©viter les pertes? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrÃ©ez une copie de sauvegarde, protÃ©gez-la avec un mot de passe et stockez-la sur un support jetable. </font><font style="vertical-align: inherit;">De plus, en fait, comme cela se fait avec les clÃ©s pour Bitcoin. </font><font style="vertical-align: inherit;">En principe, vous pouvez traduire les clÃ©s principales sous forme imprimÃ©e et les enregistrer sur une feuille de papier. </font><font style="vertical-align: inherit;">D'ailleurs. </font><font style="vertical-align: inherit;">Et puis restaurer par entrÃ©e manuelle. </font><font style="vertical-align: inherit;">Mais c'est pour des gens assez Â«paranoÃ¯aquesÂ» comme moi.</font></font><br></blockquote><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais que se passe-t-il si on me vole une clÃ© principale?</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C'est dÃ©jÃ  grave. Bien que les recommandations dÃ©crites ici pour le stockage de la clÃ© principale (non incluses dans le protocole) les protÃ¨gent contre la falsification directe, les enregistreurs de frappe et les chevaux de Troie, nÃ©anmoins, le risque de compromettre la clÃ© principale demeure. Malheureusement, une protection parfaite n'existe pas. La clÃ© peut Ãªtre dÃ©tournÃ©e directement de la mÃ©moire du navigateur via une vulnÃ©rabilitÃ© du moteur javascript. Par exemple. Ou perdez-vous votre tÃ©lÃ©phone portable ... </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors, quels sont les risques de voler une clÃ© principale?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indispensable pour recevoir des informations sur vous et mÃªme pour agir en votre nom. Obtenir la possibilitÃ© pour un attaquant de se connecter sous vous et en mode lecture pour accÃ©der Ã  des informations sensibles.</font></font> Calme et tranquille.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou tÃ©lÃ©chargez simultanÃ©ment toutes vos vidÃ©os privÃ©es de vos camarades de classe. C'est dÃ©sagrÃ©able pour toi. Les fans de phoques se rÃ©jouissent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, vous devez vous rÃ©inscrire rapidement avec une nouvelle clÃ© sur des sites importants. Et, si quelque chose de terrible s'est produit, l'enregistrement de votre nouveau jeton dans la base de donnÃ©es du fournisseur de services de maniÃ¨re officielle est la seule bonne option. Vous pouvez penser Ã  de nombreuses mÃ©thodes d'enregistrement: de la fixation du papier dans une lettre officielle, Ã  une demande via le service d'assistance technique du site avec confirmation de votre identitÃ© de maniÃ¨re acceptable. Mais ce n'est que pour les sites sÃ©rieux, comme les services bancaires en ligne.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FaÃ§ons de minimiser les risques. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation de clÃ©s individuelles pour les domaines (mais cela rÃ©duit la mobilitÃ© des comptes). </font><font style="vertical-align: inherit;">Authentification Ã  deux facteurs via des canaux indÃ©pendants. </font><font style="vertical-align: inherit;">Le site affiche les adresses IP et les appareils sur lesquels la connexion Ã©tait Ã©tablie la derniÃ¨re fois, afin que vous remarquiez au moins un compromis.</font></font><br></blockquote><br><br><a name="part4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 Attaques contre le rÃ©gime d'autorisation </font></font></h1><br><br><a name="attack_user_tracking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.1 Suivi des utilisateurs </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un site de confiance peut fusionner sans vergogne des informations vous concernant avec d'autres sites. </font><font style="vertical-align: inherit;">Sur Internet, il existe des sites collecteurs qui regroupent ces informations et les vendent Ã  tout le monde. </font><font style="vertical-align: inherit;">Statistiques Yandex, Google Analytics - un site rare s'en passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour que deux sites diffÃ©rents puissent dÃ©terminer qu'ils travaillent avec le mÃªme client, deux techniques sont utilisÃ©es:</font></font><br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a un lÃ©ger inconvÃ©nient dans le schÃ©ma 2: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non pas l'utilisateur est identifiÃ©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais le navigateur. Mais souvent, le navigateur == client. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble que le jeton soit le mieux adaptÃ© pour une utilisation dans le schÃ©ma n Â° 2. AprÃ¨s tout, si l'utilisateur a permis Ã  deux sites (agissant en couple) de se Â«souvenirÂ» d'eux-mÃªmes, notre jeton permanent peut agir comme une telle Â«empreinte digitaleÂ», non seulement le navigateur, mais l'utilisateur lui-mÃªme. Le problÃ¨me pour les sites ici est qu'ils </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recevront des jetons diffÃ©rents</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais les sites peuvent essayer d'appliquer Ã©galement le schÃ©ma n Â° 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site 1 recevra le code H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du navigateur </font><font style="vertical-align: inherit;">et le site 2, exÃ©cutÃ© dans le contexte du site 1, </font><font style="vertical-align: inherit;">recevra le </font><font style="vertical-align: inherit;">code H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il semble maintenant que les sites peuvent former une paire (H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , H</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et mÃªme le transmettre Ã  un site d'agrÃ©gateur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'un autre site 3, associÃ© au site 2, essaie de vous suivre. </font><font style="vertical-align: inherit;">Le site 3 recevra le jeton H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du navigateur </font><font style="vertical-align: inherit;">, et le site 2, exÃ©cutÃ© dans le contexte du site 3, </font><font style="vertical-align: inherit;">recevra le </font><font style="vertical-align: inherit;">jeton H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 '</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir comment les jetons sont formÃ©s). </font><font style="vertical-align: inherit;">En consÃ©quence, la combinaison des donnÃ©es obtenues est impossible, car </font><font style="vertical-align: inherit;">ils n'ont pas de parties qui se chevauchent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cela ne signifie pas que les sites ne pourront pas utiliser un navigateur d'empreintes digitales pour surveiller</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il indique seulement que le schÃ©ma de gÃ©nÃ©ration de jetons lui-mÃªme est assez fiable et protÃ¨ge contre le suivi. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option de protection:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DÃ©connectez-vous des sites avec lesquels vous avez fini de travailler. </font><font style="vertical-align: inherit;">Le navigateur peut le faire automatiquement lorsque vous fermez l'onglet.</font></font><br><br><a name="attack_XSS"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.2 Attaque XSS </font></font></h2><br><br> <abbr title="Cross-Site Scripting â€” Â« Â»"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un type d'attaque impliquant l'introduction de code malveillant sur la page du site Web victim.com. </font><font style="vertical-align: inherit;">Par exemple, via un script d'affiliation ou un CDN piratÃ© d'un framework populaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un code malveillant peut utiliser l'autorisation de l'utilisateur sur le site pour y accÃ©der ou pour voler des donnÃ©es d'authentification de l'utilisateur. </font><font style="vertical-align: inherit;">Un code malveillant peut Ãªtre insÃ©rÃ© dans une page via une vulnÃ©rabilitÃ© dans un serveur Web (piratage trivial), via des rÃ©seaux affiliÃ©s (sources peu fiables), via une vulnÃ©rabilitÃ© sur l'ordinateur d'un utilisateur (crawling de chevaux de Troie). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La protection principale contre de telles attaques pour notre schÃ©ma d'autorisation est constituÃ©e de rÃ¨gles spÃ©ciales pour gÃ©nÃ©rer le champ Source lors du calcul des jetons. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulnÃ©rabilitÃ©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: pour XSS stockÃ© (lorsque le script est directement insÃ©rÃ© dans le site attaquÃ© et chargÃ© Ã  partir de celui-ci suite au piratage du serveur), la protection ne fonctionnera pas. </font><font style="vertical-align: inherit;">Parce que le navigateur ne pourra pas identifier un tel script comme Â«externeÂ». </font><font style="vertical-align: inherit;">Le mÃªme problÃ¨me se produit lorsqu'un attaquant effectue un proxy sur le trafic client-serveur.</font></font><br><br><a name="attack_CSRF"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.3 Attaque CSRF </font></font></h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La victime visite le site evil.com, crÃ©Ã© par un attaquant. En son nom, une requÃªte (GET / POST / HEAD / PUT / DELETE) est exÃ©cutÃ©e vers un site oÃ¹ l'utilisateur est dÃ©jÃ  autorisÃ© (par exemple, vers un serveur de systÃ¨me de paiement). La demande elle-mÃªme effectue une sorte d'opÃ©ration malveillante (par exemple, le transfert d'argent sur le compte de l'attaquant). Selon la supervision des dÃ©veloppeurs, le site ne vÃ©rifie pas les champs Referer et ne demande pas d'informations de vÃ©rification supplÃ©mentaires Ã  l'utilisateur. En consÃ©quence, l'attaque est rÃ©ussie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le schÃ©ma d'autorisation de site proposÃ© supprime la plupart des scÃ©narios d'attaque </font></font><abbr title="ross Site Request Forgery â€” Â«  Â»"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSRF</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en raison de l'algorithme de gÃ©nÃ©ration de jetons. </font><font style="vertical-align: inherit;">Toute demande intersite entraÃ®nera la rÃ©ception par le site attaquÃ© d'un jeton non valide de l'utilisateur. </font><font style="vertical-align: inherit;">Par consÃ©quent, dans cette situation, l'utilisateur du site attaquÃ© sera anonyme anonyme. </font><font style="vertical-align: inherit;">MÃªme une tentative d'exÃ©cution d'une demande GET inoffensive d'un site attaquant Ã  un site attaquÃ© (tÃ©lÃ©chargement d'une image) entraÃ®nera la rÃ©ception par ce dernier d'un jeton invalide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela devrait grandement simplifier la vie des dÃ©veloppeurs de sites.</font></font><br><br><a name="attack_SSO"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.4 Suivi Ã  l'aide de l'authentification unique </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux sites S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , auxquels l'utilisateur fait confiance et dont il dispose les clÃ©s, dÃ©cident d'appliquer une technologie similaire Ã  SSO pour le suivi des utilisateurs. Mais depuis vous ne pouvez pas intÃ©grer un site dans un autre (l'un d'eux recevra un jeton non valide), vous ne pouvez pas ouvrir le site d'un partenaire avec un script (pour la mÃªme raison), puis le site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dÃ©cide d'utiliser une technique dÃ©licate. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur l'une des pages, il place une Ã©tiquette translucide A, couvrant toute la fenÃªtre. Le lien mÃ¨ne au site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et l'identifiant utilisateur (Ã  partir de S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et le jeton H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 sont</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmis dans l'adresse </font><font style="vertical-align: inherit;">. L'utilisateur ne voit pas le lien. En cliquant sur n'importe quelle zone du site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il dÃ©clenche l'ouverture d'un nouvel onglet sur le site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour le moment, S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne recevra pas de jeton valide. </font><font style="vertical-align: inherit;">L'auto-rechargement avec une balise ne l'aidera pas non plus</font></font><br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou un script. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut crÃ©er la balise A sur toute sa page sous la forme d'un faux bouton Fermer:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce lien rechargera d'abord le site, puis le fermera. </font><font style="vertical-align: inherit;">Au moment du redÃ©marrage, le navigateur enverra le </font><font style="vertical-align: inherit;">token H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> dÃ©jÃ  valide </font><font style="vertical-align: inherit;">au site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (car la rÃ¨gle 2.4 P1 a Ã©tÃ© respectÃ©e: l'utilisateur a personnellement ouvert les deux liens). </font><font style="vertical-align: inherit;">En consÃ©quence, S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> recevra des informations sur les actions de son utilisateur sur le site S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> , associera le jeton H </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> Ã  son H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> et enverra Ã  H </font><sub><font style="vertical-align: inherit;">2 une</font></sub><font style="vertical-align: inherit;"> requÃªte interserveur Ã  S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A l'avenir, les sites S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> et S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> pourront Ã©changer toute information sur l'utilisateur par Ã©change de serveur, comme </font><font style="vertical-align: inherit;">maintenant, ils peuvent l'identifier de maniÃ¨re unique </font><b><font style="vertical-align: inherit;">sÃ©parÃ©ment les uns des autres</font></b></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les utilisateurs mobiles sont particuliÃ¨rement vulnÃ©rables Ã  cette attaque, car </font><font style="vertical-align: inherit;">essayer de fermer une page inutile peut accidentellement cliquer sur un faux lien qui occupe tout l'Ã©cran mobile.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MÃ©thode de protection:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interrompez automatiquement la session lorsque l'onglet est fermÃ©. </font><font style="vertical-align: inherit;">Ensuite, le site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a pas pu recevoir de jeton valide tant que l'utilisateur lui-mÃªme ne s'est pas connectÃ©. </font><font style="vertical-align: inherit;">Certes, cela ne protÃ©gera pas contre les situations oÃ¹ l'utilisateur lui-mÃªme a ouvert les onglets et s'est connectÃ© Ã  S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et c'est seulement alors que les sites ont menÃ© une telle attaque.</font></font><br><br><a name="attack_sso_key_discredit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.5 Compromis clÃ© pour l'authentification unique </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laissez un compte d'utilisateur sur un serveur d'authentification qui prend en charge l'authentification unique Ãªtre compromis. </font><font style="vertical-align: inherit;">Nous Ã©valuerons les risques possibles avec notre schÃ©ma d'authentification. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les jetons pour chaque site sont calculÃ©s individuellement en fonction des clÃ©s de domaine.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compromettre une clÃ© de domaine ne compromet pas automatiquement toutes les autres.</font></font></b> </blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart des sites sur lesquels vous vous Ãªtes dÃ©jÃ  connectÃ© en utilisant SSO enregistreront probablement votre jeton avec votre profil depuis le serveur SSO dans leur base de donnÃ©es. </font><font style="vertical-align: inherit;">Dans notre schÃ©ma, le site extraira simplement un jeton de la base de donnÃ©es et vous reconnaÃ®tra.</font></font> C'est-Ã -dire<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le serveur SSO n'est plus nÃ©cessaire sur ces sites - il a rempli sa fonction au stade de l'enregistrement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En d'autres termes, vous ne perdez pas automatiquement tous vos accÃ¨s Ã  la fois. Un attaquant sera identifiÃ© sur les mÃªmes sites qu'une autre personne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une tentative de reconduction de l'authentification entre domaines n'aidera pas non plus l'attaquant: le site devrait bloquer les tentatives de crÃ©ation d'un nouveau compte avec l'ancien identifiant SSO et le nouveau jeton de site. Ou bien, les tentatives de rÃ©Ã©criture du jeton utilisateur pour un ID existant dans le processus SSO doivent Ãªtre bloquÃ©es. Le fait de cela devrait susciter une suspicion raisonnable du cÃ´tÃ© du site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un jeton utilisateur ne peut Ãªtre lÃ©galement modifiÃ© que d'une seule maniÃ¨re (voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«ScÃ©narios de fonctionnement du protocoleÂ»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risque.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le site n'enregistre pas votre jeton et votre profil dans sa base de donnÃ©es, mais s'appuie entiÃ¨rement sur le mÃ©canisme SSO, un attaquant n'a qu'Ã  effectuer une authentification interdomaine pour se connecter en utilisant votre nom. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimisation des risques en cas de compromis.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Curieusement, mais c'est la prÃ©servation par les sites de tokens et de profils utilisateurs de leur cÃ´tÃ©. Une tentative par un attaquant de mener une authentification interdomaine peut provoquer un conflit entre l'ancien utilisateur Id et son nouveau jeton. La situation elle-mÃªme, lorsque l'utilisateur a modifiÃ© le jeton d'une maniÃ¨re autre que celle spÃ©cifiÃ©e dans le protocole, doit Ãªtre perÃ§ue de maniÃ¨re suspecte ou rejetÃ©e complÃ¨tement. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risque maximum:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autorisation en votre nom sur d'autres sites (oÃ¹ vous n'Ãªtes pas allÃ©). AccÃ©dez Ã  vos donnÃ©es de profil. Commettre des actes illÃ©gaux en votre nom. Et pour que le propriÃ©taire lÃ©gitime ne puisse rien retourner, un attaquant peut changer son jeton sur le serveur d'autorisation de maniÃ¨re lÃ©gale. Ce risque coÃ¯ncide cependant avec les risques liÃ©s Ã  l'utilisation des rÃ©gimes d'autorisation traditionnels. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moyens de protection.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Refus d'utiliser l'authentification unique (d'autant que le schÃ©ma proposÃ© a Ã©tÃ© conÃ§u comme un moyen de s'Ã©loigner des schÃ©mas d'authentification centralisÃ©e). Utilisez plusieurs SSO (ne stockez pas tous les Å“ufs dans le mÃªme panier!). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si SSO prend en charge l'authentification Ã  deux facteurs avec authentification par d'autres attributs (courrier, tÃ©lÃ©phone), il est alors possible de reprendre le contrÃ´le du compte du serveur d'autorisation.</font></font><br><br><a name="attack_token_compromise_due_transmit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.6 Compromission de jetons pendant le transfert </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est clair que le mÃ©canisme proposÃ© pour hacher les jetons pendant le transfert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne donne pas une garantie Ã  100% de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leur protection. </font><font style="vertical-align: inherit;">Un attaquant peut intercepter le trafic de la victime au moment du transfert d'un jeton non sÃ©curisÃ© (lors de l'enregistrement principal de la clÃ© permanente), Ã  â€‹â€‹titre d'exemple. </font><font style="vertical-align: inherit;">Et puis utilisez-le. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par consÃ©quent, l'utilisation de SSL est encouragÃ©e. </font><font style="vertical-align: inherit;">Mais ne prenez pas le HTTPS comme panacÃ©e. </font><font style="vertical-align: inherit;">Ce protocole est Ã©galement exposÃ©, ainsi que HTTP. </font><font style="vertical-align: inherit;">Seulement un peu plus dur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certes, un transfert aussi rare d'un jeton ouvert, ainsi que l'utilisation d'un jeton individuel pour chaque domaine, rÃ©duit le risque d'exploiter la vulnÃ©rabilitÃ©. </font><font style="vertical-align: inherit;">NÃ©anmoins.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre danger est l'interception et la rÃ©utilisation du jeton dans la session en cours de l'utilisateur. </font><font style="vertical-align: inherit;">Comme je l'ai dit plus tÃ´t, idÃ©alement, le jeton devrait Ãªtre hachÃ© avec un nouveau sel Ã  chaque demande du client. </font><font style="vertical-align: inherit;">Cependant, cela supprimera la possibilitÃ© de traitement parallÃ¨le des demandes sur le serveur et rendra impossible l'envoi de demandes parallÃ¨les Ã  partir du client. </font><font style="vertical-align: inherit;">Le calcul et la vÃ©rification des hachages sont gÃ©nÃ©ralement une opÃ©ration coÃ»teuse qui rÃ©duit les performances.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, le jeton passÃ© dans l'en-tÃªte ne doit jamais Ãªtre disponible depuis Javascript. </font><font style="vertical-align: inherit;">Similaire Ã  Cookie avec le drapeau HttpOnly. </font><font style="vertical-align: inherit;">MÃªme lors de la rÃ©ception de requÃªtes ajax par scripts.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MÃ©thode de fonctionnement:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intercepter la demande d'un utilisateur, extraire la valeur actuelle du jeton, envoyer une autre opÃ©ration avec le mÃªme jeton (comme pour le mÃªme utilisateur). </font><font style="vertical-align: inherit;">Certes, le systÃ¨me classique basÃ© sur les cookies de session est Ã©galement vulnÃ©rable Ã  ce type d'attaque. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MÃ©thode de protection:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> confirmation des opÃ©rations importantes via d'autres canaux de communication, par exemple par SMS ou courrier; </font><font style="vertical-align: inherit;">prÃ©-enregistrement du token via d'autres canaux de communication (certificat papier, par exemple).</font></font><br><br><a name="attack_token_compromise_due_site_hacking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.7 Piratage d'un site Web et compromission de jetons </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sites de piratage se produisent constamment. </font><font style="vertical-align: inherit;">MÃªme les grands sites bien protÃ©gÃ©s se brisent. </font><font style="vertical-align: inherit;">Il existe de nombreuses faÃ§ons de pirater: d'une injection triviale Ã  un Â«drainÂ» d'initiÃ©. </font><font style="vertical-align: inherit;">Par consÃ©quent, la compromission de votre jeton sur n'importe quel site est un Ã©vÃ©nement trÃ¨s probable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais le protocole proposÃ©, tout de mÃªme, rend l'Ã©vÃ©nement de piratage du site le moins douloureux pour vous.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La compromission du jeton n'entraÃ®ne pas la compromission de la clÃ© de domaine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la base de laquelle elle a Ã©tÃ© calculÃ©e. </font><font style="vertical-align: inherit;">De plus, cet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©vÃ©nement ne conduit pas au compromis de vos autres jetons</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et si c'est le cas, l'accÃ¨s Ã  d'autres sites reste inaccessible.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est particuliÃ¨rement agrÃ©able lorsque des clÃ©s sont apportÃ©es Ã  la plupart des sites Ã  l'aide d'une clÃ© principale: il est impossible de la restaurer par reverse engineering. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais en mÃªme temps, il est impossible d'utiliser la clÃ© de domaine dont le jeton a Ã©tÃ© compromis, pour des raisons Ã©videntes. </font><font style="vertical-align: inherit;">Je dois changer la clÃ©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clÃ© du domaine oÃ¹ la fuite officielle s'est produite peut Ãªtre effectuÃ©e soit sur la base d'un nombre alÃ©atoire, soit sur la base d'une clÃ© principale, avec l'ajout d'un numÃ©ro de version:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Conclusion </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plusieurs de mes amis Ã  qui j'ai montrÃ© l'article m'ont posÃ© essentiellement la mÃªme question: "Quelle est la principale chose ici?" </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vu d'en haut</font></font></b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        Â« Â»      Â«-Â». <br><br>  -    Â« Â». <s>  </s>    ,  <s></s> Â«Â».     ,    .     (   Google ,  Facebook â€“       ).     (  DDOS-    . â€“ <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO â€“    . <br><br> ,        Â« Â».         .      .       .             .   , . <br><br>      -      Â«Â»  .    ,    Â« Â».          ,    . <br><br>  -,         ? <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh, il n'y a pas de puce principale!</font></font></b>  HÃ©las.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il existe un certain nombre de dÃ©tails qui rendent le protocole plus rentable que le schÃ©ma de connexion / mot de passe traditionnel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Vous avez probablement remarquÃ© ce popup ennuyeux sur de nombreux sites.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Notre site enregistre les cookies! </font><font style="vertical-align: inherit;">Mettez votre casque et soyez vigilant, car le grand frÃ¨re vous regarde! </font><font style="vertical-align: inherit;">Cliquez sur "Oui", car vous n'avez toujours pas le choix. "</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est un autre popup pour un tas d'autres tout aussi intrusifs et trÃ¨s nÃ©cessaires. </font><font style="vertical-align: inherit;">Et tout cela grÃ¢ce au RGPD europÃ©en (un analogue de notre loi PD). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors voilÃ . </font><font style="vertical-align: inherit;">Dans notre systÃ¨me, les cookies ne sont plus nÃ©cessaires Ã  des fins d'identification! </font><font style="vertical-align: inherit;">Du mot Â«complÃ¨tementÂ». </font><font style="vertical-align: inherit;">L'utilisateur dÃ©cide d'autoriser ou non le site Ã  l'identifier, et quand et pendant combien de temps. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moins un popup ennuyeux, +1 au karma du protocole.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Le dÃ©veloppeur n'a plus besoin de faire des formulaires d'autorisation et de rÃ©cupÃ©ration de mot de passe. </font><font style="vertical-align: inherit;">Il n'est pas nÃ©cessaire d'implÃ©menter des algorithmes SSO complexes et de maÃ®triser des bibliothÃ¨ques complexes: OAuth, SAML, Kerberos, etc., suivez la procÃ©dure d'enregistrement de votre site, modifiez les clÃ©s d'autorisation, surveillez leur sÃ©curitÃ©; </font><font style="vertical-align: inherit;">et si quelque chose a mal tournÃ© avec SSO, comprenez de toute urgence: "qu'est-ce qui a mal tournÃ© et pourquoi." </font><font style="vertical-align: inherit;">De plus, le serveur d'autorisation peut bloquer votre site pour des raisons inconnues. </font><font style="vertical-align: inherit;">Allez le dÃ©couvrir. </font><font style="vertical-align: inherit;">Hier, tout a fonctionnÃ©, mais aujourd'hui ... Et ici, il suffit de lire le jeton dans l'en-tÃªte et de vÃ©rifier s'il y en a un dans notre base de donnÃ©es. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple = fiable</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juste dire ...</font></font></b> <div class="spoiler_text">      .     .       ,   -  -  .       . .  . <br><br>    -, -,  Â« Â»   . <br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. L'utilisateur n'a pas besoin d'entrer et de se souvenir d'un tas de mots de passe. Utilisez les services de sites tiers ou on ne sait pas par qui et comment les programmes Ã©crits. Vous ne pouvez pas avoir peur de l'accÃ¨s Ã  un ordinateur par des tiers, des enregistreurs de frappe et des chevaux de Troie. Il suffit de faire une copie de sauvegarde de la clÃ© principale, de la protÃ©ger avec un mot de passe et de la stocker quelque part sur une clÃ© USB. Comme un portefeuille Bitcoin. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qui n'est pas une fonctionnalitÃ©?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Si le site est piratÃ©, vous ne risquez rien. Eh bien, rÃ©gÃ©nÃ©rez Ã  nouveau la clÃ©. Alors que le mot de passe divulguÃ© aux crackers du site peut causer beaucoup de problÃ¨mes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Le protocole a Ã©tÃ© crÃ©Ã© en tenant compte de l'expÃ©rience des attaques de rÃ©seau connues. Son architecture comprend dÃ©jÃ  une protection de base contre XSS, CSRF. Encore une fois, les webmasters trouveront plus facile de dÃ©velopper des sites. Et leurs utilisateurs - plus calmes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. IndÃ©pendance du protocole vis-Ã -vis d'un fournisseur de services spÃ©cifique et de ses caprices. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole vous rend libre.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Enfin, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocole</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proposÃ© </font><b><font style="vertical-align: inherit;">revendique la future norme ouverte</font></b><font style="vertical-align: inherit;"> . Et la norme, si elle est adoptÃ©e par les participants, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impose des obligations de mettre en Å“uvre la fonctionnalitÃ© conformÃ©ment au cahier des charges</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et de ne pas exclure la ferme collective de ses propres dÃ©cisions d'autorisation, inventant une fois de plus la forme de connexion, d'enregistrement, de rÃ©cupÃ©ration de mot de passe, de dÃ©connexion. Et ne plaisante pas avec le hachage de mot de passe ou l'injection SQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et surtout, comme tout standard ouvert, il </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut et doit Ãªtre vÃ©rifiÃ©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> experts indÃ©pendants.</font></font></font><font style="vertical-align: inherit;">MÃªme si l'auteur de la version originale du protocole a Â«foirÃ©Â» les dÃ©tails, la communautÃ© en ligne peut identifier ce correctif en temps opportun. </font><font style="vertical-align: inherit;">Eh bien, ou envoyez mon protocole Ã  la ferraille. </font><font style="vertical-align: inherit;">HÃ©las pour moi, et "pooh-carry" pour tout le monde.</font></font><br><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Je pense que je devrais m'arrÃªter lÃ -dessus</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E. Wiles</font></font><br></blockquote><br><br><hr>  <b>PS</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez vous familiariser avec l'option d'un article complet dans un format hors ligne. </font><font style="vertical-align: inherit;">Lors de la composition de documents sur Habr, je pouvais faire des fautes de frappe. </font><font style="vertical-align: inherit;">Si vous avez des commentaires sÃ©rieux, il est prÃ©fÃ©rable de vÃ©rifier l'original et de laisser les commentaires d'article (critiques) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans ce fichier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Envoyez-moi vos modifications sur le mail sergey201991 [] gmail. </font><font style="vertical-align: inherit;">Je ne suis pas une pieuvre, mais je vais essayer de rÃ©pondre. </font><font style="vertical-align: inherit;">J'ajouterai plusieurs commentaires correspondants / intÃ©ressants Ã  cet article. </font><font style="vertical-align: inherit;">Avec leurs rÃ©ponses. </font><font style="vertical-align: inherit;">Une variante d'un article de commentaire sÃ©parÃ© n'est pas exclue. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, je sais que le protocole peut avoir des problÃ¨mes:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il n'y a aucun moyen de se connecter sous votre compte sur l'appareil de quelqu'un d'autre si vous n'avez pas de clÃ© en main, mais vous en avez besoin de toute urgence; </font><font style="vertical-align: inherit;">les mots de passe sont plus pratiques ici</font></font></li><li>      ;           ,  SSO </li><li>       Â«Â», -  : -      (   ) </li><li>    -  </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ce qui concerne la page 1 - je pensais sÃ©rieusement Ã  revenir Ã  l'idÃ©e de gÃ©nÃ©rer une clÃ© de domaine basÃ©e sur un mot de passe, en faisant une protection contre la force brute en compliquant le processus de gÃ©nÃ©ration de la clÃ©: disons, augmenter le nombre de tours de hachage Ã  1000. Mais le problÃ¨me avec une possible collision de mots de passe pour diffÃ©rents utilisateurs sur un seul Le site me hante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concernant la page 2 - cela est traitÃ© par le temps. </font><font style="vertical-align: inherit;">Vous devez vous habituer aux nouvelles interfaces. </font><font style="vertical-align: inherit;">Au dÃ©but, ce ne sera pas clair, puis ce sera simple. </font><font style="vertical-align: inherit;">Donner Ã  un homme des annÃ©es 80 un smartphone moderne, il n'aurait pas non plus devinÃ© comment le gÃ©rer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci beaucoup si vous le lisez jusqu'au bout!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472310/">https://habr.com/ru/post/fr472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472296/index.html">SystÃ¨me de protection contre les fuites pour une machine Ã  laver</a></li>
<li><a href="../fr472298/index.html">Le condensÃ© de matiÃ¨res fraÃ®ches du monde du front-end de la derniÃ¨re semaine n Â° 385 (14-20 octobre 2019)</a></li>
<li><a href="../fr472300/index.html">Descente de gradient stochastique (SGD) pour la fonction de perte logarithmique (LogLoss) dans un problÃ¨me de classification binaire</a></li>
<li><a href="../fr472304/index.html">La NASA embauche des ingÃ©nieurs pour dÃ©velopper un robot humanoÃ¯de de nouvelle gÃ©nÃ©ration</a></li>
<li><a href="../fr472306/index.html">PHP Digest n Â° 166 (7-21 octobre 2019)</a></li>
<li><a href="../fr472312/index.html">ExpÃ©rience de transfert d'un projet Maven vers Multi-Release Jar: dÃ©jÃ  possible, mais toujours difficile</a></li>
<li><a href="../fr472314/index.html">J'aime les gens en carton</a></li>
<li><a href="../fr472318/index.html">Suivi distribuÃ© dans Istio</a></li>
<li><a href="../fr472320/index.html">Entretien avec Zabbix: 12 rÃ©ponses franches</a></li>
<li><a href="../fr472326/index.html">Notre industrie spatiale ... Et si vous considÃ©rez les problÃ¨mes de l'industrie du point de vue d'un geek?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>