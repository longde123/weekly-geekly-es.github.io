<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛹🏻 🤘🏽 🏅 Identification des clients sur les sites sans mots de passe et cookies: application pour standard 🤶🏼 🔌 👇🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cher habrozhitel! Chers experts! Je présente pour votre évaluation un nouveau concept d'identification des utilisateurs sur les sites Web qui, je l'es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identification des clients sur les sites sans mots de passe et cookies: application pour standard</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="image"><br><br>  Cher habrozhitel!  Chers experts!  Je présente pour votre évaluation un nouveau concept d'identification des utilisateurs sur les sites Web qui, je l'espère, deviendra avec votre aide un standard Internet ouvert, améliorant un peu ce monde Internet.  Il s'agit d'une version provisoire du protocole d'authentification sans mot de passe, conçue comme un article gratuit.  Et si l'idée sous-jacente reçoit une évaluation positive de votre part, cher lecteur, je continuerai à la publier sur reddit.com et rfc-editor.org.  Et j'espère que je pourrai intéresser les développeurs des principaux navigateurs à sa mise en œuvre.  Par conséquent, j'attends de vous des critiques constructives. <br><br>  Attention: beaucoup de texte. <br><br><a name="habracut"></a><br>  La question est donc.  Est-il possible d'identifier sans ambiguïté les visiteurs du site sans divulguer leurs données personnelles et le suivi entre les différents sites?  Est-il possible, en résolvant un tel problème, d'abandonner complètement la forme d'autorisation la plus primitive par login / mot de passe et d'utiliser cookie / localStorage? <br><br>  D'une part, les sites doivent reconnaître un client afin, par exemple, de «restaurer» leurs paramètres, panier de produits, publicités, articles, etc.  D'autre part, les visiteurs souhaitent rester aussi anonymes que possible, sans révéler leurs données personnelles, et empêcher les sites tiers de les suivre.  Et ces derniers peuvent le faire en échangeant entre eux les données collectées. <br><br>  Cela ressemble à une tâche pour s'assurer que les loups sont pleins et que les moutons sont en sécurité.  Est-ce réel? <br><br>  Dans une certaine mesure, je pense - vraiment. <br><br><h1>  Table des matières </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1 concept d'authentification sans mot de passe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.1 Clés et jetons au lieu de connexions et mots de passe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.2 Structure des jetons</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhj7nU6O5YVJjsr21uk6tX9oIBuwVg#">1.3 En-têtes de protocole HTTP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.4 Comment les clients identifient-ils les sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.4.2 Comment savoir si un site prend en charge ce protocole?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.5 Comment les clients autorisent-ils les sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.6 Comment mettre en place une identification client fiable?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.7 Autorisation sur le site vue par l'utilisateur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.8 Comment une clé de site change-t-elle?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.9 Comment l’autorisation interdomaines est-elle mise en œuvre?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.10 Comment implémenter l'authentification inter-domaines?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.11 Mobilité du compte</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 Description technique du protocole</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.0 Algorithme de génération de clés de domaine</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.1 l'algorithme de calcul du jeton source</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.2 Algorithme de protection des jetons pendant le transfert</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.3 Procédure d'échange de sel entre le navigateur et le serveur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.4 Règles pour la formation du champ Contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.5 Règles de définition des champs expéditeur et destinataire</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.6 Détails sur les tables de définition de contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.7 Scénarios de protocole</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.8 Traitement des jetons sur le serveur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.9 Authentification interdomaine</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3 Recommandations de sécurité</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.1 Protection des informations clés contre les accès non autorisés</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.2 À propos des mots de passe en tant que clés de domaine</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.3 Risques de perdre / compromettre des clés et de les minimiser</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4 Attaques contre le régime d'autorisation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.1 Suivi des utilisateurs</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.2 Attaque XSS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.3 Attaque CSRF</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.4 Suivi à l'aide de l'authentification unique</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.5 Compromis clé pour l'authentification unique</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.6 Compromission de jetons pendant le transfert</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.7 Piratage d'un site Web et compromission de jetons</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">Quel est le problème avec les mots de passe?</b> <div class="spoiler_text">  Oui, ce n’est pas le cas.  Ils peuvent être perdus.  Ils peuvent être volés.  Il faut s'en souvenir.  Quoi qu'il en soit, pourquoi suis-je obligé de remplir une forme d'inscription et de trouver un autre mot de passe pour voir la météo ou télécharger ce fichier?  Enfin, les mots de passe sont légèrement inférieurs à beaucoup.  Combien de sites vous aimez, autant de mots de passe.  Et par conséquent, beaucoup utilisent un seul mot de passe sur tous les sites.  Quelqu'un utilise un algorithme délicat pour s'en souvenir.  Ou un gestionnaire de mots de passe.  Ou, bêtement, un cahier.  Ou préfère l'authentification entre domaines: vous vous connectez une seule fois sur un seul site, et c'est tout!  Oui, pas tous.  C'est si le site le prend en charge. <br>  Toutes ces approches présentent des inconvénients. <br>  Utilisez un mot de passe sur différents sites - Moveton.  Ce que deux personnes savent, le cochon le sait aussi.  Tous les sites (même grands et réputés) ne respectent pas honnêtement les règles de sécurité pour le stockage de vos mots de passe.  Certains sites stockent les mots de passe sous forme ouverte, tandis que d'autres pensent que le stockage des hachages de mot de passe les protège déjà suffisamment.  En conséquence, des fuites de mots de passe et d'autres données personnelles des clients se produisent régulièrement. <br>  Avec le gestionnaire de mots de passe, c'est déjà mieux.  Certes, personne ne vous garantit qu'il ne fusionne pas vos mots de passe quelque part.  Et allez trouver un gestionnaire qui peut synchroniser vos comptes sur tous les appareils (netbook domestique, téléphone, ordinateur de travail).  Je n'exclus pas que cela existe. <br>  Mais en tout cas, l'idée elle-même: inscrivez-vous d'abord sur notre site Web (en même temps, envoyez un e-mail, mobile, donnez du sang pour analyse), puis inventez / mémorisez votre nom d'utilisateur et votre mot de passe et soyez assez gentil pour vous en souvenir, mais gardez-les secrets - approche, je vous le dis, so-so.  Et pas un seul gestionnaire de mots de passe ne le résoudra.  Mais cela résout le <abbr title="Technologie d'authentification unique implémentée par divers protocoles tels que SAML, OAuth, Kerberos">SSO</abbr> . <br>  C'est juste de la malchance: si vous perdez le mot de passe du site SSO et l'oubliez, ou s'il vous a été volé ... Vous perdez l'accès à tous vos sites à la fois ou vous le donnez volontairement à quiconque et il n'est pas clair avec quelles intentions.  <b>Ne stockez pas tous les œufs dans le même panier!</b> <br>  Et ce n'est pas un fait que le site SSO est fiable.  Ou ne stocke pas vos mots de passe en texte clair.  Ou ne les fusionne pas du tout volontairement, et offre également à d'autres la possibilité de vous suivre entre les sites.  Eh bien, vous obtenez le point. <br>  Par conséquent: login + mot de passe = evil.  Et tout le mal dans le monde devrait être bu sérieusement et pendant longtemps.  Et un cookie aussi.  Avec ses crocodiles de session PHPSESSIONID, JSESSIONID et leurs analogues. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Et que faire?</b> <div class="spoiler_text">  Vous devez d'abord considérer des situations typiques, à partir desquelles il sera clair: pourquoi les sites veulent-ils se souvenir de leurs clients et est-ce vraiment nécessaire pour eux? <br><ol><li>  Blog personnel "Vasya Pupkina", dans lequel, par exemple, les commentaires sont autorisés.  L'inscription n'est nécessaire que pour se protéger des bots, procéder à des votes gratuits, compter les «likes» et autres «meow-meow» et attribuer une note aux commentateurs.  C'est-à-dire  Ici <b>, la fonctionnalité de suivi est nécessaire exclusivement par le site</b> , et seulement dans une faible mesure - par l'utilisateur (s'il apprécie sa note «commentateur» sur ce site). </li><li>  Sites de réseaux sociaux et autres locuteurs Internet (ICQ, skype - là aussi).  L'inscription est nécessaire pour implémenter le contenu nommé (auteur), pour identifier les visiteurs les uns des autres.  C'est-à-dire  Ici <b>, la fonctionnalité d'identification est plus largement nécessaire par les utilisateurs eux-mêmes</b> .  Bien que les sites de réseaux sociaux soient les premiers dans la liste des "pécheurs", ils collectent les informations les plus complètes sur les visiteurs et se souviennent de vous sérieusement et longtemps.  On ne sait donc pas encore qui a le plus besoin d'être identifié. </li><li>  Site d'entreprise avec contenu fermé.  L'enregistrement ou l'autorisation ici est nécessaire principalement pour restreindre l'accès au contenu.  Toutes sortes de: écoles en ligne, bibliothèques, sites privés non publics, etc.  Ici <b>, la fonctionnalité d'autorisation est plus largement nécessaire par le site</b> .  En règle générale, aucun formulaire d'inscription n'est ouvert.  Les informations d'identification sont partagées via d'autres canaux. </li><li>  Une boutique en ligne et une autre plate-forme similaire vendant des articles, des services ou du contenu.  J'inclurai également des sites d'annonces classées payantes / gratuites.  L'inscription est principalement nécessaire pour stocker l'historique des commandes des clients, et pour qu'il puisse suivre leur statut actuel, stocker leurs préférences (favoris);  afin de formuler des offres personnelles au client en fonction de l'historique d'achat et des préférences.  Ici <b>, la fonctionnalité d'identification est également nécessaire pour le client et le magasin</b> .  Mais plus, bien sûr, au magasin.  Vapeur, vapeur et vapeur. </li><li>  Tous les comptes personnels des utilisateurs des services Internet: e-mail, services publics, Sberbank-online, mégaphone-online, bureaux de fournisseurs, CMS des hébergeurs, etc.  Ici <b>, l'utilisateur lui-même est principalement intéressé par une identification correcte et fiable</b> .  Après tout, il gère des informations importantes pour lui-même, ce qui dans certaines situations a des conséquences juridiques et financières.  Ça ne sent pas comme l'anonymat.  Elle est nuisible ici. </li><li>  Routeurs, consoles de gestion, versions Web de la gestion de quelque chose sur votre réseau domestique ou d'entreprise. </li></ol><br><br>  Il est clair que dans différentes situations, il peut y avoir différents risques.  Dans certains cas, une identification incorrecte, la perte de données d'authentification, voire le vol / falsification de celles-ci, n'entraînera aucune conséquence significative pour le site ou pour l'utilisateur.  Dans d'autres, ce sera juste désagréable (j'ai perdu du karma sur Habré - "c'est un désastre ...") ou conduira à des désagréments (je ne peux pas me laisser aller à Yula, voir mes annonces; j'ai profilé l'accès à mes projets sur github, - okay nouveau compte, projets fork).  Troisièmement, elle peut entraîner des conséquences juridiques et financières.  Par conséquent, il faut supposer que le régime d'autorisation proposé n'est pas une «solution miracle» pour tous les cas, en particulier «nu».  <b>Lorsque des informations sensibles sont gérées, il convient d'utiliser d'autres méthodes d'identification et d'authentification</b> ou leur combinaison (authentification à deux facteurs, cryptographie à clé asymétrique, 3D-secure, eToken, OTP-Token, etc.). <br><br>  Oh bien.  Quel est votre savoir traditionnel? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Qu'offre le nouveau protocole?</b> <div class="spoiler_text">  Du point de vue de l'utilisateur final: <br><ol><li>  Le site doit se souvenir et reconnaître le visiteur sans aucune contribution de l'utilisateur;  le site devrait vous reconnaître à la fois au sein de la session et entre les différentes sessions.  Pas de cookies, mots de passe ou inscriptions.  Dans le même temps, différents sites ne devraient pas être en mesure <i>d'</i> identifier de manière unique le même visiteur, étant en mesure de suivre leur activité sur ces sites et sur d'autres.  C'est-à-dire  les sites ne devraient pas être en mesure de regrouper les informations pour leurs visiteurs. </li><li>  L'utilisateur doit pouvoir « <b>oublier n'importe quel site</b> » à tout moment;  et le site oubliera l'utilisateur.  Il devrait y avoir la possibilité d'accorder des droits au site pour se souvenir du client à l'initiative du client (sans popup obsessionnel).  L'utilisateur doit pouvoir migrer en toute sécurité son identité virtuelle entre différents appareils et navigateurs (s'il en a besoin) afin d'avoir une seule autorisation sur ses sites favoris. </li></ol><br><br>  Je vois.  Et quels bonus les développeurs de sites devraient-ils en retirer? <br><ol><li>  Une procédure d'identification plus simple: il n'est pas nécessaire de créer pour la millième fois la prochaine forme de connexion, déconnexion, enregistrement, modification et récupération de mot de passe.  Il suffit d'activer le module de support de protocole pour votre framework préféré, implémenté sur la base du standard. </li><li>  Il n'est pas nécessaire qu'un concepteur dessine un formulaire de connexion et réfléchisse à l'endroit où le cacher sur un petit écran mobile.  Le protocole rend les formulaires inutiles.  Eh bien, sauf que le formulaire d'inscription.  Où est-il alors sans eux?  Hélas. </li></ol><br><br>  Enfin: <br><ol><li>  Le protocole d'authentification doit être unifié et standardisé;  Vérifié par des experts en sécurité  Approuvé et recommandé par les comités de normalisation Web.  En conséquence, la possibilité de commettre des erreurs classiques de la part des webmasters lors du développement de formulaires de connexion / déconnexion standard, de la modification / récupération de mots de passe (transmission de mots de passe sous forme claire, utilisation incorrecte du hachage, stockage de mots de passe ou hachages «non salés» dans la base de données, détournement de mots de passe utilisateur lorsque site de piratage). </li><li>  L'autorisation doit être fiable dans une certaine mesure (protégée contre la falsification, l'accès non autorisé, avec une authentification garantie);  Ne créez pas de nouvelles vulnérabilités sur les pages Web et les navigateurs;  si possible, réduisez les risques d'attaques réseau connues dès le départ.  Eh bien, ou du moins une réduction significative des risques d'une mise en œuvre réussie. </li></ol><br><br>  Sur la base de ces exigences, nous nous tournons vers le plus intéressant: la conception d'un nouveau protocole. <br></div></div><br><br><a name="part1"></a><h1>  1 concept d'authentification sans mot de passe </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 Clés et jetons au lieu de connexions et mots de passe </h2><br>  Pour chaque domaine, y compris les enfants, le navigateur client génère aléatoirement une clé unique de 256 bits <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Cette clé n'est jamais transmise.</b>  Reste constant dans la session de l'utilisateur.  Chaque nouvelle session crée une nouvelle clé. <br>  Basé sur une clé <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  le navigateur génère un jeton 256 bits <sup>*</sup> à l'aide d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">algorithme spécial</a> <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  pour identifier l'utilisateur avec un domaine spécifique.  Jeton d'identification <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  l'utilisateur (ci-après simplement appelé le jeton) remplace les cookies de session comme PHPSESSIONID et JSESSIONID. <br>  Clé <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  peut être " <b>corrigé</b> " par l'utilisateur.  La fixation de la clé permettra à l'utilisateur de rester autorisé sur le site pour une durée illimitée dans différentes sessions de navigateur et de retourner l'autorisation précédemment existante.  Il s'agit d' <b>un analogue de la fonction «se souvenir de moi»</b> . <br>  Lorsque la validation est annulée, le navigateur «oubliera» cette clé et recommencera à générer une clé aléatoire pour ce domaine pour chaque nouvelle session (à partir de la session actuelle), ce qui <b>est analogue à la «sortie»</b> de l'utilisateur du site.  La sortie est instantanée, ne nécessitant pas de rechargement de page. <br>  L'utilisateur peut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">créer une clé permanente pour le domaine</a> .  La clé permanente, ainsi que la clé fixe, permettra à l'utilisateur de retourner l'autorisation précédente.  En fait, cette <b>clé devient un remplacement pour la connexion login-mot de passe.</b> <br>  L'utilisateur a la possibilité de contrôler quand le navigateur du domaine utilisera une clé constante et quand - aléatoire.  Il s'agit d' <b>un analogue de la fonction de connexion / déconnexion</b> .  Le concept <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est présenté dans les captures d'écran ci-dessous</a> . <br>  Les méthodes de génération de clés de domaine persistantes assurent la mobilité des comptes d'utilisateurs entre différents appareils.  Le protocole définit les éléments suivants: <br><ul><li>  génération d'une clé de domaine basée sur une clé principale d'utilisateur </li><li>  formation individuelle d'une clé de domaine sur la base d'un capteur biologique de nombre aléatoire </li><li>  importation de clés existantes à partir d'un fichier de clés à partir d'un autre appareil </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Structure des jetons </h2><br>  Le jeton est une structure de 256 bits, représentée sous la forme d'une chaîne hexadécimale: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  pièce d'identification </td><td>  partie d'authentification </td></tr></tbody></table></div><br>  La partie d'identification du jeton (les 128 bits les plus élevés) est similaire à la connexion.  Par cette séquence de bits, le serveur peut identifier de manière unique l'utilisateur. <br>  La partie d'authentification du jeton (les 128 bits inférieurs) est similaire au mot de passe.  Cette séquence de bits aide le serveur à valider le jeton. <br>  Les règles de validation des jetons sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">décrites ci-dessous</a> . <br><br><a name="http_headers"></a><h2>  1.3 En-têtes de protocole HTTP </h2><br>  <b>En-têtes utilisés par le client:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; est utilisé pour envoyer un jeton au serveur <br>  <b>CSI-Token</b> : &lt;Token1&gt;;  <b>Changed-To</b> &lt;Token2&gt; est utilisé pour changer le jeton actuel: <br><ul><li>  lors de l'autorisation sur une clé permanente, </li><li>  lors de l'enregistrement d'une clé permanente, </li><li>  lors du changement de la clé permanente. </li></ul><br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Permanent est</b> utilisé lors de la fixation de la clé aléatoire actuelle par l'utilisateur. <br>  <b>CSI-Token</b> : &lt;Token&gt; La <b>déconnexion est</b> utilisée pour mettre fin prématurément à la session en cours. <br><br>  <b>En-têtes utilisés par le serveur:</b> <br>  <b>Support CSI: oui</b> indique au client que le serveur prend en charge le protocole d'autorisation CSI. <br>  <b>CSI-Token-Action: le succès est</b> utilisé pour informer le navigateur de l'acceptation d'un nouveau jeton d'utilisateur (clé de changement). <br>  <b>CSI-Token-Action: abandonner</b> annule la procédure de changement des jetons (retour au jeton précédent). <br>  <b>CSI-Token-Action: l'enregistrement</b> indique au navigateur que le nouveau jeton d'utilisateur est toujours en cours d'enregistrement. <br>  <b>CSI-Token-Action:</b> erreur de vérification de jeton côté serveur <b>non valide</b> . <br><br>  Enfin <br>  <b>CSI-Salt est</b> envoyé à la fois par le navigateur et le serveur lors de l'échange du «sel» utilisé pour protéger le jeton (partie authentification).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voir ci-dessous pour</a> plus de détails. <br><br><a name="how_site_identify_us"></a><h2>  1.4 Comment les clients identifient-ils les sites? </h2><br>  Un site peut utiliser un jeton pour identifier un visiteur du site.  Dans le même temps, le schéma de génération de jetons et leur capacité de 256 bits <b>garantissent des jetons uniques pour chaque paire:</b> domaine utilisateur.  Un autre domaine verra un autre jeton utilisateur.  Même s'il est exécuté dans le contexte du site cible (via IFRAME, IMG, LINK, SCRIPT).  De plus, un algorithme spécial de génération de jetons protège les utilisateurs contre les attaques XSS et SRF et rend impossible le suivi d'un utilisateur à son insu.  Mais en même temps, la technologie <abbr title="Technologie d'authentification unique implémentée par divers protocoles tels que SAML, OAuth, Kerberos">SSO reste</abbr> possible avec sa permission et son identification inter-domaines. <br>  Le token <b>est transmis dans l'en-tête HTTP CSI-Token</b> <u>avec chaque requête</u> vers n'importe quelle ressource de domaine (page, document, image, script, style, police, fichier, requête ajax, ...): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  Le jeton est <b>recalculé <i>à chaque</i> requête HTTP (S)</b> : page, image, requête ajax. <br>  Afin d'optimiser les calculs, la mise en cache des jetons par le navigateur est autorisée, mais uniquement pour la durée de la session et uniquement si les conditions de satisfaction de la demande restent inchangées. <br>  Comme indiqué ci-dessus, le jeton peut remplacer les cookies de session tels que PHPSESSIONID et JSESSIONID.  La seule différence est que si le site générait précédemment un identifiant permettant au visiteur de suivre un utilisateur spécifique entre ses différentes demandes (après tout, des milliers de demandes d'utilisateurs différents arrivent sur le site en même temps), le client lui-même remplit désormais cette fonction. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une telle identification est tout à fait suffisante pour vous permettre de faire des achats dans la boutique en ligne, de faire de la publicité sur des sites appropriés, d'écrire sur des forums, sur des réseaux sociaux, sur Wikipedia ou sur des articles Habré. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, l'utilisateur reste anonyme pour le site. Mais il peut s'agir d'un «familier» anonyme du site. Et le serveur peut enregistrer le jeton d'un tel utilisateur de son côté, ainsi que ses données (compte personnel avec achats, préférences, karma, brioches, likes et autres bonus). Mais seulement pour garder sous condition l'achèvement de tout processus commercial: achat, soumission de l'annonce, etc. Les conditions sont déterminées par le site lui-même.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme vous pouvez le voir, le protocole est aussi simple que possible pour les sites qui n'ont pas besoin de vous inscrire avant de vous donner la possibilité de prendre des mesures. </font><font style="vertical-align: inherit;">Mais ceux qui en ont besoin auront un peu plus de mal. </font><font style="vertical-align: inherit;">Mais plus à ce sujet ci-dessous.</font></font><br><br><a name="how_we_know_what_sci_supported"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.4.2 Comment savoir si un site prend en charge ce protocole? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site doit transmettre le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Support: oui</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> http-header </font><font style="vertical-align: inherit;">dans la section Response Headers de sa réponse:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En voyant un tel titre, le navigateur informera discrètement l'utilisateur qu'il peut se sauver sur le site. </font><font style="vertical-align: inherit;">Par exemple, le symbole clé dans la barre d'adresse:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un clic sur une clé, par exemple, créera une clé pour le domaine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La formation d'une nouvelle clé ne conduit pas à son utilisation automatique. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La clé permanente ne commence à être utilisée que lorsqu'elle est activée par l'utilisateur. </font></font><br><br><a name="how_make_authorization"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 Comment les clients autorisent-ils les sites? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est important de comprendre que le jeton ne rend pas encore l'utilisateur autorisé sur un site particulier - seulement reconnaissable. </font><font style="vertical-align: inherit;">Mais, comme cela a déjà été dit, vous n'êtes pour l'instant qu'une «personne anonyme» reconnaissable. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le site doit vous associer personnellement votre token, hélas, l'inscription sur un tel site ne peut être évitée. </font><font style="vertical-align: inherit;">Mais dans le protocole proposé, cela est rendu un peu plus facile.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est important que les développeurs le comprennent: la plupart des sites n'ont pas besoin de questionnaire. </font><font style="vertical-align: inherit;">Évitez de forcer les visiteurs à s'inscrire. </font><font style="vertical-align: inherit;">Dans la plupart des situations typiques, vous pouvez exécuter un processus métier sans collecter de visiteurs PD.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplir des formulaires d'inscription fastidieux «avec ou sans» est désagréable. </font><font style="vertical-align: inherit;">Mais avec le nouveau protocole, il n'est plus nécessaire de trouver un autre identifiant et mot de passe. </font><font style="vertical-align: inherit;">Seul le bouton Confirmer et me sauver:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sûr, vous devrez d'abord créer une clé permanente pour le site. </font><font style="vertical-align: inherit;">Mais il s'agit de quelques clics de souris. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et, bien sûr, il vous sera demandé de confirmer votre téléphone ou votre adresse postale. </font><font style="vertical-align: inherit;">Mais cela dépend déjà du site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après une autorisation réussie, le serveur, via un en-tête HTTP spécial, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informera le navigateur qu'il a accepté la nouvelle clé. </font><font style="vertical-align: inherit;">Plus de détails au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chapitre II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="how_implement_reliable_identification"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.6 Comment mettre en place une identification client fiable? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans les situations plus graves (compte personnel du fournisseur, hébergement, banque), une authentification à deux facteurs doit et peut être effectuée, et la preuve de la possession du jeton peut être effectuée par le biais d'une pré-inscription et d'une confirmation d'identité par d'autres moyens: par e-mail, SMS ou même en fixant le jeton de l'utilisateur sur papier. </font><font style="vertical-align: inherit;">(Oui, oui. Les certificats sont enregistrés sur papier, pourquoi pas des jetons).</font></font><br><br><a name="user_view_concept"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.7 Autorisation sur le site vue par l'utilisateur </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le navigateur informe l'utilisateur que le site prend en charge l'autorisation CSI via l'icône de verrouillage dans la barre d'adresse. </font><font style="vertical-align: inherit;">Si vous effectuez certaines actions sur le site, vous pouvez demander au site de se souvenir de vous. </font><font style="vertical-align: inherit;">A partir de ce moment, le serveur reconnaîtra l'utilisateur même entre différentes sessions:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu de fixer la clé, l'utilisateur peut créer une clé permanente pour le site et s'y inscrire. </font><font style="vertical-align: inherit;">Illustration animée:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">   .   .  .      . <br>     ,  « ».      . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et lorsque l'utilisateur dispose d'une clé permanente pour le site et que cette clé y est enregistrée, le processus de connexion est grandement simplifié: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">   . ,    .  ,  «».   ,  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plus grande puissance du protocole se manifeste lorsque l'utilisateur crée une clé pour le site en fonction de la clé principale. </font><font style="vertical-align: inherit;">Dans ce cas, le </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problème de votre identification sur des sites sur d'autres appareils</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est facilement </font><u><font style="vertical-align: inherit;">résolu</font></u><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'animation suivante le démontre. </font><font style="vertical-align: inherit;">Il est supposé que vous avez déjà distribué votre clé principale une fois entre vos appareils / navigateurs:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour les sites avec une autorisation à deux facteurs, la «reconnaissance» peut ressembler à ceci: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'illustration</font></font></b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La sortie est encore plus facile. </font><font style="vertical-align: inherit;">Cliquez sur "Déconnexion" dans le navigateur et c'est tout:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le navigateur envoie une demande au site (sur n'importe quelle page) avec la méthode HEAD, dans laquelle il envoie l'en-tête CSI-Token &lt;&gt;; </font><font style="vertical-align: inherit;">Déconnexion.</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le serveur, voyant un tel en-tête, se déconnecte. </font><font style="vertical-align: inherit;">S'il s'agissait d'une clé fixe, le site supprime toutes les informations sur l'utilisateur (plus qu'une telle clé n'apparaîtra jamais). </font><font style="vertical-align: inherit;">S'il s'agissait d'une clé permanente, interrompt simplement la session. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute autre activité du site transforme l'utilisateur en un anonymat inconnu du site: rechargement de la page, tentative de demande ajax, téléchargement d'un fichier, etc. </font><font style="vertical-align: inherit;">- Le navigateur enverra un jeton généré déjà sur la base d'une clé aléatoire.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez gérer les clés dans le gestionnaire de clés: modifier la clé permanente, exporter la clé permanente dans un fichier, importer à partir d'un fichier à partir d'un autre appareil. </font><font style="vertical-align: inherit;">Configurez la «sortie automatique» après avoir fermé un onglet ou un navigateur. </font><font style="vertical-align: inherit;">Définissez la durée d'une clé fixe.</font></font></blockquote><br><br><a name="how_user_can_change_key"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.8 Comment une clé de site change-t-elle? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le remplacement de la clé permanente du site revient techniquement à passer d'une clé aléatoire à une clé permanente. </font><font style="vertical-align: inherit;">Ceci est décrit plus en détail au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chapitre II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cas de modification de la clé permanente du site, le navigateur notifie au site la modification correspondante du jeton, en envoyant un en </font><b><font style="vertical-align: inherit;">-</font></b><font style="vertical-align: inherit;"> tête </font><b><font style="vertical-align: inherit;">CSI-Token</font></b><font style="vertical-align: inherit;"> avec la clé </font><b><font style="vertical-align: inherit;">Changed-To </font></b></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à chaque demande suivante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site doit traiter correctement une telle demande. </font><font style="vertical-align: inherit;">Et, si un jeton utilisateur donné est stocké dans sa base de données, il doit effectuer un remplacement approprié. </font><font style="vertical-align: inherit;">Dans le même temps, le site devrait répondre au navigateur au sujet du changement réussi du jeton de son côté. </font><font style="vertical-align: inherit;">Il le fait dans l'en-tête Response Headers avec le paramètre: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action: succès</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indiquant le jeton appliqué. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site a le droit de rejeter une tentative de modification du jeton (par exemple, s'il n'y en avait pas dans sa base de données ou s'il ne les enregistre pas du tout) avec le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paramètre CSI-Token-Action: abandonné. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jusqu'à ce que le navigateur reçoive l'en-tête CSI-Token-Action, il ajoutera la clé Changed-To à chaque demande de jeton CSI du site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un analogue du «changement de mot de passe» de l'utilisateur.</font></font></b> <br><br><a name="how_make_cross_domain_auth"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.9 Comment l’autorisation interdomaines est-elle mise en œuvre? </font></font></h2><script type="text/javascript">function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('ru', 'fr', function () {});}</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=gtElInit&amp;client=wt"></script><br>  L'autorisation classique entre domaines utilisant la technologie <abbr title="Technologie d'authentification unique implémentée par divers protocoles tels que SAML, OAuth, Kerberos">SSO</abbr> présente de nombreux avantages pour l'utilisateur.  Vous n'avez pas besoin de vous souvenir d'un tas de mots de passe provenant d'un tas de sites.  Il n'est pas nécessaire de s'inscrire et de remplir les formulaires mornes.  Certains serveurs d'autorisation demandent quels droits accorder au site qui a demandé l'authentification unique. <br>  Mais il y a aussi des inconvénients.  <b>Vous dépendez du fournisseur SSO.</b>  Si le serveur SSO ne fonctionne pas, vous n'obtiendrez pas le site cible.  Si vous perdez votre mot de passe ou votre compte est volé - vous perdez l'accès à tous les sites à la fois. <br>  Pour les développeurs web, les choses sont un peu plus compliquées.  Depuis le début, vous devez enregistrer votre site sur le serveur d'autorisation, obtenir les clés, apprendre à travailler avec le protocole ( <abbr title="Un standard ouvert pour l'échange de données d'authentification et d'autorisation entre un fournisseur de compte et un fournisseur de services">SAML</abbr> , <abbr title="Un protocole d'autorisation ouvert qui permet de fournir à un tiers un accès limité aux ressources protégées de l'utilisateur sans avoir à transférer un identifiant et un mot de passe à un tiers">OAuth</abbr> , etc.) et les bibliothèques correspondantes, assurez-vous que la clé n'expire pas, que le serveur d'autorisation ne bloque pas votre site pour vos raisons et etc.  Il s'agit d'une redevance pour le fait que vous n'avez pas besoin de conserver des comptes d'utilisateurs, de faire des formulaires d'inscription, de vous connecter, etc.  La vérité augmente le coût de la maintenance (sous forme de réparation de pannes soudaines).  Encore une fois, si le serveur est soudainement indisponible pour le site, alors hélas. <br>  Ce schéma d'autorisation rend SSO un peu plus sûr et l'autorisation pour tous les participants est plus facile.  La sécurité sera discutée ci-dessous dans la section <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Compromis clé pour l'authentification unique".</a> <br><br>  Jetez un œil au site S, qui prend en charge l'authentification unique de Google.  Supposons que vous ayez un compte Google.  Pour vous connecter, vous cliquez sur le lien "Se connecter avec Google", qui ouvrira l'onglet d'autorisation Google.  Le navigateur vous indiquera que vous avez une clé pour Google.  Et Google vous dira quels droits S. demande. <br>  Si vous êtes d'accord, cliquez sur "Connexion" dans le gestionnaire de clés.  La page se rechargera.  Google recevra déjà son jeton valide, vous reconnaîtra et vous autorisera.  Et avec une demande inter-serveur, il informera le Site S de vos informations de compte conformément aux champs demandés. <br>  La page rechargée contiendra un bouton «Suivant» qui vous ramènera au site cible. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">Dans l'illustration</b> <div class="spoiler_text">  Il donnera un exemple de cet algorithme lors de son inscription sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com à l'</a> aide d'une autorisation interdomaine via accounts.google.com. <br></div></div><br>  Le site S peut décider de sauvegarder ou non des données vous concernant dans sa base de données.  Cette question dépasse le cadre du régime d'autorisation proposé.  Mais en outre, lorsque nous examinerons les risques de perdre la clé pour SSO, le site est recommandé de conserver le jeton et l'identifiant utilisateur de SSO de son côté, et l'utilisateur est recommandé de créer une clé permanente pour S. <br><blockquote>  <b>Vulnérabilité:</b> Après une telle autorisation, les sites S1, S2, S3, ... (où vous vous êtes connecté via Google) pourront vous reconnaître (par l'identifiant qui vous a été attribué par Google) et, par conséquent, suivre votre activité. </blockquote><br><blockquote>  <b>Option de protection:</b> ne fonctionne pas simultanément sur les sites si vous vous êtes inscrit via le SSO du même fournisseur.  Si possible, déconnectez-vous du serveur d'autorisation immédiatement après la fin de l'autorisation («sortie automatique» pour le domaine). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 Comment implémenter l'authentification inter-domaines? </h2><br>  Tout cela, bien sûr, est bon.  Alors que le travail est effectué sur un seul navigateur - tout va bien.  Mais qu'en est-il des réalités modernes lorsqu'une personne a deux téléphones portables, un ordinateur de travail et plusieurs navigateurs dessus, un ordinateur personnel et un autre ordinateur portable?  Plus une tablette commune pour la femme / les enfants. <br>  Nous devrons en quelque sorte résoudre le problème du transfert des clés de domaine entre les navigateurs et les appareils.  Et aussi résoudre le problème de leur synchronisation correcte. <br>  L'un des mécanismes pour résoudre ce problème consiste à calculer diverses clés de domaine sur la base d'une clé principale commune sans possibilité de récupération inverse de la clé principale à partir d'une clé de domaine connue. <br>  Après avoir créé une clé personnelle K pour le domaine D en utilisant une clé principale M sur un appareil, un utilisateur peut créer la même clé K pour le domaine D et sur n'importe quel autre en utilisant la même clé principale M et un seul algorithme.  Plus précisément, cela se fera non pas par l'utilisateur, mais par son navigateur.  Avec cette approche, il suffit à l'utilisateur de répartir sa clé principale entre tous les navigateurs utilisés par lui et il "transfère toutes ses clés" de domaines à la fois.  Effectue en même temps des sauvegardes de cette manière. <br>  Confort d'utilisation maximal.  <b>Mais aussi le risque maximum</b> en cas de compromission de la clé principale.  Par conséquent, ces derniers doivent être protégés en conséquence.  Les risques de perte ou de compromission de la clé principale et les moyens de minimiser ces risques sont décrits dans le chapitre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«3 Recommandations de sécurité»</a> . <br>  L'utilisation d'une seule clé principale pour générer toutes les clés pour tous les domaines n'est pas toujours une option pratique.  Premièrement, que faire si la clé de domaine est soudainement compromise et doit être modifiée?  Deuxièmement, que faire si vous devez partager une clé de domaine avec une autre personne?  Par exemple, entre les membres de la famille.  Ou s'agit-il d'un compte d'accès au courrier public d'entreprise.  Comment alors "récupérer" votre clé (car en fait elle a été compromise)? <br>  Par conséquent, la génération de clés de domaine individuelles à l'aide d'un capteur biologique de nombres aléatoires doit être prise en charge par les navigateurs.  Mais nous revenons ensuite à la question de notre mobilité et des problèmes de synchronisation, des fonctions d'exportation et d'importation de clés dans le navigateur et de création de copies de sauvegarde. <br><br><h3>  Transfert via un appareil physique aliénable </h3><br>  Les cartes à puce et les jetons USB peuvent être tout à fait appropriés comme stockage sécurisé des informations clés (car ils ont été créés pour cela).  L'authentification à deux facteurs protège les clés contre tout accès non autorisé avec un accès direct à l'appareil. <br>  Certes, les cartes à puce nécessitent des lecteurs spéciaux (sans parler des pilotes), ce qui limite leur utilisation uniquement aux postes de travail équipés de tels lecteurs. <br>  Avec des jetons USB un peu plus faciles.  Seuls les pilotes sont requis.  Mais vous ne pouvez pas coller un tel jeton dans le téléphone.  Et bien que pour les téléphones portables il existe des jetons réalisés sous forme de cartes SD, pour ne pas dire que cette solution ajoute à la mobilité.  Essayez de tirer une carte d'un téléphone mobile, mais insérez-la dans un autre.  Et ce n'est pas que ce soit impossible.  Le truc, c'est que ce n'est pas pratique. <br>  Et si le jeton se casse?  Ensuite, toutes vos clés iront au Grand Cthulhu. <br>  Il y aura donc une tentation avec un tel schéma d'utiliser plusieurs appareils en double.  Mais vous devez encore résoudre le problème de synchronisation des clés si vous avez plusieurs cartes à puce. <br>  Et, franchement, ces appareils ne sont pas protégés contre les enregistreurs de frappe.  Maintenant, si le code PIN devait être entré à partir de la carte / du jeton lui-même.  Puis autre chose.  Mais je n'en ai pas vu dans la nature. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Avantages:</b> des clés aléatoires de 256 bits peuvent être utilisées;  haute sécurité grâce à l'utilisation d'une authentification à deux facteurs;  le plus haut niveau de protection contre la falsification directe. <br>  <b>Inconvénients:</b> dépendance de l'appareil;  nécessite des coûts financiers;  faible mobilité;  la nécessité de réserver des cartes et, par conséquent, de synchroniser les données entre elles;  la vulnérabilité aux enregistreurs de frappe demeure. <br></blockquote><br><h3>  Synchronisation via le service en ligne </h3><br>  La «technologie du cloud» est désormais mise en avant dans la mesure du possible.  Il semble qu'ils, avec la blockchain, soient devenus un substitut à la «technologie de la banane».  Naturellement, on souhaite utiliser une certaine plate-forme Internet pour l'échange d'informations clés.  Une sorte de carte à puce "en ligne". <br>  Quoi?  Vous vous connectez en utilisant notre système de manière anonyme sur un tel site;  envoyez-y vos clés cryptées avec un mot de passe;  Vous passez d'un autre appareil au même site avec la même clé / mot de passe;  vous obtenez les clés de là;  Vous synchronisez les modifications par date de modification.  Semblable au gestionnaire de mots de passe, seul celui-ci est en ligne. <br>  C'est juste, personne ne garantit que le service en ligne ne sera pas piraté ou ne fusionnera pas vos clés, bien que cryptées, «si nécessaire».  Qui mettra en place un tel service gratuitement.  Voilà. <br>  Bien sûr, le mot de passe protège les clés contre une utilisation directe.  Mais votre mot de passe résiste-t-il à la force brute "hors ligne"?  Voilà une autre question. <br><blockquote>  <b>Avantages:</b> haute mobilité des diplômes;  indépendance de l'appareil et du navigateur;  vous n'avez besoin que d'un seul mot de passe (bien qu'ils n'aient pas laissé le mot de passe, c'est déjà mieux). <br>  <b>Inconvénients:</b> moins sûr que de stocker des clés sur un support aliénable.  En fait, la sécurité des clés repose sur la force du mot de passe à sélectionner. <br></blockquote><br>  Vous pouvez bien sûr utiliser une clé principale pour crypter d'autres clés.  Celui avec lequel les autres clés de domaine sont calculées.  En option. <br><br><a name="part2"></a><h1>  2 Description technique du protocole </h1><br><br><a name="perm_key_algo"></a><h2>  2.0 Algorithme de génération de clés de domaine </h2><br>  Ce protocole définit seulement 2 méthodes pour générer des clés de domaine. <br><br><ul><li>  basé sur un générateur de nombres aléatoires (de préférence biologique) </li><li>  basé sur une clé principale de 256 bits </li></ul><br>  Dans ce dernier cas, la clé de domaine est calculée comme suit: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {clé}} (domaine) $" data-tex="display"></p>  où <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {clé} $" data-tex="inline">  - Clé maître 256 bits, Domaine - nom de domaine pour lequel la clé est créée. <br>  Ci-après, <i>HMAC</i> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un algorithme cryptographique de hachage</a> basé sur une implémentation de 256 bits de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonction de</a> hachage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SHA-2</a> . <br><blockquote>  La divulgation de compromis ou volontaire d'une clé de domaine ne compromet pas la clé principale d'origine. </blockquote><br>  La clé principale fournit un mécanisme pour la mobilité des informations d'identification de l'utilisateur. <br><div class="spoiler">  <b class="spoiler_title">Remarque</b> <div class="spoiler_text">  Dans la version initiale du protocole, l'option de génération de clés de domaine basée sur le mot de passe de l'utilisateur était considérée comme garantissant la mobilité de l'utilisateur et la protection contre la compromission du mot de passe lors du piratage d'un site.  Mais dans le chapitre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«3 Consignes de sécurité», des</a> explications seront données sur les raisons pour lesquelles il a été décidé de refuser un tel schéma. </div></div><br>  Si la clé créée sur la base du «maître» a été compromise ou si le jeton calculé à partir d'une telle clé (à la suite d'un piratage du site) a été compromis, la clé doit être modifiée.  Vous pouvez la changer en une clé aléatoire de 256 bits, ou la générer à partir du même «assistant», avec l'ajout d'une version: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (version Domain \ cup) $" data-tex="display"></p>  Ci-après, le symbole <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  sera utilisé pour l'opération de concaténation de chaînes (tableaux d'octets). <br><br><a name="token_algo"></a><h2>  2.1 l'algorithme de calcul du jeton source </h2><br>  Le jeton d'authentification de l'utilisateur est calculé avec chaque demande de n'importe quelle ressource de domaine.  Pour calculer le jeton de demande, les données suivantes sont prises: <br><br><ul><li>  <i>Expéditeur</i> - le nom de domaine de l'initiateur de la demande (il peut s'agir d'une page avec une iframe ou un script du domaine de quelqu'un d'autre qui effectue la récupération), </li><li>  <i>Destinataire</i> - nom de domaine du destinataire (où la demande est envoyée), </li><li>  <i>Contexte</i> - contexte d'exécution de la demande, </li><li>  <i>Protection</i> - une séquence aléatoire de 32 octets (256 bits), si le contexte est vide;  sinon vide </li></ul><br>  Ces données sont concaténées et hachées avec SHA-2 256 bits <b>sur la clé K du domaine initiant la requête</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (Expéditeur \ Destinataire de la tasse \ Contexte de la tasse \ Protection de la tasse) $" data-tex="display"></p><blockquote>  Un jeton valide est obtenu lorsque le contexte n'est pas vide.  Pour une identification correcte sur le site cible, la condition Sender = Recipient = Context doit être remplie. </blockquote><br>  Le champ Contexte, avec Protection, est utilisé pour se protéger contre <abbr title="Contrefaçon de demande intersite - «contrefaçon de demande intersite»">les</abbr> attaques <abbr title="Script intersite - «script intersite»">XSS</abbr> et <abbr title="Contrefaçon de demande intersite - «contrefaçon de demande intersite»">CSRF</abbr> , ainsi que contre le suivi des utilisateurs. <br>  Des explications plus détaillées sur les règles de détermination de l'expéditeur / destinataire / contexte seront fournies ci-dessous. <br><br><a name="token_validation_algo"></a><h2>  2.2 Algorithme de protection des jetons pendant le transfert </h2><br>  Le jeton client d'origine est transmis extrêmement rarement.  Uniquement lors du transfert d'un jeton non enregistré au moment de la création de la session. <br>  <b>Un jeton est considéré comme non enregistré</b> s'il: est créé sur la base d'une clé aléatoire (non fixe);  n'a pas été accepté par le serveur après l'envoi de la clé de remplacement ou permanente.  Pour plus de détails, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Traitement des jetons sur le serveur»</a> . <br>  Le navigateur et le serveur génèrent conjointement une paire de nombres aléatoires, appelés  salt (Salt), avec lequel les 128 bits inférieurs du jeton sont hachés.  Les deux échangent ces numéros selon le protocole.  Pour plus de détails, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Salt Swap Procedure Browser-Server»</a> . <br>  Ainsi, le serveur de site voit le jeton suivant: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Hi (T_s) \ cup HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  où <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Salut (T_s) $" data-tex="inline">  - haute 128 bits, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - les 128 bits inférieurs du jeton d'origine, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  - concaténation de chaînes.  Dans ce cas, le jeton initial <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  devrait déjà être connu du serveur. <br><br>  Idéalement, CSI-Salt devrait changer chaque fois qu'un navigateur demande un serveur.  Cependant, cela peut être une exigence coûteuse en termes de ressources informatiques.  De plus, il peut «tuer» la possibilité d'envoyer des requêtes parallèles au serveur. <br>  Par conséquent, afin d'optimiser les calculs, il est autorisé de conserver les valeurs CSI-Salt inchangées dans différentes demandes, <u>mais pas plus d'une session</u> .  Cela peut être une limite de temps (changement de CSI-Salt toutes les 5 minutes), ou une réaction à l'intensité des requêtes (changement de CSI-Salt toutes les 100 requêtes), ou après chaque série de requêtes (au moment de la pause, client-serveur), ou une version mixte.  Ici, la décision est laissée aux développeurs de navigateurs. <br>  Garder CSI-Salt inchangé trop longtemps affaiblit la protection du jeton transmis, permettant à l'attaquant d'intercepter le jeton pendant que l'utilisateur légitime a terminé la déconnexion et d'exécuter une demande non autorisée au nom de la victime. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 Procédure d'échange de sel entre le navigateur et le serveur </h2><br>  2.3.1 Jeton basé sur une clé de serveur aléatoire ou non enregistrée <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navigateur</b> </th><th>  <b>Serveur</b> </th></tr><tr><td colspan="2">  <b>Demande initiale (initialisation de session utilisateur)</b> </td></tr><tr><td>  Le navigateur envoie le jeton tel quel. <br>  <b>Votre demande manque CSI-Salt.</b> <br></td><td>  Le serveur voit d'abord un tel jeton. <br><div class="spoiler">  <b class="spoiler_title">au fait</b> <div class="spoiler_text">  Le serveur n'est peut-être pas le premier à voir un tel jeton.  Et le navigateur est considéré comme non enregistré.  Cela peut se produire <u>lorsque vous recréez la clé en fonction de la clé principale sur un autre appareil</u> .  Par conséquent, cette situation doit également être prise en compte. </div></div><br>  Le perçoit tel qu'il est (le considère comme non protégé).  Utilise ce jeton comme identifiant de session. <br>  Génère son <i><sub>sel</sub> S.</i> <br>  <b>Le renvoie dans la réponse de l'en-tête CSI-Salt.</b> <br></td></tr><tr><td colspan="2">  <b>Deuxième demande</b> </td></tr><tr><td>  Génère du sel <i>Avec du <sub>sel</sub></i> . <br>  Le navigateur connecte <sup>[3]</sup> son sel et le sel du serveur. <br>  Le navigateur envoie la demande, en passant un jeton de sel partagé. <br>  <b>Envoie du sel CSI.</b> <br></td><td>  Le serveur reçoit la demande et <b>récupère le client CSI-Salt</b> . <br>  Le serveur connecte le sel du navigateur au sien et l'utilise pour vérifier le jeton. <br><br>  Si la validation du jeton réussit, elle fournit à l'utilisateur un contenu conforme à ses droits. <br><br>  En cas d'erreurs de vérification, renvoie l'en <b>-</b> tête <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une réponse vide: dépend du serveur. <br></td></tr><tr><td colspan="2">  <b>Demandes ultérieures</b> </td></tr><tr><td>  Le navigateur envoie la demande, en passant un jeton de sel partagé. <br>  <b>Votre demande manque CSI-Salt.</b> <br></td><td>  Le serveur reçoit la demande et vérifie son jeton. <br><br>  Si la validation du jeton réussit, elle fournit à l'utilisateur un contenu conforme à ses droits. <br><br>  En cas d'erreurs de vérification, renvoie l'en <b>-</b> tête <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une réponse vide: dépend du serveur. <br></td></tr><tr><td colspan="2">  <b>Après un certain temps <sup>[2]</sup></b> </td></tr><tr><td>  Génère un nouveau sel <i>C <sub>sel</sub></i> . <br>  Connectez le nouveau sel au sel du serveur. <br>  Envoie une requête, en passant un jeton protégé par un nouveau sel commun. <br>  <b>Envoie du sel CSI.</b> <br></td><td>  Le serveur reçoit la demande et <b>récupère le nouveau client CSI-Salt</b> . <br>  Le serveur connecte le sel du navigateur au sien et l'utilise pour vérifier le jeton. <br><br>  Si la validation du jeton réussit, elle fournit à l'utilisateur un contenu conforme à ses droits. <br><br>  En cas d'erreurs de vérification, renvoie l'en <b>-</b> tête <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une réponse vide: dépend du serveur. <br></td></tr></tbody></table></div><br>  2.3.2 Jeton basé sur la clé enregistrée par le serveur <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navigateur</b> </th><th>  <b>Serveur</b> </th></tr><tr><td colspan="2">  <b>Demande initiale (initialisation de session utilisateur)</b> </td></tr><tr><td>  Génère du sel <i>Avec du <sub>sel</sub></i> . <br>  <b>Envoie du sel CSI.</b> <br>  Transfère le jeton sous une forme protégée. <br></td><td>  Le serveur reçoit la demande et <b>récupère le client CSI-Salt</b> . <br>  Lit un jeton protégé. <br>  Recherche le jeton client complet dans sa base de données (utilise le premier jeton 128 bits reçu dans la demande de recherche). <br>  Parce que  il s'agit de la demande initiale, le serveur n'a pas envoyé de sel au client, puis la <b>validation</b> du <b>jeton à ce stade est effectuée uniquement par le sel du client</b> . <br><br>  En cas d'erreurs de vérification, renvoie l'en <b>-</b> tête <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une réponse vide: dépend du serveur. <br><br>  Si la validation du jeton réussit, elle fournit à l'utilisateur un contenu conforme à ses droits. <br><br>  Génère son <i><sub>sel</sub> S.</i> <br>  <b>Le renvoie dans la réponse de l'en-tête CSI-Salt</b> . <br></td></tr><tr><td colspan="2">  <b>Demandes ultérieures</b> </td></tr><tr><td>  Le navigateur combine son sel et son sel de serveur. <br>  Le navigateur envoie la demande, en passant un jeton de sel partagé. <br>  <b>Votre demande manque CSI-Salt</b> . <br></td><td>  Le serveur reçoit la demande et vérifie son jeton. <br><br>  Si la validation du jeton réussit, elle fournit à l'utilisateur un contenu conforme à ses droits. <br><br>  En cas d'erreurs de vérification, renvoie l'en <b>-</b> tête <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une réponse vide: dépend du serveur. <br></td></tr><tr><td colspan="2">  <b>Après un certain temps <sup>[2]</sup></b> </td></tr><tr><td>  Génère un nouveau sel <i>C <sub>sel</sub></i> . <br>  Le navigateur connecte le nouveau sel au sel du serveur. <br>  Le navigateur envoie la demande, en passant un jeton protégé par le nouveau sel partagé. <br>  <b>Envoie du sel CSI</b> . <br></td><td>  Le serveur reçoit la demande et <b>récupère le nouveau client CSI-Salt</b> . <br>  Le serveur connecte le sel du navigateur au sien et l'utilise pour vérifier le jeton. <br><br>  Si la validation du jeton réussit, elle fournit à l'utilisateur le contenu conformément à ses droits. <br><br>  En cas d'erreurs de vérification, renvoie l'en <b>-</b> tête <b>CSI-Token-Action: invalide</b> au client.  Renvoyer du contenu ou renvoyer une réponse vide: dépend du serveur. <br></td></tr></tbody></table></div><hr>  <sup>[1] Un jeton est considéré comme non enregistré s'il: est créé sur la base d'une clé aléatoire;</sup>  <sup>n'a pas été accepté par le serveur après l'envoi de la clé de modification ou permanente avec la réponse CSI-Token-Action: succès.</sup> <sup><br></sup>  <sup>[2] Le temps pendant lequel le changement CSI-Salt est effectué est déterminé par les navigateurs eux-mêmes.</sup>  <sup>Cela peut se produire après une série de demandes, après un délai d'attente, après un certain nombre de demandes.</sup> <sup>  – <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       –     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appellerons le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nôtre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le domaine dont nous </font><i><font style="vertical-align: inherit;">chargeons</font></i><font style="vertical-align: inherit;"> la page (affichée dans la barre d'adresse du navigateur). Les domaines restants seront appelés </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Même si ce sont des domaines enfants d'un donné. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appelons la ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle a été téléchargée à partir d'un domaine externe. Nous appellerons la ressource </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interne</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle a été téléchargée depuis notre domaine. La ressource peut être un script, une image, une requête ajax et tout autre fichier.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un script est considéré comme externe s'il a été téléchargé à partir d'un domaine externe. Le script placé dans la balise &lt;script&gt; créée, créé par un script externe, sera également considéré comme externe. Le script situé dans la balise &lt;script&gt; modifiée est déclaré externe s'il a été modifié par un script externe, ou si un script externe était présent dans la chaîne d'appel lorsque son contenu a changé. Même si en même temps ce &lt;script&gt; était à l'origine sur la page ou a été créé par un script interne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nommerons les balises LINK, SCRIPT, IMG, IFAME et autres, qui nécessitent que le navigateur charge une ressource dès qu'elle est rencontrée par l'analyseur DOM - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balises de ressource</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nommerons les balises FORM, A, META et autres, qui peuvent lancer le chargement des pages sous certaines conditions (soumettre, cliquer,timeout) - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lancement de balises</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appellerons la balise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle était à l'origine présente sur la page lors de sa première émission par le serveur. Nous appellerons la balise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dynamique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si elle a été créée lors de l'exécution des scripts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La balise FORM est déclarée dynamique, même si non seulement la balise elle-même a changé, mais aussi les valeurs de tous les champs INPUT associés à ce formulaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous appellerons </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notre propre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> balise dynamique </font><font style="vertical-align: inherit;">si le script qui l'a créée appartient à notre domaine, et la chaîne d'appel de l'instruction qui a généré cette balise n'avait pas de fonction appartenant à un script externe. Sinon, nous considérons une telle balise dynamique </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorrecte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le chargement de la page est déclenché par le lancement de balises.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La balise initiatrice peut être activée directement par l'utilisateur, ou activée par le script, en exécutant la commande click (pour le lien) et soumettre (pour le formulaire), ou par le script générant les événements onclick / onsubmit correspondants. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, la balise initiatrice peut être activée par le navigateur. </font><font style="vertical-align: inherit;">Un exemple d'une telle balise est META avec les paramètres http-equiv = "refresh" content = "0". </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau P. Valeurs de contexte dans différentes conditions d'ouverture de page</font></font></sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Méthode d'ouverture </font></font></th><th colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qui a déclenché le chargement de la page? </font></font></th></tr><tr><th>  Utilisateur </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propre. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le navigateur </font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Statique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1. </font><font style="vertical-align: inherit;">Référent</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4. </font><font style="vertical-align: inherit;">Hériter</font></font></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dynamique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Propre </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5. </font><font style="vertical-align: inherit;">Hériter</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7 </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8. </font><font style="vertical-align: inherit;">Hériter</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Incorrect </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC. </font><font style="vertical-align: inherit;">Vide</font></font></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Directement </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD. </font><font style="vertical-align: inherit;">Domaine</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pf. </font><font style="vertical-align: inherit;">Vide</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG. </font><font style="vertical-align: inherit;">Varariant </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">même tableau, seule image</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la balise de ressource a été modifiée par un script (par exemple, l'attribut SRC d'IMG), puis que la ressource a été automatiquement chargée par le navigateur, nous pensons que le contenu / la ressource a été déclenché par l'analyseur, la méthode de chargement est la balise, mais le statut de cette balise devient «dynamique». </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau R. Valeurs de contexte dans différentes conditions de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chargement de contenu / ressource</font></font></b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Méthode de téléchargement </font></font></th><th colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Qui a provoqué le téléchargement du contenu? </font></font></th></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analyseur Dom </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propre. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Statique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1. </font><font style="vertical-align: inherit;">La page</font></font></td><td></td><td></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dynamique </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Propre </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4. </font><font style="vertical-align: inherit;">La page</font></font></td><td></td><td></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Incorrect </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7. </font><font style="vertical-align: inherit;">Vide</font></font></td><td></td><td></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Directement </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA. </font><font style="vertical-align: inherit;">Référent</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB. </font><font style="vertical-align: inherit;">La page</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC </font><font style="vertical-align: inherit;">Référent</font></font></td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">même tableau, seule image</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1] Balise de lancement </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2] Balise de ressource </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3] Hériter de ses propres pages, vide lors de l'ouverture de pages de domaines étrangers </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4] Hériter lors de la redirection de serveurs vers leurs pages, vide lors de la redirection vers d'autres domaines ou lors de l'ouverture d'une page à partir de sources externes (voir . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clarification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></sup> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abréviations</font></font></b> <div class="spoiler_text"> <b>Referrer</b> –     Referrer. <br> <b>Page</b> –   (Tab)      . <br> <b>Empty</b> –  . <br> <b>Domain</b> –  Context     <br> <b>Inherit</b> –  Context     <br> <b>Variant</b> –  Context    «-»   <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Des marques de la forme P1..PF, R1..RC seront utilisées pour faire référence à la cellule correspondante dans le tableau lors de l'analyse de situations spécifiques. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarquez le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">domaine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font><font style="vertical-align: inherit;">surbrillance </font><font style="vertical-align: inherit;">dans le premier tableau. </font><font style="vertical-align: inherit;">Vous ne pouvez être autorisé sur un site que lorsque vous ouvrez vous-même le site à une adresse directe ou par un lien à partir d'un autre site, avec un rechargement ultérieur de la page de votre propre initiative.</font></font></blockquote><br><br><a name="sender_recipient_rules"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.5 Règles de définition des champs expéditeur et destinataire </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'expéditeur est le domaine de la page / du script / du style d'où provient la demande. </font><font style="vertical-align: inherit;">La page demande des styles, des images, des scripts. </font><font style="vertical-align: inherit;">Les scripts demandent du contenu via ajax. </font><font style="vertical-align: inherit;">Les styles peuvent charger d'autres styles. </font><font style="vertical-align: inherit;">Ce sont les initiateurs de la demande. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le destinataire est le domaine auquel la demande va vraiment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour qu'il n'y ait plus de questions, considérons des exemples spécifiques. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'il y ait un site site.net. </font><font style="vertical-align: inherit;">Sur la page principale du site:</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style site.net/css/common.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les styles common.css importent les styles fonts.google.com/fonts/Roboto.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le style Roboto.css importe la police fonts.google.com/fonts/Roboto.ttf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> image menant à img.site.net/picture1.jpg </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trame chargée depuis adriver.ru/frame </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adm.site.net/admin.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Laissez dans le cadre (avec adriver.ru) vous connecter: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style de adriver.ru/style.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> image de img.adriver.ru/img/01.png </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adriver.ru/libs.js </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de api.adriver.ru/v1/ad.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeurs de l'expéditeur / destinataire lors du chargement des ressources avec l'analyseur DOM </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ressource téléchargeable </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeur de l'expéditeur </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valeur du destinataire </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/css/common.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.ttf </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net/picture1.jpg </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/frame </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/style.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru/img/01.png </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, regardons les valeurs de Sender / Recipient lors du chargement de contenu avec des scripts lors de l'exécution des requêtes ajax. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeurs de l'expéditeur / destinataire lors du chargement de contenu avec des scripts</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script exécutable </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Où va la demande? </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expéditeur </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Destinataire </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru / ... </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru </font></font></td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.6 Détails sur les tables de définition de contexte </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examinons plus en détail les options d'ouverture de pages (onglets du navigateur) dont nous disposons et la valeur de contexte qui sera obtenue. </font></font><br><br><a name="P1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'utilisateur de la page précédente a cliqué sur le lien ou cliquez sur le bouton soumettre du formulaire. Le gestionnaire de navigateur d'événements standard pour le lien / formulaire a redirigé l'utilisateur vers cette page. Situation normale. Transition sécurisée entre les pages d'un domaine ou différents domaines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous passez à site.net à partir d'un autre domaine google.com, le contexte sera égal au domaine précédent (google.com). Et l'utilisateur sur le nouveau domaine site.net ne sera pas autorisé (même si l'onglet voisin de ce site où l'utilisateur est autorisé est ouvert). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une transition indépendante répétée de l'utilisateur (sans l'aide de scripts) via le lien vers le même site conduira à nouveau à la situation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais le contexte sera déjà égal au domaine site.net, car par la règle Context = Referrer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est fait pour protéger contre</font></font><abbr title="ross Site Request Forgery — «  »"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attaque </font><abbr title="ross Site Request Forgery — «  »"><font style="vertical-align: inherit;">CSRF</font></abbr><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P5"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'utilisateur de la page précédente a cliqué sur le lien créé / modifié par un script téléchargé depuis le domaine de la page précédente; </font><font style="vertical-align: inherit;">ou l'utilisateur de la page précédente a cliqué sur le bouton d'envoi du formulaire créé / modifié par le script (en changeant la balise FORM, y compris ses champs INPUT). </font><font style="vertical-align: inherit;">Le gestionnaire de navigateur d'événements standard pour le lien / formulaire a redirigé l'utilisateur vers cette page.</font></font><br><br><a name="P9"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est identique à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le script était externe, ou il existe une fonction d'un script externe dans la chaîne d'appel (protection contre la modification des fonctions de script du script de site par un script tiers).</font></font><br><br><a name="PD"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'utilisateur a ouvert la page à une adresse directe. </font><font style="vertical-align: inherit;">Ouverture sûre.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisateur doit ouvrir la page en entrant l'URL dans la barre d'adresse. </font><font style="vertical-align: inherit;">Ou ouvrez un site à partir des signets du navigateur.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ouverture d'un lien à partir d'un raccourci sur le bureau d'un autre programme, toute autre situation où le système d'exploitation envoie une commande au navigateur pour ouvrir le lien doit être considérée comme un cas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (l'ouverture du lien est initiée par le navigateur). Même si l'utilisateur appuie sur F5 pour recharger la page, cela doit être considéré comme un cas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce n'est que si l'utilisateur entre dans la barre d'adresse et appuie sur Entrée que le navigateur sera considéré comme un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est fait pour protéger les attaques CSRF contre d'autres programmes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fait de suivre le lien d'un autre programme mènera l'utilisateur vers le site attaqué avec un jeton invalide et un contexte vide, qui seront enregistrés même si l'utilisateur appuie sur F5 (actualiser la page). Vous ne pouvez pas vous connecter tant que l'utilisateur n'a ouvert aucun lien vers les pages du site (situation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, si un attaquant d'un autre programme décide de faire glisser à un utilisateur autorisé un lien vers la page du site site.net qui exécute une commande, il ne pourra pas le faire facilement. Il faudra forcer l'utilisateur à cliquer sur un autre lien sur cette page, puis forcer l'utilisateur à s'y authentifier, et alors seulement ... Ensuite, l'utilisateur sera très probablement sur une autre page de site.net.</font></font><br><br><a name="P2"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sur la page précédente pour un lien ou un formulaire placé à l'origine sur la page, un script natif de la page précédente a généré un événement click / submit. </font><font style="vertical-align: inherit;">Aucune fonction de la chaîne d'appels n'appartenait à des scripts externes. </font><font style="vertical-align: inherit;">Le navigateur a redirigé l'utilisateur vers cette page. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la nouvelle page appartient au même domaine, le contexte est hérité de la page précédente. </font><font style="vertical-align: inherit;">Si la nouvelle page appartient à un domaine étranger, le contexte sera vide.</font></font><br><br><a name="P6"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le même que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a été créé / modifié par son propre script.</font></font><br><br><a name="PA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le même que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a été créé / modifié par un script externe.</font></font><br><br><a name="PE"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le script de la page précédente a provoqué l'ouverture de cette page avec la commande window.location.href ou window.open (...). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le script de page site.net redirige l'utilisateur vers la page du même domaine, le champ Contexte sera hérité de la page de génération. Dans ce cas, Context = site.net. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la page ya.ru a été ouverte et que le script nous a transférés sur maps.ya.ru, le contexte de la nouvelle page sera déjà vide. Dans les actions ultérieures de l'utilisateur, le contexte restera presque toujours vide, ce qui compliquera l'autorisation de l'utilisateur sur le site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole implique que l'ouverture d'un site sur un autre est une opération dangereuse. Cela protège l'utilisateur contre le suivi non autorisé par ces sites et contre les attaques CSRF.</font></font><br><br><a name="P3"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul l'événement click / submit a été déclenché par un script externe. </font><font style="vertical-align: inherit;">Le contexte devient vide (une séquence aléatoire d'octets est envoyée à la place), ce qui protège les sites tiers du suivi du site (réseaux de bannières).</font></font><br><br><a name="P7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a été créé / modifié par un script externe.</font></font><br><br><a name="PB"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le lien / formulaire a été créé / modifié par un script externe.</font></font><br><br><a name="PF"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul le script provocateur était externe.</font></font><br><br><a name="P4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le navigateur a rechargé la page suite au traitement de la balise &lt;META&gt;. </font><font style="vertical-align: inherit;">La balise était à l'origine sur la page. </font><font style="vertical-align: inherit;">Redirection légale. </font><font style="vertical-align: inherit;">Le contexte persistera à partir de la page d'origine. </font><font style="vertical-align: inherit;">Comme c'est le cas avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P8"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le navigateur a rechargé la page suite au traitement de la balise &lt;META&gt;. </font><font style="vertical-align: inherit;">Mais la balise a été créée / modifiée par son propre script. </font><font style="vertical-align: inherit;">Ceci est valide, mais le contexte persistera à partir de la page d'origine. </font><font style="vertical-align: inherit;">Comme c'est le cas avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il ne sera pas possible d'attirer le jeton légal de l'utilisateur de cette manière.</font></font><br><br><a name="PC"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - similaire à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seul script externe. </font><font style="vertical-align: inherit;">Le site ouvert recevra un nombre aléatoire comme contexte.</font></font><br><br><a name="PG"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le navigateur ouvre des liens sur commande à partir du système d'exploitation. </font><font style="vertical-align: inherit;">Il se peut que vous cliquiez sur un lien d'un autre programme, ouvriez un raccourci sur le bureau. </font><font style="vertical-align: inherit;">Il peut s'agir d'une commande d'un autre programme, à votre insu. </font><font style="vertical-align: inherit;">Dans ce cas, la source n'est pas approuvée et le champ Contexte restera vide lors de toute manipulation utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est fait pour protéger les attaques CSRF contre d'autres programmes.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si le navigateur lui-même ouvre les onglets précédemment enregistrés, le contexte de la page est défini égal à la valeur de cette page au moment de la fermeture du navigateur. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, cette catégorie comprend toutes les situations où le navigateur est redirigé par le serveur vers une autre page (de son propre domaine ou de quelqu'un d'autre) suite au traitement de l'en-tête HTTP Header. </font><font style="vertical-align: inherit;">Si la redirection va vers votre propre page, la valeur de contexte est héritée. </font><font style="vertical-align: inherit;">Si la redirection va à quelqu'un d'autre, elle est réinitialisée. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est fait pour protéger contre le suivi des attaques des serveurs Web.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, une telle règle peut entraîner des problèmes avec la mise en œuvre actuelle de l'autorisation interdomaine. </font><font style="vertical-align: inherit;">Si après autorisation, le serveur SSO redirige l'utilisateur vers le site cible, ce dernier y sera anonyme.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour éviter à l'utilisateur de «perdre» l'autorisation d'origine sur le site cible, il est nécessaire de transmettre des informations d'authentification entre les requêtes du serveur. </font><font style="vertical-align: inherit;">L'algorithme peut être le suivant:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur crée et active une clé permanente pour le site cible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Passe du site cible au serveur SSO lui-même en cliquant sur le lien approprié; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> active la clé permanente existante à partir du serveur SSO; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Après avoir reçu la clé Changed-To, le serveur SSO envoie une requête inter-serveur au site cible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur clique sur le bouton «Continuer» de la page d'autorisation, ce qui le renvoie au site cible; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin de respecter la règle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le site cible propose à l'utilisateur de cliquer à nouveau sur le bouton de lien pour y accéder (par exemple, vers la page d'accueil d'un participant autorisé).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur clique sur le bouton de lien, la page se recharge et l'utilisateur est déjà autorisé sur le site cible. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La description de l'algorithme semble en fait plus compliquée que sa mise en œuvre. </font><font style="vertical-align: inherit;">Une implémentation de l'interface utilisateur pourrait ressembler à ceci:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une nouvelle entrée sur le site cible ne nécessite plus l'autorisation SSO de l'utilisateur. </font><font style="vertical-align: inherit;">Il suffit d'activer la clé permanente.</font></font></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examinons maintenant de plus près les options de chargement de contenu sur les pages et la valeur de contexte qui sera obtenue sur demande. </font></font><br><br><a name="R1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la ressource est chargée par le navigateur suite à l'analyse de la page (le navigateur a rencontré une balise de ressource). </font><font style="vertical-align: inherit;">La valeur de contexte lors de la génération d'une demande de ressource est extraite de la page Contexte contenant la balise de ressource. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, si site.net a un cadre adriver.ru dans lequel l'image de img.disk.com est chargée, puis lors de la génération d'une requête HTTP vers img.disk.com, le navigateur prend la valeur calculée pour la page comme contexte site.net.</font></font><br><br><a name="R4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est identique à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Seule la balise de ressource a été créée / modifiée par son propre script, à la suite de quoi le navigateur DOM Parser a fonctionné. Par exemple, sur la page site.net/index.html, notre propre script site.net/require.js a inséré un autre script personnalisé (&lt;script src = ...&gt; tag) site.net/min.js, ce qui a forcé le navigateur à générer une demande de téléchargement de fichier main.js. Le champ Contexte de cette demande sera défini sur la valeur calculée pour la page site.net.</font></font><br><br><a name="R7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est identique à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais comme la balise de ressource a été créée / modifiée par un script externe, lorsque la ressource est demandée, le navigateur générera un jeton basé sur un contexte vide et une séquence aléatoire de 256 bits. En conséquence, le script de l'attaquant externe evil.com/drop.js, intégré à la page du domaine site.net attaqué, essayant de répondre à une demande adressée au site.net cible au nom de la victime échouera, car le serveur recevra une demande avec un jeton aléatoire et ne pourra pas identifier l'expéditeur de la demande.</font></font><br><br><a name="RA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'analyseur télécharge le contenu suite à l'analyse d'un autre contenu Par exemple, la feuille de style site.net/css/common.css, téléchargée pour la page site.net/index.html, importe la feuille de style fonts.google.com/fonts/Roboto.css, ce qui oblige le navigateur à demander fonts.google .com au nom de Referrer = site.net/css/common.css. La valeur de contexte dans ce cas sera égale à Referrer. Ensuite, le fichier de styles Roboto.css importe la police Roboto.ttf, ce qui oblige le navigateur à demander fonts.google.com/fonts/Roboto.ttf au nom de Referrer = fonts.google.com/fonts/Roboto.css. La valeur de contexte sera égale à Referrer dans ce cas, mais elle est différente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons, hypothétiquement, que le fichier Roboto.css (ressource externe) n'importe pas de police / style, mais essaie de mener une attaque CSRF avec cette instruction:</font></font><pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  dans l'espoir de répondre à la demande sur site.net au nom d'un utilisateur autorisé.  Mais le problème pour l'attaquant est que site.net s'attend à recevoir un jeton de l'utilisateur: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Ensuite, comme avec une telle demande CSRF, le navigateur créera un jeton: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  Et une demande adressée au site viendra de la part d'un site anonyme qui ne dispose pas de droits d'accès pour effectuer ces opérations. <br><br><a name="RB"></a>  <b>RB</b> - le contenu est téléchargé par le propre script du site.  Dans ce cas, Context est utilisé pour calculer le jeton de demande, qui est égal à la page contenant le script.  Pour le script site.net/1.js de la page Contexte site.net, il sera égal au contexte de la page elle-même. <br><blockquote>  Notez que le contexte de la page elle-même n'est pas toujours égal au nom de domaine de la page et dépend de la façon dont elle a été ouverte à l'origine. </blockquote>  Supposons que le site de l'attaquant evil.com ouvre la page du site attaqué site.net, où le script site.net/util.js exécute une requête avec les paramètres transmis via l'URL de la page.  L'attaquant espère, en glissant «ses paramètres» via l'URL, forcer son propre script site.net/util.js à exécuter une requête ajax pour effectuer des actions importantes au nom de la victime. <br><br>  Supposons que l'utilisateur lui-même soit allé sur evil.com via un lien direct.  Le contexte de evil.com sera alors evil.com.  De plus evil.com ouvre le script site.net/api/payment?victim_params avec un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">script</a> , dans l'espoir de mener une attaque, mais le champ Contexte de site.net sera vide (cas PE / PF).  Le script site.net/utils.js, exécutant une requête ajax, forcera le navigateur à prendre Context depuis la page site.net.  Et c'est vide chez nous.  Mais alors site.net recevra une demande ajax avec ce jeton: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup random) $" data-tex="display"></p><br>  alors que pour un utilisateur autorisé, il est prévu: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net verra un jeton inconnu et ne pourra pas identifier l'utilisateur.  La protection a fonctionné. <br><blockquote>  Soit dit en passant, à cause d'un tel schéma, la réalisation d'une autorisation interdomaine via des fenêtres contextuelles sera irréaliste. </blockquote>  Pour implémenter l'authentification unique sous le protocole, vous devez ouvrir un nouvel onglet pour la page du serveur d'autorisation.  Et en même temps, l'utilisateur doit ouvrir un tel onglet.  La meilleure option est d'ouvrir à l'utilisateur le lien approprié depuis le site cible. <br><br><a name="RC"></a>  <b>RC</b> - le contenu est chargé avec un script de site Web externe.  Dans ce cas, Context est utilisé pour calculer le jeton de demande, qui est égal au champ Request Referrer. <br><br>  Malgré le fait que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RB</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RC</a> protègent contre les attaques CSRF, ils conduisent néanmoins à la génération de jetons constants.  Et <b>cela vous permet d'implémenter l'authentification interdomaine et</b> l' <b>authentification</b> utilisateur <b>interdomaine</b> (lorsque vous devez déterminer que plusieurs demandes adressées à différents serveurs provenaient de cet utilisateur).  Ce qui peut être mis en œuvre pour lui donner une autorité égale sur un groupe de domaines connexes. <br><br>  Si la <b>page</b> du <b>site a été ouverte automatiquement à</b> partir d'un autre site, vous ne pourrez pas vous y connecter, même si vous rechargez ce site vous-même.  Parce que Source héritera d'une valeur nulle.  Le navigateur doit signaler à l'utilisateur ce fait (Source = aléatoire): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Ceci est fait pour se protéger contre les sites qui forcent d'autres fenêtres contextuelles à s'ouvrir (elles-mêmes ou leurs scripts externes), et sur les sites qui s'ouvrent, ils redémarreront ou créeront de faux boutons de fermeture sur tout l'écran menant aux mêmes sites.  C'est-à-dire  cela empêche une tentative de suivi, dans l'espoir d'obtenir un jeton valide. <br><br>  <b>Toute tentative par le site d'imiter vos actions avec un script externe</b> , ou une tentative par un script externe de créer directement ou indirectement une balise initiatrice et de vous la glisser, conduira à une source vide et à l'ajout d'octets aléatoires au moment du calcul du hachage de jeton. <br><br>  L'astuce pour créer ou modifier la balise &lt;script&gt; dans la page attaquée dans le DOM n'aidera pas.  Le champ Source restera vide. <br><br>  Mais dans les mêmes conditions, les scripts internes conduiront à des requêtes avec Source égale à sa valeur précédente.  Et si la page d'origine avait Source = Domain, tout irait bien.  L'utilisateur restera autorisé pour de telles demandes. <br><br>  Mais avec des scripts téléchargés à partir de ressources tierces (CDN), des problèmes peuvent survenir dans certains cas.  Et c'est vrai, car  L'intégrité du code CDN n'est pas garantie.  Si vous ne voulez pas perdre l'autorisation de l'utilisateur, conservez les scripts sur votre site et téléchargez-les depuis votre domaine.  Cela ressemble à l'interdiction d'utiliser des liens http sur les pages https. <br><br>  Nous décrivons la situation dans laquelle un développeur peut tomber.  À la suite des actions de l'utilisateur, votre script redirige un utilisateur autorisé vers l'une des pages du site (par exemple, cela se fait par un formulaire), ce qui nécessite que l'utilisateur reste autorisé.  Votre script appelle, par exemple, $ (form) .submit () à l'aide d'un script jQuery chargé à partir du CDN.  Dans ce cas, le navigateur voit que dans la pile d'appels qui a déclenché l'événement d'envoi du formulaire, il existe une fonction d'un script externe.  Pour empêcher <abbr title="Contrefaçon de demande intersite - «contrefaçon de demande intersite»">les</abbr> attaques <abbr title="Script intersite - «script intersite»">XSS</abbr> / <abbr title="Contrefaçon de demande intersite - «contrefaçon de demande intersite»">CSRF</abbr> , le navigateur rend le champ Source vide et ajoute des octets aléatoires à la génération du jeton (cas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">P9</a> ).  En conséquence, l'utilisateur sur la nouvelle page devient soudainement non autorisé et ne peut pas terminer l'opération.  Cela peut être déroutant pour les développeurs habitués à utiliser les CDN. <br><br><a name="protocol_scenario"></a><h2>  2.7 Scénarios de protocole </h2><br>  Voici les principaux scénarios probables de l'utilisateur travaillant avec le site, affectant toutes les situations possibles et les étapes de leur mise en œuvre (connexion anonyme, «se souvenir de moi», «oublie-moi», passer à l'utilisation d'une clé permanente, autorisation et sortie, enregistrement et authentification à deux facteurs, exportation / importation de clés, remplacement de clés, etc.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 Forum, Blog, Wikipédia </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  1.1 Premier accès à ce site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.2 Afficher les pages. </td><td>  Envoie un jeton sécurisé contre une clé aléatoire. </td><td>  Fournit du contenu public.  Vérifie le bit de jeton inférieur de 128 bits. </td></tr><tr><td>  1.3 Essayer de faire des actions (ajouter des commentaires, etc.) </td><td>  Envoie un jeton sécurisé contre une clé aléatoire. </td><td>  Indique à l'utilisateur qu'il doit se présenter au système.  À ce stade, le site est convaincu que la clé est aléatoire. </td></tr><tr><td>  1.4 Indique au navigateur de faire en sorte que le site s'en souvienne. </td><td>  Corrige la clé actuelle.  Envoie une clé permanente.  Le jeton, comme précédemment, est transmis sous une forme protégée.  Envoie cette clé jusqu'à ce qu'elle reçoive le succès du serveur. </td><td>  Maintenant, le site sait que la clé est fixe.  Envoie CSI-Token-Action: succès.  Il peut appliquer la technique de mémorisation de l'utilisateur pendant une longue période: il enregistre un jeton dans la base de données pour la récupération de session future avec l'utilisateur.  Ou maintient la session plus longtemps (enregistrer dans un fichier). </td></tr><tr><td>  1.5 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton CSI sécurisé à partir d'une clé fixe. </td><td>  Enregistre les actions de cet utilisateur. </td></tr><tr><td>  1.6 Ferme l'onglet du navigateur. </td><td>  Rien. </td><td>  Il attend les demandes des utilisateurs suivantes. </td></tr><tr><td>  1.7 Retourne sur le site. </td><td>  Envoie une clé fixe sécurisée. </td><td>  Continue de travailler avec l'utilisateur.  Les données de session sont extraites de la base de données ou du fichier temporaire par jeton. </td></tr><tr><td>  1.8 Annule la fixation des clés (oubliez-moi sur ce site) </td><td>  Envoie une clé de déconnexion </td><td>  Supprime les données utilisateur dans la base de données, comme  il s'agissait d'une clé fixe et l'utilisateur ne pourra plus jamais la récupérer.  Met fin à la session.  Le navigateur n'enverra plus jamais un tel jeton. </td></tr><tr><td>  1.9 Lorsque vous accédez au site pour la première fois après la déconnexion. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Ce site est déjà un nouvel utilisateur.  Nous considérons l'utilisateur anonyme.  Nous utilisons le jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.10 Parcourir les pages. </td><td>  Envoie un jeton sécurisé contre une clé aléatoire. </td><td>  Fournit du contenu public.  Vérifie le bit de jeton inférieur de 128 bits. </td></tr><tr><td>  1.11 Ferme l'onglet du navigateur. </td><td>  Rien. </td><td>  Interrompt une session après une temporisation. </td></tr><tr><td>  1.12 Retourne sur le site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.13 Crée une clé de site permanente. </td><td>  Rien. </td></tr><tr><td>  1.14 Activation de la clé permanente. </td><td>  <b>Demande à l'utilisateur: voulez-vous vraiment que le site se souvienne de votre clé?</b>  <b>Assurez-vous que ce site est bien celui qu'il prétend être.</b> <br>  Envoie le changement vers.  Ce n'est qu'à ce moment que le navigateur transmet le jeton aux personnes non protégées.  Dans tous les cas suivants, le navigateur transmettra toujours un jeton protégé lors de la connexion.  Mais pour cela, le site doit confirmer le changement de jetons via CSI-Token-Action: succès. </td><td>  N'oubliez pas le nouveau jeton utilisateur dans la base de données.  Modifie l'ID de session.  Continue d'attendre les demandes du nouveau jeton.  Envoie CSI-Token-Action: succès. </td></tr><tr><td>  1.15 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton sécurisé à partir d'une clé permanente </td><td>  Enregistre les actions de cet utilisateur.  Vérifie le jeton inférieur de 128 bits. </td></tr><tr><td>  1.16 Effectue la "Sortie". </td><td>  Envoie une clé de déconnexion </td><td>  Rompre la session </td></tr><tr><td>  1.17 Retourne sur le site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons le jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  1.18 Activation de la clé permanente. </td><td>  Envoie le changement vers.  Le jeton est déjà protégé, car  la dernière fois que le site nous a répondu CSI-Token-Action: succès. </td><td>  Nous chargeons les données utilisateur enregistrées à partir de la base de données.  Modifie l'ID de session.  Nous travaillons avec le jeton enregistré.  Nous savons qu'un jeton est basé sur une clé permanente. </td></tr><tr><td>  1.19 Ferme l'onglet du navigateur. </td><td>  Rien.  Ou la clé de déconnexion, si "sortie automatique" est configuré lorsque l'onglet est fermé. </td><td>  Interrompt une session après un délai d'expiration ou à la réception d'une clé de déconnexion. </td></tr><tr><th colspan="3">  2 Boutique en ligne ou site d'annonces </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  2.1 D'abord inclus sur ce site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur. </td></tr><tr><td>  2.2 Afficher les pages. </td><td>  Envoie un jeton sécurisé contre une clé aléatoire. </td><td>  Fournit du contenu public.  Vérifie le bit de jeton inférieur de 128 bits. </td></tr><tr><td>  2.3 Essayer de faire des actions (ajouter des publicités, des achats, etc.) </td><td>  Envoie un jeton sécurisé contre une clé aléatoire. </td><td>  Indique à l'utilisateur qu'il doit se présenter au système.  À ce stade, le site est convaincu que la clé est aléatoire. </td></tr><tr><td>  2.4 Indique au navigateur de faire en sorte que le site s'en souvienne. </td><td>  Corrige la clé actuelle.  Avant la première demande, il envoie un jeton CSI sécurisé avec la clé permanente.  Après avoir réussi, il arrête d'envoyer cette clé. </td><td>  Maintenant, le site sait que la clé est fixe.  Il peut appliquer la technique de la mémorisation de l'utilisateur pendant une longue période: soit il enregistre le jeton dans la base de données pour une récupération future de la session avec l'utilisateur.  Ou tient la session plus longtemps (plusieurs jours). </td></tr><tr><td>  2.5 Effectue des actions (ajout d'annonces, d'achats, etc.) </td><td>  Envoie un jeton CSI sécurisé à partir d'une clé fixe. </td><td>  Enregistre les actions de cet utilisateur.  Vérifie le jeton. </td></tr><tr><td>  2.6 Ferme l'onglet du navigateur. </td><td>  Rien. </td><td>  Tient la session.  Avec une inactivité prolongée, il enregistre les données de session de la RAM dans un fichier ou une base de données. </td></tr><tr><td>  2.7 Se connecte à nouveau au site. </td><td>  Envoie une clé fixe sécurisée. </td><td>  La séance se poursuit.  Nous travaillons avec l'utilisateur, comme si de rien n'était. </td></tr><tr><td>  2.8 <b>Crée ou importe une</b> clé de site persistante. </td><td>  Rien. </td></tr><tr><td>  2.9 Activation de la clé permanente.  Ici, en fait, il y a une transition de l'utilisation d'une clé fixe à une clé permanente. </td><td>  Envoie une clé de modification.  Le jeton est transmis <b>sans protection</b> pour la clé nouvellement créée et le jeton non enregistré sur le serveur.  Le jeton est transféré <b>protégé</b> pour la clé importée. </td><td>  2.9.A.  Jeton basé sur la nouvelle clé. <br>  Si l'ancien jeton a été enregistré dans la base de données - changez simplement le jeton dans la base de données. <br><br>  2.9.V.  Jeton basé sur la clé importée. <br>  Si l'ancien jeton a été enregistré dans la base de données - supprimez-le.  Lors de la fusion de deux profils d'un utilisateur (ce que vous pouvez lui demander) - car  en fait, l'utilisateur a deux jetons stockés dans la base de données: à partir d'une clé fixe et d'une clé importée.  Modifie l'ID de session.  Envoie CSI-Token-Action: succès.  Il continue d'attendre les demandes du nouveau jeton. </td></tr><tr><td>  2.10 Effectue des actions (achats, affichage d'annonces, panier d'achat, favoris, avis, comparaisons) </td><td>  Envoie un jeton sécurisé à partir d'une clé permanente </td><td>  Enregistre les actions de cet utilisateur.  Vérifie le jeton inférieur de 128 bits. </td></tr><tr><td>  2.11 Ferme l'onglet du navigateur. </td><td>  Rien.  Ou la clé de déconnexion, si "sortie automatique" est configuré lorsque l'onglet est fermé. </td><td>  Interrompt une session après un délai d'expiration ou à la réception d'une clé de déconnexion. </td></tr><tr><th colspan="3">  3 sites avec pré-inscription obligatoire (réseau social) </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  3.1 Inclus sur ce site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous ne laissons que dans les sections publiques.  Lorsque vous essayez d'accéder au contenu fermé, nous traduisons dans le formulaire d'autorisation. </td></tr><tr><td>  3.2 Crée une clé de site permanente </td><td>  Rien </td></tr><tr><td>  3.3 Activation de la clé permanente. </td><td>  <b>Demande à l'utilisateur: voulez-vous vraiment que le site se souvienne de votre clé?</b>  <b>Assurez-vous que ce site est bien celui qu'il prétend être.</b> <br><br>  Envoie le changement vers. <br>  <b>Le jeton est transmis en clair</b> . </td><td>  N'oubliez pas le nouveau jeton.  Nous ne sommes pas pressés d'enregistrer dans la base de données tant que l'enregistrement n'est pas encore terminé.  Nous gardons l'utilisateur sur le formulaire «Inscription» jusqu'à confirmation de la propriété (par téléphone, courrier).  Envoie CSI-Token-Action: enregistrement </td></tr><tr><td>  3.4 Entrez vos coordonnées. </td><td>  Envoie des requêtes ajax.  Envoie le changement vers.  Ancien jeton sur la même clé aléatoire. <br>  <b>Le nouveau jeton est déjà transféré sous une forme protégée</b> . <br><br>  Dès qu'il réussit, il passe à l'utilisation d'un nouveau jeton (clé permanente). </td><td>  Vérifie les coordonnées.  Si tout réussit, il envoie CSI-Token-Action: succès.  Sinon: CSI-Token-Action: inscription.  Si CSI-Token-Action: abandon est envoyé, l'enregistrement ne réussit pas.  Le navigateur devrait revenir à l'utilisation d'un nombre aléatoire (annulation de la saisie).  Et signalez cela à l'utilisateur. </td></tr><tr><td>  3.5 Va dans la section fermée du site </td><td>  Envoie un jeton sécurisé à partir d'une clé permanente. </td><td>  Fournit un accès en vérifiant le jeton inférieur de 128 bits. </td></tr><tr><td>  3.6 Effectue des actions (achats, affichage d'annonces, panier d'achat, favoris, avis, comparaisons) </td><td>  Envoie un jeton sécurisé à partir d'une clé permanente. </td><td>  Enregistre les actions de cet utilisateur.  Vérifie le jeton inférieur de 128 bits. </td></tr><tr><td>  3.7 Ferme l'onglet du navigateur. </td><td>  Rien.  Ou la clé de déconnexion, si "sortie automatique" est configuré lorsque l'onglet est fermé. </td><td>  Interrompt une session après un délai d'expiration ou à la réception d'une clé de déconnexion. </td></tr><tr><td>  3.8 Inclus dans ce site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous ne laissons que dans les sections publiques.  Lorsque nous essayons d'accéder à un contenu fermé, nous informons l'utilisateur qu'il est un utilisateur anonyme. </td></tr><tr><td>  3.9 Activation de la clé permanente. </td><td>  Envoie le changement vers.  Les deux jetons sont transmis de manière sécurisée. </td><td>  Nous chargeons les données utilisateur de la base de données par jeton (le 128 bits le plus élevé).  Maintenant, le site sait qui est cet utilisateur. </td></tr><tr><td>  3.10 Modifie la clé permanente du domaine (en un autre permanent) </td><td>  <b>Demande à l'utilisateur: voulez-vous vraiment que le site se souvienne de votre nouvelle clé?</b>  <b>Assurez-vous que ce site est bien celui qu'il prétend être.</b> <br><br>  Envoie le changement vers. <br>  <b>Le nouveau jeton est transféré en clair;</b>  <b>vieux - dans protégé</b> <br></td><td>  Remplace le jeton de la base de données par un nouveau.  Charge les données de profil.  Utilise un nouveau jeton à partir des demandes suivantes.  Envoie CSI-Token-Action: succès </td></tr><tr><td>  3.11 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton sécurisé à partir d'une nouvelle clé </td><td>  Enregistre les actions de cet utilisateur.  Vérifie le jeton inférieur de 128 bits. </td></tr><tr><td>  3.12 Effectue une "sortie". </td><td>  Envoie une clé de déconnexion </td><td>  Rompre la session </td></tr><tr><td>  3.13 Inclus sur ce site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous traduisons vers le formulaire d'autorisation. </td></tr><tr><td>  3.14 Activation d'une clé permanente </td><td>  Envoie le changement vers.  Les deux jetons sont transmis de manière sécurisée. </td><td>  Nous chargeons les données utilisateur de la base de données par jeton (le 128 bits le plus élevé). </td></tr><tr><td>  3.15 Importe une clé différente pour ce domaine. <br>  <b>Important: la clé importée doit être enregistrée sur le serveur.</b> <br></td><td>  Envoie une clé Déconnexion Passe à l'utilisation d'une clé aléatoire. </td><td>  Rompre la session </td></tr><tr><td>  3.16 Active une nouvelle clé </td><td>  Envoie le changement vers. <br>  <b>Les deux jetons sont transmis de manière sécurisée.</b> <br><br>  Veuillez noter que la clé «précédente» est déjà une clé aléatoire (voir 3.15). </td><td>  Cette clé doit être connue de la base de données.  <b>L'exportation</b> de <b>clé à</b> partir du navigateur n'est autorisée que pour les jetons enregistrés.  Ainsi, le navigateur est sûr que la <b>clé importée est connue du serveur</b> et l'envoie sécurisée.  Sinon, le serveur ne peut pas reconnaître le jeton utilisateur et ne peut pas l'autoriser. </td></tr><tr><td>  3.17 Effectue des actions (ajout de messages, vote, etc.) </td><td>  Envoie un jeton sécurisé à partir d'une nouvelle clé </td><td>  Enregistre les actions de cet utilisateur.  Vérifie le jeton inférieur de 128 bits. </td></tr><tr><td>  3.18 sort </td><td>  Envoie une clé de déconnexion </td><td>  Rompre la session </td></tr><tr><th colspan="3">  4 sites avec autorisation à deux facteurs (Sberbank Online) </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>  Serveur de site </th></tr><tr><td>  4.1 Inclus sur ce site. </td><td>  Génère une clé aléatoire.  Envoie un jeton non sécurisé à partir d'une clé aléatoire. </td><td>  Nous considérons l'utilisateur anonyme.  Nous utilisons ce jeton comme identifiant de la session utilisateur.  Nous traduisons vers le formulaire d'autorisation. </td></tr><tr><td>  4.2 Crée une clé de site permanente </td><td>  Rien </td></tr><tr><td>  4.3 Activation de la clé permanente. </td><td>  <b>Demande à l'utilisateur: voulez-vous vraiment que le site se souvienne de votre clé?</b>  <b>Assurez-vous que ce site est bien celui qu'il prétend être.</b> <br><br>  Envoie le changement vers. <br>  <b>Le jeton est transmis en clair</b> . </td><td>  Le jeton n'est pas connu du site.  N'oubliez pas le nouveau jeton.     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  «» </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  «»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          «». </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  «»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   «»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess – .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 – Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   «»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Utilisateur </th><th>  Navigateur </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  « » </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           «» </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considère l'utilisateur anonyme. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affiche le message "Accès refusé"</font></font></b> <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.8 Activation de la clé permanente. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoie le changement vers. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le jeton est transmis sous une forme protégée</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (car il est déjà connu de l'appareil; nous avons passé l'enregistrement plus tôt).</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifie l'utilisateur par le jeton 128 bits le plus élevé. </font><font style="vertical-align: inherit;">Vérifie les bits faibles.</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.9 Effectue des actions privilégiées </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoie un jeton sécurisé à partir d'une clé permanente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effectue des actions conformément aux privilèges de l'utilisateur. </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.10 Sort </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoie une clé de déconnexion </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rompre la session </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un exemple de configuration d'accès aux jetons basé sur le fichier .htaccess. </font></font><br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chat /etc/apache2/.csi_keys </font></font></pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.7.1 Algorithme de calcul des jetons utilisateur possibles d'un site à l'aide d'une clé connue </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nous connaissons la clé de domaine K, nous pouvons facilement calculer le jeton T "valide" possible de l'utilisateur qui viendra avec ses demandes. </font><font style="vertical-align: inherit;">Pour cela, il faut que la condition soit remplie: l'initiateur des requêtes, le destinataire des requêtes et le contexte d'exécution doivent correspondre et être égaux au domaine. </font><font style="vertical-align: inherit;">En d'autres termes, si nous avons le nom de domaine vsphere.local, alors:</font></font><br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> À partir de là, le jeton d'origine (brut) est calculé comme suit: </font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la transmission, le jeton d'origine sera davantage protégé. </font><font style="vertical-align: inherit;">Les 128 bits inférieurs du jeton seront hachés avec le sel passé dans l'en-tête de demande CSI-Salt </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ainsi, le site verra le jeton suivant:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Où </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspond aux 128 bits supérieurs, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspond aux 128 bits inférieurs du jeton d'origine. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, pour les consoles de gestion fermées sur un réseau d'entreprise, les consoles Web ne chargent pas de scripts, de cadres, etc. externes. </font><font style="vertical-align: inherit;">Par conséquent, cette condition sera remplie dans la plupart des cas.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Pour la méthode de formation du sel, voir la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Procédure d'échange de sel entre le navigateur et le serveur».</font></font></a></sup> <br><br><a name="server_token_processing"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.8 Traitement des jetons sur le serveur </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoi d'un token au serveur (sans clés) </font></font></h3><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> État du jeton T dans la session de site </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Actions du serveur de site </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inconnu </font></font></td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt –   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    –  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le navigateur verrouille la clé client. </font><font style="vertical-align: inherit;">L'utilisateur souhaite que le site se souvienne du client pendant plusieurs sessions. </font><font style="vertical-align: inherit;">Le stockage du jeton utilisateur dans sa base de données est la décision du serveur. </font><font style="vertical-align: inherit;">Nous renvoyons CSI-Token-Action: succès ou CSI-Token-Action: abandon au client.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoi d'un jeton avec une clé de déconnexion </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indique que le jeton actuel ne sera plus utilisé par le navigateur. </font><font style="vertical-align: inherit;">Envoyé lorsque l'utilisateur clique sur "Quitter" dans le navigateur, ou ferme l'onglet et l'option est configurée (sortie automatique lorsque l'onglet est fermé), ou refuse d'utiliser une clé fixe ("oublie-moi sur ce site").</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, l'autologin ne devrait pas l'être. </font><font style="vertical-align: inherit;">Pour des raisons de sécurité.</font></font></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envoi d'un jeton avec une clé de modification </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appelons l'ancien jeton T, le nouveau - T '. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMPORTANT: en</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tant que nouveau jeton T ', la valeur réelle du jeton est envoyée (pour la première fois, pour les non enregistrés), tandis que l'ancien jeton est envoyé haché (les 128 bits inférieurs).</font></font><br><div class="scrollable-table"><table><tbody><tr><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statut du jeton dans la base de données du serveur </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup> </td><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Actions du serveur de site </font></font></td></tr><tr><td>  T </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T ' </font></font></td></tr><tr><td>  non </td><td>  non </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Motif: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistrement légal de l'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplacez l'identifiant de session utilisateur par T ' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoyer le client CSI-Token-Action: succès. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisateur a créé une clé permanente pour le site et a effectué la «connexion». </font><font style="vertical-align: inherit;">Le serveur peut stocker un tel jeton sur son côté. </font><font style="vertical-align: inherit;">Et avant cela, proposez de remplir le formulaire d'inscription (si nécessaire).</font></font><br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   –      (  ). <br></td></tr><tr><td>  non </td><td>  est là </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       «» .    <b>      </b> ,       -.  Parce que    «  »,    . <br></td></tr><tr><td>  est là </td><td>  non </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  <br>  <br></td><td>  est là </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      – . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  <br>  <br> . <br></td><td>  est là </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , –  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme mentionné précédemment, les sites peuvent interagir avec d'autres sites partenaires ou leurs sous-domaines pour fournir à l'utilisateur certaines des fonctionnalités. L'exemple le plus courant est lorsque sur le site site.ru certaines des ressources sont chargées à partir des sous-domaines img.site.ru, une partie de download.site.ru et une autre partie d'autres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, le site site.ru doit pouvoir informer ses domaines partenaires dont les demandes lui parviennent exactement. En effet, si vous êtes autorisé sur site.ru, cela ne vous rend pas automatiquement autorisé sur d'autres sites, y compris les sous-domaines du site. Ils verront d'autres jetons de votre part. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyons comment le jeton est calculé et comment cela peut nous aider. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laissez l'utilisateur se connecter à site.ru avec une clé permanente et y avoir un jeton:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Toutes les demandes provenant de la page du site site.ru vers le domaine site.ru et causées par: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> balises de ressource de page (dynamique statique ou native) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propres scripts </font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aura un jeton T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir règles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Ce sont des demandes légitimes à site.ru. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, laissez le client télécharger le fichier restreint à partir de la page site.ru, mais le lien mène à download.site.ru. </font><font style="vertical-align: inherit;">Dans ce cas, le sous-domaine recevra le jeton suivant (règles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exactement le même jeton download.site.ru recevra si une demande ajax de la page du site site.ru est exécutée dessus (règles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre domaine de domaine recevra un jeton:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais, notez que si les conditions pour répondre aux demandes ne changent pas, alors pour un ensemble donné de domaines A, B, C, le navigateur générera toujours un jeton constant. </font><font style="vertical-align: inherit;">Nous pouvons donc effectuer une identification interdomaines. </font><font style="vertical-align: inherit;">Par exemple, comme ça. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depuis site.ru, nous faisons des demandes ajax pour les sous-domaines. </font><font style="vertical-align: inherit;">Nous passons l'identifiant ID! = T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 de l'</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisateur, qui lui est délivré par site.ru. </font><font style="vertical-align: inherit;">Les sous-domaines recevront des jetons T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour le même utilisateur </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Chacun des sous-domaines fera un tas de son jeton avec l'ID utilisateur. </font><font style="vertical-align: inherit;">Les sous-domaines partageront déjà des informations sur l'ID utilisateur et ses droits avec les demandes de serveur à serveur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bouquet est fait une fois. </font><font style="vertical-align: inherit;">Par la suite, les sous-domaines seront guidés par leurs propres jetons, comme </font><font style="vertical-align: inherit;">ils seront également permanents pour la clé permanente site.ru.</font></font><br><br><a name="part3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 Recommandations de sécurité </font></font></h1><br><div class="spoiler">  <b class="spoiler_title">Remarque</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.1 Protection des informations clés contre les accès non autorisés </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole d'autorisation proposé protège l'utilisateur contre les enregistreurs de frappe qui volent vos mots de passe, car le schéma proposé n'utilise aucun mot de passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais les moyens de protéger les clés contre les compromis doivent être examinés plus en détail. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les clés peuvent être compromises par:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> copie des informations clés par un logiciel malveillant (accès à distance) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accès direct au fichier avec les informations clés "hors ligne" (accès direct) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moment de la distribution entre les appareils </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En supposant que les informations clés sont stockées sur une carte à puce (nous avons considéré cette option dans la section </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Mobilité du compte»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), la tâche de protection des informations clés est transférée sur la puce. Certes, il existe une vulnérabilité aux enregistreurs de frappe qui peuvent intercepter le code PIN saisi; Eh bien, désagrément à utiliser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus des cartes à puce, le cryptage symétrique peut être utilisé pour se protéger contre l'accès direct aux informations clés. Mais la question est: quelle clé prendre pour le chiffrement? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si cette clé est générée sur la base du mot de passe de l'utilisateur, alors, d'une part, nous obtenons une vulnérabilité à la sélection du mot de passe «hors ligne», et d'autre part, en fait, de ce qu'ils ont laissé, ils en sont venus à: «encore une fois, certains mots de passe». </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une option plus correcte consiste à </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coudre d'une manière spéciale </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une telle clé dans l'assemblage du navigateur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou l'une de ses bibliothèques spécialisées). Chaque mise à jour du navigateur modifie à la fois la clé et son emplacement dans le fichier compilé. Cette approche ne donnera pas une garantie de protection à 100%, mais compliquera sérieusement la tâche de décryptage. Tout d'abord, l'attaquant devra trouver la version exacte de l'assemblage, puis la trouver, la démonter et découvrir comment la clé est assemblée.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, les clés de domaine elles-mêmes doivent être directement stockées dans un fichier séparé, et non avec la configuration pour leur utilisation (c'est-à-dire uniquement les clés et rien de plus). Ensuite, leur déchiffrement par sélection de clé (à partir d'assemblages connus) sera impossible, car il est impossible de distinguer une clé correctement déchiffrée d'une séquence aléatoire d'octets. Ensuite, les tentatives de récupération d'une clé principale sans connaître la version exacte de l'assemblage du navigateur et le démontage direct de son code deviendront impossible. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez utiliser l'option combinée: cryptage avec la clé du navigateur + cryptage avec le mot de passe utilisateur du compte OS (si l'API OS le permet). De plus, la clé est toujours générée à la volée. La force brute hors ligne deviendra alors encore plus chère.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, après avoir changé le mot de passe utilisateur dans le système d'exploitation, la clé changera également. </font><font style="vertical-align: inherit;">Et si vous ne pré-décryptez pas sur l'ancienne clé, cela vous protégera contre les situations où l'administrateur de l'ordinateur change votre mot de passe afin d'accéder à votre compte et d'effectuer des actions en votre nom. </font><font style="vertical-align: inherit;">Situations du type: quitter son emploi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous allez d'abord faire une copie de sauvegarde des clés (exporter les clés dans un fichier). </font><font style="vertical-align: inherit;">Sauf si, bien sûr, vous l'avez déjà fait lors de la distribution de clés à d'autres appareils.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Par exemple, une clé de 32 octets est distribuée de manière aléatoire dans la section 64 Ko d'un fichier exécutable. </font><font style="vertical-align: inherit;">Et seul le code source sait comment récupérer la clé précieuse de ces octets.</font></font></sup> <br><br><a name="why_password_for_keys_not_good"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.2 À propos des mots de passe en tant que clés de domaine </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'une des versions initiales du protocole, la clé de domaine pouvait être générée en fonction du mot de passe de l'utilisateur. L'algorithme était délicat, à l'exclusion des clés en double pour différents domaines pour le même mot de passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela a été positionné comme un moyen pratique d'accéder aux comptes de mobilité. Saisie d'un mot de passe et ne vous inquiétez de rien. Mais il s'est avéré ce qui suit:</font></font><br><br><ol><li>     ,     «» ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  C'est-à-dire       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  C'est-à-dire      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et si je perds la clé principale?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cela peut se produire si vous modifiez votre mot de passe ou réinstallez le système d'exploitation. Quels sont les risques? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, vous n'irez pas sur les sites où vous étiez auparavant. Perdez votre historique d'achat sur les boutiques en ligne, vos annonces sur les sites en ligne, le karma sur les forums. Peu importe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais qui empêche de refaire la procédure d'enregistrement avec un nouveau token et de le confirmer via le numéro de téléphone indiqué dans la même annonce? Il s'avère que le site doit faire une forme de ré-enregistrement du token (un analogue de "récupération de mot de passe")? Où est l'absence promise de «toutes sortes de» formes? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, un site qui doit non seulement identifier le visiteur, mais aussi savoir qui il est, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devra</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faire un formulaire d'inscription. </font><font style="vertical-align: inherit;">En fait, ce formulaire peut être utilisé pour une réinscription. </font><font style="vertical-align: inherit;">Vous spécifiez exactement les mêmes données qu'auparavant (email, mobile). </font><font style="vertical-align: inherit;">Confirmez que vous disposez de ces données (lettre, SMS). </font><font style="vertical-align: inherit;">Le système voit qu'un tel compte existe déjà, les données vous appartiennent à 100%, mais le jeton est différent - il réécrit le jeton. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais encore, il vaut mieux ne pas perdre la clé principale.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment éviter les pertes? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créez une copie de sauvegarde, protégez-la avec un mot de passe et stockez-la sur un support jetable. </font><font style="vertical-align: inherit;">De plus, en fait, comme cela se fait avec les clés pour Bitcoin. </font><font style="vertical-align: inherit;">En principe, vous pouvez traduire les clés principales sous forme imprimée et les enregistrer sur une feuille de papier. </font><font style="vertical-align: inherit;">D'ailleurs. </font><font style="vertical-align: inherit;">Et puis restaurer par entrée manuelle. </font><font style="vertical-align: inherit;">Mais c'est pour des gens assez «paranoïaques» comme moi.</font></font><br></blockquote><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais que se passe-t-il si on me vole une clé principale?</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C'est déjà grave. Bien que les recommandations décrites ici pour le stockage de la clé principale (non incluses dans le protocole) les protègent contre la falsification directe, les enregistreurs de frappe et les chevaux de Troie, néanmoins, le risque de compromettre la clé principale demeure. Malheureusement, une protection parfaite n'existe pas. La clé peut être détournée directement de la mémoire du navigateur via une vulnérabilité du moteur javascript. Par exemple. Ou perdez-vous votre téléphone portable ... </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors, quels sont les risques de voler une clé principale?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indispensable pour recevoir des informations sur vous et même pour agir en votre nom. Obtenir la possibilité pour un attaquant de se connecter sous vous et en mode lecture pour accéder à des informations sensibles.</font></font> Calme et tranquille.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou téléchargez simultanément toutes vos vidéos privées de vos camarades de classe. C'est désagréable pour toi. Les fans de phoques se réjouissent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, vous devez vous réinscrire rapidement avec une nouvelle clé sur des sites importants. Et, si quelque chose de terrible s'est produit, l'enregistrement de votre nouveau jeton dans la base de données du fournisseur de services de manière officielle est la seule bonne option. Vous pouvez penser à de nombreuses méthodes d'enregistrement: de la fixation du papier dans une lettre officielle, à une demande via le service d'assistance technique du site avec confirmation de votre identité de manière acceptable. Mais ce n'est que pour les sites sérieux, comme les services bancaires en ligne.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Façons de minimiser les risques. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation de clés individuelles pour les domaines (mais cela réduit la mobilité des comptes). </font><font style="vertical-align: inherit;">Authentification à deux facteurs via des canaux indépendants. </font><font style="vertical-align: inherit;">Le site affiche les adresses IP et les appareils sur lesquels la connexion était établie la dernière fois, afin que vous remarquiez au moins un compromis.</font></font><br></blockquote><br><br><a name="part4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 Attaques contre le régime d'autorisation </font></font></h1><br><br><a name="attack_user_tracking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.1 Suivi des utilisateurs </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un site de confiance peut fusionner sans vergogne des informations vous concernant avec d'autres sites. </font><font style="vertical-align: inherit;">Sur Internet, il existe des sites collecteurs qui regroupent ces informations et les vendent à tout le monde. </font><font style="vertical-align: inherit;">Statistiques Yandex, Google Analytics - un site rare s'en passe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour que deux sites différents puissent déterminer qu'ils travaillent avec le même client, deux techniques sont utilisées:</font></font><br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a un léger inconvénient dans le schéma 2: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non pas l'utilisateur est identifié</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais le navigateur. Mais souvent, le navigateur == client. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble que le jeton soit le mieux adapté pour une utilisation dans le schéma n ° 2. Après tout, si l'utilisateur a permis à deux sites (agissant en couple) de se «souvenir» d'eux-mêmes, notre jeton permanent peut agir comme une telle «empreinte digitale», non seulement le navigateur, mais l'utilisateur lui-même. Le problème pour les sites ici est qu'ils </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recevront des jetons différents</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais les sites peuvent essayer d'appliquer également le schéma n ° 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le site 1 recevra le code H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du navigateur </font><font style="vertical-align: inherit;">et le site 2, exécuté dans le contexte du site 1, </font><font style="vertical-align: inherit;">recevra le </font><font style="vertical-align: inherit;">code H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il semble maintenant que les sites peuvent former une paire (H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , H</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et même le transmettre à un site d'agrégateur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'un autre site 3, associé au site 2, essaie de vous suivre. </font><font style="vertical-align: inherit;">Le site 3 recevra le jeton H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du navigateur </font><font style="vertical-align: inherit;">, et le site 2, exécuté dans le contexte du site 3, </font><font style="vertical-align: inherit;">recevra le </font><font style="vertical-align: inherit;">jeton H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 '</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (voir comment les jetons sont formés). </font><font style="vertical-align: inherit;">En conséquence, la combinaison des données obtenues est impossible, car </font><font style="vertical-align: inherit;">ils n'ont pas de parties qui se chevauchent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cela ne signifie pas que les sites ne pourront pas utiliser un navigateur d'empreintes digitales pour surveiller</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il indique seulement que le schéma de génération de jetons lui-même est assez fiable et protège contre le suivi. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option de protection:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Déconnectez-vous des sites avec lesquels vous avez fini de travailler. </font><font style="vertical-align: inherit;">Le navigateur peut le faire automatiquement lorsque vous fermez l'onglet.</font></font><br><br><a name="attack_XSS"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.2 Attaque XSS </font></font></h2><br><br> <abbr title="Cross-Site Scripting — « »"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un type d'attaque impliquant l'introduction de code malveillant sur la page du site Web victim.com. </font><font style="vertical-align: inherit;">Par exemple, via un script d'affiliation ou un CDN piraté d'un framework populaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un code malveillant peut utiliser l'autorisation de l'utilisateur sur le site pour y accéder ou pour voler des données d'authentification de l'utilisateur. </font><font style="vertical-align: inherit;">Un code malveillant peut être inséré dans une page via une vulnérabilité dans un serveur Web (piratage trivial), via des réseaux affiliés (sources peu fiables), via une vulnérabilité sur l'ordinateur d'un utilisateur (crawling de chevaux de Troie). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La protection principale contre de telles attaques pour notre schéma d'autorisation est constituée de règles spéciales pour générer le champ Source lors du calcul des jetons. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vulnérabilité</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: pour XSS stocké (lorsque le script est directement inséré dans le site attaqué et chargé à partir de celui-ci suite au piratage du serveur), la protection ne fonctionnera pas. </font><font style="vertical-align: inherit;">Parce que le navigateur ne pourra pas identifier un tel script comme «externe». </font><font style="vertical-align: inherit;">Le même problème se produit lorsqu'un attaquant effectue un proxy sur le trafic client-serveur.</font></font><br><br><a name="attack_CSRF"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.3 Attaque CSRF </font></font></h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La victime visite le site evil.com, créé par un attaquant. En son nom, une requête (GET / POST / HEAD / PUT / DELETE) est exécutée vers un site où l'utilisateur est déjà autorisé (par exemple, vers un serveur de système de paiement). La demande elle-même effectue une sorte d'opération malveillante (par exemple, le transfert d'argent sur le compte de l'attaquant). Selon la supervision des développeurs, le site ne vérifie pas les champs Referer et ne demande pas d'informations de vérification supplémentaires à l'utilisateur. En conséquence, l'attaque est réussie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le schéma d'autorisation de site proposé supprime la plupart des scénarios d'attaque </font></font><abbr title="ross Site Request Forgery — «  »"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSRF</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en raison de l'algorithme de génération de jetons. </font><font style="vertical-align: inherit;">Toute demande intersite entraînera la réception par le site attaqué d'un jeton non valide de l'utilisateur. </font><font style="vertical-align: inherit;">Par conséquent, dans cette situation, l'utilisateur du site attaqué sera anonyme anonyme. </font><font style="vertical-align: inherit;">Même une tentative d'exécution d'une demande GET inoffensive d'un site attaquant à un site attaqué (téléchargement d'une image) entraînera la réception par ce dernier d'un jeton invalide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela devrait grandement simplifier la vie des développeurs de sites.</font></font><br><br><a name="attack_SSO"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.4 Suivi à l'aide de l'authentification unique </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux sites S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , auxquels l'utilisateur fait confiance et dont il dispose les clés, décident d'appliquer une technologie similaire à SSO pour le suivi des utilisateurs. Mais depuis vous ne pouvez pas intégrer un site dans un autre (l'un d'eux recevra un jeton non valide), vous ne pouvez pas ouvrir le site d'un partenaire avec un script (pour la même raison), puis le site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> décide d'utiliser une technique délicate. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur l'une des pages, il place une étiquette translucide A, couvrant toute la fenêtre. Le lien mène au site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et l'identifiant utilisateur (à partir de S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et le jeton H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 sont</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmis dans l'adresse </font><font style="vertical-align: inherit;">. L'utilisateur ne voit pas le lien. En cliquant sur n'importe quelle zone du site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il déclenche l'ouverture d'un nouvel onglet sur le site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour le moment, S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne recevra pas de jeton valide. </font><font style="vertical-align: inherit;">L'auto-rechargement avec une balise ne l'aidera pas non plus</font></font><br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou un script. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut créer la balise A sur toute sa page sous la forme d'un faux bouton Fermer:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce lien rechargera d'abord le site, puis le fermera. </font><font style="vertical-align: inherit;">Au moment du redémarrage, le navigateur enverra le </font><font style="vertical-align: inherit;">token H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> déjà valide </font><font style="vertical-align: inherit;">au site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (car la règle 2.4 P1 a été respectée: l'utilisateur a personnellement ouvert les deux liens). </font><font style="vertical-align: inherit;">En conséquence, S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> recevra des informations sur les actions de son utilisateur sur le site S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> , associera le jeton H </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> à son H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> et enverra à H </font><sub><font style="vertical-align: inherit;">2 une</font></sub><font style="vertical-align: inherit;"> requête interserveur à S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A l'avenir, les sites S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> et S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> pourront échanger toute information sur l'utilisateur par échange de serveur, comme </font><font style="vertical-align: inherit;">maintenant, ils peuvent l'identifier de manière unique </font><b><font style="vertical-align: inherit;">séparément les uns des autres</font></b></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les utilisateurs mobiles sont particulièrement vulnérables à cette attaque, car </font><font style="vertical-align: inherit;">essayer de fermer une page inutile peut accidentellement cliquer sur un faux lien qui occupe tout l'écran mobile.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode de protection:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interrompez automatiquement la session lorsque l'onglet est fermé. </font><font style="vertical-align: inherit;">Ensuite, le site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a pas pu recevoir de jeton valide tant que l'utilisateur lui-même ne s'est pas connecté. </font><font style="vertical-align: inherit;">Certes, cela ne protégera pas contre les situations où l'utilisateur lui-même a ouvert les onglets et s'est connecté à S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et c'est seulement alors que les sites ont mené une telle attaque.</font></font><br><br><a name="attack_sso_key_discredit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.5 Compromis clé pour l'authentification unique </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laissez un compte d'utilisateur sur un serveur d'authentification qui prend en charge l'authentification unique être compromis. </font><font style="vertical-align: inherit;">Nous évaluerons les risques possibles avec notre schéma d'authentification. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les jetons pour chaque site sont calculés individuellement en fonction des clés de domaine.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compromettre une clé de domaine ne compromet pas automatiquement toutes les autres.</font></font></b> </blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart des sites sur lesquels vous vous êtes déjà connecté en utilisant SSO enregistreront probablement votre jeton avec votre profil depuis le serveur SSO dans leur base de données. </font><font style="vertical-align: inherit;">Dans notre schéma, le site extraira simplement un jeton de la base de données et vous reconnaîtra.</font></font> C'est-à-dire<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le serveur SSO n'est plus nécessaire sur ces sites - il a rempli sa fonction au stade de l'enregistrement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En d'autres termes, vous ne perdez pas automatiquement tous vos accès à la fois. Un attaquant sera identifié sur les mêmes sites qu'une autre personne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une tentative de reconduction de l'authentification entre domaines n'aidera pas non plus l'attaquant: le site devrait bloquer les tentatives de création d'un nouveau compte avec l'ancien identifiant SSO et le nouveau jeton de site. Ou bien, les tentatives de réécriture du jeton utilisateur pour un ID existant dans le processus SSO doivent être bloquées. Le fait de cela devrait susciter une suspicion raisonnable du côté du site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un jeton utilisateur ne peut être légalement modifié que d'une seule manière (voir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Scénarios de fonctionnement du protocole»</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risque.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le site n'enregistre pas votre jeton et votre profil dans sa base de données, mais s'appuie entièrement sur le mécanisme SSO, un attaquant n'a qu'à effectuer une authentification interdomaine pour se connecter en utilisant votre nom. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimisation des risques en cas de compromis.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Curieusement, mais c'est la préservation par les sites de tokens et de profils utilisateurs de leur côté. Une tentative par un attaquant de mener une authentification interdomaine peut provoquer un conflit entre l'ancien utilisateur Id et son nouveau jeton. La situation elle-même, lorsque l'utilisateur a modifié le jeton d'une manière autre que celle spécifiée dans le protocole, doit être perçue de manière suspecte ou rejetée complètement. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risque maximum:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autorisation en votre nom sur d'autres sites (où vous n'êtes pas allé). Accédez à vos données de profil. Commettre des actes illégaux en votre nom. Et pour que le propriétaire légitime ne puisse rien retourner, un attaquant peut changer son jeton sur le serveur d'autorisation de manière légale. Ce risque coïncide cependant avec les risques liés à l'utilisation des régimes d'autorisation traditionnels. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moyens de protection.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Refus d'utiliser l'authentification unique (d'autant que le schéma proposé a été conçu comme un moyen de s'éloigner des schémas d'authentification centralisée). Utilisez plusieurs SSO (ne stockez pas tous les œufs dans le même panier!). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si SSO prend en charge l'authentification à deux facteurs avec authentification par d'autres attributs (courrier, téléphone), il est alors possible de reprendre le contrôle du compte du serveur d'autorisation.</font></font><br><br><a name="attack_token_compromise_due_transmit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.6 Compromission de jetons pendant le transfert </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est clair que le mécanisme proposé pour hacher les jetons pendant le transfert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne donne pas une garantie à 100% de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leur protection. </font><font style="vertical-align: inherit;">Un attaquant peut intercepter le trafic de la victime au moment du transfert d'un jeton non sécurisé (lors de l'enregistrement principal de la clé permanente), à ​​titre d'exemple. </font><font style="vertical-align: inherit;">Et puis utilisez-le. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par conséquent, l'utilisation de SSL est encouragée. </font><font style="vertical-align: inherit;">Mais ne prenez pas le HTTPS comme panacée. </font><font style="vertical-align: inherit;">Ce protocole est également exposé, ainsi que HTTP. </font><font style="vertical-align: inherit;">Seulement un peu plus dur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certes, un transfert aussi rare d'un jeton ouvert, ainsi que l'utilisation d'un jeton individuel pour chaque domaine, réduit le risque d'exploiter la vulnérabilité. </font><font style="vertical-align: inherit;">Néanmoins.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre danger est l'interception et la réutilisation du jeton dans la session en cours de l'utilisateur. </font><font style="vertical-align: inherit;">Comme je l'ai dit plus tôt, idéalement, le jeton devrait être haché avec un nouveau sel à chaque demande du client. </font><font style="vertical-align: inherit;">Cependant, cela supprimera la possibilité de traitement parallèle des demandes sur le serveur et rendra impossible l'envoi de demandes parallèles à partir du client. </font><font style="vertical-align: inherit;">Le calcul et la vérification des hachages sont généralement une opération coûteuse qui réduit les performances.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, le jeton passé dans l'en-tête ne doit jamais être disponible depuis Javascript. </font><font style="vertical-align: inherit;">Similaire à Cookie avec le drapeau HttpOnly. </font><font style="vertical-align: inherit;">Même lors de la réception de requêtes ajax par scripts.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode de fonctionnement:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intercepter la demande d'un utilisateur, extraire la valeur actuelle du jeton, envoyer une autre opération avec le même jeton (comme pour le même utilisateur). </font><font style="vertical-align: inherit;">Certes, le système classique basé sur les cookies de session est également vulnérable à ce type d'attaque. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode de protection:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> confirmation des opérations importantes via d'autres canaux de communication, par exemple par SMS ou courrier; </font><font style="vertical-align: inherit;">pré-enregistrement du token via d'autres canaux de communication (certificat papier, par exemple).</font></font><br><br><a name="attack_token_compromise_due_site_hacking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.7 Piratage d'un site Web et compromission de jetons </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les sites de piratage se produisent constamment. </font><font style="vertical-align: inherit;">Même les grands sites bien protégés se brisent. </font><font style="vertical-align: inherit;">Il existe de nombreuses façons de pirater: d'une injection triviale à un «drain» d'initié. </font><font style="vertical-align: inherit;">Par conséquent, la compromission de votre jeton sur n'importe quel site est un événement très probable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais le protocole proposé, tout de même, rend l'événement de piratage du site le moins douloureux pour vous.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La compromission du jeton n'entraîne pas la compromission de la clé de domaine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la base de laquelle elle a été calculée. </font><font style="vertical-align: inherit;">De plus, cet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">événement ne conduit pas au compromis de vos autres jetons</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et si c'est le cas, l'accès à d'autres sites reste inaccessible.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est particulièrement agréable lorsque des clés sont apportées à la plupart des sites à l'aide d'une clé principale: il est impossible de la restaurer par reverse engineering. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais en même temps, il est impossible d'utiliser la clé de domaine dont le jeton a été compromis, pour des raisons évidentes. </font><font style="vertical-align: inherit;">Je dois changer la clé. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clé du domaine où la fuite officielle s'est produite peut être effectuée soit sur la base d'un nombre aléatoire, soit sur la base d'une clé principale, avec l'ajout d'un numéro de version:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Conclusion </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plusieurs de mes amis à qui j'ai montré l'article m'ont posé essentiellement la même question: "Quelle est la principale chose ici?" </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vu d'en haut</font></font></b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        « »      «-». <br><br>  -    « ». <s>  </s>    ,  <s></s> «».     ,    .     (   Google ,  Facebook –       ).     (  DDOS-    . – <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO –    . <br><br> ,        « ».         .      .       .             .   , . <br><br>      -      «»  .    ,    « ».          ,    . <br><br>  -,         ? <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh, il n'y a pas de puce principale!</font></font></b>  Hélas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il existe un certain nombre de détails qui rendent le protocole plus rentable que le schéma de connexion / mot de passe traditionnel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Vous avez probablement remarqué ce popup ennuyeux sur de nombreux sites.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Notre site enregistre les cookies! </font><font style="vertical-align: inherit;">Mettez votre casque et soyez vigilant, car le grand frère vous regarde! </font><font style="vertical-align: inherit;">Cliquez sur "Oui", car vous n'avez toujours pas le choix. "</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est un autre popup pour un tas d'autres tout aussi intrusifs et très nécessaires. </font><font style="vertical-align: inherit;">Et tout cela grâce au RGPD européen (un analogue de notre loi PD). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors voilà. </font><font style="vertical-align: inherit;">Dans notre système, les cookies ne sont plus nécessaires à des fins d'identification! </font><font style="vertical-align: inherit;">Du mot «complètement». </font><font style="vertical-align: inherit;">L'utilisateur décide d'autoriser ou non le site à l'identifier, et quand et pendant combien de temps. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moins un popup ennuyeux, +1 au karma du protocole.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Le développeur n'a plus besoin de faire des formulaires d'autorisation et de récupération de mot de passe. </font><font style="vertical-align: inherit;">Il n'est pas nécessaire d'implémenter des algorithmes SSO complexes et de maîtriser des bibliothèques complexes: OAuth, SAML, Kerberos, etc., suivez la procédure d'enregistrement de votre site, modifiez les clés d'autorisation, surveillez leur sécurité; </font><font style="vertical-align: inherit;">et si quelque chose a mal tourné avec SSO, comprenez de toute urgence: "qu'est-ce qui a mal tourné et pourquoi." </font><font style="vertical-align: inherit;">De plus, le serveur d'autorisation peut bloquer votre site pour des raisons inconnues. </font><font style="vertical-align: inherit;">Allez le découvrir. </font><font style="vertical-align: inherit;">Hier, tout a fonctionné, mais aujourd'hui ... Et ici, il suffit de lire le jeton dans l'en-tête et de vérifier s'il y en a un dans notre base de données. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple = fiable</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juste dire ...</font></font></b> <div class="spoiler_text">      .     .       ,   -  -  .       . .  . <br><br>    -, -,  « »   . <br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. L'utilisateur n'a pas besoin d'entrer et de se souvenir d'un tas de mots de passe. Utilisez les services de sites tiers ou on ne sait pas par qui et comment les programmes écrits. Vous ne pouvez pas avoir peur de l'accès à un ordinateur par des tiers, des enregistreurs de frappe et des chevaux de Troie. Il suffit de faire une copie de sauvegarde de la clé principale, de la protéger avec un mot de passe et de la stocker quelque part sur une clé USB. Comme un portefeuille Bitcoin. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce qui n'est pas une fonctionnalité?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Si le site est piraté, vous ne risquez rien. Eh bien, régénérez à nouveau la clé. Alors que le mot de passe divulgué aux crackers du site peut causer beaucoup de problèmes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Le protocole a été créé en tenant compte de l'expérience des attaques de réseau connues. Son architecture comprend déjà une protection de base contre XSS, CSRF. Encore une fois, les webmasters trouveront plus facile de développer des sites. Et leurs utilisateurs - plus calmes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Indépendance du protocole vis-à-vis d'un fournisseur de services spécifique et de ses caprices. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le protocole vous rend libre.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Enfin, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocole</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proposé </font><b><font style="vertical-align: inherit;">revendique la future norme ouverte</font></b><font style="vertical-align: inherit;"> . Et la norme, si elle est adoptée par les participants, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impose des obligations de mettre en œuvre la fonctionnalité conformément au cahier des charges</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et de ne pas exclure la ferme collective de ses propres décisions d'autorisation, inventant une fois de plus la forme de connexion, d'enregistrement, de récupération de mot de passe, de déconnexion. Et ne plaisante pas avec le hachage de mot de passe ou l'injection SQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et surtout, comme tout standard ouvert, il </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut et doit être vérifié</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> experts indépendants.</font></font></font><font style="vertical-align: inherit;">Même si l'auteur de la version originale du protocole a «foiré» les détails, la communauté en ligne peut identifier ce correctif en temps opportun. </font><font style="vertical-align: inherit;">Eh bien, ou envoyez mon protocole à la ferraille. </font><font style="vertical-align: inherit;">Hélas pour moi, et "pooh-carry" pour tout le monde.</font></font><br><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Je pense que je devrais m'arrêter là-dessus</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E. Wiles</font></font><br></blockquote><br><br><hr>  <b>PS</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez vous familiariser avec l'option d'un article complet dans un format hors ligne. </font><font style="vertical-align: inherit;">Lors de la composition de documents sur Habr, je pouvais faire des fautes de frappe. </font><font style="vertical-align: inherit;">Si vous avez des commentaires sérieux, il est préférable de vérifier l'original et de laisser les commentaires d'article (critiques) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans ce fichier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Envoyez-moi vos modifications sur le mail sergey201991 [] gmail. </font><font style="vertical-align: inherit;">Je ne suis pas une pieuvre, mais je vais essayer de répondre. </font><font style="vertical-align: inherit;">J'ajouterai plusieurs commentaires correspondants / intéressants à cet article. </font><font style="vertical-align: inherit;">Avec leurs réponses. </font><font style="vertical-align: inherit;">Une variante d'un article de commentaire séparé n'est pas exclue. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, je sais que le protocole peut avoir des problèmes:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il n'y a aucun moyen de se connecter sous votre compte sur l'appareil de quelqu'un d'autre si vous n'avez pas de clé en main, mais vous en avez besoin de toute urgence; </font><font style="vertical-align: inherit;">les mots de passe sont plus pratiques ici</font></font></li><li>      ;           ,  SSO </li><li>       «», -  : -      (   ) </li><li>    -  </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ce qui concerne la page 1 - je pensais sérieusement à revenir à l'idée de générer une clé de domaine basée sur un mot de passe, en faisant une protection contre la force brute en compliquant le processus de génération de la clé: disons, augmenter le nombre de tours de hachage à 1000. Mais le problème avec une possible collision de mots de passe pour différents utilisateurs sur un seul Le site me hante. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concernant la page 2 - cela est traité par le temps. </font><font style="vertical-align: inherit;">Vous devez vous habituer aux nouvelles interfaces. </font><font style="vertical-align: inherit;">Au début, ce ne sera pas clair, puis ce sera simple. </font><font style="vertical-align: inherit;">Donner à un homme des années 80 un smartphone moderne, il n'aurait pas non plus deviné comment le gérer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci beaucoup si vous le lisez jusqu'au bout!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472310/">https://habr.com/ru/post/fr472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472296/index.html">Système de protection contre les fuites pour une machine à laver</a></li>
<li><a href="../fr472298/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 385 (14-20 octobre 2019)</a></li>
<li><a href="../fr472300/index.html">Descente de gradient stochastique (SGD) pour la fonction de perte logarithmique (LogLoss) dans un problème de classification binaire</a></li>
<li><a href="../fr472304/index.html">La NASA embauche des ingénieurs pour développer un robot humanoïde de nouvelle génération</a></li>
<li><a href="../fr472306/index.html">PHP Digest n ° 166 (7-21 octobre 2019)</a></li>
<li><a href="../fr472312/index.html">Expérience de transfert d'un projet Maven vers Multi-Release Jar: déjà possible, mais toujours difficile</a></li>
<li><a href="../fr472314/index.html">J'aime les gens en carton</a></li>
<li><a href="../fr472318/index.html">Suivi distribué dans Istio</a></li>
<li><a href="../fr472320/index.html">Entretien avec Zabbix: 12 réponses franches</a></li>
<li><a href="../fr472326/index.html">Notre industrie spatiale ... Et si vous considérez les problèmes de l'industrie du point de vue d'un geek?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>