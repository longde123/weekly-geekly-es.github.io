<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìø üï† üòû Do ‚ÄúColor Extender para ZX-Spectrum‚Äù ao ZX-Poly ü•Ñ ‚ôëÔ∏è „Ä∞Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Color Extender for ZX-Spectrum" - este √© o t√≠tulo do artigo publicado no echo fido7.zx.spectrum em 3 de agosto de 1997. O artigo descreveu a id√©ia de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Do ‚ÄúColor Extender para ZX-Spectrum‚Äù ao ZX-Poly</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472232/"><p>  "Color Extender for ZX-Spectrum" - este √© o <em>t√≠tulo do</em> artigo publicado no echo <em>fido7.zx.spectrum</em> em 3 de agosto de 1997.  O artigo descreveu a id√©ia de resolver um dos principais problemas da plataforma ZX-Spectrum - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conflito de atributos</a> .  A publica√ß√£o despertou algum interesse naquele momento, e eu gostaria de falar sobre detalhes t√©cnicos e a hist√≥ria do problema. </p><br><p><img src="https://habrastorage.org/webt/ft/at/_v/ftat_vfl5fato4m_aobobohxfhm.png" alt="Logotipo ZX-Poly"></p><br><p>  N√£o vou me aprofundar nos detalhes t√©cnicos e apenas descrever estruturalmente a id√©ia e a solu√ß√£o. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Parte n√£o t√©cnica da hist√≥ria, voc√™ pode pular</b> <div class="spoiler_text"><p>  A hist√≥ria do desenvolvimento come√ßou no in√≠cio da primavera de 1994, quando o pa√≠s ainda vivia "mudan√ßas no rascunho", o que levou ao fechamento maci√ßo de adiamentos e ao apelo de estudantes de escolas profissionais e t√©cnicas.  Tive sorte - estive no meu √∫ltimo ano no Col√©gio Radiot√©cnico de Leningrado e, dessa forma, o Estado concordou em adiar a curto prazo o recebimento acelerado de um diploma com a substitui√ß√£o do design do diploma por um exame em todas as disciplinas.  Ele deixou o ex√©rcito em 1 de mar√ßo de 1994, como t√©cnico de r√°dio certificado. </p><br><p>  Nas for√ßas armadas da √©poca, havia um afluxo sem precedentes dos mesmos especialistas do n√≠vel t√©cnico m√©dio, embora isso arruinasse levemente o sistema de recrutamento outono-primavera na cabe√ßa dos "av√≥s", que j√° tinham uma classifica√ß√£o clara nos nomes, eles apelidaram de "goblin".  Entre os "estrondosos", havia muitas pessoas que gostavam do ZX-Spectrum e Alexander Gumin era assim na minha divis√£o (ele escreveu jogos no ZX-Spectrum sob o selo ANCCAN com Denis Markelov e ficou conhecido por sua adapta√ß√£o do Mortal Kombat para esta plataforma em 1997), com quem falar sobre programa√ß√£o e hardware. </p><br><p>  Mais perto de meados de abril de 1994, no final do "curso de jovens lutadores", Alexander e eu fomos transferidos para o batalh√£o de constru√ß√£o localizado em Strelna, um sub√∫rbio de S√£o Petersburgo.  L√° tivemos que dominar a dif√≠cil especialidade do cortador de cabos por v√°rios meses.  A vida nessa parte flu√≠a sem pressa e o estudo alternava com roupas, que na maioria das vezes esticavam as m√£os, mas davam ao c√©rebro tempo para reflex√£o.  Ent√£o, em uma das roupas da cozinha, no meu andar e pensando no ZX-Spectrum e suas capacidades, tive a id√©ia de como superar o "conflito de atributos". </p><br><p>  Eu ponderei essa id√©ia at√© o final do servi√ßo e fiquei cada vez mais convencido de que "poderia funcionar".  Infelizmente, a ideia da viabilidade da pr√≥pria plataforma, √† qual eu iria aplicar essa ideia, me visitou com menos frequ√™ncia.  No entanto, na R√∫ssia, o ZX-Spectrum brilhou mais vivamente no c√©u entre 1991 e 1996.  Alguns produtores russos de seus clones aumentaram tanto que patrocinaram programas de TV (por exemplo, a empresa Bi-Em patrocinou o programa "The Jungle's Name" por um tempo).  Mas durante o servi√ßo havia outros problemas, ent√£o decidi adiar todos os problemas relacionados ao com√©rcio at√© ser enviado para a reserva.  Periodicamente e sem revelar detalhes, eu estava interessado em v√°rios especialistas no t√≥pico de viabilidade t√©cnica e validade da abordagem.  Ele manteve a id√©ia em segredo profundo e nem a compartilhou com Alexander Gumin, apenas indicando-lhe vagamente que havia encontrado uma solu√ß√£o muito simples para aumentar o n√∫mero de cores, mantendo a compatibilidade com vers√µes anteriores. </p><br><p>  Tendo ingressado no ‚Äúcidad√£o‚Äù em 1997 e conseguido um emprego como engenheiro de software da segunda categoria na empresa de S√£o Petersburgo ‚ÄúTecnologias e modelos de informa√ß√£o‚Äù, comecei a me interessar um pouco pela quest√£o da comercializa√ß√£o da solu√ß√£o.  Por alguma raz√£o, eu tinha certeza de que, se apenas sugerisse a solu√ß√£o que encontrei, todos come√ßariam a rasgar com as m√£os e o dinheiro fluiria.  Comecei a telefonar para o conhecido, na √©poca, na √°rea de fabricantes e comerciantes de "Engenharia do espectro", como Sergey Zonov, Vyacheslav Skutin (Nemo) e outros.  Sergey Zonov simplesmente me disse que "o trem j√° partiu" e n√£o h√° mais sentido comercial nesse empreendimento.  Vyacheslav Skutin, sendo um spektrumist ortodoxo, ficou hostil com qualquer id√©ia em que tentassem mudar alguma coisa na plataforma e essa tamb√©m era uma vers√£o completamente morta.  Decidi que havia pouca conversa e pelo menos algo precisava ser feito, e era melhor come√ßar com um emulador para obter materiais promocionais e dados experimentais. </p><br><p>  Em 1998, tomando como base um dos emuladores ZX-Spectrum de c√≥digo aberto existentes na √©poca, escritos em Pascal, criei um emulador primitivo de quatro computadores trabalhando em paralelo.  Eu parcialmente adaptei o jogo After The War 2 para ele, colorindo alguns de seus sprites.  O sistema funcionou e, al√©m de aproveitar a ideia de trabalho, consegui capturas de tela √† minha disposi√ß√£o, confirmando a ideia de colorir jogos existentes. </p><br><p>  Em 1998, visitei a empresa Peters, que estava desenvolvendo sua nova plataforma Sprinter na √©poca.  Ele tentou interessar o diretor Nikolai Noskov.  Eles investiram pesadamente no novo desenvolvimento e, de acordo com a lei da maldade, a arquitetura super flex√≠vel do Sprinter, capaz de emular quase qualquer plataforma de processador √∫nico no Z80, n√£o podia estender quatro processadores.  No entanto, uma visita a essa empresa foi muito √∫til, pois ele se encontrou com o autor da plataforma Sprinter, Ivan Makarchenko, e aprendeu sobre novas oportunidades no campo do desenvolvimento de FPGA. </p><br><p>  Logo a crise de 1998 "murchava" e havia uma ing√™nua esperan√ßa de que o interesse no ZX-Spectrum pudesse reviver.  No in√≠cio de 1999, n√≥s (com meu parceiro na √©poca, Andrei Savichev) t√≠nhamos planos de criar o "Fundo Nacional do Espectro" e uma reuni√£o foi realizada sobre esse assunto no novo escrit√≥rio da mesma empresa de Peters.  Mas eles n√£o entram no mesmo rio duas vezes e, √© claro, nada aconteceu.  J√° em 1999, todas as id√©ias sobre o t√≥pico de implementa√ß√£o de hardware da plataforma foram descartadas (trabalhamos nesse desenvolvimento com Sergey Egorov, mas n√£o fomos al√©m dos esquemas).  At√© 2007, eu praticamente n√£o lidava com a plataforma, mas houve tempo e decidi reescrever o emulador e elaborar os detalhes da plataforma, verificando as abordagens e deixando-as "virtualmente". </p></div></div><br><p>  O modo de v√≠deo padr√£o ZX-Spectrum, exibe 256 por 192 pixels.  No modo monocrom√°tico, isso requer apenas 6144 bytes, o que representa aproximadamente 10% do campo total da mem√≥ria (contra 50% no BK-0010).  As informa√ß√µes de cores s√£o armazenadas em 768 bytes adicionais, localizados imediatamente ap√≥s os dados de pixel.  A paleta consiste em oito cores e dois tons.  A cor dos pixels iluminados e descartados √© determinada imediatamente para o bloco de 8 por 8 pixels e o matiz √© determinado imediatamente para a cor dos pixels iluminados e descartados. </p><br><p>  Parece colorido e uma quantidade relativamente pequena de dados √© enviada muito rapidamente, mas exige um esfor√ßo e arte incr√≠veis de artistas e programadores no desenvolvimento de jogos e protetores de tela coloridos.  A menor inconsist√™ncia no gr√°fico leva a um conflito de atributos.  A maioria dos desenvolvedores fez seu trabalho bem no cen√°rio BK-0010, com apenas quatro cores (mas para todos os pontos!), A quase-cor Spectrum parecia muito vantajosa e atual. </p><br><p><img src="https://habrastorage.org/webt/rb/wz/qv/rbwzqvjgroepwudiddfwnl9vhsi.png" alt="Exemplo de atributo ZX-Spectrum"></p><br><p>  Com o desenvolvimento da plataforma para o ZX-Spectrum 128, foi adicionada a capacidade de alternar o hardware entre duas p√°ginas de mem√≥ria de v√≠deo.  Os programadores encontraram rapidamente uma maneira de obter v√°rias cores usando uma mudan√ßa muito r√°pida das p√°ginas de v√≠deo exibidas e uma altera√ß√£o din√¢mica dos atributos de cores. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_aeNtFCaYt8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Por isso, foi poss√≠vel aumentar programaticamente a resolu√ß√£o da tela (o que √© perfeitamente mostrado, por exemplo, na demonstra√ß√£o "Dead Morose", onde ao mesmo tempo o texto √© executado com uma resolu√ß√£o de 256, 512 e 768 pontos horizontalmente). </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WHj4gBB612U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Por√©m, qualquer solu√ß√£o de software que exija um aumento no fluxo de informa√ß√µes de v√≠deo leva a um aumento no consumo do processador, o que √© muito cr√≠tico no caso de jogos din√¢micos.  N√£o havia fonte n√£o utilizada de reservas de energia de computa√ß√£o no sistema.  Tudo depende do processador no ZX-Spectrum e fornece uma pequena descarga, exceto talvez o processador de m√∫sica no campo dos efeitos sonoros. </p><br><p>  Minha id√©ia era que voc√™ poderia adicionar mais tr√™s processadores, lan√ßando em cada um deles o processamento de seus componentes de cores.  Os dados recebidos da mem√≥ria de v√≠deo de cada processador devem ser integrados, formando um valor YRGB <strong>para cada pixel</strong> .  Atributos de cores padr√£o s√£o ignorados.  O processamento paralelo de informa√ß√µes deve garantir que n√£o haja desempenho de flacidez. </p><br><p><img src="https://habrastorage.org/webt/fs/g3/yc/fsg3ycbdz2wwt7ysrtsfpeyms1a.png" alt="Esquema de n√∫cleos em ZX-Poly 256x192"></p><br><p>  N√£o posso dizer que era original na id√©ia, porque foi inspirado pela leitura do livro de tradu√ß√£o "The Computer Gains Mind" (Mir Publishing House, 1990), que descreveu uma certa plataforma gr√°fica da Pixar desenvolvida na Lucasfilm.  E, de acordo com o <abbr title="A teoria da solu√ß√£o inventiva de problemas, ou TRIZ, √© um conjunto de m√©todos para resolver problemas t√©cnicos e melhorar os sistemas t√©cnicos">TRIZ,</abbr> √© apenas uma transi√ß√£o de um monossistema para um polissistema. </p><br><p><img src="https://habrastorage.org/webt/lg/7d/1k/lg7d1ktwhzyxrnzzwt2yljv8qaw.png" alt="se√ß√£o da p√°gina do livro &quot;O computador ganha intelig√™ncia&quot;"></p><br><p>  Uma pergunta muito dolorosa para qualquer desenvolvimento - e quem escrever√° o programa?  (em particular, a plataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sprinter se</a> deparou com essa "armadilha").  No meu caso, o problema com o software foi resolvido automaticamente pelo fato de que raramente os programas existentes verificavam que tipo de dados eles gravavam na mem√≥ria de v√≠deo e simplesmente trabalhavam com eles "como um carteiro com uma carta selada".  De acordo com meus c√°lculos, verificou-se que a maioria dos programas de jogos existentes poderia sobreviver com facilidade √† adapta√ß√£o de seus dados de v√≠deo sem altera√ß√µes no c√≥digo execut√°vel.  Obviamente, jogos com um pacote de gr√°ficos ou otimiza√ß√µes internas em sua sa√≠da para a tela foram cortados.  A adapta√ß√£o de tais programas exigiria pesquisa e altera√ß√£o do c√≥digo execut√°vel.  O desenvolvimento de ROMs especializadas n√£o era necess√°rio. </p><br><p>  Eu acho que esse conceito √© aplic√°vel a qualquer plataforma dom√©stica antiga (por exemplo, AGAT, Radio86RK, BK-0010 etc.), onde n√£o h√° acelerador de v√≠deo dedicado e o processador trabalha diretamente com a mem√≥ria de v√≠deo para formar uma imagem. </p><br><p>  Na primeira vers√£o do emulador, acabei de fazer com que quatro ZX-Spectrum 48s funcionassem de forma s√≠ncrona. Mas o que √© f√°cil de simular no emulador √© muito dif√≠cil de repetir em hardware real.  √â bastante dif√≠cil garantir o carregamento de dados em quatro m√≥dulos de computa√ß√£o e iniciar de forma s√≠ncrona a partir do mesmo endere√ßo.  Uma solu√ß√£o semelhante que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spec256</a> apresenta para esse <abbr title="Instru√ß√£o √∫nica, dados m√∫ltiplos - fluxo de instru√ß√µes √∫nico, fluxo de dados m√∫ltiplos">SIMD</abbr> Z80 virtual especializado de 64 bits, que n√£o existe na natureza.  Como parte de uma solu√ß√£o mais realista (e mais complexa) para esse problema, a plataforma ZX-Poly foi formada. </p><br><h1 id="ot-cvetorasshiritelya-k-zx-poly">  Do ‚ÄúColor Extender‚Äù ao ZX-Poly </h1><br><h2 id="processornye-moduli">  M√≥dulos do processador </h2><br><p>  O ZX-Poly √© uma plataforma de computa√ß√£o baseada no ZX-Spectrum 128 contendo quatro m√≥dulos de processador.  Cada m√≥dulo possui suas pr√≥prias portas de E / S endere√ß√°veis ‚Äã‚Äãvis√≠veis externamente.  Embora os m√≥dulos do processador compartilhem os sinais de controle do sistema (RESET, NMI, CLK e INT), eles funcionam independentemente. </p><br><p><img src="https://habrastorage.org/webt/9r/na/nt/9rnantil7npmty1cnmtip6hdxvg.png" alt="Diagrama de blocos"></p><br><p>  Existe uma certa classifica√ß√£o, dependendo do √≠ndice do m√≥dulo - quanto menor o √≠ndice, maior a classifica√ß√£o, respectivamente, "m√≥dulo 0" √© o mestre no sistema.  O acesso de grava√ß√£o √†s portas do sistema do m√≥dulo √© permitido apenas para o m√≥dulo com classifica√ß√£o igual ou superior, n√£o h√° restri√ß√µes de leitura.  Isso foi feito porque havia pensamentos sobre o desenvolvimento de um sistema operacional especializado. </p><br><p><img src="https://habrastorage.org/webt/hz/wg/l9/hzwgl9ajm1vcyx_cycpsmh8c3uk.png" alt="Classifica√ß√£o dos m√≥dulos"></p><br><p>  Um detalhe muito importante √© que todos os dispositivos de processador usados ‚Äã‚Äãdevem ser do mesmo fabricante (e seria bom ter uma s√©rie de produ√ß√£o), pois a menor diferen√ßa em sua organiza√ß√£o interna ou otimiza√ß√£o pode violar a consist√™ncia do sistema. </p><br><p>  Imediatamente ap√≥s o in√≠cio do sistema, apenas o m√≥dulo mestre (CPU0) √© iniciado, os m√≥dulos restantes est√£o no modo WAIT, portanto, para o usu√°rio, tudo passa despercebido. </p><br><p>  No espa√ßo IO, o ZX-Poly adiciona as seguintes portas dispon√≠veis para grava√ß√£o e leitura: </p><br><ul><li>  porta de configura√ß√£o principal $ 3D00 </li><li>  m√≥dulo 0 - $ 00FF, $ 10FF, $ 20FF, $ 30FF </li><li>  m√≥dulo 1 - $ 01FF, $ 11FF, $ 21FF, $ 31FF </li><li>  m√≥dulo 2 - $ 02FF, $ 12FF, $ 22FF, $ 32FF </li><li>  m√≥dulo 3 - $ 03FF, $ 13FF, $ 23FF, $ 33FF </li></ul><br><p>  A principal porta de configura√ß√£o do ZX-Poly √© $ 3D00.  Somente o m√≥dulo mestre pode gravar nele, mas ele est√° dispon√≠vel para leitura em todos os m√≥dulos e cada uma de suas pr√≥prias informa√ß√µes especializadas √© retornada.  Em particular, um m√≥dulo pode descobrir seu √≠ndice, se sua mem√≥ria est√° mapeada para as portas de E / S do m√≥dulo principal, o deslocamento de sua mem√≥ria na pilha, etc.  Al√©m disso, a porta de configura√ß√£o da plataforma base $ 7FFD passou por pequenas altera√ß√µes, que usam bits n√£o utilizados no original. </p><br><h2 id="pamyat">  A mem√≥ria </h2><br><p>  Como na arquitetura original do ZX-Spectrum 128, existem ROM e RAM.  Se a organiza√ß√£o e o trabalho com a ROM praticamente n√£o mudaram, a RAM se transformou em um "heap" comum de 512 KB, no qual cada processador trabalha com uma janela dedicada de 128 KB (ou seja, 8 p√°ginas de 16 KB no ZX-Spectrum 128).  O deslocamento da janela pode ser alterado em incrementos de 64 Kb e todos os m√≥dulos do processador podem ser projetados para funcionar com uma parte de mem√≥ria total ou parcialmente sobreposta no heap.  A ROM pode ser desativada e a p√°gina RAM0 RAM ser√° conectada em seu lugar (isso permite criar uma vers√£o "colorida" do sistema operacional base, por exemplo, um int√©rprete b√°sico).  Ap√≥s uma redefini√ß√£o de hardware, todos os m√≥dulos recebem deslocamentos autom√°ticos para separar as janelas de mem√≥ria na pilha. </p><br><p>  O mestre do m√≥dulo processador (CPU0) tem a capacidade de mapear os espa√ßos de endere√ßo de outros m√≥dulos (CPU1-3) na √°rea de suas portas de E / S.  I.e.  ele pode gravar na porta, alterando o estado da c√©lula de mem√≥ria de um determinado m√≥dulo e, ao mesmo tempo, √© poss√≠vel gerar um sinal NMI em um m√≥dulo mapeado.  Ao ler as c√©lulas de mem√≥ria de um m√≥dulo mapeado, a gera√ß√£o INT √© poss√≠vel.  Isso foi feito para emular dispositivos virtuais usando os m√≥dulos 1-3. </p><br><h2 id="video-kontroller">  Controlador de v√≠deo </h2><br><p>  A principal ‚Äúcereja‚Äù √©, obviamente, um controlador de v√≠deo, tudo foi iniciado para isso.  No total, a plataforma suporta cinco modos de v√≠deo. </p><br><h3 id="video-rezhimy-zx-spectrum-128-mode-0123">  Modos de v√≠deo ZX-Spectrum 128 (modo 0,1,2,3) </h3><br><p>  Esses modos de v√≠deo n√£o s√£o dignos de nota e n√£o diferem em nada do modo de v√≠deo padr√£o do ZX-Spectrum 128. A p√°gina de v√≠deo atual do m√≥dulo de processador selecionado com colora√ß√£o de atributo √© exibida.  Imediatamente ap√≥s o in√≠cio do sistema, o modo 0 √© ativado, ou seja,  A p√°gina de v√≠deo do m√≥dulo mestre (CPU0) √© exibida. </p><br><p><img src="https://habrastorage.org/webt/1f/lk/vn/1flkvncwify4gom7fmw2zp-i77c.png" alt="ATW2 no modo ZX padr√£o"></p><br><h3 id="zx-poly-256x192-mode-4">  ZX-Poly 256x192 (modo 4) </h3><br><p>  Este modo de v√≠deo n√£o usa nenhum dado da √°rea de atributo.  O bit de pixel de cada m√≥dulo √© combinado com os dados de pixel de outros m√≥dulos e os quatro bits gerados s√£o usados ‚Äã‚Äãpara gerar um sinal YRGB de brilho de cor. </p><br><p>  Cada m√≥dulo √© respons√°vel por seu componente: </p><br><ul><li>  m√≥dulo 0 (mestre) para verde (verde). </li><li>  m√≥dulo 1 para vermelho (vermelho) </li><li>  m√≥dulo 2 para azul (azul) </li><li>  m√≥dulo 3 para brilho </li></ul><br><p><img src="https://habrastorage.org/webt/gy/kw/jx/gykwjxvnd5r_4967oxnlgo2z8gs.gif" alt="vers√£o colorida"></p><br><p>  Se voc√™ iniciar um jogo n√£o adaptado nesse modo, ele ser√° simplesmente preto e branco. <br><img src="https://habrastorage.org/webt/jt/_i/s4/jt_is4xsowghhld2aimz0dnpplc.png" alt="jogo n√£o adaptado"></p><br><h3 id="zx-poly-256x192-s-maskirovaniem-po-inkpaper-mode-6">  ZX-Poly 256x192 com m√°scara por INK + PAPER (modo 6) </h3><br><p>  Como o anterior, ele fornece 16 cores para cada ponto, mas h√° um "truque".  Em alguns programas do ZX-Spectrum, os elementos gr√°ficos s√£o ocultos usando os valores id√™nticos de INK e PAPER nos atributos, especialmente em jogos de rolagem.  Se voc√™ remover esta oportunidade, os elementos gr√°ficos come√ßar√£o a se acumular na tela, quebrando a imagem.  Portanto, o estado de TINTA e PAPEL √© analisado a partir do atributo do m√≥dulo mestre lido na mem√≥ria de v√≠deo (CPU0) e, se forem id√™nticos, todos os pontos ser√£o destacados com a cor retirada de TINTA / PAPEL (√© claro, levando em considera√ß√£o o brilho). </p><br><p><img src="https://habrastorage.org/webt/ol/sy/26/olsy265bag3_dg_bnxl-grzsjlq.gif"></p><br><h3 id="zx-poly-256x192-s-maskirovaniem-po-flashinkpaper-mode-7">  ZX-Poly 256x192 com m√°scara por FLASH + TINTA + PAPEL (modo 7) </h3><br><p>  Mode √© uma combina√ß√£o dos modos 4 e 6. Para os atributos leg√≠veis do m√≥dulo mestre (CPU0), o bit FLASH √© analisado e, se estiver definido (o que √© raro em jogos din√¢micos no campo de jogo), o bloco 8 por 8 pixels √© exibido no modo 6 ( com m√°scara com TINTA e PAPEL id√™nticos).  Se o FLASH for reiniciado, o bloco ser√° exibido como em um ZX-Spectrum comum.  O bit FLASH n√£o √© praticado em sua fun√ß√£o direta e n√£o pisca. <br>  Esse modo √© muito conveniente para evitar redesenhar os pain√©is de informa√ß√µes do jogo e alguns efeitos no jogo (por exemplo, quando os desenvolvedores de jogos piscam no campo de jogo por meio de atributos). </p><br><p><img src="https://habrastorage.org/webt/cs/fr/cv/csfrcvh0rtury8g_9g20t1xoecm.gif" alt="Flying shark animado adaptado"></p><br><h3 id="zx-poly-512x384-s-atributami-mode-5">  ZX-Poly 512x384 com atributos (modo 5) </h3><br><p>  Os atributos s√£o usados ‚Äã‚Äãquase da mesma maneira que na plataforma original, sem nenhuma altera√ß√£o (mesmo o bit FLASH).  Os dados de pixel de v√≠deo de cada m√≥dulo s√£o coloridos com um atributo da mem√≥ria de v√≠deo deste m√≥dulo e, ap√≥s passar pela colora√ß√£o, s√£o exibidos em um padr√£o quadriculado, devido ao qual um bloco de familiaridade √© de 16 por 16 pontos. </p><br><p><img src="https://habrastorage.org/webt/5i/gv/cl/5igvcljru-gbuybss377ujcbbr0.png" alt="forma√ß√£o de xadrez"></p><br><p>  Este modo permite dobrar a resolu√ß√£o dos aplicativos, sem alterar o c√≥digo execut√°vel.  √â verdade que experimentos com o mesmo jogo "Pin√≥quio" mostraram que em jogos brilhantes com grandes detalhes, o efeito ser√° pouco percept√≠vel.  Como esses s√£o pixels virtuais, os jogos n√£o sabem nada sobre isso e o movimento m√≠nimo poss√≠vel dos elementos do jogo √© no n√≠vel de dois pixels virtuais.  Eu acho que esse modo √© bom para jogos com pequenos objetos de jogo em um local familiar. </p><br><p><img src="https://habrastorage.org/webt/o4/25/hk/o425hkbmpkl00uju8aaon-_siui.png" alt="exemplo do jogo &quot;Pin√≥quio&quot;"></p><br><p>  Um efeito muito melhor nesse modo de v√≠deo foi obtido em aplicativos de texto, por exemplo, no editor de texto ZX-Word, onde apenas a fonte foi processada sem altera√ß√µes no c√≥digo execut√°vel. </p><br><p><img src="https://habrastorage.org/webt/xd/ol/li/xdollinm5mle6snma7prgemgyyw.gif" alt="ZX-Word adaptado"></p><br><h2 id="mnogozadachnost">  Multitarefa </h2><br><p>  Apesar de os processadores do sistema usarem a mesma fonte de sinais de controle, eles funcionam de forma independente.  O sistema n√£o pode ser chamado de <abbr title="Single Instruction, Multiple Data -   ,   ">SIMD de</abbr> pleno direito, j√° que cada processador processa instru√ß√µes de seu pr√≥prio bloco de mem√≥ria, simplesmente aproveita a capacidade de "palm off" as mesmas instru√ß√µes.         ,  "  "        ‚Äî  . </p><br><p><img src="https://habrastorage.org/webt/gp/yg/5k/gpyg5khuq7hn9jvvbgny5hddqrs.png" alt="Exemplo fora de sincroniza√ß√£o"></p><br><p>          ,     ,         "".  ,     . </p><br><h2 id="mehanizmy-sinhronizacii">   </h2><br><h3 id="lokalnyy-reset">  RESET </h3><br><p>       RESET    ,            .     JP ADDR          . </p><br><h3 id="stop-adres"> - </h3><br><p>       master- (CPU0).       ,      (   M1),      <strong></strong>  WAIT,                RESET.       ,   ,   16     . </p><br><h1 id="emulyator-sistemy">   </h1><br><p>  2007  JavaSE     .        Z80 (      -)  FDD  181893.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JDK 1.8+</a> . </p><br><p><img src="https://habrastorage.org/webt/0m/qa/rp/0mqarpebzf0p9ewtwkojknscb_u.png" alt="Janela do emulador"></p><br><p>            ZX-Spectrum        ,  80%   ,    .         ZX-Spectrum 128,      <strong>Options-&gt;ZX 128 Mode</strong> ,    ZX-Poly      . </p><br><p>       -,    ZX-Spectrum ‚Äî   .      ,    <strong>File-&gt;Options</strong> </p><br><p><img src="https://habrastorage.org/webt/re/3a/er/re3aerw3r_zksnkvghxn35u3n2w.gif" alt="ROM de teste ZX-Poly"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se os jogos n√£o usarem pacotes de sprites, a colora√ß√£o ser√° bem simples. </font><font style="vertical-align: inherit;">√â preciso ter cuidado quando houver otimiza√ß√µes no c√≥digo execut√°vel de sa√≠da do sprite, pois isso pode levar √† dessincroniza√ß√£o dos m√≥dulos do processador.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um gerenciador de inicializa√ß√£o foi desenvolvido para carregar dados nos m√≥dulos a partir de um disco e iniciar simultaneamente simultaneamente. </font><font style="vertical-align: inherit;">Seu c√≥digo para TAP e TR-DOS √© apresentado no projeto.</font></font></p><br><p><img src="https://habrastorage.org/webt/_o/py/bv/_opybvhjgijkprgwb2lyaipdpy4.gif" alt="Exemplo de opera√ß√£o do carregador de inicializa√ß√£o"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Juntamente com o emulador, um pequeno utilit√°rio (tamb√©m escrito em Java) para aplicativos de colora√ß√£o foi desenvolvido. </font></font></p><br><p><img src="https://habrastorage.org/webt/3b/dg/fa/3bdgfacgkovaenmlf1ewkcoiriw.png" alt="Corretor de Sprite ZX-Poli"></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo o projeto √© publicado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sob a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licen√ßa GNU GPLv3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br><p> <a href=""><img src="https://habrastorage.org/webt/xr/1n/zx/xr1nzxg1xx9xmbv0hzgdas_dmu4.png"></a> <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472232/">https://habr.com/ru/post/pt472232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472222/index.html">‚ÄúLeia se voc√™ gosta de ouvir‚Äù: livros para quem n√£o √© indiferente √† m√∫sica - do cl√°ssico ao hip-hop</a></li>
<li><a href="../pt472224/index.html">Usando o novo NVMe SSD como um disco de inicializa√ß√£o em sistemas mais antigos com o Legacy BIOS (para qualquer sistema operacional)</a></li>
<li><a href="../pt472226/index.html">Melhorando os controles de formul√°rio no Microsoft Edge e Chromium</a></li>
<li><a href="../pt472228/index.html">9 truques para trabalhar com o c√≥digo do Visual Studio</a></li>
<li><a href="../pt472230/index.html">Chips para ML - fale sobre novos produtos</a></li>
<li><a href="../pt472234/index.html">Criptomoeda: ainda √© um freeloader ou um parceiro?</a></li>
<li><a href="../pt472240/index.html">Sobre gamification. O que √©, por que e como faz√™-lo? Apar√™ncia do desenvolvedor</a></li>
<li><a href="../pt472242/index.html">Aceleramos o agendador Tokio dez vezes</a></li>
<li><a href="../pt472246/index.html">React + IndexDb + atualiza√ß√£o autom√°tica = quase AsyncRedux</a></li>
<li><a href="../pt472248/index.html">Como fundimos a programa√ß√£o final do IT-Planet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>