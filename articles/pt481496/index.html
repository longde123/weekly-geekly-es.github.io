<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ô†Ô∏è üö© üî§ Ataque DDoS atrav√©s da engenharia social üë®üèæ‚Äçüç≥ ‚úãüèΩ üõµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR O invasor substitui o IP de origem pelo endere√ßo do seu servidor e aciona abusos autom√°ticos. Como resultado, o cliente √© banido da hospedagem ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ataque DDoS atrav√©s da engenharia social</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/481496/"><img src="https://habrastorage.org/webt/i6/x7/om/i6x7omrejaehro4mws5isygnptk.jpeg"><br><br>  <b>TL; DR O invasor substitui o IP de origem pelo endere√ßo do seu servidor e aciona abusos autom√°ticos.</b>  <b>Como resultado, o cliente √© banido da hospedagem por atividades maliciosas que n√£o estavam l√°.</b> <br><br><blockquote>  <b>Comentado por <a href="https://vdsina.ru/%3Fpartner%3Dhabr2">vdsina.ru</a> :</b> <br>  <i>Este artigo foi escrito por nosso cliente, que nos passou de um grande hoster ap√≥s um ataque de DDoS e concordou em compartilhar essa hist√≥ria.</i> </blockquote><br>  Vou falar sobre uma maneira surpreendentemente insidiosa de ataques DDoS, que eu nunca encontrei antes.  O insidioso √© que nenhum ataque √© realizado no pr√≥prio servidor da v√≠tima.  Em vez disso, o invasor provoca a opera√ß√£o de sistemas de detec√ß√£o de ataques de terceiros, for√ßando a gerar reclama√ß√µes completamente reais (nas pessoas comuns "abusos") ao seu servidor. <br><br>  Do lado do hoster, parece que voc√™ est√° envolvido em atividades maliciosas, embora na verdade isso n√£o seja verdade.  Acontece que muitos grandes provedores de hospedagem n√£o est√£o prontos para entender profundamente as causas do problema e preferem simplesmente bani-lo por violar as regras. <br><br>  Este artigo detalha esse tipo de ataque em um caso real. <br><a name="habracut"></a><br><h2>  Linha do tempo </h2><br>  Eu mantive v√°rios projetos pessoais em servidores VPS em um host conhecido.  Uma vez recebi uma carta dele: <br><br><blockquote>  <b># 9042382: Viola√ß√£o de ToS - atividade maliciosa</b> <br>  Ol√° <br><br>  Recebemos um relat√≥rio de atividade maliciosa origin√°ria do seu servidor XXXX.  Pedimos que voc√™ investigue esse assunto assim que puder.  Depois de concluir sua investiga√ß√£o, responda a este ticket com as respostas para as seguintes perguntas: <br>  ... <br><pre><code class="plaintext hljs">Reported-From: abuse-out@checkdomain.de Category: info Report-Type: info Service: different services Version: 0.1 User-Agent: Checkdomain Express 0.19 Date: Fri, 26 May 2018 19:25:19 +0200 Source-Type: ipv4 Source: my-server-ip-xx-xxx Port: dif. Report-ID: dih3cefnp@checkdomain.de Schema-URL: http://www.blocklist.de/downloads/schema/info_0.1.1.json Attachment: text/plain DETAILS ZU DEN ATTACKEN/ST√ñRUNGEN | DETAILS OF THE ATTACKS (letzten 60 Tage / max. 100 St.) | (last 60 days / max. 100 hits) portflood: syn | | standby.checkdomain.de | VORHERIGE SPERREN DER IP-NUMMER | BANNED HISTORY OF THIS IP-NUMBER my-server-ip-xxx-xxx-xxx: this ip-number was never banned before AUZUG AUS SERVERLOGDATEI | EXCERPT FROM SERVER LOGFILE tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:41667 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:46208 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:13000 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:39104 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:55348 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:37266 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:60684 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:63878 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:50445 SYNRECV - tcp 0 0 85.10.207.190:80 my-server-ip-xx-xxx:56215 SYNRECV -</code> </pre> <br></blockquote><br>  Onde <b>my-server-ip-xx-xxx</b> √© o endere√ßo IP do servidor. <br><br>  Nele, o hoster me envia uma reclama√ß√£o recebida em sua caixa de abuso @ e pede urgentemente para interromper a atividade maliciosa, caso contr√°rio, eu serei bloqueado.  O log anexado mostra uma lista de conex√µes TCP com a porta 80 (HTTP) no estado SYN RECEIVED.  Ou seja, do meu servidor h√° uma inunda√ß√£o SYN no servidor da web de algu√©m. <br><br>  Meu primeiro pensamento √© que eles me invadiram e o SYN flood vem do meu servidor.  No Linux, h√° restri√ß√µes no gerenciamento de soquetes com direitos normais de usu√°rio e voc√™ pode enviar apenas pacotes SYN (sem estabelecer uma conex√£o TCP completa) apenas com privil√©gios de root.  E isso significa que eles racharam completamente. <br><br>  Em p√¢nico, corro para o servidor para procurar um processo malicioso.  Verifico top, ss, lsof e n√£o vejo nada suspeito.  A principal conclus√£o: " <i>horror, eles provavelmente inundaram um rootkit t√£o legal que esconde o v√≠rus no n√≠vel do kernel de todos os utilit√°rios do sistema!</i> ".  No processo de pesquisa, verifica-se que a carga no servidor n√£o mudou, de acordo com os gr√°ficos no painel do host, o tr√°fego na interface permanece o mesmo. <br><br>  Antes disso, iniciei o <b>tcpdump</b> com filtros que mostravam tr√°fego de sa√≠da e n√£o via nada suspeito.  Desesperado, decido ver todo o tr√°fego para o servidor.  Encontro pacotes raros de RST de servidores estranhos no fluxo de tr√°fego leg√≠timo. <br><br>  Parece algo assim, onde <b>my-server-ip-xx-xxx √© o</b> endere√ßo do meu servidor: <br><br><pre> <code class="plaintext hljs">IP 85.10.207.190.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP 85.10.207.190.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP 85.10.207.190.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP adsl-070-154.sip.pns.bellsouth.net.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP adsl-070-154.sip.pns.bellsouth.net.http &gt; my-server-ip-xx-xxx.8389: Flags [R] IP adsl-070-154.sip.pns.bellsouth.net.http &gt; my-server-ip-xx-xxx.8389: Flags [R]</code> </pre><br>  Era √≥bvio que isso era uma anomalia, j√° que n√£o havia mais troca com esses servidores e por que eles enviaram um pacote para fechar a conex√£o, n√£o estava claro para mim. <br>  Nesse ponto, administradores experientes entenderiam tudo imediatamente, mas resolveremos tudo isso por nossos dedos <br><br><h2>  Como isso funciona </h2><br>  Pacotes RST recebidos s√£o respostas a tentativas de estabelecer uma conex√£o TCP com uma porta privada.  Ao mesmo tempo, n√£o h√° tr√°fego de sa√≠da do meu servidor para os servidores que enviam RST.  Isso significa que o invasor substitui o endere√ßo de sa√≠da pelo meu e gera tr√°fego semelhante a um ataque DDoS.  Mas como a √∫nica coisa que um invasor pode fazer √© enviar um pacote de sa√≠da, todas as respostas dos servidores chegam ao meu servidor. <br><br><img src="https://habrastorage.org/webt/nd/g7/a-/ndg7a-fdzrxswv3sjvd8jwvykym.png"><br>  <font color="999999"><sup>Somente respostas a solicita√ß√µes falsas chegam ao servidor da v√≠tima</sup></font> <br><blockquote>  Normalmente, esses ataques s√£o usados ‚Äã‚Äãpara <a href="https://www.cloudflare.com/learning/ddos/dns-amplification-ddos-attack/">amplifica√ß√£o do DNS</a> , quando o invasor envia uma pequena solicita√ß√£o em nome da v√≠tima e a v√≠tima recebe uma grande resposta que n√£o solicitou.  Este √© um mecanismo cl√°ssico de ataque por exaust√£o de canal. </blockquote>  No meu caso, o invasor n√£o pretendeu esgotar o canal do servidor v√≠tima.  Sua atividade era completamente invis√≠vel nos gr√°ficos de consumo do canal.  Seu principal objetivo era provocar sistemas de notifica√ß√£o autom√°tica de ataques √† rede que enviariam uma carta reclamando do endere√ßo de abuso especificado na sub-rede whois do meu provedor.  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BE%25D0%25B1%25D0%25BD%25D0%25B0%25D1%2580%25D1%2583%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B2%25D1%2582%25D0%25BE%25D1%2580%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">Sistemas intrusivos de preven√ß√£o / detec√ß√£o</a> , como <a href="https://www.snort.org/">Snort</a> e <a href="https://suricata-ids.org/">Suricata, podem fazer isso</a> . <br><br>  Como resultado, o hoster recebe uma carta absolutamente real de empresas leg√≠timas, que cont√©m uma reclama√ß√£o sobre minha atividade maliciosa e at√© mesmo os registros reais nelas.  Ao mesmo tempo, o invasor n√£o precisa de um canal grande, pois conhece com anteced√™ncia os endere√ßos dos servidores nos quais os sistemas IDS / IPS est√£o instalados e o n√∫mero m√≠nimo necess√°rio de pacotes para que a reclama√ß√£o autom√°tica funcione. <br><br>  A √∫nica dificuldade para um invasor √© encontrar um servidor que permita a substitui√ß√£o de endere√ßos IP de sa√≠da em pacotes.  Todos os hosters normais bloqueiam esses pacotes.  Existem apenas dois tipos de hospedagem, permitindo que os clientes substituam o IP de sa√≠da: muito analfabetos configurados ou especialmente criados para crimes cibern√©ticos. <br><br><h2>  Verificando a possibilidade de falsifica√ß√£o de endere√ßo IP </h2><br>  Aconselho que voc√™ verifique seu host quanto √† possibilidade de substituir o IP de sa√≠da.  Isso exigir√° dois servidores, um para receber tr√°fego e outro para enviar. <br><br>  No lado do servidor receptor, come√ßaremos a registrar o tr√°fego recebido.  Vamos especificar uma porta rara como um filtro no qual n√£o deve haver tr√°fego em hor√°rios normais: <br><br><pre> <code class="plaintext hljs">tcpdump -i any port 9912</code> </pre><br>  No servidor que estamos testando, geraremos um pacote com a substitui√ß√£o do endere√ßo IP de sa√≠da para <b>1.1.1.1</b> , direcionado √† porta 9912. Para isso, usamos o utilit√°rio cool <a href="https://nmap.org/nping/">nping</a> dos desenvolvedores do nmap.  Permite gerar pacotes n√£o-padr√£o nos n√≠veis L2 e L3. <br><br><pre> <code class="plaintext hljs">nping --tcp -p 9912 -S 1.1.1.1 receiver-server.com</code> </pre><br>  <b>receiver-server.com</b> - o endere√ßo do servidor de escuta executando tcpdump <br>  <b>1.1.1.1</b> - endere√ßo de sa√≠da substituto <br>  <b>9912</b> - Porta Remota <br><br>  Se no lado de <b>receiver-server.com</b> voc√™ vir um pacote fornecido em nome do 1.1.1.1, seu provedor permitir√° que voc√™ substitua o endere√ßo IP de sa√≠da.  Esta √© uma ocasi√£o para inform√°-lo sobre problemas na instala√ß√£o de equipamentos de rede.  Geralmente, esse problema √© afetado pelos provedores de servi√ßos de Internet dom√©sticos. <br><br><h2>  Suporte t√©cnico est√∫pido </h2><br><br>  Tendo descoberto as raz√µes das queixas, eu detalhei tudo ao hoster: <br><blockquote>  Ol√° <br>  Finalmente entendo o que aconteceu. <br><br>  Eles falsificam meu endere√ßo IP e hosts aleat√≥rios DDoS usando meu endere√ßo como endere√ßo de origem.  Portanto, as v√≠timas geram relat√≥rios autom√°ticos de abuso aos meus provedores de hospedagem. <br><br>  Voc√™ pode ver no log de abuso que as conex√µes est√£o apenas no estado SYN_RECV (nenhuma conex√£o TCP completa estabelecida) porque eles podem enviar apenas um pacote usando IP falsificado e n√£o podem concluir o handshake TCP. <br>  Eu posso provar isso.  H√° muitos pacotes de entrada TCP RST chegando agora ao meu servidor a partir de hosts para os quais nunca enviei nenhum pacote. <br><br>  Voc√™ pode verific√°-lo agora executando: <br><br>  tcpdump -i eth0 "tcp [tcpflags] &amp; (tcp-rst)! = 0" <br><br>  Voc√™ ver√° que muitos pacotes RST vieram de hosts para os quais nunca enviei dados. <br>  Isso prova que o invasor est√° falsificando meu endere√ßo IP para me comprometer e gerar abusos. <br></blockquote><br>  Pareceu-me que qualquer engenheiro de suporte t√©cnico qualificado entenderia a situa√ß√£o e a quest√£o seria encerrada.  Mas, em vez disso, exigiram que eu verifique o servidor com software antiv√≠rus ou reinstale completamente o sistema operacional.  Enquanto nos correspond√≠amos com o suporte t√©cnico, os abusos continuaram chegando e em um dia fui banido. <br><br>  Foi um insulto desagrad√°vel o fato de eu ter sido enquadrada.  Essa situa√ß√£o mostra como as pessoas s√£o vulner√°veis, que, em vez de entender, seguem impensadamente os scripts.  Desde ent√£o, cito esse caso como um exemplo quando surge o debate sobre a escolha de uma hospedagem para projetos importantes.  Infelizmente, muitas empresas de hospedagem simplesmente n√£o podem se dar ao luxo de dedicar muito tempo a casos n√£o-padr√£o de pequenos clientes e √© mais f√°cil bani-lo do que resolver seus problemas. <br><br> <a href="https://vdsina.ru/%3Fpartner%3D7d159c89hz"><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Inscreva-se no nosso desenvolvedor do Instagram </h3><br> <a href="http://bit.ly/34w4T9B"><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt481496/">https://habr.com/ru/post/pt481496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt481482/index.html">Postagem cruzada em uma p√°gina do Facebook usando o PHP SDK</a></li>
<li><a href="../pt481486/index.html">‚ÄúContinuando vivo, permanecendo vivo‚Äù: o novo protocolo aumentar√° o raio do poss√≠vel uso de Wi-Fi em 60 metros</a></li>
<li><a href="../pt481488/index.html">Como oficiais da Regi√£o de Moscou medem a polui√ß√£o do ar</a></li>
<li><a href="../pt481490/index.html">Vitamina D. Uma curta excurs√£o</a></li>
<li><a href="../pt481492/index.html">Colecionamos m√∫sicas coloridas para o Ano Novo</a></li>
<li><a href="../pt481500/index.html">Programador fan√°tico. Parte abstrata 3 + tabela abstrata. Planejamento e seixo em um balde de √°gua</a></li>
<li><a href="../pt481502/index.html">Introdu√ß√£o √†s a√ß√µes do GitHub</a></li>
<li><a href="../pt481506/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel n¬∫ 327 (de 16 a 22 de dezembro)</a></li>
<li><a href="../pt481510/index.html">Otimiza√ß√£o do Unity: como a hierarquia de cenas o rouba</a></li>
<li><a href="../pt481514/index.html">Trabalhando com a biblioteca Newtonsoft.Json com um exemplo real. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>