<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà¥ ‚óæÔ∏è üë¥ Pizza ala semi-supervisada üëú üëàüèª ü§æüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, me gustar√≠a hablar sobre algunas t√©cnicas para trabajar con datos al entrenar un modelo. En particular, c√≥mo extraer la segmentaci√≥n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pizza ala semi-supervisada</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/422873/">  En este art√≠culo, me gustar√≠a hablar sobre algunas t√©cnicas para trabajar con datos al entrenar un modelo.  En particular, c√≥mo extraer la segmentaci√≥n de los objetos en las cajas, as√≠ como c√≥mo entrenar al modelo y obtener el marcado del conjunto de datos, marcando solo unas pocas muestras. <br><img src="https://habrastorage.org/webt/wo/lz/ab/wolzab2hx3sxc7qnqrmrucfhynk.png"><br><a name="habracut"></a><br><h2>  Desaf√≠o </h2><br>  Hay un cierto proceso de hacer pizza y fotos de sus diversas etapas (incluida no solo pizza).  Se sabe que si la receta de masa se echa a perder, habr√° granos blancos en la corteza.  Tambi√©n hay una marca binaria de la calidad de la prueba para cada instancia de pizza, hecha por expertos.  Es necesario desarrollar un algoritmo que determine la calidad de la prueba de acuerdo con la fotograf√≠a. <br><br>  El conjunto de datos consta de fotograf√≠as tomadas desde diferentes tel√©fonos, en diferentes condiciones, diferentes √°ngulos.  Instancias de pizza - 17k.  Fotos totales - 60k. <br><br>  En mi opini√≥n, la tarea es bastante t√≠pica y adecuada para mostrar diferentes enfoques para el manejo de datos.  Para resolverlo, debes: <br><br>  1. Elija fotos donde haya una masa de pizza; <br>  2. En las fotos seleccionadas, resalte el pastel; <br>  3. Entrene la red neuronal en las √°reas seleccionadas. <br><br><h2>  Filtrando fotos </h2><br>  A primera vista parece que la forma m√°s f√°cil ser√≠a dar esta tarea a los redactores, y luego entrenar el conjunto de datos en datos limpios.  Sin embargo, decid√≠ que era m√°s f√°cil para m√≠ marcar una peque√±a parte yo mismo que explicarle a un escriba qu√© √°ngulo era el correcto.  Adem√°s, no ten√≠a un criterio dif√≠cil para el √°ngulo correcto. <br><br>  Entonces, esto es lo que hice: <br><br>  1. Marcado 100 fotos de borde; <br><br><img src="https://habrastorage.org/webt/r3/_e/po/r3_epoxo9v9p_e0aljlsnqcdgge.png"><br><br>  2. Calcul√© las caracter√≠sticas despu√©s de la extracci√≥n global de la cuadr√≠cula resnet-152 con pesos de imagenet11k_places365; <br><br><img src="https://habrastorage.org/webt/im/my/0c/immy0cck12em7iyx24yrxyzubwy.png"><br><br>  3. Tom√≥ el promedio de caracter√≠sticas de cada clase, recibiendo dos anclas; <br><br>  4. Calcul√© la distancia desde cada ancla a todas las caracter√≠sticas de las 50k fotos restantes; <br><br>  5. Los 300 superiores en proximidad a un ancla son relevantes para la clase positiva, los 500 superiores m√°s cercanos al otro ancla son negativos; <br><br><img src="https://habrastorage.org/webt/ga/wn/xn/gawnxnw_jio9rg8yboqzqb3rmac.png"><br><br>  6. Entren√© a LightGBM en estas muestras con las mismas caracter√≠sticas (XGboost se indica en la imagen, porque tiene un logotipo y es m√°s reconocible, pero LightGBM no tiene un logotipo); <br><br>  7. Usando este modelo, obtuve el marcado de todo el conjunto de datos. <br><br><img src="https://habrastorage.org/webt/bd/vb/rq/bdvbrqhqcf5crt3scgwhw5zttms.png"><br><br>  Utilic√© aproximadamente el mismo enfoque en las competencias de kaggle como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea de base</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Una explicaci√≥n en los dedos de por qu√© este enfoque incluso funciona</b> <div class="spoiler_text">  Una red neuronal se puede percibir como una transformaci√≥n fuertemente no lineal de una imagen.  En el caso de la clasificaci√≥n, la imagen se convierte en las probabilidades de las clases que estaban en el conjunto de entrenamiento.  Y estas probabilidades se pueden usar esencialmente como caracter√≠sticas para Light GBM.  Sin embargo, esta es una descripci√≥n bastante pobre, y en el caso de la pizza, diremos que la clase de pastel es condicionalmente 0.3 gatos y 0.7 perros, y la basura es el resto.  En cambio, puede usar caracter√≠sticas menos dispersas despu√©s de la Agrupaci√≥n promedio global.  Tienen una propiedad tal que las caracter√≠sticas se generan a partir de las muestras del conjunto de entrenamiento, que deben estar separadas por una transformaci√≥n lineal (una capa completamente conectada con Softmax).  Sin embargo, debido al hecho de que no hab√≠a una pizza expl√≠cita en el tren imagenet, es mejor realizar una transformaci√≥n no lineal en forma de √°rboles para separar las clases del nuevo conjunto de entrenamiento.  En principio, puede ir a√∫n m√°s lejos y tomar caracter√≠sticas de algunas capas intermedias de la red neuronal.  Ser√°n mejores porque todav√≠a no han perdido la localidad de los objetos.  Pero son mucho peores debido al tama√±o del vector de caracter√≠sticas.  Y adem√°s, son menos lineales que frente a una capa totalmente conectada. <br></div></div><br><h2>  Una ligera digresi√≥n </h2><br>  ODS recientemente se quej√≥ de que nadie escribe sobre sus fallas.  Corrigiendo la situaci√≥n.  Hace aproximadamente un a√±o, particip√© en la competencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kaggle Sea Lions</a> con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Eugene Nizhibitsky</a> .  La tarea consist√≠a en contar los lobos marinos en las im√°genes del dron.  El marcado se dio simplemente en forma de coordenadas de canal, pero en alg√∫n momento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Iglovikov los</a> marc√≥ con cajas y lo comparti√≥ generosamente con la comunidad.  En ese momento, me consideraba un padre de segmentaci√≥n sem√°ntica (despu√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kaggle Dstl</a> ) y decid√≠ que Unet facilitar√≠a enormemente la tarea de contar si aprend√≠a a distinguir cl√°sicamente a los gatos. <br><br><div class="spoiler">  <b class="spoiler_title">Explicaci√≥n de la segmentaci√≥n sem√°ntica.</b> <div class="spoiler_text">  La segmentaci√≥n sem√°ntica es esencialmente una clasificaci√≥n p√≠xel por p√≠xel de una imagen.  Es decir, cada p√≠xel fuente de la imagen debe asociarse con una clase.  En el caso de la segmentaci√≥n binaria (caso del art√≠culo), ser√° una clase positiva o negativa.  En el caso de la segmentaci√≥n multiclase, a cada p√≠xel se le asignar√° una clase del conjunto de entrenamiento (fondo, hierba, gato, hombre, etc.).  En el caso de la segmentaci√≥n binaria, la arquitectura de red neuronal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">U-net</a> funcionaba bien en ese momento.  Esta red neuronal es similar en estructura a un codificador-decodificador convencional, pero con reenv√≠o de caracter√≠sticas desde la parte del codificador al decodificador en las etapas de tama√±o apropiado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cdf/52f/999/cdf52f99903a93bd403db1b073f19ba0.png"><br><br>  Sin embargo, en forma de vainilla, ya nadie lo usa, pero al menos agregan Batch Norm.  Bueno, como regla general, toman un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">codificador gordo</a> e inflan el decodificador.  Las arquitecturas similares a U-net han sido reemplazadas por nuevas cuadr√≠culas de segmentaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FPN</a> , que muestran un buen rendimiento en algunas tareas.  Sin embargo, las arquitecturas similares a Unet no han perdido su relevancia hasta el d√≠a de hoy.  Funcionan bien como l√≠nea base, son f√°ciles de entrenar y es muy simple variar la profundidad / tama√±o de la neurociencia cambiando diferentes eccoders. <br></div></div><br>  En consecuencia, comenc√© a ense√±ar segmentaci√≥n, teniendo como objetivo en la primera etapa solo gatos de boxeo.  Despu√©s de la primera etapa de entrenamiento, predije el tren y mir√© c√≥mo se ven las predicciones.  Con la ayuda de la heur√≠stica, se podr√≠a seleccionar la confianza abstracta de la m√°scara y dividir condicionalmente las predicciones en dos grupos: donde todo es bueno y donde todo es malo. <br><br><img src="https://habrastorage.org/webt/wx/84/jt/wx84jttvncmdiykyt25csspnyec.png"><br><br>  Las predicciones donde todo est√° bien podr√≠an usarse para entrenar la pr√≥xima iteraci√≥n del modelo.  Las predicciones, donde todo es malo, podr√≠an elegirse con grandes √°reas sin sellos, manos enmascaradas y tambi√©n arrojadas al tren.  Y de manera iterativa, Eugene y yo entrenamos un modelo que incluso aprendi√≥ a segmentar aletas de lobo marino para individuos grandes. <br><br><img src="https://habrastorage.org/webt/_a/g6/xz/_ag6xzccipgeizeek1qnncwxz4k.png"><br><br>  Pero fue un fracaso feroz: pasamos mucho tiempo aprendiendo a segmentar gatos geniales y ... Casi no ayud√≥ en su c√°lculo.  La suposici√≥n de que la densidad de los sellos (el n√∫mero de individuos por unidad de √°rea de la m√°scara) es constante no funcion√≥, porque el dron vol√≥ a diferentes alturas y las im√°genes ten√≠an diferentes escalas.  Y al mismo tiempo, la segmentaci√≥n a√∫n no distingu√≠a a los individuos individuales si se manten√≠an apretados, lo que suced√≠a con bastante frecuencia.  Y antes del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enfoque innovador para la separaci√≥n de los objetos</a> del equipo Tocoder en DSB2018, todav√≠a hab√≠a otro a√±o.  Como resultado, nos quedamos sin nada m√°s que terminar en el lugar 40 de 600 equipos. <br><br>  Sin embargo, saqu√© dos conclusiones: la segmentaci√≥n sem√°ntica es un enfoque conveniente para visualizar y analizar el funcionamiento del algoritmo, y se pueden soldar m√°scaras de las cajas con cierto esfuerzo. <br><br>  Pero volvamos a la pizza.  Para resaltar el pastel en las fotos seleccionadas y filtradas, la opci√≥n m√°s correcta ser√≠a dar la tarea a los redactores.  En ese momento, ya hab√≠amos implementado los cuadros y el algoritmo de consenso para ellos.  As√≠ que solo lanc√© un par de ejemplos y se los di al marcado.  Como resultado, obtuve 500 muestras con un √°rea de corteza seleccionada con precisi√≥n. <br><br><img src="https://habrastorage.org/webt/pd/pr/nh/pdprnh1katpk2nl7gzq-edoy8cm.png"><br><br>  Luego saqu√© mi c√≥digo de los sellos y me acerqu√© m√°s formalmente al procedimiento actual.  Despu√©s de la primera iteraci√≥n del entrenamiento, tambi√©n fue claramente visible d√≥nde se equivoc√≥ el modelo.  Y la confianza de las predicciones se puede definir de la siguiente manera: <br>  1 - (√°rea gris) / (√°rea de m√°scara) # habr√° una f√≥rmula, lo prometo <br><br><img src="https://habrastorage.org/webt/hz/eb/9d/hzeb9dqh2fazgyo0gpdclqbp1du.png"><br><br>  Ahora, para hacer la pr√≥xima iteraci√≥n de tirar de las cajas en las m√°scaras, un peque√±o conjunto predecir√° el tren TTA.  Esto puede considerarse en cierta medida la destilaci√≥n del conocimiento WAAAAGH, pero es m√°s correcto llamar a Pseudo Etiquetado. <br><br><img src="https://habrastorage.org/webt/qk/he/eo/qkheeobxrxzxbim3gk8s8gihoyu.png"><br><br>  A continuaci√≥n, debe elegir con sus ojos un cierto umbral de confianza, a partir del cual formamos un nuevo tren.  Y, opcionalmente, puede marcar las muestras m√°s complejas que el conjunto no podr√≠a manejar.  Decid√≠ que ser√≠a √∫til, y pint√© unas 20 im√°genes en alg√∫n lugar mientras diger√≠a el almuerzo. <br><br><img src="https://habrastorage.org/webt/13/4e/wz/134ewz9jgris1o-9jmss90qt7ew.png"><br><br>  Y ahora la parte final de la tuber√≠a: entrenamiento modelo.  Para preparar las muestras, extraje el √°rea de la m√°scara del pastel.  Tambi√©n infl√© un poco la m√°scara con dilataci√≥n y la apliqu√© a la imagen para eliminar el fondo, ya que no deber√≠a haber informaci√≥n sobre la calidad de la prueba.  Y luego acabo de presentar varios modelos del zool√≥gico de Imagenet.  En total, pude recolectar alrededor de 12k muestras confiables.  Por lo tanto, no ense√±√© toda la red neuronal, sino solo el √∫ltimo grupo de convoluciones, de modo que el modelo no se volver√≠a a entrenar. <br><br><div class="spoiler">  <b class="spoiler_title">¬øPor qu√© necesitas congelar capas?</b> <div class="spoiler_text">  Hay dos beneficios de esto: 1. La red aprende m√°s r√°pido, porque no necesita leer gradientes para capas congeladas.  2. La red no est√° reentrenada, ya que ahora tiene menos par√°metros libres.  Se argumenta que los primeros pocos grupos de convoluciones durante el entrenamiento en Imagenet generan signos bastante comunes, como transiciones de color n√≠tidas y texturas que son adecuadas para una clase muy amplia de objetos en fotograf√≠a.  Esto significa que no puede entrenarlos durante Transer Learning. <br></div></div><br><img src="https://habrastorage.org/webt/_1/vq/-5/_1vq-5oea_ikx7b68me9v_hrjq0.png"><br><br>  El mejor modelo individual fue Inception-Resnet-v2, y para ella, el ROC-AUC en un pliegue fue de 0.700.  Si no selecciona nada y env√≠a im√°genes en bruto tal cual, entonces ROC-AUC es 0.58.  Mientras estaba desarrollando la soluci√≥n, el siguiente lote de datos se cocin√≥ en la pizza DODO, y fue posible probar toda la tuber√≠a en una reserva honesta.  Verificamos toda la tuber√≠a y obtuvimos ROC-AUC 0.83. <br><br>  Veamos los errores ahora: <br><br>  Falso negativo superior <br><br><img src="https://habrastorage.org/webt/nc/as/lz/ncaslzpmdyudlv5joncem_h9gcy.png"><br><br>  Se puede ver aqu√≠ que est√°n asociados con un error al marcar el pastel, ya que claramente hay signos de una prueba estropeada. <br><br>  Falso positivo superior <br><br><img src="https://habrastorage.org/webt/bu/hn/cz/buhncz0hnwtl5mf2l5bhqbfuat0.png"><br><br>  Aqu√≠ los errores est√°n relacionados con el hecho de que el primer modelo fue elegido con un √°ngulo no muy bueno, seg√∫n el cual es dif√≠cil encontrar signos clave de la calidad de la prueba. <br><br><h2>  Conclusi√≥n </h2><br>  Los colegas a veces se burlan de m√≠ porque resuelvo muchos problemas segmentando con Unet.  Sin embargo, en mi opini√≥n, este es un enfoque bastante poderoso y conveniente.  Le permite visualizar errores del modelo y la confianza de sus predicciones.  Adem√°s, toda la l√≠nea de pago parece muy simple y ahora hay un mont√≥n de repositorios para cualquier marco. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422873/">https://habr.com/ru/post/es422873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422863/index.html">Tribus, gremios, tren de construcci√≥n y sin TDD: c√≥mo funciona el desarrollo m√≥vil en Uber, Spotify, Odnoklassniki y Avito</a></li>
<li><a href="../es422865/index.html">Java Enterprise Open Lesson "CDI en acci√≥n"</a></li>
<li><a href="../es422867/index.html">Determinaci√≥n del n√∫mero de pisos de una casa a partir de su fotograf√≠a sin aprendizaje autom√°tico</a></li>
<li><a href="../es422869/index.html">Dominamos nuevos lenguajes de programaci√≥n, confiando en los ya aprendidos</a></li>
<li><a href="../es422871/index.html">Identificar perfiles significativos en VK</a></li>
<li><a href="../es422875/index.html">¬øPor qu√© no debe alquilar un VPS / VDS por 200 rublos o c√≥mo elegir el servidor virtual adecuado?</a></li>
<li><a href="../es422877/index.html">"¬øEs esto IoT?" - aprende a no llamar al Internet de las cosas todo en una fila</a></li>
<li><a href="../es422879/index.html">Semana de la seguridad 34: por que se rompen los enrutadores</a></li>
<li><a href="../es422881/index.html">Presentaci√≥n de SOCI - Biblioteca de acceso a bases de datos C ++</a></li>
<li><a href="../es422883/index.html">Su redacci√≥n apesta. Aqu√≠ se explica c√≥mo solucionarlo.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>