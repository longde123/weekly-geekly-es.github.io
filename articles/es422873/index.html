<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游걊 餃쮪잺 游놊 Pizza ala semi-supervisada 游녶 游녣游낕 游쮫릞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art칤culo, me gustar칤a hablar sobre algunas t칠cnicas para trabajar con datos al entrenar un modelo. En particular, c칩mo extraer la segmentaci칩n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pizza ala semi-supervisada</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/422873/">  En este art칤culo, me gustar칤a hablar sobre algunas t칠cnicas para trabajar con datos al entrenar un modelo.  En particular, c칩mo extraer la segmentaci칩n de los objetos en las cajas, as칤 como c칩mo entrenar al modelo y obtener el marcado del conjunto de datos, marcando solo unas pocas muestras. <br><img src="https://habrastorage.org/webt/wo/lz/ab/wolzab2hx3sxc7qnqrmrucfhynk.png"><br><a name="habracut"></a><br><h2>  Desaf칤o </h2><br>  Hay un cierto proceso de hacer pizza y fotos de sus diversas etapas (incluida no solo pizza).  Se sabe que si la receta de masa se echa a perder, habr치 granos blancos en la corteza.  Tambi칠n hay una marca binaria de la calidad de la prueba para cada instancia de pizza, hecha por expertos.  Es necesario desarrollar un algoritmo que determine la calidad de la prueba de acuerdo con la fotograf칤a. <br><br>  El conjunto de datos consta de fotograf칤as tomadas desde diferentes tel칠fonos, en diferentes condiciones, diferentes 치ngulos.  Instancias de pizza - 17k.  Fotos totales - 60k. <br><br>  En mi opini칩n, la tarea es bastante t칤pica y adecuada para mostrar diferentes enfoques para el manejo de datos.  Para resolverlo, debes: <br><br>  1. Elija fotos donde haya una masa de pizza; <br>  2. En las fotos seleccionadas, resalte el pastel; <br>  3. Entrene la red neuronal en las 치reas seleccionadas. <br><br><h2>  Filtrando fotos </h2><br>  A primera vista parece que la forma m치s f치cil ser칤a dar esta tarea a los redactores, y luego entrenar el conjunto de datos en datos limpios.  Sin embargo, decid칤 que era m치s f치cil para m칤 marcar una peque침a parte yo mismo que explicarle a un escriba qu칠 치ngulo era el correcto.  Adem치s, no ten칤a un criterio dif칤cil para el 치ngulo correcto. <br><br>  Entonces, esto es lo que hice: <br><br>  1. Marcado 100 fotos de borde; <br><br><img src="https://habrastorage.org/webt/r3/_e/po/r3_epoxo9v9p_e0aljlsnqcdgge.png"><br><br>  2. Calcul칠 las caracter칤sticas despu칠s de la extracci칩n global de la cuadr칤cula resnet-152 con pesos de imagenet11k_places365; <br><br><img src="https://habrastorage.org/webt/im/my/0c/immy0cck12em7iyx24yrxyzubwy.png"><br><br>  3. Tom칩 el promedio de caracter칤sticas de cada clase, recibiendo dos anclas; <br><br>  4. Calcul칠 la distancia desde cada ancla a todas las caracter칤sticas de las 50k fotos restantes; <br><br>  5. Los 300 superiores en proximidad a un ancla son relevantes para la clase positiva, los 500 superiores m치s cercanos al otro ancla son negativos; <br><br><img src="https://habrastorage.org/webt/ga/wn/xn/gawnxnw_jio9rg8yboqzqb3rmac.png"><br><br>  6. Entren칠 a LightGBM en estas muestras con las mismas caracter칤sticas (XGboost se indica en la imagen, porque tiene un logotipo y es m치s reconocible, pero LightGBM no tiene un logotipo); <br><br>  7. Usando este modelo, obtuve el marcado de todo el conjunto de datos. <br><br><img src="https://habrastorage.org/webt/bd/vb/rq/bdvbrqhqcf5crt3scgwhw5zttms.png"><br><br>  Utilic칠 aproximadamente el mismo enfoque en las competencias de kaggle como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l칤nea de base</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Una explicaci칩n en los dedos de por qu칠 este enfoque incluso funciona</b> <div class="spoiler_text">  Una red neuronal se puede percibir como una transformaci칩n fuertemente no lineal de una imagen.  En el caso de la clasificaci칩n, la imagen se convierte en las probabilidades de las clases que estaban en el conjunto de entrenamiento.  Y estas probabilidades se pueden usar esencialmente como caracter칤sticas para Light GBM.  Sin embargo, esta es una descripci칩n bastante pobre, y en el caso de la pizza, diremos que la clase de pastel es condicionalmente 0.3 gatos y 0.7 perros, y la basura es el resto.  En cambio, puede usar caracter칤sticas menos dispersas despu칠s de la Agrupaci칩n promedio global.  Tienen una propiedad tal que las caracter칤sticas se generan a partir de las muestras del conjunto de entrenamiento, que deben estar separadas por una transformaci칩n lineal (una capa completamente conectada con Softmax).  Sin embargo, debido al hecho de que no hab칤a una pizza expl칤cita en el tren imagenet, es mejor realizar una transformaci칩n no lineal en forma de 치rboles para separar las clases del nuevo conjunto de entrenamiento.  En principio, puede ir a칰n m치s lejos y tomar caracter칤sticas de algunas capas intermedias de la red neuronal.  Ser치n mejores porque todav칤a no han perdido la localidad de los objetos.  Pero son mucho peores debido al tama침o del vector de caracter칤sticas.  Y adem치s, son menos lineales que frente a una capa totalmente conectada. <br></div></div><br><h2>  Una ligera digresi칩n </h2><br>  ODS recientemente se quej칩 de que nadie escribe sobre sus fallas.  Corrigiendo la situaci칩n.  Hace aproximadamente un a침o, particip칠 en la competencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kaggle Sea Lions</a> con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Eugene Nizhibitsky</a> .  La tarea consist칤a en contar los lobos marinos en las im치genes del dron.  El marcado se dio simplemente en forma de coordenadas de canal, pero en alg칰n momento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Iglovikov los</a> marc칩 con cajas y lo comparti칩 generosamente con la comunidad.  En ese momento, me consideraba un padre de segmentaci칩n sem치ntica (despu칠s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kaggle Dstl</a> ) y decid칤 que Unet facilitar칤a enormemente la tarea de contar si aprend칤a a distinguir cl치sicamente a los gatos. <br><br><div class="spoiler">  <b class="spoiler_title">Explicaci칩n de la segmentaci칩n sem치ntica.</b> <div class="spoiler_text">  La segmentaci칩n sem치ntica es esencialmente una clasificaci칩n p칤xel por p칤xel de una imagen.  Es decir, cada p칤xel fuente de la imagen debe asociarse con una clase.  En el caso de la segmentaci칩n binaria (caso del art칤culo), ser치 una clase positiva o negativa.  En el caso de la segmentaci칩n multiclase, a cada p칤xel se le asignar치 una clase del conjunto de entrenamiento (fondo, hierba, gato, hombre, etc.).  En el caso de la segmentaci칩n binaria, la arquitectura de red neuronal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">U-net</a> funcionaba bien en ese momento.  Esta red neuronal es similar en estructura a un codificador-decodificador convencional, pero con reenv칤o de caracter칤sticas desde la parte del codificador al decodificador en las etapas de tama침o apropiado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cdf/52f/999/cdf52f99903a93bd403db1b073f19ba0.png"><br><br>  Sin embargo, en forma de vainilla, ya nadie lo usa, pero al menos agregan Batch Norm.  Bueno, como regla general, toman un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">codificador gordo</a> e inflan el decodificador.  Las arquitecturas similares a U-net han sido reemplazadas por nuevas cuadr칤culas de segmentaci칩n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FPN</a> , que muestran un buen rendimiento en algunas tareas.  Sin embargo, las arquitecturas similares a Unet no han perdido su relevancia hasta el d칤a de hoy.  Funcionan bien como l칤nea base, son f치ciles de entrenar y es muy simple variar la profundidad / tama침o de la neurociencia cambiando diferentes eccoders. <br></div></div><br>  En consecuencia, comenc칠 a ense침ar segmentaci칩n, teniendo como objetivo en la primera etapa solo gatos de boxeo.  Despu칠s de la primera etapa de entrenamiento, predije el tren y mir칠 c칩mo se ven las predicciones.  Con la ayuda de la heur칤stica, se podr칤a seleccionar la confianza abstracta de la m치scara y dividir condicionalmente las predicciones en dos grupos: donde todo es bueno y donde todo es malo. <br><br><img src="https://habrastorage.org/webt/wx/84/jt/wx84jttvncmdiykyt25csspnyec.png"><br><br>  Las predicciones donde todo est치 bien podr칤an usarse para entrenar la pr칩xima iteraci칩n del modelo.  Las predicciones, donde todo es malo, podr칤an elegirse con grandes 치reas sin sellos, manos enmascaradas y tambi칠n arrojadas al tren.  Y de manera iterativa, Eugene y yo entrenamos un modelo que incluso aprendi칩 a segmentar aletas de lobo marino para individuos grandes. <br><br><img src="https://habrastorage.org/webt/_a/g6/xz/_ag6xzccipgeizeek1qnncwxz4k.png"><br><br>  Pero fue un fracaso feroz: pasamos mucho tiempo aprendiendo a segmentar gatos geniales y ... Casi no ayud칩 en su c치lculo.  La suposici칩n de que la densidad de los sellos (el n칰mero de individuos por unidad de 치rea de la m치scara) es constante no funcion칩, porque el dron vol칩 a diferentes alturas y las im치genes ten칤an diferentes escalas.  Y al mismo tiempo, la segmentaci칩n a칰n no distingu칤a a los individuos individuales si se manten칤an apretados, lo que suced칤a con bastante frecuencia.  Y antes del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enfoque innovador para la separaci칩n de los objetos</a> del equipo Tocoder en DSB2018, todav칤a hab칤a otro a침o.  Como resultado, nos quedamos sin nada m치s que terminar en el lugar 40 de 600 equipos. <br><br>  Sin embargo, saqu칠 dos conclusiones: la segmentaci칩n sem치ntica es un enfoque conveniente para visualizar y analizar el funcionamiento del algoritmo, y se pueden soldar m치scaras de las cajas con cierto esfuerzo. <br><br>  Pero volvamos a la pizza.  Para resaltar el pastel en las fotos seleccionadas y filtradas, la opci칩n m치s correcta ser칤a dar la tarea a los redactores.  En ese momento, ya hab칤amos implementado los cuadros y el algoritmo de consenso para ellos.  As칤 que solo lanc칠 un par de ejemplos y se los di al marcado.  Como resultado, obtuve 500 muestras con un 치rea de corteza seleccionada con precisi칩n. <br><br><img src="https://habrastorage.org/webt/pd/pr/nh/pdprnh1katpk2nl7gzq-edoy8cm.png"><br><br>  Luego saqu칠 mi c칩digo de los sellos y me acerqu칠 m치s formalmente al procedimiento actual.  Despu칠s de la primera iteraci칩n del entrenamiento, tambi칠n fue claramente visible d칩nde se equivoc칩 el modelo.  Y la confianza de las predicciones se puede definir de la siguiente manera: <br>  1 - (치rea gris) / (치rea de m치scara) # habr치 una f칩rmula, lo prometo <br><br><img src="https://habrastorage.org/webt/hz/eb/9d/hzeb9dqh2fazgyo0gpdclqbp1du.png"><br><br>  Ahora, para hacer la pr칩xima iteraci칩n de tirar de las cajas en las m치scaras, un peque침o conjunto predecir치 el tren TTA.  Esto puede considerarse en cierta medida la destilaci칩n del conocimiento WAAAAGH, pero es m치s correcto llamar a Pseudo Etiquetado. <br><br><img src="https://habrastorage.org/webt/qk/he/eo/qkheeobxrxzxbim3gk8s8gihoyu.png"><br><br>  A continuaci칩n, debe elegir con sus ojos un cierto umbral de confianza, a partir del cual formamos un nuevo tren.  Y, opcionalmente, puede marcar las muestras m치s complejas que el conjunto no podr칤a manejar.  Decid칤 que ser칤a 칰til, y pint칠 unas 20 im치genes en alg칰n lugar mientras diger칤a el almuerzo. <br><br><img src="https://habrastorage.org/webt/13/4e/wz/134ewz9jgris1o-9jmss90qt7ew.png"><br><br>  Y ahora la parte final de la tuber칤a: entrenamiento modelo.  Para preparar las muestras, extraje el 치rea de la m치scara del pastel.  Tambi칠n infl칠 un poco la m치scara con dilataci칩n y la apliqu칠 a la imagen para eliminar el fondo, ya que no deber칤a haber informaci칩n sobre la calidad de la prueba.  Y luego acabo de presentar varios modelos del zool칩gico de Imagenet.  En total, pude recolectar alrededor de 12k muestras confiables.  Por lo tanto, no ense침칠 toda la red neuronal, sino solo el 칰ltimo grupo de convoluciones, de modo que el modelo no se volver칤a a entrenar. <br><br><div class="spoiler">  <b class="spoiler_title">쯇or qu칠 necesitas congelar capas?</b> <div class="spoiler_text">  Hay dos beneficios de esto: 1. La red aprende m치s r치pido, porque no necesita leer gradientes para capas congeladas.  2. La red no est치 reentrenada, ya que ahora tiene menos par치metros libres.  Se argumenta que los primeros pocos grupos de convoluciones durante el entrenamiento en Imagenet generan signos bastante comunes, como transiciones de color n칤tidas y texturas que son adecuadas para una clase muy amplia de objetos en fotograf칤a.  Esto significa que no puede entrenarlos durante Transer Learning. <br></div></div><br><img src="https://habrastorage.org/webt/_1/vq/-5/_1vq-5oea_ikx7b68me9v_hrjq0.png"><br><br>  El mejor modelo individual fue Inception-Resnet-v2, y para ella, el ROC-AUC en un pliegue fue de 0.700.  Si no selecciona nada y env칤a im치genes en bruto tal cual, entonces ROC-AUC es 0.58.  Mientras estaba desarrollando la soluci칩n, el siguiente lote de datos se cocin칩 en la pizza DODO, y fue posible probar toda la tuber칤a en una reserva honesta.  Verificamos toda la tuber칤a y obtuvimos ROC-AUC 0.83. <br><br>  Veamos los errores ahora: <br><br>  Falso negativo superior <br><br><img src="https://habrastorage.org/webt/nc/as/lz/ncaslzpmdyudlv5joncem_h9gcy.png"><br><br>  Se puede ver aqu칤 que est치n asociados con un error al marcar el pastel, ya que claramente hay signos de una prueba estropeada. <br><br>  Falso positivo superior <br><br><img src="https://habrastorage.org/webt/bu/hn/cz/buhncz0hnwtl5mf2l5bhqbfuat0.png"><br><br>  Aqu칤 los errores est치n relacionados con el hecho de que el primer modelo fue elegido con un 치ngulo no muy bueno, seg칰n el cual es dif칤cil encontrar signos clave de la calidad de la prueba. <br><br><h2>  Conclusi칩n </h2><br>  Los colegas a veces se burlan de m칤 porque resuelvo muchos problemas segmentando con Unet.  Sin embargo, en mi opini칩n, este es un enfoque bastante poderoso y conveniente.  Le permite visualizar errores del modelo y la confianza de sus predicciones.  Adem치s, toda la l칤nea de pago parece muy simple y ahora hay un mont칩n de repositorios para cualquier marco. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422873/">https://habr.com/ru/post/es422873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422863/index.html">Tribus, gremios, tren de construcci칩n y sin TDD: c칩mo funciona el desarrollo m칩vil en Uber, Spotify, Odnoklassniki y Avito</a></li>
<li><a href="../es422865/index.html">Java Enterprise Open Lesson "CDI en acci칩n"</a></li>
<li><a href="../es422867/index.html">Determinaci칩n del n칰mero de pisos de una casa a partir de su fotograf칤a sin aprendizaje autom치tico</a></li>
<li><a href="../es422869/index.html">Dominamos nuevos lenguajes de programaci칩n, confiando en los ya aprendidos</a></li>
<li><a href="../es422871/index.html">Identificar perfiles significativos en VK</a></li>
<li><a href="../es422875/index.html">쯇or qu칠 no debe alquilar un VPS / VDS por 200 rublos o c칩mo elegir el servidor virtual adecuado?</a></li>
<li><a href="../es422877/index.html">"쮼s esto IoT?" - aprende a no llamar al Internet de las cosas todo en una fila</a></li>
<li><a href="../es422879/index.html">Semana de la seguridad 34: por que se rompen los enrutadores</a></li>
<li><a href="../es422881/index.html">Presentaci칩n de SOCI - Biblioteca de acceso a bases de datos C ++</a></li>
<li><a href="../es422883/index.html">Su redacci칩n apesta. Aqu칤 se explica c칩mo solucionarlo.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>