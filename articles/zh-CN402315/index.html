<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤚🏻 👩🏽‍💼 🦖 计时器和触发器CODESYS。 Arduino向经典PLC迈出的又一步 👋 👨🏻‍🚀 🧗🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="它发生在CODESYS环境中的程序控制器（PLC）中。 每个处理过该系统的人都知道，在任何项目中都有一个Standard.lib库，该库中实现了基本的计时器，触发器，计数器以及许多其他功能和功能块。 这些单元中的许多单元都在PLC程序中不断使用。 并且库本身像CODESYS编程语言一样，是IEC 6...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>计时器和触发器CODESYS。 Arduino向经典PLC迈出的又一步</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402315/"><div style="text-align:center;"><img src="https://habrastorage.org/files/269/7d4/587/2697d458734041e8ad9553eaa94aafda.png"></div><br> 它发生在CODESYS环境中的程序控制器（PLC）中。 每个处理过该系统的人都知道，在任何项目中都有一个Standard.lib库，该库中实现了基本的计时器，触发器，计数器以及许多其他功能和功能块。 这些单元中的许多单元都在PLC程序中不断使用。 并且库本身像CODESYS编程语言一样，是IEC 61131-3标准的一个实施例，即 设计用于帮助经典PLC任务的编程。 <br><a name="habracut"></a><br>  PLC程序的功能之一是，程序的主循环应在没有明显延迟的情况下运行，它的内部循环不应具有未定义的退出时间或“有思想的”功能的同步调用，尤其是在慢速通道上的通信方面。 该过程的输入和输出图像仅在主循环的边界处更新，并且我们在循环的一次迭代中“坐下”的时间越长，对控制对象的真实状态的了解就越少，最终，循环溢出的看门狗将起作用。 许多人可能会反对我，说现代PLC模棱两可，支持硬件中断。 我同意，但是我的计划中未包括谈论此类系统，但我想谈论基于Arduino微处理器平台的单任务实现（无中断）的（准伪选择）PLC，其中只有一个主循环。 顺便说一句，说与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Arduino兼容的PLC CONTROLLINO（</a>关于在硬件中实现Arduino的尝试的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分）</a>的这篇文章促使我撰写此说明并不是没有错。 可编程逻辑控制器 <br><br> 关于Arduino的几句话。 从PLC程序员的角度来看，Arduino是具有一个非常快或相反的一个非常慢的loop（）循环的典型控制器。 循环的执行时间没有限制，根据程序员的计划，它可以计算一次和无数次。 当程序很简单并且简化为执行顺序操作，控制器而没有并行事件时，只需使用无穷的嵌套条件检查周期和类型为delay（）的同步延迟来替换操作即可。 这样的程序的顺序步骤将逐字地，简单且逻辑地执行。 但是，一旦需要对并行操作进行编程，就必须更改程序范例。 <br><br> 在单任务系统中，可见并行性只能通过非常快速的并行状态顺序扫描来实现，而不会长时间停留在每个函数调用或条件检查上。 物理输入和输出没有问题，功能运行得足够快，但是delay（）变成了不合理的制动。 在这里，非阻塞计时器进入了，这正是PLC编程中的经典计时器。 底线是它们使用毫秒计数器，并且所有操作都与该全局计数器的值相关。 <br><br> 现在，让我们记住来自CODESYS的相同Standard.lib。 它只是实现了IEC-s的非阻塞计时器。 我以此为基础，将计时器和触发器的功能移植到Arduino库代码（C ++）。 即 试图使Arduino更接近经典PLC。 <br><br> 下面，我将在我的<b>plcStandardLib</b>库中简要介绍CODESYS的移植功能块（FB）及其类似物，所有时序图对于新的Arduino库都是正确的。 例如，可以在CODESYS的俄语帮助中找到对源块的更详细描述。 <br><br><h3>  TON-功能块“延迟打开的计时器” </h3><br><pre><code class="hljs lisp">TON(<span class="hljs-name"><span class="hljs-name">IN</span></span>, PT, Q, ET)</code> </pre> <br> 分别输入BOOL和TIME类型的IN和PT。 输出Q和ET与BOOL和TIME类型相似。 当IN为FALSE时，输出Q = FALSE，输出ET =0。一旦IN变为TRUE，输出ET的倒计时（以毫秒为单位）就会开始等于PT的值。 此外，计数器不增加。 当IN为TRUE且ET为PT时，Q为TRUE，否则为FALSE。 所以 <br> 因此，从输入IN的边沿开始以PT的延迟设置输出Q。 <br><br><h4> 在Arduino IDE中： </h4><br> 广告选项： <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">TON </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TON1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">TON </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TON1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PT)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     PT</span></span></code> </pre> <br> 用例： <br><br><pre> <code class="hljs pgsql">Q = TON1.Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); //  "  " TON1.<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; TON1.Run(); Q = TON1.Q;</code> </pre> <br>  TON操作时序图： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/569/93b/33b/56993b33becf4b9fb1354ac095d573fa.png"></div><br><h3>  TOF-功能块“延时关机定时器” </h3><br><pre> <code class="hljs lisp">TOF(<span class="hljs-name"><span class="hljs-name">IN</span></span>, PT, Q, ET)</code> </pre> <br> 分别输入BOOL和TIME类型的IN和PT。 输出Q和ET与BOOL和TIME类型相似。 如果IN为TRUE，则输出Q = TRUE，输出ET =0。一旦IN变为FALSE，输出ET的倒计时（以毫秒为单位）开始。 当达到设定的持续时间时，倒计时停止。 如果IN为FALSE而ET为PT，则输出Q为FALSE，否则为TRUE。 因此，输出Q从输入IN的下降开始以延迟PT被复位。 <br><br><h4> 在Arduino IDE中： </h4><br> 简而言之，与TON非常相似： <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">TOF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TOF1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PT)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     PT Q = TOF1.Run(boolean IN); //  "  "</span></span></code> </pre> <br>  TOF时序图： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b12/11d/56d/b1211d56da474524b72f53e5ecc8c5a8.png"></div><br><h3>  TP-脉冲计时器功能块 </h3><br><pre> <code class="hljs lisp">TP(<span class="hljs-name"><span class="hljs-name">IN</span></span>, PT, Q, ET)</code> </pre> <br> 分别输入BOOL和TIME类型的IN和PT。 输出Q和ET与BOOL和TIME类型相似。 当IN为FALSE时，输出Q = FALSE，输出ET =0。当IN变为TRUE时，输出Q设置为TRUE，并且计时器开始在输出ET上计数（以毫秒为单位），直到达到PT指定的持续时间为止。 此外，计数器不增加。 因此，输出Q沿输入IN的边缘产生持续时间PT的脉冲。 <br><br><h4> 在Arduino IDE中： </h4><br> 简而言之，与TON非常相似： <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">TP </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TP1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PT)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     PT Q = TP1.Run(boolean IN); //  "  "</span></span></code> </pre> <br>  TP操作时序图： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/03d/476/347/03d476347d6746f499a8f7829ade9d6a.png"></div><br><h3>  R_TRIG-功能块“前检测器” </h3><br>  R_TRIG功能块在输入信号的上升沿生成一个脉冲。 只要输入CLK为FALSE，则输出Q为FALSE。  CLK变为TRUE时，Q设置为TRUE。 下次调用该功能块时，输出将重置为FALSE。 因此，在从FALSE到TRUE的每个CLK转换中，该模块都会发出单个脉冲。 <br><br>  ST中的示例CODEDESYS： <br><br><pre> <code class="hljs go">RTRIGInst : R_TRIG ; RTRIGInst(CLK:= VarBOOL1); VarBOOL2 := RTRIGInst.Q;</code> </pre> <br><h4> 在Arduino IDE中： </h4><br> 公告： <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">R_TRIG</span></span> R_TRIG1;</code> </pre> <br> 用例： <br><br><pre> <code class="hljs objectivec">Q = R_TRIG1.Run(boolean <span class="hljs-built_in"><span class="hljs-built_in">CLK</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  "  " R_TRIG1.CLK = CLK; R_TRIG1.Run(); Q = R_TRIG1.Q;</span></span></code> </pre> <br><h3>  F_TRIG-功能单元“下降检测器” </h3><br> 功能块F_TRIG在输入信号的后沿生成一个脉冲。 <br> 输出Q为FALSE，直到输入CLK为TRUE。 一旦CLK设置为FALSE，Q设置为TRUE。 下次调用该功能块时，输出将重置为FALSE。 因此，该模块在每次从TRUE到FALSE的CLK转换时发出一个脉冲。 <br><br><h4> 在Arduino IDE中： </h4><br><pre> <code class="hljs objectivec">F_TRIG F_TRIG1; Q = F_TRIG1.Run(boolean <span class="hljs-built_in"><span class="hljs-built_in">CLK</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  "  "</span></span></code> </pre> <br><h3>  RS_TRIG-功能块RS触发/ SR_TRIG-功能块SR触发 </h3><br> 断开主开关，RS触发： <br><br><pre> <code class="hljs lisp">Q1 = RS (<span class="hljs-name"><span class="hljs-name">SET</span></span>, RESET1)</code> </pre> <br> 切换至主导： <br><br><pre> <code class="hljs lisp">Q1 = SR (<span class="hljs-name"><span class="hljs-name">SET1</span></span>, RESET)</code> </pre> <br> 输入变量SET和RESET1与BOOL类型的输出变量Q1相同。 <br><br><h4> 在Arduino IDE中： </h4><br><pre> <code class="hljs pgsql">RS_TRIG RS_TRIG1; Q = RS_TRIG1.Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); //  "  "</code> </pre> <br><pre> <code class="hljs pgsql">SR_TRIG SR_TRIG1; Q = SR_TRIG1.Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); //  "  "</code> </pre> <br><h2> 源代码和示例 </h2><br><div class="spoiler">  <b class="spoiler_title">plcStandardLib_1.h</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* * plcStandardLib_1.h * * Created on: 01.01.2017 * Author: Admin */</span></span> #ifndef PLCSTANDARDLIB_1_H_ #define PLCSTANDARDLIB_1_H_ #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ARDUINO &gt;= <span class="hljs-number"><span class="hljs-number">100</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Arduino.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;WProgram.h&gt; #endif <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TON ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TON { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: TON(); TON(unsigned long PT); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; //   unsigned long PT; //   unsigned long ET; //   -    private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   unsigned long _StartTime; }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TOF ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TOF { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: TOF(); TOF(unsigned long PT); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; //   unsigned long PT; //   unsigned long ET; //   -    private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   unsigned long _StartTime; }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TP ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TP { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: TP(); TP(unsigned long PT); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; //   unsigned long PT; //   unsigned long ET; //   -    private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   unsigned long _StartTime; }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- R_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> R_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: R_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK); <span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- F_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> F_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: F_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK); <span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- RS_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> RS_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: RS_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   //private: }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- SR_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SR_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: SR_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   //private: }; #endif <span class="hljs-comment"><span class="hljs-comment">/* PLCSTANDARDLIB_H_ */</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">plcStandardLib_1.cpp</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* * plcStandardLib_1.h * * Created on: 01.01.2017 * Author: Admin */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "plcStandardLib_1.h" <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TON ------------------- */</span></span> TON::TON() { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; PT = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } TON::TON(unsigned long PT) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; TON::PT = PT; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> TON::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { TON::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TON::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_M) { _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; //    _StartTime = millis(); // ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; //  = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Q) ET = millis() - _StartTime; //   } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &gt;= PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TOF ------------------- */</span></span> TOF::TOF() { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; PT = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } TOF::TOF(unsigned long PT) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; TOF::PT = PT; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> TOF::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { TOF::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TOF::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { Q = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_M) { _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //    _StartTime = millis(); // ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; //  = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Q) ET = millis() - _StartTime; //   } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &gt;= PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TP ------------------- */</span></span> TP::TP() { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; PT = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } TP::TP(unsigned long PT) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; TP::PT = PT; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> TP::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { TP::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_M) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TP::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; //    _StartTime = millis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &lt; PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Q) { ET = millis() - _StartTime; //   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &gt;= PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TP::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- R_TRIG ------------------- */</span></span> R_TRIG::R_TRIG() { CLK = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> R_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK) { R_TRIG::CLK = CLK; Q = R_TRIG::CLK &amp;&amp; !_M; _M = R_TRIG::CLK; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } F_TRIG::F_TRIG() { CLK = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> F_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK) { F_TRIG::CLK = CLK; Q = !F_TRIG::CLK &amp;&amp; !_M; _M = !F_TRIG::CLK; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- RS_TRIG ------------------- */</span></span> RS_TRIG::RS_TRIG() { <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> RS_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>) { RS_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; RS_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; Q = !<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> RS_TRIG::Run() { Q = !<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- SR_TRIG ------------------- */</span></span> SR_TRIG::SR_TRIG() { <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> SR_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>) { SR_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; SR_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> SR_TRIG::Run() { Q = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">plcStandardLib_1_example.ino</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"plcStandardLib_1.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED 13 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ButtonIn 7 TON TON1(500); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   , 500. TON TON2(1000); //   , 1000. TOF TOF1(500); //   , 500. TP TP1(300); //   , 300. TP TP2(200); //   , 200. R_TRIG R_TRIG1; //      void setup() { pinMode(ButtonIn, INPUT_PULLUP); pinMode(LED, OUTPUT); } void loop() { digitalWrite(LED, TP1.Run(R_TRIG1.Run(TON1.Run(digitalRead(ButtonIn))))); // TON1 -    // R_TRIG1 -    // TP1 -     digitalWrite(LED, TP2.Run(TON2.Run(!TON2.Q))); //     TON  TP // TON2.Run(!TON2.Q)) -    // TP2 -     digitalWrite(LED, TOF1.Run(TON1.Run(digitalRead(ButtonIn)))); //     }</span></span></span></span></code> </pre><br></div></div><br> 例如，要过滤按钮的联系人的颤动（也要同时打开！），此代码就足够了： <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">FiltredButtonIn</span></span> = TON1.Run(digitalRead(ButtonIn))</code> </pre> <br> 总结：这就是CODESYS看起来像是基于TON和TP计时器链的脉冲发生器。 最初，TON被带反演的反馈所覆盖，并从中生成单个脉冲发生器，从而开始TP脉冲发生器的操作。 在我的Arduino示例中，类似的代码如下： <br><br><pre> <code class="hljs lisp">digitalWrite(<span class="hljs-name"><span class="hljs-name">LED</span></span>, TP2.Run(<span class="hljs-name"><span class="hljs-name">TON2</span></span>.Run(!TON2.Q)))<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/XIjuetT1CvM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN402315/">https://habr.com/ru/post/zh-CN402315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN402305/index.html">我们如何在导演上使用眼线笔测试咬合矫正</a></li>
<li><a href="../zh-CN402307/index.html">魅族Pro 5 Ubuntu Edition智能手机的滥用</a></li>
<li><a href="../zh-CN402309/index.html">铁杆或几乎三角形的船</a></li>
<li><a href="../zh-CN402311/index.html">机器人将使世界变得干净</a></li>
<li><a href="../zh-CN402313/index.html">如何管理睡眠：直接影响大脑活动的方法</a></li>
<li><a href="../zh-CN402317/index.html">适用于手机所有者的最佳VR耳机</a></li>
<li><a href="../zh-CN402319/index.html">贾吉洛尼亚大学利用IBM Watson的功能开发了一个培训器应用程序</a></li>
<li><a href="../zh-CN402321/index.html">Livall评论：具有控制器，麦克风和本地应用程序的智能头盔</a></li>
<li><a href="../zh-CN402323/index.html">“还工作”：听音乐的艺术</a></li>
<li><a href="../zh-CN402325/index.html">“稀薄的世界。” 第七章</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>