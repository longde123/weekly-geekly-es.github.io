<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôÄÔ∏è üèÄ üê≠ Criptografado de acordo com GOST: memorando sobre a configura√ß√£o de roteamento din√¢mico de tr√°fego üîÄ üíª üî¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se sua empresa transmitir ou receber pela rede dados pessoais e outras informa√ß√µes confidenciais sujeitas a prote√ß√£o de acordo com a lei, ser√° necess√°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criptografado de acordo com GOST: memorando sobre a configura√ß√£o de roteamento din√¢mico de tr√°fego</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/471470/"><img src="https://habrastorage.org/webt/v-/53/qf/v-53qfuqlx4ywc8cf8xfp2wlgt8.jpeg"><br>  Se sua empresa transmitir ou receber pela rede dados pessoais e outras informa√ß√µes confidenciais sujeitas a prote√ß√£o de acordo com a lei, ser√° necess√°rio aplicar a criptografia de acordo com o GOST.  Hoje, contaremos como introduzimos essa criptografia com base no S-Terra crypto-gateway (KS) em um dos clientes.  Esta hist√≥ria ser√° interessante para especialistas em seguran√ßa da informa√ß√£o, al√©m de engenheiros, designers e arquitetos.  N√£o vamos nos aprofundar nas nuances da configura√ß√£o t√©cnica neste post - vamos nos concentrar nos pontos principais da configura√ß√£o b√°sica.  Uma quantidade enorme de documenta√ß√£o sobre a configura√ß√£o dos daemons do SO Linux, na qual o banco de dados S-Terra se baseia, est√° dispon√≠vel gratuitamente na Internet.  A documenta√ß√£o de configura√ß√£o do software propriet√°rio da S-Terra tamb√©m est√° dispon√≠vel ao p√∫blico no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">portal</a> do fabricante. <br><a name="habracut"></a><br><h2>  Algumas palavras sobre o projeto </h2><br>  A topologia de rede do cliente era t√≠pica - malha completa entre o centro e as filiais.  Foi necess√°rio introduzir a criptografia dos canais de troca de informa√ß√µes entre todos os sites, dos quais havia 8 partes. <br><br>  Geralmente, nesses projetos, tudo √© est√°tico: nos gateways de criptografia (KS), as rotas est√°ticas s√£o definidas para a rede local do site, as listas de endere√ßos IP (ACLs) para criptografia s√£o escritas.  Entretanto, nesse caso, os sites n√£o possuem gerenciamento centralizado e tudo pode acontecer dentro de suas redes locais: as redes podem ser adicionadas, exclu√≠das e modificadas de todas as formas.  Para evitar a reconfigura√ß√£o de roteamento e ACLs para o KS ao alterar o endere√ßamento de redes locais nos sites, foi decidido usar o OSPF de encapsulamento din√¢mico e roteamento din√¢mico, que inclui todos os KS e a maioria dos roteadores do n√≠vel de n√∫cleo da rede nos sites (em alguns sites, os administradores de infraestrutura preferem use SNAT na dire√ß√£o do KS nos roteadores do kernel). <br><br>  O tunelamento GRE resolveu dois problemas: <br>  <b>1.</b> Use na ACL para criptografia o endere√ßo IP da interface KS externa, na qual todo o tr√°fego enviado para outros sites √© encapsulado. <br>  <b>2.</b> Organize t√∫neis ptp entre os KS, que permitem configurar o roteamento din√¢mico (no nosso caso, o provedor MPLS L3VPN √© organizado entre os sites). <br><br>  O cliente solicitou a implementa√ß√£o da criptografia como um servi√ßo.  Caso contr√°rio, ele teria que n√£o apenas oferecer suporte a gateways de criptografia ou terceirizar alguma organiza√ß√£o, mas tamb√©m monitorar independentemente o ciclo de vida dos certificados de criptografia, renov√°-los a tempo e instalar novos. <br><img src="https://habrastorage.org/webt/ho/lc/ch/holcch4mtnk2skxc5_atydslidu.jpeg"><br>  E agora o memorando em si - como e o que montamos <br><br><h2>  Nota de assunto do KII: configuramos um gateway criptogr√°fico </h2><br><h3>  Configura√ß√£o b√°sica de rede </h3><br>  Primeiro, lan√ßamos um novo cache e entramos no console de administra√ß√£o.  Voc√™ deve come√ßar alterando a senha do administrador interno - o comando <b>change user password administrator</b> .  Em seguida, √© necess√°rio executar o procedimento de inicializa√ß√£o (o comando de <b>inicializa√ß√£o</b> ) no processo em que os dados da licen√ßa s√£o inseridos e o sensor de n√∫mero aleat√≥rio (DSN) √© inicializado. <br><br>  <b><u>Preste aten√ß√£o!</u></b>  Quando o S-Terra KS √© inicializado, √© estabelecida uma pol√≠tica de seguran√ßa na qual as interfaces do Security Gateway n√£o passam pacotes.  Voc√™ deve criar sua pr√≥pria pol√≠tica ou usar o <b>comando run csconf_mgr enable</b> para ativar uma pol√≠tica de permiss√£o predefinida. <br>  Em seguida, voc√™ precisa configurar o endere√ßamento das interfaces externas e internas, bem como a rota padr√£o.  √â prefer√≠vel trabalhar com a configura√ß√£o de rede do cache e configurar a criptografia atrav√©s do console do tipo Cisco.  Este console foi projetado para inserir comandos semelhantes aos comandos do Cisco IOS.  A configura√ß√£o criada usando o console semelhante √† Cisco, por sua vez, √© convertida nos arquivos de configura√ß√£o correspondentes com os quais os daemons do SO trabalham.  Voc√™ pode acessar o console do tipo Cisco no console de administra√ß√£o com o comando <b>configure</b> . <br><br>  Altere as senhas do cscons do usu√°rio interno e ative: <br><br>  &gt; ativar <br>  Senha: csp (predefinida) <br>  #configure terminal <br>  #username privil√©gio cscons 15 secret 0 #enable secret 0 Defina a configura√ß√£o b√°sica da rede: <br><br>  #interface GigabitEthernet0 / 0 <br>  #ip address 10.111.21.3 255.255.255.0 <br>  #no shutdown <br>  #interface GigabitEthernet0 / 1 <br>  #ip address 192.168.2.5 255.255.255.252 <br>  #no shutdown <br>  #ip route 0.0.0.0 0.0.0.0 10.111.21.254 <br><br><h3>  GRE </h3><br>  Sa√≠mos do console do tipo Cisco e vamos para o shell debian com o comando <b>system</b>  Defina sua pr√≥pria senha para o <b>usu√°rio root</b> com o comando <b>passwd</b> . <br>  Um t√∫nel separado para cada site √© configurado em cada KSh.  A interface do t√∫nel est√° configurada no arquivo <b>/ etc / network / interfaces</b> .  O utilit√°rio de encapsulamento IP, que faz parte do conjunto predefinido de iproute2, √© respons√°vel por criar a pr√≥pria interface.  O comando para criar uma interface √© gravado na op√ß√£o pre-up. <br><br>  Exemplo de configura√ß√£o de uma interface de t√∫nel t√≠pica: <br>  auto site1 <br>  iface site1 inet static <br>  endere√ßo 192.168.1.4 <br>  m√°scara de rede 255.255.255.254 <br>  pr√©-up t√∫nel ip adicionar modo site1 gre local 10.111.21.3 remoto 10.111.22.3 chave hfLYEg ^ vCh6p <br><br>  <b><u>Preste aten√ß√£o!</u></b>  Note-se que as configura√ß√µes da interface do t√∫nel devem estar localizadas fora da se√ß√£o <br><br>  ### netifcfg-begin ### <br>  ***** <br>  ### netifcfg-end ### <br><br>  Caso contr√°rio, essas configura√ß√µes ser√£o apagadas ao alterar as configura√ß√µes de rede de interfaces f√≠sicas atrav√©s do console semelhante √† Cisco. <br><br><h3>  Roteamento din√¢mico </h3><br>  No S-Terra, o roteamento din√¢mico √© implementado usando o pacote de software Quagga.  Para configurar o OSPF, precisamos ativar e configurar os <b>daemons</b> <b>zebra</b> e <b>ospfd</b> .  O daemon zebra √© respons√°vel pela intera√ß√£o entre os daemons de roteamento e o sistema operacional.  O daemon ospfd, como o nome indica, √© respons√°vel pela implementa√ß√£o do protocolo OSPF. <br>  O OSPF √© configurado atrav√©s do console daemon ou diretamente atrav√©s do arquivo de configura√ß√£o <b>/etc/quagga/ospfd.conf</b> .  Todas as interfaces f√≠sicas e de t√∫nel envolvidas no roteamento din√¢mico s√£o adicionadas ao arquivo e s√£o anunciadas redes que ser√£o anunciadas e receber√£o an√∫ncios. <br><br>  Um exemplo de configura√ß√£o para adicionar ao <b>ospfd.conf</b> : <br>  interface eth0 <br>  ! <br>  interface eth1 <br>  ! <br>  interface site1 <br>  ! <br>  interface site2 <br>  roteador ospf <br>  ID do roteador ospf 192.168.2.21 <br>  √°rea de rede 192.168.1.4/31 0.0.0.0 <br>  rede 192.168.1.16/31 √°rea 0.0.0.0 <br>  √°rea de rede 192.168.2.4/30 0.0.0.0 <br><br>  Nesse caso, os endere√ßos 192.168.1.x / 31 s√£o reservados para redes de encapsulamento ptp entre sites, os endere√ßos 192.168.2.x / 30 s√£o alocados para redes de tr√¢nsito entre o KS e os roteadores do kernel. <br><br>  <u><b>Preste aten√ß√£o!</b></u>  Para reduzir a tabela de roteamento em instala√ß√µes grandes, √© poss√≠vel filtrar o an√∫ncio das redes de tr√¢nsito usando as constru√ß√µes de <b>mapa de rotas</b> <b>sem redistribui√ß√£o conectada</b> ou <b>redistribu√≠da</b> . <br><br>  Depois de configurar os daemons, voc√™ precisa alterar o status de inicializa√ß√£o do daemon em <b>/ etc / quagga / daemons</b> .  Nas op√ß√µes <b>zebra</b> e <b>ospfd</b> n√£o h√° corre√ß√£o para sim.  Execute o daemon quagga e defina sua execu√ß√£o autom√°tica ao iniciar o cache com o comando <b>update-rc.d quagga enable</b> . <br><br>  Se os t√∫neis GRE e OSPF estiverem configurados corretamente, as rotas para a rede de outros sites dever√£o aparecer nos roteadores KS e kernel e, assim, surgir√° a conectividade de rede entre redes locais. <br><br><h3>  Criptografamos o tr√°fego transmitido </h3><br>  Como j√° foi escrito, ao criptografar entre sites, geralmente especificamos os intervalos de endere√ßos IP (ACLs) entre os quais o tr√°fego √© criptografado: se os endere√ßos de origem e destino se enquadram nesses intervalos, o tr√°fego entre eles √© criptografado.  No entanto, neste projeto, a estrutura √© din√¢mica e os endere√ßos podem mudar.  Como j√° configuramos o encapsulamento do GRE, podemos especificar endere√ßos KS externos como os endere√ßos de origem e destino para a criptografia de tr√°fego - porque para criptografia ocorre o tr√°fego j√° encapsulado pelo protocolo GRE.  Em outras palavras, tudo o que entra no cache da rede local de um site para as redes anunciadas por outros sites √© criptografado.  E j√° em cada um dos sites qualquer encaminhamento pode ser realizado.  Assim, com qualquer altera√ß√£o nas redes locais, basta que o administrador modifique os an√∫ncios que v√£o de sua rede para a dire√ß√£o da escola secund√°ria, e ela ficar√° dispon√≠vel para outros sites. <br><br>  A criptografia no S-Terra KS √© realizada usando o protocolo IPSec.  Utilizamos o algoritmo Grasshopper de acordo com o GOST R 34.12-2015 e, para compatibilidade com vers√µes mais antigas, o GOST 28147-89 pode ser usado.  Tecnicamente, a autentica√ß√£o pode ser realizada tanto em chaves predefinidas (PSKs) quanto em certificados.  No entanto, em opera√ß√£o industrial, √© necess√°rio usar certificados emitidos de acordo com GOST R 34.10-2012. <br><br>  O trabalho com certificados, cont√™ineres e CRLs √© realizado usando o utilit√°rio <b>cert_mgr</b> .  Primeiro, usando o comando <b>cert_mgr create</b> , <b>voc√™</b> precisa <b>criar</b> um cont√™iner de chave privada e uma solicita√ß√£o de certificado, que ser√° enviada ao Centro de Gerenciamento de Certificados.  Depois de receber o certificado, ele deve ser importado com o comando <b>cert_mgr import</b> junto com o certificado raiz da CA e da CRL (se usado).  Voc√™ pode <b>verificar se</b> todos os certificados e CRLs est√£o instalados com o comando <b>cert_mgr show</b> . <br><br>  Ap√≥s a instala√ß√£o bem-sucedida dos certificados, v√° para o console semelhante √† Cisco para configurar o IPSec. <br>  Criamos uma pol√≠tica IKE que especifica os algoritmos e par√¢metros desejados do canal seguro criado, que ser√£o oferecidos ao parceiro para aprova√ß√£o. <br><br>  #crypto isakmp policy 1000 <br>  #encr gost341215k <br>  #hash gost341112-512-tc26 <br>  #authentication sign <br>  #group vko2 <br>  #lifetime 3600 <br><br>  Esta pol√≠tica se aplica ao criar a primeira fase do IPSec.  A conclus√£o bem-sucedida da primeira fase √© o estabelecimento da SA (Security Association). <br>  Em seguida, precisamos definir uma lista de endere√ßos IP de origem e de destino (ACLs) para criptografia, formar um conjunto de transforma√ß√µes, criar um mapa criptogr√°fico (mapa criptogr√°fico) e vincul√°-lo √† interface externa do CAB. <br><br>  Defina a ACL: <br>  #ip site1 estendido da lista de acesso <br>  #permit gre host 10.111.21.3 host 10.111.22.3 <br><br>  Um conjunto de transforma√ß√µes (assim como na primeira fase, usamos o algoritmo de criptografia Grasshopper usando o modo de simula√ß√£o): <br><br>  #crypto ipsec transform-set GOST esp-gost341215k-mac <br><br>  Crie um mapa criptogr√°fico, especifique ACL, transforme o conjunto e o endere√ßo do ponto: <br><br>  #crypto map MAIN 100 ipsec-isakmp <br>  #match address site1 <br>  #set conjunto de transforma√ß√£o GOST <br>  #set peer 10.111.22.3 <br><br>  Anexamos o mapa criptogr√°fico √† interface externa do CABG: <br><br>  #interface GigabitEthernet0 / 0 <br>  #ip address 10.111.21.3 255.255.255.0 <br>  #crypto map PRINCIPAL <br><br>  Para criptografar canais com outros sites, voc√™ deve repetir o procedimento para criar ACLs e cart√µes de criptografia, alterando o nome do ACL, endere√ßos IP e n√∫mero do cart√£o de criptografia. <br><br>  <b><u>Preste aten√ß√£o!</u></b>  Se a verifica√ß√£o do certificado CRL n√£o for usada, isso dever√° ser especificado explicitamente: <br><br>  #crypto pki trustpoint s-terra_technological_trustpoint <br>  # revocation-check none <br><br>  Nesta configura√ß√£o pode ser considerado completo.  A sa√≠da dos comandos do console do tipo Cisco <b>mostra crypto isakmp sa</b> e <b>show crypto ipsec sa</b> deve refletir a primeira e a segunda fases constru√≠das do IPSec.  A mesma informa√ß√£o pode ser obtida usando o comando <b>sa_mgr show</b> executado no shell debian.  A sa√≠da do comando <b>cert_mgr show deve exibir</b> certificados de site remoto.  O status desses certificados ser√° <b>remoto</b> .  Caso os t√∫neis n√£o sejam constru√≠dos, √© necess√°rio examinar o log do servi√ßo VPN, armazenado no arquivo <b>/var/log/cspvpngate.log</b> .  Uma lista completa de arquivos de log com uma descri√ß√£o de seu conte√∫do est√° dispon√≠vel na documenta√ß√£o. <br><br><h2>  Monitore a "integridade" do sistema </h2><br>  O S-Terra KS usa o daemon snmpd padr√£o para monitorar.  Al√©m dos par√¢metros t√≠picos do Linux, o S-Terra pronto para uso suporta a sa√≠da de t√∫neis IPSec de acordo com CISCO-IPSEC-FLOW-MONITOR-MIB, que √© o que usamos para monitorar o status dos t√∫neis IPSec.  A funcionalidade de OIDs personalizados tamb√©m √© suportada, fornecendo os resultados do script como valores.  Esse recurso nos permite rastrear as datas de validade dos certificados.  O script escrito analisa a sa√≠da do comando <b>cert_mgr show</b> e, como resultado, fornece o n√∫mero de dias antes da expira√ß√£o dos certificados local e raiz.  Essa t√©cnica √© indispens√°vel ao administrar um grande n√∫mero de CRM. <br><img src="https://habrastorage.org/webt/ho/gl/py/hoglpynhcvdwk7o5x5hpvbtycuo.jpeg"><br><br><h2>  Qual √© o cimus dessa criptografia </h2><br>  Toda a funcionalidade descrita acima √© suportada KS S-Terra "pronto para uso".  Ou seja, n√£o era necess√°rio instalar nenhum m√≥dulo adicional que pudesse afetar a certifica√ß√£o de gateways criptogr√°ficos e a certifica√ß√£o de todo o sistema de informa√ß√£o.  Os canais entre sites podem ser quaisquer, mesmo atrav√©s da Internet. <br><br>  Devido ao fato de que, ao alterar a infraestrutura interna, n√£o √© necess√°rio reconfigurar os gateways de criptografia, o <b>sistema funciona como um servi√ßo</b> , o que √© muito conveniente para o cliente: ele pode colocar seus servi√ßos (cliente e servidor) em qualquer endere√ßo e todas as altera√ß√µes s√£o transferidas dinamicamente entre o equipamento de criptografia. <br><br>  Obviamente, a criptografia devido √† sobrecarga afeta a taxa de transfer√™ncia de dados, mas n√£o significativamente - a largura de banda do canal pode diminuir em um m√°ximo de 5 a 10%.  Al√©m disso, a tecnologia foi testada e mostrou bons resultados, mesmo em canais de sat√©lite, que s√£o bastante inst√°veis ‚Äã‚Äãe com baixa largura de banda. <br><br>  <i>Igor Vinokhodov, engenheiro da 2¬™ linha de administra√ß√£o da Rostelecom Solar</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471470/">https://habr.com/ru/post/pt471470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471452/index.html">Intelig√™ncia artificial se conecta √† previs√£o de terremotos</a></li>
<li><a href="../pt471458/index.html">Regress√£o linear e descida de gradiente</a></li>
<li><a href="../pt471462/index.html">Escola de desenvolvedores Java em Nizhny Novgorod</a></li>
<li><a href="../pt471464/index.html">Designer el√©trico em miniatura para crian√ßas com as pr√≥prias m√£os</a></li>
<li><a href="../pt471468/index.html">O problema da classifica√ß√£o de hackers por perigo</a></li>
<li><a href="../pt471472/index.html">Semana de Seguran√ßa 42: backdoors de hardware, vulnerabilidade no Intel NUC</a></li>
<li><a href="../pt471474/index.html">Life hack - escreva e hospede o site com um livro de visitas na nuvem gratuitamente</a></li>
<li><a href="../pt471480/index.html">Como criar equipes de produtos eficazes?</a></li>
<li><a href="../pt471482/index.html">CLRium # 6: Simultaneidade e Paralelismo. Dois dias: do processador ao ass√≠ncrono / aguardar</a></li>
<li><a href="../pt471484/index.html">Modelo de transfer√™ncias de futebol: aprofundando</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>