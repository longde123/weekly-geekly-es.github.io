<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โฏ๏ธ ๐น ๐ ููู ูุตููุง ุจุฑูููุซููุณุ โบ๏ธ โ๏ธ โฐ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุจุทุฑููุฉ ูุง ูุงู ุนููู ุฃู ุฃุชุนุงูู ูุน ููุงููุณ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจูุง ุ ููุง ูู ุงูุญุงู ุฏุงุฆููุง (ูุง ููุชุ) ูุฅุถุงูุชูุง ูุงุญููุง - ุฅููุง ุตุนุจุฉ ููุบุงูุฉ ููู ูุชู ุชูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููู ูุตููุง ุจุฑูููุซููุณุ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475600/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ุจุทุฑููุฉ ูุง ูุงู ุนููู ุฃู ุฃุชุนุงูู ูุน ููุงููุณ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจูุง ุ ููุง ูู ุงูุญุงู ุฏุงุฆููุง (ูุง ููุชุ) ูุฅุถุงูุชูุง ูุงุญููุง - ุฅููุง ุตุนุจุฉ ููุบุงูุฉ ููู ูุชู ุชูููุฐูุง ุจุนุฏ - ููุฐุง ูุนูู ุฃู ุงูููุช ูุฏ ุญุงู ูุชุทุจูููุง.  ุจุนุฏ ุจุนุถ ุงูุชุฌูุงู ุนูู ุงูุดุจูุฉ ุ ูุงู ูุธุงู ุงูุฑุตุฏ ุงูุฃูุซุฑ ุดุนุจูุฉ ุ ููุง ูุจุฏู ูู ุ ุจุฑูููุซููุณ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู Prometheus ุ ูููููุง ูุฑุงูุจุฉ ููุงุฑุฏ ุงูููุจููุชุฑ ุงููุฎุชููุฉ ุ ูุซู: ุงูุฐุงูุฑุฉ ูุงููุนุงูุฌ ูุงููุฑุต ูุชุญููู ุงูุดุจูุฉ.  ูุฏ ูููู ูู ุงูููู ุจุงููุณุจุฉ ููุง ุฃูุถูุง ุญุณุงุจ ุนุฏุฏ ุงูููุงููุงุช ูุทุฑู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจูุง ุฃู ูููุงุณ ููุช ุชูููุฐูุง ุ ูุฃูู ูููุง ุฒุงุฏ ุงูุญูู ุนูู ุงููุธุงู ุ ุฒุงุฏ ุชุนุทูู.  ูููุง ุชุฃุชู ุจุฑูููุซููุณ ููุณุงุนุฏุชูุง.  ูุจุฏู ุฃู ูุฐุง ุงูููุงู ูููุฑ ุงูููุงุท ุงูุฑุฆูุณูุฉ ูููู ุนูู Prometheus ููุฅุถุงูุฉ ูุฌููุนุฉ ุงูููุงููุณ ุฅูู API.  ูุฐูู ุ ูุจุฏุฃ ูุน ุฃูุซุฑ ุนุงุฏูุง ุ ูุน ูุตู ุตุบูุฑ. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุจุฑูููุซููุณ ูู ูุธุงู ููุชูุญ ุงููุตุฏุฑ ู Time Series DBMS ููุชูุจ ูู Go ูุงูุฐู ุทูุฑุชู SoundCloud.  ูุฏูู ูุซุงุฆู ุฑุณููุฉ ูุฏุนู ูุบุงุช ูุซู: Go ุ Java ุฃู Scala ุ Python ุ Ruby.  ููุฌุฏ ุฏุนู ุบูุฑ ุฑุณูู ููุบุงุช ุฃุฎุฑู ุ ูุซู: C # ู C ++ ู C ู Bash ู Lua for Nginx ู Lua for Tarantool ูุบูุฑูุง ุ ูุงููุงุฆูุฉ ุจุฃููููุง ููุฌูุฏุฉ ุนูู ูููุน Prometheus ุงูุฑุณูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุชููุฑ ุฌููุน ุฎุฏูุงุช Prometheus ูุตูุฑ Docker ุนูู Docker Hub ุฃู Quay.io. </p><br><p style=";text-align:right;direction:rtl"> ูุชู <code>docker run -p 9090:9090 prom/prometheus</code> Prometheus ุจูุงุณุทุฉ ุงูุฃูุฑ <code>docker run -p 9090:9090 prom/prometheus</code> ุ ูุงูุฐู ูุจุฏุฃ ุชุดุบููู ุจุงูุชูููู ุงูุงูุชุฑุงุถู ููููู ุจุชุนููู ุงููููุฐ <code>localhost:9090</code> ุ ูุจุนุฏ ุฐูู ุ ุณุชููู ูุงุฌูุฉ ุงููุณุชุฎุฏู Prometheus ูุชุงุญุฉ ูู <code>localhost:9090</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจุฑูููุซููุณ ูู ูุธุงู ูุฑุงูุจุฉ ูุชุถูู ุฃุฏูุงุช ูุชููุนุฉ ูุชูููู ูุฑุงูุจุฉ ุงูุชุทุจููุงุช (ููุงุท ุงูููุงูุฉ) ุจุงุณุชุฎุฏุงู ุจุฑูุชูููู HTTP.  ุนูุฏ ุงูุงุชุตุงู ุจู Prometheus ุ ูุง ูุฏุนู HTTP API "ุงููุตุงุฏูุฉ ุงูุฃุณุงุณูุฉ".  ุฅุฐุง ููุช ุชุฑูุฏ ุงุณุชุฎุฏุงู ุงููุตุงุฏูุฉ ุงูุฃุณุงุณูุฉ ููุงุชุตุงู ุจู Prometheus ุ ููุตูู ุจุงุณุชุฎุฏุงู Prometheus ุจุงูุงูุชุฑุงู ูุน ุฎุงุฏู ูููู ุนูุณู ูุงุณุชุฎุฏุงู ุงููุตุงุฏูุฉ ุนูู ูุณุชูู ุงููููู.  ููููู ุงุณุชุฎุฏุงู ุฃู ูููู ุนูุณู ูุน ุจุฑูููุซููุณ. </p><br><p style=";text-align:right;direction:rtl">  <strong><em>ุงูููููุงุช ุงูุฑุฆูุณูุฉ ูุจุฑูููุซููุณ:</em></strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฎุงุฏู ูุฌูุน ุงูููุงููุณ ููุญูุธูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุธููุง ุ </li><li style=";text-align:right;direction:rtl">  ุญุฒู ูุฌูุน ุงูููุงููุณ ูู API ุ </li><li style=";text-align:right;direction:rtl">  Pushgateway - ูููู ูุชููู ุงูููุงููุณ ูู ุงูุชุทุจููุงุช ุงูุชู ูุง ูููู ุงุณุชุฎุฏุงู ุทูุจ ุงูุณุญุจ ุ </li><li style=";text-align:right;direction:rtl">  ุงููุตุฏุฑูู - ุฃุฏูุงุช ูุชุตุฏูุฑ ุงูููุงููุณ ูู ุชุทุจููุงุช ูุฎุฏูุงุช ุงูุทุฑู ุงูุซุงูุซ ุ ุงููุซุจุชุฉ ุนูู ุงูุฃุฌูุฒุฉ ุงููุณุชูุฏูุฉ ุ </li><li style=";text-align:right;direction:rtl">  AlertManager - ูุฏูุฑ ุงูุฅุฎุทุงุฑ (ุงูุชูุจููุงุช) ุ ูุชู ุชุนุฑูู ุงูุชูุจููุงุช ูู ููู ุงูุชูููู ูุชุนููููุง ุจูุงุณุทุฉ ูุฌููุนุฉ ูู ุงูููุงุนุฏ ููููุงููุณ. <br>  ุฅุฐุง ูุงู ููุงู ุงูุชุฒุงู ุฃุซูุงุก ุงูุนูููุฉ ุจุงููุงุนุฏุฉ ุ ูุชู ุชุดุบูู ุงูุชูุจูู ูุฅุฑุณุงูู ุฅูู ุงููุณุชูููู ุงููุญุฏุฏูู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู Slack ุฃู ุบูุฑูู. </li></ul><br><p style=";text-align:right;direction:rtl">  ุชุณูู ุงููุงุฆูุงุช ุงูุชู ูุนูู ูุนูุง ุจุฑูููุซููุณ ุงูููุงููุณ ุงูุชู ุชู ุชููููุง ูู ุงูุฃูุฏุงู ุฅูุง ูู ุฎูุงู ุจูุงุจุฉ ุงูุฏูุน ุฃู ูู ุฎูุงู ุงููุตุฏุฑูู. </p><br><p style=";text-align:right;direction:rtl">  <strong><em>ุนูุฏ ุฌูุน ุงูููุงููุณ ุ ูุชู ุงุณุชุฎุฏุงู ุนุฏุฉ ุทุฑู ูููููุง:</em></strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุทูุจ Prometheus ููุงููุณ ูู ุงููุฏู ูู ุฎูุงู ุทูุจ ุณุญุจ ุ ูุชู ุชุญุฏูุฏ ุฅุนุฏุงุฏุงุชูุง ูู ููู ุงูุชูููู ูู ูุณู scrape_config ููู ูููุฉ. <br>  ุนูุฏูุง ูุฌูุน ุงููุธุงู ุงูุจูุงูุงุช ุ ููููู ุงูุชุญูู ูู ูุชูุฑุฉ ุงูุชุฌููุน ูุฅูุดุงุก ุชููููุงุช ูุชุนุฏุฏุฉ ูุฌูุน ุงูุจูุงูุงุช ูุชุญุฏูุฏ ุชุฑุฏุฏ ูุฎุชูู ููุงุฆูุงุช ูุฎุชููุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุณูุญ ูู ุงููุตุฏุฑูู ุจุฌูุน ุงูููุงููุณ ูู ูุงุฆูุงุช ูุฎุชููุฉ ุ ุนูู ุณุจูู ุงููุซุงู: ููุงุนุฏ ุงูุจูุงูุงุช (MongoDB ุ SQL ุ ุฅูุฎ) ุ ูุณูุงุณุฑุฉ ุงูุฑุณุงุฆู (RabbitMQ ุ EMQ ุ NSQ ุ ููุง ุฅูู ุฐูู) ุ ููุงุฒูุงุช ุชุญููู HTTP ุ ููุง ุฅูู ุฐูู ุ </li><li style=";text-align:right;direction:rtl">  Pushgateway.  ูููู ุงุณุชุฎุฏุงูู ุนูุฏ ุงูุถุฑูุฑุฉ ุ ุนูุฏูุง ูุชุนุฐุฑ ุนูู ุงูุชุทุจูู ุชูููุฑ ุงููุฏุฑุฉ ุนูู ุฅุนุทุงุก ุงูููุงููุณ ูุจุงุดุฑุฉู ูู Prometheus ุ  ุฃู ุนูุฏ ุงุณุชุฎุฏุงู ููุงู ุงูุฏููุนุงุช ุงูุชู ููุณ ูุฏููุง ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุทูุจ ุณุญุจ Prometheus. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุณูุชู ุชุฎุฒูู ุฌููุน ุงูููุงููุณ ุงููุณุชููุฉ ูู ูุจู ุจุฑูููุซููุณ ูู ูุงุนุฏุฉ ุจูุงูุงุช ูุน ุทูุงุจุน ุฒูููุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong><strong>ุชุฑุชูุจ</strong></strong> </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููู Prometheus ุจุงุณุชุฎุฏุงู ุนูุงูุงุช ุณุทุฑ ุงูุฃูุงูุฑ ููููุงุช ุงูุชูููู ุงููุชููุฑุฉ ุจุชูุณูู YAML.  ุชุชูุญ ูู ุนูุงูุงุช ุณุทุฑ ุงูุฃูุงูุฑ ุชูููู ูุนููุงุช ุบูุฑ ูุงุจูุฉ ููุชุบููุฑ ุ ูุซู: ุงููุณุงุฑุงุช ุ ูุญุฏุงุช ุชุฎุฒูู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ุนูู ุงููุฑุต ููู ุงูุฐุงูุฑุฉ ุ ุฅูุฎ.  ูุณูุญ ูู ููู ุงูุชูููู ุจุชูููู ูู ูุง ูุชุนูู ุจุงููุธุงุฆู ูุฅุนุฏุงุฏ ูููุงุช yaml ุงูุชู ุชู ุชุญููููุง.  ูู ุดูุก ููุชูุจ ูู ููู ุงูุชูููู ุงูุนุงู ุ ููู ูุชูุญ ูู ุถุจุท ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ููุฌููุน ูุชูููุฒ ุงูุฅุนุฏุงุฏุงุช ูููุงุทุน ุงูุชูููู ุงููุฎุชููุฉ ุจุดูู ูููุตู.  ูุชู ุชูููู ุงูุฅุนุฏุงุฏุงุช ุงูุชู ูุณุชุทูุนูุง Prometheus ูู ููู ุงูุชูููู ูู ูุณู scrape_configs. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูู Prometheus ุฅุนุงุฏุฉ ุชุญููู ูููุงุช ุงูุชูููู ุฃุซูุงุก ุงูุนูููุฉ ุ ุฅุฐุง ูุงู ุงูุชูููู ุงูุฌุฏูุฏ ุบูุฑ ุตุงูุญ ุ ููู ูุชู ุชุทุจููู.  ูุชู ุชุดุบูู ุฅุนุงุฏุฉ ุชุดุบูู ููู ุงูุชูููู ุนู ุทุฑูู ุฅุฑุณุงู ุฃูุฑ SIGHUP Prometheus ุฃู ุฅุฑุณุงู ุทูุจ HTTP POST ุฅูู <code>/-/reload</code> ุ ุจุดุฑุท ุฃู ูุชู <code>--web.enable-lifecycle</code> ุนูุงูุฉ <code>--web.enable-lifecycle</code> .  ุณูุชู ุฃูุถูุง ุฅุนุงุฏุฉ ุชุญููู ุฌููุน ูููุงุช ุงูููุงุนุฏ ุงูููููุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong><strong>ูุง ูู ุฃููุงุน ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ</strong></strong> </p><br><p style=";text-align:right;direction:rtl">  ุชููู ุจุฑูููุซููุณ ุจุชุฎุฒูู ูููุฐุฌ ุจูุงูุงุช ูุชุนุฏุฏ ุงูุฃุจุนุงุฏ ูุฎุตุต ูุชุณุชุฎุฏู ูุบุฉ ุงุณุชุนูุงู ููุจูุงูุงุช ูุชุนุฏุฏุฉ ุงูุฃุจุนุงุฏ ุชุณูู PromQL.  ุชููู ุจุฑูููุซููุณ ุจุชุฎุฒูู ุงูุจูุงูุงุช ูู ุดูู ุณูุงุณู ุฒูููุฉ ุ ููู ุชุฏุนู ุงูุนุฏูุฏ ูู ุฎูุงุฑุงุช ุงูุชุฎุฒูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุชุฎุฒูู ุงููุญูู ูููุฑุต: ูู ุณุงุนุชูู ุ ูุชู ุถุบุท ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูู ุงูุฐุงูุฑุฉ ูุชุฎุฒูููุง ุนูู ุงููุฑุต.  ุจุดูู ุงูุชุฑุงุถู ุ ูุชู ุงุณุชุฎุฏุงู ุฏููู ./data ูู ุฏููู ุงูุนูู ูุญูุธ ุงููููุงุช ุงููุถุบูุทุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุณุชูุฏุน ุงูุชุฎุฒูู ุนู ุจุนุฏ: ูุฏุนู ุจุฑูููุซููุณ ุงูุชูุงูู ูุน ูุณุชูุฏุนุงุช ุงูุทุฑู ุงูุซุงูุซ (ุนูู ุณุจูู ุงููุซุงู: ูุงููุง ุ ุจูุณุชุฌุฑุณ ุ ุฃูุงุฒูู S3 ุ ููุง ุฅูู ุฐูู) ูู ุฎูุงู ูุญูู ุจุฑูุชูููู ุงูุชุฎุฒูู ุงููุคูุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุญุฏูุฏ ุงูุณูุณูุฉ ุงูุฒูููุฉ ุงููุฎุฒูุฉ ุจูุงุณุทุฉ ุงูููุงุณ ูุงูุจูุงูุงุช ุงููุตููุฉ ูู ุดูู ุฃุฒูุงุฌ ุฐุงุช ูููุฉ ููุชุงุญ ุ ุนูู ุงูุฑุบู ูู ุฃูู ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูุฏ ูุง ูุชู ุงุณุชุฎุฏุงู ุงุณู ุงููููุงุณ ูุณูู ูุชููู ุงููููุงุณ ููุณู ููุท ูู ุงูุจูุงูุงุช ุงูุชุนุฑูููุฉ.  ูููู ุชุนุฑูู ุงูุณูุณูุฉ ุงูุฒูููุฉ ุฑุณูููุง ุนูู ุฃููุง &lt;metric name&gt; {&lt;metadata&gt;}.  <strong><em>ุงูููุชุงุญ</em></strong> ูู &lt;metric name&gt; {&lt;metadata&gt;} - ูุง ูููุณู ุ <strong><em>ูุงููููุฉ</em></strong> ูู ุงููููุฉ ุงููุนููุฉ ูุฑูู ูุน ููุน float64 (ูุฏุนู Prometheus ูุฐุง ุงูููุน ููุท).  ูุญุชูู ูุตู ุงูููุชุงุญ ุนูู ุจูุงูุงุช ุฃูููุฉ (ุชุณููุงุช) ุ ููุตููุฉ ุฃูุถูุง ุจุฃุฒูุงุฌ ูููุฉ ุงูููุชุงุญ: &lt;label name&gt; = "&lt;label label&gt;" ุ &lt;label name&gt; = "&lt;label label&gt;" ุ ... </p><br><p style=";text-align:right;direction:rtl">  <strong>ุนูุฏ ุชุฎุฒูู ุงูููุงููุณ ุ ูุชู ุงุณุชุฎุฏุงู ุฃููุงุน ุงูุจูุงูุงุช ุงูุชุงููุฉ:</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong><em>ุนุฏุงุฏ</em></strong> - ุจุญุณุงุจ ุงููุจูุบ ุนูู ูุฏู ูุชุฑุฉ ูู ุงูุฒูู.  ูููู ุฃู ูุฒูุฏ ูุฐุง ุงูููุน ูู ุงูููุงููุณ ููุท (ูุง ููููู ุงุณุชุฎุฏุงู ุงูููู ุงูุณูุจูุฉ) ุฃู ุฅุนุงุฏุฉ ุชุนููู ุงููููุฉ. <br>  ูุฏ ูููู ุฐูู ููุงุณุจูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุญุณุงุจ ุนุฏุฏ ุงูุทูุจุงุช ูู ุงูุฏูููุฉ ุฃู ุนุฏุฏ ุงูุฃุฎุทุงุก ูู ุงูููู ุ ูุนุฏุฏ ุญุฒู ุงูุดุจูุฉ ุงููุฑุณูุฉ / ุงููุณุชููุฉ ุ ุฅูุฎ. </li><li style=";text-align:right;direction:rtl">  <strong><em>ูููุงุณ</em></strong> - ูุฎุฒู ุงูููู ุงูุชู ูุฏ ุชููุต ุฃู ุชุฒูุฏ ุจูุฑูุฑ ุงูููุช. <br>  ุงููููุงุณ ูุง ููุธูุฑ ุชุทูุฑ ุงูููุงููุณ ุนูู ูุฏุงุฑ ูุชุฑุฉ ุฒูููุฉ.  ุจุงุณุชุฎุฏุงู ุงููููุงุณ ุ ููููู ุฃู ุชููุฏ ุชุบููุฑุงุช ุงูููุงุณ ุบูุฑ ุงูููุชุธูุฉ ุจูุฑูุฑ ุงูููุช. </li><li style=";text-align:right;direction:rtl">  <strong><em>ุงููุฏุฑุฌ ุงูุฅุญุตุงุฆู</em></strong> - ูุญูุธ ุนุฏุฉ ุณูุงุณู ุฒูููุฉ: ุงููุฌููุน ุงูููู ูุฌููุน ุงูููู ุงููุฑุตูุฏุฉ ุ  ุนุฏุฏ ุงูุฃุญุฏุงุซ ุงูุชู ุชูุช ููุงุญุธุชูุง ุ <br>  ูุดุงุฑ ุฅูู ุงูุนุฏุงุฏุงุช ุงูุชุฑุงูููุฉ (ุงูุฏูุงุก) ูู ุงูุชุณููุฉ ูู <code>le="&lt;upper inclusive bound&gt;"</code> . <br>  ูุชู ุฌูุน ุงูููู ูู ุงูููุงุทู ุฐุงุช ุงูุญุฏูุฏ ุงูุนููุง ุงููุฎุตุตุฉ (ุงูุฏูุงุก). </li><li style=";text-align:right;direction:rtl">  <strong><em>ููุฎุต</em></strong> - ูุญูุธ ุนุฏุฉ ุณูุงุณู ุฒูููุฉ: ุงููุฌููุน ุงูููู ูุฌููุน ุงูููู ุงูููุงุญุธุฉ ุ  ุนุฏุฏ ุงูุฃุญุฏุงุซ ุงูุชู ุชูุช ููุงุญุธุชูุง ุ <br>  ูุดุงุฑ ุฅูู ุงูุชุฏูู iles-quantiles (0 โค ฯ โค 1) ููุฃุญุฏุงุซ ุงููุฑุตูุฏุฉ - ูู ุงูููุตู ุนูู ุฃูู <code>quantile="&lt;ฯ&gt;"</code> . </li></ul><br><p style=";text-align:right;direction:rtl">  <strong><strong>ููู ูุชู ุญูุธ ุงูุจูุงูุงุชุ</strong></strong> </p><br><p style=";text-align:right;direction:rtl">  ุชูุตู ุจุฑูููุซููุณ "ุฅุนุทุงุก" 2/3 ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุฅูู ุชุทุจูู ููุฏ ุงูุชุดุบูู. <br>  ูุชุฎุฒูู ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ ุ ูุณุชุฎุฏู Prometheus ูููุงุช ุชุณูู chunk ุ ูู ูููุงุณ ูู ููู ุฎุงุต ุจู.  ุฌููุน ุงููููุงุช ุงูููุทูุนุฉ ุบูุฑ ูุงุจูุฉ ููุชุบููุฑ ุ ุจุงุณุชุซูุงุก ุขุฎุฑ ููู ูุชู ููู ูุชุงุจุฉ ุงูุจูุงูุงุช.  ูุชู ุญูุธ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูู ูุทุนุฉ ููู ุณุงุนุชูู ูุนูู ุฏูู ุงูุฎูููุฉ ุนูู ุฏูุฌ ุงูุจูุงูุงุช ููุชุงุจุชูุง ุนูู ุงููุฑุต.  ูุชููู ูู ูุชูุฉ ูู ุณุงุนุชูู ูู ุฏููู ูุญุชูู ุนูู ููู ูุงุญุฏ ุฃู ุฃูุซุฑ ูู ุงูููุงุทุน ุงูุชู ุชุญุชูู ุนูู ุฌููุน ุนููุงุช ุงูุณูุงุณู ุงูุฒูููุฉ ูุชูู ุงููุชุฑุฉ ุงูุฒูููุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ููู ุจูุงูุงุช ุงูุชุนุฑูู ูููู ุงูููุฑุณ (ุงูุฐู ูููุฑุณ ุฃุณูุงุก ุงูููุงููุณ ูุงูุชุณููุงุช ููุณูุงุณู ุงูุฒูููุฉ ูู ุงููููุงุช ุงูููุทูุนุฉ).  ุฅุฐุง ูู ุชูู ุจุฑูููุซููุณ ูู ุบุถูู ุณุงุนุฉ ูุงุญุฏุฉ ุจูุชุงุจุฉ ุงูุจูุงูุงุช ููุทุนูุง ุ ูุณูุชู ุญูุธูุง ุนูู ุงููุฑุต ูุณูุชู ุฅูุดุงุก ุฌุฒุก ุฌุฏูุฏ ููุชุงุจุฉ ุงูุจูุงูุงุช.  ุงูุญุฏ ุงูุฃูุตู ููุชุฑุฉ ุงูุงุญุชูุงุธ ุจุงูุจูุงูุงุช ูู Prometheus ูู 21 ููููุง ุชูุฑูุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฃู  ุชู ุฅุตูุงุญ ุญุฌู ุงูุฐุงูุฑุฉ ุ ูุณูุชู ุชูููุฏ ุฃุฏุงุก ุงููุธุงู ูููุชุงุจุฉ ูุงููุฑุงุกุฉ ุจูุฐุง ุงูุญุฌู ูู ุงูุฐุงูุฑุฉ.  ูุชู ุชุญุฏูุฏ ููุฏุงุฑ ุฐุงูุฑุฉ PTSDB ุญุณุจ ุงููุชุฑุฉ ุงูุฒูููุฉ ุงูุฏููุง ุ ููุชุฑุฉ ุงูุชุฌููุน ุ ูุนุฏุฏ ููุงููุณ ุงูููุช. </p><br><p style=";text-align:right;direction:rtl">  ูุฏู ุจุฑูููุซููุณ ุฃูุถูุง ุขููุฉ WAL ูููุน ููุฏ ุงูุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong><em>ุงููุชุงุจุฉ ุฅูู ุงูุฃูุงู ุณุฌู (WAL)</em></strong> ุชุณูุณู ุงูุนูููุงุช ุงููุญููุธุฉ ุนูู ูุณูุท ุฏุงุฆู ูู ุดูู ูููุงุช ุงูุณุฌู.  ูู ุญุงูุฉ ุญุฏูุซ ูุดู ุ ูููู ุงุณุชุฎุฏุงู ูููุงุช WAL ูุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู ุญุงูุชูุง ุงููุชุณูุฉ ูู ุฎูุงู ุงูุงุณุชุนุงุฏุฉ ูู ุงูุณุฌูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุฎุฒูู ูููุงุช ุงูุณุฌู ูู ุฏููู wal ูู ูุทุงุนุงุช 128 ููุฌุงุจุงูุช.  ุชุญุชูู ูุฐู ุงููููุงุช ุนูู ุจูุงูุงุช ุฃูููุฉ ูู ูุชู ุถุบุทูุง ุจุนุฏ ุ ูุฐุง ููู ุฃูุจุฑ ุจูุซูุฑ ูู ูููุงุช ุงูุฃุฌุฒุงุก ุงููุนุชุงุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณุชููู ุจุฑูููุซููุณ ุจุชุฎุฒูู ูุง ูุง ููู ุนู 3 ูููุงุช ุณุฌู ุ ูููู ูููู ููุฎูุงุฏู ุงูุชู ุชุชูุชุน ุจุญุฑูุฉ ูุฑูุฑ ุนุงููุฉ ุฃู ุชุฑู ุฃูุซุฑ ูู ุซูุงุซุฉ ูููุงุช WAL ุ ุญูุซ ุฅููุง ุชุญุชุงุฌ ุฅูู ุชุฎุฒูู ูุง ูุง ููู ุนู ุณุงุนุชูู ูู ุงูุจูุงูุงุช ุงูุฎุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ุงุณุชุฎุฏุงู WAL ูู ุงูุฎูุงุถ ูุจูุฑ ูู ุนุฏุฏ ุทูุจุงุช ุงููุชุงุจุฉ ุฅูู ุงููุฑุต ุ ููุง  ูุญุชุงุฌ ููู ุงูุณุฌู ููุท ุฅูู ุงููุชุงุจุฉ ุนูู ุงููุฑุต ุ ูููุณ ูู ุฌุฒุก ูู ุงูุจูุงูุงุช ุงูุชู ุชู ุชุบููุฑูุง ููุชูุฌุฉ ููุนูููุฉ.  ุชุชู ูุชุงุจุฉ ููู ุงูุณุฌู ุจุงูุชุณูุณู ุ ูุจุงูุชุงูู ูุฅู ุชูููุฉ ูุฒุงููุฉ ุงูุณุฌู ุฃูู ุจูุซูุฑ ูู ุชูููุฉ ูุชุงุจุฉ ุฃุฌุฒุงุก ุงูุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุญูุธ Prometheus ููุงุท ุงูุชููู ุงูุฏูุฑูุฉ ุ ูุงูุชู ุชุชู ุฅุถุงูุชูุง ุงูุชุฑุงุถููุง ูู ุณุงุนุชูู ุนู ุทุฑูู ุถุบุท ุณุฌูุงุช ุงููุชุฑุฉ ุงููุงุถูุฉ ูุญูุธูุง ุนูู ุงููุฑุต. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุฎุฒูู ุฌููุน ููุงุท ุงูุชููู ูู ููุณ ุงูุฏููู ูุซู checkpoint.ddd ุ ุญูุซ ูููู ddd ุนุฏุฏูุง ูุชุฒุงูุฏูุง ุจุดูู ุฑุชูุจ.  ูุฐูู ุ ุนูุฏ ุงูุชุนุงูู ูู ุงููุดู ุ ููููู ุงุณุชุนุงุฏุฉ ููุงุท ุงูุชููู ูู ูุชุงููุฌ ููุทุฉ ุงูุชููู ูุน ุงูุฅุดุงุฑุฉ ุฅูู ุงูุชุฑุชูุจ (.ddd). <br>  ูู ุฎูุงู ูุชุงุจุฉ ุณุฌูุงุช WAL ุ ููููู ุงูุฑุฌูุน ุฅูู ุฃู ููุทุฉ ุชูุชูุด ูุชููุฑ ููุง ุณุฌู ุงูุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong><strong>ูุงุฐุง ุญุฏุซ ูู ุงูููุงุฑุณุฉุ</strong></strong> </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุฅุถุงูุฉ ุฅูู ุงููุดุฑูุน (.Net Framework) ุ ุงุณุชุฎุฏููุง ุญุฒูุฉ Prometheus.Client.3.0.2 ูุฌูุน ุงูููุงููุณ.  ูุฌูุน ุงูููุงููุณ ุ ุชูุช ุฅุถุงูุฉ ุงูุทุฑู ูุงููุตูู ุงููุงุฒูุฉ ุฅูู ุงููุดุฑูุน ูุชุฎุฒูู ุงูููุงููุณ ุญุชู ูุชู ุงุณุชูุงููุง ุจูุงุณุทุฉ Prometheus. </p><br><p style=";text-align:right;direction:rtl">  ุชู ุชุนุฑูู ูุงุฌูุฉ IMetricsService ูู ุงูุฃุตู ุนูู ุฃููุง ุชุญุชูู ุนูู ุฃุณุงููุจ ุงููุคูุช ูููุงุณ ูุฏู ุนูู ุงูุทุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public interface IMetricsService { Stopwatch StartTimer(); void StopTimer(Stopwatch timer, string controllerName, string actionName, string methodName = "POST"); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุถูู ูุฆุฉ MetricsService ุ ุงูุชู ุชููุฐ ูุงุฌูุฉ IMetricsService ูุชุฎุฒูู ุงูููุงููุณ ูุคูุชูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public class MetricsService : IMetricsService { private static Histogram _histogram; static MetricsService() { _histogram = CreateHistogram(); } public Stopwatch StartTimer() { try { var timer = new Stopwatch(); timer.Start(); return timer; } catch (Exception exception) { Logger.Error(exception); } return null; } public void StopTimer(Stopwatch timer, string controllerName, string actionName, string methodName = "POST") { try { if (timer == null) { throw new ArgumentException($"{nameof(timer)} can't be null."); } timer.Stop(); _histogram .WithLabels(controllerName, actionName, methodName) .Observe(timer.ElapsedMilliseconds, DateTimeOffset.UtcNow); } catch (Exception exception) { Logger.Error(exception); } } public static List&lt;string&gt; GetAllLabels() { var metricsList = new List&lt;string&gt;(); try { foreach (var keyValuePair in _histogram.Labelled) { var controllerName = keyValuePair.Key.Labels[0].Value; var actionName = keyValuePair.Key.Labels[1].Value; var methodName = keyValuePair.Key.Labels[2].Value; var requestDurationSum = keyValuePair.Value.Value.Sum; var requestCount = keyValuePair.Value.Value.Count; metricsList.Add($"http_request_duration_widget_sum{{controller={controllerName},action={actionName},method={methodName}}} {requestDurationSum}"); metricsList.Add($"http_request_duration_widget_count{{controller={controllerName},action={actionName},method={methodName}}} {requestCount}"); } _histogram = CreateHistogram(); } catch (Exception exception) { Logger.Error(exception); } return metricsList; } private static Histogram CreateHistogram() { var newMetrics = Metrics .WithCustomRegistry(new CollectorRegistry()) .CreateHistogram(name: "http_request_duration_web_api", help: "Histogram metrics of Web.Api", includeTimestamp: true, labelNames: new[] { "controller", "action", "method" }); var oldValue = _histogram; for (var i = 0; i &lt; 10; i++) { var oldValue = Interlocked.Exchange&lt;Histogram&gt;(ref oldValue, newMetrics); if (oldValue != null) { return oldValue; } } return null; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุงุณุชุฎุฏุงู ุงููุตู ุงูุฎุงุต ุจูุง ูุญูุธ ุงูููุงููุณ ุงูุชู ูุฎุทุท ูุฌูุนูุง ูู ุงูุฃุณุงููุจ Application_BeginRequest ู Application_Error ู Application_EndRequest.  ูู ูุฆุฉ Global.cs ุ ูุถูู ูุฌููุนุฉ ูู ุงูููุงููุณ ุฅูู ุงูุฃุณุงููุจ ุงููุฐููุฑุฉ ุฃุนูุงู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private IMetricsService _metricsService; protected virtual void Application_BeginRequest(object sender, EventArgs e) { var context = new HttpContextWrapper(HttpContext.Current); var metricServiceTimer = _metricsService.StartTimer(); context.Items.Add("metricsService", _metricsService); context.Items.Add("metricServiceTimer", metricServiceTimer); } protected virtual void Application_EndRequest(object sender, EventArgs e) { WriteMetrics(new HttpContextWrapper(HttpContext.Current)); } protected void Application_Error(object sender, EventArgs e) { WriteMetrics(new HttpContextWrapper(HttpContext.Current)); } private void WriteMetrics(HttpContextBase context) { try { _metricsService = context.Items["metricsService"] as IMetricsService; if (_metricsService != null) { var timer = context.Items["metricServiceTimer"] as Stopwatch; string controllerName = null; string actionName = null; var rd = RouteTable.Routes.GetRouteData(context); if (rd != null) { controllerName = rd.GetRequiredString("controller"); actionName = rd.GetRequiredString("action"); } _metricsService.StopTimer(timer, controllerName, actionName, context.Request.HttpMethod); } } catch (Exception exception) { Logger.Error("Can't write metrics.", exception); } }</code> </pre><br><p style=";text-align:right;direction:rtl">  ุฃุถู ูุญุฏุฉ ุชุญูู ุฌุฏูุฏุฉ ุ ูุงูุชู ุณุชููู ููุทุฉ ูุฑุฌุนูุฉ ูุฅุฑุณุงู ููุงููุณ API ุงูุฎุงุตุฉ ุจูุง ุฅูู Prometheus: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public class MetricsController : Controller { [HttpGet] public string[] GetAllMetrics() { try { var metrics = MetricsService.GetAllLabels(); return metrics.ToArray(); } catch (Exception exception) { Logger.Error(exception); } return new string[] { }; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณุชููู ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุชูููู ุชููุฆุฉ Prometheus ูุฌูุน ุงูููุงููุณ ูู ูุณู scrape_configs ุ ูุจุนุฏ ุฐูู ูููููุง ุฃู ูุฑู ุงูููุงููุณ ุงูุชู ุชู ุฌูุนูุง ุจุงููุนู ูู Prometheus ุฃู Grafana UI. </p><br><p style=";text-align:right;direction:rtl">  <strong><strong>ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ ุงูุชู ููุง ููุชููู ุจูุง ูู ุจุฑูููุซููุณ:</strong></strong> </p><br><p style=";text-align:right;direction:rtl">  ูููุฐุฌ ุงูุจูุงูุงุช ูุชุนุฏุฏ ุงูุฃุจุนุงุฏ: ุงูููุงููุณ ูุงูุนูุงูุงุช. <br>  ูุบุฉ ุงุณุชุนูุงู PromQL ูุฑูุฉ.  ูู ููุณ ููุดุบู ุงูุงุณุชุนูุงู ุ ูููููุง ุงุณุชุฎุฏุงู ุนูููุงุช ูุซู ุงูุถุฑุจ ูุงูุฅุถุงูุฉ ูุงูุชุณูุณู ููุง ุฅูู ุฐูู ุ  ูููู ุฃู ูุคุฏููุง ูุน ููุงููุณ ูุชุนุฏุฏุฉ. <br>  ูุฌูุน ุงูุจูุงูุงุช ุงููุณุชูุฏุฉ ุฅูู HTTP ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุณุญุจ. <br>  ูุชูุงูู ูุน ุทุฑููุฉ ุงูุฏูุน ุนุจุฑ Pushgateway. <br>  ูู ุงููููู ุฌูุน ุงูููุงููุณ ูู ุงูุชุทุจููุงุช ุงูุฃุฎุฑู ูู ุฎูุงู ุงููุตุฏุฑูู. <br>  ูููุฑ ุขููุฉ ูููุน ููุฏุงู ุงูุจูุงูุงุช. <br>  ูุฏุนู ุงูุชูุซููุงุช ุงูุฑุณูููุฉ ุงููุฎุชููุฉ ููุจูุงูุงุช. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar475600/">https://habr.com/ru/post/ar475600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar475588/index.html">ุซูุงุซุฉ ููุงุฐุฌ</a></li>
<li><a href="../ar475590/index.html">ุชุฑุฌูุฉ ุงูุจุฑุงูุฌ ุจุงุณุชุฎุฏุงู Notepad ++</a></li>
<li><a href="../ar475594/index.html">ุฌุงูุง ุณูุฑูุจุช ูุณููุฉ: ูุนุงุฏูุฉ ุฎุทูุฉ ุชูุฑูุจุง</a></li>
<li><a href="../ar475596/index.html">ุซุจุช ูุฑุถูุงุช ุนุฏุฏ ุฃููู ูุจูุฑ ูุฃูุธูุฉ ุนุฏุฏ ุตุบูุฑ</a></li>
<li><a href="../ar475598/index.html">ุชูุธูู ุจููุฉ ุจุณูุทุฉ ูู ุชุทุจูู Android ูุน ูุฌููุนุฉ ูู ViewModel + LiveData ู Retrofit + Coroutines</a></li>
<li><a href="../ar475604/index.html">ุชูููู ูุงูุจ PostgreSQL ุงูุฑุณูู ุนูู Zabbix 4.4</a></li>
<li><a href="../ar475608/index.html">ูุฏูุฑ ุนูุงูุงุช Google: ุฅุนุฏุงุฏุงุช ูุดุบู ุบูุฑ ูุงุถุญุฉ ููููุฏุฉ</a></li>
<li><a href="../ar475610/index.html">ูุตุงุจูุญ ุงูุทุงููุฉ LED ุงูุขููุฉ ุงูุชู ุชุญุชูุธ ุจุงูุฑุคูุฉ</a></li>
<li><a href="../ar475612/index.html">ุชุนุทู ุ ูุชู ุ ุงูุชุฃููุฏุงุช ูุงูุซูุฉ ูู ุงูุชูููุฐ</a></li>
<li><a href="../ar475614/index.html">ุฃุชูุชุฉ ุฃุตุบุฑ. ุงูุฌุฒุก ุงูุซุงูู. ุชุตููู ุงูุดุจูุงุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>