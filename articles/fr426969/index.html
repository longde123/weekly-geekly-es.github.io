<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ üçö üëë Vigilant Lida: automatisation des tests de s√©curit√© üèÇüèæ üåÄ üë©üèª‚Äçü§ù‚Äçüë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, chers lecteurs. Je m'appelle Victor Burov, je suis d√©veloppeur chez ISPsystem. Dans le dernier article, j'ai parl√© de l' outil de cr√©ation d'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vigilant Lida: automatisation des tests de s√©curit√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/426969/">  Bonjour, chers lecteurs.  Je m'appelle Victor Burov, je suis d√©veloppeur chez ISPsystem.  Dans le dernier article, j'ai parl√© de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outil de cr√©ation d'autotests</a> , aujourd'hui je partagerai mon exp√©rience dans l'automatisation des tests de s√©curit√©. <br><br><img src="https://habrastorage.org/webt/9t/xm/uy/9txmuy_rzmrhxjp0mbe4hfobvq8.jpeg"><br><br>  Au d√©but, les vuln√©rabilit√©s des produits ont √©t√© recherch√©es par un employ√© distinct.  Les tests manuels ont pris beaucoup de temps et ne garantissaient pas que toutes les vuln√©rabilit√©s seraient trouv√©es.  Apr√®s avoir v√©rifi√© les lois de base des tests, nous sommes arriv√©s √† la conclusion qu'il peut √™tre automatis√©.  Ensuite, nous avons d√©cid√© d'√©crire un utilitaire qui facilitera la vie du testeur, lui fera gagner du temps et vous permettra de v√©rifier les produits apr√®s chaque changement.  Puisque le testeur s'appelait Lida, nous avons nomm√© la nouvelle application en son honneur.  En g√©n√©ral, dans notre entreprise, il est devenu une tradition d'appeler les outils de test par les noms des testeurs. <br><a name="habracut"></a><br>  Apr√®s avoir analys√© les utilitaires de recherche de vuln√©rabilit√©s, je suis arriv√© √† la conclusion qu'ils ont tous besoin de sp√©cifier les fonctions √† appeler et les param√®tres utilis√©s.  Nous avons de nouveau d√©cid√© de profiter de l'interface unifi√©e et formul√© les exigences pour Lida. <br><br><h4>  Conditions de d√©marrage: </h4><br><ol><li>  Construisez automatiquement des listes de fonctions. </li><li>  Options de saisie semi-automatique. </li><li>  Faire des requ√™tes API. </li><li>  Analyse de la sortie des donn√©es apr√®s l'ex√©cution des fonctions. </li><li>  Recherchez les vuln√©rabilit√©s dans les donn√©es. </li><li>  Formation de rapports. </li><li>  Param√®tres flexibles. </li></ol><br>  R√©aliser tout cela n'a pas √©t√© facile. <br><br><h2>  Impl√©mentation </h2><br><h3>  Contourner les formulaires et les listes </h3><br>  Pour trouver des vuln√©rabilit√©s dans une fonction, elle doit √™tre ex√©cut√©e en passant les param√®tres n√©cessaires.  Notre interface est construite sur la base de listes et de formulaires, vous pouvez donc automatiser la collecte de donn√©es en traitant des documents xml qui d√©crivent la structure des √©l√©ments de l'interface. <br><br>  J'ai d√©cid√© de d√©marrer l'exploration √† partir du menu principal, en rentrant r√©cursivement dans toutes les listes imbriqu√©es.  ¬´Lida¬ª ouvre la liste du premier niveau.  En r√®gle g√©n√©rale, il poss√®de plusieurs boutons qui invoquent certaines fonctions. <br><br>  Si le bouton ouvre le formulaire, le r√©sultat de l'appel sera un document xml avec des n≈ìuds contenant des informations sur les champs: nom, validateur, plage de valeurs valides.  Sur la base de ces informations, des valeurs de champ sont g√©n√©r√©es.  Par exemple, un nombre sera g√©n√©r√© pour int.  S'il n'y a pas de validateur, une cha√Æne al√©atoire est g√©n√©r√©e.  Apr√®s avoir rempli tous les champs du formulaire, une demande est envoy√©e. <br><br>  Si la fonction est une liste, elle sera ouverte et les fonctions associ√©es aux boutons seront appel√©es pour ses √©l√©ments. <br><br>  Lors de la v√©rification des listes, un probl√®me survient - toutes les listes doivent avoir un ensemble d'enregistrements qui garantissent que tous les boutons de la liste sont cliquables. <br><br><h3>  Recherche d'injection SQL </h3><br>  L'injection SQL est probablement l'un des probl√®mes les plus courants pour les applications, y compris la n√¥tre.  De nombreux appels de fonction g√©n√®rent diverses requ√™tes SGBD.  Une erreur se produit lorsque des param√®tres provenant de l'ext√©rieur sont substitu√©s ¬´tels quels¬ª dans le corps de la demande.  Les cons√©quences de telles erreurs peuvent √™tre tristes: de la r√©ception non autoris√©e de donn√©es √† la suppression de tableaux. <br><br>  Pour d√©marrer la recherche d'injections SQL, j'ai organis√© la sortie de toutes les requ√™tes SQL vers un fichier.  Une fois la fonction ex√©cut√©e, l'application recherche les valeurs des param√®tres pass√©s dans les requ√™tes SQL r√©sultantes. <br><br>  <i>Vous pouvez utiliser le journal du serveur SQL lui-m√™me.</i>  <i>Mais dans notre cas, il n'y a qu'une seule m√©thode pour ex√©cuter des requ√™tes et y ajouter la journalisation n'a pas √©t√© difficile.</i>  <i>Gr√¢ce √† cela, nous savons exactement quel d√©fi a g√©n√©r√© telle ou telle demande.</i> <br><br>  Lorsque la valeur du param√®tre transmis est trouv√©e, l'utilitaire transmet une valeur contenant un guillemet simple √† ce param√®tre.  Si la citation se trouve dans la m√™me s√©quence, le param√®tre n'est pas √©chapp√© - nous avons trouv√© une place pour l'injection SQL. <br><br><h3>  Analyse des appels syst√®me </h3><br>  Un probl√®me similaire se produit lorsque nous effectuons des appels syst√®me.  J'ai d√©cid√© de les rechercher avec strace et j'ai s√©lectionn√© les param√®tres de lancement optimaux pour cela.  Exemple de d√©marrage d'ISPmanager: <br><br><pre><code class="xml hljs">strace -f -s 1024 -e trace=file,process bin/core ispmgr</code> </pre> <br>  Comme pour les injections SQL, Lida ex√©cute une fonction et analyse la sortie strace pour <i>trouver les</i> valeurs des param√®tres pass√©s dans les fonctions <i>open, unlink, rmdir, chmod chown, chflags, mknod, mkfifo, fcntl, symlink, link, execve, mkdir</i> . <br><br>  Si le param√®tre est trouv√©, l'utilitaire lui transmet une valeur contenant, par exemple, un chemin d'acc√®s avec une transition vers le r√©pertoire ci-dessus.  S'il se pr√©sente tel quel, une vuln√©rabilit√© potentielle est d√©tect√©e. <br><br>  L'analyse de la fonction execve s'est av√©r√©e tr√®s utile.  Il vous permet de d√©terminer dans quelle fonction les arguments pour ex√©cuter les fichiers ex√©cutables ne sont pas √©chapp√©s.  Cette erreur est tr√®s co√ªteuse, car gr√¢ce √† elle, vous pouvez obtenir un acc√®s root au serveur simplement en changeant le mot de passe. <br><br><blockquote>  Lorsque les utilisateurs trouvent une vuln√©rabilit√© dans nos produits, l'entreprise verse une r√©compense en esp√®ces, dont le montant d√©pend de la cat√©gorie de vuln√©rabilit√©.  Cette approche peut √™tre moins co√ªteuse que la recherche d'erreurs par vous-m√™me (le testeur peut ne pas trouver l'erreur et obtenir un salaire). </blockquote><br>  <i>Un autre test int√©ressant: v√©rifier l'ordre d'appeler les fonctions stat et autres.</i>  <i>Souvent, l'acc√®s est d'abord v√©rifi√© par stat, puis par des actions dangereuses, ce qui laisse la possibilit√© de substitution.</i>  <i>Mais nous n'avons pas automatis√© cela.</i> <br><br><h3>  V√©rification de l'acc√®s aux objets √©trangers </h3><br>  Nous v√©rifions l'acc√®s aux objets √©trangers sous l'utilisateur pour les entit√©s d'un autre utilisateur et administrateur.  Dans ce mode, nous v√©rifions la possibilit√© de lire, modifier et visualiser les listes d'√©l√©ments d'un utilisateur √©tranger. <br><br>  Lida contourne toutes les fonctions disponibles au nom du propri√©taire ou de l'administrateur et se souvient de leurs √©l√©ments.  Ensuite, il appelle les m√™mes fonctions avec des √©l√©ments provenant d'un autre utilisateur.  Dans une situation id√©ale, la r√©ponse devrait √™tre une erreur telle que Acc√®s ou Manqu√©.  Si une telle erreur n'est pas re√ßue, il est donc tr√®s probable que vous puissiez lire les donn√©es de l'utilisateur de quelqu'un d'autre. <br><br>  Dans certains cas, l'absence d'erreur ne signifie pas que vous pouvez acc√©der directement aux objets d'autres utilisateurs.  Au d√©but de ces fonctions, nous ajoutons une v√©rification des autorisations des √©l√©ments.  Cela v√©rifie non seulement la s√©curit√©, mais √©galement l'exactitude des r√©ponses du serveur. <br><br><h3>  Validation API </h3><br>  La validation de notre API est un bonus suppl√©mentaire de v√©rification des fonctions pour les vuln√©rabilit√©s.  En analysant les rapports sur le travail de Lida, nous avons appris √† renvoyer les types d'erreurs corrects, ce qui a rendu notre API plus pratique et logique.  En cons√©quence, comme avec le magn√©tophone, nous avons re√ßu non seulement un contr√¥le de s√©curit√©, mais aussi une fois de plus v√©rifi√© la coh√©rence de notre API. <br><br><h2>  Des difficult√©s </h2><br><h4>  Faux positifs </h4><br>  L'utilitaire peut fonctionner avec tous nos produits, par cons√©quent, il v√©rifie de nombreuses fonctions diff√©rentes.  Fondamentalement, les faux positifs sont apparus dans le mode de v√©rification de l'acc√®s aux objets √©trangers.  Cela est d√ª aux caract√©ristiques des boutons et des fonctions. <br><br>  Les faux positifs √©taient le plus gros probl√®me de Lida.  Il semblait qu'il √©tait compl√®tement d√©bogu√©, mais lors de la v√©rification sur diff√©rents panneaux, de nouveaux faux positifs sont apparus.  En cons√©quence, il y a eu plusieurs √©tapes de leur correction. <br><br><h4>  Cr√©ation d'entit√© </h4><br>  La plupart des actions du panneau sont effectu√©es sur n'importe quelle entit√© (nom de domaine, base de donn√©es, etc.).  Pour atteindre une automatisation maximale, Lida a d√ª cr√©er ces entit√©s automatiquement.  Mais en pratique, cela s'est av√©r√© difficile √† mettre en ≈ìuvre.  Parfois, la validation est effectu√©e dans le code, il n'est donc pas toujours possible de remplacer automatiquement une valeur de param√®tre.  La deuxi√®me raison est les entit√©s d√©pendantes.  Par exemple, pour cr√©er une bo√Æte aux lettres, vous devez cr√©er un domaine de messagerie. <br><br>  Par cons√©quent, nous avons d√©cid√© de ne pas lutter pour une automatisation compl√®te.  Avant de commencer, le testeur cr√©e des entit√©s manuellement et prend un instantan√© de la machine, car les entit√©s seront modifi√©es apr√®s v√©rification.  Cela vous permet de ne pas ignorer la v√©rification d'un groupe de fonctions en cas de cr√©ation infructueuse d'une entit√©. <br><br><h4>  Appel de fonctions destructrices </h4><br>  Presque chaque liste a des fonctions pour supprimer ou d√©sactiver une entit√©.  Si vous les ex√©cutez en s√©quence, l'entit√© sera supprim√©e avant d'ex√©cuter d'autres fonctions.  Je d√©finis de telles fonctions et j'ex√©cute apr√®s d'autres.  Ajout d'une cl√© qui interdit l'ex√©cution de telles fonctions. <br><br>  Certaines fonctions red√©marrent le serveur.  Ils doivent √™tre suivis et ajout√©s √† la liste des ignor√©s. <br><br>  En raison de la nature de la logique de fonctionnement, certaines fonctions red√©marrent le panneau.  Pendant les tests de s√©curit√©, cela entra√Æne le d√©marrage du panneau sans tracer les requ√™tes SQL ou strace - une v√©rification suppl√©mentaire n'a plus de sens.  Vous devez suivre cela et red√©marrer le panneau en mode trace. <br><br><h4>  V√©rification des param√®tres d√©pendants </h4><br>  Sur les formulaires, il existe des champs de saisie de texte, des cases √† cocher, des listes d√©roulantes, dont les valeurs d√©pendent de la disponibilit√© des valeurs des autres champs.  Chaque valeur du champ d√©pendant peut avoir une section de code distincte, par cons√©quent, les parties lorsqu'elles peuvent rester non v√©rifi√©es. <br><br>  Pour r√©soudre ce probl√®me, j'ai ajout√© des algorithmes pour analyser les champs d√©pendants et v√©rifier toutes les combinaisons de contr√¥les d√©pendants. <br><br><h4>  V√©rification des fonctionnalit√©s non disponibles dans l'interface </h4><br>  Les fonctions de service ne sont pas disponibles pour la transition, mais peuvent contenir des vuln√©rabilit√©s.  Pour les identifier et les v√©rifier, nous avons une fonction sp√©ciale qui renvoie une liste de toutes les fonctions enregistr√©es.  Nous comparons cette liste avec la liste des fonctions test√©es.  Il n'y a pas de m√©tadonn√©es pour les fonctions de service, il est donc impossible de v√©rifier les param√®tres trait√©s √† l'int√©rieur. Pour v√©rifier ces fonctions, je leur transmets nos param√®tres standard <i>elid, plid</i> et autres. <br><br><h2>  Conclusion </h2><br>  Nous avons inclus Lida dans chaque construction de nuit √† Jenkins.  Sur la base des r√©sultats de son travail, un rapport de v√©rification est g√©n√©r√©, des informations sur la fonction suspecte y sont affich√©es avec tous les param√®tres. <br><br>  La t√¢che cl√¥tur√©e par le d√©veloppeur est d√©sormais v√©rifi√©e non seulement par le testeur, mais aussi par Lida.  Le testeur traite le rapport re√ßu: copie les param√®tres de la fonction suspecte dans le navigateur et analyse le comportement et le panneau de journalisation.  Si la vuln√©rabilit√© est confirm√©e, l'erreur est consign√©e aupr√®s du d√©veloppeur. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426969/">https://habr.com/ru/post/fr426969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426959/index.html">Installer kubernetes via kubespray (stockage local, installer Elasticsearch + Fluentd + Kibana, prometheus)</a></li>
<li><a href="../fr426961/index.html">Comment Microsoft a r√©√©crit le compilateur C # en C # et l'a ouvert</a></li>
<li><a href="../fr426963/index.html">Les applications Flutter r√™vent-elles de widgets bas√©s sur une plateforme?</a></li>
<li><a href="../fr426965/index.html">Qu'adviendra-t-il de la gestion des erreurs en C ++ 2a</a></li>
<li><a href="../fr426967/index.html">G√©n√©rateur de code ABAP en ligne</a></li>
<li><a href="../fr426971/index.html">Fatalisme dans la gestion des erreurs</a></li>
<li><a href="../fr426973/index.html">Sandwichs d'entreprise</a></li>
<li><a href="../fr426975/index.html">Joker 2018: l'impossible est possible</a></li>
<li><a href="../fr426977/index.html">LibreOffice: le cauchemar d'un comptable</a></li>
<li><a href="../fr426979/index.html">Comment apprendre l'anglais gratuitement: 3 outils communs et des instructions d√©taill√©es pour chacun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>