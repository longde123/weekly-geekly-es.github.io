<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∫ üë®üèø‚Äçü§ù‚Äçüë®üèº üò∏ EME? Cdm? DRM? CENC? IDK! Ce dont vous avez besoin pour cr√©er votre propre lecteur vid√©o dans un navigateur üéÇ üñêüèæ üë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Que signifient toutes ces abr√©viations? Que faut-il pour d√©velopper un lecteur open source pour regarder des vid√©os d'Amazon, Sky et d'autres platefor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>EME? Cdm? DRM? CENC? IDK! Ce dont vous avez besoin pour cr√©er votre propre lecteur vid√©o dans un navigateur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/426727/"> Que signifient toutes ces abr√©viations?  Que faut-il pour d√©velopper un lecteur open source pour regarder des vid√©os d'Amazon, Sky et d'autres plateformes et regarder des vid√©os de n'importe quel fournisseur?  Sebastian Golasch a expliqu√© comment le processus de streaming vid√©o se d√©roule lors de la conf√©rence HolyJS 2018 Piter.  Sous la coupe - vid√©o et traduction de son rapport. <br><br><img src="https://habrastorage.org/webt/et/to/7c/etto7cv1khykp68gwreip_8rfy4.jpeg"><br><br>  <i>Sebastian Golasch est actuellement d√©veloppeur chez Deutsche Telekom.</i>  <i>Il a longtemps travaill√© avec Java et PHP, puis est pass√© √† JS, Python et Rust.</i>  <i>Depuis sept ans, il travaille sur la plateforme propri√©taire de la maison intelligente Qivicon.</i> <br><br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3Y3R_snaDDc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2>  Un peu sur l'histoire du streaming vid√©o </h2><br>  Tout d'abord, regardons l'histoire du Web, car nous sommes pass√©s de QuickTime √† Netflix en 25 ans.  Tout a commenc√© dans les ann√©es 90 quand Apple a invent√© QuickTime.  Son utilisation sur Internet a commenc√© en 1993-1994.  √Ä cette √©poque, le lecteur pouvait lire des vid√©os avec une r√©solution de 156 √ó 116 pixels et une fr√©quence de 10 FPS, sans acc√©l√©ration mat√©rielle (en utilisant uniquement les ressources du processeur).  Ce format √©tait ax√© sur une connexion commut√©e √† 9600 bauds - 9600 bps, y compris les informations de surcharge. <br><br>  C'√©tait l'√©poque du navigateur Netscape.  La vid√©o dans le navigateur n'avait pas l'air trop belle, car elle n'√©tait pas native du Web.  Pour la lecture, nous avons utilis√© un logiciel externe (le m√™me QuickTime) avec sa propre interface, qui a √©t√© visualis√©e dans le navigateur √† l'aide de la balise embed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/664/455/137/664455137979de92508841f0d3ceaafa.png"><br><br>  La situation s'est un peu am√©lior√©e lorsque Macromedia a sorti le Shockwave Player (apr√®s le rachat de Macromedia par Adobe, il est devenu Adobe Flash Player).  La premi√®re version de Shockwave Player est sortie en 1997, mais la lecture vid√©o n'y est apparue qu'en 2002. <br><br>  Ils ont utilis√© le codec Sorenson Spark aka H.263.  Il a √©t√© optimis√© pour les petites r√©solutions et les petits fichiers.  Qu'est-ce que cela signifie?  Par exemple, une vid√©o de 43 secondes qui a √©t√© utilis√©e pour tester le Shockwave Player ne pesait que 560 Ko.  Bien s√ªr, il ne serait pas tr√®s agr√©able de regarder un film de cette qualit√©, mais la technologie elle-m√™me √©tait int√©ressante pour l'√©poque.  Cependant, comme dans le cas de QuickTime, pour que Shockwave Player fonctionne dans le navigateur, un logiciel suppl√©mentaire √©tait n√©cessaire.  Ce lecteur avait beaucoup de probl√®mes de s√©curit√©, mais le plus important est que la vid√©o √©tait toujours un module compl√©mentaire de navigateur. <br><br>  En 2007, Microsoft a sorti Silverlight, qui rappelle quelque peu Flash.  Nous n'allons pas creuser profond√©ment, mais toutes ces solutions avaient quelque chose en commun - une bo√Æte noire.  Tous les joueurs fonctionnaient comme un module compl√©mentaire de navigateur, et vous n'aviez aucune id√©e de ce qui se passait √† l'int√©rieur. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84b/418/52e/84b41852efd2fb39dbea144b2e898dfe.png"><br><br>
<h2>  √âl√©ment &lt; <code>Video/</code> &gt; </h2><br>  En 2007, Opera a propos√© d'utiliser la balise &lt; <code>Video/</code> &gt;, c'est-√†-dire de cr√©er une vid√©o native dans un navigateur.  Nous l'utilisons aujourd'hui.  C'est facile et pratique, et n'importe quelle vid√©o peut non seulement √™tre visionn√©e, mais √©galement t√©l√©charg√©e.  Et m√™me si nous ne voulons pas autoriser le t√©l√©chargement de vid√©os, nous ne pouvons pas interdire de les t√©l√©charger sur le navigateur.  Le maximum est de rendre le t√©l√©chargement vid√©o plus difficile. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cac/3be/693/cac3be693c7a3328062521d828c12c38.png"><br><br>  La <code>&lt;Video/&gt;</code> est exactement l'oppos√© de la bo√Æte noire, et la visualisation du code source est tr√®s simple. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca1/f23/708/ca1f237081ed5a6a9e648b65e05ea7a1.png"><br><br><h2>  DRM </h2><br>  Cependant, vous ne pouvez pas simplement cliquer avec le bouton droit sur une vid√©o sur Netflix et s√©lectionner "Enregistrer sous".  La raison en est DRM (Digital Restrictions Management).  Ce n'est pas une technologie ou une application unique qui effectue une t√¢che.  Il s'agit d'un terme g√©n√©ral pour des concepts tels que: <br><br><ul><li>  Authentification et cryptage utilisateur </li><li>  Cryptage bas√© sur le contenu </li><li>  D√©finition des droits et application des restrictions </li><li>  Commentaires et mise √† jour </li><li>  Contr√¥le de sortie et protection de liaison </li><li>  Examen et suivi des intrus </li><li>  Gestion des cl√©s et des licences </li></ul><br>  Pour comprendre ce qu'est la DRM, nous devons √©tudier son √©cosyst√®me, c'est-√†-dire d√©terminer quelles entreprises sont impliqu√©es.  C‚Äôest: <br><br><ul><li>  <b>Les propri√©taires de contenu</b> sont au sommet de l'√©cosyst√®me.  Par exemple, Disney, MGM ou FIFA.  Ces soci√©t√©s produisent du contenu et y ont des droits. </li><li>  <b>Les noyaux DRM</b> sont des soci√©t√©s qui fournissent la technologie DRM (par exemple, Google, Apple, Microsoft, etc.). Actuellement, il existe environ 7 √† 8 technologies DRM de diff√©rentes soci√©t√©s. </li><li>  <b>Fournisseurs de services</b> - D√©velopper un logiciel serveur qui crypte la vid√©o. </li><li>  <b>Navigateurs</b> qui sont en fait des joueurs. </li><li>  <b>Les fournisseurs de contenu</b> sont des soci√©t√©s telles que Netflix, Amazon, Sky, etc. En r√®gle g√©n√©rale, ils ne poss√®dent pas les droits sur le contenu, ils le conc√®dent sous licence et le distribuent. </li><li>  <b>Les fournisseurs de puces / p√©riph√©riques</b> sont √©galement impliqu√©s dans l'√©cosyst√®me, car DRM n'est pas seulement une technologie logicielle.  Certaines entreprises (principalement chinoises) d√©veloppent des puces qui encodent et d√©codent la vid√©o. </li></ul><br>  Vous √™tes-vous d√©j√† demand√© pourquoi, lorsque vous regardez une vid√©o sur Netflix dans un navigateur, elle n'a pas une tr√®s haute r√©solution (SD), mais si vous regardez la m√™me vid√©o sur une Apple TV ou une Android TV Box, le m√™me contenu est lu en Full HD ou en 4K?  DRM en est √©galement responsable.  Le fait est que les fabricants ont toujours peur que des pirates volent du contenu.  Par cons√©quent, moins l'environnement est s√©curis√© dans lequel le d√©codage vid√©o est effectu√©, plus la qualit√© est mauvaise pour l'utilisateur.  Par exemple, si le d√©codage est effectu√© par programme (par exemple, dans Chrome ou Firefox), la vid√©o est affich√©e dans la pire qualit√©.  Dans un environnement o√π les capacit√©s mat√©rielles de d√©codage sont utilis√©es (par exemple, si Android utilise un GPU), les possibilit√©s de copie ill√©gale de contenu sont moindres, et ici la qualit√© de lecture est plus √©lev√©e.  Enfin, l'environnement le plus s√©curis√© est enti√®rement mat√©riel (Apple TV ou Android TV Box), o√π le d√©codage et la lecture sont effectu√©s sans impliquer le logiciel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f9/4fb/1bb/9f94fb1bb7c1fa9d31a02d2bf62950f0.png"><br><br>  Mais si nous parlons de navigateurs, leur d√©codage est presque toujours effectu√© par un logiciel.  Diff√©rents navigateurs utilisent diff√©rents syst√®mes pour DRM.  Chrome et Firefox utilisent Widevine.  Cette soci√©t√© appartient √† Google et conc√®de sous licence leurs applications DRM.  Ainsi, pour le d√©codage, Firefox t√©l√©charge la biblioth√®que DRM de Google.  Dans le navigateur, vous pouvez voir d'o√π vient le t√©l√©chargement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca9/49d/015/ca949d015734b50c36e8594b8f5a4370.png"><br><br>  Apple utilise son propre syst√®me FairPlay, qui a √©t√© cr√©√© lorsque la soci√©t√© a pr√©sent√© le premier iPhone et iPad.  Microsoft utilise √©galement son propre d√©veloppement appel√© PlayReady, qui est int√©gr√© √† Windows.  Dans d'autres cas, Widevine est le plus souvent utilis√©.  Ce syst√®me existe √† la fois comme application et comme solution mat√©rielle - des puces qui d√©codent la vid√©o. <br><br><h2>  Cdm </h2><br>  L'abr√©viation CDM signifie Content Decryption Module.  Il s'agit d'un logiciel ou d'un mat√©riel qui peut fonctionner de plusieurs mani√®res: <br><br><ul><li>  D√©chiffrez la vid√©o, apr√®s quoi elle est rendue dans le navigateur √† l'aide de la balise &lt;Video /&gt;. </li><li>  D√©chiffrez et d√©codez la vid√©o, puis transf√©rez les images brutes de la vid√©o pour les lire dans le navigateur. </li><li>  D√©chiffrez et d√©codez la vid√©o, puis transf√©rez les images brutes de la vid√©o pour la lecture √† l'aide du GPU. </li></ul><br>  Malgr√© le support du GPU, la deuxi√®me option est le plus souvent utilis√©e (au moins en ce qui concerne Chrome et Firefox). <br><br><h2>  D√©codage et d√©codage des couches dans le navigateur </h2><br>  Alors, comment tout cela fonctionne-t-il ensemble?  Pour comprendre cela, regardez les couches de d√©codage et de d√©cryptage dans le navigateur.  Ils sont divis√©s en: <br><br><ul><li>  Application JavaScript - elle indique √† l'ordinateur quelle vid√©o je vais regarder. </li><li>  Un navigateur est un lecteur qui lit du contenu vid√©o. </li><li>  Module de d√©cryptage de contenu. </li><li>  La gestion des droits num√©riques est tout au sujet du d√©codage vid√©o (je ne pouvais pas trouver une meilleure notation, donc je l'ai appel√© ainsi). </li><li>  Ex√©cution fiable. </li><li>  Dans ce cas, les deux premiers composants sont un lecteur DRM, le module de d√©cryptage de contenu est un client DRM et les deux derniers composants sont le noyau DRM. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b2b/7da/87b/b2b7da87bf7b3b92ef4004f4d4b97800.png"><br><br>  Ce qui se passe lorsque vous lisez une vid√©o dans un navigateur est illustr√© dans l'image ci-dessous.  Bien s√ªr, elle est un peu d√©routante: il y a beaucoup de fl√®ches et de couleurs.  Je vais le parcourir √©tape par √©tape, en utilisant des cas r√©els pour le rendre plus clair <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1e/982/bb7/b1e982bb7fe74fa39f08b00264987409.png"><br><br>  Nous utiliserons Netflix comme exemple.  J'ai √©crit une application de d√©bogage. <br><br>  J'ai commenc√© par o√π, je pense, chacun de vous commencerait: j'ai regard√© les demandes que Netflix fait lorsque je d√©marre une vid√©o, et j'ai vu un grand nombre d'enregistrements. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b04/913/8d7/b049138d7a4da37f5b9b6c5e4da88bf3.png"><br><br>  Cependant, si vous ne laissez que ceux qui sont vraiment n√©cessaires pour lire la vid√©o, il s'av√®re qu'il n'y en a que trois: manifeste, licence et le premier fragment de la vid√©o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/381/e12/a9f/381e12a9f194014ae19501e4e9ada763.png"><br><br>  Le lecteur Netflix est √©crit en JavaScript et contient plus de 76 000 lignes de code, et, bien s√ªr, je ne peux pas l'analyser compl√®tement.  Mais je voudrais montrer les principales parties n√©cessaires √† la lecture de vid√©os prot√©g√©es. <br><br>  Nous allons commencer avec le mod√®le: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ba/205/e6f/9ba205e6f022e4a99ffa373372c99047.png"><br><br><h2>  EME </h2><br>  Mais avant de nous plonger dans les fonctions, nous devons nous familiariser avec une autre technologie - EME (Encrypted Media Extensions, encrypted media extensions).  Cette technologie n'effectue pas le d√©cryptage et le d√©codage, c'est juste une API de navigateur.  EME sert d'interface pour CDM, pour KeySystem, pour un serveur avec une licence et pour un serveur o√π le contenu est stock√©. <br><br>  Commen√ßons donc avec getKeySystemConfig. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e68/179/765/e68179765d8d942b41efd0a05fb51cd4.png"><br><br>  Il convient de garder √† l'esprit que cela d√©pend du fournisseur, donc la configuration que je pr√©sente ici fonctionne pour Netflix, mais ne fonctionne pas, par exemple, pour Amazon. <br><br>  Dans cette configuration, nous devons indiquer au syst√®me backend quel niveau d'ex√©cution de confiance nous pouvons offrir.  Il peut s'agir d'un d√©codage mat√©riel s√©curis√© ou d'un d√©codage logiciel s√©curis√©.  Autrement dit, nous indiquons au syst√®me le mat√©riel et les logiciels qui seront utilis√©s pour la lecture.  Et cela d√©terminera la qualit√© du contenu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0f/071/1dd/c0f0711ddf9da278d6ab4c23ff31f75c.png"><br><br>  Une fois la configuration configur√©e, envisagez de cr√©er un MediaKeySystem initial. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99a/62b/ccb/99a62bccbf59fc6c893db5b34b3e3c91.png"><br><br>  C'est l√† que l'interaction avec le module de d√©cryptage de contenu commence.  Vous devez indiquer √† l'API le syst√®me DRM et le syst√®me de cl√©s que nous utilisons.  Dans notre cas, c'est Widevine. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e31/ff8/416/e31ff841688a7f78547c02723c31c11c.png"><br><br>  L'√©tape suivante est facultative pour tous les syst√®mes, mais obligatoire pour Netflix.  Encore une fois, sa n√©cessit√© d√©pend du fournisseur.  Nous devons appliquer un certificat de serveur √† nos mediaKeys.  Les certificats de serveur sont du texte brut dans un fichier Netflix Cadmium.js qui peut √™tre facilement copi√©.  Et lorsque nous l'appliquons √† mediaKeys, toutes les communications entre le serveur avec la licence et notre navigateur deviennent s√©curis√©es gr√¢ce √† l'utilisation de ce certificat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3c/601/dd1/d3c601dd109f2a67e84efe69ca76ba6a.png"><br><br>  Lorsque cela est fait, nous devons nous tourner vers l'√©l√©ment d'origine de la vid√©o et dire: ¬´Ok, c'est le syst√®me cl√© que nous voulons utiliser, et c'est le tag vid√©o bonjour.  Laissez-nous vous unir. " <br><br><img src="https://habrastorage.org/getpro/habr/post_images/797/6cf/3ce/7976cf3ce8dacf000547d40084d16d22.png"><br><br>  Et voici la derni√®re fonction dont vous avez besoin pour configurer le syst√®me vid√©o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/107/ce0/fa0/107ce0fa0c047fd77218983652e0aa89.png"><br><br>  Il s'agit d'une session DRM ou MediaKeySession.  Ce ne sont que les donn√©es qui vont du fournisseur au module de d√©cryptage qui signe les demandes avec eux.  Ces donn√©es sont √©galement du texte brut, qui est cach√© derri√®re plusieurs fonctions dans le fichier du lecteur Netflix, d'o√π je les ai copi√©es. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed7/3a4/0a3/ed73a40a370d7744f55590fc9e23efa5.png"><br><br>  Lorsque nous appelons create.Session sur l'objet mediaKeys, nous devons indiquer quelle vid√©o nous prenons en charge.  Dans ce cas, c'est mp4.  Cela nous ram√®ne au contexte de messagerie avec notre syst√®me CDM.  Nous avons √©galement besoin de Netflix pour appliquer le certificat de serveur base64 dans chaque formulaire, mais toute cette configuration dans la session de cr√©ation est √† nouveau fournie en fonction du syst√®me DRM. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b24/8ff/e27/b248ffe2709055f4eadc33eab77df455.png"><br><br>  La derni√®re fonction ci-dessous - keySession.generateRequest cr√©e une demande de licence en arri√®re-plan.  Ou CDM cr√©e une demande de licence en arri√®re-plan.  En d'autres termes, il s'agit de donn√©es binaires brutes que nous devons envoyer au serveur sous licence afin d'obtenir en retour une licence valide. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/43c/798/16e/43c79816e9006b0668d58555887017b7.png"><br><br>  Ici, cenc est int√©ressant.  Il s'agit d'une norme de cryptage ISO qui d√©finit un sch√©ma de s√©curit√© pour la vid√©o mp4.  Dans WebM, cela s'appelle diff√©remment, mais la fonction effectue la m√™me chose. <br><br>  handleMessage est l'interface EventListener que nous avons configur√©e.  Lorsque cet √©v√©nement est d√©clench√© par l'√©v√©nement de message dans keySession, nous savons que nous sommes pr√™ts √† obtenir une licence du serveur. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ef/93b/e85/4ef93be85d1d8535408a1abed9ca9ec6.png"><br><br>  Et dans ce rappel, nous n'obtenons qu'une demande √† un serveur avec une licence qui donne des donn√©es binaires (elles peuvent √©galement diff√©rer selon le fournisseur).  Nous utilisons ces donn√©es pour mettre √† jour la session en cours en ajoutant une licence.  Autrement dit, d√®s que nous avons re√ßu une licence valide du serveur, notre CDM sait que nous pouvons d√©coder et d√©crypter la vid√©o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/779/ef3/ea9/779ef3ea918671d1c4a2d2df8d9c404d.png"><br><br>  Si nous appliquons cela au diagramme ci-dessous, nous obtenons ceci: nous voulons lire la vid√©o, et l'application JavaScript dit: ¬´Bonjour, navigateur!  Je veux lire la vid√©o! "  - utilise ensuite Encrypted Media Extensions et fait une demande aux fonctions de licence dans Widevine CDM pour une licence.  Cette demande est ensuite renvoy√©e au navigateur, et nous pouvons l'√©changer contre une licence valide sur le serveur de licences, puis nous devons retransf√©rer cette licence sur CDM.  Ce processus a √©t√© montr√© dans le code ci-dessus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a98/e80/622/a98e806221a4f2533f0155c8425a36b4.png"><br><br>  Mais notez que nous n'avons pas encore perdu une seconde de la vid√©o, et nous devons tous le faire afin de pouvoir lire certaines vid√©os √† l'avenir. <br><br><h2>  MSE </h2><br>  Et une autre technologie que nous devons rechercher est MSE (Media Source Extensions).  Elle peut √™tre appel√©e la demi-s≈ìur d'EME (Encrypted Media Extensions).  Il s'agit √©galement d'une API de navigateur et cela n'a rien √† voir avec DRM.  Je le vois comme une interface de programmation pour &lt; <code>Video/</code> &gt; Src.  En l'utilisant, vous pouvez cr√©er des flux binaires en JavaScript et appliquer des fragments vid√©o √† l'√©l√©ment &lt; <code>Video/</code> &gt;.  Ainsi, gr√¢ce √† lui, la source du tag &lt; <code>Video/</code> &gt; devient dynamique. <br><br>  Ainsi, nous pouvons utiliser les extensions pour les sources multim√©dias, instancier et acc√©der √† la vid√©o, puis t√©l√©charger les fragments vid√©o en plusieurs parties et les appliquer √† la balise &lt; <code>Video/</code> &gt;. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a1/8f5/99f/0a18f599f2422bc047ad16d71f32f9af.png"><br><br>  Le fait est que lorsque vous regardez une vid√©o de deux heures, vous ne voulez pas attendre qu'elle soit compl√®tement charg√©e.  Au lieu de cela, vous le coupez en petits morceaux dont la taille varie d'environ 30 secondes √† 2 minutes et vous les appliquez √† l'√©l√©ment &lt; <code>Video/</code> &gt; un par un. <br><br>  Une fois que notre tampon MediaSource est pr√™t et li√© √† l'√©l√©ment &lt; <code>Video/</code> &gt;, nous pouvons ajouter un SourceBuffer.  Nous devons √† nouveau lui dire quel format vid√©o et quels codecs nous utilisons, puis il sera cr√©√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/49a/d01/b0f/49ad01b0fcb2745fd0243c9bd4cf0972.png"><br><br>  Enfin, nous pouvons maintenant r√©cup√©rer des fragments individuels et les envoyer sur notre SourceBuffer en utilisant la m√©thode append √† l'√©l√©ment &lt;Video /&gt;, en recevant une vid√©o cr√©√©e dynamiquement.  Il peut √©galement √™tre utilis√© pour d'autres cas d'utilisation o√π les gens peuvent combiner ind√©pendamment diff√©rents √©l√©ments de la vid√©o, cr√©ant leurs propres vid√©os, mais je ne voudrais pas m'y attarder trop profond√©ment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d5/687/bc3/9d5687bc390e405b84977c99420abb4b.png"><br><br>  C'est donc presque la derni√®re √©tape que nous devons franchir.  Vous avez un r√©seau de distribution, vous avez des fragments, puis le navigateur envoie les fragments chiffr√©s et compress√©s au CDM, o√π le d√©chiffrement et, √©ventuellement, le d√©codage sont effectu√©s.  Ensuite, les fragments d√©crypt√©s et non compress√©s sont renvoy√©s au navigateur, o√π ils sont visualis√©s et affich√©s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/498/2d0/8a6/4982d08a6ee484ab5de56fb3cdb6d247.png"><br><br><h2>  Manifeste </h2><br>  Mais il y a encore un point.  Comment savoir quels fragments nous devons t√©l√©charger, o√π les t√©l√©charger et quand?  Et ceci est la derni√®re partie, la demande manquante du manifeste.  Lorsque nous demandons √† Netflix un manifeste, il a besoin de beaucoup de donn√©es.  Si nous voulons simplement lire une vid√©o, il nous importe quel syst√®me DRM nous utilisons, quelle vid√©o nous voulons regarder (ID Netflix, qui peut √™tre copi√© √† partir de l'URL) et des profils.  Les profils d√©terminent dans quelle r√©solution nous recevons la vid√©o, et aussi dans quelle langue nous recevons les pistes audio, dans quel format (st√©r√©o, Dolby Digital, etc.), si nous utilisons des sous-titres, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daf/b78/506/dafb7850664c7b2baba6894add61a79a.png"><br><br><h2>  MPEG-DASH </h2><br>  Le format manifeste le plus couramment utilis√© est MPEG-DASH.  Certes, Apple utilise un format diff√©rent - HSL, qui en apparence ressemble √† une liste de fichiers dans l'ancien lecteur Winamp.  Mais Widevine et Microsoft utilisent exactement MPEG-DASH.  Il est bas√© sur XML et d√©finit tout: dur√©e, taille du tampon, types de contenu, quand les fragments sont charg√©s, fragments pour diff√©rentes r√©solutions, ainsi que la commutation adaptative du d√©bit binaire.  Ce dernier signifie que si un utilisateur, par exemple, regarde une vid√©o et en m√™me temps que la vitesse de t√©l√©chargement baisse, la lecture ne s'arr√™te pas, mais la qualit√© vid√©o se d√©t√©riore tout simplement.  Cela est d√ª au fait que le manifeste d√©finit les m√™mes parties pour diff√©rentes r√©solutions, elles ont la m√™me dur√©e et les m√™mes indices.  Par cons√©quent, si la vitesse de t√©l√©chargement diminue, le navigateur peut simplement basculer vers un flux avec une r√©solution inf√©rieure sans interrompre le t√©l√©chargement et sans mettre en m√©moire tampon les donn√©es. <br><br>  Voil√† √† quoi ressemble le manifeste des Gardiens de la Galaxie.  Nous pouvons y voir qu'√† diff√©rentes vitesses de t√©l√©chargement, les gens recevront des vid√©os de qualit√© diff√©rente, ainsi que le fait qu'il existe des pistes audio pour les personnes malentendantes.  Il pr√©cise √©galement les sous-titres. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/785/a96/a6f/785a96a6fa6b13ed57bd6f5518f36fa1.png"><br><br>  Nous avons une dur√©e et une indication de l'heure √† partir de laquelle commencer la lecture.  Cette fonction est utilis√©e, par exemple, lorsque vous interrompez la visualisation et que vous revenez ensuite √† la vid√©o, en commen√ßant l√† o√π vous vous √©tiez arr√™t√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcc/349/b4c/dcc349b4c9b4a4eabfa26da95511185d.png"><br><br>  Il y a aussi la robustesse, qui dit: ce fragment ne peut √™tre perdu que si votre syst√®me r√©pond aux exigences.  Dans ce cas, il s'agit du d√©codage mat√©riel - Hardware Secure Codecs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a76/7c2/248/a767c224876945a69441fe4314114319.png"><br><br>  Pour la m√™me partie de la vid√©o, vous pouvez d√©terminer n'importe quel nombre de fragments avec diff√©rentes r√©solutions. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fa/202/d19/9fa202d1922b5e6d9aabb5a22f359d49.png"><br><br>  Et puis vous obtenez l'URL pour charger le fragment, et le param√®tre de plage affiche la plage de valeurs en millisecondes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/35e/325/93c/35e32593c77c1c7b242ce0141e8b6fd3.png"><br><br>  Ceci est la derni√®re partie.  Vous obtenez √©galement parfois un manifeste du CDN.  Certains fournisseurs ont un serveur distinct pour la livraison des fragments, mais le plus souvent, ils proviennent de la m√™me machine que la fonctionnalit√© de manifeste.  Lorsque nous avons t√©l√©charg√© le manifeste, nous savons quels fragments nous devons t√©l√©charger, nous pouvons envoyer une demande de fragments, puis d√©crypter et d√©coder √† partir du CDM. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/2e5/47d/8262e547d950d80ec737263c795ddab9.png"><br><br>  En g√©n√©ral, c'est tout.  Tout ce qui a √©t√© dit ci-dessus suffit pour d√©velopper un lecteur open source pour regarder des vid√©os d'Amazon, Sky et d'autres plateformes et regarder des vid√©os de presque tous les fournisseurs. <br><br><h2>  Msl </h2><br>  Netflix a jug√© utile d'ajouter un cryptage de message suppl√©mentaire entre le navigateur et le serveur.  Ils l'ont appel√© la ¬´couche de s√©curit√© des messages¬ª, la couche de s√©curit√© des messages ou MSL.  Cela ne fait rien directement avec la vid√©o, c'est juste une couche suppl√©mentaire de cryptage.  L'une des raisons de l'impl√©mentation de MSL est que HTTPS n'est pas suffisamment s√©curis√©.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MSL</a> , d'autre part, est open source, vous pouvez donc toujours voir comment cela fonctionne.  Ici, je ne vais pas me plonger dans ce sujet, et si vous √™tes int√©ress√©, vous pouvez toujours trouver des informations sur les raisons pour lesquelles Netflix fait MSL dans leur blog.  GitHub dispose d'une documentation d√©taill√©e sur son impl√©mentation et ses impl√©mentations de travail en Java. <br><br>  Il existe √©galement une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">impl√©mentation Python</a> que nous avons √©crite avec des amis.  √Ä ma connaissance, c'est le seul client open source qui fonctionne pour Netflix.  Il travaille avec Kodi Media Center.  Pour la visualisation, vous pouvez utiliser VLC Player ou tout autre logiciel appropri√©. <br><br><h2>  Et encore une fois la "bo√Æte noire" </h2><br>  Donc, vous avez vu ce dont nous avions besoin pour mettre en ≈ìuvre tout cela, et combien de fois j'ai mentionn√© le MDP - la ¬´bo√Æte noire¬ª qui est t√©l√©charg√©e sur Google.  Ainsi, nous avons de nouveau renvoy√© la vid√©o dans la ¬´bo√Æte noire¬ª.  Le bel √©l√©ment &lt;Video /&gt; nous est √† nouveau cach√©.  Nous avons ajout√© des logiciels tiers qui nous aident, mais qui sont en m√™me temps ferm√©s et que nous ne pouvons pas g√©rer.  Il peut faire beaucoup de choses discr√®tes: suivi, analyse, envoi de donn√©es ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ef/e10/72c/7efe1072c1d1d1390451a08ba3897f33.png"><br><br>  Voici ce que Tim Berners Lee a dit √† ce sujet: <i>"Donc, en g√©n√©ral, il est important de maintenir l'EME comme un environnement en ligne relativement s√ªr o√π vous pouvez regarder des films, ainsi que le plus pratique et celui qui en fait partie du discours interconnect√© de l'humanit√©."</i> <br><br>  Mais il y a d'autres opinions √† ce sujet.  En particulier, de l'Electronic Frontiers Foundation, qui avant l'av√®nement de DRM √©tait membre du W3C.  Voici ce qu'ils disent: <i>¬´En 2013, l'EFF a √©t√© d√©√ßu d'apprendre que le W3C a repris le projet de normalisation des extensions multim√©dias crypt√©es EME.</i>  <i>En fait, nous parlons d'une API dont la seule fonction √©tait de donner √† DRM un r√¥le de premier plan dans l'√©cosyst√®me des navigateurs.</i>  <i>Nous continuerons de nous battre pour garantir la gratuit√© et l'ouverture d'Internet.</i>  <i>¬´Nous continuerons de poursuivre le gouvernement am√©ricain pour abroger les lois qui rendent les DRM si toxiques, et nous continuerons de lutter au niveau du droit mondial.¬ª</i> <br><br>  Il m'est difficile de dire comment m'y rapporter.   ,       ,      ,      .   ,     Netflix,     . ,        ,         . <br><br><blockquote>   , 24-25 ,    <b>HolyJS 2018 Moscow</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´The Universal Serial Web¬ª</a> :     WebUSB,    USB-  .     -,    . <br><br> PS  1-      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . ,     ‚Äî  50%   . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426727/">https://habr.com/ru/post/fr426727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426717/index.html">L'illusion de tromperie: une illusion d'optique visuelle bas√©e sur la r√©tro-pr√©vision</a></li>
<li><a href="../fr426719/index.html">Hackathon sur la science des donn√©es √† SIBUR: comment c'√©tait</a></li>
<li><a href="../fr426721/index.html">√âviter les √©checs pendant le d√©veloppement du produit: 10 conseils de Rookee</a></li>
<li><a href="../fr426723/index.html">Microsoft et ses partenaires esp√®rent cr√©er une capsule temporelle sur la lune</a></li>
<li><a href="../fr426725/index.html">Comment faire des choses quand vous n‚Äôavez pas envie de les faire</a></li>
<li><a href="../fr426729/index.html">√âcole de magie TypeScript: g√©n√©riques et extension de type</a></li>
<li><a href="../fr426731/index.html">CSS: caract√©ristiques int√©ressantes de border-radius</a></li>
<li><a href="../fr426733/index.html">Le fer n'√©chouera pas. Comment je pr√©pare des dizaines de serveurs par jour pour la bataille</a></li>
<li><a href="../fr426735/index.html">Bienvenue au JETHACK Hackathon</a></li>
<li><a href="../fr426737/index.html">En bref sur l'architecture des processeurs neuromorphiques: un regard int√©rieur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>