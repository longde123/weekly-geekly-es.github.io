<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÇ üôåüèæ üÜò Portar JS a Elbrus ü§∏üèº üìâ üôÜüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta es una historia sobre portar JavaScript a la plataforma nacional Elbrus, hecha por chicos de UniPro. El art√≠culo proporciona un breve an√°lisis co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Portar JS a Elbrus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/419155/">  Esta es una historia sobre portar JavaScript a la plataforma nacional Elbrus, hecha por chicos de UniPro.  El art√≠culo proporciona un breve an√°lisis comparativo de plataformas, detalles de procesos y dificultades. <br><br><img src="https://habrastorage.org/webt/6x/ai/-j/6xai-jeiycantp_i5sdieoiglzc.jpeg"><br><br>  El art√≠culo se basa en un informe de Dmitry ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">dbezheckov</a> ) Bezhetskov y Vladimir ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">volodyabo</a> ) Anufrienko con HolyJS 2018 Piter.  Debajo del corte, encontrar√° la transcripci√≥n de video y texto del informe. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1zWUN6y2WbI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Parte 1. Elbrus, originario de Rusia </h2><br>  Primero, entenderemos qu√© es Elbrus.  Aqu√≠ hay algunas caracter√≠sticas clave de esta plataforma en comparaci√≥n con x86. <br><br><h3>  Arquitectura VLIW </h3><br>  Una soluci√≥n arquitect√≥nica completamente diferente a la arquitectura superescalar, que ahora es m√°s com√∫n en el mercado.  VLIW le permite expresar con mayor precisi√≥n las intenciones en el c√≥digo debido al control expl√≠cito de todos los dispositivos de l√≥gica aritm√©tica (ALU) independientes, que Elbrus tiene, por cierto, 4. Esto no excluye la posibilidad de tiempo de inactividad de algunas ALU, pero a√∫n aumenta el rendimiento te√≥rico en un ciclo de reloj El procesador. <br><br><h3>  Agrupaci√≥n de equipos </h3><br>  Los comandos del procesador Ready se combinan en paquetes (Bundles).  Un paquete es una gran instrucci√≥n que se ejecuta por reloj condicional.  Tiene muchas instrucciones at√≥micas que se ejecutan de forma independiente e inmediata en la arquitectura Elbrus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e77/da3/ebc/e77da3ebc083c57d019b34bbc58483af.png"><br><br>  En la imagen de la derecha, los rect√°ngulos grises indican los paquetes obtenidos al procesar el c√≥digo JS de la izquierda.  Si todo est√° aproximadamente claro con las instrucciones ldd, fmuld, faddd, fsqrts, entonces la declaraci√≥n de devoluci√≥n al comienzo del primer paquete es sorprendente para las personas que no est√°n familiarizadas con el ensamblador de Elbrus.  Esta instrucci√≥n carga la direcci√≥n de retorno de la funci√≥n floatMath actual en el registro ctpr3 de antemano, de modo que el procesador pueda descargar las instrucciones necesarias.  Luego, en el √∫ltimo paquete, ya hacemos la transici√≥n a la direcci√≥n precargada en ctpr3. <br><br>  Tambi√©n vale la pena se√±alar que Elbrus tiene muchos m√°s registros 192 + 32 + 32 frente a 16 + 16 +8 para x86. <br><br><h3>  Expl√≠cito especulativo versus impl√≠cito </h3><br>  Elbrus admite especulaci√≥n expl√≠cita en el nivel de comando.  Por lo tanto, podemos llamar y cargar a.bar desde la memoria incluso antes de verificar que no sea nulo, como se ve en el c√≥digo de la derecha.  Si la lectura l√≥gica al final no es v√°lida, entonces el valor en b simplemente se marcar√° como hardware incorrecto y no ser√° posible acceder a √©l. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/822/ec0/bcb/822ec0bcbb07ec7cff3a3e35656ef99e.png"><br><br><h3>  Soporte de ejecuci√≥n condicional </h3><br>  Elbrus tambi√©n admite ejecuci√≥n condicional.  Considere esto en el siguiente ejemplo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a34/39b/005/a3439b00564ddec3a66383e76bb58b96.png"><br><br>  Como podemos ver, el c√≥digo del ejemplo anterior sobre especulaci√≥n tambi√©n se reduce debido al uso de la convoluci√≥n de la expresi√≥n condicional en dependencia, no por control, sino por datos.  El hardware de Elbrus admite registros de predicados, en los que solo puede almacenar dos valores verdaderos o falsos.  Su caracter√≠stica principal es que puede marcar instrucciones con dicho predicado y, dependiendo de su valor en el momento de la ejecuci√≥n, la instrucci√≥n se ejecutar√° o no.  En este ejemplo, la instrucci√≥n cmpeq realiza la comparaci√≥n y coloca su resultado l√≥gico en el predicado P1, que luego se utiliza como marcador para cargar el valor de b en el resultado.  En consecuencia, si el predicado era igual a verdadero, entonces el valor 0 permanec√≠a en el resultado. <br><br>  Este enfoque le permite transformar un gr√°fico de control de programa bastante complejo en ejecuci√≥n de predicados y, en consecuencia, aumenta la plenitud del paquete.  Ahora podemos generar equipos m√°s independientes bajo diferentes predicados y llenarlos con paquetes.  Elbrus admite 32 registros de predicados, lo que le permite codificar 65 flujos de control (m√°s uno por la ausencia de un predicado en el comando). <br><br><h3>  Tres pilas de hardware en comparaci√≥n con una en Intel </h3><br>  Dos de ellos est√°n protegidos de modificaciones por el programador.  Uno, la pila de cadena, es responsable de almacenar las direcciones para los retornos de las funciones, el otro, la pila de registros, contiene los par√°metros a trav√©s de los cuales se pasan.  El tercero, la pila de usuarios, almacena las variables y los datos del usuario.  En Intel, todo se almacena en una pila, lo que da lugar a vulnerabilidades, ya que todas las direcciones de las transiciones, los par√°metros est√°n en un lugar que no est√° protegido por modificaciones por parte del usuario. <br><br><h3>  Sin predictor de rama din√°mico </h3><br>  En su lugar, se utiliza un esquema con preparaciones de conversi√≥n y transici√≥n if para que la canalizaci√≥n de ejecuci√≥n no se detenga. <br><br><h3>  Entonces, ¬øpor qu√© necesitamos JS en Elbrus? </h3><br><ol><li>  Sustituci√≥n de importaciones. <br></li><li>  Introducci√≥n de Elbrus al mercado de computadoras dom√©sticas, donde ya se requiere Javascript para el mismo navegador. <br></li><li>  Elbrus ya es necesario en la industria, por ejemplo con Node.js.  Por lo tanto, debe portar el nodo a esta arquitectura. <br></li><li>  El desarrollo de la arquitectura de Elbrus, as√≠ como especialistas en este campo. <br></li></ol><br><h3>  Si no hay int√©rprete, vienen dos compiladores </h3><br>  La implementaci√≥n anterior de v8 de Google se tom√≥ como base.  Funciona as√≠: se crea un √°rbol de sintaxis abstracta a partir del c√≥digo fuente, luego, dependiendo de si el c√≥digo se ejecut√≥ o no, utilizando uno de los dos compiladores (Crankshaft o FullCodegen), respectivamente, se crea un c√≥digo binario optimizado o no optimizado.  No hay int√©rprete <br><br><img src="https://habrastorage.org/getpro/habr/post_images/569/0ab/9f1/5690ab9f1edaf8273f6fe62b64110d27.png"><br><br><h3>  ¬øC√≥mo funciona FullCodegen? </h3><br>  Los nodos del √°rbol de sintaxis se traducen en c√≥digo binario, despu√©s de lo cual todo se "pega".  Un nodo tiene aproximadamente 300 l√≠neas de c√≥digo en un ensamblador de macros.  Esto, en primer lugar, ofrece un amplio horizonte de optimizaciones y, en segundo lugar, no hay transiciones de c√≥digo de bytes, como en el int√©rprete.  Es simple, pero al mismo tiempo hay un problema: durante la transferencia tendr√° que volver a escribir una gran cantidad de c√≥digo en el ensamblador de macros. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b8/38c/79a/6b838c79ab83cd76a498d82bf4ac3884.png"><br><br>  Sin embargo, todo esto se hizo y el resultado fue una versi√≥n del compilador FullCodegen 1.0 para Elbrus.  Todo se hizo a trav√©s de C ++ runtime v8, no optimizaron nada, el c√≥digo del ensamblador simplemente se reescribi√≥ de x86 a la arquitectura Elbrus. <br><br><h3>  Codegen 1.1 </h3><br>  Como resultado, el resultado no fue exactamente el esperado, y se decidi√≥ lanzar FullCodegen 1.1: <br><br><ul><li>  Menos tiempo de ejecuci√≥n, escribi√≥ en un ensamblador de macros; <br></li><li>  Se agregaron conversiones if manuales (en la figura, como ejemplo, se verifica que la variable js sea verdadera o falsa); <br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/588/974/2f1/5889742f19fa70280dcb5665e1e733d8.png"><br><br>  Tenga en cuenta que la comprobaci√≥n de NaN, indefinido, nulo se realiza a la vez, sin usar if, que ser√≠a necesario en la arquitectura Intel. <br><br><ul><li>  El c√≥digo no solo se reescribi√≥ con Intel, sino que tambi√©n implement√≥ la especulaci√≥n en stubs e implement√≥ la ruta r√°pida tambi√©n a trav√©s de MAsm (ensamblador macro). <br></li></ul><br>  Las pruebas se realizaron en Google Octane.  M√°quinas de prueba: <br><br><ul><li>  Elbrus: E2S 750 MHz, 24 GB <br></li><li>  Intel: Core i7 3.4 GHz, 16 GB <br></li></ul><br>  Resultados adicionales: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb4/922/ff5/fb4922ff553518321227b4a0c57f91bd.png"><br><br>  En el histograma est√° la relaci√≥n de los resultados, es decir.  ¬øCu√°ntas veces es Elbrus peor que Intel?  En dos pruebas, Crypto y zlib, los resultados son notablemente peores debido al hecho de que Elbrus a√∫n no tiene instrucciones de hardware para trabajar con cifrado.  En general, dada la diferencia de frecuencias, result√≥ bastante bien. <br><br>  La siguiente es una prueba en comparaci√≥n con el int√©rprete js de firefox, que es parte de la distribuci√≥n est√°ndar de Elbrus.  M√°s es mejor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ab/c77/0d4/0abc770d4a1717ca18156070f0b762a4.png"><br>  Veredicto: el compilador volvi√≥ a hacer un buen trabajo. <br><br><h3>  Resultados de desarrollo </h3><br><ul><li>  El nuevo motor JS pas√≥ las pruebas test262.  Esto le da derecho a ser llamado un entorno de tiempo de ejecuci√≥n completo ECMAScript 262. <br></li><li>  La productividad aument√≥ en promedio cinco veces en comparaci√≥n con el motor anterior: el int√©rprete. <br></li><li>  Node.js 6.10 tambi√©n fue portado como un ejemplo de uso de V8, ya que no fue dif√≠cil. <br></li><li>  Sin embargo, todav√≠a es peor que Core i7 en FullCodegen siete veces. <br></li></ul><br><h3>  Nada parec√≠a presagiar </h3><br>  Todo estar√≠a bien, pero aqu√≠ Google anunci√≥ que ya no es compatible con FullCodegen y Crankshaft y se eliminar√°n.  Despu√©s de lo cual el equipo recibi√≥ una orden de desarrollo para el navegador Firefox, y m√°s sobre eso m√°s adelante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d7/f15/543/9d7f155439ad3b1436ebc4cc9c59d50a.png"><br><br><h2>  Parte 2. Firefox y su mono ara√±a </h2><br>  Se trata del motor del navegador Firefox: SpiderMonkey.  En la figura, las diferencias entre este motor y el nuevo V8. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c91/301/274/c9130127464ac436103ab6e8ed8c187d.png"><br><br>  Se puede ver que en la primera etapa todo parece que el c√≥digo fuente se analiza en un √°rbol de sintaxis abstracta, luego en c√≥digo de bytes y luego comienzan las diferencias. <br><br>  En SpiderMonkey, el bytecode es interpretado por el int√©rprete de C ++, que en esencia se asemeja a un interruptor grande, dentro del cual se realizan los saltos de bytecode.  Adem√°s, el c√≥digo interpretado ingresa al compilador de neotimizaci√≥n de la l√≠nea base.  Luego, en la etapa final, se incluye el compilador de optimizaci√≥n Ion en el caso.  En el motor V8, el bytecode es procesado por el int√©rprete Ingnition y luego por el compilador TurboFan. <br><br><h3>  L√≠nea de base, ¬°te elijo a ti! </h3><br>  La portabilidad comenz√≥ con el compilador Baseline.  Es esencialmente una m√°quina apilada.  Es decir, hay una cierta pila de la que las c√©lulas toma variables, las recuerda, realiza algunas acciones con ellas, despu√©s de lo cual devuelve las variables y los resultados de las acciones a las celdas de la pila.  A continuaci√≥n, en algunas im√°genes, este mecanismo se muestra paso a paso con respecto a la funci√≥n simple foo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4a/8fb/d66/d4a8fbd66d65c39e23a22ed8c21b844e.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/744/c7a/927/744c7a92704b61ec0063a5223de84bda.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fdd/0bb/b3f/fdd0bbb3f000f2738af72ee77afbc719.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cfe/b02/db2/cfeb02db22e24368fca8632db5cf93f2.png"><br><br><h3>  ¬øQu√© es un marco? </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/4a8/386/e3c/4a8386e3c926b0175dcd7508cfbd0783.png"><br><br>  En las im√°genes de arriba puedes ver la palabra marco.  En t√©rminos generales, este es un contexto de Javascript en el hardware, es decir, un conjunto de datos en la pila que describe cualquiera de sus funciones.  En la imagen a continuaci√≥n, la funci√≥n es foo, y a la derecha de ella se ve c√≥mo se ve en la pila: argumentos, descripci√≥n de la funci√≥n, direcci√≥n de retorno, indicaci√≥n del marco anterior, porque la funci√≥n se llam√≥ desde alg√∫n lugar y para regresar correctamente al lugar de la llamada, esta informaci√≥n debe almacenarse en stack, y luego las variables locales mismas funciones y operandos para los c√°lculos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14d/c18/a75/14dc18a750ddcddf752bc1ed53a6eed0.png"><br><br>  Por lo tanto, las <b>ventajas de la l√≠nea de base</b> : <br><br><ul><li>  Parece FullCodegen, por lo que su experiencia de portabilidad fue √∫til; <br></li><li>  Portar el ensamblador, obtener un compilador que funcione; <br></li><li>  Es conveniente depurar; <br></li><li>  Cualquier trozo puede ser reescrito. <br></li></ul><br>  Pero tambi√©n hay <b>desventajas</b> : <br><br><ul><li>  C√≥digo lineal, hasta que ejecute un c√≥digo de byte, no podr√° ejecutar lo siguiente, lo que no es muy bueno para la arquitectura con computaci√≥n paralela; <br></li><li>  Como funciona con bytecode, realmente no optimizas. <br></li></ul><br>  Solo quedaba implementar el ensamblador de macros y obtener un compilador listo para usar.  La depuraci√≥n no fue un buen augurio, fue suficiente mirar la pila en la arquitectura x86, y luego en la que se obtuvo al portar para encontrar el problema. <br><br>  Como resultado, en las pruebas con el nuevo compilador, la productividad se ha triplicado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79e/20b/20b/79e20b20b8126f69cd9031c406af0da0.png"><br><br>  Sin embargo, Octane no admite excepciones.  Y su implementaci√≥n es muy importante. <br><br><h3>  Trabajo excepcional </h3><br>  Primero, veamos c√≥mo funcionan las excepciones en x86.  Mientras se ejecuta el programa, las direcciones de retorno de las funciones se escriben en la pila.  En alg√∫n momento, ocurre una excepci√≥n.  Pasamos al controlador de excepciones de tiempo de ejecuci√≥n, que utiliza los marcos de los que hablamos anteriormente.  Encontramos d√≥nde ocurri√≥ exactamente la excepci√≥n, despu√©s de lo cual debemos rebobinar la pila al estado deseado, y luego la direcci√≥n de retorno cambia a aquella donde se procesar√° la excepci√≥n. <br><br>  El problema es que debido a otro dispositivo de pila en la arquitectura de Elbrus, esto no funcionar√°.  Ser√° necesario calcular por llamadas al sistema cu√°nto necesita rebobinar en la pila de Cadena.  A continuaci√≥n, realizamos una llamada al sistema para obtener la pila de llamadas.  A continuaci√≥n, en la direcci√≥n en la pila de Cadena, hacemos un reemplazo para la direcci√≥n que realiza la devoluci√≥n. <br><br>  A continuaci√≥n se muestra una ilustraci√≥n de la secuencia de estos pasos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/21e/288/52b/21e28852b593e04e9712f55ced7484a5.png"><br><br>  No es la forma m√°s r√°pida, sin embargo, se maneja la excepci√≥n.  Pero a√∫n as√≠, en Intel parece un poco m√°s simple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4d/e44/ee6/f4de44ee6d999e24e8a275b027c4442e.png"><br><br>  Con Elbrus, habr√° m√°s saltos al controlador: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/239/b1f/8cc239b1f908dc1ab6c02953ef7641d9.png"><br>  Es por eso que no debe basar la l√≥gica del programa en excepciones, especialmente en Elbrus. <br><br><h3>  ¬°Optim√≠zalo! </h3><br>  Entonces, se implementa el manejo de excepciones.  Ahora le diremos c√≥mo lo hicimos todo un poco m√°s r√°pido: <br><br><ul><li>  Reescribi√≥ cach√©s en l√≠nea; <br></li></ul><br><ul><li>  Hizo un arreglo manual (y luego autom√°tico) de demoras; <br></li><li>  Hicieron preparativos para las transiciones (mayor en el c√≥digo): cuanto antes se prepare la transici√≥n, mejor; <br></li><li>  Recolector de basura incremental soportado <br></li></ul><br>  El segundo p√°rrafo se detendr√° en un poco m√°s de detalle.  Ya hemos examinado un peque√±o ejemplo de trabajo con paquetes, y continuaremos con √©l. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/805/722/9dd/8057229ddec6aa5091fa132de5506a9a.png"><br><br>  Cualquier operaci√≥n, por ejemplo, la carga, no se realiza en un ciclo, en este caso se realiza en tres ciclos.  Por lo tanto, si queremos multiplicar dos n√∫meros, ingresamos a la operaci√≥n de multiplicaci√≥n, pero los operandos mismos a√∫n no se han cargado, el procesador solo puede esperar a que se carguen.  Y esperar√° un cierto n√∫mero de medidas, un m√∫ltiplo de cuatro.  Pero si configura manualmente el retraso, el tiempo de espera puede reducirse, mejorando as√≠ el rendimiento.  Adem√°s, el proceso de organizaci√≥n de los retrasos fue automatizado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af7/721/cba/af7721cba060984416301fb89004a502.png"><br><br>  Resultados de la optimizaci√≥n BaseLine v1.0 vs Baseline v1.1.  Claro, el motor se ha vuelto m√°s r√°pido. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f3/d34/6cf/8f3d346cf9c1731bff2d85d0e52df5eb.png"><br><br><h3>  ¬øC√≥mo pueden los programadores no hacer una pistola de iones? </h3><br>  En la ola de √©xito de la implementaci√≥n de Baseline v1.1, se decidi√≥ portar el compilador de optimizaci√≥n Ion. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b97/887/d35/b97887d35eae9e30d300fa7d60b24942.png"><br><br>  ¬øC√≥mo funciona el compilador de optimizaci√≥n?  El c√≥digo fuente se interpreta, se inicia la compilaci√≥n.  En el proceso de ejecuci√≥n del c√≥digo de bytes, Ion recopila datos sobre los tipos utilizados en el programa y el an√°lisis de las "funciones activas", aquellas que se realizan con m√°s frecuencia que otras.  Despu√©s de eso, se decide compilarlos mejor, optimizarlos.  A continuaci√≥n, se construye una representaci√≥n de alto nivel del compilador, un gr√°fico de operaci√≥n.  El gr√°fico est√° optimizado (opt 1, opt 2, opt ...), se crea una representaci√≥n de bajo nivel, que consta de instrucciones de la m√°quina, se reservan registros, se genera un c√≥digo binario directamente optimizado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/294/80d/48a/29480d48a92487c40bd4a7de91c7b1ef.png"><br><br>  Hay m√°s registros en Elbrus y los equipos en s√≠ son grandes, por lo tanto, necesitamos: <br><br><ul><li>  Team Planner <br></li><li>  Distribuidor de registro propio; <br></li><li>  LIR propio (Representaci√≥n intermedia de bajo nivel); <br></li><li>  C√≥digo propio generador. <br></li></ul><br>  El equipo ya ten√≠a experiencia en portar Java a Elbrus, decidieron usar la misma biblioteca para la generaci√≥n de c√≥digo para portar Ion.  Ella se llama TANGO.  Tiene: <br><br><ul><li>  Team Planner <br></li><li>  Distribuidor de registro propio; <br></li><li>  Optimizaciones de bajo nivel. <br></li></ul><br>  Queda por introducir una representaci√≥n de alto nivel en TANGO, para hacer un selector.  El problema es que la vista de bajo nivel en TANGO es como ensamblador, que es dif√≠cil de mantener y depurar.  ¬øC√≥mo deber√≠a verse el compilador por dentro?  Para una mejor comprensi√≥n, Mozilla cre√≥ su propio compilador HolyJit; tambi√©n hay una opci√≥n para escribir su propio mini idioma para traducir entre una representaci√≥n de alto nivel y de bajo nivel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a3/6b2/94b/0a36b294b7fb8241b5be77a22a4d0e09.png"><br><br>  El desarrollo a√∫n est√° en marcha.  Bueno y m√°s sobre c√≥mo no exagerar con la optimizaci√≥n. <br><br><h2>  Parte 3. Lo mejor es enemigo de lo bueno </h2><br><h3>  Compilaci√≥n como es </h3><br>  El proceso de optimizaci√≥n en Ion, cuando el c√≥digo se calienta y luego se compila y optimiza, es codicioso, esto se puede ver en el siguiente ejemplo. <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{
 &nbsp;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b;
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomeStuff</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{
 &nbsp;<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1100</span></span>; ++i) {
 &nbsp;&nbsp;&nbsp;print(foo(obj,obj));
 &nbsp;}
}

doSomeStuff(<span class="hljs-string"><span class="hljs-string">"HollyJS"</span></span>);
doSomeStuff({<span class="hljs-attr"><span class="hljs-attr">n</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>});
</code></pre><br>
   JS Shell    (  ), &nbsp;&nbsp;   Mozilla,   :<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7ab/cdb/646/7abcdb646a834281b059d5a418d659c2.png"><br>
<br>
 .  ,     ,   -     bailout ().  ,   .      foo     object,           ,     ,        .    ,  :<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomeStuff</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{
 &nbsp;<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1100</span></span>; ++i) {
 &nbsp;&nbsp;&nbsp;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(obj <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>))
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"><span class="hljs-comment">// bailout</span></span>
 &nbsp;&nbsp;&nbsp;print(foo_only_str(obj, obj));
 &nbsp;}
}
</code></pre><br>
         ,            .<br>
<br>
       .   ,         ,   DCE.<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/677/41e/90f/67741e90f8b4e89225a55ab86c434601.png"><br>
<br>
<h2> </h2><br>
       ,  ,        ,          .<br>
<br>
   ,   ,    ,  SpiderMonkey  Resume Point. -   ,     .     ,       baseline .   ,   runtime   ,    .   lowering, regAlloc,     (snapshot),   ,    .      baseline .<br>
<br>
   :<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/bd4/449/349/bd444934928405be1d22ecefc3926427.png"><br>
<br>
 runtime  x86    : ,        .        .  ,       ,    ,    ,      ,    . ,      ,   Type .   :<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b39/e8a/1ca/b39e8a1ca896a3550e80405177ccbf48.png"><br>
<br>
    ,       ,           chain . ,     ,  . <br>
<br>
    :    ,       chain-,    N ,    ,         baseline,         . &nbsp;<br>
<br>
    ,        .<br>
<br>
    :<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6f3/684/575/6f3684575e08d56fb5eaf64cede1e3c3.png"><br>
<br>
    Ion  4-            baseline.     :<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9e6/325/b40/9e6325b406a27d6cdfee2ab2a9409488.png"><br>
<br>
<h2></h2><br>
,   ,     SpiderMonkey, V8  Node.    ‚Äî  .     . <br>
<br>
      .       ,   ,      chain-.<br>
<br>
<blockquote>  ,  : 24-25      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HolyJS</a>,      .      ‚Äî  ,      .</blockquote></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419155/">https://habr.com/ru/post/es419155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419145/index.html">Fintech Digest: la capitalizaci√≥n de Apple super√≥ los $ 1 bill√≥n, AI ayud√≥ a eBay a aumentar los ingresos en miles de millones</a></li>
<li><a href="../es419147/index.html">Cubo de 1000 dimensiones: ¬øes posible crear un modelo computacional de la memoria humana hoy?</a></li>
<li><a href="../es419149/index.html">Gu√≠a de Mikrotik RoMON</a></li>
<li><a href="../es419151/index.html">Hogar inteligente: una nueva dimensi√≥n de confort y la b√∫squeda de la excelencia. Parte dos</a></li>
<li><a href="../es419153/index.html">Memorando de derechos de Cyborg</a></li>
<li><a href="../es419159/index.html">C√≥digo JS, n√∫meros romanos, acertijos geom√©tricos: c√≥mo ciframos nuestra edad</a></li>
<li><a href="../es419161/index.html">Modelado de la superficie del agua usando el procesador FFT y NeuroMatrix DSP</a></li>
<li><a href="../es419165/index.html">Enviamos SMS "an√≥nimos" desde la consola al n√∫mero deseado utilizando el servicio bytehand y C ++</a></li>
<li><a href="../es419169/index.html">"World of the Wild West" a trav√©s de los ojos del desarrollador</a></li>
<li><a href="../es419171/index.html">Deshabilitar las comprobaciones de estado de tiempo de ejecuci√≥n en una aplicaci√≥n de Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>