<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì≥ üêÖ üñãÔ∏è Organizaci√≥n de pruebas seguras en producci√≥n. Parte 2 üçü ‚òéÔ∏è üåú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En esta parte del art√≠culo, continuaremos considerando varios tipos de pruebas en producci√≥n. Los que se saltaron la primera parte pueden leerla aqu√≠ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organizaci√≥n de pruebas seguras en producci√≥n. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/418329/"><img src="https://habrastorage.org/webt/ht/ra/sh/htrashsucmi8c4a6nok7rihdoay.png"><br><br>  En esta parte del art√≠culo, continuaremos considerando varios tipos de pruebas en producci√≥n.  Los que se saltaron la primera parte pueden leerla <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Por lo dem√°s, bienvenido a cat. <br><a name="habracut"></a><br><h2>  Pruebas de producci√≥n: lanzamiento </h2><br>  Despu√©s de probar el servicio despu√©s de la <i>implementaci√≥n</i> , debe estar preparado para su <i>lanzamiento</i> . <br>  Es importante tener en cuenta que en esta etapa la reversi√≥n de los cambios solo es posible en situaciones de falla <i>sostenible</i> , por ejemplo: <br><br><ul><li>  falla de servicio en bucle; </li><li>  exceder el tiempo de espera para un n√∫mero significativo de conexiones en el flujo ascendente, lo que provoca un fuerte aumento en la frecuencia de errores; </li><li>  cambio de configuraci√≥n inaceptable, por ejemplo, la falta de una clave secreta en una variable de entorno que causa un mal funcionamiento del servicio (las variables de entorno generalmente son mejores para evitar, pero este es un tema para otra discusi√≥n). </li></ul><br>  Las pruebas exhaustivas en la etapa de <i>implementaci√≥n</i> me permiten minimizar idealmente o evitar por completo sorpresas desagradables en la etapa de <i>lanzamiento</i> .  Sin embargo, hay una serie de recomendaciones para liberar de forma segura el nuevo c√≥digo. <br><br><h3>  Despliegue de Canarias </h3><br>  <i>El despliegue de Canary</i> es un <i>lanzamiento</i> parcial <i>de un</i> servicio en producci√≥n.  A medida que pasa la comprobaci√≥n de estado b√°sica, las peque√±as partes del tr√°fico del entorno de producci√≥n actual se env√≠an a las partes liberadas.  Los resultados de las partes del servicio se supervisan a medida que se procesa el tr√°fico, los indicadores se comparan con los de referencia (no relacionados con los canarios), y si caen fuera de los valores de umbral aceptables, se realiza una reversi√≥n al estado anterior.  Aunque este enfoque se usa generalmente cuando se lanza el software del servidor, las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pruebas canarias del software del cliente</a> tambi√©n se est√°n volviendo m√°s comunes. <br><br>  Varios factores influyen en el tr√°fico que se utilizar√° para el despliegue canario.  En varias compa√±√≠as, las partes lanzadas del servicio primero reciben solo tr√°fico interno de usuarios (lo que se conoce como alimentaci√≥n de perros).  Si no se observan errores, se agrega una peque√±a parte del tr√°fico del entorno de producci√≥n, despu√©s de lo cual se realiza una implementaci√≥n completa.  Se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recomienda que</a> regrese al estado anterior en caso de resultados de implementaci√≥n canarios no v√°lidos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">autom√°ticamente</a> , y las herramientas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Spinnaker</a> tienen soporte incorporado para an√°lisis automatizado y funciones de reversi√≥n. <br><br>  Hay algunos problemas con las pruebas canarias, y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">este art√≠culo</a> proporciona una descripci√≥n bastante completa de ellos. <br><br><h3>  Monitoreo </h3><br>  El monitoreo es un procedimiento absolutamente necesario en <i>cada</i> etapa del despliegue del producto en producci√≥n, pero esta funci√≥n ser√° especialmente importante en la etapa de <i>lanzamiento</i> .  La supervisi√≥n es adecuada para obtener informaci√≥n sobre el nivel general de rendimiento del sistema.  Pero monitorear todo en el mundo puede no ser la mejor soluci√≥n.  <i>El</i> monitoreo <i>efectivo</i> se realiza puntualmente, lo que le permite identificar un peque√±o conjunto de modos de falla sostenible del sistema o un conjunto b√°sico de indicadores.  Ejemplos de tales modos de falla pueden ser: <br><br><ul><li>  aumento en la tasa de error; </li><li>  una disminuci√≥n en la velocidad general de procesamiento de solicitudes en todo el servicio, en un punto final espec√≠fico, o, peor a√∫n, un cese completo del trabajo; </li><li>  mayor retraso </li></ul><br>  La observaci√≥n de cualquiera de estos modos de falla sostenible es la base para una reversi√≥n inmediata a un estado anterior o la reversi√≥n de nuevas versiones de software <i>lanzadas</i> .  Es importante recordar que es poco probable que el monitoreo en esta etapa sea completo e indicativo.  Muchos creen que el n√∫mero ideal de se√±ales monitoreadas durante el monitoreo es de 3 a 5, pero <i>definitivamente</i> no m√°s de 7-10.  El libro blanco de Kraken en Facebook ofrece la siguiente soluci√≥n: <br><br>  <i>"El problema se resuelve con la ayuda de un componente de monitoreo f√°cilmente configurable, que se informa de dos indicadores b√°sicos (el percentil 99 del tiempo de respuesta del servidor web y la frecuencia de ocurrencia de errores HTTP fatales) que describen objetivamente la calidad de la interacci√≥n del usuario".</i> <br><br>  El conjunto de indicadores del sistema y de la aplicaci√≥n que se monitorean durante la fase de lanzamiento se determina mejor durante el dise√±o del sistema. <br><br><h3>  Seguimiento de excepciones </h3><br>  Estamos hablando de rastrear excepciones en la etapa de lanzamiento, aunque podr√≠a parecer que en las etapas de <i>implementaci√≥n</i> y despu√©s del lanzamiento esto no ser√≠a menos √∫til.  Las herramientas de seguimiento de excepciones a menudo no garantizan la misma minuciosidad, precisi√≥n y cobertura masiva que otras herramientas de monitoreo del sistema, pero a√∫n pueden ser muy √∫tiles. <br><br>  Las herramientas de c√≥digo abierto (como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sentry</a> ) muestran informaci√≥n avanzada sobre las solicitudes entrantes y crean pilas de datos de rastreo y variables locales, lo que simplifica enormemente el proceso de depuraci√≥n, que generalmente consiste en ver registros de eventos.  El seguimiento de excepciones tambi√©n es √∫til al ordenar y priorizar problemas que no requieren una reversi√≥n completa a un estado anterior (por ejemplo, un caso l√≠mite que arroja una excepci√≥n). <br><br><h3>  Conformaci√≥n del tr√°fico </h3><br>  La configuraci√≥n del tr√°fico (redistribuci√≥n del tr√°fico) no es tanto una forma independiente de prueba como una herramienta para apoyar el enfoque canario y la liberaci√≥n por fases del nuevo c√≥digo.  De hecho, se garantiza la configuraci√≥n del tr√°fico actualizando la configuraci√≥n del equilibrador de carga, lo que le permite redirigir gradualmente m√°s tr√°fico a la nueva versi√≥n <i>lanzada</i> . <br><br>  Este m√©todo tambi√©n es √∫til para la implementaci√≥n por fases del nuevo software (aparte de la implementaci√≥n regular).  Considera un ejemplo.  Imgix necesitaba implementar una arquitectura de infraestructura fundamentalmente nueva en junio de 2016.  Despu√©s de la primera prueba de la nueva infraestructura con una cierta cantidad de tr√°fico oscuro, comenzaron a desplegarse en producci√≥n, inicialmente redirigiendo aproximadamente el 1% del tr√°fico del entorno de producci√≥n a una nueva pila.  Luego, en el transcurso de varias semanas, se aument√≥ el volumen de datos que llegaban a la nueva pila (resolviendo problemas en el camino), hasta que comenz√≥ a procesar el 100% del tr√°fico. <br><br>  La popularidad de la arquitectura de malla de servicios ha provocado un nuevo aumento en el inter√©s en los servidores proxy.  Como resultado, tanto los servidores proxy antiguos (nginx, HAProxy) como los nuevos (Envoy, Conduit) agregaron soporte para nuevas funciones en un intento de superar a los competidores.  Me parece que el futuro, en el que la redistribuci√≥n del tr√°fico del 0 al 100% en la etapa de lanzamiento del producto se lleva a cabo autom√°ticamente, est√° a la vuelta de la esquina. <br><br><h2>  Pruebas de producci√≥n: despu√©s del lanzamiento </h2><br>  Las pruebas posteriores al lanzamiento se realizan como una verificaci√≥n realizada <i>despu√©s de un</i> <i>lanzamiento</i> exitoso <i>del</i> c√≥digo.  En esta etapa, puede estar seguro de que el c√≥digo en su conjunto es correcto, se ha <i>lanzado con</i> √©xito en producci√≥n y procesa el tr√°fico correctamente.  El c√≥digo implementado se usa directa o indirectamente en condiciones reales, sirviendo a clientes reales o realizando tareas que tienen un impacto significativo en el negocio. <br><br>  El objetivo de cualquier prueba en esta etapa es principalmente verificar la operabilidad del sistema, teniendo en cuenta varias posibles cargas y patrones de tr√°fico.  La mejor manera de hacer esto es recopilar evidencia documental de todo lo que sucede en la producci√≥n y usarla tanto para la depuraci√≥n como para obtener una imagen completa del sistema. <br><br><h3>  Marcado de funciones o lanzamiento oscuro </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">La publicaci√≥n m√°s antigua</a> sobre el uso exitoso de las banderas de caracter√≠sticas que encontr√© fue publicada hace casi diez a√±os.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Featureflags.io</a> proporciona la gu√≠a m√°s completa para esto. <br><br>  <i>‚ÄúLa marcaci√≥n de caracter√≠sticas es un m√©todo utilizado por los desarrolladores para marcar una nueva funci√≥n utilizando sentencias if-then, que permite un mayor control sobre su lanzamiento.</i>  <i>Al marcar una funci√≥n y aislarla de esta manera, el desarrollador tiene la capacidad de activar y desactivar esta funci√≥n independientemente del estado de implementaci√≥n.</i>  <i>Esto efectivamente separa el lanzamiento de la funci√≥n del despliegue del c√≥digo ".</i> <br><br>  Al marcar el nuevo c√≥digo, puede probar su rendimiento y rendimiento en producci√≥n seg√∫n sea necesario.  El marcado de caracter√≠sticas es uno de los tipos de pruebas generalmente aceptados en producci√≥n, es bien conocido y a menudo se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describe</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">varias fuentes</a> .  Es mucho menos conocido el hecho de que este m√©todo puede usarse en el proceso de probar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">transferencia de bases de datos</a> o software para sistemas personales. <br><br>  De lo que los autores de art√≠culos rara vez escriben es sobre los mejores m√©todos para desarrollar y usar indicadores de funci√≥n.  El uso incontrolado de banderas puede ser un problema grave.  La falta de disciplina en t√©rminos de eliminar las banderas no utilizadas despu√©s de un per√≠odo espec√≠fico a veces lleva al hecho de que debe realizar una auditor√≠a completa y eliminar las banderas obsoletas acumuladas durante meses (si no durante a√±os) de trabajo. <br><br><h3>  Pruebas A / B </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Las pruebas A / B a</a> menudo se realizan como parte de un an√°lisis experimental y no se consideran pruebas en producci√≥n.  Por esta raz√≥n, las pruebas A / B no solo se usan ampliamente (a veces incluso de una manera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dudosa</a> ), sino que tambi√©n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">estudian</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describen</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">activamente</a> (incluidos art√≠culos sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lo que determina un cuadro</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mando eficaz</a> para experimentos en l√≠nea).  Con mucha menos frecuencia, las pruebas A / B se utilizan para probar varias configuraciones de hardware o m√°quinas virtuales.  A menudo se les llama "sintonizaci√≥n" (por ejemplo, sintonizaci√≥n JVM), pero no se clasifican como pruebas A / B t√≠picas (aunque la sintonizaci√≥n se puede considerar como un tipo de prueba A / B realizada con el mismo nivel de rigor cuando se trata de mediciones) . <br><br><h3>  Registros, eventos, indicadores y seguimiento. </h3><br>  Puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">leer</a> sobre las llamadas "tres ballenas de observabilidad": registros, indicadores y rastreo distribuido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h3>  Perfilado </h3><br>  En algunos casos, para diagnosticar problemas de rendimiento, es necesario utilizar la creaci√≥n de perfiles de aplicaciones en la producci√≥n.  Dependiendo de los idiomas y tiempos de ejecuci√≥n admitidos, la creaci√≥n de perfiles puede ser un procedimiento bastante simple, que implica agregar solo una l√≠nea de c√≥digo a la aplicaci√≥n ( <code>import _ "net/http/pprof"</code> en el caso de Go).  Por otro lado, puede requerir el uso de muchas herramientas o probar el proceso mediante el m√©todo de recuadro negro y verificar los resultados utilizando herramientas como los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gr√°ficos de llama</a> . <br><br><h3>  Prueba de tee </h3><br>  Muchas personas consideran que tales pruebas son algo as√≠ como la duplicaci√≥n de datos, ya que en ambos casos el tr√°fico del entorno de producci√≥n se env√≠a a grupos o procesos que no son de producci√≥n.  En mi opini√≥n, la diferencia es que el uso del tr√°fico para fines de <i>prueba</i> es algo diferente de su uso para fines de <i>depuraci√≥n</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">Etsy escribi√≥ en su blog</a> sobre el uso de tee-tests como herramienta de verificaci√≥n (este ejemplo realmente se parece a la duplicaci√≥n de datos en la sombra). <br>  <i>‚ÄúAqu√≠ <b>tee</b> puede entenderse como el comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tee</a> en la l√≠nea de comando.</i>  <i>Escribimos una regla <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://devcentral.f5.com/articles/">iRule</a> basada en un equilibrador de carga F5 existente para clonar el tr√°fico HTTP dirigido a uno de los grupos y redirigirlo a otro grupo.</i>  <i>Por lo tanto, pudimos utilizar el tr√°fico del entorno de producci√≥n dirigido a nuestro cl√∫ster API y enviar una copia del mismo al cl√∫ster experimental HHVM, as√≠ como a un cl√∫ster PHP aislado para comparar.</i> <i><br></i>  <i>Esta t√©cnica ha demostrado ser muy efectiva.</i>  <i>Nos permiti√≥ comparar el rendimiento de las dos configuraciones utilizando perfiles de tr√°fico id√©nticos ".</i> <br><br>  Sin embargo, a veces se requiere una prueba de salida basada en el tr√°fico del entorno de producci√≥n en un sistema aut√≥nomo para la <i>depuraci√≥n</i> .  En tales casos, el sistema aut√≥nomo se puede cambiar para configurar la salida de informaci√≥n de diagn√≥stico adicional u otro procedimiento de compilaci√≥n (por ejemplo, utilizando la herramienta de limpieza de flujo), lo que simplifica enormemente el proceso de soluci√≥n de problemas.  En tales casos, las pruebas de tee deben considerarse, m√°s bien, <i>herramientas de depuraci√≥n</i> , en lugar de <i>verificaci√≥n</i> . <br><br>  Anteriormente, tales tipos de depuraci√≥n eran relativamente raros en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">imgix</a> , pero todav√≠a se usaban, especialmente cuando se trataba de problemas con las aplicaciones de depuraci√≥n que son sensibles al retraso. <br><br>  Por ejemplo, la siguiente es una descripci√≥n anal√≠tica de uno de estos incidentes que ocurrieron en 2015.  El error 400 ocurri√≥ tan raramente que casi no se vio al intentar reproducir el problema.  Ella apareci√≥ en unos pocos casos de un bill√≥n.  Hab√≠a muy pocos durante el d√≠a.  Como resultado, result√≥ que era simplemente imposible reproducir de manera confiable el problema, por lo que era necesario realizar una depuraci√≥n utilizando el tr√°fico de trabajo para tener la oportunidad de rastrear la ocurrencia de este error.  Esto es lo que mi antiguo colega escribi√≥ sobre esto: <br><br>  <i>‚ÄúEleg√≠ una biblioteca que se supon√≠a que era interna, pero finalmente tuve que crear la m√≠a basada en la biblioteca proporcionada por el sistema.</i>  <i>En la versi√≥n proporcionada por el sistema, se produjo un error peri√≥dicamente que no apareci√≥ de ninguna manera mientras la cantidad de tr√°fico era peque√±a.</i>  <i>Sin embargo, el nombre truncado en el t√≠tulo fue el verdadero problema.</i> <i><br><br></i>  <i>Durante los siguientes dos d√≠as, estudi√© en detalle el problema asociado con la mayor frecuencia de errores falsos 400. El error se manifest√≥ en un n√∫mero muy peque√±o de solicitudes, y los problemas de este tipo son dif√≠ciles de diagnosticar.</i>  <i>Todo esto parec√≠a la aguja notoria en un pajar: el problema se encontr√≥ en un caso por mil millones.</i> <i><br><br></i>  <i>El primer paso para localizar el origen de los errores fue obtener todos los datos de solicitud HTTP sin procesar que dieron como resultado una respuesta incorrecta.</i>  <i>Para realizar una prueba en T del tr√°fico entrante cuando est√° conectado a un socket, agregu√© el punto final del socket de dominio Unix al servidor de renderizado.</i>  <i>La idea era permitirnos activar y desactivar r√°pida y f√°cilmente el flujo de tr√°fico oscuro y realizar pruebas directamente en la computadora del desarrollador.</i>  <i>Para evitar problemas en la producci√≥n, era necesario romper la conexi√≥n si hab√≠a un problema de contrapresi√≥n.</i>  <i>Es decir</i>  <i>si el duplicado no pudo hacer frente a la tarea, se desconect√≥.</i>  <i>Este socket fue muy √∫til en algunos casos durante el desarrollo.</i>  <i>Esta vez, sin embargo, lo usamos para recopilar tr√°fico entrante en los servidores seleccionados, con la esperanza de obtener suficientes solicitudes para revelar el patr√≥n que condujo a la aparici√≥n de errores falsos 400. Utilizando dsh y netcat, pude generar el tr√°fico entrante con relativa facilidad en un archivo local. .</i> <i><br><br></i>  <i>La mayor parte del entorno se gast√≥ recopilando estos datos.</i>  <i>Tan pronto como tuvimos suficientes datos, pude usar netcat para reproducirlo en el sistema local, cuya configuraci√≥n se modific√≥ para mostrar una gran cantidad de informaci√≥n de depuraci√≥n.</i>  <i>Y todo sali√≥ a la perfecci√≥n.</i>  <i>El siguiente paso es reproducir los datos a la mayor velocidad posible.</i>  <i>En este caso, el bucle con la verificaci√≥n de condici√≥n envi√≥ las solicitudes sin procesar de una en una.</i>  <i>Despu√©s de aproximadamente dos horas, logr√© lograr el resultado deseado.</i>  <i>¬°Los datos en los registros mostraron la falta de un encabezado!</i> <i><br><br></i>  <i>Utilizo madera roja y negra para transmitir los encabezados.</i>  <i>Dichas estructuras consideran la comparabilidad como identidad, que en s√≠ misma es muy √∫til cuando existen requisitos especiales para las claves: en nuestro caso, los encabezados HTTP no distinguen entre may√∫sculas y min√∫sculas.</i>  <i>Al principio pensamos que el problema estaba en el nodo hoja de la biblioteca utilizada.</i>  <i>El orden de adici√≥n realmente afecta el orden de construcci√≥n del √°rbol base, y equilibrar el √°rbol rojo-negro es un proceso bastante complicado.</i>  <i>Y aunque esta situaci√≥n era poco probable, no era imposible.</i>  <i>Me cambi√© a otra implementaci√≥n de red-ebony.</i>  <i>Se solucion√≥ hace varios a√±os, as√≠ que decid√≠ incrustarlo directamente en la fuente para obtener exactamente la versi√≥n que se necesitaba.</i>  <i>Sin embargo, el ensamblaje eligi√≥ una versi√≥n diferente, y como contaba con una nueva, al final tuve un comportamiento incorrecto.</i> <i><br><br></i>  <i>Debido a esto, el sistema de visualizaci√≥n gener√≥ 500 errores, lo que condujo a la interrupci√≥n del ciclo.</i>  <i>Es por eso que el error solo ocurri√≥ con el tiempo.</i>  <i>Despu√©s del procesamiento c√≠clico de varios ensamblajes, el tr√°fico de ellos se redirigi√≥ a una ruta diferente, lo que aument√≥ la escala del problema en este servidor.</i>  <i>Mi suposici√≥n de que el problema estaba en la biblioteca result√≥ ser incorrecta, y el interruptor inverso resolvi√≥ 500 errores.</i> <i><br><br></i>  <i>Regres√© a 400 errores: todav√≠a hab√≠a un problema con el error, que tard√≥ aproximadamente dos horas en detectarse.</i>  <i>Cambiar la biblioteca, obviamente, no resolvi√≥ el problema, pero estaba seguro de que la biblioteca seleccionada era lo suficientemente confiable.</i>  <i>Sin darme cuenta de la falacia de la elecci√≥n, no cambi√© nada.</i>  <i>Despu√©s de estudiar la situaci√≥n con m√°s detalle, me di cuenta de que el valor correcto estaba almacenado en un encabezado de un solo car√°cter (por ejemplo, "h: 12345").</i>  <i>Finalmente me di cuenta de que h era el car√°cter final del encabezado Content-Length.</i>  <i>Al mirar los datos nuevamente, me di cuenta de que el encabezado Content-Length estaba vac√≠o.</i> <i><br><br></i>  <i>Como resultado, todo fue un error de sesgo de uno al leer los encabezados.</i>  <i>El analizador HTTP nginx / joyent crea datos parciales, y cada vez que el campo de encabezado parcial result√≥ ser un car√°cter m√°s corto de lo necesario, envi√© el encabezado sin un valor y posteriormente recib√≠ un campo de encabezado de un car√°cter que conten√≠a el valor correcto.</i>  <i>Esta es una combinaci√≥n bastante rara, por lo que su funcionamiento lleva mucho tiempo.</i>  <i>As√≠ que aument√© la cantidad de recopilaci√≥n de datos cada vez que apareci√≥ un encabezado de un car√°cter, apliqu√© la soluci√≥n propuesta y ejecut√© el script con √©xito durante varias horas.</i> <i><br></i>  <i>Por supuesto, se pudieron detectar algunos otros problemas con el mal funcionamiento de la biblioteca mencionado, pero ambos errores fueron corregidos ".</i> <i><br></i> <br><br>  Los ingenieros involucrados en el desarrollo de aplicaciones sensibles al retraso necesitan la capacidad de depurar usando tr√°fico din√°mico capturado, porque a menudo ocurren errores que no pueden reproducirse durante la prueba de la unidad o detectarse usando una herramienta de monitoreo (especialmente si hay un retraso grave en el registro). <br><br><h3>  Enfoque de ingenier√≠a del caos </h3><br>  <i>Chaos Engineering es un enfoque basado en experimentos en un sistema distribuido para confirmar su capacidad de soportar las condiciones ca√≥ticas del entorno de producci√≥n.</i> <br><br>  El m√©todo Chaos Engineering, que se hizo famoso por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Chaos Monkey de</a> Netflix, ahora se ha convertido en una disciplina independiente.  El t√©rmino Ingenier√≠a del Caos apareci√≥ recientemente, pero la prueba de fallas es una pr√°ctica de larga data. <br><br>  El t√©rmino "prueba ca√≥tica" se refiere a las siguientes t√©cnicas: <br><br><ul><li>  deshabilitar nodos arbitrarios para determinar qu√© tan resistente es el sistema al fracaso; </li><li>  introducir errores (por ejemplo, aumentar el retraso) para confirmar que el sistema los procesa correctamente; </li><li>  violaci√≥n forzada de la red para determinar la respuesta del servicio. </li></ul><br>  La mayor√≠a de las empresas utilizan un entorno operativo por niveles y poco complejo para realizar pruebas ca√≥ticas de manera efectiva.  Es importante enfatizar que la introducci√≥n de fallas en el sistema se realiza mejor despu√©s de configurar las funciones b√°sicas de tolerancia a fallas.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Este documento</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">t√©cnico de Gremlin</a> proporciona una descripci√≥n bastante completa de los principios de pruebas ca√≥ticas, as√≠ como instrucciones para prepararse para este procedimiento. <br><br>  <i>‚ÄúEspecialmente importante es el hecho de que Chaos Engineering se considera una disciplina cient√≠fica.</i>  <i>Dentro de esta disciplina, se aplican procesos de ingenier√≠a de alta precisi√≥n.</i> <i><br></i>  <i>La tarea de Chaos Engineering es <b>decirles a los</b> usuarios algo nuevo sobre las vulnerabilidades del sistema mediante la realizaci√≥n de experimentos en √©l.</i>  <i>Es necesario identificar todos los problemas ocultos que podr√≠an surgir en la producci√≥n, incluso antes de que causen una falla masiva.</i>  <i>Solo despu√©s de eso podr√° eliminar de manera efectiva todas las debilidades del sistema y hacerlo verdaderamente tolerante a fallas ‚Äù.</i> <br><br><h2>  Conclusi√≥n </h2><br>  El prop√≥sito de las pruebas en producci√≥n no es <i>eliminar</i> completamente todas las fallas posibles en el sistema.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">John Allspaw</a> dice: <br>  <i>‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vemos que los</a> sistemas son cada vez m√°s tolerantes a fallas, y eso es genial.</i>  <i>Pero debemos admitir: "m√°s y m√°s" no es igual a "absolutamente".</i>  <i>En cualquier sistema complejo, una falla puede suceder (y suceder√°) de la manera m√°s impredecible ".</i> <i><br></i> <br>  Las pruebas en producci√≥n a primera vista pueden parecer una tarea bastante complicada, que va mucho m√°s all√° de la competencia de la mayor√≠a de las empresas de ingenier√≠a.  Y aunque dicha prueba <i>no</i> es una tarea <i>f√°cil</i> , asociada con algunos riesgos, si la sigue todas las reglas, ayudar√° a lograr la confiabilidad de los sistemas distribuidos complejos que se encuentran en todas partes en la actualidad. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418329/">https://habr.com/ru/post/es418329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418317/index.html">2048 est√° prohibido. No RosKomNadzor</a></li>
<li><a href="../es418319/index.html">Bombillas LED Gauss 2017-2018</a></li>
<li><a href="../es418321/index.html">Generador de n√∫meros aleatorios de fotones: ¬øel cifrado m√°s confiable?</a></li>
<li><a href="../es418323/index.html">Un poco sobre los atributos de los hosts, el teclado, el c√≥digo y SCS en la serie "World of the Wild West" (Westworld)</a></li>
<li><a href="../es418327/index.html">Zapateros con botas: qu√© tel√©fonos inteligentes eligen los expertos por s√≠ mismos</a></li>
<li><a href="../es418331/index.html">Maestros de servidores y redes: felices fiestas</a></li>
<li><a href="../es418333/index.html">Los robots Uber est√°n volviendo a la carretera, pero la gente los conducir√°</a></li>
<li><a href="../es418335/index.html">Enfrentamiento en Positivo Hack Days 8: an√°lisis de cadenas de ataque</a></li>
<li><a href="../es418337/index.html">Hot, Summer DataGrip 2018.2</a></li>
<li><a href="../es418339/index.html">Manipulador "manual"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>