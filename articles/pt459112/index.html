<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÉ üï• üìØ No√ß√µes b√°sicas sobre o Google Chrome Converter recursos HTML para PDF üë∂üèæ üç∫ ‚úä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, em uma startup, resolvi o problema de gerar tickets em formato PDF. Naquela √©poca, um site com uma pilha estabelecida de tecnologias j√° ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>No√ß√µes b√°sicas sobre o Google Chrome Converter recursos HTML para PDF</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459112/"><p><img src="https://habrastorage.org/webt/nl/zz/on/nlzzon_ar_4p3nuhes4p4cgq2ey.jpeg"></p><br><p>  Recentemente, em uma startup, resolvi o problema de gerar tickets em formato PDF.  Naquela √©poca, um site com uma pilha estabelecida de tecnologias j√° estava pronto, ent√£o eu estava procurando uma abordagem que n√£o exigisse o uso de ferramentas adicionais.  No final, propus criar primeiro tickets no formato HTML e depois converter em PDF usando o navegador Chrome.  Como se viu, dessa forma, voc√™ pode gerar n√£o apenas tickets ricamente decorados com CSS, mas tamb√©m uma variedade de relat√≥rios com gr√°ficos em JavaScript.  Neste artigo, falarei sobre como iniciar o Chrome para esses fins, darei algumas dicas para personalizar o CSS e tamb√©m discutirei as desvantagens dessa solu√ß√£o. </p><a name="habracut"></a><br><p>  Op√ß√µes alternativas n√£o ser√£o discutidas aqui, porque j√° foram escritas o suficiente sobre elas, s√£o f√°ceis de encontrar e s√£o ferramentas prontas, informa√ß√µes sobre as quais √© melhor procurar nas fontes principais - na documenta√ß√£o em sites oficiais.  O m√©todo proposto n√£o √© uma ferramenta independente e √© mais um subproduto do desenvolvimento de v√°rias tecnologias.  No segmento da Internet em l√≠ngua russa, h√° poucas informa√ß√µes coletadas, ent√£o decidi preencher a lacuna. </p><br><h2 id="pochemu-vybran-imenno-etot-variant">  Por que essa op√ß√£o √© escolhida? </h2><br><p>  A maior vantagem √© que o Chrome n√£o precisa expandir a pilha de tecnologias para gerar PDF pelo navegador Chrome.  Os desenvolvedores de front-end criam HTML com ferramentas de desenvolvimento conhecidas e veem imediatamente os resultados intermedi√°rios do trabalho no navegador.  Ao mesmo tempo, o Chrome provavelmente est√° rodando nos testes e transferi-lo para o back-end n√£o √© dif√≠cil.  Tamb√©m deve ser observado que o codificador √© capaz de acessar todo o arsenal de propriedades do CSS, incluindo Flexbox e Grid. <br>  Vou falar sobre as defici√™ncias e maneiras de contorn√°-las durante o curso do artigo. </p><br><h2 id="reshaem-zadachu-odnoy-strokoy">  Resolvemos o problema em uma linha </h2><br><p>  Na linha de comando, chamamos o Chrome no modo decapitado, salvando a p√°gina em pdf: </p><br><pre><code class="bash hljs">chrome --headless --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-gpu --<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-to-pdf https://google.com</code> </pre> <br><p>  Os usu√°rios do Linux podem precisar executar <code>chromium-browser</code> vez do <code>chrome</code> . <br>  Os usu√°rios de MAC podem achar √∫til pr√©-criar o alias: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> chrome=<span class="hljs-string"><span class="hljs-string">"/Applications/Google\\ \\Chrome.app/Contents/MacOS/Google\\ \\Chrome"</span></span></code> </pre> <br><p>  ATUALIZA√á√ÉO: Os coment√°rios esclareceram que os usu√°rios do Windows precisam definir explicitamente o nome do arquivo PDF <code>--print-to-pdf=output.pdf</code> </p><br><p>  Se voc√™ j√° possui um gerador de documentos HTML, em vez de <code>https://google.com</code> especifique o URL para receber este documento. </p><br><p>  Abra o arquivo <code>output.pdf</code> no diret√≥rio local e observe o resultado. <br>  A primeira coisa que chama sua aten√ß√£o √© a presen√ßa de um cabe√ßalho com uma data de impress√£o e um rodap√© com um URL e pagina√ß√£o.  Para remov√™-los, voc√™ precisa adicionar algumas regras CSS.  √â improv√°vel que essas regras sejam adicionadas ao <code>google.com</code> , portanto, para mais trabalhos, √© melhor criar seu pr√≥prio documento HTML. </p><br><h2 id="dobavlyaem-css">  Adicionar CSS </h2><br><p>  O CSS possui uma consulta de m√≠dia especial <code>@page</code> , que √© usada para impress√£o; definiremos o recuo para que o Cabe√ßalho e o Rodap√© simplesmente n√£o se ajustem: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">size</span></span>: A4; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0mm</span></span>; }</code> </pre> <br><p>  Esse m√©todo funcionar√° apenas para documentos de p√°gina √∫nica. Ao imprimir duas ou mais p√°ginas, o Rodap√© com o URL e a numera√ß√£o de p√°ginas permanecer√£o na parte inferior inferior.  Voc√™ pode pedir explicitamente ao Chrome para desativar a exibi√ß√£o de Cabe√ßalho e Rodap√©, definindo o par√¢metro de impress√£o <code>displayHeaderFooter = False</code> , mas no momento ele n√£o √© movido para a interface da linha de comandos.  Para isso, voc√™ precisar√° de ferramentas para automatizar o trabalho com o navegador: Selenium ou titereiro.  A seguir, considerarei a primeira op√ß√£o, porque meu projeto usou Python. </p><br><h2 id="zapuskaem-chrome-cherez-selenium">  Inicie o Chrome via Selenium </h2><br><p>  Portanto, instale o Selenium com o comando <code>pip install selenium</code> , fa√ßa o download do driver chrome que corresponde √† sua vers√£o do Chrome em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://chromedriver.chromium.org/</a> e use a fun√ß√£o <code>get_pdf_from_html</code> do exemplo abaixo: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webdriver <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.chrome.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json, base64 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pdf_from_html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, chromedriver=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'./chromedriver'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, print_options = {})</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Chrome webdriver_options = Options() webdriver_options.add_argument('--headless') webdriver_options.add_argument('--disable-gpu') driver = webdriver.Chrome(chromedriver, options=webdriver_options) #   url driver.get(path) #    calculated_print_options = { 'landscape': False, 'displayHeaderFooter': False, 'printBackground': True, 'preferCSSPageSize': True, } calculated_print_options.update(print_options) #    pdf  result = send_devtools(driver, "Page.printToPDF", calculated_print_options) driver.quit() #    base64 -  return base64.b64decode(result['data']) def send_devtools(driver, cmd, params={}): resource = "/session/%s/chromium/send_command_and_get_result" % driver.session_id url = driver.command_executor._url + resource body = json.dumps({'cmd': cmd, 'params': params}) response = driver.command_executor._request('POST', url, body) if response['status']: raise Exception(response.get('value')) return response.get('value') if __name__ == "__main__": if len(sys.argv) != 3: print ("usage: converter.py &lt;html_page_sourse&gt; &lt;filename_to_save&gt;") exit() result = get_pdf_from_html(sys.argv[1]) with open(sys.argv[2], 'wb') as file: file.write(result)</span></span></code> </pre><br><p>  Para obter um arquivo PDF, voc√™ pode executar este exemplo na linha de comando, especificando o URL e o nome do arquivo para salvar o PDF, ou chame a fun√ß√£o <code>get_pdf_from_html</code> e passe tr√™s argumentos para ele: </p><br><ol><li>  caminho - URL do documento html; </li><li>  chromedriver - o caminho na m√°quina local para o driver chrome (por padr√£o, ele deve estar no diret√≥rio local); </li><li>  print_options - atributos de impress√£o adicionais. </li></ol><br><p>  Deve-se observar que o Selenium n√£o possui uma interface padr√£o para imprimir uma p√°gina em PDF, e somente o Chrome pode fazer isso; portanto, √© necess√°rio ligar diretamente para <code>driver.command_executor._request</code> . </p><br><p>  Agora vamos ver quais ferramentas est√£o dispon√≠veis para controlar o posicionamento do conte√∫do em documentos de v√°rias p√°ginas. </p><br><h2 id="tipografika-v-css">  Tipografia CSS </h2><br><p>  Ao imprimir em frente e verso, voc√™ pode definir margens diferentes da borda para as p√°ginas direita e esquerda individualmente se planeja costur√°-las no futuro: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:left</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; } @<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:right</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; }</code> </pre> <br><p>  Para a primeira p√°gina, voc√™ pode especificar seu pr√≥prio design, por exemplo, um recuo aumentado da borda superior: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:first</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10cm</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Top margin on first page 10cm */</span></span> }</code> </pre> <br><p>  √â poss√≠vel definir a quebra de p√°gina antes do cabe√ßalho do primeiro n√≠vel para que comece em uma p√°gina √≠mpar: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before </span></span>: right }</code> </pre> <br><p>  Usando a propriedade <code>page-break-after</code> , voc√™ pode impedir uma quebra de p√°gina imediatamente ap√≥s algum elemento, por exemplo, um cabe√ßalho de segundo n√≠vel: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-after </span></span>: avoid }</code> </pre> <br><p>  A propriedade <code>page-break-inside</code> ajuda a evitar quebras de p√°gina onde √© indesej√°vel fazer isso, por exemplo, no meio de uma tabela </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-inside </span></span>: avoid }</code> </pre> <br><p>  As <code>orphans</code> e <code>orphans</code> ajudar√£o a evitar quebras de p√°gina no in√≠cio e no final de um par√°grafo: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">orphans</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">widows</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><h2 id="chto-s-proizvoditelnostyu">  E o desempenho? </h2><br><p>  Em um Core i5-8600K 3600MHz em um fluxo, uma simples convers√£o de documento leva 0,6 segundos.  Na minha m√°quina de escrever port√°til de final de 2013, 2,4 GHz - 1,5 segundos. <br>  Obviamente, os principais recursos s√£o gastos no lan√ßamento do navegador.  Voc√™ pode reduzir o tempo de convers√£o para um grande n√∫mero de arquivos se executar o Chrome uma vez como microsservi√ßo e enviar a ele um URL para convers√£o.  A implementa√ß√£o deste m√©todo est√° al√©m do escopo deste artigo. </p><br><h2 id="chto-esche-ne-tak">  O que mais est√° errado? </h2><br><p>  Eu vejo dois problemas principais: </p><br><ol><li>  A impossibilidade de simplesmente determinar a posi√ß√£o dos elementos em um documento.  Isso dificulta a cria√ß√£o de um √≠ndice com indica√ß√£o autom√°tica dos n√∫meros de p√°gina, especialmente se o tamanho do conte√∫do n√£o for conhecido antecipadamente. </li><li>  A convers√£o do Chrome √© o produto do Google, que coleta diversas informa√ß√µes sobre os usu√°rios.  Se o vazamento de dados do documento for inaceit√°vel, voc√™ deve ter cuidado com a solu√ß√£o proposta - feche o navegador com acesso a recursos externos ou procure outra solu√ß√£o.  O uso de c√≥digo aberto Chromium n√£o resolve o problema - j√° foram encontrados erros do Google. </li></ol><br><h2 id="vyvody">  Conclus√µes </h2><br><p>  Proponho tirar conclus√µes sobre a admissibilidade de usar essa abordagem por conta pr√≥pria.  Cada projeto √© √∫nico √† sua maneira.  Se voc√™ decide se esse m√©todo √© adequado em seu projeto. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459112/">https://habr.com/ru/post/pt459112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459100/index.html">O GitHub Package Registry suportar√° pacotes Swift</a></li>
<li><a href="../pt459102/index.html">Prato de presente ou m√∫sica gr√°tis para os amantes de refrigerantes e caf√©s da manh√£ prontos</a></li>
<li><a href="../pt459104/index.html">C # ou Java? TypeScript ou JavaScript? A classifica√ß√£o de linguagens de programa√ß√£o com base no aprendizado de m√°quina</a></li>
<li><a href="../pt459108/index.html">Tesla apresentar√° v√°rias surpresas ao mesmo tempo no segundo semestre deste ano</a></li>
<li><a href="../pt459110/index.html">Estamos escrevendo um bot de pesca no jogo Albion Online em Python</a></li>
<li><a href="../pt459114/index.html">14 Melhores Plugins de SEO para WordPress em 2019</a></li>
<li><a href="../pt459116/index.html">Um passo mais perto do reparo do timo</a></li>
<li><a href="../pt459118/index.html">Como projetamos e implementamos a nova rede na Huawei no escrit√≥rio de Moscou, parte 2</a></li>
<li><a href="../pt459120/index.html">Computadores modulares incorporados da s√©rie UNO-1000/2000</a></li>
<li><a href="../pt459122/index.html">Aleksey Savvateev: Pr√™mio Nobel de Jean Tyrol por analisar mercados imperfeitos (2014) e reputa√ß√£o coletiva</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>