<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👨🏾 🤢 🧚 Échec linguistique épique, ou Comment entasser tout le dictionnaire de la langue russe dans Power BI 💛 ➗ 🚳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D'une manière ou d'une autre, en résolvant le problème de l'analyse linguistique dans Power BI et en recherchant en même temps des exemples pour mon a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Échec linguistique épique, ou Comment entasser tout le dictionnaire de la langue russe dans Power BI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/429140/"><img src="https://habrastorage.org/webt/ig/jx/ik/igjxikbvwngnl6pdd9voe9ukrvc.jpeg" alt="image"><br><br>  D'une manière ou d'une autre, en résolvant le problème de l'analyse linguistique dans Power BI et en recherchant en même temps des exemples pour mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent</a> , je me suis souvenu du problème que j'ai essayé de résoudre dans Excel il y a plusieurs années: il était nécessaire d'implémenter un dictionnaire de langue russe dans le système analytique pour l'analyse linguistique d'un grand nombre de requêtes en langage naturel.  Et il était souhaitable d'utiliser des outils bureautiques standard.  La grande majorité des gens entreprendraient immédiatement cette tâche dans Excel, et j'ai une fois suivi le même chemin.  J'ai utilisé le corpus ouvert de la langue russe ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://opencorpora.org/</a> ) comme dictionnaire. <br><br>  Mais la déception m'attendait - le dictionnaire comprenait 300 000 formes de mots, plus de 5 millions d'entrées, et pour Excel c'est, en principe, un montant impossible.  Même si vous y introduisez «juste» 1 million de lignes, seule une personne très patiente qui ne sera jamais pressée pourra effectuer des manipulations avec elle ou, Dieu nous en préserve, des calculs.  Mais cette fois, j'ai décidé de définir un outil plus approprié pour la tâche - Power BI. <br><a name="habracut"></a><br><h2>  Qu'est-ce que Power BI? </h2><br>  Je trouve ce produit largement sous-estimé par la communauté professionnelle.  Power BI est un ensemble d'outils d'analyse commerciale qui a été créé pour les utilisateurs qui possèdent Excel à un niveau légèrement supérieur à «diviser le montant en colonnes».  Si une personne est capable d'écrire des formules de complexité moyenne dans Excel, elle maîtrisera Power BI en quelques soirées. <br><br>  Ce n'est pas un produit unique avec une sorte de logique de programmation interne, mais un système de trois composants: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea3/887/958/ea38879580c8b208c77bf0366d74dc60.png" alt="image"><br><br><ul><li>  <b>Requête de puissance</b>  Il s'agit d'un ETL, dans lequel il est nécessaire d'écrire des requêtes en utilisant son propre langage de programmation entièrement fonctionnel - M. En toute honnêteté, il convient de noter que, très probablement, un utilisateur ordinaire est peu susceptible d'avoir à le programmer: la plupart des fonctions sont disponibles directement via le menu ou l'assistant dans l'interface du composant.  Le langage M est complètement différent du langage de requête DAX (PowerPivot).  Cependant, Microsoft les a réunis.  Cela a du sens du point de vue du développement: ETL est conçu pour la réception et la saturation initiale des données (pas rapide), et DAX - pour les calculs qui nous aident à visualiser ces données (rapidement).  Autrement dit, DAX est pour le frontal, et Power Query pour le backend, pour le processus d'extraction et de formatage des données. </li><li>  <b>PowerPivot</b> .  Un module de traitement en mémoire basé sur le moteur xVelocity.  Utilise le langage de requête DAX, très similaire au langage de formule Excel. </li><li>  <b>Composant de visualisation</b> .  Il est très utile pour une utilisation dans des systèmes où vous devez visualiser des données: sur le site Web d'une entreprise, ou sur un portail de support technique (par exemple, un nuage de requêtes), ou sur une ressource interne de l'entreprise.  Il existe des outils qui peuvent le faire sans Power BI, mais beaucoup d'entre eux n'aideront pas lorsque le nombre d'enregistrements est en millions et que les données doivent être agrégées d'une manière ou d'une autre.  Et avec d'autres outils de ce type, Power BI fait concurrence en raison de sa simplicité et de son faible coût de traitement en mémoire.  Il est clair que si nous parlons de téraoctets de données, une approche différente sera nécessaire.  Et pour de tels cas, Microsoft a déjà quelque chose à offrir, mais c'est un sujet pour un article séparé. </li></ul><br>  La courbe d'apprentissage à la première étape augmente très fortement: si vous êtes bon dans Excel, alors 80% des fonctionnalités de Power BI s'ouvriront à vous après une courte étude.  C'est un outil très puissant, assez facile à utiliser, mais - jusqu'à un certain point.  Pour l'utiliser à pleine capacité, vous aurez déjà besoin d'expérience et d'une connaissance approfondie des langages M et DAX. <br><br><h2>  À quoi sert Power BI Desktop? </h2><br>  À qui cela peut-il être utile?  Tout d'abord, tous les utilisateurs professionnels qui doivent traiter et analyser de grandes quantités de données lorsque Excel n'est plus en mesure de faire face ou de gonfler à la limite.  J'insiste - Power BI Desktop est conçu <b>pour un large éventail d'utilisateurs qui résolvent une gamme très variée de tâches</b> .  Par exemple, dans mon cas, il s'agissait de normaliser 5 millions d'entrées de texte pour la détermination ultérieure de la fréquence des mots clés. <br><br>  Ceci est demandé lors du traitement des questionnaires, des requêtes des moteurs de recherche, des publicités, des dictées / essais, des tableaux statistiques, etc. Ou pour la résolution de mots croisés ... <br><br>  Un autre cas et une option de mise en œuvre sont examinés dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sur le «reconnaissant» de Dmitry Tumaikin.  Implémenté sur Excel classique, mais en utilisant des macros ... <br><br>  Un autre scénario populaire pour cette application de Power BI consiste à calculer le ratio d'indicateurs pour la période actuelle et précédente.  Par exemple, nous avons des données de revenus pré-agrégées et vous devez les comparer en jours avec le trimestre, l'année ou la période précédente.  Et je veux / dois insérer le résultat de la comparaison dans la colonne suivante sous forme de valeurs, pas de formules.  Il semblerait que pour Excel, la tâche la plus simple consiste à écrire une formule de comparaison simple et à l'étirer sur toutes les cellules de la colonne.  Mais pas si vous avez plusieurs millions de lignes dans le tableau.  Dans DAX lui-même, cette tâche est encore plus facile que dans Excel, mais aussi uniquement à l'aide de post-calculs. <br><br>  De nombreux autres scénarios pratiques pour l'utilisation de Power BI peuvent être proposés, mais vous, je pense, avez déjà compris l'essentiel.  Bien sûr, toutes ces tâches ne sont pas un problème pour un programmeur qui possède, par exemple, Python ou R, mais ces spécialistes sont a priori plus petits par ordre de grandeur que les experts Excel.  Excel n'a que des possibilités limitées, mais pas avec Power BI, qui utilise le langage de formule DAX, qui est très similaire au langage de formule Excel, et est capable de traiter des millions et des dizaines de millions d'enregistrements à la volée.  Et puis vous devez augmenter la RAM (au moins jusqu'à 100, au moins jusqu'à 300 Go). <br><br><h2>  Nous aidons les demandes de processus de support technique </h2><br>  Mais revenons à ma tâche.  Il était nécessaire de trouver comment la ligne zéro du support technique évaluerait automatiquement le sujet des demandes des utilisateurs.  Pour commencer, j'ai décidé d'isoler certaines formes de mots et de déterminer les sujets les plus importants que les utilisateurs soulèvent le plus souvent par la fréquence de leur apparition dans les messages. <br><br>  Le dictionnaire source est un simple fichier texte qui a une structure régulière et ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/-j/yj/pi/-jyjpiiq6ttx9cwq3-3ckouy2c0.png" alt="image"><br><br>  À des fins statistiques, il a été nécessaire de déterminer la forme initiale pour chaque forme de mot: pour les noms - un seul numéro du cas nominatif, pour les verbes - une forme indéfinie, etc.  Pour les programmeurs, cette tâche était plus simple que simple: pour chaque mot dans la colonne de gauche, recherchez la correspondance avec le formulaire qui suit immédiatement le numéro de ce mot dans le dictionnaire. <br><br>  C'est juste l'utilisateur professionnel moyen qui ne possède pas Python, des outils spécialisés et des compétences en développement, ne sera pas en mesure de résoudre ce problème sans utiliser l'auto-analyse BI ou des outils conviviaux similaires.  De plus, si les données doivent être traitées pour leurs besoins internes ou s'il n'y a aucune information confidentielle qui nécessite une protection, Power BI dans ce cas sera également gratuit *. <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqué</b> <div class="spoiler_text">  *) Il s'agit de la version Power BI Desktop et de la version Power BI Services pour un usage personnel au tarif gratuit. </div></div><br>  Pour analyser les données, j'avais besoin dans Power Query, dans un tableau de 5 millions d'enregistrements, d'ajouter une nouvelle colonne, décalée d'une position.  Au début, j'ai essayé d'appliquer l'approche classique à l'aide de Power Query, qui est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">décrite</a> sur le portail de la communauté Power BI par Marcel Beug, l'auteur de la référence en ligne originale de Power Query en ligne (également écrite en Power Query).  Deux algorithmes différents sont proposés dans l'article: l'un est inspiré par les idées de Matt Elington, un gourou célèbre et formateur Power BI, et la seconde approche est l'idée originale de Marcel lui-même, en utilisant une fonction supplémentaire.  Malgré le fait que pour augmenter la productivité, j'ai complètement mis en cache les données source, les deux approches ont nécessité un temps gigantesque - elles étaient déjà passées le huitième jour et le processus n'était pas terminé.  La taille du fichier source était de 270 Mo et la taille actuelle des données traitées était proche de 17 To.  Je suis sûr que peu d'utilisateurs Power BI ont vu de tels nombres dans la fenêtre de chargement des données à partir d'une source de fichiers. <br><br><img src="https://habrastorage.org/webt/ox/yq/e_/oxyqe_yrqk_1zhbfscm1rbuvjma.png" alt="image"><br><br>  Pourquoi le volume est si gonflé, ce n'est pas clair;  même le produit cartésien de tous les enregistrements est bien inférieur à 16 To.  Ici, l'optimiseur interne n'était clairement pas à la hauteur.  Et, par exemple, DAX-Studio n'autorise pas le traçage des requêtes Power Query, uniquement DAX.  Peut-être que quelqu'un partagera son expérience avec PQ Troubleshipping? <br><br>  Sans attendre la fin du premier processus, j'ai décidé sur une autre machine d'essayer de résoudre le problème en utilisant DAX via une requête auto-écrite.  La demande a été satisfaite ... en 180 secondes environ, et la consommation de mémoire a légèrement augmenté. <br><br><img src="https://habrastorage.org/webt/nb/aw/e2/nbawe2uffzilci2ttxi6ulhqg24.png" alt="image"><br><br>  Code source d'une demande DAX: <br><br> <code>KeyWord = <br> CALCULATE( <br> TOPN(1; <br> CALCULATETABLE( <br> VALUES(ShiftedList[Word]) <br> ;ALLEXCEPT(ShiftedList;ShiftedList[Word Nr]) <br> ) <br> )//TOPN <br> )//CALCULATE <br> <br></code> <br><br>  C'est-à-dire que pour chaque ligne de la nouvelle colonne [KeyWord], la toute première valeur de la colonne [Word] est recherchée, contenant toutes les variantes de formes de mots ayant le même numéro de forme de mot de base (colonne [Word Nr]).  Tant que le format du fichier source reste inchangé, la demande doit être exécutée sans erreur sur toutes les versions ultérieures du dictionnaire. <br><br>  Le code de requête dans Power Query, qui forme la table source au format requis, a été généré «automatiquement» et terminé en moins d'une minute: <br><br><img src="https://habrastorage.org/webt/v8/yj/xq/v8yjxq04xubrbgacegv6tiw-q2m.png" alt="image"><br><br>  Après qu'une colonne de mots clés a été formée dans l'interface PowerPivot en trois minutes, la recherche des formes de mots dans l'interface Power BI ne prend pas plus de 4 secondes.  De plus, une recherche de contrôle pour les mêmes données dans votre Notepad ++ x64 préféré pourrait prendre 20 secondes ou plus.  Mais ce n'est pas une pierre dans le jardin de la centrale nucléaire - il est plus difficile (et plus long) de rechercher l'ensemble du tableau de données qu'en fonction de données déjà balisées. <br><br>  Soit dit en passant, la demande DAX ci-dessus n'est pas née la première fois et les options intermédiaires ont consommé toute la mémoire disponible, ont fonctionné pendant une longue période et se sont terminées par une erreur de données ou un résultat non pertinent. <br><br><img src="https://habrastorage.org/webt/h0/bm/b_/h0bmb_w7wieehm3olc7lgsfwpnm.png" alt="image"><br><br>  En conséquence, la taille du fichier PBIX enregistré est devenue 60% (112 Mo) plus petite que le dictionnaire de texte d'origine, mais plus de 4 fois la taille de l'archive ZIP avec le même dictionnaire. <br><br>  Revenons à la bataille entre Power Query et DAX: la différence de durée d'une même opération dans différents composants suggère que Power BI n'est pas un pied-de-biche contre lequel il n'y a pas de réception.  Il a son propre caractère et les caractéristiques de l'application, qui doivent être pris en compte dans son travail.  En fait, comme tout outil.  Et les recommandations de gourous même reconnus doivent être traitées avec prudence. <br><br>  Il semble que le lauréat du prix Nobel Richard Smalley disait, paraphrasant la première loi de Clark: «Lorsque les experts disent que quelque chose est faisable, ils ont probablement raison (ils ne savent tout simplement pas quand).  Quand ils disent que cela est impossible, ils se trompent probablement. " <br><br>  Caractéristiques de la machine d'essai: <br>  <i>Processeur: Intel Core i7 4770 @ 3,4 GHz (4 cœurs)</i> <i><br></i>  <i>RAM: 16 Go</i> <i><br></i>  <i>Système d'exploitation: Windows 7 Enterprise SP1 x64</i> <br><br>  Le dictionnaire prêt à l'emploi au format Power BI peut être téléchargé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici,</a> une version en ligne modifiée du dictionnaire est disponible.  Vous pouvez résoudre les mots croisés à votre guise :) <br><br><img src="https://habrastorage.org/webt/6l/zp/-j/6lzp-jafheccraeyj8hi-ktvt8k.png" alt="image"><br><br>  ... Soit dit en passant, il y a plusieurs années, la tâche a néanmoins été résolue dans Excel, mais pas à 100%.  Juste pour l'analyse des textes, pas tout le corpus de la langue russe a été utilisé, mais le dictionnaire des fréquences.  Pour le nettoyage de texte de base, n'importe laquelle des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">listes de fréquences</a> top100 disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> pour plusieurs dizaines de kilo-octets est tout à fait appropriée. <br><br>  <i>Yuri Kolmakov, expert, Département des systèmes de consolidation et de visualisation des données, Jet Infosystems ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">McCow</a> )</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429140/">https://habr.com/ru/post/fr429140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429122/index.html">L'avenir proche de NetApp</a></li>
<li><a href="../fr429124/index.html">Organisation de visioconférence atypique dans une grande entreprise chimique</a></li>
<li><a href="../fr429126/index.html">Visiter le père</a></li>
<li><a href="../fr429136/index.html">Samsung a présenté un smartphone avec un écran qui s'estompe</a></li>
<li><a href="../fr429138/index.html">Ce qui cache le PDF</a></li>
<li><a href="../fr429144/index.html">Smartphones pliables et autres informations Android Dev Summit</a></li>
<li><a href="../fr429146/index.html">Alimentation à découpage pour téléscripteur des années 40 (avec des thyratrons au mercure lumineux!)</a></li>
<li><a href="../fr429148/index.html">Comment des «gestionnaires efficaces» ont noyé Flickr</a></li>
<li><a href="../fr429150/index.html">Gestion de vos modules pour CMS à l'aide de composer</a></li>
<li><a href="../fr429152/index.html">Composant de navigation Android. Des choses simples à faire soi-même</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>