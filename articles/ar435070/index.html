<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โ๏ธ ๐ฅ ๐ ููุฏูุฉ ูุทุจูุฉ 3 ุฌุฏุงุฑ ุงูุญูุงูุฉ MikroTik ๐ ๐ฌ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุนุฏ ุฌุฏุงุฑ ุงูุญูุงูุฉ (ุฃู ุนุงูู ุชุตููุฉ ุงูุญุฒูุฉ) ููุถูุนูุง ูุจูุฑูุง ููุนูุฏูุง ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ูุงูุนูููุฉ. ูููู ุฃู ูููู ููุฑุดุญ ุงูุญุฒูุฉ ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงููุฎุชููุฉ ุฅูุฌุงุจู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุฏูุฉ ูุทุจูุฉ 3 ุฌุฏุงุฑ ุงูุญูุงูุฉ MikroTik</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435070/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุนุฏ ุฌุฏุงุฑ ุงูุญูุงูุฉ (ุฃู ุนุงูู ุชุตููุฉ ุงูุญุฒูุฉ) ููุถูุนูุง ูุจูุฑูุง ููุนูุฏูุง ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ูุงูุนูููุฉ.  ูููู ุฃู ูููู ููุฑุดุญ ุงูุญุฒูุฉ ูู ุฃูุธูุฉ ุงูุชุดุบูู ุงููุฎุชููุฉ ุฅูุฌุงุจูุงุช ูุณูุจูุงุช ููุงุฑูุฉ ุจุงูุชุทุจููุงุช ุงูุฃุฎุฑู.  ูู ูุฐู ุงูููุงูุฉ ุ ุณุฃูุธุฑ ุญุตุฑููุง ูู "ุฌุฏุงุฑ ุงูุญูุงูุฉ" ูู RouterOS ูุน ูุฑุงุนุงุฉ iptables ุงูุณูู. </p><a name="habracut"></a><br><h3 id="predislovie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h3><br><h4 id="dlya-kogo-eta-statya" style=";text-align:right;direction:rtl">  ูู ูู ูุฐุง ุงูููุงู ูุ </h4><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุนุฑู ููููุฉ ุงูุนูู ูุน iptables ุ ูุชุงุจุน ูุชูููู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ููู ูููู ููุงู ุดูุก ุฌุฏูุฏ ุจุงููุณุจุฉ ูู ูู ูุฐู ุงูููุงูุฉ (ุญุณููุง ุ ุจุงุณุชุซูุงุก ุฃูู ูุชู ุงุณุชุฎุฏุงู ุงูุณูุงุณู ุฐุงุช ุงูุฃุณูุงุก ุงูุฃุฎุฑู ูู ุฌุฏูู NAT).  ุฅุฐุง ูุงูุช ูุฐู ูู ุงููุฑุฉ ุงูุฃููู ุงูุชู ุชุฑู ูููุง ุฌุฏุงุฑ ุญูุงูุฉ ูู RouterOS ูุชุฑุบุจ ูู ุงูุญุตูู ุนูู ุจุฑูุงูุฌ ูุตู ุฌุงูุฒ ููุชูููู ุ ููู ุชุฌุฏู ููุง.  ุชูุฏู ุงููุงุฏุฉ ุฅูู ุฃููุฆู ุงูุฐูู ูุฑุบุจูู ูู ุงูุญุตูู ุนูู ููุฑุฉ <strong>ุฃุณุงุณูุฉ</strong> ุนู ููููุฉ ุนูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ููุง ูุญุฏุซ ูุน ุฑุฒูุฉ ุจุฑูุชูููู ุงูุฅูุชุฑูุช ูู ูุฑุงุญู ูุฎุชููุฉ ูู ูุนุงูุฌุชูุง.  ุณูุฃุชู ููู ุฃุนูู ูุน ุงูุฎุจุฑุฉ ูุญู ุงููุดุงูู ุงูููููุฉ ูุบูุฑ ุงูุนุงุฏูุฉ ุจุงุณุชุฎุฏุงู ูุฑุดุญ ุงูุญุฒูุฉ. </p><br><h3 id="teoreticheskaya-chast" style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงููุธุฑู </h3><br><h4 id="chto-takoe-layer3-firewall" style=";text-align:right;direction:rtl">  ูุง ูู ุฌุฏุงุฑ ุงูุญูุงูุฉ Layer3ุ </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ai/xt/od/aixtod5yvn-bvirxxdvwmnm2m30.png"></p><br><p style=";text-align:right;direction:rtl">  ูููุชุฑุถ ุฃู ูุฏูู ุฌูุงุฒ ุชูุฌูู ูุฒูุฏ ุจุฅููุงููุฉ ุงููุตูู ุฅูู ุงูุฅูุชุฑูุช ููุงุฌูุชูู ููุฌุณุฑ: ุฌุณุฑ ุงูุดุจูุฉ ุงููุญููุฉ (ether2-ether5) ู bridge-dmz (ether6-ether10). </p><br><p style=";text-align:right;direction:rtl">  ุฏุงุฎู ูุงุฌูุฉ Bridge ุ ุชุนุซุฑ ุงูุฃุฌูุฒุฉ ุจุดูู ูุณุชูู ุนูู ุงูุฌูุฑุงู ูู ุดุจูุงุชูุง ุงููุฑุนูุฉ ูุญุฒู ุงูุชุจุงุฏู ุ ููุนูู ุฌูุงุฒ ุงูุชูุฌูู ููุญูู ููุง ูุฑุงูุจ ุญุฑูุฉ ุงููุฑูุฑ ูุฐู ุนูู ูุณุชูู ุงูุดุจูุฉ (ุจุงูุทุจุน ุ ููููู ุฅุฌุจุงุฑูุง ุนูู ุงูููุงู ุจุฐูู ุ ูููู ุฏุนูุง ูุชุญุฏุซ ุนู Layer2 Firewall ูู ููุช ุขุฎุฑ). </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ุงุชุตู ุจุงูุฌูุงุฒ ุงููุชุตู ุจูุงุฌูุฉ ุฌุณุฑ ุฃุฎุฑู ุฃู ููุฌูุฏ ุนูู ุงูุดุจูุฉ ุงูุนุงูููุฉ ุ ุญูุซ ุชููู ุงูุฃุฌูุฒุฉ ุจููู ุงูุญุฒู ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ุ ูุงูุฐู ูุญุฏุฏ ุงููุณุงุฑ ููุนุงูุฌูุง ุนูู ูุณุชูู ุงูุดุจูุฉ (ุงูุทุจูุฉ 3). </p><br><h4 id="packet-flow-diagram" style=";text-align:right;direction:rtl">  ูุฎุทุท ุชุฏูู ุงูุญุฒูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุชู ูุตู ุงููุณุงุฑ ุงููุงูู ูุญุฑูุฉ ุงููุฑูุฑ ูู Packet Flow Diagram ุ ูููุงู ุงูุนุฏูุฏ ูู ุงูุฅุตุฏุงุฑุงุช ุงูุฑุณููุฉ (v5 ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">v6</a> ) ุ ูุฌุจ ุฃู ุชููู ูุนุฑููุฉ ูุชุณุชุฎุฏู ูู ุงูุนูู ุงููููู ุ ูููู ูููู ุชุดุบูู ูุฑุดุญ ุงูุญุฒูุฉ ุ ูุชู ุชุญููููุง ุจุดูู ุฒุงุฆุฏ ุ ูุฐูู ุณุฃุดุฑุญ ูู ุฅุตุฏุงุฑ ุฎููู ุงููุฒู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cb/fr/uu/cbfruui7ydb8lqm19myzozfotbo.png"></p><br><p style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ูู ุฃู ูุงุฌูุฉ ุฌูุงุฒ ุชูุฌูู (Layer 3) (ูุนููุฉ ุฃู ุงูุชุฑุงุถูุฉ).  ุชุตู ุงูุญุฒูุฉ ุงูุชู ุชูุชูู ูู ุงูุดุจูุฉ ุงููุญููุฉ ุฅูู ุงูุฅูุชุฑูุช ุฅูู ูุงุฌูุฉ ุงูุฅุฏุฎุงู ูุชุชุฑู ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ.  ุชุตู ุงูุญุฒูุฉ ูู ุงูุฅูุชุฑูุช ุฅูู ุงูุดุจูุฉ ุงููุญููุฉ ุฃูุถูุง ุฅูู ูุงุฌูุฉ ุงูุฅุฏุฎุงู ุ ูุชุชุฑู ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ.  ูุชู ุฏุงุฆููุง ูุฑุงุกุฉ ุญุฒูุฉ ุงูุชุฏูู ูู ุฅุฏุฎุงู ุงุชุฌุงู ูุงุญุฏ -&gt; ุงูุฅุฎุฑุงุฌ. </p><br><h4 id="osobennosti-terminologii" style=";text-align:right;direction:rtl">  ููุฒุงุช ุงููุตุทูุญุงุช </h4><br><p style=";text-align:right;direction:rtl">  ุฏุฑุงุณุฉ ุชุฏูู ุงูุญุฒูุฉ ูุฃุฌูุฒุฉ iptables ุ ููููู ุงูุนุซูุฑ ุนูู ุฃูุตุงู ูู ุฎูุงู "ุณูุงุณู ูู ุงูุฌุฏุงูู" ุฃู "ุฌุฏุงูู ูู ุณูุงุณู".  ููุถุญ ุงููุฎุทุท ุงูุฌุฏุงูู ูู ุงูุณูุงุณู ุ ูุนูุฏ ุฅุถุงูุฉ ููุงุนุฏ ุฅูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ุณูููู ูู ุดูุก ุจุงูุนูุณ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูู ุงููุงูุน ุ ุชูุชูู ุงูุญุฒูุฉ ุจูู ูุชู [ุณูุณูุฉ + ุฌุฏุงูู] ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุช ุจูุจูู ูู ูุชูุฉ [prerouting + mangle] ุ ุณุชุธู ุญุฒูุฉ ุงูููู ุชุชู ูุนุงูุฌุชูุง ูู [forward + mangle].  ูู ุงูููู ุชุฐูุฑ ุฐูู ูู ุงูุชููููุงุช ุงููุนูุฏุฉ ุจุงุณุชุฎุฏุงู pbr ู ููุงุฆู ุงูุงูุชุธุงุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ูุซุงุฆู iptables ุนูู ุชุนุฑููุงุช ุฃูุซุฑ ุฏูุฉ ุ ูููู ุจูููุงุช ุจุณูุทุฉ: <br>  <strong>ุงูุณูุงุณู</strong> ูุณุคููุฉ ุนู ููุงู ูุนุงูุฌุฉ ุงูุญุฒูุฉ ูุชุณูุณู ุงูููุงุนุฏ. <br>  ุชุญุฏุฏ <strong>ุงูุฌุฏุงูู</strong> ุงูุฅุฌุฑุงุกุงุช ุงูุชู ูููู ุชูููุฐูุง ุนูู ุงูุญุฒูุฉ. </p><br><h4 id="bazovye-varianty-sledovaniya-paketa" style=";text-align:right;direction:rtl">  ุงูุญุฒูุฉ ุงูุฃุณุงุณูุฉ ุงูุชุงููุฉ ุงูุฎูุงุฑุงุช </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/1d/tm/6j/1dtm6j1wiiolczrm215gcz_imss.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุนุจูุฑ</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rj/9z/_w/rj9z_w8s9pc4valiwixtkrwpdke.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุฃุชู ุงูุญุฒูุฉ ูู ุงูุดุจูุฉ ุฅูู ุฅุญุฏู ูุงุฌูุงุช ุฌูุงุฒ ุงูุชูุฌูู </li><li style=";text-align:right;direction:rtl">  ูู ุณูุณูุฉ PREROUTING ุ ูููู ูููุณุคูู ุงูุชุฃุซูุฑ ุนูู ูุณุงุฑ ุงูุญุฒูุฉ: ุชุญุฏูุฏ ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ (ุชูุฌูู ูุงุนุฏุฉ ุงูุณูุงุณุฉ) ุฃู ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅูู ุนููุงู ุขุฎุฑ (dst-nat). </li><li style=";text-align:right;direction:rtl">  ููููุง ูุฌุฏูู ุงูุชูุฌูู ููุญุฒูุฉ ุ ูุชู ุชุญุฏูุฏ ุงููุงุฌูุฉ ุงูุตุงุฏุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ุณูุณูุฉ FORWARD ูู ููุงู ุงูุชุตููุฉ ุงูุฑุฆูุณู ูููุฑูุฑ. </li><li style=";text-align:right;direction:rtl">  ุงูุนูุตุฑ ุงูุฃุฎูุฑ ูุจู ุงูุฏุฎูู ุฅูู ุงูุดุจูุฉ ูู ุณูุณูุฉ POSTROUTING ุ ุญูุซ ููููู ุชุบููุฑ ุนููุงู ุงููุฑุณู (src-nat). </li><li style=";text-align:right;direction:rtl">  ุฐูุจุช ุงูุญุฒูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช. </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>ูุงุฑุฏุฉ</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qn/l8/gd/qnl8gdad6vpxhgdjnhvhpzngcau.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฌุงุกุช ุญุฒูุฉ ูู ุงูุดุจูุฉ ุฅูู ุฅุญุฏู ูุงุฌูุงุช ุฌูุงุฒ ุงูุชูุฌูู </li><li style=";text-align:right;direction:rtl">  ุถุฑุจ ุณูุณูุฉ PREROUTING. </li><li style=";text-align:right;direction:rtl">  ููููุง ูุฌุฏูู ุงูุชูุฌูู ุ ุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ูููุนุงูุฌุฉ ุฅูู ุงูุนูููุฉ ุงููุญููุฉ. </li><li style=";text-align:right;direction:rtl">  ุชููู ุณูุณูุฉ INPUT ุจุชุตููุฉ ุญุฑูุฉ ุงููุฑูุฑ ุงููุงุฑุฏุฉ ุจูุงุณุทุฉ ุงููุณุคูู. </li><li style=";text-align:right;direction:rtl">  ุชูุช ูุนุงูุฌุฉ ุงูุญุฒูุฉ ุจูุงุณุทุฉ ุงูุนูููุฉ ุงููุญููุฉ. </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>ุงูููุชููุฉ ููุงูุชู</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jh/qr/sd/jhqrsd8rq3lt8x1s3jzjuup_m-8.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุฅุญุฏู ุนูููุงุช ุงูููุฌู ุญุฒูุฉ ip (ุฌุฏูุฏุฉ ุฃู ุงุณุชุฌุงุจุฉ - ูุง ููู). </li><li style=";text-align:right;direction:rtl">  ููููุง ูุฌุฏูู ุงูุชูุฌูู ุ ูุชู ุชุนุฑูู ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ ููุญุฒูุฉ. </li><li style=";text-align:right;direction:rtl">  ูููู ูููุณุคูู ุชุตููุฉ ุญุฑูุฉ ุงููุฑูุฑ ุงูุตุงุฏุฑุฉ ุฃู ุชุบููุฑ ุงููุณุงุฑ ูู ุณูุณูุฉ OUTPUT. </li><li style=";text-align:right;direction:rtl">  ููุญุฒูุฉ ุ ูุชู ุงุชุฎุงุฐ ุงููุฑุงุฑ ุงูููุงุฆู ุนูู ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ. </li><li style=";text-align:right;direction:rtl">  ุชูุน ุงูุญุฒูุฉ ูู POSTROUTING ุ ููุฐูู ุญุฑูุฉ ุงููุฑูุฑ <em>ุงูุนุงุจุฑุฉ</em> . </li><li style=";text-align:right;direction:rtl">  ุฐูุจุช ุงูุญุฒูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช. </li></ol><br><h4 id="connection-tracker" style=";text-align:right;direction:rtl">  ุชุนูุจ ุงุชุตุงู </h4><br><p style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุฃููุงู ุฅูู ููู ูุงููุฉ ุนูุงูู ุชุตููุฉ ุญุฒู ุงูุญุงูุฉ ูุนุฏููุฉ ุงูุญุงูุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/8c/lg/7z/8clg7zcfasexwuw3e3utjyhypl8.png"></p><br><p style=";text-align:right;direction:rtl">  ูุซุงู  ููุชุญ ุงูููุจููุชุฑ 192.168.100.10 ุงุชุตุงู tcp ุจุงูุฎุงุฏู 192.0.2.10.  ุนูู ุฌุงูุจ ุงูุนููู ุ ูุชู ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููููุฐ ุงูุฏููุงูููู</a> 49149 ุ ุนูู ุฌุงูุจ ุงูุฎุงุฏู 80. ูุจู ุงุณุชูุงู ุงููุญุชูู ุ ูุฌุจ ุนูู ุงูุนููู ูุงูุฎุงุฏู ุชุจุงุฏู ุงูุญุฒู ูุชุฃุณูุณ ุฌูุณุฉ tcp. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ <em>ุนุฏููู ุงูุฌูุณูุฉ ุ</em> ุชุญุชุงุฌ ุฅูู ูุชุญ ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุดุจูุฉ ุงููุญููุฉ ุฅูู ุงูุฅูุชุฑูุช ููู ุงูุฅูุชุฑูุช ุฅูู ุงูุดุจูุฉ ุงููุญููุฉ (ุนูู ุงูุฃูู ููุฌููุนุฉ ูู ุงูููุงูุฐ ุงูุญูููุฉ).  ููู ููู ุญูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฌูุงุฒ ุงูุชูุฌูู ุฐู ุงูุญุงูุฉ <em>ุงููุนุงูุฉ</em> ุ ูููู ุจุชุญููู ุงูุญุฒู ุ ูุจุนุฏ ุชููู tcp syn ูู 192.168.100.10:49149 ูู 192.0.2.10:80 ุ ูุนุชุจุฑ ูุฐุง ุจุฏุงูุฉ ุงุชุตุงู ุฌุฏูุฏ.  ุณูุชู ุงุนุชุจุงุฑ ุฌููุน ุงูุญุฒู ุงูุฅุถุงููุฉ (ูู ุฃู ุงุชุฌุงู) ุจูู 192.168.100.10:49149 ู 192.0.2.10:80 ุฌุฒุกูุง ูู ุงูุงุชุตุงู ุงูุซุงุจุช ุญุชู ูุชู ุฅุบูุงู ุฌูุณุฉ tcp ุฃู ุงูุชูุงุก ุตูุงุญูุฉ ุฃุฌูุฒุฉ ุถุจุท ุงูููุช. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู UDP / ICMP ูุงูุฃููุงุน ุงูุฃุฎุฑู ูู ุญุฑูุฉ ุงููุฑูุฑ ุ ุญูุซ ูุง ูููู ุงูุชูููุฒ ุจูู ุจุฏุงูุฉ ูููุงูุฉ ุงูุงุชุตุงู ุจุดูู ูุงุถุญ ุ ุชุนุชุจุฑ ุงูุญุฒูุฉ ุงูุฃููู ูู ุงูุฃููู ุ ูุชุนุชุจุฑ ุงูุจุงูู ุฌุฒุกูุง ูู ุงูุงุชุตุงู ุงูุซุงุจุช ูุชุญุฏูุซ ุงููููุชุงุช ุ ูููุณู ุฌูุงุฒ ุงูุชูุฌูู ูุฐู ุงูุงุชุตุงูุงุช ุจุนุฏ ุงูุชูุงุก ุตูุงุญูุฉ ุฃุฌูุฒุฉ ุถุจุท ุงูููุช. </p><br><p style=";text-align:right;direction:rtl">  ููุณู ูุชุชุจุน ุงูุงุชุตุงู ุงูุญุฒู ุฅูู ุนุฏุฉ ุฃููุงุน: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/j2/do/3f/j2do3fsdj1-t-hq7p2wnf0pnqte.png"></p><br><p style=";text-align:right;direction:rtl">  <em>ุฌุฏูุฏ</em> - ุญุฒูุฉ ุชูุชุญ ุงุชุตุงููุง ุ ุนูู ุณุจูู ุงููุซุงู <em>syn</em> ู tcp ุฃู ุงูุญุฒูุฉ ุงูุฃููู ูู ุฏูู UDP. <br>  <em>ุฃูุดุฆุช</em> - ุญุฒูุฉ ุชุชุนูู ุงุชุตุงู ูุนุฑูู. <br>  <em>ุฐุงุช ุตูุฉ</em> - ุงูุญุฒูุฉ ุงููุชุนููุฉ ุจุงูุงุชุตุงู ุงูุฅุถุงูู ูู ูุชุนุฏุฏ ุงูุจุฑูุชููููุงุช (sip ุ pptp ุ ftp ุ ...). <br>  ุญุฒูุฉ <em>ุบูุฑ ุตุงูุญุฉ</em> ูู ุงุชุตุงู ุบูุฑ ูุนุฑูู. <br>  <em>untracked</em> - ุงูุญุฒูุฉ ูุง ุชุชุจุน ุงุชุตุงู ุชุนูุจ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุชูููู ุงุชุตุงู ุชุนูุจ</strong> <br>  ุชูููู = ูุนู - ุชูููู. <br>  ุชูููู = ูุง - ุชุนุทูู. <br>  enabed = ุชู ุชุนุทููู ุชููุงุฆููุง ุญุชู ุชุธูุฑ ูุงุนุฏุฉ ุชุณุชุฎุฏู ุฅููุงููุงุช conntrack ูู ุฌุฏุงุฑ ุงูุญูุงูุฉ.  ูุชู ุงุณุชุฎุฏุงูู ุงูุชุฑุงุถูุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/a9/2b/tl/a92btlt5yfxh9fhf7-wmpgrohbu.png"></p><br><p style=";text-align:right;direction:rtl">  ุงููุนููุงุช ุงููุชุจููุฉ ูู ุฃุฌูุฒุฉ ุชูููุช ูุฎุชููุฉ ูุนุงุฏุฉ ูุง ุชุชุทูุจ ุถุจุท. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูููุณุคูู ุนุฑุถ ูุญุฐู ุงูุงุชุตุงูุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุจุฏู ุงูุงุชุตุงู ุจู NAT ููุง ููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mb/i7/7x/mbi77x9oinpcys1ohb516glu4mc.png"></p><br><p style=";text-align:right;direction:rtl">  ูุคุซุฑ ุงุณุชุฎุฏุงู conntrack ุนูู ุงูุฃุฏุงุก ูุงุณุชููุงู ุงูููุงุฑุฏ (ุฎุงุตุฉู ูุน ุนุฏุฏ ูุจูุฑ ูู ุงูุงุชุตุงูุงุช) ุ ูููู ูู ูุนูู ูู ูุนุธู ุงูุชููููุงุช ุ ูุธุฑูุง ูุฃู  ุณูููู ูุฏูู ุฌุฏุงุฑ ุญูุงูุฉ ุนุฏูู ุงูุญุงูุฉ ุจุฏูู NAT. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงุฆูุฉ ุงููุธุงุฆู ุงูุชุงุจุนุฉ ูุชุนูุจ ุงูุงุชุตุงู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/la/td/kz/latdkzskcwi9cx2o4lkdwtehps8.png"></p></div></div><br><h4 id="ttl" style=";text-align:right;direction:rtl">  TTL </h4><br><p style=";text-align:right;direction:rtl">  Time To Live - ุญูู ูู ุฑุฃุณ ุญุฒูุฉ IP ูุญุฏุฏ ุนุฏุฏ ุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูุชู ูููู ุฃู ุชูุฑ ุงูุญุฒูุฉ ูู ุฎูุงููุง ูุจู ุฅุชูุงููุง ุ ููุญูู ูู ุฅุนุงุฏุฉ ุชูุฌูู ุงูุญุฒูุฉ ุงูุชู ูุง ุชูุชูู ุฃุซูุงุก ุญููุงุช ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gp/qi/js/gpqijsw0wgsu2yqrkcamd3z0mhk.png"></p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุฅุนุงุฏุฉ ุงูุชูุฌูู ุ ูููู ุฌูุงุฒ ุงูุชูุฌูู ูู ูููุฉ TTL ุจููุฏุงุฑ 1 ุ ุฅุฐุง ูุงู TTL = 0.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชุตู ุงูุญุฒูุฉ ุฐุงุช TTL = 1 ุฅูู ุงูุนูููุฉ ุงููุญููุฉ ูุฌูุงุฒ ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุณุชุฎุฏู ุจุนุถ ุดุฑูุงุช ุงูููู ุงูุญูู TTL ูููุน ุงุณุชุฎุฏุงู ุฃุฌูุฒุฉ ุงูุชูุฌูู.  ุชุณุชุญู ูู ูุฐู ุงููููุฏ ุงูุฒูุงุฏุฉ ูู ูููุฉ ttl ูู ุฌุฏูู mangle. </p><br><h4 id="nat" style=";text-align:right;direction:rtl">  NAT </h4><br><p style=";text-align:right;direction:rtl">  ุชุฑุฌูุฉ ุนููุงู ุงูุดุจูุฉ - ุชูููุฉ ูุชุบููุฑ ุงูุนูุงููู ูู ุฑุฃุณ ุญุฒูุฉ ip.  ูุซู linux ุ ูุนุชุจุฑ NAT ุฌุฒุกูุง ูู ุนุงูู ุชุตููุฉ ุงูุญุฒูุฉ.  ูุนูู NAT ุนูู ุฃุณุงุณ ุชุนูุจ ุงูุงุชุตุงู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ุชู ุชุตููู NAT ูุญู ุณุฑูุน ููุดููุฉ ุงุณุชููุงุฏ ุนูุงููู IPv4 ุ ููุดุจูุงุช ุงููุญููุฉ ุ ุงูุชุฑุญ ุงุณุชุฎุฏุงู ุดุจูุฉ ูุฑุนูุฉ ูู ุงููุทุงูุงุช: 10.0.0.0/8 ุ  172.16.0.0/12 ุ  192.168.0.0/16 ูุชุฑุฌูุชูุง ุฅูู ูุงุญุฏ (ุฃู ุนุฏุฉ) ุนูุงููู ูุงุจูุฉ ููุชูุฌูู.  ูู ุงููุงูุน ุ ููุงู ุนุฏุฏ ูููู ูู ุงูุดุจูุงุช ุงููุฑุนูุฉ ููุฎุฏูุฉ ุงูุชู ูููู ุงุณุชุฎุฏุงููุง ุนูู ุงูุดุจูุงุช ุงูุฎุงุตุฉ ูุฌูุงุฒ ุงูุชูุฌูู ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูู ููุณ ููููุฉ NAT ุ ูููู ููุตู ุจุงุชุจุงุน ุงููุนุงููุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุนูููุงุช NAT ููุท: tcp ู udp ู icmp ูุจุนุถ ุงูุจุฑูุชููููุงุช ุงููุชุนุฏุฏุฉ ูู [IP] -&gt; [ุฌุฏุงุฑ ุงูุญูุงูุฉ] -&gt; [ูููุฐ ุงูุฎุฏูุฉ].  ุชุชู ูุนุงูุฌุฉ ุงูุญุฒูุฉ ุงูุฃููู (connection-state = new) ุงูุฃููู ููุท ูู ุงูุงุชุตุงู ุ ูุชุชู ูุนุงูุฌุฉ ุงูุญุฒู ุงููุชุจููุฉ ุชููุงุฆููุง ุฏูู ูุดุงุฑูุฉ ุฌุฏูู NAT.  ูููู ุชุชุจุน ุฐูู ุนู ุทุฑูู ุงูุชุบููุฑ ูู ุงูุนุฏุงุฏุงุช ูู ุงูููุงุนุฏ. </p><br><p style=";text-align:right;direction:rtl">  ูุญุชูู ุฑุฃุณ ุงูุญุฒูุฉ ุนูู ุนููุงู ุงููุตุฏุฑ ูุงููุฌูุฉ ุ ุนูู ุงูุชูุงูู ุ ููููุณู NAT ุฅูู ูุตุฏุฑ ู NAT ุงููุฌูุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุตุฏุฑ NAT</strong> - ุนููุงู ุงููุฑุณู ุฎุฏุงุน ุ ููุฌูุฏุฉ ุนูู ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูููุฒููุฉ ูุงูุดุฑูุงุช ูู ุงูุนุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/2s/ej/or/2sejor290wkc26agkonobacposa.png"></p><br><p style=";text-align:right;direction:rtl">  ูุณูุญ ููุนุฏูุฏ ูู ุงูุฃุฌูุฒุฉ ุงูุชู ุชุญูู ุนูุงููู "ุฑูุงุฏูุฉ" ุนูู ุงูุดุจูุฉ ุงููุญููุฉ ุจุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ุจุงุณุชุฎุฏุงู ูุงุญุฏ (ุฃู ุนุฏุฉ) ุนูุงููู ุญููููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hh/hi/du/hhhidurhkrsiiuflmg6dakupph8.png"></p><br><p style=";text-align:right;direction:rtl">  ุจุงูุนูุฏุฉ ุฅูู ุชุฏูู ุงูุญุฒูุฉ ุ ูุฑู ุฃู SRC-NAT ูู ูุฑุญูุฉ ุงููุดุฑ ุ ุจุนุฏ ุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุชูุฌูู ุงูุญุฒูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชูุฑ ุญุฒูุฉ ุงูุงุณุชุฌุงุจุฉ ุนุจุฑ DST-NAT <em>ุงูุถููู</em> ุญูุซ ูุชู ุชุบููุฑ ุนููุงู ุงููุณุชูู ุฅูู ูุญูู. </p><br><p style=";text-align:right;direction:rtl">  <strong>NAT ุงููุฌูุฉ</strong> - ุงุณุชุจุฏุงู ุนููุงู ุงููุณุชูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/id/rb/l9/idrbl9jdlfgfvbftjkgwoorszae.png"></p><br><p style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฎุฏุงูู ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูุฅุนุงุฏุฉ ุชูุฌูู ุงูุญุฒูุฉ ุฅูู ุนููุงู ุขุฎุฑ ุ ูุนุงุฏุฉ ูุง ูุชู ุงุณุชุฎุฏุงูู "ูุฅุนุงุฏุฉ ุชูุฌูู ุงูููุงูุฐ" ูู ุงูุดุจูุฉ ุงูุฎุงุฑุฌูุฉ ุฅูู ุงูุดุจูุฉ ุงููุญููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ju/uv/ly/juuvlyxr74gi8qykxx80vzhyvg4.png"></p><br><p style=";text-align:right;direction:rtl">  ููููุง ูุญุฒู ุงูุญุฒูุฉ ุ ุชุญุฏุซ ุนูููุฉ DST-NAT ูุจู ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ุงูุชูุฌูู ูู Prerouting ุ ููุฌุฏ SRC-NAT <em>ุงูุถููู</em> ูุญุฑูุฉ ูุฑูุฑ ุงูุงุณุชุฌุงุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  NAT ูู ุฃุฏุงุฉ ูููุฉ ูุฅุฏุงุฑุฉ ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุญุฏ ูุง ุ ูููู ูุฌุจ ุงุณุชุฎุฏุงููุง ุฃุฎูุฑูุง (ุนูุฏูุง ูุง ุชููู ุงูุฃุฏูุงุช ุงูุฃุฎุฑู ูููุฏุฉ) </p><br><h4 id="cepochkichains-bazovye-i-polzovatelskie" style=";text-align:right;direction:rtl">  ุณูุงุณู (ุณูุงุณู) ุงูุฃุณุงุณูุฉ ูุงููุณุชุฎุฏู </h4><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงูุณูุงุณู ูู ุงูููุงุนุฏ ูุชูุฑุถ ููุทู ูุนุงูุฌุฉ ุงูุญุฒู. <br>  ููุงู ุนุฏุฉ ุณูุงุณู ุฃุณุงุณูุฉ ุชู ุชุนููููุง ูุชุฏูู ุงูุญุฒูุฉ: <br>  <strong>Prerouting (dstnat)</strong> - ูุนุงูุฌุฉ ุงูุญุฒูุฉ ูุจู ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ุงูุชูุฌูู <br>  <strong>ุฅุฏุฎุงู</strong> - ูุนุงูุฌุฉ ุงูุญุฒู ุงูููุฌูุฉ ููุนูููุงุช ุงููุญููุฉ ูุฌูุงุฒ ุงูุชูุฌูู <br>  <strong>ุงูุฅุฎุฑุงุฌ</strong> - ูุนุงูุฌุฉ ุญุฒู ุงูุญุฒู ุงููุงุชุฌุฉ ุนู ุงูุนูููุงุช ุงููุญููุฉ ูุฌูุงุฒ ุงูุชูุฌูู <br>  <strong>ุฅูู ุงูุฃูุงู</strong> - ูุนุงูุฌุฉ ุงููุฑูุฑ ุงููุฑูุฑ <br>  <strong>Postrouting (srcnat)</strong> - ูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ุฌุงูุฒุฉ ููุฅุฑุณุงู ุฅูู ุงููุงุฌูุฉ </p><br><p style=";text-align:right;direction:rtl">  <em>ูู ุดูุก ูุดุจู ูู iptables ุ ูููู ุชุชู ุฅุนุงุฏุฉ ุชุณููุฉ ุงูุณูุงุณู ูู nat.</em>  <em>ูุง ูุฐุง ูุฑุชุจุท ุจู (ุนูู ุงูุฃุฑุฌุญ ูุน ููุทุฉ ุงุชุตุงู ุฃู ุชูุฑูุบ ุงูุฃุฌูุฒุฉ ูู nat) ุบูุฑ ูุนุฑูู ุจุงููุณุจุฉ ูู ุ ูููู ูุง ูุบูุฑ ุฃู ุดูุก ุนูู ุงูุฅุทูุงู.</em> </p><br><p style=";text-align:right;direction:rtl">  ุชูุฑุฑ ุงูุญุฒูุฉ ุงูููุงุนุฏ ูู ุงูุณูุณูุฉ ุจุดูู ูุชุชุงุจุน ุ ุฅุฐุง ูุงูุช ููุงุณุจุฉ ูุฌููุน ุงูุดุฑูุท ุ ูุณูุชู ุชุทุจูู ุงูุฅุฌุฑุงุก ุนูู ุงูุญุฒูุฉ.  ุฅุฐุง ุชู ุฅููุงุก ุงูุฅุฌุฑุงุก ููู ุชุณูุท ุงูุญุฒูุฉ ุ ูุณูุชู ุชูุฑูุฑู ุฅูู ูุชูุฉ ุชุฏูู ุงูุญุฒูุฉ ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฌููุน ุณูุงุณู ุงูุฃุณุงุณ ูุฏููุง ุฅุฌุฑุงุก ุงูุชุฑุงุถู (ุฅุฐุง ูู ุชุชูุงุณุจ ุงูุญุฒูุฉ ูุน ุฃู ูู ุงูููุงุนุฏ) - <em>ูุจูู</em> . </p><br><p style=";text-align:right;direction:rtl">  ุงูุณูุงุณู ุงููุฎุตุตุฉ ุถุฑูุฑูุฉ ูุชูููู ุนุฏุฏ ุงูููุงุนุฏ ุงูุชู ุชูุฑ ุจูุง ูู ุญุฒูุฉ ูุฅูุดุงุก ููุงุนุฏ ูุนูุฏุฉ ููุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ.  ุฌููุน ุณูุงุณู ุงููุณุชุฎุฏู ููุง ุนูู ุงูุชุฑุงุถู - <em>ุนุงุฆุฏ</em> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bk/rg/sk/bkrgskh5wudzzf54mueqiy9oehk.png"></p><br><p style=";text-align:right;direction:rtl">  ุถูู ุงูุฌุฏูู ุ ููููู ุฅุนุงุฏุฉ ุชูุฌูู ุงูููุงุนุฏ ูู ุนุฏุฉ ุณูุงุณู ุฃุณุงุณูุฉ (ููุณุชุฎุฏู) ูุฎุชููุฉ ุฅูู ุณูุณูุฉ ุงููุณุชุฎุฏู ุ ูููู ุณุชุนูุฏ ุงูุญุฒูุฉ ุฅูู ุงูุณูุณูุฉ ุงูุชู ุฌุงุกุช ูููุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_8/kw/oi/_8kwoirut9mtd67elbejqkzdsek.png"></p><br><h4 id="usloviya-v-pravilah" style=";text-align:right;direction:rtl">  ุงูุดุฑูุท ูุงูุฃุญูุงู </h4><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงูุณูุงุณู ูู ููุงุนุฏ ุ ูู ูุงุนุฏุฉ ุชุชููู ูู ุดุฑูุท ูุฅุฌุฑุงุกุงุช.  ููุงู ุงููุซูุฑ ูู ุงูุดุฑูุท ุ ูููู ูู ุชุณุชุฎุฏููุง ุฌููุนูุง ูู ุชููููุงุช ุญููููุฉ.  ูุนุธู ุงูุญุงูุงุช ูููู ุฃู ุชููู ูุณุจููุฉ ุจู "ูุง" (ุนูุงูุฉ "!").  ููุชุฒุงูู ูุน ุงููุงุนุฏุฉ ุ ูุฌุจ ุฃู ุชููู ุงูุญุฒูุฉ ููุงุณุจุฉ ูุฌููุน ูุฐู ุงูุดุฑูุท. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/la/dh/or/ladhorisauzv81cnmffmkjo6_hi.png"></p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจุนุถ ุงูุดุฑูุท</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุงูุดุฑุท </th><th>  ุงููุตู </th></tr></thead><tbody><tr><td>  ุนููุงู src </td><td>  ุนููุงู ุงููุตุฏุฑ </td></tr><tr><td>  ุงูุชูููุช ุงูุตููู ุนููุงู </td><td>  ุนููุงู ุงููุณุชูู </td></tr><tr><td>  ูุงุฆูุฉ ุนูุงููู src </td><td>  ุนููุงู ุงููุตุฏุฑ ูุฏุฑุฌ. </td></tr><tr><td>  ุงูุชูููุช ุงูุตููู ูุงุฆูุฉ ุงูุนูุงููู </td><td>  ุนููุงู ุงููุณุชูู ูุฏุฑุฌ </td></tr><tr><td>  ุงูุจุฑูุชูููู </td><td>  ุจุฑูุชูููู ุทุจูุฉ ุงูููู </td></tr><tr><td>  src ุงููููุงุก </td><td>  ูููุฐ ุงููุตุฏุฑ </td></tr><tr><td>  ุงูุชูููุช ุงูุตููู ุงููููุงุก </td><td>  ูููุงุก ุงููุณุชูู </td></tr><tr><td>  ุงููููุงุก </td><td>  ูููุฐ ุงููุตุฏุฑ ุฃู ุงููุฌูุฉ </td></tr><tr><td>  ูู ูุงุฌูุฉ </td><td>  ุงููุงุฌูุฉ ุงูุชู ุฌุงุกุช ุจูุง ุงูุญุฒูุฉ </td></tr><tr><td>  ุฎุงุฑุฌ ุงููุงุฌูุฉ </td><td>  ุงููุงุฌูุฉ ุงูุชู ุณูุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ูููุง ุฅูู ุงูุดุจูุฉ </td></tr><tr><td>  ูู ูุงุฌูุฉ ุงููุงุฆูุฉ </td><td>  ูุชู ุณุฑุฏ ุงููุงุฌูุฉ ุงูุชู ุฌุงุกุช ุงูุญุฒูุฉ </td></tr><tr><td>  ุฎุงุฑุฌ ูุงุฌูุฉ ุงููุงุฆูุฉ </td><td>  ูุชู ุณุฑุฏ ุงููุงุฌูุฉ ุงูุชู ุณูุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ูููุง ุฅูู ุงูุดุจูุฉ </td></tr><tr><td>  ุทุจูุฉ 7 ุจุฑูุชูููู </td><td>  ุชุญููู ูุญุชููุงุช ุงูุญุฒู 10 ุงูุฃููู ูู ุงุชุตุงู </td></tr><tr><td>  ุงููุญุชูู </td><td>  ุงูุจุญุซ ุนู ุณูุณูุฉ ูุนููุฉ ูู ุฏูุนุฉ ูุงุญุฏุฉ </td></tr><tr><td>  tls- ุงููุถูู </td><td>  ุจุญุซ ุงููุถูู ูู tls ุฑุฃุณ </td></tr><tr><td>  ุณูุงุณุฉ IPSEC </td><td>  ุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุญุฒูุฉ ูุทุงุจูุฉ ูุณูุงุณุฉ ipsec ุฃู ูุง </td></tr><tr><td>  ุญุฌู ุงูุญุฒูุฉ </td><td>  ุญุฌู ุงูุญุฒูุฉ ุจุงูุจุงูุช </td></tr><tr><td>  src-mac-address </td><td>  ุนููุงู ูุตุฏุฑ ุญุฒูุฉ ูุงู </td></tr><tr><td>  ุนูุงูุฉ ุงุชุตุงู </td><td>  ุชุณููุฉ ุงูุงุชุตุงู </td></tr><tr><td>  ุนูุงูุฉ ุงูุญุฒูุฉ </td><td>  ุชุณููุฉ ุงูุญุฒูุฉ </td></tr><tr><td>  ุนูุงูุฉ ุงูุชูุฌูู </td><td>  ุญุฒูุฉ ููุทุฉ ุงูุทุฑูู </td></tr><tr><td>  ุญุงูุฉ ุงูุงุชุตุงู </td><td>  ุญุงูุฉ ุญุฒูุฉ ุงูุงุชุตุงู </td></tr><tr><td>  ุฃุนูุงู TCP </td><td>  ุญุฒูุฉ ุฃุนูุงู ุจุฑูุงูุฌ ุงูุชุนุงูู ุงูููู </td></tr><tr><td>  ุฎูุงุฑุงุช icmp </td><td>  ุฎูุงุฑุงุช ุญุฒูุฉ Icmp </td></tr><tr><td>  ุนุดูุงุฆู </td><td>  ูุชู ุชุดุบูู ุงููุงุนุฏุฉ (ุนูุฏูุง ุชุชุฒุงูู ุดุฑูุท ุฃุฎุฑู) ูุน ุงุญุชูุงู ูุนูู </td></tr><tr><td>  ุงูููุช </td><td>  ููููู ุชุญุฏูุฏ ุณุงุนุงุช ุนูู ุงููุงุนุฏุฉ ุ ูุณูุก ุงูุญุธ ุฏูู ุชุญููู ุชุงุฑูุฎ </td></tr><tr><td>  ttl </td><td>  ูููุฉ ุงูุญูู ttl ูู ุงูุญุฒูุฉ </td></tr><tr><td>  dscp </td><td>  ูููุฉ ุงูุญูู DSCP (ToS) ูู ุงูุญุฒูุฉ </td></tr><tr><td>  - // - </td><td>  - // - </td></tr><tr><td>  ููุงู ูุจู </td><td>  ุฎูุงุฑ ูุญุฏุฉ ุงูุชุญูู (ุจุฏูู ุดุฑุท) ุ ูุณูุญ ูู ุจุฅุถุงูุฉ ูุงุนุฏุฉ ูุจู ุงููุญุฏุฏ </td></tr><tr><td>  ุงููุนูููู </td><td>  ุฎูุงุฑ ูุญุฏุฉ ุงูุชุญูู (ูููุณ ุงูุดุฑุท) ุ ูุณูุญ ูู ุจุชุนุทูู ุงููุงุนุฏุฉ </td></tr></tbody></table><br><p style=";text-align:right;direction:rtl">  <strong>ููุงุญุธุงุช</strong> <br>  ูุนููุงู src. (Dst.) ุ ููููู ุชุญุฏูุฏ: IP ูุงุญุฏ ุฃู ูุฌููุนุฉ ูู ุงูุนูุงููู ูู ุฎูุงู ูุงุตูุฉ ุฃู ุดุจูุฉ ูุฑุนูุฉ. <br>  ููุงู ุญุงุฌุฉ ุฅูู ููุงุฆู ุนูุงููู ููุฌูุน ุจูู ุงูุนุฏูุฏ ูู ุงูููููุฉ ุงูููุฑูุฉ ุบูุฑ ุงููุชุตูุฉ ุชุญุช ููุณ ุงูุงุณู.  ุนูู ุนูุณ ipset ูู netfilter ุ ูููู ุญุฐู ุงูุฅุฏุฎุงูุงุช ูู ููุงุฆู MikroTik ุจุนุฏ ูุชุฑุฉ ุฒูููุฉ ูุญุฏุฏุฉ.  ููููู ุนุฑุถ ุงูููุงุฆู ูุฅุฌุฑุงุก ุชุบููุฑุงุช ูู [IP] -&gt; [ุฌุฏุงุฑ ุงูุญูุงูุฉ] -&gt; [ููุงุฆู ุงูุนูุงููู]. <br>  ุจุตูุชู ุฑูู ุงููููุฐ (ูููุฐ ุฃู ูููุฐ src ุฃู ูููุฐ dst) ุ ููููู ุชุญุฏูุฏ ูููุฐ ูุงุญุฏ ุฃู ุนุฏุฉ ููุงูุฐ ููุตููุฉ ุจููุงุตู ุฃู ูุฌููุนุฉ ูู ุงูููุงูุฐ ุนุจุฑ ูุงุตูุฉ. </p></div></div><br><p style=";text-align:right;direction:rtl">  ูู MUM ุงูุฃุฎูุฑ ูู MSC ุ ูุงู ููุงู ุนุฑุถ ุชูุฏููู ุฌูุฏ ุญูู ุชุฃุซูุฑ ุงูุธุฑูู ุงููุฎุชููุฉ ุนูู ุณุฑุนุฉ ูุนุงูุฌุฉ ุงูุญุฒู (ููุงู ุณูู ุชุชุนูู ููููุฉ ุงุณุชุฎุฏุงู ุงูุฌุฏูู ุงูุฎุงู ูุชูููู ุงูุญูู ุนูู ุฌูุงุฒ ุงูุชูุฌูู) ุ ุงูููุชููู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุณุฌูู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุนุฑุถ ุงูุชูุฏููู</a> . </p><br><h4 id="deystviya-v-tablicah" style=";text-align:right;direction:rtl">  ุฌุฏุงูู ุงูุฅุฌุฑุงุกุงุช </h4><br><p style=";text-align:right;direction:rtl">  ุชุนุชูุฏ ูุฌููุนุฉ ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ ุนูู ุงูุญุฒูุฉ ุนูู ุงูุฌุฏูู ุงูุฐู ุชุชู ูุนุงูุฌุชู ููู. <br><img src="https://habrastorage.org/webt/i3/ba/xj/i3baxjyyz-fnswxpanh_qek5kq8.png"><br>  <strong>ูุฑุดุญ</strong> - ุฌุฏูู ุชุตููุฉ ุญุฑูุฉ ุงููุฑูุฑ ุ ูุงุญุฏุฉ ูู ููุงููู ุญูุซ ููููู ุฅุณูุงุท ุงูุญุฒูุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>NAT</strong> - ุฌุฏูู ูุชุนุฏูู ุนูุงููู IP ูุงูููุงูุฐ (tpc ุ udp) ูู ุฑุฃุณ ุญุฒูุฉ ip. </p><br><p style=";text-align:right;direction:rtl">  <strong>Mangle</strong> - ุฌุฏูู ูุชุนุฏูู ุงูุญููู ุงูุฃุฎุฑู ูู ุญุฒูุฉ ip ูุชุญุฏูุฏ ุงูุชุณููุงุช ุงููุฎุชููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/w0/dc/n3/w0dcn3uinajpugbflfjha0pt5jy.png"></p><br><p style=";text-align:right;direction:rtl">  ููุงู ุซูุงุซุฉ ุฃููุงุน ูู ุชุณููุงุช ุงูุญุฒูุฉ ุงูุฏุงุฎููุฉ: ุงูุงุชุตุงู ุ ุงูุญุฒูุฉ ุ ุงููุณุงุฑ.  ุงูุชุณููุงุช ููุฌูุฏุฉ ููุท ุฏุงุฎู ุฌูุงุฒ ุงูุชูุฌูู ููุง ุชุฐูุจ ุฅูู ุงูุดุจูุฉ.  ูููู ุฃู ูููู ููุญุฒูุฉ ุชุณููุฉ ูุงุญุฏุฉ ูู ูู ููุน ุ ุจูููุง ุชูุฑ ุนุฏุฉ ููุงุนุฏ ููุนูุงูุฉ ุจุงูุชุณูุณู ุ ูุชู ุงููุชุงุจุฉ ุนูู ุงูููุตูุงุช. <br>  ูุง ูููู ุชุนููู ููุตูุงุช ุงููุณุงุฑ ุฅูุง ูู ุณูุงุณู ุงูุชุฌููุน ูุงูุฅุฎุฑุงุฌ ุ ูุงูุจุงูู ูู ุฃู ุณูุงุณู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุงุฑุณุงุช ุงูุฌูุฏุฉ ูุถุน ุนูุงูุฉ ุนูู ุงูุงุชุตุงู ุฃููุงู ุ ุซู ุงูุญุฒูุฉ (ุงูุญุฒูุฉ) ุฃู ุงููุณุงุฑ (ุงููุณุงุฑ).  ุงูุชุญูู ูู ุงูุชุณููุงุช ุฃุณุฑุน ูู ุญููู ุงูุญุฒูุฉ.  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูุฐุง ููุณ ูู ุงูุญุงู ุฏุงุฆูุง ูู ููุงุฆู ุงูุงูุชุธุงุฑ ุงููุนูุฏุฉ ุฃู pbr ุนูุงูุฉ ุฅุถุงููุฉ ููุงุชุตุงู ุบูุฑ ูููุฏ. </p><br><p style=";text-align:right;direction:rtl">  <strong>RAW</strong> - ุฌุฏูู ูุณูุญ ููุญุฒู ุจุชุฌุงูุฒ ูุชุชุจุน ุงูุงุชุตุงู.  ูุชู ุงุณุชุฎุฏุงูู ูููุงุฌูุฉ DoS ูุชูููู ุงูุญูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุชุฌุงูุฒ ุญุฑูุฉ ูุฑูุฑ ุงูุฅุฑุณุงู ุงููุชุนุฏุฏ).  ูุชูุญ ูู ุฅุณูุงุท ุงูุญุฒูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชููู ุฅุฌุฑุงุกุงุช ุงูุฅููุงุก ูุนุงูุฌุฉ ุงูุญุฒูุฉ ูู ุงูุณูุณูุฉ ูุชูุฑูุฑูุง ุฅูู ุงููุชูุฉ ุงูุชุงููุฉ ูู ุชุฏูู ุงูุญุฒูุฉ ุ ุฃู ุชุฌุงูููุง. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุฅุฌุฑุงุกุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ุงูุฌุฏูู </th><th>  ุงูุนูู </th><th>  ุงููุตู </th><th>  ุฅููุงุกุ </th></tr></thead><tbody><tr><td>  ุงููู </td><td>  ุงูุจู </td><td>  ุชููู ุนู ูุนุงูุฌุฉ ุงูุญุฒูุฉ ูููููุง ุฅูู ูุชูุฉ ุชุฏูู Pakcet ุงูุชุงููุฉ </td><td>  ูุนู </td></tr><tr><td>  ุงููู </td><td>  ุณุฌู </td><td>  ูุนูููุงุช ุญุฒูุฉ ุงูุณุฌู: ูู ุงูุฅุตุฏุงุฑุงุช ุงูุญุฏูุซุฉ ุ ููููู ุฅุถุงูุฉ ุณุฌู ุฅูู ุฃู ุฅุฌุฑุงุก ุขุฎุฑ. </td><td>  ูุง </td></tr><tr><td>  ุงููู </td><td>  ุงูุนุจูุฑ </td><td>  ุญุณุงุจ ุนุฏุฏ ุงูุญุฒู.  ุชุณุชุฎุฏู ูุชุตุญูุญ ุงูุฃุฎุทุงุก </td><td>  ูุง </td></tr><tr><td>  ุงููู </td><td>  ุฅุถุงูุฉ src ุฅูู ูุงุฆูุฉ ุงูุนูุงููู ูุฅุถุงูุฉ dst ุฅูู ูุงุฆูุฉ ุงูุนูุงููู </td><td>  ุฃุถู ุนููุงู ุงููุตุฏุฑ (ุงููุฌูุฉ) ูู ุงูุญุฒูุฉ ุฅูู ุงููุงุฆูุฉ ุงููุญุฏุฏุฉ </td><td>  ูุง </td></tr><tr><td>  ุงููู </td><td>  ุงูููุฒ </td><td>  ุงูุชูู ุฅูู ุณูุณูุฉ ุงููุณุชุฎุฏู </td><td>  ูุนู </td></tr><tr><td>  ุงููู </td><td>  ุงูุนูุฏุฉ </td><td>  ุงูุนูุฏุฉ ุฅูู ุณูุณูุฉ ุงูุฃู.  ูู ุณูุงุณู ูุงุนุฏุฉ ุฃููุง ุชุนูู ูุซู ูุจูู </td><td>  ูุนู </td></tr><tr><td>  ุชุตููุฉ ุงูุฎุงู </td><td>  ุฅุณูุงุท </td><td>  ููู ุชุฏูู ุงูุญุฒูุฉ ุนูู ุชุฏูู ุงูุญุฒูุฉ ูุชุฌุงูู </td><td>  ูุนู </td></tr><tr><td>  ุชุตููุฉ ู Prerouting </td><td>  ูุงุณุช ุชุฑุงู </td><td>  ุญุฒูุฉ ุงูุนูู ูุชุฏูู ุงูุญุฒูุฉ ุงูุณุฑูุนุฉ </td><td>  ูุนู </td></tr><tr><td>  ูุฑุดุญ </td><td>  ุฑูุถ </td><td>  ูุซู ุฅุณูุงุท ุ ูููู ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุงููุฑุณู ุงูุญุฒูุฉ (tcp ุฃู icmp) ุญูู ุงูุญุฒูุฉ ุงูููุณุฏูุฉ </td><td>  ูุนู </td></tr><tr><td>  ูุฑุดุญ </td><td>  ูุฎ </td><td>  ูุญุงูุงุฉ ูุฌูุฏ ูููุฐ ููุชูุญ.  ูุณุชุฎุฏู ููุญูุงูุฉ ุถุฏ DoS ุ ูุงูุชุถููู (ูุฃุญูุงููุง) ุงูุชุตุญูุญ </td><td>  ูุนู </td></tr><tr><td>  NAT </td><td>  src-nat </td><td>  ุงุณุชุจุฏุงู ุนููุงู ุงููุฑุณู ุฅูู ุงููุญุฏุฏ </td><td>  ูุนู </td></tr><tr><td>  NAT </td><td>  ุญููุฉ ุชููุฑูุฉ </td><td>  ุญุงูุฉ ุฎุงุตุฉ ูู src-nat ุ ุชุณุชุจุฏู ุนููุงู ุงููุฑุณู ุจุฃุญุฏ ุงูุนูุงููู ูู ุงููุงุฌูุฉ ุ ูุชุณุชุฎุฏู ุนูู ูุงุฌูุงุช ุฏููุงููููุฉ (dhcp ุ vpn).  ูุง ููุตุญ ุจุงุณุชุฎุฏุงูู ูู ุญุงูุฉ ูุฌูุฏ ุนุฏุฉ ุนูุงููู IP ุนูู ุงููุงุฌูุฉ </td><td>  ูุนู </td></tr><tr><td>  NAT </td><td>  ููุณู </td><td>  ุญุงูุฉ ุฎุงุตุฉ ูู src-nat.  ูุณุชุจุฏู ุนููุงู ุงููุฑุณู ุจุนููุงู ูู ุงููุทุงู ุงููุญุฏุฏ </td><td>  ูุนู </td></tr><tr><td>  NAT </td><td>  ุงูุชูููุช ุงูุตููู </td><td>  ูุณุชุจุฏู ุนููุงู ุงููุณุชูู ุจุงูุนููุงู ุงููุญุฏุฏ </td><td>  ูุนู </td></tr><tr><td>  NAT </td><td>  ุฅุนุงุฏุฉ ุชูุฌูู </td><td>  ูู ุญุงูุฉ dst-nat ุงูุฎุงุตุฉ ุ ูุณุชุจุฏู ุนููุงู ุงููุณุชูู ุจุนููุงู ูุงุฌูุฉ ุฌูุงุฒ ุงูุชูุฌูู ุงูุชู ุฌุงุกุช ุจูุง ุงูุญุฒูุฉ </td><td>  ูุนู </td></tr><tr><td>  NAT </td><td>  netmap </td><td>  ููุณ ุจุฏููุง ู DST- ูุงุช.  ุชูุณุชุฎุฏู ููุชุฑุฌูุฉ ูู ุดุจูุฉ ุฅูู ุดุจูุฉ ุ ุงูุธุฑ ุงูุฃูุซูุฉ </td><td>  ูุนู </td></tr><tr><td>  Mangle </td><td>  ุนูุงูุฉ ุงุชุตุงู </td><td>  ุชุณููุฉ ุงูุงุชุตุงู </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุนูุงูุฉ ุงูุญุฒูุฉ </td><td>  ุชุณููุฉ ุงูุญุฒูุฉ ุงููุทุจูุฉ ูู ููุงุฆู ุงูุงูุชุธุงุฑ </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุนูุงูุฉ ุงูุชูุฌูู </td><td>  ุชู ุชุทุจูู ุชุณููุฉ ุงููุณุงุฑ ูู ุณูุงุณุฉ ุงูุชูุฌูู ุงูุฃุณุงุณูุฉ </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุชุบููุฑ ttl </td><td>  ุชุญุฑูุฑ ttl </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุชุบููุฑ dcsp (tos) </td><td>  ุชุบููุฑ dcsp ุงูุนุดุฑู </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุชุบููุฑ MSSS </td><td>  ุชุบููุฑ mss ุฅูู ุจุฑูุงูุฌ ุงูุชุนุงูู ุงูููู syn </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ูุงุถุญ ูุฏ </td><td>  ูุงุถุญ ูุง ุชุฌุฒุฆุฉ ุงูุนูู </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุฎูุงุฑุงุช ipv4 ุงูุดุฑูุท </td><td>  ูุญู ุฎูุงุฑุงุช ipv4 ุงููุชูุฏูุฉ </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ูุถุน ุงูุฃููููุฉ </td><td>  ุชุนููู ุฃููููุฉ ู CoS </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุงูุทุฑูู </td><td>  ุชุนููู ุจูุงุจุฉ ููุญุฒูุฉ.  ูุณุฎุฉ ุจุณูุทุฉ ูู PBR </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุดู tzsp </td><td>  ูู ุจุชุบููู ุงูุญุฒู ูู udp ูุฅุฑุณุงููุง ุฅูู ip ุงููุญุฏุฏ </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุดู ุงูููุจููุชุฑ </td><td>  ุงูุชูุงุธุฑูุฉ ูู tzsp ุ ูููู ูุน ููุน ูุฎุชูู ูู ุงูุชุบููู.  ูู ูููู ุฅุฐุง ุงุณุชุฎุฏุงู ุงูุญุงูุงุช ูุน calea </td><td>  ูุง </td></tr><tr><td>  Mangle </td><td>  ุงูุนุจูุฑ </td><td>  ุจุดูู ุงูุชุฑุงุถู ุ ูุนุธู ุงูููุงุนุฏ ูู mangle ูุง ุชููุน ุงูุญุฒูุฉ ูู ุงููุฑูุฑ ุ ููููู ุชุบููุฑ ูุฐุง ุงูุณููู ุนู ุทุฑูู ุชุนููู passtrough = ูุง </td><td>  ูุง </td></tr><tr><td>  ุงูุฎุงู </td><td>  notrack </td><td>  ูุง ุชุชุจุน ุงูุญุฒูุฉ ูู ุชุนูุจ ุงูุงุชุตุงู </td><td>  ูุนู </td></tr></tbody></table><br><p style=";text-align:right;direction:rtl">  <em>ุฅุฐุง ูุงู ููุงู ูู ูุฑุบุจ ุ ููููููู ูุชุงุจุฉ ุงููุฒูุฏ ุนู FastTrack ู FastPath ุ ููู ูุฌุจ ุฃูุง ุชุชููุน ูุนุฌุฒุงุช ูู ูุฐู ุงูุชูููุงุช.</em> </p></div></div><br><h4 id="para-slov-pro-dpi" style=";text-align:right;direction:rtl">  ุจุถุน ูููุงุช ุนู ุฅุฏุงุฑุฉ ุดุคูู ุงูุฅุนูุงู </h4><br><p style=";text-align:right;direction:rtl">  ููุงู ุงูุนุฏูุฏ ูู ุงูุงุญุชูุงูุงุช ูููุธุฑ ูู ุงูุญุฒูุฉ ุฃุนูู ููููุงู ูู ุฑุฃุณ ุทุจูุฉ ุงูููู: <br>  <em>ุงููุญุชูู</em> - ูุจุญุซ ุนู ุณูุณูุฉ ูุนููุฉ ูู ุงูุญุฒูุฉ. <br>  <em>layer7-protocol</em> - <em>ุชุฎุฒูู</em> ุฃูู 10 ุญุฒู (ุฃู 2 ููููุจุงูุช) ูู ุงูุงุชุตุงู ูุงูุจุญุซ ุนู ุฅุนุงุฏุฉ ุงูุชุณุฌูู ูู ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูุคูุชูุง.  ูุคุซุฑ ุนุฏุฏ ูุจูุฑ ูู ููุงุนุฏ layer7 ุจุดูู ูุจูุฑ ุนูู ุงูุฃุฏุงุก. <br>  <em>tls-host</em> ูู ุนููุงู ุงุณู ุงููุถูู ูู ุฑุฃุณ TLS / SNI ูุงุชุตุงู HTTPS. </p><br><h3 id="primery" style=";text-align:right;direction:rtl">  ุฃูุซูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุง ุชูู ุจูุณุฎ ุงูุฃูุซูุฉ ุฏูู ุชูููุฑ ุ ููู ุงูุฃูุถู ุฃู ุชุฃุฎุฐ ุงูุฌูุงุฒ ููุญุงููุฉ ูุชุงุจุฉ ุงูุชูููู ุจููุณู (ุฃู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุฃูุซูุฉ ุ ูููู ูููู ูุง ุชูุนูู ูู ูุงุนุฏุฉ ูู ุงูููุงุนุฏ).  ุฅุฐุง ููุช ูุง ุชุนุฑู ููููุฉ ุงุณุชููุงู ุงูููุงุนุฏ: ูู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ูุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชููููุงุช ุงูููุฒููุฉ ูุง ูููู ุงููุตูู ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ูู ูุงุฌูุฉ ุงูุดุจูุฉ ุงููุงุณุนุฉ ุ ุฃุถูู ูุน ุงูุชุตููุฉ ุญุณุจ ูุงุฆูุฉ ุงูุนูุงููู. </p><br><h4 id="defoltnyy-firewall-routeros" style=";text-align:right;direction:rtl">  ุฌุฏุงุฑ ุงูุญูุงูุฉ ุงูุงูุชุฑุงุถู RouterOS </h4><br><p style=";text-align:right;direction:rtl">  ุชูููู ุขูู ุฅูู ุญุฏ ูุง ุ ูููู ูู ุฃูุงูู ูุดูุดุฉ ููุบุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">/ip firewall filter #     (established, related)   (untracked)  add action=accept chain=input connection-state=established,related,untracked #    (invalid)  add action=drop chain=input connection-state=invalid #  icmp  add action=accept chain=input protocol=icmp #          add action=drop chain=input in-interface-list=!LAN #   ipsec    add action=accept chain=forward ipsec-policy=in,ipsec add action=accept chain=forward ipsec-policy=out,ipsec #          add action=fasttrack-connection chain=forward connection-state=established,related #       add action=accept chain=forward connection-state=established,related,untracked #    add action=drop chain=forward connection-state=invalid #     wan ,     dstnat (,      src-nat   dst-nat) add action=drop chain=forward connection-nat-state=!dstnat connection-state=new in-interface-list=WAN /ip firewall nat #Source NAT      ipsec,      WAN add action=masquerade chain=srcnat ipsec-policy=out,none out-interface-list=WAN</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃุณุชุฎุฏู ุงูุชูููู ุงูุงูุชุฑุงุถู ุฃุจุฏูุง ุ ูููู ูุจู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุงูุงูุชุฑุงุถู ูุงู ุฃุณูุฃ ุจูุซูุฑ. </p><br><h4 id="minimalnyy-domashniy-firewall" style=";text-align:right;direction:rtl">  ุงูุญุฏ ุงูุฃุฏูู ูุฌุฏุงุฑ ุงูุญูุงูุฉ ุงูุฑุฆูุณูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุฃุณูู ุดูุก ููุชูุตู ุฅููู.  ูุนู ุ ูุง ููุณูุญ ุจุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ูู ูุชู ุชุนูุจูุง (ูููู ูู ูุฑุญูุฉ ุงูุฏุฑุงุณุฉ ุงูุฃุณุงุณูุฉ ูุฌุฏุงุฑ ุงูุญูุงูุฉ ุงูุชู ูุง ุชุฒุงู ูุง ุชุญุชุงุฌ ุฅูููุง) ูุณุชููู ููุงู ูุดููุงุช ูู ุจุฑูุงูุฌ ipsec ุงููููู (ูุฑุฉ ุฃุฎุฑู ุ ุฅุฐุง ุชูููุช ูู ุชูููู ipsec ุ ูุฃูุช ุชุนุฑู ูุง ูุฌุจ ุงูููุงู ุจู). </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter #     (established, related)  add chain=input connection-state=established,related action=accept #  icmp  add chain=input connection-state=new protocol=icmp action=accept #      add chain=input connection-state=new in-interface-list=LAN action=accept #     add chain=input action=drop #       add chain=forward connection-state=established,related action=accept #         add chain=forward connection-state=new in-interface-list=LAN action=accept #     add chain=forward action=drop /ip firewall nat #Source NAT        WAN add chain=srcnat out-interface-list=WAN action=masquerade</code> </pre> <br><h4 id="primer-s-dmz" style=";text-align:right;direction:rtl">  ูุซุงู DMZ </h4><br><p style=";text-align:right;direction:rtl">  ุนูู ุฃุฌูุฒุฉ ุงูุชูุฌูู "ุงูููุฒููุฉ" ุ ูุญุจ ุงูุงุณู ุงููุฎุชุตุฑ DMZ ุงุณุชุฏุนุงุก ููุจููุชุฑ ุนูู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงููุญููุฉ ุงูุชู ูุชู ุชูุฌูู ุฌููุน ุงูููุงูุฐ ูู ุงูุดุจูุฉ ุงูุฎุงุฑุฌูุฉ ุฅูููุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ููุณ ูุฐุง ูู ุงูุฃูุฑ ุ ูุฃุญุฏ ุฎูุงุฑุงุช DMZ ูู ูุตู ุงูููุฑุฏ ุงูุฐู ูุฌุจ ุฃู ุชููุฑ ุงููุตูู ุฅููู ูู ุงูุฅูุชุฑูุช ุ ููููู ุชูููุฐ ูุฌูู ูุงุฌุญ (ุฎุงุฏู ุงูููุจ ูุน cms ุงูุชู ุชูุฌุฏ ูููุง ุซููุจ ุจุงุณุชูุฑุงุฑ ูู ูุฏู ุฌูุฏ ููููุงุฌููู).  ูู ุญุงูุฉ ุงูุงุฎุชุฑุงู ุ ูู ูุชููู ุงูููุงุฌู ูู ุงูุชุฃุซูุฑ ุนูู ุงููุดุงุฑููู ูู ุงูุดุจูุฉ ุงููุญููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bb/pp/9g/bbpp9gbe7k4owuef7hxuzisrurg.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#  /ip firewall nat add chain=dstnat dst-port=80,443 action=dst-nat to-address=192.168.200.2 /ip firewall filter #   icmp   add chain=input connection-state=established,related action=accept add chain=input protocol=icmp connection-state=new action=accept #      add chain=input in-interface=ether2-lan action=accept #    add chain=input action=drop #    add chain=forward connection-state=established,related action=accept #        add chain=forward in-interface=ether2-lan connection-state=new action=accept #    web  add chain=forward out-interface=ether3-dmz dst-address=192.168.200.2 dst-port=80,443 connection-state=new action=accept #   add chain=forward action=drop</code> </pre> <br><h4 id="hairpin-nat" style=";text-align:right;direction:rtl">  ุงููุงุณู NAT </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/r5/ms/wv/r5mswv8kwtp0m3amzpl--bd5fn0.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat add chain=dstnat dst-port=80 action=dst-nat to-address=192.168.100.2</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููููู ุงููุนุชุงุฏ ูู ุนูุฏูุง ุชููู ุจุฅุนุงุฏุฉ ุชูุฌูู ูููุฐ ุฅูู ุฎุงุฏู ุนูู ุดุจูุฉ ูุญููุฉ ููุนูู ูู ุดูุก ูู ุงูุฎุงุฑุฌ ุ ูููู ุฏุงุฎู ุงูุดุจูุฉ ุงููุญููุฉ ูุง ูููู ุงููุตูู ุฅูู ุงูุฎุงุฏู ุนูู ุนููุงู ุฎุงุฑุฌู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุฑู ูุง ูุญุฏุซ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฑุณู ุงูููุจููุชุฑ 192.168.100.10 ุทูุจูุง ุฅูู 192.0.2.100 </li><li style=";text-align:right;direction:rtl">  ูููุฐ DST-NAT ุนูู ุฌูุงุฒ ุงูุชูุฌูู ูุชุชู ุฅุนุงุฏุฉ ุชูุฌูู ุงูุญุฒูุฉ ุฅูู 192.168.100.2 </li><li style=";text-align:right;direction:rtl">  ูุฑู ุงูุฎุงุฏู ุฃู ุงูุญุฒูุฉ ูู 192.168.100.10 ูุฏ ูุตูุช ุฅูููุง ุนูู ุงูุนููุงู 192.168.100.2 ููู ุชุณุชุฌูุจ ูู ุงูุนููุงู ุงููุญูู </li><li style=";text-align:right;direction:rtl">  ูุชููู ุงูููุจููุชุฑ ุญุฒูุฉ ุบูุฑ ูุชููุนุฉ ูู 192.168.100.2 ููุชุฌุงูููุง. </li></ol><br><p style=";text-align:right;direction:rtl">  ูุชูุซู ุงูุญู ูู ุฅุถุงูุฉ ูุงุนุฏุฉ ุฅุถุงููุฉ ุชููู ุจุชุบููุฑ ุงูุนููุงู ุงููุตุฏุฑ ุฅูู ุนููุงู ุฌูุงุฒ ุงูุชูุฌูู ุ ุจุญูุซ ูููู ุงูุฎุงุฏู ุจุฅุฑุฌุงุน ุงูุญุฒูุฉ ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ุ ูุงูุฐู ุณูุฑุณูู ุฅูู ุฌูุงุฒ ุชููุฆุฉ ุงูููุจููุชุฑ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat #  add chain=dstnat dst-port=80 action=dst-nat to-address=192.168.100.2 # ,      add chain=srcnat src-address=192.168.100.0/24 dst-address=192.168.100.2 action=masquerade</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูุง ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงููุฎุทุท ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ูููู ููุซุงู ุนูู ุชุตุญูุญ ุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ุฃูุง ูุนุฌุจ ุจู ุญููุง. </p><br><h4 id="pravilnoe-ispolzovanie-netmap" style=";text-align:right;direction:rtl">  ุงูุงุณุชุฎุฏุงู ุงูุณููู ู netmap </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l9/xa/ox/l9xaoxkyat1phpmy6tnnhau6nls.png"><br>  Netmap ูู ุชูููุฉ ูุชุฑุฌูุฉ ุงูุนูุงููู ูู ุดุจูุฉ ูุฑุนูุฉ ุฅูู ุนูุงููู ุดุจูุฉ ูุฑุนูุฉ ุฃุฎุฑู. <br>  ูุชููู ุนููุงู IP (ูู ุฅุฏุฎุงู ุงูููุงุน) ูู ุฌุฒุฃูู: ุงูุดุจูุฉ (ุนุฏุฏ ุงูุจุชุงุช ุงููุญุฏุฏุฉ ูู ููุงุน ุงูุดุจูุฉ ุงููุฑุนูุฉ) ูุงููุถูู (ุงูุจุชุงุช ุงููุชุจููุฉ).  ูุบูุฑ Netmap ุฌุฒุก ุงูุดุจูุฉ ูู ุงูุนููุงู ุ ูููู ูุง ูููุณ ุงูุฌุฒุก ุงููุถูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jy/eh/xh/jyehxh3hok1l5-wfw6c8n4czdlu.png"></p><br><p style=";text-align:right;direction:rtl">  ููุงู ุฌูุงุฒุงู ูุชุตูุงู ุจูุงุณุทุฉ ููุงุฉ VPN.  ุชุฎุฏู ุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูุดุจูุงุช ุงููุฑุนูุฉ ุจููุณ ุงูุนููุงู.  ูู ุงูุถุฑูุฑู ุฌุนู ุงููุตูู ุจูู ุงูุดุจูุงุช ุงููุฑุนูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุง ููููู ุงูุงุณุชุบูุงุก ุนู ุงูุนูุงููู ุงูุฅุถุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณูู ูุทุฑู ุงููุณุชุฎุฏููู ูู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงููุณุฑู ุฅูู ุงููููู ูู ุฎูุงู ุงูุดุจูุฉ ุงููุฑุนูุฉ 192.168.102.0/24 <br>  ุณูุชุทุฑู ุงููุณุชุฎุฏููู ูู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงููููู ุฅูู ุงููุณุงุฑ ูู ุฎูุงู ุงูุดุจูุฉ ุงููุฑุนูุฉ 192.168.101.0/24 </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูููู ุนูู MikroTik 1. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#     /ip route add distance=1 dst-address=192.168.102.0/24 gateway /ip firewall nat #       add action=netmap chain=srcnat dst-address=192.168.102.0/24 out-interface=ipip src-address=192.168.100.0/24 to-address=192.168.101.0/24 #       add action=netmap chain=dstnat dst-address=192.168.101.0/24 in-interface=ipip src-address=192.168.102.0/24 to-address=192.168.100.0/24</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููู MikroTik2 ูู ููุณู ุชูุฑูุจุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add distance=1 dst-address=192.168.101.0/24 gateway=10.10.10.1 /ip firewall nat add action=netmap chain=srcnat dst-address=192.168.101.0/24 out-interface=ipip src-address=192.168.100.0/24 to-address=192.168.102.0/24 add action=netmap chain=dstnat dst-address=192.168.102.0/24 in-interface=ipip src-address=192.168.101.0/24 to-address=192.168.100.0/24</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุชููููุงุช ุฃูุซุฑ ุชุนููุฏูุง ุชุณุชุฎุฏู netmap ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงู ูุฏูู ุงูุนุฏูุฏ ูู ุงูุงุชุตุงูุงุช ุจุงูููุงุท ุงูุจุนูุฏุฉ ูุน ุงูุดุจูุงุช ุงููุฑุนูุฉ ุงููุชูุงุทุนุฉ ููุง ุชูุฌุฏ ุทุฑููุฉ ูุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช ุนูู ุงููุนุฏุงุช ุงูุจุนูุฏุฉ ุ ูููู ูุฐุง ูู ุจุงููุนู ุชูุฌูู ูุชูุฏู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ุชููู ุดูุฆูุง (ุญูู netmap) ุ ูุฃูุช ูุง ุชุญุชุงุฌ ุฅููู ููุง ุชุณุชุฎุฏู ูุฐุง ุงูุฅุฌุฑุงุก ุนูุฏ ุฅุนุงุฏุฉ ุชูุฌูู ุงูููุงูุฐ. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435070/">https://habr.com/ru/post/ar435070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435054/index.html">ุฌุงูุนุฉ ITMO "ูู ุงูููุงุฑุณุฉ": ูุน ุดุฑูุงุช ุงูุชูููููุฌูุง ุงูุชู ูุชุนุงูู ูุนูุง</a></li>
<li><a href="../ar435056/index.html">Samsung SSD 860 QVO 1 TB ู 4 TB: ุงููุณุชููู ุงูุฃูู SATA QLC (3 ุฃุฌุฒุงุก)</a></li>
<li><a href="../ar435060/index.html">2018 ูุงู ุนุงู ุณููุชุฑ. ูุง ุงูุชุงููุ</a></li>
<li><a href="../ar435062/index.html">ุฏููู: ุงูุฒุนุชุฑ + ุงูุฑุจูุน. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar435064/index.html">ูุญู ุฑููุจ Xiaomi ูููุณุฉ ููุฑุจุงุฆูุฉ</a></li>
<li><a href="../ar435072/index.html">ุฐุงูุฑุฉ ุชูุซูููุฉ 8 ุจุช ููุนูู ูุน ุงูุดุจูุงุช ุงูุนุตุจูุฉ</a></li>
<li><a href="../ar435074/index.html">ููุงุท ุงูุถุนู ูู Kyivstar: 1) ุชุญููู ููุดูุฑ ุณุงุจู ุนู ูููุงุช ุงููุฑูุฑ + 2) ูุนูููุงุช ุญูู ุงููุดุชุฑูุงุช ุงูุชู ุชูุฑ ุนุจุฑ ุฎุฏูุงุช Kyivstar</a></li>
<li><a href="../ar435076/index.html">ููู ูุนูู ุงููุณูููู ูุน Google ุนูู ููุฏ ุฅุฒุนุงุฌูุง</a></li>
<li><a href="../ar435078/index.html">ูุงุฐุง ูู ุฌุนู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูููุซููู ุฎุงูุฏููุ</a></li>
<li><a href="../ar435080/index.html">ุฏููู: ุงูุฒุนุชุฑ + ุงูุฑุจูุน. ุงูุฌุฒุก 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>