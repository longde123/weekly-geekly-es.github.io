<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♍️ 🥑 🐃 مقدمة لطبقة 3 جدار الحماية MikroTik 😛 📬 📠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="يعد جدار الحماية (أو عامل تصفية الحزمة) موضوعًا كبيرًا ومعقدًا من الناحية النظرية والعملية. يمكن أن يكون لمرشح الحزمة في أنظمة التشغيل المختلفة إيجابي...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>مقدمة لطبقة 3 جدار الحماية MikroTik</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435070/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  يعد جدار الحماية (أو عامل تصفية الحزمة) موضوعًا كبيرًا ومعقدًا من الناحية النظرية والعملية.  يمكن أن يكون لمرشح الحزمة في أنظمة التشغيل المختلفة إيجابيات وسلبيات مقارنة بالتطبيقات الأخرى.  في هذه المقالة ، سأنظر حصريًا في "جدار الحماية" في RouterOS مع مراعاة iptables السلف. </p><a name="habracut"></a><br><h3 id="predislovie" style=";text-align:right;direction:rtl">  مقدمة </h3><br><h4 id="dlya-kogo-eta-statya" style=";text-align:right;direction:rtl">  من هو هذا المقال ل؟ </h4><br><p style=";text-align:right;direction:rtl">  إذا كنت تعرف كيفية العمل مع iptables ، فتابع وتكوين جدار الحماية ، فلن يكون هناك شيء جديد بالنسبة لك في هذه المقالة (حسنًا ، باستثناء أنه يتم استخدام السلاسل ذات الأسماء الأخرى في جدول NAT).  إذا كانت هذه هي المرة الأولى التي ترى فيها جدار حماية في RouterOS وترغب في الحصول على برنامج نصي جاهز للتكوين ، فلن تجده هنا.  تهدف المادة إلى أولئك الذين يرغبون في الحصول على فكرة <strong>أساسية</strong> عن كيفية عمل جدار الحماية وما يحدث مع رزمة بروتوكول الإنترنت في مراحل مختلفة من معالجتها.  سيأتي فهم أعمق مع الخبرة وحل المشاكل اليومية وغير العادية باستخدام مرشح الحزمة. </p><br><h3 id="teoreticheskaya-chast" style=";text-align:right;direction:rtl">  الجزء النظري </h3><br><h4 id="chto-takoe-layer3-firewall" style=";text-align:right;direction:rtl">  ما هو جدار الحماية Layer3؟ </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ai/xt/od/aixtod5yvn-bvirxxdvwmnm2m30.png"></p><br><p style=";text-align:right;direction:rtl">  لنفترض أن لديك جهاز توجيه مزود بإمكانية الوصول إلى الإنترنت وواجهتين للجسر: جسر الشبكة المحلية (ether2-ether5) و bridge-dmz (ether6-ether10). </p><br><p style=";text-align:right;direction:rtl">  داخل واجهة Bridge ، تعثر الأجهزة بشكل مستقل على الجيران من شبكاتها الفرعية وحزم التبادل ، ويعمل جهاز التوجيه كمحول ولا يراقب حركة المرور هذه على مستوى الشبكة (بالطبع ، يمكنك إجبارها على القيام بذلك ، ولكن دعنا نتحدث عن Layer2 Firewall في وقت آخر). </p><br><p style=";text-align:right;direction:rtl">  إذا لزم الأمر ، اتصل بالجهاز المتصل بواجهة جسر أخرى أو موجود على الشبكة العالمية ، حيث تقوم الأجهزة بنقل الحزم إلى جهاز التوجيه ، والذي يحدد المسار ويعالجها على مستوى الشبكة (الطبقة 3). </p><br><h4 id="packet-flow-diagram" style=";text-align:right;direction:rtl">  مخطط تدفق الحزمة </h4><br><p style=";text-align:right;direction:rtl">  تم وصف المسار الكامل لحركة المرور في Packet Flow Diagram ، وهناك العديد من الإصدارات الرسمية (v5 ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">v6</a> ) ، يجب أن تكون معروفة وتستخدم في العمل اليومي ، ولكن لفهم تشغيل مرشح الحزمة ، يتم تحميلها بشكل زائد ، لذلك سأشرح في إصدار خفيف الوزن. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cb/fr/uu/cbfruui7ydb8lqm19myzozfotbo.png"></p><br><p style=";text-align:right;direction:rtl">  واجهة الإدخال / الإخراج هي أي واجهة جهاز توجيه (Layer 3) (فعلية أو افتراضية).  تصل الحزمة التي تنتقل من الشبكة المحلية إلى الإنترنت إلى واجهة الإدخال وتترك واجهة الإخراج.  تصل الحزمة من الإنترنت إلى الشبكة المحلية أيضًا إلى واجهة الإدخال ، وتترك واجهة الإخراج.  يتم دائمًا قراءة حزمة التدفق في إدخال اتجاه واحد -&gt; الإخراج. </p><br><h4 id="osobennosti-terminologii" style=";text-align:right;direction:rtl">  ميزات المصطلحات </h4><br><p style=";text-align:right;direction:rtl">  دراسة تدفق الحزمة لأجهزة iptables ، يمكنك العثور على أوصاف من خلال "سلاسل في الجداول" أو "جداول في سلاسل".  يوضح المخطط الجداول في السلاسل ، وعند إضافة قواعد إلى جدار الحماية ، سيكون كل شيء بالعكس. </p><br><p style=";text-align:right;direction:rtl">  ولكن في الواقع ، تنتقل الحزمة بين كتل [سلسلة + جداول] ، على سبيل المثال ، إذا قمت بقبول في كتلة [prerouting + mangle] ، ستظل حزمة النقل تتم معالجتها في [forward + mangle].  من المهم تذكر ذلك في التكوينات المعقدة باستخدام pbr و قوائم الانتظار. </p><br><p style=";text-align:right;direction:rtl">  تحتوي وثائق iptables على تعريفات أكثر دقة ، ولكن بكلمات بسيطة: <br>  <strong>السلاسل</strong> مسؤولة عن مكان معالجة الحزمة وتسلسل القواعد. <br>  تحدد <strong>الجداول</strong> الإجراءات التي يمكن تنفيذها على الحزمة. </p><br><h4 id="bazovye-varianty-sledovaniya-paketa" style=";text-align:right;direction:rtl">  الحزمة الأساسية التالية الخيارات </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/1d/tm/6j/1dtm6j1wiiolczrm215gcz_imss.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>العبور</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rj/9z/_w/rj9z_w8s9pc4valiwixtkrwpdke.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تأتي الحزمة من الشبكة إلى إحدى واجهات جهاز التوجيه </li><li style=";text-align:right;direction:rtl">  في سلسلة PREROUTING ، يمكن للمسؤول التأثير على مسار الحزمة: تحديد واجهة الإخراج (توجيه قاعدة السياسة) أو إعادة التوجيه إلى عنوان آخر (dst-nat). </li><li style=";text-align:right;direction:rtl">  وفقًا لجدول التوجيه للحزمة ، يتم تحديد الواجهة الصادرة. </li><li style=";text-align:right;direction:rtl">  سلسلة FORWARD هي مكان التصفية الرئيسي للمرور. </li><li style=";text-align:right;direction:rtl">  العنصر الأخير قبل الدخول إلى الشبكة هو سلسلة POSTROUTING ، حيث يمكنك تغيير عنوان المرسل (src-nat). </li><li style=";text-align:right;direction:rtl">  ذهبت الحزمة عبر الإنترنت. </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>واردة</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qn/l8/gd/qnl8gdad6vpxhgdjnhvhpzngcau.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  جاءت حزمة من الشبكة إلى إحدى واجهات جهاز التوجيه </li><li style=";text-align:right;direction:rtl">  ضرب سلسلة PREROUTING. </li><li style=";text-align:right;direction:rtl">  وفقًا لجدول التوجيه ، تم إرسال الحزمة للمعالجة إلى العملية المحلية. </li><li style=";text-align:right;direction:rtl">  تقوم سلسلة INPUT بتصفية حركة المرور الواردة بواسطة المسؤول. </li><li style=";text-align:right;direction:rtl">  تمت معالجة الحزمة بواسطة العملية المحلية. </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>المنتهية ولايته</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jh/qr/sd/jhqrsd8rq3lt8x1s3jzjuup_m-8.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إنشاء إحدى عمليات الموجه حزمة ip (جديدة أو استجابة - لا يهم). </li><li style=";text-align:right;direction:rtl">  وفقًا لجدول التوجيه ، يتم تعريف واجهة الإخراج للحزمة. </li><li style=";text-align:right;direction:rtl">  يمكن للمسؤول تصفية حركة المرور الصادرة أو تغيير المسار في سلسلة OUTPUT. </li><li style=";text-align:right;direction:rtl">  للحزمة ، يتم اتخاذ القرار النهائي على واجهة الإخراج. </li><li style=";text-align:right;direction:rtl">  تقع الحزمة في POSTROUTING ، وكذلك حركة المرور <em>العابرة</em> . </li><li style=";text-align:right;direction:rtl">  ذهبت الحزمة عبر الإنترنت. </li></ol><br><h4 id="connection-tracker" style=";text-align:right;direction:rtl">  تعقب اتصال </h4><br><p style=";text-align:right;direction:rtl">  تحتاج أولاً إلى فهم ماهية عوامل تصفية حزم الحالة وعديمة الحالة. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/8c/lg/7z/8clg7zcfasexwuw3e3utjyhypl8.png"></p><br><p style=";text-align:right;direction:rtl">  مثال  يفتح الكمبيوتر 192.168.100.10 اتصال tcp بالخادم 192.0.2.10.  على جانب العميل ، يتم استخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المنفذ الديناميكي</a> 49149 ، على جانب الخادم 80. قبل استلام المحتوى ، يجب على العميل والخادم تبادل الحزم لتأسيس جلسة tcp. </p><br><p style=";text-align:right;direction:rtl">  في حالة <em>عديمي الجنسية ،</em> تحتاج إلى فتح حركة المرور من الشبكة المحلية إلى الإنترنت ومن الإنترنت إلى الشبكة المحلية (على الأقل لمجموعة من المنافذ الحيوية).  وهو ككل حفرة. </p><br><p style=";text-align:right;direction:rtl">  في جهاز التوجيه ذي الحالة <em>الفعالة</em> ، يقوم بتحليل الحزم ، وبعد تلقي tcp syn من 192.168.100.10:49149 لـ 192.0.2.10:80 ، يعتبر هذا بداية اتصال جديد.  سيتم اعتبار جميع الحزم الإضافية (في أي اتجاه) بين 192.168.100.10:49149 و 192.0.2.10:80 جزءًا من الاتصال الثابت حتى يتم إغلاق جلسة tcp أو انتهاء صلاحية أجهزة ضبط الوقت. </p><br><p style=";text-align:right;direction:rtl">  بالنسبة إلى UDP / ICMP والأنواع الأخرى من حركة المرور ، حيث لا يمكن التمييز بين بداية ونهاية الاتصال بشكل واضح ، تعتبر الحزمة الأولى هي الأولى ، وتعتبر الباقي جزءًا من الاتصال الثابت وتحديث الموقتات ، وينسي جهاز التوجيه هذه الاتصالات بعد انتهاء صلاحية أجهزة ضبط الوقت. </p><br><p style=";text-align:right;direction:rtl">  يقسم متتبع الاتصال الحزم إلى عدة أنواع: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/j2/do/3f/j2do3fsdj1-t-hq7p2wnf0pnqte.png"></p><br><p style=";text-align:right;direction:rtl">  <em>جديد</em> - حزمة تفتح اتصالًا ، على سبيل المثال <em>syn</em> ل tcp أو الحزمة الأولى في دفق UDP. <br>  <em>أنشئت</em> - حزمة تتعلق اتصال معروف. <br>  <em>ذات صلة</em> - الحزمة المتعلقة بالاتصال الإضافي في متعدد البروتوكولات (sip ، pptp ، ftp ، ...). <br>  حزمة <em>غير صالحة</em> من اتصال غير معروف. <br>  <em>untracked</em> - الحزمة لا تتبع اتصال تعقب. </p><br><p style=";text-align:right;direction:rtl">  <strong>تكوين اتصال تعقب</strong> <br>  تمكين = نعم - تمكين. <br>  تمكين = لا - تعطيل. <br>  enabed = تم تعطيله تلقائيًا حتى تظهر قاعدة تستخدم إمكانيات conntrack في جدار الحماية.  يتم استخدامه افتراضيا. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/a9/2b/tl/a92btlt5yfxh9fhf7-wmpgrohbu.png"></p><br><p style=";text-align:right;direction:rtl">  المعلمات المتبقية هي أجهزة توقيت مختلفة وعادة لا تتطلب ضبط. </p><br><p style=";text-align:right;direction:rtl">  يمكن للمسؤول عرض وحذف الاتصالات ، على سبيل المثال ، يبدو الاتصال بـ NAT كما يلي: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mb/i7/7x/mbi77x9oinpcys1ohb516glu4mc.png"></p><br><p style=";text-align:right;direction:rtl">  يؤثر استخدام conntrack على الأداء واستهلاك الموارد (خاصةً مع عدد كبير من الاتصالات) ، لكنه لن يعمل في معظم التكوينات ، نظرًا لأن  سيكون لديك جدار حماية عديم الحالة بدون NAT. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">قائمة الوظائف التابعة لتعقب الاتصال</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/la/td/kz/latdkzskcwi9cx2o4lkdwtehps8.png"></p></div></div><br><h4 id="ttl" style=";text-align:right;direction:rtl">  TTL </h4><br><p style=";text-align:right;direction:rtl">  Time To Live - حقل في رأس حزمة IP يحدد عدد أجهزة التوجيه التي يمكن أن تمر الحزمة من خلالها قبل إتلافها ، ويحمي من إعادة توجيه الحزمة التي لا تنتهي أثناء حلقات التوجيه. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gp/qi/js/gpqijsw0wgsu2yqrkcamd3z0mhk.png"></p><br><p style=";text-align:right;direction:rtl">  عند إعادة التوجيه ، يقلل جهاز التوجيه من قيمة TTL بمقدار 1 ، إذا كان TTL = 0.  في هذه الحالة ، ستصل الحزمة ذات TTL = 1 إلى العملية المحلية لجهاز التوجيه. </p><br><p style=";text-align:right;direction:rtl">  تستخدم بعض شركات النقل الحيل TTL لمنع استخدام أجهزة التوجيه.  تستحق كل هذه القيود الزيادة في قيمة ttl في جدول mangle. </p><br><h4 id="nat" style=";text-align:right;direction:rtl">  NAT </h4><br><p style=";text-align:right;direction:rtl">  ترجمة عنوان الشبكة - تقنية لتغيير العناوين في رأس حزمة ip.  مثل linux ، يعتبر NAT جزءًا من عامل تصفية الحزمة.  يعمل NAT على أساس تعقب الاتصال. </p><br><p style=";text-align:right;direction:rtl">  في البداية ، تم تصميم NAT كحل سريع لمشكلة استنفاد عناوين IPv4 ؛ للشبكات المحلية ، اقترح استخدام شبكة فرعية من النطاقات: 10.0.0.0/8 ؛  172.16.0.0/12 ؛  192.168.0.0/16 وترجمتها إلى واحد (أو عدة) عناوين قابلة للتوجيه.  في الواقع ، هناك عدد قليل من الشبكات الفرعية للخدمة التي يمكن استخدامها على الشبكات الخاصة وجهاز التوجيه ، من حيث المبدأ ، هو نفس كيفية NAT ، ولكن يوصى باتباع المعايير. </p><br><p style=";text-align:right;direction:rtl">  عمليات NAT فقط: tcp و udp و icmp وبعض البروتوكولات المتعددة من [IP] -&gt; [جدار الحماية] -&gt; [منفذ الخدمة].  تتم معالجة الحزمة الأولى (connection-state = new) الأولى فقط في الاتصال ، وتتم معالجة الحزم المتبقية تلقائيًا دون مشاركة جدول NAT.  يمكن تتبع ذلك عن طريق التغيير في العدادات في القواعد. </p><br><p style=";text-align:right;direction:rtl">  يحتوي رأس الحزمة على عنوان المصدر والوجهة ، على التوالي ، وينقسم NAT إلى مصدر و NAT الوجهة. </p><br><p style=";text-align:right;direction:rtl">  <strong>المصدر NAT</strong> - عنوان المرسل خداع ، موجودة على الغالبية العظمى من أجهزة التوجيه المنزلية والشركات في العالم. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/2s/ej/or/2sejor290wkc26agkonobacposa.png"></p><br><p style=";text-align:right;direction:rtl">  يسمح للعديد من الأجهزة التي تحمل عناوين "رمادية" على الشبكة المحلية بالاتصال بالإنترنت باستخدام واحد (أو عدة) عناوين حقيقية. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hh/hi/du/hhhidurhkrsiiuflmg6dakupph8.png"></p><br><p style=";text-align:right;direction:rtl">  بالعودة إلى تدفق الحزمة ، نرى أن SRC-NAT في مرحلة النشر ، بعد تحديد ما إذا كان سيتم توجيه الحزمة. </p><br><p style=";text-align:right;direction:rtl">  تمر حزمة الاستجابة عبر DST-NAT <em>الضمني</em> حيث يتم تغيير عنوان المستلم إلى محلي. </p><br><p style=";text-align:right;direction:rtl">  <strong>NAT الوجهة</strong> - استبدال عنوان المستلم. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/id/rb/l9/idrbl9jdlfgfvbftjkgwoorszae.png"></p><br><p style=";text-align:right;direction:rtl">  يتم استخدامه ، إذا لزم الأمر ، لإعادة توجيه الحزمة إلى عنوان آخر ، وعادة ما يتم استخدامه "لإعادة توجيه المنافذ" من الشبكة الخارجية إلى الشبكة المحلية. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ju/uv/ly/juuvlyxr74gi8qykxx80vzhyvg4.png"></p><br><p style=";text-align:right;direction:rtl">  وفقًا لحزم الحزمة ، تحدث عملية DST-NAT قبل اتخاذ قرار بشأن التوجيه في Prerouting ؛ يوجد SRC-NAT <em>الضمني</em> لحركة مرور الاستجابة. </p><br><p style=";text-align:right;direction:rtl">  NAT هي أداة قوية لإدارة حركة المرور إلى حد ما ، ولكن يجب استخدامها أخيرًا (عندما لا تكون الأدوات الأخرى مفيدة) </p><br><h4 id="cepochkichains-bazovye-i-polzovatelskie" style=";text-align:right;direction:rtl">  سلاسل (سلاسل) الأساسية والمستخدم </h4><br><p style=";text-align:right;direction:rtl">  تتكون السلاسل من القواعد وتفرض منطق معالجة الحزم. <br>  هناك عدة سلاسل أساسية تم تعيينها لتدفق الحزمة: <br>  <strong>Prerouting (dstnat)</strong> - معالجة الحزمة قبل اتخاذ قرار بشأن التوجيه <br>  <strong>إدخال</strong> - معالجة الحزم الموجهة للعمليات المحلية لجهاز التوجيه <br>  <strong>الإخراج</strong> - معالجة حزم الحزم الناتجة عن العمليات المحلية لجهاز التوجيه <br>  <strong>إلى الأمام</strong> - معالجة المرور المرور <br>  <strong>Postrouting (srcnat)</strong> - معالجة حركة المرور جاهزة للإرسال إلى الواجهة </p><br><p style=";text-align:right;direction:rtl">  <em>كل شيء يشبه في iptables ، ولكن تتم إعادة تسمية السلاسل في nat.</em>  <em>ما هذا مرتبط به (على الأرجح مع نقطة اتصال أو تفريغ الأجهزة من nat) غير معروف بالنسبة لي ، لكنه لا يغير أي شيء على الإطلاق.</em> </p><br><p style=";text-align:right;direction:rtl">  تمرر الحزمة القواعد في السلسلة بشكل متتابع ، إذا كانت مناسبة لجميع الشروط ، فسيتم تطبيق الإجراء على الحزمة.  إذا تم إنهاء الإجراء ولم تسقط الحزمة ، فسيتم تمريره إلى كتلة تدفق الحزمة التالية. </p><br><p style=";text-align:right;direction:rtl">  جميع سلاسل الأساس لديها إجراء افتراضي (إذا لم تتناسب الحزمة مع أي من القواعد) - <em>قبول</em> . </p><br><p style=";text-align:right;direction:rtl">  السلاسل المخصصة ضرورية لتقليل عدد القواعد التي تمر بها كل حزمة وإنشاء قواعد معقدة لمعالجة حركة المرور.  جميع سلاسل المستخدم لها عمل افتراضي - <em>عائد</em> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bk/rg/sk/bkrgskh5wudzzf54mueqiy9oehk.png"></p><br><p style=";text-align:right;direction:rtl">  ضمن الجدول ، يمكنك إعادة توجيه القواعد من عدة سلاسل أساسية (ومستخدم) مختلفة إلى سلسلة المستخدم ، ولكن ستعود الحزمة إلى السلسلة التي جاءت منها. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_8/kw/oi/_8kwoirut9mtd67elbejqkzdsek.png"></p><br><h4 id="usloviya-v-pravilah" style=";text-align:right;direction:rtl">  الشروط والأحكام </h4><br><p style=";text-align:right;direction:rtl">  تتكون السلاسل من قواعد ؛ كل قاعدة تتكون من شروط وإجراءات.  هناك الكثير من الشروط ، ولكن لن تستخدمها جميعًا في تكوينات حقيقية.  معظم الحالات يمكن أن تكون مسبوقة بـ "لا" (علامة "!").  للتزامن مع القاعدة ، يجب أن تكون الحزمة مناسبة لجميع هذه الشروط. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/la/dh/or/ladhorisauzv81cnmffmkjo6_hi.png"></p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">بعض الشروط</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  الشرط </th><th>  الوصف </th></tr></thead><tbody><tr><td>  عنوان src </td><td>  عنوان المصدر </td></tr><tr><td>  التوقيت الصيفي عنوان </td><td>  عنوان المستلم </td></tr><tr><td>  قائمة عناوين src </td><td>  عنوان المصدر مدرج. </td></tr><tr><td>  التوقيت الصيفي قائمة العناوين </td><td>  عنوان المستلم مدرج </td></tr><tr><td>  البروتوكول </td><td>  بروتوكول طبقة النقل </td></tr><tr><td>  src الميناء </td><td>  منفذ المصدر </td></tr><tr><td>  التوقيت الصيفي الميناء </td><td>  ميناء المستلم </td></tr><tr><td>  الميناء </td><td>  منفذ المصدر أو الوجهة </td></tr><tr><td>  في واجهة </td><td>  الواجهة التي جاءت بها الحزمة </td></tr><tr><td>  خارج الواجهة </td><td>  الواجهة التي سيتم إرسال الحزمة منها إلى الشبكة </td></tr><tr><td>  في واجهة القائمة </td><td>  يتم سرد الواجهة التي جاءت الحزمة </td></tr><tr><td>  خارج واجهة القائمة </td><td>  يتم سرد الواجهة التي سيتم إرسال الحزمة منها إلى الشبكة </td></tr><tr><td>  طبقة 7 بروتوكول </td><td>  تحليل محتويات الحزم 10 الأولى في اتصال </td></tr><tr><td>  المحتوى </td><td>  البحث عن سلسلة معينة في دفعة واحدة </td></tr><tr><td>  tls- المضيف </td><td>  بحث المضيف في tls رأس </td></tr><tr><td>  سياسة IPSEC </td><td>  تحقق مما إذا كانت الحزمة مطابقة لسياسة ipsec أم لا </td></tr><tr><td>  حجم الحزمة </td><td>  حجم الحزمة بالبايت </td></tr><tr><td>  src-mac-address </td><td>  عنوان مصدر حزمة ماك </td></tr><tr><td>  علامة اتصال </td><td>  تسمية الاتصال </td></tr><tr><td>  علامة الحزمة </td><td>  تسمية الحزمة </td></tr><tr><td>  علامة التوجيه </td><td>  حزمة نقطة الطريق </td></tr><tr><td>  حالة الاتصال </td><td>  حالة حزمة الاتصال </td></tr><tr><td>  أعلام TCP </td><td>  حزمة أعلام برنامج التعاون الفني </td></tr><tr><td>  خيارات icmp </td><td>  خيارات حزمة Icmp </td></tr><tr><td>  عشوائي </td><td>  يتم تشغيل القاعدة (عندما تتزامن شروط أخرى) مع احتمال معين </td></tr><tr><td>  الوقت </td><td>  يمكنك تحديد ساعات عمل القاعدة ، لسوء الحظ دون تحويل تاريخ </td></tr><tr><td>  ttl </td><td>  قيمة الحقل ttl في الحزمة </td></tr><tr><td>  dscp </td><td>  قيمة الحقل DSCP (ToS) في الحزمة </td></tr><tr><td>  - // - </td><td>  - // - </td></tr><tr><td>  مكان قبل </td><td>  خيار وحدة التحكم (بدون شرط) ، يسمح لك بإضافة قاعدة قبل المحدد </td></tr><tr><td>  المعوقين </td><td>  خيار وحدة التحكم (وليس الشرط) ، يسمح لك بتعطيل القاعدة </td></tr></tbody></table><br><p style=";text-align:right;direction:rtl">  <strong>ملاحظات</strong> <br>  كعنوان src. (Dst.) ، يمكنك تحديد: IP واحد أو مجموعة من العناوين من خلال واصلة أو شبكة فرعية. <br>  هناك حاجة إلى قوائم عناوين للجمع بين العديد من الملكية الفكرية غير المتصلة تحت نفس الاسم.  على عكس ipset في netfilter ، يمكن حذف الإدخالات في قوائم MikroTik بعد فترة زمنية محددة.  يمكنك عرض القوائم وإجراء تغييرات في [IP] -&gt; [جدار الحماية] -&gt; [قوائم العناوين]. <br>  بصفتك رقم المنفذ (منفذ أو منفذ src أو منفذ dst) ، يمكنك تحديد منفذ واحد أو عدة منافذ مفصولة بفواصل أو مجموعة من المنافذ عبر واصلة. </p></div></div><br><p style=";text-align:right;direction:rtl">  في MUM الأخير في MSC ، كان هناك عرض تقديمي جيد حول تأثير الظروف المختلفة على سرعة معالجة الحزم (هناك سوف تتعلم كيفية استخدام الجدول الخام لتقليل الحمل على جهاز التوجيه) ، المهتمين: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التسجيل</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">والعرض التقديمي</a> . </p><br><h4 id="deystviya-v-tablicah" style=";text-align:right;direction:rtl">  جداول الإجراءات </h4><br><p style=";text-align:right;direction:rtl">  تعتمد مجموعة الإجراءات المتاحة على الحزمة على الجدول الذي تتم معالجته فيه. <br><img src="https://habrastorage.org/webt/i3/ba/xj/i3baxjyyz-fnswxpanh_qek5kq8.png"><br>  <strong>مرشح</strong> - جدول تصفية حركة المرور ، واحدة من مكانين حيث يمكنك إسقاط الحزمة. </p><br><p style=";text-align:right;direction:rtl">  <strong>NAT</strong> - جدول لتعديل عناوين IP والمنافذ (tpc ، udp) في رأس حزمة ip. </p><br><p style=";text-align:right;direction:rtl">  <strong>Mangle</strong> - جدول لتعديل الحقول الأخرى من حزمة ip وتحديد التسميات المختلفة. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/w0/dc/n3/w0dcn3uinajpugbflfjha0pt5jy.png"></p><br><p style=";text-align:right;direction:rtl">  هناك ثلاثة أنواع من تسميات الحزمة الداخلية: الاتصال ، الحزمة ، المسار.  التسميات موجودة فقط داخل جهاز التوجيه ولا تذهب إلى الشبكة.  يمكن أن يكون للحزمة تسمية واحدة من كل نوع ، بينما تمر عدة قواعد للعلامة بالتسلسل ، يتم الكتابة على الملصقات. <br>  لا يمكن تعيين ملصقات المسار إلا في سلاسل التجميع والإخراج ، والباقي في أي سلاسل. </p><br><p style=";text-align:right;direction:rtl">  من الممارسات الجيدة وضع علامة على الاتصال أولاً ، ثم الحزمة (الحزمة) أو المسار (المسار).  التحقق من التسميات أسرع من حقول الحزمة.  في الممارسة العملية ، هذا ليس هو الحال دائما في قوائم الانتظار المعقدة أو pbr علامة إضافية للاتصال غير مفيد. </p><br><p style=";text-align:right;direction:rtl">  <strong>RAW</strong> - جدول يسمح للحزم بتجاوز متتبع الاتصال.  يتم استخدامه لمواجهة DoS وتقليل الحمل على وحدة المعالجة المركزية (على سبيل المثال ، تجاوز حركة مرور الإرسال المتعدد).  يتيح لك إسقاط الحزمة. </p><br><p style=";text-align:right;direction:rtl">  تكمل إجراءات الإنهاء معالجة الحزمة في السلسلة وتمريرها إلى الكتلة التالية في تدفق الحزمة ، أو تجاهلها. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">الإجراءات</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  الجدول </th><th>  العمل </th><th>  الوصف </th><th>  إنهاء؟ </th></tr></thead><tbody><tr><td>  الكل </td><td>  اقبل </td><td>  توقف عن معالجة الحزمة ونقلها إلى كتلة تدفق Pakcet التالية </td><td>  نعم </td></tr><tr><td>  الكل </td><td>  سجل </td><td>  معلومات حزمة السجل: في الإصدارات الحديثة ، يمكنك إضافة سجل إلى أي إجراء آخر. </td><td>  لا </td></tr><tr><td>  الكل </td><td>  العبور </td><td>  حساب عدد الحزم.  تستخدم لتصحيح الأخطاء </td><td>  لا </td></tr><tr><td>  الكل </td><td>  إضافة src إلى قائمة العناوين وإضافة dst إلى قائمة العناوين </td><td>  أضف عنوان المصدر (الوجهة) من الحزمة إلى القائمة المحددة </td><td>  لا </td></tr><tr><td>  الكل </td><td>  القفز </td><td>  انتقل إلى سلسلة المستخدم </td><td>  نعم </td></tr><tr><td>  الكل </td><td>  العودة </td><td>  العودة إلى سلسلة الأم.  في سلاسل قاعدة أنها تعمل مثل قبول </td><td>  نعم </td></tr><tr><td>  تصفية الخام </td><td>  إسقاط </td><td>  وقف تدفق الحزمة على تدفق الحزمة وتجاهل </td><td>  نعم </td></tr><tr><td>  تصفية و Prerouting </td><td>  فاست تراك </td><td>  حزمة العلم لتدفق الحزمة السريعة </td><td>  نعم </td></tr><tr><td>  مرشح </td><td>  رفض </td><td>  مثل إسقاط ، ولكن يتم إرسال إشعار المرسل الحزمة (tcp أو icmp) حول الحزمة المنسدلة </td><td>  نعم </td></tr><tr><td>  مرشح </td><td>  فخ </td><td>  محاكاة وجود منفذ مفتوح.  يستخدم للحماية ضد DoS ، والتضليل (وأحيانًا) التصحيح </td><td>  نعم </td></tr><tr><td>  NAT </td><td>  src-nat </td><td>  استبدال عنوان المرسل إلى المحدد </td><td>  نعم </td></tr><tr><td>  NAT </td><td>  حفلة تنكرية </td><td>  حالة خاصة من src-nat ، تستبدل عنوان المرسل بأحد العناوين من الواجهة ، وتستخدم على واجهات ديناميكية (dhcp ، vpn).  لا ينصح باستخدامه في حالة وجود عدة عناوين IP على الواجهة </td><td>  نعم </td></tr><tr><td>  NAT </td><td>  نفسه </td><td>  حالة خاصة من src-nat.  يستبدل عنوان المرسل بعنوان من النطاق المحدد </td><td>  نعم </td></tr><tr><td>  NAT </td><td>  التوقيت الصيفي </td><td>  يستبدل عنوان المستلم بالعنوان المحدد </td><td>  نعم </td></tr><tr><td>  NAT </td><td>  إعادة توجيه </td><td>  في حالة dst-nat الخاصة ، يستبدل عنوان المستلم بعنوان واجهة جهاز التوجيه التي جاءت بها الحزمة </td><td>  نعم </td></tr><tr><td>  NAT </td><td>  netmap </td><td>  ليس بديلا ل DST- نات.  تُستخدم للترجمة من شبكة إلى شبكة ، انظر الأمثلة </td><td>  نعم </td></tr><tr><td>  Mangle </td><td>  علامة اتصال </td><td>  تسمية الاتصال </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  علامة الحزمة </td><td>  تسمية الحزمة المطبقة في قوائم الانتظار </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  علامة التوجيه </td><td>  تم تطبيق تسمية المسار في سياسة التوجيه الأساسية </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  تغيير ttl </td><td>  تحرير ttl </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  تغيير dcsp (tos) </td><td>  تغيير dcsp العشري </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  تغيير MSSS </td><td>  تغيير mss إلى برنامج التعاون الفني syn </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  واضح مد </td><td>  واضح لا تجزئة العلم </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  خيارات ipv4 الشريط </td><td>  محو خيارات ipv4 المتقدمة </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  وضع الأولوية </td><td>  تعيين أولوية ل CoS </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  الطريق </td><td>  تعيين بوابة للحزمة.  نسخة بسيطة من PBR </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  شم tzsp </td><td>  قم بتغليف الحزم في udp وإرسالها إلى ip المحدد </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  شم الكمبيوتر </td><td>  التناظرية من tzsp ، ولكن مع نوع مختلف من التغليف.  في ويكي إذا استخدام الحالات مع calea </td><td>  لا </td></tr><tr><td>  Mangle </td><td>  العبور </td><td>  بشكل افتراضي ، معظم القواعد في mangle لا تمنع الحزمة من المرور ، يمكنك تغيير هذا السلوك عن طريق تعيين passtrough = لا </td><td>  لا </td></tr><tr><td>  الخام </td><td>  notrack </td><td>  لا تتبع الحزمة في تعقب الاتصال </td><td>  نعم </td></tr></tbody></table><br><p style=";text-align:right;direction:rtl">  <em>إذا كان هناك من يرغب ، فيمكنني كتابة المزيد عن FastTrack و FastPath ، لكن يجب ألا تتوقع معجزات من هذه التقنيات.</em> </p></div></div><br><h4 id="para-slov-pro-dpi" style=";text-align:right;direction:rtl">  بضع كلمات عن إدارة شؤون الإعلام </h4><br><p style=";text-align:right;direction:rtl">  هناك العديد من الاحتمالات للنظر في الحزمة أعمق قليلاً من رأس طبقة النقل: <br>  <em>المحتوى</em> - يبحث عن سلسلة معينة في الحزمة. <br>  <em>layer7-protocol</em> - <em>تخزين</em> أول 10 حزم (أو 2 كيلوبايت) من الاتصال والبحث عن إعادة التسجيل في البيانات المخزنة مؤقتًا.  يؤثر عدد كبير من قواعد layer7 بشكل كبير على الأداء. <br>  <em>tls-host</em> هو عنوان اسم المضيف في رأس TLS / SNI لاتصال HTTPS. </p><br><h3 id="primery" style=";text-align:right;direction:rtl">  أمثلة </h3><br><p style=";text-align:right;direction:rtl">  لا تقم بنسخ الأمثلة دون تفكير ، فمن الأفضل أن تأخذ الجهاز ومحاولة كتابة التكوين بنفسك (أو إعادة كتابة الأمثلة ، ولكن لفهم ما تفعله كل قاعدة من القواعد).  إذا كنت لا تعرف كيفية استكمال القواعد: في الإعدادات الافتراضية والحد الأدنى من التكوينات المنزلية لا يمكن الوصول إلى جهاز التوجيه من واجهة الشبكة الواسعة ، أضفه مع التصفية حسب قائمة العناوين. </p><br><h4 id="defoltnyy-firewall-routeros" style=";text-align:right;direction:rtl">  جدار الحماية الافتراضي RouterOS </h4><br><p style=";text-align:right;direction:rtl">  تكوين آمن إلى حد ما ، ولكن في أماكن مشوشة للغاية: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">/ip firewall filter #     (established, related)   (untracked)  add action=accept chain=input connection-state=established,related,untracked #    (invalid)  add action=drop chain=input connection-state=invalid #  icmp  add action=accept chain=input protocol=icmp #          add action=drop chain=input in-interface-list=!LAN #   ipsec    add action=accept chain=forward ipsec-policy=in,ipsec add action=accept chain=forward ipsec-policy=out,ipsec #          add action=fasttrack-connection chain=forward connection-state=established,related #       add action=accept chain=forward connection-state=established,related,untracked #    add action=drop chain=forward connection-state=invalid #     wan ,     dstnat (,      src-nat   dst-nat) add action=drop chain=forward connection-nat-state=!dstnat connection-state=new in-interface-list=WAN /ip firewall nat #Source NAT      ipsec,      WAN add action=masquerade chain=srcnat ipsec-policy=out,none out-interface-list=WAN</code> </pre> <br><p style=";text-align:right;direction:rtl">  لم أستخدم التكوين الافتراضي أبدًا ، ولكن قبل جدار الحماية الافتراضي كان أسوأ بكثير. </p><br><h4 id="minimalnyy-domashniy-firewall" style=";text-align:right;direction:rtl">  الحد الأدنى لجدار الحماية الرئيسية </h4><br><p style=";text-align:right;direction:rtl">  أسهل شيء للتوصل إليه.  نعم ، لا يُسمح بحركة المرور التي لم يتم تعقبها (ولكن في مرحلة الدراسة الأساسية لجدار الحماية التي لا تزال لا تحتاج إليها) وستكون هناك مشكلات في برنامج ipsec النفقي (مرة أخرى ، إذا تمكنت من تكوين ipsec ، فأنت تعرف ما يجب القيام به). </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter #     (established, related)  add chain=input connection-state=established,related action=accept #  icmp  add chain=input connection-state=new protocol=icmp action=accept #      add chain=input connection-state=new in-interface-list=LAN action=accept #     add chain=input action=drop #       add chain=forward connection-state=established,related action=accept #         add chain=forward connection-state=new in-interface-list=LAN action=accept #     add chain=forward action=drop /ip firewall nat #Source NAT        WAN add chain=srcnat out-interface-list=WAN action=masquerade</code> </pre> <br><h4 id="primer-s-dmz" style=";text-align:right;direction:rtl">  مثال DMZ </h4><br><p style=";text-align:right;direction:rtl">  على أجهزة التوجيه "المنزلية" ، يحب الاسم المختصر DMZ استدعاء كمبيوتر على الشبكة الفرعية المحلية التي يتم توجيه جميع المنافذ من الشبكة الخارجية إليها. </p><br><p style=";text-align:right;direction:rtl">  في الواقع ، ليس هذا هو الأمر ، وأحد خيارات DMZ هو فصل المورد الذي يجب أن توفر الوصول إليه من الإنترنت ، ويمكن تنفيذ هجوم ناجح (خادم الويب مع cms التي توجد فيها ثقوب باستمرار هو هدف جيد للمهاجمين).  في حالة الاختراق ، لن يتمكن المهاجم من التأثير على المشاركين في الشبكة المحلية. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bb/pp/9g/bbpp9gbe7k4owuef7hxuzisrurg.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#  /ip firewall nat add chain=dstnat dst-port=80,443 action=dst-nat to-address=192.168.200.2 /ip firewall filter #   icmp   add chain=input connection-state=established,related action=accept add chain=input protocol=icmp connection-state=new action=accept #      add chain=input in-interface=ether2-lan action=accept #    add chain=input action=drop #    add chain=forward connection-state=established,related action=accept #        add chain=forward in-interface=ether2-lan connection-state=new action=accept #    web  add chain=forward out-interface=ether3-dmz dst-address=192.168.200.2 dst-port=80,443 connection-state=new action=accept #   add chain=forward action=drop</code> </pre> <br><h4 id="hairpin-nat" style=";text-align:right;direction:rtl">  القاسي NAT </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/r5/ms/wv/r5mswv8kwtp0m3amzpl--bd5fn0.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat add chain=dstnat dst-port=80 action=dst-nat to-address=192.168.100.2</code> </pre> <br><p style=";text-align:right;direction:rtl">  الموقف المعتاد هو عندما تقوم بإعادة توجيه منفذ إلى خادم على شبكة محلية ويعمل كل شيء من الخارج ، ولكن داخل الشبكة المحلية لا يمكن الوصول إلى الخادم على عنوان خارجي. </p><br><p style=";text-align:right;direction:rtl">  دعونا نرى ما يحدث: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يرسل الكمبيوتر 192.168.100.10 طلبًا إلى 192.0.2.100 </li><li style=";text-align:right;direction:rtl">  ينفذ DST-NAT على جهاز التوجيه وتتم إعادة توجيه الحزمة إلى 192.168.100.2 </li><li style=";text-align:right;direction:rtl">  يرى الخادم أن الحزمة من 192.168.100.10 قد وصلت إليها على العنوان 192.168.100.2 وهي تستجيب من العنوان المحلي </li><li style=";text-align:right;direction:rtl">  يتلقى الكمبيوتر حزمة غير متوقعة من 192.168.100.2 ويتجاهلها. </li></ol><br><p style=";text-align:right;direction:rtl">  يتمثل الحل في إضافة قاعدة إضافية تقوم بتغيير العنوان المصدر إلى عنوان جهاز التوجيه ، بحيث يقوم الخادم بإرجاع الحزمة إلى جهاز التوجيه ، والذي سيرسله إلى جهاز تهيئة الكمبيوتر. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat #  add chain=dstnat dst-port=80 action=dst-nat to-address=192.168.100.2 # ,      add chain=srcnat src-address=192.168.100.0/24 dst-address=192.168.100.2 action=masquerade</code> </pre> <br><p style=";text-align:right;direction:rtl">  في الممارسة العملية ، لا يتم استخدام هذا المخطط في كثير من الأحيان ، ولكن كمثال على تصحيح جدار الحماية ، أنا معجب به حقًا. </p><br><h4 id="pravilnoe-ispolzovanie-netmap" style=";text-align:right;direction:rtl">  الاستخدام السليم ل netmap </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l9/xa/ox/l9xaoxkyat1phpmy6tnnhau6nls.png"><br>  Netmap هي تقنية لترجمة العناوين من شبكة فرعية إلى عناوين شبكة فرعية أخرى. <br>  يتكون عنوان IP (في إدخال القناع) من جزأين: الشبكة (عدد البتات المحددة في قناع الشبكة الفرعية) والمضيف (البتات المتبقية).  يغير Netmap جزء الشبكة من العنوان ، لكنه لا يلمس الجزء المضيف. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jy/eh/xh/jyehxh3hok1l5-wfw6c8n4czdlu.png"></p><br><p style=";text-align:right;direction:rtl">  هناك جهازان متصلان بواسطة قناة VPN.  تخدم أجهزة التوجيه الشبكات الفرعية بنفس العنوان.  من الضروري جعل الوصول بين الشبكات الفرعية. </p><br><p style=";text-align:right;direction:rtl">  لا يمكنك الاستغناء عن العناوين الإضافية. </p><br><p style=";text-align:right;direction:rtl">  سوف يطرق المستخدمون من الشبكة الفرعية اليسرى إلى اليمين من خلال الشبكة الفرعية 192.168.102.0/24 <br>  سيتطرق المستخدمون من الشبكة الفرعية اليمنى إلى اليسار من خلال الشبكة الفرعية 192.168.101.0/24 </p><br><p style=";text-align:right;direction:rtl">  التكوين على MikroTik 1. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#     /ip route add distance=1 dst-address=192.168.102.0/24 gateway /ip firewall nat #       add action=netmap chain=srcnat dst-address=192.168.102.0/24 out-interface=ipip src-address=192.168.100.0/24 to-address=192.168.101.0/24 #       add action=netmap chain=dstnat dst-address=192.168.101.0/24 in-interface=ipip src-address=192.168.102.0/24 to-address=192.168.100.0/24</code> </pre> <br><p style=";text-align:right;direction:rtl">  تكوين MikroTik2 هو نفسه تقريبا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add distance=1 dst-address=192.168.101.0/24 gateway=10.10.10.1 /ip firewall nat add action=netmap chain=srcnat dst-address=192.168.101.0/24 out-interface=ipip src-address=192.168.100.0/24 to-address=192.168.102.0/24 add action=netmap chain=dstnat dst-address=192.168.102.0/24 in-interface=ipip src-address=192.168.101.0/24 to-address=192.168.100.0/24</code> </pre> <br><p style=";text-align:right;direction:rtl">  هناك تكوينات أكثر تعقيدًا تستخدم netmap ، على سبيل المثال ، إذا كان لديك العديد من الاتصالات بالنقاط البعيدة مع الشبكات الفرعية المتقاطعة ولا توجد طريقة لتغيير الإعدادات على المعدات البعيدة ، ولكن هذا هو بالفعل توجيه متقدم. </p><br><p style=";text-align:right;direction:rtl">  إذا لم تفهم شيئًا (حول netmap) ، فأنت لا تحتاج إليه ولا تستخدم هذا الإجراء عند إعادة توجيه المنافذ. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435070/">https://habr.com/ru/post/ar435070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435054/index.html">جامعة ITMO "في الممارسة": مع شركات التكنولوجيا التي نتعاون معها</a></li>
<li><a href="../ar435056/index.html">Samsung SSD 860 QVO 1 TB و 4 TB: المستهلك الأول SATA QLC (3 أجزاء)</a></li>
<li><a href="../ar435060/index.html">2018 كان عام سكوتر. ما التالي؟</a></li>
<li><a href="../ar435062/index.html">دليل: الزعتر + الربيع. الجزء 1</a></li>
<li><a href="../ar435064/index.html">نحن ركوب Xiaomi مكنسة كهربائية</a></li>
<li><a href="../ar435072/index.html">ذاكرة تمثيلية 8 بت للعمل مع الشبكات العصبية</a></li>
<li><a href="../ar435074/index.html">نقاط الضعف في Kyivstar: 1) تحليل منشور سابق عن كلمات المرور + 2) معلومات حول المشتريات التي تمر عبر خدمات Kyivstar</a></li>
<li><a href="../ar435076/index.html">كيف يعمل المسوقون مع Google على نقد إزعاجنا</a></li>
<li><a href="../ar435078/index.html">ماذا لو جعل الذكاء الاصطناعي الممثلين خالدين؟</a></li>
<li><a href="../ar435080/index.html">دليل: الزعتر + الربيع. الجزء 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>