<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏻 👩🏼‍🎨 🤹🏼 Chatbot-Entwicklung (Telegramm + Youtube) 👠 👨🏼‍💻 🐞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warum ist es überhaupt hier aufgetaucht? 

 Kürzlich schrieb ich einen Artikel über die Entwicklung von PHP-Bots mit Laravel + Botman als Telegramm. D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chatbot-Entwicklung (Telegramm + Youtube)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463207/">  Warum ist es überhaupt hier aufgetaucht? <br><br>  Kürzlich schrieb ich einen Artikel über die Entwicklung von PHP-Bots mit Laravel + Botman als Telegramm.  Das allererste, was sie geschrieben haben, ist „aus einer Kanone auf Spatzen schießen“.  Ich stimme dem zu, ich habe es sogar während der Entwicklung erkannt, aber ich war an Laravel interessiert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/rl/ce/lyrlcenybn_v6he3q2rsxgymiok.jpeg" alt="Bild"></div><a name="habracut"></a><br>  Jetzt habe ich einen Bot für reines PHP (ohne Umreifung) und die Telegramm-API entwickelt. Da es viele Artikel zu einem ähnlichen Thema gibt, werden wir ein wenig auf die Google-API (Youtube-API) eingehen.  Ich hoffe, Sie finden es interessant und nützlich, mehr über die YouTube-API zu erfahren. <br><br>  Ein kleiner Exkurs.  Im Moment arbeite ich als Frontend-Programmierer und arbeite mit PHP nur zu meinem eigenen Vergnügen (obwohl es ein Vergnügen ist).  Es mag dumme Fehler auf der Serverseite geben, aber es funktioniert und für mich zum Zeitpunkt des Trainings ist dies genug. <br><br><h4>  Erklärung des Problems </h4><br>  Eines Abends kam mir die Idee, den Bot und Youtube zu verbinden. Damals ahnte ich nicht einmal die Existenz von API Google.  Es erfordert einen Bot, der, wenn ein neues Video auf dem YouTube-Kanal veröffentlicht wird, die Benachrichtigung in meinem Bot pusht. <br><br>  Im Prinzip ist die Funktionalität recht einfach, aber wie arbeitet man mit YouTube?  Es stellt sich heraus, dass Google selbst eine Lösung für dieses Problem hat und Google API heißt.  Es ermöglicht Ihnen, mit allen Anwendungen des Unternehmens zu arbeiten, aber ich war nur an YouTube interessiert. <br><br><h4>  Anpassung und Entwicklung </h4><br>  So kam es, dass während des Studiums der YouTube-API eine elegante Lösung für mein Problem gefunden wurde, die von der API-Dokumentation selbst angeboten wurde.  Aber zuerst über die API.  Um damit zu arbeiten, müssen Sie zur Google-Konsole gehen und die gewünschte API-Option auswählen.  Danach liegt der Pfad nur noch in der Dokumentation oder im Stackoverflow.  Ich muss sofort sagen, dass es keine russische Version der Dokumentation gibt, es gibt auch keine Lektionen.  Es ist ratsam, nur minimale Kenntnisse der englischen Sprache zu haben oder durch Tippen zu handeln. <br><br>  Es sieht so aus.  Sie gehen in die Google-Konsole, erstellen Ihr Projekt und wählen die gewünschte API aus. <br><br><img src="https://habrastorage.org/webt/p1/aa/8v/p1aa8vsd_gsk_kbhgtvzdzdpqso.png" alt="Bild"><br><br>  Und jetzt das Problem zu lösen.  Beim Lesen der Dokumentation habe ich den Dienst <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pubsubhubbub.appspot.com/subscribe</a> gefunden (Google hat es mir selbst gezeigt) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,</a> mit dem Sie YouTube und Ihre Anwendung verknüpfen können.  Wie funktioniert es  Es funktioniert nach dem Prinzip des Webhooks.  Sie fügen das Youtube des Kanals ein, den Sie hören möchten, und empfangen jedes Mal, wenn Sie Aktionen auf dem Kanal ausführen (Video hinzufügen, löschen, ändern), Daten in Ihr Skript. <br><br><img src="https://habrastorage.org/webt/hl/tb/yg/hltbygpefguy9khw5huwwer9au8.png" alt="Bild"><br><br>  Rückruf-URL - ein Skript, das Daten von Google empfängt. <br>  Die Themen-URL ist der Kanal, den Sie anhören möchten. <br><br>  Nun, im Feld Modus können Sie auswählen, was Sie möchten, abonnieren oder abbestellen. <br><br>  Beginnen wir mit dem Schreiben des Codes. Zunächst richten wir unser Skript für die Arbeit mit YouTube ein.  Ich habe seitdem alles in einer Datei geschrieben  Es war ein Test + Code, da ist wirklich nicht genug.  Nachdem Sie eine Abonnementanfrage gesendet haben, müssen Sie diese bestätigen.  Wenn Sie googeln, finden Sie die Antwort auf der Lieblingsseite aller, wie einer der Kommentare zu stackoverflow nahe legt. <br><br><pre><code class="php hljs">$video = <span class="hljs-string"><span class="hljs-string">"null"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'hub_challenge'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_REQUEST[<span class="hljs-string"><span class="hljs-string">'hub_challenge'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $video = parseYoutubeUpdate(file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseYoutubeUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data)</span></span></span><span class="hljs-function"> </span></span>{ $xml = simplexml_load_string($data, <span class="hljs-string"><span class="hljs-string">'SimpleXMLElement'</span></span>, LIBXML_NOCDATA); $video_id = substr((string)$xml-&gt;entry-&gt;id, <span class="hljs-number"><span class="hljs-number">9</span></span>); $channel_id = substr((string)$xml-&gt;entry-&gt;author-&gt;uri, <span class="hljs-number"><span class="hljs-number">32</span></span>); $published = (string)$xml-&gt;entry-&gt;published; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'video_id'</span></span>=&gt;$video_id, <span class="hljs-string"><span class="hljs-string">'channel_id'</span></span>=&gt;$channel_id, <span class="hljs-string"><span class="hljs-string">'published'</span></span>=&gt;$published ); }</code> </pre> <br>  Hier erstellen wir der Einfachheit halber eine Variable, in der wir die Informationen zum Video benötigen.  In den nächsten beiden Zeilen kannst du bestimmen, ob es möglich ist, die Anfrage von pubsubhubbub zu bestätigen. Wenn ja, dann bestätige, wenn nicht, bedeutet dies, dass die Daten von youtube stammen und wir sie verarbeiten müssen.  In der Funktion parseYoutubeUpdate verarbeiten wir die Antwort und erhalten alle Informationen, die wir benötigen. <br><br>  Hier lohnt es sich, über eine spezielle (meiner Meinung nach kann ich mich irren) Form von Daten zu schweifen und zu erzählen, die YouTube (für Antworten) verwendet. Sie wird, wie ich es verstehe, Atom genannt (nicht zu verwechseln mit der IDE oder ist es nur eine gewöhnliche XML ... es gab wenig Erfahrung damit). .  Es sieht ungefähr so ​​aus (ein kleiner Teil der Antwort von Youtube): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>yt:video:eE5mpblYpdY<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:videoId</span></span></span><span class="hljs-tag">&gt;</span></span>eE5mpblYpdY<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:videoId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:channelId</span></span></span><span class="hljs-tag">&gt;</span></span>UCGqKr3O5ub-O7zEKx_qeHUQ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:channelId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>20b3560a49 1080<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alternate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.youtube.com/watch?v=hgCQ378xNus"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>not Epic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uri</span></span></span><span class="hljs-tag">&gt;</span></span>https://www.youtube.com/channel/UCGqKr3O5ub-O7zEKx_qeHUQ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uri</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span>2019-07-14T05:10:49+00:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span>2019-07-14T05:11:07.600177664+00:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Zurück zu parseYoutubeUpdate (). <br><br>  In einer Funktion konvertieren wir die Antwort in das XML-Format. <br>  Wir schreiben die benötigten Daten in die Variablen. <br>  Und dann geben wir ein Array mit diesen Daten zurück. <br><br>  Wir gehen zum Telegramm.  Für den Anfang möchte ich sagen, es ist ******, wie einfacher es ist, mit Botman zu arbeiten.  Wenn Sie Bots nur für Telegramm entwickeln möchten, verwenden Sie keine Bibliotheken, mit denen Sie Bots für verschiedene Plattformen entwickeln können.  es macht keinen Sinn ... es wird mehr Probleme geben.  Die Telegramm-API ist sehr klar und einfach, selbst für Anfänger, die gerade PHP kennengelernt haben und nur minimale OOP-Kenntnisse haben. <br><br>  Also näher am Punkt, näher am Code.  Wir müssen einen Bot erstellen und ihn an unser Skript binden.  Ich hoffe du kannst einen Bot erstellen.  Wir schreiben ein Token vom Bot und erstellen eine Anfrage <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TOKEN = <span class="hljs-string"><span class="hljs-string">"6826815*******Yme99*****9kjzgVi*****3S******"</span></span>; $url = <span class="hljs-string"><span class="hljs-string">'https://api.telegram.org/bot'</span></span> . TOKEN . <span class="hljs-string"><span class="hljs-string">'/sendMessage'</span></span>;</code> </pre><br>  Jetzt müssen wir nur noch eine Anfrage an den Telegrammserver senden. <br><br><pre> <code class="php hljs">$params = [ <span class="hljs-string"><span class="hljs-string">'chat_id'</span></span> =&gt;<span class="hljs-number"><span class="hljs-number">712531723</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span> =&gt; $linkVideo, ]; $url = $url . <span class="hljs-string"><span class="hljs-string">'?'</span></span> . http_build_query($params);</code> </pre><br>  Wir erstellen die erforderlichen Parameter, für mich ist es eine Chat-ID (wenn in der Produktion ein Bot angezeigt wird, müssen alle IDs in der Datenbank für Spam gespeichert werden) und eine Textnachricht. <br><br>  Wie Sie vielleicht bemerkt haben, übergebe ich den Link als einfache Nachricht, nicht als Video.  So wie ich es verstehe, überträgt ein Telegramm ein Video nur, wenn es auf den Server hochgeladen wird, andernfalls nicht ... + Ich muss ein Vorschaubild für das Video sehen. <br><br>  Jetzt erhält unser Bot Benachrichtigungen über das Beenden / die Videobearbeitung.  Es sieht ungefähr so ​​aus: <br><br><img src="https://habrastorage.org/webt/yg/18/72/yg1872yqamevvqavsgu7hpfo-oc.png" alt="Bild"><br><br>  Spiel vorbei  Ich habe alles  Der größte Nachteil dieses Codes ist, dass er sich in einer einzigen Datei befindet, aber es war für mich nicht sinnvoll, den 10-zeiligen Code zu trennen. <br><br>  Quellen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463207/">https://habr.com/ru/post/de463207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463193/index.html">Konvertieren Sie Schwarzweißbilder mit nicht negativer Matrixzerlegung in ASCII-Grafiken</a></li>
<li><a href="../de463195/index.html">Was passiert mit dem Tele2 Internet?</a></li>
<li><a href="../de463197/index.html">Blazor + MVVM = Silverlight schlägt zurück, weil das alte Böse unbesiegbar ist</a></li>
<li><a href="../de463203/index.html">Die schwere Zeitlast. Yandex berichtet über häufige Fehler bei der Arbeit mit der Zeit</a></li>
<li><a href="../de463205/index.html">Zunächst nicht funktionsfähig: Wie man mit einem Laptop unter Windows 10 und einem 32-Gigabyte-Laufwerk überlebt</a></li>
<li><a href="../de463215/index.html">Ingenieure und Architekten entwerfen bereits Mond-Siedlungen</a></li>
<li><a href="../de463221/index.html">Beobachten der Sonne: 5 Arten von Geräten, von 5 bis 5.000 US-Dollar</a></li>
<li><a href="../de463223/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 310 (vom 5. bis 11. August)</a></li>
<li><a href="../de463225/index.html">WiFi Enterprise. FreeRadius + FreeIPA + Ubiquiti</a></li>
<li><a href="../de463227/index.html">Problemlösung mit pwnable.kr 19 - Verknüpfung aufheben. Heap-Pufferüberlauf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>