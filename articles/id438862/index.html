<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌪️ 🕷️ ✍🏿 Menyebarkan aplikasi web isomorfik menggunakan Nuxt.js sebagai contoh. 🥩 👨🏼‍⚖️ 🙋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam proyek menengah dan besar, situs ini tidak terbatas pada satu layanan - misalnya, hanya situs, sebagai aturan ada database, API, server yang mer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menyebarkan aplikasi web isomorfik menggunakan Nuxt.js sebagai contoh.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438862/"><img src="https://habrastorage.org/webt/sa/ge/qb/sageqbm3jftmbtbdkftowwvwb3o.jpeg"><br>  Dalam proyek menengah dan besar, situs ini tidak terbatas pada satu layanan - misalnya, hanya situs, sebagai aturan ada database, API, server yang merutekan permintaan ke semua layanan ini.  Meluncurkan dan memperbarui semua ini tanpa standarisasi apa pun tidak mudah, dan menskalakan ke banyak server bahkan lebih sulit. <br><a name="habracut"></a><br>  Docker, yang telah menjadi standar de facto di dunia pengemasan, pengiriman, dan aplikasi penerbitan, akan membantu kami mengatasi masalah ini. <br><br>  Docker memungkinkan kita untuk membungkus aplikasi atau layanan dengan semua dependensi dan pengaturan dalam wadah yang terisolasi, menjamin konsistensi konten pada platform apa pun. <br><br>  Sebagai aplikasi isomorfik, kita akan menggunakan kerangka kerja Nuxt.js, yang terdiri dari Vue.js dan Node.js, memungkinkan kita untuk menulis aplikasi web universal dengan rendering sisi-server (SSR). <br><br>  Pilihan ini karena preferensi pribadi, namun, dengan cara yang sama, Anda dapat mengambil kerangka kerja lain, misalnya Next.js. <br><br><h3>  Kami mengumpulkan dan mempublikasikan gambar pertama. </h3><br>  Pertama-tama, Anda perlu mengkonfigurasi port dan host di dalam aplikasi.  Ada beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cara</a> untuk melakukan ini, kita akan menggunakan pengaturan di package.json dengan menambahkan bagian baru: <br><br><pre><code class="json hljs"><span class="hljs-string"><span class="hljs-string">"config"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"nuxt"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-string"><span class="hljs-string">"3000"</span></span> } }</code> </pre> <br>  Untuk tindakan lebih lanjut, kita membutuhkan buruh pelabuhan, susunan buruh pelabuhan yang terpasang di sistem dan editor dengan proyek terbuka. <br><br>  Buat Dockerfile yang kami masukkan ke root dan jelaskan instruksi untuk membangun gambar. <br><br>  Kita perlu membangun gambar berdasarkan gambar Node.js versi 10, dalam hal ini versi alpine yang ringan digunakan: <br><br><pre> <code class="plaintext hljs">FROM node:10-alpine</code> </pre> <br>  Kemudian atur variabel lingkungan dengan nama direktori: <br><br><pre> <code class="plaintext hljs">ENV APP_ROOT /web</code> </pre> <br>  Tetapkan sebagai direktori kerja dan tambahkan sumber: <br><br><pre> <code class="plaintext hljs">WORKDIR ${APP_ROOT} ADD . ${APP_ROOT}</code> </pre><br>  Instal dependensi dan bangun aplikasi: <br><br><pre> <code class="plaintext hljs">RUN npm ci RUN npm run build</code> </pre><br>  Dan kami menulis perintah peluncuran aplikasi di dalam gambar: <br><br><pre> <code class="plaintext hljs">CMD ["npm", "run", "start"]</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Dockerfile</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">FROM node:10-alpine ENV APP_ROOT /web ENV NODE_ENV production WORKDIR ${APP_ROOT} ADD . ${APP_ROOT} RUN npm ci RUN npm run build CMD ["npm", "run", "start"]</code> </pre><br></div></div><br>  Setelah itu, buka folder saat ini di terminal dan kumpulkan gambar: <br><br><pre> <code class="plaintext hljs">docker build -t registry.gitlab.com/vik_kod/nuxtjs_docker_example .</code> </pre><br>  Jalankan gambar secara lokal untuk memverifikasi bahwa semuanya berfungsi dengan benar: <br><br><pre> <code class="plaintext hljs">docker run -p 3000:3000 registry.gitlab.com/vik_kod/nuxtjs_docker_example</code> </pre><br>  Pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">localhost: 3000,</a> kita akan melihat yang berikut: <br><br><img src="https://habrastorage.org/webt/3m/8m/4e/3m8m4epncpbjdw0hxwfptw7rqh4.png"><br><br>  Hebat!  Kami berhasil meluncurkan bangunan produksi aplikasi pada mesin lokal. <br><br>  Sekarang kita perlu menerbitkan gambar ke repositori buruh pelabuhan agar dapat menggunakan gambar yang sudah jadi pada server target.  Anda dapat menggunakan repositori yang di-host-sendiri atau yang lain, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hub.docker.com</a> resmi. <br><br>  Saya akan menggunakan repositori di gitlab, tab dengan repositori buruh pelabuhan ada yang disebut registry.  Sebelumnya, saya sudah membuat repositori untuk proyek, jadi sekarang saya menjalankan perintah: <br><br><pre> <code class="plaintext hljs">docker push registry.gitlab.com/vik_kod/nuxtjs_docker_example</code> </pre><br>  Setelah gambar berhasil di-boot, Anda dapat mulai mengkonfigurasi server VPS, <br>  Milik saya adalah sebagai berikut: <br><br><ul><li>  RAM 1 GB </li><li>  4 core </li><li>  30 GB drive </li></ul><br>  Saya juga mengambil kesempatan untuk menginstal buruh pelabuhan segera ketika membuat server, jadi jika itu tidak diinstal pada VPS Anda, Anda dapat membaca instruksi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web resmi.</a> <br><br>  Setelah membuat server, buka dan masuk ke repositori buruh pelabuhan, dalam kasus saya ini gitlab: <br><br><pre> <code class="plaintext hljs">docker login registry.gitlab.com</code> </pre><br>  Setelah otorisasi, kita dapat memulai aplikasi dengan perintah yang terlihat sebelumnya: <br><br><pre> <code class="plaintext hljs">docker run -p 3000:3000 registry.gitlab.com/vik_kod/nuxtjs_docker_example</code> </pre><br><img src="https://habrastorage.org/webt/8z/qh/su/8zqhsuvrva9zi4mgqhutiq4nwrk.png"><br><br>  Gambar telah diunduh dan mulai, mari kita periksa: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e4/609/85a/1e460985a476590d13d1a344c9a1a90b.png"><br><br>  Kami melihat gambar yang akrab, kami meluncurkan wadah dengan aplikasi, tetapi sudah di server jauh. <br><br>  Sentuhan terakhir tetap, sekarang ketika terminal ditutup, gambar akan dihentikan, jadi kita akan menambahkan atribut -d untuk memulai wadah di latar belakang. <br>  Berhenti dan mulai ulang: <br><br><pre> <code class="plaintext hljs">docker run -d -p 3000:3000 registry.gitlab.com/vik_kod/nuxtjs_docker_example</code> </pre><br>  Sekarang kita dapat menutup terminal dan memastikan aplikasi kita berfungsi dengan sukses. <br><br>  Kami mencapai apa yang dibutuhkan - kami meluncurkan aplikasi di buruh pelabuhan dan sekarang aplikasi ini cocok untuk ditempatkan, baik sebagai gambar independen dan sebagai bagian dari infrastruktur yang lebih besar. <br><br><h3>  Tambahkan reverse proxy </h3><br>  Pada tahap saat ini, kita dapat menerbitkan proyek sederhana, tetapi bagaimana jika kita perlu meletakkan aplikasi dan API di domain yang sama dan selain itu, berikan statika tidak melalui Node.js? <br><br>  Dengan demikian, perlu muncul apa yang disebut server proxy terbalik, di mana semua permintaan akan diterima dan dialihkan tergantung pada permintaan ke layanan terkait. <br><br>  Dengan demikian server kita akan menggunakan nginx. <br><br>  Mengelola wadah jika ada lebih dari satu secara individu tidak nyaman.  Oleh karena itu, kami akan menggunakan buruh pelabuhan sebagai cara untuk mengatur dan mengelola wadah. <br><br>  Buat proyek kosong baru, di root yang kami tambahkan file docker-compose.yml dan folder nginx. <br><br>  Di docker-compose.yml kami menulis yang berikut ini: <br><br><pre> <code class="plaintext hljs">version: "3.3" #      services: #  , nginx nginx: image: nginx:latest #   80  http  443  https ports: - "80:80" - "443:443" #      container_name: proxy_nginx volumes: #   nginx ,      - ./nginx:/etc/nginx/conf.d #            - ./logs:/var/log/nginx/ #   Nuxt.js  nuxt: #     image: registry.gitlab.com/vik_kod/nuxtjs_docker_example container_name: nuxt_app #        ports: - "3000:3000"</code> </pre><br>  Di folder nginx, tambahkan config, yang direkomendasikan oleh situs resmi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nuxt.js</a> , dengan sedikit perubahan. <br><br><div class="spoiler">  <b class="spoiler_title">nginx.conf</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">map $sent_http_content_type $expires { "text/html" epoch; "text/html; charset=utf-8" epoch; default off; } server { root /var/www; listen 80; #    nginx server_name localhost; #   ip  gzip on; gzip_types text/plain application/xml text/css application/javascript; gzip_min_length 1000; location / { expires $expires; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_read_timeout 1m; proxy_connect_timeout 1m; #   ,       # docker-compose        ,    nuxt_app proxy_pass http://nuxt_app:3000; } }</code> </pre><br></div></div><br>  Kami menjalankan perintah untuk menjalankan: <br><br><pre> <code class="plaintext hljs">docker-compose up</code> </pre> <br><img src="https://habrastorage.org/webt/_e/nm/rt/_enmrtzkskhzce0dsha44ihxyde.png"><br><br>  Semuanya dimulai dengan benar, sekarang jika kita pergi ke alamat yang mendengarkan nginx, localhost - kita akan melihat aplikasi kita, tidak akan ada perbedaan visual, namun sekarang semua permintaan pergi ke nginx terlebih dahulu di mana mereka dialihkan tergantung pada aturan yang ditentukan. <br><br>  Sekarang kita tidak memiliki layanan atau statika tambahan, mari kita tambahkan folder statis di mana kita akan menempatkan beberapa gambar. <br><br>  Pasang di wadah nginx dengan menambahkan baris ke docker-compose: <br><br><pre> <code class="plaintext hljs">... container_name: proxy_nginx volumes: #     - ./static:/var/www/static ...</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Updated docker-compose.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">version: "3.3" #      services: #  , nginx nginx: image: nginx:latest #   80  http  443  https ports: - "80:80" - "443:443" #      container_name: proxy_nginx volumes: #   nginx ,      - ./nginx:/etc/nginx/conf.d #            - ./logs:/var/log/nginx/ #     - ./static:/var/www/static #   Nuxt.js  nuxt: #     image: registry.gitlab.com/vik_kod/nuxtjs_docker_example container_name: nuxt_app #         ports: - "3000:3000"</code> </pre><br></div></div><br>  Kemudian tambahkan lokasi baru ke nginx.conf: <br><br><pre> <code class="plaintext hljs">location /static/ { try_files $uri /var/www/static; }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Diperbarui nginx.conf</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">map $sent_http_content_type $expires { "text/html" epoch; "text/html; charset=utf-8" epoch; default off; } server { root /var/www; listen 80; #    nginx server_name localhost; #   ip  gzip on; gzip_types text/plain application/xml text/css application/javascript; gzip_min_length 1000; location / { expires $expires; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_read_timeout 1m; proxy_connect_timeout 1m; #   ,       # docker-compose        ,    nuxt_app proxy_pass http://nuxt_app:3000; } location /static/ { try_files $uri /var/www/static; } }</code> </pre><br></div></div><br>  Mulai ulang komposisi buruh pelabuhan: <br><br><pre> <code class="plaintext hljs">docker-compose up --build</code> </pre><br>  Pergi ke <a href="">localhost / static / demo.jpg</a> <a href=""><br></a> <br><br><img src="https://habrastorage.org/webt/op/fv/op/opfvopehymnscgtysqtoxjcjzdw.png"><br><br>  Sekarang statis dikirimkan melalui Nginx, menghapus beban dari Node.js di aplikasi utama. <br><br>  Setelah memastikan bahwa semuanya berfungsi, Anda dapat mempublikasikan perakitan kami di server.  Untuk melakukan ini, saya akan membuat repositori di direktori saat ini.  Setelah sebelumnya menambahkan log dan folder statis ke .gitignore. <br><br>  Setelah itu, kita pergi ke server, menghentikan gambar buruh pelabuhan yang sebelumnya diluncurkan dan mengkloning repositori. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ec/a7d/da4/9eca7dda43a5ed7623eb5fd12f41cdd6.png"><br><br>  Sebelum memulai perakitan, Anda perlu memindahkan folder dengan statika ke server, pergi ke terminal di mesin lokal dan gunakan utilitas baris perintah scp untuk memindahkan folder ke server: <br><br><pre> <code class="plaintext hljs">scp -r /Users/vik_kod/PhpstormProjects/nuxtjs_docker_proxy_example/static root@5.101.48.172:/root/example_app/</code> </pre><br>  Jika volume statika besar, lebih baik kompres folder terlebih dahulu dan kirim sebagai arsip, lalu ekstrak di server.  Jika tidak, unduhan mungkin memakan waktu lama. <br><br>  Kami kembali ke terminal di server dan pergi ke folder kloning, jalankan perintah: <br><br><pre> <code class="plaintext hljs">docker-compose up -d</code> </pre><br>  Tutup terminal dan pergi ke situs: <br><br><img src="https://habrastorage.org/webt/au/3l/yq/au3lyqjf74cr99zabxraau073m0.png"><br><br><img src="https://habrastorage.org/webt/hm/pv/id/hmpvidrp494pdol1dzf-lebt9vs.png"><br>  Hebat!  Menggunakan reverse proxy, kami memisahkan statika dari aplikasi. <br><br><h3>  Langkah selanjutnya </h3><br>  Semua yang telah kami lakukan di atas adalah pilihan yang cukup sederhana, dalam proyek-proyek besar Anda perlu mempertimbangkan lebih banyak hal, di bawah ini adalah daftar singkat dari apa yang dapat Anda lakukan selanjutnya. <br><br><ul><li>  Wadah data hanya untuk area admin statis, aplikasi SPA, dan basis data </li><li>  Layanan tambahan untuk pemrosesan gambar dan optimisasi, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">misalnya</a> </li><li>  Integrasi CI / CD, perakitan gambar ketika mendorong ke cabang yang dipilih, serta layanan memperbarui dan memulai kembali secara otomatis </li><li>  Buat Kubernetes atau Swarm cluster jika ada lebih dari 1 server, untuk penyeimbangan beban dan penskalaan horizontal yang mudah </li></ul><br><h3>  Total </h3><br><ul><li>  Kami telah berhasil menerbitkan aplikasi di server dan menyiapkannya untuk penskalaan lebih lanjut. </li><li>  Kami harus mengenal buruh pelabuhan dan mengetahui cara membungkus aplikasi Anda dalam sebuah wadah. </li><li>  Kami belajar langkah apa yang bisa diambil lebih lanjut untuk meningkatkan infrastruktur. </li></ul><br><h3>  Kode sumber </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Aplikasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Konfigurasi</a> <br><br>  <i>Terima kasih atas perhatian Anda dan saya harap materi ini membantu Anda!</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id438862/">https://habr.com/ru/post/id438862/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id438850/index.html">Moscow JS 44 - pengumuman</a></li>
<li><a href="../id438852/index.html">Gateway GSM baru dari OpenVox</a></li>
<li><a href="../id438854/index.html">Penjelasan sifat fisik dari fenomena "Gaya Angkat" tanpa menggunakan persamaan Bernoulli</a></li>
<li><a href="../id438856/index.html">Sag dari kehidupan</a></li>
<li><a href="../id438858/index.html">Cara menggunakan segmentasi, penargetan, dan posisi (STP) dalam mengembangkan strategi pemasaran</a></li>
<li><a href="../id438864/index.html">Membekukan fitur C ++ 20. Coroutine, Modul dan banyak lagi</a></li>
<li><a href="../id438866/index.html">Sintaks pembangun versus Java</a></li>
<li><a href="../id438868/index.html">Minggu Keamanan 06: Langsung di FaceTime</a></li>
<li><a href="../id438870/index.html">Lombok mengembalikan kehebatan Jawa</a></li>
<li><a href="../id438874/index.html">Memulai pertemanan dengan VkNet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>