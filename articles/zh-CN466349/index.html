<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>➕ 👦🏽 👩🏽‍🔬 如何在15,000家线下商店进行A / B测试 ⏩ 🦈 🕘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你好 X5 Retail Group的互联大数据临时分析团队。 

 在本文中，我们将讨论我们的A / B测试方法以及我们每天面临的挑战。 

 大数据X5拥有大约200名员工，其中包括70名科学家日期和分析师日期。 我们的主要业务是从事特定产品-需求，分类，促销活动等。 除了他们，还有我们独立的临...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何在15,000家线下商店进行A / B测试</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/466349/"> 你好  X5 Retail Group的互联大数据临时分析团队。 <br><br> 在本文中，我们将讨论我们的A / B测试方法以及我们每天面临的挑战。 <br><br> 大数据X5拥有大约200名员工，其中包括70名科学家日期和分析师日期。 我们的主要业务是从事特定产品-需求，分类，促销活动等。 除了他们，还有我们独立的临时分析团队。 <br><br><img src="https://habrastorage.org/webt/fc/ab/by/fcabbyvlt69yxmfimt4iidjbsze.png"><br><a name="habracut"></a><br> 我们是： <br><br><ul><li> 我们帮助业务部门处理不适合现有产品的数据分析请求； </li><li> 如果产品团队需要更多的帮助，我们会提供帮助； </li><li> 我们从事A / B测试-这是团队的主要职能。 </li></ul><br> 我们工作的情况与典型的A / B测试有很大不同。 通常，该技术与在线和在线指标相关：更改如何影响转化，保留率，点击率等。 大多数实验都与界面更改有关：重新布置横幅，重新粉刷按钮，替换文本等。 <br><br>  X5的业务有所不同-它是遍布全国的15,000家各种格式的离线商店。 此功能强加了某些限制。 首先，可以测试的一组指标变化很大，其次，对实验施加了限制。 就人工而言，更改在线商店店面设计的任务无法与更改离线商店中部门顺序的任务相提并论。 <br><br> 该公司拥有一支参与忠诚度计划的团队，其飞行员最接近经典的A / B测试理念。 对于“普通” A / B测试，我们遇到的问题是非常不典型的。 例如： <br><br><ul><li> 如果更改香肠和糕点部门的订单，商店的财务状况将如何改变？ </li><li> 客户流失的模式将如何影响财务业绩？ </li><li> 设置postamate将如何影响商店性能？ </li></ul><br> 客户认为某种改变将对其中一项指标产生积极影响（我们将在后面讨论）。 我们的工作是帮助他们根据数据验证其假设。 <br><br><h3> 指标 </h3><br> 我们正在测试哪些指标？  <b>RTO</b> ， <b>平均检查</b>和<b>流量</b>是我们开放空间机翼中最常用的词。 <br><br><ul><li>  <b>RTO</b> （零售周转率）-商店赚的钱。 </li></ul><br> 业务的主要指标之一，也是最难测试的指标。 <br><br> 该商店的每日营业额以百万卢布为单位。 因此，指标的价差至少以几千卢布衡量。 确定样本大小的复杂而漫长的公式表示，方差越大，任何有意义的结论都需要更多的数据。 为了在如此大的PTO分散度下，即使要达到十分之一的效果，商店的飞行员也需要花费六个月的时间。 <br><br> 想象一下董事会的反应，如果在与他们的会议上说飞行员需要在所有商店花六个月甚至一年的时间？  =） <br><br> 我们有两种标准方法。 <br><br> 第一种方法：我们不考虑整个商店的RTO，而是某种产品类别。 例如，由于商店中两个部分的重新布置（“蛋糕”和“香肠”），预计这两个类别的PTO都会增加。 一类的RTO比整个商店的RTO小得多，因此分散性较低。 在这种情况下，我们希望这些类别中的飞行员与其余类别隔离。 <br><br> 第二种方法：我们采样时间。 观察单位不是整个飞行员的商店PTO，而是每周或每天的PTO。 因此，我们增加了观察次数，同时保持了原始数据的方差。 <br><br><img src="https://habrastorage.org/webt/kw/b_/w1/kwb_w1jmlkx4rynvidf5cfqvkny.jpeg"><br><br><ul><li>  <b>平均支票</b>或<b>RTO /支票数</b> -一张支票的平均金额。 </li></ul><br> 部分更改旨在使人们购买更多商品，因此，如果我们使用通常的指标进行类比，则我们会测试RTO /支票数量或平均支票数量。 <br><br> 测试此指标的难度与零售的具体情况有关。 例如，随着“ 3为2的价格”促销活动的试点推出，计划购买一种产品的人将购买三种产品，而支票的金额将增加。 但是，如果他后来变得不太可能去商店并且飞行员实际上没有那么成功怎么办？ <br><br><ul><li>  <b>流量</b> -商店中一定时间段内的支票数量。 </li></ul><br> 为了避免在检验影响平均检查的假设时得出错误的结论，我们同时查看流量变化。 我们无法直接跟踪有多少人来到商店，因为 并非所有访问者都是忠诚度计划的客户，因此，对于A / B测试，每张支票都是对客户的“独特访问”。 类似于PTO，我们考虑不同时间间隔的流量：每天的流量，每小时的流量。 <br><br> 平均检查与流量之间的关系非常重要：飞行员是否可以增加平均检查，但减少流量并最终不会导致PTO增加，而是导致PTO减少？ 飞行员可以在不改变平均费用的情况下帮助增加流量吗？ <br><br><ul><li>  <b>保证金</b> -产品价格与其成本之间的差额 </li></ul><br> 在我们可以改变商品价格的框架中，有一些飞行员-有些人的价格上涨了，而有些人则相反。 由于我们不影响生产成本，因此通过改变价格，我们可以改变商品的保证金。 这样的飞行员会导致流量增加，并增加平均检查量。 但这是否意味着该试点成功了，并且值得在该网络的所有商店中更改价格？ 不，人们很可能会开始更多地购买负利润或小利润的商品而放弃高利润的商品。 因此，RTO并不总是跟随总利润的增加；因此，值得分别测试这些指标。 <br><br> 好吧，假设我们已经确定了目标指标。 以下问题： <br><br><ul><li> 客户计划接收什么尺寸的效果？ </li><li> 在实验中实际上可以检测到什么效果？ </li><li> 实验需要多长时间？ </li><li> 哪一组？ </li></ul><br><h3> 实验总结 </h3><br> 在线用户进行的A / B测试具有显着优势-他们具有很高的推广能力。 换句话说，在实验过程中获得的结论可以按比例缩放到所有用户。 实验设置保证了泛化能力：对照组和测试组是随机组成的，几乎两个组均来自同一分布，您可以在两个组中捕获大量流量-会有预算。 <br><br> 对于离线零售，这些设置都不起作用。 首先，商店的数量是有限制的。 其次，商店之间存在很大差异。 实际上，居住区中的Perekrestok商店和商务中心附近的Perekrestok是来自不同分布的完全不同的对象。 <br><br><img src="https://habrastorage.org/webt/-8/o_/so/-8o_sonaxffqinwcofkoegbxw58.jpeg"><br><br> 在图中，我们看到测试组中的商店与整个网络的商店不同。 这是一个非常典型的情况：在Pyaterochka连锁店中，不仅在城市，而且在小居民区都设有商店。 大型飞行员通常会在城市举行。 无论我们收到什么影响，在整个网络上扩展它都是错误的。 <br><br> 我们通过以下公式评估飞行员的总效果： <br><br><img src="https://habrastorage.org/webt/0p/t7/-w/0pt7-w_eyalkcs_fafhwwgqzjx0.png"><br><br>  a是试点组的分布与网络中所有商店的相交区域。 <br><br> 请注意，这不是统计定律的结果，而是我们对考虑累积影响的逻辑性的假设。 <br><br> 理想的选择是为测试组招募代表性样本，即真正反映网络整个状态的商店。 但是代表性导致样本异质性，因为  PTO较低或较高的商店将被采样。 <br><br><h3> 小组人数，飞行员时长和可察觉的影响最小 </h3><br> 现在最重要的是-效果的大小和飞行员的持续时间。 通常，我们面临以下三种情况之一： <br><br><ol><li> 客户有飞行员的时间限制以及可以合作的商店数量； </li><li> 客户知道他希望收到的效果规模，并要求指出飞行员需要的商店数量（然后是商店本身）； </li><li> 客户愿意接受我们的报价。 </li></ol><br> 不能说任何一种情况都比较简单，因为无论如何我们都在准备一个影响误差表。 <br><br><img src="https://habrastorage.org/webt/tl/rb/dc/tlrbdcloe-j79-o-2rygs4aqira.png"><br><br> 对她很重要： <br><br><ol><li> 第一种错误-不在时看到效果的可能性； </li><li> 第二种错误-跳过效果时的可能性； </li><li> 成功试点所预期的效果大小。 </li></ol><br> 这三个参数的组合使您可以计算所需的飞行员持续时间。 表格中的值是样本数量-在这种情况下，每天进行试点所需的收据数量或商店中的平均度量标准。 如果我们谈论现实世界，那么通常第一类和第二类错误的概率是5-10％。 从表中可以看出，由于存在此类固定错误，我们需要421 Pyaterochka天才能赶上百分之一的影响。 看来这个数字相当不错-毕竟，每天421 Pyaterochka是40家商店的试点，为期10天。 但是，只有一个“但是”-很少有飞行员真正期望百分之一的效果。 通常我们讲的是百分之一的十分之一。 鉴于RTO是以十亿计的，成功试点的效果的十分之一可以大大增加收入。 因此，我想测量最小的影响。 但是效果大小越小，第二种方法的误差就越大。 这是可以理解的：微小的影响类似于随机噪声，很少被认为是与规范的真正偏离。 在下面的图形中可以清楚地看到这一点，我们希望在具有较大方差的数据中捕获较小的影响。 <br><br><img src="https://habrastorage.org/webt/vr/na/lw/vrnalwenskdfrb2xpenvbhgq23o.jpeg"><br><br><h3>  A / A测试 </h3><br> 在试验开始之前，您需要确定测试和控制组。 客户可能有或没有试点组。 我们准备通过请求限制在这两种情况下为他提供帮助-例如，商店应严格位于三个特定区域。 <br><br> 假设我们以某种方式选择了一个测试和对照组。 如何确保所选的组很好，并且您真的可以对它们进行A / B测试？ 似乎一切听起来都很和谐：我们给观察值打了分，根据公式可以得出0.7％的效果，我们找到了类似的商店。 现在什么不适合我们？ <br><br> 不幸的是，很多严肃的事实： <br><br><ul><li> 样本中的元素并非来自同一分布-我们的样本是来自不同商店的观察结果的混合，并且每个商店都有自己的分布。 </li><li> 样本的要素不是独立的-样本中有一个商店的观测值很多，它们之间有联系； </li><li> 在没有飞行员的情况下无法保证均等- 我们根本不确定如果没有飞行员，那么商店的统计信息不会有所不同。 </li></ul><br> 在根据误差和影响选择观察次数的公式的计算中，未考虑所有这些问题。 为了了解上述问题的影响程度，我们进行了A / A测试。 实际上，这是在商店中没有飞行员时对商店中的整个飞行员进行的模拟。 这个时期称为预试。 <br><img src="https://habrastorage.org/webt/rf/zd/vz/rfzdvzpvmqlff2x6ed2bzeqtuxy.png"><br> 在试行期间，我们多次重复了三个步骤： <br><br><ol><li> 选择类似的团体； </li><li> 两组平等测试； </li><li> 增加测试组的效果并测试均等性。 </li></ol><br><img src="https://habrastorage.org/webt/ri/ti/eg/ritieghfygj6kgxfyedloba-irk.png"><br><br><h3> 匹配相似的群体 </h3><br> 我们没有发明自行车，因此我们正在寻找具有最近邻居的旧方法的类似群体。 为商店生成特征的策略是另一种艺术。 我们发现了三种工作方法： <br><br><ul><li> 根据我们正在测试的指标，每个商店都由一个特征向量来描述。 例如，当检查平均支票时，我们描述了8周的每日平均支票-我们为商店获得56个标牌。 然后，我们计算一对商店的标牌之间的欧几里得距离。 </li></ul><br><img src="https://habrastorage.org/webt/ra/nq/sy/ranqsy12gvkgu2tgk1lsocvbwcu.jpeg"><br><br><ul><li> 查找动态相似的商店。 存储的度量绝对值可能有所不同，但趋势却是重合的-通过某些数学操作，可以将这些存储视为相同。 </li></ul><br><img src="https://habrastorage.org/webt/gw/pz/99/gwpz99ikylr7lyv7nyteclwdk8y.jpeg"><br><br><ul><li> 预测商店在试用期内的表现（将来），并根据它们选择类似的商品-但是在这里，我们需要一个能准确预测飞行员表现的预言家。 </li></ul><br> 我们坚持一个非常简单的假设：如果在试点之前商店是相似的，那么如果没有试点变更，它们将保持相似。 <br><br> 您会注意到，即使在这三种工作方法中，也可以在许多方面进行变化：考虑功能的天数/周数，评估指标动态的方法等。 <br><br> 没有万能药，在每个实验中，我们都会根据目标选择不同的选项。 但这很简单：找到一种选择最接近邻居的方法，该方法会给出第一类和第二类的合理错误。 它们来自何处，我们进一步说明。 <br><br><h3> 测试均值是否相等或第一种方法的错误 </h3><br> 回想一下，在这一点上，我们： <br><br><ol><li> 与客户确定效果的大小和飞行员的持续时间 </li><li> 解释了第一类和第二类错误的本质 </li><li> 建立了选择相似群体的方法 </li></ol><br> 此阶段的目标是确保我们在第3节中选择的方法找到这样的组，以使飞行员在这些商店中的指标（RTO，平均检查，流量）在统计上没有差异。 <br><br> 在循环中，我们通过某种统计检验和自举法反复选择选定的组以实现相等性。 如果错误比例（即，组彼此不相等）高于阈值，则拒绝该方法并选择一个新的方法。 因此，直到我们达到所需的错误阈值。 <br><br><img src="https://habrastorage.org/webt/-r/wn/sg/-rwnsgtq1jyngzxrsdm446piem0.png"><br><br> 重要的是要找出不存在效果时我们捕获效果的频率，即 我们的选择方法是否响应商店之间的随机差异。 <br><br><h3> 添加效果或第二种方法的错误 </h3><br> 这是一个合理的问题，但是我们是否不会以将实际效果也视为噪声而忽略它们的方式进行自我训练？ 换句话说，我们是否能够检测到效果？ <br><br> 在最后一步确保各组重合后，我们向其中一个组添加了人工效果，即 我们保证试点成功并取得成功。 <br><br> 这次的目标是找出平等假设被拒绝的频率，即 该测试能够区分两组。 在这种情况下的错误是假定组是相等的。 我们将此错误称为第二种错误。 <br><br> 同样，在周期中，我们测试对照组和“嘈杂”测试组是否相等。 如果我们很少犯错误，那么我们认为选择组的方法已通过验证。 它可以用来在试点期间选择组，并确保如果试点产生了效果，我们将能够检测到它。 <br><br><img src="https://habrastorage.org/webt/bw/gh/vw/bwghvwsqzs2uaxq81gf06e1z2zo.png"><br><br><h3> 关于异质性 </h3><br> 我们已经提到，数据异质性是我们所面临的最大敌人之一。 不均匀性是由多种根本原因引起的： <br><br><ul><li> 购物的异质性-每个商店都有自己的平均指标值（在莫斯科RTO商店中，访问量远大于在乡村商店中） </li><li> 一周中各天的异质性-流量的分布不同以及一周中不同日期的平均检查不同：星期二的流量看起来不像星期五的流量 </li><li> 天气的异质性-人们在不同的天气条件下购物的方式有所不同 </li><li> 一年中时间的异质性-冬季的流量与夏季的流量不同-如果飞行员持续数周，则必须考虑到这一点。 </li></ul><br> 不均匀性增加了方差，如上所述，在评估PTO存储库时，方差已经具有巨大的意义。 捕获效果的大小直接取决于方差。 例如，将色散降低四倍，可以检测到一半效果。 <br><br> 在最简单的情况下，我们正在努力解决线性化的异质性问题。 <br> 假设我们在两家商店中进行了为期三天的试点（是的，这与所有关于效果大小的规定公式相矛盾，但这是一个示例）。 商店中的平均<b>RTO</b>分别为20万和50万，而两组的方差为10,000，根据所有观察，则为35,000 <br> 试点之后，平均值分为300和600组，方差分别为10,000和22,500，整个组为40,000。 <br><br><img src="https://habrastorage.org/webt/om/yn/pb/omynpbpgftr7lsoa7bl6rubjos0.png"><br><br> 一个简单而优雅的举动是线性化数据，即 从每个期间值中减去上一个期间的平均值。 <br><br><img src="https://habrastorage.org/webt/3t/xf/9t/3txf9tustucss6vaj6ydnkxnct8.png"><br><br> 在输出处，样本为：100、0、200，-50、100、250。试点期间的色散减少了3倍，达到13000。 <br><br> 这意味着我们可以看到比原始绝对值更微妙的效果。 <br><br> 这不是处理异质性的唯一方法。 我们将在下一篇文章中讨论其他内容。 <br><br><h3>  A / B测试的一般方法 </h3><br> 大型飞行员的准备工作和他们的评估通过了我们的团队，并经过了全面的测试。 <br><br> 我们的协议： <br><br><ol><li> 从客户那里接收有关度量标准和预期效果的信息； </li><li> 确定小组的规模和飞行员的持续时间； </li><li> 开发一种按组分配商店的算法； </li><li> 在组之间进行A / A测试并验证该算法； </li><li> 等待飞行员完成并计算效果。 </li></ol><br> 这些阶段都不是没有困难地通过的；每个阶段都有其特点。 我们在本文中介绍了如何处理其中的一些。 接下来，我们将讨论...。 <br><br><h3> 团队 </h3><br> 最后，我想提一下所有演员： <br><br><ul><li> 瓦列里（Valery Babushkin） </li><li> 亚历山大·萨赫诺夫（Alexander Sakhnov） </li><li> 丹尼斯·伊万诺夫（Denis Ivanov） </li><li> 谢尔盖·登琴科（Sergey Demchenko） </li><li> 尼古拉·纳扎罗夫（Nikolay Nazarov） </li><li> 谢尔盖·卡巴诺夫（Sergey Kabanov） </li><li> 尤里·加里米林 </li><li> 海伦·特凡扬（Helen Tevanyan） </li><li> 弗拉迪斯拉夫·拉登科夫 </li><li> 谢尔盖·扎哈罗夫（Sergey Zakharov） </li><li> 瓦西里的故事 </li><li> 亚历山大·别利亚耶夫（Alexander Belyaev） </li><li> 基斯马特·马戈梅多夫（Kismat Magomedov） </li><li> 埃戈尔·克拉申尼科夫（Egor Krashennikov） </li><li> 艾格（Egor Karnaukh） </li><li>  Svyatoslav Oreshin </li><li> 尤里·特鲁比森（Yuri Trubitsyn） </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466349/">https://habr.com/ru/post/zh-CN466349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466333/index.html">如何为自己安排工作场所</a></li>
<li><a href="../zh-CN466335/index.html">使用8base功能创建Slack应用程序</a></li>
<li><a href="../zh-CN466337/index.html">您的功能是什么颜色？</a></li>
<li><a href="../zh-CN466339/index.html">如何在Microsoft SQL Server中使用R从Google Analytics（分析）获取数据</a></li>
<li><a href="../zh-CN466345/index.html">构造配色方案的波动方法</a></li>
<li><a href="../zh-CN466355/index.html">鳄鱼会飞，但是低低（大约不带情绪但有离题的ekranoplans）</a></li>
<li><a href="../zh-CN466359/index.html">为什么世界生态债务日和环境足迹是伪科学的废话</a></li>
<li><a href="../zh-CN466361/index.html">如何获得哥萨克GICSP证书</a></li>
<li><a href="../zh-CN466363/index.html">lur饮DevOps。 第一天 Git，CI / CD，IaC和绿色恐龙</a></li>
<li><a href="../zh-CN466365/index.html">开发单片类Unix操作系统-入门（1）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>