<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›¬ ğŸ§œğŸ¾ ğŸ™ŒğŸ» nodejsï¼šæµç¨‹ç®¡ç†å™¨å’ŒES6æ¨¡å— ğŸ‘³ â–«ï¸ ğŸ‘©ğŸ¼â€ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœåŠ¡å™¨ç«¯JavaScripté¢†åŸŸï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œå¤´è„‘æ¸…æ™°ï¼Œæ•´æ´ã€‚ å› æ­¤ï¼Œå½“æˆ‘å‘ç°å­˜åœ¨è¿›ç¨‹ç®¡ç†å™¨ï¼Œå°¤å…¶æ˜¯å…³äºpm2æ—¶ ï¼Œæˆ‘ç«‹å³å°è¯•ä½¿ç”¨å®ƒåœ¨nodejsä¸Šè¿è¡Œä¸€äº›ç®€å•çš„åç«¯æœåŠ¡ï¼Œ nodejsè¿›è¡Œè‡ªæˆ‘æ•™è‚²ã€‚ é€šè¿‡importä»¥JSä»£ç è¿æ¥æ¨¡å—ï¼ˆ ES6æ¨¡å— ï¼‰çš„èƒ½åŠ›ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œå› ä¸º å®ƒå…è®¸æ‚¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>nodejsï¼šæµç¨‹ç®¡ç†å™¨å’ŒES6æ¨¡å—</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482370/"><p>åœ¨æœåŠ¡å™¨ç«¯JavaScripté¢†åŸŸï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œå¤´è„‘æ¸…æ™°ï¼Œæ•´æ´ã€‚ å› æ­¤ï¼Œå½“æˆ‘å‘ç°å­˜åœ¨è¿›ç¨‹ç®¡ç†å™¨ï¼Œå°¤å…¶æ˜¯å…³äº<a href="https://habr.com/ru/post/480670/">pm2æ—¶</a> ï¼Œæˆ‘ç«‹å³å°è¯•ä½¿ç”¨å®ƒåœ¨<code>nodejs</code>ä¸Šè¿è¡Œä¸€äº›ç®€å•çš„åç«¯æœåŠ¡ï¼Œ <code>nodejs</code>è¿›è¡Œè‡ªæˆ‘æ•™è‚²ã€‚ é€šè¿‡<code>import</code>ä»¥JSä»£ç è¿æ¥æ¨¡å—ï¼ˆ <a href="https://nodejs.org/docs/latest-v12.x/api/esm.html">ES6æ¨¡å—</a> ï¼‰çš„èƒ½åŠ›ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œå› ä¸º å®ƒå…è®¸æ‚¨åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œå¹¶ä¸”æˆ‘å†™ä¸‹äº†å¸¦æœ‰ES6æ¨¡å—çš„ç®€å•æœåŠ¡ã€‚ </p><br><p> ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘æ²¡æœ‰æˆåŠŸåœ¨pm2ä¸‹å¯åŠ¨åº”ç”¨ç¨‹åºçš„ES6ç‰ˆæœ¬ï¼Œæœ€å¥½<code>forever</code>ä½¿ç”¨æˆ–ä½¿ç”¨<code>systemd</code>è¿è¡Œæ­¤ç±»åº”ç”¨ç¨‹åºã€‚ å‰Šå‡-ä¸ºå–œæ¬¢æ–‡æœ¬çš„äººæä¾›çš„ç»“æœæŠ¥å‘Šã€‚ </p><a name="habracut"></a><br><h1 id="vvedenie"> å¼•è¨€ </h1><br><p> åœ¨æœ¬å‡ºç‰ˆç‰©çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿›ç¨‹ç®¡ç†å™¨æŒ‡çš„æ˜¯ä¸€é¡¹æœåŠ¡ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯ç›‘è§†æ­£åœ¨è¿è¡Œçš„<code>nodejs</code>åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨å‘ç”Ÿå´©æºƒæ—¶é‡æ–°å¯åŠ¨å®ƒã€‚ åŒæ ·ï¼Œè¿›ç¨‹ç®¡ç†å™¨å¯ä»¥ï¼ˆä½†ä¸å¿…ï¼‰æ”¶é›†æœ‰å…³åº”ç”¨ç¨‹åºï¼ˆå¤„ç†å™¨ï¼Œå†…å­˜ï¼‰æ¶ˆè€—çš„èµ„æºçš„ä¿¡æ¯ã€‚ </p><br><h1 id="testovyy-servis"> æµ‹è¯•æœåŠ¡ </h1><br><p> å¯¹äºæµ‹è¯•æµç¨‹ç»ç†ï¼Œæˆ‘åœ¨ES6æœåŠ¡ï¼ˆ <a href="https://github.com/flancer64/sof_es6_pm/tree/habr_pm">github repo</a> ï¼‰ä¸­ä½¿ç”¨äº†ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="javascript hljs"># src/app_es6.mjs <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> express <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"express"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mod <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./mod/es6.mjs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> msg = <span class="hljs-string"><span class="hljs-string">"Hello World! "</span></span> + mod.getName(); app.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(msg); res.send(msg); }); app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ES6 app listening on port 3000!'</span></span>); });</code> </pre> <br><p> åœ¨ES6æ¨¡å—ä¸­ï¼š </p><br><pre> <code class="javascript hljs"># src/mod/es6.mjs <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">getName</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"ES6 module is here."</span></span>; } }</code> </pre> <br><p>  CommonJSæ¨¡å—æ‰§è¡Œçš„ç±»ä¼¼æœåŠ¡å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs"># src/app_cjs.js <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"express"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mod = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"./mod/cjs.js"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> msg = <span class="hljs-string"><span class="hljs-string">"Hello World! "</span></span> + mod.getName(); app.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(msg); res.send(msg); }); app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"CommonJS app listening on port 3000!"</span></span>); });</code> </pre> <br><p>  CJSæ¨¡å—ï¼š </p><br><pre> <code class="javascript hljs"># src/mod/cjs.js <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">getName</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"CommonJS module is here."</span></span>; } };</code> </pre> <br><p> åœ¨ä¸ä½¿ç”¨<code>nodejs</code> v12.14.0ä¸Šçš„è¿›ç¨‹ç®¡ç†å™¨çš„æƒ…å†µä¸‹å¯åŠ¨æœåŠ¡ï¼š </p><br><pre> <code class="plaintext hljs">$ node --experimental-modules ./src/app_es6.mjs # ES6-service $ node ./src/app_cjs.js # CJS-service</code> </pre> <br><h1 id="pm2"> ä¸‹åˆ2 </h1><br><p>  <code>pm2</code>å½“å‰æ˜¯æ‰€æè®®åŠŸèƒ½çš„æµç¨‹ç®¡ç†è€…ä¸­çš„é¢†å¯¼è€…ï¼ˆé™¤äº†ä½¿æµç¨‹ä¿æŒåœ¨å·¥ä½œçŠ¶æ€ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬<a href="https://pm2.keymetrics.io/docs/usage/cluster-mode/">é›†ç¾¤</a> ï¼Œèµ„æºä½¿ç”¨<a href="https://pm2.keymetrics.io/docs/usage/monitoring/">ç›‘è§†ï¼Œ</a> <a href="https://pm2.keymetrics.io/docs/usage/restart-strategies/">é‡å¯</a>æµç¨‹çš„å„ç§<a href="https://pm2.keymetrics.io/docs/usage/restart-strategies/">ç­–ç•¥</a> ï¼‰ã€‚ </p><br><p>  CJSæœåŠ¡å¯åŠ¨æ²¡æœ‰é—®é¢˜ï¼ˆ <code>pm2</code> v4.2.1ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">$ pm2 start ./src/app_cjs.js -i 4</code> </pre> <br><p><img src="https://habrastorage.org/webt/cx/tu/9m/cxtu9mfzw3hkqq-si7h_brbfejy.png"></p><br><p> è¿˜å¯ä»¥æ¯«æ— é—®é¢˜åœ°æ”¯æŒé›†ç¾¤ä¸­æŒ‡å®šæ•°é‡çš„æœåŠ¡å®ä¾‹ï¼š </p><br><pre> <code class="plaintext hljs">root@omen17:~# ps -Af | grep app_cjs alex 29848 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js alex 29855 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js alex 29864 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js alex 29875 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js</code> </pre> <br><p> æ€æ­»ä¸€ä¸ªå®ä¾‹ï¼ˆ <code>PID 29864</code> ï¼‰ä¹‹åï¼Œæµç¨‹ç®¡ç†å™¨ç«‹å³é€‰æ‹©ä¸€ä¸ªæ–°å®ä¾‹ï¼ˆ <code>PID 30703</code> ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">root@omen17:~# kill -s SIGKILL 29864 root@omen17:~# ps -Af | grep app_cjs alex 29848 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js alex 29855 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js alex 29875 29828 0 15:31 ? 00:00:00 node /.../src/app_cjs.js alex 30703 29828 7 15:35 ? 00:00:00 node /.../src/app_cjs.js</code> </pre> <br><p> ä½†æ˜¯è¯¥åº”ç”¨ç¨‹åºçš„ES6ç‰ˆæœ¬åœ¨<code>pm2</code>ä¸­æ— æ³•æ­£å¸¸å·¥ä½œã€‚ å½“<a href="https://futurestud.io/tutorials/pm2-how-to-start-your-app-with-node-js-v8-arguments">å°†</a>å‚æ•°â€œ --experimental-modulesâ€ä¼ é€’ç»™nodejsæ—¶ï¼š </p><br><pre> <code class="plaintext hljs">$ pm2 start ./src/app_es6.mjs -i 4 --node-args="--experimental-modules"</code> </pre> <br><p> åŸæ¥è¿™å¼ å›¾ï¼š <br><img src="https://habrastorage.org/webt/ur/y_/a3/ury_a3oh7cfqa-gj1-107tcxwx8.png"></p><br><p> åœ¨æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š </p><br><pre> <code class="plaintext hljs">$ pm2 log ... /home/alex/.pm2/logs/app-es6-error-2.log last 15 lines: 2|app_es6 | at /usr/lib/node_modules/pm2/node_modules/async/internal/onlyOnce.js:12:16 2|app_es6 | at WriteStream.&lt;anonymous&gt; (/usr/lib/node_modules/pm2/lib/Utility.js:186:13) 2|app_es6 | at WriteStream.emit (events.js:210:5) 2|app_es6 | at internal/fs/streams.js:299:10 2|app_es6 | Error [ERR_REQUIRE_ESM]: Must use import to load ES Module: /home/alex/work/sof_es6_pm/src/app_es6.mjs 2|app_es6 | at Object.Module._extensions..mjs (internal/modules/cjs/loader.js:1029:9) 2|app_es6 | at Module.load (internal/modules/cjs/loader.js:815:32) 2|app_es6 | at Function.Module._load (internal/modules/cjs/loader.js:727:14) 2|app_es6 | at /usr/lib/node_modules/pm2/lib/ProcessContainer.js:297:23 2|app_es6 | at wrapper (/usr/lib/node_modules/pm2/node_modules/async/internal/once.js:12:16) 2|app_es6 | at next (/usr/lib/node_modules/pm2/node_modules/async/waterfall.js:96:20) 2|app_es6 | at /usr/lib/node_modules/pm2/node_modules/async/internal/onlyOnce.js:12:16 2|app_es6 | at WriteStream.&lt;anonymous&gt; (/usr/lib/node_modules/pm2/lib/Utility.js:186:13) 2|app_es6 | at WriteStream.emit (events.js:210:5) 2|app_es6 | at internal/fs/streams.js:299:10</code> </pre> <br><p> ä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸Šï¼Œ <code>pm2</code>ä¸èƒ½è¿è¡Œæœªç»ES6æ¨¡å—ç¼–è¯‘çš„è„šæœ¬ã€‚ å…³äºæ­¤ä¸»é¢˜çš„æœ€æ–°ä¸€<a href="https://github.com/Unitech/pm2/issues/4540">æœŸ</a>äº2019å¹´12æœˆ5æ—¥åˆ›å»ºï¼ˆå¤§çº¦ä¸€ä¸ªæœˆå‰ï¼‰ã€‚ </p><br><h1 id="forever"> æ°¸è¿œ </h1><br><p> åœ¨<a href="https://www.npmtrends.com/forever-vs-pm2">pm2</a> ï¼ˆ <a href="https://www.npmtrends.com/forever-vs-pm2">npmtrends</a> ï¼‰ä¹‹åï¼Œ <code>forever</code>æ˜¯ç¬¬äºŒå—æ¬¢è¿çš„æµç¨‹ç®¡ç†å™¨ã€‚ è¿™æ˜¯ä¸€ä¸ªè¾ƒæ—§çš„é¡¹ç›®ï¼ˆä»2010å¹´å¼€å§‹äº<code>pm2</code>äº2013å¹´å¯åŠ¨ï¼‰ï¼Œä½†ä¸<code>pm2</code> ï¼Œå®ƒå¯¹åŠŸèƒ½çš„å…³æ³¨èŒƒå›´æ›´çª„ã€‚  <code>forever</code> â€œå˜å°–é”â€ï¼Œä»¥ä¸æ–­ç»´æŠ¤è¿‡ç¨‹ï¼Œè€Œæ— éœ€ä»»ä½•é¢å¤–çš„<code>pm2</code> ï¼Œå…¶å½¢å¼ä¸ºè´Ÿè½½å¹³è¡¡å’Œç›‘è§†æ‰€ä½¿ç”¨çš„èµ„æºã€‚ ä»<a href="https://github.com/foreversd/forever/commits/master">æäº¤çš„é¢‘ç‡</a>æ¥çœ‹<a href="https://github.com/foreversd/forever/commits/master">ï¼Œè¯¥</a>é¡¹ç›®å¤„äºç¨³å®šçŠ¶æ€ï¼ˆæ´»åŠ¨å¼€å‘é˜¶æ®µå·²ç»è¿‡å»ï¼‰ï¼Œæ‚¨ä¸èƒ½æœŸæœ›å®ƒä¼šæœ‰ä»»ä½•æ–°åŠŸèƒ½ã€‚ æˆ‘æ²¡æœ‰æ‰¾åˆ°<code>forever</code>å¯åŠ¨æ—¶ä»å‘½ä»¤è¡Œå°†å‚æ•°ä¼ é€’ç»™<code>nodejs</code>çš„æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œåˆ™æœ‰è¿™æ ·çš„å¯èƒ½æ€§ï¼š </p><br><pre> <code class="plaintext hljs">{ "uid": "app_es6", "max": 5, "spinSleepTime": 1000, "minUptime": 1000, "append": true, "watch": false, "script": "src/app_es6.mjs", "command": "node --experimental-modules" }</code> </pre> <br><p> åœ¨æ­¤ç‰ˆæœ¬ä¸­è¿è¡Œåº”ç”¨ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="plaintext hljs">$ forever start forever.es6.json ... $ forever list info: Forever processes running data: uid command script forever pid id logfile uptime data: [0] app_es6 node --experimental-modules src/app_es6.mjs 3972 3979 /home/ubuntu/.forever/app_es6.log 0:0:0:3.354</code> </pre> <br><p> ä»¥ä¸‹æ˜¯æµç¨‹æœ¬èº«ï¼š </p><br><pre> <code class="plaintext hljs">$ ps -Af | grep es6 ubuntu 3972 1 0 12:01 ? 00:00:00 /usr/bin/node /usr/lib/node_modules/forever/bin/monitor src/app_es6.mjs ubuntu 3979 3972 0 12:01 ? 00:00:00 node --experimental-modules /home/ubuntu/sof_es6_pm/src/app_es6.mjs</code> </pre> <br><p> å½“è¯¥è¿‡ç¨‹è¢«â€œ <code>PID 3979</code> â€ï¼ˆ <code>PID 3979</code> ï¼‰æ—¶ï¼Œç®¡ç†å™¨ä¼šå®šæœŸå¼•å‘ä¸€ä¸ªæ–°çš„è¿‡ç¨‹ï¼ˆ <code>PID 4013</code> ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">$ kill -s SIGKILL 3979 ubuntu@vsf:~/sof_es6_pm$ ps -Af | grep es6 ubuntu 3972 1 0 12:01 ? 00:00:00 /usr/bin/node /usr/lib/node_modules/forever/bin/monitor src/app_es6.mjs ubuntu 4013 3972 4 12:10 ? 00:00:00 node --experimental-modules /home/ubuntu/sof_es6_pm/src/app_es6.mjs</code> </pre> <br><p>  <code>forever</code>ä¸ä¼šå¯¹å¯åŠ¨ä½¿ç”¨ES6æ¨¡å—çš„åº”ç”¨ç¨‹åºèµ·åˆ°å‡ºè‰²çš„ä½œç”¨ï¼Œä½†é—®é¢˜æ˜¯ï¼Œå¦‚æœå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿè‡ªå·±çš„èµ„æºæ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¦åœ¨Linuxç³»ç»Ÿä¸Š<code>forever</code>ä½¿ç”¨å‘¢ï¼Ÿ </p><br><h1 id="systemd"> ç³»ç»Ÿçš„ </h1><br><p>  <a href="https://habr.com/ru/company/southbridge/blog/255845/">systemd</a>å…è®¸æ‚¨åœ¨linuxç¯å¢ƒä¸­åˆ›å»ºæœåŠ¡å¹¶æ§åˆ¶å®ƒä»¬çš„å¯åŠ¨ï¼ŒåŒ…æ‹¬åœ¨çªç„¶å´©æºƒçš„æƒ…å†µä¸‹ã€‚ åˆ›å»ºå¸¦æœ‰æœåŠ¡æè¿°ï¼ˆ <code>./app_es6.service</code> ï¼‰çš„å•ä½æ–‡ä»¶å°±è¶³å¤Ÿäº†ï¼š </p><br><pre> <code class="plaintext hljs">[Unit] Description=Simple web server with ES6 modules. After=network.target [Service] Type=simple Restart=always PIDFile=/run/app_es6.pid WorkingDirectory=/home/ubuntu/sof_es6_pm ExecStart=/usr/bin/nodejs --experimental-modules /home/ubuntu/sof_es6_pm/src/app_es6.mjs [Install] WantedBy=multi-user.target</code> </pre> <br><p> å¹¶å°†å…¶é“¾æ¥åˆ°<code>/etc/systemd/system</code>ç›®å½•ï¼ˆè·¯å¾„åœ¨å•ä½æ–‡ä»¶ä¸­å¿…é¡»æ˜¯ç»å¯¹çš„ï¼‰ã€‚ åœ¨çªç„¶åœæ­¢çš„æƒ…å†µä¸‹é‡æ–°å¯åŠ¨æœåŠ¡çš„é€‰é¡¹æ˜¯ï¼š </p><br><pre> <code class="plaintext hljs">Restart=always</code> </pre> <br><p> æœåŠ¡å¯åŠ¨å¦‚ä¸‹ï¼š </p><br><pre> <code class="plaintext hljs"># systemctl start app_es6.service # systemctl status app_es6.service â— app_es6.service - Simple web server with ES6 modules. Loaded: loaded (/home/ubuntu/sof_es6_pm/app_es6.service; linked; vendor preset: enabled) Active: active (running) since Thu 2020-01-02 11:09:42 UTC; 9s ago Main PID: 2184 (nodejs) Tasks: 11 (limit: 4662) CGroup: /system.slice/app_es6.service â””â”€2184 /usr/bin/nodejs --experimental-modules /home/ubuntu/sof_es6_pm/src/app_es6.mjs Jan 02 11:09:42 vsf systemd[1]: Started Simple web server with ES6 modules.. Jan 02 11:09:42 vsf nodejs[2184]: (node:2184) ExperimentalWarning: The ESM module loader is experimental. Jan 02 11:09:42 vsf nodejs[2184]: ES6 app listening on port 3000!</code> </pre> <br><p> å½“è¿›ç¨‹è¢«â€œæ€æ­»â€ï¼ˆ <code>PID 2184</code> ï¼‰æ—¶ï¼Œ <code>systemd</code>å®šæœŸå¼•å‘ä¸€ä¸ªæ–°çš„è¿‡ç¨‹ï¼ˆ <code>PID 2233</code> ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs"># ps -Af | grep app_es6 root 2184 1 0 11:09 ? 00:00:00 /usr/bin/nodejs --experimental-modules /home/ubuntu/sof_es6_pm/src/app_es6.mjs # kill -s SIGKILL 2184 # ps -Af | grep app_es6 root 2233 1 3 11:10 ? 00:00:00 /usr/bin/nodejs --experimental-modules /home/ubuntu/sof_es6_pm/src/app_es6.mjs</code> </pre> <br><p> ä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>systemd</code>ä¸<code>forever</code> ï¼Œä½†åœ¨æ›´åŸºæœ¬çš„å±‚é¢ä¸Šã€‚ </p><br><h1 id="strongloop"> å¼ºå¾ªç¯ </h1><br><p> åœ¨æŸ¥çœ‹æµç¨‹ç®¡ç†å™¨çš„å®æ–½é€‰é¡¹æ—¶ï¼Œ <a href="https://strong-pm.io/">StrongLoop</a>ç»å¸¸ä¼šå¼¹å‡ºã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®ä¼¼ä¹å·²ç»åœæ­¢å¼€å‘äº†ï¼ˆ <a href="https://www.npmjs.com/package/strongloop">3å¹´ä¹‹å‰</a>å‘å¸ƒäº†æœ€æ–°ç‰ˆæœ¬6.0.3ï¼‰ã€‚ æˆ‘ä»€è‡³æ— æ³•é€šè¿‡<code>npm</code>åœ¨Ubuntu 18.04ä¸Šå®‰è£…å®ƒï¼š </p><br><pre> <code class="plaintext hljs"># npm install -g strongloop npm WARN deprecated swagger-ui@2.2.10: No longer maintained, please upgrade to swagger-ui@3. ... npm ERR! A complete log of this run can be found in: npm ERR! /root/.npm/_logs/2020-01-02T11_25_15_473Z-debug.log</code> </pre> <br><p> å°½ç®¡æœ‰å¤§é‡å…³äºä¸æ¨èä½¿ç”¨çš„ä¾èµ–é¡¹å’Œå®‰è£…é”™è¯¯çš„æ¶ˆæ¯ï¼Œä½†ä»é€šè¿‡<code>yarn</code>å®‰è£…<code>yarn</code>è½¯ä»¶åŒ…ï¼Œä½†æ˜¯ï¼Œæˆ‘æ‹’ç»ç ”ç©¶StronLoopã€‚ </p><br><h1 id="instrumenty-razrabotchika"> å¼€å‘äººå‘˜å·¥å…· </h1><br><p> ç»å¸¸åœ¨<a href="https://www.npmjs.com/package/nodemon">pm2</a>æ—è¾¹ï¼Œå¹¶ä¸”<code>forever</code> <a href="https://www.npmtrends.com/pm2-vs-nodemon-vs-watch-vs-onchange">éƒ½æœ‰</a>è¯¸å¦‚<a href="https://www.npmjs.com/package/nodemon">nodemon</a> ï¼Œ <a href="https://www.npmjs.com/package/watch">watch</a>å’Œ<a href="https://www.npmjs.com/package/onchange">onchangeä¹‹</a>ç±»çš„è½¯ä»¶åŒ…ã€‚ è¿™äº›å·¥å…·ä¸æ˜¯è¿‡ç¨‹ç®¡ç†å™¨ï¼Œä½†æ˜¯å®ƒä»¬ä½¿æ‚¨å¯ä»¥ç›‘è§†æ–‡ä»¶ä¸­çš„æ›´æ”¹å¹¶æ‰§è¡Œé™„åŠ åˆ°è¿™äº›æ›´æ”¹çš„å‘½ä»¤ï¼ˆåŒ…æ‹¬é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼‰ã€‚ </p><br><h1 id="rezyume"> æ€»ç»“ </h1><br><p>  <code>pm2</code>ç±»çš„æµç¨‹ç®¡ç†å™¨åœ¨æœåŠ¡å™¨ç«¯JSä¸–ç•Œä¸­æ˜¯ä¸€é¡¹éå¸¸æœ‰ç”¨çš„æœåŠ¡ã€‚ ä½†æ˜¯ï¼Œä¸å¹¸çš„æ˜¯ï¼Œ <code>pm2</code>æœ¬èº«ä¸å…è®¸è¿è¡Œç°ä»£çš„<code>nodejs</code>åº”ç”¨ç¨‹åºï¼ˆå°¤å…¶æ˜¯ES6æ¨¡å—ï¼‰ã€‚ ç”±äºæˆ‘çœŸçš„ä¸å–œæ¬¢è½¬è¯‘ï¼Œå› æ­¤<code>nodejs</code>å¯¹æˆ‘è€Œè¨€ï¼Œ <code>nodejs</code>ä¸­<code>nodejs</code>æµç¨‹ç®¡ç†å™¨æ˜¯ä¼ ç»Ÿçš„<code>systemd</code> ï¼ˆæˆ–å…¶<a href="http://supervisord.org/index.html">æ›¿ä»£å“</a> ï¼‰ã€‚ ä½†æ˜¯ï¼Œåªè¦<code>pm2</code>å¯ä»¥æ”¯æŒå¸¦æœ‰ES6æ¨¡å—çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘å°†å¾ˆé«˜å…´ä½¿ç”¨<code>pm2</code> ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482370/">https://habr.com/ru/post/zh-CN482370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482354/index.html">ConfigureAwaitï¼šå¸¸è§é—®é¢˜</a></li>
<li><a href="../zh-CN482356/index.html">ä»å¸¸è§„Windowsç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨æ²¡æœ‰èµ„æºç®¡ç†å™¨çš„æƒ…å†µä¸‹ä½¿ç”¨Windows Server</a></li>
<li><a href="../zh-CN482358/index.html">æƒŠæ…Œå¦‚ä½•åœ¨Rustä¸­å‘æŒ¥ä½œç”¨</a></li>
<li><a href="../zh-CN482362/index.html">å‡ ä¹æ— æ”¿åºœçŠ¶æ€ï¼šFidonetçš„ç®€è¦å†å²ï¼Œè¯¥é¡¹ç›®ä¸å…³å¿ƒé€šè¿‡äº’è”ç½‘è·èƒœ</a></li>
<li><a href="../zh-CN482366/index.html">æœºå™¨äººä¸“å®¶å¯¹ç‰¹æ–¯æ‹‰è‡ªåŠ¨é©¾é©¶ä»ªæœ‰ä½•çœ‹æ³•</a></li>
<li><a href="../zh-CN482372/index.html">åœ¨Hyper-Vä¸­ä¸ºArch Linux guestè™šæ‹Ÿæœºå¯ç”¨å¢å¼ºçš„ä¼šè¯æ¨¡å¼</a></li>
<li><a href="../zh-CN482378/index.html">Wacomçš„ç®€å²ï¼šå›¾å½¢è¾“å…¥æ¿æŠ€æœ¯å¦‚ä½•åº”ç”¨â€‹â€‹äºç”µå­é˜…è¯»å™¨</a></li>
<li><a href="../zh-CN482382/index.html">ç¿»è¯‘çš„å››ä¸ªåŸåˆ™ï¼Œæˆ–è€…ä¸€ä¸ªäººä¸ä¼šä»¥ä»€ä¹ˆæ–¹å¼å±ˆæœäºæœºå™¨ç¿»è¯‘ï¼Ÿ</a></li>
<li><a href="../zh-CN482384/index.html">æˆ‘çš„æœªå®ç°é¡¹ç›®ã€‚ 200ä¸ªMikroTikè·¯ç”±å™¨ç½‘ç»œ</a></li>
<li><a href="../zh-CN482386/index.html">Visual Studio for Macï¼šé€šè¿‡é”®ç›˜ç»‘å®šæ§åˆ¶IDE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>