<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔹 🚡 🏂🏽 如何使PHP7中的扩展比“ hello，world”更困难，并且不致于眼花red乱。 第一部分 🧕🏽 🕓 ⏏️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="怎么了 
 我写这篇文章是为了使我总共花了至少一年的时间，读者可以走几个小时。 正如我的亲身经验所表明的那样，仅使用C语言进行编程要比对PHP工作进行认真的扩展要容易一些。 在这里，我将使用实现前缀树的libtrie库示例（最好称为trie）来尽可能多地告诉您如何进行扩展。 我将在新安装的Lubun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何使PHP7中的扩展比“ hello，world”更困难，并且不致于眼花red乱。 第一部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428626/"><h2> 怎么了 </h2><br> 我写这篇文章是为了使我总共花了至少一年的时间，读者可以走几个小时。 正如我的亲身经验所表明的那样，仅使用C语言进行编程要比对PHP工作进行认真的扩展要容易一些。 在这里，我将使用实现前缀树的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">libtrie</a>库示例（最好称为trie）来尽可能多地告诉您如何进行扩展。 我将在新安装的Lubuntu 18.04系统上编写并同时执行所描述的操作。 <br><br> 让我们开始吧。 <br><a name="habracut"></a><br><h2> 软件安装 </h2><br><h4>  p </h4><br><ol><li> 首先，我们放入php7.2-dev软件包，其中包含构建扩展所需的phpize脚本。 另外，我们将需要一个工作版本的php，在该版本上我们将检查我们的扩展名。 安装此软件包将拉出许多相关的软件包，我们将提供的所有内容放入其中。 <br><br><pre><code class="bash hljs">sudo apt install php7.2-dev</code> </pre> <br></li><li> 我们转到php.net网站，转到“下载”部分，并拉出指向带有最新稳定版本php（现在为7.2.11）的档案的链接。 <br> 下载php源档案： <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp &amp;&amp; wget http://it2.php.net/get/php-7.2.11.tar.gz/from/this/mirror -O php7.tar.gz</code> </pre><br></li><li> 现在将存档解压缩到我们自己： <br><br><pre> <code class="bash hljs">sudo tar -xvf php7.tar.gz -C /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/src</code> </pre><br></li></ol><br><h4> 代码编辑器 </h4><br> 我通常使用2个代码编辑器。 简单快速的geany和漂亮的书呆子，但JetBrains提供了非常先进的提示。  Geany可从标准芜菁Ubuntu安装。 <br><br><pre> <code class="bash hljs">sudo apt install geany</code> </pre><br> 从JetBrains官方网站下载Clion： <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Downloads &amp;&amp; wget https://download.jetbrains.com/cpp/CLion-2018.2.5.tar.gz -O clion.tar.gz</code> </pre><br><pre> <code class="bash hljs">sudo tar -xvf clion.tar.gz -C /usr/share</code> </pre><br> 我们建立一个链接，以方便从控制台运行clion。 <br><br><pre> <code class="bash hljs">sudo ln -s /usr/share/clion-2018.2.5/bin/clion.sh /usr/bin/clion</code> </pre><br> 首次启动后，clion本身将通过LXpanel Shell菜单为其自身创建快捷方式，但这是您首次需要手动运行它。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># clion</span></span></code> </pre><br><h2> 创建扩展 </h2><br> 在这里，我们至少有3个选择： <br><br><ol><li> 从我们下载的php来源中获取原始标准光盘。 </li><li> 用特殊的ext_skel脚本稍微看了标准光盘 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从这里</a>获取优质的极简主义光盘。 </li></ol><br> 我最喜欢第三个选项，但是在失败的情况下，我将使用第二个选项以最大程度地减少可能被误解的地方。 尽管选择开发人员的空白仍然是一种乐趣：-) <br><br><ol><li> 让我们转到带有标准php扩展名的目录。 <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/src/php-7.2.11/ext</code> </pre><br> 除了脚本的名称之外，您还可以通过原始文件指定一些扩展参数。 所有这一切都不可能完成。 我将手工做所有事情，但我将展示原型的工作原理。 我们做特里，所以让我们命名扩展libtrie。 要在/ usr / local / src目录中工作，您需要管理员权限，以免最终写sudo，我将包括具有提升权限的bash。 <br><br><pre> <code class="bash hljs">sudo bash</code> </pre><br></li><li> 在这里，我将仅设置所创建扩展将实现的1个函数的参数。 这只是一个演示功能，以演示如何完成此操作。 <br><br> 我们将完全模拟标准功能 <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span> array_fill ( int $start_index , int $num , mixed $value )</code> </pre><br>  proto文件中的语法非常简单，只需要指定函数的名称即可。 我会写一些更多的东西，使它看起来更有用。 <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> my_array_fill \( int start_index , int num , mixed value \) &gt;&gt; libtrie.proto</code> </pre><br></li><li> 现在运行ext_skel脚本，为其指定扩展名和我们创建的原型文件。 <br><br><pre> <code class="bash hljs">./ext_skel --extname=libtrie --proto=./libtrie.proto</code> </pre><br></li><li> 我们已经创建了带有扩展名的目录。 让我们开始吧。 <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> libtrie</code> </pre><br></li></ol><br><h4> 文件结构与汇编原理 </h4><br><div class="spoiler">  <b class="spoiler_title">档案结构</b> <div class="spoiler_text"><pre> <code class="bash hljs">config.m4 -           phpize   ./configure,       makefile. CREDITS -  ,     ,    libtrie.c -      php_libtrie.h -     config.w32 -        windows EXPERIMENTAL -  .    ,    . libtrie.php -  php      . tests -  </code> </pre><br></div></div><br> 要成功构建扩展，只需要3个文件。 在上面提到的扩展的极简光盘中，只有3个文件。 <br><br><pre> <code class="bash hljs">config.m4 php_libtrie.h libtrie.c</code> </pre><br> 我不喜欢php中接受的标准命名，我喜欢标头文件和带有程序主体的文件命名相同。 因此重命名 <br> <code>libtrie.c</code> <br> 在 <br> <code>php_libtrie.c</code> <br> <br><pre> <code class="bash hljs">mv libtrie.c php_libtrie.c</code> </pre><br><h4> 编辑config.m4 </h4><br> 默认的config.m4文件实际上挤满了内容，其中的大量内容令人困惑。 如我所说，此文件是形成配置脚本所必需的。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关此内容的更多信息。 <br><br><pre> <code class="bash hljs">geany config.m4 &amp;</code> </pre><br> 我们只剩下这个： <br><br><pre> <code class="bash hljs">PHP_ARG_ENABLE(libtrie, whether to <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> libtrie support, [ --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libtrie Enable libtrie support]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PHP_LIBTRIE</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"no"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment">#    -    # PHP_ADD_INCLUDE() #   PHP_NEW_EXTENSION(libtrie, php_libtrie.c, $ext_shared) # PHP_NEW_EXTENSION(libtrie, php_libtrie.c, $ext_shared,, -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1) fi</span></span></code> </pre><br><img src="https://habrastorage.org/webt/mb/fz/y_/mbfzy_te6ilmvy8oelvaf91_g20.png"><br><br> 第一个宏使您能够在运行生成的配置脚本时启用和禁用我们的扩展。 <br><br> 第二个块是最重要的，它确定哪些文件将作为扩展的一部分进行编译，扩展是通过.so文件动态连接还是扩展是静态的，以及是否将在php构建过程中进行集成。 我们的将充满活力。 <br> 保存文件。 <br><br> 我们将文件复制到用户目录，以使其在root模式下不起作用。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    exit</span></span></code> </pre><br> 复制： <br><br><pre> <code class="bash hljs">cp /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/src/php-7.2.11/ext/libtrie ~/Documents/ -r</code> </pre><br><h3> 演示功能 </h3><br> 让我提醒您，我们将完全模拟array_fill（）。 我将通过clion进行研究，但是本指南可以在任何编辑器中完成。  Clion很好，因为它允许您自动执行基本语法检查，并且还支持通过ctrl +单击快速浏览文件或函数。 为了使此类转换在我们的扩展程序中起作用，您将必须配置CMakeLists.txt文件 <br><br> 为了使clion正常工作，您将需要安装cmake构建系统，该系统将安装一堆相关软件包。 使用命令安装所有这些： <br><br><pre> <code class="bash hljs">sudo apt install cmake</code> </pre><br><h4> 配置cmake </h4><br> 我们以扩展形式打开我们的目录。 通过单击屏幕顶部的根目录名称，通过上下文菜单创建具有以下内容的CMakeLists.txt文件： <br><br><pre> <code class="bash hljs">cmake_minimum_required(VERSION 3.12) project(php-ext-libtrie C) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(CMAKE_C_STANDARD 11) <span class="hljs-comment"><span class="hljs-comment">#   phproot,       php set(phproot /usr/local/src/php-7.2.11/) #   ,      #      clion       php include_directories(${phproot}) include_directories(${phproot}TSRM/) include_directories(${phproot}main/) include_directories(${phproot}Zend/) #    clion          add_executable(php-ext-libtrie php_libtrie.c)</span></span></code> </pre><br><img src="https://habrastorage.org/webt/ag/nc/qj/agncqji78vvzfcbyevpwi-9gszy.png"><br><br> 也许有人知道如何缩短此文件的长度，以便clion开始索引项目文件。 我没有找到更短的方法。 如果有人知道，请在评论中写。 <br><br><h4> 演示功能代码 </h4><br> 用扩展名<code>php_libtrie.c</code>的主体打开文件，然后 <br> 删除所有评论，以免混淆我们。 <br><br><img src="https://habrastorage.org/webt/8x/sj/c2/8xsjc2q571audrqfbliblnct4-8.png"><br><br><img src="https://habrastorage.org/webt/vu/ql/mu/vuqlmu48nqu2fkkasdosjsma8zw.png"><br><br>  Clion检查代码中使用的所有函数和宏是否都已声明，如果没有，则抛出错误。 显然，PHP开发人员不使用clion，否则他们可能会对此做一些事情。 为了防止这些错误在扩展程序中发生，我们将向我们提供缺少的头文件。 <br><br> 为了简化一切，我这样做： <br> 我将所有包含头文件的头文件从<code>php_libtrie.c</code>文件传输到<code>php_libtrie.h</code> ，第一个文件中只有一个条目： <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"php_libtrie.h"</span></span></span></span></code> </pre><br><img src="https://habrastorage.org/webt/ft/fe/yg/ftfeygfd1fznk5jxaccj8i9mt8k.png"><br><br>  <code>php_libtrie.h</code>文件将包含所有其他必要的包含。 <br><br><img src="https://habrastorage.org/webt/_v/_4/jg/_v_4jgpsak4g3aa7clykblcuq8y.png"><br><br><div class="spoiler">  <b class="spoiler_title">我的头文件的内容</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#ifndef</span></span> <span class="hljs-type"><span class="hljs-type">PHP_LIBTRIE_H</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">PHP_LIBTRIE_H</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#ifdef</span></span> <span class="hljs-type"><span class="hljs-type">HAVE_CONFIG_H</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"config.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;stdarg.h&gt; //   va_start() <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;inttypes.h&gt; //    //  <span class="hljs-symbol"><span class="hljs-symbol">#if</span></span> defined(__GNUC__) &amp;&amp; __GNUC__ &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span> # define <span class="hljs-type"><span class="hljs-type">ZEND_API</span></span> __attribute__ ((visibility(<span class="hljs-comment"><span class="hljs-comment">"default"</span></span>))) # define <span class="hljs-type"><span class="hljs-type">ZEND_DLEXPORT</span></span> __attribute__ ((visibility(<span class="hljs-comment"><span class="hljs-comment">"default"</span></span>))) <span class="hljs-symbol"><span class="hljs-symbol">#else</span></span> # define <span class="hljs-type"><span class="hljs-type">ZEND_API</span></span> # define <span class="hljs-type"><span class="hljs-type">ZEND_DLEXPORT</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> # define <span class="hljs-type"><span class="hljs-type">SIZEOF_SIZE_T</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> //   <span class="hljs-type"><span class="hljs-type">ZVAL_COPY_VALUE</span></span>() <span class="hljs-symbol"><span class="hljs-symbol">#ifndef</span></span> <span class="hljs-type"><span class="hljs-type">ZEND_DEBUG</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">ZEND_DEBUG</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span> //  ,      <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"php.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"php_ini.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"zend.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"zend_types.h"</span></span> //<span class="hljs-type"><span class="hljs-type">ZVAL_COPY_VALUE</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"ext/standard/info.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"zend_API.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"zend_modules.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"zend_string.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"spprintf.h"</span></span> extern zend_module_entry libtrie_module_entry; ...</code> </pre><br></div></div><br> 如果一切操作正确，则离子检测仪的右上角将显示黄色或绿色方块，这意味着没有严重错误。 <br><br><img src="https://habrastorage.org/webt/pt/gm/sa/ptgmsa8nlhkn1gs_ykyc8igavao.png"><br><br><h4> 理论上的一点偏离 </h4><br> 为了使扩展正常工作，需要执行以下两项操作： <br><br><ol><li> 您需要初始化特殊结构zend_module_entry，其中包含以下内容： <br><br><pre> <code class="hljs ruby">zend_module_entry libtrie_module_entry = { STANDARD_MODULE_HEADER, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-string"><span class="hljs-string">"libtrie"</span></span>, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  libtrie_functions, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     PHP_MINIT(libtrie), <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>,     PHP_MSHUTDOWN(libtrie), <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   PHP_RINIT(libtrie), <span class="hljs-regexp"><span class="hljs-regexp">/* Replace with NULL if there's nothing to do at request start */</span></span> PHP_RSHUTDOWN(libtrie), <span class="hljs-regexp"><span class="hljs-regexp">/* Replace with NULL if there's nothing to do at request end */</span></span> PHP_MINFO(libtrie), <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,    php  phpinfo() PHP_LIBTRIE_VERSION, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,     STANDARD_MODULE_PROPERTIES /<span class="hljs-regexp"><span class="hljs-regexp">/    };</span></span></code> </pre><br></li><li> 初始化包含我们扩展的所有功能的同一数组。 <br><br> 在这里，通过特殊的宏包装器PHP_FE（），设置了扩展中所有函数的名称。 通常，宏在PHP中非常活跃地使用，有很多仅引用其他宏的宏，而反之则更远。 您必须习惯它。 您可以通过ctrl +单击来确定是否通过了宏。 在这里，clion是必不可少的。 <br><br> 还记得原始文件吗？ 我们在那里设置了1个函数my_array_fill（）。 所以现在我们在这里有3个元素： <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> zend_function_entry libtrie_functions[] = { PHP_FE(confirm_libtrie_compiled, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* For testing, remove later. */</span></span> PHP_FE(my_array_fill, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) PHP_FE_END <span class="hljs-comment"><span class="hljs-comment">/* Must be the last line in libtrie_functions[] */</span></span> };</code> </pre><br> 第一行是一个测试函数，它将显示扩展名有效，第二行是我们的函数，第三行是一个特殊的宏，它应该是此数组中的最后一个。 <br></li></ol><br> 找到我们的功能： <br><br><pre> <code class="hljs lisp">PHP_FUNCTION(<span class="hljs-name"><span class="hljs-name">my_array_fill</span></span>)</code> </pre><br> 如您所见，它也是通过宏初始化的。 事实是，所有php函数都不会在C内部返回任何内容（确切地说，返回void），并且不能更改其参数。 在某个地方甚至更方便。 <br><br> 如果您查看文件结构（左侧窗口的一部分），则会在此处列出文件的所有功能，但以在预编译宏后的形式显示它们。 屏幕快照显示我们的函数my_array_fill实际上将是zif_my_array_fill。 <br><br><img src="https://habrastorage.org/webt/ur/cl/m4/urclm4yrxdayv7heohr0puutrm8.png"><br><br> 从php的参数到我们的C函数，我们使用了一个宏。 可以在文件中找到有关此宏的更多详细信息： <br><br><pre> <code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/src/php-7.2.11/README.PARAMETER_PARSING_API</code> </pre><br> 以下是我们的模拟功能代码，并附有详细说明。 <br><br><div class="spoiler">  <b class="spoiler_title">代号</b> <div class="spoiler_text"><pre> <code class="hljs ruby">PHP_FUNCTION(my_array_fill) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,     /<span class="hljs-regexp"><span class="hljs-regexp">/    2 : /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ zend_execute_data *execute_data, zval *return_value /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     ,      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/zend_long  int64_t  x64   int32_t  x86  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      zend_long zend_long start_index; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/1  , zend_long num; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/2   zval *value; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   mixed ,   zval,      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    ,          if (zend_parse_parameters(ZEND_NUM_ARGS(), "llz", &amp;start_index, &amp;num, &amp;value) == FAILURE) { /</span></span>*     *    RETURN<span class="hljs-number"><span class="hljs-number">_</span></span>    * return_value     *<span class="hljs-regexp"><span class="hljs-regexp">/ RETURN_FALSE; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,   -    if (num &lt;= 0) { php_error_docref(NULL TSRMLS_CC, E_WARNING, "argument 2 must be &gt; 0"); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     RETURN_FALSE; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/zval *return_value  ,        /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       zval,     ,  -  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   zend_long  unsigned int32. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      + -. ..   1,    3,     4  array_init_size(return_value, (uint32_t)(start_index + num)); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,   ,   for(zend_long i = start_index, last = start_index + num; i &lt; last; ++i) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   zval       add_index_zval(return_value, i, value); } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,      return_value return; }</span></span></code> </pre><br></div></div><br><br><br><h2> 构建和测试扩展 </h2><br> 首先，运行phpize，这将使我们配置文件。 <br><br><pre> <code class="bash hljs">phpize</code> </pre><br> 现在运行./configure，它将生成makefile。 <br><br><pre> <code class="bash hljs">./configure</code> </pre><br> 最后，运行make，它将收集我们的扩展名。 <br><br><pre> <code class="bash hljs">make</code> </pre><br> 让我们检查一下我们做了什么。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    php,       # modules.  -a  php      php -d extension=modules/libtrie.so -a</span></span></code> </pre><br> 我们输入php控制台： <br><br><pre> <code class="php hljs">print_r(my_array_fill(<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"hello, baby!"</span></span>));</code> </pre><br> 享受结果。 <br><br><img src="https://habrastorage.org/webt/gn/sx/cy/gnsxcy1ihjtn6tgm7mpqjsz9hl4.png"><br><br> 有人问，特里在哪里？ 关于实现trie工作的函数，我将在第二部分中编写。 <br><br>  <b>请继续关注。</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN428626/">https://habr.com/ru/post/zh-CN428626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN428612/index.html">JavaScript中的高阶函数：这是什么？</a></li>
<li><a href="../zh-CN428614/index.html">星期五 程序员的狂欢4.2</a></li>
<li><a href="../zh-CN428616/index.html">使用Google Apps脚本将XLS文件转换为Google Spreadsheet</a></li>
<li><a href="../zh-CN428620/index.html">如何创建Roguelike</a></li>
<li><a href="../zh-CN428624/index.html">Jeffrey Richter，Pavel Yosifovich，Greg Young和所有人。 DotNext 2018莫斯科的硬核和建筑</a></li>
<li><a href="../zh-CN428628/index.html">使用抽象的JavaScript语法树</a></li>
<li><a href="../zh-CN428630/index.html">不，到2033年，比特币不会破坏我们的气候。</a></li>
<li><a href="../zh-CN428632/index.html">在React中处理拦截器</a></li>
<li><a href="../zh-CN428634/index.html">移植Quake3</a></li>
<li><a href="../zh-CN428636/index.html">Roskomnadzor将向Google处以罚款</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>