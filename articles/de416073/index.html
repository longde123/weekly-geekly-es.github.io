<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🎓 📨 🌑 Ein einfacher Kryptowährungs-Handelsbot 🧘🏾 ♏️ 🛌🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Heute werden wir unseren ersten Kampfhandelsroboter für das Spielen an der Börse schreiben. Kryptoaustausch. Warum Kryptowährungsaus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ein einfacher Kryptowährungs-Handelsbot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416073/"><p>  Hallo allerseits!  Heute werden wir unseren ersten Kampfhandelsroboter für das Spielen an der Börse schreiben.  Kryptoaustausch.  Warum Kryptowährungsaustausch? </p><br><p>  a) Hype-Thema; <br>  b) sie sind irgendwie einfacher. </p><br><p>  Zunächst möchte ich die Fans des Three Axes Casinos sofort warnen: Sie werden morgen kein Auto verdienen.  In diesem Artikel erfahren Sie mehr darüber, wie Sie mit dem Schreiben Ihrer Roboter beginnen, sodass der Algorithmus primitiv ist, aber funktioniert. </p><br><p>  Zweitens werden Sie verdienen.  Nur ein bisschen. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">C / f „Das Spiel für einen Herbst“ (2015)</b> <div class="spoiler_text"><blockquote>  - Dieser Geruch, was ist das?  Wie riecht es? <br>  - Köln? <br>  - Nein… <br>  - Chancen? <br>  - Nein.  Geld. <br>  - Oh ... alles ist klar <br>  - Der Geruch von Geld! <br>  - Ich verstehe. </blockquote></div></div><br><p> Für die Ungeduldigsten der gesamte Code auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Exmo-Exchange-Trade-Bot-Github</a> . </p><br><p>  <strong>Stufe 1: Austausch.</strong> </p><br><p>  Wir werden an der EXMO-Börse handeln.  Es gibt mehrere Gründe.  Der Austausch ist in der GUS beliebt, er ist russischsprachig und unterstützt die Eingabe von Rubeln. Er kann Paare zum Rubel bilden. </p><br><p>  Zu den Minuspunkten zählen der unbequeme Prozess der Einzahlung von Rubel, eine anständige Provision und wenige gehandelte Paare. </p><br><p>  Für uns ist die Hauptsache, dass es vorgefertigte Lösungen für die Arbeit mit ihrer API gibt.  Dies wird sicherlich unsere Arbeit erleichtern. </p><br><p>  Also fangen wir an. </p><br><p>  Natürlich müssen Sie sich an der Börse registrieren und etwas Geld einzahlen.  Zum Beispiel habe ich 5 Dollar beigesteuert. </p><br><p>  Weiter in Ihrem Konto erhalten Sie Schlüssel für den Zugriff auf die API. </p><br><p>  Ich werde den Client für NodeJS verwenden (Sie müssen also nodejs und npm installieren). </p><br><p>  Erstellen Sie auf Ihrem Computer einen neuen Ordner und eine Datei, in der sich unser Handelsroboter befindet (z. B. exmo / index.js), öffnen Sie die Konsole und treffen Sie die letzten Standardvorbereitungen. </p><br><p>  Wir gehen mit unserem Projekt in den Ordner und schreiben - npm init, drücken dann die Eingabetaste für alle Fragen. </p><br><p>  Als nächstes schreiben wir </p><br><pre><code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> exmo-api</code> </pre> <br><p>  Erstellen Sie während der Installation der Pakete eine weitere Datei, nennen Sie sie exmo.js und füllen Sie sie mit diesem Inhalt. </p><br><div class="spoiler">  <b class="spoiler_title">mit diesen Inhalten</b> <div class="spoiler_text"><pre> <code class="hljs lua">var CryptoJS = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"crypto-js"</span></span>) http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), querystring = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'querystring'</span></span>), request = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'request'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = { url: <span class="hljs-string"><span class="hljs-string">'https://api.exmo.me/v1/'</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CryptoJS.HmacSHA512(message, <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.secret).toString(CryptoJS.enc.hex); } exports.init_exmo = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cfg)</span></span></span></span> { <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.key = cfg.key; <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.secret = cfg.secret; <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.nonce = Math.<span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(new Date().getTime()*<span class="hljs-number"><span class="hljs-number">1000</span></span>); }; exports.api_query = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method_name, data, callback)</span></span></span></span>{ data.nonce = <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.nonce++; var post_data = querystring.stringify(data); var options = { url: <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.url + method_name, method: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, headers: { <span class="hljs-string"><span class="hljs-string">'Key'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.key, <span class="hljs-string"><span class="hljs-string">'Sign'</span></span>: sign(post_data) }, form:data }; request(options, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error, response, body)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">error</span></span> &amp;&amp; response.statusCode == <span class="hljs-number"><span class="hljs-number">200</span></span>) { callback(body); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ callback(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>); } }); }; exports.api_query2 = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method_name, data, callback)</span></span></span></span>{ data.nonce = <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.nonce++; var post_data = querystring.stringify(data); var post_options = { host: <span class="hljs-string"><span class="hljs-string">'api.exmo.me'</span></span>, port: <span class="hljs-string"><span class="hljs-string">'80'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/v1/'</span></span> + method_name, method: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, headers: { <span class="hljs-string"><span class="hljs-string">'Key'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.key, <span class="hljs-string"><span class="hljs-string">'Sign'</span></span>: sign(post_data), <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/x-www-form-urlencoded'</span></span>, <span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>: Buffer.byteLength(post_data) } }; var post_req = http.request(post_options, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(res)</span></span></span></span> { res.setEncoding(<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>); res.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { callback(chunk); }); }); post_req.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(post_data); post_req.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }; exports.test = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.key; };</code> </pre> </div></div><br><p>  Diese Datei enthält die Adresse der API, die Verbindung zusätzlicher Bibliotheken, die wir für die Arbeit mit der API benötigen, und die Hauptfunktion für Anforderungen an die API. </p><br><p>  Das ist alles, wir haben alles vorbereitet und jetzt können wir direkt damit beginnen, eine persönliche „Geldmaschine“ zu schaffen;) </p><br><p>  <strong>Stufe 2: Code</strong> </p><br><p>  Öffnen Sie unsere index.js und verbinden Sie die Datei exmo.js: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exmo = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"./exmo"</span></span>);</code> </pre> <br><p>  Gehen Sie als Nächstes zum Austausch in Ihrem persönlichen Konto zu dem Ort, an dem wir unsere Schlüssel für den Zugriff auf die API erstellt haben.  Wir kopieren sie und speichern sie in Variablen: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> apiKey = <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> apiSecret = <span class="hljs-string"><span class="hljs-string">' '</span></span>;</code> </pre> <br><p>  Erstellen Sie nun zwei Variablen: <br>  Währung1 ist WAS wir kaufen; <br>  Währung2 - Währung, für die wir kaufen. </p><br><p>  Ich möchte Bitcoins für Dollar kaufen: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currency1 = <span class="hljs-string"><span class="hljs-string">'BTC'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currency2 = <span class="hljs-string"><span class="hljs-string">'USD'</span></span>;</code> </pre> <br><p>  Als nächstes ein wichtiger Punkt - wir erstellen eine Variable mit einem Mindesteinsatzbetrag.  Die Börse erlaubt es nicht, weniger als diesen Betrag zu kaufen. </p><br><p>  Wir gehen zur Adresse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://api.exmo.com/v1/pair_settings/ und</a> suchen nach Ihrem Paar (für mich ist es BTC_USD) und schauen uns den ersten Parameter an - min_quantity - 0.001 </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currency1MinQuantity = <span class="hljs-number"><span class="hljs-number">0.001</span></span>;</code> </pre> <br><p>  Und noch ein paar Variablen: </p><br><p>  Die Anzahl der Minuten, nach denen eine nicht erfüllte Bestellung storniert wird </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> orderLifeTime = <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br><p>  Austauschprovision (0,002 = 0,2%) </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stockFee = <span class="hljs-number"><span class="hljs-number">0.002</span></span>;</code> </pre> <br><p>  Zeitraum (in Minuten) für die Berechnung des Durchschnittspreises (dies wird für unseren Algorithmus benötigt) </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> avgPricePeriod = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  der Betrag von Währung2, um Währung1 in einer einmaligen Transaktion zu kaufen (ich warf 5 $ - ich werde mit ihnen operieren) </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> canSpend = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre> <br><p>  die gewünschte Gewinnsumme aus jeder Transaktion (0,001 = 0,1%) </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> profit = <span class="hljs-number"><span class="hljs-number">0.001</span></span>;</code> </pre> <br><p>  Wenn die Austauschzeit vom Strom abweicht </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stockTimeOffset = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  Der Einfachheit halber kombinieren wir unser Paar durch _ </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentPair = currency1+<span class="hljs-string"><span class="hljs-string">'_'</span></span>+currency2;</code> </pre> <br><p>  Initialisieren Sie die Verbindung. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">exmo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.init_exmo</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">key</span></span>:apiKey, secret:apiSecret});</code> </pre> <br><p>  Für den Test können Sie Informationen über sich selbst anfordern: </p><br><pre> <code class="hljs pgsql">exmo.api_query("user_info", { }, result =&gt; console.log(result););</code> </pre> <br><p>  Gehen Sie zur Konsole und starten Sie </p><br><pre> <code class="hljs pgsql">node <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js</code> </pre> <br><p>  Wenn alles richtig gemacht ist, sehen Sie Informationen über Sie! </p><br><p>  Alles funktioniert und Sie können zum interessantesten Teil übergehen - der Funktion, die das Geld generiert. </p><br><p>  Also, ich habe oben bereits gesagt, dass unser Algorithmus dumm sein wird, jetzt werden Sie verstehen, wie viel) </p><br><p>  Der Trick besteht darin, die Historie der abgeschlossenen Transaktionen für einen beliebigen Zeitraum zu erfassen - wir haben die Variable avgPricePeriod dafür verantwortlich - und den Durchschnittspreis zu berechnen, für den Währung1 verkauft wurde.  Für diesen Durchschnittspreis geben wir unsere Bestellung auf. </p><br><p>  Also fangen wir an.  Wir schreiben unsere trade () Funktion </p><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trade</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{}</code> </pre> <br><p>  Zuerst erhalten wir eine Liste unserer offenen Bestellungen: </p><br><p>  1) Wir prüfen mit der API-Methode user_open_orders, ob wir offene Bestellungen für unser Paar haben.  Wenn es auch zum Verkauf gibt, </p><br><p>  dann warten wir nur darauf, dass sie erfüllt werden (manchmal bis zum Ende der Zeit).  Wenn es Bestellungen gibt, merken Sie sich diese einfach. </p><br><pre> <code class="hljs markdown">exmo.api<span class="hljs-emphasis"><span class="hljs-emphasis">_query("user_</span></span>open_orders", { }, result =&gt; { let res = JSON.parse(result); if(res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>] == undefined) console.log('  '); let buyOrders = [<span class="hljs-string"></span><span class="hljs-string"></span>]; for(let i in res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>]){ console.log(res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">i</span></span>]); if(res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">i</span></span>].type == 'sell'){ console.log(',    /    '); }else{ buyOrders.push(res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">i</span></span>]); } }</code> </pre> <br><p>  2) Wir prüfen, ob wir offene Bestellungen haben. </p><br><p>  Wir sortieren alle Bestellungen und erhalten mithilfe der <strong>order_trades-</strong> Methode einen Verlauf von ihnen, wobei <strong>wir</strong> die <strong>Bestell-</strong> ID dort übergeben. </p><br><p>  Es gibt 3 Möglichkeiten: </p><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buyOrders.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(let key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> buyOrders){ console.log(<span class="hljs-string"><span class="hljs-string">',     '</span></span>, buyOrders[<span class="hljs-type"><span class="hljs-type">key</span></span>][<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>]); exmo.api_query(<span class="hljs-string"><span class="hljs-string">'order_trades'</span></span>, {<span class="hljs-string"><span class="hljs-string">"order_id"</span></span>: buyOrders[<span class="hljs-type"><span class="hljs-type">key</span></span>][<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>]}, result =&gt; { let res = JSON.parse(result);</code> </pre> <br><p>  1) Wir können die notwendige Währung nicht ganz, sondern in Teilen aus Bestellungen von Verkäufern kaufen. <br>  Wenn wir also bereits zum gewünschten Preis gekauft haben, warten wir auf den Kauf des gesamten Betrags. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res.result !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>){ console.log(<span class="hljs-string"><span class="hljs-string">',       ,     '</span></span>); }</code> </pre> <br><p>  2) Mit der zweiten Option müssen wir prüfen, ob unsere Bestellung zu lange hängt.  Die Preise ändern sich schnell und möglicherweise ist der Durchschnittspreis nicht mehr relevant.  Zu diesem Zweck haben wir die Variable orderLifeTime erstellt, in der wir angeben, wie viel unsere Bestellung in Minuten hängen soll. </p><br><p>  Wenn die Zeit <strong>abgelaufen</strong> ist, stornieren Sie die Bestellung mit der Methode <strong>order_cancel</strong> und übergeben Sie ihr die Bestellnummer. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timePassed = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime() / <span class="hljs-number"><span class="hljs-number">1000</span></span>) + stockTimeOffset * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> - (buyOrders[key][<span class="hljs-string"><span class="hljs-string">'created'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(timePassed &gt; orderLifeTime * <span class="hljs-number"><span class="hljs-number">60</span></span>){ exmo.api_query(<span class="hljs-string"><span class="hljs-string">'order_cancel'</span></span>,{<span class="hljs-string"><span class="hljs-string">"order_id"</span></span>:buyOrders[key][<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>]}, res =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(res); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result.error) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result.error); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`   </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${orderLifeTime}</span></span></span><span class="hljs-string">     </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currency1}</span></span></span><span class="hljs-string">`</span></span>); }); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{</code> </pre> <br><p>  3) Wenn die Zeit noch nicht abgelaufen ist, hoffen wir nur, dass wir zu unserem Preis kaufen können. </p><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`,        ,      </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${timePassed}</span></span></span><span class="hljs-string"> `</span></span>); } } }); } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{</code> </pre> <br><p>  Alles, wir haben offene Aufträge herausgefunden, jetzt weiß unser Roboter, was mit Aufträgen zu tun ist, wenn er sie erstellt.  Die halbe Arbeit erledigt. </p><br><p>  Also ein Block, wenn wir keine Bestellungen haben. </p><br><p>  Informationen zu unserem Konto <strong>erhalten</strong> wir mithilfe der <strong>user_info-</strong> Methode: </p><br><pre> <code class="hljs coffeescript">exmo.api_query(<span class="hljs-string"><span class="hljs-string">'user_info'</span></span>,{},<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(result)</span></span></span><span class="hljs-function">=&gt;</span></span>{ let res = JSON.parse(result);</code> </pre> <br><p>  Der Einfachheit halber schreiben wir Guthaben für unsere Paare auf: </p><br><pre> <code class="hljs powershell">let balance = res.balances[<span class="hljs-type"><span class="hljs-type">currency1</span></span>]; let balance2 = res.balances[<span class="hljs-type"><span class="hljs-type">currency2</span></span>];</code> </pre> <br><p>  Überprüfen Sie, ob Währung1 verkauft werden kann. </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(balance &gt;= currency1MinQuantity){}</code> </pre> <br><p>  Wenn ja, müssen wir die Verkaufsrate berechnen. </p><br><p>  Sie müssen die gesamte Währung verkaufen, die Sie gekauft haben, den Betrag, den Sie gekauft haben, plus Gewinn abzüglich der Umtauschprovision. </p><br><p>  <strong>Ein wichtiger Punkt!</strong>  Wir haben weniger Währungen als wir gekauft haben - die Börse hat eine Provision erhalten. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> wannaGet = canSpend + canSpend * (stockFee+profit); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'sell'</span></span>, balance, wannaGet, (wannaGet/balance));</code> </pre> <br><p>  Beim Erstellen von Aufträgen muss der Methode <strong>order_create</strong> die folgenden Parameter übergeben werden: </p><br><ul><li>  Paar ist unser aktuelles Paar für den Handel; </li><li>  Menge - Menge; </li><li>  Preis - Preis; </li><li>  Typ - Typ der erstellten Bestellung (Kauf / Verkauf); </li></ul><br><p>  Wir wollen verkaufen - in der Art, die wir <strong>verkaufen</strong> . </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options = { <span class="hljs-string"><span class="hljs-string">"pair"</span></span>: currentPair, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span>: balance, <span class="hljs-string"><span class="hljs-string">"price"</span></span>: wannaGet / balance, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">'sell'</span></span> };</code> </pre> <br><p>  und senden Sie eine Anfrage, wenn alles korrekt ist, sehen Sie den Eintrag "Ein Verkaufsauftrag wurde erstellt". </p><br><pre> <code class="hljs coffeescript">exmo.api_query(<span class="hljs-string"><span class="hljs-string">"order_create"</span></span>, options,<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(result)</span></span></span><span class="hljs-function">=&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result.error) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result.error); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"   "</span></span>, currency1, result.order_id); });</code> </pre> <br><p>  Das ist alles.  Wenn wir eine Währung hatten, haben wir einfach einen Auftrag zum Verkauf erstellt. </p><br><p>  Nun wenden wir uns dem interessantesten Block zu: dem Fall, dass wir keine Währung1 (btc) haben und diese für unsere Währung2 (usd) kaufen möchten. </p><br><p>  Überprüfen Sie zunächst, ob in Währung2 genügend Geld in der Bilanz vorhanden ist. </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(balance2 &gt;= canSpend){}</code> </pre> <br><p>  Wenn dies der Fall ist, müssen wir den Durchschnittspreis ermitteln, für den Währung1 (BTC) für den in <em>avgPricePeriod</em> angegebenen <em>Zeitraum verkauft wird</em> . </p><br><p>  <em>Ein bisschen Text:</em> <br>  Exmo verfügt über eine <strong>Tickermethode</strong> mit Statistiken und Handelsvolumina für Währungspaare.  Die Statistiken zeigen den Durchschnittspreis der letzten 24 Stunden.  Der Unterschied zwischen dem Durchschnittspreis und dem Preis, zu dem die Auktion derzeit stattfindet, kann jedoch sehr unterschiedlich sein. </p><br><p>  Aus diesem Grund können wir lange auf die Ausführung eines Verkaufsauftrags warten. </p><br><p>  Wir werden unser Fahrrad machen. </p><br><p>  Exmo hat eine <strong>Handelsmethode</strong> und gibt eine Liste von Geschäften für ein Währungspaar zurück. </p><br><p>  Wir werden das perfekte Angebot für den <em>avgPricePeriod nehmen, an dem</em> wir interessiert sind, und daraus den Durchschnittspreis berechnen. </p><br><p>  Dies ist keine ideale Option, zeigt jedoch die tatsächlichen Preise an, zu denen sie verkaufen und kaufen. </p><br><p>  Zum Zeitpunkt des Schreibens beträgt der Durchschnittspreis von BTC_USD beispielsweise 8314, während der Kauf an der Börse zu einem Preis von 7970 erfolgt. </p><br><p>  Wenn wir eine Bestellung zu einem Durchschnittspreis aufgeben, wird diese sofort zu dem in Verkaufsaufträgen angegebenen Mindestpreis ausgeführt. </p><br><p>  Wenn wir jedoch Gewinn und Umtauschprovision hinzufügen, werden wir wahrscheinlich sehr lange auf den Verkauf warten. </p><br><p>  Wenden wir uns also der <em>Handelsmethode zu</em> und fragen ihn nach Statistiken zu unserem <em>aktuellen</em> Paar: </p><br><pre> <code class="hljs javascript">exmo.api_query(<span class="hljs-string"><span class="hljs-string">"trades"</span></span>,{<span class="hljs-string"><span class="hljs-string">"pair"</span></span>:currentPair}, result =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> res = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(result); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> prices = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> summ = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  Wir werden alle Ergebnisse durchgehen und nur diejenigen belassen, die für unseren Zeitraum geeignet sind. </p><br><pre> <code class="hljs markdown">for(deal in res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>]){ let timePassed = (new Date().getTime() / 1000) + stockTimeOffset <span class="hljs-bullet"><span class="hljs-bullet">* 60 *</span></span> 60 - res[<span class="hljs-string"><span class="hljs-string">currentPair</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">deal</span></span>].date; if(timePassed <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">avgPricePeriod</span></span></span></span><span class="xml"><span class="hljs-tag"> * </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">60</span></span></span></span><span class="xml"><span class="hljs-tag">){ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">summ</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">parseInt(res[currentPair][deal].price);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">prices.push</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">parseInt</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">res</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">currentPair</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">deal</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.price</span></span></span></span><span class="xml"><span class="hljs-tag">)); } }</span></span></span></span></code> </pre> <br><p>  Und berechnen Sie den Durchschnittspreis. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> avgPrice = summ2 / prices.length;</code> </pre> <br><p>  Wir haben einen Durchschnittspreis, aber wir müssen ihn ein wenig <em>korrigieren</em> - subtrahieren Sie die <em>Börsenprovision</em> und addieren Sie den gewünschten Gewinn.  Nachdem wir einen Preis erhalten haben, der unter dem durchschnittlichen Marktpreis liegt, werden wir etwas mehr Währung kaufen, da die Börse anschließend daran teilnimmt. </p><br><pre> <code class="hljs lisp">let needPrice = avgPrice - avgPrice * (<span class="hljs-name"><span class="hljs-name">stockFee</span></span> + profit)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><p>  Wir bekommen den endgültigen Betrag, den wir kaufen müssen. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ammount = canSpend / needPrice; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Buy'</span></span>, ammount, needPrice);</code> </pre> <br><p>  Wir prüfen, ob es möglich ist, einen solchen Währungsbetrag zu kaufen (ist der Mindestkaufbetrag nicht verletzt). </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ammount &gt;= currency1MinQuantity){}</code> </pre> <br><p>  Wenn unsere Menge größer ist, bilden wir die Parameter für die Methode <strong>order_create</strong> , nur diesmal mit der <strong>Kaufart</strong> . </p><br><pre> <code class="hljs pgsql"> let <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = { "pair": currentPair, "quantity": ammount, "price": needPrice, **"type": <span class="hljs-string"><span class="hljs-string">'buy'</span></span>** }; exmo.api_query(<span class="hljs-string"><span class="hljs-string">'order_create'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>, res =&gt; { let result = <span class="hljs-type"><span class="hljs-type">JSON</span></span>.parse(res); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result.error) console.log(result.error); console.log(<span class="hljs-string"><span class="hljs-string">'   '</span></span>, result.order_id); }); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ console.log(<span class="hljs-string"><span class="hljs-string">',      '</span></span>); } }); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ console.log(<span class="hljs-string"><span class="hljs-string">',   '</span></span>); }</code> </pre> <br><p>  Jetzt müssen wir unsere Funktion auf den Timer stellen (der Bereich ist zum Beispiel alle 5 Sekunden einmal) und wir können ihn ausführen. </p><br><pre> <code class="hljs matlab">var timerId = setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trade</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timerId</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTimeout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tick, 5000)</span></span></span><span class="hljs-function">; }, 5000);</span></span></code> </pre> <br><pre> <code class="hljs pgsql">node <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js</code> </pre> <br><p>  Herzlichen Glückwunsch, Sie haben Ihren ersten Handelsroboter geschrieben: Sie können den Algorithmus beenden und viel Geld verdienen. <del>  nur ein Scherz </del>  . </p><br><p>  Ich denke, Sie haben eine vernünftige Frage: "Wie viel Geld können Sie auf diese Weise verdienen?" </p><br><p>  Für eine Operation mit 5 Dollar verdiene ich ungefähr 2-3 Cent.  Dies liegt an der Primitivität des Algorithmus, der funktioniert, wenn der Preis in einem bestimmten Bereich schwankt (und dies ist beim Austausch von Kryptowährungen fast immer nicht der Fall).  Pro Tag finden ca. 10-20 Operationen statt (mit guten Händen).  Du kannst dich selbst zählen;) </p><br><p>  Aber wir beherrschen den Code nicht um des Geldes willen. </p><br><p>  Nochmals ein Link zum Github mit der Vollversion des Bots und Kommentaren. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/v-florinskiy/exmo-exchange-trade-bot</a> </p><br><p>  Dies ist mein erster Artikel - nicht streng beurteilen) </p><br><p>  Alle Gewinn. </p><br><p>  PS: Für diejenigen, die nicht mit Node gearbeitet haben, funktioniert Ihr Skript natürlich, während die Konsole geöffnet ist. </p><br><p>  Damit Ihr Roboter rund um die Uhr funktioniert, benötigen Sie eine Art vps: Dort setzen Sie nodejs, npm und beispielsweise pm2.  Mit diesem Dienstprogramm funktioniert das Skript auch dann weiter, wenn die Konsole geschlossen ist. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416073/">https://habr.com/ru/post/de416073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416061/index.html">So lala sehe ich alles</a></li>
<li><a href="../de416063/index.html">Verhandlungen über Russen sind nirgends zu verzeichnen</a></li>
<li><a href="../de416067/index.html">Übersicht über die Sicherheitsanfälligkeit in Mikrotik Winbox. Oder eine große Datei</a></li>
<li><a href="../de416069/index.html">Verlustfreie ElasticSearch-Datenmigration</a></li>
<li><a href="../de416071/index.html">Neuronale Netze, grundlegende Funktionsprinzipien, Vielfalt und Topologie</a></li>
<li><a href="../de416075/index.html">Der FSB möchte die Verantwortung für die versteckte Verwendung von Diktiergeräten und Kameras in Smartphones übernehmen [und nicht nur]</a></li>
<li><a href="../de416077/index.html">PlantUML - Alles, was Business Analysten zum Erstellen von Diagrammen in der Softwaredokumentation benötigen</a></li>
<li><a href="../de416079/index.html">Corona Native für Android - Verwenden von benutzerdefiniertem Java-Code in einem in Corona geschriebenen Spiel</a></li>
<li><a href="../de416081/index.html">Mit der Rückkehr nach Habr stimmt noch etwas nicht</a></li>
<li><a href="../de416083/index.html">Meine Regeln für Effizienz: Arbeiten mit Aufgaben, Projekten, Büchern und Notizen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>