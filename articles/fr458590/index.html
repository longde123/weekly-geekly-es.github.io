<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëû ‚ö†Ô∏è üëâüèº Approches architecturales dans les applications iOS üí∞ ü§µüèº üçó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous allons parler des approches architecturales dans le d√©veloppement iOS, de certaines des nuances et des d√©veloppements dans la mise e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Approches architecturales dans les applications iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/agima/blog/458590/"><p>  Aujourd'hui, nous allons parler des approches architecturales dans le d√©veloppement iOS, de certaines des nuances et des d√©veloppements dans la mise en ≈ìuvre de certaines choses.  Je vais vous dire quelles approches nous suivons et approfondir un peu les d√©tails. </p><a name="habracut"></a><br><p>  R√©v√©lez imm√©diatement toutes les cartes.  Nous utilisons MVVM-R (MVVM + Router). </p><br><p>  En fait, il s'agit d'une MVVM standard, dans laquelle la navigation entre les √©crans est plac√©e dans une couche distincte - le routeur, et la logique de r√©ception des donn√©es - dans les services.  Ensuite, nous examinerons nos r√©alisations dans la mise en ≈ìuvre de chaque couche. </p><br><h2 id="pochemu-mvvm-a-ne-viper-ili-mvc">  Pourquoi MVVM, pas VIPER ou MVC? </h2><br><p>  Contrairement √† MVC, MVVM a une responsabilit√© assez divis√©e entre les couches.  Il n'a pas autant de code ¬´servant¬ª que dans VIPER, bien que ViewModel pour les √©crans soit √©galement ferm√© par des protocoles.  Cette architecture est quelque peu similaire √† VIPER, seuls Presenter et Interactor sont combin√©s dans le ViewModel, et les connexions entre les couches sont simplifi√©es gr√¢ce √† l'utilisation de la programmation r√©active et des liants (nous utilisons ReactiveSwift). </p><br><h2 id="entity">  Entit√© </h2><br><p>  Nous utilisons deux couches de mod√®les de donn√©es: la premi√®re est li√©e √† une base de donn√©es (ci-apr√®s d√©nomm√©e <strong>objets g√©r√©s</strong> ), la seconde est ce que l'on appelle les <strong>objets simples</strong> , qui n'ont rien √† voir avec la base de donn√©es. </p><br><p> Chaque entit√© ordinaire impl√©mente le protocole traduisible, qui peut √™tre initialis√© √† partir d'un objet g√©r√© et √† partir duquel un objet g√©r√© peut √™tre cr√©√©.  Nous utilisons Realm comme base de donn√©es, dans notre cas <code>ManagedObject</code> est <code>RealmSwift.Object</code> .  Le mappage s'effectue via <code>Codable</code> : ils sont mapp√©s en tant qu'objets simples et enregistr√©s en tant qu'objets g√©r√©s.  Les autres services et ViewModel fonctionnent uniquement avec des objets simples. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Translatable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ManagedObject</span></span>: <span class="hljs-type"><span class="hljs-type">Object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(object: <span class="hljs-type"><span class="hljs-type">ManagedObject</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toManagedObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ManagedObject</span></span> }</code> </pre> <br><p>  Pour enregistrer, r√©cup√©rer et supprimer des objets de la base de donn√©es, une entit√© distincte est utilis√©e - Stockage.  Le stockage √©tant ferm√© par le protocole, nous ne d√©pendons pas de l'impl√©mentation d'une base de donn√©es sp√©cifique et, si n√©cessaire, nous pouvons remplacer Realm par CoreData. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cachedObjects</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">T</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">object</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byPrimaryKey key: AnyHashable)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(objects: [T])</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object: T)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(objects: [T])</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object: T)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAll</span></span></span><span class="hljs-function">&lt;T: Translatable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ofType type: T.</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> }</code> </pre> <br><h3 id="kakie-plyusy-i-minusy-u-takogo-podhoda">  Quels sont les avantages et les inconv√©nients de cette approche? </h3><br><p>  Chaque base de donn√©es a ses propres caract√©ristiques.  Par exemple, un objet Realm d√©j√† stock√© dans la base de donn√©es ne peut √™tre utilis√© que dans le cadre du flux dans lequel il a √©t√© cr√©√©.  C'est g√™nant. </p><br><p>  En outre, un objet peut √™tre supprim√© de la base de donn√©es, alors qu'il se trouve dans la RAM, et y acc√©der plantera.  Core Data a les m√™mes fonctionnalit√©s.  Par cons√©quent, nous obtenons des objets de la base de donn√©es, les convertissons en objets simples, puis travaillons avec eux. </p><br><p>  Avec cette approche, le code devient plus grand et doit √™tre pris en charge.  Quelles que soient les fonctionnalit√©s de la base de donn√©es, nous perdons la possibilit√© d'utiliser des puces sympas.  Dans le cas de CoreData, il s'agit d'un FetchedResultsController, o√π nous pouvons contr√¥ler toutes les insertions, suppressions et modifications dans un tableau d'entit√©s.  √Ä propos du m√™me m√©canisme dans Realm. </p><br><h2 id="core-components">  Composants principaux </h2><br><p>  Les composants principaux sont des entit√©s qui ex√©cutent l'une de leurs t√¢ches.  Par exemple, le mappage, l'interaction avec la base de donn√©es, l'envoi et le traitement des demandes r√©seau.  Le stockage du paragraphe pr√©c√©dent n'est qu'un des composants principaux. </p><br><h3 id="protocols">  Protocoles </h3><br><p>  Nous utilisons activement des protocoles.  Tous les composants principaux sont ferm√©s par des protocoles, et il est possible de faire une simulation ou une impl√©mentation de test pour des tests unitaires.  Ainsi, nous obtenons une certaine flexibilit√© d'impl√©mentation.  Toutes les d√©pendances sont pass√©es √† init.  Lors de l'initialisation de chaque objet, nous comprenons quel type de d√©pendances il y a, ce qu'il utilise √† l'int√©rieur de lui-m√™me. </p><br><h3 id="http-client">  Client HTTP </h3><br><p>  Une demande de r√©seau est d√©crite par le protocole <code>NetworkRequestParams</code> . </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetworkRequestParams</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method: <span class="hljs-type"><span class="hljs-type">HTTPMethod</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters: <span class="hljs-type"><span class="hljs-type">Parameters</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encoding: <span class="hljs-type"><span class="hljs-type">ParameterEncoding</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headers: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span>]? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> defaultHeaders: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span>]? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } }</code> </pre> <br><p>  Nous utilisons <code>enum</code> pour d√©crire les requ√™tes r√©seau.  Cela ressemble √† ceci: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserNetworkRouter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLRequestConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> info <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> update(userJson:[<span class="hljs-type"><span class="hljs-type">String</span></span> : <span class="hljs-type"><span class="hljs-type">Any</span></span>]) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserNetworkRouter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetworkRequestParams</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .info: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/users/profile"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .update: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/users/update_profile"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method: <span class="hljs-type"><span class="hljs-type">HTTPMethod</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .info: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .update: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .post } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encoding: <span class="hljs-type"><span class="hljs-type">ParameterEncoding</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .info: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">URLEncoding</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .update: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">JSONEncoding</span></span>() } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters: <span class="hljs-type"><span class="hljs-type">Parameters</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .info: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [:] <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .update(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userJson): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> userJson } } }</code> </pre> <br><p>  Chaque <code>NetworkRouter</code> impl√©mente le protocole <code>URLRequestConvertible</code> .  Nous le donnons au client du r√©seau, qui le convertit en <code>URLRequest</code> et l'utilise <code>URLRequest</code> √† sa destination. </p><br><p>  Le client r√©seau est le suivant: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTPClientProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: NetworkRequestParams &amp; URLRequestConvertible)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">SignalProducer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Data</span></span>, <span class="hljs-type"><span class="hljs-type">Error</span></span>&gt; }</code> </pre> <br><h3 id="mapper">  Mappeur </h3><br><p>  Nous utilisons <code>Codable</code> pour la cartographie des donn√©es. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MapperProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-function">&lt;MappingResult: Codable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: Data, dateDecodingStrategy: JSONDecoder.DateDecodingStrategy)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">SignalProducer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MappingResult</span></span>, <span class="hljs-type"><span class="hljs-type">Error</span></span>&gt; }</code> </pre> <br><h3 id="push---uvedomleniya">  Notifications push </h3><br><p>  Chaque notification push a un type et chaque type a son propre gestionnaire.  Le gestionnaire re√ßoit un dictionnaire contenant des informations de la notification.  L'entit√© d'agr√©gation d√©tient les gestionnaires; c'est elle qui recevra le push et le dirigera vers le gestionnaire souhait√©.  Il s'agit d'une approche assez √©volutive qui est pratique √† utiliser si vous devez g√©rer diff√©remment plusieurs types de notifications push. </p><br><h2 id="servisy">  Les services </h2><br><p>  En gros, un service est responsable d'une entit√©.  Consid√©rez ceci avec un exemple d'application de r√©seau social.  Il y a un serveur de l'utilisateur qui re√ßoit l'utilisateur - lui-m√™me, et donne les entit√©s modifi√©es si nous le modifions.  Il existe un service postal qui re√ßoit une liste de messages, un message d√©taill√©, un service de paiement, etc.  etc. </p><br><p>  Tous les services contiennent des composants de base.  Lorsque nous appelons une m√©thode sur un service, il commence √† extraire diverses m√©thodes des composants principaux et donne finalement le r√©sultat. </p><br><p>  Un service, en r√®gle g√©n√©rale, fonctionne pour un √©cran sp√©cifique, ou plut√¥t pour un mod√®le de vue d'√©cran (plus d'informations ci-dessous).  Si, en quittant l'√©cran, le service n'est pas d√©truit, mais continue de r√©pondre √† une demande r√©seau d√©j√† inutile et ralentira les autres demandes.  Cela peut √™tre contr√¥l√© manuellement, mais il sera plus difficile de maintenir un tel syst√®me.  Cependant, cette approche a un inconv√©nient: si le r√©sultat du service est n√©cessaire m√™me apr√®s la sortie de l'√©cran, vous devrez chercher d'autres solutions, peut-√™tre rendre certains services singleton. </p><br><p>  Les services sont apatrides.  √âtant donn√© que les services ne sont pas des monotones, nous pouvons avoir plusieurs instances du m√™me service, dans lesquelles les √©tats peuvent diff√©rer les uns des autres.  Cela peut conduire √† un comportement incorrect. </p><br><p>  Un exemple de m√©thode d'un des services: </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">SignalProducer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">User</span></span>, <span class="hljs-type"><span class="hljs-type">Error</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">UserNetworkRouter</span></span>.info <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> httpClient.load(request: request) .flatMap(.latest, mapUser) .flatMap(.latest, save) }</code> </pre> <br><h2 id="viewmodel">  ViewModel </h2><br><p>  Nous diviserons ViewModel en 2 types: </p><br><ul><li>  ViewModel pour l'√©cran (ViewController) </li><li>  ViewModel pour UIView (y compris les cellules de tableau ou UICollectionView) </li></ul><br><p>  ViewModel pour ViewController est responsable de la logique de l'√©cran.  En r√®gle g√©n√©rale, cela envoie des requ√™tes r√©seau, pr√©pare des donn√©es, r√©pond aux √©v√©nements de l'interface utilisateur. </p><br><p>  ViewModel pr√©pare toutes les donn√©es pour la vue issue du service.  Si une liste d'entit√©s arrive, le ViewModel la transforme en une liste de ViewModel et les lie √† la vue.  S'il y a des √©tats (il y a une coche / pas de coche), cela est √©galement g√©r√© et transmis au ViewModel. </p><br><p>  ViewModel contr√¥le √©galement la logique de navigation.  Il existe une couche de routeur distincte pour la navigation, mais le ViewModel donne les commandes. </p><br><p>  Fonctions typiques du mod√®le de vue: obtenir l'utilisateur, contacter le service utilisateur, cr√©er le ViewModel √† partir de la valeur re√ßue.  Lorsque tout se charge, View prend le ViewModel et dessine la cellule de vue. </p><br><p>  ViewModel pour l'√©cran est ferm√© par le protocole pour les m√™mes raisons que les services.  Cependant, il existe un autre cas int√©ressant: par exemple, une application bancaire, o√π chaque action (transfert de fonds, ouverture d'un compte, blocage d'un compte) est confirm√©e par SMS.  Sur l'√©cran de confirmation, il y a un champ de saisie de code et un bouton ¬´envoyer √† nouveau¬ª. </p><br><p>  ViewModel est ferm√© par ce protocole: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CodeInputViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">///    func send(code: String) -&gt; SignalProducer&lt;Void, Error&gt; ///    func resendCode() -&gt; SignalProducer&lt;Void, Error&gt; }</span></span></code> </pre> <br><p>  Dans ViewController, il est stock√© sous la forme suivante: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel: <span class="hljs-type"><span class="hljs-type">CodeInputViewModelProtocol?</span></span></code> </pre> <br><p>  Selon ce que nous essayons de confirmer par SMS, l'envoi d'un code et l'envoi de SMS peuvent √™tre repr√©sent√©s par des demandes compl√®tement diff√©rentes, et apr√®s confirmation, des transitions vers diff√©rents √©crans, etc. sont n√©cessaires.  √âtant donn√© que le ViewController ne se soucie pas du type de temps dont dispose le ViewModel, nous pouvons avoir plusieurs impl√©mentations de ViewModel pour diff√©rents cas, et l'interface utilisateur sera courante. </p><br><p>  Le ViewModel pour View et les cellules traite g√©n√©ralement du formatage des donn√©es et du traitement des entr√©es utilisateur.  Par exemple, stocker l'√©tat s√©lectionn√© / non s√©lectionn√©. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeedCellViewModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url: <span class="hljs-type"><span class="hljs-type">URL?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> title: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> subtitle: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(feed: <span class="hljs-type"><span class="hljs-type">FeedItem</span></span>) { url = <span class="hljs-type"><span class="hljs-type">URL</span></span>(string: feed.imageUrl) title = feed.title subtitle = <span class="hljs-type"><span class="hljs-type">DateFormatter</span></span>.feed.string(from feed.publishDate) } }</code> </pre> <br><h2 id="navigaciya">  La navigation </h2><br><p>  Les transitions entre les √©crans sont effectu√©es par le routeur. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(sourceViewController: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.sourceViewController = sourceViewController } <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceViewController: <span class="hljs-type"><span class="hljs-type">UIViewController?</span></span> }</code> </pre> <br><p>  Chaque √©cran poss√®de son propre routeur, h√©rit√© de la base.  Il a des m√©thodes de transition pour des √©crans sp√©cifiques. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeedRouter</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showDetail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewModel: FeedDetailViewModelProtocol)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vc = <span class="hljs-type"><span class="hljs-type">FeedDetailViewController</span></span>() vc.viewModel = viewModel sourceViewController?.navigationController?.pushViewController(vc, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } }</code> </pre> <br><p>  Comme vous pouvez le voir dans l'exemple ci-dessus, l'assemblage du "module" se produit dans le routeur.  Cela contredit formellement la lettre S de SOLID, mais en pratique, cela s'av√®re assez pratique et ne pose pas de probl√®me. </p><br><p>  Il y a des moments o√π la m√™me m√©thode est n√©cessaire dans diff√©rents routeurs.  Afin de ne pas l'√©crire plusieurs fois, nous cr√©ons un protocole dans lequel il y aura des m√©thodes g√©n√©rales, et nous l'impl√©menterons.  Il suffit maintenant de signer le routeur souhait√© pour ce protocole, et il disposera des m√©thodes n√©cessaires. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeedRouterProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showDetail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewModel: FeedDetailViewModelProtocol)</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeedRouterProtocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Self</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showDetail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewModel: FeedDetailViewModelProtocol)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vc = <span class="hljs-type"><span class="hljs-type">FeedDetailViewController</span></span>() vc.viewModel = viewModel sourceViewController?.navigationController?.pushViewController(vc, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } }</code> </pre> <br><h2 id="view">  Afficher </h2><br><p>  View est traditionnellement responsable de l'affichage des informations pour l'utilisateur et du traitement des actions de l'utilisateur.  Dans MVVM, nous pensons que ViewController est une vue.  Il est important qu'aucune logique complexe n'ait sa place dans le ViewModel.  Dans tous les cas, m√™me dans MVC, vous ne devez pas charger le ViewController lourdement, bien qu'il soit difficile de le faire. </p><br><p>  View commande le ViewModel.  Si le ViewController est charg√©, nous donnons la commande ViewModel: charger les donn√©es du r√©seau ou du cache.  View accepte √©galement les signaux du ViewModel.  Si le ViewModel indique que quelque chose a chang√© (par exemple, les donn√©es m√™mes ont √©t√© charg√©es), alors View r√©agit et redessine. </p><br><p>  Nous n'utilisons pas de storyboards.  La navigation est fortement li√©e au ViewController et il est difficile de s'int√©grer dans l'architecture.  Les conflits surviennent souvent dans les story-boards, qui sont un ¬´plaisir¬ª distinct √† √©diter. </p><br><h2 id="chto-delat-dalshe">  Que faire ensuite? </h2><br><p>  Vous pouvez utiliser la g√©n√©ration de code pour les mod√®les (traduisible), car toute l'initialisation de l'objet de base de donn√©es vers l'objet plan et vice versa est d√©sormais enregistr√©e manuellement. </p><br><p>  Vous pouvez √©galement utiliser un sch√©ma de requ√™te plus universel, car de nombreuses m√©thodes de services ressemblent √† ceci: aller sur le r√©seau, appliquer le mappage, enregistrer dans la base de donn√©es.  Cela peut √©galement √™tre universalis√©, pour d√©finir un squelette commun. </p><br><p>  Nous avons consid√©r√© des approches architecturales, mais n'oubliez pas qu'une application de haute qualit√© n'est pas seulement une architecture, mais aussi une interface fluide, r√©active et pratique.  Aimez vos utilisateurs et √©crivez des applications de qualit√©. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458590/">https://habr.com/ru/post/fr458590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458568/index.html">Comment avons-nous obtenu les premi√®res images 3D de peut-√™tre la plus ancienne √©glise chr√©tienne de Russie</a></li>
<li><a href="../fr458572/index.html">Anatoly Slyusar: ¬´La p√©riode de l'ordinateur europ√©en nous a permis de former des programmeurs syst√®me et appliqu√©s¬ª</a></li>
<li><a href="../fr458576/index.html">Gestion et localisation de texte dans une application web</a></li>
<li><a href="../fr458582/index.html">Un ing√©nieur d'Amazon a cr√©√© un dispositif de blocage de l'IA qui emp√™che les chats de sortir de la rue</a></li>
<li><a href="../fr458584/index.html">11 juillet, Webinaire Group-IB ¬´Analyse des logiciels malveillants pour les d√©butants: approches de base¬ª</a></li>
<li><a href="../fr458592/index.html">De la latence Ceph √©lev√©e au patch du noyau avec eBPF / BCC</a></li>
<li><a href="../fr458594/index.html">N'oubliez pas d'augmenter les chances de r√©ponse au client en utilisant une demande r√©p√©t√©e dans l'√©quilibrage L7</a></li>
<li><a href="../fr458596/index.html">Petty Little Joy # 6: OpenAI Gym - Jouez √† des jeux et contr√¥lez des robots</a></li>
<li><a href="../fr458598/index.html">Reconnaissance des sources lumineuses sur les cartes de l'environnement</a></li>
<li><a href="../fr458600/index.html">Que sont les v√©los √©lectriques (examen de groupe en deux parties de cinq mod√®les de deux fabricants), partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>