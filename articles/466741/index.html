<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµÔ∏è üëàüèª ‚ö±Ô∏è Lo mejor es enemigo de lo bueno. üëñ ‚ÜïÔ∏è üí≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo trata sobre c√≥mo una vez que decidimos mejorar ligeramente la herramienta interna SelfTester, utilizada para verificar la calidad del an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lo mejor es enemigo de lo bueno.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/466741/"><p><img src="https://habrastorage.org/getpro/habr/post_images/982/355/890/982355890903cccb9e35a693d48d72cf.png" alt="Cuadro 12" align="left"></p>  Este art√≠culo trata sobre c√≥mo una vez que decidimos mejorar ligeramente la herramienta interna SelfTester, utilizada para verificar la calidad del analizador PVS-Studio.  La mejora fue simple y parec√≠a √∫til, pero nos cre√≥ muchos problemas, y luego result√≥ que ser√≠a mejor si no lo hici√©ramos. <br><a name="habracut"></a><br><h2>  Selftester </h2><br>  Desarrollamos y promovemos el analizador de c√≥digo est√°tico PVS-Studio para C, C ++, C # y Java.  Para verificar la calidad del analizador, utilizamos herramientas internas que se denominan colectivamente SelfTester.  Cada uno de los idiomas admitidos tiene su propia versi√≥n de SelfTester.  Esto se debe a las caracter√≠sticas de las pruebas, y es m√°s conveniente.  Por lo tanto, en este momento, nuestra empresa utiliza tres herramientas internas de SelfTester para C \ C ++, C # y Java, respectivamente.  A continuaci√≥n, hablar√© sobre la versi√≥n de Windows de SelfTester para proyectos de C \ C ++ Visual Studio, llam√°ndolo simplemente SelfTester.  Este probador fue el primero en la l√≠nea de tales herramientas internas, es el m√°s avanzado y complejo de todos. <br><br>  ¬øC√≥mo funciona SelfTester?  La idea es simple: tome un grupo de proyectos de prueba (usamos proyectos reales con c√≥digo fuente abierto) y anal√≠celos usando PVS-Studio.  Como resultado, se genera un registro de advertencia del analizador para cada proyecto.  Este registro se compara con el registro de <i>referencia</i> para el mismo proyecto.  Al comparar registros, SelfTester crea un <i>registro de</i> comparaci√≥n de registros en una forma conveniente para que los desarrolladores lo perciban. <br><br>  Despu√©s de estudiar el libro de registro, el desarrollador llega a una conclusi√≥n sobre los cambios en el comportamiento del analizador: el n√∫mero y la naturaleza de las advertencias, la velocidad de operaci√≥n, los errores internos del analizador, etc.  Toda esta informaci√≥n es muy importante, le permite comprender qu√© tan bien el analizador hace su trabajo. <br><br>  Seg√∫n el registro de comparaci√≥n de registros, el desarrollador realiza cambios en el n√∫cleo del analizador (por ejemplo, al crear una nueva regla de diagn√≥stico), controlando inmediatamente el efecto de sus ediciones.  Si el desarrollador ya no tiene preguntas sobre la pr√≥xima comparaci√≥n de los registros, entonces <i>hace</i> <i>referencia al</i> registro de advertencia <i>actual</i> para el proyecto.  De lo contrario, el trabajo contin√∫a. <br><br>  Entonces, la tarea de SelfTester es trabajar con un grupo de proyectos de prueba (por cierto, ya hay m√°s de 120 de ellos para C / C ++).  Los proyectos para el grupo se seleccionan como soluciones de Visual Studio.  Esto se hace para probar adicionalmente el analizador en diferentes versiones de Visual Studio que el analizador admite (desde Visual Studio 2010 hasta Visual Studio 2019 en este momento). <br><br>  <i>Nota</i> : Separar√© a√∫n m√°s los conceptos de <i>soluci√≥n</i> y <i>proyecto</i> , entendiendo el proyecto como parte de la soluci√≥n, como es habitual en Visual Studio. <br><br>  La interfaz de SelfTester se ve as√≠: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d0/627/355/1d0627355eb338938aa789d33aedec83.png" alt="Cuadro 3"></div><br>  A la izquierda hay una lista de soluciones, a la derecha est√°n los resultados de la prueba para cada versi√≥n de Visual Studio. <br><br>  Las marcas grises "No admitido" indican que la soluci√≥n no es compatible con la versi√≥n seleccionada de Visual Studio o que no se ha convertido para esta versi√≥n.  Algunas soluciones en el grupo tienen una configuraci√≥n que indica la versi√≥n espec√≠fica de Visual Studio para verificar.  Si no se especifica la versi√≥n, la soluci√≥n se actualizar√° a todas las versiones posteriores de Visual Studio.  Un ejemplo de dicha soluci√≥n en la captura de pantalla es "smart_ptr_check.sln" (se realiz√≥ la verificaci√≥n para todas las versiones de Visual Studio). <br><br>  Una marca verde "OK" indica que la pr√≥xima verificaci√≥n no revel√≥ ninguna diferencia con el registro de referencia.  Una marca roja "Diff" indica diferencias.  Es en tales etiquetas que el desarrollador debe prestar atenci√≥n.  Para hacer esto, necesita hacer doble clic en la etiqueta deseada.  La soluci√≥n seleccionada se abrir√° en la versi√≥n deseada de Visual Studio, y all√≠ tambi√©n se abrir√° una ventana con un registro de advertencia.  Los botones de control a continuaci√≥n le permiten reiniciar el an√°lisis de las decisiones seleccionadas o todas, asignar el registro seleccionado (o todos a la vez) a los est√°ndares, etc. <br><br>  Los resultados presentados del trabajo de SelfTester siempre se duplican en el informe html (registro de diferencias). <br><br>  Adem√°s de la GUI, SelfTester tambi√©n tiene modos automatizados para ejecutarse durante las compilaciones nocturnas.  Sin embargo, el patr√≥n de uso habitual son los lanzamientos repetidos por el desarrollador durante la jornada laboral.  Por lo tanto, una de las caracter√≠sticas importantes para SelfTester es su <i>velocidad</i> . <br><br>  Por qu√© la velocidad es importante: <br><br><ol><li>  Para ejecutar durante las pruebas nocturnas, el tiempo necesario para completar cada paso es cr√≠tico.  Obviamente, cuanto m√°s r√°pido pasan las pruebas, mejor.  Y el tiempo de funcionamiento promedio de SelfTester actualmente supera las 2 horas; </li><li>  Al iniciar SelfTester durante el d√≠a, el desarrollador tiene que esperar menos por el resultado, lo que aumenta la productividad laboral. </li></ol><br>  Fue el deseo de acelerar el trabajo de SelfTester lo que caus√≥ las mejoras esta vez. <br><br><h2>  Multithreading en SelfTester </h2><br>  SelfTester se cre√≥ originalmente como una aplicaci√≥n multiproceso con la capacidad de verificar m√∫ltiples soluciones en paralelo.  La √∫nica limitaci√≥n es que no puede verificar simult√°neamente la misma soluci√≥n para diferentes versiones de Visual Studio, ya que muchas soluciones necesitan actualizarse a ciertas versiones de Visual Studio antes de verificar.  Durante esto, los cambios se realizan directamente en los <i>archivos de</i> proyecto <i>.vcxproj</i> , lo que genera errores al ejecutarse en paralelo. <br><br>  Para que el trabajo sea m√°s eficiente, SelfTester utiliza un programador de tareas inteligente que le permite establecer un valor estrictamente limitado para subprocesos paralelos y mantenerlo. <br><br>  El planificador se usa en dos niveles.  El primero es el nivel de <i>soluci√≥n</i> , que se utiliza para comenzar a verificar la soluci√≥n <i>.sln</i> utilizando la <i>utilidad PVS-Studio_Cmd.exe</i> .  Dentro de <i>PVS-Studio_Cmd.exe</i> (en el nivel de comprobaci√≥n de <i>archivos de</i> c√≥digo fuente) se utiliza el mismo planificador, pero con un <i>grado</i> diferente <i>de</i> configuraci√≥n <i>de paralelismo</i> . <br><br>  El grado de paralelismo es un par√°metro que realmente indica cu√°ntos hilos paralelos deben ejecutarse simult√°neamente.  Para los valores de grado de paralelismo en el nivel de decisi√≥n y los archivos, se seleccionaron los valores predeterminados de <i>cuatro</i> y <i>ocho</i> , respectivamente.  Por lo tanto, el n√∫mero de subprocesos paralelos para esta implementaci√≥n debe ser igual a 32 (cuatro soluciones probadas simult√°neamente y ocho archivos).  Esta configuraci√≥n nos parece √≥ptima para que el analizador funcione en un procesador de ocho n√∫cleos. <br><br>  El desarrollador puede establecer independientemente otros valores del grado de paralelismo, centr√°ndose en el rendimiento de su computadora o en las tareas actuales.  Si no establece este par√°metro, se seleccionar√° de manera predeterminada el n√∫mero de procesadores l√≥gicos del sistema. <br><br>  <i>Nota</i> : adem√°s consideraremos que el trabajo se lleva a cabo con el grado predeterminado de valores de paralelismo. <br><br>  El <i>planificador LimitedConcurrencyLevelTaskScheduler se</i> hereda de <i>System.Threading.Tasks.TaskScheduler</i> y se refina para proporcionar el nivel m√°ximo de paralelismo cuando se trabaja en la parte superior de <i>ThreadPool</i> .  Jerarqu√≠a de herencia: <br><br><pre><code class="cs hljs">LimitedConcurrencyLevelTaskScheduler : PausableTaskScheduler { .... } PausableTaskScheduler: TaskScheduler { .... }</code> </pre> <br>  <i>PausableTaskScheduler le</i> permite pausar tareas, y <i>LimitedConcurrencyLevelTaskScheduler</i> , adem√°s, proporciona un control inteligente de la cola de tareas y la programaci√≥n de su ejecuci√≥n, teniendo en cuenta el grado de paralelismo, la cantidad de tareas programadas y otros factores.  El planificador se usa al iniciar las tareas <i>System.Threading.Tasks.Task</i> . <br><br><h2>  Prerrequisitos para mejoras </h2><br>  La implementaci√≥n del trabajo descrito anteriormente tiene un inconveniente: no es √≥ptima cuando se trabaja con soluciones de diferentes tama√±os.  Y el tama√±o de las soluciones en el grupo de prueba es <i>muy</i> diferente: de 8 KB a 4 GB para el tama√±o de la carpeta con la soluci√≥n, y de uno a varios miles de archivos de c√≥digo fuente en cada uno. <br><br>  El planificador pone en cola las decisiones simplemente en orden, sin ning√∫n componente intelectual.  Perm√≠tame recordarle que, de forma predeterminada, no se pueden verificar m√°s de cuatro soluciones al mismo tiempo.  Si en este momento se est√°n verificando cuatro soluciones grandes (la cantidad de archivos en cada una es superior a ocho), se supone que estamos trabajando de manera eficiente, ya que utilizamos la cantidad m√°xima posible de subprocesos (32). <br><br>  Pero imagine una situaci√≥n bastante com√∫n cuando se prueban varias soluciones peque√±as.  Por ejemplo, una soluci√≥n es grande y contiene 50 archivos (se incluir√°n un m√°ximo de ocho hilos), y los otros tres contienen tres, cuatro y cinco archivos cada uno.  En este caso, usamos solo 20 hilos (8 + 3 + 4 + 5).  Obtenemos una subutilizaci√≥n del tiempo del procesador y una disminuci√≥n en el rendimiento general. <br><br>  <i>Nota</i> : de hecho, el cuello de botella, como regla, sigue siendo el subsistema de disco, no el procesador. <br><br><h2>  Mejoras </h2><br>  Una mejora que se sugiere en este caso es la clasificaci√≥n de la lista de soluciones enviadas para verificaci√≥n.  Es necesario lograr el uso √≥ptimo de un n√∫mero determinado de subprocesos ejecutados simult√°neamente (32) mediante la presentaci√≥n de proyectos con el n√∫mero "correcto" de archivos para su verificaci√≥n. <br><br>  Veamos nuevamente nuestro ejemplo, cuando se verifican cuatro soluciones con el siguiente n√∫mero de archivos en cada una: 50, 3, 4 y 5. Una tarea que verifica una soluci√≥n de <i>tres</i> archivos probablemente funcionar√° pronto.  Y en lugar de ello, ser√≠a √≥ptimo agregar una soluci√≥n en la que haya ocho o m√°s archivos (para utilizar un m√°ximo de ocho secuencias disponibles para esta soluci√≥n).  Luego, en total, usaremos ya 25 hilos (8 + <b>8</b> + 4 + 5).  No esta mal.  Sin embargo, siete hilos todav√≠a se dejaron sin usar.  Y aqu√≠ surge la idea de otro refinamiento, relacionado con la eliminaci√≥n de la restricci√≥n en cuatro hilos para verificar soluciones.  De hecho, en el ejemplo anterior, puede agregar no una, sino varias soluciones, utilizando la mayor cantidad posible de los 32 hilos.  Imaginemos que tenemos dos soluciones m√°s, tres y cuatro archivos cada una.  Agregar estas tareas cerrar√° por completo la "brecha" en los hilos no utilizados, y habr√° 32 (8 + 8 + 4 + 5 + <b>3</b> + <b>4</b> ). <br><br>  Creo que la idea es clara.  De hecho, la implementaci√≥n de estas mejoras tampoco requiri√≥ mucho esfuerzo.  Todo se hizo en un d√≠a. <br><br>  Era necesario refinar la clase de tarea: herencia de <i>System.Threading.Tasks.Task</i> y agregar el campo "peso".  Para establecer el peso de la soluci√≥n, se utiliza un algoritmo simple: si el n√∫mero de archivos en la soluci√≥n es menor que ocho, entonces el peso se establece igual a este valor (por ejemplo, 5), si el n√∫mero de archivos es mayor o igual a ocho, entonces el peso se elige igual a ocho. <br><br>  Tambi√©n era necesario refinar el programador: ense√±arle a elegir soluciones con el peso adecuado para lograr un valor m√°ximo de 32 hilos.  Tambi√©n era necesario permitir la asignaci√≥n de m√°s de cuatro hilos para la verificaci√≥n simult√°nea de soluciones. <br><br>  Finalmente, se tom√≥ un paso preliminar para analizar todas las soluciones de agrupaci√≥n (evaluaci√≥n utilizando la API de MSBuild) para calcular y establecer los pesos de la soluci√≥n (obtener el n√∫mero de archivos con c√≥digo fuente). <br><br><h2>  Resultado </h2><br>  Creo que, despu√©s de una presentaci√≥n tan larga, ya adivinaste que el resultado fue cero. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/91c/6c1/fca/91c6c1fca4017036c0fca83fd2113474.png" alt="Cuadro 15"></div><br>  Es bueno que las mejoras fueran simples y r√°pidas. <br><br>  Bueno, ahora, de hecho, comienza la parte del art√≠culo sobre "nos cre√≥ muchos problemas", y eso es todo. <br><br><h2>  Efectos secundarios </h2><br>  Entonces, un resultado negativo tambi√©n es un resultado.  Result√≥ que la cantidad de soluciones grandes en el grupo excede <i>significativamente</i> la cantidad de soluciones peque√±as (menos de ocho archivos).  En estas condiciones, las mejoras realizadas no tienen un efecto notable, ya que son pr√°cticamente invisibles: su verificaci√≥n lleva un tiempo microsc√≥pico en comparaci√≥n con los grandes proyectos. <br><br>  Sin embargo, se decidi√≥ dejar la revisi√≥n como "sin interferir" y potencialmente √∫til.  Adem√°s, el conjunto de soluciones de prueba se repone constantemente, por lo que en el futuro, tal vez, la situaci√≥n cambiar√°. <br><br>  Y luego ... <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bdf/906/0ea/bdf9060ea6b9d1ce17ed820acc1468c7.png" alt="Cuadro 5"></div><br>  Uno de los desarrolladores se quej√≥ de la "ca√≠da" de SelfTester.  Bueno, eso pasa.  Para evitar que se pierda este error, se lanz√≥ un incidente interno (ticket) con el nombre "Excepci√≥n al trabajar con SelfTester".  El error ocurri√≥ durante la evaluaci√≥n del proyecto.  Es cierto que tal abundancia de ventanas atestigu√≥ el problema tambi√©n en el controlador de errores.  Pero esto fue eliminado r√°pidamente, y durante la semana siguiente no se rompi√≥ nada.  De repente, otro usuario se quej√≥ de SelfTester.  Y nuevamente al error de la evaluaci√≥n del proyecto: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fa/1f3/bd5/0fa1f3bd596a2a4bdbbc0f9ace32664c.png" alt="Cuadro 8"></div><br>  Esta vez, la pila conten√≠a m√°s informaci√≥n √∫til: un error en el formato xml.  Probablemente, mientras procesaba el archivo de proyecto <i>Proto_IRC.vcxproj</i> (su representaci√≥n xml), algo le sucedi√≥ al archivo en s√≠, por lo que <i>XmlTextReader</i> no pudo procesarlo. <br><br>  La presencia de dos errores en un per√≠odo de tiempo bastante corto nos hizo mirar m√°s de cerca el problema.  Adem√°s, como dije anteriormente, SelfTester es muy utilizado por los desarrolladores. <br><br>  Para empezar, se hizo un an√°lisis del √∫ltimo lugar de la ca√≠da.  Lamentablemente, no se pudo identificar nada sospechoso.  Por si acaso, pidieron a los desarrolladores (usuarios de SelfTester) que estuvieran alertas y reportaran posibles errores. <br><br>  Un punto importante: el c√≥digo en el que ocurri√≥ el error se reutiliz√≥ en SelfTester.  Inicialmente, se utiliza para evaluar proyectos en el analizador ( <i>PVS-Studio_Cmd.exe</i> ).  Es por eso que la atenci√≥n al problema ha crecido.  Sin embargo, no se produjeron ca√≠das similares en el analizador. <br><br>  Mientras tanto, un boleto sobre problemas con SelfTester se repon√≠a con nuevos errores: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b49/15a/0ae/b4915a0aecc426246419f4a26e62a233.png" alt="Cuadro 9"></div><br>  Y de nuevo <i>XmlException</i> .  Obviamente, en alg√∫n lugar hay hilos competidores que trabajan con archivos de proyecto de lectura y escritura.  SelfTester trabaja con proyectos en los siguientes casos: <br><br><ol><li>  Evaluaci√≥n de proyectos durante el c√°lculo preliminar de los pesos de decisi√≥n: un nuevo paso que inicialmente despert√≥ sospechas; </li><li>  Actualizaci√≥n de proyectos a las versiones necesarias de Visual Studio: realizadas inmediatamente antes de la verificaci√≥n (los proyectos no se superponen) y no deber√≠an afectar el trabajo; </li><li>  Evaluaci√≥n de proyectos durante la verificaci√≥n: mecanismo de seguridad de subprocesos depurado, que se reutiliz√≥ de <i>PVS-Studio_Cmd.exe</i> ; </li><li>  Recuperar archivos de proyecto (reemplazando archivos <i>.vcxproj</i> modificados <i>con los</i> archivos de referencia originales) al salir de SelfTester, ya que los archivos de proyecto se pueden actualizar a las versiones necesarias de Visual Studio en el proceso: el paso final, que tampoco afecta a otros mecanismos. </li></ol><br>  La sospecha recay√≥ en el nuevo c√≥digo agregado para la optimizaci√≥n (c√°lculo de pesos).  Pero el estudio de este c√≥digo mostr√≥ que si el usuario iniciaba el an√°lisis inmediatamente despu√©s del inicio de SelfTester, el probador siempre esperaba correctamente el final de la evaluaci√≥n preliminar.  Este lugar parec√≠a seguro. <br><br>  Nuevamente, no pudimos identificar la fuente del problema. <br><br><h2>  Dolor </h2><br>  Durante el mes siguiente, SelfTester continu√≥ cayendo de vez en cuando.  El ticket se rellen√≥ con datos, pero no estaba claro qu√© hacer con estos datos.  La mayor√≠a de los bloqueos fueron todos con la misma <i>XmlException</i> .  Ocasionalmente hab√≠a algo m√°s, pero en el mismo c√≥digo reutilizado de <i>PVS-Studio_Cmd.exe</i> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c31/fbe/c11/c31fbec1152210e397b6d9d1ffdb5aa6.png" alt="Imagen 1"></div><br>  Por tradici√≥n, no se imponen requisitos tan altos a las herramientas internas, por lo tanto, el trabajo con errores de SelfTester se realiz√≥ de forma residual.  De vez en cuando, diferentes personas se conectaban (durante todo el tiempo del incidente, seis personas trabajaron en el problema, incluidos dos pasantes en pr√°cticas).  Sin embargo, la tarea tuvo que ser distra√≠da. <br><br>  <i>Nuestro primer error</i>  De hecho, aqu√≠ ya era posible resolver el problema de una vez por todas.  Como?  Estaba claro que el error fue causado por una nueva optimizaci√≥n.  Despu√©s de todo, antes de todo, todo funcion√≥ bien, y el c√≥digo reutilizado obviamente no podr√≠a ser tan malo.  Adem√°s, esta optimizaci√≥n no trajo ning√∫n beneficio.  Entonces, ¬øqu√© hab√≠a que hacer?  <i>Eliminar esta optimizaci√≥n</i> <b>.</b>  Como saben, esto no se hizo.  Continuamos trabajando en un problema que nosotros mismos hab√≠amos creado.  La b√∫squeda continu√≥ por la respuesta a la pregunta: "¬øC√ìMO?"  ¬øC√≥mo se cae?  Sin embargo, parece estar escrito correctamente. <br><br>  <i>Nuestro segundo error.</i>  <i>Otras personas</i> estaban <i>conectadas</i> a la soluci√≥n del problema.  Un muy, muy gran error.  Desafortunadamente, esto no solo no resolvi√≥ el problema, sino que se gastaron recursos adicionales.  S√≠, nuevas personas aportaron nuevas ideas, pero para su implementaci√≥n tom√≥ (absolutamente desperdiciado) mucho tiempo de trabajo.  En cierta etapa, los programas de prueba fueron escritos (por los mismos aprendices) que emulan la evaluaci√≥n del mismo proyecto en diferentes hilos con modificaci√≥n paralela del proyecto en otro hilo.  No sirvi√≥ de nada.  Adem√°s de lo que ya sab√≠amos antes, la API de MSBuild es segura para subprocesos en su interior, no han descubierto nada nuevo.  Y en SelfTester, se agreg√≥ un mini-dump cuando <i>se</i> lanz√≥ una <i>XmlException</i> .  Entonces todo esto alguien lo debati√≥, horror.  Se sostuvieron discusiones, se hicieron muchas otras cosas innecesarias. <br><br>  <i>Finalmente, nuestro tercer error</i> .  ¬øSabes cu√°nto tiempo ha pasado desde que surgi√≥ el problema con SelfTester y hasta que se resolvi√≥?  Aunque no, cuenta t√∫ mismo.  El incidente se cre√≥ el 17/09/2018 y se cerr√≥ el 20/02/2019, y hay m√°s de 40 (¬°cuarenta!) Mensajes all√≠.  Chicos, esto es mucho tiempo!  Nos <i>permitimos</i> hacer TI <i>durante</i> cinco meses.  Al mismo tiempo (en paralelo), participamos en el soporte para Visual Studio 2019, agregamos el lenguaje Java, comenzamos a implementar el est√°ndar MISRA C / C ++, mejoramos el analizador C #, participamos activamente en conferencias, escribimos un mont√≥n de art√≠culos, etc.  Y todos estos trabajos no recibieron el tiempo de los desarrolladores debido al est√∫pido error SelfTester. <br><br>  Ciudadanos, aprendan de nuestros errores y nunca hagan eso.  Y no lo haremos. <br><br>  Lo tengo todo <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a8/a29/f94/3a8a29f94aeed35ddeaec17222a4f990.png" alt="Cuadro 17"></div><br>  Por supuesto, esto es una broma, y ‚Äã‚Äãte dir√© cu√°l fue el problema con SelfTester :) <br><br><h2>  Bingo! </h2><br>  Afortunadamente, entre nosotros hab√≠a una persona con la conciencia menos nublada (mi colega Sergey Vasiliev), que solo mir√≥ el problema desde un √°ngulo completamente diferente (y tambi√©n tuvo un poco de suerte).  ¬øQu√© pasa si dentro de SelfTester est√° realmente bien y los proyectos rompen algo desde afuera?  Paralelamente a SelfTester, por lo general, nada comenz√≥, en algunos casos controlamos estrictamente el tiempo de ejecuci√≥n.  En este caso, este "algo" solo podr√≠a ser SelfTester en s√≠ mismo, pero otra instancia m√°s. <br><br>  Al salir de SelfTester, la secuencia que restaura los archivos de proyecto de los est√°ndares contin√∫a funcionando durante alg√∫n tiempo.  En este punto, puede reiniciar el probador.  La protecci√≥n contra la ejecuci√≥n de varias instancias de SelfTester al mismo tiempo se agreg√≥ <i>m√°s tarde</i> y ahora se ve as√≠: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a3/7bf/437/0a37bf4373e3beb9bbfe2542afb258a0.png" alt="Cuadro 16"></div><br>  Pero entonces ella se fue. <br><br>  Incre√≠blemente, durante casi medio a√±o de tormento nadie le prest√≥ atenci√≥n.  Restaurar proyectos a partir de est√°ndares es un procedimiento de fondo lo suficientemente r√°pido, pero, desafortunadamente, no lo suficientemente r√°pido como para no interferir con el reinicio de SelfTester.  ¬øY qu√© pasa en el inicio?  As√≠ es, calculando los pesos de decisi√≥n.  Un proceso sobrescribe los archivos <i>.vcxproj</i> , mientras que otro intenta leerlos.  Hola, <i>XmlException</i> . <br><br>  Sergey descubri√≥ todo esto cuando agreg√≥ al probador la capacidad de cambiar al modo de trabajar con otro conjunto de registros est√°ndar.  La necesidad de esto surgi√≥ despu√©s de agregar el conjunto de reglas MISRA al analizador.  Puede cambiar directamente en la interfaz, mientras el usuario ve la ventana: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/9b0/87d/0a59b087d0e13688ab41a690ed490a3f.png" alt="Cuadro 14"></div><br>  Despu√©s de lo cual SelfTester se <i>reinicia</i> .  Bueno, antes, aparentemente, los usuarios de alguna manera emularon el problema ellos mismos, comenzando el probador nuevamente. <br><br><h2>  Debriefing y conclusiones </h2><br>  Por supuesto, eliminamos, o mejor dicho, deshabilitamos la optimizaci√≥n creada anteriormente.  Adem√°s, fue mucho m√°s f√°cil que hacer alg√∫n tipo de sincronizaci√≥n entre el resto del probador.  Y todo comenz√≥ a funcionar bien, como antes.  Y como medida adicional, se agreg√≥ la protecci√≥n descrita anteriormente contra el lanzamiento simult√°neo del probador. <br><br>  Ya escrib√≠ anteriormente sobre nuestros principales errores durante la b√∫squeda del problema, por lo que la autoflagelaci√≥n es suficiente.  Tambi√©n somos personas y, por lo tanto, estamos equivocados.  Es importante aprender de sus errores y sacar conclusiones.  Las conclusiones aqu√≠ son bastante simples: <br><br><ul><li>  Es necesario rastrear y evaluar el crecimiento de la complejidad de la tarea; </li><li>  Parar a tiempo; </li><li>  Trate de ver el problema de manera m√°s amplia, ya que con el tiempo la vista est√° "borrosa" y el √°ngulo de visi√≥n se estrecha; </li><li>  No tengas miedo de eliminar el c√≥digo viejo o innecesario. </li></ul><br>  Ahora seguro, eso es todo.  Gracias por leer  A todos los c√≥digos sin esperanza! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: Sergey Khrenov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lo mejor es enemigo de lo bueno</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/466741/">https://habr.com/ru/post/466741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../466731/index.html">Extravagancia Se levanta septiembre</a></li>
<li><a href="../466733/index.html">Bienvenido a DINS Java TARDE 18 de septiembre</a></li>
<li><a href="../466735/index.html">Una manera f√°cil de crear una alerta de voz en el sistema de automatizaci√≥n del hogar ("Smart Home")</a></li>
<li><a href="../466737/index.html">Por qu√© fall√≥ la red social de Google+</a></li>
<li><a href="../466739/index.html">Lo mejor es enemigo de lo bueno.</a></li>
<li><a href="../466745/index.html">El primer lugar de trabajo o c√≥mo comenzar a desarrollar API en Node.js</a></li>
<li><a href="../466747/index.html">Desarrolladores de Mitap iOS en Redmadrobot</a></li>
<li><a href="../466753/index.html">Administraci√≥n de red r√°pida y eficiente - Network MACMonitor</a></li>
<li><a href="../466755/index.html">La computadora te har√° sabrosa</a></li>
<li><a href="../466757/index.html">El primer mitap de Flutter en San Petersburgo - 26 de septiembre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>