<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ฟ ๐ ๐ ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ ุฏุงุฎู SQL Server ๐ฆ ๐๐ป ๐คฐ๐ฟ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฌูููุง : ุฅุฐู ุ ูู ุบููุฑ ุนููู ููู ุฃูุณุ 
 ููุดุง : ููุณ ุฃูุง 
 ููุณูู : ููุณ ุฃูุง 
 - ุดุจุงุจ ุ ูู ูููููุง ุงูุญุตูู ุนูู ุฌูุชุ 
 Seryozha : ููุฏ ุญุงู ุงูููุช! 
 ููุฏ ูุฑุช ุฃุณุจู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ ุฏุงุฎู SQL Server</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419919/" style=";text-align:right;direction:rtl">  <b>ุฌูููุง</b> : <i>ุฅุฐู ุ ูู ุบููุฑ ุนููู ููู ุฃูุณุ</i> <br>  <b>ููุดุง</b> : <i>ููุณ ุฃูุง</i> <br>  <b>ููุณูู</b> : <i>ููุณ ุฃูุง</i> <br>  - <i>ุดุจุงุจ ุ ูู ูููููุง ุงูุญุตูู ุนูู ุฌูุชุ</i> <br>  <b>Seryozha</b> : <i>ููุฏ ุญุงู ุงูููุช!</i> <br>  ููุฏ ูุฑุช ุฃุณุจูุนูู ... <br><br>  <b>ุฌูููุง</b> : <i>ูุง ุฑูุงูุ</i> <br>  - <i>ูุนู ุ ุฃูู ุชุฑุชูุจุ</i> <br>  <b>ุฌูููุง</b> : <i>ูุง</i> <s><i>ูุนูุฉ</i></s> <i>(...</i> <br><br>  ููุฐุง ุจุฏุฃ ูู ุดูุก.  ุญุณูุง ุ ูุงุฐุง ุ ูู ุญุฑู ููู ุณุทุฑ ูุฑุชูุจุ <br><br>  ุฃู ุฑุจูุง ุณูุญุฏุซ ูู ูุฐุง ุจููุฑุฏูุ) ุนูุฏ ูุฐู ุงูููุทุฉ ุ ูุจุฏุฃูู ูู ุงูุชูููุฑ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชู ุชุดุบูู ูุดุบูุงุช DDL</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุฌุฏูู ุงูุฒููู</a> ูุงูุตูุฑุฉ.  ุญููุง ุ ุณูููู ุจุชุฎุฒูู ุงูุฅุตุฏุงุฑุงุช ูู ุงูุฏุงุฎู <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SQL Server'a</a> !) <br><br><img src="https://habrastorage.org/webt/dn/fe/f3/dnfef3bqd49qysawcaxvuuiasdi.jpeg"><br><br><a name="habracut"></a><br>  ุฃููุงู ุ ูู ุจุฅูุดุงุก ุงูุฌุฏุงูู ุงูุชู ุณูุชู ุชุฎุฒูู ุงูุฅุตุฏุงุฑุงุช ูููุง <br><br><pre style=";text-align:right;direction:rtl"><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">master</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-comment"><span class="hljs-comment">--     IF NOT EXISTS ( SELECT 1 FROM sys.objects WHERE name = 'VersionControlHistory' AND type = 'U' ) CREATE TABLE dbo.VersionControlHistory( Id INT NOT NULL, Event sysname NOT NULL, Db sysname NOT NULL, Sch sysname NOT NULL, Object sysname NOT NULL, Sql XML NOT NULL, Login sysname NOT NULL, StartDate DATETIME2(0) NOT NULL, EndDate DATETIME2(0) NOT NULL ) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY] GO --      IF NOT EXISTS ( SELECT 1 FROM sys.objects WHERE name = 'VersionControl' AND type = 'U' ) CREATE TABLE dbo.VersionControl( Id INT IDENTITY(1,1) NOT NULL CONSTRAINT PK_VersionControl PRIMARY KEY NONCLUSTERED, Event sysname NOT NULL, Db sysname NOT NULL, Sch sysname NOT NULL, Object sysname NOT NULL, Sql XML NOT NULL, Login sysname NOT NULL, StartDate DATETIME2(0) GENERATED ALWAYS AS ROW START NOT NULL, EndDate DATETIME2(0) GENERATED ALWAYS AS ROW END NOT NULL, PERIOD FOR SYSTEM_TIME (StartDate, EndDate) ) WITH ( SYSTEM_VERSIONING = ON ( HISTORY_TABLE = dbo.VersionControlHistory ) ) GO</span></span></code> </pre> <br>  ูู ุงูููู ุฃู ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ูููุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฏูู ุงูุฒููู.</a> <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุนุฏ ุฅูุดุงุฆูุง ุ ูุง ููููู ุชุทุจูู ุฃูุงูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DDL</a> ุนูู ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ ุฃู ุงูุชุงุฑูุฎูุฉ.  ููุง ููููู ุญุฐู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฏูู ุงูุฒููู</a> </li><li style=";text-align:right;direction:rtl">  ูุง ููููู ุชุบููุฑ ุงูุจูุงูุงุช ูู ุงูุฌุฏูู ุงูุชุงุฑูุฎู </li></ol><br>  ุงูููุฏ ุงูุซุงูู ููุงุณุจูุง ุ ูููู ูุงุฐุง ููุนู ูุน ุงูุฃููุ <br><br>  ุงูุฎูุงุฑุฒููุฉ ูู ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--        ALTER TABLE dbo.VersionControl SET ( SYSTEM_VERSIONING = OFF ); /* -  */ --    : ALTER TABLE dbo.VersionControl SET ( SYSTEM_VERSIONING = ON ( HISTORY_TABLE = dbo.VersionControlHistory, DATA_CONSISTENCY_CHECK = OFF );</span></span></code> </pre><br>  ุนูู ุงูุฑุบู ูู ุนุฏู ูุฌูุฏ ุฃู ููุงุฑุณ ุนูู ุงูุฌุฏูู ุญุชู ุงูุขู ุ ุงููุฃูุง ุจุฅุฌุฑุงุกุงุชูุง <b>ููุธุงุฆููุง</b> ุ ููุง ุฅูู ุฐูู <b>INIT</b> ุงููููุฒ ุ ูุงูุฐู ูุนูู ูู ุญุงูุชูุง ุงูููุถุน ุงูุฃููู <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">query</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>), @<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) = N<span class="hljs-string"><span class="hljs-string">' USE [db] INSERT INTO MASTER.dbo.VersionControl WITH (TABLOCKX) ( Event, Db, Sch, Object, Sql, Login ) SELECT ''INIT'' AS Event, DB_NAME(), ss.name AS Sch, so.name AS Object, CONCAT(''&lt;query&gt;&lt;![CDATA['', sasm.definition, '']]&gt;&lt;/query&gt;'' ), SUSER_SNAME() AS Login FROM sys.objects AS so JOIN sys.schemas AS ss ON ss.schema_id = so.schema_id JOIN sys.all_sql_modules AS sasm ON sasm.object_id = so.object_id WHERE so.is_ms_shipped = 0 AND NOT EXISTS ( SELECT 1 FROM MASTER.dbo.VersionControl AS vc WHERE vc.Db = ''[db]'' AND vc.Sch = ss.name AND vc.Object = so.name ); '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">databases</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rn <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> sysname); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">databases</span></span> (rn, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rn, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.databases <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> owner_sid != <span class="hljs-number"><span class="hljs-number">0x01</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @i <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">max</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(rn) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">databases</span></span>), @<span class="hljs-keyword"><span class="hljs-keyword">error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>), @db sysname; WHILE @i &lt; @max <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">query</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span>(@<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>, <span class="hljs-string"><span class="hljs-string">'[db]'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>), @db = <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">databases</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> rn = @i; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_executesql @<span class="hljs-keyword"><span class="hljs-keyword">query</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @i += <span class="hljs-number"><span class="hljs-number">1</span></span>; CONTINUE; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> TRY <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> CATCH <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">error</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">CONCAT</span></span>( <span class="hljs-string"><span class="hljs-string">'XML Parsing error. In this case that''s mean one of ['</span></span>, @db, <span class="hljs-string"><span class="hljs-string">'] object is invalid for convert to XML'</span></span> ); PRINT @error; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @i += <span class="hljs-number"><span class="hljs-number">1</span></span>; CONTINUE; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> CATCH; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; GO</code> </pre><br>  ูุฃู  ุณุชุญุฏุซ ุงูุชุบููุฑุงุช ุนูู ุงููุงุฆูุงุช ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุจุงุฑุฉ UPDATE</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุณููุธุฑ</a> ุบุงูุจูุง ุฅูู ุงูุฅุตุฏุงุฑุงุช ุญุณุจ ุงูููุชุงุญ: ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููุฎุทุท ูุงุณู ุงููุงุฆู ุ ุงูููุฑุณ ูุณุชุฏุนู! <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">IF NOT EXISTS ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.indexes <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = <span class="hljs-string"><span class="hljs-string">'IX_VersionControl_upd_key'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> IX_VersionControl_upd_key <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> MASTER.dbo.VersionControl (Db, Sch, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">INCLUDE</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Sql</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Event</span></span>, Login);</code> </pre><br>  ูู ุดูุก ุฌุงูุฒ ูุจุฏุก ุชุฎุฒูู ุงูุฅุตุฏุงุฑุงุช ูุณูุณุงุนุฏูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดุบู DDL</a> ูุฐุง <br><br>  <b>ูุงู!</b>  ูุฃู  ุชูุฌุฏ ุฌุฏุงูู ุงูุฅุตุฏุงุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช <b>ุงูุฑุฆูุณูุฉ</b> ุ ุจุนุฏ ุฅูุดุงุก ูุดุบู ุ ูุง ูููู ูุฃู ุดุฎุต ููุณ ูุฏูู ุญููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฐู ุชุนุฏูู ุงููุงุฆูุงุช ุฃู ุฅูุดุงุคูุง ุฃู ุญุฐููุง <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">IF EXISTS ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.server_triggers <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> = <span class="hljs-string"><span class="hljs-string">'tr_VersionControl'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> tr_VersionControl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SERVER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> tr_VersionControl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SERVER</span></span> <span class="hljs-comment"><span class="hljs-comment">--WITH ENCRYPTION --   /*      : https://docs.microsoft.com/ru-ru/sql/relational-databases/triggers/ddl-events?view=sql-server-2017 */ FOR CREATE_TABLE, ALTER_TABLE, DROP_TABLE, CREATE_VIEW, ALTER_VIEW, DROP_VIEW, CREATE_FUNCTION, ALTER_FUNCTION, DROP_FUNCTION, CREATE_PROCEDURE, ALTER_PROCEDURE, DROP_PROCEDURE, CREATE_ASSEMBLY, ALTER_ASSEMBLY, DROP_ASSEMBLY, CREATE_INDEX, ALTER_INDEX, DROP_INDEX, CREATE_TRIGGER, ALTER_TRIGGER, DROP_TRIGGER, RENAME AS BEGIN SET NOCOUNT ON; UPDATE vs SET vs.Event = ev.EventType, vs.Sql = CONCAT('&lt;query&gt;&lt;!CDATA', ev.Sql, '&gt;&lt;/query&gt;' ), vs.Login = ev.Login FROM MASTER.dbo.VersionControl AS vs JOIN ( SELECT * FROM ( VALUES ( EVENTDATA().value( '(/EVENT_INSTANCE/EventType)[1]', 'NVARCHAR(128)' ), EVENTDATA().value( '(/EVENT_INSTANCE/SchemaName)[1]', 'NVARCHAR(128)' ), EVENTDATA().value( '(/EVENT_INSTANCE/ObjectName)[1]', 'NVARCHAR(128)' ), EVENTDATA().value( '(/EVENT_INSTANCE/TSQLCommand/CommandText)[1]', 'NVARCHAR(MAX)' ), EVENTDATA().value( '(/EVENT_INSTANCE/LoginName)[1]', 'NVARCHAR(128)' ) )) AS Event (EventType, Sch, Object, Sql, Login ) ) ev ON vs.Db = DB_NAME() AND vs.Sch = ev.Sch AND vs.Object = ev.Object ; END GO</span></span></code> </pre><br>  ููุฑุงุญุฉ ุงุณุชุฎุฏุงู ูุฐุง ุงููุธุงู ุ ุชู ุงูุชุฑุงุญ ุงูุฅุฌุฑุงุก ุฃุฏูุงู. <br><br>  ุฅูู ุณูู ุงูุงุณุชุฎุฏุงู.  ุณูู ุชุณุงุนุฏูุง ุงูุจุงุฏุฆุฉ <b>sp_ ูู</b> ุงููุตูู ุฅูู ุงูุฅุฌุฑุงุก ุฏูู ุชุญุฏูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููุฎุทุท.  ูุชู ุชุนุจุฆุฉ ุงููุนููุงุช ุจุดูู ุญุฏุณู.  ููููู ุชุญุฏูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุท ูุณูุฑู ุงููุงุฆูุงุช ุงููุฑุชุจุทุฉ ุจูุง ููุท ุทูุงู ุงูููุช ุ ูููู ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู ุงููุฎุทุท ูุงููุงุฆู ููุณู ุ ูุจุงูุทุจุน ุงููุทุงู ุงูุฒููู ุงูุฐู ุชู ุฅุฌุฑุงุก ุงูุชุบููุฑุงุช ุนููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> dbo.sp_Vc @db sysname = <span class="hljs-string"><span class="hljs-string">'%'</span></span>, @sch sysname = <span class="hljs-string"><span class="hljs-string">'%'</span></span>, @obj sysname = <span class="hljs-string"><span class="hljs-string">'%'</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> DATETIME2(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">to</span></span> DATETIME2(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; IF @from IS NULL AND @to IS NULL <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> master.dbo.VersionControl <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Db <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @db <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> Sch <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @sch <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @obj <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> StartDate <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> master.dbo.VersionControl <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> SYSTEM_TIME <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Db <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @db <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> Sch <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @sch <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @obj <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> StartDate <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre><br>  ูููุง ููู ุฃูุซูุฉ ุนูู ุงุณุชุฎุฏุงู ุงูุฅุฌุฑุงุก <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--        sp_Vc; /*          */ sp_Vc 'dwh'; /*            */ sp_Vc 'dwh', 'dbo'; /*      ,        */ sp_Vc 'dwh', 'dbo', 'MyObject'; /*      , ,       1-  9-  */ sp_Vc 'dwh', 'dbo', 'MyObject', '20180501 00:00:00', '20180509 00:00:00';</span></span></code> </pre><br>  ููููู ุชุซุจูุช ูุฐุง ุงูุฅุทุงุฑ ุงููุตุบุฑ ูู ูุณุชูุฏุนู ุ ูุฅุฐุง ูุงู ุฅุตุฏุงุฑ SQL Sever ุงูุฎุงุต ุจู ุฃุตุบุฑ ูู 2016 ุ ูุฃูุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุจุงูููุงุณุจุฉ ุ ูุญู ูุณุชุฎุฏู ูุฐุง ุงูุฅุตุฏุงุฑ ุงูุขู ุ ููููู ููุณ ุฑุงุฆุนูุง. <br><br><h3 style=";text-align:right;direction:rtl">  ูู ุงูุฎุชุงู </h3><br>  ูู ุฃุชููู ุฃุจุฏูุง ูู ูุฒููุฉ ุงูุงุณุชูุชุงุฌ <b>.</b>  ู <b>&amp; _lt ุ</b>  ุจุฏูุงู ูู ุงูุนูุงูุงุช <b>&gt;</b> ู <b>&lt;</b> ูู ุงูุฌุฏูู <b>master.dbo.VersionControl</b> ุญุณุจ ุงูุญูู <b>Sql</b> .  ุฅุฐุง ููุช ุชุณุชุทูุน ุงููุณุงุนุฏุฉ ูู ูุฐุง ุฃู ูุฏูู ุฃู ุฃููุงุฑ ุ ูุฃูุง ูู ุงูุชุธุงุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุทูุจ ุณุญุจ</a> . <br><br>  ุดูุฑุง ูููุชู ุ ูุถุน ุงููุฌูู ูุงููููุจ ูุงูุณูุงู. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar419919/">https://habr.com/ru/post/ar419919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar419907/index.html">ูุตุงุฆุญ ูุฅุทูุงู ุฃูุนุงุจ ุงูุฌูุงู: ุงูุฌุฒุก 2 ุ ุงูุฅุทูุงู ุงูุนุงููู</a></li>
<li><a href="../ar419911/index.html">ุจูุงุก ูุฏุงุฑุงุช ุงูุฃุฌุฑุงู ุงูุณูุงููุฉ ุจุงุณุชุฎุฏุงู Python</a></li>
<li><a href="../ar419913/index.html">ุงูููุง ูุงูููุฒู ุงูุฐูู. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar419915/index.html">ุงูุชุฑุงุจุท ูุฎุงุฏู SSH ูู initramfs</a></li>
<li><a href="../ar419917/index.html">ุงูุดุจูุงุช ุงูุนุตุจูุฉ: ุชูููุฐ ูููุฉ ุงููุทุฑ ุนูู Tensor Flow ู Python</a></li>
<li><a href="../ar419921/index.html">ููููุฉ ุฅุณูุงุท 10 ููููู ุนูุจุฉ ูู ุงูุซุงููุฉ</a></li>
<li><a href="../ar419923/index.html">ุนููู ุงููุคูุช ุ ุณุงุนุงุช ุงูููุญุฉ ุงูุฃู</a></li>
<li><a href="../ar419925/index.html">ุงูุชุญูู ูู ุฅุตุฏุงุฑ ุงููููุงุช ุงููุฑุฏูุฉ ุจุงุณุชุฎุฏุงู GitHub Gist</a></li>
<li><a href="../ar419927/index.html">[DotNetBook] ุงูุงุณุชุซูุงุกุงุช: ุงูุชุจ ุจููุฉ ุงููุธุงู</a></li>
<li><a href="../ar419929/index.html">[DotNetBook] ุฃุญุฏุงุซ ุงูุงุณุชุซูุงุก ูููููุฉ ุงูุญุตูู ุนูู StackOverflow ู ExecutionEngineException ูู ุงูุจุฏุงูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>