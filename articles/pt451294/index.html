<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äç‚úàÔ∏è üèñÔ∏è üîÅ Como adicionei fun√ß√µes ao carro via CAN, n√£o consigo programar ‚ÜòÔ∏è ü§© üìª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O objetivo deste artigo √© falar sobre minha experi√™ncia com modifica√ß√µes de carros e experimentos com o barramento CAN. 

 Como tudo come√ßou 
 Primeir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como adicionei fun√ß√µes ao carro via CAN, n√£o consigo programar</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451294/"> <a href=""><img src="https://habrastorage.org/webt/xo/k7/t2/xok7t2l-qmakairvtmxiduaj6pg.jpeg"></a> <br><br>  O objetivo deste artigo √© falar sobre minha experi√™ncia com modifica√ß√µes de carros e experimentos com o barramento CAN. <br><br><h1>  Como tudo come√ßou </h1><br>  Primeiro, decidi adicionar uma c√¢mera frontal ao meu Chevrolet Cruze 2017.  Como o carro j√° possui uma c√¢mera de vis√£o traseira de f√°brica, em um n√≠vel alto, foi necess√°rio descobrir duas coisas: <br><br><ol><li>  A maneira de transferir v√≠deo da c√¢mera frontal, que adicionarei. <br></li><li>  Um m√©todo para exibir fotos de uma c√¢mera de vis√£o traseira a qualquer momento. </li></ol><a name="habracut"></a><br>  A parte do v√≠deo foi simples.  Por experi√™ncia anterior, eu sabia que voc√™ pode fazer um mixer de v√≠deo em um rel√©. <br><br>  A partida na tela acabou sendo mais complicada e, ap√≥s alguma investiga√ß√£o, cheguei √† conclus√£o de que o carro deveria enviar um sinal da c√¢mera de vis√£o traseira para a tela atrav√©s de algum tipo de barramento de dados. <br><br><h1>  Barramento CAN </h1><br>  A Chevrolet tem dois barramentos de dados diferentes.  O primeiro √© o CAN padr√£o, r√°pido (500 Kbps) e confi√°vel, usado para dados cr√≠ticos.  O segundo √© o que a GM chama de LAN (GMLAN), um barramento mais antigo e mais lento (33,3 Kbps) usado para dados que n√£o s√£o de seguran√ßa. <br><br>  Eu precisava de uma maneira de ouvir o tr√°fego no CAN, ou seja, um sniffer.  O dispositivo PCAN √© incrivelmente √∫til para esse fim. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf0/18f/db5/cf018fdb5119f22edb383bc4b77f92cd.jpg"><br>  <i><font color="gray">Pico pode</font></i> <br><br>  O Peak Can (PCAN) √© um dispositivo USB capaz de interceptar e transmitir mensagens.  Gra√ßas ao software Pcan View, voc√™ pode come√ßar sem muito treinamento. <br><br>  Como a c√¢mera de vis√£o traseira √© menos importante para a seguran√ßa do que outros componentes, sugeri que os dados que voc√™ est√° procurando provavelmente estejam no barramento GMLAN. <br><br>  O ponto de acesso mais f√°cil √© o conector OBD2.  Conectei o Peak Can ao barramento GMLAN, iniciei o software e imediatamente ouvi o tr√°fego. <br><br><h1>  Integra√ß√£o </h1><br>  O objetivo era fazer a engenharia reversa da chamada da c√¢mera de vis√£o traseira.  Para fazer isso, com o farejador ligado, inverti o carro para que ele ligasse a tela e tentei estacionar v√°rias vezes.  Durante todo esse processo, notei um √∫nico ID com mensagens que imitavam sequencialmente minhas a√ß√µes. <br><br>  Depois estacionei e, atrav√©s do Pcan View, tentei transmitir a mesma mensagem que vi quando a tela foi ligada e desligada.  Em um piscar de olhos, eu j√° estava interagindo com o √¥nibus. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149439" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Passagem de mensagem PCAN</font></i> <br><br>  No entanto, eu n√£o planejava viajar constantemente com um laptop.  O que era necess√°rio era uma maneira de automatizar essas fun√ß√µes - e aqui o Arduino foi √∫til.  A capacidade de receber diretamente 12V de energia em combina√ß√£o com um grande n√∫mero de recursos e suporte na Internet tornou essa escolha √≥bvia. <br><br>  Al√©m do Arduino, eu precisava de dois componentes para concluir o projeto: o m√≥dulo CAN e o m√≥dulo de rel√©.  Em ess√™ncia, o Arduino √© o c√©rebro que executa e executa c√≥digo.  O m√≥dulo CAN oferece a capacidade de interagir com o barramento de dados, e o rel√© fornece energia √† c√¢mera frontal e tamb√©m atua como um mixer de v√≠deo entre ela e a c√¢mera de vis√£o traseira. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd2/8b9/335/fd28b9335da54c5e1f490e0439bf6694.jpg"><br>  <i><font color="gray">M√≥dulo Mcp2515 (superior), Arduino Uno (central), m√≥dulo de rel√© (inferior)</font></i> <br><br>  Depois de adicionar e configurar as bibliotecas apropriadas, o Arduino fez uma conex√£o com o carro. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149432" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Ouvindo o tr√°fego atrav√©s do Arduino</font></i> <br><br>  Como eu j√° sabia que poderia iniciar a exibi√ß√£o, comecei a pensar em COMO fazer isso.  A id√©ia inicial era instalar um bot√£o de chamada instant√¢nea especial no painel, mas comecei a pensar: "O que mais posso usar na rede como gatilho?" <br><br>  Durante os experimentos, descobri que as mensagens com o ID correspondente ao bot√£o "Cancelar controle de cruzeiro" tamb√©m s√£o transmitidas pelo barramento GMLAN.  Isso foi ideal porque o controle de cruzeiro √© ativado a velocidades acima de 65 km / h quando uso a c√¢mera frontal e a velocidades abaixo de 15 km / h a c√¢mera de vis√£o traseira liga para ajudar no estacionamento, para que nunca sobrepor.  Depois de escrever um c√≥digo, consegui que o Arduino reconhecesse quando o bot√£o Cancelar controle de cruzeiro √© pressionado. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149460" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Reconhecimento de clique √∫nico</font></i> <br><br>  No entanto, n√£o queria que a c√¢mera fosse ativada toda vez que cancelasse o controle de cruzeiro, ent√£o decidi que a melhor abordagem √© transform√°-lo (de fato) em um bot√£o multifuncional.  A c√¢mera √© ativada apenas se o bot√£o for "pressionado duas vezes". <br><br>  Ap√≥s um longo fim de semana explorando a fun√ß√£o millis e depurando o c√≥digo, programei com √™xito o reconhecimento de toque duplo. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149449" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Reconhecimento de toque duplo</font></i> <br><br>  E quando vinculei √†s minhas equipes o controle da exibi√ß√£o, obtive uma utilidade bastante interessante. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149421" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Toque duas vezes + comandos</font></i> <br><br><h1>  Funcionalidade </h1><br>  Agora tive a oportunidade de ligar e desligar a tela, mas havia um problema - e a c√¢mera de vis√£o traseira?  Eu precisava que eles trabalhassem em conjunto com a c√¢mera frontal, como se tivessem sido montadas assim na f√°brica. <br><br>  No fluxograma, descrevi como o represento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/771/63e/cca/77163ecca613e040e82d2aae9db9c511.jpg"><br><br>  Eu rapidamente percebi que, para um sistema assim, voc√™ precisa conhecer o estado de tr√™s vari√°veis ‚Äã‚Äãa qualquer momento: <br><br><ul><li>  M√≥dulo da c√¢mera frontal: o motorista ligou ou desligou? <br></li><li>  Visor da c√¢mera: a imagem est√° ligada ou desligada? <br></li><li>  Reverso: carro em r√© ou n√£o? </li></ul><br>  Sem experi√™ncia em programa√ß√£o, era muito dif√≠cil, e todo o meu tempo livre eu pensava em diferentes abordagens. <br><br>  No final, eu consegui! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149405" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Monitoramento ativo</font></i> <br><br>  Agora eu era capaz de implementar a l√≥gica operacional que controla o rel√©. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/333149469" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Controle de rel√©</font></i> <br><br>  Durante todo o processo, aprendi mais sobre o Arduino e notei que a vers√£o Nano √© capaz de fazer tudo o que voc√™ precisa, embora tenha um tamanho menor e pre√ßo mais baixo.  √â ideal para instala√ß√£o permanente em um carro.  Desenvolvi um modelo e imprimi um estojo em uma impressora 3D para colocar os componentes como uma unidade compacta para instala√ß√£o. <br><br><img src="https://habrastorage.org/webt/o9/dq/vd/o9dqvdst9apwqd3ufvmr-l7ppqy.png"><br>  <i><font color="gray">Caso 3D</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/bc4/e86/6afbc4e8629d4fd6255f6f79f8344b8d.png"></div><br><br><h1>  Todos juntos </h1><br>  Finalmente chegou o dia em que vi os resultados.  Embora voc√™ ainda precise mexer no tempo, foi bom ver que o m√≥dulo funciona corretamente. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/334454520" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">Ligar / desligar o modo de estacionamento, ligar / desligar a c√¢mera frontal, alternar automaticamente para a c√¢mera de vis√£o traseira e voltar automaticamente</font></i> <br><br>  Em geral, essa experi√™ncia me ensinou muito e abriu meus olhos para a possibilidade de integra√ß√£o direta com o barramento CAN.  √â bastante surpreendente o que pode ser alcan√ßado conectando-se em dois fios. <br><br><h1>  No futuro </h1><br>  No futuro, pretendo escrever um tutorial detalhado sobre como adicionar funcionalidades adicionais aos bot√µes existentes no seu carro usando componentes e software gratuitos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451294/">https://habr.com/ru/post/pt451294/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451278/index.html">An√°lise da Wavelet - Parte 1</a></li>
<li><a href="../pt451280/index.html">Os metais mais interessantes</a></li>
<li><a href="../pt451282/index.html">Buracos negros na an√°lise da Web: quantos dados s√£o perdidos no GA e por que</a></li>
<li><a href="../pt451286/index.html">Roskomnadzor, que merecemos</a></li>
<li><a href="../pt451292/index.html">RxDart: transforma√ß√µes m√°gicas de fluxos</a></li>
<li><a href="../pt451296/index.html">Anunciado pelo ML.NET 1.0</a></li>
<li><a href="../pt451298/index.html">Como criar um console de jogos com um estojo solicitando uma placa de circuito impresso</a></li>
<li><a href="../pt451302/index.html">Principais empresas de terceiriza√ß√£o de TI</a></li>
<li><a href="../pt451304/index.html">Yandex "tip": como maximizar os lucros em uma assinatura paga</a></li>
<li><a href="../pt451306/index.html">QEMU.js: agora a s√©rio e com WASM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>