<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçõ üßìüèª üî† Como eu criei o Recycle! VR üëµüèæ üßõüèº üí∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No artigo anterior, tentamos criar uma cena b√°sica no A-Frame para experimentar os conceitos b√°sicos da estrutura na pr√°tica. Neste artigo, gostaria d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu criei o Recycle! VR</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443062/"><img src="https://habrastorage.org/webt/zw/1k/9x/zw1k9xfuttgxodgleuo-ksko4nq.png"><br><br>  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior,</a> tentamos criar uma cena b√°sica no A-Frame para experimentar os conceitos b√°sicos da estrutura na pr√°tica.  Neste artigo, gostaria de compartilhar minha experi√™ncia na cria√ß√£o de um jogo no A-Frame - Recycle!  VR  O reposit√≥rio do projeto est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seguinte link</a> . <br><br><h2>  Reciclagem!? </h2><br>  A ideia de criar um jogo surgiu quase imediatamente assim que descobri o Web VR.  Embora, em geral, acredito que os jogos na Web, em qualquer caso, sejam inferiores a bons projetos, mesmo para dispositivos m√≥veis, sem mencionar computadores pessoais e consoles.  Mas, parece-me, o jogo √© o teste mais dif√≠cil.  Comecei a pensar exatamente no que posso fazer.  Eu assisti a outros projetos e fiquei imediatamente impressionado com a oportunidade de pegar algo usando o controlador.  E desde que eu estou associado a uma organiza√ß√£o que est√° envolvida na coleta de lixo separada h√° algum tempo, a resposta veio por si s√≥.  Reciclagem.  N√≥s pegamos o lixo e jogamos no lixo.  O que poderia ser mais f√°cil?  Mas tudo acabou n√£o sendo t√£o simples, e isso, de fato, ser√° discutido mais adiante. <br><a name="habracut"></a><br><h2>  Sele√ß√£o de framework </h2><br>  No in√≠cio do trabalho no jogo, eu conhecia apenas duas estruturas mais ou menos s√©rias: React 360, A-Frame.  Obviamente, o A-Frame era mais adequado para criar o jogo.  Sim, agora eu sei que ainda existe um mecanismo de jogo PlayCanvas que tamb√©m suporta VR, mas √© tarde demais.  Al√©m disso, descobriu-se que o A-Frame tamb√©m n√£o √© ruim para a cria√ß√£o de jogos. <br><br><h2>  Por onde come√ßar? </h2><br>  Comecei estudando exemplos oficiais de jogos de desenvolvedores do A-Frame.  O benef√≠cio destes n√£o √© suficiente.  A-Blast, A-Painter, Museum, Super Craft e agora tamb√©m Gunters of Oasis.  De todos os projetos apresentados, gostei mais do A-Blast - um jogo de tiro em que voc√™ precisa lutar com as criaturas mais fofas do universo.  Portanto, eu queria levar este jogo como modelo para o meu.  Mas n√£o deu certo.  E a raz√£o para isso foi a estrutura do jogo.  Pareceu-me que ela estava muito bagun√ßada e sem pensar.  Talvez n√£o seja necess√°rio mais, mas eu queria fazer algo mais conveniente e f√°cil de entender. <br><br><h2>  Estrutura </h2><br>  A estrutura do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A-Blast</a> representa apenas um ponto de entrada - o arquivo index.html, que cont√©m uma cena com todos os ativos, entidades b√°sicas do jogo, controles e tudo em geral. <br><br><img src="https://habrastorage.org/webt/_t/gy/cv/_tgycvogik29i2jemys2srlpuuy.png"><br><br>  Como voc√™ pode ver na captura de tela, al√©m dos componentes e sistemas necess√°rios (o A-Frame usa o padr√£o Entity Component System), tamb√©m existem marcadores e inimigos - essencialmente os mesmos sistemas, mas por algum motivo t√™m seu pr√≥prio inv√≥lucro.  Geralmente diga que esse c√≥digo n√£o √© f√°cil de entender.  Ent√£o, decidi pensar em como esse c√≥digo pode ser estruturado.  A primeira id√©ia √© dividir a cena em suas partes constituintes.  Por que um roteador e modelos seriam √∫teis, o que renderizaria essa ou aquela parte da cena.  Depois de pesquisar o primeiro e o segundo (n√£o, n√£o cinco minutos), n√£o encontrei nada.  Embora eu seja um defensor da regra, n√£o escreva bicicletas, mas desta vez eu tive que escrever minha decis√£o.  Embora, em algum lugar de duas a tr√™s semanas eu me deparei com modelos de Kevin Ngo.  Mas j√° era tarde demais. <br><br><h2>  Roteador e padr√µes </h2><br><img src="https://habrastorage.org/webt/sp/bm/tn/spbmtnkznus5jjfffyvhjys6xvg.gif"><br><br>  E assim, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um modelo de roteador de quadro</a> entra em cena.  O que ele pode fazer?  Como mencionado acima, sua principal tarefa √© renderizar as partes necess√°rias do jogo, por exemplo, a tela de t√≠tulo, o campo de jogo, a tela final do jogo, etc.  Como fazer isso?  Em princ√≠pio, voc√™ pode encontrar tudo o que precisa na documenta√ß√£o do m√≥dulo no github, mas, em resumo, temos o seguinte: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">router</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Routes --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-screen"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-field"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-field"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-over"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-over"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"how-to-play"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"how-to-play"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- End Routes --&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Templates --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"controls"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- End Templates --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><ol><li>  Estamos adicionando o componente do roteador √† cena. </li><li>  Adicione uma rota para cada parte do aplicativo (quadros da cena).  Uma rota para a tela inicial, outra para o campo de jogo, etc. </li><li>  Renderize modelos diretamente atrav√©s de modelos a </li><li>  Se necess√°rio, mudamos de rota <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.systems.router.changeRoute(<span class="hljs-string"><span class="hljs-string">'game-field'</span></span>);</code> </pre> <br>  <b>Nota</b> : este exemplo se refere ao c√≥digo da cena, para que possamos chamar o sistema do roteador diretamente. </li><li>  Definimos e conectamos os modelos, algo como isto: <br><br><pre> <code class="javascript hljs">AFRAME.registerTemplate(<span class="hljs-string"><span class="hljs-string">'game-field'</span></span>, <span class="hljs-string"><span class="hljs-string">` &lt;a-sub-assets&gt; &lt;a-asset-item id="glass" src="/assets/models/glass_bottle.gltf"&gt;&lt;/a-asset-item&gt; ... &lt;audio id="fail" src="/assets/sounds/fail.wav" preload&gt;&lt;/audio&gt; &lt;/a-sub-assets&gt; &lt;a-template name="button" options="text: EXIT; position: 0 1 4; rotation: 0 180 0; event: stop-game"&gt;&lt;/a-template&gt; &lt;a-entity id="indicator" indicator visible="false" position="0 1 -2" text="align: center; width: 4; color: #00A105; value: -1" &gt;&lt;/a-entity&gt; &lt;a-entity game-field-manager&gt;&lt;/a-entity&gt; `</span></span>);</code> </pre><br>  <b>Nota:</b> a-sub-assets permite carregar ativos e ativos, mas apenas com a diferen√ßa de que h√° uma verifica√ß√£o por padr√£o e se o ativo j√° tiver sido adicionado, ele n√£o ser√° adicionado novamente quando a rota for alterada. <br><br>  <b>Nota 2:</b> Normalmente voc√™ pode usar modelos apenas com a sequ√™ncia de modelos ES6.  Caso contr√°rio, ele pode se transformar em "string" + var + "string", n√£o √© legal.  Kevin, por exemplo, tem suporte para mecanismos de modelo.  Mas por que complicar, certo? <br></li></ol><br>  Assim, voc√™ pode criar uma estrutura de aplicativo conveniente que conter√° o seguinte: <i>componentes, sistemas, modelos, estados, bibliotecas</i> .  Nada mais e tudo est√° nas prateleiras. <br><br><h2>  Manipulando objetos </h2><br><img src="https://habrastorage.org/webt/zm/m1/i3/zmm1i3r-m5no1cptxljmjcwr88u.gif"><br><br>  A primeira tarefa a ser resolvida foi a manipula√ß√£o de objetos.  Eu precisava de um funcional como agarrar - arremesso.  Inicialmente, comecei a refletir sobre como criar esse componente do zero.  Puramente no n√≠vel filistino, tal reflex√£o √© permitida: temos um controlador (no caso de uma √°rea de trabalho, √© um cursor), tem uma posi√ß√£o.  Tamb√©m temos certos objetos, por exemplo cubos, eles tamb√©m t√™m uma posi√ß√£o.  Alterando a posi√ß√£o do controlador, devemos alterar a posi√ß√£o do objeto.  √â simples?  Ent√£o, na verdade sim, mas n√£o vai funcionar.  Mencionarei alguns pontos de uma lista muito longa para convenc√™-lo disso: <br><br><ul><li>  O cursor no A-Frame √© um descendente de uma c√¢mera e possui coordenadas relativas; </li><li>  A posi√ß√£o do controlador n√£o √© suficiente, voc√™ ainda precisa considerar a orienta√ß√£o, a dist√¢ncia do objeto, a posi√ß√£o da c√¢mera (player); </li><li>  Para objetos com um corpo f√≠sico, isso n√£o funcionar√°, porque as coordenadas da geometria est√£o conectadas √†s coordenadas do corpo. </li></ul><br>  √â bom que o bom Sr. Wil Murphy e seus amigos tenham <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">superado as m√£os</a> .  Essencialmente, esta biblioteca cont√©m todos os componentes necess√°rios: <br><br><ul><li>  <b>pair√°vel</b> .  Orienta√ß√£o.  Aponte o controlador ou cursor sobre a zona de colis√£o do objeto (geralmente o objeto inteiro) </li><li>  <b>agarr√°vel</b> : captura.  Pegue um objeto usando o bot√£o apropriado e arraste-o </li><li>  <b>estic√°vel</b> : segure com as duas m√£os e estique \ aperte </li><li>  <b>draggable \ dropable</b> : essencial para determinar o evento "o item foi lan√ßado em um local espec√≠fico" </li></ul><br>  Voc√™ pode encontrar tudo o que precisa sobre como configurar e conectar super m√£os no reposit√≥rio mencionado acima.  Eu s√≥ quero chamar a aten√ß√£o para v√°rias nuances: <br><br><ul><li>  Crie mixins separados para a m√£o direita e esquerda.  Separe os componentes por tipo de dispositivos suportados.  Por exemplo, a m√£o direita, al√©m de oculus-touch, vive-controls, windows-motion-controls, tamb√©m pode haver oculus-go-controls e gear-vr-controls.  A m√£o esquerda precisa estar oculta para os capacetes m√≥veis da BP.  Cada controlador deve conter m√£os de mixagem e um componente de super-m√£os.  <a href="">Um exemplo</a> ; </li><li>  Se voc√™ especificou objetos: .clsname para reycaster, n√£o se esque√ßa de adicion√°-lo a cada elemento que pode ser obtido usando o controlador, caso contr√°rio, nenhum evento para super m√£os falhar√°.  Claro, se <i>colliderEvent: raycaster-intersection</i> ; </li><li>  Arrastar com o mouse projeta as coordenadas 2D no mundo 3d, portanto √© melhor usar o cursor para a √°rea de trabalho. </li></ul><br><h2>  Adicionar f√≠sica </h2><br>  Adicionar f√≠sica a um quadro √© realmente muito simples.  Existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sistema especial</a> para isso.  √â adicionado √† cena e pronto, a f√≠sica j√° est√° no seu bolso. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">physics</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"debug: false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dynamic-body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">position</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 1 -2"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"floor"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">static-body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>Mark</b> : <i>debug: true</i> permite a visualiza√ß√£o de corpos f√≠sicos vinculados √† geometria.  √â conveniente quando voc√™ precisa "delinear" um objeto. <br><br>  Na verdade, este √© um inv√≥lucro para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cannon.js</a> que faz todo o trabalho sujo de comparar geometria e corpos f√≠sicos para voc√™.  Novamente, sobre como esse sistema funciona, voc√™ pode encontr√°-lo na descri√ß√£o do reposit√≥rio.  E gostaria de me concentrar em apenas um ponto importante para o meu jogo. <br><br>  Eu precisava ter certeza de que, ao pressionar o bot√£o no lixo, uma certa for√ßa era definida (quanto mais voc√™ mantiver o bot√£o pressionado, maior ser√° a for√ßa).  Como se viu, essa tarefa n√£o √© t√£o simples quanto parece √† primeira vista.  Bem, o que √© t√£o complicado?  - voc√™ diz, n√≥s <i>aplicamosImpluse</i> e voila.  Na verdade n√£o ... Ele define a rota√ß√£o de um objeto ao longo de um vetor aplicado ao centro do corpo.  Usando esse m√©todo, podemos apenas emular um yule.  Embora, se voc√™ definir um vetor com o √¢ngulo correto para o plano, poder√° obter algo semelhante a um empurr√£o.  Mas n√£o era disso que eu precisava. <br><br>  Como se viu, eu precisava de velocidade ao definir esse par√¢metro, o objeto inicia seu movimento em uma determinada dire√ß√£o.  Essa dire√ß√£o √© especificada pelo vetor.  E aqui come√ßa a divers√£o.  Como encontrar esse vetor?  Encontrei duas op√ß√µes: <br><br><ol><li>  Obtenha o quaternion do controlador (ou c√¢mera para a √°rea de trabalho), que descreve sua orienta√ß√£o no espa√ßo.  Crie um vetor V1 = &lt;1,1,1&gt;, multiplique pela for√ßa de arremesso e aplique a orienta√ß√£o a tudo isso. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> velocityVector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); velocityVector.multiplyScalar(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force); velocityVector.applyQuaternion(controllerQuaternion); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grabbed.body.velocity.set(velocityVector.x, velocityVector.y, velocityVector.z);</code> </pre></li><li>  Encontre a posi√ß√£o do controlador (cursor) e a posi√ß√£o do objeto que est√° sendo lan√ßado.  Calcule o vetor de dire√ß√£o para dois pontos.  Normalize o vetor.  E multiplique pela for√ßa. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> directionX = (trashPosition.x - zeroPosition.x); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> directionZ = (trashPosition.z - zeroPosition.z); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vectorsLength = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(directionX, <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(directionZ, <span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = (directionX / vectorsLength) * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> z = (directionZ / vectorsLength) * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grabbed.body.velocity.set(x , y, z );</code> </pre></li></ol><br>  Eu escolhi a segunda op√ß√£o porque nela posso contar apenas x e z.  E prepare-se, j√° que eu precisava jogar ao longo do arco para que o lixo despejado ca√≠sse na cesta, apesar do usu√°rio segurando o controlador. <br><br><h2>  Algumas palavras sobre o modelo </h2><br><img src="https://habrastorage.org/webt/vt/fl/e9/vtfle9xqpvbpak4i2su4fusxplk.png"><br><br>  Desde o in√≠cio, eu decidi fazer um jogo no estilo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">low-poly</a> .  Embora o WebGL seja capaz de renderizar cenas relativamente complexas hoje em dia, seu desempenho ainda √© inferior √†s bibliotecas avan√ßadas, como DirectX, Vulkan, Mantle, etc. Tudo depende tamb√©m do desempenho do dispositivo do usu√°rio.  Como gostaria de me concentrar em capacetes m√≥veis da BP mais acess√≠veis (Oculus Go, Gear VR), acho que o baixo poli √© uma das poucas solu√ß√µes para criar um aplicativo ou jogo de VR.  Embora, √© claro, tudo dependa do volume. <br><br>  Ok, low-poly √© t√£o low-poly, mas como fazer tudo isso?  Tudo √© muito simples, existe uma boa ferramenta de c√≥digo aberto - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Blender</a> .  Acredite, ele √© capaz de muito, mas para tarefas simples ele n√£o √© muito adequado.  Existem muitos materiais de treinamento relacionados √† modelagem no Blender e n√£o ser√° dif√≠cil encontr√°-los.  Eu s√≥ queria focar sua aten√ß√£o em v√°rios pontos relacionados ao desenvolvimento web: <br><br><ol><li>  O exportador de tr√™s js est√° desatualizado.  Precisa encontrar e fornecer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exportador de GLTF</a> .  GLTF √© um formato especial projetado para a web.  E sim, isso √© JSON. </li><li>  O GLTF n√£o suporta o Cycles Renderer, portanto voc√™ deve usar o Blender Renderer.  E isso significa que n√£o haver√° n√≥s legais, transforma√ß√µes de cores, realces de metal (podem ser feitos de maneira diferente). </li><li>  Voc√™ precisa exportar apenas o item selecionado.  Voc√™ n√£o precisa de c√¢meras e luzes extras?  Arquivo&gt; Exportar&gt; gltf 2.0.  No menu esquerdo, Exportar GLTF 2.0&gt; Exportar somente selecionado. </li><li>  Come√ßamos a exportar da posi√ß√£o &lt;0, 0, 0&gt; no Blender.  √â melhor dimensionar no mesmo local, para que mais tarde voc√™ n√£o use o componente de escala em um quadro. </li><li>  Se voc√™ desenhar um espa√ßo aberto como em Reciclar!  VR, voc√™ precisa adicionar objetos apenas para onde o jogador possa olhar teoricamente.  Atr√°s, atr√°s das casas, na Reciclagem!  existem algumas √°rvores e somente no local em que o usu√°rio pode v√™-las.  N√£o √© necess√°rio sobrecarregar a cena. </li><li>  Se voc√™ precisar alterar o material do modelo, precisar√° esperar at√© ele carregar, obter o pr√≥prio modelo, retirar todos os n√≥s (o GLTF cont√©m informa√ß√µes n√£o apenas sobre malhas) <br><br><pre> <code class="javascript hljs">e.detail.model.traverse(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.isMesh) { node.material.color = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Color(someColor); } });</code> </pre></li></ol><br><h2>  Em conclus√£o </h2><br>  Obrigado a todos pela aten√ß√£o!  Lembro novamente que o reposit√≥rio do projeto est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seguinte link</a> .  Quem quiser trazer algo novo para este jogo - seja bem-vindo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443062/">https://habr.com/ru/post/pt443062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443052/index.html">Lindo rel√≥gio preciso de um smartphone antigo</a></li>
<li><a href="../pt443054/index.html">Uma sele√ß√£o de utilit√°rios para um programador no Linux</a></li>
<li><a href="../pt443056/index.html">Segundo paciente com HIV atinge remiss√£o</a></li>
<li><a href="../pt443058/index.html">Arquitetura limpa. Parte I - Introdu√ß√£o</a></li>
<li><a href="../pt443060/index.html">A nave estelar alcan√ßar√° Marte?</a></li>
<li><a href="../pt443064/index.html">Sonda israelense voa para a lua</a></li>
<li><a href="../pt443066/index.html">S√≥crates apaixonado: quem realmente lan√ßou os fundamentos da filosofia ocidental</a></li>
<li><a href="../pt443070/index.html">Sobre id√©ias prematuras e oportunas no exemplo dos irm√£os Graco</a></li>
<li><a href="../pt443080/index.html">Discos r√≠gidos em laptops e desktops podem ser uma fonte para ouvir conversas de pessoas pr√≥ximas</a></li>
<li><a href="../pt443082/index.html">Por que voc√™ n√£o deve olhar para os outros ao aprender um idioma</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>