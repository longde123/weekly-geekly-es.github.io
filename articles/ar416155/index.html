<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ข๏ธ ๐ฎ WebSockets ูู Angular: ุฅูุดุงุก Angular Service ููุนูู ูุน ูุขุฎุฐ ุงูููุจ ๐ฃ ๐คฐ๐ฝ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ูุฐู ุงูููุงูุฉ ุณุฃุญุงูู ุฃู ุฃุบุทู ุจุงูุชูุตูู ุงููุทุงู ุงูุถูู ููุชูููููุฌูุง ูู ุฅุทุงุฑ ุงูุฅุทุงุฑ ุงูุฒุงูู ููุณุงุนุฏู ุงููุชูุงูู ุจุงููุนู - RxJs ุ ุจูููุง ูุชุนูุฏ ุฃูุง ูุชุทุฑู ุฅูู ุนูููุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WebSockets ูู Angular: ุฅูุดุงุก Angular Service ููุนูู ูุน ูุขุฎุฐ ุงูููุจ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416155/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dz/-h/c_/dz-hc_la-a4emvhkqbd4ihr5zfe.jpeg" alt="ุงูุตูุฑุฉ"><br>  ูู ูุฐู ุงูููุงูุฉ ุณุฃุญุงูู ุฃู ุฃุบุทู ุจุงูุชูุตูู ุงููุทุงู ุงูุถูู ููุชูููููุฌูุง ูู ุฅุทุงุฑ ุงูุฅุทุงุฑ ุงูุฒุงูู ููุณุงุนุฏู ุงููุชูุงูู ุจุงููุนู - RxJs ุ ุจูููุง ูุชุนูุฏ ุฃูุง ูุชุทุฑู ุฅูู ุนูููุงุช ุชูููุฐ ุงูุฎุงุฏู ุ ููุง  ูุฐุง ููุถูุน ูุงูู ูููุงู ูููุตู. <br><br>  ุณูููู ูุฐุง ุงููุต ูููุฏูุง ูุฃููุฆู ุงูุฐูู ูู ุนูู ุฏุฑุงูุฉ ุจู Angular ุจุงููุนู ุ ูููููู ูุฑุบุจูู ูู ุชุนููู ูุนุฑูุชูู ูุจุงุดุฑุฉ ุญูู ุงูููุถูุน. <br><a name="habracut"></a><br>  ุฃููุงู ุ ุจุนุถ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุง ูู WebSocket ูููุงุฐุง ุชุญุชุงุฌู </h2><br><blockquote style=";text-align:right;direction:rtl">  ููููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููููุจูุฏูุง</a> ุ ูุฅู WebSocket ูู "ุจุฑูุชูููู ุงุชุตุงู ูุฒุฏูุฌ (ููููู ุงูุฅุฑุณุงู ูุงูุงุณุชูุจุงู ูู ููุณ ุงูููุช) ุนุจุฑ ุงุชุตุงู TCP ุ ูุตูู ูููุฑุงุณูุฉ ูู ุงูููุช ุงููุนูู ุจูู ุงููุชุตูุญ ูุฎุงุฏู ุงูููุจ. <br>  ุชู ุชุตููู WebSocket ููุชู ุชูููุฐู ูู ูุชุตูุญุงุช ุงูููุจ ูุฎูุงุฏู ุงูููุจ ุ ูููู ูููู ุงุณุชุฎุฏุงูู ูุฃู ุชุทุจูู ุนููู ุฃู ุฎุงุฏู.  ุจุฑูุชูููู WebSocket ูู ุจุฑูุชูููู ูุณุชูู ูุนุชูุฏ ุนูู ุจุฑูุชูููู TCP.  ุฅูู ูุชูุญ ุชูุงุนููุง ุฃูุซู ุจูู ุงููุชุตูุญ ููููุน ุงูููุจ ุ ููุง ูุณูู ุชูุฒูุน ุงููุญุชูู ุงูุชูุงุนูู ูุฅูุดุงุก ุชุทุจููุงุช ูู ุงูููุช ุงููุนูู. " <br></blockquote><br>  ุจูุนูู ุขุฎุฑ ุ ูุณูุญ WebSocket ููุฎุงุฏู ุจุชููู ุงูุทูุจุงุช ูู ุงูุนููู ูุฅุฑุณุงู ุงูุทูุจุงุช ุฅูู ุงูุนููู ูู ุฃู ููุช ูุฑุบูุจ ููู ุ ูุจุงูุชุงูู ุ ูุญุตู ุงููุชุตูุญ (ุงูุนููู) ูุงูุฎุงุฏู ุนูู ุญููู ูุชุณุงููุฉ ูุงููุฏุฑุฉ ุนูู ุชุจุงุฏู ุงูุฑุณุงุฆู ุนูุฏ ุงูุงุชุตุงู.  ูุชุทูุจ ุทูุจ AJAX ุงูุนุงุฏู ุฅุฑุณุงู ุฑุคูุณ HTTP ูุงููุฉ ุ ููุง ูุนูู ุฒูุงุฏุฉ ุญุฑูุฉ ุงููุฑูุฑ ูู ููุง ุงูุงุชุฌุงููู ุ ูู ุญูู ุฃู ุงูุญูู ุงูุฒุงุฆุฏ ูููุงุจุณ ุงูููุจ ุจุนุฏ ุฅูุดุงุก ุงูุงุชุตุงู ูู ูุญุฏุชู ุจุงูุช ููุท.  ูููู ููุจุณ ุงูููุจ ูู ูููุฉ ุงููุนูููุงุช ุงููุฑุณูุฉ ูู ุฑุคูุณ HTTP ุจูุฆุงุช ูุขูุงู ุงููุฑุงุช ููููู ุจุดูู ูุจูุฑ ูู ููุช ุงูุงูุชุธุงุฑ.  ุชุฏุนู ุงุชุตุงูุงุช ููุจุณ ุงูููุจ ุนุจุฑ ุงููุฌุงูุงุช ูุซู CORS. <br><br>  ุนูู ุฌุงูุจ ุงูุฎุงุฏู ุ ููุงู ุญุฒู ูุฏุนู ููุจุณ ุงูููุจ ุ ุนูู ุงูุนููู ูู HTML5 WebSocket API ุ ูุงูุฐู ูุญุชูู ุนูู ูุงุฌูุฉ ูู ุซูุงุซ ุทุฑู: <br><br>  <b><i>WebSocket</i></b> - ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ููุงุชุตุงู ุจุฎุงุฏู WebSocket ุ ุซู ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุจูุงูุงุช ุนุจุฑ ุงูุงุชุตุงู ุ <br>  <b><i>CloseEvent</i></b> - ุญุฏุซ ุชู ุฅุฑุณุงูู ุจูุงุณุทุฉ ูุงุฆู WebSocket ุนูุฏ ุฅุบูุงู ุงูุงุชุตุงู ุ <br>  <b><i>MessageEvent</i></b> - ุญุฏุซ ุชู ุฅุฑุณุงูู ุจูุงุณุทุฉ WebSocket ุนูุฏ ุชููู ุฑุณุงูุฉ ูู ุงูุฎุงุฏู. <br><br>  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ุชุจุฏู ุจูุง ุนูู ูุณุชูู ุชุทุจูู JavaSript: <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">const ws = new WebSocket("ws://www.example.com/socketserver", "protocolOne"); ws.onopen = () =&gt; { ws.onmessage = (event) =&gt; { console.log(event); } ws.send("Here's some text that the server is urgently awaiting!"); };</code> </pre> <br>  <b><i>onmessage</i></b> - ุงูุงุณุชูุงุน ุฅูู ุงูุฑุณุงุฆู ูู ุงูุฎุงุฏู <br>  <b><i>ุฃุฑุณู</i></b> - ุฃุฑุณู ุฑุณุงุฆูู ุฅูู ุงูุฎุงุฏู <br><br>  ูุฐุง ูู ุ ูู ุดููู ุงูุฃุณุงุณู ุ ูู ุดูุก ุจุณูุท ููุบุงูุฉ ุ ูููู ุฅุฐุง ูุงูุช ูุฏูู ุฑุบุจุฉ ูู ุงูุฎูุถ ูู ุงูููุถูุน ุ ูููููู ุงูุงูุชูุงู ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">MDN Web Docs</a> ููู ุงูููุช ููุณู ููุชุจุงุช ุงูุฏุฑุงุณุฉ ุงูุชู ุชุทุจู ุทุจูุงุชูุง ุงูุฎุงุตุฉ ููู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฐู. <br><br><h2 style=";text-align:right;direction:rtl">  ููุงุฐุง ูุง ุชุฎุงู ูู ุงุณุชุฎุฏุงู WebSocket </h2><br>  ุงูููุทุฉ ุงูุฃููู ุงูุชู ูููู ุฃู ุชุฎูู ูู <b>ุฏุนู ุงููุชุตูุญ</b> .  ุงูููู ูุง ุชูุฌุฏ ูุดููุฉ ูู ูุฐุง ุงููุจูู - ูุชู ุฏุนู WebSocket ุจุดูู ุดุจู ูุงูู ุนูู ุงูููุจ ููู ูุทุงุน ุงููุงุชู ุงููุญููู. <br><br><img src="https://habrastorage.org/webt/6q/kt/br/6qktbrrlnloyi0ec862v8qzclts.png" alt="ุงูุตูุฑุฉ"><br><br><img src="https://habrastorage.org/webt/bn/pk/k5/bnpkk58xzozo2c9plnkgszfjnk4.png" alt="ุงูุตูุฑุฉ"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://caniuse.com/#feat=websockets</a> <br><br>  ุงูููุทุฉ ุงูุซุงููุฉ ูู <b>ุณูููุฉ ุงูุชูููุฐ</b> .  ูุนู ุ ูู ุงูุจุฏุงูุฉ ูุฐุง ุฃูุฑ ูุญุจุท. <br><br>  ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุจุณูุทุฉ ููุบุงูุฉ ูุฏุฑุฌุฉ ุฃูู ูุฏ ูุจุฏู ูู ุงูุตุนุจ ูููููุฉ ุงูุฃููู ููู ููููุฉ ุงูุชุนุงูู ูุน ูุซู ูุฐุง ุงูุนุฏุฏ ุงููุชูุงุถุน ูู ุงูุฃุณุงููุจ ุ ูุฃู ุฌููุนูุง ุ ุจุงุณุชุซูุงุก ุทุฑููุฉ ูุงุญุฏุฉ ุ ุชุจูุบ ุฅูุง ุนู ุฃุฎุทุงุก ุฃู ุงุชุตุงูุงุช ุ ููุงุญุฏุฉ ูููุง ููุท - <b><i>onmessage</i></b> - ุชุญูู ูุงุณุชุฎุฏุงู ูุขุฎุฐ ุงูููุจ ุ ุฃู  ูุชููู ุงูุจูุงูุงุช ูู ุงูุฎุงุฏู. <br><br>  ูู ุงูููุช ููุณู ุ ูุฅู ุงููุดููุฉ ูู ุฃู ุงูุฎุงุฏู ุนุงุฏุฉ ูุง ูุฑุณู ุจูุงูุงุช ูุฎุชููุฉ ุ ูุจุงูุชุงูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุนุฏุฉ ุฑุณุงุฆู ูุฎุชููุฉุ  ุฃู ูู ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุงุชุตุงู ุฎุงุต ุจู ููู ูููุฐุฌ ุจูุงูุงุชุ <br><br>  ูุฐุง ุ ุงููููุฉ: ุชุญุชุงุฌ ุฅูู ูุจูู ูููุฐุฌ ุงููุณุชุฎุฏู ูุฃุญุฏุซ ูููุฐุฌ ุฅุฎุจุงุฑู ูู ุงูุฎุงุฏู ุ ูุฑุจูุง ุดูุก ุขุฎุฑ. <br><br>  ููุฏ ุตุงุฏูุช ูุซู ูุฐุง ุงูุชูููุฐ "ุงูุฃููู": <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">const wsUser = new WebSocket("ws://www.example.com/user"); wsUser.onmessage = (event) =&gt; { // ... }; const wsNews = new WebSocket("ws://www.example.com/news"); wsNews.onmessage = (event) =&gt; { // ... }; const wsTime = new WebSocket("ws://www.example.com/time"); wsTime.onmessage = (event) =&gt; { // ... }; const wsDinner = new WebSocket("ws://www.example.com/dinner"); wsDinner.onmessage = (event) =&gt; { // ... }; const wsCurrency = new WebSocket("ws://www.example.com/currency"); wsCurrency.onmessage = (event) =&gt; { // ... }; const wsOnline = new WebSocket("ws://www.example.com/online"); wsOnline.onmessage = (event) =&gt; { // ... }; const wsLogin = new WebSocket("ws://www.example.com/login"); wsLogin.onmessage = (event) =&gt; { // ... }; const wsLogout = new WebSocket("ws://www.example.com/logout"); wsLogout.onmessage = (event) =&gt; { // ... };</code> </pre> <br>  ูููููุฉ ุงูุฃููู ุ ูู ุดูุก ููุทูู.  ูููู ุงูุขู ุชุฎูู ููู ุณูุจุฏู ุฅุฐุง ูุงู ููุงู ุงูุนุดุฑุงุช ุฃู ุงููุฆุงุช ูููู.  ูู ุฃุญุฏ ุงููุดุงุฑูุน ุงูุชู ุนููุช ูููุง ุ ูุงู ููุงู ุญูุงูู ุซูุงุซูุงุฆุฉ ุญุฏุซ. <br><br><img src="https://habrastorage.org/webt/d3/rg/dl/d3rgdlp8eggnms2ot2ely5zktz8.jpeg" alt="ุงูุตูุฑุฉ"><br><br>  ูุญู ุงููุดููุฉ. <br><br>  ุชุณูุญ ูู ูุงูุฉ ููุชุจุงุช ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ ููุนูู ุจุงุณุชุฎุฏุงู ูุขุฎุฐ ุงูููุจ ุจุงูุงุดุชุฑุงู ูู ุฑุณุงุฆู ูู ููุน addEventListener.  ูุจุฏู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ws.on("user", (userData) =&gt; { / .. })</code> </pre> <br>  ููุง ูุนูู ุ ูููููุง ุงูุนูู ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ูุงุญุฏุฉ - <b><i>onmessage</i></b> ุ ุงูุชู ุชุชููู ุฌููุน ุงูุจูุงูุงุช ูุฌุฒุก ูู ุงุชุตุงููุง ุ ูุฐูู ูุจุฏู ูุฐุง ุงูุฑูุฒ ุบูุฑ ูุนุชุงุฏ ุฅูู ุญุฏ ูุง.  ูุชู ุชูููุฐ ุฐูู ุนูู ุงููุญู ุงูุชุงูู: ุชูุฑุฌุน <b><i>onmessage</i></b> ุฑุณุงูุฉ <b><i>MessageEvent</i></b> ุชุญุชูู ุนูู ุญูู <b><i>ุงูุจูุงูุงุช</i></b> .  ูู <b><i>ุงูุจูุงูุงุช ุงูุชู</i></b> ุชุญุชูู ุนูู ุงููุนูููุงุช ุงูุชู ูุฑุณููุง ุงูุฎุงุฏู ุฅูููุง.  ูุจุฏู ูุฐุง ุงููุงุฆู ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{ "event": "user", "data": { "name": "John Doe", ... } }</code> </pre> <br>  ุญูุซ ูููู <b><i>ุงูุญุฏุซ</i></b> ูู ุงูููุชุงุญ ุงูุฐู ูููู ูู ุฎูุงูู ุชุญุฏูุฏ ุงููุนูููุงุช ุงูุชู ุฃุฑุณููุง ุงูุฎุงุฏู.  ุจุนุฏ ุฐูู ุ ุนูู ุงูุฌุงูุจ ุงูุฃูุงูู ุ ูุชู ุฅูุดุงุก ุญุงููุฉ ุชููู ุจุชุตููุฉ ุงููุนูููุงุช ุญุณุจ ุงูุญุฏุซ ูุฅุฑุณุงููุง ุฅูู ุงูุนููุงู ุงููุทููุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">const ws = new WebSocket("ws://www.example.com"); ws.onmessage = (event) =&gt; { const data = JSON.parse(event.data); if (data.event === 'user') { // ... } if (data.event === 'news') { // ... } };</code> </pre> <br><br>  ูุฐุง ูุฌุนู ูู ุงููููู ุชููู ุจูุงูุงุช ูุฎุชููุฉ ุฏุงุฎู ููุณ ุงูุงุชุตุงู ูุงูุงุดุชุฑุงู ูููุง ูู ุฎูุงู ุจูุงุก ุฌููุฉ ููุงุซู ููุนุงุฏุฉ ูุฃุญุฏุงุซ JS. <br><br><h2 style=";text-align:right;direction:rtl">  WebSockets ุงูุฒุงูู </h2><br>  ุฃุฎูุฑูุง ุ ูุตููุง ุฅูู ุฃูู ุดูุก - ุจุงุณุชุฎุฏุงู WebSockets ูุจุงุดุฑุฉู ูู Angular. <br><br>  ุนูู ุงูุฑุบู ูู ุจุณุงุทุฉ ุงูุนูู ูุน WebSocket API ุงูุฃุตูู ุ ุณูุณุชุฎุฏู ูู ูุฐู ุงูููุงูุฉ RxJs ุ ูุงูุชู ุจุงูุทุจุน ุ ูุฃููุง ูุชุญุฏุซ ุนู Angular. <br><br>  ูููู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช WebSocket ุงูุฃุตููุฉ ูู ุชุทุจููุงุช Angular ุ ูุฅูุดุงุก ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู ุ ู RxJs Observable ุ ูุงูุงุดุชุฑุงู ูู ุงูุฑุณุงุฆู ุงูุถุฑูุฑูุฉ ุ ููุง ุฅูู ุฐูู ุ ูููู RxJs ูุฏ ูุงูุช ุจุงููุนู ุจุงูุนูู ุงูุฑุฆูุณู ููุงุจุฉ ุนูู: WebSocketSubject ุนุจุงุฑุฉ ุนู ุบูุงู ุชูุงุนูู ุนุจุฑ WebSocket ุงูููุงุณู API  ูุง ูููู ุจุฅูุดุงุก ูุงูู ุญุฏุซ ุฃู ุฅุนุงุฏุฉ ูุนุงูุฌุฉ ุงููุนุงูุฌุฉ.  ูุฐุง ููุถูุน ุนุงุฏู ุ ูุงูุฐู ููููู ูู ุฎูุงูู ุงูุชุนุงูู ูุน ููุงุจุณ ุงูููุจ ุฐุงุช ุงูููุท ุงูุชูุงุนูู. <br><br><h2 style=";text-align:right;direction:rtl">  RxJs WebSocketSubject </h2><br>  ูุฐูู ุ ูุชููุน <a href="">WebSocketSubject WebSocketSubjectConfig</a> ููุฌูุฉ ุงุฎุชูุงุฑูุฉ ุ ุญูุซ ููููู ุชูุฑูุฑ ุฑุงุจุท ุฅูู ุงูููุถูุน ุงูุฐู ุชูุช ููุงุญุธุชู ุ ูุฅูุดุงุก ููุงุญุธุฉ ูููู ูู ุฎูุงููุง ุงูุงุณุชูุงุน ูุฅุฑุณุงู ุฑุณุงุฆู ูููุงุจุณ ุงูููุจ. <br><br>  ุจุจุณุงุทุฉ ุ ุชููู ุจุชูุฑูุฑ ุนููุงู URL ููุงุชุตุงู ููุณูุทุฉ WebSocketSubject ูุงูุงุดุชุฑุงู ูู ุฌููุน ุฃูุดุทุฉ ููุจุณ ุงูููุจ ุจุงูุทุฑููุฉ ุงููุนุชุงุฏุฉ ูู RxJs.  ูุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุฅุฑุณุงู ุฑุณุงูุฉ ุฅูู ุงูุฎุงุฏู ุ ูุงุณุชุฎุฏู ููุณ ุงูุทุฑููุฉ ุงููุนุชุงุฏุฉ webSocketSubject.next (ุงูุจูุงูุงุช). <br><br><h2 style=";text-align:right;direction:rtl">  ููุฏู ุฎุฏูุฉ ููุนูู ูุน WebSocket Angular </h2><br>  ุตู ุจุฅูุฌุงุฒ ูุง ูุชููุนู ูู ุงูุฎุฏูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ููุญุฏุฉ ูููุฌุฒุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุฅููุงููุฉ ุงูุชูููู ุนูู ูุณุชูู ุงุชุตุงู ุชุจุนูุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DI</a> ุ </li><li style=";text-align:right;direction:rtl">  ุฅููุงููุฉ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู ุ </li><li style=";text-align:right;direction:rtl">  ุงููุชุงุจุฉ </li><li style=";text-align:right;direction:rtl">  ุงููุฏุฑุฉ ุนูู ุงูุงุดุชุฑุงู ูุชููู ุงููุนูููุงุช ุนู ุทุฑูู ุงูููุชุงุญ ุ </li><li style=";text-align:right;direction:rtl">  ุงููุฏุฑุฉ ุนูู ุฅููุงุก ุงูุงุดุชุฑุงู ุ </li><li style=";text-align:right;direction:rtl">  ุฅุฑุณุงู ุฑุณุงุฆู ุฅูู ุงูุฎุงุฏู ุ </li><li style=";text-align:right;direction:rtl">  ุฃุนุฏ ุงูุงุชุตุงู. </li></ul><br>  ุงูููุทุฉ ุงูุฃุฎูุฑุฉ ุชุณุชุญู ุงูุงูุชุจุงู ุจุดูู ุฎุงุต.  ูุนุฏ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุ ุฃู ูุคุณุณุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฎุงุฏู ุ ุนุงููุงู ุจุงูุบ ุงูุฃูููุฉ ุนูุฏ ุงูุนูู ูุน ูุขุฎุฐ ุงูููุจ ุ ูุซู  ูููู ุฃู ุชุชุณุจุจ ููุงุตู ุงูุดุจูุฉ ุฃู ุชุนุทู ุงูุฎุงุฏู ุฃู ุงูุฃุฎุทุงุก ุงูุฃุฎุฑู ุงูุชู ุชุชุณุจุจ ูู ูุทุน ุงูุงุชุตุงู ูู ุชุนุทู ุงูุชุทุจูู. <br><br>  ูู ุงูููู ุฃู ููุงุญุธ ุฃู ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุงุชุตุงู <b>ูุง ูุฌุจ ุฃู ุชููู ูุชูุฑุฑุฉ ููุบุงูุฉ</b> ููุง ูุฌุจ ุฃู ุชุณุชูุฑ ุฅูู ูุง ูุง ููุงูุฉ ุ ููุง ูู  ูููู ููุฐุง ุงูุณููู ุชุนููู ุงูุนููู. <br><br>  ุฏุนูุง ูุจุฏุฃ. <br><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณูููู ุจุฅูุดุงุก ูุงุฌูุฉ ุชูููู ุงูุฎุฏูุฉ ููุญุฏุฉ ุชููุฑ ุงููุฏุฑุฉ ุนูู ุงูุชูููู ุนูุฏ ุงูุงุชุตุงู. <br><br>  ุฅู ุฃููู ุ ุณุฃููู ุจุชูุตูุฑ ุงูุฑูุฒ ุ ุงููุณุฎุฉ ุงููุงููุฉ ุงูุชู ููููู ุฑุคูุชูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ุงููุฌุชูุน ุงูุฒุงูู ุงููุงุทู ุจุงูุฑูุณูุฉ ุนูู GitHub</a> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">export interface WebSocketConfig { url: string; reconnectInterval?: number; reconnectAttempts?: number; } export class WebsocketModule { public static config(wsConfig: WebSocketConfig): ModuleWithProviders { return { ngModule: WebsocketModule, providers: [{ provide: config, useValue: wsConfig }] }; } }</code> </pre> <br>  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ูุตู ูุงุฌูุฉ ุฑุณุงูุฉ ููุจุณ ุงูููุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">export interface IWsMessage&lt;T&gt; { event: string; data: T; }</code> </pre> <br>  ุญูุซ ูููู <b><i>ุงูุญุฏุซ</i></b> ูู ุงูููุชุงุญ ุ <b><i>ูุงูุจูุงูุงุช</i></b> ุงูุชู ูุชู ุงูุญุตูู ุนูููุง ุจูุงุณุทุฉ ุงูููุชุงุญ ูู ูููุฐุฌ ููุชูุจ. <br><br>  ุชุจุฏู ุงููุงุฌูุฉ ุงูุนุงูุฉ ููุฎุฏูุฉ ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">export interface IWebsocketService { on&lt;T&gt;(event: string): Observable&lt;T&gt;; send(event: string, data: any): void; status: Observable&lt;boolean&gt;; }</code> </pre> <br>  ุชุญุชูู ุงูุฎุฏูุฉ ุนูู ูุฌุงูุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//   WebSocketSubject private config: WebSocketSubjectConfig&lt;IWsMessage&lt;any&gt;&gt;; private websocketSub: SubscriptionLike; private statusSub: SubscriptionLike; // Observable    interval private reconnection$: Observable&lt;number&gt;; private websocket$: WebSocketSubject&lt;IWsMessage&lt;any&gt;&gt;; // ,      private connection$: Observer&lt;boolean&gt;; //  Observable       private wsMessages$: Subject&lt;IWsMessage&lt;any&gt;&gt;; //       private reconnectInterval: number; //    private reconnectAttempts: number; //      private isConnected: boolean; //   public status: Observable&lt;boolean&gt;;</code> </pre> <br>  ูู ูููุดุฆ ูุฆุฉ ุงูุฎุฏูุฉ ุ ูุญุตู ุนูู ูุงุฆู WebSocketConfig ุงููุญุฏุฏ ุนูุฏ ุชูุตูู ุงููุญุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">constructor(@Inject(config) private wsConfig: WebSocketConfig) { this.wsMessages$ = new Subject&lt;IWsMessage&lt;any&gt;&gt;(); //  ,  ,     this.reconnectInterval = wsConfig.reconnectInterval || 5000; this.reconnectAttempts = wsConfig.reconnectAttempts || 10; //      connection$   websocket$ this.config = { url: wsConfig.url, closeObserver: { next: (event: CloseEvent) =&gt; { this.websocket$ = null; this.connection$.next(false); } }, //     connection$ openObserver: { next: (event: Event) =&gt; { console.log('WebSocket connected!'); this.connection$.next(true); } } }; // connection status this.status = new Observable&lt;boolean&gt;((observer) =&gt; { this.connection$ = observer; }).pipe(share(), distinctUntilChanged()); //      this.statusSub = this.status .subscribe((isConnected) =&gt; { this.isConnected = isConnected; if (!this.reconnection$ &amp;&amp; typeof(isConnected) === 'boolean' &amp;&amp; !isConnected) { this.reconnect(); } }); // ,  -    this.websocketSub = this.wsMessages$.subscribe( null, (error: ErrorEvent) =&gt; console.error('WebSocket error!', error) ); //  this.connect(); }</code> </pre> <br>  ุทุฑููุฉ ุงูุงุชุตุงู ููุณูุง ุจุณูุทุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private connect(): void { this.websocket$ = new WebSocketSubject(this.config); //  //   ,    , //  ,  // ,    this.websocket$.subscribe( (message) =&gt; this.wsMessages$.next(message), (error: Event) =&gt; { if (!this.websocket$) { // run reconnect if errors this.reconnect(); } }); }</code> </pre> <br>  ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุฃูุซุฑ ุชุนููุฏูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private reconnect(): void { //  interval    reconnectInterval this.reconnection$ = interval(this.reconnectInterval) .pipe(takeWhile((v, index) =&gt; index &lt; this.reconnectAttempts &amp;&amp; !this.websocket$)); //     ,        this.reconnection$.subscribe( () =&gt; this.connect(), null, () =&gt; { // Subject complete if reconnect attemts ending this.reconnection$ = null; if (!this.websocket$) { this.wsMessages$.complete(); this.connection$.complete(); } }); }</code> </pre> <br>  ุทุฑููุฉ ุงูุชุดุบูู ุ ูู ุฃูุถูุง ุจุณูุทุฉ ููุบุงูุฉ ุ ูุง ููุฌุฏ ุดูุก ููุชุนููู ุนููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public on&lt;T&gt;(event: string): Observable&lt;T&gt; { if (event) { return this.wsMessages$.pipe( filter((message: IWsMessage&lt;T&gt;) =&gt; message.event === event), map((message: IWsMessage&lt;T&gt;) =&gt; message.data) ); } }</code> </pre> <br>  ุทุฑููุฉ <b><i>ุงูุฅุฑุณุงู</i></b> ุฃูุซุฑ ุจุณุงุทุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public send(event: string, data: any = {}): void { if (event &amp;&amp; this.isConnected) { //   any ,   ""   string //      :) this.websocket$.next(&lt;any&gt;JSON.stringify({ event, data })); } else { console.error('Send error!'); } }</code> </pre> <br>  ูุฐู ูู ุงูุฎุฏูุฉ ุจุฃููููุง.  ููุง ุชุฑูู ุ ูุฅู ุงูุฌุฒุก ุงูุฃูุจุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููุน ุนูู ุชูุธูู ุฅุนุงุฏุฉ ุงูุงุชุตุงู. <br><br>  ุฏุนูุง ูุฑู ุงูุขู ููููุฉ ุงุณุชุฎุฏุงูู.  ูู ุจุชูุตูู ุงููุญุฏุฉ ุงูููุทูุฉ WebsocketModule: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">imports: [ WebsocketModule.config({ url: environment.ws //      'ws://www.example.com' }) ]</code> </pre> <br>  ูู ูููุดุฆ ุงููููู ุ ูููู ุจุฅุฏุฎุงู ุงูุฎุฏูุฉ ูุงูุงุดุชุฑุงู ูู ุงูุฑุณุงุฆู ูู " <b><i>ุงูุฑุณุงุฆู</i></b> " ุ ูุฅุฑุณุงู ุงููุต ูุฑุฉ ุฃุฎุฑู ุฅูู ุงูุฎุงุฏู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private wsService: WebsocketService) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wsService.on&lt;IMessage[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'messages'</span></span></span></span></span><span class="hljs-function">) .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(messages: IMessage[]</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(messages); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wsService.send(<span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-string"><span class="hljs-string">'Test Text!'</span></span>); }); }</code> </pre> <br>  ุงุณู ุงูุฃุญุฏุงุซ ุฃูุซุฑ ููุงุกูุฉ ููุถุน ุซูุงุจุช ุฃู ุชุนุฏุงุฏ.  ูููู ุจุฅูุดุงุก ููู websocket.events.ts ูู ููุงู ูุง ูููุชุจู ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">export const WS = { ON: { MESSAGES: 'messages' }, SEND: { TEXT: 'text' } };</code> </pre> <br>  ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุงุดุชุฑุงูุงุช ุจุงุณุชุฎุฏุงู ูุงุฆู WS ุงูุฐู ุชู ุฅูุดุงุคู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">this.wsService.on&lt;IMessage[]&gt;(WS.ON.MESSAGES) .subscribe((messages: IMessage[]) =&gt; { console.log(messages); this.wsService.send(WS.SEND.TEXT, 'Test Text!'); });</code> </pre> <br><img src="https://habrastorage.org/webt/zn/jz/k7/znjzk75iy2uudtgep2wr4u8djmk.jpeg" alt="ุงูุตูุฑุฉ"><br><br><h2 style=";text-align:right;direction:rtl">  ูู ุงูุฎุชุงู </h2><br>  ูุฐุง ุ ูู ุงููุงูุน ุ ูู ุดูุก.  ูุฐุง ูู ุงูุญุฏ ุงูุฃุฏูู ุงูุถุฑูุฑู ุงูุฐู ูุญุชุงุฌ ูุทูุฑ Angular ุฅูู ูุนุฑูุชู ุญูู WebSockets.  ุขูู ุฃู ุฃููู ูุฏ ุชูุงููุช ูุฐุง ุงูููุถูุน ุจูุถูุญ ุชุงู.  ูููู ุงูุนุซูุฑ ุนูู ุงููุณุฎุฉ ุงููุงููุฉ ูู ุงูุฎุฏูุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitHub</a> . <br><br>  ูุฌููุน ุงูุฃุณุฆูุฉ ููููู ุงูุงุชุตุงู ูู ุงูุชุนูููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู</a> ุนูู Telegram ุฃู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุฉ Angular</a> ูู ููุณ ุงูููุงู. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar416155/">https://habr.com/ru/post/ar416155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar416143/index.html">ูุชุงุจ "ุณูุธูุฑ ุชุดุฑูุญ ุงูุฌุซุฉ!" ุชุญููู ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ุงูุนูููุฉ ยป</a></li>
<li><a href="../ar416147/index.html">ุชูุธูู ุงูุชููู ูู ุชุทุจููุงุช iOS ุจุงุณุชุฎุฏุงู Root Controller</a></li>
<li><a href="../ar416149/index.html">ุฃุณุฆูุฉ ูุฃุฌูุจุฉ ุงูุทุงูุฉ ุงููุชุฌุฏุฏุฉ ุ ุงูุฌุฒุก ุงูุฃูู</a></li>
<li><a href="../ar416151/index.html">ุจุงููู ุจุฏูู ุฃุจุนุงุฏ. ุณุญุฑ ุชุญููู ุงูุจุนุฏ ุงูููุนู</a></li>
<li><a href="../ar416153/index.html">ูู ุณุชุตุจุญ ุงูุทุงุฆุฑุงุช ุฃูุซุฑ ููุซูููุฉุ ููุฏู ูุตูุนู ุงูุทุงุฆุฑุงุช ุงูุฑูุจูุชุงุช ููุดุฑูุงุช</a></li>
<li><a href="../ar416157/index.html">ูู ุฃุญุถุงู ุจุงูุซูู (ูููุณุงุก ููุท)</a></li>
<li><a href="../ar416159/index.html">ููู ุชู ุชูููููุง ุจููุงุฑูุฉ ุงููููุฐ ูุน ุซุนุจุงู</a></li>
<li><a href="../ar416161/index.html">10 ุฃุณุจุงุจ [ูุนุฏู] ุงุณุชุฎุฏุงู k8s</a></li>
<li><a href="../ar416163/index.html">ุชุนูู ุจุฑูุงูุฌ OpenGL. ุงูุฏุฑุณ 5.6 - ุฑุณู ุฎุฑุงุฆุท ุงูููุธุฑ</a></li>
<li><a href="../ar416167/index.html">Peter Norwig: ุชุนูู ุงูุจุฑูุฌุฉ ูู ... 10 ุณููุงุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>