<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП╗тАНЁЯПл ЁЯПВЁЯП╗ ЁЯТХ рдХреИрд╕реЗ рд╣рдо 70% рд╕реЗ рдЙрддреНрдкрд╛рджрдХрддрд╛ рдмрдврд╝рд╛рддреЗ рд╣реБрдП рддрдиреНрдпрддрд╛ рдкреНрд░рд╡рд╛рд╣ рдмрдврд╝рд╛ ЁЯЪ┤ЁЯП╗ ЁЯЩЖЁЯП╛ ЁЯР╜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЙрджреНрдпреЛрдЧ рдФрд░ рдЕрдиреБрд╕рдВрдзрд╛рди рджреЛрдиреЛрдВ рдореЗрдВ рд▓реЛрдХрдкреНрд░рд┐рдп рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ (рдПрдордПрд▓) рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдордВрдЪ рдмрди рдЧрдпрд╛ рд╣реИред рдПрдордПрд▓ рдореЙрдбрд▓ рдХреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдФрд░ рд░рдЦрд░рдЦрд╛рд╡ рдХреЗ рд▓рд┐рдП рдХрдИ рдореБрдлреНрдд рдкреБрд╕реНрддрдХрд╛рд▓рдп, рдЙрдкрдХрд░рдг...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдХреИрд╕реЗ рд╣рдо 70% рд╕реЗ рдЙрддреНрдкрд╛рджрдХрддрд╛ рдмрдврд╝рд╛рддреЗ рд╣реБрдП рддрдиреНрдпрддрд╛ рдкреНрд░рд╡рд╛рд╣ рдмрдврд╝рд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445928/"> рдЙрджреНрдпреЛрдЧ рдФрд░ рдЕрдиреБрд╕рдВрдзрд╛рди рджреЛрдиреЛрдВ рдореЗрдВ рд▓реЛрдХрдкреНрд░рд┐рдп рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ (рдПрдордПрд▓) рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдордВрдЪ рдмрди рдЧрдпрд╛ рд╣реИред  рдПрдордПрд▓ рдореЙрдбрд▓ рдХреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдФрд░ рд░рдЦрд░рдЦрд╛рд╡ рдХреЗ рд▓рд┐рдП рдХрдИ рдореБрдлреНрдд рдкреБрд╕реНрддрдХрд╛рд▓рдп, рдЙрдкрдХрд░рдг рдФрд░ рд░реВрдкрд░реЗрдЦрд╛ рдмрдирд╛рдИ рдЧрдИ рд╣реИрдВред  Tensorflow рд╕рд░реНрд╡рд┐рдВрдЧ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдПрдХ рд╡рд┐рддрд░рд┐рдд рдЙрддреНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдордПрд▓ рдореЙрдбрд▓ рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред <br><br>  рд╣рдорд╛рд░реА Mux рд╕реЗрд╡рд╛ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреЗ рдХрдИ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ, рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рд╡реАрдбрд┐рдпреЛ рдЯрд╛рдЗрдЯрд▓ рдореЗрдВ рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА рд╣реИред  рдЖрдЬ рд╣рдо рдЙрди рддрд░реАрдХреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рджреЛрдиреЛрдВ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдХреЗ рд╡рд┐рд▓рдВрдмрддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред  рдореЙрдбрд▓ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдЖрдорддреМрд░ рдкрд░ "рдСрдирд▓рд╛рдЗрди" рд╕рдВрдЪрд╛рд▓рди (рдПрдХ рдЖрд╡реЗрджрди рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрде рдкрд░) рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, рдЕрдиреБрдХреВрд▓рди рдХреЗ рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп рд╕рдмрд╕реЗ рдХрдо рд╕рдВрднрд╡ рджреЗрд░реА рдХреЗ рд╕рд╛рде рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмрдбрд╝реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдирд╛ рд╣реИред <br><a name="habracut"></a><br><h1>  Tensorflow рдХреА рд╕реЗрд╡рд╛ рдХреНрдпрд╛ рд╣реИ? </h1><br>  Tensorflow рд╕рд░реНрд╡рд┐рдВрдЧ рдПрдордПрд▓ рдореЙрдбрд▓ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдФрд░ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рдЪреАрд▓рд╛ рд╕рд░реНрд╡рд░ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдПрдХ рдмрд╛рд░ рдЬрдм рдореЙрдбрд▓ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЯреЗрдВрд╕рд░рдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдХреЛ рдЗрд╕реЗ рдПрдХ рд╕рдВрдЧрдд (рд╕рд░реНрд╡рд┐рд╕реЗрдмрд▓) рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br>  <i>рд╕рд░реНрд╡реЗрдмрд▓</i> рдПрдХ рдХреЗрдВрджреНрд░реАрдп рдЕрдореВрд░реНрддрддрд╛ рд╣реИ рдЬреЛ рдЯреЗрдВрд╕рд░рдлреНрд▓реЛ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд▓рдкреЗрдЯрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдореЙрдбрд▓ рдХреЛ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╕рд░реНрд╡ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, Servable рд╡реЗ рдореВрд▓рднреВрдд рд╡рд╕реНрддреБрдПрдБ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЧреНрд░рд╛рд╣рдХ рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИред  рд╕рд░реНрд╡ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдЖрдХрд╛рд░ рдорд╛рдпрдиреЗ рд░рдЦрддрд╛ рд╣реИ: рдЫреЛрдЯреЗ рдореЙрдбрд▓ рдХрдо рдЬрдЧрд╣ рд▓реЗрддреЗ рд╣реИрдВ, рдХрдо рдореЗрдореЛрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рддреЗрдЬреА рд╕реЗ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВред  рдкреНрд░рд┐рдбрд┐рдХреНрдЯ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдореЙрдбрд▓ рдХреЛ SavedModel рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20b/9f9/47e/20b9f947ea0f318dc7c2eba619b3901f.png"><br><br>  Tensorflow Serving рдПрдХ GRPC / HTTP рд╕рд░реНрд╡рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдШрдЯрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рддреА рд╣реИ рдЬреЛ рдХрдИ ML рдореЙрдбрд▓ (рдпрд╛ рдХрдИ рд╕рдВрд╕реНрдХрд░рдг) рдкрд░реЛрд╕рддрд╛ рд╣реИ, рдирд┐рдЧрд░рд╛рдиреА рдШрдЯрдХ рдФрд░ рдПрдХ рдХрд╕реНрдЯрдо рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред <br><br><h1>  рдбреЙрдХрдЯрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реБрдП рдЯреЗрдВрд╕рд░рдлреНрд▓реЛ </h1><br>  рдЖрдЗрдП рдорд╛рдирдХ Tensorflow Serving рд╕реЗрдЯрд┐рдВрдЧреНрд╕ (CPU рдЕрдиреБрдХреВрд▓рди рдХреЗ рдмрд┐рдирд╛) рдХреЗ рд╕рд╛рде рдкреНрд░рджрд░реНрд╢рди рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рд▓рдЧрд╛рдиреЗ рдореЗрдВ рд╡рд┐рд▓рдВрдмрддрд╛ рдХреЗ рдореВрд▓ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, TensorFlow Docker рд╣рдм рд╕реЗ рдирд╡реАрдирддрдо рдЫрд╡рд┐ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: <br><br><pre><code class="bash hljs">docker pull tensorflow/serving:latest</code> </pre> <br>  рдЗрд╕ рдЕрдиреБрдЪреНрдЫреЗрдж рдореЗрдВ, рд╕рднреА рдХрдВрдЯреЗрдирд░ рдЪрд╛рд░ рдХреЛрд░, 15 рдЬреАрдмреА, рдЙрдмрдВрдЯреВ 16.04 рдХреЗ рд╕рд╛рде рдПрдХ рдореЗрдЬрдмрд╛рди рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред <br><br><h3>  SavedModel рдХреЛ Tensorflow Model рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдВ </h3><br>  рдЬрдм рдПрдХ рдореЙрдбрд▓ рдХреЛ рдЯреЗрдВрд╕рд░рдлрд╝реНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдЪрд░ рдирд┐рдпрдВрддреНрд░рдг рдмрд┐рдВрджреБ (рдбрд┐рд╕реНрдХ рдкрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ) рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдЙрдЯрдкреБрдЯ рд╕реАрдзреЗ рдореЙрдбрд▓ рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рдпрд╛ рдЬрдореЗ рд╣реБрдП рдЬрдореЗ рд╣реБрдП рдЧреНрд░рд╛рдл рдкреНрд░рд╛рд░реВрдк (рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓) рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  Tensorflow Serving рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдЬрдореЗ рд╣реБрдП рдЧреНрд░рд╛рдл рдХреЛ SavedModel рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдирд┐рд░реНрдпрд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Tensorflow рдкреНрд░рд▓реЗрдЦрди</a> рдореЗрдВ SavedModel рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреЗ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВред <br><br>  Tensorflow рдкреНрд░рдпреЛрдЧ, рдЕрдиреБрд╕рдВрдзрд╛рди, рдпрд╛ рдЙрддреНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдХрдИ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдФрд░ рдЕрдиреБрд╕рдВрдзрд╛рди</a> рдореЙрдбрд▓ рднреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред <br><br>  рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо 1000 рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рдПрдХ рдЗрдореЗрдЬрдиреЗрдЯ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЛ рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрд╣рд░реЗ рдЕрд╡рд╢рд┐рд╖реНрдЯ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ (ResNet) рдореЙрдбрд▓</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╣рд▓реЗ рд╕реЗ</a> <code>ResNet-50 v2</code> рдореЙрдбрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ SavedModel рдореЗрдВ Channels_last (NHWC) <i>рд╡рд┐рдХрд▓реНрдк</i> : рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рд╕реАрдкреАрдпреВ рдкрд░ рдмреЗрд╣рддрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред <br><br>  RestNet рдореЙрдбрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдирд┐рдореНрди рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">models/ 1/ saved_model.pb variables/ variables.data-00000-of-00001 variables.index</code> </pre> <br>  Tensorflow рд╕рд░реНрд╡рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╕рдВрдЦреНрдпрд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдХреНрд░рдордмрджреНрдз рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕рдВрд░рдЪрдирд╛ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ <code>1/</code> рд╕рдВрд╕реНрдХрд░рдг 1 рдореЙрдбрд▓ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдореЙрдбрд▓ рд╡реЗрдЯ (рдЪрд░) рдХреЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЗ рд╕рд╛рде <code>saved_model.pb</code> рдореЙрдбрд▓ рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред <br><br><h3>  рдмрдЪрдд рдФрд░ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг SavedModel </h3><br>  рдирд┐рдореНрди рдЖрджреЗрд╢ Denser рдХрдВрдЯреЗрдирд░ рдореЗрдВ Tensorflow Serving рдореЙрдбрд▓ рд╕рд░реНрд╡рд░ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рддрд╛ рд╣реИред  SavedModel рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдХрдВрдЯреЗрдирд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдореЙрдбрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="plaintext hljs">docker run -d -p 9000:8500 \ -v $(pwd)/models:/models/resnet -e MODEL_NAME=resnet \ -t tensorflow/serving:latest</code> </pre> <br>  рдХрдВрдЯреЗрдирд░ рд▓реЙрдЧ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдореЙрдбрд▓рд░рд╡рд░ рдЬреАрдЖрд░рдкреАрд╕реА рдФрд░ рдПрдЪрдЯреАрдЯреАрдкреА рдХреЗ рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ рдкрд░ <code>resnet</code> рдореЙрдбрд▓ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ рдФрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">... I tensorflow_serving/core/loader_harness.cc:86] Successfully loaded servable version {name: resnet version: 1} I tensorflow_serving/model_servers/server.cc:286] Running gRPC ModelServer at 0.0.0.0:8500 ... I tensorflow_serving/model_servers/server.cc:302] Exporting HTTP/REST API at:localhost:8501 ...</code> </pre> <br><h3>  рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдЧреНрд░рд╛рд╣рдХ </h3><br>  Tensorflow Serving <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдмрдлрд╝рд░реНрд╕</a> (protobufs) рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ рдПрдкреАрдЖрдИ рд╕реНрдХреАрдорд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдПрдкреАрдЖрдИ рдХреЗ рд▓рд┐рдП рдЬреАрдЖрд░рдкреАрд╕реА рдЧреНрд░рд╛рд╣рдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд╛рдпрдерди рдкреИрдХреЗрдЬ <code>tensorflow_serving.apis</code> рд░реВрдк рдореЗрдВ рдкреИрдХ рдХрд┐рдП рдЧрдП рд╣реИрдВред  рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдФрд░ рдкрд╛рдпрдерди рдкреИрдХреЗрдЬ <code>tensorflow</code> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред <br><br>  рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЧреНрд░рд╛рд╣рдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрднрд░рддрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">virtualenv .env &amp;&amp; source .env/bin/activate &amp;&amp; \ pip install numpy grpcio opencv-python tensorflow tensorflow-serving-api</code> </pre> <br>  <code>ResNet-50 v2</code> рдореЙрдбрд▓ рдПрдХ рд╕реНрд╡рд░реВрдкрд┐рдд рдЪреИрдирд▓_рдмреНрд▓рд╛рд╕реНрдЯ (NHWC) рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдлреНрд▓реЛрдЯрд┐рдВрдЧ рдкреЙрдЗрдВрдЯ <code>ResNet-50 v2</code> рдЗрдирдкреБрдЯ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЗрдирдкреБрдЯ рдЫрд╡рд┐ opencv-python рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрдврд╝реА рдЬрд╛рддреА рд╣реИ рдФрд░ рдлреНрд▓реЛрдЯ 32 рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЦреНрдпрд╛рддреНрдордХ рд╕рд░рдгреА (рдКрдВрдЪрд╛рдИ ├Ч рдЪреМрдбрд╝рд╛рдИ ├Ч рдЪреИрдирд▓) рдореЗрдВ рд▓реЛрдб рд╣реЛрддреА рд╣реИред  рдиреАрдЪреЗ рджреА рдЧрдИ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реНрдЯрдм рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ JPEG рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рд╕рдВрдЦреНрдпрд╛рддреНрдордХ рд╕рд░рдгреА рдореЗрдВ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ gRPC рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП tanor_proto рдореЗрдВ рдХрдирд╡рд░реНрдЯ рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python from __future__ import print_function import argparse import numpy as np import time tt = time.time() import cv2 import tensorflow as tf from grpc.beta import implementations from tensorflow_serving.apis import predict_pb2 from tensorflow_serving.apis import prediction_service_pb2 parser = argparse.ArgumentParser(description='incetion grpc client flags.') parser.add_argument('--host', default='0.0.0.0', help='inception serving host') parser.add_argument('--port', default='9000', help='inception serving port') parser.add_argument('--image', default='', help='path to JPEG image file') FLAGS = parser.parse_args() def main(): # create prediction service client stub channel = implementations.insecure_channel(FLAGS.host, int(FLAGS.port)) stub = prediction_service_pb2.beta_create_PredictionService_stub(channel) # create request request = predict_pb2.PredictRequest() request.model_spec.name = 'resnet' request.model_spec.signature_name = 'serving_default' # read image into numpy array img = cv2.imread(FLAGS.image).astype(np.float32) # convert to tensor proto and make request # shape is in NHWC (num_samples x height x width x channels) format tensor = tf.contrib.util.make_tensor_proto(img, shape=[1]+list(img.shape)) request.inputs['input'].CopyFrom(tensor) resp = stub.Predict(request, 30.0) print('total time: {}s'.format(time.time() - tt)) if __name__ == '__main__': main()</span></span></code> </pre> <br>  JPEG рдЗрдирдкреБрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдПрдХ рдХрд╛рд░реНрдпрд╢реАрд▓ рдЧреНрд░рд╛рд╣рдХ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗрдЧрд╛: <br><br><pre> <code class="bash hljs">python tf_serving_client.py --image=images/pupper.jpg total time: 2.56152906418s</code> </pre> <br>  рдкрд░рд┐рдгрд╛рдореА рдЯреЗрдВрд╕рд░ рдореЗрдВ рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рди рдФрд░ рд╕рдВрдХреЗрддреЛрдВ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рд╣реЛрддрд╛ рд╣реИред <br><br><pre> <code class="python hljs">outputs { key: <span class="hljs-string"><span class="hljs-string">"classes"</span></span> value { dtype: DT_INT64 tensor_shape { dim { size: <span class="hljs-number"><span class="hljs-number">1</span></span> } } int64_val: <span class="hljs-number"><span class="hljs-number">238</span></span> } } outputs { key: <span class="hljs-string"><span class="hljs-string">"probabilities"</span></span> ...</code> </pre> <br>  рдПрдХрд▓ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣ рдХреА рджреЗрд░реА рд╕реНрд╡реАрдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рдХреБрдЫ рднреА рдЖрд╢реНрдЪрд░реНрдп рдХреА рдмрд╛рдд рдирд╣реАрдВ рд╣реИ: рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рдХреА рд╡реНрдпрд╛рдкрдХ рд░реЗрдВрдЬ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЯреЗрдВрд╕реЛрд░рдлрд╝реНрд▓реЛ рд╕реЗрд╡рд╛ рдмрд╛рдЗрдирд░реА рд╣реИред  рдЖрдкрдиреЗ рд╢рд╛рдпрдж рдорд╛рдирдХ рдЯреЗрдирд╕рд░реНрдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдХрдВрдЯреЗрдирд░ рдХреЗ рд▓реЙрдЧ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐рдпрд╛рдБ рджреЗрдЦреАрдВ: <br><br><pre> <code class="plaintext hljs">I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</code> </pre> <br>  рдпрд╣ рдПрдХ CPU рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ TensorFlow рд╕рд░реНрд╡рд┐рдВрдЧ рдмрд╛рдЗрдирд░реА рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h3>  рдПрдХ рдЕрдиреБрдХреВрд▓рд┐рдд рдмрд╛рдЗрдирд░реА рдмрдирд╛рдПрдБ </h3><br>  рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ <a href="">рдбреЙрдХреНрдпреВрдореЗрдВрдЯреЗрд╢рди рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░, рд╣реЛрд╕реНрдЯ рд╕реЗ рд╕реАрдкреАрдпреВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╕рднреА рдЕрдиреБрдХреВрд▓рди рдХреЗ рд╕рд╛рде рд╕реНрд░реЛрдд рд╕реЗ рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдЬрд╣рд╛рдВ рдмрд╛рдЗрдирд░реА рдХрд╛рдо рдХрд░реЗрдЧреАред  рдХреЛрдбрд╛рдВрддрд░рдг рдХрд░рддреЗ рд╕рдордп, рд╡рд┐рд╢реЗрд╖ рдЭрдВрдбреЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рд▓рд┐рдП рд╕реАрдкреАрдпреВ рдЕрдиреБрджреЗрд╢ рд╕реЗрдЯ рдХреА рд╕рдХреНрд░рд┐рдпрддрд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддреЗ рд╣реИрдВ: <br><br><div class="scrollable-table"><table><tbody><tr><th>  рдирд┐рд░реНрджреЗрд╢ рд╕реЗрдЯ </th><th>  рдЭрдВрдбреЗ </th></tr><tr><td>  AVX </td><td>  - рдЧреЛрдж = рдорд╡рдХреНрд╖ </td></tr><tr><td>  AVX2 </td><td>  - рдЕрдкрдирд╛рдиреЗ = -рдорд╛рд╡рдПрдХреНрд╕ реи </td></tr><tr><td>  FMA </td><td>  - рджрддреНрддрдХ = -рдордореНрдорд╛ </td></tr><tr><td>  рдПрд╕рдПрд╕рдИ 4.1 </td><td>  - рдХреНрд░реЙрдк = -msse4.1 </td></tr><tr><td>  рдПрд╕рдПрд╕рдИ 4.2 </td><td>  - рдЕрдкрдирд╛рдиреЗ = -msse4.2 </td></tr><tr><td>  рд╕рднреА рдкреНрд░реЛрд╕реЗрд╕рд░ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╣реИ </td><td>  - рдХреНрд░реЙрдк = -рдорд░рдЪ = рджреЗрд╢реА </td></tr></tbody></table></div><br>  рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдПрдХ рдЯреЗрдВрд╕рд░рдлрд╝реНрд▓реЛ рдХреА рдХреНрд▓реЛрдирд┐рдВрдЧред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рез.резрей рд╣реИ (рдЗрд╕ рд▓реЗрдЦ рдХреЗ рдкреНрд░рдХрд╛рд╢рди рдХреЗ рд╕рдордп рдЕрдВрддрд┐рдо): <br><br><pre> <code class="bash hljs">USER=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> TAG=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> TF_SERVING_VERSION_GIT_BRANCH=<span class="hljs-string"><span class="hljs-string">"r1.13"</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --branch=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TF_SERVING_VERSION_GIT_BRANCH</span></span></span><span class="hljs-string">"</span></span> https://github.com/tensorflow/serving</code> </pre> <br>  Tensorflow рджреЗрд╡ рдЫрд╡рд┐ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреЗрд╕рд▓ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рд╣рдо рдЗрд╕реЗ CPU рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">TF_SERVING_BUILD_OPTIONS=<span class="hljs-string"><span class="hljs-string">"--copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.1 --copt=-msse4.2"</span></span></code> </pre> <br>  рдпрджрд┐ рдкрд░реНрдпрд╛рдкреНрдд рдореЗрдореЛрд░реА рдирд╣реАрдВ рд╣реИ, рддреЛ рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдирд┐рд░реНрдорд╛рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдореЗрдореЛрд░реА рдХреА рдЦрдкрдд рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ <code>--local_resources=2048,.5,1.0</code> ред  рдЭрдВрдбреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреЗрдВрд╕реЛрд░рдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдФрд░ рдбреЙрдХрд░</a> рд╕рд╣рд╛рдпрддрд╛, рд╕рд╛рде рд╣реА рд╕рд╛рде <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд╛рдЬреЗрд▓</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди рджреЗрдЦреЗрдВ</a> ред <br><br>  рдореМрдЬреВрджрд╛ рдПрдХ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдХрд╛рд░реНрдпрд╢реАрд▓ рдЫрд╡рд┐ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash USER=$1 TAG=$2 TF_SERVING_VERSION_GIT_BRANCH="r1.13" git clone --branch="${TF_SERVING_VERSION_GIT_BRANCH}" https://github.com/tensorflow/serving TF_SERVING_BUILD_OPTIONS="--copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.1 --copt=-msse4.2" cd serving &amp;&amp; \ docker build --pull -t $USER/tensorflow-serving-devel:$TAG \ --build-arg TF_SERVING_VERSION_GIT_BRANCH="${TF_SERVING_VERSION_GIT_BRANCH}" \ --build-arg TF_SERVING_BUILD_OPTIONS="${TF_SERVING_BUILD_OPTIONS}" \ -f tensorflow_serving/tools/docker/Dockerfile.devel . cd serving &amp;&amp; \ docker build -t $USER/tensorflow-serving:$TAG \ --build-arg TF_SERVING_BUILD_IMAGE=$USER/tensorflow-serving-devel:$TAG \ -f tensorflow_serving/tools/docker/Dockerfile .</span></span></code> </pre> <br>  ModelServer рдХреЛ рд╕рдорд╕рд╛рдордпрд┐рдХ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">TensorFlow рдЭрдВрдбреЗ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдк рд╕рдорд╛рдирд╛рдВрддрд░ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рджреЛ рдереНрд░реЗрдб рдкреВрд▓ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs">intra_op_parallelism_threads</code> </pre> <br><ul><li>  рдПрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдереНрд░реЗрдбреНрд╕ рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ; <br></li><li>  рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдЙрдк-рд╕рдВрдЪрд╛рд▓рди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░рдХреГрддрд┐ рдореЗрдВ рд╕реНрд╡рддрдВрддреНрд░ рд╣реЛрддреЗ рд╣реИрдВред </li></ul><br><pre> <code class="plaintext hljs">inter_op_parallelism_threads</code> </pre> <br><ul><li>  рд╕реНрд╡рддрдВрддреНрд░ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдереНрд░реЗрдбреНрд╕ рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ; <br></li><li>  Tensorflow рдЧреНрд░рд╛рдлрд╝ рд╕рдВрдЪрд╛рд▓рди, рдЬреЛ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рд╕реНрд╡рддрдВрддреНрд░ рд╣реИрдВ рдФрд░ рдЗрд╕рд▓рд┐рдП, рд╡рд┐рднрд┐рдиреНрди рдереНрд░реЗрдбреНрд╕ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </li></ul><br>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рджреЛрдиреЛрдВ рдкреИрд░рд╛рдореАрдЯрд░ <code>0</code> рд╕реЗрдЯ рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рд╕реНрд╡рдпрдВ рдЙрдкрдпреБрдХреНрдд рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЕрд░реНрде рд╣реИ рдкреНрд░рддрд┐ рдХреЛрд░ рдПрдХ рдзрд╛рдЧрд╛ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдорд▓реНрдЯреА-рдХреЛрд░ рдХреЙрдиреНрд╕рд┐рдХреНрд╡реЗрдВрд╕реА рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдлрд┐рд░ рд╕рд░реНрд╡рд┐рд╕рд┐рдВрдЧ рдХрдВрдЯреЗрдирд░ рдХреЛ рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреА рддрд░рд╣ рд╕реЗ рдЪрд▓рд╛рдПрдВ, рдЗрд╕ рдмрд╛рд░ рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдбреЙрдХрдЯрд░ рдЫрд╡рд┐ рдХреЗ рд╕рд╛рде рдФрд░ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рд▓рд┐рдП рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рдлрд╝реНрд▓реИрдЧ рдХреЗ рд╕рд╛рде: <br><br><pre> <code class="bash hljs">docker run -d -p 9000:8500 \ -v $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>)/models:/models/resnet -e MODEL_NAME=resnet \ -t <span class="hljs-variable"><span class="hljs-variable">$USER</span></span>/tensorflow-serving:<span class="hljs-variable"><span class="hljs-variable">$TAG</span></span> \ --tensorflow_intra_op_parallelism=4 \ --tensorflow_inter_op_parallelism=4</code> </pre> <br>  рдХрдВрдЯреЗрдирд░ рд▓реЙрдЧ рдХреЛ рдЕрдм рдПрдХ рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд рд╕реАрдкреАрдпреВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪреЗрддрд╛рд╡рдиреА рдирд╣реАрдВ рджрд┐рдЦрд╛рдиреА рдЪрд╛рд╣рд┐рдПред  рдПрдХ рд╣реА рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдЕрдиреБрд░реЛрдз рдкрд░ рдХреЛрдб рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд┐рдирд╛, рджреЗрд░реА рд▓рдЧрднрдЧ 35.8% рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИ: <br><br><pre> <code class="bash hljs">python tf_serving_client.py --image=images/pupper.jpg total time: 1.64234706879s</code> </pre> <br><h3>  рдЧреНрд░рд╛рд╣рдХ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдореЗрдВ рдЧрддрд┐ рдмрдврд╝рд╛рдПрдВ </h3><br>  рдХреНрдпрд╛ рдЕрдм рднреА рддреЗрдЬреА рд╕рдВрднрд╡ рд╣реИ?  рд╣рдордиреЗ рдЕрдкрдиреЗ рд╕реАрдкреАрдпреВ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди 1 рд╕реЗрдХрдВрдб рд╕реЗ рдЕрдзрд┐рдХ рдХреА рджреЗрд░реА рдЕрднреА рднреА рдмрд╣реБрдд рдмрдбрд╝реА рд▓рдЧрддреА рд╣реИред <br><br>  рдРрд╕рд╛ рд╣реБрдЖ рдХрд┐ <code>tensorflow_serving</code> рдФрд░ <code>tensorflow</code> <code>tensorflow_serving</code> рд▓реЛрдб рдХрд░рдирд╛ рджреЗрд░реА рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдпреЛрдЧрджрд╛рди рджреЗрддрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХреЙрд▓ <code>tf.contrib.util.make_tensor_proto</code> рдПрдХ рд╡рд┐рднрд╛рдЬрди рджреВрд╕рд░рд╛ рднреА рдЬреЛрдбрд╝рддрд╛ рд╣реИред <br><br>  рдЖрдк рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ: "рдХреНрдпрд╛ рд╣рдореЗрдВ TensorFlow рдкрд╛рдпрдерди рдкреИрдХреЗрдЬреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ Tensorflow рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ?"  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, <code>tensorflow_serving</code> рдФрд░ <code>tensorflow</code> рдкреИрдХреЗрдЬ <i>рдХреА</i> рдХреЛрдИ рд╡рд╛рд╕реНрддрд╡рд┐рдХ <i>рдЖрд╡рд╢реНрдпрдХрддрд╛</i> рдирд╣реАрдВ рд╣реИред <br><br>  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдПрдкреАрдЖрдИ рдХреЛ рдкреНрд░реЛрдЯреЛ-рдмрдлрд╝рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рджреЛ рдмрд╛рд╣рд░реА рдирд┐рд░реНрднрд░рддрд╛рдПрдБ рдЗрд╕реА <code>tensorflow</code> рдФрд░ <code>tensorflow_serving</code> рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ - рдФрд░ рдлрд┐рд░ рдЖрдкрдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдкрд░ рд╕рдВрдкреВрд░реНрдг (рднрд╛рд░реА) рдЯреЗрдиреНрд╕рдлрд╝реНрд▓реЛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рдЦреАрдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, <code>tensorflow</code> рдФрд░ <code>tensorflow_serving</code> рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ <code>tensorflow</code> рдФрд░ <code>grpcio-tools</code> рдкреИрдХреЗрдЬ рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="bash hljs">pip uninstall tensorflow tensorflow-serving-api &amp;&amp; \ pip install grpcio-tools==1.0.0</code> </pre> <br>  <code>tensorflow/tensorflow</code> рдФрд░ <code>tensorflow/serving</code> рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдХреНрд▓реЛрди рдХрд░реЗрдВ рдФрд░ <code>tensorflow/serving</code> рд▓рд┐рдП рдирд┐рдореНрди рдкреНрд░реЛрдЯреЛрдмреЙрдлрд╝ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХреЙрдкреА рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">tensorflow/serving/ tensorflow_serving/apis/model.proto tensorflow_serving/apis/predict.proto tensorflow_serving/apis/prediction_service.proto tensorflow/tensorflow/ tensorflow/core/framework/resource_handle.proto tensorflow/core/framework/tensor_shape.proto tensorflow/core/framework/tensor.proto tensorflow/core/framework/types.proto</code> </pre> <br>  рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдП рдЧрдП рдореВрд▓ рд░рд╛рд╕реНрддреЛрдВ рдХреЗ рд╕рд╛рде рдЗрди <code>protos/</code> рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ <code>protos/</code> рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">protos/ tensorflow_serving/ apis/ *.proto tensorflow/ core/ framework/ *.proto</code> </pre> <br>  рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА RPC рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">prediction_service.proto</a> рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реЗрд╡рд╛ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдиреНрдп RPC рдХреА рдиреЗрд╕реНрдЯреЗрдб рдирд┐рд░реНрднрд░рддрд╛ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> рдПрдХ рд╕рд░рд▓реАрдХреГрдд <code>prediction_service.</code> рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  Grpcio.tools.protoc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рдпрдерди рдЬреАрдЖрд░рдкреАрд╕реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрдирд╛рдПрдВ: <br><br><pre> <code class="plaintext hljs">PROTOC_OUT=protos/ PROTOS=$(find . | grep "\.proto$") for p in $PROTOS; do python -m grpc.tools.protoc -I . --python_out=$PROTOC_OUT --grpc_python_out=$PROTOC_OUT $p done</code> </pre> <br>  рдЕрдм рдкреВрд░реЗ <code>tensorflow_serving</code> рдХреЛ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">from tensorflow_serving.apis import predict_pb2 from tensorflow_serving.apis import prediction_service_pb2</code> </pre> <br>  ... рдФрд░ <code>protos/tensorflow_serving/apis</code> рд╕реЗ рдЙрддреНрдкрдиреНрди <code>protos/tensorflow_serving/apis</code> рд╕рд╛рде рдмрджрд▓реЗрдВ: <br><br><pre> <code class="plaintext hljs">from protos.tensorflow_serving.apis import predict_pb2 from protos.tensorflow_serving.apis import prediction_service_pb2</code> </pre> <br>  Tensorflow рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд╣реЗрд▓реНрдкрд░ рдлрдВрдХреНрд╢рди <code>make_tensor_proto</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдпрд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ TensorProto рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдЕрдЬрдЧрд░ / рд╕рдВрдЦреНрдпрд╛рддреНрдордХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рд▓рдкреЗрдЯрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрднрд░рддрд╛ рдФрд░ рдХреЛрдб рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf ... tensor = tf.contrib.util.make_tensor_proto(features) request.inputs[<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>].CopyFrom(tensor)</code> </pre> <br>  рдкреНрд░реЛрдЯреЛрдмрдлрд╝рд░реНрд╕ рдЖрдпрд╛рдд рдХрд░реЗрдВ рдФрд░ TensorProto рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensor_pb2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensor_shape_pb2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> types_pb2 ... <span class="hljs-comment"><span class="hljs-comment"># ensure NHWC shape and build tensor proto tensor_shape = [1]+list(img.shape) dims = [tensor_shape_pb2.TensorShapeProto.Dim(size=dim) for dim in tensor_shape] tensor_shape = tensor_shape_pb2.TensorShapeProto(dim=dims) tensor = tensor_pb2.TensorProto( dtype=types_pb2.DT_FLOAT, tensor_shape=tensor_shape, float_val=list(img.reshape(-1))) request.inputs['inputs'].CopyFrom(tensor)</span></span></code> </pre> <br>  рдкреВрд░реНрдг рдкрд╛рдпрдерди рд▓рд┐рдкрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ рд╣реИ</a> ред  рдПрдХ рдЕрджреНрдпрддрди рд╕реНрдЯрд╛рд░реНрдЯрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдЪрд▓рд╛рдПрдВ рдЬреЛ рдЕрдиреБрдХреВрд▓рд┐рдд Tensorflow рд╕рд░реНрд╡рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="bash hljs">python tf_inception_grpc_client.py --image=images/pupper.jpg total time: 0.58314920859s</code> </pre> <br>  рдирд┐рдореНрди рдЖрд░реЗрдЦ рдорд╛рдирдХ рдХреЗ рдореБрдХрд╛рдмрд▓реЗ 10 рд╕реЗ рдЕрдзрд┐рдХ рд░рди рдХреЗ рдЯреЗрдирд╕рдлрд╝реНрд▓реЛ рд╕реЗрд╡рд╛ рдХреЗ рдЕрдиреБрдХреВрд▓рд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48d/990/b83/48d990b83dc54762fec809a580c450c8.png"><br><br>  рдФрд╕рдд рд╡рд┐рд▓рдВрдм рд▓рдЧрднрдЧ 3.38 рдЧреБрдирд╛ рдХрдо рд╣реБрдЖред <br><br><h1>  рдмреИрдВрдбрд╡рд┐рдбреНрде рдЕрдиреБрдХреВрд▓рди </h1><br>  рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрдВрд╕рд░рдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдмреИрдВрдбрд╡рд┐рдбреНрде рдЕрдиреБрдХреВрд▓рди рдЖрдорддреМрд░ рдкрд░ "рд╕реНрдЯреИрдВрдб-рдЕрд▓реЛрди" рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рддрдВрдЧ рд╡рд┐рд▓рдВрдмрддрд╛ рд╕реАрдорд╛рдПрдВ рдПрдХ рд╕рдЦреНрдд рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИрдВред <br><br><h3>  рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг </h3><br>  рдЬреИрд╕рд╛ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди</a> рдореЗрдВ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ, рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдмреИрдЪ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдореВрд▓ рд░реВрдк рд╕реЗ рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рд╕рд░реНрд╡рд┐рдВрдЧ рдореЗрдВ рд╕рдорд░реНрдерд┐рдд рд╣реИред <br><br>  рд▓реЗрдЯреЗрдВрд╕реА рдФрд░ рдереНрд░реВрдкреБрдЯ рдХреЗ рдмреАрдЪ рдХреЗ рдЯреНрд░реЗрдб-рдСрдл рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдмреИрдЪ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдорд╛рдкрджрдВрдбреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡реЗ рдЖрдкрдХреЛ рдЕрдзрд┐рдХрддрдо рдереНрд░реВрдкреБрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рддреНрд╡рд░рдХ рд╕рдХреНрд╖рдо рд╣реИрдВред <br><br>  рдкреИрдХреЗрдЬрд┐рдВрдЧ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>--enable_batching</code> рдФрд░ <code>--batching_parameters_file</code> рд╕реЗрдЯ рдХрд░реЗрдВред  рдкреИрд░рд╛рдореАрдЯрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SessionBundleConfig рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред  рд╕реАрдкреАрдпреВ рдкрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП, рдЙрдкрд▓рдмреНрдз рдХреЛрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП <code>num_batch_threads</code> рд╕реЗрдЯ рдХрд░реЗрдВред  GPU рдХреЗ рд▓рд┐рдП, <a href="">рдпрд╣рд╛рдВ</a> рдЙрдкрдпреБрдХреНрдд рдкреИрд░рд╛рдореАрдЯрд░ рджреЗрдЦреЗрдВред <br><br>  рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░ рдкреВрд░реЗ рдкреИрдХреЗрдЬ рдХреЛ рднрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдПрдХ рдмрдбрд╝реЗ рдЕрдиреБрд░реЛрдз (рдЯреЗрдВрд╕рд░) рдореЗрдВ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдПрдХ рд╕рдВрдпреБрдХреНрдд рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рдЯреЗрдиреНрд╕рд░рдлрд╝реНрд▓реЛ рд╕рддреНрд░ рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, CPU / GPU рд╕рдорд╛рдирддрд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред <br><br>  Tensorflow рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧ: <br><br><ul><li>  рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкреИрдХреЗрдЯ рдХреЛ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреНрд▓рд╛рдЗрдВрдЯ рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ <br></li><li>  рдореЙрдбрд▓ рдЧреНрд░рд╛рдл рдХреЗ рдШрдЯрдХреЛрдВ рдХреЛ рд╕реАрдкреАрдпреВ / рдЬреАрдкреАрдпреВ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдХреЗ рддреЗрдЬрд╝ рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг <br></li><li>  рдПрдХрд▓ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдИ рдореЙрдбрд▓реЛрдВ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ <br></li><li>  рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ "рдСрдлрд╝рд▓рд╛рдЗрди" рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЕрддреНрдпрдзрд┐рдХ рдЕрдиреБрд╢рдВрд╕рд╛ рдХреА рдЬрд╛рддреА рд╣реИ </li></ul><br><h3>  рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг </h3><br>  рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕рдореВрд╣ рдХрдИ рдЖрд╡рдХ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдПрдХ рдореЗрдВ рд░рдЦрддрд╛ рд╣реИред <br><br>  рдЪреВрдВрдХрд┐ рд░реЗрд╕рдиреЗрдЯ рдореЙрдбрд▓ NHWC рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдЗрдирдкреБрдЯ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ (рдкрд╣рд▓рд╛ рдЖрдпрд╛рдо рдЗрдирдкреБрдЯ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ), рд╣рдо рдХрдИ рдЗрдирдкреБрдЯ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рдПрдХ рдЖрд░рдкреАрд╕реА рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>batch = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jpeg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(FLAGS.images_path): path = os.path.join(FLAGS.images_path, jpeg) img = cv2.imread(path).astype(np.float32) batch.append(img) ... batch_np = np.array(batch).astype(np.float32) dims = [tensor_shape_pb2.TensorShapeProto.Dim(size=dim) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dim <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> batch_np.shape] t_shape = tensor_shape_pb2.TensorShapeProto(dim=dims) tensor = tensor_pb2.TensorProto( dtype=types_pb2.DT_FLOAT, tensor_shape=t_shape, float_val=list(batched_np.reshape(<span class="hljs-number"><span class="hljs-number">-1</span></span>))) request.inputs[<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>].CopyFrom(tensor)</code> </pre> <br>  рдПрди рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рдПрдХ рдкреИрдХреЗрдЯ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рдЯреЗрдВрд╕рд░ рдореЗрдВ рд╕рдорд╛рди рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЗрдирдкреБрдЯ рдХреЗ рд▓рд┐рдП рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдкрд░рд┐рдгрд╛рдо рд╣реЛрдВрдЧреЗред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрди = 2: <br><br><pre> <code class="python hljs">outputs { key: <span class="hljs-string"><span class="hljs-string">"classes"</span></span> value { dtype: DT_INT64 tensor_shape { dim { size: <span class="hljs-number"><span class="hljs-number">2</span></span> } } int64_val: <span class="hljs-number"><span class="hljs-number">238</span></span> int64_val: <span class="hljs-number"><span class="hljs-number">121</span></span> } } ...</code> </pre> <br><h1>  рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рддреНрд╡рд░рдг </h1><br>  GPU рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрджред <br><br>  рд╕реАрдЦрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ GPU рдкрд░ рд╕рдорд╛рдирд╛рдВрддрд░реАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЧрд╣рди рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдЗрд╖реНрдЯрддрдо рд╕рдорд╛рдзрд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдВрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП, рд╕рдорд╛рдирд╛рдВрддрд░реАрдХрд░рдг рдЗрддрдирд╛ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИред  рдЕрдХреНрд╕рд░ рдЖрдк рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЙрддреНрдкрд╛рджрди рдХреЛ рдПрдХ рдЬреАрдкреАрдпреВ рддрдХ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдЙрдкрдХрд░рдг рдХрд╛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЪрдпрди рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдЧрд╣рди рддрдХрдиреАрдХреА рдФрд░ рдЖрд░реНрдерд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  "рд╕реНрд╡рд╛рдпрддреНрдд" рдирд┐рд╖реНрдХрд░реНрд╖ (рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рд╡реЙрд▓реНрдпреВрдо) рдХреЗ рдмреИрдЪ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕рдорд╛рдирд╛рдВрддрд░рдХрд░рдг рдЕрдзрд┐рдХ рдореВрд▓реНрдпрд╡рд╛рди рд╣реИред <br><br>  GPU рдкрд░ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╕рдмрд╕реЗ рдмрдбрд╝реА рд▓рд╛рдн (рдХрдо рд╡рд┐рд▓рдВрдмрддрд╛, рдЙрдЪреНрдЪ рдереНрд░реВрдкреБрдЯ) рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧрдд (рдореМрджреНрд░рд┐рдХ, рдкрд░рд┐рдЪрд╛рд▓рди, рддрдХрдиреАрдХреА) рдХреЗ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд╕рд╛рде рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi445928/">https://habr.com/ru/post/hi445928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi445918/index.html">20 рд╕рд╛рд▓ рдХреЗ рд░реЛрд▓рд░рдХреЛрд╕реНрдЯрд░ рдЯрд╛рдЗрдХреВрди: рдЦреЗрд▓ рдХреЗ рдирд┐рд░реНрдорд╛рддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░</a></li>
<li><a href="../hi445920/index.html">рд▓рд╛рдЗрд╡: рдмрдбрд╝реА рдЯреАрдореЛрдВ рдореЗрдВ iOS рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЛ рдХреИрд╕реЗ рд░реЛрдХреЗрдВ</a></li>
<li><a href="../hi445922/index.html">рдпрджрд┐ рдЖрдк Habr рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдСрдирд▓рд╛рдЗрди рдкреНрд░рд╕рд╛рд░рдг рдХреНрдпреЛрдВ рджреЗрдЦреЗрдВ</a></li>
<li><a href="../hi445924/index.html">TREASURES: рдЬрдм рд╕реНрдорд╛рд░реНрдЯ рдШрдбрд╝рд┐рдпреЛрдВ рдХреЛ рдЕрдЬреАрдм рд▓рдЧрддрд╛ рд╣реИ</a></li>
<li><a href="../hi445926/index.html">рдЕрдореЗрд░рд┐рдХрд╛ рдХрд╛ рдпреВрдПрдлрдУ рд╕реАрдХреНрд░реЗрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╡рд░реНрдорд╣реЛрд▓ рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдЖрдпрд╛рдореЛрдВ рдкрд░ рднреА рд╢реЛрдз рдХрд░ рд░рд╣рд╛ рд╣реИред</a></li>
<li><a href="../hi445932/index.html">рдХреНрд▓рд╛рдЗрдВрдЯ рдПрдкреНрд▓реАрдХреЗрд╢рди рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА: рдлреНрд░рдВрдЯ-рдПрдВрдб рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд▓рд┐рдП рдкреНрд░реИрдХреНрдЯрд┐рдХрд▓ рдЯрд┐рдкреНрд╕</a></li>
<li><a href="../hi445936/index.html">рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХреНрд╕ рд╡рд┐рдХрд╛рд╕ред рдЙрдВрдЧрд▓рд┐рдпреЛрдВ рдкрд░ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi445940/index.html">рд╣рд╛рдмрд░рд╛ рдХреЗ рд╕рд╛рде рдПрдПрдордП, рд╡реА 7.0ред рдиреАрдВрдмреВ, рдбреЛрдирдЯреНрд╕ рдФрд░ рд╕рдорд╛рдЪрд╛рд░</a></li>
<li><a href="../hi445946/index.html">MWC: рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢</a></li>
<li><a href="../hi445948/index.html">C ++ рдореЗрдВ рдирд┐рд╣рд┐рдд: рд╢реБрд░реБрдЖрддреА, рдордзреНрдпрд╡рд░реНрддреА, рдЙрдиреНрдирдд</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>