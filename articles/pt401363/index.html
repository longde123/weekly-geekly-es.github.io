<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎍 👸🏻 🛥️ Lado escuro MH-Z19 ⏭️ 👩🏿‍🤝‍👩🏻 🕵🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O que de novo? Quanto você pode? 

 Sim, hoje falaremos novamente sobre o nosso amado sensor de dióxido de carbono Winsen MH-Z19. Não, não haverá repe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lado escuro MH-Z19</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401363/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que de novo?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quanto você pode?</a> <br><br>  Sim, hoje falaremos novamente sobre o nosso amado sensor de dióxido de carbono Winsen MH-Z19.  Não, não haverá repetições *. <br><br><img src="https://habrastorage.org/files/fbf/b65/069/fbfb65069dd446b180901d854abd0dd1.JPG"><br><br>  * quase <br><br>  Como você deve ter notado, <s>histórias de horror</s> sobre os perigos de altas concentrações de CO2 na sala aparecem regularmente nas páginas deste recurso.  E embora as alegações de que concentrações acima de 1000 ppm carreguem o inferno e a morte sejam um pouco exageradas (a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> diz que pelo menos alguns efeitos começam com 1%, ou seja, 10.000 ppm, enquanto o sensor tem toda a faixa de 5000 ppm) - o CO2 pode servir como um indicador da presença de outras coisas ruins devido à ventilação insuficiente.  Portanto, eu também decidi me juntar ao mundo fascinante da CO2-metry e me apossar do sensor mencionado. <br><br>  A primeira coisa, é claro, eu o conectei ao arduino.  Copiei (com as alterações necessárias) o código do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> , os números estimados apareceram na tela. <br><br>  Mas enquanto eu o copiava, uma minhoca de dúvida surgiu em minha alma - por que esse sensor forneceu nove bytes e apenas dois bytes foram responsáveis ​​por CO2?  Talvez ele queira me dizer outra coisa? <br><a name="habracut"></a><br>  Uma pesquisa na Internet me levou a uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">página</a> tão <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interessante</a> .  O autor experimenta o MH-Z19 e revela sua reação a comandos não documentados (e documentados).  Ele ainda não tentou todas as equipes, então ainda há espaço para a nossa parte se divertir.  É isso que faremos. <br><br>  Antes de tudo, trataremos da equipe "clássica" 0x86 (ou simplesmente 134), com a qual obtemos a concentração de CO2.  Relatórios do Revspace: <br><br><blockquote>  Uma resposta ao comando 0x86 geralmente se parece com isso: <br>  0xFF CM HH LL TT SS Uh Ul CS <br>  onde <br>  CM é o comando repetido de volta <br>  HH / LL é o valor de CO2 ppm, parte alta / baixa <br>  TT é a temperatura em graus Celsius, mais 40. Por exemplo, quando a temperatura é de 25 graus C, TT = 0x41 <br>  SS é algum tipo de byte de status, esse byte sempre tem apenas um bit definido! <br>  Uh / Ul é algum valor desconhecido, talvez relacionado à pressão?  Depois de inicializar o sensor, ele inicia exatamente às 15000 e, em seguida, geralmente se instala em cerca de 10500. <br>  Cs é a soma de verificação </blockquote><br>  Ou seja, a resposta do sensor a esse comando também contém a temperatura T (deslocada em 40 graus) e dois valores de destino desconhecidos - um byte S e dois bytes U. S recebe valores de dois graus e U, quando o sensor inicia, cai de 15.000 para pouco mais de 10 000 <br><br>  Como entender o que os números S e U significam?  Claro, você precisa desenhar um gráfico!  Em qualquer situação incompreensível, desenhe um gráfico. <br><br><div class="spoiler">  <b class="spoiler_title">Detalhes técnicos maçantes</b> <div class="spoiler_text">  E para desenhar um gráfico, seria bom direcionar as leituras do sensor para um computador.  O que fiz com Serial.println ().  A cada cinco segundos, o arduin examina o sensor e grava suas leituras no USB-UART, tudo o que resta é lê-las no computador e salvá-las em um arquivo.  Eu faço isso (no Linux) assim: <br><br><pre><code class="bash hljs">rlwrap cat | cu -l /dev/ttyACM0 &gt; sensor_$(date <span class="hljs-string"><span class="hljs-string">'+%Y%m%d_%H%M%S'</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">Não chute</b> <div class="spoiler_text">  Sim, eu sei que você pode fazer apenas cat / dev / ttyACM0&gt; .., mas por algum motivo isso nem sempre funciona para mim, às vezes esse comando termina imediatamente em silêncio.  Também gosto do comando fornecido (rlwrap cat | cu -l / dev / ttyACM0) porque permite que você se comunique convenientemente com o microcontrolador no modo interativo (embora isso não seja necessário neste caso).  Certamente existem ferramentas melhores para esse fim, mas, infelizmente, eu não as conheço. <br></div></div><br>  Em outra janela do terminal, você pode assistir a este arquivo em tempo real: <br><br><pre> <code class="hljs pgsql">tail -f sensor_.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre> <br>  Acontece que uma folha de números: <br><br><pre> <code class="hljs erlang">... <span class="hljs-number"><span class="hljs-number">1188</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> <span class="hljs-number"><span class="hljs-number">1188</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> <span class="hljs-number"><span class="hljs-number">1190</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> <span class="hljs-number"><span class="hljs-number">1191</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> <span class="hljs-number"><span class="hljs-number">1192</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> <span class="hljs-number"><span class="hljs-number">1193</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> <span class="hljs-number"><span class="hljs-number">1195</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">10790</span></span> ...</code> </pre> <br>  Cada linha contém CO2, T, S, U (U é repetido duas vezes - como dois bytes e um número de dois bytes, não pergunte o porquê). <br><br>  Agora você pode criar gráficos.  Eu farei isso com o ipython --pylab. <br><br><pre> <code class="python hljs">y = map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> a: map(int, a.split()), open(<span class="hljs-string"><span class="hljs-string">"sensor1.log"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>).readlines()) <span class="hljs-comment"><span class="hljs-comment">#     ,     ,    yt = transpose(y) x = arange(len(yt[0])) / 720. #    ,        figure() plot(x, yt[0]) # CO2 figure(); plot(x, yt[1], "g"); # T figure(); plot(x, yt[2], "r"); # S figure(); plot(x, yt[-1], "m"); # U</span></span></code> </pre><br></div></div><br>  Então, o gráfico de CO2: <br><img src="https://habrastorage.org/files/bb5/58b/958/bb558b958d4b484c9b70307c3f05d8e1.png"><br>  Em princípio, parece ser verdade.  Tristes apenas explosões periódicas.  Parece que isso ocorre porque o sensor está simplesmente deitado sobre a mesa e, com a menor brisa, suas leituras são perdidas. <br><br>  Temperatura: <br><img src="https://habrastorage.org/files/793/05e/1be/79305e1be11a4a69a29ef67608b2ad47.png"><br>  O momento em que abri a janela é claramente visível.  Pivôs de 1 a 2 graus, o que não é ruim para uma oportunidade não documentada.  No entanto, se recordarmos o princípio do sensor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NDIR</a> , podemos entender que não se deve esperar grande precisão do termômetro embutido.  Esses instrumentos medem a absorção de luz na faixa do infravermelho distante, e a boa e velha lâmpada de Ilyich é usada para gerar essa luz, e você pode até ver através das janelas como ela se ilumina a cada cinco segundos (um momento assim é detectado no KDPV).  E essa lâmpada consome muita energia e, como resultado, aquece todo o sensor, e quanto ele aquece depende da conjuntura momentânea dos fluxos de ar. <br><br>  Abordamos o mais interessante.  Valor S: <br><img src="https://habrastorage.org/files/739/510/7bd/7395107bd5e94483a0e746cfe94c3580.png"><br>  Não diz nada?  Eu também  Com o luto, desenhamos CO2 e S no mesmo gráfico e aumentamos ligeiramente: <br><img src="https://habrastorage.org/files/c34/f9d/634/c34f9d63486441ae971fc9b76de17566.png"><br>  Sim!  Agora está tudo claro!  Quando tudo está bem, S é 64, e quando o sensor de CO2 começa a salsicha, ele cai para 4. Portanto, você pode usar S para descobrir como o sensor se sente e qual a precisão de suas leituras. <br><br>  Resta, como dizem os pára-quedistas, o valor extremo é U: <br><img src="https://habrastorage.org/files/75f/af7/b52/75faf7b522b840968649ca3163900f4a.png"><br>  Infelizmente, um truque de sobreposição faz pouco aqui.  É visível apenas que, como o revspace prometeu, no início é igual a 15.000 e depois cai para pouco mais de 10.000 (mas pode cair um pouco depois de muito tempo).  E uma vez por dia o ciclo se repete. <br><br>  Mas quando conectei a potência do sensor não a 5, mas a 3,3 volts de arduino, a situação mudou: <br><img src="https://habrastorage.org/files/3f6/765/09e/3f676509e04e4530a0e96794c5aff651.png"><br>  3,3 volts no arduino são retirados do chip LP2985, que é um estabilizador linear de 160 miliamperes.  E a lâmpada, a julgar pelos artigos na Internet, come tanto.  Ao olhar para o sensor, é perceptível que a lâmpada com esta fonte de energia acende mais tempo do que em cinco volts.  E o valor de U é uma vez e meia maior. <br><br>  A hipótese a seguir emerge - o sensor determina automaticamente quanto tempo leva para acender a lâmpada para obter radiação infravermelha suficiente e, se não houver corrente suficiente, queima a lâmpada por mais tempo.  E o valor de U reflete apenas o tempo de queima da lâmpada (ou algum outro valor relacionado, por exemplo, a energia gasta). <br><br>  Para testar essa suposição, alimentamos o sensor a partir de uma bateria de íons de lítio, que obviamente pode produzir uma corrente muito maior: <br><img src="https://habrastorage.org/files/4de/df5/1cc/4dedf51cc236498787bec68a5673b17a.png"><br>  De fato, U às vezes cai abaixo de 10.000!  No entanto, isso obviamente não é uma prova absoluta e, após 24 horas, tudo se torna quase o oposto.  Portanto, a hipótese permanece apenas uma hipótese, mas não criei nada melhor. <br><br>  <b>UPD:</b> Caro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">unsvp</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">resolveu o</a> enigma do valor U. Dou a ele a palavra: <br><br><blockquote>  o valor de U é obviamente o valor mínimo da absorção medida de CO2 por dia, em algumas unidades de medida internas. <br></blockquote><br>  Nada a acrescentar, exceto que a programação: <br><img src="https://habrastorage.org/files/a10/338/7ce/a103387ce60f4df38695e4842a06feae.png"><br>  Por que eu não pensei nisso?  Tudo é simples.  Desenhei um gráfico de quatro valores de uma vez e resolvi isso.  Mas era necessário desenhar duas quantidades (como na figura acima), para que o lixo estranho em face da magnitude S não interferisse na percepção.  Não repita meus erros. <br><br>  Talvez eu acrescente o seguinte: você vê um passo maior que 1000 ppm em 48 horas?  Este sensor é calibrado automaticamente.  Nesse caso, o valor de U caiu em comparação com o que era antes da calibração.  Considerando que é óbvio que a concentração real de CO2 durante esse período apenas aumentou.  A conclusão disso é muito simples - o valor U não é um valor de absorção muito "bruto", mas já está calculado ajustado para a calibração atual, aparentemente representando alguma diferença nas leituras mínimas nos ciclos de calibração atual e anterior. <br><br>  Em geral, na minha opinião, a calibração automática (pelo menos na forma em que é implementada no MH-Z19) é ruim.  O Revspace diz que pode ser desabilitado usando o comando 0x79: ABC logic on / off. <br><br>  <b>/ UPD</b> <br><br>  Bem, com uma equipe resolvida.  É hora de ir mais longe, e o artigo está chegando ao fim e outras 255 equipes não foram testadas! <br><br>  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo revspace, a</a> lista de comandos testados termina assim: <br><br><blockquote>  comando 0x89-0x8F <br>  Nenhuma resposta é retornada, no entanto, o comando 0x8d parece redefinir o sensor. <br><br>  comando 0x99 (intervalo) <br>  ... </blockquote><br>  Além disso, as equipes com números mais baixos não são todas verificadas.  Assim, pouco mais da metade do número total de equipes desconhecidas permanece. <br><br>  Sem mais delongas, decidi dar comandos aleatoriamente (mais precisamente, pseudo-aleatoriamente).  E aqui está o que eu tenho: <br><br><pre> <code class="hljs perl">... Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">208</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">00</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 17 0 0 0 0 0 238 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 45 0 0 0 0 0 210 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">250</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">00</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 88 0 0 0 0 0 167 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 245 0 0 0 0 0 10 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">107</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">148</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">00</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 214 0 0 0 0 0 41 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 136 0 0 0 0 0 119 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">248</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">00</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 153 0 0 0 0 0 102 Response: 255 153 1 0 0 0 0 0 102 CRC: 102102 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 256 0 0 0 Command: 255 1 146 0 0 0 0 0 109 Response: 0 0 0 0 0 0 0 0 0 CRC: 00 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">183</span></span> Response: <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-number"><span class="hljs-number">249</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">211</span></span> <span class="hljs-number"><span class="hljs-number">215</span></span> <span class="hljs-number"><span class="hljs-number">212</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">215</span></span> <span class="hljs-number"><span class="hljs-number">204</span></span> CRC: <span class="hljs-number"><span class="hljs-number">159204</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 723 215 212 4567 Command: 255 1 51 0 0 0 0 0 204 Response: 93 151 80 143 212 255 255 255 217 CRC: 185217 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 20623 212 255 -1 Command: 255 1 98 0 0 0 0 0 157 Response: 16 136 252 75 66 50 48 48 13 CRC: 9313 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: -<span class="hljs-number"><span class="hljs-number">949</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">12336</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">190</span></span> Response: <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 243 0 0 0 0 0 12 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 13 0 0 0 0 0 242 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">220</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 229 0 0 0 0 0 26 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 95 0 0 0 0 0 160 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">207</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 209 0 0 0 0 0 46 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 200 0 0 0 0 0 55 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ...</code> </pre> <br>  Aqui Command é o que foi enviado ao sensor (o número do comando em si é o terceiro número desde o início), Response é o que o sensor respondeu, você não pode olhar para o resto (CRC é a soma de verificação calculada / real, CO2 / t / s / u é o resultado da quebra resposta do sensor a quatro números, como se estivesse respondendo a um comando "padrão"). <br><br>  Como você pode ver, não muito.  Além disso, a partir de algum ponto, o sensor recusou-se completamente a fornecer algo além de zeros.  A última coisa que obtive do sensor foi: <br><br><pre> <code class="hljs perl">Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">121</span></span> Response: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CRC: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: 0 0 0 0 Command: 255 1 130 0 0 0 0 0 125 Response: 242 98 200 201 207 216 178 130 33 CRC: 50 33 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: -14135 207 216 -19838 Command: 255 1 134 0 0 0 0 0 121 Response: 204 91 151 80 143 212 255 255 236 CRC: 93 236 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: -<span class="hljs-number"><span class="hljs-number">26800</span></span> <span class="hljs-number"><span class="hljs-number">143</span></span> <span class="hljs-number"><span class="hljs-number">212</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span> Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> Response: <span class="hljs-number"><span class="hljs-number">181</span></span> <span class="hljs-number"><span class="hljs-number">156</span></span> <span class="hljs-number"><span class="hljs-number">252</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">79</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">85</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> CRC: <span class="hljs-number"><span class="hljs-number">241</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> CO2/t/<span class="hljs-regexp"><span class="hljs-regexp">s/u: -947 79 68 16981 Command: 255 1 134 0 0 0 0 0 121 Response: 13 10 0 0 0 0 0 0 0 CRC: 246 0 CO2/t/s</span></span><span class="hljs-regexp"><span class="hljs-regexp">/u: 0 0 0 0 Command: 255 1 216 0 0 0 0 0 39 Response: 0 0 0 0 0 0 0 0 0 CRC: 0 0 CO2/t</span></span><span class="hljs-regexp"><span class="hljs-regexp">/s/u</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  E depois zeros.  Tentei digitar comandos sequencialmente, começando com 0x8e - novamente zeros.  Eu tentei dar o comando "padrão" 0x86 - zeros.  Eu matei o sensor?  Na verdade, todas as condições estão presentes - insiro pequenos comandos não documentados, portanto também conecto a interface do sensor diretamente ao arduino de cinco volts, embora a folha de dados diga explicitamente que foi projetada para 3,3 volts. <br><br>  Primeiro de tudo, tentei a boa e velha receita de qualquer enikeyshchik - desligue e ligue novamente.  Ou seja, ele o retirou e o prendeu no sensor, além de poder, com todo o resto funcionando.  O sensor produziu aproximadamente o mesmo que na última passagem citada (mas com números ligeiramente diferentes).  Sim, isso significa que o sensor não morreu completamente e diz algo em cada bota, adivinhou os shtirlits. <br><br>  Depois dei um pouco mais ao meu cérebro e adivinhei antes de uma verdade - os zeros que vimos acima não são a resposta do sensor.  De fato, o sensor está silencioso e meu programa desenha o que a função Arduin de receber n bytes forneceu (para dizer zeros).  E, todas as vezes antes da recepção, para garantir que haja algo a ser feito, acontece que não há nada para aceitar.  Exceto nos casos em que o sensor acabou de reiniciar. <br><br>  Acontece que o sensor parou completamente de aceitar qualquer comando.  Aparentemente, 5 volts na interface serial não foram em vão.  Sim, o artigo não perguntou de alguma forma.  Obrigado a todos pela atenção.  Nós discordamos, não há nada para olhar. <br><br>  Oh espera ... <br><br>  Vê esses números no final? <br><br><pre> <code class="hljs">13 10</code> </pre> <br>  Não se parece com nada? <br><br>  Obviamente, este é um bom e velho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">feed de linha</a> !  Em outras palavras, 0x0D 0x0A - esta é a maneira de traduzir uma string, por exemplo, no Windows (e no Unix, eles facilitam - 0x0A, porque alguns arquivos perdem quebras de linha quando abertos em um notebook do Windows). <br><br>  Então, talvez o sensor queira nos dizer algo na linguagem humana?  No entanto, se esse idioma for chinês, não vai me ajudar muito.  Então, esperamos que essa seja uma linguagem mais compreensível e decodifique a mensagem de acordo com a tabela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ASCII</a> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> reduce(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> a, b: a + b, map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> a: chr(int(a)), <span class="hljs-string"><span class="hljs-string">"255 255 255 250 24 220 207 254 77 79 68 66 85 83 13 10"</span></span>.split()))         MODBUS</code> </pre> <br>  Recebeu até seis letras.  E aqui está o que o mesmo sensor disse ao carregar um pouco mais cedo: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> reduce(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> a, b: a + b, map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> a: chr(int(a)), <span class="hljs-string"><span class="hljs-string">"96 249 2 211 215 212 17 215 204 93 151 80 143 212 255 255 255 217 16 136 252 75 66 50 48 48 13 10 "</span></span>.split())) `        ] P         KB200</code> </pre> <br>  A diferença é óbvia - a linha KB200 mudou para a linha MODBUS.  O resto - parece que não é de todo texto, nem mesmo caracteres chineses - nem que seja porque a maioria deles muda de tempos em tempos. <br><br>  Então, o que o sensor nos diz?  A pedido do KB200, uma pesquisa na Internet produz um teclado, um amostrador de núcleo, um ferro, uma mesa de troca, um controlador de controle de câmera PTZ, um mixer, exceto um careca.  Bem, mas não está claro como aplicar esse conhecimento ao nosso caso.  Bem, vamos procurar o MODBUS.  Desta vez, a própria <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> está ao nosso serviço: <br><br><blockquote>  O Modbus é um protocolo de comunicação aberto baseado na arquitetura mestre-escravo.  É amplamente utilizado na indústria para organizar as comunicações entre dispositivos eletrônicos.  Pode ser usado para transmitir dados através das linhas de comunicação serial RS-485, RS-422, RS-232, bem como uma rede TCP / IP (Modbus TCP). </blockquote><br>  A própria hipótese se sugere - após um dos comandos não documentados, o sensor mudou para o protocolo Modbus e agora nos informa isso usando os métodos disponíveis.  Como não há outras opções previstas, faremos um teste direto dessa hipótese, ou seja, vamos tentar entrar em contato com o sensor via Modbus. <br><br>  Na Internet, foi encontrada uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">implementação</a> Modbus para arduins.  Mas isso é uma má sorte - o Arduino Leonardo não é suportado, mas por acaso monstruoso apenas Leonardo. <br><br>  Mas, como logo percebi, isso é até o melhor.  O protocolo Modbus é tão simples quanto três moedas de um centavo.  E, além de dolorosamente semelhante ao protocolo "nativo" MH-Z19.  Então, por que arrastar coisas desagradáveis ​​da Internet e entendê-las dolorosamente quando você pode implementar tudo o que precisa em dois minutos (bem, duas horas)? <br><br>  Então, antes, nós, querendo descobrir as leituras, pedimos ao sensor que as emitisse da seguinte forma: <br><br><pre> <code class="hljs">0xFF, 0x01, 0x86, 0x00, 0x00, 0x00, 0x00, 0x00, 0x79</code> </pre> <br>  Ou em decimal: <br><br><pre> <code class="hljs">255, 1, 134, 0, 0, 0, 0, 0, 121</code> </pre> <br>  Onde 255 é o número mágico, 1 é o endereço do sensor, 134 é o comando, 121 é o byte da soma de verificação. <br><br>  E como será no Modbus?  Não haverá correspondência exata, mas você pode fazer, por exemplo, o seguinte: <br><br><pre> <code class="hljs">1, 4, 0, 0, 0, 4, 213, 197</code> </pre> <br>  1 - endereço do sensor. <br><br>  4 - número da equipe.  Os comandos no Modbus podem ser contados nos dedos, e até agora estaremos interessados ​​em apenas dois deles - 3 e 4. Por razões ocultas no escuro dos séculos, eles são chamados de Read Multiple Holding Registers e Read Input Registers, mas na verdade eles dão um comando para ler um determinado o número de números de byte duplo em um determinado endereço.  O comando 3 lê os números disponíveis para leitura / gravação e o comando 4 lê apenas. <br><br>  0, 0 é o endereço que vamos ler (neste caso, 0).  Se você definir o mesmo endereço com uma equipe de 3 ou 4, geralmente obteremos resultados diferentes. <br><br>  0, 4 - o número de números que queremos ler (neste caso, 4).  Há um momento engraçado aqui.  Embora você possa especificar esse número até 65535, na verdade, o protocolo permite que você não leia mais de 125 números por vez.  E tudo porque a resposta indica o número de bytes das informações enviadas e são necessários apenas um byte (e os números são de dois bytes).  Além disso, pelo que entendi, o tamanho da resposta em si é limitado a 255 bytes. <br><br>  213, 197 - dois bytes de uma soma de verificação ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CRC16</a> ).  Em geral, este é o momento mais difícil de toda a nossa implementação.  Na verdade, eu nem me aprofundei em como isso é considerado, mas simplesmente copiei o código <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a> .  Como existe um mar de CRC16s diferentes, é preciso abordar com responsabilidade a escolha da função.  Você pode verificar se uma função específica é adequada para o Modbus, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Isso, de fato, é tudo o que precisamos saber sobre o Modbus.  Pelo menos para começar. <br><br>  Embora você adivinhe há muito tempo que meu apelo ao MH-Z19 no Modbus foi um sucesso, mas vamos fingir que a intriga persiste.  Até o momento, nem sabemos qual é o endereço do nosso sensor (embora "no original" seja 1, está longe de ser o mesmo no Modbus).  Portanto, você precisa repetir o comando com endereços diferentes (e existem apenas 255) e ver a que nosso sensor responderá: <br><br><pre> <code class="hljs vbscript">... Command: <span class="hljs-number"><span class="hljs-number">254</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">213</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> CRC: <span class="hljs-number"><span class="hljs-number">213</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Command: <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">212</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> CRC: <span class="hljs-number"><span class="hljs-number">212</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Command: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> CRC: <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Command: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-number"><span class="hljs-number">202</span></span> CRC: <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-number"><span class="hljs-number">202</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Command: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-number"><span class="hljs-number">249</span></span> CRC: <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-number"><span class="hljs-number">249</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">132</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">194</span></span> <span class="hljs-number"><span class="hljs-number">193</span></span> Command: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> CRC: <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Command: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-number"><span class="hljs-number">159</span></span> CRC: <span class="hljs-number"><span class="hljs-number">193</span></span> <span class="hljs-number"><span class="hljs-number">159</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: ...</code> </pre> <br>  Parece que o endereço é 2. Repito vários comandos com o endereço 2 - não há resposta.  Eu mudo o endereço para 1 - há uma resposta!  Assim, o endereço do sensor é o mesmo que era - 1. <br><br>  E por que a passagem 2 obteve o endereço 2?  Aqui, novamente, a Hinduness do meu código se arrasta.  Depois de emitir o comando, verifico se existem bytes a serem recebidos.  Mas como eu faço isso imediatamente, o sensor não tem tempo para enviar nada; portanto, a resposta do sensor é aceita pelo programa apenas no próximo ciclo.  Como você pode ver no log fornecido - o primeiro número na resposta é 1 e apenas indica o endereço do sensor.  Para contornar esse problema, basta adicionar um atraso de 50 milissegundos antes de receber uma resposta. <br><br>  Considere a resposta do sensor ao nosso comando: <br><br><pre> <code class="hljs">1 132 2 194 193</code> </pre> <br>  1 - como já descobrimos - o endereço do sensor. <br><br>  132 - código de comando e código de erro.  Se não houvesse erro, esse número seria o mesmo que o comando enviado - ou seja, 4. Mas como ocorreu um erro, conforme indicado pelo bit mais significativo definido como 1, o número passou a ser 4 + 128 = 132. Portanto, a propósito, um comando no Modbus não pode ter um número maior que 127 - para esse comando, o código de sucesso seria o mesmo que o código de erro. <br><br>  2 - código de erro.  Diz exatamente qual erro ocorreu.  Como a Wikipedia diz, 02 - O endereço de dados especificado na solicitação não está disponível.  Portanto, não há peixe neste endereço e não há nada para capturar.  Vamos tentar outros endereços. <br><br>  194 193 - CRC16. <br><br>  Agora, finalmente, é hora de arranhar o espaço de endereço do sensor para entender onde está o peixe.  Fiz isso com simplicidade - enviei um comando para ler um número com um novo endereço a cada 0,1 segundos.  Como os endereços são 65536, esse processo é concluído em aproximadamente duas horas.  Os resultados são brevemente os seguintes: <br><br>  Comando 1 (Read Coils) - erro 2 em qualquer endereço. <br>  Comando 2 (Ler entradas discretas) - com qualquer erro de endereço 2. <br>  Comando 4 (Read Input Registers) - erro 2 com qualquer endereço. <br>  Equipe 3 (Read Multiple Holding Registers) - obtém sucesso nos endereços de 0 a 289. <br>  Os comandos para escrever valores (por exemplo, 6) parecem funcionar, mas parece que o valor registrado é substituído em breve pelo que era.  Mas não investiguei esse problema de perto. <br><br>  Portanto, o círculo de pesquisa se estreita - precisamos de números no comando 3 e endereços de 0 a 289. A idéia do rico mundo interno do sensor pode ser obtida a partir destas linhas: <br><br><pre> <code class="hljs vbscript">Command: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> CRC: <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">158</span></span> <span class="hljs-number"><span class="hljs-number">124</span></span> Command: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">238</span></span> CRC: <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">238</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> Command: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> CRC: <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">153</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">177</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">196</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">214</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">232</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">250</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">137</span></span> <span class="hljs-number"><span class="hljs-number">122</span></span> Command: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> CRC: <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">232</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">232</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">163</span></span> <span class="hljs-number"><span class="hljs-number">198</span></span></code> </pre> <br>  É verdade que os números foram salvos no arquivo morto apenas no endereço 255. Aqui, novamente, 1 3 é o endereço e o comando, 128 é o número de bytes transferidos, dois bytes no final são CRC e todo o resto é o conteúdo da memória. <br><br>  De todo esse esplendor, estamos obviamente interessados ​​nos endereços cujo conteúdo muda com o tempo.  E aqui o sensor acabou sendo duas novidades para mim - boas e más.  Bom - existem esses endereços.  E os ruins - existem apenas dois deles - 261 e 264. Compare com a "vida passada", quando quatro números foram dados em um comando ao mesmo tempo!  Eu já rolei meu lábio - pensei em ter acesso a todas as variáveis ​​internas.  Bem, dois e dois. <br><br>  Hora de criar gráficos novamente! <br><br>  Valor no endereço 261: <br><img src="https://habrastorage.org/files/e92/388/2e5/e923882e53d54fa382b6a110a0fda313.png"><br>  Parece uma concentração de CO2.  Isso pode ser visto quando tentei respirar no sensor.  É verdade que o valor mínimo fica visivelmente mais baixo que a "referência" 400 ppm, portanto a calibração deixa muito a desejar.  De uma forma ou de outra, o sensor é declarado ressuscitado. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor em 264: </font></font><br><img src="https://habrastorage.org/files/c7f/588/0a0/c7f5880a047c4b5bb3e3767579824987.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">praticamente o mesmo, apenas em uma escala diferente e de cabeça para baixo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ambas as quantidades estão no mesmo gráfico: </font></font><br><img src="https://habrastorage.org/files/281/22a/172/28122a1724d7413ca57b665d6c705a5d.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma questão natural surge - talvez uma dessas quantidades seja o valor "bruto" que vem do ADC e que o sensor converte na estimativa de CO2 usando o método escravo? </font><font style="vertical-align: inherit;">Nesse caso, isso abre grandes oportunidades para recalibrar e melhorar a precisão do sensor, e talvez para usá-lo para outros fins. </font><font style="vertical-align: inherit;">A resposta para esta pergunta (e algumas outras), tentaremos entrar na próxima série. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os comentários e sugestões são aceitos - como zombar do MH-Z19 no próximo artigo. </font><font style="vertical-align: inherit;">É verdade que não prometo nada.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt401363/">https://habr.com/ru/post/pt401363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt401353/index.html">Os cientistas criaram um sensor compacto para o diagnóstico do vírus influenza</a></li>
<li><a href="../pt401355/index.html">E neste momento</a></li>
<li><a href="../pt401357/index.html">CTRL O Robô - da oficina à mesa</a></li>
<li><a href="../pt401359/index.html">Ping de endereços IP como uma ferramenta universal das ciências sociais</a></li>
<li><a href="../pt401361/index.html">Bem-vindo a Alcatraz: uma das maiores instalações de energia distribuída dos EUA</a></li>
<li><a href="../pt401367/index.html">O livro "Programação Arduino. Trabalho profissional com esboços "</a></li>
<li><a href="../pt401369/index.html">Avaliação do smartphone ASUS ZenFone 3 Max</a></li>
<li><a href="../pt401371/index.html">Análise de conjuntos de dados do portal de dados abertos data.gov.ru</a></li>
<li><a href="../pt401375/index.html">Pesquisa: o sono é necessário para ajudar a esquecer</a></li>
<li><a href="../pt401379/index.html">Simulação virtual 3D de navios para a Marinha Russa - estamos no topo da TI?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>