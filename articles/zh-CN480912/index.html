<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤒 ♠️ 👩🏽‍⚖️ 快速行动。 编写TodoMVC。 第一部分 🗿 🧛🏾 👨🏿‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="显然，关于dap的第一篇文章并没有成为我写作的成功：关于它的绝大多数评论都归结为“ niasilil”和“ niasilil，但我谴责”。 唯一具有建设性的顶级评论的奖项是OldVitus ，它以TodoMVC为例来说明演示dap的建议，以便进行比较。 我将在本文中做什么。 

 TodoMVC （...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>快速行动。 编写TodoMVC。 第一部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480912/">显然，关于<a href="https://dap.js.org/" rel="nofollow">dap</a>的第一<a href="https://habr.com/ru/post/478330/">篇文章</a>并没有成为我写作的成功：关于它的绝大多数评论都归结为“ niasilil”和“ niasilil，但我谴责”。 唯一具有建设性的顶级评论的奖项是<a href="https://habr.com/en/users/oldvitus/" class="user_link">OldVitus</a> ，它以<a href="https://habr.com/en/users/oldvitus/" class="user_link">TodoMVC为例</a>来说明演示dap的建议，以便进行比较。 我将在本文中做什么。 <br><br>  <a href="http://todomvc.com/" rel="nofollow">TodoMVC</a> （如果没有人知道的话）就是这样一个标准的UI调用世界，它使您可以使用不同的框架比较相同问题（有条件的“待办事项列表”）的解决方案。 该任务非常简单（其<a href="https://dap.js.org/samples/todo.html" rel="nofollow">在dap上的解决方案</a> “在一个屏幕<a href="https://dap.js.org/samples/todo.html" rel="nofollow">上</a>中断”）非常具有说明性。 因此，在她的示例中，我将尝试展示如何使用dap来实现Web前端的典型任务。 <br><br> 我没有搜索和研究问题的正式描述，而是决定简单地反转其中一个示例。 本文的后端对我们来说并不有趣，因此我们不会自己编写，而是使用网站<a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com上的其中之一</a> ，然后从此处获取<a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">示例客户端</a>和标准<a href="" rel="nofollow">CSS文件</a> 。 <br><br> 要使用dap，您无​​需下载和安装任何程序。 无需<code>npm install</code> ，仅此<code>npm install</code> 。 不需要创建具有特定目录结构，清单和IT成功其他属性的任何项目。 足够的文本编辑器和浏览器。 要调试XHR请求，您可能还需要一个Web服务器-一个简单的服务器，例如Chrome <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb" rel="nofollow">扩展</a>程序。 我们的整个前端将包含一个.html文件（当然，这是指dap引擎脚本和标准TodoMVC CSS文件） <br><br> 因此，从头开始。 <br><a name="habracut"></a><br><h2>  1.创建一个.html文件 </h2><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Todo -- dap sample<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.todobackend.com/client/css/vendor/todomvc-common.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://dap.js.org/0.4.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//   dap </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> 通常的html准备工作，其中包括网站<a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a>友好提供的CSS文件和<a href="https://www.todobackend.com/" rel="nofollow">dap.js.org</a>网站友好提供的dap引擎。 <br><br><h2>  2.复制原始示例的DOM结构 </h2><br> 要使用标准CSS文件而不进行更改，我们将坚持与<a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">原始示例</a>相同的DOM结构。 在Chrome浏览器中将其打开，按Ctr + Shift + I，选择“元素”标签，然后查看应用程序本身是否位于元素<code>section id="todo-app"&gt;</code> <br><br><img src="https://habrastorage.org/webt/3d/ks/mq/3dksmqoxzyif_tgnxfc3v-wf_us.png"><br><br> 通过逐个打开此子树，我们将其结构重写为.html文件。 现在，我们只是以一种快速的方式进行草图绘制，而不是编写代码，因此我们仅在“单引号”及其子代括号中写下元素的签名。 如果没有孩子，我们画空括号。 我们监控指数和方括号的余额。 <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   dap '#todoapp'( '#header'( 'H1'() 'INPUT#new-todo placeholder="What needs to be done?" autofocus'() ) '#main'( '#toggle-all type=checkbox'() 'UL#todo-list'( 'LI'( 'INPUT.toggle type=checkbox'() 'LABEL'() 'BUTTON.destroy'() ) ) ) '#footer'( '#todo-count'() 'UL#filters'( 'LI'() ) '#clear-completed'() ) )</span></span></code> </pre><br> 注意：重复元素（例如，这里是<code>LI</code>元素），即使原始元素中有多个元素，我们也会对其写入一次。 显然，这些是来自同一模式的数组。 <br><br> 我认为，用手写HTML和CSS的任何人都可以理解签名格式，因此，现在我不再详细介绍它。 我只能说标签是用大写字母写的，没有标签就等于有DIV标签。  ＃元素（带有id）的丰富之处是由于所包含的CSS文件的细节所致，它主要使用id选择器。 <br><br><h2>  3.请记住，dap程序是Javascript </h2><br> 为了避免代码中不必要的括号，dap引擎将几种方法直接注入<code>String.prototype</code> （我知道在标准对象中实现您的方法是ayahay，但简而言之，我们已经通过了），它将签名字符串转换为dap模板。 一种这样的方法是<code>.d(rule, ...children)</code> 。 它采用的第一个参数是生成规则（ <i>d-rule</i> ），其余参数是任意数量的子代。 <br><br> 基于此新知识，我们添加代码，以便代替每个左括号，而使用序列<code>.d(""</code> ，并且在每个左引号之前，除了第一个引号之外，还带有逗号。生活技巧：您可以使用自动替换。 <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) )</code> </pre><br> 瞧！ 我们得到了对<code>.d</code>方法的调用树，可以将其转换为dap模板。 空字符串<code>""</code>是将来d规则的种子，而子元素是用逗号分隔的参数。 正式地，这是一个有效的dap程序，尽管还不能完全满足我们的需求。 但是它已经可以启动了！ 为此，请在右方括号后添加<code>.RENDER()</code>方法。 顾名思义，此方法将呈现结果模板。 <br><br> 因此，在此阶段，我们有一个包含以下内容的.html文件： <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Todo -- dap sample&lt;/title&gt; &lt;link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/&gt; &lt;script src="https://dap.js.org/0.4.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; '#todoapp'.d("" ,'#header'.d("" ,'H1'.d("") ,'INPUT#new-todo placeholder="What needs to be done?" autofocus'.d("") ) ,'#main'.d("" ,'#toggle-all type=checkbox'.d("") ,'UL#todo-list'.d("" ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("") ,'LABEL'.d("") ,'BUTTON.destroy'.d("") ) ) ) ,'#footer'.d("" ,'#todo-count'.d("") ,'UL#filters'.d("" ,'LI'.d("") ) ,'#clear-completed'.d("") ) ) .RENDER() //   dap   &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br> 您可以<a href="http://dap.js.org/samples/tutorial/3.html" rel="nofollow">在浏览器中将其打开，</a>以确保生成DOM元素，应用CSS样式，仅将其填充为该模板即可。 <br><br><h2>  4.获取数据 </h2><br> 我们转到<a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">原始页面</a> ，在工具中打开“网络”选项卡，打开XHR过滤器，然后查看数据的来源和格式。 <br><br><img src="https://habrastorage.org/webt/vf/ff/4l/vfff4lreh7nhj6jpgb8re83wb-s.png"><br><br><img src="https://habrastorage.org/webt/qi/lh/ga/qilhganpuhmmtevpnyuytm1uadu.png"><br><br> 好吧好吧 待办事项列表直接取自<a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">todo-backend-express.herokuapp.com</a>作为对象的json数组。 太好了 <br><br> 为了接收数据，dap有一个内置的converter <code>:query</code> ，可将URL异步“转换”为从URL接收的数据。  URL本身，我们不会直接在规则中编写，而用常量<code>todos</code>表示； 那么整个数据挖掘设计将如下所示： <br><br><pre> <code class="javascript hljs">todos:query</code> </pre><br> 并在字典中将<code>todos</code>常量本身写入-在<code>.RENDER()</code>之前的<code>.DICT</code>部分： <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ... ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"https://todo-backend-express.herokuapp.com/"</span></span> }) .RENDER()</code> </pre><br> 收到<code>todos</code>数组后，我们从中构建一个待办事项列表：对于每种情况，我们从<code>.title</code>字段中获取名称，并将其写入<code>LABEL</code>元素，从<code>.completed</code>字段中<code>.completed</code>获取“ completeness”的符号，并写入至<code>checked</code>元素<code>INPUT.toggle</code>的<code>checked</code>属性。 这样做是这样的： <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  *       ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("#.checked=.completed") // #  " " ,'LABEL'.d("! .title") //  !      ,'BUTTON.destroy'.d("") ) )</span></span></code> </pre><br> 我们在浏览器中更新此页面，如果您从文件系统启动它，则什么也不会发生。 问题是现代浏览器不允许本地文档中的跨域XHR请求。 <br><br><img src="https://habrastorage.org/webt/tm/fy/bi/tmfybiqw7s2geblqodepfg7k7lk.png"><br><br> 现在该使用任何本地Web服务器通过http观看我们的页面了。 好吧，或者如果您还没有准备好用自己的双手编写dap，请使用我的链接查看页面的顺序版本（别忘了查看源代码-在Chrome中，这是使用Ctrl + U完成的） <br><br> 因此，我们<a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">转到位于http：//的页面，</a>看到数据即将到来，列表正在构建中。 太好了！ 您已经掌握了<code>*</code>和运算符<code>!</code>  ，converter <code>:query</code> ，常量和访问当前数组元素的字段。 再次查看结果代码。 您仍然觉得它不可读吗？ <br><br><h2>  5.添加状态 </h2><br> 也许您已经尝试单击待办事项列表中的复选标记。 复选框本身会更改颜色，但是与原始复选框不同， <code>LI</code>父元素不会更改其样式（“已完成的工作”应变为灰色并划掉，但这不会发生）-事物不会更改其<i>状态</i> 。 但是这些元素还没有任何状态，因此无法更改它。 现在我们将修复它。 <br><br> 向<code>LI</code>元素添加“完成”状态。 为此，请在其d规则中定义<code>$completed</code> <i>状态变量</i> 。 对于可以更改此状态的<code>INPUT.toggle</code> ，我们将分配一个适当的反应规则（ <i>ui-rule</i> ），该<i>规则</i>将根据其自己的<code>checked</code>标志（“ daw已打开”）来设置<code>$completed</code>变量。 根据<code>$completed</code>状态<code>$completed</code> <code>LI</code>元素将启用或禁用CSS类“已完成”。 <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed"</span></span><span class="hljs-comment"><span class="hljs-comment">//  ,    .completed ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") //       .ui("$completed=#.checked") //    $completed ,'LABEL'.d("! .title") ,'BUTTON.destroy'.d("") ) .a("!? $completed") //     $completed,    css- completed )</span></span></code> </pre><br>  CSS类的这种操作是很常见的事情，因此在dap中有一个特殊的运算符可用于它们！ <br> 请注意，我们在<i>a规则中</i>执行此操作（从单词累计）。 为什么不在D规则中？ 这两种规则之间的区别在于，更新时，d规则会完全重建元素的内容，并再次删除旧的和新的内容，而a规则不会触及元素的现有内容，而是将结果``附加''到现有内容中。 更改<code>LI</code>元素的单个属性不需要重组其其余内容，因此在a规则中执行此操作更为合理。 <br><br> 我们看一下<a href="http://dap.js.org/samples/tutorial/5-1.html" rel="nofollow">结果</a> 。 效果已经更好：点击复选框更改相应待办事项的状态，并根据此状态更改元素的视觉样式。 但是仍然存在一个问题：如果最初存在已完成任务的列表，则它们不会是灰色的，因为默认情况下，在生成元素时不执行a规则。 为了即使在生成过程中也要执行它，我们将运算符<code>a!</code>添加到元素<code>LI</code>的d规则中 <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $completed    a-</span></span></code> </pre><br>  <a href="http://dap.js.org/samples/tutorial/5-2.html" rel="nofollow">我们看</a> 。 好吧 以<code>$completed</code>的状态<code>$completed</code> 。 在初次启动时和随后的手动切换过程中，已完成的案例均会正确设置样式。 <br><br><h2>  6.编辑案例名称 </h2><br> 回到<a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">原来</a> 。 通过双击案例名称，将激活编辑模式，在该模式下可以更改此名称。 在此以完全隐藏“视图”视图模式模板（带有DAW，标题和删除按钮）的方式实现，并显示<code>INPUT class="edit"</code>元素。 我们将做一些不同的操作-我们将只隐藏<code>LABEL</code>元素，因为其他两个元素不会干扰我们的编辑。 只需将<code>view</code>类添加到<code>LABEL</code>元素。 <br><br> 对于“编辑”状态，在<code>LI</code>元素中定义<code>$editing</code>变量。 最初，它（状态）被重置，通过<code>dblclick</code>在<code>LABEL</code>元素上打开，并在<code>INPUT.edit</code>元素失去焦点时关闭。 所以我们写： <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$completed=#.checked") ,'LABEL.view' .d("? $editing:!; ! .title") //  $editing ,     .e("dblclick","$editing=`yes") //  dblclick  $editing ,'INPUT.edit' .d("? $editing; !! .title@value") //  $editing  .ui(".title=#.value") //  .title   change (ui     INPUT) .e("blur","$editing=") //  $editing   blur ,'BUTTON.destroy'.d("") ).a("!? $completed $editing") //   $completed  $editing  css-  'LI'</span></span></code> </pre><br> 现在我们<a href="http://dap.js.org/samples/tutorial/6.html" rel="nofollow">可以</a>编辑案例的名称。 <br><br><h2>  7.将数据发送到服务器 </h2><br> 好的，我们已经可以在浏览器中进行编辑了，但是这些更改也必须转移到服务器上。 我们看一下原始代码是怎么做的： <br><br><img src="https://habrastorage.org/webt/jd/r5/bw/jdr5bwsa8yi7wu4sbwxqr3bwcdi.png"><br><br> 更改将使用具有特定URL的PATCH方法（以<code>http://todo-backend-express.herokuapp.com/28185</code>的形式）发送到服务器，这显然在每种情况下都是唯一的。 服务器在列表中的每种情况的<code>.url</code>字段中指示此URL。 也就是说，我们更新服务器上大小写所需要做的就是将PATCH请求发送到<code>.url</code>字段中指定的地址，更改后的数据以JSON格式发送： <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>)</code> </pre><br> 在这里，我们使用相同的converter <code>:query</code> ，但是版本更详细。 如果将<code>:query</code>应用于简单字符串，则将该字符串视为URL，并执行GET请求。 如果<code>:query</code>收到一个复杂对象，在这种情况下，它将把它当作对请求的详细描述，包含字段<code>.method</code> ， <code>.url</code> ， <code>.headers</code>和<code>.body</code> ，并根据它们执行请求。 在这里，在更新<code>.title</code>立即向服务器发送带有此更新的<code>.title</code>的PATCH请求。 <br><br> 但是有细微差别。 我们从服务器获取<code>.url</code>字段，它看起来像这样： <code>http://todo-backend-express.herokuapp.com/28185</code> : <code>http://todo-backend-express.herokuapp.com/28185</code> ，也就是说，如果我们的客户端也通过http：//打开，则http：//协议是硬编码的那一切都很好 但是，如果客户端通过https：//打开，则会出现问题：出于安全原因，浏览器会阻止来自https来源的http-traffic。 <br><br> 解决方法很简单：如果您从<code>.url</code>删除协议，则请求将通过页面协议。 因此，让我们开始吧：编写适当的转换器<code>dehttp</code> ，然后将<code>.url</code>通过它。  <code>.FUNC</code>部分中<code>.FUNC</code>了自定义转换器（和其他功能）： <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-comment"><span class="hljs-comment">//  -         dehhtp: url=&gt;url.replace(/^https?\:/,'')//    URL } })</span></span></code> </pre><br> 将标头对象放在字典中也可以在其他查​​询中使用： <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title):json.encode@body):query"</span></span>) ... .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} })</code> </pre><br> 好吧，对于完全风水，我们将使用转换器的另一个有用属性<code>:query</code> query-根据<code>Content-type:application/json</code>标头在json中自动编码请求主体。 结果，规则将如下所示： <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title)):query"</span></span>)</code> </pre><br> 所以， <a href="http://dap.js.org/samples/tutorial/7-2.html" rel="nofollow">看</a> 。 好的，案例名称现在不仅在浏览器中更改，而且在服务器上也更改。 但是！ 不仅案件的名称可以更改，而且完成状态也可以更改。 因此，它也需要发送到服务器。 <br> 您可以将相同的PATCH请求添加到<code>INPUT.toggle</code>元素，只需发送<code>(.completed)</code>而不是<code>(.completed)</code> ： <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$completed=#.checked; (@method`PATCH .url:dehttp headers (.completed:?)):query"</span></span>)</code> </pre><br> 您可以将此PATCH请求放在“括号之外”： <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">// $patch - ""   ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=($completed=#.checked)") //   $patch  completed ,'LABEL.view' .d("? $editing:!; ! .title") .e("dblclick","$editing=`yes") ,'INPUT.edit' .d("? $editing; !! .title@value") .ui("$patch=(.title=#.value)") //   $patch  title .e("blur","$editing=") ,'BUTTON.destroy'.d("") ) .a("!? $completed $editing") //  $patch  ,   ,   .u("? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch=")</span></span></code> </pre><br> 就是这个 反应规则属于“上规则”组，从“下至上”执行-从后代到父级，再到根本身（必要时可以中断此顺序）。 这有点像DOM中的弹出事件。 因此，可以将几个后代共有的一些反应片段分配给一个共同的祖先。 <br><br> 具体来说，在我们的案例中，从这种委托中获得的收益并不是特别明显，但是，如果存在更多可编辑的字段，那么将这一庞大的请求（当然是基于dap标准）放在一条通用规则中，将大大有助于保持代码的简单性和可读性。 所以我推荐它。 <br><br>  <a href="http://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">我们来看</a> ：现在，名称更改和状态更改都发送到了服务器。 <br><br> 在下一篇文章中，如果您有兴趣，请考虑添加，删除和过滤案例。 同时，您可以在<a href="https://dap.js.org/docs/" rel="nofollow">dap.js.org/docs上</a>查看<a href="https://dap.js.org/samples/todo.html" rel="nofollow">最终结果</a>和dap代码的其他示例。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN480912/">https://habr.com/ru/post/zh-CN480912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN480900/index.html">带回我的孩子！ （N.F.故事）</a></li>
<li><a href="../zh-CN480902/index.html">新的Postgres_exporter PostgreSQL监视功能</a></li>
<li><a href="../zh-CN480904/index.html">PHP微服务框架：Swoft的开发环境</a></li>
<li><a href="../zh-CN480906/index.html">编写一个简单的python游戏</a></li>
<li><a href="../zh-CN480910/index.html">如何为Selenium测试创建基本测试类并通过JUnit RuleChain进行初始化</a></li>
<li><a href="../zh-CN480914/index.html">面向初学者的微服务</a></li>
<li><a href="../zh-CN480918/index.html">Apache Hadoop代码质量：生产VS测试</a></li>
<li><a href="../zh-CN480920/index.html">使用远程PoE测试TP-Link交换机。 关于旧型号的升级</a></li>
<li><a href="../zh-CN480922/index.html">Evgeny Usvitsky：“世界上每个人都知道在哪里免费获取地理数据-仅在OSM中”</a></li>
<li><a href="../zh-CN480924/index.html">重制MediEvil的创建者如何以及为何重新设计了游戏的狂热老板</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>