<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ½ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ•´ğŸ¾ Java EEå¹¶å‘API ğŸ§–ğŸ¾ ğŸ’ƒ ğŸ‘€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ 

 åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ²‰è¿·äºåŒ…å­ï¼Œå¹¶å¯åŠ¨äº†â€œ Java Enterprise Developerâ€è¯¾ç¨‹çš„ç¬¬äºŒæµã€‚ è¯¥è¯¾ç¨‹çš„æ°¸ä¹…åˆ›å»ºè€…å’Œè€å¸ˆ-Vitaly Ivanovç”šè‡³æ’°å†™äº†æœ‰å…³è¯¥ä¸»é¢˜çš„æ–‡ç« ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™å¯¹æ‚¨ä¼¼ä¹å¾ˆæœ‰ç”¨:) 

 æ‰€ä»¥æˆ‘ä»¬èµ°å§:) 

 æœ¬æ–‡æ¢è®¨äº†JavaEEå¹¶å‘æ€§è§„èŒƒAPIï¼ˆ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java EEå¹¶å‘API</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/421809/">å¤§å®¶å¥½ï¼ <br><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬<s>æ²‰è¿·äºåŒ…å­ï¼Œå¹¶</s>å¯åŠ¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ Java Enterprise Developerâ€</a>è¯¾ç¨‹çš„ç¬¬äºŒæµã€‚ è¯¥è¯¾ç¨‹çš„æ°¸ä¹…åˆ›å»ºè€…å’Œè€å¸ˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Vitaly Ivanov</a>ç”šè‡³æ’°å†™äº†æœ‰å…³è¯¥ä¸»é¢˜çš„æ–‡ç« ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™å¯¹æ‚¨ä¼¼ä¹å¾ˆæœ‰ç”¨:) <br><br> æ‰€ä»¥æˆ‘ä»¬èµ°å§:) <br><br> æœ¬æ–‡æ¢è®¨äº†JavaEEå¹¶å‘æ€§è§„èŒƒAPIï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JSR 236</a> ï¼‰ï¼Œè¯¥APIä½¿ç”¨æ‰˜ç®¡èµ„æºçš„æ¦‚å¿µå®šä¹‰äº†JavaEEå®¹å™¨ä¸­å¹¶è¡Œä»»åŠ¡çš„æ ‡å‡†ã€‚ ç¬¬ä¸ƒç‰ˆJavaEEçš„å‘å¸ƒä½¿åœ¨Enterpriseå®¹å™¨ä¸­è¿è¡Œå¹¶è¡Œä»»åŠ¡æˆä¸ºå¯èƒ½ï¼Œä»è€Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ç”¨äºå¤„ç†å¤šä»»åŠ¡çš„ä¾¿æ·å·¥å…·å’Œå®ç”¨ç¨‹åºã€‚ ç›´åˆ°é‚£ä¸€åˆ»ï¼Œæ‰€æœ‰çš„å¤šä»»åŠ¡å¤„ç†éƒ½ç•™ç»™äº†æ‰€ç”¨åº”ç”¨æœåŠ¡å™¨çš„ç‰¹å®šå®ç°ï¼Œè¯¥æœåŠ¡å™¨ç‹¬ç«‹å†³å®šä»»åŠ¡çš„ä¼˜åŒ–ã€‚ åœ¨æ„å»ºä¼ä¸šåº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„æ—¶ï¼Œè¿åæ­¤åŸåˆ™è¢«è®¤ä¸ºæ˜¯ä¸å¥½çš„åšæ³•ã€‚ ç»“æœï¼Œä¸å»ºè®®å¼€å‘äººå‘˜åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæœ‰æ—¶åœ¨å®¹å™¨çº§åˆ«ç¦æ­¢è¿™ç§è¡Œä¸ºã€‚ <br><br><img src="https://habrastorage.org/webt/k4/qq/by/k4qqbyksdbtsvyaceyok4sx3jgw.png"><a name="habracut"></a><br>  <i>ä¼ä¸šbeanä¸å¾—å°è¯•ç®¡ç†çº¿ç¨‹ã€‚</i>  <i>ä¼ä¸šbeanä¸å¾—å°è¯•å¯åŠ¨ï¼Œåœæ­¢ï¼ŒæŒ‚èµ·æˆ–æ¢å¤çº¿ç¨‹ï¼Œä¹Ÿä¸èƒ½å°è¯•æ›´æ”¹çº¿ç¨‹çš„ä¼˜å…ˆçº§æˆ–åç§°ã€‚</i>  <i>ä¼ä¸šbeanä¸å¾—å°è¯•ç®¡ç†çº¿ç¨‹ç»„ã€‚</i> <br><br>  <i>ï¼ˆä½œè€…çš„å…è´¹ç¿»è¯‘ï¼šEJBä¸åº”å°è¯•ç®¡ç†çº¿ç¨‹ï¼Œå³å°è¯•å¯åŠ¨ï¼Œåœæ­¢ï¼Œæš‚åœå’Œæ¢å¤å…¶æ‰§è¡Œï¼Œæˆ–è€…æ›´æ”¹ä¼˜å…ˆçº§æˆ–æ›´æ”¹çº¿ç¨‹çš„åç§°ã€‚è€Œä¸”ï¼ŒEJBä¸åº”å°è¯•ç®¡ç†çº¿ç¨‹ç»„ï¼‰ã€‚</i> <br><br> å®é™…ä¸Šï¼Œç¦æ­¢åœ¨JavaEEå®¹å™¨ä¸­åˆ›å»ºè‡ªå·±çš„çº¿ç¨‹æ˜¯å¾ˆæˆé—®é¢˜çš„ï¼Œä½†æ˜¯ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå®¹å™¨çš„åå°æœåŠ¡æ— æ³•ä¿è¯å…¶å·¥ä½œçš„æ­£ç¡®æ€§ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨JavaSEçš„çº¿ç¨‹ç»§æ‰¿è€…ï¼ˆæˆ–Runnableå®ç°ï¼‰åœ¨æ–°çº¿ç¨‹ä¸­å¯åŠ¨ä»»åŠ¡ï¼Œåˆ™åœ¨EJBæ–¹æ³•å®Œæˆæ—¶å…³é—­äº‹åŠ¡å¯èƒ½ä¼šæ— æ³•æ­£å¸¸å·¥ä½œã€‚ åŒæ ·ï¼Œä½¿ç”¨é€šè¿‡Executorsç±»çš„é™æ€æ–¹æ³•åˆ›å»ºçš„Executor APIæä¾›çš„åŸºæœ¬æ¥å£ç±»å‹ï¼ˆä¾‹å¦‚ExecutorServiceå’ŒScheduledExecutorServiceï¼‰ä¼šå¯¼è‡´æ½œåœ¨çš„é”™è¯¯å¹¶ä¸­æ–­å®¹å™¨æœåŠ¡çš„æ‰§è¡Œã€‚ <br><br> åœ¨JavaEEè§„èŒƒæ¨èçš„ç”¨äºå¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„å·¥å…·ä¸­ï¼Œå¼€å‘äººå‘˜å¿…é¡»ä½¿ç”¨å¼‚æ­¥çš„Stateless / Statefull EJBå’Œ/æˆ–Message Driven Beanï¼Œå®ƒä»¬çš„åŠŸèƒ½è¶³ä»¥æ»¡è¶³ä¸€å®šèŒƒå›´çš„ä»»åŠ¡ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå…¶ç®¡ç†æœ€åˆå®Œå…¨ç”±åº”ç”¨ç¨‹åºæœåŠ¡å™¨å®Œå…¨æ§åˆ¶ï¼Œå³EJBå®¹å™¨ã€‚ <br><br> ä½†æ˜¯ï¼Œå¦‚å‰æ‰€è¿°ï¼Œç”±äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JSR 236</a> ï¼Œå®¹å™¨ç®¡ç†çš„èµ„æºå‡ºç°äº†ï¼Œè¯¥èµ„æºå®ç°äº†å¯¹å¤šçº¿ç¨‹å’Œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„æ”¯æŒï¼Œä»è€Œæ‰©å±•äº†JavaSE <code>java.util.concurrent</code>åŒ…çš„åŠŸèƒ½ã€‚ å¯¹äºJavaEEå †æ ˆï¼Œæ‰˜ç®¡èµ„æºç±»ä½äº<code>javax.enterprise.concurrent</code>åŒ…ä¸­ï¼Œå¹¶é€šè¿‡ä½¿ç”¨<code>@Resource</code>æ‰¹æ³¨çš„èµ„æºæ³¨å…¥æˆ–é€šè¿‡JNDIä¸Šä¸‹æ–‡ï¼ˆå°¤å…¶æ˜¯InitialContextï¼‰æ¥æä¾›å¯¹è¿™äº›ç±»çš„å¯¹è±¡çš„è®¿é—®ã€‚ åŒæ—¶ï¼Œæ·»åŠ äº†ä½¿ç”¨JavaEEåº”ç”¨ç¨‹åºå†…éƒ¨å¤šçº¿ç¨‹ç¯å¢ƒæ‰€ç†Ÿæ‚‰çš„Future / ScheduledFuture / CompletableFutureå¯¹è±¡çš„å¯èƒ½æ€§ã€‚ <br><br> å› æ­¤ï¼Œæœ‰è¶³å¤Ÿçš„æ­Œè¯ï¼Œè®©æˆ‘ä»¬ä»å®é™…çš„è§’åº¦ï¼ˆå³åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ï¼‰ä»¥åŠä»ä»¥Glassfish 5åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸ºä¾‹çš„èµ„æºé…ç½®çš„è§’åº¦ï¼Œä»”ç»†æŸ¥çœ‹è§„èŒƒæä¾›çš„æ¯ä¸ªæ‰˜ç®¡èµ„æºã€‚ <br><br> å—¯ï¼ŒManagedExecutorServiceç±»æ˜¯ç¬¬ä¸€ä¸ªè¦è€ƒè™‘çš„ç±»ï¼Œï¼ˆä»åç§°ä¸­å·²ç»äº†è§£ï¼‰è¯¥ç±»æ‰©å±•äº†ç†Ÿæ‚‰çš„JavaSEçš„åŠŸèƒ½ï¼Œå³å¼€ç®±å³ç”¨çš„ExecutorServiceï¼Œå¹¶è®¾è®¡ç”¨äºJavaEEç¯å¢ƒä¸­çš„å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚ <br><br> è¦ä¸ä»…åœ¨Glassfishåº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­é…ç½®è¿™ç§ç±»å‹çš„ExecutorServiceï¼Œè¿˜åº”è¯¥å¼•ç”¨domain.xmlé…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„ä½ç½®ç”±$ {GLASSFISH_HOME} / domains / &lt;domainname&gt; / configç›®å½•ç¡®å®šã€‚ è¯¥æ–‡ä»¶çš„ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs">&lt;domain application-root=<span class="hljs-string"><span class="hljs-string">"${com.sun.aas.instanceRoot}/applications"</span></span> version=<span class="hljs-string"><span class="hljs-string">"25"</span></span> log-root=<span class="hljs-string"><span class="hljs-string">"${com.sun.aas.instanceRoot}/logs"</span></span>&gt; &lt;resources&gt; &lt;context-service object-type=<span class="hljs-string"><span class="hljs-string">"system-all"</span></span> jndi-name=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultContextService"</span></span> /&gt; &lt;managed-executor-service object-type=<span class="hljs-string"><span class="hljs-string">"system-all"</span></span> jndi-name=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultManagedExecutorService"</span></span> /&gt; &lt;managed-scheduled-executor-service object-type=<span class="hljs-string"><span class="hljs-string">"system-all"</span></span> jndi-name=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultManagedScheduledExecutorService"</span></span> /&gt; &lt;managed-thread-factory object-type=<span class="hljs-string"><span class="hljs-string">"system-all"</span></span> jndi-name=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultManagedThreadFactory"</span></span> /&gt; &lt;/resources&gt; &lt;servers&gt; &lt;server config-ref=<span class="hljs-string"><span class="hljs-string">"server-config"</span></span> name=<span class="hljs-string"><span class="hljs-string">"server"</span></span>&gt; &lt;resource-ref ref=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultContextService"</span></span> /&gt; &lt;resource-ref ref=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultManagedExecutorService"</span></span> /&gt; &lt;resource-ref ref=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultManagedScheduledExecutorService"</span></span> /&gt; &lt;resource-ref ref=<span class="hljs-string"><span class="hljs-string">"concurrent/__defaultManagedThreadFactory"</span></span> /&gt; &lt;/server&gt; &lt;/servers&gt; &lt;/domain&gt;</code> </pre> <br> è¿›å…¥Glassfish 5ç®¡ç†é¢æ¿çš„ç•Œé¢ï¼Œè¿›è¡Œé…ç½® <br><br>  ManagedExecutorServiceå¦‚ä¸‹ï¼š <br><br><img src="https://habrastorage.org/webt/ov/ik/wt/ovikwtidsmbgljlxmelboniomzy.png"><br><br> æœ¬èŠ‚å…è®¸åˆ›å»ºç›¸åŒç±»å‹çš„æ–°èµ„æºï¼Œç°æœ‰èµ„æºçš„ç®¡ç†ï¼Œåˆ é™¤ä»¥åŠé”å®šå’Œè§£é”ã€‚ <br><br> å¯¹äºGlassfishä¸­çš„æ§åˆ¶å°ç®¡ç†è¿·æ¥è¯´ï¼Œå±•ç¤ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„asadminå®ç”¨ç¨‹åºï¼Œåœ¨å…¶ä¸­ä½¿ç”¨<code>create-managed-executor-service</code>å‘½ä»¤ï¼Œå¯ä»¥åˆ›å»ºæ–°çš„ManagedExecutorServiceèµ„æºï¼š <br><br><img src="https://habrastorage.org/webt/en/cp/nx/encpnxc2gn7fobfzuyhsgnw8jba.png"><br><br> åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ï¼Œä½¿ç”¨èµ„æºæ³¨å…¥æ¥è·å–å¯¹ManagedExecutorServiceåˆ›å»ºçš„å¯¹è±¡çš„å¼•ç”¨æ›´ä¸ºæ–¹ä¾¿ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨JNDIå·¥å…·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Resource</span></span>(lookup = <span class="hljs-string"><span class="hljs-string">"concurrent/OtusExecutorService"</span></span>) ManagedExecutorService executor; InitialContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InitialContext(); ManagedExecutorService managedExecutorServiceWithContext = (ManagedExecutorService) context.lookup( <span class="hljs-string"><span class="hljs-string">"concurrent/OtusExecutorService"</span></span>);</code> </pre><br> æˆ‘æƒ³å¼•èµ·è¯»è€…çš„æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº<code>@Resource</code>æ‰¹æ³¨ï¼Œlookupå‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”å¦‚æœå¼€å‘äººå‘˜æœªåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­å®šä¹‰å®ƒï¼Œåˆ™å®¹å™¨å°†åœ¨å…¶<code>__default</code>ä¸­æ³¨å…¥<code>__default</code>å‰ç¼€çš„é»˜è®¤èµ„æºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œä»£ç å˜å¾—æ›´åŠ ç®€æ´ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> ManagedExecutorService executor;</code> </pre> <br> åœ¨ä½¿ç”¨<code>execute()</code>å’Œ<code>submit()</code>æ–¹æ³•æ¥æ”¶åˆ°å¯¹æ­¤å¯¹è±¡çš„å¼•ç”¨ä¹‹åï¼Œæ‚¨å¯ä»¥è¿è¡Œåœ¨å®¹å™¨å†…å®ç°Runnableæˆ–Callableæ¥å£çš„ä»»åŠ¡ã€‚ <br><br> ä»¥ä¸€ä¸ªç¤ºä¾‹ä¸ºä¾‹ï¼Œæˆ‘æƒ³æŒ‡å‡ºï¼Œåœ¨æ‰€æœ‰å¯èƒ½çš„æƒ…å†µä¸­ï¼Œæœ€æœ‰è¶£çš„æ˜¯åœ¨åˆ†å¸ƒå¼JavaEEç¯å¢ƒä¸­æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœ¨è¯¥ä»»åŠ¡ä¸­ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æä¾›äº‹åŠ¡æ”¯æŒå¾ˆé‡è¦ã€‚ å¦‚æ‚¨æ‰€çŸ¥ï¼ŒJavaEEå·²ç»å¼€å‘äº†JTAï¼ˆJava Transaction APIï¼‰è§„èŒƒï¼Œè¯¥è§„èŒƒå…è®¸æ‚¨é€šè¿‡ä»¥<code>begin()</code>æ–¹æ³•æ˜¾å¼å¯åŠ¨å®ƒå¹¶ä»¥<code>commit()</code>æ–¹æ³•ï¼Œæäº¤æ›´æ”¹æˆ–<code>rollback()</code>ä½œä¸ºæ˜¾å¼å¼€å§‹æ¥ç¡®å®šäº‹åŠ¡çš„è¾¹ç•Œï¼Œä»è€Œå›æ»šå·²æ‰§è¡Œçš„åŠ¨ä½œã€‚ <br><br> è€ƒè™‘ä¸€ä¸ªç¤ºä¾‹ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ä»ç”¨æˆ·äº‹åŠ¡ä¸­çš„ç´¢å¼•æŒ‰ç™¾é¡¹åˆ—è¡¨è¿”å›ä¸€æ¡æ¶ˆæ¯ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TransactionSupportCallableTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Callable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> messageIndex; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TransactionSupportCallableTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> messageId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. messageIndex = messageId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ UserTransaction tx = lookupUserTransaction(); String message = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { tx.begin(); message = getMessage(messageIndex); tx.commit(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { tx.rollback(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e1) { e1.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> message; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ â€¦ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> UserTransaction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookupUserTransaction</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ â€¦ } }</code> </pre> <br>  Servletçš„ä»£ç ï¼Œè¯¥ä»£ç åœ¨éšæœºé€‰æ‹©çš„ç´¢å¼•å¤„æ˜¾ç¤ºåˆ—è¡¨ä¸­çš„æ¶ˆæ¯ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@WebServlet</span></span>(<span class="hljs-string"><span class="hljs-string">"/task"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManagedExecutorServiceServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpServlet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Resource</span></span>(lookup = <span class="hljs-string"><span class="hljs-string">"concurrent/OtusExecutorService"</span></span>) ManagedExecutorService executor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ServletException, IOException </span></span>{ Future&lt;String&gt; futureResult = executor.submit(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionSupportCallableTask(Random.nextInt(<span class="hljs-number"><span class="hljs-number">100</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!futureResult.isDone()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Thread.sleep(<span class="hljs-number"><span class="hljs-number">50</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { response.getWriter().write(<span class="hljs-string"><span class="hljs-string">"Callable task has received message with following content '"</span></span> + futureResult.get() + <span class="hljs-string"><span class="hljs-string">"'"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception e) { e.printStackTrace(); } } }</code> </pre> <br> æ¥ä¸‹æ¥è¦è€ƒè™‘çš„æ˜¯ManagedScheduledExecutorServiceèµ„æºï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯è®¡åˆ’ä»¥å›ºå®šé—´éš”é‡å¤æ‰§è¡Œæˆ–éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚ <br><br><img src="https://habrastorage.org/webt/6t/85/k3/6t85k3th4xfxgvefxm9tahhxjus.png"><br><br> ä»é€šè¿‡GlassFishç®¡ç†æ§åˆ¶å°é…ç½®æ­¤èµ„æºçš„è§’åº¦æ¥çœ‹ï¼Œä¸ä»¥å‰çš„ç±»å‹ç›¸æ¯”ï¼Œæ²¡æœ‰å‘ç°ç‰¹åˆ«çš„æ›´æ”¹ï¼š <br><br><img src="https://habrastorage.org/webt/ks/jq/g6/ksjqg6dvumoskfqcclnkm2x6_lc.png"><br><br> ä¸ºäº†å¿«é€Ÿåˆ›å»ºManagedScheduledExecutorServiceç±»å‹çš„èµ„æºï¼Œ <code>asadmin</code>ä½¿ç”¨<code>create-managed-scheduled-executor-service</code>å‘½ä»¤ <br><br><img src="https://habrastorage.org/webt/bd/zh/22/bdzh22mgi708cpcwtchliflffh4.png"><br><br> åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨èµ„æºæ³¨å…¥ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Resource</span></span>(lookup = <span class="hljs-string"><span class="hljs-string">"concurrent/OtusScheduledExecutorService"</span></span>) ManagedScheduledExecutorService scheduledExecutor;</code> </pre> <br> ç”¨äºæ‰§è¡Œæ­¤ç±»ExecutorServiceçš„ä»»åŠ¡çš„ä¸»è¦æ–¹æ³•æ˜¯ï¼š <code>schedule()</code> ï¼ˆç”¨äºæ¥æ”¶è¾“å…¥ä¸ºRunnableæˆ–Callableç±»å‹çš„ä»»åŠ¡<code>scheduleAtFixedRate()</code>å’Œ<code>scheduleAtFixedRate()</code> ï¼ˆç”¨äºç¡®å®šä»»åŠ¡çš„åˆå§‹å»¶è¿Ÿï¼Œå¹¶åœ¨TimeUnitä¸­è®¾ç½®é‡å¤é—´éš”ï¼ˆç§’ï¼Œåˆ†é’Ÿç­‰ï¼‰ã€‚ ï¼‰ã€‚ <br><br> å‰é¢çš„æƒ…å†µå¯ä»¥é‡å†™å¦‚ä¸‹ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@WebServlet</span></span>(<span class="hljs-string"><span class="hljs-string">"/scheduledTask"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManagedScheduledExecutorServiceServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpServlet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Resource</span></span>(lookup = <span class="hljs-string"><span class="hljs-string">"concurrent/OtusScheduledExecutorService"</span></span>) ManagedScheduledExecutorService scheduledExecutor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ServletException, IOException </span></span>{ ScheduledFuture&lt;String&gt; futureResult = scheduledExecutor.schedule( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionSupportCallableTask(Random.nextInt(<span class="hljs-number"><span class="hljs-number">100</span></span>)), <span class="hljs-number"><span class="hljs-number">5</span></span>, TimeUnit.SECONDS); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!futureResult.isDone()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Thread.sleep(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Wait } catch (InterruptedException e) { e.printStackTrace(); } } try { response.getWriter().write("Callable task received message with following content '" + futureResult.get() + "'"); } catch ( Exception e) { e.printStackTrace(); } } }</span></span></code> </pre> <br> æ­¤å¤–ï¼Œä¼ä¸šç‰ˆçš„å¹¶å‘APIç¯å¢ƒè¿˜æä¾›äº†åˆ›å»ºå—æ§æµçš„åŠŸèƒ½ã€‚ å¯¹äºè¿™äº›ä»»åŠ¡ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨æ‰˜ç®¡çº¿ç¨‹å·¥å‚çš„åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½é€šè¿‡åŒåçš„ManagedThreadFactoryç±»å®ç°å…¶åŠŸèƒ½ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥é€šè¿‡JNDIæœåŠ¡è¿›è¡Œè®¿é—®ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> ManagedThreadFactory factory;</code> </pre> <br>  Glassfishæ§åˆ¶å°çš„ç®¡ç†çª—å£çœ‹èµ·æ¥â€œè¿‡æ—¶â€ï¼š <br><br><img src="https://habrastorage.org/webt/c5/7n/dr/c57ndr_iu3zewecd6f_zte8vjsi.png"><br><br> ä½¿ç”¨æ‰˜ç®¡çº¿ç¨‹å·¥å‚ï¼Œä¸ä»…å¯ä»¥ä¸ºå®¹å™¨æä¾›æµæ§åˆ¶æœºåˆ¶ï¼Œè¿˜å¯ä»¥åˆå§‹åŒ–ç”Ÿæˆçš„çº¿ç¨‹çš„å±æ€§ï¼šè®¾ç½®åç§°å’Œä¼˜å…ˆçº§ï¼Œè¿™åœ¨å°†æ¥å¯ä»¥é€šè¿‡è½»æ¾æ£€æµ‹å…ˆå‰å‘½åçš„çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ¥æå¤§åœ°ç®€åŒ–è§£æçº¿ç¨‹è½¬å‚¨æ—¶å¯¹é—®é¢˜çš„æœç´¢ã€‚ <br><br> åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æµçš„ç±»ï¼Œè¯¥æµæ˜¾ç¤ºäº†ä¸è¯¥ä»»åŠ¡ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„æœ‹å‹çš„ä¿¡æ¯ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleThreadTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String friend; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimpleThreadTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String friend)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.friend = friend; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + friend); } }</code> </pre> <br> è®©servletå¯åŠ¨çº¿ç¨‹å¹¶å°†å…¶æŠ¥å‘Šç»™è¾“å‡ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@WebServlet</span></span>(<span class="hljs-string"><span class="hljs-string">"/thread"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManagedThreadFactoryServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpServlet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> ManagedThreadFactory factory; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ServletException, IOException </span></span>{ Thread thread = factory.newThread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleThreadTask(<span class="hljs-string"><span class="hljs-string">"Otus"</span></span>)); thread.setName(<span class="hljs-string"><span class="hljs-string">"ManagedThreadFromPool"</span></span>); thread.setPriority(<span class="hljs-number"><span class="hljs-number">7</span></span>); thread.start(); response.getWriter().write(<span class="hljs-string"><span class="hljs-string">"Custom thread has been running."</span></span>); } }</code> </pre><br> è½¬å‘JavaEEåœ¨å¤šçº¿ç¨‹é¢†åŸŸçš„æœ€ç»ˆåŠŸèƒ½-ä¸Šä¸‹æ–‡æœåŠ¡ï¼Œåº”æ³¨æ„ï¼Œè¿™äº›æœåŠ¡åˆ›å»ºäº†åŠ¨æ€ä¸Šä¸‹æ–‡ä»£ç†å¯¹è±¡ã€‚ æˆ‘ä»¬éƒ½ç†Ÿæ‚‰JavaSEä¸­çš„åŠ¨æ€ä»£ç†çš„åŠŸèƒ½ï¼ˆ <code>java.lang.reflect.Proxy</code> ï¼‰ï¼Œå®ƒä½¿æ‚¨èƒ½å¤Ÿç”Ÿæˆæ‰€éœ€æ¥å£çš„åŠ¨æ€å®ç°ï¼Œå…¶åŠŸèƒ½è¢«æ´»è·ƒåœ°ç”¨äºåˆ›å»ºæ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡ç®¡ç†ï¼Œå¹¶ç”¨äºå„ç§AOPæ‹¦æˆªå™¨ç­‰ã€‚ æ­¤å¤–ï¼Œå¯¹äºé€šè¿‡JavaEEä¸Šä¸‹æ–‡æœåŠ¡åˆ›å»ºçš„ä»£ç†ï¼Œå‡å®šå®ƒä»¬å¯ä»¥åœ¨å…¬å…±JNDIä¸Šä¸‹æ–‡ï¼Œå®‰å…¨æ€§ä¸Šä¸‹æ–‡å’Œå®¹å™¨ç±»çš„æ¡†æ¶å†…å·¥ä½œã€‚ <br><br> è¦è¿æ¥æœåŠ¡ï¼Œåªéœ€ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> ContextService service;</code> </pre> <br> ä»ç®¡ç†å’Œé…ç½®æ­¤èµ„æºçš„è§’åº¦æ¥çœ‹ï¼Œä¸€åˆ‡éƒ½éå¸¸ç†Ÿæ‚‰å¹¶ä¸”ç±»ä¼¼äºå·²ç»è€ƒè™‘çš„ç±»å‹ï¼š <br><br><img src="https://habrastorage.org/webt/ql/n6/vw/qln6vwb5bbsk_e3sxner_vwjzsc.png"><br><br> ä»¥ä¸‹æ˜¯åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­å¯åŠ¨ä»£ç†ä»»åŠ¡çš„çº¿ç¨‹çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleProxyTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  Subject subject = Subject.getSubject(AccessController.getContext()); logInfo(subject.getPrincipals()); //    calculateSmth(); } private void calculateSmth() { â€¦ } private void logInfo(Set&lt;Principal&gt; subject) { â€¦ } }</span></span></code> </pre> <br> ç”¨äºåˆ›å»ºä¸Šä¸‹æ–‡ä»£ç†çš„æ— çŠ¶æ€EJB beanï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Stateless</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextServiceBean</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> ContextService service; <span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> ManagedExecutorService executor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Runnable task)</span></span></span><span class="hljs-function"> </span></span>{ Runnable proxy = service.createContextualProxy(task, Runnable.class); executor.submit(proxy); } }</code> </pre> <br> æœ€åï¼Œæ˜¯æ‰§è¡Œä»»åŠ¡çš„servletçš„ä»£ç ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@WebServlet</span></span>(<span class="hljs-string"><span class="hljs-string">"/context"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextServiceServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpServlet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> ContextServiceBean contextServiceBean; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ServletException, IOException </span></span>{ contextServiceBean.perform(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleProxyTask()); } }</code> </pre> <br> è¿™å®é™…ä¸Šç»ˆæ­¢äº†JavaEEå¼€å‘äººå‘˜åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å·¥ä½œçš„èƒ½åŠ›ã€‚ å¤šäºäº†ä»–ä»¬ï¼Œå®¹å™¨ä¸­å‘ç”Ÿçš„æ‰€æœ‰è¿›ç¨‹å’ŒæœåŠ¡éƒ½å°†åœ¨æœåŠ¡å™¨çš„ä¸¥æ ¼æ§åˆ¶ä¸‹ï¼Œä»¥åè°ƒå…¶å·¥ä½œå¹¶ä¸”ä¸è¿åé€šå¸¸çš„æ‰§è¡Œé¡ºåºã€‚ ä¸ºäº†è¾¾åˆ°ä¼ä¸šå¼€å‘äººå‘˜çš„ç›®æ ‡ï¼Œè¿™äº›åŠŸèƒ½é€šå¸¸å°±è¶³å¤Ÿäº†ï¼Œåœ¨ç¬¬å…«ç‰ˆä¸­ï¼Œæ­¤APIå¹¶æœªæ›´æ”¹ã€‚ <br><br> ç»“æŸ <br><br> ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬æ­£åœ¨ç­‰å¾…é—®é¢˜å’Œè¯„è®ºï¼Œä¸€å®šè¦æŸ¥çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Vitaly</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„å…¬å¼€è¯¾ç¨‹</a> ï¼Œåœ¨é‚£é‡Œä»–è¿˜å¯ä»¥æå‡ºé—®é¢˜å¹¶æ”¶å¬/å‚ä¸â€œ CDI in action @ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN421809/">https://habr.com/ru/post/zh-CN421809/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN421797/index.html">ä¸ºä»€ä¹ˆéœ€è¦Splunkï¼Ÿ ç›‘æ§ITåŸºç¡€æ¶æ„</a></li>
<li><a href="../zh-CN421801/index.html">BetterSlackæ‰©å±•ä½œè€…åº”Slackå¾‹å¸ˆçš„è¦æ±‚å°†å…¶æ’¤å›</a></li>
<li><a href="../zh-CN421803/index.html">UPSå’Œç”µæ± ï¼šæ”¾åœ¨å“ªé‡Œï¼Ÿ æ˜¯çš„ç­‰ä½ </a></li>
<li><a href="../zh-CN421805/index.html">æ²‰æµ¸åœ¨ä»¥å¤ªåŠçš„å¼€å‘ä¸­ã€‚ ç¬¬0éƒ¨åˆ†ï¼šæ— éœ€åŒºå—é“¾</a></li>
<li><a href="../zh-CN421807/index.html">å‚åŠ Positive Technologiesç½‘ç«™æ¼æ´æœç´¢æœåŠ¡çš„å…¬å¼€æµ‹è¯•</a></li>
<li><a href="../zh-CN421811/index.html">IETFæå‡ºäº†ä¸€ç§æ–°çš„æ¶ˆæ¯ä¼ é€’æ ‡å‡†-æ‚¨éœ€è¦äº†è§£çš„å†…å®¹</a></li>
<li><a href="../zh-CN421817/index.html">ä½¿ç”¨åŸºæœ¬å·¥å…·åœ¨React.jsä¸­ä½¿ç”¨è¡¨å•</a></li>
<li><a href="../zh-CN421819/index.html">ELK Stackç”¨äºå­˜å‚¨Djangoåº”ç”¨ç¨‹åºæ—¥å¿—</a></li>
<li><a href="../zh-CN421821/index.html">æˆ‘ä»¬åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨Voronoiçš„é©¬èµ›å…‹ï¼Œåƒç´ åŒ–å’Œå‡ ä½•è’™ç‰ˆæ¥è£…é¥°ç½‘ç«™</a></li>
<li><a href="../zh-CN421823/index.html">æˆ‘ä»¬å¦‚ä½•å¼•å…¥X-Ray x64</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>