<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèΩ ü§õüèº üëë Gesti√≥n eficiente de transacciones en primavera üàØÔ∏è üï∫üèæ üë∏üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buen dia a todos! 

 Bueno, el final del mes siempre es intenso, y solo queda un d√≠a hasta el comienzo de la segunda secuencia del curso "Developer on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gesti√≥n eficiente de transacciones en primavera</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/431508/">  Buen dia a todos! <br><br>  Bueno, el final del mes siempre es intenso, y solo queda un d√≠a hasta el comienzo de la segunda secuencia del curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Developer on Spring Framework"</a> , un curso maravilloso e interesante ense√±ado por el igualmente bello y enojado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Yuri</a> (como algunos estudiantes lo llaman por el nivel de requisitos en DZ), veamos otro material que hemos preparado para usted. <br><br>  Vamos <br><br>  <b>Introduccion</b> <br><br>  La mayor√≠a de las veces, los desarrolladores no otorgan importancia a la gesti√≥n de transacciones.  Como resultado, o bien la mayor parte del c√≥digo tiene que ser reescrito m√°s tarde, o el desarrollador implementa la gesti√≥n de transacciones sin saber c√≥mo deber√≠a funcionar realmente o qu√© aspectos deber√≠an usarse espec√≠ficamente en su caso. <br><br>  Un aspecto importante en la gesti√≥n de transacciones es determinar los l√≠mites correctos de una transacci√≥n, cu√°ndo debe comenzar una transacci√≥n y cu√°ndo finalizar, cu√°ndo se deben agregar datos a la base de datos y cu√°ndo se deben bombear (en caso de una excepci√≥n). <br><br><img src="https://habrastorage.org/webt/qg/8n/mw/qg8nmwe4wvoqd2iuw3xv3ldpse0.png"><a name="habracut"></a><br><br>  El aspecto m√°s importante para los desarrolladores es comprender c√≥mo implementar mejor la gesti√≥n de transacciones en una aplicaci√≥n.  As√≠ que echemos un vistazo a las diversas opciones. <br><br>  <b>M√©todos de gesti√≥n de transacciones</b> <br><br>  Las transacciones se pueden administrar de las siguientes maneras: <br><br>  <i><b>1. Control del programa escribiendo c√≥digo personalizado</b></i> <br><br>  Este es un antiguo m√©todo de gesti√≥n de transacciones. <br><br><pre><code class="java hljs">EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="hljs-string"><span class="hljs-string">"PERSISTENCE_UNIT_NAME"</span></span>); EntityManager entityManager = entityManagerFactory.createEntityManager(); Transaction transaction = entityManager.getTransaction() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { transaction.begin(); someBusinessCode(); transaction.commit(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception ex) { transaction.rollback(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ex; }</code> </pre> <br>  <b>Pros</b> : <br><br><ul><li>  Los l√≠mites de transacci√≥n son obvios en el c√≥digo. </li></ul><br>  <b>Contras</b> : <br><br><ul><li>  Es repetitivo y propenso a errores. </li><li>  Cualquier error puede tener un gran impacto. </li><li>  Necesita escribir muchas plantillas, tambi√©n, si desea llamar a otro m√©todo desde este m√©todo, debe controlarlo nuevamente desde el c√≥digo. </li></ul><br>  <i><b>2. Usando Spring para la gesti√≥n transaccional</b></i> <br><br>  Spring admite dos tipos de gesti√≥n de transacciones <br><br>  <b>1. Gesti√≥n de transacciones de software</b> : debe gestionar las transacciones a trav√©s de la programaci√≥n.  Este m√©todo es lo suficientemente flexible, pero dif√≠cil de mantener. <br><br>  <b>2. Gesti√≥n de transacciones declarativas</b> : separa la gesti√≥n de transacciones de la l√≥gica empresarial.  Solo utiliza anotaciones en la configuraci√≥n basada en XML para la gesti√≥n de transacciones. <br><br>  <u><b>Recomendamos encarecidamente el uso de transacciones declarativas.</b></u>  <u><b>Si desea conocer los motivos, siga leyendo, de lo contrario, vaya directamente a la secci√≥n Gesti√≥n de transacciones declarativas si desea implementar esta opci√≥n.</b></u> <br><br>  Ahora veamos cada enfoque en detalle. <br><br>  <i><b>2.1.</b></i>  <i><b>Gesti√≥n program√°tica de transacciones:</b></i> <br><br>  Spring Framework proporciona dos herramientas para la gesti√≥n program√°tica de transacciones. <br><br>  a.  Usando <code>TransactionTemplate</code> (recomendado por el equipo de Spring): <br><br>  Veamos c√≥mo implementar este tipo usando el c√≥digo de ejemplo a continuaci√≥n (tomado de la documentaci√≥n de Spring con algunos cambios) <br><br>  <u>Tenga en cuenta que los fragmentos de c√≥digo se toman de Spring Docs.</u> <br><br>  Archivo XML de contexto: <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- Initialization for data source --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"driverClassName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jdbc:mysql://localhost:3306/TEST"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Initialization for TransactionManager --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Definition for ServiceImpl bean --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"serviceImpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.service.ServiceImpl"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Clase de <code>Service</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransactionTemplate transactionTemplate; <span class="hljs-comment"><span class="hljs-comment">//       PlatformTransactionManager public ServiceImpl(PlatformTransactionManager transactionManager) { this.transactionTemplate = new TransactionTemplate(transactionManager); } //       ,   ,    //       xml  this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED); this.transactionTemplate.setTimeout(30); //30  ///    public Object someServiceMethod() { return transactionTemplate.execute(new TransactionCallback() { //         public Object doInTransaction(TransactionStatus status) { updateOperation1(); return resultOfUpdateOperation2(); } }); }}</span></span></code> </pre><br>  Si no hay valor de retorno, use la conveniente clase <code>TransactionCallbackWithoutResult</code> con una clase an√≥nima, como se muestra a continuaci√≥n: <br><br><pre> <code class="java hljs">transactionTemplate.execute(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallbackWithoutResult() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInTransactionWithoutResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TransactionStatus status)</span></span></span><span class="hljs-function"> </span></span>{ updateOperation1(); updateOperation2(); } });</code> </pre><br><ul><li>  Las instancias de la clase <code>TransactionTemplate</code> son seguras para subprocesos, por lo que no todos los estados de di√°logo son compatibles. </li><li>  Sin embargo, las instancias de <code>TransactionTemplate</code> mantienen el estado de configuraci√≥n, por lo que si una clase necesita usar una TransactionTemplate con diferentes configuraciones (por ejemplo, un nivel de aislamiento diferente), entonces debe crear dos instancias diferentes de TransactionTemplate, aunque algunas clases pueden usar la misma instancia de TransactionTemplate. </li></ul><br>  b.  Usando la implementaci√≥n <code>PlatformTransactionManager</code> directamente: <br><br>  Miremos esta opci√≥n en el c√≥digo nuevamente. <br><br><pre> <code class="java hljs">&lt;!-- Initialization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> data source --&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"driverClassName"</span></span> value=<span class="hljs-string"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"url"</span></span> value=<span class="hljs-string"><span class="hljs-string">"jdbc:mysql://localhost:3306/TEST"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"username"</span></span> value=<span class="hljs-string"><span class="hljs-string">"root"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"password"</span></span> value=<span class="hljs-string"><span class="hljs-string">"password"</span></span>/&gt; &lt;/bean&gt; &lt;!-- Initialization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> TransactionManager --&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"transactionManager"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> ref=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> /&gt; &lt;/bean&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlatformTransactionManager transactionManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTransactionManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( PlatformTransactionManager transactionManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactionManager = transactionManager; } DefaultTransactionDefinition def = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultTransactionDefinition(); <span class="hljs-comment"><span class="hljs-comment">//     -  ,       def.setName("SomeTxName"); def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED); TransactionStatus status = txManager.getTransaction(def); try { //   -  } catch (Exception ex) { txManager.rollback(status); throw ex; } txManager.commit(status); }</span></span></code> </pre> <br>  Ahora, antes de pasar al siguiente m√©todo de gesti√≥n de transacciones, veamos c√≥mo decidir qu√© tipo de gesti√≥n de transacciones elegir. <br><br>  Elegir entre la <b>gesti√≥n de transacciones</b> <b>program√°tica</b> y <b>declarativa</b> : <br><br><ul><li>  La gesti√≥n program√°tica de transacciones es una buena opci√≥n solo si tiene un peque√±o n√∫mero de operaciones transaccionales.  (En la mayor√≠a de los casos, estas no son transacciones). </li><li>  El nombre de una transacci√≥n solo se puede establecer expl√≠citamente en Program Transaction Management. </li><li>  La gesti√≥n program√°tica de transacciones debe usarse cuando desea controlar expl√≠citamente la gesti√≥n de transacciones. </li><li>  Por otro lado, si su aplicaci√≥n contiene numerosas operaciones transaccionales, vale la pena usar la gesti√≥n declarativa. </li><li>  La gesti√≥n declarativa no le permite gestionar transacciones en l√≥gica empresarial y no es dif√≠cil de configurar. </li></ul><br>  <i><b>2.2.</b></i>  <i><b>Transacciones declarativas (generalmente utilizadas en casi todos los escenarios de cualquier aplicaci√≥n web)</b></i> <br><br>  <b>Paso 1</b> : defina el administrador de transacciones en el archivo xml de contexto de su aplicaci√≥n Spring. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">transaction-manager</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txManager"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  <b>Paso 2</b> : habilite el soporte de anotaciones agregando una entrada en el archivo xml de contexto de su aplicaci√≥n Spring. <br><br>  O agregue <code>@EnableTransactionManagement</code> a su archivo de configuraci√≥n, como se muestra a continuaci√≥n: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableTransactionManagement</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppConfig</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br>  <i><b>Spring recomienda anotar solo clases espec√≠ficas (y m√©todos de clases espec√≠ficas) con anotaci√≥n <code>@Transactional</code> comparaci√≥n con las interfaces de anotaci√≥n.</b></i> <br><br>  La raz√≥n de esto es porque coloca la anotaci√≥n en el nivel de la interfaz, y si usa clases proxy ( <code>proxy-target-class = ¬´true¬ª</code> ) o el aspecto entrelazado ( <code>mode = ¬´aspectj¬ª</code> ), la infraestructura proxy no reconoce los par√°metros de transacci√≥n y plexos, por ejemplo, no se aplicar√° el comportamiento transaccional. <br><br>  <b>Paso 3</b> : Agregue la anotaci√≥n <b><code>@Transactional</code></b> a la clase (m√©todo de clase) o interfaz (m√©todo de interfaz). <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">proxy-target-class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Configuraci√≥n predeterminada: <code>proxy-target-class="false"</code> <br><br><ul><li>  <code>@Transactional</code> puede colocar una <code>@Transactional</code> antes de una definici√≥n de interfaz, un m√©todo de interfaz, una definici√≥n de clase o un m√©todo de clase p√∫blica. </li><li>  Si desea que algunos m√©todos de clase (marcados con la anotaci√≥n <code>@Transactional</code> ) tengan configuraciones de atributos diferentes, como el nivel de aislamiento o el nivel de propagaci√≥n, coloque la anotaci√≥n en el nivel de m√©todo para anular la configuraci√≥n de atributos de nivel de clase. </li><li>  En el modo proxy (que se establece de manera predeterminada), solo se pueden interceptar las llamadas a m√©todos "externos" que pasan por el proxy.  Esto significa que una "llamada independiente", por ejemplo, un m√©todo en el destino que llama a alg√∫n otro m√©todo del objetivo, no dar√° como resultado una transacci√≥n real en tiempo de ejecuci√≥n, incluso si el m√©todo llamado est√° etiquetado con <code>@Transactional</code> . </li></ul><br>  Ahora veamos <code>@Transactional</code> diferencia entre los <code>@Transactional</code> anotaci√≥n <code>@Transactional</code> <br><br> <b><code>@Transactional (isolation=Isolation.READ_COMMITTED)</code></b> <br> <br><ul><li>  El valor predeterminado es <code>Isolation.DEFAULT</code> </li><li>  En la mayor√≠a de los casos, usar√° la configuraci√≥n predeterminada hasta que tenga requisitos especiales. </li><li>  Le dice al administrador de transacciones ( <code>tx</code> ) que el siguiente nivel de aislamiento debe usarse para el <code>tx</code> actual.  Debe instalarse en el punto desde donde comienza <code>tx</code> , porque no podemos cambiar el nivel de aislamiento despu√©s de que tx comienza. </li></ul><br>  <b>PREDETERMINADO</b> : utilice el nivel de aislamiento predeterminado en la base de datos base. <br><br>  <b>READ_COMMITTED</b> (lectura de datos fijos): una constante que indica que se ha evitado la lectura sucia;  Lectura no repetida y lectura fantasma pueden ocurrir. <br><br>  <b>READ_UNCOMMITTED</b> (leer datos no confirmados): este nivel de aislamiento indica que una transacci√≥n puede leer datos que otras transacciones a√∫n no han eliminado. <br><br>  <b>REPEATABLE_READ</b> (repetibilidad de lectura): una constante que indica que se evitan lecturas sucias y lecturas no repetibles;  puede aparecer la lectura fantasma. <br><br>  <b>SERIALIZABLE</b> : Permanente, lo que indica que se evita la lectura sucia, la lectura no repetible y la lectura fantasma. <br><br>  ¬øQu√© significan estas jergas: lectura "sucia", lectura fantasma o lectura repetida? <br><br><ul><li>  <b>Lectura sucia</b> : la transacci√≥n A escribe.  Mientras tanto, la transacci√≥n "B" lee el mismo registro hasta que se completa la transacci√≥n A. M√°s tarde, la transacci√≥n A decide revertir, y ahora tenemos cambios en la transacci√≥n B que son incompatibles.  Esta es una lectura sucia.  La transacci√≥n B funcion√≥ en el nivel de aislamiento READ_UNCOMMITTED, por lo que podr√≠a leer los cambios realizados por la transacci√≥n A antes de que se completara la transacci√≥n. </li><li>  <b>Lectura no repetible</b> : la transacci√≥n "A" lee algunos registros.  Luego, la transacci√≥n "B" escribe este registro y lo confirma.  M√°s tarde, la transacci√≥n A lee el mismo registro nuevamente y puede recibir diferentes valores, ya que la transacci√≥n B realiz√≥ cambios en este registro y los confirm√≥.  Esta es una lectura que no se repite. </li><li>  <b>Lectura fantasma</b> : la transacci√≥n "A" lee una serie de registros.  Mientras tanto, la transacci√≥n "B" inserta un nuevo registro en la misma fila que la transacci√≥n A. M√°s tarde, la transacci√≥n A lee el mismo rango nuevamente y tambi√©n recibe el registro que la transacci√≥n B acaba de insertar. Esta es una lectura fantasma: la transacci√≥n recuper√≥ una serie de registros varias veces de la base de datos y recibi√≥ diferentes conjuntos de resultados (que contienen registros fantasma). </li></ul><br> <code><b>@Transactional(timeout=60)</b></code> <br> <br>  El valor predeterminado es el tiempo de espera predeterminado para el sistema de transacci√≥n subyacente. <br><br>  Informa al administrador de tx sobre el tiempo de espera hasta que tx est√© inactivo antes de decidir si revierte las transacciones que no responden. <br><br> <code><b>@Transactional(propagation=Propagation.REQUIRED)</b></code> <br> <br>  Si no se especifica, el comportamiento de propagaci√≥n predeterminado es <code>REQUIRED</code> . <br><br>  Otras opciones son <code>REQUIRES_NEW, MANDATORY, SUPPORTS, NOT_SUPPORTED, NEVER</code> y <code>NESTED</code> . <br><br>  <b>REQUERIDO</b> <br><br>  Indica que el m√©todo de destino no puede funcionar sin un tx activo.  Si tx ya se est√° ejecutando antes de llamar a este m√©todo, continuar√° en el mismo tx o el nuevo tx comenzar√° poco despu√©s de llamar a este m√©todo. <br><br>  <b>REQUISITOS_NUEVO</b> <br><br><ul><li>  Indica que se debe ejecutar un nuevo tx cada vez que se llama al m√©todo de destino.  Si tx ya se est√° ejecutando, se detendr√° antes de comenzar uno nuevo. </li></ul><br>  <b>Obligatorio</b> <br><br><ul><li>  Indica que el m√©todo de destino requiere tx activo.  Si tx no contin√∫a, no fallar√°, lanzando una excepci√≥n. </li></ul><br>  <b>SOPORTES</b> <br><br><ul><li>  Indica que el m√©todo de destino se puede ejecutar independientemente de tx.  Si tx funciona, participar√° en el mismo tx.  Si se ejecuta sin tx, se seguir√° ejecutando si no hay errores. </li></ul><br><ul><li>  Los m√©todos que recuperan datos son los mejores candidatos para esta opci√≥n. </li></ul><br>  <b>NO SOPORTADO</b> <br><br><ul><li>  Indica que el m√©todo de destino no requiere la propagaci√≥n del contexto de transacci√≥n. </li><li>  B√°sicamente, los m√©todos que se ejecutan en una transacci√≥n, pero que realizan operaciones con RAM, son los mejores candidatos para esta opci√≥n. </li></ul><br>  <b>Nunca</b> <br><br><ul><li>  Indica que el m√©todo de destino generar√° una excepci√≥n si se ejecuta en un proceso transaccional. </li><li>  Esta opci√≥n no se usa en la mayor√≠a de los casos en proyectos. </li></ul><br> <b><code>@Transactional (rollbackFor=Exception.class)</code></b> <br> <br>  Valor predeterminado: <code>rollbackFor=RunTimeException.class</code> <br><br>  En Spring, todas las clases API lanzan una RuntimeException, lo que significa que si alg√∫n m√©todo falla, el contenedor siempre revierte la transacci√≥n actual. <br><br>  El problema es solo con excepciones marcadas.  Por lo tanto, este par√°metro se puede usar para deshacer declarativamente una transacci√≥n si se produce una <code>Checked Exception</code> . <br><br> <code><b>@Transactional (noRollbackFor=IllegalStateException.class)</b></code> <br> <br>  Indica que la reversi√≥n no deber√≠a ocurrir si el m√©todo de destino genera esta excepci√≥n. <br><br>  Ahora, el √∫ltimo pero m√°s importante paso en la gesti√≥n de transacciones es publicar la anotaci√≥n <code>@Transactiona</code> l.  En la mayor√≠a de los casos, surge la confusi√≥n donde se debe ubicar la anotaci√≥n: ¬øen el nivel de servicio o en el nivel DAO? <br><br>  <b><code>@Transactional</code> : ¬øServicio o nivel DAO?</b> <br><br>  El servicio es el mejor lugar para colocar <code>@Transactional</code> , el nivel de servicio debe contener el comportamiento del caso de uso al nivel de detalle para la interacci√≥n del usuario, que l√≥gicamente entra en la transacci√≥n. <br><br>  Hay muchas aplicaciones CRUD que no tienen una l√≥gica comercial significativa que tenga un nivel de servicio que simplemente transfiera datos entre controladores y objetos de acceso a datos, lo que no es √∫til.  En estos casos, podemos poner la anotaci√≥n de transacci√≥n en el nivel DAO. <br><br>  Por lo tanto, en la pr√°ctica, puede colocarlos en cualquier lugar, depende de usted. <br><br>  Adem√°s, si coloca <code>@Transactional</code> en la capa DAO y si su capa DAO ser√° reutilizada por diferentes servicios, ser√° dif√≠cil colocarla en la capa DAO, ya que diferentes servicios pueden tener diferentes requisitos. <br><br>  Si su nivel de servicio recupera objetos usando Hibernate, y digamos que tiene inicializaciones diferidas en la definici√≥n de un objeto de dominio, entonces necesita abrir la transacci√≥n en el nivel de servicio, de lo contrario, encontrar√° una excepci√≥n LazyInitializationException lanzada por ORM. <br><br>  Considere otro ejemplo donde su nivel de servicio puede llamar a dos m√©todos DAO diferentes para realizar operaciones de base de datos.  Si su primera operaci√≥n DAO fall√≥, las otras dos pueden transferirse y finalizar√° el estado inconsistente de la base de datos.  La anotaci√≥n de nivel de servicio puede salvarlo de tales situaciones. <br><br>  Espero que este art√≠culo te haya ayudado. <br><br>  El fin <br><br>  Siempre es interesante ver sus comentarios o preguntas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es431508/">https://habr.com/ru/post/es431508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431498/index.html">WebP se har√° cargo de la web pronto, pero no tardar√° mucho</a></li>
<li><a href="../es431500/index.html">Bases de datos y Kubernetes (informe de revisi√≥n y video)</a></li>
<li><a href="../es431502/index.html">Conferencia para desarrolladores de iOS Kolesa Mobile 3.0. Informe de video</a></li>
<li><a href="../es431504/index.html">Phishing - funciona. Cr√≥nica del robo del iPhone XS seguido del robo de datos de iCloud</a></li>
<li><a href="../es431506/index.html">Xcode y depuraci√≥n avanzada en LLDB: Parte 1</a></li>
<li><a href="../es431510/index.html">C√≥mo recopilar informaci√≥n del contorno Compra con selenio</a></li>
<li><a href="../es431512/index.html">Un peque√±o estudio de las propiedades de una simple U-net, una red convolucional cl√°sica para la segmentaci√≥n.</a></li>
<li><a href="../es431514/index.html">Entrevista para entrevistadores.</a></li>
<li><a href="../es431516/index.html">Un d√≠a en la vida de un asesor financiero</a></li>
<li><a href="../es431518/index.html">Microsoft Connect (); Meetup en Mosc√∫</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>