<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíí ü§≥ ‚ûø Sistema de archivos ESP32 y SPIFFS üë©üèæ‚Äçüîß ‚è≥ üíÜüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SPIFFS : sistema de archivos (Sistema de archivos flash de interfaz perif√©rica en serie) para memoria flash conectada a trav√©s de una interfaz perif√©r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistema de archivos ESP32 y SPIFFS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483280/"><p><img src="https://habrastorage.org/webt/dk/uh/vq/dkuhvq6yoyqdkd4tcxoysp1cldg.png"></p><br><p>  <strong>SPIFFS</strong> : sistema de archivos (Sistema de archivos flash de interfaz perif√©rica en serie) para memoria flash conectada a trav√©s de una interfaz perif√©rica en serie.  En palabras simples: hay un microcontrolador ESP32 (Figura 1), tiene una memoria NOR no vol√°til regrabable incorporada, que almacena: Preferencias, gestor de arranque, firmware (boceto compilado), sistema de archivos (SPIFFS) y algo m√°s algo as√≠ como una actualizaci√≥n por aire (OTA). </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/4k/dn/lc/4kdnlcaw_rmw1zh3saprrt8g-lm.png"></p><br><p>  Figura 1. Diagrama de bloques funcional del microcontrolador ESP32 </p><br><p>  <strong>La memoria NOR</strong> es un tipo de memoria regrabable no vol√°til que tiene una velocidad de lectura bastante alta, una velocidad de escritura y borrado relativamente baja, en comparaci√≥n con el tipo de <strong>memoria NAND</strong> .  Es casi imposible cumplir con la memoria NOR de gran capacidad, generalmente limitada a 128 MB.  En el caso de ESP32 - <strong>cuatro</strong> . </p><br><p>  Hoy SPIFFS tiene algunas desventajas. <del>  fallas </del>  , incluyendo: falta de soporte de carpetas;  no es una pila en tiempo real, por lo que la misma operaci√≥n puede llevar tiempos diferentes;  falta de capacidad para encontrar y reparar bloques rotos.  Si las deficiencias enumeradas no son cr√≠ticas para usted, entonces continuamos leyendo el siguiente p√°rrafo. </p><br><h2 id="davayte-pogovorim-ob-ispolzovanii">  Hablemos de usar </h2><br><p>  Desafortunadamente, fuera de la caja, la memoria del microcontrolador no est√° marcada como SPIFFS, para marcarla, debe usar el <a href="" rel="nofollow"><strong>complemento ESP32FS</strong></a> para el entorno de desarrollo Arduino IDE. </p><br><p>  Despu√©s de descargar el complemento, debe instalarse: </p><br><ul><li>  Aseg√∫rese de tener <strong>instalada</strong> la √∫ltima versi√≥n del entorno de desarrollo <strong>Arduino IDE</strong> y el <strong>controlador</strong> para su dispositivo en el <strong>ESP32</strong> .  Tengo el controlador <strong>M5Stack CP210X</strong> que descargo de <a href="https://m5stack.com/pages/download" rel="nofollow">este</a> enlace; </li><li>  Copie la carpeta de <strong>herramientas</strong> descargada con el complemento incrustado en la carpeta <strong>/ Arduino / tools / ESP32FS /</strong> ; </li><li>  En <strong>macOS, la</strong> carpeta se encuentra en <strong>~ / Documents / Arduino /</strong> ; </li><li>  Reinicie la computadora y compruebe en el entorno de desarrollo en el men√∫ <strong>Herramientas</strong> que aparece el elemento de <strong>carga de datos de boceto ESP32</strong> (Figura 2), eso significa que hizo todo correctamente; </li></ul><br><p><img src="https://habrastorage.org/webt/-x/nx/hh/-xnxhhpznuyuzorp80sfkjugpwm.png"></p><br><p>  Figura 2. Men√∫ de <strong>herramientas</strong> </p><br><ul><li>  Presta atenci√≥n a la carpeta de <strong>datos</strong> ubicada al lado del boceto.  Todos los archivos ubicados en esta carpeta se cargar√°n en la memoria del dispositivo durante el formateo; </li><li>  Si√©ntase libre de seleccionar el elemento indicado y espere hasta el final del formateo del √°rea de memoria.  Tenga en cuenta que otras secciones de la memoria <strong>NO se</strong> ver√°n afectadas, lo que significa que el firmware permanecer√° en la memoria del dispositivo y funcionar√°.  De manera similar con el boceto, cuando se compila en el firmware y se descarga al dispositivo, el sistema de archivos no se ver√° afectado. </li></ul><br><h2 id="esli-hochetsya-komforta">  Si quieres comodidad </h2><br><ul><li><p>  Si desea tocar archivos y ver informaci√≥n sobre el espacio libre, descargue el boceto <a href="https://github.com/dsiberia9s/A-Explorer/tree/master/BRIDGE" rel="nofollow"><strong>BRIDGE</strong></a> y muestre su dispositivo. </p><br></li><li><p>  Descargue tambi√©n <del>  y compilar </del>  Administrador de archivos multiplataforma <strong><a href="https://github.com/dsiberia9s/A-Explorer" rel="nofollow">A-Explorer</a></strong> (Figura 3).  En <strong>GitHub, los</strong> binarios pronto estar√°n en la carpeta <strong>bin</strong> . </p><br><p><img src="https://habrastorage.org/webt/mp/6d/rg/mp6drgioq7tnnceb7zwowdfsgds.png"></p><br><p>  Figura 3 a.  Administrador de archivos A-Explorer para macOS </p><br><p><img src="https://habrastorage.org/webt/bs/hw/ko/bshwkodnhxaqb8jonxgpxdanlqo.jpeg"></p><br><p>  Figura 3, b.  Administrador de archivos A-Explorer para Windows </p><br></li></ul><br><p>  Este administrador de archivos le permitir√° encontrar informaci√≥n sobre espacio libre, cargar / descargar / eliminar archivos.  Hay una indicaci√≥n del progreso de la operaci√≥n. </p><br><p>  Como puede ver en la Figura 3, el complemento asign√≥ aproximadamente <strong>1.38 MB de</strong> memoria bajo SPIFFS. </p><br><h2 id="kto-takoy-etot-bridge">  ¬øQui√©n es este PUENTE? </h2><br><p>  <strong>BRIDGE</strong> es un boceto y, en primer lugar, una funci√≥n del mismo nombre que funciona con el sistema de archivos SPIFFS y A-Explorer es un shell gr√°fico para √©l.  Este √∫ltimo env√≠a un comando u otro, y esta funci√≥n lo procesa en el dispositivo usando las <strong>bibliotecas</strong> <strong>FS</strong> y <strong>SPIFFS</strong> .  Veamos qu√© es interesante en estas bibliotecas. </p><br><p>  Comencemos mirando los m√©todos p√∫blicos <strong>de la clase SPIFFS</strong> : </p><br><ul><li><p>  M√©todo de inicio de bool (bool formatOnFail = false, const char * basePath = "/ spiffs", uint8_t maxOpenFiles = 10).  Este m√©todo intenta inicializar una instancia de la clase.  El primer argumento es verdadero o falso en caso de que el sistema de archivos deba formatearse si el sistema de archivos no est√° formateado.  El segundo argumento toma la ruta donde se ubicar√° la ra√≠z del sistema de archivos.  El tercer argumento determinar√° la cantidad de archivos abiertos simult√°neamente.  Es mejor dejar los dos √∫ltimos par√°metros predeterminados y no cambiarlos.  Si falta el sistema de archivos (no se utiliz√≥ el complemento anterior).  entonces la funci√≥n devolver√° falso. </p><br></li><li><p>  El m√©todo bool format () verificar√° si el sistema de archivos est√° formateado, devuelve verdadero, de lo contrario, falso. </p><br></li><li><p>  M√©todo size_t totalBytes ().  Este m√©todo devuelve el n√∫mero size_t del n√∫mero total de bytes asignados para el sistema de archivos. </p><br></li><li><p>  M√©todo size_t usedBytes ().  Este m√©todo devuelve el n√∫mero size_t de bytes utilizados en el sistema de archivos. </p><br></li><li><p>  M√©todo de fin vac√≠o ().  Este m√©todo desinicializa esta clase.  Despu√©s de llamar a este m√©todo, no tiene sentido llamar a otros m√©todos. </p><br></li></ul><br><p>  Todo en esta clase, no hay nada particularmente interesante.  Pasemos a <strong>la clase FS</strong> y veamos qu√© puede ser √∫til desde all√≠. </p><br><ul><li><p>  Lo primero que llama la atenci√≥n es el m√©todo de inicializaci√≥n de la clase bool begin ().  Este m√©todo no requiere argumentos y no hay necesidad de llamarlo, porque usaremos el siguiente m√©todo de inmediato. </p><br></li><li><p>  El m√©todo de abrir archivo (const char <em>path, const char</em> mode) y su hermano File open (const String &amp; path, const char * mode).  Estos m√©todos toman dos argumentos, el primero de los cuales es un puntero simb√≥lico y de cadena a la ruta del archivo, y el segundo es el modo de apertura, que puede ser la siguiente constante: </p><br></li></ul><br><p>  <strong>FILE_READ</strong> : abierto solo para lectura; </p><br><p>  <strong>FILE_WRITE</strong> : abierto solo para escritura; </p><br><p>  <strong>FILE_APPEND</strong> : abierto para sobrescribir. </p><br><p>  Despu√©s de abrir el archivo, ahora podemos realizar cualquier operaci√≥n en √©l. </p><br><ul><li>  El m√©todo size_t write (uint8_t) le permite escribir un entero sin signo de 8 bits al final del archivo. </li><li>  El m√©todo de escritura size_t (const uint8_t * buf, size_t size) le permite escribir una serie de enteros sin signo de la longitud especificada en el segundo argumento. </li><li>  El m√©todo int available () cuenta el n√∫mero de caracteres desde el final hasta el puntero. </li><li>  El m√©todo int read () lee un car√°cter del archivo y lo devuelve como un entero, mientras el cursor desplaza una unidad hacia la derecha. </li><li>  El m√©todo size_t readBytes (char * buffer, size_t length) lee los caracteres en el b√∫fer se√±alado por el primer argumento y el n√∫mero de caracteres pasados ‚Äã‚Äãpor el segundo argumento.  Devuelve el n√∫mero de caracteres le√≠dos. </li><li>  El m√©todo String readString () lee una l√≠nea de un archivo. </li><li>  El m√©todo int peek () funciona de manera similar al m√©todo int read (), solo el cursor permanece en su lugar. </li><li>  El m√©todo bool seek (uint32_t pos, modo SeekMode) y bool seek (uint32_t pos, modo SeekMode) establece el cursor en la ubicaci√≥n especificada.  La posici√≥n se pasa como el primer argumento y la segunda regla ( <strong>SeekSet</strong> - establece el cursor).  Si tiene √©xito, devuelve verdadero, de lo contrario, falso. </li><li>  El m√©todo size_t position () devuelve la posici√≥n del cursor. </li><li>  El m√©todo size_t size () devuelve el tama√±o del archivo en Bytes. </li><li>  El m√©todo const char * name () devuelve el nombre del archivo. </li><li>  El m√©todo const char * fullName (), teniendo en cuenta la ruta completa. </li><li>  El m√©todo bool isFile () devuelve verdadero si el objeto abierto es un archivo.  De lo contrario, una mentira. </li><li>  El m√©todo bool isDirectory () devuelve verdadero si el objeto abierto es una carpeta.  De lo contrario, una mentira. </li><li>  El m√©todo File openNextFile () devuelve un puntero al siguiente archivo en la ra√≠z; de lo contrario, NULL. </li><li>  Los m√©todos bool existe (const char * path) y bool exist (const String &amp; path) toman el nombre completo del archivo como argumento, y si tal archivo existe, devuelve verdadero, de lo contrario devuelve falso. </li><li>  Los m√©todos bool remove (const char * path) y bool remove (const String &amp; path) intentan eliminar el archivo cuyo nombre se pasa por argumento.  Si tiene √©xito, devuelve verdadero, de lo contrario, falso. </li><li>  M√©todo bool rename (const char <em>pathFrom, const char</em> pathTo) y bool rename (const String &amp; pathFrom, const String &amp; pathTo);  toma el nombre completo del archivo como primer argumento, y el segundo como el nombre completo del nuevo archivo y le cambia el nombre. </li></ul><br><p>  S√≠, s√≠, puede tomar esta funci√≥n y ejecutarla en un hilo separado en cualquier otro boceto </p><br><p>  <strong>Muchas gracias por tu tiempo!</strong>  <strong>Me alegrar√≠a si este art√≠culo te beneficia.</strong> </p><br><h3 id="spisok-literatury-i-ili-istochnikov">  Referencias y (o) fuentes: </h3><br><ul><li>  Sistema de archivos SPIFFS <a href="https://docs.espressif.com/projects/esp-idf/en/latest/api-reference/storage/spiffs.html" rel="nofollow">aqu√≠</a> </li><li>  Trabaje con el sistema de archivos en el complemento ESP8266 en el IDE de Arduino <a href="http://wikihandbk.com/wiki/ESP8266:%25D0%259F%25D1%2580%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B2%25D0%25BA%25D0%25B8/Arduino/%25D0%25A0%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0_%25D1%2581_%25D1%2584%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25BE%25D0%25B9_%25D0%25B2_%25D0%25B0%25D0%25B4%25D0%25B4%25D0%25BE%25D0%25BD%25D0%25B5_ESP8266_%25D0%25B4%25D0%25BB%25D1%258F_IDE_Arduino" rel="nofollow">aqu√≠</a> </li><li>  Cargador de sistema de archivos Arduino ESP32 <a href="https://github.com/me-no-dev/arduino-esp32fs-plugin" rel="nofollow">aqu√≠</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/483280/">https://habr.com/ru/post/483280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483268/index.html">El libro "Moda, fe, fantas√≠a y la nueva f√≠sica del universo"</a></li>
<li><a href="../483270/index.html">La evoluci√≥n de las aplicaciones HighLoad en el ejemplo de un portal regional de servicios p√∫blicos</a></li>
<li><a href="../483272/index.html">El camino desde el negocio de los restaurantes hasta la empresa de TI.</a></li>
<li><a href="../483276/index.html">Nuevas caracter√≠sticas de Python 3.8 y es hora de actualizar a Python 2</a></li>
<li><a href="../483278/index.html">Acuerdo de asociaci√≥n o c√≥mo no arruinar un negocio al comienzo</a></li>
<li><a href="../483284/index.html">C√≥mo analic√© el horario</a></li>
<li><a href="../483290/index.html">Pensamiento de dise√±o en la gesti√≥n de proyectos o por qu√© un gerente de proyecto necesita t√©cnicas creativas</a></li>
<li><a href="../483294/index.html">Estamos escribiendo una "calculadora". Parte II Resuelve ecuaciones, renderiza en LaTeX, acelera funciones para superluz</a></li>
<li><a href="../483298/index.html">C√≥mo dejarlo bien, para que luego ...</a></li>
<li><a href="../483302/index.html">Comenzando con Google Sheets en Python. Desde el registro hasta la lectura de datos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>