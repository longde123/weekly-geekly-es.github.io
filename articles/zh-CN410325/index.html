<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🔧 ☢️ 👩🏾‍🤝‍👨🏻 使用CGNAT解决地址短缺 🍺 🧑🏼 📸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="互联网无一例外地进入了我们生活的方方面面。 了解哪些设备具有用于连接网络的端口后，您就会发疯。 同时，IP地址的数量成正比减少。 

 一个简单的例子：在这方面我很保守，但是已经联系上了： 



- 电视（2个）； 
- 电话（2 sim）； 
- 硬盘录像机 
- 汽车 
- 狗（与GPS / ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用CGNAT解决地址短缺</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nag/blog/410325/"><img src="https://habrastorage.org/webt/u_/sw/9z/u_sw9zekm8jepuprzoayoppwiye.jpeg"><br><br> 互联网无一例外地进入了我们生活的方方面面。 了解哪些设备具有用于连接网络的端口后，您就会发疯。 同时，IP地址的数量成正比减少。 <br><a name="habracut"></a><br> 一个简单的例子：在这方面我很保守，但是已经联系上了： <br><br><ul><li> 电视（2个）； </li><li> 电话（2 sim）； </li><li> 硬盘录像机 </li><li> 汽车 </li><li> 狗（与GPS / GPRS配合使用）。 </li></ul><br> 下一行： <br><br><ul><li> 屋子里的灯 </li><li> 水壶 </li><li> 烫衣板。 </li></ul><br> 将来，还有更多。 在家中，在工作中，在汽车中，在公共交通中，在乡下-到处都有Internet访问。 说出不存在的地方比较容易。...相反，由于互联网无处不在，因此难度更大。 <br><br>  “已连接”设备的数量正以惊人的速度增长。 无法分析需要IP地址的硬件的统计数据和增长预测，但是所有消息来源都认为增长是指数级的，并且这种趋势将在未来5-10年内持续下去。 <br><br> 随着网络的下一次扩展，又有一个IP地址块投入生产，几乎没有剩余的东西了...... LIR PI并没有放弃（这已经是5年了），而且PA每年都变得越来越昂贵，租用这样的重要资源正面临着巨大的风险。 实际上，最后一次获得LIR资格和令人垂涎的/ 22机会是巨大的，而且，根据RIPE最新消息判断，很快就不会有这样的机会：欧洲注册服务商给出了最后/ 8块的一半以上。 <br><br><img src="https://habrastorage.org/webt/xe/vt/pi/xevtpienobbeec7n7yuthbvtf78.png"><br><br> 地址的全部用完了： <br><br><img src="https://habrastorage.org/webt/mc/hr/dr/mchrdrds2wk-k6t814sjggs9_ss.jpeg"><br><br> 从图表可以明显看出，注册服务商的预测是正确的。 尽管RIPE竭尽全力延长痛苦，但2017年仍发布了约400万个地址，其中总数为1100万个。 这表明到2020年它们将完全消失。 运营商必须做出选择：集中保存IPv4或切换到IPv6。 <br><br> 回顾网络的未来架构，我得出的结论是，从IPv6实施的速度来看，在接下来的（至少）10-15年内，主要流量仍将保留在Internet协议的第4版上。 在俄罗斯今天的BGP公告中，只有大约15％的AS具有IPv6，而在世界范围内-略多于25％， <br><br><img src="https://habrastorage.org/webt/v3/9x/6q/v39x6qekc0bo6msrsj9pyfmhaii.png"><br><br>  MSK-IX中的IPv6流量少于IPv4（源）的1％， <br><br><img src="https://habrastorage.org/webt/0i/xk/ib/0ixkibpqzir39pvuanb3wrnrr4i.png"><br><br><img src="https://habrastorage.org/webt/1r/o_/tv/1ro_tvylgwt9ffb-osdbk3govvw.png"><br><br> 根据Google的说法-全球仅超过20％的用户（在俄罗斯只有1.34％）来自IPv6。 <br><br><img src="https://habrastorage.org/webt/qe/bi/qx/qebiqxf0n-jssx4m-cryi8hx6ic.jpeg"><br><br>  IPv6流量有所增加，但并不至于让其严重担心和匆忙实施它。 这是由于以下事实：尚未在所有客户端设备中实现对IPv6的本地支持！ 即使是新产品，甚至是超新潮的产品，也都声称拥有新一代的物联网设备。 因此，正如Google的一位员工Avery Pennarun所写的正确的那样，在将网络完全过渡到IPv6之后，我们仍然需要NAT。 这样过时的IPv4灯泡就可以进入Internet。 <br><br> 关于IPv6实现的文章很多。 平均数兆字节的阅读文本和我们自己的实验得出的结论是，在2017年底，您需要实现IPv6，但要谨慎。 耙子很多，每个耙子都有自己的耙子。 有了v6支持，即使在操作员设备上，一切仍然很糟糕（您至少可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a>阅读有关rake的实现）。 您需要实现DualStack，即 同时向客户端发布IPv6和IPv4地址。 这意味着IPv4的剩余部分仍需要分发给客户，并且很快他们就可以用它的黄金来负担，并且需要进行保存。 因此，在接下来的（至少）十年内，NAT将无处可走，这意味着您需要考虑实现Dual Stack的情况来规划网络的发展，或者仅购买仅支持v6的新硬件，以尽可能减少问题的发生。 <br><br> 可以预测流量和订户数量的增长，我相信在实现NAT的现有硬件上，资源将很快用完，并且有必要进行扩展。 有必要解决以下任务： <br><br><ul><li> 为每个用户提供给定数量的广播； </li><li> 提供地址池-必须将来自一个客户端的所有连接广播到相同的白色IP； </li><li> 限制一次广播的寿命； </li><li> 保留广播日志（用于SORM）。 </li></ul><br> 市场为我们提供什么解决方案？ <br><br><img src="https://habrastorage.org/webt/l2/1k/zx/l21kzx7bdd6kfikn3s3inpyy9pg.jpeg"><br><br> 硬件解决方案的选择是品牌的选择，也是对稳定性和可靠性的希望。 关于如何选择高端车-法拉利（Ferrari），兰博基尼（Lamborghini），麦克拉伦（Maclaren）...固然很好，但购买预算非常庞大，而且运营需要高素质的工程师。 而且，除了非常昂贵外，这种资格认证还应针对特定制造商。 例如，瞻博网络准备好教您的管理员在其设备上配置NAT，价格略高于700美元（在此处），并且仅取决于AJSPR证书的可用性。 因此，如果您已经在网络核心中拥有Cisco ASR，那么，例如考虑让Ericcsson在其上使用单个功能就毫无意义。 <br><br> 另一方面，NAT在纯硬件（ASIC）上的实现颇为陌生，为此，Cisco的CGSE模块不过是一台具有基于FreeBSD的专有软件的x.86服务器，该服务器适合作为一部分工作。硬件路由器。 从这个意义上讲，它的价格似乎是天价。 但是，品牌硬件解决方案最令人垂涎​​的功能是“设置后就忘了”，这很遗憾，只是尚未有人100％实现。 值得一提的是虚拟化平台，例如NFWare虚拟运营商级NAT，Juniper vSRX / vMX和其他NFV解决方案，当网络功能在逻辑上集中时，对于分布式NFV（dNFV）的概念来说，NAT是一个有趣的案例（我们有一个池）地址和资源，以及一个管理点），但同时它们是按地理位置<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">分布的</a> 。 但是，这个主题值得进行单独且全面的回顾。 <br><br> 有观点认为，对于NFV的未来而言，这个话题并不有趣，传统上既是知名品牌在运营商的钢铁市场上占据头把交椅，又有大型投资者积极为与虚拟化相关的一切提供资金，包括网络功能（以AFK为例）系统和NFWare）。 但是，在本文的框架中，NFV我将不再赘述。 <br><br> 此外，Mikrotik稍显与众不同，可以在x.86而非x.86（CCR）平台上以及在虚拟化环境（CHR）中实现，但是，这是一个纯软路由器，可以处理几乎所有功能相同的处理器。 但是，鉴于CCR是具有专有软件的完整设备-我也将其分配给硬件部分（顺便说一下，这是针对小型网络的少数解决方案之一-NAT +模式下的性能极限约为4-5 Gb / s型号CCR-1036）和用于x.86的RouterO-软件-最终出现在x.86部分。 <br><br> 如果您回到汽车主题，那么在Linux / FreeBSD上的自组装就是一辆拉力赛车。 我们需要采用一个原本旨在用于民用目的，熟练的机械师的平台，并进行锯，扭曲，微调，调整，重建，并希望最终一切都能很快实现胜利……这一切取决于90％的将实施和支持。 通常，只有这样的人才能在公司工作。 然后，他基于对过程的理解来构建一个系统。 并且他支持该系统。 如果他离开将会怎样？ 该功能的文档化程度如何？ 维护别人的这种系统与从头编写它一样昂贵。 <br><br> 诸如RDP.ru，Carbon Soft，VAS Experts等纯软件解决方案是自我收藏和知名品牌的替代方案。 用汽车术语来说，这是一个调音室，只要花一定的钱，就可以用民用汽车制造出非常令人印象深刻的跑车，这绝不逊色于著名品牌。 如今，对于中型甚至大型网络，此选项都具有许多优势。 即：x.86是一个通用平台，其组件可以在几乎任何大城市中购买，并且通常在供应商处有现货。 硬件比Cisco或Juniper的相同模块便宜得多，这使您可以保留它们的备用零件。 您可以通过用更高生产率的硬件替换并购买许可证来升级平台，并将发行的设备用于其他目的。 即 预订问题很容易解决，“按需购买，按需购买”的概念在所有方面都显而易见。 此外，软件解决方案（例如VAS Experts的SCAT DPI）执行许多任务，在使用硬件解决方案时，这些任务必须分别实施。 这是流量缓存，针对DDOS的防护以及完整DPI的其他功能，例如根据FZ-139进行阻止，阻止和替换广告，广播日记以及将数据导出到SORM-3，收集有关流量类型的统计信息以及实现一些其他附加功能的可能性。 服务，例如“儿童的互联网”等 重要的是，国内制造商在软件解决方案市场上有很好的代表，这不仅是他们本国的骄傲，也是俄语支持，对开发人员没有语言障碍。 <br><br>  x.86解决方案的缺点也很明显-首先，这涉及对硬件组件的有效选择。 错误充斥着性能和容错问题。 安装系统（如果制造商不提供此类服务）可能非常简单。 但是，适当的软件提供商应始终在选择硬件以及安装和调试方面提供帮助。 另外，值得注意的是该解决方案应该经过认证，我认为不应出现“为什么”和“为什么”的问题。 <br><br> 总之，对于我来说，选择是显而易见的-NAT和DPI集成在一个盒子中是结合成本，功能，可伸缩性和可维护性要求的最佳解决方案。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN410325/">https://habr.com/ru/post/zh-CN410325/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN410315/index.html">2月23日的礼物创意-Smart Geek Pens</a></li>
<li><a href="../zh-CN410317/index.html">下午或白天天文观测恒星</a></li>
<li><a href="../zh-CN410319/index.html">为什么某些应用程序不使用实际进度条</a></li>
<li><a href="../zh-CN410321/index.html">人的附加组件：授权</a></li>
<li><a href="../zh-CN410323/index.html">如何跨过中级课程并将英语提高到高级</a></li>
<li><a href="../zh-CN410327/index.html">杰夫·贝佐斯（Jeff Bezos）开始安装150米机械表，该表将使用一万年</a></li>
<li><a href="../zh-CN410329/index.html">间谍案件（第1部分）</a></li>
<li><a href="../zh-CN410331/index.html">特朗普政府计划在2024年之后将ISS美国部分私有化</a></li>
<li><a href="../zh-CN410333/index.html">外星人船Oumuamua随机旋转</a></li>
<li><a href="../zh-CN410335/index.html">黑客入侵了AWS上的Tesla实例并在那里开采了加密货币</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>