<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏻 👮 🙏🏾 الطرق المحمية في JavaScript ES5 👩🏿‍🌾 ☠️ 👔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="تمت كتابة الكثير من المقالات الرائعة حول نموذج الكائن في JavaScript. وحول الطرق المختلفة لإنشاء أعضاء صف خاص على الإنترنت مليء بالأوصاف الجديرة بالاهت...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>الطرق المحمية في JavaScript ES5</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425521/" style=";text-align:right;direction:rtl">  تمت كتابة الكثير من المقالات الرائعة حول نموذج الكائن في JavaScript.  وحول الطرق المختلفة لإنشاء أعضاء صف خاص على الإنترنت مليء بالأوصاف الجديرة بالاهتمام.  ولكن حول الأساليب المحمية - هناك القليل من البيانات.  أود أن أسد هذه الفجوة وأخبر كيف يمكنك إنشاء طرق محمية بدون مكتبات في JavaScript ECMAScript 5 فقط. <br><br>  في هذه المقالة: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لماذا هناك حاجة لأعضاء الفئة المحمية</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ما تحتاجه لفهم الطريقة المقدمة</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مساعد فئة المحميين خطأ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تنفيذ الأعضاء المحميين (الأساليب والخصائص) للفئات المعلنة كوظائف (ECMAScript 5)</a> </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">رابط إلى مستودع git-hub مع شفرة المصدر والاختبارات.</a> <a name="habracut"></a><br><br><h2 style=";text-align:right;direction:rtl">  لماذا هناك حاجة لأعضاء الفئة المحمية </h2><br>  باختصار ، إذن <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  من الأسهل فهم عمل الفصل والعثور على الأخطاء فيه.  (يمكنك أن ترى على الفور في الحالات التي يتم فيها استخدام أعضاء الفصل. إذا كانت خاصة ، فأنت بحاجة إلى تحليل هذه الفئة فقط ، جيدًا ، وإذا كانت محمية ، فعندئذ فقط هذه الفئات والفئات المشتقة منها.) </li><li style=";text-align:right;direction:rtl">  أسهل لإدارة التغيير.  (على سبيل المثال ، يمكنك إزالة أعضاء من القطاع الخاص دون خوف من كسر شيء ما خارج الفصل القابل للتحرير.) </li><li style=";text-align:right;direction:rtl"> يتم تقليل عدد التطبيقات في تعقب الأخطاء ، لأن  يمكن لمستخدمي المكتبة أو التحكم "خياطة" الأعضاء "الخاصين" ، والذي قررنا إزالته في الإصدار الجديد من الفصل ، أو تغيير منطق عملهم. </li><li style=";text-align:right;direction:rtl">  وبشكل عام ، يعد أعضاء الفئة المحمية أداة تصميم.  من الجيد أن يكون في متناول اليد واختبار جيد. </li></ul><br>  دعني أذكرك بأن الفكرة الرئيسية للأعضاء المحميين هي إخفاء الأساليب والخصائص عن مستخدمي مثيل الفصل ، ولكن في نفس الوقت السماح للفصول المشتقة بالوصول إليها. <br><br>  لن يسمح استخدام TypeScript باستدعاء الأساليب المحمية ، ومع ذلك ، بعد التجميع في JavaScript ، يصبح جميع الأعضاء الخاصين والمحميين عامين.  على سبيل المثال ، نقوم بتطوير عنصر تحكم أو مكتبة يقوم المستخدمون بتثبيتها على مواقعهم أو تطبيقاتهم.  سيكون هؤلاء المستخدمون قادرين على فعل ما يريدون مع الأعضاء المحميين ، منتهكين سلامة الفصل.  نتيجة لذلك ، تعقّب أداة تتبع الأخطاء لدينا شكاوى من أن مكتبتنا أو عنصر التحكم لدينا لا يعمل بشكل صحيح.  نحن نقضي الوقت والجهد لفرزها - <i>"هل هذه هي الطريقة التي كان بها الكائن في حالة العميل ، مما أدى إلى حدوث خطأ؟!"</i>  .  لذلك ، من أجل تسهيل الحياة على الجميع ، هناك حاجة إلى هذه الحماية التي لن تجعل من الممكن تغيير معنى أفراد الطبقة الخاصة والمحمية. <br><br><h2 style=";text-align:right;direction:rtl">  ما تحتاجه لفهم الطريقة المعنية </h2><br>  لفهم طريقة إعلان أعضاء الصف المحميين ، تحتاج إلى معرفة قوية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  فئات الجهاز والكائنات في JavaScript. </li><li style=";text-align:right;direction:rtl">  طرق لإنشاء أعضاء الصف الخاص (على الأقل من خلال الإغلاق). </li><li style=";text-align:right;direction:rtl">  الأساليب Object.defineProperty و Object.getOwnPropertyDescriptor </li></ul><br>  حول طراز الجهاز في JavaScript ، يمكنني أن أوصي ، على سبيل المثال ، بمقالة ممتازة كتبها Andrey Akinshin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">DreamWalker</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"فهم OOP في JS [الجزء رقم 1]"</a> . <br>  فيما يتعلق بالممتلكات الخاصة ، هناك وصف جيد ، وفي رأيي ، كامل إلى حد ما <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لما يصل إلى 4 طرق مختلفة لإنشاء أعضاء فئة خاصة</a> على موقع MDN. <br><br>  بالنسبة لأسلوب Object.defineProperty ، سيسمح لنا بإخفاء الخصائص والأساليب من الحلقات for-in ، ونتيجة لذلك ، من خوارزميات التسلسل: <br><br><pre style=";text-align:right;direction:rtl"><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(MyClass.prototype, <span class="hljs-string"><span class="hljs-string">'protectedNumber'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.publicNumber = <span class="hljs-number"><span class="hljs-number">25</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyClass(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> obj1){ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'property:'</span></span> prop); <span class="hljs-comment"><span class="hljs-comment">//prop     'protectedNumber' } console.log(JSON.stringify(obj1)); //  { 'publicNumber': 25 }</span></span></code> </pre> <br>  يجب أن يتم هذا الإخفاء ، ولكن هذا ، بالطبع ، لا يكفي لأنه  لا تزال هناك إمكانية لاستدعاء الطريقة / الخاصية مباشرة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj1.protectedNumber); <span class="hljs-comment"><span class="hljs-comment">//  12.</span></span></code> </pre><br><h2 style=";text-align:right;direction:rtl">  مساعد فئة المحميين خطأ </h2><br>  أولاً ، نحتاج إلى فئة ProtectedError ، التي ترث من الخطأ ، والتي سيتم طرحها إذا لم يكن هناك وصول إلى الطريقة أو الملكية المحمية. <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProtectedError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message = <span class="hljs-string"><span class="hljs-string">"Encapsulation error, the object member you are trying to address is protected."</span></span>; } ProtectedError.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(); ProtectedError.prototype.constructor = ProtectedError;</code> </pre><br><h2 style=";text-align:right;direction:rtl">  تنفيذ أعضاء الفئة المحمية في ES5 </h2><br>  الآن بعد أن أصبح لدينا فئة ProtectedError ونفهم ما يفعله Object.defineProperty بالقيمة التي يمكن عدها: خطأ ، دعنا نحلل إنشاء فئة أساسية تريد مشاركة طريقة المحمية مع جميع فئاتها المشتقة ، ولكن نخفيها عن أي شخص آخر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ,        /** @summary       */ function checkAccess() { if (!(this instanceof BaseClass)) throw new ProtectedError(); if (this.constructor === BaseClass) throw new ProtectedError() } Object.defineProperty(_self, 'protectedMethod', { enumerable: false, //    for-in  configurable:false, //     value: function(){ //   , ,          Base,     checkAccess.call(this); //  . protectedMethod(); } }); function protectedMethod(){ //       , //       this,   _self return 'example value'; } this.method = function (){ protectedMethod(); //          BaseClass //this.protectedMethod(); //   , ..      ProtectedError } }</span></span></code> </pre><br><h3 style=";text-align:right;direction:rtl">  وصف مُنشئ فئة BaseClass </h3><br>  ربما ستشوشك الشيكات: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass();</code> </pre>  هذا الاختبار هو "هواة".  يمكنك إزالته ؛ لا علاقة له بالطرق المحمية.  ومع ذلك ، أنا شخصيا أتركه في رمز بلدي ، لأنه  هناك حاجة لتلك الحالات عندما لا يتم إنشاء مثيل الفصل بشكل صحيح ، أي  بدون الكلمة جديدة.  على سبيل المثال ، مثل هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj1 = BaseClass(); <span class="hljs-comment"><span class="hljs-comment">//  : var obj2 = BaseClass.call({});</span></span></code> </pre><br>  في مثل هذه الحالات ، افعل ما يحلو لك.  يمكنك ، على سبيل المثال ، إنشاء خطأ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Wrong instance creation. Maybe operator "new" was forgotten'</span></span>);</code> </pre><br>  أو يمكنك ببساطة إنشاء مثيل بشكل صحيح ، كما هو الحال في BaseClass. <br><br>  بعد ذلك ، نقوم بحفظ المثال الجديد في المتغير _self (لماذا أحتاج إلى شرح ذلك لاحقًا). <br><br><h3 style=";text-align:right;direction:rtl">  وصف الممتلكات العامة المسماة المحمية </h3><br>  عند إدخال الطريقة ، نسمي فحص السياق الذي تم الاتصال به.  من الأفضل أن تقوم بإيداع طريقة منفصلة ، على سبيل المثال ، checkAccess ، لأن  ستكون هناك حاجة إلى نفس الفحص في جميع الأساليب والخصائص المحمية للفئات.  لذا ، بادئ ذي بدء ، تحقق من نوع سياق الاستدعاء لهذا.  إذا كان هذا يحتوي على نوع آخر بخلاف BaseClass ، فلن يكون النوع هو BaseClass نفسه ولا أي من مشتقاته.  نحن نحظر مثل هذه المكالمات. <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BaseClass)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError();</code> </pre><br>  كيف يحدث هذا؟  على سبيل المثال ، مثل هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someObject = {}; b.protectedMethod.call(someObject); <span class="hljs-comment"><span class="hljs-comment">//   ,  protectedMethod this   someObject    , .. someObject instanceof BaseClass  </span></span></code> </pre><br>  في حالة الفئات المشتقة ، سيكون تعبير هذا المثيل لـ BaseClass صحيحًا.  ولكن بالنسبة لمثيلات BaseClass ، سيكون هذا المثال من تعبير BaseClass صحيحًا.  لذلك ، لتمييز مثيلات فئة BaseClass عن مثيلات الفئات المشتقة ، نتحقق من المُنشئ.  إذا كان المُنشئ يطابق BaseClass ، فإن الطريقة المحمية لدينا تسمى مثيل BaseClass ، تمامًا مثل الطريقة العامة العادية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); b.protectedMethod();</code> </pre><br>  نحن نحظر مثل هذه المكالمات: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor === BaseClass) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError();</code> </pre><br>  يأتي بعد ذلك استدعاء طريقة المحمية المغلقة ، والتي ، في الواقع ، هي الطريقة التي نحميها.  داخل الطريقة ، إذا كنت بحاجة إلى الرجوع إلى أعضاء فئة BaseClass ، يمكنك القيام بذلك باستخدام المثيل المخزن لـ _self.  هذا هو بالضبط ما تم إنشاؤه _ نفسي للوصول إلى أعضاء الفصل من جميع الأساليب الخاصة / الخاصة.  لذلك ، إذا كنت لا تحتاج إلى الوصول إلى أعضاء الفئة في طريقتك أو ملكيتك المحمية ، فلا يمكنك إنشاء المتغير _self. <br><br><h3 style=";text-align:right;direction:rtl">  استدعاء طريقة محمية داخل فئة BaseClass </h3><br>  داخل فئة BaseClass ، يجب الوصول إلى ProtectMethod بالاسم فقط ، وليس من خلال ذلك.  خلاف ذلك ، داخل الطريقة المحمية لا يمكننا التمييز بين ما إذا كنا قد تم استدعاؤنا كطريقة عامة أو من داخل فئة.  في هذه الحالة ، ينقذنا الإغلاق - الطريقة المحمية التي تتصرف مثل طريقة خاصة عادية ، مغلقة داخل الفصل ولا تكون مرئية إلا في نطاق وظيفة BaseClass. <br><br><h3 style=";text-align:right;direction:rtl">  وصف فئة DerivedClass المشتقة </h3><br>  الآن دعونا نلقي نظرة على فئة مشتقة وكيفية جعلها في متناول طريقة محمية لفئة أساسية. <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DerivedClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _base = { <span class="hljs-attr"><span class="hljs-attr">protectedMethod</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.protectedMethod.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }; <span class="hljs-comment"><span class="hljs-comment">/** @summary       */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor === DerivedClass) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError(); } <span class="hljs-comment"><span class="hljs-comment">//     Object.defineProperty(this, 'protectedMethod', { enumerable: false, // ..       this configurable: false,//         for-in  //      value: function(){ checkAccess.call(_self); return _base.protectedMethod(); } }); //        this.someMethod = function(){ console.log(_base.protectedMethod()); } } DerivedClass.prototype = new BaseClass(); Object.defineProperty(DerivedClass.prototype, 'constructor', { value : DerivedClass, configurable: false });</span></span></code> </pre><br><h3 style=";text-align:right;direction:rtl">  وصف مُنشئ فئة مشتقة </h3><br>  في الفئة المشتقة ، نقوم بإنشاء كائن _base نضع فيه مرجعًا لطريقة المحمية من الفئة الأساسية ، مغلقًا لسياق الفئة المشتقة من خلال طريقة الربط القياسية.  هذا يعني أن استدعاء _base.protectedMethod ()؛  هذا داخل كائن محمي ليس كائن _base ، بل مثيل لفئة DerivedClass. <br><br><h3 style=";text-align:right;direction:rtl">  وصف طريقة ProtectedMethod داخل DerivedClass </h3><br>  في فئة DerivedClass ، من الضروري التصريح عن الطريقة العامة المحمية في الطريقة نفسها كما فعلنا في الفئة الأساسية عبر Object.defineProperty والتحقق من الوصول إليها عن طريق استدعاء طريقة checkAccess أو عن طريق التحقق مباشرة في الطريقة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(DerivedClass.prototype, <span class="hljs-string"><span class="hljs-string">'protectedMethod'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor === DerivedClass) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProtectedError() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _base.protectedMethod(); } });</code> </pre><br>  نتحقق - <i>"ولكن هل تم استدعاؤنا كوسيلة عامة بسيطة؟"</i>  بالنسبة لحالات فئة DerivedClass ، سيكون المُنشئ مساوياً لـ DerivedClass.  إذا كان الأمر كذلك ، فقم بإنشاء خطأ.  خلاف ذلك ، نرسلها إلى الفئة الأساسية وستقوم بالفعل بإجراء جميع الفحوصات الأخرى. <br><br>  لذلك ، في الفئة المشتقة ، لدينا وظيفتان.  تم تعريف واحد عبر Object.defineProperty وهو مطلوب للفئات المشتقة من DerivedClass.  إنه عام وبالتالي لديه شيك يحظر المكالمات العامة.  توجد الطريقة الثانية في كائن _base ، الذي يتم إغلاقه داخل فئة DerivedClass وبالتالي فهو غير مرئي لأي شخص من الخارج ويتم استخدامه للوصول إلى الطريقة المحمية من جميع أساليب DerivedClass. <br><br><h3 style=";text-align:right;direction:rtl">  حماية الملكية </h3><br>  مع الخصائص ، يحدث العمل بشكل مختلف قليلاً.  يتم تعريف الخصائص في BaseClass كالمعتاد من خلال Object.defineProperty ، فقط في المراسلات والمستوطنين تحتاج أولاً إلى إضافة الشيك الخاص بنا ، أي  تحقق من المكالمة <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _protectedProperty; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _protectedProperty; }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); _protectedProperty = value; }, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); }</code> </pre><br>  داخل فئة BaseClass ، لا يتم الوصول إلى الخاصية المحمية من خلال هذا ، ولكن إلى المتغير المغلق _protectedProperty.  إذا كان من المهم بالنسبة لنا أن يعمل كل من getter و setter عند استخدام الخاصية داخل فئة BaseClass ، فإننا نحتاج إلى إنشاء طرق خاصة getProtectedPropety و setProtectedProperty ، حيث لن تكون هناك عمليات تحقق ، ويجب أن يتم استدعاؤهم بالفعل. <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _protectedProperty; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getProtectedProperty(); }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ checkAccess.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); setProtectedProperty(value); }, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProtectedProperty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    return _protectedProperty; } function setProtectedProperty(value){ //    _protectedProperty = value; } }</span></span></code> </pre><br>  في الفئات المشتقة ، يكون العمل مع الخصائص أكثر تعقيدًا ، لأن  لا يمكن استبدال الخاصية بالسياق.  لذلك ، سوف نستخدم طريقة Object.getOwnPropertyDescriptor القياسية للحصول على getter و setter من خاصية الفئة الأساسية كوظائف يمكن استخدامها بالفعل لتغيير سياق المكالمة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DerivedClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _base = { <span class="hljs-attr"><span class="hljs-attr">protectedMethod</span></span>: _self.protectedMethod.bind(_self), }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _baseProtectedPropertyDescriptor = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(_self, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      _base //    DerivedClass     Object.defineProperty(_base, 'protectedProperty', { get: function() { return _baseProtectedPropertyDescriptor.get.call(_self); }, set: function(value){ _baseProtectedPropertyDescriptor.set.call(_self, value); } }) //      ,      DerivedClass      . Object.defineProperty(_self, 'protectedProperty', { get: function () { checkAccess.call(_self); return base.protectedProperty; }, set: function (value) { checkAccess.call(_self); _base.protectedProperty = value; }, enumerable: false, configurable: false }); }</span></span></code> </pre><br><h3 style=";text-align:right;direction:rtl">  وصف الميراث </h3><br>  وآخر شيء أود التعليق عليه هو ميراث DerivedClass من BaseClass.  كما تعلم ، DerivedClass.prototype = new BaseClass ()؛  لا يخلق نموذجًا أوليًا فحسب ، بل يعيد أيضًا كتابة خاصية المُنشئ.  وبسبب هذا ، لكل مثيل من DerivedClass ، تصبح خاصية المُنشئ مساوية لـ BaseClass.  لإصلاح ذلك ، عادةً بعد إنشاء نموذج أولي ، أعد كتابة خاصية المُنشئ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">DerivedClass.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); DerivedClass.prototype.constructor = DerivedClass;</code> </pre><br>  ومع ذلك ، حتى لا يعيد أحد كتابة هذه الخاصية بعدنا ، فإننا نستخدم نفس Object.defineProperty.  الخاصية القابلة للتكوين: خطأ خاصية يمنع تجاوز الخاصية مرة أخرى: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">DerivedClass.prototype = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseClass(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(DerivedClass.prototype, <span class="hljs-string"><span class="hljs-string">'constructor'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">value</span></span> : DerivedClass, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> });</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar425521/">https://habr.com/ru/post/ar425521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar425505/index.html">تحليل عملية التمهيد لينكس نواة</a></li>
<li><a href="../ar425507/index.html">Parsim Wikipedia لمهام البرمجة اللغوية العصبية في 4 فرق</a></li>
<li><a href="../ar425511/index.html">ميزات غير واضحة لتطبيق Rotativa لتوليد PDF في تطبيق ASP.NET MVC</a></li>
<li><a href="../ar425515/index.html">تحظر Apple الإصلاح المستقل لنماذج MacBook الجديدة</a></li>
<li><a href="../ar425517/index.html">كيف أنشأت Yandex توقعات هطول الأمطار العالمية باستخدام الرادارات والأقمار الصناعية</a></li>
<li><a href="../ar425525/index.html">يذهب تيم بيرنرز لي في مسار الحرب: "خطوة صغيرة للويب ..."</a></li>
<li><a href="../ar425527/index.html">القوائم في Kotlin. نهج هاسكل</a></li>
<li><a href="../ar425529/index.html">Sans Forgetica: خط يتيح لك حفظ ما تقرأه بشكل أفضل قليلاً</a></li>
<li><a href="../ar425531/index.html">تبريد الفرامل السائلة. خيارات تطوير النظام</a></li>
<li><a href="../ar425533/index.html">كيفية العمل في السحابة: من التحقق من موثوقية مركز البيانات إلى إدارة البنية التحتية الافتراضية</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>