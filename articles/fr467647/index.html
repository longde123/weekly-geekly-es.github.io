<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèæ üìñ ü§† Ne pas charger - ne pas tester: comment nous avons identifi√© les probl√®mes avec le syst√®me de gestion de documents VTB üí® ‚ôæ üë©üèΩ‚Äçü§ù‚Äçüë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, VTB a modifi√© certains composants mat√©riels et logiciels du syst√®me de workflow. Les changements √©taient trop importants pour continuer √† f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ne pas charger - ne pas tester: comment nous avons identifi√© les probl√®mes avec le syst√®me de gestion de documents VTB</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vtb/blog/467647/">  R√©cemment, VTB a modifi√© certains composants mat√©riels et logiciels du syst√®me de workflow.  Les changements √©taient trop importants pour continuer √† fonctionner sans test de charge √† grande √©chelle: tout probl√®me avec le syst√®me de support de documents (LMS) est lourd de pertes. <br><br><img src="https://habrastorage.org/webt/yc/vo/e5/ycvoe5se_fq1pfmmaumbgodslew.jpeg"><br><br>  Les sp√©cialistes d'Intertrust ont test√© VTB SDO sur les √©quipements Huawei - un complexe de batterie de serveurs, de r√©seau de donn√©es et de stockage bas√© sur des disques SSD.  Pour les tests, nous avons cr√©√© un environnement qui reproduit des sc√©narios r√©els avec la charge maximale possible.  R√©sultats et conclusions - sous la coupe. <br><a name="habracut"></a><br><h2>  Pourquoi avons-nous besoin d'un syst√®me de workflow dans une banque et pourquoi le tester </h2><br>  LMS dans VTB est un progiciel complexe sur lequel tous les processus de gestion cl√©s sont li√©s.  Le syst√®me fournit des services de documentation g√©n√©rale, d'interaction √©lectronique et d'analyse.  Une circulation bien organis√©e des documents acc√©l√®re les d√©cisions de gestion, rend la proc√©dure d'adoption transparente et contr√¥l√©e, am√©liore la qualit√© de la gestion et renforce la comp√©titivit√© de la banque. <br><br>  Le LMS devrait assurer une mise en ≈ìuvre claire des d√©cisions conform√©ment aux r√©glementations √©tablies.  Cela n√©cessite des performances √©lev√©es, une tol√©rance aux pannes, une mise √† l'√©chelle flexible.  Le syst√®me a des exigences √©lev√©es en mati√®re de contr√¥le d'acc√®s, de volume de documents trait√©s simultan√©ment et de nombre d'utilisateurs.  Maintenant, il y en a 65 000 dans VTB SDO, et ce nombre continue de cro√Ætre. <br><br>  Le syst√®me √©volue constamment: l'architecture change, les technologies obsol√®tes sont remplac√©es par des technologies modernes.  Et r√©cemment, certains composants du syst√®me ont √©t√© remplac√©s par des composants ind√©pendants de l'importation, sans logiciel propri√©taire.  La nouvelle architecture SDO bas√©e sur le logiciel CompanyMedia et le complexe mat√©riel Huawei supportera-t-elle l'augmentation de la charge?  R√©pondre sans ambigu√Øt√© √† cette question, sans attendre une situation similaire dans la r√©alit√©, cela n'a √©t√© possible qu'avec l'aide de tests de r√©sistance. <br><br>  En plus de tester le nouveau produit logiciel pour la r√©sistance au stress, nous avons eu les t√¢ches suivantes: <br><br><ul><li>  d√©terminer les param√®tres exacts de dimensionnement horizontal et vertical des serveurs pour le profil de charge de la banque; <br></li><li>  v√©rifier la tol√©rance de panne des composants dans des conditions de charge √©lev√©e; <br></li><li>  pour identifier le coefficient d'entropie de l'interaction intercluster avec mise √† l'√©chelle horizontale; <br></li><li>  essayez de mettre √† l'√©chelle les demandes de lecture lorsque vous utilisez l'√©quilibreur de plateforme; <br></li><li>  d√©terminer le coefficient de mise √† l'√©chelle horizontale de tous les n≈ìuds et composants du syst√®me; <br></li><li>  d√©terminer les param√®tres mat√©riels maximaux possibles des serveurs √† diverses fins fonctionnelles (mise √† l'√©chelle verticale); <br></li><li>  d'√©tudier le profil de charge de l'application sur l'infrastructure technique, d'approximer les r√©sultats pour planifier le d√©veloppement du syst√®me d'information; <br></li><li>  √âtudiez l'impact de la consolidation des donn√©es d'application sur un seul syst√®me de stockage de donn√©es sur l'optimisation des ressources, l'am√©lioration de la fiabilit√© et des performances. <br></li></ul><br><h2>  M√©thodologie et √©quipement </h2><br>  Les tests de charge des syst√®mes de gestion √©lectronique de documents sont souvent effectu√©s selon des sc√©narios simplifi√©s.  Ils simulent la recherche et l'ouverture rapides de fiches de documents qui ne sont pas associ√©es √† d'autres fichiers et n'ont pas d'historique de cycle de vie.  Dans ce cas, en r√®gle g√©n√©rale, personne ne prend en compte les droits d'acc√®s et les autres facteurs consommateurs de ressources caract√©ristiques des conditions r√©elles. <br><br>  Souvent, ces tests divorc√©s sont effectu√©s par des fournisseurs de solutions.  C'est compr√©hensible: il est important pour un fournisseur de d√©montrer √† un client potentiel les hautes performances et la vitesse du syst√®me.  Il n'est pas surprenant que les mod√®les de test simplifi√©s affichent des temps de r√©ponse record du syst√®me, m√™me si le nombre d'utilisateurs et de documents augmente consid√©rablement. <br><br>  Nous devions reproduire les conditions r√©elles de fonctionnement.  Par cons√©quent, au d√©but, nous avons collect√© des statistiques pendant un mois: nous avons enregistr√© l'activit√© des utilisateurs, regard√© le travail de fond de tous les services.  Les syst√®mes de surveillance int√©gr√©s dans le LMS sont devenus d'une grande aide √† cet √©gard.  Les employ√©s de la banque ont aid√© √† corriger les donn√©es r√©sultantes sur les flux de documents, tandis que nous avons ajust√© la croissance projet√©e des flux. <br><br>  Le r√©sultat a √©t√© une m√©thodologie de test, √† l'aide de laquelle il a √©t√© possible de simuler les processus se produisant dans le syst√®me, en tenant compte de toutes les charges r√©elles.  Au banc d'essai, nous avons reproduit - individuellement et dans diverses combinaisons - les op√©rations commerciales les plus courantes, ainsi que les demandes les plus longues.  Lors des tests de performance, tous les composants ont √©t√© soumis √† des contraintes.  Des op√©rations ont √©t√© effectu√©es pour calculer les droits d'acc√®s des utilisateurs aux objets syst√®me, ouvrir des documents avec une hi√©rarchie ramifi√©e complexe et un grand nombre de liens, rechercher le syst√®me, etc. <br><br><h3>  Profil de test de charge: </h3><br><ul><li>  utilisateurs enregistr√©s: 65 000 avec une augmentation jusqu'√† 150 000; <br></li><li>  fr√©quence des connexions des utilisateurs (authentifications): 50 000 par heure; <br></li><li>  utilisateurs travaillant simultan√©ment dans le syst√®me: 10 000; <br></li><li>  documents enregistr√©s: 10 millions par an; <br></li><li>  volume de pi√®ces jointes: 1 To par an; <br></li><li>  processus d'approbation des documents: 1,5 million par an; <br></li><li>  visas des parties √† l'accord: 7,5 millions par an; <br></li><li>  r√©solutions et instructions: 15 millions par an; <br></li><li>  rapports sur les r√©solutions et instructions: 15 millions par an; <br></li><li>  t√¢ches utilisateur: 18 millions par an. <br></li></ul><br>  Ces applications ont √©t√© consolid√©es sur un seul syst√®me de stockage Huawei OceanStor Dorado 6000 V3 avec 117 disques SSD de 3,6 To chacun, le volume total utilisable est sup√©rieur √† 300 To.  La puissance de calcul a √©t√© plac√©e sur le syst√®me de serveur modulaire de Huawei E9000, et les donn√©es ont √©t√© transmises sur le r√©seau en fonction des commutateurs du niveau du centre de donn√©es de la s√©rie Huawei CE.  Pendant le test, nous avons observ√© 24 heures sur 24 tous les indicateurs du syst√®me.  Tous les r√©sultats, y compris les donn√©es historiques, ont √©t√© enregistr√©s sous forme de graphiques et de tableaux pour une analyse ult√©rieure. <br><br><h3>  Serveurs d'infrastructure mat√©rielle de test de charge </h3><br><br><img src="https://habrastorage.org/webt/_e/2s/jw/_e2sjwzdxhukjiw-glhk_vj3j98.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b4/1e0/a74/9b41e0a74f08b980c948037de04d525a.png"><br><br>  En raison des performances √©lev√©es du syst√®me de stockage Huawei OceanStor Dorado 6000 V3, les retards lors de l'ex√©cution des demandes des utilisateurs d√©passent rarement 1 ms.  Cette vitesse du sous-syst√®me de disque de l‚Äôapplication nous a incit√©s √† poursuivre nos recherches.  Nous avons d√©cid√©, en analysant les donn√©es historiques, de d√©terminer l'effet de diff√©rents types de charges de travail sur l'infrastructure technique.  Les r√©sultats obtenus nous permettent de planifier de mani√®re flexible et pr√©cise le d√©veloppement du syst√®me conform√©ment aux exigences de la plate-forme mat√©rielle. <br><br><h3>  En termes de mise √† l'√©chelle, nous avons v√©rifi√©: </h3><br><ul><li>  limite de mise √† l'√©chelle verticale du <b>serveur d'applications (CMJ)</b> , ressources de criticit√©: nombre de c≈ìurs et fr√©quence, quantit√© de RAM; <br></li><li>  prise en charge de la mise √† l'√©chelle horizontale du <b>serveur d'applications (CMJ)</b> en dupliquant des services fonctionnellement identiques et en les √©quilibrant entre eux; <br></li><li>  limites de la mise √† l'√©chelle verticale et horizontale du <b>serveur client (Web-GUI)</b> ; <br></li><li>  limites de la mise √† l'√©chelle verticale du <b>stockage</b> de <b>fichiers (FS)</b> , ressources de criticit√©: bande passante r√©seau, vitesse du disque; <br></li><li>  prise en charge de la mise √† l'√©chelle horizontale du <b>stockage</b> de <b>fichiers (FS) en</b> raison du syst√®me de fichiers distribu√© - CEPH, GLUSTERFS; <br></li><li>  limites de la mise √† l'√©chelle verticale de <b>la base de donn√©es (PostgreSQL)</b> , ressources selon le degr√© de criticit√©: capacit√© RAM, vitesse du disque, nombre de c≈ìurs et fr√©quence; <br></li><li>  prise en charge de la mise √† l'√©chelle horizontale de la <b>base de donn√©es (PostgreSQL)</b> : mise √† l'√©chelle de la charge de lecture sur les serveurs esclaves, mise √† l'√©chelle de la charge d'√©criture sur le principe de la division en modules fonctionnels; <br></li><li>  limites de la mise √† l'√©chelle verticale et horizontale du <b>courtier de messages (Apache Artemis)</b> ; <br></li><li>  limites de la mise √† l'√©chelle verticale et horizontale du <b>serveur de recherche (Apache Solr)</b> . <br></li></ul><br><h2>  Probl√®mes et solutions </h2><br>  L'une des principales t√¢ches consistait √† identifier d'√©ventuels probl√®mes de performances du LMS.  Au cours des travaux, les goulots d'√©tranglement suivants ont √©t√© identifi√©s et des moyens de les r√©soudre ont √©t√© trouv√©s. <br><br>  <b>Verrouille la journalisation synchrone.</b>  Les op√©rations de journalisation dans la configuration WildFly standard sont effectu√©es de mani√®re synchrone et affectent consid√©rablement les performances.  Il a √©t√© d√©cid√© de passer √† un enregistreur asynchrone et d'√©crire en m√™me temps non pas sur un disque, mais sur le syst√®me d'agr√©gation de journaux ELK. <br><br>  <b>Initialisation de sessions inutiles lors de l'utilisation d'un entrep√¥t de donn√©es.</b>  Chaque thread qui a re√ßu des donn√©es du r√©f√©rentiel a initialis√© deux fois une session pour l'authentification en mode SSO.  Cette op√©ration est gourmande en ressources et augmente consid√©rablement le temps d'ex√©cution de la demande de l'utilisateur, et r√©duit √©galement le d√©bit global du serveur. <br><br>  <b>Se verrouille lorsque vous travaillez avec des objets de cache d'application.</b>  L'application a utilis√© des verrous reentrantLock assez lourds (Java 7), ce qui a nui √† la vitesse d'ex√©cution des requ√™tes.  Le type de verrou a √©t√© remplac√© par stampedLock, ce qui a consid√©rablement r√©duit le temps pass√© √† travailler avec les objets de cache. <br><br>  Apr√®s cela, nous avons de nouveau lanc√© des tests de charge pour d√©terminer la dur√©e moyenne des op√©rations typiques dans le syst√®me LMS avec stockage relationnel sur le profil de la banque.  Nous avons obtenu les r√©sultats suivants: <br><br><ul><li>  autorisation de l'utilisateur dans le syst√®me - 400 ms; <br></li><li>  visualiser la progression en moyenne - 2,5 s; <br></li><li>  cr√©ation d'une carte d'enregistrement et de contr√¥le - 1,4 s; <br></li><li>  enregistrement et enregistrement de la carte de contr√¥le - 600 ms; <br></li><li>  cr√©ation d'une r√©solution - 1 p. <br></li></ul><br><h2>  Conclusions </h2><br>  En plus d'identifier les probl√®mes, les tests de r√©sistance ont confirm√© certaines de nos hypoth√®ses. <br><br><ul><li>  Le syst√®me fonctionne beaucoup mieux sur la famille Linux d'OS. <br></li><li>  Les principes d√©clar√©s d'assurer la tol√©rance aux pannes fonctionnent au niveau de chaque composant en mode ¬´chaud¬ª. <br></li><li>  Un composant cl√© - le service de logique m√©tier (acceptation des demandes des utilisateurs) - a une mise √† l'√©chelle horizontale ¬´miroir¬ª et une mise √† l'√©chelle presque lin√©aire du d√©bit avec une augmentation du nombre d'instances. <br></li><li>  Dimensionnement optimal du service de logique m√©tier pour 1 200 utilisateurs simultan√©s - 8 vCPU pour le service et 1,5 vCPU pour le SGBD. <br></li><li>  La consolidation des donn√©es d'application sur un seul syst√®me de stockage augmente consid√©rablement la productivit√© et la fiabilit√©, augmente l'√©volutivit√©. <br></li></ul><br>  Nous serons heureux de r√©pondre √† vos questions dans les commentaires - peut-√™tre souhaitez-vous en savoir plus sur certains aspects des tests. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467647/">https://habr.com/ru/post/fr467647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467629/index.html">Le livre ¬´R√©alit√© irr√©elle. Parcourir la boucle quantique ¬ª</a></li>
<li><a href="../fr467631/index.html">Vues de contexte JavaScript</a></li>
<li><a href="../fr467633/index.html">P√©tition: D√©claration et paiement automatiques des imp√¥ts sur les revenus de FLP (Ukraine)</a></li>
<li><a href="../fr467639/index.html">Semaine de la s√©curit√© 38: suivi des appareils mobiles via une carte SIM</a></li>
<li><a href="../fr467645/index.html">Suite au Meetup Angular # 15</a></li>
<li><a href="../fr467653/index.html">Habrastatistique: analyse des commentaires des lecteurs</a></li>
<li><a href="../fr467655/index.html">Comment j'ai pass√© l'√©t√© avec C # 8</a></li>
<li><a href="../fr467657/index.html">Inventaire de I √† Z. Nous comptons les licences logicielles</a></li>
<li><a href="../fr467659/index.html">Acc√©l√®re consid√©rablement l'ex√©cution des t√¢ches gr√¢ce √† l'exemple de configuration suppl√©mentaire de la m√©moire HyperX FURY DDR4 mise √† jour</a></li>
<li><a href="../fr467661/index.html">Dosim√®tre pour Seryozha. Partie I. Polimaster - Chasseurs de nucl√©ides</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>