<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖüèª ‚ú≥Ô∏è üï∏Ô∏è Bot pour surveiller les services Web en une demi-heure: t√©l√©gramme + bash + cron ü§æüèª üöµüèΩ üßïüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parfois, vous devez effectuer rapidement une surveillance pour un nouveau service, mais il n'y a aucune infrastructure / expertise pr√™te √† l'emploi. D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot pour surveiller les services Web en une demi-heure: t√©l√©gramme + bash + cron</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483318/"><img src="https://habrastorage.org/webt/ks/-r/l9/ks-rl9jvsn3vka3r5kxkj4jvbxg.jpeg"><br><br>  Parfois, vous devez effectuer rapidement une surveillance pour un nouveau service, mais il n'y a aucune infrastructure / expertise pr√™te √† l'emploi.  Dans ce guide, dans une demi-heure, nous mettrons en ≈ìuvre un outil pour surveiller tous les services Web en utilisant uniquement les outils Ubuntu int√©gr√©s: bash, cron et curl.  Nous utiliserons le t√©l√©gramme pour envoyer des alertes. <br><br>  "Cerise sur le g√¢teau" sera l'implication √©motionnelle des utilisateurs.  Il est v√©rifi√© aupr√®s des gens - cela fonctionne. <br><a name="habracut"></a><br>  Lorsque nous avons cr√©√© un chatbot dans le service de t√©l√©m√©decine Doctor Near pour d√©terminer le niveau de stress des utilisateurs, nous avions besoin d'une surveillance.  En quelques heures, un mini-projet a √©t√© r√©alis√©, qui non seulement fonctionne tr√®s bien, mais ajoute √©galement des commentaires positifs. <br><br>  Pour commencer, obtenez un r√©f√©rentiel avec des scripts: <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rshekhovtsov/msms.git</code> </pre> <br>  Acc√©dez au dossier msms, puis travaillez-y. <br><br>  Si le t√©l√©gramme est bloqu√©, utilisez un proxy.  L'option la plus simple et la plus fiable est le torse: <br><br><pre> <code class="bash hljs">sudo apt install tor sudo apt install torsocks</code> </pre> <br>  Par exemple, nous allons configurer la surveillance de la page de d√©marrage de google.com en trois √©tapes. <br><br><h2>  √âTAPE 1. Cr√©ez un bot dans le t√©l√©gramme et obtenez l'ID utilisateur </h2><br><ul><li>  Dans la cha√Æne de recherche de contacts dans le t√©l√©gramme, recherchez <a href="https://t.me/botfather" rel="nofollow">@botfather</a> : <br><br><img src="https://habrastorage.org/webt/mf/8r/tx/mf8rtxrovcs-4r8ax2pn7fuxusc.png"><br></li><li>  Nous le d√©marrons avec le bouton D√©marrer, saisissons la commande / newbot et r√©pondons aux questions.  Vous devez garder √† l'esprit que le nom est le nom du bot qui sera affich√© pour les utilisateurs, et le nom d'utilisateur est unique et doit se terminer par "bot": <br><br><img src="https://habrastorage.org/webt/gc/q5/fx/gcq5fxjht5xytwso83degwhmslm.png"><br><br>  Entre autres choses, le bot √©mettra un jeton secret pour l'API HTTP, que vous devez copier et enregistrer dans le fichier telegram-api-key.txt dans le dossier msms. <br></li><li>  Nous tapons le nom de notre bot dans la ligne de recherche de t√©l√©gramme et l'ex√©cutons. <br></li><li>  Pour finir, ajoutez-nous √† la liste des destinataires des alertes de surveillance: <br><br><pre> <code class="bash hljs">sudo chmod +x ./recipients-setup.sh torsocks ./recipients-setup.sh</code> </pre> <br>  Le script affichera une liste des appels r√©cents au bot, il devrait y avoir une ligne avec notre identifiant et nom dans le t√©l√©gramme.  Nous prenons cet identifiant et l'enregistrons dans le fichier services / google-destinataires.txt.  Format de fichier: chaque ligne a un identifiant.  Un exemple: <br><br><pre> <code class="bash hljs">123456789 987654321</code> </pre> </li></ul><br>  Pour ajouter un nouveau destinataire, vous devez lui demander de d√©marrer le bot en t√©l√©gramme, d'ex√©cuter destinataires-setup.sh et d'ajouter l'identifiant au fichier. <br><br><h2>  √âTAPE 2. Configurer la surveillance </h2><br>  La description du service se produit en cr√©ant un fichier ini dans le dossier des services.  Cinq param√®tres doivent √™tre d√©finis: <br><br><ol><li>  <b>MSMS_SERVICE_NAME</b> : nom du service - sera utilis√© dans les alertes et les <b>journaux de</b> surveillance. </li><li>  <b>MSMS_SERVICE_ENDPOINT</b> : le point de terminaison du service sur <b>lequel</b> nous contacterons curl. </li><li>  <b>MSMS_CURL_PARAMS</b> : param√®tres de boucle suppl√©mentaires, voir l'exemple ci-dessous. </li><li>  <b>MSMS_EXPECTED</b> : r√©ponse de service attendue.  Utilis√© si la r√©ponse est courte. </li><li>  <b>MSMS_EXPECTED_FILE</b> : nom de fichier avec la r√©ponse de service attendue.  Si sp√©cifi√©, remplace MSMS_EXPECTED. </li><li>  <b>MSMS_RECIPIENTS</b> : fichier avec une liste de destinataires de notification. </li></ol><br>  La demande sur google.com renvoie un html fixe avec une redirection, nous l'utiliserons comme r√©ponse attendue du serveur: <br><br><pre> <code class="bash hljs">curl google.com &gt; services/google-response.html</code> </pre> <br>  Cr√©ez le fichier services / google.ini: <br><br><pre> <code class="bash hljs">MSMS_SERVICE_NAME=<span class="hljs-string"><span class="hljs-string">'google front page'</span></span> <span class="hljs-comment"><span class="hljs-comment"># service endpoint MSMS_SERVICE_ENDPOINT='google.com' # curl parameters MSMS_CURL_PARAMS='-s --connect-timeout 3 -m 7' # expected service response MSMS_EXPECTED_FILE='google-response.html' # recipients list file MSMS_RECIPIENTS='google-recipients.txt'</span></span></code> </pre> <br>  Dans <code>MSMS_CURL_PARAMS</code> vous pouvez sp√©cifier tout ce que la boucle peut faire, y compris: <br><br><ol><li>  D√©sactivez les messages curl pour ne pas obstruer la console et consigner: <code>-s</code> </li><li>  D√©finissez le d√©lai de connexion avec le service en cours de v√©rification (en secondes): <code>--connect-timeout 3</code> </li><li>  D√©finir le d√©lai de r√©ponse: <code>-m 7</code> </li><li>  D√©sactivez la v√©rification des certificats pour SSL (par exemple, si un certificat auto-sign√© est utilis√©): <code>--insecure</code> </li><li>  Sp√©cifiez le type de demande http: <code>-X POST</code> </li><li>  Sp√©cifiez les en-t√™tes: <code>-H "Content-Type: application/json"</code> </li><li>  Sp√©cifiez le corps de la demande sous forme de cha√Æne ou de fichier.  Exemple de fichier: <code>-d @request.json</code> </li></ol><br>  Nous avons d√©sactiv√© les notifications et d√©fini des d√©lais d'expiration de 3 secondes.  √† la connexion et 7 sec.  pour recevoir une r√©ponse du service. <br><br>  <b>Attention</b> : sp√©cifiez les valeurs des param√®tres entre guillemets simples, comme dans l'exemple.  Malheureusement, bash est plut√¥t fragile dans ce sens, et un <s>papillon volant accidentellement au</s> mauvais endroit peut entra√Æner la <s>mort de l'univers avec</s> des erreurs difficiles √† diagnostiquer. <br><br>  Nous avons mis en place un suivi.  V√©rifiez que tout va bien: <br><br><pre> <code class="bash hljs">sudo chmod +x ./monitoring.sh torsocks ./monitoring.sh</code> </pre> <br>  Le script doit afficher un message de la forme: <br><br><pre> <code class="bash hljs">2020-01-10 12:14:31 health-check <span class="hljs-string"><span class="hljs-string">"google front page"</span></span>: OK</code> </pre> <br><h2>  √âTAPE 3. Ajustez l'horaire </h2><br>  Configurer un planning de surveillance dans cron: <br><br><pre> <code class="bash hljs">sudo crontab -e</code> </pre> <br>  Ajoutez une ligne pour v√©rifier google.com toutes les minutes: <br><br><pre> <code class="bash hljs">*/1 * * * * torsocks &lt;   &gt;/monitoring.sh &gt;&gt; &lt;   &gt;/monitoring.log 2&gt;&amp;1</code> </pre> <br>  Ajoutez une alerte tous les jours √† 11h00, confirmant la surveillance elle-m√™me.  Pour ce faire, passez le param√®tre DAILY au script: <br><br><pre> <code class="bash hljs">0 11 * * * torsocks &lt;   &gt;/monitoring.sh DAILY &gt;&gt; &lt;   &gt;/monitoring.log 2&gt;&amp;1</code> </pre><br>  <code>2&gt;&amp;1</code> - technique standard de redirection des erreurs vers le flux de sortie principal.  En cons√©quence, ils seront √©galement inclus dans le journal de surveillance. <br><br>  Enregistrez les modifications et rattrapez-les avec la commande: <br><br><pre> <code class="bash hljs"> sudo service cron reload</code> </pre> <br>  Vous pouvez en savoir plus sur la configuration de cron, par exemple, <a href="https://losst.ru/nastrojka-cron" rel="nofollow">ici</a> . <br><br>  Ainsi, chaque minute, un script de surveillance sera lanc√©, qui sera accessible via gol sur google.com.  Si la r√©ponse re√ßue diff√®re de la r√©ponse attendue, le script enverra une notification dans le t√©l√©gramme √† la liste des destinataires.  Le journal d'audit est conserv√© dans le fichier monitoring.log <br><br>  Si vous avez besoin d'ajouter un autre service, nous cr√©ons simplement un nouveau fichier ini pour lui dans le dossier des services et, si n√©cessaire, cr√©ons une liste s√©par√©e de destinataires.  Tout le reste fonctionnera automatiquement. <br><br>  Si le service v√©rifi√© est devenu indisponible, une alerte sera envoy√©e toutes les minutes.  Si vous ne pouvez pas restaurer rapidement le service, vous pouvez d√©sactiver temporairement les notifications dans les propri√©t√©s du bot dans le t√©l√©gramme. <br><br>  Examinons maintenant de plus pr√®s les fonctionnalit√©s suppl√©mentaires et la mise en ≈ìuvre des scripts. <br><br><h2>  Mod√®les de messages et engagement √©motionnel </h2><br>  Pour rendre la communication avec le bot plus vivante, nous l'avons appel√© Manechka, ajout√© l'avatar d'image correspondant et engag√© des sp√©cialistes des relations publiques pour cr√©er des textes de message.  Vous pouvez utiliser nos r√©alisations ou changer √† votre go√ªt. <br><br>  Par exemple, comme ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zs/kk/nd/zskkndbpynjm9l-o2ujyvblznlw.jpeg"></div><br>  ou m√™me ainsi: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ul/nh/e3/ulnhe3lg9gypwy56x53sk-kuegm.png"></div><br>  Pourquoi pas? <br><br>  Le nom du robot et l'avatar sont d√©finis via <a href="https://t.me/botfather" rel="nofollow">@botfather</a> . <br>  Les mod√®les de message se trouvent dans le dossier des <b>mod√®les</b> : <br><br><ul><li>  <b>curl-fail.txt</b> : message envoy√© lorsque curl a renvoy√© un code d'erreur diff√©rent de z√©ro.  Parle g√©n√©ralement de l'impossibilit√© de tendre la main au service. </li><li>  <b>daily.txt</b> : message quotidien confirmant que la surveillance du service fonctionne. </li><li>  <b>service-fail.txt</b> : message envoy√© lorsque la r√©ponse du service est diff√©rente de celle attendue. </li></ul><br>  Examinons les possibilit√©s de personnalisation √† l'aide de l'exemple de mod√®les de messages int√©gr√©s. <br>  Les mod√®les utilisent des emojis.  Malheureusement, habr ne les affiche pas. <br>  Pour s√©lectionner les emojis, il est pratique d'utiliser la recherche sur <a href="https://emojipedia.org/" rel="nofollow">emojipedia.org</a> : <br><br><img src="https://habrastorage.org/webt/wj/uy/_3/wjuy_3icssro1d0hpptoe5xq91e.jpeg"><br><br>  Vous copiez et collez simplement le caract√®re appropri√© dans le texte du mod√®le (c'est l'unicode habituel). <br><ol><li>  curl-fail.txt: <br><br><pre> <code class="bash hljs">,  ...      \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" \`CURL EXIT CODE: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXIT_CODE</span></span></span><span class="hljs-string">\`</span></span></code> </pre> <br>  Nous avons utilis√© le nom de service que nous avons sp√©cifi√© (variable <code>MSMS_SERVICE_NAME</code> ) et une variable de script interne avec le code de terminaison curl ( <code>EXIT_CODE</code> ).  Nous avons √©galement format√© le message en utilisant le balisage du <a href="https://core.telegram.org/bots/api" rel="nofollow">t√©l√©gramme</a> : les caract√®res `` '' encadrent le texte d'une largeur fixe.  Puisque les guillemets et les apostrophes sont des caract√®res bash officiels, nous leur √©chappons avec le caract√®re "\".  Les noms de variables sont pr√©c√©d√©s d'un signe "$". <br><br>  R√©sultat: <br><br><img src="https://habrastorage.org/webt/po/zf/3n/pozf3neoa1bjqxslwqny1ocal2s.jpeg"><br></li><li>  service-fail.txt: <br><br><pre> <code class="bash hljs">,  ...  \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\"     ,     : \`</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$RESPONSE</span></span></span><span class="hljs-string">\`</span></span></code> </pre> <br>  R√©sultat: <br><br><img src="https://habrastorage.org/webt/kv/f1/tl/kvf1tlzbrmm3cqdpf70tnm0m2z4.jpeg"><br><br>  Ici, nous utilisons une autre variable de script: <code>RESPONSE</code> .  Il contient la r√©ponse du service. <br></li><li>  daily.txt: <br><br><pre> <code class="bash hljs">, !    , c  : \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\"  ...     ?</span></span></code> </pre><br>  R√©sultat: <br><br><img src="https://habrastorage.org/webt/qs/ox/r_/qsoxr_bkdi8qva9ms1xzwpxugxa.jpeg"><br></li></ol><br>  Passons √† l'impl√©mentation des scripts. <br><br><h2>  Script de surveillance </h2><br>  <b>monitoring.sh</b> facilite la d√©couverte automatique - prend tous les fichiers ini du dossier services et ex√©cute pour chacun le script principal avec la logique de v√©rification et d'envoi des alertes: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd $(dirname "$0")/services for service_ini in $(ls *.ini); do bash ../msms.sh "$1" "$service_ini" done</span></span></code> </pre> <br>  Pour g√©n√©rer un message quotidien sur l'√©tat de surveillance, le script peut recevoir le param√®tre DAILY. <br><br>  Veuillez noter qu'au d√©marrage du script, le dossier en cours se transforme en services.  Cela permet aux fichiers ini de sp√©cifier les chemins d'acc√®s aux fichiers par rapport aux services. <br><br><h2>  Script pour v√©rifier et envoyer des alertes </h2><br>  <b>msms.sh</b> contient la logique de base de la v√©rification d'un service et de l'envoi d'alertes. <br><br>  Travailler avec un t√©l√©gramme: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># telegram endpoint TG_API_URL="https://api.telegram.org/bot$(cat ../telegram-api-key.txt)/sendMessage" ################################################################# # send message to telegram # parameter: message text ################################################################# function send_message { for chat_id in $(cat ../$MSMS_RECIPIENTS); do curl -s -X POST --connect-timeout 10 $TG_API_URL -d chat_id=$chat_id -d parse_mode="Markdown" -d text="$1" echo done }</span></span></code> </pre><br>  Nous cr√©ons une URL pour acc√©der √† l'API REST du t√©l√©gramme √† l'aide de la cl√© priv√©e stock√©e dans le fichier. <br><br>  La fonction send_message utilise curl pour envoyer des messages √† cette API REST, en prenant l'ID du destinataire dans le fichier que nous avons sp√©cifi√© dans ini.  Dans les donn√©es que nous envoyons, nous indiquons que nous utilisons le balisage de message: <code>parse_mode="Markdown"</code> . <br><br>  Imprimez la date-heure actuelle et chargez le fichier ini. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> $(date <span class="hljs-string"><span class="hljs-string">'+%Y-%m-%d %H:%M:%S'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># load variables from .ini file: . $2</span></span></code> </pre><br>  La ligne magique <code>. $2</code>  <code>. $2</code> ex√©cute le fichier ini transmis en tant que deuxi√®me param√®tre comme un script ordinaire, en entrant les valeurs sp√©cifi√©es dans les variables d'environnement. <br><br>  T√©l√©chargez la r√©ponse attendue √† partir du fichier si le param√®tre <code>MSMS_EXPECTED_FILE</code> est <code>MSMS_EXPECTED_FILE</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_EXPECTED_FILE</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> MSMS_EXPECTED=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(cat "$MSMS_EXPECTED_FILE")</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  Effectuez une v√©rification de service avec l'envoi d'alertes, si n√©cessaire: <br><br><pre> <code class="bash hljs">RESPONSE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval curl $MSMS_CURL_PARAMS \"$MSMS_SERVICE_ENDPOINT\")</span></span></span><span class="hljs-string">"</span></span> EXIT_CODE=$? <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$EXIT_CODE</span></span> != 0 ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> health-check \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" FAILED: CURL EXIT WITH </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXIT_CODE</span></span></span><span class="hljs-string"> MESSAGE="</span></span>$(cat ../templates/curl-fail.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" elif [[ "</span></span><span class="hljs-variable"><span class="hljs-variable">$RESPONSE</span></span><span class="hljs-string"><span class="hljs-string">" != "</span></span><span class="hljs-variable"><span class="hljs-variable">$MSMS_EXPECTED</span></span><span class="hljs-string"><span class="hljs-string">" ]]; then echo health-check \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" FAILED: "</span></span><span class="hljs-variable"><span class="hljs-variable">$RESPONSE</span></span><span class="hljs-string"><span class="hljs-string">" MESSAGE="</span></span>$(cat ../templates/service-fail.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" else echo health-check \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\": OK fi</span></span></code> </pre><br>  D'abord, nous affectons la variable <code>RESPONSE</code> au r√©sultat de la commande curl pour ce service. <br><br>  Expression <code>EXIT_CODE=$?</code>  met le r√©sultat de la derni√®re commande, c'est-√†-dire  boucle.  Si vous devez envoyer une alerte, le mod√®le est lu √† partir du fichier correspondant et l'envoi aux destinataires se <code>send_message</code> aide de <code>send_message</code> . <br><br>  Le dernier bloc traite le param√®tre DAILY: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"DAILY"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> health-check \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" DAILY MESSAGE="</span></span>$(cat ../templates/daily.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" fi</span></span></code> </pre> <br>  Il envoie un message confirmant l'int√©grit√© de la surveillance elle-m√™me. <br><br><h2>  Obtention d'une liste d'ID utilisateur </h2><br>  <b>destinataires-setup.sh</b> appelle l'API de t√©l√©gramme pour obtenir les derniers messages adress√©s au bot: <br><br><pre> <code class="bash hljs">curl -s https://api.telegram.org/bot$(cat telegram-api-key.txt)/getUpdates \ | python recipients-setup.py</code> </pre> <br>  Il utilise la magie de python pour bien lister la sortie.  Ceci est facultatif, vous pouvez simplement prendre l'id souhait√© de json, que la commande affichera: <br><br><pre> <code class="bash hljs">torsocks curl -s https://api.telegram.org/bot$(cat telegram-api-key.txt)/getUpdates</code> </pre> <br><h2>  Conclusion </h2><br>  Ainsi, vous pouvez utiliser des scripts et des mod√®les de message pr√™ts √† l'emploi, en configurant uniquement des services et des listes observables pour les notifications;  Vous pouvez cr√©er une nouvelle "identit√©" pour le bot;  et vous pouvez prendre votre d√©cision sur la base de la proposition. <br><br>  Comme options pour un d√©veloppement ult√©rieur, la configuration et la gestion de la surveillance dans le bot lui-m√™me se sugg√®rent, mais ici, vous ne pouvez pas vous passer de python.  Si quelqu'un met la main sur moi - vous savez o√π t√©l√©charger la demande de pull :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483318/">https://habr.com/ru/post/fr483318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483308/index.html">Exp√©rience VonmoTrade. Partie 4: Tableaux de n√©gociation</a></li>
<li><a href="../fr483310/index.html">Cr√©ez des objectifs pour Snapchat en utilisant pix2pix</a></li>
<li><a href="../fr483312/index.html">La grande th√©orie du flocon de neige</a></li>
<li><a href="../fr483314/index.html">Comment effectuer des actions Redux asynchrones √† l'aide de Redux-Thunk</a></li>
<li><a href="../fr483316/index.html">Pr√©sentation rapide de SwiftUI</a></li>
<li><a href="../fr483320/index.html">Cr√©ation d'un mus√©e m√©di√©val VR</a></li>
<li><a href="../fr483322/index.html">D√©veloppement d'API REST - quelle est l'approche Code First?</a></li>
<li><a href="../fr483324/index.html">Processus flexibles dans l'√©quipe informatique</a></li>
<li><a href="../fr483328/index.html">API REST - Qu'est-ce que HATEOAS?</a></li>
<li><a href="../fr483330/index.html">√Ä propos du fonctionnement d'un PC en utilisant l'exemple de Windows 10 et du clavier, partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>