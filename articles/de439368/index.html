<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïò üëµüèª üöÖ Animationen in iOS-Anwendungen, die auf dem Server geboren wurden üíÖ üì∏ üöó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor sechs Monaten haben wir eine der beeindruckendsten Funktionen von Badoo vorgestellt - das Live-Streaming . Unter anderem k√∂nnen Benutzer ihren Lie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Animationen in iOS-Anwendungen, die auf dem Server geboren wurden</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/439368/"><img src="https://habrastorage.org/webt/px/9h/mg/px9hmgqrpebneeamcitvv8b_wkw.jpeg"><br><br>  Vor sechs Monaten haben wir eine der beeindruckendsten Funktionen von Badoo vorgestellt - das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Live-Streaming</a> .  Unter anderem k√∂nnen Benutzer ihren Lieblings-Streamern in Form von Geschenken ihren Dank aussprechen.  Wir wollten diese Geschenke so hell und attraktiv wie m√∂glich gestalten und beschlossen, sie wiederzubeleben - mit anderen Worten, zu animieren.  Und um es noch interessanter zu machen, wollten wir alle paar Wochen Geschenke und Animationen aktualisieren. <br><br>  iOS-Ingenieure m√ºssen erraten haben, um welches Arbeitsvolumen es sich handelt: Um alte und neue Animationen zu l√∂schen, m√ºssen viele Aktionen auf der Clientseite ausgef√ºhrt werden.  Zu diesem Zweck m√ºssen Android- und iOS-Teams an jeder Version beteiligt sein. Zusammen mit der Zeit, die erforderlich ist, um das Update im App Store zu genehmigen, bedeutet dies, dass der Start jeder Version mit aktualisierten Animationen mehrere Tage dauern kann.  Wir haben es jedoch geschafft, dieses Problem zu l√∂sen, und jetzt werde ich Ihnen sagen, wie. <br><br><h1>  L√∂sungsarchitektur </h1><br>  Zu diesem Zeitpunkt wussten wir bereits, wie man <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Adobe After Effects-Animationen (im Folgenden: AAE) in einem Format exportiert, das unsere iOS-Anwendung</a> mithilfe der Lottie-Bibliothek verstanden hat.  Diesmal gingen wir etwas weiter: Wir beschlossen, alle relevanten Animationen auf dem Server zu speichern und bei Bedarf herunterzuladen. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/wq/tz/6w/wqtz6w0lgzbjm1eq5bvcshngnxw.png"><br><br>  Ein Beispiel f√ºr eine echte Animation in unserer Anwendung, die auf diese Weise erhalten wurde: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pe/3s/qo/pe3sqoahuswtkbfqd4wl-opzv8m.gif" width="250"></div><br><br>  In diesem Beitrag werde ich jedoch als Beispiel eine einfache Animation nehmen, die ich selbst erstellt habe.  Es ist nicht so kreativ wie in Badoo, aber es ist durchaus geeignet, unseren Ansatz zu demonstrieren. <br><br><h1>  Animationen exportieren </h1><br>  Das von mir verwendete AAE-Projekt kann zusammen mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">anderen Quellen auf GitHub gefunden werden</a> .  <code>_raw/animations/Fancy/Fancy.aep</code> Sie das Projekt unter <code>_raw/animations/Fancy/Fancy.aep</code> , wird ein Fenster <code>_raw/animations/Fancy/Fancy.aep</code> : <br><br><img src="https://habrastorage.org/webt/_k/hz/os/_khzosjwwyiiysdwfdon6iqjz10.png"><br><br>  Jetzt spreche ich nicht √ºber das Erstellen von Animationen in AAE, sondern dar√ºber, wie vorhandene Animationen aus AAE mithilfe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bodymovin-</a> Plugins in ein f√ºr eine iOS-Anwendung geeignetes Format importiert werden. <br><br>  √ñffnen Sie das Plugin nach der Installation, indem Sie <i>im Men√º Fenster / Erweiterungen / Bodymovin</i> ausw√§hlen: <br><br><img src="https://habrastorage.org/webt/jq/3d/rw/jq3drw28ghwylkqidrecb78r9p4.png"><br><br>  Das Bodymovin-Fenster wird angezeigt, in dem Sie die zu exportierende Animation, einen Ordner zum Speichern der resultierenden Datei und das √ñffnen der Exporteinstellungen ausw√§hlen k√∂nnen: <br><br><img src="https://habrastorage.org/webt/iy/th/yl/iythylsx8lylzanrfavxmtn7u64.png"><br><br>  In den Animationseinstellungen k√∂nnen wir Bodymovin bitten, Ressourcen in die JSON-Datei aufzunehmen, indem wir <i>Assets / Include in json</i> ausw√§hlen: <br><br><img src="https://habrastorage.org/webt/c8/8v/od/c88vodmi3cksysyvdfg-89qqwby.png"><br><br>  Durch Dr√ºcken der Schaltfl√§che Rendern exportieren wir die ausgew√§hlte animierte Komposition und speichern sie in einer Datei. <br><br><h1>  Speichern von Animationen auf dem Server </h1><br>  Angenommen, wir laden gerenderte animierte JSON-Dateien auf einen Webserver hoch.  In unserem Fall habe ich sie der Einfachheit halber in das Projekt-Repository auf GitHub gestellt.  Animationen finden Sie hier: <br><br><ul><li>  <a href="">Die Wolken</a> </li><li>  <a href="">Feuerwerk</a> </li></ul><br><br>  Basislink <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://raw.githubusercontent.com/chupakabr/server-provided-animations/master/_raw/rendered-animations/</a> <br><br>  Animations-IDs: <br><br><ul><li> <code>clouds.json</code> <br> </li><li> <code>fireworks.json</code> <br> </li></ul><br><br><blockquote>  Hinweis: Suchen Sie einen Swift-Webserver f√ºr Animationen?  Die L√∂sung finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . Eine ausf√ºhrliche Erl√§uterung finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in diesem Artikel</a> . </blockquote><br><br>  Wir haben also einen funktionierenden Server mit Animationen, also ist es Zeit, mit dem aufregendsten Teil fortzufahren: dem Rendern von Animationen auf dem Bildschirm. <br><br><h1>  Animationsanzeige </h1><br>  Jetzt rate ich Ihnen, ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Demo-</a> Projekt f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unsere iOS-Anwendung</a> zu √∂ffnen, da es den gesamten erforderlichen Code und die erforderlichen Einstellungen enth√§lt. <br><br><h2>  Animationen herunterladen </h2><br>  Da die REST-API zum Empfangen von Daten bereits bereit ist, ist es an der Zeit, das Protokoll des Datenanbieters einzuf√ºhren und seine Implementierung hinzuzuf√ºgen, die Daten vom Server herunterl√§dt: <br><br><pre> <code class="plaintext hljs">import Lottie protocol AnimationsProviderProtocol {   typealias Completion = (_ animation: LOTComposition?) -&gt; Void   func loadAnimation(byId id: String, completion: @escaping Completion) } final class ServerAnimationProvider: AnimationsProviderProtocol {   private let endpoint: URL   init(endpoint: URL) {       self.endpoint = endpoint   }   func loadAnimation(byId id: String, completion: @escaping Completion) {       let path = "/\(id).json"       guard let animationUrl = URL(string: path, relativeTo: self.endpoint) else {           completion(nil)           return       }       URLSession.shared.invalidateAndCancel()       let task = URLSession.shared.dataTask(with: animationUrl) { (data, response, error) in           guard error == nil, let data = data, let json = self.parseJson(from: data) else {               completion(nil)               return           }           let animation = LOTComposition(json: json)           completion(animation)       }       task.resume()   }   private func parseJson(from data: Data?) -&gt; [AnyHashable : Any]? {       guard let data = data else { return nil }       do {           let json = try JSONSerialization.jsonObject(with: data, options: []) as? [AnyHashable : Any]           return json       } catch {           return nil       }   } }</code> </pre> <br><br>  Mit dieser Datenproviderklasse k√∂nnen wir auf Anfrage Animationen im JSON-Format vom Server herunterladen und zum Rendern auf der Benutzeroberfl√§che im Speicher speichern.  Angenommen, wir folgen dem MVVM-Muster - dann ist es einfach, es in der <code>ViewModel</code> Entit√§t wie folgt zu verwenden: <br><br><pre> <code class="plaintext hljs"> // ... private let animationProvider: AnimationsProviderProtocol private(set) var animationModel: LOTComposition? // ‚Ä¶ func loadAnimation(byId animationId: String) {     self.animationProvider.loadAnimation(byId: animationId) { [weak self] (animationModel) in         self?.animationModel = animationModel     } } // ...</code> </pre> <br><br>  <code>ViewModel</code> aktualisiert die Eigenschaft der ausgew√§hlten Animation, wenn die richtige HTTP-Antwort von einem Server mit einem nicht leeren JSON-Objekt empfangen wird.  Diese Daten werden von der Pr√§sentationsebene verwendet, um die Animation anzuzeigen. <br><br><h2>  Pr√§sentationsschicht </h2><br>  Jetzt k√∂nnen wir mit dem <code>ViewModel</code> auf die Animationsdaten zugreifen und diese auf der Benutzeroberfl√§che anzeigen, indem wir den integrierten <code>ViewModel</code> , der an die Schaltfl√§che angeh√§ngt ist: <br><br><pre> <code class="plaintext hljs">class ViewController: UIViewController {   // ...   @IBOutlet weak var animationContainer: UIView!   override func viewDidLoad() {       super.viewDidLoad()       // ...       self.animationView = {           let view = LOTAnimationView(frame: self.animationContainer.bounds)           self.animationContainer.addSubview(view)           return view       }()   }   @IBAction func onPlayAnimationAction(_ sender: Any) {       self.animationView.stop()       self.animationView.sceneModel = self.viewModel.animationModel       self.animationView.play()   } }</code> </pre> <br><br>  Wenn Sie auf eine Schaltfl√§che klicken, wird die LOTAnimationView-Instanz mit den neuesten Daten aus dem <code>ViewModel</code> aktualisiert. <br><br>  So sieht es aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rn/3d/qq/rn3dqqo6ueg3tfye-tmh9rlhove.png" width="250"></div><br><br>  Das ist alles.  Jetzt zeigt die Anwendung die von unserer REST-API heruntergeladene Animation an <br>  (vom Server). <br><br><h1>  Tipps &amp; Einschr√§nkungen </h1><br>  Tricks: <br><br><ul><li>  AAE unterst√ºtzt die meisten Objekttypen, einschlie√ülich Raster- und Vektorbilder. </li><li>  Mit Bodymovin k√∂nnen Sie alle Ressourcen mit Base64 in die endg√ºltige JSON-Datei einbetten. Auf diese Weise k√∂nnen Sie vermeiden, Ressourcen auf der Clientseite separat zu laden. </li><li>  Sie k√∂nnen entweder direkt in einem Vektor in AAE zeichnen oder einfach Vektorbilder im Adobe Illustrator-Format importieren. </li></ul><br>  Leider konnte ich keine SVG-Dateien in AAE importieren (ich habe es versucht!). <br><br>  In diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">interessanten Artikel</a> meines Kollegen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Radoslaw Sesiva</a> erfahren Sie mehr √ºber Tricks und das L√∂sen m√∂glicher Probleme. <br><br><h1>  Fazit </h1><br>  Was bringt uns das Herunterladen von Animationen vom Server?  Der offensichtlichste Vorteil dieses Ansatzes ist die M√∂glichkeit, alle Teilnehmer am Animationsaktualisierungsprozess gemeinsam zu nutzen.  Mit anderen Worten, um eine neue coole Animation zu ver√∂ffentlichen, m√ºssen Designer dem Serverteam lediglich die entsprechende JSON-Datei zur Verf√ºgung stellen.  Um die Animation auf dem Client zu entfernen, entfernen Sie sie einfach vom Server.  Einfach und schnell. <br><br>  Es ist auch sehr cool, dass dieselben Funktionen auf allen unterst√ºtzten Plattformen (iOS, Android, Web) implementiert werden k√∂nnen, ohne dass das Client-Server-Protokoll, der Servercode und die Animationsdateien direkt auf dem Client ge√§ndert werden m√ºssen. <br><br>  Das ist alles  Vielen Dank f√ºr Ihre Aufmerksamkeit! <br><hr><br><h3>  N√ºtzliche Links </h3><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hinter den Kulissen beim Importieren von Adobe After Effects-Animationen in die Badoo iOS-App</a> " von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Radoslaw Cieciwa</a> ; </li><li>  <a href="">Bodymovin Plugin f√ºr AAE</a> von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AirbnbEng</a> ; </li><li>  Das gesamte Projekt ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier auf GitHub</a> verf√ºgbar. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Installation des Bodymovin-Plugins f√ºr AAE</a> durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AirbnbEng</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lottie iOS-Bibliothek</a> von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AirbnbEng</a> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">REST API mit Swift on Vapor</a> " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Valery Chevtaev</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ZXP Plugin Installer</a> f√ºr AAE. <br></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439368/">https://habr.com/ru/post/de439368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439358/index.html">Excel-Dateimetadaten</a></li>
<li><a href="../de439360/index.html">Schulung Cisco 200-125 CCNA v3.0. Cisco Certified Network Specialist (CCNA). Tag 3. Subnetze</a></li>
<li><a href="../de439362/index.html">Wie unterrichten wir Software Engineering an der St. Petersburg HSE?</a></li>
<li><a href="../de439364/index.html">Oculus Go-Gl√§ser mit einer Reihe von ‚ÄûErdbeer‚Äú -Inhalten wurden zum Verkauf angeboten</a></li>
<li><a href="../de439366/index.html">Automatisierung von drei N√§geln</a></li>
<li><a href="../de439370/index.html">Vom Server bereitgestellte Animationen in iOS-Apps</a></li>
<li><a href="../de439372/index.html">Willst du einen Detektiv spielen? Finden Sie den Fehler in einer Funktion von Midnight Commander</a></li>
<li><a href="../de439374/index.html">F√ºr diejenigen, die Detektiv spielen m√∂chten: Finden Sie den Fehler in der Funktion von Midnight Commander</a></li>
<li><a href="../de439376/index.html">Interessenclub</a></li>
<li><a href="../de439378/index.html">Buch (des Seins?). Reflexionen √ºber die Natur des Geistes. Teil I.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>