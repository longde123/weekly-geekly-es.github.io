<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö± ü•´ ü•ö Como eu hackeei um provedor de hospedagem ü§±üèº üëêüèº ‚¨ÜÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, comecei a receber uma proposta para verificar a opera√ß√£o de v√°rios servi√ßos em busca de erros e vulnerabilidades. E nessas propostas, te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu hackeei um provedor de hospedagem</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431398/"><img src="https://habrastorage.org/webt/ll/i7/8h/lli78hrfs3wa8mxil9xhv4mux44.gif"><br><br>  Recentemente, comecei a receber uma proposta para verificar a opera√ß√£o de v√°rios servi√ßos em busca de erros e vulnerabilidades.  E nessas propostas, tento trabalhar no resultado e obter o m√°ximo prazer do processo.  Mas o resultado do √∫ltimo "projeto" me chocou para dizer o m√≠nimo. <br><br>  Me pediram para testar o provedor de hospedagem. <br><a name="habracut"></a><br>  N√£o divulgarei o nome.  E na minha hist√≥ria vou usar o nome Hoster.  Com o pr√≥prio site, o servi√ßo de hospedagem era padr√£o.  Ofertas para comprar certificados VDS, dom√≠nios e SSL. <br><br>  Primeiro, fiquei surpreso com a forma como a conta pessoal do usu√°rio foi implementada.  N√£o era necess√°rio comprovar a propriedade do endere√ßo de e-mail durante o registro.  Ou seja, voc√™ pode se registrar com o endere√ßo de e-mail steve.jobs@apple.com.  Ou melhor ainda, support@hoster.com. <br><br>  Felizmente, por√©m, por analogia com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">essa hist√≥ria</a> , a divulga√ß√£o de informa√ß√µes confidenciais da central de suporte de servi√ßos n√£o aconteceu. <br><br>  No entanto, isso aconteceu quando eu criei uma solicita√ß√£o de suporte de teste e verifiquei imediatamente a disponibilidade de solicita√ß√µes de ID vizinhas para outras solicita√ß√µes de suporte.  Surpreendentemente, eles estavam dispon√≠veis.  E foi poss√≠vel observar quem e o que se registra no hoster.  E que problemas os usu√°rios enfrentam?  Em geral, a vulnerabilidade padr√£o do IDOR, que agora n√£o surpreender√° ningu√©m.  Claro, ela foi instantaneamente corrigida. <br><br>  Havia tamb√©m v√°rios lugares com o XSS armazenado.  Havia tamb√©m o Blind XSS que retornou o cookie do administrador de servi√ßos para mim.  Gra√ßas a esse XSS, consegui descobrir onde a interface do administrador est√° localizada e, em geral, revelou muitas informa√ß√µes interessantes. <br><br><ul><li>  Quantos usu√°rios ativos. </li><li>  Quantos dom√≠nios est√£o no controle. </li><li>  Quantos VDS est√£o implantados. </li></ul><br>  E muito mais ... <br><br><img src="https://habrastorage.org/webt/ua/iz/zl/uaizzlxoh7o3eutwvtomg6mfrvu.png"><br><br>  Houve v√°rios erros nos tokens de CSRF, que permitiram, em nome do usu√°rio, fazer muitas coisas perigosas em sua conta.  E se havia lugares onde os tokens de CSRF eram transferidos, eles eram simplesmente transferidos.  Ningu√©m planejou verific√°-los no back-end.  Como resultado das minhas descobertas, parte da funcionalidade foi completamente desativada.  Por exemplo, a autentica√ß√£o 2FA foi decidida como removida temporariamente, pois n√£o ocorreu na implementa√ß√£o. <br><br>  No decorrer do meu trabalho, prestei aten√ß√£o n√£o apenas aos problemas de seguran√ßa, mas tamb√©m aos erros de implementa√ß√£o ou problemas na opera√ß√£o de algumas funcionalidades.  Eu gosto de controle de qualidade n√£o poderia passar assim.  Como resultado, meu rastreador de problemas alcan√ßou a figura 22. Tantos problemas no conjunto que eu encontrei e consertei (extremamente not√°veis). <br><br>  Os resultados foram mais do que convincentes.  E eu j√° planejava concluir este projeto.  Mas, por alguma raz√£o, lembrei-me novamente do problema da falta de confirma√ß√£o do propriet√°rio do endere√ßo de e-mail durante o registro.  E ele come√ßou a apresentar situa√ß√µes em que isso pode criar problemas m√°ximos para a hospedagem e seus propriet√°rios.  Em algum momento, comecei a pensar nas rela√ß√µes dos propriet√°rios desse servi√ßo de hospedagem com outros projetos da mesma empresa que conhecia.  Depois de alguns minutos, registrei uma conta com o endere√ßo de email de outro projeto da mesma empresa (seja support@example.com).  Em seguida, consegui vincular o dom√≠nio example.com √† minha conta criada suppot@example.com.  Mas ainda n√£o consegui controlar o conte√∫do do dom√≠nio vinculado. <br><br>  Mas ele poderia pescar perfeitamente com e-mails em nome do servi√ßo example.com. <br><br><img src="https://habrastorage.org/webt/fi/qk/it/fiqkityfxwga7pfldwvdhlgoqnq.png"><br><br>  N√£o est√° claro para onde chegaram as cartas de resposta.  Porque eu respondi uma dessas cartas de teste para mim mesma.  Mas eu n√£o recebi a resposta em si.  Provavelmente desapareceu em resposta ao verdadeiro propriet√°rio da conta de e-mail support@example.com. <br><br>  E ent√£o aconteceu algo pelo qual eu decidi escrever este artigo. <br><br>  Consegui resolver o subdom√≠nio esquecido.  Vulnerabilidade de controle de subdom√≠nio cl√°ssico.  Voc√™ pode ler mais sobre isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  N√£o sei por que, mas tentei adicionar uma liga√ß√£o a um dom√≠nio inexistente.  E eu fiz isso. <br><br><img src="https://habrastorage.org/webt/eo/hw/l0/eohwl0ueicowiesegl-jtpiamog.png"><br><br>  O subdom√≠nio foi adicionado com sucesso e eu pude controlar o conte√∫do desse subdom√≠nio.  E o conte√∫do foi exibido. <br><br><img src="https://habrastorage.org/webt/go/dp/k_/godpk_k1sl3c056c-atq7t30fjy.png"><br><br>  Mas isso n√£o pode ser o mesmo!  Como assim ?!  Afinal, a vulnerabilidade de controle cl√°ssico de subdom√≠nios funciona apenas com subdom√≠nios existentes. <br><br>  Esta situa√ß√£o absolutamente n√£o se encaixava na minha cabe√ßa.  Ou seja, foi poss√≠vel ignorar os n√≠veis de valida√ß√£o da minha atitude em rela√ß√£o a example.com, que nunca √© minha (provavelmente gra√ßas ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">exemplo</a> .com no nome da minha conta).  Mas como √© poss√≠vel adicionar subdom√≠nios e control√°-los sem nenhum componente de verifica√ß√£o nos registros A, TXT, CNAME ...? <br><br>  Normalmente eu vejo isso - adicionaremos um subdom√≠nio a voc√™, apenas voc√™ prova que pode faz√™-lo.  V√° e adicione ao TXT este hash <i>ololopyshpyshpyshbdysh123</i> . <br><br>  Mas n√£o havia tal coisa.  Deseja o subdom√≠nio admin.example.com?  N√£o tem problema! <br><br><img src="https://habrastorage.org/webt/vr/-1/ub/vr-1ub4gdfw7oerzole8jbvfl_i.jpeg"><br><br>  Como se uma vulnerabilidade de controle de subdom√≠nio V2. <br><br>  Devido √† capacidade de me comunicar rapidamente com os propriet√°rios do servi√ßo de hospedagem testado - a Pandora me abriu esta caixa. <br><br>  Acabou o seguinte.  A hospedagem funcionou atrav√©s do CloudFlare.  E ele trabalhou de uma maneira muito esperta. <br>  Vou tentar explicar em palavras simples. <br><br>  Grosso modo, digo-lhe, venha a mim, eu vou te hospedar.  Delegue seus dom√≠nios para mim. <br>  Depois, envio todas as chamadas recebidas indiscriminadamente para o CloudFlare, considerando-as corretas. <br>  E se voc√™ confiasse em mim com o dom√≠nio vasya.ru e um vizinho viesse zapilitar o site com test.vasya.ru e tamb√©m me desse hospedagem, ent√£o meu servidor, tendo acesso ao CloudFlare e j√° com direitos a vasya.ru, adicionou o terceiro n√≠vel sem problemas dom√≠nio para um vizinho e todas as regras, rapidamente e sem questionar.  Para todo o DNS, as informa√ß√µes corretas do CloudFlare chegaram.  E CloudFlare confia em mim. <br><br>  Normalmente, √© claro, os provedores de hospedagem configuram seus servi√ßos DNS.  Mas aqui acontece que eles trapacearam e apenas transferiram tudo para o CloudFlare de um usu√°rio. <br><br>  Portanto, temos uma aquisi√ß√£o de subdom√≠nio god_mode.  √â verdade que isso funcionou apenas com os endere√ßos que a hospedagem j√° controla.  Mas em conjunto com o painel de administra√ß√£o do servi√ßo descoberto anteriormente - isso pode ser um truque para os clientes do servi√ßo de host e do host. <br><br>  No momento, quase todas as vulnerabilidades e erros cr√≠ticos foram corrigidos.  E espero que ningu√©m decida sobre essas del√≠cias arquitet√¥nicas depois de ler esta hist√≥ria. <br><br>  PS: Coment√°rios e sugest√µes sobre o artigo s√£o bem-vindos.  Agradecimentos especiais ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Patriot2k</a> pela consultoria t√©cnica!  Tamb√©m estou aberto a sugest√µes para testar algo interessante. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431398/">https://habr.com/ru/post/pt431398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431388/index.html">O mundo atrav√©s dos olhos de um carro. Como os drones o veem?</a></li>
<li><a href="../pt431390/index.html">Tend√™ncias digitais de 2019 e seu impacto na mudan√ßa de comportamento do consumidor</a></li>
<li><a href="../pt431392/index.html">Esquema de compartilhamento secreto de Shamir</a></li>
<li><a href="../pt431394/index.html">Pervers√µes curiosas do mundo da TI</a></li>
<li><a href="../pt431396/index.html">Como coletamos dados biom√©tricos de clientes</a></li>
<li><a href="../pt431400/index.html">30 bibliotecas e ferramentas Android que n√£o devem passar por voc√™ at√© 2018</a></li>
<li><a href="../pt431402/index.html">A vingan√ßa do Uber AI Montezuma passou melhor que a humana</a></li>
<li><a href="../pt431404/index.html">Velocidade Wi-Fi real (nas empresas)</a></li>
<li><a href="../pt431406/index.html">Como ganhar um hackathon</a></li>
<li><a href="../pt431408/index.html">Como efetivamente preparar e fazer perguntas aos clientes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>