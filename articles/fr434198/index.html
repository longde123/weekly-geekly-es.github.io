<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘± ğŸ¤­ ğŸ¤š Choisir un mode de fonctionnement du serveur Web en fonction de son expÃ©rience personnelle ğŸ‘« ğŸ¥… ğŸ™ƒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article sera utile aux personnes qui ont dÃ©jÃ  leur propre site ou qui prÃ©voient de l'ouvrir. L'article sera particuliÃ¨rement intÃ©ressant pour les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Choisir un mode de fonctionnement du serveur Web en fonction de son expÃ©rience personnelle</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434198/">  Cet article sera utile aux personnes qui ont dÃ©jÃ  leur propre site ou qui prÃ©voient de l'ouvrir.  L'article sera particuliÃ¨rement intÃ©ressant pour les webmasters ambitieux qui estiment que la meilleure heure de leur projet approche Ã  grands pas et veulent se prÃ©parer Ã  l'afflux de visiteurs. <br><br>  MÃªme ceux qui ne rÃªvent encore que de milliers d'utilisateurs sur leur site se sont probablement demandÃ©: "Combien d'utilisateurs mon site reprÃ©sentera-t-il s'ils se connectent en mÃªme temps?"  Je me souviens immÃ©diatement de l'expression bien connue Â«HabraeffectÂ» - le phÃ©nomÃ¨ne de dÃ©faillance du site, qui s'est avÃ©rÃ© non prÃªt pour de nombreuses conversions vers celui-ci aprÃ¨s l'apparition du lien sur Internet. <br><a name="habracut"></a><br>  Supposons que le site existe dÃ©jÃ  (ou le sera bientÃ´t): oÃ¹ peut-il Ãªtre localisÃ©?  Doit-il s'agir d'un hÃ©bergement classique ou d'un serveur vps?  Si vps, lequel et comment est-il prÃ©fÃ©rable de le configurer?  Ou peut-Ãªtre qu'il n'y a aucune diffÃ©rence et qu'il est plus facile de choisir ce qui est le moins cher?  Dans cet article, nous considÃ©rerons plusieurs options et en pratique nous assurerons laquelle est la meilleure pour notre site. <br><br>  Nous allons expÃ©rimenter: dÃ©finir diffÃ©rents modes de fonctionnement du serveur et mesurer les performances.  Nous simulerons la charge sur le site en utilisant le service Loaddy.com.  Vous pouvez y dÃ©finir le nombre d'utilisateurs, le type de charge croissant et le graphique montrera comment le serveur y rÃ©pond.  On pense qu'un utilisateur gÃ©nÃ¨re environ une demande sur le site en 10 secondes.  En tant que site de test, prenez une boutique de dÃ©monstration en ligne sur cms moguta.  Il sera rempli de Â«biensÂ» de test qui seront affichÃ©s sur la page principale selon plusieurs critÃ¨res (c'est-Ã -dire, lorsque la page est en cours de crÃ©ation, le travail est en cours avec la base de donnÃ©es, etc.).  D'une maniÃ¨re ou d'une autre, cela vous permettra de comparer les modes entre eux. <br><br>  En tant que site de test, nous allons crÃ©er un serveur VPS sur Ubuntu.  Sa configuration sera [1 cÅ“ur, 1 Go de RAM].  Nous supposons que ce sont prÃ©cisÃ©ment ces serveurs d'entrÃ©e de gamme qui sont crÃ©Ã©s dans la plupart des cas pour de nouveaux projets.  La version test de la boutique en ligne sera disponible Ã  l'adresse IP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://130.193.44.219/</a> <br><br>  L'hÃ©bergement classique est Ã©galement utile, pour lequel nous remplirons Ã©galement la mÃªme boutique en ligne pour effectuer des tests.  Vous pouvez suivre notre propre chemin et effectuer les mÃªmes tests sur votre projet! <br><br>  Ã‰tant donnÃ© que dans la plupart des cas, avec vps, un panneau de contrÃ´le est proposÃ©, nous apporterons les principales modifications aux paramÃ¨tres qu'il contient.  Sur le serveur vps, nous avons 3 modes de fonctionnement: <br><br><ul><li>  Apache </li><li>  Apache en mode CGI; </li><li>  Nginx + php-fpm (sans Apache). </li></ul><br>  Mais d'abord, testons l'hÃ©bergement: <br><br><h2>  HÃ©bergement classique Ã  faible coÃ»t </h2><br><img src="https://habrastorage.org/webt/9i/9u/rj/9i9urjtvocmzug1u0s7aug1e-qk.gif" alt="image"><br>  Le rÃ©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Des erreurs apparaissent lorsque le nombre de visiteurs dÃ©passe 50 personnes.  L'hÃ©bergement cesse de donner du contenu, cependant, si vous allez dans le panneau de contrÃ´le d'hÃ©bergement, nous pouvons voir quelque chose comme ceci: <br><blockquote>  Votre site a Ã©tÃ© soumis Ã  des restrictions au cours des derniÃ¨res 24 heures.  Les ressources du processeur Ã©taient limitÃ©es pour votre site.  Vous avez atteint les limites des processus d'entrÃ©e (le nombre de scripts PHP et CGI exÃ©cutÃ©s simultanÃ©ment, les tÃ¢ches planifiÃ©es et les sessions de console) 126 fois. </blockquote>  Eh bien, bien sÃ»r, l'hÃ©bergement c'est de l'hÃ©bergement, d'autant plus bon marchÃ©.  Vous pouvez bien sÃ»r trouver un tarif qui offrira plus d'options, mais vous devez tenir compte de tout cela, trouver en quelque sorte les donnÃ©es exactes des restrictions et de chaque fournisseur d'hÃ©bergement. <br><br><h2>  VPS: Apache </h2><br>  Le prochain en ligne est notre test Air Force avec le mode Apache, qui est d'ailleurs proposÃ© par dÃ©faut lors de l'installation du panneau de contrÃ´le ISP. <br><br><img src="https://habrastorage.org/webt/cq/ps/3k/cqps3kza1pw3ew7wdszpqcovgva.gif" alt="image"><br><br>  Le rÃ©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Les problÃ¨mes commencent lorsque le nombre d'utilisateurs dÃ©passe 90. Si nous allons sur notre serveur via ssh et regardons ce moment sur la liste des processus utilisant la commande top, triÃ©s en utilisant Shift + M (selon la quantitÃ© de mÃ©moire consommÃ©e), nous verrons quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/8y/ml/uk/8ymlukh_jyjx0jlsnttsw_de6mw.gif" alt="image"><br><br>  Nous voyons que le processus apache2 est devenu de nombreuses filiales et ils ont mangÃ© toute la RAM de notre serveur vps. <br><br>  Ici, vous devez faire une petite remarque.  Le fait est qu'il existe thÃ©oriquement un mode pour le serveur Apache qui permet Ã  la place de ce grand nombre de processus enfants pour chaque connexion de crÃ©er plusieurs soi-disant multi-threads, chacun servant Ã  plusieurs connexions.  Ce mode est appelÃ© <i>travailleur</i> , contrairement Ã  la <i>prÃ©-fourche</i> par dÃ©faut.  Mais ce n'est pas facile Ã  installer, il est impossible de le faire dans des panneaux comme ISP, et si vous Ãªtes perplexe et essayez de le faire via ssh, il s'avÃ¨re que dÃ©sactiver la prÃ©fork et activer le travailleur ne suffit pas, vous avez toujours besoin d'une version thread-safe de php.  Et si des modules comme Zend ou IonCube sont utilisÃ©s, ils doivent Ã©galement Ãªtre thread-safe.  Quoi qu'il en soit, le site officiel PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne recommande pas de</a> dÃ©finir ce mode. <br><br><h2>  VPS: CGI </h2><br>  Voyons ce qui se passe lors de l'utilisation du mode CGI.  Pour ce faire, vous devez autoriser l'utilisation de PHP en mode CGI dans le panneau de configuration du FAI, cela se fait dans la section "Comptes - Utilisateurs - ParamÃ¨tres pour l'utilisateur". <br><br><img src="https://habrastorage.org/webt/jc/md/zx/jcmdzxrcghqhwf4xmy2edbixov0.gif" alt="image"><br><br>  Le rÃ©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Une image sombre s'est avÃ©rÃ©e.  Le serveur refuse de distribuer du contenu dÃ©jÃ  avec plus de 55 visiteurs, la RAM est entiÃ¨rement consommÃ©e par les processus Â«phpÂ».  Vient ensuite une tentative de restauration de la fonctionnalitÃ©, mais elle se termine toujours par un Ã©chec de presque 100%. <br><br><h2>  VPS: Nginx + PHP-FPM </h2><br>  Le temps est venu pour un mode dans lequel le serveur Apache n'est pas du tout utilisÃ©, Nginx fonctionne Ã  la place et php est traitÃ© par le module php-fpm.  Si vous utilisez le panneau de configuration du FAI, vous devez activer ce mode pour l'utilisateur.  Cela se fait Ã©galement dans la section "Comptes - Utilisateurs - ParamÃ¨tres utilisateur".  De plus, ce mode doit Ãªtre disponible dans la section "ParamÃ¨tres - FonctionnalitÃ©s - Serveur Web (www)". <br><br><img src="https://habrastorage.org/webt/g1/9h/tu/g19htuq2ms1wdgc7chekxfrdzzk.gif" alt="image"><br><br>  Le rÃ©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Ce dont vous avez besoin!  DisponibilitÃ© Ã  100%, tandis que la vitesse de tÃ©lÃ©chargement et le temps de rÃ©ponse du serveur sont Ã  des niveaux acceptables, bien qu'ils augmentent avec l'augmentation de la charge.  NÃ©anmoins, le serveur fait face! <br><br>  Regardons la table des processus au moment de la charge maximale sur le serveur: <br><br><img src="https://habrastorage.org/webt/lf/al/bx/lfalbxszotenrmulrkdhifuejky.gif" alt="image"><br><br>  Nous voyons que nous avons encore un approvisionnement de RAM disponible.  Et les processus enfants php-fpm7.0 ne se dÃ©veloppent pas en grand nombre, mais sont limitÃ©s Ã  5 instances, chacune servant Ã  plusieurs threads. <br><br>  Eh bien, il semble qu'un "mode gagnant" soit dÃ©fini.  Voyons combien de visiteurs simultanÃ©s notre serveur peut servir dans ce mode.  Mais avant cela, nous faisons un peu de Â«tuningÂ».  Tout d'abord, comme apache n'est pas utilisÃ© pour une telle opÃ©ration sur le serveur, il peut Ãªtre complÃ¨tement dÃ©sactivÃ©.  Nous le ferons dans le panneau de contrÃ´le du FAI dans la section "SystÃ¨me - Services".  DeuxiÃ¨mement, nous modifions un peu le principe de dÃ©marrage des processus php-fpm.  Par dÃ©faut, il est dynamique.  Cela signifie que les processus enfants resteront en mÃ©moire mÃªme lorsqu'ils ne sont pas nÃ©cessaires.  En mÃªme temps, la mÃ©moire n'est pas libÃ©rÃ©e et, avec le temps, ces processus peuvent croÃ®tre plus que nous le souhaiterions.  Par consÃ©quent, il est proposÃ© de dÃ©finir le mode Â«Ã  la demandeÂ» - sur demande.  Et dÃ©finissez le nombre de processus enfants et le dÃ©lai d'expiration pour eux. <br><br>  Pour ce faire, vous devrez vous rendre sur le serveur via ssh et enregistrer ces paramÃ¨tres dans le fichier de configuration php.  Ceci est commodÃ©ment fait dans le fichier pour l'utilisateur pour lequel le domaine a Ã©tÃ© crÃ©Ã© dans ISP. <br><br>  Il se trouve gÃ©nÃ©ralement dans /etc/php/7.0/fpm/pool.d <br><br>  Donc: <pre><code class="bash hljs">sudo nano /etc/php/7.0/fpm/pool.d/www-root.conf</code> </pre> <br><br>  On y voit par dÃ©faut les paramÃ¨tres suivants: <br><br><pre> <code class="plaintext hljs">[www-root] pm = dynamic pm.start_servers = 1 pm.min_spare_servers = 1 pm.max_children = 5 pm.max_spare_servers = 5</code> </pre> <br>  Pour activer le mode sur demande, vous devez le remplacer par: <br><pre> <code class="plaintext hljs">pm = ondemand pm.max_children = 5 pm.process_idle_timeout = 10s</code> </pre> <br>  Et redÃ©marrez php-fpm avec la commande <br><br><pre> <code class="bash hljs">sudo service php7.0-fpm restart</code> </pre> <br>  AprÃ¨s cela, les processus php-fpm7.0 seront crÃ©Ã©s Ã  la demande (s'il y a une charge), leur nombre maximum sera = 5, et aprÃ¨s 10 secondes d'arrÃªt, le processus sera tuÃ©, libÃ©rant de la RAM. <br><br>  Au cas oÃ¹, nous relancerons notre test pour nous assurer que toute cette activitÃ© amateur n'a pas affectÃ© les performances du site Web: <br><br><img src="https://habrastorage.org/webt/j_/ii/3q/j_ii3q4de-cmblsvtxi7grdwumq.gif" alt="image"><br><br>  Le rÃ©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Maintenant, exÃ©cutons Loaddy avec beaucoup de visiteurs pour comprendre combien de connexions notre serveur peut gÃ©rer: <br><br><img src="https://habrastorage.org/webt/wb/vs/72/wbvs72nk8yujn1n8w-ngook9mm0.gif" alt="image"><br><br>  Le rÃ©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  La bonne nouvelle est que toutes les demandes ont Ã©tÃ© traitÃ©es, bien qu'avec un retard important, avec un grand nombre de demandes par seconde.  Le temps de rÃ©ponse du serveur approche 10 secondes avec un nombre de hits de 190+. Mais rappelons le graphique du mode Apache, oÃ¹ nous avons dÃ©jÃ  reÃ§u 4 secondes de rÃ©ponse du serveur avec plus de 80 utilisateurs, tandis qu'en mode php-fpm, des dÃ©calages similaires sont observÃ©s avec 130 requÃªtes que nous avons spÃ©cialement allouÃ©es curseur sur le graphique ci-dessus. <br>  Mais c'est le mÃªme VPS. <br><br>  Tableau des principaux processus Ã  la fin du test (avec 200 utilisateurs): <br><br><img src="https://habrastorage.org/webt/rj/uj/ra/rjujrafp7z1vbu_iqryibz88cew.gif" alt="image"><br><br>  Notez qu'aprÃ¨s le test, la mÃ©moire utilisÃ©e par pfp-fpm est libÃ©rÃ©e: <br><br><img src="https://habrastorage.org/webt/yc/32/vt/yc32vtmtnrupcw6spibvemvkzpk.gif" alt="image"><br><br>  Notre serveur est donc prÃªt pour de nouvelles charges. <br><br>  Il faut se rappeler que le site fonctionne en mode nginx + php-fpm, ce qui signifie que apache2 n'est pas utilisÃ© dans le travail et, par consÃ©quent, .htaccess n'est pas utilisÃ©.  Cela peut ne pas sembler pratique, mais c'est l'option la plus rapide possible, et les moteurs de recherche classent mieux les sites qui fonctionnent rapidement. <br><br><h2>  Conclusion </h2><br>  En conclusion, un autre petit point: si vous avez configurÃ© tout sur le serveur que vous vouliez et avez dÃ©cidÃ© de dÃ©connecter le panneau de contrÃ´le du FAI, ou si vous n'avez plus de licence pour celui-ci, veuillez noter que le processus Â«de baseÂ» de celui-ci restera suspendu sur votre serveur.  AprÃ¨s des mois, il peut se dÃ©velopper, il est donc prÃ©fÃ©rable de le Â«tuerÂ» et de le supprimer du dÃ©marrage et de crona. <br><br>  Si vous souhaitez tester indÃ©pendamment le site Ã  l'aide de Loaddy ou d'autres mÃ©thodes, il est disponible Ã  l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">adresse http://130.193.44.219/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434198/">https://habr.com/ru/post/fr434198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434188/index.html">Security Week 52: The Greatest Hits</a></li>
<li><a href="../fr434190/index.html">Comment crÃ©er un miracle de NoÃ«l numÃ©rique: une interview avec CIO Santa Claus</a></li>
<li><a href="../fr434192/index.html">Comment Baldur's Gate a sauvÃ© les RPG informatiques</a></li>
<li><a href="../fr434194/index.html">DÃ©veloppement de compÃ©tences pour Alice. ExpÃ©rience avec les interfaces vocales, conseils pour les dÃ©butants</a></li>
<li><a href="../fr434196/index.html">3CX v16 Alpha 2 et plans pour la nouvelle annÃ©e</a></li>
<li><a href="../fr434200/index.html">La rouille est-elle si terrible qu'elle est peinte</a></li>
<li><a href="../fr434202/index.html">4 secrets pour ne pas perdre son emploi en science des donnÃ©es</a></li>
<li><a href="../fr434206/index.html">Distributeur de jet ok.ru/music</a></li>
<li><a href="../fr434208/index.html">Comment Go a sauvÃ© notre Black Friday</a></li>
<li><a href="../fr434210/index.html">Analyse du concours de quiz Android du stand HeadHunter au Mobius 2018 Moscou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>