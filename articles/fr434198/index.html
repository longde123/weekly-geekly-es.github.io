<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë± ü§≠ ü§ö Choisir un mode de fonctionnement du serveur Web en fonction de son exp√©rience personnelle üë´ ü•Ö üôÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article sera utile aux personnes qui ont d√©j√† leur propre site ou qui pr√©voient de l'ouvrir. L'article sera particuli√®rement int√©ressant pour les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Choisir un mode de fonctionnement du serveur Web en fonction de son exp√©rience personnelle</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434198/">  Cet article sera utile aux personnes qui ont d√©j√† leur propre site ou qui pr√©voient de l'ouvrir.  L'article sera particuli√®rement int√©ressant pour les webmasters ambitieux qui estiment que la meilleure heure de leur projet approche √† grands pas et veulent se pr√©parer √† l'afflux de visiteurs. <br><br>  M√™me ceux qui ne r√™vent encore que de milliers d'utilisateurs sur leur site se sont probablement demand√©: "Combien d'utilisateurs mon site repr√©sentera-t-il s'ils se connectent en m√™me temps?"  Je me souviens imm√©diatement de l'expression bien connue ¬´Habraeffect¬ª - le ph√©nom√®ne de d√©faillance du site, qui s'est av√©r√© non pr√™t pour de nombreuses conversions vers celui-ci apr√®s l'apparition du lien sur Internet. <br><a name="habracut"></a><br>  Supposons que le site existe d√©j√† (ou le sera bient√¥t): o√π peut-il √™tre localis√©?  Doit-il s'agir d'un h√©bergement classique ou d'un serveur vps?  Si vps, lequel et comment est-il pr√©f√©rable de le configurer?  Ou peut-√™tre qu'il n'y a aucune diff√©rence et qu'il est plus facile de choisir ce qui est le moins cher?  Dans cet article, nous consid√©rerons plusieurs options et en pratique nous assurerons laquelle est la meilleure pour notre site. <br><br>  Nous allons exp√©rimenter: d√©finir diff√©rents modes de fonctionnement du serveur et mesurer les performances.  Nous simulerons la charge sur le site en utilisant le service Loaddy.com.  Vous pouvez y d√©finir le nombre d'utilisateurs, le type de charge croissant et le graphique montrera comment le serveur y r√©pond.  On pense qu'un utilisateur g√©n√®re environ une demande sur le site en 10 secondes.  En tant que site de test, prenez une boutique de d√©monstration en ligne sur cms moguta.  Il sera rempli de ¬´biens¬ª de test qui seront affich√©s sur la page principale selon plusieurs crit√®res (c'est-√†-dire, lorsque la page est en cours de cr√©ation, le travail est en cours avec la base de donn√©es, etc.).  D'une mani√®re ou d'une autre, cela vous permettra de comparer les modes entre eux. <br><br>  En tant que site de test, nous allons cr√©er un serveur VPS sur Ubuntu.  Sa configuration sera [1 c≈ìur, 1 Go de RAM].  Nous supposons que ce sont pr√©cis√©ment ces serveurs d'entr√©e de gamme qui sont cr√©√©s dans la plupart des cas pour de nouveaux projets.  La version test de la boutique en ligne sera disponible √† l'adresse IP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://130.193.44.219/</a> <br><br>  L'h√©bergement classique est √©galement utile, pour lequel nous remplirons √©galement la m√™me boutique en ligne pour effectuer des tests.  Vous pouvez suivre notre propre chemin et effectuer les m√™mes tests sur votre projet! <br><br>  √âtant donn√© que dans la plupart des cas, avec vps, un panneau de contr√¥le est propos√©, nous apporterons les principales modifications aux param√®tres qu'il contient.  Sur le serveur vps, nous avons 3 modes de fonctionnement: <br><br><ul><li>  Apache </li><li>  Apache en mode CGI; </li><li>  Nginx + php-fpm (sans Apache). </li></ul><br>  Mais d'abord, testons l'h√©bergement: <br><br><h2>  H√©bergement classique √† faible co√ªt </h2><br><img src="https://habrastorage.org/webt/9i/9u/rj/9i9urjtvocmzug1u0s7aug1e-qk.gif" alt="image"><br>  Le r√©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Des erreurs apparaissent lorsque le nombre de visiteurs d√©passe 50 personnes.  L'h√©bergement cesse de donner du contenu, cependant, si vous allez dans le panneau de contr√¥le d'h√©bergement, nous pouvons voir quelque chose comme ceci: <br><blockquote>  Votre site a √©t√© soumis √† des restrictions au cours des derni√®res 24 heures.  Les ressources du processeur √©taient limit√©es pour votre site.  Vous avez atteint les limites des processus d'entr√©e (le nombre de scripts PHP et CGI ex√©cut√©s simultan√©ment, les t√¢ches planifi√©es et les sessions de console) 126 fois. </blockquote>  Eh bien, bien s√ªr, l'h√©bergement c'est de l'h√©bergement, d'autant plus bon march√©.  Vous pouvez bien s√ªr trouver un tarif qui offrira plus d'options, mais vous devez tenir compte de tout cela, trouver en quelque sorte les donn√©es exactes des restrictions et de chaque fournisseur d'h√©bergement. <br><br><h2>  VPS: Apache </h2><br>  Le prochain en ligne est notre test Air Force avec le mode Apache, qui est d'ailleurs propos√© par d√©faut lors de l'installation du panneau de contr√¥le ISP. <br><br><img src="https://habrastorage.org/webt/cq/ps/3k/cqps3kza1pw3ew7wdszpqcovgva.gif" alt="image"><br><br>  Le r√©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Les probl√®mes commencent lorsque le nombre d'utilisateurs d√©passe 90. Si nous allons sur notre serveur via ssh et regardons ce moment sur la liste des processus utilisant la commande top, tri√©s en utilisant Shift + M (selon la quantit√© de m√©moire consomm√©e), nous verrons quelque chose comme ceci: <br><br><img src="https://habrastorage.org/webt/8y/ml/uk/8ymlukh_jyjx0jlsnttsw_de6mw.gif" alt="image"><br><br>  Nous voyons que le processus apache2 est devenu de nombreuses filiales et ils ont mang√© toute la RAM de notre serveur vps. <br><br>  Ici, vous devez faire une petite remarque.  Le fait est qu'il existe th√©oriquement un mode pour le serveur Apache qui permet √† la place de ce grand nombre de processus enfants pour chaque connexion de cr√©er plusieurs soi-disant multi-threads, chacun servant √† plusieurs connexions.  Ce mode est appel√© <i>travailleur</i> , contrairement √† la <i>pr√©-fourche</i> par d√©faut.  Mais ce n'est pas facile √† installer, il est impossible de le faire dans des panneaux comme ISP, et si vous √™tes perplexe et essayez de le faire via ssh, il s'av√®re que d√©sactiver la pr√©fork et activer le travailleur ne suffit pas, vous avez toujours besoin d'une version thread-safe de php.  Et si des modules comme Zend ou IonCube sont utilis√©s, ils doivent √©galement √™tre thread-safe.  Quoi qu'il en soit, le site officiel PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne recommande pas de</a> d√©finir ce mode. <br><br><h2>  VPS: CGI </h2><br>  Voyons ce qui se passe lors de l'utilisation du mode CGI.  Pour ce faire, vous devez autoriser l'utilisation de PHP en mode CGI dans le panneau de configuration du FAI, cela se fait dans la section "Comptes - Utilisateurs - Param√®tres pour l'utilisateur". <br><br><img src="https://habrastorage.org/webt/jc/md/zx/jcmdzxrcghqhwf4xmy2edbixov0.gif" alt="image"><br><br>  Le r√©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Une image sombre s'est av√©r√©e.  Le serveur refuse de distribuer du contenu d√©j√† avec plus de 55 visiteurs, la RAM est enti√®rement consomm√©e par les processus ¬´php¬ª.  Vient ensuite une tentative de restauration de la fonctionnalit√©, mais elle se termine toujours par un √©chec de presque 100%. <br><br><h2>  VPS: Nginx + PHP-FPM </h2><br>  Le temps est venu pour un mode dans lequel le serveur Apache n'est pas du tout utilis√©, Nginx fonctionne √† la place et php est trait√© par le module php-fpm.  Si vous utilisez le panneau de configuration du FAI, vous devez activer ce mode pour l'utilisateur.  Cela se fait √©galement dans la section "Comptes - Utilisateurs - Param√®tres utilisateur".  De plus, ce mode doit √™tre disponible dans la section "Param√®tres - Fonctionnalit√©s - Serveur Web (www)". <br><br><img src="https://habrastorage.org/webt/g1/9h/tu/g19htuq2ms1wdgc7chekxfrdzzk.gif" alt="image"><br><br>  Le r√©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Ce dont vous avez besoin!  Disponibilit√© √† 100%, tandis que la vitesse de t√©l√©chargement et le temps de r√©ponse du serveur sont √† des niveaux acceptables, bien qu'ils augmentent avec l'augmentation de la charge.  N√©anmoins, le serveur fait face! <br><br>  Regardons la table des processus au moment de la charge maximale sur le serveur: <br><br><img src="https://habrastorage.org/webt/lf/al/bx/lfalbxszotenrmulrkdhifuejky.gif" alt="image"><br><br>  Nous voyons que nous avons encore un approvisionnement de RAM disponible.  Et les processus enfants php-fpm7.0 ne se d√©veloppent pas en grand nombre, mais sont limit√©s √† 5 instances, chacune servant √† plusieurs threads. <br><br>  Eh bien, il semble qu'un "mode gagnant" soit d√©fini.  Voyons combien de visiteurs simultan√©s notre serveur peut servir dans ce mode.  Mais avant cela, nous faisons un peu de ¬´tuning¬ª.  Tout d'abord, comme apache n'est pas utilis√© pour une telle op√©ration sur le serveur, il peut √™tre compl√®tement d√©sactiv√©.  Nous le ferons dans le panneau de contr√¥le du FAI dans la section "Syst√®me - Services".  Deuxi√®mement, nous modifions un peu le principe de d√©marrage des processus php-fpm.  Par d√©faut, il est dynamique.  Cela signifie que les processus enfants resteront en m√©moire m√™me lorsqu'ils ne sont pas n√©cessaires.  En m√™me temps, la m√©moire n'est pas lib√©r√©e et, avec le temps, ces processus peuvent cro√Ætre plus que nous le souhaiterions.  Par cons√©quent, il est propos√© de d√©finir le mode ¬´√† la demande¬ª - sur demande.  Et d√©finissez le nombre de processus enfants et le d√©lai d'expiration pour eux. <br><br>  Pour ce faire, vous devrez vous rendre sur le serveur via ssh et enregistrer ces param√®tres dans le fichier de configuration php.  Ceci est commod√©ment fait dans le fichier pour l'utilisateur pour lequel le domaine a √©t√© cr√©√© dans ISP. <br><br>  Il se trouve g√©n√©ralement dans /etc/php/7.0/fpm/pool.d <br><br>  Donc: <pre><code class="bash hljs">sudo nano /etc/php/7.0/fpm/pool.d/www-root.conf</code> </pre> <br><br>  On y voit par d√©faut les param√®tres suivants: <br><br><pre> <code class="plaintext hljs">[www-root] pm = dynamic pm.start_servers = 1 pm.min_spare_servers = 1 pm.max_children = 5 pm.max_spare_servers = 5</code> </pre> <br>  Pour activer le mode sur demande, vous devez le remplacer par: <br><pre> <code class="plaintext hljs">pm = ondemand pm.max_children = 5 pm.process_idle_timeout = 10s</code> </pre> <br>  Et red√©marrez php-fpm avec la commande <br><br><pre> <code class="bash hljs">sudo service php7.0-fpm restart</code> </pre> <br>  Apr√®s cela, les processus php-fpm7.0 seront cr√©√©s √† la demande (s'il y a une charge), leur nombre maximum sera = 5, et apr√®s 10 secondes d'arr√™t, le processus sera tu√©, lib√©rant de la RAM. <br><br>  Au cas o√π, nous relancerons notre test pour nous assurer que toute cette activit√© amateur n'a pas affect√© les performances du site Web: <br><br><img src="https://habrastorage.org/webt/j_/ii/3q/j_ii3q4de-cmblsvtxi7grdwumq.gif" alt="image"><br><br>  Le r√©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Maintenant, ex√©cutons Loaddy avec beaucoup de visiteurs pour comprendre combien de connexions notre serveur peut g√©rer: <br><br><img src="https://habrastorage.org/webt/wb/vs/72/wbvs72nk8yujn1n8w-ngook9mm0.gif" alt="image"><br><br>  Le r√©sultat est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  La bonne nouvelle est que toutes les demandes ont √©t√© trait√©es, bien qu'avec un retard important, avec un grand nombre de demandes par seconde.  Le temps de r√©ponse du serveur approche 10 secondes avec un nombre de hits de 190+. Mais rappelons le graphique du mode Apache, o√π nous avons d√©j√† re√ßu 4 secondes de r√©ponse du serveur avec plus de 80 utilisateurs, tandis qu'en mode php-fpm, des d√©calages similaires sont observ√©s avec 130 requ√™tes que nous avons sp√©cialement allou√©es curseur sur le graphique ci-dessus. <br>  Mais c'est le m√™me VPS. <br><br>  Tableau des principaux processus √† la fin du test (avec 200 utilisateurs): <br><br><img src="https://habrastorage.org/webt/rj/uj/ra/rjujrafp7z1vbu_iqryibz88cew.gif" alt="image"><br><br>  Notez qu'apr√®s le test, la m√©moire utilis√©e par pfp-fpm est lib√©r√©e: <br><br><img src="https://habrastorage.org/webt/yc/32/vt/yc32vtmtnrupcw6spibvemvkzpk.gif" alt="image"><br><br>  Notre serveur est donc pr√™t pour de nouvelles charges. <br><br>  Il faut se rappeler que le site fonctionne en mode nginx + php-fpm, ce qui signifie que apache2 n'est pas utilis√© dans le travail et, par cons√©quent, .htaccess n'est pas utilis√©.  Cela peut ne pas sembler pratique, mais c'est l'option la plus rapide possible, et les moteurs de recherche classent mieux les sites qui fonctionnent rapidement. <br><br><h2>  Conclusion </h2><br>  En conclusion, un autre petit point: si vous avez configur√© tout sur le serveur que vous vouliez et avez d√©cid√© de d√©connecter le panneau de contr√¥le du FAI, ou si vous n'avez plus de licence pour celui-ci, veuillez noter que le processus ¬´de base¬ª de celui-ci restera suspendu sur votre serveur.  Apr√®s des mois, il peut se d√©velopper, il est donc pr√©f√©rable de le ¬´tuer¬ª et de le supprimer du d√©marrage et de crona. <br><br>  Si vous souhaitez tester ind√©pendamment le site √† l'aide de Loaddy ou d'autres m√©thodes, il est disponible √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">adresse http://130.193.44.219/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434198/">https://habr.com/ru/post/fr434198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434188/index.html">Security Week 52: The Greatest Hits</a></li>
<li><a href="../fr434190/index.html">Comment cr√©er un miracle de No√´l num√©rique: une interview avec CIO Santa Claus</a></li>
<li><a href="../fr434192/index.html">Comment Baldur's Gate a sauv√© les RPG informatiques</a></li>
<li><a href="../fr434194/index.html">D√©veloppement de comp√©tences pour Alice. Exp√©rience avec les interfaces vocales, conseils pour les d√©butants</a></li>
<li><a href="../fr434196/index.html">3CX v16 Alpha 2 et plans pour la nouvelle ann√©e</a></li>
<li><a href="../fr434200/index.html">La rouille est-elle si terrible qu'elle est peinte</a></li>
<li><a href="../fr434202/index.html">4 secrets pour ne pas perdre son emploi en science des donn√©es</a></li>
<li><a href="../fr434206/index.html">Distributeur de jet ok.ru/music</a></li>
<li><a href="../fr434208/index.html">Comment Go a sauv√© notre Black Friday</a></li>
<li><a href="../fr434210/index.html">Analyse du concours de quiz Android du stand HeadHunter au Mobius 2018 Moscou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>