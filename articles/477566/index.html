<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∑Ô∏è üë®üèº‚Äç‚úàÔ∏è üîΩ Huawei Cloud: hoy est√° nublado en PVS-Studio ‚è≠Ô∏è üëêüèº üè°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este siglo, todos han o√≠do hablar de los servicios en la nube. Muchas empresas han dominado este segmento del mercado y creado sus servicios en la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Huawei Cloud: hoy est√° nublado en PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/477566/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ac/bd2/47b/2acbd247b999e7f8e9e45f77181e2f06.png" alt="Imagen 2"></div><br>  En este siglo, todos han o√≠do hablar de los servicios en la nube.  Muchas empresas han dominado este segmento del mercado y creado sus servicios en la nube en varias direcciones.  Nuestro equipo tambi√©n ha estado interesado recientemente en estos servicios en t√©rminos de integrar el analizador de c√≥digo PVS-Studio con ellos.  Creemos que nuestros lectores habituales ya adivinan qu√© tipo de proyecto revisaremos esta vez.  La elecci√≥n recay√≥ en el c√≥digo de servicios en la nube de Huawei. <br><a name="habracut"></a><br><h2>  Introduccion </h2><br>  Si sigue al equipo de PVS-Studio, probablemente haya notado que recientemente hemos estado muy interesados ‚Äã‚Äãen las tecnolog√≠as en la nube.  Ya hemos publicado varios art√≠culos relacionados con este tema: <br><br><ul><li>  <a href="https://www.viva64.com/ru/b/0670/">PVS-Studio va a las nubes: Azure DevOps</a> </li><li>  <a href="https://www.viva64.com/ru/b/0636/">PVS-Studio va a las nubes: Travis CI</a> </li><li>  <a href="https://www.viva64.com/ru/b/0676/">PVS-Studio va a las nubes: CircleCI</a> </li><li>  <a href="https://www.viva64.com/ru/b/0686/">PVS-Studio va a las nubes: GitLab CI / CD</a> </li></ul><br>  Y as√≠, cuando estaba recogiendo otro proyecto interesante para el pr√≥ximo art√≠culo, recib√≠ una oferta de trabajo de <a href="https://www.huawei.com/en/">Huawei</a> por correo.  Al recopilar informaci√≥n sobre esta empresa, result√≥ que tienen sus propios servicios en la nube, pero lo principal es que el c√≥digo fuente de estos servicios est√° disponible gratuitamente en GitHub.  Esta fue la raz√≥n principal para elegir esta compa√±√≠a para este art√≠culo.  Como dijo un sabio chino: "Los accidentes no son accidentales". <br><br>  Ahora un poco sobre nuestro analizador.  PVS-Studio es un analizador de c√≥digo est√°tico que identifica errores y vulnerabilidades en el c√≥digo fuente de programas escritos en C, C ++, C # y Java.  El analizador funciona en las plataformas Windows, Linux y macOS.  Adem√°s de los complementos para entornos de desarrollo cl√°sicos como Visual Studio o IntelliJ IDEA, el analizador tiene la capacidad de integrarse con SonarQube y Jenkins: <br><br><ul><li>  <a href="https://www.viva64.com/ru/m/0037/">Integraci√≥n de los resultados del an√°lisis PVS-Studio en SonarQube</a> </li><li>  <a href="https://www.viva64.com/ru/m/0048/">Lanzar PVS-Studio en Jenkins</a> </li></ul><br><h2>  Analisis de proyecto </h2><br>  En el proceso de b√∫squeda de informaci√≥n para el art√≠culo, descubr√≠ que Huawei tiene un <a href="https://developer.huaweicloud.com/en-us">centro de desarrolladores</a> donde puede obtener informaci√≥n, gu√≠as y el c√≥digo fuente de sus servicios en la nube.  Se utilizaron varios lenguajes de programaci√≥n para crear estos servicios, pero los lenguajes como Go, Java y Python resultaron ser los m√°s populares. <br><br>  Como me especializo en Java, los proyectos fueron elegidos en consecuencia.  Las fuentes de los proyectos analizados en el art√≠culo se pueden obtener en el repositorio de GitHub <a href="https://github.com/huaweicloud/">huaweicloud</a> . <br><br>  Para analizar los proyectos, solo necesitaba realizar algunas acciones: <br><br><ul><li>  Obtenga proyectos del repositorio; </li><li>  Utilice las <a href="https://www.viva64.com/ru/m/0044/">instrucciones</a> para iniciar el analizador Java e iniciar el an√°lisis en cada uno de los proyectos. </li></ul><br>  Despu√©s de analizar los proyectos, logramos destacar solo tres a los que me gustar√≠a prestar atenci√≥n.  Esto se debe al hecho de que el tama√±o de los proyectos restantes de Java era demasiado peque√±o. <br><br>  Resultados del an√°lisis del proyecto (n√∫mero de advertencias y n√∫mero de archivos): <br><br><ul><li>  <a href="https://github.com/huaweicloud/huaweicloud-sdk-java">huaweicloud-sdk-java</a> : 31 - Alto, 2 - Medio y 16 - Bajo, m√°s de 2700 archivos. </li><li>  <a href="https://github.com/huaweicloud/huaweicloud-dis-agent">huaweicloud-dis-agent</a> : 7 - Alto, 6 - Medio y 6 - Bajo, m√°s de 100 archivos. </li><li>  <a href="https://github.com/huaweicloud/huaweicloud-sdk-java-dis">huaweicloud-sdk-java-dis</a> : 15 - Alto, 6 - Medio y 16 - Bajo, m√°s de 270 archivos. </li></ul><br>  Hay pocas advertencias, por lo que, en general, podemos decir sobre la buena calidad del c√≥digo.  Adem√°s, no todas las operaciones son errores v√°lidos.  Esto se debe al hecho de que el analizador a veces no tiene suficiente informaci√≥n para distinguir el c√≥digo correcto del incorrecto.  Por lo tanto, los diagn√≥sticos del analizador se mejoran todos los d√≠as con la ayuda de la informaci√≥n recibida de los usuarios.  Consulte tambi√©n el art√≠culo " <a href="https://www.viva64.com/ru/b/0488/">C√≥mo y por qu√© los analizadores est√°ticos luchan contra los falsos positivos</a> ". <br><br>  En el proceso de an√°lisis de proyectos, seleccion√© las advertencias m√°s interesantes, que analizar√© en este art√≠culo. <br><br><h2>  Orden de inicializaci√≥n de campo </h2><br>  El ciclo de inicializaci√≥n de la clase <a href="https://www.viva64.com/ru/w/v6050/">V6050</a> est√° presente.  La inicializaci√≥n de 'INSTANCE' aparece antes de la inicializaci√≥n de 'LOG'.  UntrustedSSL.java (32), UntrustedSSL.java (59), UntrustedSSL.java (33) <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UntrustedSSL</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UntrustedSSL INSTANCE = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UntrustedSSL(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOG = LoggerFactory.getLogger(UntrustedSSL.class); .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UntrustedSSL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Throwable t) { LOG.error(t.getMessage(), t); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } } }</span></span></code> </pre> <br>  Si se produce alguna excepci√≥n en el constructor de la clase <i>UntrustedSSL</i> , la informaci√≥n sobre esta excepci√≥n se registra en el <i>bloque catch</i> utilizando el registrador <i>LOG</i> .  Sin embargo, debido al orden de inicializaci√≥n de los campos est√°ticos, el <i>LOG</i> al momento de inicializar el campo <i>INSTANCE</i> a√∫n no se ha inicializado.  Por lo tanto, al registrar informaci√≥n de excepci√≥n en el constructor, se generar√° una <i>NullPointerException</i> .  Esta excepci√≥n es la causa de otra <i>excepci√≥n ExceptionInInitializerError</i> que se produce si se produce una excepci√≥n al inicializar el campo est√°tico.  Todo lo que se necesita para resolver el problema descrito es colocar la inicializaci√≥n de <i>LOG</i> antes de la inicializaci√≥n de <i>INSTANCE</i> . <br><br><h2>  Error tipogr√°fico invisible </h2><br>  <a href="https://www.viva64.com/ru/w/v6005/">V6005</a> La variable 'this.metricSchema' se asigna a s√≠ misma.  OpenTSDBSchema.java (72) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenTSDBSchema</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@JsonProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"metric"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;SchemaField&gt; metricSchema; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMetricsSchema</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;SchemaField&gt; metricsSchema)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.metricSchema = metricSchema; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } public void setMetricSchema(List&lt;SchemaField&gt; metricSchema) { this.metricSchema = metricSchema; } .... }</span></span></code> </pre> <br>  Ambos m√©todos establecen el campo <i>metricSchema</i> , pero los nombres de los m√©todos difieren seg√∫n el car√°cter 's'.  El programador nombr√≥ los argumentos de estos m√©todos de acuerdo con el nombre del m√©todo.  Como resultado, en la l√≠nea se√±alada por el analizador, el campo <i>metricSchema se</i> asigna a s√≠ mismo y no se utiliza el argumento del m√©todo <i>metricsSchema</i> . <br><br>  <a href="https://www.viva64.com/ru/w/v6005/">V6005</a> La variable 'suspender' se asigna a s√≠ misma.  SuspendTransferTaskRequest.java (77) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuspendTransferTaskRequest</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> suspend; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSuspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> suspend)</span></span></span><span class="hljs-function"> </span></span>{ suspend = suspend; } .... }</code> </pre> <br>  Aqu√≠ hay un error banal relacionado con el descuido, debido a que ocurre la asignaci√≥n del argumento <i>suspendido</i> a s√≠ mismo.  Como resultado, el valor del argumento llegado no se asignar√° al campo de <i>suspensi√≥n</i> , como est√° impl√≠cito.  Correctamente: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSuspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> suspend)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.suspend = suspend; }</code> </pre> <br><h2>  Condiciones predeterminadas </h2><br>  Como suele suceder, la regla <a href="https://www.viva64.com/ru/w/v6007/">V6007</a> se rompe en t√©rminos de la cantidad de advertencias. <br><br>  <a href="https://www.viva64.com/ru/w/v6007/">V6007 La</a> expresi√≥n 'firewallPolicyId == null' siempre es falsa.  FirewallPolicyServiceImpl.java (125) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> FirewallPolicy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeFirewallRuleFromPolicy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String firewallPolicyId, String firewallRuleId)</span></span></span><span class="hljs-function"> </span></span>{ checkNotNull(firewallPolicyId); checkNotNull(firewallRuleId); checkState(!(firewallPolicyId == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; firewallRuleId == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>), <span class="hljs-string"><span class="hljs-string">"Either a Firewall Policy or Firewall Rule identifier must be set"</span></span>); .... }</code> </pre> <br>  En este m√©todo, el m√©todo <i>checkNotNull</i> verifica que los argumentos sean <i>nulos</i> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@CanIgnoreReturnValue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkNotNull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T reference)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reference == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NullPointerException(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reference; } }</code> </pre> <br>  Despu√©s de verificar el argumento con el m√©todo <i>checkNotNull</i> , puede estar 100% seguro de que el argumento pasado a este m√©todo no es <i>nulo</i> .  Dado que el m√©todo <i>checkNotNull</i> verifica ambos argumentos del m√©todo <i>removeFirewallRuleFromPolicy</i> , no tiene sentido volver a verificar los argumentos para <i>valores</i> <i>nulos</i> .  Sin embargo, se pasa una expresi√≥n al m√©todo <i>checkState</i> como primer argumento, donde los argumentos <i>firewallPolicyId</i> y <i>firewallRuleId se</i> vuelven a verificar para que sean <i>nulos</i> . <br><br>  Se emite una advertencia similar para <i>firewallRuleId</i> : <br><br><ul><li>  V6007 La expresi√≥n 'firewallRuleId == null' siempre es falsa.  FirewallPolicyServiceImpl.java (125) </li></ul><br>  <a href="https://www.viva64.com/ru/w/v6007/">V6007 La</a> expresi√≥n 'filteringParams! = Null' siempre es verdadera.  NetworkPolicyServiceImpl.java (60) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Invocation&lt;NetworkServicePolicies&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildInvocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, String&gt; filteringParams)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filteringParams == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> servicePoliciesInvocation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filteringParams != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... } return servicePoliciesInvocation; }</span></span></code> </pre> <br>  En este m√©todo, si el argumento <i>filteringParams</i> es <i>nulo</i> , el m√©todo sale y devuelve un valor.  Por lo tanto, la prueba se√±alada por el analizador siempre ser√° verdadera, lo que significa que esta prueba no tiene sentido. <br><br>  Similar ocurre en 13 clases: <br><br><ul><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  PolicyRuleServiceImpl.java (58) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  GroupServiceImpl.java (58) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  ExternalSegmentServiceImpl.java (57) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  L3policyServiceImpl.java (57) </li><li>  V6007 La expresi√≥n 'filteringParams! = Null' siempre es verdadera.  PolicyRuleSetServiceImpl.java (58) </li><li>  y as√≠ sucesivamente ... </li></ul><br><h2>  Referencia nula </h2><br>  <a href="https://www.viva64.com/ru/w/v6008/">V6008 Desreferencia</a> potencial nula de 'm.blockDeviceMapping'.  NovaServerCreate.java (390) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ServerCreateBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blockDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BlockDeviceMappingCreate blockDevice)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (blockDevice != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; m.blockDeviceMapping == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { m.blockDeviceMapping = Lists.newArrayList(); } m.blockDeviceMapping.add(blockDevice); <span class="hljs-comment"><span class="hljs-comment">// &lt;= return this; }</span></span></code> </pre> <br>  En este m√©todo, la inicializaci√≥n del campo de referencia <i>m.blockDeviceMapping</i> no ocurrir√° si el argumento <i>blockDevice</i> es <i>nulo</i> .  Este campo se inicializa solo en este m√©todo, por lo que cuando se llama al m√©todo <i>add</i> , el campo <i>m.blockDeviceMapping</i> arrojar√° una <i>NullPointerException</i> . <br><br>  <a href="https://www.viva64.com/ru/w/v6008/">V6008 Desreferencia</a> potencial nula de 'FileId.get (ruta)' en la funci√≥n '&lt;init&gt;'.  TrackedFile.java (140), TrackedFile.java (115) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrackedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FileFlow&lt;?&gt; flow, Path path)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(flow, path, FileId.get(path), ....); }</code> </pre> <br>  El resultado del m√©todo est√°tico <i>FileId.get (ruta)</i> se pasa al constructor de la clase <i>TrackedFile</i> como tercer argumento.  Pero este m√©todo puede devolver <i>nulo</i> : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> FileId </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Path file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Files.exists(file)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } .... }</code> </pre> <br>  En el constructor llamado a trav√©s de <i>esto</i> , el argumento <i>id</i> no cambia hasta que se usa por primera vez: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrackedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., ...., FileId id, ....)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ .... FileId newId = FileId.get(path); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!id.equals(newId)) { .... } }</code> </pre> <br>  Por lo tanto, si se pasa <i>nulo</i> al m√©todo como tercer argumento, se producir√° una excepci√≥n. <br><br>  Una situaci√≥n similar ocurre en otro caso: <br><br><ul><li>  V6008 Desreferencia potencial nula de 'buffer'.  PublishingQueue.java (518) </li></ul><br>  <a href="https://www.viva64.com/ru/w/v6008/">V6008 Desreferencia</a> potencial nula de 'dataTmpFile'.  CacheManager.java (91) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putToCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PutRecordsRequest putRecordsRequest)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataTmpFile == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !dataTmpFile.exists()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { dataTmpFile.createNewFile(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } catch (IOException e) { LOGGER.error("Failed to create cache tmp file, return.", e); return ; } } .... }</span></span></code> </pre> <br>  Y de nuevo NPE.  Una serie de comprobaciones en la declaraci√≥n condicional permiten que el objeto <i>dataTmpFile</i> sea ‚Äã‚Äãnulo para una mayor desreferenciaci√≥n.  Creo que hay dos errores tipogr√°ficos aqu√≠, y la verificaci√≥n deber√≠a ser as√≠: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataTmpFile != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !dataTmpFile.exists())</code> </pre> <br><h2>  Subcadenas y n√∫meros negativos </h2><br>  <a href="https://www.viva64.com/ru/w/v6009/">V6009</a> La funci√≥n 'subcadena' podr√≠a recibir el valor '-1' mientras se espera un valor no negativo.  Examine el argumento: 2. RemoveVersionProjectIdFromURL.java (37) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String url)</span></span></span><span class="hljs-function"> </span></span>{ String urlRmovePojectId = url.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, url.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urlRmovePojectId.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, urlRmovePojectId.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>)); }</code> </pre> <br>  Se entiende que la URL se pasa a este m√©todo como una cadena, que no est√° validada de ninguna manera.  Despu√©s de que esta cadena se recorta varias veces utilizando el m√©todo <i>lastIndexOf</i> .  Si <i>lastIndexOf</i> no encuentra una coincidencia en la cadena, devolver√° -1.  Esto arrojar√° una <i>StringIndexOutOfBoundsException</i> , ya que los argumentos del m√©todo de <i>subcadena</i> deben ser n√∫meros no negativos.  Para que el m√©todo funcione correctamente, debe agregar la validaci√≥n del argumento de entrada o verificar que los resultados de los m√©todos <i>lastIndexOf</i> no sean n√∫meros negativos. <br><br>  Aqu√≠ hay otros lugares donde esto sucede: <br><br><ul><li>  V6009 La funci√≥n 'subcadena' podr√≠a recibir el valor '-1' mientras se espera un valor no negativo.  Examine el argumento: 2. RemoveProjectIdFromURL.java (37) </li><li>  V6009 La funci√≥n 'subcadena' podr√≠a recibir el valor '-1' mientras se espera un valor no negativo.  Examine el argumento: 2. RemoveVersionProjectIdFromURL.java (38) </li></ul><br><h2>  Resultado olvidado </h2><br>  <a href="https://www.viva64.com/ru/w/v6010/">V6010</a> Se requiere utilizar el valor de retorno de la funci√≥n 'concat'.  AKSK.java (278) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildCanonicalHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(URL url)</span></span></span><span class="hljs-function"> </span></span>{ String host = url.getHost(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = url.getPort(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (port &gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>) { host.concat(<span class="hljs-string"><span class="hljs-string">":"</span></span> + Integer.toString(port)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> host; }</code> </pre> <br>  Al escribir este c√≥digo, no se tuvo en cuenta que llamar al m√©todo <i>concat</i> no cambiar√° la cadena de <i>host</i> debido a la inmutabilidad de los objetos de tipo <i>String</i> .  Para que el m√©todo funcione correctamente, debe asignar el resultado del m√©todo <i>concat</i> a la variable del <i>lenguaje principal</i> en el bloque <i>if</i> .  Correctamente: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (port &gt; -<span class="hljs-number"><span class="hljs-number">1</span></span>) { host = host.concat(<span class="hljs-string"><span class="hljs-string">":"</span></span> + Integer.toString(port)); }</code> </pre> <br><h2>  Variables no utilizadas </h2><br>  <a href="https://www.viva64.com/ru/w/v6021/">V6021 La</a> variable 'url' no se usa.  TriggerV2Service.java (95) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAllTriggersForFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String functionUrn)</span></span></span><span class="hljs-function"> </span></span>{ checkArgument(!Strings.isNullOrEmpty(functionUrn), ....); String url = ClientConstants.FGS_TRIGGERS_V2 + ClientConstants.URI_SEP + functionUrn; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deleteWithResponse(uri(triggersUrlFmt, functionUrn)).execute(); }</code> </pre> <br>  En este m√©todo, la variable <i>url</i> no se usa despu√©s de la inicializaci√≥n.  Lo m√°s probable es que la variable <i>url</i> se pase al m√©todo <i>uri</i> como segundo argumento en lugar de <i>functionUrn</i> , ya que la variable <i>functionUrn est√°</i> involucrada en la inicializaci√≥n de la variable <i>url</i> . <br><br><h2>  Argumento no utilizado en constructor </h2><br>  <a href="https://www.viva64.com/ru/w/v6022/">V6022 El</a> par√°metro 'returnType' no se usa dentro del cuerpo del constructor.  HttpRequest.java (68) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpReQuest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span></span>{ .... Class&lt;R&gt; returnType; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HttpRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., Class&lt;R&gt; returnType)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// &lt;= { this.endpoint = endpoint; this.path = path; this.method = method; this.entity = entity; } .... public Class&lt;R&gt; getReturnType() { return returnType; } .... }</span></span></span></span></code> </pre> <br>  En este constructor, olvidaron usar el argumento <i>returnType</i> y asignar su valor al campo <i>returnType</i> .  Por lo tanto, cuando se llama al m√©todo <i>getReturnType</i> , el objeto creado por este constructor devolver√° el valor predeterminado de <i>nulo</i> , aunque lo m√°s probable es que tuviera la intenci√≥n de obtener el objeto que se pas√≥ previamente al constructor. <br><br><h2>  La misma funcionalidad </h2><br>  <a href="https://www.viva64.com/ru/w/v6032/">V6032</a> Es extra√±o que el cuerpo del m√©todo 'enable' sea completamente equivalente al cuerpo de otro m√©todo 'enable'.  ServiceAction.java (32), ServiceAction.java (36) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String binary; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String host; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String binary, String host)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.binary = binary; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.host = host; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ServiceAction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String binary, String host)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// &lt;= return new ServiceAction(binary, host); } public static ServiceAction disable(String binary, String host) { // &lt;= return new ServiceAction(binary, host); } .... }</span></span></code> </pre> <br>  La presencia de dos m√©todos id√©nticos no es un error, pero el hecho de que dos m√©todos realicen la misma acci√≥n es al menos extra√±o.  Mirando los nombres de los m√©todos anteriores, podemos suponer que realizan las acciones opuestas.  De hecho, ambos m√©todos hacen lo mismo: crean y devuelven un objeto <i>ServiceAction</i> .  Lo m√°s probable es que el m√©todo de <i>deshabilitaci√≥n</i> se haya creado copiando el c√≥digo del m√©todo de <i>habilitaci√≥n</i> , pero se olvid√≥ de cambiar el cuerpo del m√©todo. <br><br><h2>  Olvid√© comprobar lo principal </h2><br>  <a href="https://www.viva64.com/ru/w/v6060/">V6060</a> La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (49), DomainService.java (46) <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Domains </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, String&gt; params)</span></span></span><span class="hljs-function"> </span></span>{ Preconditions.checkNotNull(params.get(<span class="hljs-string"><span class="hljs-string">"page_size"</span></span>), ....); Preconditions.checkNotNull(params.get(<span class="hljs-string"><span class="hljs-string">"page_number"</span></span>), ....); Invocation&lt;Domains&gt; domainInvocation = get(Domains.class, uri(<span class="hljs-string"><span class="hljs-string">"/domains"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (params != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... } return domainInvocation.execute(this.buildExecutionOptions(Domains.class)); }</span></span></code> </pre> <br>  En este m√©todo, decidimos verificar el contenido de una estructura de tipo <i>Map</i> para la desigualdad <i>nula</i> .  Para hacer esto, el argumento <i>params</i> llama al m√©todo <i>get</i> dos veces, cuyo resultado se pasa al m√©todo <i>checkNotNull</i> .  Todo parece l√≥gico, ¬°pero no importa c√≥mo!  En <i>if</i> , el argumento <i>params</i> se verifica para <i>nulo</i> .  Despu√©s de lo cual se puede suponer que el argumento de entrada puede ser <i>nulo</i> , pero antes de esta comprobaci√≥n, el m√©todo <i>get ya</i> se llamaba en los <i>par√°metros</i> dos veces.  Si se pasa <i>nulo</i> como argumento a este m√©todo, entonces la primera vez <i>que</i> se llama al m√©todo <i>get</i> , se generar√° una excepci√≥n. <br><br>  Una situaci√≥n similar ocurre en tres lugares m√°s: <br><br><ul><li>  V6060 La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (389), DomainService.java (387) </li><li>  V6060 La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (372), DomainService.java (369) </li><li>  V6060 La referencia de 'params' se utiliz√≥ antes de que se verificara contra nulo.  DomainService.java (353), DomainService.java (350) </li></ul><br><h2>  Conclusi√≥n </h2><br>  Las grandes empresas modernas en estos d√≠as simplemente no pueden prescindir del uso de servicios en la nube.  Una gran cantidad de personas utiliza estos servicios, por lo que incluso el m√°s m√≠nimo error en el servicio puede generar problemas para muchas personas, as√≠ como costos adicionales para que la empresa corrija las consecuencias de este error.  En el desarrollo, siempre es necesario tener en cuenta el factor humano, ya que cualquier persona tarde o temprano comete errores, y este art√≠culo es un ejemplo de esto.  Es por eso que debe usar todas las herramientas posibles para mejorar la calidad del c√≥digo. <br><br>  PVS-Studio ciertamente informar√° a Huawei sobre los resultados de verificar sus servicios en la nube para que los desarrolladores de esta compa√±√≠a puedan estudiarlos con m√°s detalle. <br><br>  El uso √∫nico del an√°lisis de c√≥digo est√°tico demostrado en el art√≠culo no puede mostrar todas sus ventajas.  Puede encontrar informaci√≥n m√°s detallada sobre c√≥mo usar el an√°lisis est√°tico correctamente <a href="https://www.viva64.com/ru/b/0594/">aqu√≠</a> y <a href="https://www.viva64.com/ru/b/0639/">aqu√≠</a> .  Puede descargar el analizador PVS-Studio <a href="https://www.viva64.com/ru/pvs-studio-download/">aqu√≠</a> . <br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/477558/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: Valery Komarov.  <a href="https://habr.com/en/company/pvs-studio/blog/477558/">Huawei Cloud: est√° nublado en PVS-Studio hoy</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477566/">https://habr.com/ru/post/477566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477554/index.html">La zona de dominio .ORG se vende a una empresa privada. El p√∫blico llama a ICANN a rescindir el contrato</a></li>
<li><a href="../477558/index.html">Huawei Cloud: Hoy est√° nublado en PVS-Studio</a></li>
<li><a href="../477560/index.html">Cambia tu mentalidad con SwiftUI</a></li>
<li><a href="../477562/index.html">Dise√±o de interfaz para el juego, dibuja un paquete de iconos</a></li>
<li><a href="../477564/index.html">Clientes complejos: c√≥mo proteger a su equipo de ellos</a></li>
<li><a href="../477568/index.html">El servicio es f√°cil devoluci√≥n incondicional. Correo ruso</a></li>
<li><a href="../477578/index.html">C√≥mo elegir un lenguaje de programaci√≥n para crear una aplicaci√≥n de Android</a></li>
<li><a href="../477580/index.html">Mejores marcos PHP para desarrollo web</a></li>
<li><a href="../477584/index.html">Cl√°sico atemporal: lo que los juegos de acci√≥n modernos deber√≠an aprender de DOOM</a></li>
<li><a href="../477590/index.html">C√≥digo de incrustaci√≥n y el peligro del software pirateado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>