<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏽 🎹 👩🏿‍🔧 Visi robot Raspberry Pi: peta kedalaman 👻 🍉 🗡️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat ini, semua teknologi "drone building" secara aktif semakin murah. Kecuali satu: dapatkan peta ruang di sekitarnya. Ada dua ekstrem: baik lidar ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visi robot Raspberry Pi: peta kedalaman</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388259/"><img src="https://habrastorage.org/files/174/cb5/63e/174cb563ec424e5aabb4fc27afb4ad23.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat ini, semua teknologi "drone building" secara aktif semakin murah. </font><font style="vertical-align: inherit;">Kecuali satu: dapatkan peta ruang di sekitarnya. </font><font style="vertical-align: inherit;">Ada dua ekstrem: baik lidar mahal (ribuan dolar) dan solusi optik untuk membangun peta kedalaman (ratusan dolar), atau solusi yang sangat sepi seperti pengukur jarak ultrasonik. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, muncul ide berdasarkan Raspberry Pi murah dengan satu kamera untuk membuat solusi yang akan berada di ceruk kosong dan akan memungkinkan Anda untuk mendapatkan peta kedalaman "murah". </font><font style="vertical-align: inherit;">Dan untuk melakukan ini dalam bahasa pemrograman sederhana seperti Python, sehingga tersedia bagi pemula untuk bereksperimen. </font><font style="vertical-align: inherit;">Sebenarnya, saya ingin memberi tahu tentang hasil saya. </font><font style="vertical-align: inherit;">Skrip yang dihasilkan dengan sampel foto juga dapat dijalankan di desktop.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kedalaman peta dari satu kamera.</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, beberapa kata tentang bagian optik. Untuk membuat peta kedalaman, dua gambar selalu digunakan - dari kamera kiri dan kanan. Dan kami memiliki raspberry dengan satu kamera. Oleh karena itu, pembagi optik dikembangkan, yang sebagai hasilnya memberikan pasangan stereo ke kamera. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara sederhana - jika Anda melihat foto, maka dari kotak hitam dua mata kamera melihat Anda. Tetapi sebenarnya kameranya adalah satu. Hanya sedikit keajaiban optik.</font></font><br>
<br>
<img src="https://habrastorage.org/files/5b0/c19/5f5/5b0c195f51cb4550b910a49f925b0389.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foto menunjukkan iterasi kedua belas perangkat. </font><font style="vertical-align: inherit;">Butuh waktu lama untuk mendapatkan desain stabil yang andal, yang pada saat yang sama tidak mahal. </font><font style="vertical-align: inherit;">Bagian yang paling sulit adalah cermin internal, yang dibuat sesuai pesanan dengan deposisi vakum aluminium. </font><font style="vertical-align: inherit;">Jika Anda menggunakan cermin standar, di mana lapisan reflektif terletak di bawah kaca, dan tidak di atasnya, maka di persimpangan mereka membentuk celah yang secara radikal merusak seluruh gambar.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang akan kita kerjakan</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar raspberry dari Wheezy Raspbian diambil sebagai basis, Python 2.7 dan OpenCV 2.4 diinstal, well, paket yang diperlukan untuk hal-hal kecil - matplotlib, numpy dan lainnya. </font><font style="vertical-align: inherit;">Segala macam dan tautan ke gambar kartu yang telah selesai diletakkan di akhir artikel. </font><font style="vertical-align: inherit;">Deskripsi skrip dalam bentuk pelajaran dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situs web proyek</font></font></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mempersiapkan gambar untuk membangun peta mendalam</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena solusi kami tidak terbuat dari logam dan tanpa optik ultra-presisi, penyimpangan kecil dari geometri ideal dimungkinkan sebagai hasil perakitan. </font><font style="vertical-align: inherit;">Plus, kamera terpasang ke perangkat dengan sekrup, sehingga posisinya mungkin tidak ideal. </font><font style="vertical-align: inherit;">Masalah dengan lokasi kamera diselesaikan secara manual, dan kompensasi untuk "kelengkungan" dari perakitan struktur akan dilakukan dalam perangkat lunak.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script One - Camera Alignment</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Persimpangan cermin dalam gambar idealnya harus vertikal dan terpusat. </font><font style="vertical-align: inherit;">Sulit melakukannya dengan mata, jadi skrip pertama dibuat. </font><font style="vertical-align: inherit;">Ini hanya menangkap gambar dari kamera dalam mode pratinjau langsung, menampilkannya di layar, dan di tengah overlay menarik garis putih di sepanjang penyelarasan berlangsung. </font><font style="vertical-align: inherit;">Setelah kamera diorientasikan dengan benar, kami mengencangkan sekrup lebih keras dan perakitan selesai.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/Kjx__P1AhKY%3Ffeature%3Doembed&amp;usg=ALkJrhjaLbj0JGyKHjwibp6No5AZGGZu3A" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang menarik dari kode skrip pertama</font></font></b><div class="spoiler_text"><ul>
<li>    – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></li>
<li>           –        ,       cv.imshow()      ,    .       ,     .   ,   ,       .</li>
<li>  –         , ..     .   «»  ,  camera.hflip = True</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script kedua - kita mendapatkan pasangan stereo "bersih"</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar kiri dan kanan kita bergabung di tengah gambar. </font><font style="vertical-align: inherit;">Sambungan dalam foto memiliki lebar bukan-nol - Anda dapat menghilangkannya hanya dengan melepas cermin dari perangkat, yang memperbesar ukuran struktur. </font><font style="vertical-align: inherit;">Kamera raspberry memiliki fokus yang diatur ke tak terhingga, dan objek yang letaknya dekat (dalam kasus kami, ini adalah persimpangan) cukup "kabur". </font><font style="vertical-align: inherit;">Oleh karena itu, Anda hanya perlu memberi tahu skrip, yang menurut kami merupakan zona "buruk", sehingga pasangan stereo dipotong bersih menjadi gambar. </font><font style="vertical-align: inherit;">Skrip kedua dibuat yang menampilkan gambar dan memungkinkan Anda menggunakan tombol untuk menunjukkan zona yang akan dipotong. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begini prosesnya:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/4eCGq_mEot8%3Ffeature%3Doembed&amp;usg=ALkJrhilNw8SEhIo5_xdYKgNIymQVcq-OA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang menarik dari kode skrip kedua</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a></li>
<li> ,  ,     cv2.rectangle().   ,          ,       .  , ,    Enter     .</li>
<li>   ,         .           ,        .</li>
<li>         JSON.    ,   ,      .</li>
<li>   . ,     ,        ,      .       ,      ./src          .        .     pf_1280_720.txt –       ,     .</li>
<li>           ,       .             .       :<br>
<pre><code class="python hljs">loadImagePath = <span class="hljs-string"><span class="hljs-string">""</span></span>
<span class="hljs-comment"><span class="hljs-comment"># loadImagePath = "./src/scene_1280x720_1.png"</span></span></code></pre></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script ketiga - serangkaian foto untuk kalibrasi</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ilmu pengetahuan dasar mengatakan bahwa agar berhasil membangun peta kedalaman, pasangan stereo harus dikalibrasi. Yaitu, semua titik kunci dari gambar kiri harus pada ketinggian yang sama dan di gambar kanan. Dalam situasi ini, fungsi StereoBM, yang merupakan satu-satunya waktu nyata kami, dapat berhasil melakukan tugasnya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk kalibrasi, kita perlu mencetak gambar referensi, membuat serangkaian foto dan memberikannya ke algoritma kalibrasi, yang akan menghitung semua distorsi dan menyimpan parameter untuk mengembalikan gambar ke normal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, cetak " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">papan catur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " dan rekatkan pada permukaan yang rata dan keras. Untuk mempermudah, foto serial dibuat skrip dengan penghitung waktu mundur, yang ditampilkan di atas video. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah yang terlihat seperti skrip fotografi serial di tempat kerja:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/3COWaa2dW8s%3Ffeature%3Doembed&amp;usg=ALkJrhipnDKSoNak7itMx3mOkkyDx8Auug" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang menarik dari kode skrip ke-3</font></font></b><div class="spoiler_text"><ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a></li>
<li>   . ,         . ,     ,   «»  .   ,          –      ,     .          camera.capture ()  ,   use_video_port=True.</li>
<li>       –   camera.annotate_text()          .     5  –           .</li>
<li>-,             ,          ./src</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa "kebenaran" seri yang dibuat sangat penting untuk hasil kalibrasi. </font><font style="vertical-align: inherit;">Beberapa saat kemudian kita akan melihat hasil yang diperoleh dengan mengambil foto yang salah.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 4 - memotong foto pada pasangan stereo</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah serangkaian foto diambil, kami akan membuat skrip layanan lain yang mengambil seluruh rangkaian foto yang dibuat dan memotongnya menjadi pasangan gambar - kiri dan kanan, dan menyimpan pasangan ke folder ./pairs Melihat potongan berpotongan memungkinkan kita untuk mengevaluasi seberapa baik kita mengatur penghapusan defocused. zona di tengah gambar. </font><font style="vertical-align: inherit;">Skripnya cukup biasa, jadi saya sembunyikan videonya di bawah spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh karya dan tautan ke sumber skrip ke-4</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">4- </a></li>
<li>    :<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/NvzUPVe2qvo%3Ffeature%3Doembed&amp;usg=ALkJrhgcVMojHQ_tTw9XVgIs6Y_CZg_KJQ" frameborder="0" allowfullscreen=""></iframe></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yang paling menarik adalah kalibrasi, skrip kelima </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Skrip kalibrasi mengumpankan semua pasangan stereo dari folder ./src ke fungsi kalibrasi dan mempertimbangkannya. </font><font style="vertical-align: inherit;">Setelah kerja kerasnya (untuk 15 gambar 1280x720 pada raspberry pertama yang dibutuhkan sekitar 5 menit), ia mengambil pasangan stereo terakhir, "mengoreksi" gambar (memperbaiki) dan menunjukkan versi yang sudah diperbaiki dengan mana Anda dapat membangun peta kedalaman. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begini tampilannya skrip dalam pekerjaan:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/mktMyDSskRM%3Ffeature%3Doembed&amp;usg=ALkJrhixL_sW80FWgJL3cMI77dP3UxsKOw" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang menarik dari kode skrip ke-5</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a></li>
<li>     StereoVision. ,       ,       ,         «» .</li>
<li>                ,     .    .     «» ,    ,   </li>
<li><pre><code class="python hljs">calibrator.add_corners((imgLeft, imgRight), <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code></pre>  True  False –    ,    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ada yang salah."</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada kalanya hasil kalibrasi tidak terduga. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah beberapa contoh yang mencolok: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ff2/0f1/11f/ff20f111fa8e4a59a068fb054bc13831.jpg" alt="Peta disparitas buruk"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, kalibrasi adalah momen yang menentukan. </font><font style="vertical-align: inherit;">Apa yang kita dapatkan pada tahap membangun peta kedalaman secara langsung tergantung pada kualitasnya. </font><font style="vertical-align: inherit;">Setelah sejumlah besar percobaan, daftar persyaratan pemotretan berikut ini tampak:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar catur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> boleh sejajar dengan bidang foto - selalu pada sudut yang berbeda. </font><font style="vertical-align: inherit;">Tetapi bahkan tanpa fanatisme - jika Anda memegang papan hampir tegak lurus terhadap bidang foto, maka skrip tidak akan menemukan catur di dalam gambar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cahaya, cahaya yang bagus. </font><font style="vertical-align: inherit;">Dalam pencahayaan ruangan rendah, dan bahkan ketika mengeluarkan gambar dari video, kualitas gambar menurun. </font><font style="vertical-align: inherit;">Dalam kasus saya, cahaya dalam 90% kasus segera memperbaiki situasi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet menulis bahwa dewan harus menempati ruang maksimum dalam gambar bila memungkinkan. </font><font style="vertical-align: inherit;">Sangat membantu.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah yang terlihat seperti pasangan stereo "tetap" dengan hasil kalibrasi yang baik:</font></font><br>
<br>
<img src="https://habrastorage.org/files/b1a/080/c51/b1a080c51edc481685ad2ec4c266791f.jpg" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 6 - upaya pertama untuk membangun peta mendalam</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seakan semuanya sudah siap - Anda sudah bisa membangun peta yang dalam. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami </font><font style="vertical-align: inherit;">memuat hasil kalibrasi, mengambil foto dan dengan berani membangun peta kedalaman menggunakan cv2.StereoBM </font><font style="vertical-align: inherit;">Kami </font><font style="vertical-align: inherit;">mendapatkan </font><font style="vertical-align: inherit;">sesuatu seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/files/038/1a8/87f/0381a887fa0c4e1eac31f2e810b0ee78.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya tidak terlalu mengesankan, jelas kami perlu memutar sesuatu. </font><font style="vertical-align: inherit;">Baiklah, mari lanjutkan untuk menyempurnakan tuning pada skrip ke-7 berikutnya. </font><font style="vertical-align: inherit;">Di sana kita akan menggunakan bukan 10 parameter untuk konstruksi, seperti pada StereoBM (), tetapi hampir 10, yang jauh lebih menarik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah sumber-sumber </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skrip ke-6</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script 7 - depth map dengan pengaturan tingkat lanjut </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika parameter bukan 2 tetapi 10, maka memilah-milah pilihan mereka dengan restart skrip yang salah adalah salah. </font><font style="vertical-align: inherit;">Oleh karena itu, skrip dibuat untuk penyetelan interaktif kedalaman peta yang interaktif. </font><font style="vertical-align: inherit;">Tugasnya bukan untuk menyulitkan kode dengan antarmuka, jadi semuanya dilakukan pada matplotlib. </font><font style="vertical-align: inherit;">Gambar antarmuka di matplotlib pada raspberry cukup lambat, jadi saya biasanya mentransfer folder yang berfungsi dari raspberry ke laptop dan memilih parameter di sana. </font><font style="vertical-align: inherit;">Begini cara kerja skrip:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/cNpMje5AKTQ%3Ffeature%3Doembed&amp;usg=ALkJrhhRpF_0VxfY7iPETc_AMRBWgbG1Uw" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah Anda memilih parameter, skrip dengan tombol Simpan menyimpan hasilnya ke file 3dmap_set.txt dalam format JSON.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang menarik dari kode skrip ke-7</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">7- </a></li>
<li>       . ,   -     ,        .</li>
<li>   ,         . , numOfDisparities    16,            .           update(val),            .   numOfDisparities    65.57     64.         ,            .</li>
<li>      matplotlib       ,     .</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pekerjaan praktis dengan peta kedalaman menunjukkan bahwa, pertama-tama, Anda perlu memilih parameter minDisparity, dan bersamaan dengan itu numOfDisparities. </font><font style="vertical-align: inherit;">Nah, ingat bahwa numOfDisparities sebenarnya berubah secara terpisah, dengan langkah 16. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah mengatur pasangan ini, Anda dapat bermain-main dengan parameter lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fitur pengaturan kartu sudah menjadi masalah selera pengguna, dan tergantung pada tugas yang diselesaikan. </font><font style="vertical-align: inherit;">Anda dapat membawa peta ke sejumlah besar bagian kecil atau menampilkan area yang diperbesar. </font><font style="vertical-align: inherit;">Untuk menghindari rintangan oleh robot secara sederhana, yang kedua lebih cocok. </font><font style="vertical-align: inherit;">Untuk titik cloud, yang pertama, tetapi masalah kinerja muncul di sini (kami akan kembali kepada mereka).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang ingin kita lihat?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, mungkin salah satu poin terpenting adalah penyesuaian "rabun jauh" dari perangkat kita. </font><font style="vertical-align: inherit;">Saat mengatur peta kedalaman, saya biasanya menempatkan satu objek pada jarak sekitar 30 cm, yang kedua dalam satu meter, dan sisanya dua meter. </font><font style="vertical-align: inherit;">Dan ketika mengatur dua parameter pertama (minDisparity dan numOfDisparities) di skrip ke-7, saya mencapai yang berikut:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objek terdekat (30 cm) - merah</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obyek dalam setengah meter - kuning atau hijau</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objek 2-3 meter - hijau atau biru muda</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya, kami mendapatkan sistem yang dikonfigurasikan untuk mengenali zona "dekat" hambatan dalam radius 5-10 meter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bekerja dengan video on the fly - script 8, final</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, sekarang kami memiliki sistem kustom yang sudah jadi, dan kami harus mendapatkan hasil yang praktis. </font><font style="vertical-align: inherit;">Kami mencoba membangun peta mendalam secara real time menggunakan video dari kamera kami, dan menunjukkannya secara real time saat pembaruan.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.youtube.com/embed/-qTayRg8skA%3Ffeature%3Doembed&amp;usg=ALkJrhgEhGDyJBqRMfkHe6dgRXJmVBXLMg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang menarik dari kode skrip ke-8</font></font></b><div class="spoiler_text">  –   .   ,     ,        overlay.      ,  :<br>
<br>
<ul>
<li>Overlay        R, G  B,      -   .    grayscale   </li>
<li><pre><code class="python hljs">disparity_color = cv2.applyColorMap(disparity_grayscale, cv2.COLORMAP_JET)</code></pre></li>
<li>  overlay    RGB,     BGR –        cv2.cvtColor()</li>
<li>Overlay      16.     16 —    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam perlombaan untuk kecepatan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, pengukuran pertama dilakukan pada Raspberry pertama dengan prosesor single-core. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 detik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - membangun peta pada gambar 1280x720 Ini sangat banyak. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5 detik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pada Raspberry Pi 2, sudah lebih baik. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisis menunjukkan bahwa dalam kasus ini, hanya satu inti yang digunakan pada raspberry kedua. Kekacauan! Saya membangun kembali OpenCV menggunakan perpustakaan paralelisasi TBB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5 detik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - peluncuran pada raspberry kedua menggunakan multi-core. Faktanya, ternyata hanya 2 core yang digunakan - ini masih harus diutak-atik. Ternyata </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bukan saja saya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menemukan masalah ini </font><font style="vertical-align: inherit;">, jadi masih ada ruang untuk bergerak.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dilihat oleh algoritma, kecepatan operasi harus secara linear tergantung pada ukuran data yang diproses. </font><font style="vertical-align: inherit;">Karena itu, jika Anda mengurangi resolusi sebanyak 2 kali, maka secara teoritis semuanya akan bekerja 4 kali lebih cepat. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3 detik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , atau sekitar 3-4 FPS - dengan resolusi 640x360 yang dikurangi setengahnya. </font><font style="vertical-align: inherit;">Teorinya dikonfirmasi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rencana selanjutnya</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, saya ingin mendapatkan yang terbaik dari multicore raspberry kedua. </font><font style="vertical-align: inherit;">Saya akan melihat lebih dekat sumber-sumber fungsi StereoBM dan mencoba memahami mengapa pekerjaan tidak berjalan sepenuhnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tahap selanjutnya menjanjikan lebih banyak petualangan - ini adalah penggunaan raspberry GPU untuk mempercepat perhitungan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiga jalur yang mungkin diambil di sini:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>      GPU,     10 FPS,      .     —  ,     « »   OpenCV,    .</li>
<li>        Koichi Nakamura,    GPU    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a>.  ,     -  OpenCV,     . </li>
<li>              Jan Newmarch "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Programming AudioVideo on the Raspberry Pi GPU</a>" </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memiliki pengalaman bekerja dengan TBB untuk Raspberry OpenCV, atau Anda berurusan dengan pengkodean untuk raspberry GPU, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saya akan berterima kasih atas petunjuk tambahan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya berhasil menemukan beberapa perkembangan siap pakai untuk satu alasan sederhana - raspberry dengan dua kamera adalah kejadian yang jarang terjadi. </font><font style="vertical-align: inherit;">Jika Anda mengaitkan dua webcam melalui USB, maka rem besar datang, dan hanya Raspberry Pi Compute yang dapat bekerja dengan dua kamera asli, yang juga membutuhkan papan pengukur yang besar dengan tali dan adaptor.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan yang bermanfaat:</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Skrip yang berfungsi:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumber</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> semua 8 skrip di github</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar Kartu ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,6GB dalam arsip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menyiapkan OpenCV dan Python di raspberry:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blog luar biasa "python-OpenCV-shnik" dan panduan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk menyiapkan Python dan OpenCV di raspberry</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perpustakaan StereoVision:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">Garpu</font></a><font style="vertical-align: inherit;"> kerja saya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asli oleh Egret </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskripsi penulis StereoVision di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog-nya</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kerja GPU</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jepang Koichi Nakamura </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">di github</font></a><font style="vertical-align: inherit;"> - assembler untuk python untuk GPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan Newmarch Book " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memprogram Audio Video pada Raspberry Pi GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda perlu bekerja dengan kamera raspberry Like a Boss: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">Dokumentasi</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Picamera</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, sebuah artikel menarik tentang habr tentang " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk mengenali gambar, Anda tidak perlu mengenali gambar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id388259/">https://habr.com/ru/post/id388259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id388243/index.html">Pengawasan rumah dan penglihatan jarak jauh melalui Internet</a></li>
<li><a href="../id388245/index.html">Telepon modular pertama mulai dijual</a></li>
<li><a href="../id388247/index.html">Cassini terbang di sebelah Enceladus untuk terakhir kalinya</a></li>
<li><a href="../id388253/index.html">Pada 2015, Kosta Rika menerima sekitar 99% listriknya dari sumber terbarukan.</a></li>
<li><a href="../id388257/index.html">DIY порошок для посудомойки: разбираем промышленные средства и улучшаем рецепт</a></li>
<li><a href="../id388261/index.html">Memoar robot manusiawi, bab 3-4</a></li>
<li><a href="../id388263/index.html">Kesalahpahaman tentang Semesta [Voiceover Vert Dider]</a></li>
<li><a href="../id388265/index.html">Modem Wi-Fi untuk Commodore - seperti apa tampilannya?</a></li>
<li><a href="../id388267/index.html">Kami terbang dan duduk dengan Falcon 9R</a></li>
<li><a href="../id388271/index.html">Kruglendar 2016 - poster buku harian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>