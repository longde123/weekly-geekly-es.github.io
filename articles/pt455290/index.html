<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶â ‚ÜîÔ∏è üîΩ O Guia Completo para Prometeu em 2019 ‚ÜòÔ∏è üò© üò≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os engenheiros do DevOps e do SRE provavelmente j√° ouviram falar de Prometheus mais de uma vez. 


 O Prometheus foi criado no SoundCloud em 2012 e de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O Guia Completo para Prometeu em 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/455290/"><p><img src="https://habrastorage.org/webt/sw/aw/et/swawetpfrgxw6k0m4bb960d3q2c.jpeg"></p><br><p>  <strong>Os engenheiros do DevOps e do SRE</strong> provavelmente j√° ouviram falar de <strong>Prometheus</strong> mais de uma vez. </p><br><p>  O Prometheus foi criado no SoundCloud em 2012 e desde ent√£o se tornou o padr√£o para <strong>sistemas de monitoramento</strong> .  Possui c√≥digo-fonte completamente aberto, fornece dezenas de diferentes exportadores com os quais voc√™ pode configurar o <strong>monitoramento de toda a infraestrutura em</strong> <strong>minutos</strong> . </p><br><p>  O Prometheus tem um valor √≥bvio e j√° est√° sendo usado por inovadores da ind√∫stria como DigitalOcean ou Docker como parte de um sistema completo de monitoramento. </p><br><p>  <em>O que √© Prometeu?</em> <em><br></em>  <em>Por que √© necess√°rio?</em> <em><br></em>  <em>Como √© diferente de outros sistemas?</em> </p><br><p> Se voc√™ n√£o sabe nada sobre o Prometheus ou deseja entend√™-lo melhor, seu ecossistema e todas as intera√ß√µes, <strong>este artigo √© apenas para voc√™</strong> . </p><a name="habracut"></a><br><p>  Dividimos este guia em 3 partes, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como fizemos com o InfluxDB</a> . </p><br><ul><li>  Primeiro, vem uma vis√£o completa do <strong>Prometheus</strong> , seu ecossistema e os principais aspectos da tecnologia em ritmo acelerado. </li><li>  Em seguida, s√£o fornecidas <strong>explica√ß√µes sobre os termos t√©cnicos do Prometheus</strong> .  Se voc√™ n√£o sabe o que s√£o m√©tricas, r√≥tulos, inst√¢ncias ou exportadores, aqui est√° voc√™. </li><li>  Por fim, descrevemos v√°rios <strong>cen√°rios do mundo real para o uso do Prometheus</strong> .  Aqui voc√™ ser√° inspirado por exemplos de empresas de sucesso. </li></ul><br><h2 id="chast-i-chto-takoe-prometheus">  Parte I. O que √© Prometeu? </h2><br><p>  Prometheus √© um banco de dados de s√©ries temporais.  Se voc√™ n√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">souber o</a> que √© um banco de dados de s√©ries temporais, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">leia a primeira parte do manual do InfluxDB</a> . </p><br><p>  Mas Prometheus n√£o √© apenas um banco de dados de s√©ries temporais. </p><br><p>  Voc√™ pode anexar um <strong>ecossistema inteiro de ferramentas</strong> para expandir a funcionalidade. </p><br><p>  O Prometheus <strong>monitora uma ampla variedade de sistemas</strong> : servidores, bancos de dados, m√°quinas virtuais individuais e quase tudo. </p><br><p>  Para fazer isso, <strong>Prometheus periodicamente raspa seus alvos</strong> . </p><br><p>  <em>O que √© raspagem?</em> </p><br><p>  O Prometheus <strong>recupera m√©tricas por meio de chamadas HTTP</strong> para pontos de extremidade espec√≠ficos especificados na configura√ß√£o do Prometheus. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/bu/li/99/buli99giwtpiuq88n9e3xc1b6ng.png"></a> </p><br><p>  Pegue, por exemplo, o aplicativo Web localizado em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 3000</a> .  O aplicativo transmite m√©tricas em formato de texto para algum URL.  Vamos dizer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 3000 / metrics</a> . </p><br><p>  Nesse endere√ßo, o Prometheus <strong>recupera dados</strong> do destino em intervalos espec√≠ficos. </p><br><h3 id="1-kak-rabotaet-prometheus">  1. Como o Prometheus funciona? </h3><br><p>  Como dissemos, o Prometheus consiste em uma ampla variedade de componentes. </p><br><p>  Primeiro, voc√™ precisa extrair m√©tricas de seus sistemas.  Existem diferentes maneiras: </p><br><ul><li>  <strong>Instrumenta√ß√£o do</strong> aplicativo, ou seja, seu aplicativo fornecer√° m√©tricas compat√≠veis com o Prometheus no URL especificado.  O Prometheus o identificar√° como o destino e o descartar√° no intervalo especificado. </li><li>  Uso de <strong>exportadores prontos</strong> .  Prometheus tem uma cole√ß√£o de exportadores de tecnologias existentes.  Por exemplo, exportadores prontos para monitorar m√°quinas Linux ( <em>Node Exporter</em> ), bancos de dados comuns ( <em>SQL Exporter</em> ou <em>MongoDB Exporter</em> ) e at√© mesmo para balanceadores de carga HTTP (por exemplo, <em>HAProxy Exporter</em> ). </li><li>  Usando o <strong>Pushgateway</strong> .  √Äs vezes, aplicativos ou tarefas n√£o fornecem m√©tricas diretamente.  Eles podem n√£o ter sido projetados para isso (por exemplo, tarefas em lote) ou voc√™ mesmo decidiu n√£o fornecer m√©tricas diretamente por meio do aplicativo. </li></ul><br><p>  Como voc√™ j√° entendeu, o <strong>Prometheus coleta os pr√≥prios dados</strong> (exceto os casos raros em que usamos o Pushgateway). </p><br><p> <a href=""><img src="https://habrastorage.org/webt/x8/x5/xl/x8x5xlzryccoxhuk0ly10m4z0ky.png"></a> </p><br><p>  <em>O que isso significa?</em> <em><br></em>  <em>Por que isso √© necess√°rio?</em> </p><br><h3 id="2-sbor-vs-otpravka">  2. Cole√ß√£o vs.  enviando </h3><br><p>  O Prometheus tem uma diferen√ßa not√°vel em rela√ß√£o a outros bancos de dados de s√©ries temporais: <strong>ele verifica ativamente os destinos para obter m√©tricas deles</strong> . </p><br><p>  O InfluxDB, por exemplo, funciona de maneira diferente: voc√™ <strong>envia dados</strong> diretamente <strong>para voc√™</strong> mesmo. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/hp/f5/of/hpf5ofsciuwl0z2jjymkfh9dbi0.png"></a> </p><br><p>  Ambas as abordagens t√™m seus pr√≥s e contras.  Com base na documenta√ß√£o dispon√≠vel, compilamos uma lista de raz√µes pelas quais os criadores do Prometheus escolheram essa arquitetura: </p><br><ul><li>  <strong>Controle centralizado</strong> .  Se o Prometheus enviar solicita√ß√µes para destinos, realizaremos toda a configura√ß√£o no lado do Prometheus, n√£o nos sistemas individuais. </li></ul><br><p>  Prometeu decide <strong>onde</strong> e com <strong>que frequ√™ncia</strong> raspar. </p><br><p>  Se os pr√≥prios objetos enviarem dados, existe o risco de haver muitos desses dados e o servidor travar.  Quando o sistema coleta dados, voc√™ pode <strong>controlar a frequ√™ncia da coleta</strong> e criar v√°rias configura√ß√µes de raspagem para selecionar uma <strong>frequ√™ncia diferente para diferentes objetos</strong> . </p><br><ul><li>  Prometheus armazena <strong>m√©tricas agregadas</strong> . </li></ul><br><p>  Esta √© uma adi√ß√£o √† primeira parte em que discutimos o papel de Prometeu. </p><br><p>  O Prometheus n√£o √© baseado em eventos e √© muito diferente de outros bancos de dados de s√©ries temporais.  Ele n√£o intercepta eventos individuais com limite de tempo (por exemplo, interrup√ß√µes de servi√ßo), <strong>mas coleta m√©tricas pr√©-agregadas sobre seus servi√ßos</strong> . </p><br><p>  Especificamente, o servi√ßo da web n√£o envia uma mensagem de erro 404 e uma mensagem com a causa do erro.  √â enviada uma mensagem informando que o servi√ßo recebeu uma mensagem de erro 404 nos √∫ltimos cinco minutos. </p><br><p>  Essa √© a principal diferen√ßa entre os bancos de dados de s√©ries temporais que coletam m√©tricas agregadas e os que coletam m√©tricas brutas. </p><br><h3 id="3-razvitaya-ekosistema-prometheus">  3. Desenvolvido o ecossistema de Prometheus </h3><br><p>  Essencialmente, o Prometheus √© um banco de dados de s√©ries temporais. </p><br><p>  Por√©m, ao trabalhar com esses bancos de dados, voc√™ geralmente precisa <strong>visualizar os</strong> dados, <strong>analis√°-</strong> los e configurar <strong>alertas</strong> para eles. </p><br><p>  O Prometheus suporta as seguintes ferramentas que expandem sua funcionalidade: </p><br><ul><li>  <strong>Alertmanager</strong> .  O Prometheus envia alertas para o Alertmanager com base nas regras personalizadas definidas nos arquivos de configura√ß√£o.  A partir da√≠, eles podem ser exportados para diferentes pontos de extremidade (por exemplo, Pagerduty ou Slack). </li><li>  <strong>Visualiza√ß√£o de dados</strong> .  Como o Grafana, voc√™ pode visualizar s√©ries temporais diretamente na interface do usu√°rio da web do Prometheus.  Voc√™ pode filtrar os dados e criar revis√µes espec√≠ficas do que est√° acontecendo em diferentes destinos. </li><li>  <strong>Descoberta de servi√ßo</strong> .  O Prometheus detecta dinamicamente os alvos e raspa automaticamente novos alvos, mediante solicita√ß√£o.  Isso √© especialmente conveniente se voc√™ trabalha com cont√™ineres que alteram dinamicamente endere√ßos com base na demanda. </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/vn/v8/hw/vnv8hwhdgfwge_zr4fpijo-dw6w.png"></a> </p><br><p><img src="https://habrastorage.org/webt/c0/i6/9g/c0i69gzbicfmvsaangv6g5-4jpa.png"></p><br><h2 id="chast-ii-koncepcii-prometheus">  Parte II  Conceitos de Prometeu </h2><br><p>  Como no manual do InfluxDB, explicaremos em detalhes <strong>os termos t√©cnicos</strong> relacionados ao Prometheus. </p><br><h3 id="1-model-dannyh-klyuch-znachenie">  1. Modelo de dados de valor-chave </h3><br><p>  Antes de passar para as ferramentas do Prometheus, √© importante entender completamente esse modelo de dados. </p><br><p>  Prometheus trabalha com <strong>pares de valores-chave</strong> .  A chave descreve o que estamos medindo e o valor armazena o valor real como um n√∫mero. </p><br><blockquote>  Lembre-se: O Prometheus n√£o foi projetado para armazenar informa√ß√µes brutas, como texto sem formata√ß√£o.  Ele armazena m√©tricas agregadas ao longo de um per√≠odo de tempo. </blockquote><p>  A chave neste caso √© chamada de <strong>m√©trica</strong> .  Por exemplo, velocidade do processador ou uso de mem√≥ria. </p><br><p>  <em>Mas e se voc√™ precisar de mais detalhes sobre a m√©trica?</em> <em><br></em>  <em>Por exemplo, o processador possui 4 n√∫cleos e precisamos de 4 m√©tricas separadas?</em> </p><br><p>  E aqui atalhos v√™m para o resgate.  Os atalhos fornecem mais informa√ß√µes sobre m√©tricas adicionando campos adicionais.  Por exemplo, voc√™ descreve n√£o apenas a velocidade do processador, mas a velocidade de um n√∫cleo em um IP espec√≠fico. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/k3/an/wz/k3anwzmbgecefriltntgwfkge3o.png"></a> </p><br><p>  Em seguida, voc√™ pode filtrar as m√©tricas por r√≥tulos e visualizar apenas as informa√ß√µes necess√°rias. </p><br><h3 id="2-tipy-metrik">  2. Tipos de m√©tricas </h3><br><p>  Ao monitorar com o Prometheus, as m√©tricas podem ser descritas de quatro maneiras.  √â melhor ler at√© o fim, porque existem <strong>armadilhas</strong> aqui. </p><br><h3 id="schetchik">  Contador </h3><br><p>  Este √© provavelmente o tipo mais simples de m√©trica.  O contador, como o nome indica, <strong>conta os elementos por um per√≠odo de tempo</strong> . </p><br><p>  Se voc√™ quiser contar, por exemplo, erros de HTTP em servidores ou visitar um site, use um <strong>contador</strong> . </p><br><p>  E logicamente, √© claro, o <strong>contador s√≥ pode aumentar ou zerar o n√∫mero</strong> , portanto, n√£o √© adequado para valores que podem diminuir ou valores negativos. </p><br><p>  Com sua ajuda, √© especialmente conveniente considerar o <strong>n√∫mero de ocorr√™ncias de um</strong> determinado evento durante um per√≠odo de tempo, ou seja, a taxa de altera√ß√£o da m√©trica ao longo do tempo. </p><br><p>  <em>E se voc√™ precisar medir, digamos, a mem√≥ria usada por um determinado per√≠odo?</em> <em><br></em>  <em>Este valor pode diminuir.</em>  <em>Como contar com Prometheus?</em> </p><br><h3 id="izmeriteli">  Metros </h3><br><p>  <strong>Conhe√ßa os medidores!</strong> </p><br><p>  Os medidores lidam com valores que <strong>podem diminuir com o tempo</strong> .  Eles podem ser comparados com term√¥metros - se voc√™ olhar para o term√¥metro, veremos a temperatura atual. </p><br><p>  <em>Mas se os medidores podem aumentar e diminuir e assumir valores positivos e negativos, ent√£o eles s√£o melhores do que contadores?</em> <em><br></em>  <em>Ent√£o os contadores s√£o in√∫teis?</em> </p><br><p>  No come√ßo, eu pensei que sim.  Como eles podem fazer tudo, vamos us√°-los em qualquer lugar.  Isso √© l√≥gico? </p><br><h3 id="a-vot-i-net">  Mas n√£o. </h3><br><p>  Os medidores s√£o ideais para medir o valor atual da m√©trica, que pode diminuir com o tempo. </p><br><p>  √â aqui que est√£o as mesmas armadilhas: o medidor n√£o mostra o desenvolvimento da m√©trica por um per√≠odo de tempo.  Usando medidores, <strong>voc√™ pode perder altera√ß√µes irregulares de m√©trica ao longo do tempo</strong> . </p><br><p>  Porque  Aqui est√° o que <em>/ u / justinDavidow diz</em> : </p><br><blockquote>  ‚ÄúO medidor mostra o valor m√©dio do contador delta para uma unidade durante um per√≠odo de tempo. <br><br>  O contador leva em considera√ß√£o cada unidade usada (se for um processador, opera√ß√µes, ciclos ou ticks) e, em seguida, voc√™ pode escolher quais indicadores para qual per√≠odo precisa. <br><br>  Se voc√™ estiver usando um medidor, a taxa de amostragem deve ser precisa.  Se a frequ√™ncia diferir em pelo menos alguns microssegundos, o valor n√£o ser√° confi√°vel.  "Isso √© ainda mais vis√≠vel sob carga pesada, onde o tempo entre as medi√ß√µes aumenta exponencialmente, porque o planejador do sistema n√£o tem tempo para prestar aten√ß√£o ao aplicativo de monitoramento". </blockquote><p>  Se o sistema enviar m√©tricas a cada 5 segundos e o Prometheus raspar o alvo a cada 15, algumas m√©tricas poder√£o ser perdidas no processo.  Se voc√™ realizar c√°lculos adicionais com essas m√©tricas, a precis√£o dos resultados ser√° ainda menor. </p><br><p>  No balc√£o, cada valor √© agregado.  Quando Prometeu o coleta, ele percebe que o valor foi enviado em um determinado intervalo. </p><br><p>  Agora n√£o fique confuso. </p><br><h3 id="gistogramma">  Gr√°fico de barras </h3><br><p>  Um histograma √© um tipo de m√©trica mais complexo.  Fornece informa√ß√µes adicionais.  Por exemplo, a soma das medi√ß√µes e seu n√∫mero. </p><br><p>  Os valores s√£o coletados em uma √°rea com um limite superior personalizado.  Portanto, um histograma pode: </p><br><ul><li>  <strong>Calcular valores m√©dios</strong> , ou seja, a soma dos valores divididos pelo n√∫mero de valores. </li><li>  <strong>Calcule medidas relativas de valores</strong> , e isso √© muito conveniente se voc√™ precisar descobrir quantos valores em uma determinada √°rea correspondem aos crit√©rios especificados.  Isso √© especialmente √∫til se voc√™ precisar rastrear propor√ß√µes ou definir indicadores de qualidade. </li></ul><br><p>  No mundo real, eu gostaria de ser notificado se 20% dos meus servidores tiverem uma resposta de mais de 300 ms ou uma resposta de servidor de mais de 300 ms em mais de 20% do tempo. </p><br><p>  Se voc√™ est√° lidando com propor√ß√µes, <strong>precisa de histogramas</strong> . </p><br><h3 id="svodki">  Sum√°rio </h3><br><p>  Os pain√©is <strong>s√£o histogramas avan√ßados</strong> .  Eles tamb√©m mostram a soma e o n√∫mero de medi√ß√µes, e tamb√©m <strong>quantis para o per√≠odo m√≥vel</strong> . </p><br><p>  Quantiles, se houver, est√£o dividindo a densidade de probabilidade em segmentos de igual probabilidade. </p><br><p>  <em>Ent√£o: gr√°ficos de barra ou resumos?</em> </p><br><p>  Tudo depende da <strong>inten√ß√£o</strong> . </p><br><p>  Os histogramas combinam valores ao longo de um per√≠odo de tempo, fornecendo a quantidade e a quantidade pela qual voc√™ pode acompanhar o desenvolvimento de uma determinada m√©trica. </p><br><p>  Os resumos, por outro lado, mostram quantis durante um per√≠odo de movimento (isto √©, desenvolvimento cont√≠nuo ao longo do tempo). </p><br><p>  Isso √© especialmente conveniente se voc√™ precisar conhecer um valor que represente 95% dos valores registrados durante um per√≠odo. </p><br><h3 id="3-zadaniya-i-ekzemplyary">  3. Tarefas e inst√¢ncias </h3><br><p>  Dados os recentes avan√ßos nas arquiteturas distribu√≠das e a popularidade das solu√ß√µes baseadas na nuvem, √© improv√°vel que voc√™ use um √∫nico servidor executando por conta pr√≥pria. </p><br><p>  <strong>Os servidores s√£o replicados e distribu√≠dos pelo mundo.</strong> </p><br><p>  Para ilustrar isso, vejamos a arquitetura cl√°ssica de dois servidores HAProxy que redistribuem a carga em nove servidores Web de back-end ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o, n√£o, n√£o h√° pilhas Stackoverflow</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">.</a> </p><br><p>  Neste exemplo da vida real, rastrearemos o <strong>n√∫mero de erros HTTP retornados pelos servidores da web</strong> . </p><br><p>  No Prometheus, um servidor web √© chamado de <strong>inst√¢ncia</strong> .  <strong>A tarefa</strong> ser√° o fato de voc√™ medir o n√∫mero de erros de HTTP em todas as inst√¢ncias. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/3x/s4/n9/3xs4n94kpfhqg3igmcrlfjatube.png"></a> </p><br><p>  O bom √© que tarefas e inst√¢ncias s√£o campos em r√≥tulos, e voc√™ pode filtrar os resultados por uma inst√¢ncia ou tarefa espec√≠fica. </p><br><h3 id="udobno-zhe">  √â conveniente? </h3><br><h3 id="4-promql">  4. PromQL </h3><br><p>  Se voc√™ usa bancos de dados baseados no InfluxDB, provavelmente j√° est√° familiarizado com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">InfluxQL</a> .  Ou use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SQL no TimescaleDB</a> . </p><br><p>  O Prometheus tamb√©m possui sua pr√≥pria linguagem para consultar e recuperar dados de servidores: <strong>PromQL</strong> . </p><br><p>  Como j√° sabemos, os dados s√£o apresentados na forma de pares de valores-chave.  O PromQL usa a mesma sintaxe e retorna resultados como vetores. </p><br><p>  <em>Que tipo de vetores?</em> </p><br><p>  Existem dois tipos de vetores no Prometheus e no PromQL: </p><br><ul><li>  <strong>Vetores instant√¢neos</strong> que representam todas as m√©tricas pelo √∫ltimo registro de data e hora. </li><li>  <strong>Vetores com um intervalo de tempo</strong> : se voc√™ precisar analisar o desenvolvimento de uma m√©trica ao longo do tempo, poder√° especificar um intervalo de tempo em uma solicita√ß√£o ao Prometheus.  Como resultado, voc√™ obter√° um vetor que combina todos os valores registrados para o per√≠odo selecionado. </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/gs/ih/1_/gsih1_1lvftmhzgzuze3ctrlhci.png"></a> </p><br><p>  A API PromQL fornece um conjunto de fun√ß√µes para opera√ß√µes com dados em consultas. </p><br><p>  Voc√™ pode classificar valores, aplicar fun√ß√µes matem√°ticas a eles (por exemplo, calcular derivadas ou expoentes) e at√© fazer previs√µes (por exemplo, usando o modelo Holt-Winters). </p><br><h3 id="5-instrumentirovanie">  5. Instrumenta√ß√£o </h3><br><p>  <strong>A instrumenta√ß√£o</strong> √© outra parte importante de Prometeu.  Voc√™ instrumenta aplicativos antes de extrair dados deles. </p><br><p>  No Prometheus, instrumenta√ß√£o significa adicionar bibliotecas de clientes ao aplicativo para fornecer m√©tricas do Prometheus. </p><br><p>  A instrumenta√ß√£o est√° dispon√≠vel para as linguagens de programa√ß√£o mais comuns: por exemplo, <strong>Python, Java, Ruby, Go e at√© Node ou C #</strong> . </p><br><p>  Em ess√™ncia, voc√™ cria objetos de mem√≥ria (por exemplo, medidores ou contadores) que aumentam ou diminuem dinamicamente o valor. </p><br><p>  Ent√£o voc√™ escolhe onde fornecer as m√©tricas.  Prometheus ir√° busc√°-los a partir da√≠ e salv√°-los em seu banco de dados de s√©ries temporais. </p><br><p><img src="https://habrastorage.org/webt/xi/-u/xk/xi-uxkqvgontz2729o5rmroyxkk.png"></p><br><h3 id="6-eksportery">  6. Exportadores </h3><br><p>  Nos aplicativos que voc√™ escreveu, √© muito conveniente personalizar as m√©tricas fornecidas e alter√°-las ao longo do tempo usando instrumenta√ß√£o. </p><br><p>  Para aplicativos, servidores e bancos de dados conhecidos, o <strong>Prometheus oferece aos exportadores com os quais voc√™ pode monitorar os destinos</strong> . </p><br><p>  Esses exportadores geralmente s√£o representados como imagens do Docker e s√£o f√°ceis de personalizar.  Eles fornecem um conjunto pronto de m√©tricas e pain√©is frequentemente prontos com os quais voc√™ pode configurar o monitoramento em minutos. </p><br><p>  Exemplos de exportadores: </p><br><ul><li>  <strong>Exportadores</strong> de banco de dados: para bancos de dados MongoDB, servidores SQL e MySQL. </li><li>  <strong>Exportadores HTTP</strong> : para servidores HAProxy, Apache ou NGINX. </li><li>  <strong>Exportadores Unix</strong> : o desempenho do sistema pode ser monitorado usando os exportadores de n√≥ integrados, que fornecem todas as m√©tricas do sistema sem configura√ß√£o adicional. </li></ul><br><p><img src="https://habrastorage.org/webt/7q/fm/uh/7qfmuhfszdwxa-k21na-hpko3tk.png"></p><br><h3 id="para-slov-o-vzaimnoy-sovmestimosti">  Algumas palavras sobre compatibilidade m√∫tua </h3><br><p>  A maioria dos bancos de dados de s√©ries temporais oferece suporte √† interoperabilidade para seus sistemas. </p><br><p>  Prometheus n√£o √© o √∫nico sistema de monitoramento com seus requisitos m√©tricos.  Por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">InfluxDB</a> (via Telegraf), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CollectD</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">StatsD</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nagios</a> tamb√©m t√™m seus pr√≥prios padr√µes. </p><br><p>  Portanto, para a intera√ß√£o de diferentes sistemas, s√£o criados exportadores.  Mesmo que o Telegraf n√£o envie as m√©tricas no formato aceito pelo Prometheus, o Telegraf pode enviar essas m√©tricas ao exportador do InfluxDB, de onde o Prometheus as buscar√°. </p><br><h3 id="7-opovescheniya">  7. Alertas </h3><br><p>  Ao trabalhar com bancos de dados de s√©ries temporais, voc√™ precisa de feedback dos dados, e os gerentes de alerta s√£o respons√°veis ‚Äã‚Äãpor isso. </p><br><p>  No Grafana, os alertas s√£o comuns, mas tamb√©m est√£o dispon√≠veis no Prometheus por meio do gerenciador de alertas. </p><br><p>  <strong>O Alert Manager √© uma ferramenta separada que se une ao Prometheus e lan√ßa sirenes personalizadas</strong> . </p><br><p>  Os alertas s√£o definidos no <strong>arquivo de configura√ß√£o</strong> e definem um conjunto de regras para m√©tricas.  Se a conformidade com a regra ocorrer na s√©rie temporal, um alerta ser√° acionado e enviado aos destinat√°rios especificados. </p><br><p>  Como no Grafana, voc√™ pode especificar o endere√ßo de email, <strong>Slack webhook, PagerDuty e objetos HTTP personalizados</strong> como destinat√°rio. </p><br><p><img src="https://habrastorage.org/webt/0x/xz/gf/0xxzgfpfufej_ro_ztjded5lbys.png"></p><br><h2 id="chast-iii-primery-ispolzovaniya-prometheus">  Parte III  Exemplos de Prometeu </h2><br><p><img src="https://habrastorage.org/webt/rq/6r/zk/rq6rzkeqnwe2xhzpukzx-hjdgi0.png"></p><br><p>  E, √© claro, todo guia deve ter <strong>exemplos pr√°ticos</strong> .  Como eu gostaria de dizer, a tecnologia n√£o √© um fim em si mesma e deve cumprir uma tarefa espec√≠fica. </p><br><p>  N√≥s vamos falar sobre isso. </p><br><h2 id="1-devops">  1. DevOps </h2><br><p>  Com todos esses exportadores para diferentes sistemas, bancos de dados e servidores, √© √≥bvio que o Prometheus se destina principalmente ao <strong>setor de DevOps</strong> . </p><br><p>  Sabemos que existem muitos fornecedores concorrentes e solu√ß√µes personalizadas nessa √°rea. </p><br><p>  <strong>Prometheus √© perfeito para DevOps.</strong> </p><br><p>  N√£o √© preciso quase nenhum esfor√ßo para instalar e executar inst√¢ncias, e voc√™ pode ativar e configurar facilmente qualquer ferramenta auxiliar. </p><br><p>  <strong>Detectando destinos</strong> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por exemplo, atrav√©s de um exportador de arquivos</a> -, √© uma √≥tima solu√ß√£o para pilhas em que os cont√™ineres e arquiteturas distribu√≠das s√£o amplamente utilizados. </p><br><p>  Em um ambiente em que as inst√¢ncias s√£o constantemente criadas e exclu√≠das, nenhuma pilha do DevOps pode ficar sem a <strong>descoberta de servi√ßo</strong> . </p><br><h3 id="2-zdravoohranenie">  2. Sa√∫de </h3><br><p>  Hoje, as solu√ß√µes de monitoramento s√£o necess√°rias n√£o apenas em TI.  Eles tamb√©m s√£o usados ‚Äã‚Äãem grandes ind√∫strias que fornecem arquiteturas de assist√™ncia m√©dica flex√≠veis e escal√°veis. </p><br><p>  A demanda est√° crescendo e as arquiteturas de TI devem cumpri-la.  Se voc√™ n√£o possui uma ferramenta confi√°vel para monitorar toda a infraestrutura, <strong>corre o risco de interrup√ß√µes s√©rias no servi√ßo</strong> .  J√° no setor da sa√∫de, esse perigo deve ser definitivamente minimizado. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este exemplo foi discutido no opensource.com no seguinte artigo</a> . </p><br><h3 id="3-finansovye-uslugi">  3. Servi√ßos financeiros </h3><br><p>  O exemplo mais recente foi dado na confer√™ncia da InfoQ, que discutiu o uso do Prometheus em institui√ß√µes financeiras. </p><br><p>  Jamie Christian e Alan Strader mostram como eles usam o Prometheus para monitorar sua infraestrutura no Northern Trust.  Muito informativo, eu aconselho voc√™ a procurar. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_WQ9DSanFdw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chast-x-chto-dalshe">  Parte X. O que vem a seguir? </h2><br><p><img src="https://habrastorage.org/webt/mt/c6/ox/mtc6oxvnw8qk4fijh1ihciosuwy.png"></p><br><p>  √â hora de passar da <strong>teoria</strong> para a <strong>pr√°tica</strong> . </p><br><p>  Hoje voc√™ se familiarizou com o b√°sico do Prometheus, aprendeu quais fun√ß√µes ele executa, quais ferramentas e sistemas ele trabalha e quais termos ele usa. </p><br><p>  Agora <strong>voc√™ tem tudo o que precisa para criar sua solu√ß√£o de monitoramento</strong> . </p><br><p>  Para come√ßar com o Prometheus, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estude todos os exportadores dispon√≠veis</a> . </p><br><p>  Em seguida, instale as ferramentas necess√°rias, crie seu primeiro painel - e pronto! </p><br><p>  Se voc√™ precisar de inspira√ß√£o, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">leia meu artigo sobre como monitorar uma m√°quina Linux com Prometheus e Grafana</a> .  Existem instru√ß√µes para configurar ferramentas e o primeiro painel. </p><br><p>  Espero que voc√™ tenha aprendido algo novo. </p><br><p>  Se voc√™ tem um t√≥pico para o meu pr√≥ximo artigo, compartilhe-o. </p><br><p>  <strong>Felizmente fique!</strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt455290/">https://habr.com/ru/post/pt455290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt455274/index.html">Microsoft lan√ßa uma iniciativa educacional de larga escala nas universidades russas</a></li>
<li><a href="../pt455280/index.html">Resposta do psiquiatra ao artigo "Doente-saud√°vel"</a></li>
<li><a href="../pt455284/index.html">Alexey Savvateev e teoria dos jogos: "Qual √© a probabilidade de uma bomba at√¥mica ser lan√ßada nos pr√≥ximos cinco anos?"</a></li>
<li><a href="../pt455286/index.html">Dentes da sabedoria: n√£o podem ser removidos</a></li>
<li><a href="../pt455288/index.html">Not√≠cias da semana: bloqueador de an√∫ncios corporativo nas chaves de criptografia Chrome, FSB e Yandex, a comunica√ß√£o est√° ficando mais cara</a></li>
<li><a href="../pt455292/index.html">Como aumentar 4 vezes o tempo de execu√ß√£o de dispositivos com alimenta√ß√£o autom√°tica</a></li>
<li><a href="../pt455294/index.html">Guia: como escolher uma bicicleta el√©trica usando o Twitter como exemplo - falando sobre quadros</a></li>
<li><a href="../pt455302/index.html">Estrutura da API Golang</a></li>
<li><a href="../pt455306/index.html">Respostas √†s suas perguntas sobre por que voc√™ precisa de um editor para publicar um livro</a></li>
<li><a href="../pt455308/index.html">Lugar promissor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>