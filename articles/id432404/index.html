<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏻 🗾 🤟🏻 Cadangan untuk Linux tidak menulis surat ✋🏿 🎏 🎾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 

 Hari ini saya ingin memberi tahu Anda tentang cara mengelola Veeam Agent untuk Linux menggunakan baris perintah, dan tentang kemungk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cadangan untuk Linux tidak menulis surat</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/432404/">  Halo semuanya! <br><br>  Hari ini saya ingin memberi tahu Anda tentang cara mengelola <b>Veeam Agent untuk Linux</b> menggunakan baris perintah, dan tentang kemungkinan apa yang terbuka di tangan terampil seorang programmer. <br><br>  Saya diminta untuk menulis artikel dengan komentar di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> sebelumnya.  Mengutip kejutan pengguna: “Ya, bagaimana bisa begitu?  Server tidak menulis surat yang menyatakan telah disimpan! ”  Selain itu, menurut analis, dia bukan satu-satunya, kalau tidak, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">utasnya</a> tidak akan muncul di forum.  Dan karena orang menulis, itu berarti seseorang membutuhkannya! <br><br>  Dalam artikel tersebut saya akan menjelaskan mengapa fitur ini tidak ada dalam produk.  Tapi kami tidak akan berhenti di situ, kami akan menambahkan fungsi ini!  Kami adalah programmer, jadi kami akan menulis surat dan menghasilkan laporan dalam bentuk halaman html. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8d/yu/df/8dyudfduto6pqilljl-ay1qc2jk.png"></div><br>  Selain itu, saya akan menunjukkan perintah yang paling berguna, menurut saya, yang dapat memfasilitasi pekerjaan administrator. <br><br>  Bersiap-siap: banyak kode, tidak ada gambar. <br><a name="habracut"></a><br>  Pertama, mari kita jawab pertanyaan: "Mengapa Veeam Agent untuk Linux tidak menulis surat?" <br><br>  Anda mungkin tidak suka jawabannya, jangan salahkan saya.  Tetapi kenyataannya adalah bahwa pengguna perusahaan besar atau kecil tidak membutuhkan ini, dan inilah alasannya: <br><br><ul><li> Pertama, untuk bekerja dengan surat, Anda harus meletakkan server smpt di mesin lokal, atau menggunakan seseorang di jaringan.  Dengan implementasi yang paling sederhana (perintah <code>mail</code> ), Anda perlu menginstal paket <i>mailutils</i> .  Dan banyak administrator sistem tidak ingin membuat kerentanan potensial pada server produksi mereka dalam bentuk layanan yang dapat mengirim surat ke mana saja.  Ya, dan kemungkinan tidak disebabkan oleh port yang ditutup, independensi subnet, dan banyak lagi ... </li><li>  Kedua, karena paket <i>mailutils mungkin</i> tidak ada di sistem (untuk alasan pertama), tidak masuk akal untuk mencoba menggunakannya.  Kalau tidak, kita bisa mendapatkan fungsi yang tampaknya ada di sana, tetapi "out of the box" tidak berfungsi, yang berarti bahwa akan ada utas di forum tentang topik seperti: "Cara mengonfigurasi server sehingga surat dikirim." </li><li>  Dan ketiga, secara umum, tidak ada pemberitahuan tambahan yang diperlukan, karena lebih banyak atau lebih sedikit pelanggan perusahaan menggunakan <b>Veeam Backup &amp; Replication</b> .  Konsolnya mengumpulkan informasi tentang semua cadangan yang dibuat untuk repositori terkenal.  Lihat sendiri. <br></li></ul><br>  Dalam versi <b>Veeam Backup &amp; Replication 9.5 Update 4</b> , dimungkinkan untuk menggunakan produk ini secara gratis, tetapi dengan pembatasan pada mesin virtual / fisik yang dilayani. <br>  Jika Anda memiliki hingga 3 server fisik (inklusif) - fungsi VBR gratis akan lebih dari cukup untuk Anda. <br><br>  Jika Anda memiliki lebih dari 3 mesin, tidak ada cara untuk membayar perangkat lunak, tetapi Anda masih ingin memonitor server secara terpusat, saya sarankan menambahkan beberapa skrip sendiri.  Saya suka menghibur diri dengan python setelah bekerja untuk C / C ++. <br><br>  <code>veeamconfig</code> kami akan membungkus <code>veeamconfig</code> perintah <code>veeamconfig</code> .  Tim <code>veeamconfig</code> menyediakan akses ke semua fungsionalitas produk.  Tidak diragukan lagi, antarmuka pseudografis yang dibuat menggunakan <i>perpustakaan ncurses</i> jauh lebih menyenangkan bagi mata, namun, jika Anda perlu menautkan program ke sesuatu yang baru, maka CLI adalah segalanya bagi kami. <br><br>  Deskripsi <b>Veeam Agent untuk</b> perintah <b>Linux</b> valid untuk versi 3.0.  Saya tidak memeriksa versi sebelumnya, jadi mungkin ada perbedaan. <br><br>  Antarmuka CLI di <b>Veeam Agent untuk Linux</b> cukup nyaman dan didokumentasikan dengan baik.  Cukup masukkan <code>veeamconfig --help</code> dan Anda akan mendapatkan daftar perintah yang tersedia: <br><br><pre> <code class="plaintext hljs">$sudo veeamconfig --help Veeam Agent for Linux (c) Veeam Software AG Usage: veeamconfig [command] Commands: repository - Backup repositories management vbrserver - Veeam Backup and Replication servers management job - Backup jobs management backup - Backups management point - Restore points management license - License management agreement - End User License Agreement management config - Import/export configuration schedule - Jobs schedule configuration cloud - Cloud provider management mode - Operation mode session - Sessions management ui - User interface aap - Application-aware processing version, --version, -v - Product version help, --help, -h - Short help</code> </pre><br>  Untuk melihat apa yang setiap perintah memungkinkan Anda lakukan, cukup panggil <code>veeamconfig config --help</code> .  Kami mendapatkan: <br><br><pre> <code class="plaintext hljs">Veeam Agent for Linux (c) Veeam Software AG Usage: veeamconfig config [command] Commands: import - Import repositories and jobs into database export - Export repositories and jobs from database grabLogs - Collect support logs bundle patchiso - Create custom Veeam Recovery Media adding all hardware drivers from this system help, --help, -h - Short help</code> </pre><br>  Di sini, omong-omong, kita bisa melihat <code>grabLogs</code> pengumpulan log <code>grabLogs</code> .  Ini akan memungkinkan Anda untuk dengan cepat mengumpulkan semua log yang diperlukan untuk dukungan.  Ini kalau-kalau terjadi kesalahan. <br><br>  Ada juga tim menarik yang muncul di versi 3.0: <br><br><pre> <code class="plaintext hljs">$ sudo veeamconfig agreement --help Veeam Agent for Linux (c) Veeam Software AG Usage: veeamconfig agreement [command] Commands: acceptEula - Accept Veeam End User License Agreements acceptThirdPartyLicenses - Accept Veeam 3rd party License Agreement show - Show End User License Agreements acceptance status help, --help, -h - Short help</code> </pre><br>  Faktanya adalah bahwa mulai dengan versi 3.0, pengguna diharuskan untuk secara eksplisit menyetujui perjanjian lisensi.  Itu terlihat seperti ini: <br><br><pre> <code class="plaintext hljs">$ sudo veeamconfig job list I accept Veeam Software End User License Agreement: /usr/share/doc/veeam/EULA (yes/no | y/n): yes I accept the terms of the following 3rd party software components license agreements: /usr/share/doc/veeam/3rd_party (yes/no | y/n):</code> </pre><br>  Dengan demikian, operasi skrip Anda dapat terganggu.  Agar tidak memasuki setiap mesin dan tidak melakukan prosedur ini secara manual, perintah berikut diberikan: <br><br><pre> <code class="plaintext hljs">veeamconfig agreement acceptEula veeamconfig agreement acceptThirdPartyLicenses</code> </pre><br>  Mereka memungkinkan Anda untuk menerima perjanjian lisensi tanpa pertanyaan lebih lanjut. <br><br>  Tapi kami menyimpang dari topik menulis surat. <br><br>  Untuk tugas pemantauan status server, kita memerlukan perintah <code>veeamconfig session list</code> .  Ini menghasilkan sesuatu seperti: <br><br><pre> <code class="plaintext hljs">Job name Type ID State Started at Finished at bj-home Backup {dbe48e88-3df7-4712-a472-09af8fed4e80} Success 2018-12-05 15:43 2018-12-05 15:44 bj-home Backup {c178a799-2935-4bd6-883b-b11278000076} Success 2018-12-05 16:26 2018-12-05 16:26 bj-home Backup {3405dad3-0016-4a00-933e-60ef66b30324} Success 2018-12-06 06:00 2018-12-06 06:00</code> </pre><br>  Nah, ada informasi di sini ketika server dicadangkan dan apa keberhasilannya.  Pada prinsipnya, sudah dimungkinkan untuk mengumpulkan "knalpot" ke dalam file dan mengirimkannya melalui surat.  Namun, dalam setahun surat itu dapat tumbuh sekitar 365 baris.  Dan mencari <i>Negara</i> dengan kesalahan bisa terasa membosankan.  Karenanya, kami akan menguraikan "pembuangan" ini dan mendapatkan daftar normal yang dengannya Anda sudah dapat melakukan sesuatu. <br><br>  Lihat seluruh kode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di sini</a> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CSession</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> subproccall( [<span class="hljs-string"><span class="hljs-string">"veeamconfig"</span></span>, <span class="hljs-string"><span class="hljs-string">"session"</span></span>, <span class="hljs-string"><span class="hljs-string">"list"</span></span>] ) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CSessionInfoList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, list)</span></span></span><span class="hljs-function">:</span></span> self.list = list <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.list @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> text = CSession.List() lines = text.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) list = [] <span class="hljs-comment"><span class="hljs-comment"># session info list for line in lines: if len(line) == 0: continue words = line.split() if len(words) == 0: continue if words[0] == "Job": continue if words[0] == "Total": continue try: jobName = words[0] type = words[1] id = words[2] state = words[3] startTime = words[4] + " " + words[5] finishTime = words[6] + " " + words[7] list.append(CSessionInfo(id, type, jobName, state, startTime, finishTime)) except: print "Failed to parse [", line, "]" return CSessionInfoList(list)</span></span></code> </pre><br>  Nah, sekarang mari kita membuat surat dan mengirimkannya kepada diri kita sendiri. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMailsessions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"---"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Sending statistic to administrator:"</span></span> sessions = veeamlpb.session.CSessionInfoList.Get() recipient = <span class="hljs-string"><span class="hljs-string">"dear.admin@company.com"</span></span> subject = <span class="hljs-string"><span class="hljs-string">"VAL status notification"</span></span> text = <span class="hljs-string"><span class="hljs-string">"Statistic:\n"</span></span> inx = <span class="hljs-number"><span class="hljs-number">0</span></span>; successCount = <span class="hljs-number"><span class="hljs-number">0</span></span> warningCount = <span class="hljs-number"><span class="hljs-number">0</span></span> errorCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sessions.List(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Success"</span></span>): successCount += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> (sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Warning"</span></span>): warningCount += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: errorCount += <span class="hljs-number"><span class="hljs-number">1</span></span> text += str(successCount)+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+str(warningCount)+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+str(errorCount)+<span class="hljs-string"><span class="hljs-string">" Success/Warning/Error\n"</span></span> text += <span class="hljs-string"><span class="hljs-string">"Last 10 session:\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> reversed(sessions.List()): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> inx == <span class="hljs-number"><span class="hljs-number">10</span></span>: text += <span class="hljs-string"><span class="hljs-string">"...\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; text += str(inx)+<span class="hljs-string"><span class="hljs-string">" | "</span></span>+sessionInfo.State()+<span class="hljs-string"><span class="hljs-string">" | "</span></span>+sessionInfo.JobName()+<span class="hljs-string"><span class="hljs-string">" | "</span></span>+sessionInfo.StartTime()+<span class="hljs-string"><span class="hljs-string">" / "</span></span>+sessionInfo.FinishTime() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> <span class="hljs-comment"><span class="hljs-comment">#text += inx += 1 text += "\n" text += "--------------------------------------------------------------------------------\n" text += " Yours sincerely, Veeam Agent for Linux Monitor\n" print text os.system("echo '"+text+"' | mail -s '"+subject+"' "+recipient)</span></span></code> </pre><br>  Akibatnya, setelah menginstal <i>mailutils,</i> kita bisa mendapatkan surat berupa: <br><br><pre> <code class="plaintext hljs">Statistic: 3/0/0 Success/Warning/Error Last 10 session: 0 | Success | bj-home | 2018-12-06 06:00 / 2018-12-06 06:00 1 | Success | bj-home | 2018-12-05 16:26 / 2018-12-05 16:26 2 | Success | bj-home | 2018-12-05 15:43 / 2018-12-05 15:44 -------------------------------------------------------------------------------- Yours sincerely, Veeam Agent for Linux Monitor</code> </pre><br>  Surat itu hanya menampilkan 10 sesi terakhir.  Pada saat yang sama, informasi tentang jumlah sesi yang berhasil dan tidak terlalu banyak ditampilkan pada awal surat itu.  Cukup dengan melihat angka-angka dalam surat di awal hari kerja, memeriksa surat dan menyeruput pembuat kopi untuk memahami bahwa backup malam berhasil. <br><br>  Jika Anda membutuhkan sesuatu yang lebih jelas, Anda dapat meminta informasi tentang sesi dalam format xml dan mentransfernya ke server Anda.  Di sana, gabungkan data yang diperoleh ke dalam tabel ringkasan tunggal yang menampilkan semua informasi yang diperlukan dalam format yang nyaman atau layak untuk Anda. <br>  Kami mendapatkan pasangan XML-baris: <br><br><pre> <code class="python hljs">sessionList = veeamlpb.session.CSessionList() text = sessionList.ToXml()</code> </pre><br>  Simpan file yang dihasilkan <br><br><pre> <code class="python hljs">sessionListFileName = <span class="hljs-string"><span class="hljs-string">"session_list.xml"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Store XML to file: "</span></span>,sessionListFileName sessionListXmlFile = open(sessionListFileName, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) sessionListXmlFile.write(text) sessionListXmlFile.close()</code> </pre><br>  Kemudian kami mengirim XML yang diterima ke server.  Opsi alternatif juga dimungkinkan - server mengumpulkan XML dari mesin yang dicadangkan.  Siapa inisiator belum penting bagi kami.  Adalah penting bahwa file XML dikumpulkan di server dengan daftar sesi dari semua mesin.  Saya memilih opsi pertama: <br><br><pre> <code class="python hljs">hostname = os.uname()[<span class="hljs-number"><span class="hljs-number">1</span></span>] target = <span class="hljs-string"><span class="hljs-string">"user@admin-desktop:/home/user"</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"scp ./"</span></span>+sessionListFileName+<span class="hljs-string"><span class="hljs-string">" "</span></span>+target+<span class="hljs-string"><span class="hljs-string">"/backups/"</span></span>+hostname+<span class="hljs-string"><span class="hljs-string">"/session_list.xml"</span></span>)</code> </pre><br>  Sekarang, di sisi server, masih memproses data yang diterima dan membuat halaman html yang indah. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> veeamlpb <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xml.etree.ElementTree <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> xml <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> hosts = [] backupsDirectory = <span class="hljs-string"><span class="hljs-string">"/home/user/backups"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(backupsDirectory): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">".."</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isdir(os.path.join(backupsDirectory,item)): hosts.append(item) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"item: "</span></span>,item <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(hosts) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> backupSessionMap = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hosts: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"found host: "</span></span>, host sessionInfoFile = os.path.join(os.path.join(backupsDirectory,host), <span class="hljs-string"><span class="hljs-string">"session_list.xml"</span></span>) sessionList = veeamlpb.session.CSessionInfoList.FromXmlFile(sessionInfoFile) backupSessionMap[host] = sessionList <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sessionList.List(): <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Session:"</span></span>,sessionInfo.ToString() html = xml.Element(<span class="hljs-string"><span class="hljs-string">"html"</span></span>) body = xml.SubElement(html, <span class="hljs-string"><span class="hljs-string">"body"</span></span>, {<span class="hljs-string"><span class="hljs-string">"style"</span></span>:<span class="hljs-string"><span class="hljs-string">"background-color: #00b336;"</span></span>}) xml.SubElement(body,<span class="hljs-string"><span class="hljs-string">"h1"</span></span>).text = <span class="hljs-string"><span class="hljs-string">"Report at "</span></span>+datetime.datetime.now().strftime(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span></span>) xml.SubElement(body,<span class="hljs-string"><span class="hljs-string">"h2"</span></span>).text = <span class="hljs-string"><span class="hljs-string">"Statistic:"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hosts: sessionList = backupSessionMap[host] success=<span class="hljs-number"><span class="hljs-number">0</span></span> warning=<span class="hljs-number"><span class="hljs-number">0</span></span> error=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(sessionList.List()) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sessionInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sessionList.List(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Success"</span></span>: success +=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> sessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Warning"</span></span>: warning +=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: error +=<span class="hljs-number"><span class="hljs-number">1</span></span> latestSessionInfo = sessionList.List()[<span class="hljs-number"><span class="hljs-number">-1</span></span>] attr = {} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> latestSessionInfo.State() == <span class="hljs-string"><span class="hljs-string">"Success"</span></span>: <span class="hljs-comment"><span class="hljs-comment">#attr["style"] = "background-color: #00b336;" attr["style"] = "background-color: #005f4b; color: white;" elif latestSessionInfo.State() == "Warning": attr["style"] = "background-color: #93ea20;" else: attr["style"] = "background-color: #ba0200; color: white;" xml.SubElement(xml.SubElement(body,"p"),"span", attr).text = \ host + " - "+str(success)+"/"+str(warning)+"/"+str(error)+" Success/Warning/Error" for host in hosts: sessionList = backupSessionMap[host] xml.SubElement(body,"h2").text = host+":" tableStyle =xml.SubElement(body,"style") tableStyle.attrib["type"] = "text/css" tableStyle.text = "TABLE {border: 1px solid green;} TD{ border: 1px solid green; padding: 4px;}" table = xml.SubElement(body,"table") thead = xml.SubElement(table, "thead") xml.SubElement(thead, "th").text = "Number" xml.SubElement(thead, "th").text = "State" xml.SubElement(thead, "th").text = "Job name" xml.SubElement(thead, "th").text = "Start at" xml.SubElement(thead, "th").text = "Complete at" tbody = xml.SubElement(table, "tbody") inx = 0 for sessionInfo in reversed(sessionList.List()): if inx == 10: break; tr = xml.SubElement(tbody,"tr") xml.SubElement(tr, "td").text = str(inx) attr ={} if sessionInfo.State() == "Success": pass elif sessionInfo.State() == "Warning": attr["style"] ="background-color: #93ea20;" else: attr["style"] ="background-color: #ba0200; color: white;" xml.SubElement(tr, "td", attr).text = sessionInfo.State() xml.SubElement(tr, "td").text = sessionInfo.JobName() xml.SubElement(tr, "td").text = sessionInfo.StartTime() xml.SubElement(tr, "td").text = sessionInfo.FinishTime() inx += 1 xml.ElementTree(html).write("summary.html", encoding='utf-8', method='html') return 0 exit(main())</span></span></code> </pre><br>  Hasilnya, laporan siap: <br><br><img src="https://habrastorage.org/webt/sk/yd/-x/skyd-xbv3cxvadto3fpw9vc3y6s.png"><br><br>  Saya tidak punya tugas untuk membuat produk yang indah.  Tugasnya adalah menunjukkan bahwa masalah pengumpulan statistik dapat diselesaikan dalam skrip dalam satu hingga dua hari. <br><br>  Pada prinsipnya, jika Anda mengembangkan ide-ide yang disajikan di sini, Anda dapat membuat "Open Backup Monitor for Veeam Agent for Linux".  Menurut pendapat saya, topik yang baik untuk kursus di Python, atau mungkin bahkan untuk diploma, atau hanya alasan untuk berlatih pemrograman pada proyek open source.  Setuju, lebih baik berlatih pemrograman daripada menjadi elf tingkat 80. <br><br>  Semua kode dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://www.github.com/CodeImp/veeampy/</a> .  Unduh, gunakan, suplemen, dan garpu kesehatan. <br><br>  Harap dicatat bahwa kode ini didistribusikan di bawah lisensi GPL-2, mungkin mengandung kesalahan dan banyak lagi.  Semuanya seperti biasa di dunia opensource.  Jadi sebelum digunakan dalam produksi - jangan lupa mengemudi di lab uji. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id432404/">https://habr.com/ru/post/id432404/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi434974/index.html">कॉन्फ़िगरेशन 1 सी के प्रारूप के साथ काम करें: एंटरप्राइज</a></li>
<li><a href="../hi434976/index.html">आईटीएमओ यूनिवर्सिटी फैबलैब: रचनात्मक लोगों के लिए DIY-सहकर्मियों - शो के अंदर क्या है</a></li>
<li><a href="../hi434978/index.html">पेश है HealthKit</a></li>
<li><a href="../id432400/index.html">CS: GO sekarang gratis</a></li>
<li><a href="../id432402/index.html">Hai SDM, di mana suvenir saya?</a></li>
<li><a href="../id432408/index.html">Intisari Fintech: persiapan untuk memutuskan hubungan bank kecil dari Visa dan Mastercard, kalkulator pensiun dan tidak hanya</a></li>
<li><a href="../id432410/index.html">Entitas gaya DDD dengan Entity Framework Core</a></li>
<li><a href="../id432412/index.html">Highload ++: Cara membantu sistem ERP mengatasi 500.000 permintaan per detik</a></li>
<li><a href="../id432414/index.html">Rahasia Lama untuk Debugging Cepat: Animasi Kode Sumber</a></li>
<li><a href="../id432416/index.html">Jenis Tanggungan - Masa Depan Bahasa Pemrograman</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>