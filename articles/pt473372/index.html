<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêµ üõåüèΩ üöø Criando um servi√ßo simples de rastreamento de chamadas, parte 1 üëàüèº ‚ôéÔ∏è üçñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O artigo considerar√° uma das op√ß√µes poss√≠veis para implementar o rastreamento de chamadas no site. Este material foi escrito exclusivamente para fins ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um servi√ßo simples de rastreamento de chamadas, parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473372/">  O artigo considerar√° uma das op√ß√µes poss√≠veis para implementar o rastreamento de chamadas no site.  Este material foi escrito exclusivamente para fins educacionais e n√£o tem o objetivo de substituir os servi√ßos especializados existentes que fornecem o servi√ßo de rastreamento de chamadas. <br><br><h3>  Requisitos funcionais </h3><br><ol><li>  O servi√ßo deve fornecer a capacidade de substituir n√∫meros (n√∫meros) pela origem da transi√ß√£o para o site - a transi√ß√£o dos mecanismos de pesquisa, a transi√ß√£o para a publicidade, a passagem de links com tags utm. </li><li>  O servi√ßo deve fixar o n√∫mero exibido ao visitante do site e exibir esse n√∫mero em uma visita adicional. </li><li>  Ao iniciar uma chamada para o n√∫mero exibido, o servi√ßo deve iniciar a cria√ß√£o de um evento no Google Analytics. </li></ol><a name="habracut"></a><br><h3>  Mec√¢nica geral </h3><br>  Quando voc√™ acessa o site, determinamos a origem da transi√ß√£o e, em seguida, verificamos se o n√∫mero est√° atribu√≠do a esse visitante.  Se o visitante visitou o site pela primeira vez, atribu√≠mos a ele um identificador exclusivo, ap√≥s o qual atribu√≠mos um n√∫mero do pool de n√∫meros relacionados a essa fonte de refer√™ncia.  No futuro, quando o visitante retornar ao site, exibiremos o n√∫mero atribu√≠do a ele anteriormente. <br><br>  Gostaria de me concentrar no registro de chamadas.  Substituir o n√∫mero, atribu√≠-lo ao usu√°rio √© um problema t√©cnico, o principal √© poder comparar uma chamada espec√≠fica e o n√∫mero atualmente atribu√≠do ao usu√°rio.  Se a telefonia usada permitir que voc√™ receba informa√ß√µes detalhadas das chamadas em andamento de forma cont√≠nua, sabendo o momento de uma chamada para um n√∫mero espec√≠fico e tendo informa√ß√µes sobre qual n√∫mero foi exibido naquele momento no site de qual usu√°rio, √© poss√≠vel iniciar a cria√ß√£o de um evento no Google Analytics e associ√°-lo √† ROK. <br><br><h3>  Estrutura </h3><br><ol><li>  ct-server.ru - um script execut√°vel de servi√ßo da web ser√° colocado aqui, um banco de dados para armazenar configura√ß√µes da sala e registrar visitantes; </li><li>  refer-to-site-with-ct-code.ru - neste site emularemos a transi√ß√£o da rede de pesquisa; </li><li>  site-with-ct-code.ru - o site no qual o script de substitui√ß√£o de n√∫mero ser√° colocado. </li></ol><br><h3>  Vamos come√ßar </h3><br>  O exemplo abaixo ser√° implementado no servidor local. <br><br>  Crie um host virtual <b>site-with-ct-code.ru</b> , no qual colocamos o arquivo <b>index.html</b> do seguinte conte√∫do. <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>CT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ct-server.ru/script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//  google id document.cookie = '_ga=GA1.2.1212121212.1212121212; expires=Thu, 18 Dec 2077 12:00:00 UTC; path=/'; </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'calltracking'</span></span></span><span class="hljs-tag">&gt;</span></span>79000000000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Como voc√™ pode ver no exemplo, conectamos um script externo <b><a href="">ct-server.ru/script.js</a></b> , que "comunicar√°" entre <b>site-with-ct-code.ru</b> e <b>ct-server.ru</b> , al√©m de interagir com a √°rvore DOM do site <b>site-with-ct-code.ru</b> .  O n√∫mero ser√° substitu√≠do pelo id do elemento - 'calltracking'. <br><br>  Agora crie um <b>refer-to-site-with-ct-code.ru</b> , que conter√° um link para site-with-ct-code.ru para a capacidade de verificar o n√∫mero do pino na transi√ß√£o do referenciador. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>CT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://site-with-ct-code.ru"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Depois disso, <b>criaremos</b> o host <b>ct-server.ru</b> , que ter√° a seguinte estrutura: <br><br>  index.php - um arquivo de script execut√°vel que aceita solicita√ß√µes de postagem do site-with-ct-code.ru e interage com o banco de dados; <br><br>  script.js - arquivo de script que ser√° conectado nos sites onde a substitui√ß√£o de n√∫mero ser√° realizada. <br><br><h3>  Banco de Dados </h3><br>  Vamos precisar criar duas placas.  Na tabela <b>ct</b> , armazenaremos n√∫meros e configura√ß√µes para a exibi√ß√£o deles; na tabela de <b>n√∫meros</b> , registraremos a exibi√ß√£o dos n√∫meros. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`utm`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ga`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  Uma pequena explica√ß√£o dos campos adicionados: <br><br>  telefone - n√∫mero de telefone substitu√≠do; <br>  refer - a fonte da transi√ß√£o; <br>  utm - link para a p√°gina na qual a substitui√ß√£o de n√∫mero deve ocorrer; <br>  host - o site no qual o script de substitui√ß√£o de n√∫mero est√° localizado; <br>  ga - id do contador do Google Analytics; <br>  login - login do propriet√°rio do n√∫mero. <br><br>  Encha o prato com dados. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`ct`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span>, <span class="hljs-string"><span class="hljs-string">`utm`</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span>, <span class="hljs-string"><span class="hljs-string">`ga`</span></span>, <span class="hljs-string"><span class="hljs-string">`login`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000001'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/?utm_medium=cpc'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000002'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000003'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000004'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://refer-to-site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'78000000005'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://site-with-ct-code.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-12345678-1'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br><img src="https://i.ibb.co/WxKt63X/screen4.png" alt="imagem"><br><br>  Agora crie a placa de n√∫meros. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`ct_user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`refer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`gid`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`page`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`time`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT;<span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br>  Nesta placa, registraremos qual visitante, qual n√∫mero e em que momento √© exibido no site.  No futuro, esses dados poder√£o ser comparados com o registro de chamadas para iniciar a a√ß√£o de destino - enviando um evento para o Google Analytics, criando um lead no CRM, enviando um email, etc. <br><br>  telefone - n√∫mero de telefone; <br>  ct_user - ID do visitante; <br>  refer - a fonte da transi√ß√£o; <br>  gid - cookie do Google Analytics <br>  p√°gina - a p√°gina na qual o n√∫mero √© exibido; <br>  hora - hora de exibi√ß√£o do n√∫mero. <br><br><h3>  Crie um manipulador de solicita√ß√µes </h3><br>  A intera√ß√£o entre o servi√ßo da web ct-server.ru e o site que hospeda o script ser√° feita por meio de solicita√ß√µes POST XHR (XMLHttpRequest) entre dom√≠nios. <br><br>  <b>Vamos</b> abrir o arquivo <b>ct-server.ru/index.php</b> criado anteriormente e adicionar uma verifica√ß√£o para receber dados de hosts permitidos; no nosso caso, s√£o <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site-with-ct-code.ru</a></b> , <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site-with-ct-code2.ru</a></b> e <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site-with -ct-code3.ru</a></b> . <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_ORIGIN"</span></span>]) === <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { $host = $_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_ORIGIN"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//   $allowHosts = array("http://site-with-ct-code.ru", "http://site-with-ct-code2.ru", "http://site-with-ct-code3.ru"); if (in_array($host, $allowHosts, true) === true) { header('Access-Control-Allow-Origin: ' . $host); header('Access-Control-Allow-Credentials: true'); header('Access-Control-Allow-Methods: POST'); header('Access-Control-Allow-Headers: Content-Type'); //    post-      } if ($_SERVER["REQUEST_METHOD"] === "OPTIONS") { exit; } } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  Escrevemos valores vari√°veis ‚Äã‚Äãde solicita√ß√µes POST provenientes de site-with-ct-code.ru <br><br><pre> <code class="php hljs">$phone = $_POST[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]; $ct_user = $_POST[<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>]; $gid = $_POST[<span class="hljs-string"><span class="hljs-string">"gid"</span></span>]; $refer = $_POST[<span class="hljs-string"><span class="hljs-string">"ref"</span></span>]; $page = $_POST[<span class="hljs-string"><span class="hljs-string">"page"</span></span>];</code> </pre><br>  O cozinheiro _ga tem o formato _ga = GA1.2.1212121212.12.1212121212, o trazeremos para o formato "1212121212.12121212121212". <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($gid) { $pos = strpos($gid, <span class="hljs-string"><span class="hljs-string">'.'</span></span>, strpos($gid, <span class="hljs-string"><span class="hljs-string">'.'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); $gid = substr($gid, $pos + <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>  Estabeleceremos uma conex√£o com o banco de dados onde criamos anteriormente nossas tabelas. <br><br><pre> <code class="php hljs">$conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mysqli(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-string"><span class="hljs-string">"root"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"calltracking"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($conn-&gt;connect_error) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"Connection failed: "</span></span> . $conn-&gt;connect_error); }</code> </pre><br>  A intera√ß√£o com o servi√ßo da web ser√° feita por dois m√©todos - <b>get_num_first</b> e <b>get_num</b> . <br><br>  O m√©todo <b>get_num_first √©</b> chamado quando o visitante interage pela primeira vez com o site para obter um n√∫mero selecionando no banco de dados de acordo com os crit√©rios - mail, referrer, utm, host.  Se o resultado da sele√ß√£o retornar um valor, exibimos o n√∫mero de telefone. <br><br>  Al√©m disso, enviamos o evento para o Google Analytics por meio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Protocolo de avalia√ß√£o</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Google</a> .  O mesmo m√©todo √© aplic√°vel ao rastreamento de a√ß√µes offline; no futuro, ele pode ser usado ao comparar o registro de chamadas e o registro de n√∫meros na tabela de n√∫meros. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'method'</span></span>] == <span class="hljs-string"><span class="hljs-string">'get_num_first'</span></span>) { $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `ct` where `host` = '"</span></span> . $host . <span class="hljs-string"><span class="hljs-string">"' and `refer` = '"</span></span> . $refer . <span class="hljs-string"><span class="hljs-string">"' and `utm` = '"</span></span> . $page . <span class="hljs-string"><span class="hljs-string">"' ORDER BY RAND() LIMIT 1 "</span></span>; $result = $conn-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_assoc()) { print_r($row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]); $event = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid='</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">'&amp;t=event&amp;ec=GetNumber&amp;ea=number&amp;z='</span></span> . $row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>] . <span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//echo "0"; $sql = "SELECT * FROM `ct` where `host` = '" . $host . "' and `refer` = '" . $refer . "' ORDER BY RAND() LIMIT 1 "; $result = $conn-&gt;query($sql); print_r($row["phone"]); $event = file_get_contents('https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid=' . $gid . '&amp;t=event&amp;ec=GetNumber&amp;ea=number&amp;z=' . $row["phone"] . ''); } }</span></span></code> </pre><br>  O m√©todo <b>get_num √©</b> necess√°rio para <b>registrar</b> entradas na tabela de n√∫meros. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_POST[<span class="hljs-string"><span class="hljs-string">'method'</span></span>] == <span class="hljs-string"><span class="hljs-string">'get_num'</span></span>) { $sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO `numbers` (`phone`, `ct_user`, `gid`, `refer`,`page`) VALUES ( '"</span></span> . $phone . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $ct_user . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $refer . <span class="hljs-string"><span class="hljs-string">"', '"</span></span> . $page . <span class="hljs-string"><span class="hljs-string">"');"</span></span>; $result = $conn-&gt;query($sql); $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `numbers` where `ct_user` = '"</span></span> . $ct_user . <span class="hljs-string"><span class="hljs-string">"' ORDER BY `id` DESC LIMIT 1 "</span></span>; $result = $conn-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result-&gt;num_rows &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_assoc()) { print_r($row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>]); $event = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://www.google-analytics.com/collect?v=1&amp;tid=UA-12345678-1&amp;cid='</span></span> . $gid . <span class="hljs-string"><span class="hljs-string">'&amp;t=event&amp;ec=ShowNumber&amp;ea=number&amp;z='</span></span> . $row[<span class="hljs-string"><span class="hljs-string">"phone"</span></span>] . <span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//echo "0"; } } $conn-&gt;close();</span></span></code> </pre><br><h3>  Script de substitui√ß√£o num√©rica </h3><br>  Em seguida, seguiremos para o script <b>ct-server.ru/script.js</b> , que conectamos no site-with-ct-code.ru <br><br>  Para come√ßar, vamos criar duas fun√ß√µes - <b>setcookie</b> para criar e <b>getcookie</b> para ler cookies.  N√≥s os usaremos para gravar e obter o ID do cookie do usu√°rio e n√∫mero de telefone. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  function setcookie(phone, value, expires, path, domain, secure) { document.cookie = phone + "=" + escape(value) + (expires ? "; expires=" + new Date(expires) : "") + (path ? "; path=" + path : "") + (domain ? "; domain=" + domain : "") + (secure ? "; secure" : ""); } //  function getcookie(phone) { var cookie = " " + document.cookie; var search = " " + phone + "="; var setStr = null; var offset = 0; var end = 0; if (cookie.length &gt; 0) { offset = cookie.indexOf(search); if (offset != -1) { offset += search.length; end = cookie.indexOf(";", offset); if (end == -1) { end = cookie.length; } setStr = unescape(cookie.substring(offset, end)); } } return setStr; }</span></span></code> </pre><br>  Depois disso, adicione a fun√ß√£o <b>makeid</b> para gerar o ID para o usu√°rio. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  function makeid(length) { var result = ""; var user_id = "abcdefghijklmnopqrstuvwxyz0123456789"; var user_idLength = user_id.length; for (var i = 0; i &lt; length; i++) { result += user_id.charAt(Math.floor(Math.random() * user_idLength)); } return result; }</span></span></code> </pre><br>  Agora vamos criar uma fun√ß√£o para gerar cookies contendo um ID de usu√°rio de 33 d√≠gitos. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  function generateuser_id() { var ct_user_id = makeid(33); setcookie("ct_user", ct_user_id, new Date().getTime() + 60 * 60 * 1000); //  }</span></span></code> </pre><br>  O cookie <b>ct_user</b> resultante √© armazenado por 1 hora. <br><br>  Prosseguimos para gerar uma solicita√ß√£o de n√∫mero atrav√©s do m√©todo <b>get_num_first</b> .  O n√∫mero resultante de ct-server.ru √© gravado no cookie por 1 hora e realizamos a primeira substitui√ß√£o do n√∫mero na p√°gina pelo ID do elemento. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,  ,       id  function getNumberFirstTime() { var method = "get_num_first"; var ct_user = getcookie("ct_user"); var gid = getcookie("_ga"); var ref = document.referrer; var host = window.location.origin; var page = document.location.href; var xhr = new XMLHttpRequest(); var body = "&amp;method=" + encodeURIComponent(method) + "&amp;page=" + encodeURIComponent(page) + "&amp;ct_user=" + encodeURIComponent(ct_user) + "&amp;ref=" + encodeURIComponent(ref) + "&amp;host=" + encodeURIComponent(host) + "&amp;gid=" + encodeURIComponent(gid); xhr.open("POST", "http://ct-server.ru", true); xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); xhr.withCredentials = true; xhr.send(body); xhr.onreadystatechange = function() { //console.log(xhr.responseText); var t = xhr.responseText; document.getElementById("calltracking").innerHTML = t; setcookie("phone", t, new Date().getTime() + 60 * 60 * 1000); //  }; }</span></span></code> </pre><br>  Vamos criar uma fun√ß√£o que enviar√° periodicamente o n√∫mero exibido, ID do usu√°rio, endere√ßo da p√°gina, valor do cookie do Google Analytics, fonte de refer√™ncia para ct-server.ru. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumberPeriodically</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method = <span class="hljs-string"><span class="hljs-string">"get_num"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ct_user = getcookie(<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phone = getcookie(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gid = getcookie(<span class="hljs-string"><span class="hljs-string">"_ga"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ref = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.referrer; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> page = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location.href; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.origin; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = <span class="hljs-string"><span class="hljs-string">"&amp;method="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(method) + <span class="hljs-string"><span class="hljs-string">"&amp;page="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(page) + <span class="hljs-string"><span class="hljs-string">"&amp;ct_user="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(ct_user) + <span class="hljs-string"><span class="hljs-string">"&amp;ref="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(ref) + <span class="hljs-string"><span class="hljs-string">"&amp;host="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(host) + <span class="hljs-string"><span class="hljs-string">"&amp;phone="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(phone) + <span class="hljs-string"><span class="hljs-string">"&amp;gid="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(gid); xhr.open(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://ct-server.ru"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); xhr.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.send(body); xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//console.log(xhr.responseText); var t = xhr.responseText; //document.getElementById('calltracking').innerHTML = t; }; }</span></span></code> </pre><br>  No final, adicionamos a fun√ß√£o sendToCalltracking, que verifica a presen√ßa do n√∫mero de telefone do cookie e da ID do usu√°rio. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendToCalltracking</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ggg = getcookie(<span class="hljs-string"><span class="hljs-string">"ct_user"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ccc = getcookie(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gac = getcookie(<span class="hljs-string"><span class="hljs-string">"_ga"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> ggg === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> || ggg === <span class="hljs-literal"><span class="hljs-literal">null</span></span> || ccc === <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> || ccc === <span class="hljs-literal"><span class="hljs-literal">null</span></span> || ccc.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || ggg.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || ccc === <span class="hljs-string"><span class="hljs-string">""</span></span> || ggg === <span class="hljs-string"><span class="hljs-string">""</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">//console.log('false'); generateuser_id(); getNumberFirstTime(); } else { //console.log('true'); document.getElementById("calltracking").innerHTML = ccc; getNumberPeriodically(); } }</span></span></code> </pre><br>  No in√≠cio do script, chamamos nossa fun√ß√£o timer. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myTimer = setTimeout(sendToCalltracking, <span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        setInterval(sendToCalltracking, 1 * 60 * 1000);</span></span></code> </pre><br><img src="https://i.ibb.co/MDhmBRn/screen1.png" alt="imagem"><br><br>  Se os cookies forem exclu√≠dos durante a pr√≥xima opera√ß√£o, a fun√ß√£o atribuir√° um novo ao visitante de acordo com a sele√ß√£o recebida por host e fonte.  Al√©m disso, √© poss√≠vel gravar os valores recebidos no navegador localStorage. <br><br><img src="https://i.ibb.co/4KfXYVD/screen2.png" alt="imagem"><br><br>  A cada minuto, o script enviar√° o valor do n√∫mero do cookie e da ID do usu√°rio, indicando a p√°gina em que foi aplicado sem recarreg√°-lo.  Entende-se que o script ser√° colocado em todas as p√°ginas do dom√≠nio. <br><br><img src="https://i.ibb.co/q0wGMG3/screen3.png" alt="imagem"><br><br>  No pr√≥ximo artigo, discutiremos o desenvolvimento de uma interface simples para adicionar e configurar n√∫meros. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt473372/">https://habr.com/ru/post/pt473372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473358/index.html">Instale e configure o Nexus Sonatype usando a infraestrutura como abordagem de c√≥digo</a></li>
<li><a href="../pt473362/index.html">Experi√™ncia GSoC: como dois (tr√™s) alunos realmente aprimoraram o c√≥digo CRIU</a></li>
<li><a href="../pt473364/index.html">H√° um g√≥bio, balan√ßando: uma lista de verifica√ß√£o para o com√©rcio eletr√¥nico na temporada de vendas</a></li>
<li><a href="../pt473366/index.html">O que est√° na minha tv inteligente para voc√™? Ou o que pode ser amontoado na TV?</a></li>
<li><a href="../pt473368/index.html">O MIRO √© uma plataforma de rob√¥ indoor aberta. Parte 3 - Componente de software: ESP8266</a></li>
<li><a href="../pt473374/index.html">Como integramos o YouTube Live com o Zoom</a></li>
<li><a href="../pt473376/index.html">Documenta√ß√£o no Windows 10X - uma nova vers√£o do sistema operacional para dispositivos com duas telas vazadas na rede</a></li>
<li><a href="../pt473378/index.html">Contratos de licen√ßa de malware</a></li>
<li><a href="../pt473380/index.html">4. Teste de carga do ponto de verifica√ß√£o Maestro</a></li>
<li><a href="../pt473384/index.html">3DToday Fest: como foi (ser√°). Impress√µes dos membros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>