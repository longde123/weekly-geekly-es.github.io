<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì• ü§æüèª üññ Ce que vous devez savoir sur JavaScript Engine Switcher 3.0 ‚úíÔ∏è üßï üë©üèΩ‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le JavaScript Engine Switcher a √©t√© initialement cr√©√© en tant que biblioth√®que auxiliaire et son d√©veloppement a √©t√© largement d√©termin√© par les besoi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ce que vous devez savoir sur JavaScript Engine Switcher 3.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439446/"><p><img src="https://habrastorage.org/webt/qo/zx/ss/qozxssedwxgcrteo4wnodfixdmy.png" alt="Logo de la troisi√®me version du s√©lecteur de moteur JavaScript"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le JavaScript Engine Switcher a</a> √©t√© initialement cr√©√© en tant que biblioth√®que auxiliaire et son d√©veloppement a √©t√© largement d√©termin√© par les besoins des biblioth√®ques qui l'ont utilis√©.  En fait, chacune de ses versions majeures a r√©solu une ou plusieurs t√¢ches majeures n√©cessaires au d√©veloppement ult√©rieur d'autres biblioth√®ques: </p><br><ol><li>  Dans la premi√®re version, cette t√¢che consistait √† ajouter autant de modules adaptateurs que possible pour les moteurs JS populaires prenant en charge la plate-forme .NET.  Et cela a donn√© aux utilisateurs de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bundle Transformer une</a> certaine flexibilit√©: sur les ordinateurs du d√©veloppeur, ils pouvaient utiliser le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MSIE</a> qui prend en charge le d√©bogage du code JS √† l'aide de Visual Studio, et sur les serveurs qui n'avaient pas de version moderne d'Internet Explorer ou qui n'√©taient pas install√©s du tout, ils pouvaient utiliser Module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V8</a> .  Certains ont m√™me r√©ussi √† ex√©cuter Bundle Transformer en Mono sur Linux et Mac en utilisant les modules <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jurassic</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jint</a> . </li><li>  La t√¢che principale de la deuxi√®me version √©tait l'impl√©mentation de la prise en charge de .NET Core, qui √©tait requise pour la nouvelle version de la biblioth√®que <a href="">ReactJS.NET</a> .  Une autre t√¢che importante a √©t√© la cr√©ation d'un module multiplateforme qui peut rapidement traiter de grandes quantit√©s de code JS (les modules Jurassic et Jint n'√©taient pas adapt√©s √† cela), et apr√®s un certain nombre d'am√©liorations, le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ChakraCore</a> est devenu un tel module. </li><li>  Dans la troisi√®me version, l'accent √©tait mis sur l'am√©lioration de l'int√©gration avec la biblioth√®que ReactJS.NET et l'am√©lioration de la productivit√©. </li></ol><br><p> Dans cet article, nous consid√©rerons certaines innovations de la troisi√®me version, qui pour beaucoup se sont r√©v√©l√©es non √©videntes m√™me apr√®s avoir lu le <a href="">texte de</a> la <a href="">version</a> et la section de documentation <a href="">¬´Comment mettre √† niveau les applications vers la version 3.X¬ª</a> : changements dans la classe <code>JsEngineSwitcher</code> , r√©organisation des exceptions, messages d'erreur plus informatifs, interruption et la compilation pr√©liminaire des scripts, la possibilit√© de modifier la taille maximale de la pile dans les modules ChakraCore et MSIE, ainsi qu'un nouveau module bas√© sur NiL.JS. </p><a name="habracut"></a><br><h2>  Modifications de la classe JsEngineSwitcher </h2><br><p>  Dans la nouvelle version, la classe <code>JsEngineSwitcher</code> impl√©mente l'interface <code>IJsEngineSwitcher</code> et n'est plus un singleton (vous pouvez l'instancier en utilisant le <code>new</code> op√©rateur).  Pour obtenir une instance globale, au lieu de la propri√©t√© <code>Instance</code> , utilisez la propri√©t√© <code>Current</code> .  La propri√©t√© <code>Current</code> , contrairement √† la propri√©t√© <code>Instance</code> obsol√®te, a le type de retour <code>IJsEngineSwitcher</code> .  De plus, la propri√©t√© <code>Current</code> a un setter, avec lequel vous pouvez remplacer l'impl√©mentation standard par la v√¥tre: </p><br><pre> <code class="cs hljs">JsEngineSwitcher.Current = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher();</code> </pre> <br><p>  Dans les applications Web ASP.NET Core sur lesquelles le package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JavaScriptEngineSwitcher.Extensions.MsDependencyInjection est</a> install√©, l'impl√©mentation est remplac√©e √† l'aide de la <code>AddJsEngineSwitcher</code> extension <code>AddJsEngineSwitcher</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Extensions.MsDependencyInjection; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { ‚Ä¶ services.AddJsEngineSwitcher(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher(), options =&gt; ‚Ä¶ ) ‚Ä¶ ; ‚Ä¶ } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>  Ces modifications ¬´cassent¬ª presque toujours les applications ou biblioth√®ques qui utilisent la version pr√©c√©dente de JavaScript Engine Switcher.  Par cons√©quent, vous devez apporter les modifications suivantes √† votre code: </p><br><ol><li>  Modifiez le type de variables, param√®tres ou propri√©t√©s de <code>JsEngineSwitcher</code> √† <code>IJsEngineSwitcher</code> . </li><li>  Au lieu de la propri√©t√© <code>Instance</code> , utilisez la propri√©t√© <code>Current</code> partout. </li></ol><br><p>  Il convient √©galement de noter que pour la plupart des d√©veloppeurs, ces modifications ne seront pas particuli√®rement avantageuses, car leur objectif principal √©tait de simplifier les tests unitaires (par exemple, auparavant, dans les tests unitaires de la biblioth√®que ReactJS.NET, des verrous √©taient <a href="">utilis√©s</a> , mais maintenant vous pouvez <a href="">vous en passer</a> ). </p><br><h2>  R√©organisation des exceptions </h2><br><p>  Avant la troisi√®me version, la plupart des erreurs de moteur JS se transformaient en <code>JsRuntimeException</code> type <code>JsRuntimeException</code> et seules les erreurs survenues pendant le processus d'initialisation du moteur se transformaient en <code>JsEngineLoadException</code> .  Il y avait √©galement une classe de base <code>JsException</code> , dont deux des types d'exceptions ci-dessus ont √©t√© h√©rit√©s, ce qui a permis d'intercepter absolument toutes les erreurs survenues lors du fonctionnement des moteurs JS.  Malgr√© les inconv√©nients √©vidents, cette organisation des exceptions correspond bien au concept d'une interface unifi√©e pour acc√©der aux capacit√©s de base des moteurs JS. </p><br><p>  Mais avec la mise en ≈ìuvre de l'interruption et de la pr√©-compilation des scripts (je les aborderai dans les sections suivantes), un besoin s'est fait sentir pour une nouvelle approche de l'organisation des exceptions.  La premi√®re chose √† faire a √©t√© d'ajouter un nouveau type d'exception - <code>JsInterruptedException</code> , qui √©tait n√©cessaire pour informer l'utilisateur de l'interruption de l'ex√©cution du script.  Il a ensuite fallu diviser explicitement toutes les erreurs survenues lors du traitement du script en deux groupes: les erreurs de compilation (analyse) et les erreurs d'ex√©cution.  Il √©tait √©galement n√©cessaire de s√©parer toutes sortes d'erreurs sp√©cifiques de Chakra et V8, qui n'√©taient pas li√©es au traitement de script.  Il √©tait √©galement n√©cessaire de prendre en compte la pr√©sence d'une exception dans le moteur Jint qui se produit lorsque le d√©lai d'expiration pour l'ex√©cution d'un script (timeout) s'est √©coul√©.  En cons√©quence, une nouvelle approche de l'organisation des exceptions a √©t√© form√©e, qui peut √™tre repr√©sent√©e comme la structure hi√©rarchique suivante: </p><br><ul><li> <code>JsException</code> <br> <ul><li> <code>JsEngineException</code> <br> <ul><li> <code>JsEngineLoadException</code> </li> </ul></li><li> <code>JsFatalException</code> </li> <li> <code>JsScriptException</code> <br> <ul><li> <code>JsCompilationException</code> </li> <li> <code>JsRuntimeException</code> <br> <ul><li> <code>JsInterruptedException</code> </li> <li> <code>JsTimeoutException</code> </li> </ul></li></ul></li><li> <code>JsUsageException</code> </li> </ul></li><li>  <code>JsEngineNotFoundException</code> <sup>*</sup> </li></ul><br><p>  * - cette exception ne se produit pas au niveau du moteur JS, mais au niveau du s√©lecteur de moteur JavaScript. </p><br><p>  Je pense que la hi√©rarchie des exceptions pr√©sent√©e ci-dessus n'a pas besoin de commentaires, car les noms des exceptions parlent d'eux-m√™mes.  Avec cette approche, nous obtenons non seulement plus d'informations sur les causes de l'erreur, mais nous pouvons √©galement g√©rer de mani√®re plus flexible certains types d'exceptions. </p><br><h2>  Format de message d'erreur unifi√© </h2><br><p>  Un autre probl√®me avec les versions pr√©c√©dentes de JavaScript Engine Switcher √©tait la difficult√© de localiser les erreurs survenues lors du traitement des scripts.  √Ä partir de la propri√©t√© d'exception <code>Message</code> , il √©tait difficile de comprendre exactement o√π l'erreur s'est produite dans le code, j'ai donc d√ª analyser d'autres propri√©t√©s d'exception, ce qui n'√©tait pas toujours pratique.  De plus, l'ensemble des propri√©t√©s existantes n'√©tait pas non plus suffisant. </p><br><p>  Par cons√©quent, 2 nouvelles propri√©t√©s ont √©t√© ajout√©es √† la classe <code>JsScriptException</code> : </p><br><ol><li>  <strong>Type</strong> - type d'erreur JavaScript (par exemple, <code>SyntaxError</code> ou <code>TypeError</code> ); </li><li>  <strong>DocumentName</strong> - le nom du document (g√©n√©ralement extrait des valeurs des param√®tres suivants: <code>documentName</code> des m√©thodes <code>Execute</code> et <code>ExecuteFile</code> , <code>path</code> la m√©thode <code>ExecuteFile</code> , <code>resourceName</code> la m√©thode <code>ExecuteResource</code> , etc.); </li></ol><br><p>  Une nouvelle propri√©t√© a √©galement √©t√© ajout√©e √† la classe <code>JsRuntimeException</code> - <strong>CallStack</strong> , qui contient une repr√©sentation sous forme de cha√Æne de la pile d'appels. </p><br><p>  Auparavant, une valeur provenant d'une propri√©t√© similaire de l'exception .NET d'origine ou une repr√©sentation sous forme de cha√Æne d'une erreur JavaScript √©tait simplement copi√©e dans la propri√©t√© <code>Message</code> .  Souvent, les messages d'erreur dans les diff√©rents moteurs JS diff√®rent non seulement par le format, mais √©galement par la quantit√© d'informations utiles qui y sont pr√©sent√©es.  Par exemple, en raison du manque d'informations sur les num√©ros de ligne et de colonne dans certains messages d'erreur, les d√©veloppeurs de la biblioth√®que ReactJS.NET ont √©t√© contraints de renvoyer les <a href="">exceptions</a> re√ßues du JavaScript Engine Switcher. </p><br><p>  Par cons√©quent, j'ai d√©cid√© de g√©n√©rer mes propres messages d'erreur au niveau du module adaptateur, qui auraient un format unique (unifi√©).  Ce format utilise toutes les informations d'erreur disponibles: type, description, nom du document, num√©ro de ligne, num√©ro de colonne, fragment de code et pile d'appels.  Comme base pour le nouveau format, j'ai pris le format d'erreur de la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microsoft ClearScript</a> . </p><br><p>  Voici les messages sur la m√™me erreur de compilation qui ont √©t√© g√©n√©r√©s par diff√©rents modules d'adaptateur: </p><br><pre> <code class="plaintext hljs">ChakraCore ========== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Jint ==== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:25 Jurassic ======== SyntaxError: Expected operator but found 'O' at declinationOfSeconds.js:12 MSIE   Classic ===================== SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra ActiveScript ================================= SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra IE JsRT ============================ SyntaxError: Expected ';' at 12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra Edge JsRT ============================== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; NiL === SyntaxError: Unexpected token 'O' at 12:25 V8 == SyntaxError: Invalid or unexpected token at declinationOfSeconds.js:12:24 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Vroom ===== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:24</code> </pre> <br><p>  Un exemple similaire pour une erreur d'ex√©cution: </p><br><pre> <code class="plaintext hljs">ChakraCore ========== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Global code (Script Document:1:1) Jint ==== TypeError: charMapping is undefined at russian-translit.js:929:26 Jurassic ======== TypeError: undefined cannot be converted to an object at transliterate (russian-translit.js:929) at Global code (Script Document:1) MSIE   Classic ===================== TypeError: 'undefined' is null or not an object at russian-translit.js:929:4 MSIE   Chakra ActiveScript ================================= TypeError: Unable to get property '' of undefined or null reference at russian-translit.js:929:4 MSIE   Chakra IE JsRT ============================ TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) MSIE   Chakra Edge JsRT ============================== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) NiL === TypeError: Can't get property "" of "undefined" V8 == TypeError: Cannot read property '' of undefined at transliterate (russian-translit.js:929:37) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Script Document:1:1 Vroom ===== TypeError: Cannot read property '' of undefined at russian-translit.js:929:37</code> </pre> <br><p>  Comme vous pouvez le voir dans les exemples, certains moteurs JS nous donnent des descriptions d'erreurs et des num√©ros de colonnes compl√®tement diff√©rents, et nous ne pouvons pas toujours obtenir un ensemble complet de donn√©es d'erreur, mais malgr√© ces lacunes, le format unifi√© nous donne plus d'informations sur l'emplacement de l'erreur que messages d'erreur d'origine. </p><br><h2>  Conseils de d√©ploiement de l'assembly natif </h2><br><p>  La principale cause d'erreurs lors de l'utilisation de la deuxi√®me version de JavaScript Engine Switcher √©tait que de nombreux d√©veloppeurs ont oubli√© d'installer des packages NuGet contenant des assemblages natifs pour les modules ChakraCore et V8.  √Ä un moment donn√©, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article dans le bugtracker ReactJS.NET</a> a √©galement √©t√© consacr√© √† ce probl√®me (une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traduction russe</a> est √©galement disponible).  Or, une telle erreur n'est principalement rencontr√©e que par des d√©butants qui, pour une raison quelconque, n'ont pas lu la documentation. </p><br><p>  Les auteurs de ReactJS.NET ont essay√© de minimiser le nombre de ces erreurs en utilisant les conseils √† l'int√©rieur des messages d'erreur, mais la <a href="">mise en ≈ìuvre pas tr√®s r√©ussie de</a> cette approche a conduit √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">encore plus de confusion</a> .  L'id√©e des astuces √©tait bonne, mais elle n√©cessitait une impl√©mentation fondamentalement diff√©rente, √† savoir une impl√©mentation au niveau des modules adaptateurs des moteurs JS.  Dans la nouvelle version de JavaScript Engine Switcher, ces indications sont ajout√©es au message d'erreur lors de l' <code>TypeLoadException</code> exceptions <code>DllNotFoundException</code> et <code>TypeLoadException</code> <code>JsEngineLoadException</code> (voir les exemples d'impl√©mentation des <a href="">modules ChakraCore</a> , <a href="">V8</a> et <a href="">Vroom</a> ).  De plus, ces conseils sont intelligents, car  leur g√©n√©ration prend en compte un certain nombre de facteurs: type de syst√®me d'exploitation, architecture de processeur et runtime (.NET Framework, .NET Core ou Mono). </p><br><p>  Par exemple, lorsque vous utilisez le module ChakraCore sans assemblage natif dans un processus 64 bits sur le syst√®me d'exploitation Windows, le message d'erreur ressemblera √† ceci: </p><br><blockquote>  Impossible de cr√©er une instance de ChakraCoreJsEngine.  Cela s'est probablement produit, car l'assembly 'ChakraCore.dll' ou l'une de ses d√©pendances est introuvable.  Essayez d'installer le package JavaScriptEngineSwitcher.ChakraCore.Native.win-x64 via NuGet.  En outre, vous devez toujours installer le Microsoft Visual C ++ Redistributable pour Visual Studio 2017 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.visualstudio.com/downloads/#microsoft-visual-c-redistributable-for-visual-studio-2017</a> ). </blockquote><br><p>  Le message d'erreur indique que vous devez installer le package NuGet JavaScriptEngineSwitcher.ChakraCore.Native.win-x64 et mentionne √©galement que ChakraCore pour Windows n√©cessite le composant redistribuable Microsoft Visual C ++ pour Visual Studio 2017 pour fonctionner. Si cette erreur se produit dans un processus 32 bits, l'utilisateur sera invit√© √† installer le package JavaScriptEngineSwitcher.ChakraCore.Native.win-x86. </p><br><p>  Un message d'erreur similaire sur Linux dans .NET Core ressemblerait √† ceci: </p><br><blockquote>  Impossible de cr√©er une instance de ChakraCoreJsEngine.  Cela s'est probablement produit, car l'assembly ¬´libChakraCore.so¬ª ou l'une de ses d√©pendances n'a pas √©t√© trouv√©.  Essayez d'installer le package JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 via NuGet. </blockquote><br><p>  Dans ce cas, il sera sugg√©r√© d'installer le package JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64. </p><br><p>  Une fois lanc√© en Mono, une autre invite s'affiche: </p><br><blockquote>  ... Les packages JavaScriptEngineSwitcher.ChakraCore.Native.linux- * ne prennent pas en charge l'installation sous Mono, mais vous pouvez installer l'assembly natif manuellement ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/Taritsyn/JavaScriptEngineSwitcher/wiki/ChakraCore#linux</a> ). </blockquote><br><p>  √âtant donn√© que le package JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 est compatible uniquement avec .NET Core, l'info-bulle fournira un lien vers des instructions pour d√©ployer manuellement l'assembly natif sur Linux. </p><br><p>  De nombreux autres exemples peuvent √™tre donn√©s, mais cela n'a aucun sens. </p><br><h2>  Abandon de l'ex√©cution du script </h2><br><p>  Lorsque nous donnons aux utilisateurs la possibilit√© d'ex√©cuter du code JS arbitraire sur le serveur, nous sommes confront√©s √† un probl√®me tr√®s grave - nous ne savons pas combien de temps il faudra pour ex√©cuter ce code.  Cela peut √™tre une grande quantit√© de code non optimal ou de code qui ex√©cute une boucle infinie.  Dans tous les cas, ce sera du code non contr√¥l√© qui consommera ind√©finiment les ressources de notre serveur.  Afin de contr√¥ler en quelque sorte ce processus, nous devons avoir la possibilit√© d'interrompre l'ex√©cution des scripts.  Lorsque vous utilisez des moteurs √©crits en .NET pur (par exemple, Jint, Jurassic ou NiL.JS), nous pouvons toujours commencer √† ex√©cuter du code JS en tant que t√¢che avec la possibilit√© d'annuler, mais cette approche ne fonctionnera pas pour d'autres moteurs.  Heureusement pour nous, les moteurs C ++ ont des m√©canismes int√©gr√©s pour interrompre les scripts. </p><br><p>  Pour fournir l'acc√®s √† ces m√©canismes, la propri√©t√© <code>SupportsScriptInterruption</code> et la m√©thode <code>Interrupt</code> ont √©t√© ajout√©es √† l'interface <code>IJsEngine</code> .  √âtant donn√© que tous les moteurs ne prennent pas en charge cette fonctionnalit√©, vous devez toujours v√©rifier la valeur de la propri√©t√© <code>SupportsScriptInterruption</code> avant d'appeler la m√©thode <code>Interrupt</code> (si dans les versions pr√©c√©dentes de JavaScript Engine Switcher vous deviez ex√©cuter manuellement le garbage collector, vous comprendrez imm√©diatement de quoi je parle): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (engine.SupportsScriptInterruption) { engine.Interrupt(); }</code> </pre> <br><p>  Et vous devez appeler cette m√©thode dans un thread distinct diff√©rent du thread dans lequel les scripts sont ex√©cut√©s.  Apr√®s avoir appel√© la m√©thode <code>Interrupt</code> , toutes les <code>CallFunction</code> , <code>Execute*</code> et <code>CallFunction</code> se termineront par une <code>JsInterruptedException</code> . </p><br><p>  √âtant donn√© que cette API est de bas niveau, il est recommand√© d'utiliser des m√©thodes d'extension comme les suivantes pour les t√¢ches d√©crites au d√©but de la section: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> !NET40 using System.Runtime.ExceptionServices; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using System.Threading; using System.Threading.Tasks; using JavaScriptEngineSwitcher.Core; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 using JavaScriptEngineSwitcher.Core.Extensions; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using JavaScriptEngineSwitcher.Core.Resources; ‚Ä¶ /// &lt;summary&gt; /// Extension methods for &lt;see cref="IJsEngine"/&gt; /// &lt;/summary&gt; public static class JsEngineExtensions { /// &lt;summary&gt; /// Evaluates an expression within a specified time interval /// &lt;/summary&gt; /// &lt;typeparam name="T"&gt;Type of result&lt;/typeparam&gt; /// &lt;param name="engine"&gt;JS engine&lt;/param&gt; /// &lt;param name="expression"&gt;JS expression&lt;/param&gt; /// &lt;param name="timeoutInterval"&gt;Interval to wait before the /// script execution times out&lt;/param&gt; /// &lt;param name="documentName"&gt;Document name&lt;/param&gt; /// &lt;returns&gt;Result of the expression&lt;/returns&gt; /// &lt;exception cref="ObjectDisposedException"/&gt; /// &lt;exception cref="ArgumentNullException"/&gt; /// &lt;exception cref="ArgumentException"/&gt; /// &lt;exception cref="JsCompilationException"/&gt; /// &lt;exception cref="JsTimeoutException"/&gt; /// &lt;exception cref="JsRuntimeException"/&gt; /// &lt;exception cref="JsException"/&gt; public static T Evaluate&lt;T&gt;(this IJsEngine engine, string expression, TimeSpan timeoutInterval, string documentName) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine == null) { throw new ArgumentNullException(nameof(engine)); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine.SupportsScriptInterruption) { using (var timer = new Timer(state =&gt; engine.Interrupt(), null, timeoutInterval, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 new TimeSpan(0, 0, 0, 0, -1))) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Timeout.InfiniteTimeSpan)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { try { return engine.Evaluate&lt;T&gt;(expression, documentName); } catch (JsInterruptedException e) { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, e.EngineName, e.EngineVersion, e ); } } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 Task&lt;T&gt; task = Task.Factory.StartNew(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Task&lt;T&gt; task = Task.Run(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { return engine.Evaluate&lt;T&gt;(expression, documentName); }); bool isCompletedSuccessfully = false; try { isCompletedSuccessfully = task.Wait(timeoutInterval); } catch (AggregateException e) { Exception innerException = e.InnerException; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (innerException != null) { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 innerException.PreserveStackTrace(); throw innerException; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> ExceptionDispatchInfo.Capture(innerException).Throw(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw; } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (isCompletedSuccessfully) { return task.Result; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, engine.Name, engine.Version ); } } } ‚Ä¶ } ‚Ä¶</span></span></code> </pre> <br><p>  Cette m√©thode est un module compl√©mentaire de la m√©thode du moteur <code>Evaluate&lt;T&gt;</code> , qui permet d'utiliser le param√®tre <code>timeoutInterval</code> d√©finir le d√©lai d'attente pour l'ex√©cution du script.  Le principe de fonctionnement de cette m√©thode d'extension est tr√®s simple.  Tout d'abord, nous v√©rifions si notre moteur prend en charge le m√©canisme d'interruption int√©gr√©.  Si c'est le <code>timeoutInterval</code> , nous cr√©ons une instance de la classe <code>Timer</code> , qui, apr√®s l'intervalle de <code>timeoutInterval</code> sp√©cifi√© dans le param√®tre de <code>timeoutInterval</code> , d√©marre la m√©thode d' <code>Interrupt</code> , puis nous appelons la m√©thode du moteur <code>Evaluate&lt;T&gt;</code> , et en cas d'erreur, interceptons la <code>JsInterruptedException</code> et enveloppons-la dans une <code>JsTimeoutException</code> .  Si le moteur ne prend pas en charge les interruptions, cr√©ez une instance de la classe <code>Task</code> qui ex√©cute la m√©thode <code>Evaluate&lt;T&gt;</code> du moteur, puis d√©finissez l'intervalle d'attente pour que la t√¢che soit ex√©cut√©e √©gal √† la valeur du param√®tre <code>timeoutInterval</code> et, si la t√¢che se termine par timeout, lancez une <code>JsTimeoutException</code> type <code>JsTimeoutException</code> .  Voici un exemple d'utilisation de cette m√©thode d'extension: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> expression = <span class="hljs-string"><span class="hljs-string">@"function getRandomInt(minValue, maxValue) { minValue = Math.ceil(minValue); maxValue = Math.floor(maxValue); return Math.floor(Math.random() * (maxValue - minValue + 1)) + minValue; } function sleep(millisecondsTimeout) { var totalMilliseconds = new Date().getTime() + millisecondsTimeout; while (new Date().getTime() &lt; totalMilliseconds) { } } var randomNumber = getRandomInt(1, 10); sleep(randomNumber * 1000); randomNumber;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (IJsEngine engine = JsEngineSwitcher.Current.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = engine.Evaluate&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(expression, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-string"><span class="hljs-string">"randomNumber.js"</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">" = {0}"</span></span>, result); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsTimeoutException) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"    JavaScript "</span></span> + <span class="hljs-string"><span class="hljs-string">"   !"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); } } } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>  En utilisant la m√©thode d'extension, nous calculons le r√©sultat de l'expression JS.  Le r√©sultat de l'expression est un entier al√©atoire, et ce nombre est √©galement le nombre de secondes de retard de cette expression.  De plus, lors de l'appel de la m√©thode d'extension, nous sp√©cifions un intervalle d'attente de 3 secondes.  √âtant donn√© que le temps de calcul de l'expression varie de 1 √† 10 secondes, dans un cas, le r√©sultat de l'expression sera affich√© sur la console et dans un autre, un message sur le d√©lai d'expiration. </p><br><p>  Il ne devrait pas √™tre difficile pour vous de refaire cette m√©thode d'extension pour appeler d'autres m√©thodes de moteur (par exemple, pour <code>Execute*</code> , les <code>CallFunction</code> ou d'autres versions surcharg√©es de la m√©thode <code>CallFunction</code> ).  Jusqu'√† pr√©sent, je n'ai pas d√©cid√© si j'ajouterais de telles m√©thodes d'extension √† la biblioth√®que elle-m√™me, car on ne sait pas encore combien elles seront demand√©es. </p><br><h2>  Pr√©compilation de scripts </h2><br><p>  On m'a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demand√© d'</a> ajouter un support pour la compilation pr√©liminaire des scripts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en 2015</a> .  √Ä ce moment, il n'√©tait pas clair comment une telle fonction pourrait s'int√©grer dans le concept d'une interface unifi√©e.  Mais au fil du temps, la prise en charge des fonctionnalit√©s d'accessibilit√© telles que la r√©cup√©ration de place et l'interruption de script a progressivement commenc√© √† appara√Ætre dans le moteur de commutation JavaScript.  Aux derni√®res √©tapes du travail sur la troisi√®me version, c'est au tour de la compilation pr√©liminaire. </p><br><p>  En utilisant la pr√©compilation, vous pouvez compiler un script une fois, puis l'utiliser plusieurs fois pour initialiser les moteurs JS.  Du fait que le script pr√©compil√© ne n√©cessite pas d'analyse, l'initialisation des moteurs sera plus rapide. </p><br><p>  √Ä l'heure actuelle, la pr√©-compilation est prise en charge par 5 modules adaptateurs: ChakraCore, Jint, Jurassic, MSIE (uniquement en modes JsRT) et V8.  Pour donner acc√®s aux m√©canismes du moteur correspondants, la propri√©t√© <code>SupportsScriptPrecompilation</code> et 3 nouvelles m√©thodes ont √©t√© ajout√©es √† l'interface <code>IJsEngine</code> : <code>Precompile</code> , <code>PrecompileFile</code> et <code>PrecompileResource</code> .  <code>Precompile*</code> m√©thodes <code>Precompile*</code> renvoient une instance d'un objet qui impl√©mente l'interface <code>IPrecompiledScript</code> .  Cet objet est un script pr√©compil√© qui peut √™tre utilis√© par diff√©rentes instances des moteurs (une version surcharg√©e de la m√©thode <code>Execute</code> sert √† cet effet).  Prenons un exemple simple d'utilisation de cette API: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sourceCode = <span class="hljs-string"><span class="hljs-string">@"function declinationOfSeconds(number) { var result, titles = ['', '', ''], titleIndex, cases = [2, 0, 1, 1, 1, 2], caseIndex ; if (number % 100 &gt; 4 &amp;&amp; number % 100 &lt; 20) { titleIndex = 2; } else { caseIndex = number % 10 &lt; 5 ? number % 10 : 5; titleIndex = cases[caseIndex]; } result = number + ' ' + titles[titleIndex]; return result; }"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> functionName = <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemCount = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] inputSeconds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[itemCount] { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] outputStrings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[itemCount]; IJsEngineSwitcher engineSwitcher = JsEngineSwitcher.Current; IPrecompiledScript precompiledCode = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!engine.SupportsScriptPrecompilation) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"{0}  {1}   "</span></span> + <span class="hljs-string"><span class="hljs-string">"  !"</span></span>, engine.Name, engine.Version); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { precompiledCode = engine.Precompile(sourceCode, <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds.js"</span></span>); engine.Execute(precompiledCode); outputStrings[<span class="hljs-number"><span class="hljs-number">0</span></span>] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(functionName, inputSeconds[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsCompilationException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"     "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; itemIndex &lt; itemCount; itemIndex++) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { engine.Execute(precompiledCode); outputStrings[itemIndex] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;( functionName, inputSeconds[itemIndex]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript- "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; itemIndex &lt; itemCount; itemIndex++) { Console.WriteLine(outputStrings[itemIndex]); } } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>    ,         .     <code>SupportsScriptPrecompilation</code>  ,       ,  ,     .     <code>Precompile</code>  ,      ,      <code>JsCompilationException</code> . C   <code>Execute</code>      , ..   .     <code>CallFunction</code>   <code>declinationOfSeconds</code>      .     .   ,    ,           .     3        .  ,        ,        .         ,    ,      . </p><br><p>      ,     ,    .   ,  ,           .       ReactJS.NET.        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JSPool</a> ,         ( <code>System.Runtime.Caching.MemoryCache</code>  .NET Framework 4.X, <code>System.Web.Caching.Cache</code>  ASP.NET 4.X  <code>Microsoft.Extensions.Caching.Memory.IMemoryCache</code>  ASP.NET Core).      ,        (       <a href=""> </a> ).    ,       ReactJS.NET. </p><br><p>      ReactJS.NET .              .        <code>AllowJavaScriptPrecompilation</code>   <code>true</code> . </p><br><p>  ASP.NET 4.X       <code>App_Start/ReactConfig.cs</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReactConfig</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ReactSiteConfiguration.Configuration ‚Ä¶ .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ‚Ä¶ ; ‚Ä¶ } } ‚Ä¶</code> </pre> <br><p>  ASP.NET Core      <code>Startup.cs</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env</span></span></span><span class="hljs-function">)</span></span> { ‚Ä¶ app.UseReact(config =&gt; { config ‚Ä¶ .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ‚Ä¶ ; }); app.UseStaticFiles(); ‚Ä¶ } } ‚Ä¶</code> </pre> <br><p>       ,      .       <a href="">JsExecutionBenchmark</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BenchmarkDotNet</a> .        JS-     .    14,9 ,     ,       .          JavaScript Engine Switcher ( 3.0.4). </p><br><p>   ,      .NET Framework 4.7.2: </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td> <sup></sup> </td><td align="right"> <sup>41,72 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>74,46 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>35,07 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>91,79 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td> <sup></sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>15,54 </sup> </td><td align="right"> <sup>1 296,88</sup> </td><td align="right"> <sup>640,63</sup> </td><td align="right"> <sup>31,25</sup> </td><td align="right"> <sup>7 521,49 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td> <sup></sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>78,70 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 892,94 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>30,97 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>77,75 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>24,40 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>90,58 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>33,14 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>78,40 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>32,86 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>95,48 </sup> </td></tr><tr><td rowspan="2"> <sup>V8</sup> </td><td> <sup></sup> </td><td align="right"> <sup>41,10 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>79,33 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>39,25 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>96,17 </sup> </td></tr></tbody></table><br><p>         ,    .NET ‚Äî     Jurassic  5,79 ,   Jint  1,75 a.      2     ,      2       .                .      Jurassic,          : Jurassic   JS-  IL-  Reflection.Emit,    .        ,          ,      . Jint           .NET-,    .    Jint      ,             .      ,  Jint    ,    ,            .  Jint  Jurassic        . </p><br><p>      ,   C++,  MSIE   Chakra IE JsRT ‚Äî     26,93%.    ChakraCore (18,96%),  V8 (4,71%)  MSIE   Chakra Edge JsRT    (0,85%).           Internet Explorer    Edge.            .          (   )      .   ,      -         12-17  (       ).         .       .         . </p><br><p>     .NET Core 2.0    ( V8 ,    Microsoft ClearScript,    ,   .NET Core): </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td> <sup></sup> </td><td align="right"> <sup>43,65 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,07 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>36,37 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16,59 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td> <sup></sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>15,25 </sup> </td><td align="right"> <sup>1 281,25</sup> </td><td align="right"> <sup>593,75</sup> </td><td align="right"> <sup>62,50</sup> </td><td align="right"> <sup>7 447,44 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td> <sup></sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>80,72 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 845,98 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>31,50 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,28 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>24,52 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,78 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>35,54 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,45 </sup> </td></tr><tr><td>  <sup>Oui</sup> </td><td align="right"> <sup>31,44 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,99 </sup> </td></tr></tbody></table><br><p>      . ,     ‚Äî  MSIE   Chakra Edge JsRT  (7,69%).           Chakra    . </p><br><h2>        ChakraCore  MSIE </h2><br><p>    ,  Microsoft,    ,    .     IIS    (256   32-   512   64-),     ASP.NET  JS- (,  TypeScript)   .       JavaScript Engine Switcher        .             ,        Node.js (492   32-   984   64-).   ,      ,  -    .        ChakraCore  MSIE    <code>MaxStackSize</code> ,          .         Node.js.       ,             . </p><br><h2>     NiL.JS </h2><br><p>      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NiL</a> ,      <a href="">NiL.JS</a> . NiL.JS ‚Äî    JS-,    .NET.      2014 ,        Jurassic  Jint.    ‚Äî  .         ,       . </p><br><p>     .NET Framework 4.7.2    : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>17,80 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 424,09 </sup> </td></tr></tbody></table><br><p>     .NET Core 2.0  : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>19,67 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 419,95 </sup> </td></tr></tbody></table><br><p>       .        ,     (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> ).   ,   Jint        2016       ,       .   <a href="">   3.0.0 Beta 1353</a> ,    Jint    2,4  ,  NiL.JS  2.5.1200,        . </p><br><p>   NiL.JS  .         -  ,      -  ,    .    Bundle Transformer,  JavaScript Engine Switcher,     Hogan  Handlebars,      ReactJS.NET.              NiL.JS. </p><br><h2>  Les r√©f√©rences </h2><br><ol><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JavaScript Engine Switcher</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> JavaScript Engine Switcher</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´  JavaScript Engine Switcher 2.X¬ª</a> </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JSPool</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  ReactJS.NET</a> </li><li>   <a href="">ReactJS.NET</a>  GitHub </li></ol><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439446/">https://habr.com/ru/post/fr439446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439432/index.html">Comment devenir d√©veloppeur Java en 1,5 an</a></li>
<li><a href="../fr439434/index.html">NestJS - le m√™me backend r√©el sur nodejs</a></li>
<li><a href="../fr439436/index.html">R√©duction des co√ªts de petites s√©ries d'√©lectronique en Russie. Bo√Ætier radio Internet WOLNA</a></li>
<li><a href="../fr439440/index.html">Impl√©mentez Zimbra Collaboration Open Source, autorisez via AD et cr√©ez automatiquement des bo√Ætes aux lettres</a></li>
<li><a href="../fr439442/index.html">Julia. G√©n√©rateurs de rapports et de documents</a></li>
<li><a href="../fr439448/index.html">√Ä quelles questions sur la virtualisation attendez-vous une r√©ponse d'un dipl√¥m√©?</a></li>
<li><a href="../fr439450/index.html">RS-485 sur microcontr√¥leurs domestiques de la soci√©t√© Milander</a></li>
<li><a href="../fr439454/index.html">Program as Art - Un nouveau paradigme de gestion de logiciels</a></li>
<li><a href="../fr439456/index.html">Podcasts hipster # 2</a></li>
<li><a href="../fr439458/index.html">Comment nous avons traduit le site Web de la R√©publique en Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>