<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌭 🏴󠁧󠁢󠁷󠁬󠁳󠁿 🚀 Bagaimana cara menggunakan PHP untuk mengimplementasikan layanan microser? 😆 🙏🏽 👨🏽‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mengapa harus bicara tata kelola layanan? 


 Dengan semakin populernya Internet, arsitektur MVC tradisional telah menjadi semakin membengkak dan sang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana cara menggunakan PHP untuk mengimplementasikan layanan microser?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460855/"><p><img src="https://habrastorage.org/getpro/habr/post_images/287/fa2/ee0/287fa2ee0642f5411410b78c86702e82.jpg" alt="Swoft"></p><br><h3 id="why-should-talk-service-governance">  Mengapa harus bicara tata kelola layanan? </h3><br><p>  Dengan semakin populernya Internet, arsitektur MVC tradisional telah menjadi semakin membengkak dan sangat sulit untuk dipertahankan karena skala aplikasi terus berkembang. </p><br><p>  Kita perlu mengambil tindakan untuk membagi sistem besar menjadi beberapa aplikasi sesuai dengan karakteristik bisnis.  Sebagai contoh, sistem e-commerce yang besar dapat mencakup sistem pengguna, sistem produk, sistem pemesanan, sistem evaluasi, dll., Dan kami dapat memisahkannya menjadi beberapa aplikasi individual.  Karakteristik arsitektur multi-aplikasi adalah aplikasi berjalan secara independen dan mereka tidak dapat saling memanggil. </p><a name="habracut"></a><br><p>  Meskipun beberapa aplikasi menyelesaikan masalah aplikasi yang membengkak, aplikasi tersebut tidak tergantung satu sama lain dan layanan atau kode umum tidak dapat digunakan kembali. </p><br><h3 id="official-link">  Tautan resmi </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/swoft-cloud/swoft</a> <br><br><h2 id="single-application-solution">  Solusi aplikasi tunggal </h2></li></ul><br><p>  Untuk sistem Internet yang besar, biasanya berisi beberapa aplikasi dengan layanan umum, dan masing-masing aplikasi memiliki hubungan panggilan satu sama lain.  Selain itu, ada tantangan lain untuk sistem Internet skala besar, seperti bagaimana menangani pengguna yang tumbuh cepat, bagaimana mengelola tim R&amp;D untuk dengan cepat mengubah pengembangan sistem, bagaimana menjaga peningkatan sistem dengan cara yang stabil, dan sebagainya. </p><br><p>  Oleh karena itu, untuk menggunakan kembali layanan dengan baik dan memelihara modul agar mudah berkembang.  Kami ingin layanan dipisahkan dari aplikasi.  Layanan tidak lagi dalam aplikasi, tetapi dipertahankan sebagai layanan terpisah.  Aplikasi itu sendiri bukan lagi tumpukan modul yang membengkak, tetapi komponen layanan modular. </p><br><h2 id="servitization">  Servitization </h2><br><h3 id="features">  Fitur </h3><br><p>  Jadi apa fitur menggunakan "Servitization"? </p><br><ul><li>  Aplikasi terbagi menjadi beberapa layanan oleh bisnis </li><li>  Layanan individual dapat digunakan secara mandiri </li><li>  Layanan dapat dibagikan oleh banyak aplikasi </li><li>  Layanan dapat berkomunikasi satu sama lain </li><li>  Arsitektur sistem lebih jelas </li><li>  Modul inti stabil, dan peningkatan komponen layanan dalam unit dapat menghindari risiko seringnya rilis baru </li><li>  Mudah untuk pengembangan dan manajemen </li><li>  Pemeliharaan dapat dilakukan oleh tim individu dengan alur kerja dan tanggung jawab yang jelas </li><li>  Layanan digunakan kembali, kode digunakan kembali </li><li>  Sangat mudah berkembang <cut></cut></li></ul><br><h3 id="the-challenge-of-servitization">  Tantangan servisisasi </h3><cut></cut><br><p> Setelah servis sistem, ketergantungan sistem menjadi rumit, dan jumlah interaksi di antara layanan meningkat.  Dalam mode pengembangan <code>fpm</code> , karena memori penduduk tidak dapat disediakan, setiap permintaan harus dimulai dari nol dengan mulai memuat proses untuk keluar dari proses, menambahkan banyak overhead yang tidak berguna.  Juga, koneksi basis data tidak dapat digunakan kembali dan tidak dapat dilindungi karena <code>fpm</code> adalah berbasis proses dan jumlah proses <code>fpm</code> juga menentukan jumlah bersamaan.  Ini adalah masalah yang diberikan kepada kita oleh sederhana pengembangan <code>fpm</code> .  Jadi, ini adalah alasan mengapa <code>Java</code> lebih populer sekarang di platform Internet dibandingkan dengan <code>.NET</code> dan <code>PHP</code> .  Terlepas dari <code>PHP non-memory resident</code> , ada banyak masalah lain yang perlu diatasi. </p><br><ul><li>  Lebih banyak layanan, lebih banyak kompleksitas manajemen konfigurasi </li><li>  Ketergantungan layanan yang kompleks </li><li>  Load balancing antar layanan </li><li>  Perluasan layanan </li><li>  Pemantauan layanan </li><li>  Downgrade layanan </li><li>  Otentikasi layanan </li><li>  Layanan online dan offline </li><li>  Dokumentasi layanan <br>  ...... </li></ul><cut></cut><br><p>  Anda dapat membayangkan manfaat yang dibawa oleh memori penduduk kepada kami. </p><br><ul><li><p>  <strong>Hanya mulai inisialisasi kerangka kerja setelah</strong> kita dapat berkonsentrasi pada pemrosesan permintaan karena kerangka kerja hanya dapat diinisialisasi dalam memori saat startup sekaligus untuk memori penduduk </p><br></li><li><p>  <strong>Koneksi multiplexing</strong> , beberapa insinyur tidak dapat mengerti jika tidak menggunakan koneksi pool, apa konsekuensi dari membuat koneksi untuk setiap permintaan?  Ini menyebabkan sumber daya backend terlalu banyak dalam koneksi.  Untuk beberapa layanan dasar, seperti Redis, database, koneksi adalah saluran yang mahal. </p><br></li></ul><br><p>  Jadi, adakah solusi yang bagus?  Jawabannya adalah ya, dan banyak orang menggunakan kerangka kerja yang disebut <code>Swoft</code> .  <code>Swoft</code> adalah kerangka kerja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RPC</a> dengan fitur <code>Service Governance</code> .  <code>Swoft</code> adalah kerangka kerja penuh stack penuh memori residen PHP, berdasarkan konsep inti <code>Spring Boot</code> , konvensi lebih besar daripada konfigurasi. </p><br><p>  <code>Swoft</code> menyediakan cara yang lebih elegan untuk menggunakan layanan <code>RPC</code> seperti <code>Dubbo</code> dan <code>Swoft</code> memiliki kinerja hebat mirip dengan kinerja <code>Golang</code> .  Ini adalah hasil stress test dari kinerja <code>Swoft</code> terjadi di <code>PC</code> saya. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a4/aa7/97e/3a4aa797eb0e94c2e5adfa3207308076.png" alt="Swoft"></p><br><p>  Kecepatan pemrosesan sangat luar biasa dalam tes stres <code>ab</code> .  Dengan CPU <code>i7 generation 8</code> dan memori <code>16GB</code> , <code>100000</code> permintaan hanya menggunakan <code>5s</code> .  Waktu pada dasarnya tidak mungkin dicapai dalam mode pengembangan <code>fpm</code> .  Tes ini juga cukup untuk menunjukkan kinerja tinggi dan stabilitas <code>Swoft</code> . </p><br><h2 id="elegant-service-governance">  Tata kelola layanan yang elegan </h2><cut></cut><br><h3 id="service-registration-and-discoveryhttpsenswoftorgdocs2xenmsgovernregister-discoveryhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pendaftaran dan Penemuan Layanan</a> </h3><br><p>  Dalam proses tata kelola layanan-layanan mikro, pendaftaran layanan yang diprakarsai ke kluster pihak ketiga, seperti konsul / etcd, sering dilibatkan.  Bab ini menggunakan komponen konsul swoft dalam kerangka kerja Swoft untuk mengimplementasikan pendaftaran dan penemuan layanan. <br><img src="https://habrastorage.org/getpro/habr/post_images/16a/482/683/16a482683d8376d8f179f6158135384a.png" alt="Swoft"><br>  Logika implementasi </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ReflectionException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ContainerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Agent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ClientException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ServerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Contract</span></span>\<span class="hljs-title"><span class="hljs-title">ProviderInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class RpcProvider * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RpcProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProviderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Client $client * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ReflectionException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ContainerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ClientException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ServerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@example</span></span></span><span class="hljs-comment"> * [ * 'host:port', * 'host:port', * 'host:port', * ] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Client $client)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Get health service from consul $services = $this-&gt;agent-&gt;services(); $services = [ ]; return $services; } }</span></span></code> </pre> <br><h3 id="service-circuit-breakerhttpsenswoftorgdocs2xenmsgovernbreakerhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pemutus Sirkuit Layanan</a> </h3><cut></cut><br><p>  Dalam lingkungan terdistribusi, terutama sistem arsitektur microservice terdistribusi, sangat umum bagi satu sistem perangkat lunak untuk memanggil sistem jarak jauh lain.  Callee panggilan jarak jauh semacam itu mungkin merupakan proses lain, atau host lain di seluruh jaringan.  Perbedaan terbesar antara panggilan jarak jauh ini dan panggilan internal proses adalah bahwa panggilan jarak jauh mungkin gagal atau hang.  Tidak ada respons hingga batas waktu.  Lebih buruk lagi, jika ada banyak penelepon yang memanggil layanan yang ditangguhkan yang sama, sangat mungkin bahwa batas waktu layanan menunggu dengan cepat menyebar ke seluruh sistem terdistribusi, menyebabkan reaksi berantai yang menghabiskan seluruh sumber daya dalam sistem terdistribusi.  Akhirnya, itu dapat menyebabkan kelumpuhan sistem. </p><cut></cut><br><p>  Mode Circuit Breaker dirancang untuk mencegah bencana yang disebabkan oleh reaksi berantai seperti air terjun dalam sistem terdistribusi. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0f7/357/6f0/0f73576f06e519937755982867922c34.png"></p><br><p>  Dalam mode pemutus sirkuit dasar, untuk memastikan pemasok tidak dipanggil saat pemutus sirkuit dalam keadaan terbuka, tetapi kami juga memerlukan metode tambahan untuk mengatur ulang pemutus sirkuit setelah pemasok melanjutkan layanan.  Salah satu solusi yang mungkin adalah pemutus sirkuit secara berkala mendeteksi apakah layanan pemasok dilanjutkan.  Setelah dilanjutkan, status ditetapkan untuk ditutup.  Keadaan ini adalah kondisi setengah terbuka ketika pemutus sirkuit mencoba lagi. </p><cut></cut><br><p>  Penggunaan sekeringnya sederhana dan kuat.  Ini dapat dijelaskan dengan <code>@Breaker</code> .  Sekering <code>Swoft</code> dapat digunakan dalam skenario apa pun, seperti layanan yang dipanggil.  Itu dapat diturunkan atau tidak dipanggil saat meminta layanan pihak ketiga. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class BreakerLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BreakerLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Breaker</span></span></span><span class="hljs-comment">(fallback="loopFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do something throw new Exception('Breaker exception'); } /** * @return string * @throws Exception */ public function loopFallback(): string { // Do something } }</span></span></code> </pre> <cut></cut><br><h3 id="service-restrictionhttpsenswoftorgdocs2xenmsgovernlimiterhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pembatasan layanan</a> </h3><br><p>  <strong>Pembatasan Aliran, Pemutus Arus Listrik, Downgrade Layanan</strong> Ini dapat ditekankan berulang kali karena sangat penting.  Ketika layanan tidak berfungsi, itu harus rusak.  Pembatasan aliran adalah alat untuk melindungi dirinya sendiri.  Jika tidak ada mekanisme perlindungan diri dan koneksi diterima tidak peduli berapa banyak mereka, front-end pasti akan hang ketika lalu lintas sangat besar sedangkan back-end tidak dapat menangani semua koneksi. </p><br><p>  Pembatasan aliran adalah untuk membatasi jumlah permintaan bersamaan dan jumlah ketika mengakses sumber daya yang langka, seperti barang penjualan kilat, sehingga secara efektif memotong puncak dan memperlancar kurva aliran.  Tujuan dari pembatasan aliran adalah untuk membatasi laju akses bersamaan dan permintaan bersamaan, atau untuk membatasi kecepatan permintaan dalam rentang waktu untuk melindungi sistem.  Setelah batas nilai tercapai atau dilampaui, permintaan dapat ditolak, atau diantrekan. </p><br><p>  Lapisan bawah dari pembatasan aliran <code>Swoft</code> menggunakan algoritma token bucket, dan lapisan yang mendasarinya bergantung pada <code>Redis</code> untuk menerapkan pembatasan aliran yang didistribusikan. </p><br><p>  Pembatasan aliran Swoft tidak hanya membatasi pengontrol, tetapi juga membatasi metode dalam kacang apa pun dan mengontrol laju akses metode.  Contoh berikut adalah penjelasan secara rinci. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Limiter</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">RateLimiter</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class LimiterLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LimiterLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RequestMapping</span></span></span><span class="hljs-comment">() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RateLimiter</span></span></span><span class="hljs-comment">(rate=20, fallback="limiterFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestLimiter2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'requestLimiter2'</span></span>, $uri]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limiterFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'limiterFallback'</span></span>, $uri]; } }</code> </pre> <br><p>  Ini mendukung <code>symfony/expression-language</code> .  Jika kecepatan terbatas, metode <code>limiterFallback</code> yang didefinisikan dalam <code>fallback</code> akan dipanggil. </p><cut></cut><br><h3 id="configuration-centerhttpsenswoftorgdocs2xenmsgovernconfightml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pusat konfigurasi</a> </h3><br><p>  Sebelum kita berbicara tentang pusat konfigurasi, mari kita bicara tentang file konfigurasi.  Kami tidak asing dengan itu.  Ini memberi kami kemampuan untuk memodifikasi program secara dinamis.  Kutipan dari seseorang adalah: </p><br><blockquote>  Penyesuaian dinamis dari sikap penerbangan dari runtime sistem! </blockquote><p>  Saya dapat memanggil pekerjaan kami untuk memperbaiki suku cadang di pesawat terbang cepat.  Kita manusia selalu tidak mampu mengendalikan dan memprediksi segalanya.  Untuk sistem kami, kami selalu perlu mencadangkan beberapa garis kontrol untuk membuat penyesuaian ketika kami membutuhkannya, untuk mengendalikan arah sistem (seperti kontrol abu-abu, penyesuaian pembatasan aliran), yang sangat penting bagi industri Internet yang mencakup perubahan. </p><br><p>  Untuk versi yang berdiri sendiri, kami menyebutnya konfigurasi (file);  untuk sistem cluster terdistribusi, kami menyebutnya pusat konfigurasi (sistem); </p><br><h4 id="what-exactly-is-a-distributed-configuration-center">  Apa sebenarnya pusat konfigurasi terdistribusi? </h4><cut></cut><br><p>  Dengan perkembangan bisnis dan peningkatan arsitektur layanan mikro, jumlah layanan dan konfigurasi program meningkat (berbagai layanan mikro, berbagai alamat server, berbagai parameter), dan metode file konfigurasi tradisional, serta metode database tidak dapat memenuhi kebutuhan pengembang dalam manajemen konfigurasi: </p><br><ul><li>  Keamanan: Konfigurasi mengikuti kode sumber yang disimpan dalam basis kode, yang mudah menyebabkan kebocoran konfigurasi; </li><li>  Ketepatan waktu: Memodifikasi konfigurasi dan memulai kembali layanan agar berlaku. </li><li>  Keterbatasan: Penyesuaian dinamis tidak dapat didukung: misalnya, sakelar log, sakelar fungsi; </li></ul><br><p>  Karena itu, kita perlu mengonfigurasi pusat untuk mengelola konfigurasi!  Membebaskan pengembang bisnis dari konfigurasi yang rumit dan rumit, mereka hanya perlu fokus pada kode bisnis itu sendiri, yang secara signifikan dapat meningkatkan pengembangan dan efisiensi operasional.  Pada saat yang sama, konfigurasi dan rilis paket akan semakin meningkatkan tingkat keberhasilan rilis, dan memberikan dukungan kuat untuk kontrol fine tune dan penanganan darurat operasi dan pemeliharaan. </p><br><p>  Tentang pusat konfigurasi terdistribusi, ada banyak solusi open source di web, seperti: </p><br><p>  Apollo adalah pusat konfigurasi terdistribusi yang dikembangkan oleh departemen kerangka Ctrip.  Ini dapat secara terpusat mengelola konfigurasi berbagai lingkungan dan kelompok aplikasi yang berbeda.  Itu dapat didorong ke akhir aplikasi secara real time setelah modifikasi konfigurasi.  Ini memiliki fitur otoritas standar dan manajemen proses, dan cocok untuk skenario mengkonfigurasi dan mengelola layanan microser. </p><cut></cut><br><p>  Bab ini menggunakan <code>Apollo</code> sebagai contoh untuk menarik konfigurasi dan mengamankan layanan restart dari pusat konfigurasi jarak jauh.  Jika Anda tidak terbiasa dengan <code>Apollo</code> , pertama-tama Anda dapat melihat komponen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Apollo</code></a> ekstensi <code>Swoft</code> dan membaca dokumentasi Resmi <code>Apollo</code> . </p><br><p>  Bab ini menggunakan <code>Apollo</code> di <code>Swoft</code> sebagai contoh.  Ketika konfigurasi <code>Apollo</code> berubah, restart layanan (http-server / rpc-server / ws-server).  Berikut ini adalah contoh agen: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ApolloException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class ApolloLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApolloLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ApolloException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;pull(<span class="hljs-string"><span class="hljs-string">'application'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Print data var_dump($data); } }</span></span></code> </pre> <br><p>  Di atas adalah tarikan konfigurasi Apollo yang sederhana, selain metode ini, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Swoft-Apollo</code></a> menyediakan lebih banyak cara untuk digunakan. </p><cut></cut><br><h2 id="official-link-1">  Tautan resmi </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/swoft-cloud/swoft</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460855/">https://habr.com/ru/post/id460855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460843/index.html">Memperkenalkan 3CX Call Flow Designer Baru dan Generator Template 3CX CRM</a></li>
<li><a href="../id460845/index.html">Fernando Corbato, bapak komputer Anda (dan kata sandi), meninggal pada usia 93</a></li>
<li><a href="../id460847/index.html">12,3 juta WebSockets bersamaan</a></li>
<li><a href="../id460849/index.html">Bagian 4. Model grafik untuk menghitung fungsi logis untuk proses paralel asinkron</a></li>
<li><a href="../id460851/index.html">SamsPcbGuide, Bagian 10: Teknologi - Komponen Bebas Timah Solder</a></li>
<li><a href="../id460857/index.html">Bagaimana Namecoin Blockchain Research Memprediksi Serangan Cyber ​​RTM</a></li>
<li><a href="../id460859/index.html">Konferensi IThink # 3 di Kharkov - berdasarkan WWDC 2019</a></li>
<li><a href="../id460861/index.html">Lingkup dan penutupan leksikal JavaScript</a></li>
<li><a href="../id460863/index.html">Rincian kerusakan Cloudflare 2 Juli 2019</a></li>
<li><a href="../id460865/index.html">Orang-orang di bulan. Sumber</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>