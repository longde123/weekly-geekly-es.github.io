<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèæ üë®üèΩ‚Äçüî¨ üöò Zabbix + Voximplant: monitoreo con llamadas, o c√≥mo dejar de preocuparse y configurarlo r√°pidamente üìª üé≠ üçñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zabbix, inteligente, flexible y personalizable, puede hacer todo. O casi todo. Ser√≠a extra√±o que no pudiera hacerse amigo de la telefon√≠a en la nube, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix + Voximplant: monitoreo con llamadas, o c√≥mo dejar de preocuparse y configurarlo r√°pidamente</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/465491/">  Zabbix, inteligente, flexible y personalizable, puede hacer todo.  O casi todo.  Ser√≠a extra√±o que no pudiera hacerse amigo de la telefon√≠a en la nube, especialmente cuando este √∫ltimo tiene una API HTTP conveniente: use su salud.  Hoy demostraremos c√≥mo configurar Zabbix para llamadas de notificaci√≥n a trav√©s de Voximplant, lo que puede ser muy √∫til en un caso de emergencia ("no hay tiempo para explicarlo, debe llamar, el servidor de batalla se cay√≥"). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tu/k5/_o/tuk5_odcpfkuzsgmqs5wgugzdw0.png"></div>  <font color="grey">Basado en el cuadro de la pel√≠cula "The Matrix" (The Matrix (1999), Warner Bros.)</font> <br><blockquote> Nota: el tutorial asume que ya tiene un Zabbix funcionando y una interfaz de Zabbix configurada.  La instalaci√≥n inicial de Zabbix no es el prop√≥sito de este art√≠culo, los curiosos / necesitados de dicha gu√≠a pueden consultar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial</a> y / o google. </blockquote><br><a name="habracut"></a><h2>  Con qu√© trabajaremos </h2><br>  Nuestro ejemplo utiliza VDS con CentOS 7, en el que est√° instalado Zabbix 4.2.6 (la √∫ltima versi√≥n estable en el momento de la escritura).  Monitorearemos el mismo servidor donde trabaja Zabbix.  Voximplant necesita una cuenta en la plataforma y un script de procesamiento de llamadas para JS.  Y ahora un poco m√°s. <br><br><h2>  Que haremos </h2><br>  Sin ciencia de cohetes, hagamos un monitoreo muy simple que responda a la aparici√≥n del <b>archivo / tmp / habrTriggerFile</b> : cuando aparezca dicho archivo, Zabbix se comunicar√° con Voximplant a trav√©s de la API HTTP, un script funcionar√° y llamar√° al n√∫mero de tel√©fono especificado, diga "Atenci√≥n".  Se cre√≥ un archivo en el servidor ".  y colgar  Si elimina / cambia el nombre del archivo y luego lo devuelve, se volver√° a llamar.  Si no hace nada, solo habr√° una llamada. <br><br><h2>  Voximplant </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Inicie sesi√≥n en su cuenta</a> (o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reg√≠strese</a> ) y cree <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la aplicaci√≥n</a> <b>habr</b> .  Dentro de la aplicaci√≥n, vaya a la pesta√±a Escenarios y cree un script de <b>notificaci√≥n</b> con este c√≥digo: <br><br><pre><code class="javascript hljs">VoxEngine.addEventListener(AppEvents.Started, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> call = VoxEngine.callPSTN(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"   "</span></span>) call.addEventListener(CallEvents.PlaybackFinished, () =&gt; { VoxEngine.terminate() }) call.addEventListener(CallEvents.Connected, () =&gt; { setTimeout( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> call.say(<span class="hljs-string"><span class="hljs-string">".     ."</span></span>, Language.RU_RUSSIAN_FEMALE), <span class="hljs-number"><span class="hljs-number">1000</span></span> ) }) })</code> </pre> <br>  Puede ejecutar este script con una solicitud HTTP (y hacerlo sin comprar un n√∫mero de tel√©fono).  No olvide sustituir <b>los</b> n√∫meros de <b>tel√©fono</b> en <b>callPSTN</b> : el primero es a qui√©n llamar√° la plataforma, el segundo es callerid, que se mostrar√° en el suscriptor llamado;  puede ser su n√∫mero personal verificado en la plataforma o un n√∫mero comprado previamente en Voximplant (tenga en cuenta que no se pueden usar n√∫meros virtuales).  El script llama al n√∫mero, despu√©s de la conexi√≥n informa que se ha creado un archivo y cuelga. <br><br>  Guarde el script y vaya a la pesta√±a Enrutamiento para crear una regla: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oq/_t/pm/oq_tpm3ax6p79y5pwfzii3utpae.jpeg" width="650"></div><br>  Guarde la regla y, tenga en cuenta, copie su ID. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vu/kz/yc/vukzyclxf6vzalebrz1dbsvni2e.jpeg"></div><br>  A continuaci√≥n, necesitar√° claves de API, t√≥melas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la secci√≥n correspondiente del</a> men√∫ principal. <br>  Conociendo las claves API y la ID de la regla, puede sustituirlas por el m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://voximplant.com/docs/references/">StartScenarios</a> de nuestra API HTTP, se ver√° m√°s o menos as√≠: <br><br><pre> <code class="bash hljs">https://api.voximplant.com/platform_api/StartScenarios/?account_id=1&amp;api_key=4ed5695e-4690-448r-95e8-3f8f0001287c&amp;rule_id=28</code> </pre> <br>  Un poco m√°s tarde, usamos esta solicitud al configurar la supervisi√≥n, que ya se puede iniciar. <br><br><h2>  Zabbix </h2><br>  Ingrese su interfaz de Zabbix como su usuario (o administrador), luego en la secci√≥n Configuraci√≥n - Hosts, haga clic en Crear host.  En el nombre, escriba <b>localhost</b> , en grupos, especifique el <b>grupo de prueba</b> y haga clic en Agregar a continuaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/as/ep/9o/asep9oqe5p0fjsmfrspqp7mytwk.jpeg"></div><br>  Ahora en la lista de hosts ver√° tanto el servidor Zabbix predeterminado como el localhost.  Desde aqu√≠ continuaremos configurando. <br><br>  La supervisi√≥n de Zabbix se basa en una cadena de 3 entidades: Elemento - Activador - Acci√≥n.  Los tres enlaces son obligatorios, por lo que debe crear cada uno de ellos en secuencia. <br><br><h3>  Art√≠culo </h3><br>  El art√≠culo es un acumulador de datos, y sin datos, el monitoreo no reaccionar√° ante nada.  Para crear un elemento, en la lista de hosts, haga clic en Elementos a la derecha del nombre del host local.  Tambi√©n puede hacer clic en el nombre del host y, en la pantalla que se abre, ir a la pesta√±a Elementos: la esencia es la misma.  Una vez en la pesta√±a Elementos, haga clic en Crear elemento en la esquina superior derecha.  Ingrese el nombre - <b>elemento habr</b> , luego haga clic en Agregar al lado del campo Clave - despl√°cese hacia abajo, necesitamos la clave est√°ndar <b>vfs.file.exists</b> , selecci√≥nela y se sustituir√° en el campo Clave.  Reemplace el archivo con la ruta actual, en nuestro caso la clave ser√° as√≠: <b>vfs.file.exists [/ tmp / habrTriggerFile]</b> .  En el campo Intervalo de actualizaci√≥n, configure 5 segundos para que la supervisi√≥n responda m√°s r√°pido cuando creamos el archivo en el host.  En la parte inferior de la p√°gina, haga clic en Agregar e inmediatamente ver√° el nuevo elemento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4e/fy/n0/4efyn0yodwpvunisxnx7siatcg4.jpeg"></div><br><br><h3>  Disparador </h3><br>  Los desencadenantes eval√∫an los datos recopilados y cuando alcanzan el umbral especificado, reaccionan: comienzan la acci√≥n.  En la pantalla con el elemento creado, vaya a la pesta√±a Disparadores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ko/ay/xx/koayxxidq2cdwo_ht1n5kkfoygk.jpeg"></div><br>  Haga clic en Crear disparador, <b>as√≠gnele el</b> nombre de <b>disparador</b> .  El valor del campo Expresi√≥n se recopila convenientemente utilizando el constructor: el bot√≥n Agregar.  Establezca la configuraci√≥n como en la captura de pantalla y haga clic en Insertar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zj/th/lo/zjthlop_e4pffeowtleynperswy.jpeg"></div><br>  Haga clic en Agregar en la parte inferior de la p√°gina: listo, se crea el activador. <br><br><h3>  Acci√≥n </h3><br>  La acci√≥n es una acci√≥n que dispara un disparador disparado.  Abra la pesta√±a Configuraci√≥n - Acciones, haga clic en Crear acci√≥n.  El nombre es de repente - <b>habr acci√≥n</b> .  A continuaci√≥n, en el bloque Condici√≥n nueva, deje todo como predeterminado y agregue <b>habr</b> , como resultado, se <b>obtiene</b> el <b>nombre</b> del <b>activador que contiene la</b> condici√≥n <b>habr</b> .  Haga clic en Agregar para agregar una condici√≥n: aparecer√° inmediatamente en el bloque Condiciones, vea la captura de pantalla: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/js/45/fn/js45fnk8aj1ymauczt99xtixx9a.jpeg"></div><br>  Aqu√≠, vaya a la pesta√±a Operaciones, luego en el bloque Operaciones, haga clic en Nuevo para agregar una acci√≥n.  En el Tipo de operaci√≥n, seleccione Comando remoto, aparecer√° el bloque de lista Destino y el campo de entrada Comandos.  En el bloque de lista Destino, haga clic en Nuevo, se le ofrecer√° el objetivo predeterminado: host actual, lo necesita, haga clic en Agregar y el objetivo aparecer√° en la lista.  En el campo de entrada, inserte curl + una solicitud generada previamente a Voximplant: <br><br><pre> <code class="bash hljs">curl <span class="hljs-string"><span class="hljs-string">"https://api.voximplant.com/platform_api/StartScenarios/?account_id=1&amp;api_key=4ed5695e-4690-448r-95e8-3f8f0001287c&amp;rule_id=28"</span></span></code> </pre> <br>  Luego agregue esta acci√≥n (Agregar como enlace), y solo luego haga clic en el bot√≥n Agregar para completar la creaci√≥n de la Acci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ne/sr/nf/nesrnfgyv2rikp40vnthmm0kmmk.jpeg"></div><br>  Un punto importante: elegimos el tipo de acci√≥n de comando Remoto, que est√° desactivado por defecto en la configuraci√≥n del agente Zabbix.  Para solucionar esto, en el host, abra la configuraci√≥n y ponga un valor de 1 para EnableRemoteCommands: <br><br><pre> <code class="bash hljs">vi /etc/zabbix/zabbix_agentd.conf // EnableRemoteCommands = 1</code> </pre><br>  Despu√©s de eso, reinicie el servicio del agente: <br><br><pre> <code class="bash hljs">service zabbix-agent restart</code> </pre> <br><br><h2>  Iniciamos la cadena de acciones. </h2><br>  En el panel de Zabbix, vaya a la secci√≥n Monitoreo - Problemas.  Pronto veremos una advertencia aqu√≠ de que el gatillo funcion√≥. <br><br>  En el host, cree un archivo: <br><br><pre> <code class="bash hljs">touch /tmp/habrTriggerFile</code> </pre> <br>  Despu√©s de 5 segundos en el panel Problemas veremos un nuevo mensaje;  PROBLEMA parpadear√° en la columna Estado, y si hace clic en el icono en la columna Acciones, ver√° los detalles de la acci√≥n (se puede hacer clic en la captura de pantalla): <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/vl/kw/az/vlkwazib1r2snoujsrm3g617s1c.jpeg"></a> </div> <a href=""><br></a> <br>  En el camino, se realizar√° una llamada al n√∫mero de tel√©fono que especificamos en el script Voximplant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/jm/vu/qkjmvu7ki9qixm1fix1wq5lgsn4.png"></div>  <font color="grey">Basado en el cuadro de la pel√≠cula "The Matrix" (The Matrix (1999), Warner Bros.)</font> <br><br>  Si cambia el nombre del archivo, <br><br><pre> <code class="bash hljs">mv /tmp/habrTriggerFile /tmp/habrTriggerFile_</code> </pre> <br>  luego, despu√©s de 5 segundos, el estado del problema se RESUELVE. <br><br>  Hecho  Usted es excelente porque ha configurado la cadena de interacci√≥n host - Zabbix - Voximplant y, por el mismo principio, puede configurar una l√≥gica compleja arbitraria para las llamadas de notificaci√≥n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465491/">https://habr.com/ru/post/465491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465479/index.html">Pixel Lo-fi en Unity</a></li>
<li><a href="../465483/index.html">Antig√ºedades: Windows 3.1 y la vida sin un bot√≥n de inicio</a></li>
<li><a href="../465485/index.html">Imprimir tapiz Game of Thrones en una impresora fiscal usando Python</a></li>
<li><a href="../465487/index.html">Construye una plataforma kubernetes en Pinterest</a></li>
<li><a href="../465489/index.html">Lista de verificaci√≥n de preparaci√≥n de producci√≥n</a></li>
<li><a href="../465493/index.html">Lenguaje de programaci√≥n r√°pido en Raspberry Pi</a></li>
<li><a href="../465495/index.html">C√≥mo no perder tr√°fico cuando se muda a un nuevo dominio: caso "Vse10"</a></li>
<li><a href="../465497/index.html">Mensajes secretos a trav√©s de registros del servidor</a></li>
<li><a href="../465499/index.html">¬øUna nueva ley para describir la velocidad de desarrollo de las computadoras cu√°nticas?</a></li>
<li><a href="../465501/index.html">Lecciones aprendidas 40 a√±os despu√©s del despegue y el r√°pido declive de la primera "aplicaci√≥n asesina"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>