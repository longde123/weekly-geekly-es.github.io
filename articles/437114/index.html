<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇ ü§¶ üë®üèø‚Äç‚öñÔ∏è Seminario web abierto: "SSH / NC / Socat: consejos y trucos" üçÇ ü¶â üë∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buen dia a todos! 

 La pr√≥xima semana lanzaremos el pr√≥ximo grupo de administradores de Linux , en relaci√≥n con el cual realizamos una serie de event...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seminario web abierto: "SSH / NC / Socat: consejos y trucos"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/437114/">  Buen dia a todos! <br><br>  La pr√≥xima semana lanzaremos el pr√≥ximo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">grupo de administradores de Linux</a> , en relaci√≥n con el cual realizamos una serie de eventos.  Una de ellas es una lecci√≥n abierta sobre el tema "SSH / NC / Socat: consejos y trucos".  En √©l recordamos qu√© es ssh, su historia y misi√≥n.  Examinamos varias opciones para su uso: remoto, reenv√≠o de puerto local, copia segura, calcetines proxy, proxy inverso.  De hecho, probamos las utilidades nc y socat en un laboratorio virtual. <br><br>  El seminario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">web</a> fue realizado por el experimentado administrador de sistemas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Drozdetsky</a> , desarrollador de infraestructura en letundra.com, exposcan.ru, crispmessenger.com. <br><br>  Traemos a su atenci√≥n una descripci√≥n detallada del evento pasado. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/n7jxFK9SMsk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Recordemos qu√© es SSH</b> <br><br>  SSH (Secure Shell) es un "shell seguro", un protocolo de red de nivel de aplicaci√≥n.  Le permite controlar de forma remota el sistema operativo y las conexiones TCP del t√∫nel (por ejemplo, para transferir archivos).  En su funcionalidad, SSH es similar a los protocolos Telnet y rlogin, sin embargo, difiere de ellos porque encripta todo el tr√°fico, incluidas las contrase√±as transmitidas.  La especificaci√≥n del protocolo SSH-2 est√° contenida en RFC 4251. <br><br>  Veamos los diversos usos de SSH, tanto est√°ndar como no est√°ndar.  El siguiente stand nos ayudar√° con esto: <br><br><img src="https://habrastorage.org/webt/mi/d9/2a/mid92ankvqf8pgggjz7orphgps4.png"><br><br>  El stand presenta cuatro m√°quinas virtuales que se encuentran detr√°s del firewall.  Realizaremos todas las acciones desde la m√°quina Nodo-1. <br><br>  <b>Crear una clave SSH</b> <b><br></b> <br>  Para usar la clave SSH, primero debe crearla.  Para esto, es adecuada una utilidad especial, que est√° absolutamente en cualquier distribuci√≥n de Linux: <br><br><pre><code class="plaintext hljs">ssh-keygen -t RSA -N otuslinux -f ~/.ssh/otus</code> </pre> <br><ul><li>  -t: qu√© algoritmo de cifrado usar; </li><li>  -N - clave de cifrado (un argumento conveniente si necesita crear una clave sin cifrado y respuestas a varias solicitudes ssh-keygen); </li><li>  -f: en qu√© archivo guardar la clave. </li></ul><br>  <b>Configuraci√≥n SSH ssh-server</b> <br><br>  Para m√°s trabajo, deber√° editar el archivo / etc / ssh / sshd_config y reiniciar el servidor ssh.  Aqu√≠ debe prestar atenci√≥n a las siguientes opciones: <br><br>  <code>RSAAuthentication yes</code> RSA <code>RSAAuthentication yes</code> (si se permite la autenticaci√≥n RSA); <br>  <code>PubkeyAuthentication yes</code> (si se permite la autenticaci√≥n por clave); <br>  <code>AuthorizedKeysFile %h/.ssh/authorized_keys</code> (ruta a la parte p√∫blica de la clave); <br>  Autenticaci√≥n de <code>PasswordAuthentication yes</code> (si se permite la autenticaci√≥n). <br><br>  Para copiar la clave al servidor, proceda de la siguiente manera: <br><br>  <code>ssh-copy-id -i /path/to/pub/key user@server</code> (copie la parte p√∫blica de la clave en el servidor remoto, la clave p√∫blica se copiar√° a lo largo de la ruta al archivo% h / .ssh / Authorizedkeys) <br><br>  Para no volver a ingresar la clave de cifrado cada vez que se conecta a un servidor remoto, podemos usar ssh-agent.  Para hacer esto: <br><br>  <code>eval $(ssh-agent -s)</code> (eval es parte de POSIX. Su interfaz tambi√©n puede ser un shell. La clave en el agente se almacenar√° en forma descifrada). <br><br>  <code>ssh-add ~/.ssh/our_private_key</code> (Agregar una clave privada). <br><br>  En este caso: <br><br><ul><li>  -i: indica la ubicaci√≥n de la clave p√∫blica; </li><li>  usuario: nombre de usuario en el servidor remoto; </li><li>  servidor: ip o dns del servidor de destino. </li></ul><br>  Para facilitar la conexi√≥n a un servidor remoto, podemos describir los par√°metros de conexi√≥n en el archivo de configuraci√≥n ssh, que se encuentra en la ruta ~ / .ssh / config <br><br>  Por lo tanto, obtenemos el siguiente archivo de configuraci√≥n SSH: <br><br><pre> <code class="bash hljs">Host myserver HostName ip/hostname Port 22/??? User username IdentityFile ~/.ssh/id_rsa</code> </pre> <br>  Aqu√≠ todo es simple: <br><br><ul><li>  Anfitri√≥n: el nombre de nuestra conexi√≥n; </li><li>  HostName: nombre del servidor; </li><li>  Puerto - puerto ssh </li><li>  Usuario: nombre de usuario; </li><li>  IdentityFile: clave ssh. </li></ul><br>  <b>SSH SCP</b> <br><br>  Sigamos adelante.  La forma m√°s f√°cil de usar SSH es copiar el archivo de una m√°quina al control remoto.  Para hacer esto, use la utilidad SCP (Protocolo de copia segura).  Al usarlo, puede copiar un directorio o archivo de un servidor local a un servidor remoto, o viceversa: <br><br>  <code>scp test.txt username@server:/some/directory</code> (Copiar un archivo del servidor local al servidor remoto). <br>  <code>scp username@server:test.txt /some/directory</code> (Copiar un archivo de un servidor remoto a uno local). <br>  <code>scp -r dir_name username@server:/some/directory</code> (Copiando una carpeta desde el servidor local al remoto). <br><br>  Aqu√≠: <br><br><ul><li>  nombre de usuario - nombre de usuario; </li><li>  servidor - direcci√≥n del servidor; </li><li>  / some / server - el directorio donde copiamos; </li><li>  dir_name: nombre de la carpeta; </li><li>  -r: uso recursivo. </li></ul><br>  <b>T√∫nel SSH, proxy</b> <br><br>  Ahora veamos la opci√≥n de reenviar un puerto con un control remoto a la m√°quina local.  Tomemos el caso cl√°sico como ejemplo, es decir, un mont√≥n cuando tenemos un "malvado guardia de seguridad" y un servidor con una aplicaci√≥n web, los puertos ssh y https est√°n mirando al mundo, y realmente queremos conectarnos al servidor MySQL. <br><br>  Entonces <br><br>  <code>ssh -f -N -L 9906:127.0.0.1:3306 user@server</code> (Solo nuestro caso con MySQL) <br><br>  Como resultado, podemos conectarnos al puerto local 9906 con el cliente mysql y acceder a nuestro servidor de "seguridad". <br><br>  <code>ssh -D 8080 -q -C -N -f servername</code> (Proxying el tr√°fico a trav√©s de SOCKS a trav√©s del puerto 8080) <br><br>  Con este comando, creamos un servidor proxy socks5 usando ssh.  Para verificar su rendimiento, podemos usar el siguiente comando: <br><br><pre> <code class="plaintext hljs">curl -x socks5h://server-with-proxy:8080 https://test.domain</code> </pre><br>  Un ejemplo cl√°sico de reenv√≠o de puertos con ssh es cuando el servidor al que desea conectarse est√° detr√°s de la nat.  El siguiente comando nos ayudar√° a conectarnos a dicho servidor: <br><br>  <code>ssh -f -N -R 2255:localhost:22 username@servername</code> (reenv√≠o de un servidor remoto a uno local). <br><br>  En el servidor remoto, se abrir√° el puerto 2255, que se redirigir√° al puerto 22 de nuestro servidor para la nat.  Para conectarse a dicho servidor, podemos usar el comando: <br><br><pre> <code class="plaintext hljs">ssh -p 2255 username@localhost</code> </pre><br>  Tenga en cuenta que: <br><br><ul><li>  -f: env√≠a ssh al fondo; </li><li>  -N: no ejecuta el comando en el host remoto; </li><li>  -L: reenviar el puerto local (puerto local: m√°quina local: puerto remoto); </li><li>  -R - puerto en la m√°quina remota; </li><li>  -q - modo silencioso; </li><li>  -D: define el enrutamiento din√°mico local de los puertos de nivel de aplicaci√≥n; </li><li>  -C - solicitud de compresi√≥n de datos. </li></ul><br>  <b>Netcat (nc)</b> <br><br>  Nuestra siguiente parada es Netcat, una utilidad de Unix que le permite establecer conexiones TCP y UDP, recibir datos desde all√≠ y transferirlos.  A pesar de su utilidad y simplicidad, esta utilidad no est√° incluida en ning√∫n est√°ndar y no se suministra con ning√∫n kit de distribuci√≥n.  En consecuencia, debe instalarse a mano. <br><br>  Una de las caracter√≠sticas interesantes de Netcat (nc) es la capacidad de escanear puertos: <br><br>  <code>nc -vn ipaddress 22</code> (escaneo de puerto √∫nico); <br>  <code>nc -v ipaddress 10-55</code> (escaneo de rango de puertos); <br>  <code>nc -l 4444</code> (abrir y escuchar el puerto 4444); <br>  <code>nc servername 4444</code> (nos conectamos al servidor en el puerto deseado). <br><br>  Despu√©s de abrir el puerto y conectarnos a √©l, obtenemos una peque√±a sala de chat de red =). <br><br>  A continuaci√≥n, consideramos la posibilidad de transferir archivos utilizando la utilidad nc.  Para hacer esto, el siguiente comando nos ayudar√°: <br><br> <code>cat test_file | pv -b | nc -l 4444</code>  <code>cat test_file | pv -b | nc -l 4444</code> (abra el puerto y transfi√©ralo a trav√©s de la tuber√≠a; la utilidad pv con el modificador -b se usa para mostrar el progreso de la transferencia de archivos en bytes). <br><br> <code>nc servername 4444 | pv -b &gt; filename</code>  <code>nc servername 4444 | pv -b &gt; filename</code> (nos conectamos al servidor para recibir el archivo, pv -b se usa de la misma manera). <br><br>  Podemos complicar nuestra tuber√≠a agregando archivos de archivos sobre la marcha: <br><br> <code>tar -czf - /path/to/ | pv -b | nc -l 4444</code>  <code>tar -czf - /path/to/ | pv -b | nc -l 4444</code> (archivando carpetas sobre la marcha y enviando); <br>  n <code>c servername 4444 | pv -b &gt; file.tar.gz</code>  <code>c servername 4444 | pv -b &gt; file.tar.gz</code> ( <code>c servername 4444 | pv -b &gt; file.tar.gz</code> el archivo). <br><br>  Una caracter√≠stica no muy obvia de nc es crear solo un servidor http. <br><br><pre> <code class="plaintext hljs">while true; do nc -lp 80 &lt; index.html; done</code> </pre> <br>  Tenga en cuenta que para usar el puerto 80, debe tener privilegios de root. <br><br>  Tambi√©n tenga en cuenta que: <br><br><ul><li>  -l - indica el modo operativo de escucha; </li><li>  -n: no utiliza consultas DNS; </li><li>  -v - salida detallada. </li></ul><br>  <b>Socat</b> <br><br>  Tambi√©n es una utilidad √∫til que le permite establecer conexiones TCP entre m√°quinas, puertos de reenv√≠o, etc. Funciona seg√∫n el principio de Netcat: abre dos conexiones bidireccionales, puede transferir datos, flujos, etc. Sin embargo, tiene una caracter√≠stica interesante.  Por ejemplo, usando Socat, podemos asignar puertos COM a puertos TCP, etc. <br><br>  Ejemplos de trabajo de Socat: <br><br>  <code>socat -u FILE:file_name TCP-LISTEN:5778,reuseaddr</code> # enviar archivo; <br> <code>socat -u TCP:192.168.1.48:5778 STDOUT | pv -r &gt; file_name</code>  <code>socat -u TCP:192.168.1.48:5778 STDOUT | pv -r &gt; file_name</code> # obtener archivo; <br>  <code>socat TCP-LISTEN:80,fork TCP:ubuntunode-4:80</code> # reenv√≠o de puerto del servidor remoto al puerto local; <br>  <code>socat TCP-LISTEN:1234,reuseaddr EXEC:/bin/bash</code> # Open remote shell =); <br>  <code>socat - TCP:server_with_remote_shell:1234</code> # Con√©ctese al shell remoto del servidor remoto. <br><br>  Peque√±o descifrado: <br><br><ul><li>  -u - uso del modo unidireccional; </li><li>  ARCHIVO - indica que estamos usando el archivo; </li><li>  TCP-LISTEN: escucha el puerto tcp; </li><li>  reuseaddr: permite que otros sockets se comuniquen con la misma direcci√≥n, incluso si se usa; </li><li>  fork: una vez establecida la conexi√≥n, el canal se procesa en el proceso secundario; </li><li>  TCP es el tipo de conexi√≥n. </li></ul><br>  <b>¬øDebo ver la versi√≥n de video ahora?</b> <br><br>  Por supuesto, s√≠, porque en la descripci√≥n todo se presenta de manera abstracta.  Adem√°s, los temas del seminario web se describen con m√°s detalle, y algunos de ellos proporcionan ejemplos adicionales y opciones de implementaci√≥n.  Por lo tanto, si est√° interesado en este tema, mire la lecci√≥n abierta por completo y repita todos los pasos para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Drozdetsky</a> para una m√°xima asimilaci√≥n del material.  Y no olvides dejar tus comentarios. <br><br>  ¬°Nosotros, a su vez, no nos despedimos y lo invitamos al curso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Administrador de Linux</a> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437114/">https://habr.com/ru/post/437114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437104/index.html">Introscopio: bueno, pruebas unitarias muy flojas</a></li>
<li><a href="../437106/index.html">IT en la zona .it</a></li>
<li><a href="../437108/index.html">La mayor√≠a de los textos en Internet est√°n escritos por locos.</a></li>
<li><a href="../437110/index.html">Los nanomateriales est√°n cambiando nuestro mundo y todav√≠a no tenemos procedimientos para verificar su seguridad.</a></li>
<li><a href="../437112/index.html">DMA: mitos y realidad</a></li>
<li><a href="../437116/index.html">AWS, MongoDB y las realidades econ√≥micas del c√≥digo abierto</a></li>
<li><a href="../437118/index.html">AI y 2048. Parte 1: M√©todo Monte Carlo</a></li>
<li><a href="../437120/index.html">Silla de oficina coreana: sensaciones de milagro Harachair</a></li>
<li><a href="../437122/index.html">Nombrando cosas</a></li>
<li><a href="../437124/index.html">Una manera f√°cil de agregar varios idiomas a su sitio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>