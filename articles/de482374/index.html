<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚ÄçüöÄ ü¶ë üë©üèæ‚Äçüç≥ Entwickeln von Spielen unter LibGDX mithilfe der Entity Component System-Vorlage üì≤ ‚úåÔ∏è ‚õàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Mein Name ist Andrey Shilo, ich bin ein Android-Entwickler bei FINCH . Heute werde ich Ihnen erz√§hlen, welche Fehler beim Schreiben selbst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwickeln von Spielen unter LibGDX mithilfe der Entity Component System-Vorlage</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482374/">  Hallo Habr!  Mein Name ist Andrey Shilo, ich bin ein Android-Entwickler bei <a href="https://www.facebook.com/FinchMoscow">FINCH</a> .  Heute werde ich Ihnen erz√§hlen, welche Fehler beim Schreiben selbst des einfachsten Spiels nicht gemacht werden sollten und warum der Architekturansatz von <a href="https://en.wikipedia.org/wiki/Entity_component_system">Entity Component System</a> (ECS) cool ist. <br><a name="habracut"></a><br><h2>  Das erste Mal ist immer schmerzhaft </h2><br>  Wir haben ein lustiges Projekt f√ºr eine gro√üe Medienholding, die ein nicht standardisiertes soziales Netzwerk ist.  Netzwerk mit Beitr√§gen, Kommentaren, Likes und Videos.  Einmal gaben sie uns eine Aufgabe - Spielmechanik als Promotion einzuf√ºhren.  Das Spiel sah aus wie ein einfaches Mini-Rennen, bei dem das Auto mit einem Fingertipp auf die linke / rechte Spur gefahren wurde.  Um Hindernissen auszuweichen und Booster zu sammeln, musste man die Ziellinie erreichen. Insgesamt hatte der Spieler drei Leben. <br><br>  Das Spiel sollte nat√ºrlich direkt in der Anwendung auf einem separaten Bildschirm implementiert werden.  Wir haben uns bedingungslos f√ºr <a href="https://libgdx.badlogicgames.com/">LibGDX</a> als Engine entschieden, da Sie das Spiel auf kotiln codieren und auf dem Desktop debuggen und das Spiel als <a href="https://libgdx.badlogicgames.com/documentation/gettingstarted/Running%2520and%2520Debugging.html">Java-Anwendung</a> starten <a href="https://libgdx.badlogicgames.com/documentation/gettingstarted/Running%2520and%2520Debugging.html">k√∂nnen</a> .  Zur gleichen Zeit hatten wir keine Leute, die andere Engines kannten, die in der Anwendung implementiert werden konnten (wenn Sie es wissen, dann teilen Sie es). <br><br>  Das Spiel sieht so aus: <br><br><img src="https://habrastorage.org/webt/le/xy/z0/lexyz0syrcyj6czcecctxnw0kh8.jpeg"><br><br>  Da das Spiel nach dem urspr√ºnglichen TK einfach zu sein schien, haben wir uns nicht mit architektonischen Ans√§tzen befasst.  Dar√ºber hinaus vergehen die Werbeaktionen selbst schnell - durchschnittlich dauert eine Aktie anderthalb Monate.  Dementsprechend wird der Spielcode sp√§ter einfach ausgeschnitten und erst bei der n√§chsten solchen Promo ben√∂tigt, vorausgesetzt, jemand m√∂chte so etwas wiederholen. <br><br>  Alle oben beschriebenen Faktoren und die geliebten, dr√§ngenden Manager haben uns dazu gedr√§ngt, eine Spielmechanik ohne Architektur zu schreiben. <br><br><h2>  Beschreibung des entstehenden Spiels </h2><br>  Der Gro√üteil des Codes wurde in den Klassen MyGdxGame: <a href="https://libgdx.badlogicgames.com/ci/nightlies/docs/api/com/badlogic/gdx/Game.html">Game</a> , GameScreen: <a href="https://libgdx.badlogicgames.com/ci/nightlies/docs/api/com/badlogic/gdx/Screen.html">Screen</a> und TrafficGame: <a href="https://libgdx.badlogicgames.com/ci/nightlies/docs/api/com/badlogic/gdx/scenes/scene2d/Actor.html">Actor</a> kompiliert. <br><br>  MyGdxGame - ist der Einstiegspunkt zu Beginn des Spiels, hier werden die Parameter in Form von Strings an den Konstruktor √ºbergeben.  Hier werden auch GameScreen und Spielparameter angelegt, die in einer anderen Form an diese Klasse weitergegeben werden. <br><br>  GameScreen - Erstellt einen Darsteller des Spiels TrafficGame, f√ºgt ihn der Szene hinzu, √ºbertr√§gt die bereits erw√§hnten Parameter und ‚Äûlauscht‚Äú auch den Klicks des Benutzers auf den Bildschirm und ruft die entsprechenden Methoden des Darstellers TrafficGame auf. <br><br>  TrafficGame - der Hauptdarsteller der Szene, in der alle Bewegungen des Spiels stattfinden: Rendering und Logik der Arbeit. <br><br>  Die Verwendung von <a href="https://github.com/libgdx/libgdx/wiki/Scene2d">scene2d</a> erm√∂glicht zwar das Bauen von Akteur-Nesting-B√§umen, dies ist jedoch nicht die beste architektonische L√∂sung.  F√ºr die Implementierung eines UI / UX-Spiels (unter LibGDX) ist scene2d jedoch eine hervorragende Option. <br><br>  In unserem Fall verf√ºgt TrafficGame √ºber eine riesige Sammlung gemischter Instanzen und allerlei Verhaltensflags, die in Methoden mit gro√üen <i>when-</i> Konstrukten zul√§ssig waren.  Ein Beispiel: <br><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isGameActive: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(value) { backgroundActor?.isGameActive = value boostersMap.values.filterNotNull().forEach { it.isGameActive = value } obstaclesMap.values.filterNotNull().forEach { it.isGameActive = value } finishActor.isGameActive = value field = value } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> backgroundActoolbarActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pauseButtonActor: PauseButtonActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> finishActor: FinishActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isQuizWon = falser: BackgroundActor? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playerCarActor: PlayerCarActor <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toolbarActor: To <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pointsTime = <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalTimeElapsed = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeToFinishTheGame = <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastQuizBoosterTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastBoosterTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boostersMap = hashMapOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>?, BoosterActor?&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boosterSpawnedCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> totalBoostersEatenCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boosterLimit = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastBoosterYPos = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toGenerateBooster = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastObstacleTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obstaclesMap = hashMapOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>?, ObstacleActor?&gt;()</code> </pre> <br>  Nat√ºrlich solltest du nicht so schreiben.  Aber in der Verteidigung werde ich sagen, dass es passiert ist, weil: <br><br><ul><li>  Sie m√ºssen jetzt beginnen, und wir werden die endg√ºltige TK mit dem Design sp√§ter zeigen.  Klassisch </li><li>  Bereits bekannte Architekturen (MVP / MVC / MVVM etc.) sind f√ºr die Implementierung des Spielprozesses nicht geeignet, da sie rein f√ºr die Benutzeroberfl√§che ausgelegt sind, im Spiel geschieht alles in Echtzeit. </li><li>  Urspr√ºnglich schien das Spiel einfach zu sein, aber es erforderte tats√§chlich viel Code, wobei eine gro√üe Anzahl von Nuancen ber√ºcksichtigt wurde, von denen der Gro√üteil w√§hrend des Schreibens des Spiels aufgetaucht ist. </li></ul><br><img src="https://habrastorage.org/webt/8e/cg/sn/8ecgsncl5hmmhmzw8unltjyqgh0.jpeg"><br><br>  Zus√§tzlich zu all diesen Schwierigkeiten gibt es ein weiteres h√§ufiges Problem bei der Vererbung.  Wenn Sie ein Spiel, beispielsweise einen Plattformer, erschweren, stellt sich die Frage: "Wie verteile ich wiederverwendbaren Code zwischen den Objekten des Spiels?".  Die am h√§ufigsten gew√§hlte Option ist die Vererbung, bei der der wiederverwendbare Code in den √ºbergeordneten Klassen abgelegt wird.  Diese L√∂sung verursacht jedoch viele Probleme, wenn Bedingungen angezeigt werden, die nicht in den Vererbungsbaum passen: <br><br><img src="https://habrastorage.org/webt/xg/tw/_6/xgtw_64w3v31if0kfnwoy9yemlg.png"><br><br>  Und normalerweise l√∂sen sie solche Probleme, indem sie die Struktur des Vererbungsbaums von Grund auf neu schreiben (diesmal ist es sicherlich besser), oder die Elternklassen sind mit Kr√ºcken zerbrochen. <br><br><img src="https://habrastorage.org/webt/af/8-/4o/af8-4ovkeruwatlo--agakilupm.gif"><br><br><h2>  ECS ist unser Alles </h2><br>  Eine ganz andere Geschichte ist unser zweites Promo-Spiel.  Sie war wie <a href="https://ru.wikipedia.org/wiki/Flappy_Bird">Flappy Bird</a> , aber mit Unterschieden: Der Charakter wurde von der Stimme gesteuert und die Decke und der Boden waren keine Hindernisse - man konnte darauf rutschen. <br>  Ein Beispiel f√ºr das Gameplay und zum Vergleich den Vorgang des Spielens von Flappy Bird: <br><br><img src="https://habrastorage.org/webt/9k/sv/ao/9ksvaojzedwbnyd0nm602f2n90e.gif"><br><img src="https://habrastorage.org/webt/gr/sq/3t/grsq3twwn7aorv6utrvdvgnwldw.gif"><br><br>  Zur Verdeutlichung wird in diesem Beispiel die Kamera entfernt, um die Backstage des Spiels zu sehen.  Der Boden und die Decke sind quadratische Bl√∂cke, die bis zum Rand an den Anfang verschoben werden, und Hindernisse werden nach einem vorgegebenen Muster erzeugt, das von hinten kommt.  Das Design des Spiels wurde von den Kunden ausgew√§hlt, also wundern Sie sich nicht. <br><br>  Ich mag die Entwicklung von Spielen f√ºr mobile Ger√§te und in der Freizeit werde ich mich experimentell mit Spielmustern und allem anderen besch√§ftigen, was mit der Spieleentwicklung zu tun hat.  Ich las ein Buch √ºber <a href="https://gameprogrammingpatterns.com/">Game-Design-Muster</a> , verstand aber nicht, wie die wahre Architektur der Gameplay-Logik aussehen sollte, bis ich auf ECS stie√ü. <br><br>  Entity Component System - das Designmuster, das in der Spieleentwicklung am h√§ufigsten verwendet wird.  Die Hauptidee des Musters ist <a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">Komposition statt Vererbung</a> .  Die Komposition erm√∂glicht es Ihnen, verschiedene Mechanismen an Spielobjekten zu mischen. Dies erm√∂glicht es Ihnen in Zukunft, die Einstellung von Objekteigenschaften an einen Spieledesigner zu delegieren, beispielsweise durch einen schriftlichen Konstruktor.  Da ich mit diesem Muster bereits vertraut war, beschlossen wir, es im zweiten Spiel anzuwenden. <br><br>  Betrachten Sie die Komponenten des Musters: <br><br><ul><li>  <i>Komponente</i> - Objekte mit einer <b>einfachen Datenstruktur,</b> die keine Logik enthalten oder als Verkn√ºpfung dienen.  Die Komponenten sind nach Verwendungszweck unterteilt und bestimmen alle Eigenschaften der Spielobjekte.  Geschwindigkeit, Position, Textur, K√∂rper usw.  usw.  All dies wird in den Komponenten beschrieben und dann zu den Spielobjekten hinzugef√ºgt. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VelocityComponent</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component { val velocity = Vector2</span></span></span></span>() }</code> </pre> </li><li>  <i>Entity</i> - Spielobjekte: Hindernisse / Booster / kontrollierter Held und sogar Hintergrund.  Sie haben keine speziellen Klassen nach Typ: UltraMegaSuperman: GameUnit, sondern sind einfach <b>Container</b> f√ºr das Komponentenset.  Die Tatsache, dass eine bestimmte Entit√§t dabei UltraMegaSuperman ist, definiert deren Komponentensatz und deren Parameter. <br>  In unserem Fall hatte die Hauptfigur beispielsweise die folgenden Komponenten: <br><br><ul><li>  TextureComponent - definiert, was auf dem Bildschirm gezeichnet werden soll </li><li>  TransformComponent - Die Position des Objekts im Spielfeld </li><li>  VelocityComponent - Geschwindigkeit des Objekts im Spielfeld </li><li>  HeroControllerComponent - enth√§lt Werte, die die Bewegung des Helden beeinflussen </li><li>  ImmortalityTimeComponent - enth√§lt die verbleibende Zeit der Unsterblichkeit </li><li>  DynamicComponent - Gibt an, dass das Objekt nicht statisch ist und der Schwerkraft ausgesetzt ist </li><li>  BodyComponent - Definiert den physischen 2D-Heldenk√∂rper, der zur Berechnung von Kollisionen ben√∂tigt wird </li></ul></li><li>  <i>System</i> - enth√§lt den Code f√ºr die Verarbeitung von Daten aus den Komponenten jeder Entit√§t.  Sie d√ºrfen <b>keine Entity- und / oder Component-Objekte speichern</b> , da dies dem Muster widerspricht.  Idealerweise sollten sie √ºberhaupt sauber sein. <br><br>  Systeme erledigen die ganze Drecksarbeit: Zeichnen Sie alle Objekte im Spiel, bewegen Sie das Objekt anhand seiner Geschwindigkeit, pr√ºfen Sie auf Kollisionen, √§ndern Sie die Geschwindigkeit von der eingehenden Steuerung aus und so weiter.  Zum Beispiel sieht der Effekt der Schwerkraft so aus: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Entity</span></span></span></span><span class="hljs-function"><span class="hljs-params">, deltaTime: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { entity.getComponent(VelocityComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">velocity</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">add</span></span></span></span>(<span class="hljs-number"><span class="hljs-number">0f</span></span>, -GRAVITY * deltaTime) }</code> </pre> <br>  Die Spezialisierung jedes Systems bestimmt die Anforderungen an die Entit√§ten, die es verarbeiten muss.  Das hei√üt, im obigen Beispiel muss die Entit√§t √ºber die Geschwindigkeitskomponenten VelocityComponent und DynamicComponent verf√ºgen, damit diese Entit√§t verarbeitet werden kann. Andernfalls ist diese Entit√§t f√ºr das System und f√ºr die anderen nicht interessant.  Um beispielsweise eine Textur zu zeichnen, m√ºssen Sie wissen, um welche Textur es sich bei TextureComponent handelt und wo Sie die TransformComponent zeichnen m√ºssen.  Um die Anforderungen in jedem System zu bestimmen, wird die Familie in den Konstruktor geschrieben, in dem die Komponentenklassen angegeben sind. <br><br><pre> <code class="kotlin hljs">Family.all(TransformComponent::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TextureComponent::class.java).get</span></span></span></span>()</code> </pre> <br>  Auch die Reihenfolge der Verarbeitungseinheiten innerhalb des Systems kann durch einen Komparator angepasst werden.  Dar√ºber hinaus wird die Reihenfolge der Ausf√ºhrung von Systemen in der Maschine auch durch den Priorit√§tswert geregelt. <br></li></ul><br>  Der Motor kombiniert drei Komponenten.  Es enth√§lt alle Systeme und alle Entit√§ten im Spiel.  Zu Beginn des Spiels alle notwendigen Systeme im Spiel <br><br><pre> <code class="kotlin hljs">engine.apply { addSystem(ControlSystem()) addSystem(GravitySystem()) addSystem(renderingSystem) addSystem(MovementSystem()) addSystem(EnemyGeneratorSystem()) }</code> </pre>  sowie Starteinheiten werden der Engine hinzugef√ºgt, <br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hero: Entity = engine.createEntity() engine.addEntity(hero)</code> </pre> <br>  <a href="https://libgdx.badlogicgames.com/ci/ashley/docs/com/badlogic/ashley/core/PooledEngine.html">PooledEngine :: createEntity</a> - <a href="https://libgdx.badlogicgames.com/ci/ashley/docs/com/badlogic/ashley/core/PooledEngine.html">Ruft</a> ein Entity-Objekt aus dem <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2583%25D0%25BB">Pool ab</a> , da Entities w√§hrend des Spiels erstellt werden k√∂nnen, um den Speicher nicht zu verunreinigen.  Bei Bedarf werden sie aus dem Pool der Objekte √ºbernommen und beim L√∂schen zur√ºckgesetzt.  √Ñhnliches gilt f√ºr Komponenten.  Beim Empfang von Komponenten aus dem Pool m√ºssen alle Felder initialisiert werden, da sie m√∂glicherweise Informationen zur vorherigen Verwendung dieser Komponente enthalten. <br><br>  Die Beziehung zwischen den Hauptteilen des Musters wird nachfolgend dargestellt: <br><br><img src="https://habrastorage.org/webt/gk/tj/ak/gktjakst_gxpnuikd_bbgpnfv2a.png"><br><br>  Die Engine enth√§lt eine Sammlung von Systemen und eine Sammlung von Entit√§ten.  Jedes System erh√§lt eine Verkn√ºpfung von der Engine zu einer Sammlung von Entit√§ten, die eine Auswahl aus der allgemeinen Sammlung gem√§√ü den Anforderungen des Systems darstellt und w√§hrend des Spiels aktualisiert wird, wenn sich Entit√§ten und Komponenten √§ndern.  Jede Entit√§t enth√§lt eine Sammlung ihrer Komponenten, die sie im Spiel definieren. <br><br>  Der Spielzyklus ist wie folgt aufgebaut: <br><br><ol><li>  Mit der Implementierung des <a href="https://habr.com/ru/post/271315/">"Game Cycle"</a> -Musters von LibGDX erhalten wir bei der Aktualisierungsmethode das Inkrement zu jedem Zeitschritt - deltaTime. </li><li>  Als n√§chstes geben wir die Zeit an den Motor weiter.  Und er iteriert seinerseits zyklisch durch das System und verteilt sie deltaTime. <pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until systems.size()) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> system = systems[i] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (system.checkProcessing()) { system.update(deltaTime) } }</code> </pre> </li><li>  Systeme, die DeltaTime empfangen, sortieren ihre Entit√§ten und wenden √Ñnderungen unter Ber√ºcksichtigung von DeltaTime auf sie an. <pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until entities.size()) { processEntity(entities[i], deltaTime) }</code> </pre> </li></ol><br>  Dies geschieht in jeder Hinsicht. <br><br><h2>  ECS Vorteile </h2><br><ol><li>  <b>Daten stehen an erster Stelle</b> .  Da Systeme nur die Entit√§ten verarbeiten, die zu ihnen passen, wird das System in Abwesenheit solcher Entit√§ten einfach nichts tun. Dies erm√∂glicht es, neue Funktionen zu testen und zu debuggen und nur die daf√ºr erforderlichen Entit√§ten zu erstellen. <br><br>  Sie haben beispielsweise das Spiel "Tanks" erstellt.  Nach einiger Zeit haben Sie beschlossen, einen neuen Gel√§ndetyp hinzuzuf√ºgen - "Lava".  Wenn der Panzer versucht, ihn zu passieren, endet er mit einem Ausfall.  Aber futuristische Technologie kommt zur Rettung, indem Sie installieren, die Sie die Lava √ºberqueren k√∂nnen. <br><br>  Um einen solchen Fall zu debuggen, m√ºssen Sie keine vollst√§ndigen Panzermodelle erstellen und vollst√§ndige Karten mit hinzugef√ºgten Lavastandorten erstellen. √úberlegen Sie einfach, welche Komponenten der Panzer mindestens ben√∂tigt, und f√ºgen Sie dem zu testenden Spielmodul eine Entit√§t hinzu.  Das alles klingt offensichtlich, aber in der Tat st√∂√üt man auf die TheTank-Klasse, die im Konstruktor nach einer Liste von Parametern fragt: Kaliber, Geschwindigkeit, Sprite, Schussgeschwindigkeit, Mannschaftsnamen usw.  Dies ist jedoch nicht erforderlich, um Lavaschnitte zu testen. <br></li><li>  Dem Beispiel aus dem vorherigen Absatz folgend, stellen wir au√üerdem eine <b>gro√üe Flexibilit√§t fest</b> , da es mit diesem Ansatz viel einfacher ist, Features hinzuzuf√ºgen und zu entfernen. <br><br>  Ein echtes Beispiel.  Das Spielszenario unserer zweiten Promo war, dass der Benutzer nach ca. 2-min√ºtiger Ausf√ºhrung des Songs in die Ziellinie st√ºrzte und das Spiel den Countdown startete, indem er das Level erneut startete, aber Punkte sparte, wodurch der Spieler eine Pause bekam. <br><br>  Ein paar Tage vor der erwarteten Ver√∂ffentlichung steht die Aufgabe an, "die Ziellinie zu entfernen und eine halbe Stunde ununterbrochenes Spielen mit sich wiederholenden Hindernissen und Liedern zu melden".  Eine globale Ver√§nderung, die aber sehr einfach zu bewerkstelligen war - es gen√ºgte, die Essenz der Ziellinie zu entfernen und ein Bezugssystem f√ºr das Ende des Spiels hinzuzuf√ºgen. </li><li>  Alle Entwicklungen sind <b>einfach zu testen</b> .  Mit dem Wissen, dass die Daten an erster Stelle stehen, k√∂nnen Sie beliebige Testf√§lle simulieren, ausf√ºhren und das Ergebnis anzeigen. </li><li>  In Zukunft k√∂nnen Sie einen Server mit dem Spielprozess verbinden, <b>um den Status des</b> Spiels zu √ºberpr√ºfen.  Er wird durch den gleichen Code die gleiche Client-Eingabe ausf√ºhren und sein Ergebnis mit dem Ergebnis auf dem Client vergleichen.  Wenn die Daten nicht konvergieren, ist der Client ein Betr√ºger oder wir haben Fehler im Spiel. </li></ol><br><br><h2>  ECS in der gro√üen Welt von Gamedev </h2><br>  Gro√üe Unternehmen wie Unity, Epic oder Crytek verwenden diese Vorlage in ihren Frameworks, um Entwicklern ein Tool mit einer Vielzahl von Funktionen zur Verf√ºgung zu stellen.  Ich rate Ihnen, den Bericht dar√ºber zu <a href="https://www.youtube.com/watch%3Fv%3D2Hi3GeCBpd0">lesen,</a> wie die <a href="https://www.youtube.com/watch%3Fv%3D2Hi3GeCBpd0">Gameplay-Logik in Overwatch</a> implementiert <a href="https://www.youtube.com/watch%3Fv%3D2Hi3GeCBpd0">wurde</a> <br><br>  Zum besseren Verst√§ndnis habe ich ein kleines <a href="https://github.com/AndrewMisterio/examples">Beispiel √ºber Github gemacht</a> . <br>  Vielen Dank f√ºr Ihre Aufmerksamkeit! <br><br><h2>  Auch zum Thema: </h2><br><ul><li>  <a href="https://habr.com/ru/post/343778/">Implementierung und Beispiel des Spiels</a> </li><li>  <a href="https://habr.com/ru/post/358108/">ECS und alles in allem</a> </li><li>  <a href="https://leopotam.com/2/">ECS-Grundlagen</a> </li><li>  <a href="https://fateev.pro/ru/gamedev/entity-component-system">Komponenten- und Entit√§tssystem</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482374/">https://habr.com/ru/post/de482374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482362/index.html">Fast Anarchie: Eine kurze Geschichte von Fidonet, einem Projekt, bei dem es nicht darum geht, √ºber das Internet zu gewinnen</a></li>
<li><a href="../de482364/index.html">Dinge, die Sie [vielleicht] nicht √ºber Java wussten</a></li>
<li><a href="../de482366/index.html">Was halten Experten f√ºr Roboterautos von Tesla Autopilot?</a></li>
<li><a href="../de482370/index.html">nodejs: Prozessmanager und ES6-Module</a></li>
<li><a href="../de482372/index.html">Aktivieren Sie den erweiterten Sitzungsmodus f√ºr Arch Linux-G√§ste in Hyper-V</a></li>
<li><a href="../de482382/index.html">Vier Prinzipien der √úbersetzung oder wie wird eine Person einem maschinellen √úbersetzer nicht nachgeben?</a></li>
<li><a href="../de482384/index.html">Mein nicht realisiertes Projekt. Netzwerk von 200 MikroTik Routern</a></li>
<li><a href="../de482386/index.html">Visual Studio f√ºr Mac: √úbernehmen Sie die Kontrolle √ºber Ihre IDE mit Tastenkombinationen</a></li>
<li><a href="../de482392/index.html">ELF-Tricks in Go</a></li>
<li><a href="../de482396/index.html">So w√§hlen Sie kaufm√§nnische Kurse f√ºr IT-Berufe aus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>