<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèΩ üòô üÜô Mais l'essence est quelque chose, ou minimiser le code source est plus facile qu'il n'y para√Æt. ‚ú® üìÇ üõ∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En ces merveilleux jours de janvier, nous sommes tous, bien s√ªr, pr√©occup√©s par la question de minimiser le code source tout en pr√©servant l'invariant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mais l'essence est quelque chose, ou minimiser le code source est plus facile qu'il n'y para√Æt.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482634/"><img src="https://habrastorage.org/webt/ls/g9/gy/lsg9gy2nbzs5m0redadf6s3sqjc.png"><br><p>  En ces merveilleux jours de janvier, nous sommes tous, bien s√ªr, pr√©occup√©s par la question de minimiser le code source tout en pr√©servant l'invariant.  Je veux dire, je m'en fous?!?  En vain ... Ici le compilateur est tomb√©, et le programme est gigantesque - il est en quelque sorte g√™nant pour les d√©veloppeurs d'envoyer une telle chose.  Et puis le plaisir commence: que faire si vous le jetez?  Oh, √ßa ne tombe pas - d'accord, on le laisse, mais si c'est le cas?  - plante toujours, et ceci, et ceci, et cela ... Oh, j'ai d√©marr√© le compilateur sur les anciennes sources. </p><br><p>  Dans le m√™me temps, l'automatisation de la recherche de bugs est une question de vie: git bisect, llvm-bugpoint, creduce, ... Dans cet article je d√©crirai encore une autre fa√ßon de r√©soudre le probl√®me de la simplification du cas de test, plus ou moins universel par rapport au langage de programmation, et en montrerai quelques uns exemples d'utilisation. </p><a name="habracut"></a><br><p> Universel, disons ... Peut-√™tre, bien s√ªr, il a d√©j√† √©t√© mis en ≈ìuvre dix fois, mais cela arr√™terait-il un cycliste aguerri.  <em>Et quand entre les mains d'un microscope, tous les probl√®mes semblent √™tre des clous.</em>  Dans le r√¥le d'un microscope - <a href="https://pmd.github.io/" rel="nofollow">PMD</a> . </p><br><p>  En g√©n√©ral, il existe un tel langage pour √©crire des mod√®les d√©crits par des √©quations diff√©rentielles - Modelica.  Il est assez avanc√©, il y a une impl√©mentation ouverte tr√®s cool et en g√©n√©ral.  Mais il y a un petit probl√®me: parfois une erreur de compilation interne se produit dans le compilateur.  Dans un <a href="https://habr.com/ru/post/474920/">article pr√©c√©dent,</a> j'ai d√©j√† montr√© comment ajouter la prise en charge de Modela √† l'analyseur statique PMD (en passant, certaines de mes erreurs sont apparues lors du processus de r√©vision) en plus des dix modules de langage existants.  Alors maintenant, j'ai d√©cid√© - √† quoi bon dispara√Ætre - et j'ai envoy√© un outil de preuve de concept Source Code Minimizer, r√©utilisant les modules de langage PMD existants.  Malheureusement, j'ai √©t√© envoy√©, mais pas tr√®s loin, dans un r√©f√©rentiel voisin: le mentor a d√©clar√© qu'il ne d√©cidait toujours pas de prendre en charge cela jusqu'√† la fin du si√®cle, et qu'il est perdu dans la base de code commune, j'ai donc rapidement trouv√© une invitation √† collaborer dans ma bo√Æte de r√©ception est fra√Æchement cr√©√© <a href="https://github.com/pmd/pmd-scm" rel="nofollow">pmd / pmd-scm</a> . </p><br><p>  D'abord, quelle est l'√©nonc√© du probl√®me?  Il est n√©cessaire de r√©duire la taille du code source, en pr√©servant une partie de ses propri√©t√©s.  Plus pr√©cis√©ment, je veux </p><br><ul><li>  le code r√©sultant √©tait pr√©visible <br><ul><li>  il ne doit pas √™tre aussi <strong>minimal que possible</strong> , la ¬´fin de fichier¬ª est autoris√©e, mais elle ne devrait pas se transformer en tourment </li><li>  l'obfuscation automatique n'est pas envisag√©e </li></ul></li><li>  le programme minimis√© peut √™tre divis√© en plusieurs fichiers avec le code source <br><ul><li> par exemple, en Java, chaque classe <code>public</code> doit √™tre dans un fichier s√©par√© avec le nom correct, etc. </li><li>  Je veux que chaque fichier reste visible √† la fin </li></ul></li><li>  dans le processus de transformations, l'invariant indiqu√© doit √™tre conserv√© </li></ul><br><h2 id="vnutrennee-ustroystvo">  Dispositif interne </h2><br><p>  Dans cette section, je vais d√©crire grossi√®rement l'impl√©mentation.  Pour commencer, je constate √† nouveau que cette id√©e, pour le dire en douceur, n'est pas nouvelle.  Et si j'ai cit√© git bisect simplement comme exemple du ¬´m√©canisme de d√©bogage automatique¬ª, je suis tomb√© sur <a href="https://github.com/csmith-project/creduce" rel="nofollow">creduce</a> ou quelque chose de similaire pendant un certain temps (bien que je ne l'ait pas utilis√©).  Mais j'ai d√ª utiliser <a href="https://llvm.org/docs/Bugpoint.html" rel="nofollow">llvm-bugpoint</a> - c'est impressionnant: vous vous asseyez, d√©boguez votre LLVM Pass, et il - une telle infection - se bloque sur certains syst√®mes de fichiers.  Donc, vous pouvez compiler ce fichier en code bit LLVM, ex√©cuter <code>opt</code> sur le fichier .bc avec votre plugin et vous assurer qu'il se bloque.  Et puis, grosso modo, je viens de remplacer <code>opt</code> par <code>llvm-bugpoint</code> , et apr√®s une minute, j'ai eu un ¬´squelette¬ª lourd d'une des fonctions, consistant en un nuage de blocs de base et de transitions entre eux;  tout sauf les branches a √©t√© jet√© avec succ√®s.  Soit dit en passant, comme dans mon √©nonc√© du probl√®me, apr√®s une douzaine de minutes de simplification manuelle, tout se r√©sume au fait que j'ai mal trait√© l'un des types de branche, et tout le reste n'√©tait que d√©cor.  En g√©n√©ral, l'id√©e n'est pas nouvelle. </p><br><p>  Et maintenant pour la mise en ≈ìuvre.  Puisqu'il √©tait cens√© √™tre un outil plus ou moins universel, je voulais cr√©er une sorte de framework dans lequel nous pourrions entasser des impl√©mentations optimis√©es pour diff√©rents langages.  En cons√©quence, deux concepts plut√¥t orthogonaux se sont d√©marqu√©s: </p><br><ul><li>  pris en charge invariant </li><li>  strat√©gie de minimisation </li></ul><br><h2 id="invariant">  Invariant </h2><br><p>  J'ai d√©j√† d√©crit l'une des options de la propri√©t√© que vous souhaitiez enregistrer: ¬´le compilateur a imprim√© une phrase sur la console¬ª (¬´Erreur interne du compilateur¬ª, par exemple).  En outre, les id√©es peuvent √™tre glan√©es √† partir d'une vari√©t√© de fuzzers: <a href="https://github.com/google/AFL" rel="nofollow">AFL</a> , <a href="https://github.com/grimm-co/killerbeez" rel="nofollow">Killerbeez</a> et autres: </p><br><ul><li>  le processus s'est termin√© avec du code retour (en particulier, ¬´crash on signal¬ª sous Linux) </li><li>  le processus a pris plus de T millisecondes.  Ici, h√©las, une instabilit√© peut se produire en raison de la charge flottante du syst√®me.  Pour une plus grande pr√©cision, vous pouvez utiliser le temps CPU, bien que, id√©alement, les compteurs de performances soient utiles. </li><li>  le compilateur peut (pas) g√©n√©rer un fichier de sortie </li><li>  ... </li></ul><br><p>  J'ai d√©j√† impl√©ment√© certains d'entre eux (code retour, ligne imprim√©e), d'autres non, certains peuvent √™tre sp√©cifiques √† des langues individuelles.  En g√©n√©ral, il s'agit d'une partie de la t√¢che assez autonome, souvent compl√®tement ind√©pendante d'une langue sp√©cifique. </p><br><h2 id="strategiya-minimizacii">  Strat√©gie de minimisation </h2><br><p>  √Ä premi√®re vue, tout ici est purement d√©pendant de la langue.  Quelque part, vous devez jeter les variables avec les cas d'utilisation, quelque part - pour conserver le m√™me nombre d'√©quations et d'inconnues.  Il est d'autant plus important d'abstraire cette partie du code.  Mais quelque chose de basique peut √™tre rendu commun pour tout le monde: par exemple, d'un simple mouvement du poignet, le moteur de r√®gles XPath tourne ... tourne ... ... oh, pour XPath version 1.0, ce n'est pas le cas.  D√©sol√©, un petit probl√®me technique - dans un outil universel pour couper les arbres de syntaxe <del>  pour l'hiver </del>  .  En g√©n√©ral, l'API de strat√©gie de minimisation est assez simple: en gros, la fonction a une fonction d'√©tape (on lui donne une liste des n≈ìuds racine des arbres de syntaxe), qui peut demander "mais essayez de jeter ces branches" via l'interface d'op√©ration.  Si l'invariant est viol√©, la fonction retourne le contr√¥le; sinon, elle fait tourner la pile en lan√ßant une exception sp√©ciale, et la version r√©sultante est consid√©r√©e comme la prochaine approximation.  Un processus est consid√©r√© comme termin√© si la fonction d'√©tape a renvoy√© le contr√¥le sans passer par une exception.  Vous pouvez dire que cela est terriblement inefficace - peut-√™tre que oui, <del>  ZATO CONVENIENT !! 111 </del>  , mais de quoi s'agit-il, s'il est cens√© d√©marrer r√©guli√®rement le processus de compilation externe des centaines de fois dans un cycle. </p><br><p>  Cela soul√®ve la question: comment r√©cup√©rer la source de l'AST aminci?  Bien s√ªr, vous pouvez essayer d'√©crire un code sp√©cial pour chaque langue qui g√©n√®re un fichier texte.  Mais, comme vous le savez, un programmeur doit √™tre paresseux.  Donc √ßa ne marchera pas - ce n'est d√©j√† clairement pas de la s√©rie "ramass√© les impl√©mentations existantes et c'est parti."  Heureusement, dans les n≈ìuds de l'arborescence, il y a des informations sur les lignes et colonnes de d√©but et de fin pour ce n≈ìud - cela signifie que si le module de langue indique correctement ces informations, vous pouvez prendre le texte source et en d√©couper soigneusement des morceaux (d'o√π, d'ailleurs, et quelques difficult√©s d'obscurcissement: il ne suffit pas de jeter quelque chose, mais vous devez le remplacer: des identifiants, par exemple).  Soit dit en passant, dans la base de code PMD, nous avons m√™me trouv√© une classe pour √©diter un fichier en utilisant des op√©rations de coupe de texte sans intersection (ainsi que l'ajout, mais ce n'est pas si int√©ressant pour cette t√¢che particuli√®re). </p><br><h2 id="teoriya-itog">  Th√©orie: R√©sum√© </h2><br><p>  Pour le moment, j'ai mis en ≈ìuvre deux strat√©gies.  L'un d'eux est le d√©coupage XPath, qui est, dans un sens, un cas d√©g√©n√©r√©, car il √©crit de force le r√©sultat, m√™me s'il ne s'agit plus d'une source syntaxiquement correcte.  Le second est d√©j√† ¬´honn√™te¬ª it√©ratif et interactif (dans le sens o√π il interagit vraiment avec le compilateur et v√©rifie l'invariant): il essaie juste de lancer les branches une par une en boucle.  En voici un peu plus: </p><br><ul><li>  en principe, la v√©rification de l'invariant pour la source, qui n'est pas analys√©e, n'a gu√®re de sens pour une strat√©gie "honn√™te": m√™me si le compilateur survit √† cela, le minimiseur devra red√©marrer la source.  Par cons√©quent, il est logique de jeter les fichiers ¬´cass√©s¬ª √† l'avance: l'analyse dans votre processus est plus rapide que l'ex√©cution de tout le compilateur </li><li>  dans le cas g√©n√©ral, il serait probablement pratique d'utiliser des coroutines ici (enfin, ou de retourner le flux de contr√¥le √† l'envers), mais comme c'est loin d'√™tre la partie la plus difficile du calcul, √† chaque √©tape de la fonction d'√©tape, je me contente de marcher autour de l'arbre, en comptant la distance hauts.  Je me souviens seulement du comptoir.  Donc, au d√©but, je pensais que le sommet est plus grand, le sommet est moins - quelle diff√©rence cela fait-il, heuristique quand m√™me!  Il s'est av√©r√© que l'erreur par unit√© peut parfois modifier le taux de ¬´convergence¬ª.  En substance, c'est logique: jeter des fonctions enti√®res de la classe dans l'ordre sera souvent une strat√©gie efficace.  Mais pour sauter un peu, et chaque fois <strong>pour aller √† l'int√©rieur de la</strong> fonction, dans la plupart des cas n'ayant rien √† voir avec le probl√®me, cela ressemble √† une id√©e comme √ßa. </li><li>  par ailleurs sur les coroutines et le d√©ploiement du flux de contr√¥le: il y aurait des probl√®mes avec cela, car apr√®s le red√©marrage du texte modifi√©, l'AST peut ne pas changer de mani√®re tr√®s √©vidente (c'est-√†-dire non seulement ces branches seront rejet√©es, mais quelque part les n≈ìuds vides dispara√Ætront, quelque part g√©n√©ralement l'analyse va dans l'autre sens).  Sans oublier que les n≈ìuds de la nouvelle AST ne seront pas identiques par r√©f√©rence aux anciens, et la correspondance logique par <code>equals</code> - ressemble √©galement √† une t√¢che difficile </li><li>  en principe, vous pouvez utiliser les capacit√©s de PMD √† des degr√©s divers: vous pouvez utiliser des types calcul√©s, des d√©pendances de d√©finition-utilisation, etc.  et faites quelque chose de tr√®s intelligent (mais vous devez envisager une API universelle).  En revanche, pour la strat√©gie d√©crite, il suffit d'obtenir un arbre d'analyse.  Et ici, vous pouvez m√™me <a href="https://github.com/kaitai-io/kaitai_struct" rel="nofollow">accrocher</a> du <a href="https://github.com/kaitai-io/kaitai_struct" rel="nofollow">Kaitai Struct</a> et essayer de pousser <a href="https://github.com/google/AFL" rel="nofollow">afl-tmin</a> pour minimiser les fichiers binaires :) </li></ul><br><h2 id="praktika">  Pratique </h2><br><p>  Pour commencer, construisons un minimiseur: </p><br><pre> <code class="plaintext hljs">git clone https://github.com/pmd/pmd-scm.git cd pmd-scm ./mvnw clean verify unzip pmd-scm-dist/target/pmd-scm-bin-1.0.0-SNAPSHOT.zip</code> </pre> <br><p>  Maintenant, vous avez besoin d'une source.  Prenons <a href="" rel="nofollow">GreedyStrategy.java</a> par exemple. </p><br><p>  √Ä l'aide de <a href="https://github.com/pmd/pmd-designer" rel="nofollow">Rule Designer,</a> d√©couvrez √† quoi ressemble un AST typique pour Java et ex√©cutez </p><br><pre> <code class="plaintext hljs">$ ./bin/run.sh scm --language java \ --input-file ../pmd-scm/src/main/java/net/sourceforge/pmd/scm/strategies/GreedyStrategy.java \ --output-file GreedyStrategy-min.java \ --strategy xpath \ --xpath-expression '//BlockStatement[count(../BlockStatement) &gt; 1]' Original file(s): 6155 bytes, 1099 nodes. After initial white-space cleanup: size 4548 bytes (73%), 1099 nodes (100%) After pass #1: size 1984 bytes (32%), 1099 nodes (100%) After final white-space cleanup: size 1984 bytes (32%), 325 nodes (29%) After blank line clean up: size 1767 bytes (28%), 325 nodes (29%)</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net.sourceforge.pmd.scm.strategies; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collections; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.sourceforge.pmd.lang.ast.Node; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GreedyStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMinimizationStrategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MinimizationStrategy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GreedyStrategy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MinimizationStrategyConfigurationFactory FACTORY = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AbstractFactory(<span class="hljs-string"><span class="hljs-string">"greedy"</span></span>) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MinimizationStrategyConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreedyStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Configuration configuration)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(configuration); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Node, HashSet&lt;Node&gt;&gt; directlyDependingNodes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Node, Set&lt;Node&gt;&gt; transitivelyDependingNodes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchDirectDependentsFromSubtree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node node)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// process depending nodes } private Set&lt;Node&gt; indirectlyDependentNodesFor(Node currentNode) { } private void collectNodesToRemove(Set&lt;Node&gt; result, Node node) { } private int previousPosition = 0; private int positionCountdown; private void findNodeToRemove(Node currentNode) throws Exception { } private void processSingleRoot(Node currentRoot) throws Exception { // cannot remove root for (int i = 0; i &lt; currentRoot.jjtGetNumChildren(); ++i) { findNodeToRemove(currentRoot.jjtGetChild(i)); } } @Override public void performSinglePass(List&lt;Node&gt; roots) throws Exception { } }</span></span></code> </pre> <br><p>  Autrement dit, nous avons vid√© toutes les fonctions <em>contenant directement plus d'une instruction</em> .  Cependant, la suppression des commentaires, des lignes vides, etc.  Je ne l'ai pas pr√©cis√© - apr√®s tout, est-ce (jusqu'√† pr√©sent?) Principalement un outil de <strong>d√©bogage des compilateurs</strong> , plut√¥t que de cr√©er de belles descriptions d'interface. </p><br><p>  Regardons quelque chose de plus int√©ressant maintenant: essayez de minimiser deux fichiers avec les commentaires du compilateur en m√™me temps: </p><br><p>  <strong>orig / TestResource.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.err.println(<span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unused</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// unused } }</span></span></code> </pre> <br><p>  <strong>orig / Main.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestResource().func(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>; } }</code> </pre> <br><p>  Comme vous pouvez le voir, ils ne compilent pas: </p><br><pre> <code class="plaintext hljs">$ javac orig/TestResource.java orig/Main.java orig/Main.java:3: error: incompatible types: int cannot be converted to String String str = new TestResource().func(); ^ orig/Main.java:5: error: incompatible types: unexpected return value return 123; ^ 2 errors</code> </pre> <br><p>  Imaginons que quelque chose ne va pas avec la premi√®re erreur, et essayons de faire un exemple minimal qui produit </p><br><pre> <code class="plaintext hljs">error: incompatible types: int cannot be converted to String</code> </pre> <br><p>  Pour ce faire, ex√©cutez </p><br><pre> <code class="plaintext hljs">$ bin/run.sh scm --language java \ --input-file orig/TestResource.java orig/Main.java \ --output-file TestResource.java Main.java \ --invariant message \ --printed-message "error: incompatible types: int cannot be converted to String"\ --command-line "javac TestResource.java Main.java" \ --strategy greedy Original file(s): 290 bytes, 77 nodes. After initial white-space cleanup: size 258 bytes (88%), 77 nodes (100%) After pass #1: size 255 bytes (87%), 64 nodes (83%) After pass #2: size 244 bytes (84%), 57 nodes (74%) After pass #3: size 205 bytes (70%), 51 nodes (66%) After pass #4: size 192 bytes (66%), 46 nodes (59%) After pass #5: size 181 bytes (62%), 39 nodes (50%) After pass #6: size 179 bytes (61%), 39 nodes (50%) After final white-space cleanup: size 149 bytes (51%), 39 nodes (50%) After blank line clean up: size 147 bytes (50%), 39 nodes (50%)</code> </pre> <br><p>  En cons√©quence, nous obtenons </p><br><p>  <strong>TestResource.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  <strong>Main.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestResource().func(); } }</code> </pre> <br><pre> <code class="plaintext hljs">$ javac TestResource.java Main.java TestResource.java:3: error: missing return statement } ^ Main.java:3: error: incompatible types: int cannot be converted to String String str = new TestResource().func(); ^ 2 errors</code> </pre> <br><p>  Tout comme command√©! </p><br><h2 id="itog">  R√©sum√© </h2><br><p>  Jusqu'√† pr√©sent, le projet est √† un stade assez pr√©coce, mais il y a d√©j√† quelque chose √† d√©montrer.  √Ä l'avenir, il y a des id√©es pour cr√©er une API pour les d√©pendances d'indication de langue entre les n≈ìuds AST, afin de permettre de fournir des strat√©gies sp√©cifiques au langage.  Il serait √©galement int√©ressant de cr√©er une strat√©gie universelle qui ex√©cute le script Groovy / Kotlin / autre chose - apr√®s tout, les gens qui utilisent Java ne l'ont peut-√™tre jamais vu, mais ils connaissent parfaitement bien, par exemple, Modelika, et ont dans leur t√™te leurs moyens avanc√©s pour presser la source. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482634/">https://habr.com/ru/post/fr482634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482614/index.html">L'utilisation de BSP dans Doom est-elle vraiment une initiative ing√©nieuse?</a></li>
<li><a href="../fr482620/index.html">Slurm: Habr, bonnes vacances ...</a></li>
<li><a href="../fr482622/index.html">Simulation de courir sous la pluie</a></li>
<li><a href="../fr482626/index.html">Surveillance des applications avec Logger.Backends</a></li>
<li><a href="../fr482628/index.html">Regardez "Little Green Spider of Time"</a></li>
<li><a href="../fr482636/index.html">Exp√©rience d'admission dans une magistrature en Allemagne (analyse d√©taill√©e)</a></li>
<li><a href="../fr482642/index.html">OSCD: Sprint Detection Sprint # 1, r√©sultats</a></li>
<li><a href="../fr482644/index.html">Enregistreur de frappe pour Windows avec changement de droits dans DACL</a></li>
<li><a href="../fr482646/index.html">Am√©liorez les performances du SPA en divisant vos biblioth√®ques angulaires en plusieurs parties</a></li>
<li><a href="../fr482648/index.html">Arthur Khachuyan: ¬´Du vrai Big Data dans la publicit√©¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>