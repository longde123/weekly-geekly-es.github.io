<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš  ğŸ‘¶ğŸ½ â¬‡ï¸ Meilleure priorisation HTTP / 2 pour l'accÃ©lÃ©ration Web ğŸˆ ğŸŒº ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HTTP / 2 promettait d'accÃ©lÃ©rer considÃ©rablement le Web, et Cloudflare a depuis longtemps dÃ©ployÃ© un accÃ¨s HTTP / 2 pour tous les clients. Mais une ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meilleure priorisation HTTP / 2 pour l'accÃ©lÃ©ration Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452020/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57d/5cf/dbe/57d5cfdbe917c7b464a249fb187b3ffd.png"></div><br>  HTTP / 2 promettait d'accÃ©lÃ©rer considÃ©rablement le Web, et Cloudflare a depuis longtemps dÃ©ployÃ© un accÃ¨s HTTP / 2 pour tous les clients.  Mais une caractÃ©ristique de HTTP / 2, la priorisation, n'a pas rÃ©pondu aux attentes.  Non pas parce qu'il est fondamentalement cassÃ©, mais Ã  cause de l'implÃ©mentation dans les navigateurs. <br><br>  Aujourd'hui, Cloudflare suggÃ¨re de changer la priorisation de HTTP / 2, ce qui donne Ã  nos serveurs le contrÃ´le des dÃ©cisions de priorisation qui accÃ©lÃ¨rent vraiment Internet. <br><br>  Historiquement, c'Ã©tait le navigateur qui contrÃ´lait comment et quand tÃ©lÃ©charger du contenu Web.  Aujourd'hui, pour tous les plans payants, nous apportons des changements radicaux Ã  ce modÃ¨le.  Ils transfÃ¨rent le contrÃ´le directement au propriÃ©taire du site.  Sur l'onglet Â«VitesseÂ» du tableau de bord Cloudflare, les clients peuvent activer la Â«hiÃ©rarchisation HTTP / 2 avancÃ©eÂ»: il remplace les paramÃ¨tres par dÃ©faut du navigateur par un schÃ©ma de planification amÃ©liorÃ©, ce qui accÃ©lÃ¨re considÃ©rablement l'accÃ¨s des visiteurs (dans certains cas, nous avons constatÃ© une augmentation de 50%).  Avec les travailleurs Cloudflare, les propriÃ©taires de sites peuvent aller encore plus loin et personnaliser entiÃ¨rement les paramÃ¨tres en fonction de leurs besoins spÃ©cifiques. <br><a name="habracut"></a><br><h1>  Situation actuelle </h1><br>  Les pages Web se composent de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://discuss.">dizaines (parfois des centaines) de</a> ressources individuelles qui sont tÃ©lÃ©chargÃ©es et collectÃ©es par le navigateur dans le contenu final affichÃ©.  Cela inclut le contenu visible avec lequel l'utilisateur interagit (HTML, CSS, images), ainsi que la logique d'application (JavaScript) pour le site lui-mÃªme, les balises de publicitÃ©, d'analyse et de marketing.  Du point de vue de l'utilisateur, la sÃ©quence dans laquelle ces ressources sont chargÃ©es est trÃ¨s importante: cela affecte le moment oÃ¹ il voit le contenu et peut interagir avec la page. <br><br>  Un navigateur est, en fait, un moteur de traitement HTML qui traverse un document HTML et suit les instructions dans l'ordre: du dÃ©but Ã  la fin du HTML, la construction de la page au fur et Ã  mesure de ses dÃ©placements.  Les liens de feuille de style (CSS) indiquent au navigateur comment styliser le contenu de la page, et le navigateur retardera l'affichage du contenu jusqu'Ã  ce qu'il charge la feuille de style.  Les scripts sur la page peuvent avoir des comportements diffÃ©rents.  Si le script est marquÃ© comme Â«asynchroneÂ» ou Â«en attenteÂ», le navigateur peut continuer Ã  traiter le document et simplement exÃ©cuter le script lorsqu'il sera disponible.  Si le script n'est pas marquÃ© comme asynchrone ou diffÃ©rÃ©, le navigateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DOIT</a> arrÃªter de traiter le document jusqu'Ã  ce que le script soit chargÃ© et exÃ©cutÃ©.  Ces scripts sont appelÃ©s "blocage" car ils empÃªchent le navigateur de continuer Ã  traiter le document. <br><br>  Le document HTML est divisÃ© en deux parties.  Le titre du document &lt;head&gt; est au dÃ©but et contient des feuilles de style, des scripts et d'autres instructions du navigateur nÃ©cessaires pour afficher le contenu.  Une fois que l'en-tÃªte est le corps du document &lt;body&gt;, il contient le contenu rÃ©el affichÃ© dans la fenÃªtre du navigateur (bien que les scripts et les feuilles de style puissent Ã©galement Ãªtre dans le corps).  Tant que le navigateur n'a pas atteint le corps du document, l'utilisateur n'a rien Ã  afficher et la page reste vierge.  Par consÃ©quent, il est important de traiter l'en-tÃªte le plus rapidement possible.  Si les dÃ©tails vous intÃ©ressent, le site Web <i>HTML5 Rocks</i> propose un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">excellent didacticiel</a> sur le fonctionnement des navigateurs. <br><br>  Le navigateur est gÃ©nÃ©ralement responsable de l'ordre dans lequel les diffÃ©rentes ressources nÃ©cessaires pour crÃ©er la page et poursuivre le traitement du document sont chargÃ©es.  Dans HTTP / 1.x, il existe des restrictions sur le nombre d'objets que le navigateur peut demander Ã  n'importe quel serveur Ã  la fois (gÃ©nÃ©ralement 6 connexions et une seule ressource Ã  la fois par connexion), donc l'ordre des demandes est strictement contrÃ´lÃ© par le navigateur.  Dans HTTP / 2, la situation est complÃ¨tement diffÃ©rente.  Le navigateur peut demander toutes les ressources Ã  la fois (au moins dÃ¨s qu'il les dÃ©couvre) et fournit au serveur des instructions dÃ©taillÃ©es sur la faÃ§on de fournir ces ressources. <br><br><h1>  Ordre de chargement optimal des ressources </h1><br>  Pour la plupart des piÃ¨ces, il existe un ordre optimal dans le cycle de chargement de la page qui maximise la disponibilitÃ© de la page pour l'utilisateur (et la diffÃ©rence entre l'ordre de chargement optimal et non optimal peut atteindre 50% ou plus). <br><br>  Comme dÃ©crit ci-dessus, avant que le navigateur puisse afficher du contenu, il est bloquÃ© par CSS et JavaScript dans la section <code>&lt;head&gt;</code> .  Ã€ ce stade, il est plus rentable d'utiliser 100% du canal pour charger les ressources de blocage, plutÃ´t que de les charger dans l'ordre, car elles sont Ã©crites dans le code HTML.  Cela permet au navigateur d'analyser et d'exÃ©cuter chaque Ã©lÃ©ment lors du chargement de la prochaine ressource de blocage, ce qui crÃ©e un pipeline optimal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db9/e18/fbe/db9e18fbe00d27755a152a8deabbcaa4.png"><br><br>  Le temps de chargement du script pour le chargement parallÃ¨le ou sÃ©quentiel ne diffÃ¨re pas, mais pour le chargement sÃ©quentiel, le premier script peut Ãªtre traitÃ© et exÃ©cutÃ© lors du deuxiÃ¨me chargement. <br><br>  AprÃ¨s le chargement des ressources bloquantes, la situation devient un peu plus intÃ©ressante.  Ici, la charge optimale peut dÃ©pendre d'un site particulier ou mÃªme des prioritÃ©s de l'entreprise (sÃ©lection de contenu gÃ©nÃ©rÃ© par l'utilisateur ou de publicitÃ©, ou d'analyse, etc.).  Un problÃ¨me distinct avec les polices, car le navigateur dÃ©tecte les polices souhaitÃ©es aprÃ¨s avoir appliquÃ© la feuille de style au contenu affichÃ©.  Par consÃ©quent, au moment oÃ¹ le navigateur dÃ©couvre la police, il est nÃ©cessaire d'afficher Ã  l'Ã©cran du texte dÃ©jÃ  prÃªt Ã  Ãªtre affichÃ©.  Tout retard dans le chargement de la police n'entraÃ®ne aucun texte Ã  l'Ã©cran (ou le texte s'affiche dans la mauvaise police). <br><br>  En rÃ¨gle gÃ©nÃ©rale, certains compromis doivent Ãªtre pris en compte: <br><br><ul><li>  Les polices et images personnalisÃ©es dans la partie visible de la page (fenÃªtre) doivent Ãªtre chargÃ©es aussi rapidement que possible.  Ils affectent directement l'expÃ©rience visuelle de l'utilisateur lors du chargement de la page. <br></li><li>  Le JavaScript non bloquant doit Ãªtre chargÃ© sÃ©quentiellement par rapport aux autres ressources JavaScript afin que chacune d'entre elles puisse Ãªtre canalisÃ©e.  JavaScript peut inclure une logique d'application personnalisÃ©e, ainsi que des balises de suivi pour l'analyse et le marketing, et leur retard peut entraÃ®ner une diminution des indicateurs suivis par l'entreprise. <br></li><li>  Les images peuvent Ãªtre tÃ©lÃ©chargÃ©es en parallÃ¨le.  Les premiers octets du fichier image contiennent sa taille, ce qui peut Ãªtre nÃ©cessaire pour la disposition du navigateur, et le chargement parallÃ¨le d'images progressives peut fournir une complÃ©tude visuelle aprÃ¨s avoir transfÃ©rÃ© environ 50% du volume total. </li></ul><br>  Ã‰tant donnÃ© les compromis, dans la plupart des cas, cette stratÃ©gie fonctionne bien: <br><br><ul><li>  Les polices personnalisÃ©es sont tÃ©lÃ©chargÃ©es sÃ©quentiellement et partagent la bande passante disponible avec les images dans la portÃ©e. <br></li><li>  Les images visibles sont chargÃ©es en parallÃ¨le, partageant entre elles la part de la bande passante qui leur est allouÃ©e. <br></li><li>  Lorsqu'il n'y a plus de polices ou d'images visibles: <br><ul><li>  Les scripts non bloquants sont chargÃ©s sÃ©quentiellement et partagent la bande passante disponible avec des images invisibles (qui sont hors de portÃ©e). <br></li><li>  Les images invisibles sont chargÃ©es en parallÃ¨le, partageant entre elles la part de la bande passante qui leur est allouÃ©e. </li></ul></li></ul><br>  Ainsi, le contenu visible par l'utilisateur est chargÃ© le plus rapidement possible, la logique d'application est retardÃ©e au minimum et les images invisibles sont chargÃ©es de maniÃ¨re Ã  complÃ©ter la mise en page le plus rapidement possible. <br><br><h1>  Exemple </h1><br>  Pour illustrer, utilisez une page de catÃ©gorie de produit simplifiÃ©e Ã  partir d'un site de commerce Ã©lectronique typique: <br><br><ul><li>  <b>Bleu</b> - fichier HTML de la page elle-mÃªme. <br></li><li>  <b>Vert</b> - Une feuille de style externe (fichier CSS). <br></li><li>  <b>Orange</b> - Quatre scripts externes (JavaScript).  Deux scripts de blocage en haut de la page et deux asynchrones.  Les scripts de blocage sont affichÃ©s dans une teinte orange plus foncÃ©e. <br></li><li>  <b>Le rouge</b> est une police Web personnalisÃ©e. <br></li><li>  <b>Violet</b> - 13 images.  Le logo de la page et quatre images de produits sont affichÃ©s dans la fenÃªtre de visualisation, 8 autres images de produits nÃ©cessitent un dÃ©filement.  Les cinq images visibles sont indiquÃ©es par une teinte plus foncÃ©e de violet. </li></ul><br>  Par souci de simplicitÃ©, supposons que toutes les ressources ont la mÃªme taille et chaque charge en 1 seconde.  Le tÃ©lÃ©chargement de toutes les ressources prend au total 20 secondes, mais l'ordre et la mÃ©thode de chargement sont extrÃªmement importants. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbd/07b/58a/fbd07b58a4c8aeff2a758ad1946d8523.png"><br><br>  Voici Ã  quoi ressemblera le chargement optimal des ressources dans un navigateur: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b2/6a8/2cd/8b26a82cdb5c546e9005200e5528b988.gif"><br><br><ul><li>  La page est vierge pendant les 4 premiÃ¨res secondes lors du chargement des scripts HTML, CSS et de blocage: ils utilisent tous une connexion Ã  100%. <br></li><li>  Ã€ la marque de 4 secondes, l'arriÃ¨re-plan et la structure de la page sont affichÃ©s sans texte ni images. <br></li><li>  AprÃ¨s une seconde, Ã  environ 5 secondes, le texte de la page s'affiche. <br></li><li>  Dans l'intervalle de 5 Ã  10 secondes, les images sont tÃ©lÃ©chargÃ©es, floues au dÃ©but, mais trÃ¨s rapidement elles deviennent claires.  Ã€ environ 7 secondes, le rÃ©sultat est presque impossible Ã  distinguer de la version finale. <br></li><li>  Au bout de 10 secondes environ, le chargement de tout le contenu visuel dans la partie visible de la page est terminÃ©. <br></li><li>  Au cours des deux secondes suivantes, du JavaScript asynchrone est chargÃ© et exÃ©cutÃ©, exÃ©cutant toute logique non critique (analytique, balises marketing, etc.). <br></li><li>  Au cours des 8 derniÃ¨res secondes, les images restantes sont chargÃ©es au cas oÃ¹ l'utilisateur ferait dÃ©filer la page. </li></ul><br><h1>  PrioritÃ© actuelle du navigateur </h1><br>  Tous les moteurs de navigation actuels mettent en Å“uvre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://calendar.perfplanet.com/2018/">diverses stratÃ©gies de priorisation</a> , dont aucune n'est optimale. <br><br>  <b>Microsoft Edge et Internet Explorer</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://calendar.perfplanet.com/2018/">ne prennent pas en charge la hiÃ©rarchisation</a> , ils fonctionnent donc avec les paramÃ¨tres HTTP / 2 par dÃ©faut, qui chargent tout en parallÃ¨le, rÃ©partissant uniformÃ©ment la bande passante entre toutes les ressources.  Microsoft Edge dans les futures versions passera Ã  l'utilisation du moteur Chromium, ce qui pourrait amÃ©liorer la situation.  Mais pour l'instant, dans notre exemple, le navigateur est la plupart du temps coincÃ© dans l'en-tÃªte de la page, car les images ralentissent la transmission des scripts de blocage et des feuilles de style. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9c/844/a65/e9c844a65472a56d92cb37cd27f2f035.png"><br><br>  Visuellement, cela conduit Ã  une expÃ©rience assez douloureuse: l'utilisateur regarde un Ã©cran vide pendant 19 secondes, puis il y a un dÃ©lai de 1 seconde pour afficher le texte.  Lorsque vous regardez l'animation ci-dessous, soyez patient, car pendant 19 secondes, il peut sembler que rien ne se passe sur un Ã©cran vide (bien que ce soit le cas): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c9/fae/539/6c9fae539ae1d3c99570cf53af415be4.gif"><br><br>  <b>Safari</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://calendar.perfplanet.com/2018/">charge toutes les ressources en parallÃ¨le</a> , partageant la bande passante en fonction de leur importance, selon Safari (le blocage des ressources comme les scripts et les feuilles de style est plus important que les images).  Les images sont chargÃ©es en parallÃ¨le, mais aussi simultanÃ©ment avec le blocage du contenu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c75/a7d/f05/c75a7df05716f5706aa4b037774733d2.png"><br><br>  Bien que Safari soit similaire Ã  Edge dans le sens oÃ¹ tout se charge en mÃªme temps, l'allocation de plus de bande passante aux ressources de blocage vous permet d'afficher le contenu beaucoup plus tÃ´t: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0c/840/5a1/f0c8405a1b6ddc40645ab7985e28a5eb.gif"><br><br><ul><li>  AprÃ¨s environ 8 secondes, le chargement de la feuille de style et des scripts est terminÃ©, vous pouvez donc commencer le rendu de la page.  Ã‰tant donnÃ© que les images ont Ã©tÃ© chargÃ©es en parallÃ¨le, elles peuvent Ã©galement Ãªtre partiellement affichÃ©es (flou pour les images progressives).  C'est toujours deux fois plus lent que le scÃ©nario optimal, mais beaucoup mieux que dans Edge. <br></li><li>  AprÃ¨s environ 11 secondes, la police se charge.  Vous pouvez afficher le texte.  Ã€ ce stade, davantage de donnÃ©es sont chargÃ©es pour les images, et elles deviennent un peu plus nettes.  Ceci est comparable Ã  la situation autour de la marque des 7 secondes pour un scÃ©nario de chargement optimal. <br></li><li>  Au cours des 9 secondes restantes, les images deviennent plus nettes Ã  mesure que davantage de donnÃ©es sont tÃ©lÃ©chargÃ©es jusqu'Ã  ce que, finalement, le processus se termine en 20 secondes. </li></ul><br>  <b>Firefox</b> crÃ©e une arborescence de dÃ©pendances qui regroupe les ressources, puis planifie que les groupes se chargent les uns aprÃ¨s les autres ou partagent ensemble la bande passante entre les groupes.  Au sein de ce groupe, les ressources partagent la bande passante et se chargent simultanÃ©ment.  Les images doivent Ãªtre chargÃ©es aprÃ¨s les feuilles de style qui bloquent le rendu et chargÃ©es en parallÃ¨le, mais les scripts et les feuilles de style qui bloquent le rendu sont Ã©galement chargÃ©s en parallÃ¨le et ne bÃ©nÃ©ficient pas du pipelining. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/870/e6d/83c/870e6d83c673b9c706dac49c78d3848d.png"><br><br>  Dans notre exemple, cela se produit un peu plus rapidement que dans Safari, car les images attendent le chargement de la feuille de style: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd2/806/b55/bd2806b55e830bd4c2a7e08bb1b18ce4.gif"><br><br><ul><li>  Ã€ environ 6 secondes, le contenu de la page d'origine s'affiche avec un arriÃ¨re-plan et des versions floues des images du produit (contre 8 secondes pour Safari et 4 secondes dans le meilleur des cas). <br></li><li>  Ã€ 8 secondes, la police est chargÃ©e et vous pouvez afficher le texte avec des images lÃ©gÃ¨rement plus nettes du produit (par rapport aux 11 secondes et 7 secondes de Safari dans le meilleur des cas). <br></li><li>  Pendant les 12 secondes restantes, les images deviennent plus nettes lorsque le contenu restant est chargÃ©. </li></ul><br>  <b>Chrome</b> (et tous les navigateurs basÃ©s sur Chromium) priorise l'inventaire.  Cela fonctionne trÃ¨s bien pour bloquer les ressources qui se chargent de maniÃ¨re optimale dans l'ordre, mais pas si bien pour les images.  Chaque image est chargÃ©e Ã  100% avant de commencer la suivante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e22/14d/4e0/e2214d4e04fab810f0a4398fe02434c1.png"><br><br>  En pratique, il s'agit d'un scÃ©nario de tÃ©lÃ©chargement presque optimal, Ã  la seule diffÃ©rence que les images sont tÃ©lÃ©chargÃ©es une Ã  la fois et non en parallÃ¨le: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91e/76c/d1d/91e76cd1d814aef138b35345eda46d82.gif"><br><br><ul><li>  Jusqu'Ã  5 secondes, le chargement de Chrome est identique au scÃ©nario optimal, affichant l'arriÃ¨re-plan Ã  la 4e seconde et le contenu texte Ã  la 5e. <br></li><li>  Au cours des 5 prochaines secondes, les images de la zone de visibilitÃ© sont chargÃ©es une par une jusqu'Ã  ce que le processus se termine vers 10 secondes (par rapport au scÃ©nario optimal, lorsqu'elles sont affichÃ©es sous une forme lÃ©gÃ¨rement floue vers 7 secondes et deviennent plus nettes pendant les trois secondes restantes). <br></li><li>  Une fois la partie visuelle de la page terminÃ©e en 10 secondes (identique au scÃ©nario optimal), les 10 secondes restantes sont consacrÃ©es Ã  l'exÃ©cution de scripts asynchrones et au chargement d'images cachÃ©es (ainsi que dans le scÃ©nario optimal). </li></ul><br><h1>  Comparaison visuelle </h1><br>  La diffÃ©rence visuelle est assez diffÃ©rente, bien que le chargement technique de tout le contenu prenne le mÃªme temps: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62e/2a1/d5f/62e2a1d5f10b801af61992517d7f5a5a.gif"><br><br><h1>  HiÃ©rarchisation cÃ´tÃ© serveur </h1><br>  La hiÃ©rarchisation HTTP / 2 est demandÃ©e par le client (navigateur), et le serveur doit dÃ©cider quoi faire en fonction de la demande.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://github.com/andydavies/">Un grand nombre de serveurs ne prennent pas du tout en charge cette fonction</a> et les autres rÃ©pondent Ã  une demande du client.  Une autre option consiste Ã  dÃ©cider de la meilleure hiÃ©rarchisation cÃ´tÃ© serveur en fonction de la demande du client. <br><br>  Selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://http2.github.io/">spÃ©cification</a> , la hiÃ©rarchisation HTTP / 2 est un arbre de dÃ©pendance qui nÃ©cessite une connaissance complÃ¨te de toutes les requÃªtes en cours afin de pouvoir hiÃ©rarchiser les ressources les unes par rapport aux autres.  Cela vous permet de mettre en Å“uvre des stratÃ©gies incroyablement complexes, mais il est difficile de bien le mettre en Å“uvre du cÃ´tÃ© du navigateur ou du serveur (comme en tÃ©moignent les diffÃ©rentes stratÃ©gies du navigateur et les diffÃ©rents niveaux de prise en charge du serveur).  Pour simplifier la gestion de la priorisation, nous avons dÃ©veloppÃ© un schÃ©ma plus simple qui a encore toute la flexibilitÃ© nÃ©cessaire Ã  une planification optimale. <br><br>  Le schÃ©ma de priorisation de Cloudflare se compose de 64 Â«niveauxÂ» de prioritÃ©, et Ã  chaque niveau, il existe des groupes de ressources qui dÃ©terminent comment diviser la connexion entre eux: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba5/7e5/efa/ba57e5efa56119a58bbd39596da3f9ce.png"><br><br>  Tout d'abord, toutes les ressources sont tÃ©lÃ©chargÃ©es Ã  un niveau de prioritÃ© plus Ã©levÃ©, puis une transition vers un niveau infÃ©rieur a lieu. <br><br>  Dans un niveau de prioritÃ© donnÃ©, il existe trois groupes de simultanÃ©itÃ© diffÃ©rents: <br><br><ul><li>  <b>0</b> : toutes les ressources du groupe Â«0Â» sont envoyÃ©es sÃ©quentiellement dans l'ordre dans lequel elles ont Ã©tÃ© demandÃ©es en utilisant une bande passante de 100%.  Ce n'est qu'aprÃ¨s le chargement de toutes les ressources du groupe Â«0Â» que les autres groupes du mÃªme niveau sont considÃ©rÃ©s. <br></li><li>  <b>1</b> : toutes les ressources du groupe d'accÃ¨s simultanÃ© Â«1Â» sont envoyÃ©es sÃ©quentiellement dans l'ordre dans lequel elles ont Ã©tÃ© demandÃ©es.  La bande passante disponible est uniformÃ©ment rÃ©partie entre le groupe de parallÃ©lisme "1" et le groupe de parallÃ©lisme "n". <br></li><li>  <b>n</b> : les ressources du groupe d'accÃ¨s simultanÃ© Â«nÂ» sont transmises en parallÃ¨le, partageant la bande passante disponible. </li></ul><br>  En pratique, le groupe de parallÃ©lisme Â«0Â» est utile pour le contenu critique qui doit Ãªtre traitÃ© sÃ©quentiellement (scripts, CSS, etc.).  Le groupe Â«1Â» est utile pour les contenus moins importants qui peuvent partager la bande passante avec d'autres ressources, mais oÃ¹ les ressources elles-mÃªmes bÃ©nÃ©ficient toujours d'un traitement sÃ©quentiel (scripts asynchrones, images non progressives, etc.).  Le groupe de simultanÃ©itÃ© Â«nÂ» est utile pour les ressources qui bÃ©nÃ©ficient d'un traitement parallÃ¨le (images progressives, vidÃ©o, audio, etc.). <br><br><h1>  PrioritÃ© par dÃ©faut de Cloudflare </h1><br>  Avec l'option de priorisation avancÃ©e, l'ordre Â«optimalÂ» de chargement des ressources, comme dÃ©crit ci-dessus, est implÃ©mentÃ©.  Les prioritÃ©s spÃ©cifiques appliquÃ©es sont les suivantes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b89/e96/e4f/b89e96e4f4534f5df00d732e97b5db62.png"><br><br>  Ce schÃ©ma vous permet d'envoyer sÃ©quentiellement des ressources qui bloquent le rendu, puis d'envoyer des images visibles en parallÃ¨le, puis le reste du contenu de la page avec un certain niveau de partage de bande passante pour Ã©quilibrer le chargement de l'application et le contenu.  La <i>mise en garde * Si dÃ©tectable</i> est que tous les navigateurs ne font pas la distinction entre les diffÃ©rents types de feuilles de style et de scripts, mais ce sera toujours beaucoup plus rapide dans tous les cas.  Une accÃ©lÃ©ration de 50%, en particulier pour les visiteurs Edge et Safari, ne sera pas inhabituelle: <br><br> <a href=""><img src="https://habrastorage.org/webt/u_/1n/px/u_1npxrzhg0svmgdyzelnamxj84.png"></a> <br><br><h1>  DÃ©finition des prioritÃ©s avec les travailleurs </h1><br>  Un travail par dÃ©faut plus rapide est excellent, mais il devient vraiment intÃ©ressant grÃ¢ce Ã  la possibilitÃ© de configurer la hiÃ©rarchisation avec le support Cloudflare Workers, de sorte que les sites peuvent remplacer la prioritÃ© par dÃ©faut pour les ressources ou implÃ©menter leurs propres schÃ©mas de hiÃ©rarchisation. <br><br>  Si le travailleur ajoute l'en <code>cf-priority</code> tÃªte <code>cf-priority</code> Ã  la rÃ©ponse, les serveurs de pÃ©riphÃ©rie Cloudflare appliqueront la prioritÃ© et la simultanÃ©itÃ© spÃ©cifiÃ©es.  Le format d'en-tÃªte est &lt;priority&gt; / &lt;concurrency&gt;, donc l'en <code>response.headers.set('cf-priority', â€œ30/0â€);</code>  dÃ©finira la prioritÃ© 30 et le parallÃ©lisme 0 pour cette rÃ©ponse. De mÃªme, Â«30/1Â» dÃ©finira le parallÃ©lisme Â«1Â» et Â«30 / nÂ» dÃ©finira le parallÃ©lisme sur n. <br><br>  Avec une telle flexibilitÃ©, un site peut dÃ©finir une prioritÃ© arbitraire de ressources pour ses besoins.  Par exemple, pour augmenter la prioritÃ© de certains scripts asynchrones importants ou images principales: ils sont tÃ©lÃ©chargÃ©s avant mÃªme que le navigateur ne dÃ©termine qu'ils sont Ã  portÃ©e. <br><br>  Pour informer sur les dÃ©cisions de priorisation, le runtime des travailleurs indique Ã©galement les informations demandÃ©es par le navigateur sur la priorisation dans l'objet de demande, qui est transmise au rÃ©cepteur des Ã©vÃ©nements de travail (request.cf.requestPriority).  Les prioritÃ©s entrantes sont une liste d'attributs sÃ©parÃ©s par un point-virgule.  Cela ressemble Ã  ceci: <code>weight=192;exclusive=0;group=3;group-weight=127</code> . <br><br><ul><li>  <b>poids</b> : poids pour prioriser HTTP / 2. <br></li><li>  <b>exclusif</b> : l'indicateur HTTP / 2 exclusif (1 pour les navigateurs basÃ©s sur Chromium, 0 pour les autres). <br></li><li>  <b>group</b> : identifiant de flux HTTP / 2 pour le groupe de requÃªtes (diffÃ©rent de zÃ©ro pour Firefox). <br></li><li>  <b>poids du groupe</b> : <b>poids</b> HTTP / 2 pour le groupe de requÃªtes (diffÃ©rent de zÃ©ro pour Firefox). </li></ul><br><h1>  Ce n'est que le dÃ©but. </h1><br>  La capacitÃ© de configurer et de contrÃ´ler la prioritÃ© des rÃ©ponses est la pierre angulaire d'un grand travail futur.  Nous avons l'intention d'introduire nos propres optimisations avancÃ©es en plus de cela, mais avec le soutien des travailleurs, tous les sites et chercheurs peuvent expÃ©rimenter diffÃ©rentes stratÃ©gies de priorisation.  GrÃ¢ce Ã  Apps Marketplace, les entreprises peuvent Ã©galement crÃ©er de nouveaux services d'optimisation au-dessus de la plate-forme de travail et les rendre disponibles pour une utilisation par d'autres sites. <br><br>  Si vous Ãªtes sur un plan Pro ou supÃ©rieur, accÃ©dez Ã  l'onglet Â«VitesseÂ» du tableau de bord Cloudflare et activez la Â«hiÃ©rarchisation HTTP / 2 avancÃ©eÂ» pour accÃ©lÃ©rer votre site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/386/d53/276/386d532767b6396ee628a7e0eb837282.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452020/">https://habr.com/ru/post/fr452020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452004/index.html">TrouvÃ© l'emplacement de la chute de l'appareil "Bereshit" sur la lune</a></li>
<li><a href="../fr452006/index.html">Epop Metaverse: Pourquoi les auteurs Fortnite devraient l'obtenir</a></li>
<li><a href="../fr452008/index.html">Approches d'ingÃ©nierie et liste de contrÃ´le: comment ne pas devenir fou dans le chaos des tÃ¢ches</a></li>
<li><a href="../fr452010/index.html">Osmo Action: la premiÃ¨re camÃ©ra d'action de DJI</a></li>
<li><a href="../fr452016/index.html">12 ans dans le cloud</a></li>
<li><a href="../fr452022/index.html">Google informe les utilisateurs d'une vulnÃ©rabilitÃ© avec leurs clÃ©s de sÃ©curitÃ© Titan</a></li>
<li><a href="../fr452026/index.html">Il y a 20 ans, Microsoft a changÃ© Ã  jamais la faÃ§on dont nous utilisons la souris</a></li>
<li><a href="../fr452028/index.html">Rayon de lumiÃ¨re dans le royaume des tÃ©nÃ¨bres: comment la technologie rend la vision perdue</a></li>
<li><a href="../fr452030/index.html">Histoire d'Internet: dÃ©couvrir l'interactivitÃ©</a></li>
<li><a href="../fr452034/index.html">MaÃ®trise de soi du temps pour l'auto-Ã©ducation et du temps pour lire des livres</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>