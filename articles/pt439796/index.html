<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õ ‚öìÔ∏è üëá Spring Boot 2: o que eles n√£o escrevem nas notas de vers√£o üöè üëÜüèº üë±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando um projeto em grande escala passa por uma atualiza√ß√£o em grande escala, tudo nunca √© simples: inevitavelmente, existem nuances n√£o √≥bvias (em o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spring Boot 2: o que eles n√£o escrevem nas notas de vers√£o</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/439796/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/e3/fc/a4e3fcwl22r0y3nlx8z-6pkhtny.jpeg"></div><br><br>  Quando um projeto em grande escala passa por uma atualiza√ß√£o em grande escala, tudo nunca √© simples: inevitavelmente, existem nuances n√£o √≥bvias (em outras palavras, um rake).  E ent√£o, n√£o importa qu√£o boa seja a documenta√ß√£o, apenas a experi√™ncia - sua ou de outra pessoa - ajudar√° em algo. <br><br>  Na confer√™ncia Joker 2018, falei sobre os problemas que eu mesmo encontrei ao mudar para o Spring Boot 2 e como eles s√£o resolvidos.  E agora especialmente para Habr - a vers√£o em texto deste relat√≥rio.  Por conveni√™ncia, o post tem uma grava√ß√£o de v√≠deo e um sum√°rio: voc√™ n√£o pode ler tudo, mas vai diretamente para o problema que o preocupa. <br><a name="habracut"></a><br><h2>  Sum√°rio </h2><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grava√ß√£o de v√≠deo</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Entrada</a></b> </li><li>  <b>Tempo de compila√ß√£o do rake</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Exemplos de problemas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b>Tipo de conte√∫do.</b>  <b>Determinando o tipo de resposta HTTP</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b>Agendamento.</b>  <b>Lan√ßamento agendado</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b>Spring cloud &amp; Co. Empresas</b>  <b>Compatibilidade da biblioteca</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">B√¥nus: caso de adi√ß√µes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b>Relaxe Vincula√ß√£o.</b>  <b>Liga√ß√£o de par√¢metro difusa</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b>Teste de unidade.</b>  <b>Executando testes no Mockito 2</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b>Gradle Plugin.</b>  <b>Criar projetos de inicializa√ß√£o da primavera</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ser</a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outros</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conclus√£o</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Resumo e conclus√µes</a></b> </li></ul><br><br><a name="video"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="intro"></a>  Bom dia  Quero falar sobre alguns recursos (vamos cham√°-los de rakes) que voc√™ pode encontrar ao atualizar o framework Spring Boot para a segunda vers√£o e sua opera√ß√£o subseq√ºente. <br><br>  Meu nome √© Vladimir Plizg√° ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> ), trabalho na CFT, um dos maiores e mais antigos desenvolvedores de software da R√∫ssia.  Nos √∫ltimos anos, venho desenvolvendo backend por l√°, respons√°vel pelo desenvolvimento t√©cnico do banco on-line de cart√µes pr√©-pagos.  Foi nesse projeto que me tornei o iniciador e o executor da transi√ß√£o de uma arquitetura monol√≠tica para a arquitetura de microsservi√ßos (que ainda est√° em andamento).  Bem, como a maior parte do conhecimento que eu decidi compartilhar com voc√™ foi acumulada no exemplo desse projeto em particular, vou falar um pouco mais sobre isso. <br><br><h2>  Brevemente sobre o produto experimental </h2><br>  Este √© um banco da Internet que, sozinho, atende a mais de duas d√∫zias de empresas parceiras em toda a R√∫ssia: fornece aos clientes finais a capacidade de gerenciar seu dinheiro por meio de servi√ßos banc√°rios remotos (aplicativos m√≥veis, sites).  Um dos parceiros √© a Beeline e seu cart√£o de pagamento.  Acabou sendo um bom banco na Internet, a julgar pela classifica√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Markswebb Mobile Banking Rank</a> , onde nosso produto assumiu uma boa posi√ß√£o para iniciantes. <br><br>  As "tripas" ainda est√£o em transi√ß√£o, por isso temos um mon√≥lito, o chamado n√∫cleo, em torno do qual s√£o criados 23 microsservi√ßos.  No interior, os microsservi√ßos Spring Cloud Netflix, Spring Integration e muito mais.  E no Spring Boot 2, essa coisa toda est√° voando desde o m√™s de julho.  E justamente neste lugar, moramos com mais detalhes.  Ao traduzir este projeto para a segunda vers√£o, deparei-me com alguns recursos sobre os quais quero falar. <br><br><h2>  Esbo√ßo do relat√≥rio </h2><br><img src="https://habrastorage.org/webt/rl/jd/zq/rljdzqye-_lbzjguklndonlyc-4.jpeg"><br><br>  Em muitas √°reas em que os recursos do Spring Boot 2 apareceram, tentaremos analisar tudo.  Para fazer isso rapidamente, precisamos de um detetive ou investigador experiente - algu√©m que descubra tudo isso como se fosse para n√≥s.  Como Holmes e Watson j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fizeram uma apresenta√ß√£o</a> no Joker, seremos assistidos por outro especialista, o tenente Colombo.  V√° em frente! <br><br><h2>  Bota de mola / 2 </h2><br>  Primeiro, algumas palavras sobre o Spring Boot em geral e a segunda vers√£o em particular.  Em primeiro lugar, esta vers√£o foi lan√ßada, para dizer o m√≠nimo, n√£o ontem: em 1 de mar√ßo de 2018, j√° estava em Disponibilidade Geral.  Um dos principais objetivos que os desenvolvedores buscavam era dar suporte total ao Java 8 no n√≠vel de origem.  Ou seja, n√£o pode ser compilado em uma vers√£o menor, embora o tempo de execu√ß√£o seja compat√≠vel.  O Spring Framework da quinta vers√£o, lan√ßada um pouco antes do Spring Boot 2., foi tomado como base, e essa n√£o √© a √∫nica depend√™ncia.  Ele tamb√©m tem um conceito como <a href="">BOM</a> (Bill Of Materials) - este √© um XML enorme, que lista todas as depend√™ncias (transitivas para n√≥s) de todos os tipos de bibliotecas de terceiros, estruturas adicionais, ferramentas e muito mais. <br><br>  Por conseguinte, nem todos os efeitos especiais que a segunda Bota de Primavera traz prov√™m de si ou do ecossistema da Primavera.  Dois documentos excelentes foram escritos para todo esse farm: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">notas de vers√£o</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guia de migra√ß√£o</a> .  Os documentos s√£o legais, o Spring, nesse sentido, geralmente √© bem feito.  Mas, por raz√µes √≥bvias, est√° longe de ser poss√≠vel cobrir tudo: existem alguns detalhes, desvios etc. que n√£o podem ser ou n√£o devem ser inclu√≠dos l√°.  Vamos falar sobre esses recursos. <br><br><a name="compile"></a><h2>  Tempo de compila√ß√£o.  Exemplos de mudan√ßa de API </h2><br>  Vamos come√ßar com o rake mais ou menos simples e √≥bvio: estes s√£o os que surgem em tempo de compila√ß√£o.  Ou seja, algo que nem mesmo permitir√° que voc√™ compile o projeto se voc√™ simplesmente alterar o n√∫mero 1 no script de inicializa√ß√£o para 2. <br><br>  A principal fonte de mudan√ßas, que se tornou a base para essas edi√ß√µes no Spring Boot, √©, obviamente, a transi√ß√£o do Spring para o Java 8. Al√©m disso, a pilha da Web do Spring 5 e do Spring Boot 2 se dividiu, relativamente falando, em duas.  Agora √© servlet, tradicional para n√≥s, e reativo.  Al√©m disso, era necess√°rio levar em considera√ß√£o uma s√©rie de defici√™ncias das vers√µes anteriores.  As bibliotecas de terceiros foram iniciadas (de fora do Spring).  Se voc√™ olhar para as Notas da vers√£o, n√£o ver√° nenhuma armadilha na hora e, francamente, quando li as Notas da vers√£o pela primeira vez, pareceu-me que estava tudo bem.  E para mim, parecia algo assim: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uJ2P16LXA94" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Mas, como voc√™ provavelmente adivinha, nem tudo √© t√£o bom. <br><br>  <b>Em que a compila√ß√£o ser√° interrompida (exemplo 1):</b> <br><br><ul><li> <b>Por que</b> : a classe <code>WebMvcConfigurerAdapter</code> n√£o existe mais; </li><li>  <b>Por que</b> : suportar chips Java 8 (m√©todos padr√£o em interfaces); </li><li>  <b>O que fazer</b> : use a interface <code>WebMvcConfigurer</code> . </li></ul><br>  Um projeto pode n√£o ser compilado pelo menos devido ao fato de que algumas classes simplesmente n√£o existem mais.  Porque  Sim, porque no Java 8 eles n√£o s√£o necess√°rios.  Se esses eram adaptadores com implementa√ß√£o primitiva de m√©todos, n√£o h√° nada especial para explicar, os m√©todos padr√£o resolvem tudo isso perfeitamente.  Aqui est√° um exemplo dessa classe, √© claro que √© suficiente usar a pr√≥pria interface e n√£o s√£o necess√°rios adaptadores. <br><br>  <b>Em que compila√ß√£o ser√° interrompida (exemplo 2):</b> <br><br><ul><li>  <b>Por que</b> : o m√©todo <code>PropertySourceLoader#load</code> come√ßou a retornar uma lista de fontes em vez de uma; </li><li>  <b>Motivo</b> : oferecer suporte a recursos de v√°rios documentos, por exemplo, YAML; </li><li>  <b>O que fazer</b> : agrupar a resposta em <code>singletonList()</code> (quando substitu√≠do). </li></ul><br>  Um exemplo de uma √°rea completamente diferente.  Alguns m√©todos at√© mudaram de assinatura.  Se voc√™ j√° usou o m√©todo load PropertySourceLoader, agora ele retorna uma cole√ß√£o.  Consequentemente, isso permitiu o suporte de recursos para v√°rios documentos.  Por exemplo, no YAML, atrav√©s de tr√™s h√≠fens, voc√™ pode especificar v√°rios documentos em um arquivo.  Se agora voc√™ precisa trabalhar com ele a partir de Java, lembre-se de que isso deve ser feito por meio da cole√ß√£o. <br><br>  <b>Em que compila√ß√£o ser√° interrompida (exemplo 3):</b> <br><br><ul><li>  <b>Por que</b> : algumas classes do pacote <code>org.springframework.boot.autoconfigure.web</code> dos pacotes <code>.servlet</code> - <code>.servlet</code> e <code>.reactive</code> ; </li><li>  <b>Motivo</b> : apoiar o jet stack em p√© de igualdade com o tradicional; </li><li>  <b>O que fazer</b> : atualizar importa√ß√µes. </li></ul><br>  Ainda mais altera√ß√µes foram introduzidas, assim, empilhamento.  Por exemplo, o que costumava estar no mesmo pacote da Web agora foi dividido em dois pacotes com v√°rias classes.  Estes s√£o <code>.servlet</code> e <code>.reactive</code> .  Por que isso √© feito?  Porque a pilha de jatos n√£o era uma muleta enorme em cima do servlet.  Era necess√°rio fazer isso para que eles pudessem manter seu pr√≥prio ciclo de vida, desenvolver-se em suas pr√≥prias dire√ß√µes e n√£o interferir entre si.  O que fazer sobre isso?  O suficiente para alterar as importa√ß√µes: a maioria dessas classes permaneceu compat√≠vel no n√≠vel da API.  A maioria, mas n√£o todas. <br><br>  <b>Em que compila√ß√£o ser√° interrompida (exemplo 4):</b> <br><br><ul><li>  <b>Por que</b> : a assinatura dos m√©todos da classe <code>ErrorAttributes</code> : em vez de <code>RequestAttributes</code> , <code>WebRequest(servlet)</code> e <code>ServerRequest(reactive)</code> come√ßaram a ser usados; </li><li>  <b>Motivo</b> : apoiar o jet stack em p√© de igualdade com o tradicional; </li><li>  <b>O que fazer</b> : substitua os nomes das classes nas assinaturas. </li></ul><br>  Por exemplo, na classe ErrorAttributes, agora, em vez de RequestAttributes, duas outras classes come√ßaram a ser usadas nos m√©todos: s√£o WebRequest e ServerRequest.  O motivo √© o mesmo.  E o que fazer sobre isso?  Se voc√™ estiver alternando da primeira para a segunda Spring Boot, precisar√° alterar RequestAttributes para WebRequest.  Bem, se voc√™ j√° est√° no segundo, use ServerRequest.  Obviamente, n√£o √©? <br><br><a name="compile_solution"></a><h3>  Como ser </h3><br>  Existem alguns exemplos, mas n√£o vamos resolver todos eles.  O que fazer sobre isso?  Antes de tudo, vale a pena dar uma olhada no Guia de Migra√ß√£o do Spring Boot 2.0 para observar as altera√ß√µes relacionadas a voc√™ a tempo.  Por exemplo, menciona renomear classes completamente n√£o √≥bvias.  Ainda assim, se algo se separou e quebrou, vale a pena considerar que o conceito de "web" √© dividido em 2: "servlet" e "reativo".  Com orienta√ß√£o em todas as classes e pacotes, isso pode ajudar.  Al√©m disso, deve-se ter em mente que n√£o apenas as pr√≥prias classes e pacotes foram renomeados, mas tamb√©m depend√™ncias e artefatos inteiros.  Como isso, por exemplo, aconteceu com o Spring Cloud. <br><br><hr><br><a name="contenttype"></a><h2>  Tipo de conte√∫do.  Determinando o tipo de resposta HTTP </h2><br>  Chega de coisas simples desde o tempo de compila√ß√£o, tudo √© claro e simples l√°.  Vamos falar sobre o que pode acontecer em tempo de execu√ß√£o e, portanto, pode ser gravado, mesmo que o Spring Boot 2 esteja trabalhando para voc√™ h√° muito tempo.  Vamos falar sobre a defini√ß√£o do tipo de conte√∫do. <br><br><img src="https://habrastorage.org/webt/03/a2/db/03a2dbs5_suz7osfukciaumo0-y.jpeg"><br><br>  N√£o √© segredo que o Spring pode escrever aplicativos da Web, APIs de p√°gina e REST, e pode renderizar conte√∫do com uma grande variedade de tipos, seja XML, JSON ou qualquer outra coisa.  E um dos encantos de que o Spring gosta tanto √© que voc√™ n√£o precisa se preocupar com a defini√ß√£o do tipo dado no seu c√≥digo.  Voc√™ pode esperar por m√°gica.  Essa m√°gica funciona, relativamente falando, de tr√™s maneiras diferentes: depende do cabe√ßalho Accept que veio do cliente ou da extens√£o do arquivo solicitado ou de um par√¢metro especial na URL, que, √© claro, tamb√©m pode ser direcionada. <br><br>  Considere um exemplo simples ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo fonte completo</a> ).  A seguir, usarei a nota√ß√£o de Gradle, mas mesmo se voc√™ √© um f√£ do Maven, n√£o ser√° dif√≠cil entender o que est√° escrito aqui: criamos um pequeno aplicativo no primeiro Spring Boot e usamos apenas uma Web de inicia√ß√£o. <br><br>  Exemplo (v1.x): <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br>  Como c√≥digo execut√°vel, temos uma √∫nica classe na qual o m√©todo do controlador √© declarado imediatamente. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/download/{fileName: .+}"</span></span>, produces = {TEXT_HTML_VALUE, APPLICATION_JSON_VALUE, TEXT_PLAIN_VALUE}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResponseEntity&lt;Resource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable String fileName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  Content-Type }</span></span></code> </pre><br>  √â necess√°rio um determinado nome de arquivo como entrada, que supostamente ser√° formado e fornecido.  Ele realmente forma seu conte√∫do em um dos tr√™s tipos indicados (determinando isso pelo nome do arquivo), mas n√£o especifica o tipo de conte√∫do de forma alguma - temos o Spring, ele far√° tudo sozinho. <br><br><img src="https://habrastorage.org/webt/wa/nd/77/wand77z2iocxhhqbcr-bn6lvzxm.jpeg"><br><br>  Em geral, voc√™ pode at√© tentar faz√™-lo.  De fato, se solicitarmos o mesmo documento com extens√µes diferentes, ele ser√° retornado com o tipo de conte√∫do correto, dependendo do que retornarmos: se voc√™ quiser - json, se voc√™ quiser - txt, se voc√™ quiser - html.  Funciona como um conto de fadas. <br><br><h3>  Atualizando para a v2.x </h3><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br>  √â hora de atualizar para o segundo Spring Boot.  Apenas mudamos o n√∫mero 1 para 2. <br><br><img src="https://habrastorage.org/webt/rk/ki/dg/rkkidgg5r97wfxcfq_3djkria_u.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caminho do Spring MVC que corresponde √† altera√ß√£o de comportamento padr√£o</a> <br><br>  Mas somos engenheiros, vamos dar uma olhada no Guia de Migra√ß√£o e, de repente, algo √© dito sobre isso.  Mas ele menciona algum tipo de "correspond√™ncia de caminho de sufixo".  √â sobre como mapear corretamente m√©todos em Java com uma URL.  Mas este n√£o √© o nosso caso, embora um pouco como. <br><br><img src="https://habrastorage.org/webt/cy/re/_f/cyre_fno26kbqiepmtpr0tewmrw.jpeg"><br><br>  Portanto, marcamos, checamos e batemos!  - de repente n√£o funciona.  Por algum motivo, apenas text / html come√ßa a ser fornecido em todos os lugares e, se voc√™ o digitar, n√£o √© apenas text / html, mas apenas o primeiro dos tipos especificados no atributo produz na anota√ß√£o @GetMapping.  Porque  Parece, para dizer o m√≠nimo, incompreens√≠vel. <br><br><img src="https://habrastorage.org/webt/xt/mj/50/xtmj50wpv1ossdx_6nqeakchwxc.jpeg"><br><br>  E aqui, nenhuma nota de vers√£o ajudar√°, voc√™ deve ler a fonte. <br><br><h3>  ContentNegotiationManagerFactoryBean </h3><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ContentNegotiationManagerFactoryBean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;ContentNegotiationStrategy&gt; strategies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { strategies.addAll(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.favorPathExtension) { PathExtensionContentNegotiationStrategy strategy; <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶</span></span></code> </pre><br>  L√° voc√™ pode encontrar um cl√°ssico com um nome abreviado lac√¥nico muito compreens√≠vel, que menciona uma determinada bandeira chamada "considerar extens√£o no caminho" (favorPathExtension).  O valor desse sinalizador "true" corresponde √† aplica√ß√£o de uma determinada estrat√©gia com outro nome conciso curto compreens√≠vel, do qual fica claro que ele √© apenas respons√°vel por determinar o tipo de conte√∫do por extens√£o de arquivo.  Como voc√™ pode ver, se a bandeira for falsa, a estrat√©gia n√£o ser√° aplicada. <br><br><img src="https://habrastorage.org/webt/qy/g3/ms/qyg3mscyw2mnlyqewltjefecwri.jpeg"><br><br>  Sim, provavelmente, muitos notaram que na primavera, aparentemente, h√° algum tipo de orienta√ß√£o, de modo que o nome deve estar bem, com pelo menos vinte caracteres. <br><br><img src="https://habrastorage.org/webt/ef/j8/il/efj8ilxfvvc1_dtss-7-becc_m0.jpeg"><br><br>  Se voc√™ se aprofundar um pouco mais, poder√° cavar esse fragmento.  No pr√≥prio framework Spring, e n√£o na quinta vers√£o, como seria de esperar, mas desde tempos imemoriais, esse sinalizador por padr√£o foi definido como "true".  Enquanto estava no Spring Boot e na segunda vers√£o, foi bloqueado por outro, que agora est√° dispon√≠vel para controle das configura√ß√µes.  Ou seja, agora podemos orient√°-los a partir da gest√£o ambiental, e isso √© apenas na segunda vers√£o.  Voc√™ sente?  L√° ele j√° assumiu o significado de "falso".  Ou seja, eles queriam, mais ou menos, fazer o melhor, colocar esse sinalizador nas configura√ß√µes (e isso √© √≥timo), mas o valor padr√£o foi alterado para outro (isso n√£o √© muito). <br><br>  Os desenvolvedores da estrutura tamb√©m s√£o pessoas, eles tamb√©m tendem a cometer erros.  O que fazer sobre isso?  √â claro que voc√™ precisa mudar o par√¢metro no seu projeto, e tudo ficar√° bem. <br><br>  A √∫nica coisa que vale a pena fazer, para clarear sua consci√™ncia, √© procurar na documenta√ß√£o do Spring Boot apenas qualquer men√ß√£o a essa bandeira.  E l√° ele √© realmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mencionado</a> , mas apenas em algum contexto estranho: <br><blockquote>  Se voc√™ <b>entende as advert√™ncias</b> e ainda deseja que seu aplicativo use a correspond√™ncia de padr√µes de sufixo, a seguinte configura√ß√£o √© necess√°ria: <br>  spring.mvc.contentnegotiation.favor-path-extension = true <br>  ... <br></blockquote>  Est√° escrito, eles dizem, se voc√™ entender todos os truques e ainda quiser usar a correspond√™ncia de caminho de sufixo, marque esta caixa.  Sinta a discrep√¢ncia?  Parece que estamos falando sobre a defini√ß√£o de tipo de conte√∫do no contexto desse sinalizador, mas aqui estamos falando sobre a correspond√™ncia de m√©todos e URLs Java.  Parece de alguma forma incompreens√≠vel. <br><br>  Temos que cavar mais.  Existe uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">solicita√ß√£o</a> de recebimento no GitHub: <br><br><img src="https://habrastorage.org/webt/qa/ra/e8/qarae8b3dxgmf-mwhx1-bf9tev0.jpeg"><br><br>  Dentro da estrutura dessa solicita√ß√£o de recebimento, essas altera√ß√µes foram feitas - alternando o valor padr√£o - e um dos autores da estrutura diz que esse problema tem dois aspectos: um √© apenas o caminho correspondente e o segundo √© a defini√ß√£o do tipo de conte√∫do .  Ou seja, em outras palavras, a bandeira se aplica a ambos, e eles est√£o inextricavelmente vinculados. <br><br>  Voc√™ poderia, √© claro, encontr√°-lo imediatamente no GitHub se soubesse onde procurar. <br><br><img src="https://habrastorage.org/webt/nb/pr/sq/nbprsqxl5nlwzs5qtnv3vohv26y.jpeg"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Correspond√™ncia de sufixo</a> <br><br>  Al√©m disso, a documenta√ß√£o do Spring Framework tamb√©m afirma que o uso de extens√µes de arquivo era necess√°rio anteriormente, mas agora n√£o √© mais considerado uma necessidade.  Al√©m disso, provou ser problem√°tico em v√°rios casos. <br><br><h3>  Resumir </h3><br>  Alterar o valor do sinalizador padr√£o n√£o √© um bug, mas um recurso.  Ele est√° inextricavelmente vinculado √† defini√ß√£o de correspond√™ncia de caminho e foi projetado para fazer <b>tr√™s coisas</b> : <br><br><ul><li>  reduzir os riscos de seguran√ßa (quais, vou esclarecer); </li><li>  alinhar o comportamento do WebFlux e WebMvc, eles diferiam nesse aspecto; </li><li>  alinhe a instru√ß√£o na documenta√ß√£o com o c√≥digo da estrutura. </li></ul><br><a name="contenttype_solution"></a><h3>  Como ser </h3><br>  Primeiro, sempre que poss√≠vel, voc√™ n√£o deve confiar na defini√ß√£o do tipo de conte√∫do por extens√£o.  O exemplo que mostrei √© um contra-exemplo, n√£o √© necess√°rio fazer isso!  Al√©m disso, n√£o √© necess√°rio confiar no fato de que solicita√ß√µes no formato "GET something.json", por exemplo, simplesmente "GET something".  Esse foi o caso no Spring Framework 4 e no Spring Boot 1. Isso n√£o funciona mais.  Se voc√™ precisar mapear para um arquivo com a extens√£o, fa√ßa isso explicitamente.  Em vez disso, √© melhor confiar no cabe√ßalho Accept ou no par√¢metro URL, cujo nome voc√™ pode orientar.  Bem, se voc√™ n√£o conseguir fazer isso, digamos que voc√™ tenha alguns clientes m√≥veis antigos que pararam de atualizar no s√©culo passado, ser√° necess√°rio retornar esse sinalizador, defini-lo como "true" e tudo funcionar√° como antes. <br><br>  Al√©m disso, para uma compreens√£o geral, voc√™ pode ler o cap√≠tulo "Correspond√™ncia de sufixo" na documenta√ß√£o do Spring Framework, que √© considerado pelos desenvolvedores como uma esp√©cie de cole√ß√£o de pr√°ticas recomendadas nesta √°rea e se familiarizar com o que √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ataque Download de arquivo refletido</a> , implementado usando manipula√ß√µes com extens√£o de arquivo <br><br><a name="scheduling"></a><h2>  Agendamento.  Tarefas agendadas ou peri√≥dicas </h2><br>  Vamos mudar um pouco o escopo e falar sobre a conclus√£o de tarefas em um cronograma ou periodicamente. <br><br><h3>  Um exemplo de uma tarefa.  Mensagem de log a cada 3 segundos </h3><br>  O que est√° sendo dito, eu acho, √© compreens√≠vel.  Temos algumas necessidades de neg√≥cios, para fazer algo com algum tipo de repeti√ß√£o, por isso iremos imediatamente para o exemplo.  Suponha que tenhamos uma tarefa mega complexa: gerar uma sujeira no log a cada 3 segundos. <br><br><img src="https://habrastorage.org/webt/rf/ay/mh/rfaymhimyivf7htbkhf7fw3nia0.jpeg"><br><br>  Isso pode ser feito, obviamente, de v√°rias maneiras, para eles, de qualquer forma, j√° existe algo na primavera.  E encontre - de v√°rias maneiras. <br><br><h3>  Op√ß√£o 1: procure um exemplo em seu projeto </h3><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *A very helpful service */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReallyBusinessService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ a bunch of methods ‚Ä¶ @Scheduled(fixedDelay = 3000L) public void runRepeatedlyWithFixedDelay() { assert Runtime.getRuntime().availableProcessors() &gt;= 4; } // ‚Ä¶ another bunch of methods ‚Ä¶ }</span></span></code> </pre><br>  Podemos olhar em nosso pr√≥prio projeto e provavelmente encontraremos algo assim.  Uma anota√ß√£o ficar√° no m√©todo p√∫blico e ficar√° claro que, assim que voc√™ deslig√°-lo, tudo funciona como em um conto de fadas. <br><br><h3>  Op√ß√£o 2: procure a anota√ß√£o desejada </h3><br><img src="https://habrastorage.org/webt/nr/ax/sv/nraxsvpmgs9u7z2yjavxhceqrli.jpeg"><br><br>  Voc√™ pode procurar a anota√ß√£o diretamente pelo nome, e tamb√©m ficar√° claro na documenta√ß√£o que voc√™ a pendurou - e tudo funciona. <br><br><h3>  Op√ß√£o 3: Google </h3><br>  Se voc√™ n√£o acredita em si mesmo, pode pesquisar no Google e, a partir do que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encontrou,</a> tamb√©m ficar√° claro que tudo come√ßar√° com uma anota√ß√£o. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOG = LoggerFactory.getLogger(EventCreator.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EventRepository eventRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EventRepository eventRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventRepository = eventRepository; } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalDateTime start = LocalDateTime.now(); eventRepository.save( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventKey(<span class="hljs-string"><span class="hljs-string">"An event type"</span></span>, start, UUID.randomUUID()), Math.random() * <span class="hljs-number"><span class="hljs-number">1000</span></span>)); LOG.debug(<span class="hljs-string"><span class="hljs-string">"Event created!"</span></span>); } }</code> </pre><br>  Quem v√™ o problema nisso?  Somos engenheiros, afinal, vamos verificar como isso funciona na realidade. <br><br><h3>  Mostre-me o c√≥digo! </h3><br>  Considere uma tarefa espec√≠fica (a tarefa em si e o c√≥digo est√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no meu reposit√≥rio</a> ). <br><br>  Quem n√£o quiser ler, assista a este fragmento do v√≠deo com uma demonstra√ß√£o (at√© o 22¬∫ minuto): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Como depend√™ncia, usaremos o primeiro Spring Boot com duas entradas.  Uma √© para a Web, √© como se estiv√©ssemos desenvolvendo um servidor da Web, e a segunda √© o atuador de acionador de mola, para que tenhamos recursos prontos para produ√ß√£o, para que pare√ßamos algo real. <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '2.0.4.RELEASE' } compile("org.springframework.boot:spring-boot-starter-web:$springBootVersion") compile("org.springframework.boot:spring-boot-starter-actuator:$springBootVersion") // +100500      }</span></span></code> </pre> <br>  E nosso c√≥digo execut√°vel ser√° ainda mais simples. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(‚Äú <span class="hljs-number"><span class="hljs-number">3</span></span>     ‚Ä¶‚Äù); } }</code> </pre><br>  Em geral, quase nada de not√°vel, exceto o √∫nico m√©todo no qual penduramos a anota√ß√£o.  N√≥s o copiamos em algum lugar e esperamos que funcione. <br><br>  Vamos verificar, somos engenheiros.  Come√ßamos.  Assumimos que a cada tr√™s segundos essa mensagem ser√° registrada.  Tudo deve funcionar imediatamente, garantimos que tudo seja lan√ßado na primeira Spring Boot e esperamos a sa√≠da da linha desejada.  Passagem de tr√™s segundos - uma linha √© emitida, seis passagens - uma linha √© exibida.  Otimistas venceram, tudo funciona. <br><br><img src="https://habrastorage.org/webt/ed/em/ir/edemirx8zopb5wbf193tlbbh6fi.png"><br><br>  Somente chega a hora de atualizar para o segundo Spring Boot.  N√£o vamos nos preocupar, basta mudar de um para o outro: <br><br><pre> <code class="java hljs">dependencies { ext { <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '1.5.14.RELEASE' springBootVersion = '2.0.4.RELEASE' }</span></span></code> </pre><br>  Em teoria, o Guia de Migra√ß√£o n√£o nos alertou sobre nada, e esperamos que tudo funcione sem desvios.  Do ponto de vista do c√≥digo execut√°vel, n√£o temos nenhum dos outros rakes mencionados anteriormente (incompatibilidade no n√≠vel da API ou outra coisa), pois o aplicativo √© o mais simples poss√≠vel. <br><br>  Come√ßamos.  Primeiro de tudo, estamos convencidos de que estamos trabalhando no segundo Spring Boot, caso contr√°rio, aparentemente n√£o h√° desvios. <br><br><img src="https://habrastorage.org/webt/e4/rq/cy/e4rqcy4gms2t-cog16ru4cr8qcu.png"><br><br>  No entanto, 3 segundos se passam, 6, 9, mas ainda n√£o h√° Herman - nenhuma conclus√£o, nada funciona. <br>  Como costuma acontecer, a expectativa est√° em desacordo com a realidade.  Eles costumam escrever para n√≥s na documenta√ß√£o que, de fato, tudo funciona imediatamente no Spring Boot, que podemos come√ßar como est√£o com o m√≠nimo de problemas e que nenhuma configura√ß√£o √© necess√°ria.  Mas assim que se torna realidade, muitas vezes acontece que ainda se deve ler a documenta√ß√£o.  Em particular, se voc√™ se aprofundar, poder√° encontrar aqui estas linhas: <br><blockquote>  7.3.1  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ativar anota√ß√µes de agendamento</a> <br>  Para habilitar o suporte para anota√ß√µes @Scheduled e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Async</a> , voc√™ pode adicionar @EnableScheduling e @EnableAsync a uma das suas classes @Configuration. </blockquote>  Para que a anota√ß√£o agendada funcione, voc√™ precisa pendurar outra anota√ß√£o na classe com outra anota√ß√£o.  Bem, como sempre na primavera.  Mas por que funcionou antes?  N√≥s n√£o fizemos nada disso.  Obviamente, essa anota√ß√£o em algum lugar foi suspensa no in√≠cio da primeira inicializa√ß√£o do Spring, mas agora, por algum motivo, n√£o est√° na segunda. <br><br><img src="https://habrastorage.org/webt/zz/7_/ar/zz7_ardj3w6--f-wefbyenp7_p0.jpeg"><br><br>  Come√ßamos a vasculhar os c√≥digos-fonte da primeira Spring Boot.  Descobrimos que h√° alguma classe na qual supostamente depende.  Observamos mais de perto, √© chamado "MetricExportAutoConfiguration" e, aparentemente, √© respons√°vel por fornecer essas m√©tricas de desempenho para fora, para alguns agregadores centralizados, e realmente possui essa anota√ß√£o. <br><br><img src="https://habrastorage.org/webt/mf/ya/pb/mfyapbujxbyzbumuxy2cghrs2qk.jpeg"><br><br>  Al√©m disso, ele funciona de tal maneira que inclui seu comportamento em todo o aplicativo de uma s√≥ vez, e n√£o precisa ser pendurado em classes separadas.  Era essa classe que fornecia esse comportamento e, por algum motivo, n√£o o fazia.  Porque <br><br><img src="https://habrastorage.org/webt/vd/p_/fj/vdp_fjs2gqgaicooirzzwu-tjg8.jpeg"><br><br>  Mesmo assim, o GitHub nos leva a uma escava√ß√£o arqueol√≥gica: como parte da transi√ß√£o para a segunda vers√£o do Spring Boot, essa classe foi cortada junto com a anota√ß√£o.  Porque  Sim, porque o mecanismo de entrega de m√©tricas tamb√©m mudou: eles n√£o usam mais seu pr√≥prio script, mas mudaram para o micr√¥metro - uma solu√ß√£o realmente significativa.  Isso √© apenas algo sup√©rfluo deixado com ele.  Talvez isso esteja correto. <br><br>  Quem n√£o quiser ler, veja uma breve demonstra√ß√£o por 30 segundos: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Daqui resulta que, se agora pegarmos e travarmos manualmente a anota√ß√£o ausente em nossa classe original, em teoria, o comportamento dever√° se tornar correto. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.EnableScheduling; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableScheduling</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(‚Äú <span class="hljs-number"><span class="hljs-number">3</span></span>     ‚Ä¶‚Äù); } }</code> </pre><br>  Voc√™ acha que vai funcionar?  Vamos verificar.  Come√ßamos. <br><br><img src="https://habrastorage.org/webt/6f/pg/ld/6fpgldlhinmkrdq6git1-dovdrg.png"><br><br>  Pode-se observar que ap√≥s 3 segundos, ap√≥s 6 e 9, a mensagem esperada por n√≥s ainda √© exibida no log. <br><br><a name="scheduling_solution"></a><h3>  Como ser </h3><br>  O que fazer com isso neste caso particular e mais geral?  N√£o importa o qu√£o moralista isso possa parecer, em primeiro lugar, vale a pena ler n√£o apenas fragmentos de documenta√ß√£o copiados, mas tamb√©m um pouco mais amplo, apenas para cobrir esses aspectos. <br><br>  Em segundo lugar, lembre-se de que, no Spring Boot, embora muitos recursos estejam prontos para uso (programa√ß√£o, ass√≠ncrona, cache, ...), eles nem sempre s√£o inclu√≠dos, devem ser ativados explicitamente. <br><br>  Em terceiro lugar, n√£o se preocupa em ser seguro: adicione anota√ß√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Enable</a> * (e toda a fam√≠lia) ao seu c√≥digo, sem esperar por uma estrutura.  Mas ent√£o surge a pergunta: o que acontecer√° se, por acaso, eu e meus colegas adicionarmos algumas anota√ß√µes, como eles se comportar√£o?   ,        .    :  .   ,       . <br><br> , @EnableAsync  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Enable</a> Caching  , ,  ,  ,        ,    . ,             .     ?      javadoc    ,      .  ,        .    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Enable</a> *,       ,    .     ?            . <br><br><a name="proxy"></a><h2> Spring Cloud &amp; Co.   </h2><br><img src="https://habrastorage.org/webt/0a/sa/qj/0asaqj87-tg2xetyig_ytjreb34.jpeg"><br><br>       Spring Boot 2   ,    Spring Cloud ‚Äî      Service Discovery (   ).      JavaMelody.     -  .  , ,    JDBC,    H2. <br><br><img src="https://habrastorage.org/webt/as/fd/lb/asfdlb0f-iqfgaquxgr7bjitwpq.jpeg"><br><br>    ,      ,  JavaMelody ‚Äî   ,           ,   .   dev-,  test,          -  ,  Prometheus. <br><br>      Gradle   : <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> springCloudVersion = <span class="hljs-string"><span class="hljs-string">'2.0.1.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) runtime(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-jdbc:$springBootVersion"</span></span>) runtime group: <span class="hljs-string"><span class="hljs-string">"org.springframework.cloud"</span></span>, name: <span class="hljs-string"><span class="hljs-string">"spring-clooud-starter-netflix-eureka-client"</span></span>, version: <span class="hljs-function"><span class="hljs-function">springCloudVersion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"net.bull.javamelody:javamelody-spring-boot-starter:1.72.0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//‚Ä¶ }</span></span></span></span></code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(  )</a> <br><br>      Spring Boot ‚Äî  web  jdbc,  Spring Cloud     eureka (,    ,    Service Discovery),   JavaMelody.        . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HikariJavamelodyDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(HikariJavamelodyDemoApplication.class, args); } }</code> </pre><br>  Come√ßamos. <br><br><img src="https://habrastorage.org/webt/uj/os/hr/ujoshrw-kj_cn72s23h5e7fjgka.jpeg"><br><br>      .      ,        ,      -  com.sun.proxy  Hikari, HikariDataSource.    ,  Hikari ‚Äî      ,    Tomcat, C3P0  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/la/u9/hvlau913-05gppcoqmjfsbuzip0.jpeg" width="50%"></div><br>   ?       . <br><br><h2>   </h2><br><h3> Spring Cloud  dataSource   </h3><br>  ,  Spring Cloud   ,    dataSource (   ),  .     ,    AutoRefresh  RefreshScope ‚Äî                .          .      CGLIB. <br><br>  , ,   Spring Boot     Spring    :     JDK  (    ,   )     CGLIB (   ).     BeanPostProcessor'    BeanDefinition      ,        . <br><br><h3> JavaMelody  dataSource   </h3><br>   ‚Äî  JavaMelody.    DataSource  ,      ,         . JavaMelody   JDK-,      ,   .       ‚Äî   BeanPostProcessor. <br><br>        ,   ,     DataSource     JDK-,    CGLIB-.    : <br><br><img src="https://habrastorage.org/webt/j8/la/aj/j8laaj9tuxuewycjnpqzuxcaxpw.png"><br><br>     .      ,         . <br><br><h3> Spring Boot  dataSource.unwrap() </h3><br>     Spring Boot,     DataSource#unwrap(),        JMX.    JDK-       (     ),  CGLIB-,   Spring Cloud,     Spring Context. ,   ,      JDK-,    CGLIB API    . <br><br>       ,     : <br><br><img src="https://habrastorage.org/webt/a4/tb/aw/a4tbawwbqhd72cn7zw-ain4zm4c.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://jira.spring.io/browse/SPR-17381</a> <br><br>       ,   ,     ,         .     ,     , , , -   . <br><br><img src="https://habrastorage.org/webt/ke/bn/ns/kebnnswvcy8kwtnqezvikitcdvw.jpeg"><br><br>     .       Hikari? <br><br>  ,     Hikari  -    ,   Spring Cloud    .   : Hikari       Spring Boot 2. ? -    - .   ,  Spring Cloud?   ,    -  ,       ?   .  ,       . <br><br><h3>    ‚Ä¶ </h3><br><pre> <code class="java hljs">org.springframework.cloud.autoconfigure.RefreshAutoConfiguration .RefreshScopeBeanDefinitionEnhancer: <span class="hljs-comment"><span class="hljs-comment">/** * Class names for beans to post process into refresh scope. Useful when you * don't control the bean definition (eg it came from auto-configuration). */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;String&gt; refreshables = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;( Arrays.asList(<span class="hljs-string"><span class="hljs-string">"com.zaxxer.hikari.HikariDataSource"</span></span>));</code> </pre><br>      Spring Cloud    autoconfiguration,       Enhancer BeanDefinition',       ,      Hikari.    Spring Cloud        .       . <br><br>      ?    Spring Cloud   ,        CGLIB-.   , ,  ,  ,    -      .        (jira.spring.io/browse/SPR-17381).       BeanPostProcessor,     .      BeanDefinition       ,    BeanPostProcessor'.   Stack Overflow    ,      -  ,    , proxyTargetClass   true  false  ,   .    ,        .      . <br><br>            ,      -   ,     . <br><br>    : <br><br><ul><li>      (, Tomcat JDBC Pool) <br> spring.datasource.type=org.apache.tomcat.jdbc.pool.DataSource <br>     <br> runtime 'org.apache.tomcat:tomcat-jdbc:8.5.29' <br> Hikari ,  , ,   ,      ,      Tomcat,     Spring Boot. </li><li>   JavaMelody,   JDBC-,    . <br> javamelody.excluded-datasources=scopedTarget.dataSource </li><li>      Spring Cloud. <br> spring.cloud.refresh.enabled=false <br> ,  ,     ,    Service Discovery,       . </li></ul><br><br>      .              ,          . <br><br><a name="bonus"></a><h3>  ( *) </h3><br> *  Spring Cloud (   JavaMelody) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ManagedResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAsync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJmxResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManagedOperation</span></span> <span class="hljs-meta"><span class="hljs-meta">@Async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launchLongLastingJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -   } }</span></span></code> </pre><br>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/toparvion/joker-2018-samples/tree/master/jmx-resource</a> . <br><br>   .    ,      Spring Cloud.   JavaMelody ,    Spring-,   .       ,  ,     ,    JMX   .      -  ,      Async,    JMX-  .      JMX,      @ManagedOperation,     ,     (    Spring ‚Äî    ,     OK). <br><br>      ,     ,      , , ,  myJMXResource     JMX,     .     ,          ‚Äî     , CGLIB  JDK. <br><br><img src="https://habrastorage.org/webt/de/c2/bo/dec2bo6sbaa1zipyhg55jigk960.jpeg"><br><br>  JDK  CGLIB-.    ,  -   BeanPostProcessor. <br><br>  ,    BeanPostProcessor': <br> AsyncAnnotationBeanPostProcessor <br><br><ul><li> :      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Async</a> </li><li> : org.springframework.scheduling </li><li>  :  @EnableAsync ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Import</a> ) </li></ul><br> 2. DefaultAdvisorAutoProxyCreator <br><ul><li> :     AOP-,        </li><li> : org.springframework.aop.framework.autoproxy </li><li>  : @Configuration- PointcutAdvisorConfig (  ) </li></ul><br> DefaultAdvisorAutoProxyCreator   @Configuration-.   ,      ,   JavaMelody,             configuration-.  ,    PointcutAdvisorConfig,        . <br><br><img src="https://habrastorage.org/webt/ta/bq/lh/tabqlh0jqjk71cnajqj5trjwp10.jpeg"><br><br>   ,    .   PointcutAdvisorConfig,   AdvisorConfig,     ,  configuration-,   ,  ,  ,    ,          . <br><br>  ,     ,   ,   ,    -. <br><br><img src="https://habrastorage.org/webt/nx/hw/vk/nxhwvkroqzaw8eziviybh7ct2sk.jpeg"><br><br>       BeanPostProcessor'.        ,       ,   ,    BeanPostProcessor         .    ,         Advised (  BeanPostProcessor'),   , ,   ,     , ,   JDK-,         .      . <br><br>        .     ,     : <br><br><img src="https://habrastorage.org/webt/kz/_r/te/kz_rtesazmfb1jdrd-2cbt7_kfo.png"><br><br>       JMX     .        BeanPostProcessor.       BeanPostProcessor',        , ,   ,   ,            JAR,    ,   . <br><br><a name="proxy_solution"></a><h3>  Como ser </h3><br> -,       ,   Spring AOP,  , .  ¬´ ¬ª?        ,  -       Advice  Advisor,      ,       . <br><br> -,    best practices. ,          JMX-  ,       .  - ,       , ,     .      ,   autowire' ()     .     .  ,    ,    - .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Order</a> ,     .  ,   ,     , ..     proxyTargetClass,   . <br><br> :     ,   . -, ¬´Keep calm and YAGNI¬ª.   ,                .  ¬´ ¬ª,      - , -   ,    ,       ,   .     ,  ,       :    -,   ,       ‚Äî  ,    .          . , Spring    ,      ,    .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">tolkkv</a> ,   ,      436- ,   .      ,      . <br><br><a name="relax"></a><h2> Relax Binding.    ()  </h2><br>   ,    . <br><br><img src="https://habrastorage.org/webt/ry/xw/mv/ryxwmvrfnmzbmona2o3vys4yqim.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> <br><br>    ,  Relax Binding  Spring Boot.       -         . ,      -   firstName   ,       acme.my-project.person,  Spring Boot      .        :  camel case,  ,     ,  -  ‚Äî       firstName.      Relax Binding. <br><br>      Spring Boot'    ,   ,          ‚Äî        . ,  ,   ,     : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding</a> ( 1 ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> ( 3 ) </li><li> <a href="">github.com/spring-projects/spring-boot/wiki/Relaxed-Binding-2.0</a> ( 4 ) </li></ul><br>   ,  ,  .  - . ,      . <br><br>  Por exemplo: <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) }</code> </pre><br> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ) <br><br>       - ,   web,   Spring Boot,         -  . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RelaxBindingApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(RelaxBindingDemoApplication.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SecurityProperties securityProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(RelaxBindingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> main </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ApplicationArguments args)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"KEYSTORE TYPE IS: {}"</span></span>, securityProperties.getKeyStoreType()); } }</code> </pre><br>  ,    POJO- ( )        ,    KEYSTORE TYPE.  POJO          ,      applications.properties  application.yaml,  . <br><br>      keystoreType,     private String keystoreType,      applications.properties: security.keystoreType=jks. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"security"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecurityProperties</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystorePath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystoreType; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystorePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystorePath = keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeyStoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystoreType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystoreType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystoreType = keystoreType; } }</code> </pre><br>     Spring Boot     . <br><br><img src="https://habrastorage.org/webt/ya/fn/kg/yafnkgxoaoudil70xnvdw1q_hhc.jpeg"><br><br>  ,  ,  ,  .      ,      . <br><br><img src="https://habrastorage.org/webt/qz/1b/s6/qz1bs6ydorm1cfaej8lcfzvxc84.jpeg"><br><br>      ,   .   ,   ,  ,    -   ,       , - key-store-type.        ,    ,        ,     . <br><br>       .    ,      . <br><br><img src="https://habrastorage.org/webt/kf/8j/8e/kf8j8eytzsayh7xarx_dx_kaedy.jpeg"><br><br>     .      2  ,   ,   .           Java   properties ‚Äî  ,    .    , , ,     ,    ,      .   ‚Äî      Java bean       .   ,    ,  .       ,   ¬´keystore¬ª  ,    : ¬´Key¬ª  ¬´Store¬ª. ‚Ä¶ <br><br><img src="https://habrastorage.org/webt/9-/ak/rw/9-akrwm5gftlarfdvte2s1hqkas.jpeg"><br><br>  ,    ,    ? . <br><br> ,    ,    Relax Binding    (   getStoreType()).   ,     . ,         .    ,  keyStoreType,   . ,       Relax Binding,    ,        ,    . <br><br>  ,   -  ,  -   ,     .      ,     .         : <br><br><img src="https://habrastorage.org/webt/ll/s_/c2/lls_c2hpqhq6ea7eooc_bf65c_u.jpeg"><br><br>        ,  -    ,    ,   , ,     -,         .        . <br><br><a name="relax_solution"></a><h3>  Como ser </h3><br>        :       - . -,   ,     dev-   , ,  YAML  properties,    ‚Äî      ,    ,    . -,     <a href="">c   </a> ,       Relax Binding,    .  , , ,     Spring Boot   . <br><br><a name="unit"></a><h2> Unit Testing.    Mockito 2 </h2><br>    ,    -     ,        Mockito. <br><br> Mockito    ,        Spring Boot Starter,      Spring,        Mockito. <br><br><pre> <code class="plaintext hljs">$gradle -q dependencyInsight --configuration testCompile --dependency mockito org.mockito:mockito-core:2.15.0 variant "runtime" /--- org.springframework.boot:spring-boot-starter-test:2.0.2.RELEASE /---testCompile</code> </pre><br>     ?      .    Spring Boot  Mockito   ,    1.5.2 Spring Boot     Mockito 2,      .     -  .         Mockito 2. <br><br>  Mockito   ,    2016-   Mockito 2.0  Mockito.2.1‚Äî      :  Java 8    ,     Hamcrest     - .   ,     ,     . <br><br>     ,           ,     (  ) . <br><br><img src="https://habrastorage.org/webt/5a/yt/fo/5aytfoqxgbx4crbjwmngut1dh1i.jpeg"><br><br> ,       ,     JButton  Swing,    null,   ,     -  .   , string'   null,   , null   instanceof  string.  ,  Mockito 1     ,  Mockito 2          ,  anyString  null   ,        ,       .      :      null,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> ,  ,         ,     Mockito 1. <br><br>  ,   , . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object target)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ } } &lt;hr/&gt; @Test public void testAnyStringMatcher() { MyService myServiceMock = mock(MyService.class); myServiceMock.setTarget(new JButton()); verify(myServiceMock).setTarget(anyString()); }</span></span></code> </pre><br> ,        ,   .                 JButton.       anyString.  ,   :   ,     ‚Äî    .   ,       .    -       10-    ,        .  Mockito 1   ,     : <br><br><img src="https://habrastorage.org/webt/ts/_s/cd/ts_scdhl4ikfptceteyv-plex0o.png"><br><br> Mockito 2    , ,   , anyString     : <br><br><img src="https://habrastorage.org/webt/db/tw/ec/dbtwecp6onmr9f_r4k-ufverzb8.jpeg"><br><br>     .   ,    . ,        ,      ,         ,         SocketTimeoutException,       -   .          ,  SocketTimeoutException ,  .         Mockito 1. <br><br><img src="https://habrastorage.org/webt/2b/nc/9d/2bnc9dqcfgkh7htm6-tiih1mf38.png"><br><br>   Mockito 2        ,        : <br><br><img src="https://habrastorage.org/webt/41/ya/uh/41yauhpileynqw_fqvdisk26h_k.jpeg"><br><br>   ,  Mockito 1    ,     ,        .      new SocketTimeoutException   new,  constructor,  Mockito 1   . <br><br>  O que fazer sobre isso?    , ,  RuntimeException,       ,    Mockito     . <br><br>    .    ,       .       compile-time. -     ,     Hamcrest.  Spring Boot,  Mockito 1     @MockBean  @SpyBean.        ,    Spring Integration,         review. <br> (: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://docs.spring.io/spring-integration/docs/5.0.0.RELEASE/reference/htmlsingle/#testing</a> ) <br><br><h3>  Como ser </h3><br>     ,   ,      Mockito 1,      Mockito 2 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dzone.com/refcardz/mockito</a> ). <br><br> -,      ,     ,    Spring Boot 1.5.2  Mockito 2. <br><br> -, ,    ,    Mockito 2,          : <a href=""></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . <br><br><a name="gradle"></a><h2> Gradle Plugin.  Spring Boot  </h2><br> ,     , ‚Äî  Spring Boot-  Gradle. <br><br>   Migration Guide ,  Spring Boot   Gradle   .  ,  .  :    Gradle 4  (,    settings.gradle   ).       dependency management plugin,    .    bootRepackage,  ,   :  bootWar  bootJar.     bootJar     . <br><br>  bootJar: <br><br><ul><li>  ,    org.springframework.boot  java; </li><li>   jar; </li><li>   mainClassName (    )   (  ,  -  ). </li></ul><br>  ,    ,      ‚Äî   ,   ,   Gradle,     Spring Boot. <br><br>     ?   -    Spring Boot 2, , ,  Gradle 4      Spring Boot-.     ,     ,  :      ,  ,     (    ,     ). <br><br><img src="https://habrastorage.org/webt/kb/uh/y4/kbuhy4rtm7yyl_zjp2ij62wavoq.jpeg"><br><br>   ,   .    app1 ,    app2, app3  . .  app1    lib. <br><br><h3> ¬´Show me the code!¬ª </h3><br>   <br><br><pre> <code class="java hljs">subprojects { repositories { mavenCentral() } apply plugin: <span class="hljs-string"><span class="hljs-string">'java'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'org.springframework.boot'</span></span> }</code> </pre><br>         ‚Äî   : java   Spring Boot   . <br><br> ,   ,       ,   .      ,        ,     ,     .       . <br><br> app1:   <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':lib'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br>          lib  ,   Spring Boot-. <br><br> app1:   <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GradlePluginDemoApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ @Override public void run(ApplicationArguments args) { String appVersion = Util.getAppVersion(getClass()); log.info("Current application version: {}", appVersion); } }</span></span></code> </pre><br>         Util,     . <br><br> lib:   <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Util</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; appClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> appClass.getPackage().getImplementationVersion(); } }</code> </pre><br>   Util   getAppVersion    ,    ,  ImplementationVersion   .        . <br><br><img src="https://habrastorage.org/webt/jc/ax/ur/jcaxur0f1_-yhxot9uvkfsf3fos.jpeg"><br><br>      IDE,   ,    ,     .    gradle build  IDE ,   .         Util.  ,  ,    ,      ,       . <br><br><a name="gradle_solution"></a><h3>   </h3><br> : <br><br><ul><li> bootJar   jar; </li><li> Gradle        jar. </li></ul><br> : <ul><li>       ; </li><li>   ,    jar (  ImplementationVersion), . </li></ul><br>    ?   :        . <br><br><img src="https://habrastorage.org/webt/dz/lr/p8/dzlrp85l4z8wsgc12ttn7cwsqec.jpeg"><br><br>       Spring Boot-   , ,   lib    .     . <br><br>  2:  SB Gradle Plugin   Spring Boot- <br><br><pre> <code class="java hljs">bootJar { enabled = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }</code> </pre><br>    ,      -   ,    , ,    , ,      bootJar   . ,    jar  ,       . <br><br><a name="other"></a><h2>  </h2><br>  , ,      ,      Spring Boot.       . <br><br><img src="https://habrastorage.org/webt/xm/8w/kx/xm8wkxoaoc2ujoy0kicwn5v2n9w.jpeg"><br><br>  Spring Boot        :       web-,       ,    .    - ,       ,  Spring Boot properties migrator,      ,  ,        .      ,     ,     -,        . <br><br>      Actuator.  ,       ()  ,      Spring Security.       . <br><br><img src="https://habrastorage.org/webt/hv/sl/d4/hvsld4a0hcak8jvs3rbwsbugi00.jpeg"><br><br>  Spring Cloud   .   ,        .   ,  Netflix  Feign. <br><br><img src="https://habrastorage.org/webt/lu/a5/6l/lua56loq0hsapwtgkstpf0_7ik0.jpeg"><br><br>  Spring Integration,     ,   Spring Framework,   .     ‚Äî  ,    Java DSL      , ,        .   ,       ,   ,      ,        handle    handleWithAdapter. <br><br><a name="summary"></a><h2> .    </h2><br> ,    ,     : <br><br><img src="https://habrastorage.org/webt/ww/ob/aq/wwobaqaf8ncw8fsfowcbdvipbvu.jpeg"><br><br>   ,   , , Web,       . <br><br>  (Properties Binding),   ,       ,    Relax Binding. <br><br>  ‚Äî ,     :   , AOP  ,        ,   Spring Boot 2     . <br><br> , , ,  ‚Äî   ,     Mockito 1  Mockito 2.    -  ,     ? <br><br><ul><li>  ¬´ ¬ª (YAGNI) </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">;</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Migration Guide</a> ; </li><li>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> </li></ul><br> -,   ,         ,     ,    YAGNI.   ,    -  ,     .  ,  ,     . <br><br> -,   - - ,     ,   ,     .     ,      ,  , ,       .           Migration Guide.  ,         ,   ,       ,  ,          . <br><br>     ,             Spring Boot. ,                 Spring Boot,     ,       ‚Ä¶    . <br><blockquote>    ,  : <b>5-6   </b>  <b>JPoint</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>  Spring Boot:      Spring Boot-  Java 8  Java 11.    ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439796/">https://habr.com/ru/post/pt439796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439786/index.html">Revis√£o do telefone IP Snom D712 (e um pouco D710)</a></li>
<li><a href="../pt439788/index.html">Outras curiosidades dos algoritmos GOST Grasshopper e Stribog</a></li>
<li><a href="../pt439790/index.html">Testar o JaCarta WebClient ou armazenar tokens em um cofre</a></li>
<li><a href="../pt439792/index.html">A NASA est√° procurando parceiros na ind√∫stria americana para criar um pouso tripulado parcialmente reutiliz√°vel</a></li>
<li><a href="../pt439794/index.html">Dor nas costas - compreens√£o da perspectiva da medicina moderna</a></li>
<li><a href="../pt439804/index.html">Zen de Teste de Unidade</a></li>
<li><a href="../pt439806/index.html">Nomes de dom√≠nio SSL v√°lidos para cont√™ineres do Docker local</a></li>
<li><a href="../pt439808/index.html">Os maiores telesc√≥pios. De notebooks e olhos a c√¢meras de 340 megapixels e data centers. Parte 1</a></li>
<li><a href="../pt439810/index.html">Conhe√ßa a estrutura de microsservi√ßo Moleculer</a></li>
<li><a href="../pt439812/index.html">Abordagens Kaggle para CV em prod: voc√™ n√£o pode implementar para cortar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>