<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜µ ğŸ¤¤ ğŸ‘† Microsoft ML Sparkï¼šSparkæ‰©å±•ï¼Œä½¿SparkMLæ›´äººæ€§åŒ–ï¼ŒLightGBMä½œä¸ºå¥–åŠ± ğŸ¤¶ ğŸ“³ ğŸ•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è®¸å¤šä½¿ç”¨Spark MLçš„äººéƒ½çŸ¥é“ï¼Œä»–ä»¬åœ¨é‚£é‡Œåšçš„æŸäº›äº‹æƒ…â€œå¹¶ä¸å®Œå…¨æˆåŠŸâ€ã€‚ 
 æˆ–æ ¹æœ¬ä¸åšã€‚ Sparkå¼€å‘äººå‘˜çš„ç«‹åœºæ˜¯ SparkMLæ˜¯åŸºç¡€å¹³å°ï¼Œå¹¶ä¸”æ‰€æœ‰æ‰©å±•éƒ½å¿…é¡»æ˜¯å•ç‹¬çš„ç¨‹åºåŒ…ã€‚ ä½†è¿™å¹¶ä¸æ€»æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œåˆ†æäººå‘˜å¸Œæœ›ä½¿ç”¨ç†Ÿæ‚‰çš„å·¥å…·ï¼ˆJupterï¼ŒZeppelinï¼‰è¿›è¡Œå·¥ä½œï¼Œè€Œè¿™æ­£æ˜¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microsoft ML Sparkï¼šSparkæ‰©å±•ï¼Œä½¿SparkMLæ›´äººæ€§åŒ–ï¼ŒLightGBMä½œä¸ºå¥–åŠ±</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/456668/"><p> è®¸å¤šä½¿ç”¨Spark MLçš„äººéƒ½çŸ¥é“ï¼Œä»–ä»¬åœ¨é‚£é‡Œåšçš„æŸäº›äº‹æƒ…â€œå¹¶ä¸å®Œå…¨æˆåŠŸâ€ã€‚ <br> æˆ–æ ¹æœ¬ä¸åšã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sparkå¼€å‘äººå‘˜çš„ç«‹åœºæ˜¯</a> SparkMLæ˜¯åŸºç¡€å¹³å°ï¼Œå¹¶ä¸”æ‰€æœ‰æ‰©å±•éƒ½å¿…é¡»æ˜¯å•ç‹¬çš„ç¨‹åºåŒ…ã€‚ ä½†è¿™å¹¶ä¸æ€»æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œåˆ†æäººå‘˜å¸Œæœ›ä½¿ç”¨ç†Ÿæ‚‰çš„å·¥å…·ï¼ˆJupterï¼ŒZeppelinï¼‰è¿›è¡Œå·¥ä½œï¼Œè€Œè¿™æ­£æ˜¯å¤§å¤šæ•°éœ€è¦çš„å·¥å…·ã€‚ ä»–ä»¬ä¸æƒ³ä½¿ç”¨maven-assemblyæ¥æ”¶é›†500å…†å­—èŠ‚çš„JARæ–‡ä»¶ï¼Œä¹Ÿä¸å¸Œæœ›è‡ªå·±ä¸‹è½½ä¾èµ–é¡¹å¹¶å°†å…¶æ·»åŠ åˆ°Sparkå¯åŠ¨å‚æ•°ä¸­ã€‚ ç²¾é€šJVMé¡¹ç›®æ„å»ºç³»ç»Ÿçš„å·¥ä½œå¯èƒ½éœ€è¦ä¹ æƒ¯äºJupyter / Zeppelinçš„åˆ†æå¸ˆå’ŒDataScientistsä»˜å‡ºæ›´å¤šçš„åŠªåŠ›ã€‚ è®©DevOpså’Œé›†ç¾¤ç®¡ç†å‘˜åœ¨è®¡ç®—èŠ‚ç‚¹ä¸Šæ”¾ç½®ä¸€å †è½¯ä»¶åŒ…æ˜¾ç„¶æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ è‡ªå·±ç¼–å†™SparkMLæ‰©å±•çš„ä»»ä½•äººéƒ½çŸ¥é“é‡è¦çš„ç±»å’Œæ–¹æ³•ï¼ˆå‡ºäºæŸç§åŸå› æ˜¯ç§æœ‰[ml]ï¼‰ï¼Œå¯¹å­˜å‚¨çš„å‚æ•°ç±»å‹çš„é™åˆ¶ç­‰æœ‰å¤šå°‘éšè—çš„å›°éš¾ã€‚ </p><br><p> ç°åœ¨çœ‹æ¥ï¼Œæœ‰äº†MMLSparkåº“ï¼Œç”Ÿæ´»ä¼šæ›´è½»æ¾ä¸€äº›ï¼Œå¹¶ä¸”ä½¿ç”¨SparkMLå’ŒScalaè¿›å…¥å¯ä¼¸ç¼©æœºå™¨å­¦ä¹ çš„é—¨æ§›ä¼šç•¥ä½ã€‚ </p><a name="habracut"></a><br><h2 id="vvedenie"> å¼•è¨€ </h2><br><p>ç”±äºè®¸å¤šå›°éš¾ï¼Œä»¥åŠSparkMLä¸­ç¨€ç–çš„ç°æˆæ–¹æ³•å’Œè§£å†³æ–¹æ¡ˆé›†ï¼Œè®¸å¤šå…¬å¸ä¸ºSparkç¼–å†™äº†æ‰©å±•ã€‚ ä¸€ä¸ªä¾‹å­æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PravdaML</a> ï¼Œå®ƒæ˜¯ç”±Odnoklassnikiå¼€å‘çš„ï¼Œé€šè¿‡å¯¹GitHubä¸Šå†…å®¹çš„å¿«é€Ÿè¯„ä¼°æ¥åˆ¤æ–­ï¼Œå®ƒçœ‹èµ·æ¥éå¸¸æœ‰å‰é€”ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›è§£å†³æ–¹æ¡ˆä¸­çš„å¤§å¤šæ•°é€šå¸¸éƒ½æ˜¯å°é—­çš„æˆ–å¼€æ”¾çš„ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡Maven / sbtå’ŒAPIæ–‡æ¡£è¿›è¡Œå®‰è£…ï¼Œè¿™ä½¿å¾—ä½¿ç”¨å®ƒä»¬éå¸¸å›°éš¾ã€‚ </p><br><p> ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MMLSpark</a>åº“ã€‚ </p><br><p> æˆ‘ä»¬å°†åƒå¾€å¸¸ä¸€æ ·è€ƒè™‘å¯¹æ³°å¦å°¼å…‹å·æ—…å®¢è¿›è¡Œåˆ†ç±»çš„ä»»åŠ¡ç¤ºä¾‹ã€‚ ç›®æ ‡æ˜¯æ˜¾ç¤ºMMLSparkåº“çš„å°½å¯èƒ½å¤šçš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ <del> åœ¨ImageNetä¸Šåˆ é™¤SOTA </del> æ˜¾ç¤ºå¾ˆé…·çš„æœºå™¨å­¦ä¹ ã€‚ æ‰€ä»¥æ³°å¦å°¼å…‹å·ä¼šåšåˆ°çš„ã€‚ </p><br><p><img src="https://habrastorage.org/webt/rg/bt/sf/rgbtsf7j0ovmfa5lpjkfpfapzti.jpeg"></p><br><p> è¯¥åº“æœ¬èº«å…·æœ‰ç”¨äºScalaçš„æœ¬æœºAPIï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ï¼‰ï¼ŒPython APIï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ï¼‰ï¼Œå¹¶ä¸”ä»GitHubå­˜å‚¨åº“ä¸­çš„æŸäº›ä½ç½®æ¥çœ‹ï¼Œå®ƒå¾ˆå¿«å°†å…·æœ‰Rçš„APIã€‚ </p><br><p>  GitHubé¡¹ç›®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼ˆPySpark + Jupyterï¼‰ä¸­</a>æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¾ˆå¥½çš„ç¤ºä¾‹ç¬”è®°æœ¬ç”µè„‘</a> ï¼Œä½†æˆ‘ä»¬ä¼šèµ°å¦ä¸€æ¡è·¯ã€‚ æ­£å¦‚Dmitry Bugaychenko <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰€å†™çš„é‚£æ ·</a> ï¼Œå¦‚æœæ‚¨ä¸ºSparkè¿›è¡Œå¼€å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨æœ‰å……åˆ†çš„ç†ç”±ä¸ºæ­¤ä½¿ç”¨Scalaï¼Œé‚£ä¹ˆScalaå…è®¸æ‚¨æ›´æœ‰æ•ˆï¼Œæ›´çµæ´»åœ°å®šä¹‰è‡ªå·±çš„Transformerå’ŒEstimatorï¼Œå°†å®ƒä»¬åµŒå…¥åˆ°SparkML Pipelineä¸­ï¼Œä½†æ˜¯numpyçš„å·¥ä½œé€Ÿåº¦å´å¾ˆæ…¢UDFä¸­çš„/ pandasä»£ç ï¼ˆä»JVMè°ƒç”¨å¯æ‰§è¡Œæ–‡ä»¶ï¼‰å·²ç»ç¼–å†™äº†å¾ˆå¤šã€‚ </p><br><h2 id="kratko-ob-ustanovke"> å®‰è£…ç®€ä»‹ </h2><br><p> æ•´ä¸ªç¬”è®°æœ¬ç”µè„‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>å¯ç”¨ã€‚ è¦ä¸æ³°å¦å°¼å…‹å·ä¸€èµ·ä½¿ç”¨ï¼Œåœ¨é»˜è®¤è®¾ç½®ä¸‹åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šæœ¬åœ°è¿è¡Œçš„Zeppelin Dockeré•œåƒå°±è¶³å¤Ÿäº†ã€‚  Dockerå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚  MMLSparkåº“ä¸åœ¨Maven Centralä¸­ï¼Œè€Œæ˜¯åœ¨Sparkè½¯ä»¶åŒ…ä¸­ï¼Œå¹¶ä¸”è¦å°†å…¶æ·»åŠ åˆ°Zeppelinä¸­ï¼Œå¿…é¡»åœ¨ä¾¿æºå¼è®¡ç®—æœºçš„å¼€å¤´è¿è¡Œä»¥ä¸‹ä»£ç å—ï¼š </p><br><pre><code class="plaintext hljs">%spark.dep z.addRepo("bintray.com").url("http://dl.bintray.com/spark-packages/maven/") z.load("Azure:mmlspark:0.17")</code> </pre> <br><p> å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¯¥åº“å…·æœ‰å‡ºè‰²çš„å‘åå…¼å®¹æ€§ï¼šä¾‹å¦‚ï¼Œä¸XGBoost4j-sparkä¸åŒï¼Œå®ƒè‡³å°‘éœ€è¦Spark 2.3ä»¥ä¸Šç‰ˆæœ¬ï¼Œè€ŒZeppelin Dockeræ˜ åƒé™„å¸¦çš„Spark 2.2.1ä¸­å­˜åœ¨æ­¤é—®é¢˜ï¼Œå¹¶ä¸”å­˜åœ¨ä»»ä½•å›°éš¾æˆ‘æ²¡æœ‰æ³¨æ„åˆ°ã€‚ </p><br><p>  <strong>æ³¨æ„ï¼š</strong>å¤§éƒ¨åˆ†MMLSparkåº“ä¸“ç”¨äºæ¨æ–­ç¾¤é›†ä¸Šçš„ç½‘æ ¼ï¼Œè€Œè¯¥ç¾¤é›†ä¸Šå­˜åœ¨CNTKï¼ˆæ ¹æ®æ–‡æ¡£åˆ¤æ–­ï¼Œåº”è¯»å–ç°æˆçš„cntkæ¨¡å‹ï¼‰å’Œå·¨å¤§çš„OpenCVå—ã€‚ å½“æˆ‘ä»¬æœ‰å¤§é‡çš„è¡¨æ ¼æ•°æ®ä»¥.csvï¼Œè¡¨æ ¼æˆ–å…¶ä»–æ ¼å¼å­˜åœ¨äºHDFSä¸­æ—¶ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºæ›´æ™®é€šçš„ä»»åŠ¡ï¼Œå¹¶å°è¯•â€œå»ºæ¨¡â€è¿™ç§æƒ…å†µã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œé¢„å¤„ç†å¹¶å»ºç«‹æ¨¡å‹ï¼Œè€Œè¿™äº›æ•°æ®æ— æ³•æ”¾å…¥ä¸€å°è®¡ç®—æœºçš„å†…å­˜ä¸­ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚ </p><br><h2 id="chtenie-i-razvedochnyy-analiz"> é˜…è¯»ä¸æ™ºåŠ›åˆ†æ </h2><br><p> é€šå¸¸ï¼ŒSpark + Zeppelinä¸€ç‚¹ä¹Ÿä¸å·®ï¼Œå¯ä»¥åº”ä»˜EDAä»»åŠ¡ï¼Œä½†æˆ‘ä»¬å°†å°è¯•æ‰©å±•å…¶åŠŸèƒ½ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥æ‰€éœ€çš„ç±»ï¼š </p><br><ul><li> å…¨éƒ¨æ¥è‡ªspark.sql.typesæ¥å£°æ˜æ¨¡å¼å¹¶æ­£ç¡®è¯»å–æ•°æ® </li><li> å…¨éƒ¨æ¥è‡ªspark.sql.functionsæ¥è®¿é—®åˆ—å¹¶ä½¿ç”¨å†…ç½®å‡½æ•° </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">com.microsoft.ml.spark.SummarizeData</a> ï¼Œå¯ä»¥ç§°ä¸ºpandas.DataFrame.describeçš„ç±»ä¼¼ç‰© </li></ul><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.<span class="hljs-type"><span class="hljs-type">SummarizeData</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.sql.functions._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.sql.types._</code> </pre> <br><p> æˆ‘ä»¬è¯»å–äº†æ–‡ä»¶ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> titanicSchema = <span class="hljs-type"><span class="hljs-type">StructType</span></span>( <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Passanger"</span></span>, <span class="hljs-type"><span class="hljs-type">ShortType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Survived"</span></span>, <span class="hljs-type"><span class="hljs-type">ShortType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"PClass"</span></span>, <span class="hljs-type"><span class="hljs-type">ShortType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Name"</span></span>, <span class="hljs-type"><span class="hljs-type">StringType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Sex"</span></span>, <span class="hljs-type"><span class="hljs-type">StringType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Age"</span></span>, <span class="hljs-type"><span class="hljs-type">ShortType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"SibSp"</span></span>, <span class="hljs-type"><span class="hljs-type">ShortType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Parch"</span></span>, <span class="hljs-type"><span class="hljs-type">ShortType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Ticket"</span></span>, <span class="hljs-type"><span class="hljs-type">StringType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Fare"</span></span>, <span class="hljs-type"><span class="hljs-type">FloatType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Cabin"</span></span>, <span class="hljs-type"><span class="hljs-type">StringType</span></span>) :: <span class="hljs-type"><span class="hljs-type">StructField</span></span>(<span class="hljs-string"><span class="hljs-string">"Embarked"</span></span>, <span class="hljs-type"><span class="hljs-type">StringType</span></span>) :: <span class="hljs-type"><span class="hljs-type">Nil</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> train = spark .read .schema(titanicSchema) .option(<span class="hljs-string"><span class="hljs-string">"header"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) .csv(<span class="hljs-string"><span class="hljs-string">"/mountV/titanic/train.csv"</span></span>)</code> </pre> <br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•°æ®æœ¬èº«åŠå…¶å¤§å°ï¼š </p><br><pre> <code class="scala hljs">println(<span class="hljs-string"><span class="hljs-string">s"Train shape is: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${train.count}</span></span></span><span class="hljs-string"> x </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${train.columns.length}</span></span></span><span class="hljs-string">"</span></span>) train.limit(<span class="hljs-number"><span class="hljs-number">5</span></span>).createOrReplaceTempView(<span class="hljs-string"><span class="hljs-string">"trainHead"</span></span>)</code> </pre> <br><p>  <strong>æ³¨æ„ï¼š</strong>å½“æ‚¨åªéœ€ç¼–å†™.showï¼ˆ5ï¼‰æ—¶ï¼Œå®é™…ä¸Šå¹¶ä¸éœ€è¦ä½¿ç”¨createOrReplaceTempViewã€‚ ä½†æ˜¯showæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå½“æ•°æ®ä¸ºâ€œå®½â€æ—¶ï¼Œæ¿çš„æ–‡æœ¬è¡¨ç¤ºå½¢å¼ä¸ºâ€œæµ®åŠ¨â€ï¼Œè€Œæ‰€æœ‰å†…å®¹éƒ½å˜å¾—ä¸æ¸…æ¥šã€‚ </p><br><p> è·å–æˆ‘ä»¬çš„æ•°æ®å¤§å°ï¼š <code>Train shape is: 891 x 12</code> <br> ç°åœ¨åœ¨sqlå•å…ƒæ ¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å‰5è¡Œï¼š </p><br><pre> <code class="sql hljs">%sql <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> trainHead</code> </pre> <br><p><img src="https://habrastorage.org/webt/qe/jc/wj/qejcwjvi65jp6xucnorcdfdmxo4.png"></p><br><p> å¥½å§ï¼Œè®©æˆ‘ä»¬åœ¨è¡¨ä¸ŠæŸ¥çœ‹â€œæ‘˜è¦â€ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SummarizeData</span></span>() .setBasic(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setCounts(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setPercentiles(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) .setSample(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setErrorThreshold(<span class="hljs-number"><span class="hljs-number">0.25</span></span>) .transform(train) .createOrReplaceTempView(<span class="hljs-string"><span class="hljs-string">"summary"</span></span>)</code> </pre> <br><p> ä¸ç®€å•çš„Dataset.describeç›¸æ¯”ï¼ŒSummarizeDataç±»å…·æœ‰å¤šä¸ªä¼˜ç‚¹ï¼Œå› ä¸ºå®ƒä½¿æ‚¨å¯ä»¥è®¡ç®—ç¼ºå¤±å€¼å’Œå”¯ä¸€å€¼çš„æ•°é‡ï¼Œè¿˜å¯ä»¥æŒ‡å®šè®¡ç®—åˆ†ä½æ•°çš„å‡†ç¡®æ€§ã€‚ è¿™å¯¹äºçœŸæ­£çš„å¤§æ•°æ®å¯èƒ½è‡³å…³é‡è¦ã€‚ <br><img src="https://habrastorage.org/webt/91/g4/8c/91g48c0oaqiuz8pjgklo38jaiis.png"></p><br><div class="spoiler">  <b class="spoiler_title">ä¸€äº›ä¸ªäººæƒ³æ³•</b> <div class="spoiler_text"><p> é€šå¸¸ï¼Œåœ¨æˆ‘ä¸ªäººçœ‹æ¥ï¼ŒPravdaMLä¸­çš„Odnoklassnikiå…·æœ‰æ›´å¥½çš„SummarizeDataæ¨¡æ‹Ÿå®ç°ã€‚ å¾®è½¯é‡‡ç”¨äº†ç®€å•çš„æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨<code>org.apache.spark.sql.functions</code> ï¼Œåªæ˜¯å°†æ‰€æœ‰å†…å®¹æ–¹ä¾¿åœ°åŒ…è£…åœ¨ä¸€ä¸ªç±»ä¸­ã€‚ å¯¹äºOdnoklassnikiï¼Œè¿™æ˜¯é€šè¿‡å…¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>VectorStatCollector</code></a>å®ç°çš„ï¼Œè°ƒç”¨æ—¶éœ€è¦ä¸€äº›æ›´å¤æ‚çš„ä»£ç ï¼ˆå¿…é¡»é¦–å…ˆå°†æ‰€æœ‰åŠŸèƒ½æ·»åŠ åˆ°å‘é‡ä¸­ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦å…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ï¼Œ <code>VectorAssembler</code>é€šå¸¸æ‹’ç»æ‘˜è¦<code>DecimalType</code> ï¼‰ã€‚ ä½†æ˜¯åŸºäºæˆ‘çš„Sparkç»éªŒï¼Œæˆ‘å‡è®¾æ¥è‡ªMMLSparkçš„SummarizeDataå¯èƒ½ä¼šå´©æºƒï¼Œå¹¶å‡ºç°è¯¸å¦‚<code>org.apache.spark.sql.catalyst</code> <code>StackOverflow</code>é”™è¯¯ï¼Œå¦‚æœ<strong>ç¡®å®å­˜åœ¨å¾ˆå¤š</strong>åˆ—ï¼Œå¹¶ä¸”è®¡ç®—å›¾åœ¨å¯åŠ¨æ—¶ä¼šå˜å¾—ä¸å°ï¼ˆå°½ç®¡ä¸“é—¨é’ˆå¯¹Spark 2.4ä¸­çš„â€œæé€Ÿâ€è¿™ç±»ç²‰ä¸ï¼Œä½†ä»–ä»¬å¢åŠ äº†ç¼©å‡<code>Catalyst</code>å›¾å½¢ä¼˜åŒ–å™¨çš„åŠŸèƒ½ã€‚ å¥½å§ï¼Œä¼¼ä¹åˆ—çš„æ•°é‡<strong>éå¸¸</strong>å¤šï¼ŒMicrosoftçš„ç‰ˆæœ¬ä¼šæ›´æ…¢ã€‚ ä½†è¿™å½“ç„¶å¿…é¡»å•ç‹¬æ£€æŸ¥ã€‚ </p></div></div><br><h2 id="ochistka-dannyh"> æ•°æ®æ¸…ç† </h2><br><p> åœ¨ã€Šæ³°å¦å°¼å…‹å·ã€‹ä¸­ï¼Œä¸€åˆ‡ç…§å¸¸-ä¸€ä¸²å­—ç¬¦ä¸²åˆ—ç¼ºå°‘å€¼ã€‚ ä»¥åŠæ•°æ®ä¸­çš„æŸç§å€¾æ–œï¼ˆä¼¼ä¹è¯¥æ•°æ®çš„ç‰¹å®šç‰ˆæœ¬ä¸æ˜¯å¾ˆç‰¹å®šï¼‰-ç¼ºå°‘å€¼èµ·25è¡Œã€‚ é¦–å…ˆï¼Œè§£å†³æ­¤é—®é¢˜ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> trainFiltered = train.filter(!(isnan(col(<span class="hljs-string"><span class="hljs-string">"Survived"</span></span>)) || isnull(col(<span class="hljs-string"><span class="hljs-string">"Survived"</span></span>))))</code> </pre> <br><h3 id="obrabotka-strokovyh-dannyh"> å­—ç¬¦ä¸²æ•°æ®å¤„ç† </h3><br><p> æ®æˆ‘æ‰€çŸ¥ï¼Œä»â€œ <code>Name</code>å’Œâ€œ <code>Cabin</code>å­—æ®µä¸­å¸¦å‡ºçš„å±æ€§æ˜¯æ³°å¦å°¼å…‹å·ä¸­æœ€å¥½çš„å±æ€§ã€‚ æ‚¨å¯ä»¥æä¾›å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯ä¸ºäº†é¿å…ç»™å‡ºå‡ ä¹ç›¸åŒçš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†è‡ªå·±é™åˆ¶ä¸ºå‡ ä¸ªã€‚ </p><br><p> é€šå¸¸ï¼Œå°†æ­£åˆ™è¡¨è¾¾å¼ç”¨äºæ­¤ç±»æƒ…å†µå¾ˆæ–¹ä¾¿ã€‚ <br> ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦ï¼š </p><br><ul><li> ä¸€åˆ‡éƒ½å·²åˆ†å‘ï¼Œæ•°æ®åœ¨åŸå¤„å¤„ç†ï¼› </li><li> ä¸€åˆ‡éƒ½è¢«è®¾è®¡ä¸ºSpakrML Transformeræˆ–Spark ML Estimatorç±»ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥åœ¨Pipelineä¸­è¿›è¡Œç»„è£…ã€‚ </li></ul><br><p>  <strong>æ³¨æ„ï¼š</strong>ç®¡é“é¦–å…ˆç¡®ä¿æˆ‘ä»¬å§‹ç»ˆå¯¹ç«è½¦å’Œæµ‹è¯•åº”ç”¨ç›¸åŒçš„å˜æ¢ï¼Œå¹¶ä¸”è¿˜å…è®¸æˆ‘ä»¬åœ¨äº¤å‰éªŒè¯ä¸­æ•è·â€œå±•æœ›æœªæ¥â€çš„é”™è¯¯ã€‚ è€Œä¸”ï¼Œå®ƒè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä½¿ç”¨ç®¡é“è¿›è¡Œä¿å­˜ï¼ŒåŠ è½½å’Œé¢„æµ‹çš„ç®€å•åŠŸèƒ½ã€‚ </p><br><p>  SparkMLå¯¹äºæ­¤ç±»ä»»åŠ¡æœ‰ä¸€ä¸ªâ€œå‡ ä¹é€šç”¨çš„â€ç±»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-SQLTranformer</a> ï¼Œä½†æ˜¯ç”¨SQLç¼–å†™æ˜¾ç„¶æ¯”ç”¨Scalaç¼–å†™æ›´ç³Ÿç³•ï¼Œè¿™ä»…æ˜¯å› ä¸ºèƒ½å¤Ÿåœ¨Ideaçš„ç¼–è¯‘å’Œè¯­æ³•çªå‡ºæ˜¾ç¤ºé˜¶æ®µæ•è·è¯­æ³•æˆ–å…¸å‹é”™è¯¯ã€‚  MMLSparkåœ¨è¿™é‡Œä¸ºæˆ‘ä»¬æä¾›äº†å¸®åŠ©ï¼Œåœ¨å…¶ä¸­å®ç°äº†çœŸæ­£é€šç”¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">UDFTransformer</a> ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.<span class="hljs-type"><span class="hljs-type">UDFTransformer</span></span></code> </pre> <br><p> é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºéå¸¸ç®€å•çš„è½¬æ¢å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨çš„ç›®æ ‡æ˜¯å±•ç¤ºåˆ›å»ºUDFTransformerçš„è¿‡ç¨‹ã€‚ åŸåˆ™ä¸Šï¼ŒåŸºäºè¿™æ ·çš„ç®€å•ç¤ºä¾‹ï¼Œä»»ä½•äººéƒ½å¯ä»¥å°†é€»è¾‘æ·»åŠ åˆ°ä»»ä½•çº§åˆ«çš„å¤æ‚æ€§ã€‚ </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> miss = <span class="hljs-string"><span class="hljs-string">".*miss\\..*"</span></span>.r <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mr = <span class="hljs-string"><span class="hljs-string">".*mr\\..*"</span></span>.r <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mrs = <span class="hljs-string"><span class="hljs-string">".*mrs\\..*"</span></span>.r <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> master = <span class="hljs-string"><span class="hljs-string">".*master.*"</span></span>.r <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertNames</span></span></span></span>(input: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-type"><span class="hljs-type">Option</span></span>(input).map(x =&gt; { x.toLowerCase <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> miss() =&gt; <span class="hljs-string"><span class="hljs-string">"Miss"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mr() =&gt; <span class="hljs-string"><span class="hljs-string">"Mr"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mrs() =&gt; <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> master() =&gt; <span class="hljs-string"><span class="hljs-string">"Master"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-string"><span class="hljs-string">"Unknown"</span></span> } }) }</code> </pre> <br><p>  ï¼ˆæ‚¨å¯ä»¥ç«‹å³çœ‹åˆ°Scalaå¤„ç†ç¼ºå°‘çš„å€¼æœ‰å¤šä¹ˆæ–¹ä¾¿ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™äº›<code>null</code>ä¸ä»…ä¸º<code>null</code> ï¼Œè€Œä¸”è¿˜ä¸º<code>Double.NaN</code> ï¼Œ <del> è¿™ä¹ˆå¼€ç©ç¬‘ </del> è¯¸å¦‚<code>BooleanType</code>å˜é‡ä¸­çš„é—æ¼ç­‰ç½•è§çš„äº‹æƒ…ï¼‰ </p><br><p> ç°åœ¨å£°æ˜æˆ‘ä»¬çš„<code>UserDefinedFunction</code>å¹¶ç«‹å³åŸºäºå®ƒåˆ›å»ºä¸€ä¸ª<code>Transformer</code> ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nameTransformUDF = udf(convertNames _) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nameTransformer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">UDFTransformer</span></span>() .setUDF(nameTransformUDF) .setInputCol(<span class="hljs-string"><span class="hljs-string">"Name"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"NameType"</span></span>)</code> </pre> <br><p>  <strong>æ³¨æ„ï¼š</strong>åœ¨Zeppelinç¬”è®°æœ¬ç”µè„‘ä¸­ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å½“æ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½åœ¨ç”Ÿäº§ä»£ç ä¸­æ”¾åˆ°ä¸€èµ·æ—¶ï¼Œé‡è¦çš„æ˜¯æ‰€æœ‰UDFéƒ½åœ¨<code>extends Serializable</code>ç±»æˆ–å¯¹è±¡ä¸­ã€‚ æ‚¨æœ‰æ—¶å¯èƒ½ä¼šå¿˜è®°ç„¶åå†æ·±å…¥ç ”ç©¶å¾ˆé•¿æ—¶é—´çš„æ˜¾è€Œæ˜“è§çš„äº‹æƒ…æ˜¯è¯»å–Sparké”™è¯¯çš„é•¿å †æ ˆè·Ÿè¸ªä¿¡æ¯å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚ </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬è¿˜æœ‰â€œ <code>Cabin</code>å­—æ®µã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ï¼š <br><img src="https://habrastorage.org/webt/1m/sn/n2/1msnn2zqeyerzpysj2ma3bwzuda.png"></p><br><p> æˆ‘ä»¬çœ‹åˆ°ç¼ºå°‘è®¸å¤šå€¼ï¼Œæœ‰å­—æ¯ï¼Œæ•°å­—ï¼Œä¸åŒçš„ç»„åˆç­‰ã€‚ è®©æˆ‘ä»¬ä»¥æœºèˆ±çš„æ•°é‡ï¼ˆå¦‚æœå¤šäºä¸€ä¸ªï¼‰ä»¥åŠæ•°é‡ä¸ºä¾‹-å®ƒä»¬å¯èƒ½å…·æœ‰æŸç§é€»è¾‘ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç¼–å·æ˜¯ä»èˆ¹çš„ä¸€ç«¯å¼€å§‹çš„ï¼Œé‚£ä¹ˆèˆ¹å¤´ä¸Šçš„æœºèˆ±çš„æœºä¼šå°±æ›´å°‘ã€‚ æˆ‘ä»¬è¿˜å°†åˆ›å»ºå‡½æ•°ï¼Œç„¶ååŸºäºå®ƒä»¬<code>UDFTransformer</code> ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCabinsCount</span></span></span></span>(input: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Int</span></span> = { <span class="hljs-type"><span class="hljs-type">Option</span></span>(input) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(x) =&gt; x.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>).length <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numPattern = <span class="hljs-string"><span class="hljs-string">"([az])([0-9]+)"</span></span>.r <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumbersFromCabin</span></span></span></span>(input: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Int</span></span> = { <span class="hljs-type"><span class="hljs-type">Option</span></span>(input) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Some</span></span>(x) =&gt; { x.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)(<span class="hljs-number"><span class="hljs-number">0</span></span>).toLowerCase <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> numPattern(sym, num) =&gt; <span class="hljs-type"><span class="hljs-type">Integer</span></span>.parseInt(num) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">-2</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cabinsCountUDF = udf(getCabinsCount _) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numbersFromCabinUDF = udf(getNumbersFromCabin _) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cabinsCountTransformer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">UDFTransformer</span></span>() .setInputCol(<span class="hljs-string"><span class="hljs-string">"Cabin"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"CabinCount"</span></span>) .setUDF(cabinsCountUDF) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numbersFromCabinTransformer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">UDFTransformer</span></span>() .setInputCol(<span class="hljs-string"><span class="hljs-string">"Cabin"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"CabinNumber"</span></span>) .setUDF(numbersFromCabinUDF)</code> </pre> <br><p> ç°åœ¨è®©æˆ‘ä»¬ä»ç¼ºå¤±çš„å€¼å¼€å§‹ï¼Œå³å¹´é¾„ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ©ç”¨Zeppelinçš„å¯è§†åŒ–åŠŸèƒ½ï¼š </p><br><p><img src="https://habrastorage.org/webt/h-/cj/l6/h-cjl6tzbakgmqxc1w-gt_kgwk0.png"></p><br><p> å¹¶æŸ¥çœ‹ç¼ºå¤±å€¼å¦‚ä½•ç ´åä¸€åˆ‡ã€‚ ç”¨ä¸­ä½æ•°ï¼ˆæˆ–ä¸­ä½æ•°ï¼‰æ›¿æ¢å®ƒä»¬æ˜¯åˆä¹é€»è¾‘çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è€ƒè™‘MMLSparkåº“çš„æ‰€æœ‰åŠŸèƒ½ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†ç¼–å†™è‡ªå·±çš„<code>Estimator</code> ï¼Œå®ƒå°†è€ƒè™‘è®­ç»ƒæ ·æœ¬ä¸Šçš„ç»„/å¹³å‡å€¼å¹¶å°†å…¶æ›¿æ¢ä¸ºç›¸åº”çš„å·®è·ã€‚ </p><br><p> æˆ‘ä»¬å°†éœ€è¦ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.sql.{<span class="hljs-type"><span class="hljs-type">Dataset</span></span>, <span class="hljs-type"><span class="hljs-type">DataFrame</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.{<span class="hljs-type"><span class="hljs-type">Estimator</span></span>, <span class="hljs-type"><span class="hljs-type">Model</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.param.{<span class="hljs-type"><span class="hljs-type">Param</span></span>, <span class="hljs-type"><span class="hljs-type">ParamMap</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.util.<span class="hljs-type"><span class="hljs-type">Identifiable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.util.<span class="hljs-type"><span class="hljs-type">DefaultParamsWritable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.{<span class="hljs-type"><span class="hljs-type">HasInputCol</span></span>, <span class="hljs-type"><span class="hljs-type">HasOutputCol</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.<span class="hljs-type"><span class="hljs-type">ConstructorWritable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.<span class="hljs-type"><span class="hljs-type">ConstructorReadable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.<span class="hljs-type"><span class="hljs-type">Wrappable</span></span></code> </pre> <br><p> è®©æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>ConstructorWritable</code></a> ï¼Œå®ƒå¤§å¤§ç®€åŒ–äº†ç”Ÿæ´»ã€‚ å¦‚æœæˆ‘ä»¬çš„<code>Model</code>æ˜¯<code>fit(),</code>æ–¹æ³•è¿”å›çš„â€œå—è¿‡è®­ç»ƒâ€çš„æ¨¡å‹ï¼Œè€Œè¯¥æ¨¡å‹å®Œå…¨ç”±å…¶æ„é€ å‡½æ•°ç¡®å®šï¼ˆè¿™å¯èƒ½æ˜¯99ï¼…çš„æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ¹æœ¬æ— æ³•ç”¨æ‰‹ç¼–å†™åºåˆ—åŒ–ã€‚ è¿™ç¡®å®å¤§å¤§ç®€åŒ–å¹¶åŠ å¿«äº†å¼€å‘é€Ÿåº¦ï¼Œæ¶ˆé™¤äº†é”™è¯¯ï¼Œå¹¶é™ä½äº†é€šå¸¸ä¸æ˜¯ä¸“ä¸šç¨‹åºå‘˜çš„DataScientistå’Œåˆ†æå¸ˆçš„å…¥é—¨é—¨æ§›ã€‚ </p><br><p> å®šä¹‰æˆ‘ä»¬çš„<code>Estimator</code>ç±»ã€‚ å®é™…ä¸Šï¼Œè¿™é‡Œæœ€é‡è¦çš„æ˜¯<code>fit</code>æ–¹æ³•ï¼Œå…¶ä½™æ˜¯æŠ€æœ¯è¦ç‚¹ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroupImputerEstimator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">override val uid: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Estimator</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GroupImputerModel</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasInputCol</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasOutputCol</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wrappable</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultParamsWritable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(<span class="hljs-type"><span class="hljs-type">Identifiable</span></span>.randomUID(<span class="hljs-string"><span class="hljs-string">"GroupImputer"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> groupCol: <span class="hljs-type"><span class="hljs-type">Param</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Param</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"groupCol"</span></span>, <span class="hljs-string"><span class="hljs-string">"Groupping column"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGroupCol</span></span></span></span>(v: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.set(groupCol, v) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGroupCol</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = $(groupCol) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fit</span></span></span></span>(dataset: <span class="hljs-type"><span class="hljs-type">Dataset</span></span>[_]): <span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> meanDF = dataset .toDF .groupBy($(groupCol)) .agg(mean(col($(inputCol))).alias(<span class="hljs-string"><span class="hljs-string">"groupMean"</span></span>)) .select(col($(groupCol)), col(<span class="hljs-string"><span class="hljs-string">"groupMean"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span>( uid, meanDF, getInputCol, getOutputCol, getGroupCol ) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transformSchema</span></span></span></span>(schema: <span class="hljs-type"><span class="hljs-type">StructType</span></span>): <span class="hljs-type"><span class="hljs-type">StructType</span></span> = schema .add( <span class="hljs-type"><span class="hljs-type">StructField</span></span>( $(outputCol), schema.filter(x =&gt; x.name == $(inputCol))(<span class="hljs-number"><span class="hljs-number">0</span></span>).dataType ) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span></span>(extra: <span class="hljs-type"><span class="hljs-type">ParamMap</span></span>): <span class="hljs-type"><span class="hljs-type">Estimator</span></span>[<span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> to = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">GroupImputerEstimator</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.uid) copyValues(to, extra).asInstanceOf[<span class="hljs-type"><span class="hljs-type">GroupImputerEstimator</span></span>] } }</code> </pre> <br><p>  <strong>æ³¨æ„ï¼š</strong>æˆ‘æ²¡æœ‰ä½¿ç”¨defaultCopyï¼Œå› ä¸ºç”±äºæŸç§åŸå› ï¼Œå½“æˆ‘è°ƒç”¨å®ƒæ—¶ï¼Œå®ƒå‘èª“æˆ‘æ²¡æœ‰æ„é€ å‡½æ•°\ &lt;init&gt;ï¼ˆjava.lang.Stringï¼‰ï¼Œå°½ç®¡è¿™ä¼¼ä¹ä¸åº”è¯¥å‘ç”Ÿã€‚ å¥½å§ï¼Œæ— è®ºå¦‚ä½•ï¼Œå®ç°<code>copy</code>å®¹æ˜“ã€‚ </p><br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦å®ç°<code>Model</code>ä¸€ä¸ªæè¿°ç»è¿‡è®­ç»ƒçš„æ¨¡å‹å¹¶å®ç°<code>transform</code>æ–¹æ³•çš„ç±»ã€‚ æˆ‘ä»¬å°†åŸºäº<code>org.apache.spark.sql.functions</code>å†…ç½®çš„<code>coalesce</code>å‡½æ•°æ¥æ„å»ºå®ƒï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroupImputerModel</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> val uid: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val meanDF: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DataFrame</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val inputCol: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val outputCol: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val groupCol: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GroupImputerModel</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstructorWritable</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GroupImputerModel</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ttag: <span class="hljs-type"><span class="hljs-type">TypeTag</span></span>[<span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span>] = typeTag[<span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">objectsToSave</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">Any</span></span>] = <span class="hljs-type"><span class="hljs-type">List</span></span>(uid, meanDF, inputCol, outputCol, groupCol) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span></span>(extra: <span class="hljs-type"><span class="hljs-type">ParamMap</span></span>): <span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">GroupImputerModel</span></span>(uid, meanDF, inputCol, outputCol, groupCol) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transform</span></span></span></span>(dataset: <span class="hljs-type"><span class="hljs-type">Dataset</span></span>[_]): <span class="hljs-type"><span class="hljs-type">DataFrame</span></span> = { dataset .toDF .join(meanDF, <span class="hljs-type"><span class="hljs-type">Seq</span></span>(groupCol), <span class="hljs-string"><span class="hljs-string">"left"</span></span>) .withColumn( outputCol, coalesce(col(inputCol), col(<span class="hljs-string"><span class="hljs-string">"groupMean"</span></span>)) .cast(<span class="hljs-type"><span class="hljs-type">IntegerType</span></span>)) .drop(<span class="hljs-string"><span class="hljs-string">"groupMean"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transformSchema</span></span></span><span class="hljs-function"> </span></span>(schema: <span class="hljs-type"><span class="hljs-type">StructType</span></span>): <span class="hljs-type"><span class="hljs-type">StructType</span></span> = schema .add( <span class="hljs-type"><span class="hljs-type">StructField</span></span>(outputCol, schema.filter(x =&gt; x.name == inputCol)(<span class="hljs-number"><span class="hljs-number">0</span></span>).dataType) ) }</code> </pre> <br><p> æˆ‘ä»¬éœ€è¦å£°æ˜çš„æœ€åä¸€ä¸ªå¯¹è±¡æ˜¯<code>Reader</code> ï¼Œæˆ‘ä»¬ä½¿ç”¨MMLSpark <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ConstructorReadable</a>ç±»å®ç°äº†è¯¥å¯¹è±¡ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroupImputerModel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstructorReadable</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GroupImputerModel</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><h2 id="sozdanie-pipeline"> ç®¡é“åˆ›å»º </h2><br><p> åœ¨Pipelineä¸­ï¼Œæˆ‘æƒ³å±•ç¤ºå¸¸ç”¨çš„SparkMLç±»å’ŒMMLSpark- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MultiColumnAdapterä¸­</a>éå¸¸æ–¹ä¾¿çš„ä¸œè¥¿ï¼Œå®ƒä½¿æ‚¨å¯ä»¥å°†SparkMLè½¬æ¢å™¨ä¸€æ¬¡åº”ç”¨äºå¤šä¸ªåˆ—ï¼ˆä¾‹å¦‚ï¼Œä½œä¸ºå‚è€ƒï¼ŒStringIndexerå’ŒOneHotEncoderä¼šå°†è¾“å…¥ä»…åŒ…å«ä¸€åˆ—ï¼Œä»è€Œå°†å®ƒä»¬å˜æˆè¾“å…¥å¹¿å‘Šé™·å…¥å›°å¢ƒï¼‰ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.feature.{<span class="hljs-type"><span class="hljs-type">StringIndexer</span></span>, <span class="hljs-type"><span class="hljs-type">VectorAssembler</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.<span class="hljs-type"><span class="hljs-type">Pipeline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.{<span class="hljs-type"><span class="hljs-type">MultiColumnAdapter</span></span>, <span class="hljs-type"><span class="hljs-type">LightGBMClassifier</span></span>}</code> </pre> <br><p> é¦–å…ˆï¼Œæˆ‘ä»¬å°†å£°æ˜æˆ‘ä»¬æ‹¥æœ‰å“ªäº›åˆ—ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> catCols = <span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"Sex"</span></span>, <span class="hljs-string"><span class="hljs-string">"Embarked"</span></span>, <span class="hljs-string"><span class="hljs-string">"NameType"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numCols = <span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"PClass"</span></span>, <span class="hljs-string"><span class="hljs-string">"AgeNoMissings"</span></span>, <span class="hljs-string"><span class="hljs-string">"SibSp"</span></span>, <span class="hljs-string"><span class="hljs-string">"Parch"</span></span>, <span class="hljs-string"><span class="hljs-string">"CabinCount"</span></span>, <span class="hljs-string"><span class="hljs-string">"CabinNumber"</span></span>)</code> </pre> <br><p> ç°åœ¨åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ç¼–ç å™¨ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stringEncoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MultiColumnAdapter</span></span>() .setBaseStage(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">StringIndexer</span></span>().setHandleInvalid(<span class="hljs-string"><span class="hljs-string">"keep"</span></span>)) .setInputCols(catCols) .setOutputCols(catCols.map(x =&gt; x + <span class="hljs-string"><span class="hljs-string">"_freqEncoded"</span></span>))</code> </pre> <br><p>  <strong>æ³¨æ„ï¼š</strong>ä¸SparkMLä¸­çš„scikit-learnä¸åŒï¼Œ <code>StringIndexer</code>éµå¾ªé¢‘ç‡ç¼–ç å™¨çš„åŸç†ï¼Œå¯ç”¨äºæŒ‡å®šé¡ºåºå…³ç³»ï¼ˆå³ï¼Œç±»åˆ«0 &lt;ç±»åˆ«1ï¼Œè¿™å¾ˆæœ‰æ„ä¹‰ï¼‰-è¿™ç§æ–¹æ³•é€šå¸¸é€‚ç”¨äºå†³å®šæ€§çš„æ ‘æœ¨ã€‚ </p><br><p>  <code>Imputer</code>æˆ‘ä»¬çš„<code>Imputer</code> ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> missingImputer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">GroupImputerEstimator</span></span>() .setInputCol(<span class="hljs-string"><span class="hljs-string">"Age"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"AgeNoMissings"</span></span>) .setGroupCol(<span class="hljs-string"><span class="hljs-string">"Sex"</span></span>)</code> </pre> <br><p> è¿˜æœ‰<code>VectorAssembler</code> ï¼Œå› ä¸ºSparkMLåˆ†ç±»å™¨æ›´é€‚åˆä½¿ç”¨<code>VectorType</code> ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> assembler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">VectorAssembler</span></span>() .setInputCols(stringEncoder.getOutputCols ++ numCols) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>)</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨MMLSpark-LightGBMéšé™„çš„æ¢¯åº¦æå‡ï¼Œå®ƒä¸XGBoostå’ŒCatBoostä¸€èµ·åŒ…å«åœ¨è¯¥ç®—æ³•çš„æœ€ä½³å®ç°çš„â€œä¸‰å·¨å¤´â€ä¸­ã€‚ ä¸SparkMLæ‹¥æœ‰çš„GBMå®ç°ç›¸æ¯”ï¼Œå®ƒçš„å·¥ä½œé€Ÿåº¦æ›´å¿«ï¼Œæ›´å¥½ï¼Œæ›´ç¨³å®šï¼ˆå³ä½¿è€ƒè™‘åˆ°JVMç«¯å£ä»å¤„äºæ´»åŠ¨å¼€å‘ä¸­ï¼‰ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> catColIndices = <span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lgbClf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">LightGBMClassifier</span></span>() .setFeaturesCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>) .setLabelCol(<span class="hljs-string"><span class="hljs-string">"Survived"</span></span>) .setProbabilityCol(<span class="hljs-string"><span class="hljs-string">"predictedProb"</span></span>) .setPredictionCol(<span class="hljs-string"><span class="hljs-string">"predictedLabel"</span></span>) .setRawPredictionCol(<span class="hljs-string"><span class="hljs-string">"rawPrediction"</span></span>) .setIsUnbalance(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setCategoricalSlotIndexes(catColIndices) .setObjective(<span class="hljs-string"><span class="hljs-string">"binary"</span></span>)</code> </pre> <br><p>  <strong>æ³¨æ„ï¼š</strong> LightGBMæ”¯æŒä½¿ç”¨åˆ†ç±»å˜é‡ï¼ˆå‡ ä¹ç±»ä¼¼äºcatboostï¼‰ï¼Œå› æ­¤æˆ‘ä»¬æå‰å‘å…¶æŒ‡å‡ºäº†ç±»åˆ«å±æ€§åœ¨å‘é‡ä¸­çš„ä½ç½®ï¼Œä»–æœ¬äººå°†å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨å®ƒä»¬ä»¥åŠå¦‚ä½•å¯¹å…¶è¿›è¡Œç¼–ç ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æœ‰å…³Sparkçš„LightGBMåŠŸèƒ½çš„æ›´å¤šä¿¡æ¯</b> <div class="spoiler_text"><ul><li> åœ¨è¿è¡ŒRadHat LightGBMçš„èŠ‚ç‚¹ä¸Šï¼Œé™¤æœ€æ–°ç‰ˆæœ¬å¤–ï¼Œä»»ä½•ç‰ˆæœ¬éƒ½ä¼šå´©æºƒï¼ŒåŸå› æ˜¯ä»–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸å–œæ¬¢</a> <code>glibc</code>ç‰ˆæœ¬ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ€è¿‘</a>å·²ä¿®å¤æ­¤é—®é¢˜ï¼Œä½†æ˜¯ï¼Œé€šè¿‡Mavenå®‰è£…æ—¶ï¼ŒMMLSparké€šè¿‡Mavenå®‰è£…æ—¶ä¼šæ‹‰å€’æ•°ç¬¬äºŒä¸ªç‰ˆæœ¬çš„LightGBMï¼Œå› æ­¤æ‚¨éœ€è¦æ‰‹åŠ¨æ·»åŠ RadHatä¸Šæœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–é¡¹ã€‚ </li><li>  LightGBMåœ¨å…¶å·¥ä½œä¸­åœ¨é©±åŠ¨ç¨‹åºä¸Šåˆ›å»ºäº†ä¸€ä¸ªå¥—æ¥å­—ä»¥ä¸æ‰§è¡Œäººå‘˜è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å®ƒä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>new java.net.ServerSocket(0)</code></a> ï¼Œå› æ­¤ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿçš„ä¸´æ—¶ç«¯å£ä¸­çš„éšæœºç«¯å£ã€‚ å¦‚æœä¸´æ—¶ç«¯å£çš„èŒƒå›´ä¸é˜²ç«å¢™æ‰“å¼€çš„ç«¯å£çš„èŒƒå›´ä¸åŒï¼Œåˆ™ <del> ä¼šç‡ƒçƒ§å¾ˆå¤š </del> å½“LightGBMæœ‰æ—¶ä¼šå·¥ä½œï¼ˆå½“æˆ‘é€‰æ‹©ä¸€ä¸ªå¥½çš„ç«¯å£æ—¶ï¼‰ï¼Œæœ‰æ—¶å´æ— æ³•å·¥ä½œï¼Œæ‚¨ä¼šå¾—åˆ°ä¸€ä¸ªæœ‰è¶£çš„æ•ˆæœã€‚ å¹¶ä¸”é‚£é‡Œä¼šå‡ºç°è¯¸å¦‚<code>ConnectionTimeOut</code>ç±»çš„é”™è¯¯ï¼Œä¾‹å¦‚ï¼Œå®ƒä¹Ÿå¯èƒ½è¡¨æ˜GCæŒ‚åœ¨é«˜ç®¡èº«ä¸Šæ—¶çš„é€‰æ‹©æˆ–ç±»ä¼¼çš„é€‰é¡¹ã€‚ é€šå¸¸ï¼Œä¸è¦é‡å¤æˆ‘çš„é”™è¯¯ã€‚ </li></ul></div></div><br><p> å¥½å§ï¼Œæœ€åï¼Œå£°æ˜æˆ‘ä»¬çš„ç®¡é“ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pipeline = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>() .setStages( <span class="hljs-type"><span class="hljs-type">Array</span></span>( missingImputer, nameTransformer, cabinsCountTransformer, numbersFromCabinTransformer, stringEncoder, assembler, lgbClf ) )</code> </pre> <br><h2 id="obuchenie"> åŸ¹è®­è¯¾ç¨‹ </h2><br><p> æˆ‘ä»¬å°†è®­ç»ƒé›†åˆ†ä¸ºç«è½¦å’Œæµ‹è¯•ï¼Œå¹¶æ£€æŸ¥æˆ‘ä»¬çš„ç®¡é“ã€‚ åœ¨è¿™é‡Œï¼Œæœ‰å¯èƒ½è¯„ä¼°ç®¡é“çš„ä¾¿åˆ©æ€§ï¼Œå› ä¸ºå®ƒå®Œå…¨ç‹¬ç«‹äºåˆ†åŒºï¼Œå¹¶ä¿è¯æˆ‘ä»¬å°†åº”ç”¨ç›¸åŒçš„è½¬æ¢è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ï¼Œå¹¶ä¸”æ‰€æœ‰è½¬æ¢å‚æ•°éƒ½å°†åœ¨è®­ç»ƒä¸­â€œå­¦ä¹ â€ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">Array</span></span>(trainDF, testDF) = trainFiltered.randomSplit(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>)) println(<span class="hljs-string"><span class="hljs-string">s"Train rows: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${trainDF.count}</span></span></span><span class="hljs-string">\nTest rows: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${testDF.count}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Train rows: 708 // Test rows: 158 val predictions = pipeline .fit(trainDF) .transform(testDF)</span></span></code> </pre> <br><p> ä¸ºäº†æ–¹ä¾¿è®¡ç®—æŒ‡æ ‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨MMLSpark- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ComputeModelStatisticsä¸­çš„</a>å¦ä¸€ä¸ªç±»ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.<span class="hljs-type"><span class="hljs-type">ComputeModelStatistics</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.microsoft.ml.spark.metrics.<span class="hljs-type"><span class="hljs-type">MetricConstants</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modelEvaluator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ComputeModelStatistics</span></span>() .setLabelCol(<span class="hljs-string"><span class="hljs-string">"Survived"</span></span>) .setScoresCol(<span class="hljs-string"><span class="hljs-string">"predictedProb"</span></span>) .setScoredLabelsCol(<span class="hljs-string"><span class="hljs-string">"predictedLabel"</span></span>) .setEvaluationMetric(<span class="hljs-type"><span class="hljs-type">MetricConstants</span></span>.<span class="hljs-type"><span class="hljs-type">ClassificationMetrics</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/we/rc/ba/wercbac58qpt0hsygugtqqkhc3u.png"></p><br><p> ä¸é”™ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ›´æ”¹é»˜è®¤è®¾ç½®ã€‚ </p><br><h2 id="podbor-giperparametrov"> é€‰æ‹©è¶…å‚æ•° </h2><br><p> è¦åœ¨MMLSparkä¸­é€‰æ‹©è¶…å‚æ•°ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„å¾ˆé…·çš„ä¸œè¥¿<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>TuneHyperparameters</code></a> ï¼Œå®ƒåœ¨ç½‘æ ¼ä¸Šå®ç°äº†éšæœºæœç´¢ã€‚ ä½†æ˜¯ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå®ƒè¿˜ä¸æ”¯æŒ<code>Pipeline</code> ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨å¸¸è§„çš„SparkML <code>CrossValidator</code> ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.tuning.{<span class="hljs-type"><span class="hljs-type">ParamGridBuilder</span></span>, <span class="hljs-type"><span class="hljs-type">CrossValidator</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.ml.evaluation.<span class="hljs-type"><span class="hljs-type">BinaryClassificationEvaluator</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paramSpace = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ParamGridBuilder</span></span>() .addGrid(lgbClf.maxDepth, <span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) .addGrid(lgbClf.learningRate, <span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-number"><span class="hljs-number">0.05</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>)) .addGrid(lgbClf.numIterations, <span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>)) .build println(<span class="hljs-string"><span class="hljs-string">s"Size of ParamsGrid: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${paramSpace.size}</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Size of ParamsGrid: 8 val crossValidator = new CrossValidator() .setEstimator(pipeline) .setEstimatorParamMaps(paramSpace) .setNumFolds(3) .setSeed(42L) .setEvaluator( new BinaryClassificationEvaluator() .setMetricName("areaUnderROC") .setLabelCol("Survived") .setRawPredictionCol("rawPrediction") ) val bestModel = crossValidator .fit(trainFiltered)</span></span></code> </pre> <br><p> ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥æŸ¥çœ‹ç»“æœä»¥åŠè·å¾—ç»“æœçš„å‚æ•°ã€‚ å› æ­¤ï¼Œæœ‰å¿…è¦ä½¿ç”¨â€œæ€ªå¼‚â€çš„è®¾è®¡ï¼š </p><br><pre> <code class="scala hljs">crossValidator .getEstimatorParamMaps .zip(bestModel.avgMetrics) .foreach(x =&gt; { println( <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + x._1 .toSeq .foldLeft(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">StringBuilder</span></span>())( (a, b) =&gt; a .append(<span class="hljs-string"><span class="hljs-string">s"\n\t</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b.param.name}</span></span></span><span class="hljs-string"> : </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${b.value}</span></span></span><span class="hljs-string">"</span></span>)) .toString + <span class="hljs-string"><span class="hljs-string">s"\n\tMetric: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${x._2}</span></span></span><span class="hljs-string">"</span></span> ) })</code> </pre> <br><p> è¿™ç»™äº†æˆ‘ä»¬è¿™æ ·çš„ä¸œè¥¿ï¼š <br><img src="https://habrastorage.org/webt/xl/li/o7/xllio7tbr67gq_wqolrqwzkzswu.png"></p><br><p> é€šè¿‡é™ä½å­¦ä¹ é€Ÿåº¦å’Œå¢åŠ æ ‘æœ¨çš„æ·±åº¦ï¼Œæˆ‘ä»¬è·å¾—äº†æœ€ä½³ç»“æœã€‚ åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæœ‰å¯èƒ½è°ƒæ•´æœç´¢ç©ºé—´å¹¶è·å¾—æ›´å¥½çš„ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰è¿™æ ·çš„ç›®æ ‡ã€‚ </p><br><h2 id="zaklyuchenie"> ç»“è®º </h2><br><p> å®é™…ä¸Šï¼Œè™½ç„¶MMLSparkå…·æœ‰0.17ç‰ˆï¼Œä½†ä»åŒ…å«å•ç‹¬çš„é”™è¯¯ã€‚ ä½†æ˜¯åœ¨æˆ‘çœ‹åˆ°çš„æ‰€æœ‰Sparkæ‰©å±•ä¸­ï¼Œæˆ‘è®¤ä¸ºMMLSparkæ‹¥æœ‰æœ€å…¨é¢çš„æ–‡æ¡£ä»¥åŠæœ€æ˜“äºç†è§£çš„å®‰è£…å’Œå®æ–½è¿‡ç¨‹ã€‚ å¾®è½¯è¿˜æ²¡æœ‰çœŸæ­£æ¨å¹¿å®ƒï¼Œåªæœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³äºDatabricks</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŠ¥å‘Š</a> ï¼Œä½†æ˜¯æ›´å¤šçš„æ˜¯å…³äºDeepLearningçš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æˆ‘å†™çš„è¿™äº›å¸¸è§„ä¿¡æ¯ã€‚ </p><br><p> å°±ä¸ªäººè€Œè¨€ï¼Œåœ¨æˆ‘ä»¬çš„ä»»åŠ¡ä¸­ï¼Œè¯¥åº“å‘æŒ¥äº†å¾ˆå¤§ä½œç”¨ï¼Œä½¿æˆ‘å¯ä»¥ä»Sparkèµ„æºçš„ä¸›æ—ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨åå°„æ¥è®¿é—®ç§æœ‰[ml]æ–¹æ³•ï¼Œè€Œæˆ‘çš„ä¸€ä½åŒäº‹å‡ ä¹å¶ç„¶åœ°å‘ç°äº†è¯¥åº“ã€‚ åŒæ—¶ï¼Œç”±äºè¯¥åº“æ­£åœ¨ç§¯æå¼€å‘ä¸­ï¼Œå› æ­¤æºæ–‡ä»¶ç»“æ„ <del> ç¨€é¥­ </del> æœ‰ç‚¹æ··ä¹±ã€‚ å¥½å§ï¼Œç”±äºæ²¡æœ‰ç‰¹æ®Šçš„ç¤ºä¾‹æˆ–å…¶ä»–æ–‡æ¡£ï¼ˆä»…ç©ºçš„scaladocé™¤å¤–ï¼‰ï¼Œå› æ­¤æˆ‘ä¸€å¼€å§‹å¿…é¡»ä¸€ç›´çˆ¬åˆ°æºä»£ç ä¸­ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘çœŸçš„å¸Œæœ›è¿™ä¸ªè¿·ä½ æ•™ç¨‹ï¼ˆå°½ç®¡å®ƒéå¸¸æ˜æ˜¾å’Œç®€å•ï¼‰å¯¹æŸäººæœ‰ç”¨ï¼Œå¹¶ä¸”å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›ï¼ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN456668/">https://habr.com/ru/post/zh-CN456668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN456656/index.html">SDL 2è¯¾ï¼šç¬¬4è¯¾-æ‹‰ä¼¸PNG</a></li>
<li><a href="../zh-CN456658/index.html">æˆé•¿ï¼šæˆ‘ä»¬å¦‚ä½•è¯„ä¼°å›¢é˜ŸæŠ€èƒ½</a></li>
<li><a href="../zh-CN456662/index.html">å¦‚ä½•ä½¿ç”¨æµ‹è¯•é©±åŠ¨çš„å¼€å‘ä¸ºæ²»ç–—å¸ˆçœé’±</a></li>
<li><a href="../zh-CN456664/index.html">æœºå™¨äººèµ”é’±æ—¶è¯¥å‘è°èµ·è¯‰</a></li>
<li><a href="../zh-CN456666/index.html">Webå›¾è…¾æˆ–æˆ‘ä»¬å¦‚ä½•ä½¿äº’è”ç½‘æ›´å®‰å…¨</a></li>
<li><a href="../zh-CN456670/index.html">å…³äºéå¸¸é—´è°èº«ä»½éªŒè¯æ–¹æ³•</a></li>
<li><a href="../zh-CN456672/index.html">Nginxé…æ–¹ï¼šä»PostgreSQLåˆ°websocketçš„å¼‚æ­¥é€šçŸ¥</a></li>
<li><a href="../zh-CN456674/index.html">æ‚¨ä¸çŸ¥é“çš„åœ¨Facebookä¸Šæ¨å¹¿çš„æ–°æœºä¼š</a></li>
<li><a href="../zh-CN456676/index.html">ç™»å½•åˆ†å¸ƒå¼phpåº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN456678/index.html">æœªæ¥çš„ç”µå­çŠ¶æ€ã€‚ ç¬¬4éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>