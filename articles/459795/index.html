<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìá ‚õé ‚õëÔ∏è Bitrix y actualice MariaDB a la √∫ltima versi√≥n estable ü•ô üå•Ô∏è üå≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buen d√≠a, queridos Khabrovchianos! D√©jame presentarme, Alexander. Administrador del sistema de un peque√±o pero orgulloso estudio WEB. Realmente querem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bitrix y actualice MariaDB a la √∫ltima versi√≥n estable</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459795/">  Buen d√≠a, queridos Khabrovchianos!  D√©jame presentarme, Alexander.  Administrador del sistema de un peque√±o pero orgulloso estudio WEB.  Realmente queremos que todo funcione de manera r√°pida, segura y con software nuevo.  Para hacer esto, incluso levantaron un mont√≥n de nagios + PhantomJS en la computadora de la oficina y verificaron la velocidad de carga de la p√°gina cada 30 minutos.  De acuerdo con los t√©rminos del servicio, tambi√©n seguimos las actualizaciones de 1C-Bitrix y las instalamos regularmente.  Y una vez, despu√©s de la pr√≥xima actualizaci√≥n, vemos un mensaje en el panel de administraci√≥n que indica que en el verano de 2019 1C-Bitrix deja de funcionar con MySQL 5.5 y debe actualizarse.  Los chicos de ISPSystem son guapos y regularmente ampl√≠an la funcionalidad del panel, por lo que les agradecemos especialmente.  Pero esta vez no fue posible hacer clic en todo el mouse.  Pero lo que sucedi√≥ y la cantidad de canas que hay ahora en mi barba se puede encontrar debajo del corte. <br><a name="habracut"></a><br>  Solo hab√≠a una opci√≥n para poner un "servidor DBMS alternativo" que se coloca en el contenedor Docker.  Por supuesto, entiendo que Docker es muy eficiente en el uso de los recursos, pero no importa lo bueno que funcione, la sobrecarga seguir√° siendo&gt; 0.  Y aqu√≠ estamos luchando, por as√≠ decirlo, en d√©cimas de segundo, y en la entrada optimizamos todos los sitios antes de publicar y firmar un contrato.  Entonces esta no es mi opci√≥n. <br>  Ok, ¬øqu√© est√° escrito en la documentaci√≥n?  Copia de seguridad total, agregue un archivo con un enlace al repositorio MariaDB en yum.repos.d, luego <br><br><pre><code class="bash hljs">rpm -e --nodeps MariaDB-server MariaDB-client MariaDB-common</code> </pre> <br>  Yum maldecir√° m√°s tarde que alguien elimin√≥ / instal√≥ paquetes sin su conocimiento.  Pero primero, d√©jalo jurar, est√° bien.  Y en segundo lugar, si eliminas a trav√©s de yum, √©l intenta demoler, junto con MariaDB, todo lo que est√° relacionado con √©l, y esto es PHP e ISPManager y PHPmyadmin.  Por lo tanto, trataremos con garabatos. <br><br><pre> <code class="bash hljs">yum clean all yum update yum install MariaDB-server MariaDB-client MariaDB-common</code> </pre> <br>  En general, todo estaba configurado y terminado.  Lo bueno es que las bases fueron recogidas y no hubo necesidad de restaurarlas de los vertederos.  Revis√© los sitios, funcionan y r√°pidamente.  Entr√© en un par de p√°ginas de administraci√≥n para asegurarme de que nada se cayera y le escrib√≠ al director que todo estaba bien.  En menos de 30 minutos result√≥ que no est√° del todo bien ... <br><br>  Al intentar ir al panel de administraci√≥n y agregar / editar cualquier cosa, se cay√≥ un mensaje en el contenido <br><br><pre> <code class="sql hljs">MySQL Query Error: <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> b_iblock_element_property (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, IBLOCK_ELEMENT_ID, IBLOCK_PROPERTY_ID, VAL UE, VALUE_NUM) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">10555</span></span> ,<span class="hljs-number"><span class="hljs-number">2201</span></span> ,P.ID ,<span class="hljs-string"><span class="hljs-string">'3607'</span></span> ,<span class="hljs-number"><span class="hljs-number">3607.0000</span></span> FR OM b_iblock_property P <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> = <span class="hljs-number"><span class="hljs-number">184</span></span> [[<span class="hljs-number"><span class="hljs-number">1062</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">Duplicate</span></span> entry <span class="hljs-string"><span class="hljs-string">'10555'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> <span class="hljs-string"><span class="hljs-string">'PRIMARY'</span></span>]</code> </pre> <br>  Como nuestros empleados est√°n agregando contenido al sitio, los clientes a√∫n no sab√≠an nada y a√∫n no hab√≠an comenzado a separarnos.  Pero era cuesti√≥n de tiempo porque la informaci√≥n en los sitios necesita ser actualizada y esto es lo que muchos clientes siguen y de cerca. <br><br>  Del texto de error, podemos concluir que Bitrix est√° tratando de agregar un nuevo registro a la base de datos mientras indica la misma clave primaria que ten√≠a el art√≠culo editado.  Por lo tanto, hay razones para sospechar que el problema surge del lado de Bitrix.  Vamos a su sitio web y recurrimos a soporte.  Casi de inmediato recibimos la respuesta "un problema dif√≠cil.  Se lo di a ingenieros superiores: espera ... " <br><br>  Tuvimos que esperar mucho tiempo (todo el di√°logo tuvo lugar del 25/06/2019 al 09/07/2019) y el resultado fue el mensaje "este problema no est√° relacionado con el trabajo de Bitrix CMS, sino con la base de datos en s√≠ en mariadb 10.4.6 y desafortunadamente con Al lado del sitio este problema para resolver la posibilidad falta, ser√° necesario actualizar a la versi√≥n anterior de MariaDB. <br><br>  Llegaron ... Pens√© en la rebaja al comienzo de la historia, pero <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ se dice en blanco y negro</a> que no puede haber rebaja.  Fusionar volcados e implementar nuevamente en un servidor limpio.  Es decir  Es bueno que no haya actualizado todos los servidores a la vez.  Es decir  "Solo" cien sitios (una risa nerviosa :-)).  Tambi√©n dijeron en soporte: "Para resolver el problema al usar la base de datos MariaDB 10.4.6, deber√° ponerse en contacto con el soporte t√©cnico de MariaDB para que la transacci√≥n no elimine el registro de la base de datos si se realiza la solicitud: <br><br><pre> <code class="sql hljs">$DB-&gt;Query("<span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">".$strTable."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> = <span class="hljs-string"><span class="hljs-string">".$res["</span></span><span class="hljs-keyword"><span class="hljs-keyword">ID</span></span><span class="hljs-string"><span class="hljs-string">"]); $results = $DB-&gt;Query("</span></span><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">".$strTable."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> = <span class="hljs-string"><span class="hljs-string">".$res["</span></span><span class="hljs-keyword"><span class="hljs-keyword">ID</span></span><span class="hljs-string"><span class="hljs-string">"]);‚Äù</span></span></code> </pre> <br>  Nadezhda se hab√≠a estado calentando durante un par de horas desde el comienzo de la comunicaci√≥n con el soporte de MariaDB, pero luego lleg√≥ una carta en la que me dec√≠an correctamente que no era un usuario comercial y, por lo tanto, nadie resolver√≠a mi problema deliberadamente, pero hab√≠a un foro en su sitio web y usted pod√≠a intentar buscar opciones all√≠. ... No voy a aburrir los detalles.  No hay opciones all√≠. <br>  Oh!  ¬°Tenemos una licencia comprada para ISP! <br>  - Hola, apoyo?  Chicos, ayuda! <br>  - Lo sentimos, no admitimos las basura que cambian la versi√≥n nativa del DBMS.  ¬øDesea? Hay una opci√≥n con un servidor alternativo en la ventana acoplable. <br>  - Pero, ¬øc√≥mo llegan los usuarios y las bases de datos?  A la ventana acoplable? <br>  - Bueno, los arrastras all√≠ con tus manos ... <br>  - si!  Y no olvide que el puerto para mysql cambiar√° y deber√° revisar todas las configuraciones y volver a escribirlo. <br>  - Ok, gracias, pensar√© ... <br>  Pens√© y decid√≠ demoler 10.4 con bol√≠grafos y poner 10.2 con los que no hubo problemas en otros servidores. <br><br>  El proceso no fue muy diferente del proceso de actualizaci√≥n.  Solo era necesario en el enlace al repositorio cambiar 10.4 a 10.2, restablecer y volver a crear el cach√© para yum.  Bueno, una "bagatela" m√°s: despu√©s de eliminar 10.4, vaya a / var / lib / mysql y elimine todo desde all√≠.  Sin este paso, despu√©s de instalar 10.2, el servicio caer√° constantemente y ver√° <br><br><pre> <code class="bash hljs">      <span class="hljs-string"><span class="hljs-string">''</span></span> Lost connection to MySQL server at <span class="hljs-string"><span class="hljs-string">'reading initial communication packet'</span></span>, system error: 104 <span class="hljs-string"><span class="hljs-string">"Connection reset by peer"</span></span></code> </pre> <br>  O <br><br><pre> <code class="bash hljs">Lost connection to MySQL server at <span class="hljs-string"><span class="hljs-string">'handshake: reading inital communication packet'</span></span>, system error: 104</code> </pre> <br>  Antes de importar las bases de datos, primero configur√© la contrase√±a de root para mysql que estaba registrada en las configuraciones del ISP e import√© el volcado de la base de datos mysql.  Bueno, entonces, dado que ya hay usuarios y derechos, simplemente importamos todas las bases de usuarios en una fila con la cuenta ra√≠z. <br><br>  Texto de script para el volcado de la base de datos: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo 'show databases' | mysql -u root --password="_" --skip-column-names | grep -v information_schema | xargs -I {} -t bash -c 'mysqldump -u root --password="_" {} | gzip &gt; /BACK/back-$(hostname)-{}-$(date +%Y-%m-%d-%H.%M.%S).sql.gz'</span></span></code> </pre> <br>  Antes de importar bases de datos, debe descomprimirlas.  As√≠ que solo ejecuta el comando <br><br><pre> <code class="bash hljs">gunzip /BACK/*.gz</code> </pre> <br>  Y el √∫ltimo: por alguna raz√≥n, se permiten guiones en el nombre de las bases de datos (si crea a trav√©s de ISPmanager).  Pero cuando crea o intenta llenar el volcado en la base de datos con un gui√≥n en el nombre, recibe un mensaje de que la sintaxis de la consulta es incorrecta. <br><br>  Lea hasta el final de todas las bendiciones.  Pido disculpas por las comas probablemente no colocadas, problemas con ellas.  Si hay deseos / sugerencias sobre la esencia de lo que se describe, escriba un mensaje personal porque me da miedo perder algo en los comentarios.  Y no jures mucho, este es mi primer art√≠culo :-) <br><br>  UPD1: <br><br>  Casi me olvido de mencionar: mientras trataba de encontrar una soluci√≥n al problema sin degradar MariaDB, tuve que actualizar de alguna manera la informaci√≥n.  Se actualiz√≥ de la siguiente manera: toda la base de datos se convierte de InnoDB a MyISAM, la informaci√≥n se actualiza y luego se vuelve a convertir a InooDB. <br>  UPD2: <br><br>  Acaba de llegar una carta de 1C-Bitrix con el siguiente contenido: <br><blockquote>  Solicitud de revisi√≥n implementada <br>  "Despu√©s de actualizar mariadb a 10.4.6, se produjo un error al guardar el elemento de bloque de informaci√≥n" <br>  M√≥dulo: iblock, versi√≥n: desconocido <br>  Soluci√≥n: rechazada </blockquote>  Entonces, aunque aparentemente es imposible actualizar a 10.4 :-( </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459795/">https://habr.com/ru/post/459795/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459775/index.html">Lo que aprend√≠ sobre el aprendizaje autom√°tico despu√©s de trabajar en 12 startups</a></li>
<li><a href="../459785/index.html">Aprendizaje profundo: descripci√≥n general</a></li>
<li><a href="../459787/index.html">C ++, si el tipo est√° definido: declaraci√≥n preliminar de los objetos necesarios</a></li>
<li><a href="../459789/index.html">Actualizaci√≥n de proyectos de Unity para Android para compatibilidad con la arquitectura ARM64</a></li>
<li><a href="../459793/index.html">C√≥mo encontrar nombres significativos para su c√≥digo</a></li>
<li><a href="../459797/index.html">"¬øGafas N-nada?" o "¬øcu√°l es el peligro de los anteojos chinos con dioptr√≠as"?</a></li>
<li><a href="../459798/index.html">Snom D335 - Tel√©fono IP multifuncional con pantalla a color TFT de pantalla panor√°mica</a></li>
<li><a href="../459800/index.html">Recorrido fotogr√°fico: Museo de √ìptica de la Universidad ITMO</a></li>
<li><a href="../459802/index.html">Habr Weekly # 9 / Burnout en j√≥venes, interfaces japonesas, red neuronal Battle.net, juegos y crueldad</a></li>
<li><a href="../459804/index.html">Crear tarjetas de ayuda de crowdsourcing en WordPress + shMapper</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>