<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü™Ô∏è üî£ üèÇ P√©riph√©riques bloc QEMU üïß üßöüèΩ üïß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="QEMU a plusieurs fa√ßons de connecter un p√©riph√©rique de bloc √† une machine virtuelle. Initialement, cela a √©t√© mis en ≈ìuvre de la mani√®re suivante: 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>P√©riph√©riques bloc QEMU</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412825/"><p><img src="https://habrastorage.org/getpro/habr/post_images/65a/367/b43/65a367b437b3a4242250ff30063f4455.png" alt="image"></p><br><p>  QEMU a plusieurs fa√ßons de connecter un p√©riph√©rique de bloc √† une machine virtuelle.  Initialement, cela a √©t√© mis en ≈ìuvre de la mani√®re suivante: </p><br><pre><code class="plaintext hljs">-hda /dev/sda1</code> </pre> <br><p>  Ainsi, les disques virtuels se connectaient √† l'√©poque de la virtualisation.  Il peut √™tre utilis√© aujourd'hui si nous voulons simplement tester certains liveCD.  Malheureusement, il a ses inconv√©nients. <a name="habracut"></a>  : </p><br><ul><li>  Lors de la connexion de disques virtuels, il est possible d'utiliser uniquement l'interface consid√©r√©e comme <code>/dev/hda</code> (hda, hdb, hdc, ..) sur la machine virtuelle;  Pour les CD, l'option <code>-cdrom</code> est <code>-cdrom</code> </li><li>  Lorsqu'un fichier (ou p√©riph√©rique) est connect√© √† une machine virtuelle, QEMU utilise uniquement les param√®tres par d√©faut. </li></ul><br><h2 id="drive">  conduire </h2><br><p>  Pour d√©finir d'autres param√®tres (type de bus, utilisation du cache, etc.), l'option <code>-drive</code> √©t√© ajout√©e √† <code>-drive</code> .  Bien qu'il ait √©t√© initialement utilis√© pour d√©finir les param√®tres du <em>backend</em> et du <em>frontend</em> , il n'est actuellement utilis√© <strong>que</strong> pour d√©finir les param√®tres du <em>backend</em> , c'est-√†-dire les param√®tres qui affectent la connexion du p√©riph√©rique virtuel √† l'int√©rieur de la machine virtuelle. </p><br><pre> <code class="plaintext hljs">-drive file=/dev/sda1,if=ide,cache=writeback,aio=threads</code> </pre> <br><h2 id="device">  appareil </h2><br><p>  D√©finir tous les param√®tres d'un p√©riph√©rique bloc avec une option au fil du temps s'est av√©r√© d√©raisonnable.  Par cons√©quent, les options ont √©t√© divis√©es en deux.  Param√®tres de <em>backend</em> , c'est-√†-dire ceux qui sont utilis√©s pour configurer l'environnement de virtualisation.  Et l' <em>interface</em> , qui affecte la fa√ßon dont le p√©riph√©rique est connect√© dans la machine virtuelle.  Pour cet ensemble de param√®tres, une nouvelle option <code>-device</code> √©t√© introduite, qui contient l' <em>id de l'id du</em> lecteur sp√©cifi√© par le param√®tre <code>-drive</code> . </p><br><p>  L'exemple de configuration suivant connectera le lecteur avec l' <strong>identifiant ide0-hd0</strong> , et le r√©sultat est le m√™me que la connexion d'un lecteur virtuel, comme indiqu√© dans l'introduction. </p><br><pre> <code class="plaintext hljs">-drive file=/dev/sda1,id=ide0-hd0,if=none,cache=writeback,aio=threads \ -device ide-drive,bus=ide.0,drive=ide0-hd0</code> </pre> <br><h1 id="lokalnye-blochnye-ustroystva-v-virtualnoy-mashine">  P√©riph√©riques de bloc locaux dans une machine virtuelle </h1><br><p> <a href=""><img src="https://habrastorage.org/webt/iu/bk/t0/iubkt0a0zeavkt_ntiqdcmg45bw.png"></a> </p><br><p>  L'utilisation de p√©riph√©riques de blocs physiques pour les machines virtuelles n'est pas tr√®s r√©pandue aujourd'hui compte tenu de l'utilisation g√©n√©ralis√©e des disques virtuels.  Techniquement, nous pouvons ex√©cuter une machine virtuelle avec un syst√®me propri√©taire √† partir d'un ancien disque dur.  Cependant, dans ce cas, il est pr√©f√©rable de faire d'abord une image disque (image) √† l'aide de <strong>dd</strong> et de d√©marrer le syst√®me √† partir de celui-ci d√©j√†. </p><br><p>  Comme un p√©riph√©rique bloc local, il peut √™tre connect√© √† une machine virtuelle. </p><br><ul><li>  Baie RAID locale - p√©riph√©rique de type <em>md</em> </li><li>  Master DRBD (network RAID1) - <em>p√©riph√©rique de</em> type <em>drbd</em> </li><li>  Partition de disque cr√©√©e dans le groupe LVM - p√©riph√©rique de type <em>dm</em> </li><li>  Un fichier normal connect√© via une boucle est un p√©riph√©rique de boucle </li><li><p>  Bloquer le p√©riph√©rique d'un autre ordinateur export√© via le serveur NBD - <em>p√©riph√©rique de</em> type <em>nbd</em> </p><br><p>  <em>(Ici, il convient √©galement de mentionner le type d'appareil Ceph rbd et le type d'appareil ZFS zvol - environ Per)</em> <br><br></p><br><h2 id="nbd">  NBD </h2><br><p>  Consid√©rez le concept de connexion d'un p√©riph√©rique bloc √† partir d'un ordinateur distant via un r√©seau.  Voir le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manuel s√©par√© pour NBD</a> . </p><br></li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/on/dy/nf/ondynfow2qyce6r0j65pjmqwnqo.png" align="right"></a> <a href=""><img src="https://habrastorage.org/webt/tq/uv/am/tquvamsriwa3hlj4sh3972xbvyq.png" align="left"></a>  QEMU poss√®de une API NBD int√©gr√©e, de sorte qu'un p√©riph√©rique de bloc distant √©tendu avec un serveur NBD peut √™tre directement connect√© √† la machine virtuelle via QEMU - voir la figure √† gauche. </p><br><p>  Cependant, NBD est un protocole assez simple qui n'utilise pas d'authentification sur un serveur distant et ne contr√¥le pas l'√©tat de la connexion.  Le protocole NBD suppose que le client peut se reconnecter si la connexion au serveur est interrompue, mais malheureusement QEMU ne le fait pas. </p><br><p>  En partie, la situation peut √™tre r√©solue en connectant plusieurs p√©riph√©riques NBD et en cr√©ant une matrice RAID virtuelle √† l'int√©rieur.  Cette approche pr√©sente plusieurs avantages et un d√©faut fatal.  Si l'un des appareils s'√©teint, il ne se passera rien de mal.  Mais s'ils s'envolent d'un coup = ce sera mauvais.  Les op√©rations d'E / S dans un environnement virtuel seront beaucoup plus rapides, car les requ√™tes seront ex√©cut√©es en parall√®le sur plusieurs machines physiques (serveurs NBD) √† la fois.  Mais d'un autre c√¥t√©, cela n√©cessitera plus de ressources du processeur virtuel et de la m√©moire virtuelle. </p><br><p>  Le principal inconv√©nient de la construction d'une matrice RAID √† partir de p√©riph√©riques NBD dans une machine virtuelle est le p√©riph√©rique QEMU, si le p√©riph√©rique NBD se bloque, il ne sera reconnect√© qu'apr√®s un <strong>red√©marrage complet de la</strong> machine, tandis que le red√©marrage interne du syst√®me d'exploitation √† l'int√©rieur de la machine virtuelle ne sera pas suffisant.  Mais vous pouvez cr√©er une machine virtuelle sans disques qui acc√®dera ind√©pendamment au serveur NBD et connectera les p√©riph√©riques NBD n√©cessaires.  De plus, les p√©riph√©riques d√©faillants doivent √™tre ajout√©s √† la baie et resynchronis√©s, cela peut √™tre fait manuellement ou √† l'aide de scripts √† l'int√©rieur de la machine virtuelle. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/2z/hj/h8/2zhjh8517alwckyyggummg1-wj8.png" align="left"></a>  Il est pr√©f√©rable d'acc√©der au serveur NBD √† l'aide du p√©riph√©rique de machine virtuelle NBD.  Particuli√®rement bon, en termes de performances d'E / S, est de construire une matrice RAID √† partir de p√©riph√©riques NBD. </p><br><p>  Cette solution s'est av√©r√©e √™tre la plus productive de toutes test√©es.  Et la machine virtuelle a pu continuer √† fonctionner sans interruption, m√™me en cas de d√©connexion du serveur NBD (ou de panne) au fil du temps. </p><br><p>  Ainsi, il a √©t√© possible d'organiser un environnement de virtualisation relativement stable et en m√™me temps productif sur des √©quipements instables. </p><br><blockquote>  Le principal probl√®me avec les matrices RAID sur les p√©riph√©riques NBD est que vous devez √™tre tr√®s prudent lorsque vous connectez un p√©riph√©rique faisant partie d'une matrice RAID √† partir du serveur NBD.  Il s'agit d'un processus assez d√©licat avec une forte probabilit√© d'erreur fatale, ce qui peut entra√Æner une perte de donn√©es.  Une petite faute de frappe suffit.  Voir la description de l'accident de voiture mortel du 21 juillet 2012 sur la page <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Peanuts</a> . </blockquote><p>  L'inconv√©nient est qu'un p√©riph√©rique bloc avec lequel une machine virtuelle fonctionne d√©j√† ne peut pas √™tre connect√© √† un autre endroit si son syst√®me de fichiers ne le permet pas - cela est similaire √† <strong>iSCSI</strong> ( <strong>i</strong> nternet <strong>S</strong> mall <strong>C</strong> omputer <strong>S</strong> usterm <strong>I</strong> nterface - version r√©seau de SCSI) ou <strong>AoE</strong> ( <strong>A</strong> TA <strong>u</strong> ver la technologie Eernet). </p><br><h1 id="virtualnye-diski">  Disques virtuels </h1><br><p> <a href=""><img src="https://habrastorage.org/webt/id/fl/lr/idfllr5zwpo6jniv5emsyqhir2m.png"></a> </p><br><p>  QEMU peut non seulement connecter des p√©riph√©riques de bloc √† la machine virtuelle, mais √©galement, en utilisant diverses API, un fichier normal peut √©galement √™tre connect√©, qui ressemblera √† un p√©riph√©rique de bloc √† l'int√©rieur de la machine. </p><br><h2 id="formaty-virtualnyh-diskov">  Formats de disque virtuel </h2><br><blockquote>  Qemu peut fonctionner avec des disques virtuels de diff√©rents formats.  Pour les disques virtuels qui sont pr√©sent√©s sous forme de fichiers ordinaires, il existe un <strong>utilitaire qemu-img</strong> standard qui peut √™tre utilis√© √† la fois pour la conversion afin de d√©terminer le format utilis√© et ses param√®tres. <br><br>  R√©cup√©ration des informations de disque virtuel enregistr√©es en tant que fichier normal.  De la m√™me mani√®re, vous pouvez obtenir des informations sur un disque virtuel stock√© sur GlusterFS: <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info /path_to_file/soubor.img</code> </pre> <br><br>  Cependant, pour obtenir des informations sur un disque virtuel √† l'aide de l'API GlusterFS, vous devez utiliser les m√™mes param√®tres que ceux utilis√©s pour connecter le disque virtuel √† la machine virtuelle.  Ainsi, vous pouvez identifier le disque interne sur la machine o√π le client GlusterFS est install√© et utilis√©: <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info gluster+tcp://192.168.0.2/volume_name/soubor.img</code> </pre> <br><br>  Le disque virtuel VDI ne peut √™tre identifi√© que via l'API Sheepdog: <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info sheepdog:192.168.0.2:8000:vdi_name</code> </pre> <br><br>  Pour un disque virtuel export√© depuis le serveur NBD, il est n√©cessaire de s'assurer que le bon serveur et le bon port sont sp√©cifi√©s, car NBD n'utilise aucun autre m√©canisme d'identification ou d'authentification qui √©liminerait la confusion avec d'autres disques virtuels <em>(la nouvelle version de nbd-server utilise un seul port et identifie l'appareil par son nom - environ par)</em> : <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info nbd:192.168.0.2:8000</code> </pre> <br><br>  <strong>192.168.0.2</strong> <br>  L'adresse IP de l'h√¥te √† partir duquel le p√©riph√©rique virtuel se connecte.  S'il s'agit du m√™me h√¥te <strong>qemu-img info</strong> s'ex√©cute, <em>localhost</em> peut √™tre utilis√© √† la place de l'adresse IP <br><br>  <strong>8000</strong> <br>  Num√©ro de port sur lequel le d√©mon ou le serveur √©coute.  Par d√©faut, Sheepdog utilise le port 7000, mais il peut √©galement √™tre ex√©cut√© sur un autre port pour √©viter les conflits avec une autre application.  Un serveur NBD peut √©couter sur diff√©rents ports si plusieurs appareils sont export√©s. </blockquote><p>  <strong>brut</strong> <br>  en g√©n√©ral, il s'agit simplement d'un ensemble de donn√©es enregistr√©es dans le m√™me format que sur un p√©riph√©rique bloc classique.  Un fichier 5G occupera toute cette place, qu'il contienne des donn√©es utiles ou simplement un espace vide.  <em>(qui ne s'applique pas aux fichiers √©pars - environ par.)</em> </p><br><p>  <strong>qcow</strong> <br>  Il diff√®re du format brut en ce qu'il peut √™tre incr√©mentiel, car il se d√©veloppe progressivement - c'est pratique pour les syst√®mes de fichiers qui ne prennent pas en charge les fichiers clairsem√©s, par exemple FAT32.  Ce format vous permet √©galement de cr√©er des copies incr√©mentielles distinctes √† partir d'un seul disque de base.  L'utilisation d'un tel ¬´mod√®le¬ª permet d'√©conomiser du temps et de l'espace disque.  De plus, il prend en charge le cryptage AES et la compression zlib.  L'inconv√©nient est que, contrairement aux disques bruts, un tel fichier ne peut pas √™tre mont√© directement sur la machine sur laquelle il se trouve.  Heureusement, il existe un utilitaire <strong>qemu-nbd</strong> qui peut exporter ce fichier en tant que p√©riph√©rique de blocage r√©seau, puis le connecter √† un p√©riph√©rique NBD. </p><br><p>  <strong>qcow2</strong> <br>  est une version mise √† jour du format qcow.  La principale diff√©rence est qu'il prend en charge les instantan√©s.  Sinon, ils ne sont pas fondamentalement diff√©rents.  Il est √©galement possible de rencontrer qcow2, qui est d√©fini en interne comme QCOW version 3, une fois qu'il a √©t√© inclus dans le format qcow2 il y a longtemps.  En fait, il s'agit d'un qcow2 modifi√© avec le param√®tre lazy_refcounts, qui est utilis√© pour les instantan√©s.  √âtant donn√© que la diff√©rence n'est que d'un bit, <strong>qemu-img</strong> de la version 1.7 a l'option "modifier" pour le changer.  Les versions ant√©rieures de <strong>qemu-img</strong> ne le font pas.  Si vous vouliez changer la version du format, il fallait convertir le disque virtuel en un nouveau fichier, lors de la conversion, le param√®tre compat √©tait install√© avec le param√®tre compat, pour lequel il fallait plut√¥t r√©duire le "1.1" √† 0.10 ".  La pr√©sence de l'option ¬´modifier¬ª est pratique car il n'est pas n√©cessaire d'√©craser les donn√©es en raison de ces changements mineurs. </p><br><pre> <code class="plaintext hljs">qemu-img create -f qcow2 -o compat=1.1 test.qcow2 8G</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://blog.wikichoon.com/2014/12/virt-manager-10-creates-qcow2-images.html</a> </p><br><p>  <strong>qed</strong> <br>  Il s'agit d'un format COW incr√©mentiel d'un disque virtuel qui cr√©e la moindre charge sur l'h√¥te.  Il ne prend en charge aucune compression et utilise deux tables parall√®les pour adresser les blocs de donn√©es (clusters).  Malheureusement, pas un seul d√©veloppeur ne s'est int√©ress√© depuis longtemps √† son d√©veloppement, son utilisation pose donc des probl√®mes qui seront √©voqu√©s. </p><br><p>  <strong>vdi</strong> <br>  format de disque virtuel utilis√© par le syst√®me de virtualisation Oracle Virtualbox. </p><br><p>  <strong>vmdk</strong> <br>  format de disque virtuel utilis√© par les produits VMware.  Il s'agit √©galement d'un format qui permet √† un fichier de se d√©velopper progressivement.  Cependant, il pr√©sente un grand avantage sur les formats qcow2 et qed, qui peuvent √©galement √™tre utilis√©s avec des solutions sans disque ou avec des syst√®mes de fichiers r√©seau.  Il vous permet d'avoir un fichier de disque virtuel divis√© en plusieurs petits fichiers d'une taille de 2 Go.  Cela reste du temps o√π les syst√®mes de fichiers ne pouvaient pas cr√©er de fichiers sup√©rieurs √† 2 Go.  L'avantage est que si un tel disque virtuel est r√©pliqu√© sur le r√©seau, moins de donn√©es sont transf√©r√©es et la synchronisation est beaucoup plus rapide (par exemple, dans le cas de GlusterFS).  Dans le cas d'une solution sans disque, elle est √©galement utilis√©e pour stocker uniquement de petits fichiers avec des diff√©rences pour chaque instantan√© </p><br><p>  <strong>vhdx</strong> <br>  format de disque virtuel utilis√© par le syst√®me de virtualisation Microsoft Hyper-V </p><br><p>  <strong>vpc</strong> <br>  format de disque virtuel utilis√© par le syst√®me de virtualisation Microsoft VirtualPC. </p><br><table><thead><tr><th></th><th>  <sup>Incre</sup> <sup><br></sup>  <sup>menti</sup> <sup><br></sup>  <sup>enracin√©</sup> <sup><br></sup>  <sup>C'est √† dire</sup> <br></th><th>  <sup>Chiffre</sup> <sup><br></sup>  <sup>novation</sup> <br></th><th>  <sup>Com</sup> <sup><br></sup>  <sup>pr√©s</sup> <sup><br></sup>  <sup>√ßa</sup> <br></th><th>  <sup>Preal</sup> <sup><br></sup>  <sup>emplacement</sup> <br></th><th>  <sup>Shabl</sup> <sup><br></sup>  <sup>oniz</sup> <sup><br></sup>  <sup>nation</sup> <br></th><th>  <sup>Prop</sup> <sup><br></sup>  <sup>belettes</sup> <br></th><th>  <sup>Section</sup> <sup><br></sup>  <sup>image</sup> <br></th><th>  <sup>√Ä l'int√©rieur</sup> <sup><br></sup>  <sup>instantan√©s</sup> <sup><br></sup>  <sup>toi</sup> <br></th><th>  <sup>V√©rification approuv√©e</sup> <sup><br></sup>  <sup>nosti</sup> <br></th><th>  <sup>Remarque</sup> <br></th></tr></thead><tbody><tr><td>  <sup><b>brut</b></sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>Peut √™tre mont√© via une <i>boucle</i></sup> <br></td></tr><tr><td>  <sup><b>fichier</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>option</sup> <sup><br></sup>  <sup>personnellement</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>Pour Btrfs, vous devez d√©sactiver la copie sur √©criture</sup> <br></td></tr><tr><td>  <sup><b>qcow</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td></td></tr><tr><td>  <sup><b>qcow2</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>option</sup> <sup><br></sup>  <sup>personnellement</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>oui</sup> </td><td></td></tr><tr><td>  <sup><b>qed</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td></td></tr><tr><td>  <sup><b>vmdk</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>option</sup> <sup><br></sup>  <sup>personnellement</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>hein</sup> <sup>?</sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td></td></tr><tr><td>  <sup><b>vdi</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>option</sup> <sup><br></sup>  <sup>statique (statique)</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>oui</sup> </td><td></td></tr><tr><td>  <sup><b>vhdx</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>option</sup> <sup><br></sup>  <sup>fixe (fixe)</sup> </td><td>  <sup>non</sup> </td><td>  <sup>oui</sup> <sup><a name="cite_ref-1"></a></sup>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1</a></sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td></td></tr><tr><td>  <sup><b>vpc</b></sup> </td><td>  <sup>oui</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>option</sup> <sup><br></sup>  <sup>fixe (fixe)</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td>  <sup>non</sup> </td><td></td></tr></tbody></table><br><ol><li><a name="cite_note-1"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">‚Üë</a> Il est possible d'utiliser uniquement sur des images pr√©install√©es (fixe) <br></li></ol><br><h2 id="ispolzuemye-api">  API utilis√©es </h2><br><p>  En plus des formats de fichiers, <strong>qemu-img</strong> fonctionne √©galement avec des ¬´formats¬ª fournis √† l'aide de l'API par le biais de laquelle ces p√©riph√©riques bloqu√©s sont accessibles √† distance. </p><br><p>  <strong>nfs</strong> <br>  fichier de disque virtuel connect√© √† QEMU via le protocole NFS </p><br><p>  <strong>iscsi</strong> <br>  la communication avec le p√©riph√©rique de bloc se fait via iSCSI.  Un appareil ne peut pas √™tre utilis√© simultan√©ment sur plusieurs clients. </p><br><p>  <strong>nbd</strong> <br>  L'acc√®s via NBD peut √™tre tr√®s rapide.  En effet, le protocole est tr√®s simple.  C'est un avantage, mais en m√™me temps un inconv√©nient.  Cela peut √™tre pratique lorsque plusieurs clients peuvent se connecter au m√™me serveur NBD s'ils utilisent une connexion locale via le serveur xnbd.  Cependant, comme nbd ne dispose pas de m√©canismes de s√©curit√© ou d'authentification, une situation peut facilement se produire lorsqu'un client se connecte accidentellement au mauvais appareil, qui √† un moment donn√© peut d√©j√† √™tre utilis√© et l'endommager. </p><br><p>  <strong>ssh</strong> <br>  la connexion au serveur distant se fait via sshfs </p><br><p>  <strong>briller</strong> <br>  utilise l'API du syst√®me de fichiers GlusterFS pour acc√©der au fichier de disque virtuel.  Si le fichier fait partie d'un volume r√©pliqu√© ou distribu√©, il r√©partira les donn√©es stock√©es entre les autres n≈ìuds.  Cela lui permet, en cas de panne, d'√™tre disponible sur d'autres n≈ìuds. </p><br><p>  <strong>chien de berger</strong> <br>  est √©galement un syst√®me de fichiers distribu√© avec r√©plication.  Contrairement √† GlusterFS, un disque virtuel via l'API est disponible non pas en tant que fichier, mais en tant que p√©riph√©rique de bloc.  Ceci est b√©n√©fique en termes de performances, mais d√©savantageux si nous devons aller au-del√† de l'environnement Sheepdog. </p><br><p>  <strong>paralles</strong> </p><br><h1 id="virtualnye-diski-na-setevom-hranilische">  Lecteurs virtuels sur le stockage connect√© au r√©seau </h1><br><p>  L'avantage des p√©riph√©riques de bloc situ√©s en dehors du syst√®me de virtualisation est qu'ils sont alors immunis√©s contre les pannes de machines virtuelles. </p><br><p>  Dans ce cas, une haute disponibilit√© et un volume suffisant pour le stockage √† distance sont √©galement fournis. </p><br><p>  <strong>Utilisation de NFS</strong> <br> <a href=""><img src="https://habrastorage.org/webt/ws/ce/6f/wsce6f0lvdglrpbl1g_v4lif9py.png"></a> </p><br><p>  <strong>Chien de berger</strong> <br> <a href=""><img src="https://habrastorage.org/webt/lv/ko/k4/lvkok49hqjv-kp1uiis-8sg3ejw.png"></a> </p><br><p>  <strong>GlusterFS</strong> <br> <a href=""><img src="https://habrastorage.org/webt/n9/jz/0z/n9jz0zjuprv_mj-tmq9lhjtqfjy.png"></a> </p><br><h1 id="virtualnye-mashiny-bez-blochnyh-ustroystv">  Machines virtuelles sans bloc </h1><br><p>  Sans p√©riph√©riques de bloc, les syst√®mes d'exploitation qui peuvent d√©marrer via NFS ou avec un syst√®me de fichiers h√¥te lanc√© √† l'aide de Plan9 peuvent fonctionner. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412825/">https://habr.com/ru/post/fr412825/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412813/index.html">En-t√™tes HTTP inutiles</a></li>
<li><a href="../fr412815/index.html">Cl√©s client OpenVPN Web Manager VPNFace Lite</a></li>
<li><a href="../fr412819/index.html">Vendredi, √©chauffement pour l'esprit: Karma parfait pour Habrahabr</a></li>
<li><a href="../fr412821/index.html">Voir, regarder, regarder: quelle est la diff√©rence?</a></li>
<li><a href="../fr412823/index.html">Interview en anglais: comment ne pas faire pire que l'ami du fils de la m√®re</a></li>
<li><a href="../fr412827/index.html">Pavel Durov: apr√®s l'appel de l'ILV, Apple a bloqu√© les mises √† jour de Telegram dans le monde</a></li>
<li><a href="../fr412829/index.html">Centres de donn√©es distribu√©s du fournisseur: quoi et pourquoi</a></li>
<li><a href="../fr412831/index.html">Version YouTrack 2018.2: nouvelle page de projet, image YouTrack Docker et bien plus encore</a></li>
<li><a href="../fr412833/index.html">Plus que Ford</a></li>
<li><a href="../fr412835/index.html">NanoIntroduction √† l'Internet des nano-objets. Partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>