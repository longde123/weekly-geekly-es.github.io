<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›€ğŸ¿ ğŸ‘ŒğŸ¾ ğŸ‘¨â€âš–ï¸ çœŸå®é¡¹ç›®ä¸­çš„B +æ ‘ ğŸ â›¹ğŸ¼ ğŸ¤ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶å¦‚ä½•åœ¨åˆ†å¸ƒå¼Apache Igniteæ•°æ®åº“ä¸­åˆ¶ä½œB +æ ‘ã€‚ 




 åœ¨Bæ ‘ä¸Šçš„Hæ ‘ä¸Šå·²ç»æœ‰å‡ ç¯‡æ–‡ç« ï¼ˆ ä¸€æœ¬ ï¼Œ ä¸¤æœ¬ ï¼‰ï¼Œä½†æ˜¯å®ƒä»¬æ›´å¯èƒ½æ˜¯ç†è®ºä¸Šçš„ï¼Œå³ä½¿å®ƒä»¬åŒ…å«å®ç°ï¼Œä¹Ÿæ— æ³•æŠ•å…¥ç”Ÿäº§ ã€‚ å› æ­¤ï¼Œæœ‰å…´è¶£äº†è§£ç”Ÿæ´»ä¸­ä½¿ç”¨çš„å®ç°ã€‚ 


 åœ¨ç»§ç»­é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®æ‚¨å…ˆè§‚çœ‹Maxi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>çœŸå®é¡¹ç›®ä¸­çš„B +æ ‘</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/413749/"><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ç ”ç©¶å¦‚ä½•åœ¨åˆ†å¸ƒå¼<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apache Ignite</a>æ•°æ®åº“ä¸­åˆ¶ä½œB +æ ‘ã€‚ <br></p><br><img src="https://habrastorage.org/webt/mv/_t/zg/mv_tzg1o-c96a2ib19cf9umv67u.jpeg"><a name="habracut"></a><br><p> åœ¨Bæ ‘ä¸Šçš„Hæ ‘ä¸Šå·²ç»æœ‰å‡ ç¯‡æ–‡ç« ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€æœ¬</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸¤æœ¬</a> ï¼‰ï¼Œä½†æ˜¯å®ƒä»¬æ›´å¯èƒ½æ˜¯ç†è®ºä¸Šçš„ï¼Œå³ä½¿å®ƒä»¬åŒ…å«å®ç°ï¼Œä¹Ÿæ— æ³•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŠ•å…¥ç”Ÿäº§</a> ã€‚ å› æ­¤ï¼Œæœ‰å…´è¶£äº†è§£ç”Ÿæ´»ä¸­ä½¿ç”¨çš„å®ç°ã€‚ </p><br><p> åœ¨ç»§ç»­é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®æ‚¨å…ˆè§‚çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Maxim Babenko</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¼”è®²</a> ï¼Œå¦‚æœæ‚¨ä»ç„¶ä¸äº†è§£Bæ ‘çš„ç†è®ºå«ä¹‰ã€‚ ä½†æ˜¯æˆ‘ä¸éœ€è¦æ·±å…¥äº†è§£Javaæˆ–Apache Igniteé¡¹ç›®-æˆ‘å°†æ˜ç¡®ç¼–å†™ç»†èŠ‚æˆ–å°†å…¶éšè—åœ¨ç ´åè€…çš„ä¸‹é¢ã€‚ </p><br><p> é˜…è¯»Igniteæºä»£ç æ—¶ï¼Œæˆ‘å»ºè®®æ‚¨åœ¨è„‘æµ·ä¸­è·³è¿‡æ–¹æ³•çš„å‚æ•°ï¼ˆæ–¹æ³•çš„å«ä¹‰ä¸æ˜¯å¾ˆæ¸…æ¥šï¼‰å¹¶é˜…è¯»å‡½æ•°çš„åç§°-å¦‚æœäº‹å…ˆçŸ¥é“å‡½æ•°çš„ä½œç”¨ï¼Œé‚£ä¹ˆé˜…è¯»å‡½æ•°çš„ä¸»ä½“ä¼šå®¹æ˜“å¾—å¤šã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œæˆ‘ä¸æ˜¯Apache Igniteçš„é¦–å¸­å¼€å‘äººå‘˜ï¼Œå¯èƒ½å¯¹ä»£ç æœ‰è¯¯è§£ã€‚ å› æ­¤ï¼Œæˆ‘æå‡ºäº†â€œæ®æˆ‘æ‰€çŸ¥â€ä¸€è¯ï¼Œåº”è¯¥åœ¨æ¯å¥è‚¯å®šçš„å¥å­ä¹‹å‰åœ¨è„‘æµ·ä¸­åŠ ä¸Šè¯¥è¯ã€‚ </p><br><h1 id="zachem-b-derevo-v-apache-ignite"> ä¸ºä»€ä¹ˆåœ¨Apache Igniteä¸­ä½¿ç”¨B +æ ‘ </h1><br><p> Apache Igniteæ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œä½†æ˜¯ä»2.1ç‰ˆå¼€å§‹ï¼Œå®ƒå…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŒä¹…æ•°æ®å­˜å‚¨</a> -ä¸€ç§å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜çš„åŠŸèƒ½<em>ï¼ˆä¸<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŒä¹…æ•°æ®ç»“æ„</a>æ— å…³ï¼‰</em> ã€‚ å› æ­¤ï¼Œå¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆå¤–éƒ¨å­˜å‚¨å™¨éœ€è¦ä¸€ç§ç»“æ„ï¼Œä»ç„¶æœ‰å¿…è¦äº†è§£ä¸ºä»€ä¹ˆä»–ä»¬ä¸é€‰æ‹©å…¶ä»–ç»“æ„ã€‚ </p><br><p> é¦–å…ˆï¼ŒB +æ ‘æ˜¯Bæ ‘çš„ä¼˜åŒ–ï¼Œå…¶ä¸­çš„å€¼ä»…å­˜å‚¨åœ¨å¶å­ä¸­ã€‚ åœ¨æ­¤ä¼˜åŒ–ä¸­ï¼Œæ›´å¤šçš„å…³é”®å­—é€‚åˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™å¢åŠ äº†åˆ†æ”¯çš„ç¨‹åº¦ã€‚ å› æ­¤ï¼Œæ²¡æœ‰å¤ªå¤šç†ç”±ä½¿ç”¨ç»å…¸Bæ ‘ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">B *</a>å’ŒB + *-åœ¨ç£ç›˜ä¸Šå¯†åº¦æ›´é«˜ï¼Œä½†æ˜¯å®ƒä»¬çš„æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸º æˆ‘ä»¬ä»RAMå­˜å‚¨æ•°æ®ï¼Œæ€§èƒ½å¯¹æˆ‘ä»¬æ¥è¯´æ›´é‡è¦ã€‚ </p><br><p> ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸºå‡†</a>æ¥çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼Œ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LSMæ ‘çš„</a>å†™å…¥é€Ÿåº¦è¾ƒå¿«ï¼Œä½†è¯»å–é€Ÿåº¦è¾ƒæ…¢ã€‚ æ­¤å¤–ï¼Œé˜…è¯»ä¸Šçš„æŸå¤±å¤§äºå†™ä½œä¸Šçš„æŸå¤±ï¼Œå› æ­¤å¯¹äºä¸€ä¸ªå‡è®¾çš„ä¸€èˆ¬æƒ…å†µï¼Œæˆ‘ä¹Ÿä¼šé‡‡ç”¨B +æ ‘ã€‚ </p><br><p> è¿˜æœ‰ä¸€äº›å¥‡æ€ªçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†å½¢æ ‘</a> ï¼Œä½†æ˜¯ï¼Œæ˜¾ç„¶ï¼Œå®ƒä»¬ä»…åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TokuDB</a>ä¸­è·å¾—ä¸“åˆ©å¹¶å®ç°ã€‚ </p><br><p> å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘å¯¹ä¸ºä½•ä¸å¯èƒ½åƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LevelDB</a>è¿™æ ·çš„ç°æˆç£ç›˜åç«¯æ„Ÿå…´è¶£ï¼Ÿ éƒ¨åˆ†ç­”æ¡ˆæ˜¯PDSæ”¯æŒç¬¬ä¸‰æ–¹å­˜å‚¨ã€‚ </p><br><h1 id="realizaciya-v-krupnuyu-kletku"> å¤§å•å…ƒå®æ–½ </h1><br><p>æœ€åˆï¼ŒGridGainå¼€å‘äº†Apache Igniteï¼Œä½†æ˜¯åœ¨æ”¾å¼ƒå¼€æºä¹‹å‰ï¼Œå®ƒä»¥å…¬å¸çš„åå­—å‘½åï¼Œå› æ­¤æŸäº›ç»„ä»¶åç§°ä»¥<code>Grid</code>å¼€å¤´ï¼Œè€Œå…¶ä»–ç»„ä»¶åç§°ä»¥<code>Ignite</code>å¼€å¤´ã€‚ å› æ­¤<code>GridCursor</code>è€Œæ˜¯<code>IgniteTree</code> ã€‚ è¿™é‡Œæ²¡æœ‰å…¶ä»–é€»è¾‘ã€‚ </p><br><p>  Apache Igniteä»£ç æ˜¯ç”¨Javaæœ€ä½³å®è·µæ¨¡å¼ç¼–å†™çš„ï¼Œæ¯ä¸ªç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ¥å£ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰ã€‚ ä»<code>IgniteTree</code>ç•Œé¢å¼€å§‹è·³èˆã€‚ ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ç»™å‡ºçš„ä»£ç æ²¡æœ‰javadocã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteTree</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T val)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(L key, Object x, InvokeClosure&lt;T&gt; c)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOne</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(L key)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GridCursor&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(L lower, L upper)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GridCursor&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(L lower, L upper, Object x)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findFirst</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findLast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(L key)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvokeClosure</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable T row)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException</span></span>; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newRow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">OperationType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operationType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> OperationType { NOOP, REMOVE, PUT } }</code> </pre> <br><p>  <code>IgniteTree</code>æ¥å£æè¿°äº†ä¸€ç»„æ ‡å‡†æ“ä½œã€‚ è¯·æ³¨æ„ï¼Œè¿›è¡ŒèŒƒå›´æœç´¢éœ€è¦æ‚¨ç¼–ç»‡åˆ—è¡¨ä¸­çš„å¶å­ã€‚ å¥–é‡‘æ”¯æŒä»»æ„è®°å½•æ“ä½œ<code>invoke</code> ã€‚ </p><br><p>  <code>put</code>æ“ä½œä»…æ¥å—<code>T</code>ç±»å‹çš„ä¸€ä¸ªå‚æ•°è€Œæ²¡æœ‰é”®ã€‚ æ‚¨ä¸ä¼šåœ¨<code>IgniteTree</code>æ‰¾åˆ°å¯¹æ­¤çš„è§£é‡Šï¼Œä½†æ˜¯ç­”æ¡ˆè¢«éšè—åœ¨<code>BPlusTree</code>æ ‡å¤´ä¸­ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BPlusTree</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataStructure</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteTree</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œè¯¥å€¼ç»§æ‰¿äº†é”®ï¼Œå› æ­¤ï¼Œåœ¨æ”¾ç½®æ“ä½œä¸­ï¼Œé”®æ˜¯ä»è¯¥å€¼è®¡ç®—å¾—å‡ºçš„ã€‚ è¿™å¹¶ä¸é™åˆ¶æ ‘çš„åŠŸèƒ½ã€‚ æˆ‘çš„å‡è®¾æ˜¯å­˜å‚¨é›†æ›´ç´§å‡‘ã€‚ </p><br><p> é€šå¸¸ï¼Œä»–ä»¬é€šè¿‡å°†åƒåœ¾å¸¸é‡é™„åŠ åˆ°å€¼ä¸Šæ¥ä½¿å®ƒä»¬è„±ç¦»åœ°å›¾ã€‚ ä½†æ˜¯ï¼Œåœ¨B +æ ‘ä¸­ï¼Œ <em>åªæœ‰é”®</em>å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸­ï¼›å¦‚æœå€¼ä¹Ÿå­˜å‚¨é”®ï¼Œåˆ™åœ¨å¶ä¸­<em>ä»…å­˜</em>å‚¨å€¼å°±è¶³å¤Ÿ<em>äº†</em> ã€‚ å¦‚æœæ ‘æ˜¯ä¸€ä¸ªé›†åˆï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨è¯æ˜å¶å­ä¸­åªæœ‰é”®ï¼Œæ²¡æœ‰åƒåœ¾å€¼ã€‚ </p><br><p><img src="https://habrastorage.org/webt/gk/5a/mj/gk5amjeohtkej5assnsgyy791p4.png"></p><br><p> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å…ƒç´ æœç´¢ä»£ç ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> g Get. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> IgniteCheckedException If failed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doFind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Get g)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { <span class="hljs-comment"><span class="hljs-comment">// Go down with retries. g.init(); switch (findDown(g, g.rootId, 0L, g.rootLvl)) { case RETRY: case RETRY_ROOT: checkInterrupted(); continue; default: return; } } } /** * @param g Get. * @param pageId Page ID. * @param fwdId Expected forward page ID. * @param lvl Level. * @return Result code. * @throws IgniteCheckedException If failed. */ private Result findDown(final Get g, final long pageId, final long fwdId, final int lvl) throws IgniteCheckedException { long page = acquirePage(pageId); try { for (;;) { // Init args. g.pageId = pageId; g.fwdId = fwdId; Result res = read(pageId, page, search, g, lvl, RETRY); switch (res) { case GO_DOWN: case GO_DOWN_X: assert g.pageId != pageId; assert g.fwdId != fwdId || fwdId == 0; // Go down recursively. res = findDown(g, g.pageId, g.fwdId, lvl - 1); switch (res) { case RETRY: checkInterrupted(); continue; // The child page got split, need to reread our page. default: return res; } case NOT_FOUND: assert lvl == 0 : lvl; g.row = null; // Mark not found result. return res; default: return res; } } } finally { if (g.canRelease(pageId, lvl)) releasePage(pageId, page); } }</span></span></code> </pre> <br><p>  Bæ ‘éå†ç®—æ³•çš„åŸºç¡€ä¿æŒä¸å˜ï¼šå®ƒæ²¿æ ‘é€’å½’åœ°ä¸‹é™åˆ°æ‰€éœ€çš„å¶å­ï¼šå¦‚æœå­˜åœ¨è¯¥å€¼ï¼Œåˆ™è¿”å›ç»“æœï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›<code>null</code> ã€‚ æ˜¾ç„¶ï¼Œé€’å½’æ˜¯ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæ— è®ºå¦‚ä½•ï¼ŒBæ ‘å¹¶ä¸æ·±ã€‚ </p><br><p><img src="https://habrastorage.org/webt/tc/g3/0t/tcg30to_z-6fcrfegjfulubh0gq.jpeg"></p><br><p> æˆ‘å¾ˆæƒŠè®¶ï¼Œå› ä¸ºæˆ‘è„‘å­é‡Œæœ‰ä¸ªæ¸…æ™°çš„å®‰è£…ï¼šé€’å½’æ€»æ˜¯åœ¨çœŸå®çš„é¡¹ç›®ä¸­åˆ é™¤ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Javaä¸­æ²¡æœ‰å°¾é€’å½’ä¼˜åŒ–ï¼Œ</a>åœ¨å…¶ä»–è¯­è¨€çš„é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥æ¥å—é€’å½’ï¼‰ã€‚ ä½†æ˜¯å®é™…ä¸Šï¼ŒBæ ‘çš„é«˜åº¦æ˜¯ä»¥å•ä½ä¸ºå•ä½çš„ï¼Œå› ä¸ºè®¢å•å—çš„å¤§å° <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>10</mn></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.419ex" viewBox="0 -935.7 1308.3 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-31"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-30" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mn>10</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-1"> 2 ^ {10} </script>  ï¼Œä»¥åŠè®¢å•çš„æ•°æ®æ•° <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>40</mn></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.039ex" height="2.419ex" viewBox="0 -935.7 1308.3 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-34"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-30" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mn>40</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-2"> 2 ^ {40} </script> é«˜åº¦å°†æ˜¯ <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>l</mi><mi>o</mi><mi>g</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>40</mn></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>l</mi><mi>o</mi><mi>g</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>10</mn></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></mrow><mo>=</mo><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.067ex" height="2.78ex" viewBox="0 -935.7 12515.1 1197.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-66" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-72" x="800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-61" x="1252" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-63" x="1781" y="0"></use><g transform="translate(2215,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-6F" x="298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-67" x="784" y="0"></use><g transform="translate(1264,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">ï¼ˆ</text></g><g transform="translate(2094,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-34"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-30" x="500" y="0"></use></g></g><g transform="translate(3402,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">ï¼‰</text></g></g><g transform="translate(6447,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-6F" x="298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMATHI-67" x="784" y="0"></use><g transform="translate(1264,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">ï¼ˆ</text></g><g transform="translate(2094,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-31"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-30" x="500" y="0"></use></g></g><g transform="translate(3402,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">ï¼‰</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-3D" x="10958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/company/sberbank/blog/413749/&amp;usg=ALkJrhjjG34wRqPF39djBDUJzWPJMbGtXg#MJMAIN-34" x="12014" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>l</mi><mi>o</mi><mi>g</mi><mrow class="MJX-TeXAtom-ORD"><mo>ï¼ˆ</mo></mrow><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mn>40</mn></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo>ï¼‰</mo></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi>l</mi><mi>o</mi><mi>g</mi><mrow class="MJX-TeXAtom-ORD"><mo>ï¼ˆ</mo></mrow><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mn>10</mn></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo>ï¼‰</mo></mrow></mrow><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ frac {logï¼ˆ2 ^ {40}ï¼‰} {logï¼ˆ2 ^ {10}ï¼‰} = 4 </script>  ã€‚ </p><br><p>  Apache Ignite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å–œæ¬¢å¹¶å‘</a> ã€‚ å› æ­¤ï¼Œæ ‘æ”¯æŒç«äº‰æ€§ä¿®æ”¹ã€‚ åœ¨æ“ä½œæ—¶ï¼Œä¸€ä¸ªé¡µé¢è¢«é˜»æ­¢ï¼Œä½†æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šä¿®æ”¹æ ‘çš„å…¶ä½™éƒ¨åˆ†ï¼Œå› æ­¤éœ€è¦è¿›è¡Œç¬¬äºŒæ¬¡è¯»å–ã€‚ è¿™æ ·ç¨‹åºå°±å¯ä»¥åˆ°è¾¾æ ¹æºã€‚ </p><br><p> åˆšå¼€å§‹ï¼Œæˆ‘ä¸äº†è§£æ­¤ç±»åŠŸèƒ½çš„å«ä¹‰ï¼Œå› ä¸ºç£ç›˜é€Ÿåº¦å¾ˆæ…¢ï¼Œå¹¶ä¸”ä¸€ä¸ªçº¿ç¨‹å°†å¹³é™åœ°å¤„ç†æ‰€æœ‰I / Oæ“ä½œã€‚ æ˜¾ç„¶ï¼Œä»ç£ç›˜åŠ è½½çš„èŠ‚ç‚¹ä¸­çš„æœç´¢èŠ±è´¹å¾ˆå°‘ï¼Œåœ¨æ­¤æœŸé—´ï¼Œæ‚¨å¯ä»¥ç”¨å…¶ä»–æ“ä½œåŠ è½½ç£ç›˜ï¼Œä½†æ˜¯åå¤å°è¯•ä¼šåƒå…‰å¢ç›Šã€‚ ä½†æ˜¯ï¼Œåæ¥æˆ‘æƒ³åˆ°ï¼Œåœ¨æ­¤å®ç°ä¸­ï¼ŒèŠ‚ç‚¹åœ¨ä¿®æ”¹åå¹¶æ²¡æœ‰ç«‹å³åˆ·æ–°åˆ°ç£ç›˜ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­æŒ‚äº†ä¸€æ®µæ—¶é—´ï¼Œä»¥ä¾¿ç«‹å³åº”ç”¨è®¸å¤šä¿®æ”¹ã€‚ ç”±äºé¢„å…ˆå†™å…¥æ—¥å¿—ï¼Œæ²¡æœ‰æ•°æ®ä¸¢å¤±ã€‚ å…³äºå®ƒçš„æ›´å¤šä¿¡æ¯å°†åœ¨æ–‡ç« çš„ç»“å°¾ã€‚ </p><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ·»åŠ é¡¹ç›®çš„ä»£ç ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doPut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T row, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> needOld)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException </span></span>{ checkDestroyed(); Put p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Put(row, needOld); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { <span class="hljs-comment"><span class="hljs-comment">// Go down with retries. p.init(); Result res = putDown(p, p.rootId, 0L, p.rootLvl); switch (res) { case RETRY: case RETRY_ROOT: checkInterrupted(); continue; case FOUND: // We may need to insert split key into upper level here. if (!p.isFinished()) { // It must be impossible to have an insert higher than the current root, // because we are making decision about creating new root while keeping // write lock on current root, so it can't concurrently change. assert p.btmLvl &lt;= getRootLevel(); checkInterrupted(); continue; } return p.oldRow; default: throw new IllegalStateException("Result: " + res); } } } catch (IgniteCheckedException e) { throw new IgniteCheckedException("Runtime failure on row: " + row, e); } catch (RuntimeException e) { throw new IgniteException("Runtime failure on row: " + row, e); } catch (AssertionError e) { throw new AssertionError("Assertion error on row: " + row, e); } finally { checkDestroyed(); } } /** * @param p Put. * @param pageId Page ID. * @param fwdId Expected forward page ID. * @param lvl Level. * @return Result code. * @throws IgniteCheckedException If failed. */ private Result putDown(final Put p, final long pageId, final long fwdId, final int lvl) throws IgniteCheckedException { assert lvl &gt;= 0 : lvl; final long page = acquirePage(pageId); try { for (;;) { // Init args. p.pageId = pageId; p.fwdId = fwdId; Result res = read(pageId, page, search, p, lvl, RETRY); switch (res) { case GO_DOWN: case GO_DOWN_X: assert lvl &gt; 0 : lvl; assert p.pageId != pageId; assert p.fwdId != fwdId || fwdId == 0; res = p.tryReplaceInner(pageId, page, fwdId, lvl); if (res != RETRY) // Go down recursively. res = putDown(p, p.pageId, p.fwdId, lvl - 1); if (res == RETRY_ROOT || p.isFinished()) return res; if (res == RETRY) checkInterrupted(); continue; // We have to insert split row to this level or it is a retry. case FOUND: // Do replace. assert lvl == 0 : "This replace can happen only at the bottom level."; return p.tryReplace(pageId, page, fwdId, lvl); case NOT_FOUND: // Do insert. assert lvl == p.btmLvl : "must insert at the bottom level"; assert p.needReplaceInner == FALSE : p.needReplaceInner + " " + lvl; return p.tryInsert(pageId, page, fwdId, lvl); default: return res; } } } finally { if (p.canRelease(pageId, lvl)) releasePage(pageId, page); } }</span></span></code> </pre> <br><p> å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨æ£€æµ‹åˆ°ä½ç½®åï¼Œä»£ç å°†åˆ†æ”¯åˆ°<code>replace</code>å’Œ<code>insert</code> ã€‚  <code>remove</code>ä»£ç æ— æ³•å†è§‚çœ‹ã€‚ åŸºæœ¬æœºåˆ¶æ˜¯ï¼Œæ ¹æ®æ“ä½œï¼š <code>Get</code> ï¼Œ <code>Put</code>æˆ–<code>Remove</code> ï¼Œåå¤å°è¯•éå†æ ‘å’Œä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ã€‚ </p><br><p>  <code>Invoke</code>ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œï¼Œåªæœ‰æ“ä½œæ˜¯åœ¨è®°å½•çš„å‰¯æœ¬ä¸­è¿›è¡Œçš„ï¼Œç„¶åç¡®å®šå…¶ç±»å‹ï¼šç”¨äºè¯»å–çš„<code>NOOP</code> ï¼Œç”¨äºåˆ é™¤çš„<code>REMOVE</code>å’Œç”¨äºæ›´æ–°æˆ–æ·»åŠ çš„<code>PUT</code> ï¼Œç„¶åç”Ÿæˆç›¸åº”çš„<code>Put</code>æˆ–<code>Remove</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶åº”ç”¨äºæ ‘ä¸­çš„è®°å½•ã€‚ </p><br><h1 id="ispolzovanie"> ä½¿ç”¨æ–¹æ³• </h1><br><p> ä¸‹é¢ï¼Œæˆ‘å°†ä»”ç»†ç ”ç©¶ä¸¤ä¸ª<code>BPlusTree</code> ï¼š <code>CacheDataTree</code>å’Œ<code>PendingEntriesTree</code> ã€‚ è¿‡åº¦æ˜¯ç´¢å¼•çš„å®ç°-è¿™æ˜¯ä¸€ä¸ªå•ç‹¬è®¨è®ºçš„ä¸»é¢˜ï¼Œæˆ‘è¿˜æ²¡æœ‰å‡†å¤‡å¥½è¿›è¡Œè®¨è®ºã€‚ </p><br><p> åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘å°†æ¾„æ¸…ä¸€ä¸‹ï¼Œæœ¬åœ°åˆ†å¸ƒå¼åœ°å›¾å…·æœ‰<code>IgniteCache</code>åŠŸèƒ½ï¼Œç§°ä¸º<code>IgniteCache</code>ä»¥ä¸‹ç®€ç§°ä¸ºç¼“å­˜ã€‚ </p><br><h2 id="cachedatatree"> <code>CacheDataTree</code> </h2> <br><p>  <code>CacheDataTree</code>æ˜¯å¤šä¸ª<code>IgniteCache</code>åˆ°ç£ç›˜çš„æ˜ å°„ã€‚ æ’åºæ˜¯å¤šçº§çš„ï¼šé¦–å…ˆæŒ‰ç¼“å­˜IDæ’åºä»¥å°†ä¸€ä¸ªç¼“å­˜ä¸­çš„é”®åˆ†ç»„ï¼Œç„¶åæŒ‰å“ˆå¸Œæ’åºã€‚ </p><br><p>  <code>CacheDataTree</code>ä¸ä¼šåœ¨è¯¥èŒƒå›´å†…è¿›è¡Œè¿­ä»£ï¼Œå› ä¸ºç´¢å¼•æ˜¯åœ¨<code>H2Tree extends BPlusTree</code>çš„ç»§æ‰¿äººä¸­å®ç°çš„ï¼Œ <code>H2Tree extends BPlusTree</code> ï¼Œå› æ­¤æ’åºçš„ç‰¹å®šç±»å‹å¹¶ä¸é‡è¦ï¼šä»»ä½•<code>put</code>å’Œ<code>get</code>æ“ä½œå°±è¶³å¤Ÿäº†ã€‚ æ¯”è¾ƒå“ˆå¸Œæ¯”å¯¹è±¡å¿«ã€‚ ä½†æ›´é‡è¦çš„æ˜¯ï¼Œç»Ÿä¸€çš„å“ˆå¸Œå°†æ›´å¯†é›†åœ°å¡«å……æ ‘ã€‚ </p><br><p> æ ‘æœ¨ä¿æŒå¹³è¡¡ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šé€€åŒ–ä¸ºåˆ—è¡¨ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°†å‡åŒ€åˆ†å¸ƒçš„å…³é”®å­—æ·»åŠ åˆ°æœç´¢æ ‘ä¸­ï¼Œå®ƒå°†è‡ªåŠ¨ä¿æŒå¹³è¡¡ã€‚ ç”±äºBæ ‘åœ¨å‡ºç°é—®é¢˜æ—¶å¼€å§‹å¹³è¡¡ï¼Œå¹¶ä¸”å“ˆå¸Œå‡åŒ€æ··åˆå¯†é’¥ï¼Œå› æ­¤æŒ‰å“ˆå¸Œæ’åºä¼šé™ä½å¹³è¡¡çš„é¢‘ç‡ã€‚ </p><br><p> åœ¨æœç´¢æ ‘ä¸­ä½¿ç”¨å“ˆå¸Œä¼¼ä¹å¹¶ä¸æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„æƒ³æ³•ï¼Œå®ƒçš„é€»è¾‘å‘å±•å°†å¯¼è‡´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hashæ•°ç»„æ˜ å°„çš„trie</a> ã€‚ </p><br><h2 id="pendingentriestree"> <code>PendingEntriesTree</code> </h2> <br><p>  <code>PendingEntriesTree</code>å­˜å‚¨ç”¨äºéšæ—¶é—´æ¨ç§»çš„æ•°æ®çš„é”®ï¼Œå¹¶æŒ‰è®¾ç½®ä½¿ç”¨ã€‚ æ’åºæ˜¯å¤šçº§çš„ï¼šé¦–å…ˆæŒ‰ç¼“å­˜IDæ’åºä»¥å°†ä¸€ä¸ªç¼“å­˜ä¸­çš„ç»„é”®æ’åºï¼Œç„¶åæŒ‰ç”Ÿå­˜æœŸæ’åºã€‚ æ¥ä¸‹æ¥æ˜¯å¦ä¸€è½®æ¯”è¾ƒ-æ˜¾ç„¶æ˜¯çº¯æŠ€æœ¯çš„ï¼Œä»¥åŒºåˆ†å…ƒç´ ã€‚ ä»æ’åºå¯ä»¥å¾ˆå®¹æ˜“åœ°çŒœå‡ºè¯¥ç±»æ˜¯ç”¨äºæœç´¢èŒƒå›´çš„ã€‚ è¯¥æ ‘å¤åˆ¶ç”¨äºæŠ¢å çš„ç¼“å­˜æ¡ç›®é”®ã€‚ </p><br><p> äº†è§£è¿™ç§å•ç‹¬çš„å†’é™©æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å†é™©è®°</b> <div class="spoiler_text"><p> åœ¨<code>IgniteCacheOffheapManagerImpl.expire()</code>è·å–å…‰æ ‡å¹¶ä»<code>PendingEntriesTree</code>åˆ é™¤æ¡ç›®ã€‚  <code>CacheDataTree</code>ä¸­çš„æ¡ç›®åœ¨é—­åŒ…<code>c</code>ä¸­åˆ é™¤ï¼Œé—­åŒ…<code>c</code>åœ¨å‚æ•°ä¸­ä¼ é€’ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expire</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( GridCacheContext cctx, IgniteInClosure2X&lt;GridCacheEntryEx, GridCacheVersion&gt; c, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> amount )</span></span></span></span></code> </pre> <br><p>  Apache Igniteç›´åˆ°æœ€è¿‘æ‰åœæ­¢æ”¯æŒJava 7ï¼Œå› æ­¤é€šè¿‡åŒ¿åç±»åˆ›å»ºäº†é—­åŒ…ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> IgniteInClosure2X&lt;GridCacheEntryEx, GridCacheVersion&gt; expireC = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteInClosure2X&lt;GridCacheEntryEx, GridCacheVersion&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GridCacheEntryEx entry, GridCacheVersion obsoleteVer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> touch = !entry.isNear(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (log.isTraceEnabled()) log.trace(<span class="hljs-string"><span class="hljs-string">"Trying to remove expired entry from cache: "</span></span> + entry); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entry.onTtlExpired(obsoleteVer)) touch = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (GridCacheEntryRemovedException ignore) { entry = entry.context().cache().entryEx(entry.key()); touch = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (touch) entry.context().evicts().touch(entry, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } };</code> </pre><br><p> æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„æ˜¯<code>GridCacheMapEntry.onTtlExpired()</code>æ–¹æ³•ï¼Œå…¶ä¸­çš„å®è—çº¿ä½äº<code>finally</code>å—ä¸­ã€‚ </p><br><pre> <code class="java hljs">cctx.cache().removeEntry(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> </div></div><br><h1 id="detali-realizacii"> å®æ–½ç»†èŠ‚ </h1><br><h2 id="rabota-so-stranicami-v-offheap"> åœ¨Offheapä¸­å¤„ç†é¡µé¢ </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Offheap</a>æ˜¯ä¸€ç§ä½¿ç”¨åƒåœ¾å›æ”¶å™¨ä»¥æŸç§è¯­è¨€ä¼˜åŒ–æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„æŠ€æœ¯ã€‚ </p><br><p> è’è°¬çš„æ˜¯ï¼Œç”±äºåƒåœ¾æ”¶é›†å™¨çš„å‡ºç°ï¼Œä¸€åˆ‡éƒ½å˜æ…¢äº†ï¼Œé€šå¸¸åƒåœ¾æ”¶é›†å™¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„æ€§èƒ½</a>æŸå¤±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æƒ¨é‡</a> ã€‚ å³ä½¿æ˜¯å¤§å †æœ¬èº«ä¹Ÿä¸æ˜¯é—®é¢˜ï¼Œå› ä¸º æ”¶é›†å™¨ç«äº‰æ¿€çƒˆï¼ˆä¾‹å¦‚Javaä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CMSå’ŒG1</a> ï¼‰ï¼Œå¹¶ä¸”æœåŠ¡å™¨å…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•°åä¸ªå†…æ ¸</a> ã€‚ å½“ç„¶ï¼Œæ”¶é›†å™¨ä¼šå‘åº”ç”¨ç¨‹åºæ·»åŠ æ„å¤–çš„æš‚åœï¼Œè¿™å¯¹äºæ¸¸æˆæ¥è¯´å¾ˆé‡è¦ï¼Œä½†å¯¹äºæ•°æ®åº“æ¥è¯´æ˜¯å¯ä»¥å®¹å¿çš„ã€‚ </p><br><p> ä½†æ˜¯çœŸæ­£çš„é—®é¢˜æ˜¯åœ¨å¤§å †ä¸Šè¿åäº†ä¸–ä»£å‡è®¾ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä¸–ä»£å‡è®¾</b> <div class="spoiler_text"><p>  GCä¼˜åŒ–ä½¿ç”¨ä¸–ä»£å‡è®¾ã€‚ è¯¥å‡è®¾å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬ï¼šå¼ºå’Œå¼±ã€‚ </p><br><p>  <strong>ä¸–ä»£å‡è¯´è–„å¼±ï¼š</strong>å¤§å¤šæ•°ç‰©ä½“éƒ½æ­»äºå¹´è½»ã€‚ </p><br><p>  <strong>å…³äºä¸–ä»£çš„ä¸€ä¸ªå¼ºæœ‰åŠ›çš„å‡è®¾ï¼š</strong>ç‰©ä½“è¶Šè€ï¼Œå®ƒçš„å¯¿å‘½å°±è¶Šé•¿ã€‚ </p><br><p> å¼ºæœ‰åŠ›çš„å‡è®¾æ„å‘³ç€è¾ƒå¼±çš„å‡è®¾ï¼Œåä¹‹åˆ™ä¸ç„¶ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼ŒGCåº”è¯¥æ»¡è¶³äºæ»¡è¶³å¼±å‡è®¾ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚ </p><br><p> å¦‚æœæ‚¨æƒ³æ›´å¥½åœ°ç†è§£ä»¥ä¸‹ä¸»é¢˜ï¼Œè¯·æŸ¥çœ‹Alexey Shipilevå…³äºJavaä¸­æ–°GCçš„è®¨è®ºï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2</a> ã€‚ </p></div></div><br><p> äº‹æƒ…å°±æ˜¯è¿™æ ·ï¼Œåœ¨PDSå‡ºç°ä¹‹å‰ï¼ŒApache Igniteä¸»è¦è¢«å®šä½ä¸ºæœåŠ¡å’Œç£ç›˜æ•°æ®åº“ï¼ˆä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hadoop</a> ï¼‰ä¹‹é—´çš„ç¼“å­˜ã€‚ å› æ­¤ï¼ŒIgniteä¸­çš„åœ°å›¾ç§°ä¸º<code>IgniteCache</code>å¹¶å…·æœ‰ç›¸åº”çš„æ‹‰ä¼¸åŠŸèƒ½ã€‚ ç¼“å­˜åªæ˜¯è¿åäº†ä¸–ä»£å‡è®¾-åœ¨å…¶ä¸­ï¼Œå¯¹è±¡è¢«åˆ é™¤çš„å¯èƒ½æ€§éšæ—¶é—´è€Œå¢åŠ ã€‚ å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®çš„Offheapå¯ä»¥æé«˜æ€§èƒ½ã€‚ </p><br><p> æ›´å¤šå¥–é‡‘ï¼š </p><br><ul><li> é€šè¿‡Offheapï¼Œå¯ä»¥æ›´è½»æ¾åœ°å®ç°åŒ…å«å¤šä¸ª<code>Integer.MAX_VALUE</code>å…ƒç´ çš„ç»“æ„ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚æœæ‚¨çš„å­˜å‚¨ç©ºé—´å°‘äº32GBï¼Œåˆ™é“¾æ¥å°†é‡4ä¸ªå­—èŠ‚</a> ï¼Œä»è€ŒèŠ‚çœäº†å‡ GBçš„ç©ºé—´ã€‚ </li><li> ç”±äºæ”¶é›†å™¨å»ºç«‹äº†å¯¹è±¡å›¾ï¼Œå› æ­¤æ¶ˆè€—çš„å†…å­˜ä¸å¯¹è±¡çš„æ•°é‡æˆæ¯”ä¾‹ã€‚ å¯¹è±¡çš„æ•°é‡ä¸å †æˆæ­£æ¯”ã€‚ æ”¶é›†å™¨è¿˜æ¶ˆè€—CPUï¼Œä¾‹å¦‚ï¼Œæœ€å¥½å°†å…¶ç”¨äºæ•°æ®å‹ç¼©ã€‚ </li><li> åœ¨éå¸¸å¤§çš„å †ä¸­ï¼Œå³ä½¿ä»æ•´ä½“ä¸Šä¸è¿åä¸–ä»£å‡è®¾ï¼Œä»ç„¶ä¼šæœ‰å¾ˆå¤šç»å¯¹ä»·å€¼çš„æ—§å¯¹è±¡è¿åå®ƒã€‚ </li></ul><br><p> ç”±äºæ•°æ®éšåè¢«å‘é€åˆ°ç£ç›˜ï¼Œå› æ­¤å¯¹è±¡é€šè¿‡<code>unsafe</code>ç›´æ¥è¢«åºåˆ—åŒ–åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¯¥å†…å­˜åŒºåŸŸç”¨äºI / Oç¼“å†²åŒºã€‚ </p><br><h2 id="write-ahead-log"> æå‰å†™æ—¥å¿— </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œé¢„å†™æ—¥å¿—â€</a>æ˜¯å…·æœ‰çº¿æ€§ç»“æ„çš„æ“ä½œçš„æ—¥å¿—ï¼Œä¸æ ‘ä¸åŒï¼Œæ·»åŠ è¯¥æ—¥å¿—çš„æˆæœ¬ä¸ºå¸¸æ•°ã€‚ è¯¥æ ‘çš„æ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œå¦‚æœç”±äºå€’å¡Œè€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œåˆ™å¯ä»¥é€šè¿‡åº”ç”¨ä»ä¸Šæ¬¡ä¿å­˜çŠ¶æ€å¼€å§‹çš„æ“ä½œä»æ—¥å¿—ä¸­æ¢å¤æ•°æ®ã€‚ ç»“æœæ˜¯åœ¨ä¸æŸå®³å¯é æ€§çš„æƒ…å†µä¸‹æé«˜äº†æ€§èƒ½ã€‚ æˆ‘å»ºè®®æ‚¨çœ‹ä¸€ä¸‹<code>IgniteWriteAheadLogManager</code>ç•Œé¢-æœ‰è¯¦ç»†çš„æ–‡æ¡£ã€‚ </p><br><h2 id="obhod-uzla"> èŠ‚ç‚¹æ—è·¯ </h2><br><p> ç”±äºBæ ‘ä¸­çš„èŠ‚ç‚¹ä¸å°ï¼Œå› æ­¤äºŒè¿›åˆ¶æœç´¢ä¼šç»•è¿‡å®ƒä»¬ã€‚ ä¸ºæ­¤ï¼Œ <code>BPlusTree.GetPageHandler</code>ç±»çš„åä»£ï¼Œå¹¶ä¸”å¯¹äºä¸åŒçš„æ“ä½œï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">äºŒè¿›åˆ¶æœç´¢å®ç°</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findInsertionPoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lvl, BPlusIO&lt;L&gt; io, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> low, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cnt, L row, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> shift)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IgniteCheckedException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> row != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> high = cnt - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (low &lt;= high) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mid = (low + high) &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cmp = compare(lvl, io, buf, mid, row); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmp == <span class="hljs-number"><span class="hljs-number">0</span></span>) cmp = -shift; <span class="hljs-comment"><span class="hljs-comment">// We need to fix the case when search row matches multiple data rows. //noinspection Duplicates if (cmp &lt; 0) low = mid + 1; else if (cmp &gt; 0) high = mid - 1; else return mid; // Found. } return -(low + 1); // Not found. }</span></span></code> </pre> <br><p>  <code>BPlusTree</code>ä¸åŒåä»£çš„<code>compare</code>æ–¹æ³•ä¸åŒã€‚ è´Ÿç´¢å¼•ç¼–ç ä¸å­˜åœ¨çš„å…ƒç´ çš„ä½ç½®ã€‚ æ ‡å‡†åº“ä¸­çš„<code>Collections.binarySearch</code>ä¼šæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ </p><br><p> è¯·æ³¨æ„ä»¥ä¸‹å‡ è¡Œã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmp == <span class="hljs-number"><span class="hljs-number">0</span></span>) cmp = -shift;</code> </pre> <br><p> å¯¹äº<code>findOne</code>æ“ä½œï¼Œæ­¤ä»£ç ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸º  <code>shift</code>è®¾ç½®ä¸ºé›¶ï¼Œå³ å¦‚æœæ ‘ä¸­æœ‰ç›¸åŒçš„é”®ï¼Œåˆ™å®ƒä»¬å°†æ‰¾åˆ°å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœä»¥è¿™ç§æ–¹å¼å¯»æ‰¾èŒƒå›´ï¼Œåˆ™å…ƒç´ å°†ä¸¢å¤±ï¼Œå› æ­¤<code>shift</code>è®¾ç½®ä¸º<code>1</code> ã€‚ ç»“æœï¼Œ <em>å³ä½¿å…ƒç´ å­˜åœ¨</em> ï¼Œæœç´¢<em>ä¹Ÿæ‰¾ä¸åˆ°å®ƒ</em> ï¼Œä½†æ˜¯æœç´¢èŒƒå›´å¹¶ä¸é‡è¦ã€‚ </p></div></div><br><h2 id="spisok-listov"> åºŠå•æ¸…å• </h2><br><p> ä¸ºäº†æœ‰æ•ˆåœ°ç»•è¿‡èŒƒå›´ï¼Œå°†å·¥ä½œè¡¨ç»‘å®šåˆ°ä¸€ä¸ªåˆ—è¡¨ã€‚ è¿”å›å·¥ä½œè¡¨ä¹‹é—´çš„<code>BPlusTree.ForwardCursor</code>ä½œä¸ºæœç´¢ç»“æœã€‚ æ˜¾ç„¶ï¼Œå…‰æ ‡é€šè¿‡å¹¶ä¸ä¸æ ‘ä¸­çš„å…¶ä»–æ“ä½œéš”ç¦»ï¼Œå› ä¸º ä¼ é€’æ—¶ï¼Œä»…åœ¨ä¸€é¡µä¸Šè¿›è¡Œé”å®šã€‚ æˆ‘æ²¡æœ‰æ‰¾åˆ°ä¿æŠ¤è®¿é—®æ¸¸æ ‡æ–¹æ³•çš„åŒæ­¥æœºåˆ¶ã€‚ </p><br><h1 id="zaklyuchenie"> ç»“è®º </h1><br><p> ç”±äºä¸å…¶ä»–å…³ç³»æ•°æ®åº“ç›¸æ¯”ï¼ŒApache Igniteä¸­çš„B +æ ‘è¿˜å¾ˆå¹´è½»ï¼Œå› æ­¤æˆ‘ä»¬è·å¾—äº†å¯ç”¨äºç”Ÿäº§çš„B +æ ‘çš„å¿…è¦é›†åˆï¼š </p><br><ul><li>  <strong>WAL</strong>æä¾›å»‰ä»·çš„å®‰å…¨æ€§ï¼Œå› æ­¤ï¼Œå¾ˆå°‘åœ¨ç£ç›˜ä¸Šæ›´æ–°æ ‘ã€‚ </li><li> åºåˆ—åŒ–å½¢å¼çš„æ•°æ®<strong>åˆ†æ‹†</strong> ã€‚ </li><li>  <strong>å¹¶å‘æ€§</strong> -ç”¨äºå°†æ ‘çš„ä¸€éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN413749/">https://habr.com/ru/post/zh-CN413749/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN413739/index.html">æˆ‘ä»¬å¦‚ä½•æ‰«ææ•´ä¸ªäº’è”ç½‘ä»¥åŠæˆ‘ä»¬å­¦åˆ°äº†ä»€ä¹ˆ</a></li>
<li><a href="../zh-CN413741/index.html">å®ƒæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ï¼šWWDC Redmadrobotå›¢é˜Ÿå°è±¡</a></li>
<li><a href="../zh-CN413743/index.html">åªéœ€å•å‡»å‡ ä¸‹å³å¯å¯åŠ¨LAMPå’Œå…¶ä»–æ•°ç™¾ç§Webåº”ç”¨ç¨‹åº</a></li>
<li><a href="../zh-CN413745/index.html">ä¸€æ¬¡ä¸ºäººä½“æ‰€æœ‰ç”µå­è®¾å¤‡å¼€å‘äº†æ— çº¿ç”µæºç³»ç»Ÿ</a></li>
<li><a href="../zh-CN413747/index.html">é€šè¿‡NULL</a></li>
<li><a href="../zh-CN413751/index.html">Ruslan Chereminå’ŒMaxim Gramin-åœ¨jug.msk.ruä¸Šä¸ç¯å¢ƒåˆä½œ</a></li>
<li><a href="../zh-CN413753/index.html">å¤©ä¸Šçš„çœ¼ç›ï¼šå·¡é€»æ— äººæœºï¼Œå¯è¯†åˆ«äººç¾¤å’Œå…¬å…±åœºæ‰€çš„æš´åŠ›è¡Œä¸º</a></li>
<li><a href="../zh-CN413757/index.html">å•†ä¸šé¡¹ç›®ä¸­çš„æ•°æ®åº“ï¼šæ€ä¹ˆåŠï¼Ÿ</a></li>
<li><a href="../zh-CN413759/index.html">å¥½å¥‡å¿ƒåœ¨æ•°åäº¿å¹´å‰çš„ç«æ˜Ÿä¸Šå‘ç°äº†æœ‰æœºç‰©</a></li>
<li><a href="../zh-CN413761/index.html">å¦‚ä½•é˜²æ­¢Windows 10æ›´æ–°åé‡æ–°å¯åŠ¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>