<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚öïÔ∏è üí© üõ©Ô∏è Barrymore, quel est le buzz autour de Voximplant? Sockets Web impl√©ment√©s, monsieur üò¥ üë®üèº‚Äçüç≥ ‚ú≥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebSocket est une norme progressive pour la communication en duplex int√©gral (bidirectionnelle) entre un client et un service tiers en temps r√©el. Les...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Barrymore, quel est le buzz autour de Voximplant? Sockets Web impl√©ment√©s, monsieur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/476902/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/go/qt/fp/goqtfpd9-lymms4l2uvqlrjghbi.png"></div><br>  WebSocket est une norme progressive pour la communication en duplex int√©gral (bidirectionnelle) entre un client et un service tiers en temps r√©el.  Les sockets Web sont utilis√©es pour organiser un √©change de donn√©es continu sans demandes HTTP suppl√©mentaires. <br><br>  Et nous sommes heureux de vous informer que tout cela est devenu possible dans Voximplant gr√¢ce au nouveau module <a href="https://voximplant.com/docs/references/voxengine">VoxEngine</a> , qui s'appelle - surprise - <a href="https://voximplant.com/docs/references/voxengine/websocket">WebSocket</a> .  D√©sormais, vous pourrez transf√©rer du texte et de l'audio, en tirant pleinement parti des prises Web.  Autrement dit, vous disposez d'un autre outil pour mettre √† niveau votre application. <br><br>  Dans cet article, vous apprendrez √† cr√©er une connexion WebSocket sortante, √† transf√©rer un flux audio via celui-ci et √† le convertir en texte √† l'aide de l' <a href="https://cloud.google.com/speech-to-text/">API Google Cloud Speech-to-Text</a> . <a name="habracut"></a><br><blockquote>  Veuillez noter que Voximplant a une fonctionnalit√© int√©gr√©e pour convertir la parole en texte en temps r√©el sous le contr√¥le du <a href="https://voximplant.com/docs/references/voxengine/asr">module ASR</a> .  Ce module utilise des fonctions de Google, Yandex et Tinkoff, voir les d√©tails <a href="https://voximplant.com/blog/speech-to-text-asr">ici</a> . <br><br>  L'article actuel d√©crit le cas o√π vous souhaitez utiliser un service tiers pour convertir la parole en texte et / ou d√©penser de l'argent depuis son compte, et non depuis le compte Voximplant. </blockquote><br>  Notre module propose deux formats de travail: <br><ul><li>  cr√©er une connexion sortante; </li><li>  recevoir une connexion entrante et cr√©er une prise Web pour celle-ci. </li></ul><br><h3>  Sortant </h3><br>  La premi√®re chose que vous devez faire lors de la cr√©ation d'une connexion sortante est d'ex√©cuter le script VoxEngine.  Appelez ensuite la m√©thode <a href="https://voximplant.com/docs/references/voxengine/websocket">VoxEngine.createWebSocket</a> , qui cr√©era l'objet <a href="https://voximplant.com/docs/references/voxengine/websocket/websocket">WebSocket</a> .  Cette m√©thode prend 2 param√®tres: URL au format 'wss: // + domaine + chemin' et protocoles (facultatif).  Voici √† quoi cela ressemblerait dans le code: <br><br><pre><code class="javascript hljs">VoxEngine.addEventListener(AppEvents.CallAlerting, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webSocket = VoxEngine.createWebSocket( <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span> <span class="hljs-string"><span class="hljs-string">"wss://your_link/"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       });</span></span></code> </pre> <br>  Si tout fonctionne, la m√©thode <a href="https://voximplant.com/docs/references/voxengine/call">call.sendMediaTo</a> enverra le flux audio au socket, et <a href="https://voximplant.com/docs/references/voxengine/websocket/websocket">WebSocket.send</a> , √† son tour, enverra le flux audio d√©cod√© au format JSON √† travers elle.  En cons√©quence, vous recevrez des messages du service qui traite les demandes. <br><br>  La m√©thode <a href="https://voximplant.com/docs/references/voxengine/websocket/websocket">WebSocket.close</a> est n√©cessaire pour fermer la connexion.  Veuillez noter que la connexion peut √™tre ferm√©e √† la fois c√¥t√© client et c√¥t√© serveur. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zd/lg/wo/zdlgwo-ftmjjyd0py1jviu_hrao.png"></div><br><h3>  Bo√Æte de r√©ception </h3><br>  Afin de permettre les connexions entrantes, il est n√©cessaire de signaler cela via <a href="https://voximplant.com/docs/references/voxengine/websocket">VoxEngine.allowWebSocketConnections</a> , ainsi que de vous abonner √† l'√©v√©nement <a href="https://voximplant.com/docs/references/voxengine/appevents">AppEvents.WebSocket</a> .  Il sera alors possible d'accepter la connexion entrante et d'obtenir l'objet WebSocket: event.WebSocket.  Voir le code ci-dessous: <br><br><pre> <code class="javascript hljs">VoxEngine.allowWebSocketConnections(); VoxEngine.addEventListener(AppEvents.WebSocket, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       });</span></span></code> </pre> <br>  Pour cr√©er une socket Web entrante, vous avez besoin du contr√¥le accessSecureURL.  Il peut √™tre extrait de l'√©v√©nement <a href="https://voximplant.com/docs/references/voxengine/appevents">AppEvents.Started</a> ou de la r√©ponse √† la demande HTTP qui a d√©marr√© la session.  Notez que ¬´https¬ª doit √™tre remplac√© par ¬´wss¬ª dans l'URL. <br><br>  Les √©tapes restantes sont identiques √† celles pr√©sent√©es dans le sch√©ma de connexion sortante. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3s/nn/8l/3snn8l5svneeye9byc-lmxqiems.png"></div><br><h2>  Vous aurez besoin </h2><br>  Pour impl√©menter la technologie WebSocket et la reconnaissance vocale dans votre application, vous aurez besoin de: <br><ul><li>  Compte Voximplant.  Si vous ne l'avez pas, n'h√©sitez pas √† vous inscrire <a href="https://manage.voximplant.com/auth/sign_up">ici</a> ; </li><li>  Application Voximplant, ainsi qu'un script, une r√®gle et un seul utilisateur.  Tout cela sera cr√©√© dans ce tutoriel; </li><li>  backend simple (nous allons d√©marrer le serveur sur node.js) avec la biblioth√®que cliente Cloud connect√©e pour l'API Speech-to-Text; </li><li>  client Web pour <a href="https://phone.voximplant.com/">passer</a> un appel (nous utiliserons le t√©l√©phone Web sur <a href="https://phone.voximplant.com/">phone.voximplant.com</a> ). </li></ul><br><h2>  1. Param√®tres VOXIMPLANT </h2><br>  Pour commencer, connectez-vous √† votre compte √† l' <a href="https://manage.voximplant.com/auth">adresse manage.voximplant.com/auth</a> .  Dans le menu de gauche, cliquez sur "Applications", cr√©ez-en un nouveau et nommez-le websocket.  Allez dans votre application, passez √† l'onglet Scripts, cr√©ez un script et collez-y le code suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(Modules.WebSocket); VoxEngine.addEventListener(AppEvents.CallAlerting, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ call = e.call; call.answer(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webSocket = VoxEngine.createWebSocket( <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span> <span class="hljs-string"><span class="hljs-string">"wss://your_ngrok_link/"</span></span>); webSocket.addEventListener(WebSocketEvents.ERROR, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.ERROR"</span></span>); call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.ERROR"</span></span>); }); webSocket.addEventListener(WebSocketEvents.CLOSE, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.CLOSE: "</span></span> + e.reason); call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.CLOSE: "</span></span> + e.reason); }); webSocket.addEventListener(WebSocketEvents.OPEN, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.OPEN"</span></span>); Logger.write(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(e)) call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.OPEN"</span></span>); }); webSocket.addEventListener(WebSocketEvents.MESSAGE, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.MESSAGE: "</span></span> + e.text); call.sendMessage(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: WebSocketEvents.MESSAGE: "</span></span> + e.text); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.text == <span class="hljs-string"><span class="hljs-string">"Hi there, I am a WebSocket server"</span></span>) { call.sendMediaTo(webSocket, { <span class="hljs-attr"><span class="hljs-attr">encoding</span></span>: WebSocketAudioEncoding.ULAW, <span class="hljs-string"><span class="hljs-string">"tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"MyAudioStream"</span></span>, <span class="hljs-string"><span class="hljs-string">"customParameters"</span></span>: { <span class="hljs-string"><span class="hljs-string">"param1"</span></span>: <span class="hljs-string"><span class="hljs-string">"12345"</span></span> } }); } }); call.addEventListener(CallEvents.Disconnected, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: terminating in 1 sec"</span></span>); webSocket.close(); setTimeout(VoxEngine.terminate, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }); });</code> </pre> <br>  Ce script VoxEngine envoie un flux audio √† WebSocket et suit √©galement ses √©v√©nements (ERREUR, FERMER, OUVRIR, MESSAGE).  Nous pouvons nous plonger dans les d√©tails du script un peu plus tard. <br><br>  Maintenant, allons dans l'onglet ¬´Routage¬ª, cliquez sur la ¬´Nouvelle r√®gle¬ª et appelons-la socketRule.  Maintenant, il ne reste plus qu'√† s√©lectionner votre script, et laisser le masque par d√©faut (. *). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/st/mh/ih/stmhihjv-awc5zwu0-gb842u0hq.png" width="80%"></div><br>  La derni√®re chose que vous devez faire √† ce stade est de cr√©er un utilisateur.  Basculez vers l'onglet ¬´Utilisateurs¬ª, cliquez sur ¬´Cr√©er un utilisateur¬ª, sp√©cifiez un nom (par exemple, socketUser) et un mot de passe, puis cliquez sur ¬´Cr√©er¬ª.  Nous aurons besoin de cette paire nom d'utilisateur / mot de passe pour l'authentification dans le client Web √† la derni√®re √©tape. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wu/pj/wg/wupjwgi1ewke4tahase9so2q_ku.png" width="80%"></div><br>  La configuration est termin√©e, mais avant de commencer √† cr√©er le serveur, regardons comment fonctionne le module WebSocket dans notre sc√©nario. <br><br><h2>  2. D√©tails du script </h2><br>  Le module WebSocket permet aux d√©veloppeurs d'ouvrir une connexion stable et d'envoyer des donn√©es via celle-ci.  Pour utiliser ce module, nous devons le connecter au tout d√©but du script: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(Modules.WebSocket);</code> </pre> <br>  Gr√¢ce √† la m√©thode createWebSocket, nous d√©terminons l'URL et les protocoles (facultatif).  Vous pouvez apprendre comment obtenir l'URL de WebSocket dans la section suivante. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webSocket = VoxEngine.createWebSocket( <span class="hljs-comment"><span class="hljs-comment">/*url*/</span></span> <span class="hljs-string"><span class="hljs-string">"wss://your_ngrok_link/"</span></span>);</code> </pre> <br>  Apr√®s avoir cr√©√© l'objet WebSocket, nous continuons √† g√©rer l'appel √† l'int√©rieur du gestionnaire.  √Ä savoir, nous envoyons le m√©dia √† l'objet WebSocket √† l'aide de la m√©thode call.sendMediaTo. <br><br>  Ici, vous pouvez d√©finir le format d'encodage pr√©f√©r√©, la balise et certains param√®tres personnalis√©s.  Si vous ne d√©finissez pas l'encodage, PCM8 sera utilis√© par d√©faut. <br><br>  Cette m√©thode est appel√©e lorsqu'un <a href="https://voximplant.com/docs/references/voxengine/websocket/websocketevents">message de</a> connexion r√©ussi est <a href="https://voximplant.com/docs/references/voxengine/websocket/websocketevents">re√ßu</a> .  Dans notre sc√©nario, le code d'appel ressemble √† ceci: <br><br><pre> <code class="javascript hljs">call.sendMediaTo(webSocket, { <span class="hljs-attr"><span class="hljs-attr">encoding</span></span>: WebSocketAudioEncoding.ULAW, <span class="hljs-string"><span class="hljs-string">"tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"MyAudioStream"</span></span>, <span class="hljs-string"><span class="hljs-string">"customParameters"</span></span>: { <span class="hljs-string"><span class="hljs-string">"param1"</span></span>: <span class="hljs-string"><span class="hljs-string">"12345"</span></span> } });</code> </pre> <br>  Tous les autres √©v√©nements WebSocket que vous voyez dans le code sont destin√©s au d√©bogage; ils envoient des informations au journal de la session Voximplant.  Vous pouvez les supprimer si vous le souhaitez. <br><br>  Enfin, nous ajoutons le gestionnaire de fin de transfert de donn√©es correct.  Dans notre cas, la session Voximplant mettra fin √† son travail 1 seconde apr√®s la fin de l'appel √©tabli ( <a href="https://voximplant.com/docs/references/voxengine/callevents">D√©connect√©</a> ): <br><br><pre> <code class="javascript hljs">call.addEventListener(CallEvents.Disconnected, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ Logger.write(<span class="hljs-string"><span class="hljs-string">"LOG OUTGOING: terminating in 1 sec"</span></span>); webSocket.close(); setTimeout(VoxEngine.terminate, <span class="hljs-number"><span class="hljs-number">1000</span></span>); });</code> </pre> <br>  Maintenant que la logique du script est claire, il est temps de passer √† la partie suivante, tr√®s importante de notre exemple. <br><br><h2>  3. Backend </h2><br>  Tout d'abord, assurez-vous que Node.js. est install√© sur votre ordinateur.  Vous pouvez le t√©l√©charger sur <a href="https://nodejs.org/en/download/">le site</a> principal de <a href="https://nodejs.org/en/download/">Node.js.</a>  Ex√©cutez ensuite les commandes suivantes dans la fen√™tre du terminal, l'une apr√®s l'autre, pour configurer l'environnement de travail: <br><br><pre> <code class="bash hljs">npm install express npm install ws npm install @google-cloud/speech</code> </pre> <br>  Et lorsque cela est fait, cr√©ez un fichier JS vide et placez-y le code suivant (les nuances du code seront mises en √©vidence ci-dessous): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).createServer(app); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WebSocket = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ws'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wss = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebSocket.Server({ <span class="hljs-attr"><span class="hljs-attr">server</span></span>: http }); <span class="hljs-comment"><span class="hljs-comment">//     Google Cloud const speech = require('@google-cloud/speech'); //    const client = new speech.SpeechClient(); const config = { encoding: 'MULAW', sampleRateHertz: 8000, languageCode: 'ru-RU', }; const request = { config, interimResults: true, }; let audioInput = []; let recognizeStream = null; process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = 0; app.get('/', function(req, res) { res.send('&lt;h1&gt;Hello world&lt;/h1&gt;'); }); wss.on('connection', (ws) =&gt; { //  ,       var wstream = fs.createWriteStream('myBinaryFile'); //   audioInput audioInput = []; //    recognizeStream = client .streamingRecognize(request) .on('error', err =&gt; { ws.close(); }) .on('data', data =&gt; { ws.send(data.results[0].alternatives[0].transcript) process.stdout.write( data.results[0] &amp;&amp; data.results[0].alternatives[0] ? `Transcription: ${data.results[0].alternatives[0].transcript}\n` : `\n\nError occurred, press Ctrl+C\n` ) }); ws.on('close', (message) =&gt; { console.log('The time limit for speech recognition has been reached. Please disconnect and call again.'); wstream.end(); }) //  ,     message ws.on('message', (message) =&gt; { //     base64  recognizeStream try { let data = JSON.parse(message) if (data.event == "media") { let b64data = data.media.payload; let buff = new Buffer.from(b64data, 'base64'); recognizeStream.write(buff); wstream.write(buff); } } catch (err) { console.log(message) } }); //      ws.send('Hi there, I am a WebSocket server'); }); http.listen(3000, function() { console.log('listening on *:3000'); });</span></span></code> </pre> <br>  Maintenant que le serveur est configur√©, il nous aidera √† effectuer la reconnaissance vocale.  Testez votre solution localement en cr√©ant un tunnel sur localhost 3000 √† l'aide de ngrok. <br><br>  Pour ce faire, proc√©dez comme suit: <br><ol><li>  Installez ngrok en suivant les instructions sur son <a href="https://dashboard.ngrok.com/">site Web</a> . </li><li>  Sp√©cifiez votre authtoken pour ngrok pour lier le client √† ce compte. </li><li>  Ex√©cutez la <code>node your_file_name.js</code> pour d√©marrer votre serveur sur localhost: 3000. </li><li>  Acc√©dez au dossier ngrok sur votre ordinateur et ex√©cutez la commande <code>./ngrok http 3000</code> pour cr√©er un tunnel entre le serveur local en cours d'ex√©cution et l'URL publique. </li></ol><br>  Faites attention √† l'URL publique g√©n√©r√©e, nous l'utilisons comme URL WebSocket avec le pr√©fixe ¬´wss¬ª dans le script: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ds/oy/rl/dsoyrlspc0-y5wyxqp0pbwvh38k.png" width="80%"></div><br><br><h2>  4. Reconnaissance vocale </h2><br>  Vous avez probablement remarqu√© que notre code principal contient des lignes li√©es √† Google Cloud. <br><br>  La biblioth√®que elle-m√™me est import√©e comme suit: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speech = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@google-cloud/speech'</span></span>);</code> </pre> <br>  Vous devez maintenant sp√©cifier comment traiter la demande de reconnaissance vocale.  Pour ce faire, s√©lectionnez encoding, sampleRateHertz et languageCode dans la configuration g√©n√©r√©e: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { <span class="hljs-attr"><span class="hljs-attr">encoding</span></span>: <span class="hljs-string"><span class="hljs-string">'MULAW'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sampleRateHertz</span></span>: <span class="hljs-number"><span class="hljs-number">8000</span></span>, <span class="hljs-attr"><span class="hljs-attr">languageCode</span></span>: <span class="hljs-string"><span class="hljs-string">'en-US'</span></span>, };</code> </pre> <br>  Ensuite, cr√©ez un flux d'√©criture qui vous permet d'enregistrer les donn√©es transf√©r√©es dans un fichier: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wstream = fs.createWriteStream(<span class="hljs-string"><span class="hljs-string">'myBinaryFile'</span></span>);</code> </pre> <br>  Lorsque tout est configur√©, vous devez analyser le message et mettre les donn√©es audio au format base64 dans reconnaissentStream: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.event == <span class="hljs-string"><span class="hljs-string">"media"</span></span>) { b64data = data.media.payload; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buff = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer.from(b64data, <span class="hljs-string"><span class="hljs-string">'base64'</span></span>); recognizeStream.write(buff); wstream.write(buff); }</code> </pre> <br>  Imm√©diatement apr√®s cela, une demande de reconnaissance sera lanc√©e et le traitement de cette demande commencera: <br><br><pre> <code class="javascript hljs">recognizeStream = client .streamingRecognize(request) .on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, data =&gt; { ws.send(data.results[<span class="hljs-number"><span class="hljs-number">0</span></span>].alternatives[<span class="hljs-number"><span class="hljs-number">0</span></span>].transcript) });</code> </pre> <br>  Enfin, fournissez les informations d'identification de votre compte de service pour connecter la biblioth√®que Google √† son backend.  Pour ce faire, acc√©dez √† la <a href="">page d'authentification Google</a> et suivez toutes les √©tapes qui y sont r√©pertori√©es.  Ex√©cutez ensuite la commande d'exportation dans le m√™me espace de travail (dans le m√™me onglet ¬´Terminal¬ª) que le <code>node your_file_name.js:</code> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> GOOGLE_APPLICATION_CREDENTIALS=<span class="hljs-string"><span class="hljs-string">"/home/user/Downloads/[FILE_NAME].json"</span></span></code> </pre> <br><h2>  Lancer les sockets </h2><br>  Ouvrez <a href="https://phone.voximplant.com/">phone.voximplant.com</a> , remplissez le formulaire et cliquez sur Connexion.  Le nom d'utilisateur et le mot de passe font r√©f√©rence √† l'utilisateur cr√©√© √† l'√©tape 1: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i8/cf/w-/i8cfw--mu0kpommcqb8bs_o5wmy.png" width="90%"></div><br>  Une fois l'autorisation r√©ussie, cliquez sur Appeler et commencez √† parler.  Le nuage de synth√®se vocale convertira votre discours en texte en temps r√©el, et vous pouvez voir ce texte dans la fen√™tre du terminal. <br><br>  Vous l'avez fait, f√©licitations!  Nous esp√©rons que vous avez aim√© l'article et vous souhaitons plus d'int√©gration et de nouveaux d√©fis. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eu/sv/px/eusvpx0ba-qq6mzpzbpdsadyn9s.png" width="80%"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476902/">https://habr.com/ru/post/fr476902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476878/index.html">Ampoules LED GP</a></li>
<li><a href="../fr476880/index.html">Berceaux de s√©curit√©: CSRF</a></li>
<li><a href="../fr476888/index.html">Quelles tendances UX-design suivre en 2020</a></li>
<li><a href="../fr476890/index.html">Pour ceux qui travaillent chez Houdini. √Ä propos des cours Nature of Vex et Bites of Python</a></li>
<li><a href="../fr476900/index.html">Dispositif autonome sur Arduino, signalant une augmentation (diminution) de la temp√©rature</a></li>
<li><a href="../fr476904/index.html">Une autre simulation de biblioth√®que</a></li>
<li><a href="../fr476906/index.html">Nouveaut√©s de SOLIDWORKS 2020</a></li>
<li><a href="../fr476908/index.html">Hadoop est-il mort? 2e partie</a></li>
<li><a href="../fr476910/index.html">Antiquit√©s: un choix difficile de carte son pour les jeux DOS</a></li>
<li><a href="../fr476912/index.html">Droits des soci√©t√©s sur les programmeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>