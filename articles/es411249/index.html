<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèª üé¨ „Ä∞Ô∏è C√≥mo hice mi Yandex. Transporte con horarios y autobuses. üññüèΩ üèôÔ∏è ü§¶üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicado por Mikhail Aksenov, Desarrollador .NET, DataArt 



- Sitio web del proyecto Vrnbus (Voronezh Buses); 
- Telegram bot: @vrnbusbot ; 
- Proy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hice mi Yandex. Transporte con horarios y autobuses.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/411249/"><img src="https://habrastorage.org/webt/a0/8u/mi/a08umi6_8yn4eobkvs63zv_s9tq.jpeg"><br><br>  <i>Publicado por Mikhail Aksenov, Desarrollador .NET, DataArt</i> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sitio web del proyecto Vrnbus</a> (Voronezh Buses); </li><li>  Telegram bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@vrnbusbot</a> ; </li><li>  Proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vrntrans / vrnbus</a> . </li></ul><br><h2>  Como empez√≥ todo </h2><br>  En el oto√±o de 2014, hubo buenas noticias de que Yandex.Transport se lanz√≥ en Voronezh, que muestra el movimiento de autobuses y trolebuses.  Fue genial en la parada de autob√∫s abrir un horario y descubrir que su autob√∫s funcionar√° en 5 minutos. <br><br>  Pero despu√©s de un par de meses, todo sali√≥ de acuerdo con un escenario completamente predecible.  Como todo el transporte en Voronezh desde el tranv√≠a hasta el minib√∫s funciona en efectivo, cada conductor est√° interesado en transportar la mayor cantidad de pasajeros posible.  Como resultado, organizan carreras entre ellos. <br><br>  Los conductores utilizaron el nuevo servicio para seguirse en el mapa, adelantando y cortando a los competidores en el camino.  Algunos comenzaron a perder ingresos, comenzaron a quejarse a los propietarios de la ruta y se dirigieron a personas que vend√≠an equipos con GLONASS y GPS y enviaban datos sobre los movimientos de autom√≥viles a Yandex.  A pedido de los propietarios de la flota, dejaron de enviar informaci√≥n y los autobuses comenzaron a desaparecer inmediatamente del mapa.  Ahora hay un poco m√°s de ellos, pero esto es a√∫n mucho menos que en la realidad. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/hy/2p/d9/hy2pd9kotq6w2jrb__n5gm8nzx0.jpeg"><br><br>  Para aquellos que son demasiado flojos para leer m√°s, les propongo un informe en video sobre este tema: <iframe width="560" height="315" src="https://www.youtube.com/embed/1OtHwGqSL04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Por lo dem√°s, describir√© el proyecto en forma de texto. <br><br><h2>  ¬øD√≥nde obtener los datos? </h2><br>  Al mismo tiempo, en Voronezh hay un lugar donde se recopilan todos los datos: el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Centro para la Organizaci√≥n del Tr√°fico Vial</a> (DPC).  Tienen una aplicaci√≥n web grande y pesada en su sitio con JavaScript insostenible y otros artefactos, mientras que todo viene con solicitudes POST y nada se almacena en cach√©.  Usando este sitio en s√≠, puede poner f√°cilmente un servicio que recopila datos sobre el movimiento de los autobuses. <br><br>  Hab√≠a una opci√≥n que le permite pinchar en el mapa y averiguar cu√°ndo vendr√° el autob√∫s y qu√© ser√°.  Siempre que se detenga aproximadamente (¬± 50 metros).  En el men√∫, podr√≠a abrir una lista de rutas y ver exactamente a d√≥nde van los autobuses, pero hab√≠a un problema: conduc√≠an de manera extra√±a.  Por ejemplo, a lo largo de Koltsovskaya, una calle en el centro donde no se puede acelerar especialmente, el autob√∫s avanz√≥ y retrocedi√≥ a una velocidad de aproximadamente 200 km / h. <br><br><br><h2>  Por que Python </h2><br>  Eleg√≠ Python porque es genial, las bater√≠as est√°n agrupadas, etc. Y 3.6 porque hay formato para los literales de cadena, mecanograf√≠a, eso es todo.  Veamos lo que b√°sicamente utilic√©: <br><br><ul><li>  Muchos se quejaron de que conducir el nombre exacto de una parada con todo tipo de signos de puntuaci√≥n es muy dif√≠cil.  Entonces me di cuenta de la posibilidad de b√∫squeda difusa y cre√© la primera prueba unitaria para ello. </li><li>  Todo el sistema est√° alojado en Heroku.  Es gratis, porque no tengo una base de datos. Espero sobrevivir con la base de datos del centro de datos.  Estuve de acuerdo en su uso con el Centro cuando me di cuenta de que los datos que recopilo a trav√©s de la interfaz web no son suficientes. </li><li>  En realidad, el alojamiento pasa por el servidor web Tornado.  Creo que es familiar para cualquiera que haya encontrado solicitudes web en Python. </li><li>  Necesitaba el paquete Pytz porque el servidor Heroku est√° en una zona horaria diferente, y los datos me llegan sin especificar una zona horaria.  Por lo tanto, yo mismo me encargu√© de la localizaci√≥n. </li><li>  Para crear el bot, utilic√© la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python-telegram-bot</a> recomendada.  La documentaci√≥n aqu√≠ es bastante adecuada y, en general, la biblioteca cumple con los requisitos m√≠nimos de producto viable.  Inicialmente, todo el proyecto era un bot de Telegram, que en respuesta al env√≠o de su ubicaci√≥n envi√≥ un horario de autobuses. </li><li>  Firebird, una antigua Interbase, es una base de datos de c√≥digo abierto con la que creo que muchos de ustedes han trabajado.  Por supuesto, no es tan genial como el mismo PostgreSQL, pero para una gran cantidad de consultas es suficiente.  En nuestro caso, no se necesita m√°s. </li><li>  Cachetools es un m√≥dulo muy simple que le permite almacenar en cach√© los c√°lculos.  Esto, por supuesto, no se trata de memecached o cach√© de p√°ginas web, sino de aquellos casos en los que necesita una memoria para consultas largas.  Solo t√≥malo, agrega el decorador apropiado, y todo funciona.  El cach√© tiene diferentes opciones, utilizo la versi√≥n TTL, que guarda los datos durante el tiempo especificado, porque s√© que los datos no se actualizar√°n con m√°s frecuencia que a ciertos intervalos (en mi caso, 30 segundos). </li></ul><br><br><h2>  Funcionalidad bot </h2><br><ul><li>  / nextbus stop name: hora prevista de llegada; </li><li>  / √∫ltimos n√∫meros de ruta separados por espacios: √∫ltimas paradas; </li><li>  Ubicaci√≥n de env√≠o: la hora prevista de llegada para las pr√≥ximas tres paradas; </li><li>  Entrada gratuita: n√∫meros de ruta y distancia a los autobuses (al enviar la ubicaci√≥n). </li></ul><br><br>  Trat√© de describir los comandos lo suficiente como para que la gente no preguntara c√≥mo usarlos.  B√°sicamente, hay dos comandos b√°sicos: nextbus, cuando escribe el nombre de la parada y env√≠a la ubicaci√≥n. <br><br><h2>  Funcionalidad del sitio </h2><br>  Hice el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web lo</a> m√°s minimalista posible.  De las bibliotecas de terceros, utilic√© solo dos para admitir la b√∫squeda y la promesa, porque las versiones anteriores de los navegadores preinstalados en los tel√©fonos no pueden prescindir de ellas.  Si no admite estos m√©todos, obtendr√° fideos de devoluci√≥n de llamada bastante pesados ‚Äã‚Äãpara las propias solicitudes.  Con fetch, todo se ve m√°s elegante. <br><br><img src="https://habrastorage.org/webt/vn/sd/gu/vnsdgutglxminl8j6wi07w4nkp0.jpeg"><br><br>  En realidad, el funcional aqu√≠ consta de 4 puntos: <br><br><ol><li>  <b>Llegada</b>  Solo puedes mirar la parada.  Al hacer clic en el bot√≥n (por cierto, podr√≠a valer la pena hacer m√°s, ¬°lo pensar√©!), Env√≠a su ubicaci√≥n, el sistema busca las tres paradas m√°s cercanas a usted y muestra informaci√≥n sobre ellas.  Puede ingresar el nombre de la parada y obtener informaci√≥n sobre ella.  Como casi no necesita todos los autobuses 20-30 que pueden llegar a la parada de autob√∫s, puede filtrarlos por ruta. </li><li>  <b>Autobuses</b>  La segunda p√°gina contiene informaci√≥n sobre autobuses.  Esto se debe a otra historia que me empuj√≥ a este proyecto.  Un buen d√≠a, olvid√© el sombrero en el autob√∫s, llam√© a la sala de control y le expliqu√© d√≥nde sucedi√≥.  El despachador me sugiri√≥ que cogiera mi autob√∫s en el centro, donde volver√°, dando la vuelta en la terminal.  Record√© que tengo un nombre de usuario y una contrase√±a del Centro para el sistema de gesti√≥n del tr√°fico, pero result√≥ que todav√≠a no puedo rastrear la ubicaci√≥n del autom√≥vil que necesito a trav√©s de la interfaz web.  Le devolv√≠ el sombrero, pero con gran dificultad. <br>  Pens√© que encontrar un autob√∫s podr√≠a ser mucho m√°s f√°cil.  Escrib√≠ el n√∫mero de ruta, y el sistema le muestra los autos en la l√≠nea, su ubicaci√≥n actual y la hora en que pasaron las paradas en el camino.  E incluso si conoce el n√∫mero de ruta, pero conoce el n√∫mero de autob√∫s (esto tambi√©n sucede), a√∫n puede encontrarlo. </li><li>  <b>Mapa</b>  Mapa en el sitio sin animaci√≥n.  Aqu√≠ puede seleccionar autobuses de la lista o ingresar n√∫meros manualmente, puede filtrarlos.  Se pueden mostrar hasta 600 autobuses en el mapa, aunque despu√©s de 20 se hace dif√≠cil encontrar algo en el centro, simplemente porque las rutas est√°n concentradas aqu√≠.  Por lo tanto, es mejor limitar la b√∫squeda a par√°metros m√°s estrictos. </li><li>  <b>Sobre el proyecto</b>  Ahora el proyecto tiene un sitio web, hay un bot de Telegram, grupos en redes sociales. </li></ol><br><br>  *** <br>  Afortunadamente, Python es un lenguaje con bater√≠as listas para usar.  Para cosas simples, ni siquiera necesita descargar nada, solo lea la documentaci√≥n cuidadosamente. <br><br>  Por supuesto, dichos servicios se pueden hacer para otras ciudades, adem√°s, en algunas ya funcionan.  Mucho depende del centro de datos local, en algunos lugares, por ejemplo, en San Petersburgo, incluso hay una API para desarrolladores.  Pero lo m√°s importante es la gente del pueblo que quiere cambiar su ciudad para mejor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es411249/">https://habr.com/ru/post/es411249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es411239/index.html">Creatividad de bricolaje desde la infancia: inculcar el amor por los productos caseros</a></li>
<li><a href="../es411241/index.html">"Kepler" descubri√≥ una extra√±a supernova: r√°pidamente se incendi√≥, r√°pidamente se apag√≥</a></li>
<li><a href="../es411243/index.html">Residuos - al horno</a></li>
<li><a href="../es411245/index.html">Vamos a mostrarnos al Universo: los faros que quedar√°n despu√©s de nuestra civilizaci√≥n.</a></li>
<li><a href="../es411247/index.html">Los ni√±os m√°s "inteligentes" ven VTech Kidizoom. C√≥mo son realmente las cosas</a></li>
<li><a href="../es411251/index.html">Los usuarios resienten los archivos de escaneo de Chrome en la unidad local</a></li>
<li><a href="../es411253/index.html">La fusi√≥n de las estrellas de neutrones puso fin a las alternativas de la materia oscura y la energ√≠a oscura.</a></li>
<li><a href="../es411255/index.html">Aplicaciones descentralizadas para millones de usuarios en Ethereum</a></li>
<li><a href="../es411257/index.html">En los EE. UU., Crean un sistema l√°ser que asustar√° al enemigo con sonido</a></li>
<li><a href="../es411259/index.html">Conectamos un medidor de agua a una casa inteligente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>