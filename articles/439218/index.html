<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§üüèª ü¶Ü üë®üèø‚Äçü§ù‚Äçüë®üèª VK bot en su rodilla, o c√≥mo complacer a las personas el 14 de febrero ü§≥üèæ üëêüèø üî¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por supuesto, cada uno de nosotros ama los regalos, pero sobre todo amamos los deseos que los acompa√±an. Y, hasta hace poco, no ten√≠amos la oportunida...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VK bot en su rodilla, o c√≥mo complacer a las personas el 14 de febrero</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439218/">  Por supuesto, cada uno de nosotros ama los regalos, pero sobre todo amamos los deseos que los acompa√±an.  Y, hasta hace poco, no ten√≠amos la oportunidad de sorprender gratamente a una persona con palabras c√°lidas hasta que se me ocurri√≥ la idea: ¬øqu√© pasa si le damos a las personas la oportunidad de intercambiar valentines (de todos modos, el 14 de febrero) sin abandonar el marco de la forma habitual? comunicaci√≥n - sala de chat de redes sociales? <br><br>  Palabra por palabra, y aqu√≠ est√°: ¬°un plan comercial listo para crear el ambiente de las vacaciones del D√≠a de San Valent√≠n!  ¬øHaremos felices a las personas? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/mp/13/dlmp134rko91zu7m-evwm5mlhem.jpeg" width="70%"></div><br><a name="habracut"></a><h2>  ¬°Por la idea de la luna! </h2><br>  Por supuesto, en primer lugar era necesario elaborar un plan de acci√≥n y describir la idea.  Debido al hecho de que las personas se han vuelto m√°s t√≠midas y no siempre est√°n listas para confiar en nadie, la elecci√≥n recay√≥ en escribir un bot de moda y conveniente para VK, que tiene una interfaz familiar, siempre estar√° a mano, y el anonimato de los mensajes estar√° codificado en el c√≥digo del programa. <br>  Desafortunadamente, adem√°s de todas las ventajas anteriores, las comunidades tienen dos inconvenientes: bajo ancho de banda (n√∫mero de mensajes por segundo) y una prohibici√≥n de iniciar un di√°logo con un usuario aleatorio (el usuario debe <b>primero</b> y <b>expl√≠citamente</b> aceptar recibir mensajes en nombre de la comunidad). <br><br>  Entonces, tenemos un usuario que est√° listo para enviar una tarjeta de San Valent√≠n a su alma gemela, un destinatario y un intermediario en forma de un bot de chat.  El esquema de interacci√≥n es simple, el bot deber√≠a: ofrecer el env√≠o ‚Üí reconocer al destinatario ‚Üí guardar hasta el 14 de febrero ‚Üí entregar ‚Üí repetir. <br><br>  Pero esto, por supuesto, no fue suficiente para la voraz imaginaci√≥n de la mente y, para aumentar la actividad y la participaci√≥n de la audiencia, se pens√≥ en un esquema de otra interacci√≥n que permitiera a las personas familiarizarse dentro del sistema y enviar mensajes a personas aleatorias.  Estas "valentines al azar" se pueden apreciar, y si las valentines de dos personas se gustan, les damos la oportunidad de chatear. <br><br><h4>  Descargo de responsabilidad </h4><br>  <i>Este proyecto fue creado puramente por el entusiasmo de dos personas, un programador <s>medio educado</s> (yo) y un inspirador ideol√≥gico (Stepan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">sadfun</a> Popov), no tiene el objetivo de ense√±arle algo (aunque puede ayudarlo a comprender la esencia del universo), solo cuente una historia interesante de creaci√≥n y siga el camino de una idea a una implementaci√≥n ingenua.</i> <br><br><hr><br><h2>  Aprendiendo a hablar con VK </h2><br>  Despu√©s de <b>pasar</b> por 3-4 bibliotecas diferentes a pedido de <b>"NodeJS VK API"</b> , me di cuenta de que no hay bibliotecas simples y funcionales que nos permitan usar promesas, as√≠ como trabajar durante la ejecuci√≥n.  ¬øRecuerdas uno de los problemas descritos anteriormente?  S√≠, la ejecuci√≥n de solicitudes a VKontakte no es directa, pero en lotes de 25 le permite aumentar <b>significativamente el</b> rendimiento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/fl/bp/v3flbpnqymqn0wy51ohjddwenmo.png" width="70%"></div><br>  <i>Capacidad comparativa de varios m√©todos de solicitudes a VKontakte</i> <br><br>  Por lo tanto, se decidi√≥ escribir algo propio, una soluci√≥n confiable y no muy precisa, basada en la biblioteca de <b>b√∫squeda de nodos</b> . <br><br>  Para no dar todo el c√≥digo aqu√≠, simplemente describir√© la l√≥gica del trabajo. <br><br>  Dado que las solicitudes del programa deben empaquetarse en una ejecuci√≥n, se recopilan en la cola LIFO y luego se env√≠an si: <br><br><ul><li>  Llamadas de 25 o m√°s (ejecuci√≥n m√°xima) </li><li>  Ha pasado suficiente tiempo desde el √∫ltimo env√≠o, no menos de 50 milisegundos, pero no m√°s de 150 (para que la cola se mueva, a pesar del peque√±o tama√±o) </li></ul><br>  Las solicitudes de la cola se compilan en el c√≥digo VK Script, que (en esta implementaci√≥n) se ve as√≠: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> returnables = []; returnables[<span class="hljs-number"><span class="hljs-number">0</span></span>] = API.messages.send({<span class="hljs-string"><span class="hljs-string">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">", !"</span></span>, <span class="hljs-string"><span class="hljs-string">"peer_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"random_id"</span></span>: <span class="hljs-number"><span class="hljs-number">561427</span></span>}); returnables[<span class="hljs-number"><span class="hljs-number">1</span></span>] = API.users.get({<span class="hljs-string"><span class="hljs-string">"user_ids"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span>: <span class="hljs-string"><span class="hljs-string">"sex"</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnables;</code> </pre> <br>  Despu√©s de que el c√≥digo se ejecuta mediante una solicitud a VK, el resultado de cada solicitud (por los <i>retornables de</i> √≠ndice) vuelve a su devoluci√≥n de llamada, bellamente envuelto en Promise.  La eficacia del enfoque es abrumadora: cuantos <b>m√°s</b> usuarios (y, por lo tanto, m√°s solicitudes a VKontakte para enviar), <b>menor es la</b> demora en la respuesta.  Para mantener el l√≠mite bajo control, el sistema de env√≠o tiene un contador que muestra el n√∫mero de solicitudes restantes para este segundo, lo que le permite procesar r√°pidamente una oleada de visitantes. <br><br><h2>  Aprendiendo a escuchar VK </h2><br>  Hay dos formas de recibir notificaciones de eventos de VKontakte: <b>Longpoll-request</b> y <b>Callback-server</b> .  Su servidor es conveniente porque no requiere gestos especiales para su uso, y tambi√©n le permite recibir notificaciones perdidas (por ejemplo, cuando reinicia el servidor).  Dicho servidor se puede escribir en varias l√≠neas utilizando la clase nativa <b>http.Server</b> . <br><br>  Todo esto crea un ecosistema ideal para la l√≥gica del programa, que es conveniente de usar. <br><br><h2>  Todo termina </h2><br>  Dado que el usuario es libre de hacer cualquier cosa en el chat y no podemos detenerlo, debemos limitarlo a una cantidad razonable.  La m√°quina de estado hace un gran trabajo al hacer esto, configurando cada transici√≥n posible dentro del sistema y usando los botones (par√°metro de <b>teclado</b> en messages.send) har√° que usar el bot sea tan simple como un simple toque en la pantalla. <br><br>  Aqu√≠ est√° la interacci√≥n del usuario con el bot: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sz/1o/fw/sz1ofwuethupwaiet4syf6ahl4u.png"></div><br>  Todo esto se convierte en un conjunto de estados ("Men√∫ principal", "Entrada de San Valent√≠n", etc.), las transiciones entre las cuales se configuran y transmiten en botones, o se conocen inicialmente y no cambian. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cq/dz/ml/cqdzmlalb1t2o-xpdet5mvfnnek.png"></div><br>  Por cierto, sobre los botones.  Su gama de colores no es invariable ( <b>4 colores</b> para todas las ocasiones), pero son los botones los que permiten minimizar la cantidad de errores del usuario.  Sobre su base, puede construir absolutamente cualquier sistema no lineal, por lo que se utilizan en todas partes.  Y en este proyecto tambi√©n. <br><br>  Pero debe comprender: si est√° apuntando a una gran audiencia, deber√≠a considerar otra forma de interactuar, porque alguien puede tener una aplicaci√≥n antigua ( <b>VK para iPad</b> , por ejemplo, no se ha actualizado durante mucho tiempo, no mentir√©, pero parece que ha pasado m√°s de un a√±o, y el soporte de teclado no est√° all√≠).  Y sucede (s√≠, sucede, lo comprob√©) que las personas, sin darse cuenta de que se puede hacer clic en los botones, simplemente reescriben su contenido (y luego el par√°metro del bot√≥n de carga √∫til, por supuesto, no se transmite, y todo puede romperse). <br><br>  Cabe se√±alar que no todo sucede tan bien como se describe en el diagrama, y ‚Äã‚Äãa veces ocurren casos curiosos.  Por ejemplo, el sistema para determinar el enlace VKontakte proces√≥ incorrectamente a los usuarios cuyos enlaces cortos comenzaron con <b>id</b> y lo cortaron.  La sorpresa de las personas que se encontraron con este error no se puede describir, porque escribieron Valentine Valentine, pero result√≥ que Olezhka. <br><blockquote>  <b>¬øQu√© olezhka ????</b> </blockquote><h2>  Los accidentes no son accidentales </h2><br>  Entonces, si todo est√° claro con el d√≠a de San Valent√≠n ordinario, hay un destinatario y un remitente, ¬øc√≥mo reducir a dos extra√±os?  Necesitas intercambiar sus tarjetas de San Valent√≠n, y si a la gente le gustan las tarjetas de San Valent√≠n, ¬°deber√≠an presentarse!  ¬°Aqu√≠ est√°, la f√≥rmula del amor! <br><br>  Aunque esto suena pat√©tico, funciona, y se vuelve m√°s interesante para las personas trabajar con el bot: obtendr√°n una respuesta positiva si hay al menos una persona (que, por supuesto, el bot se encargar√°). <br><br>  Esto lleva a una gran ventaja: cuantas m√°s personas aprovechen esta oportunidad, m√°s oportunidades tendr√°n de conocerse y, por lo tanto, esto, como un juego, mantiene a una persona en un chat.  Vale la pena confesar que la sesi√≥n promedio del usuario es de ~ 7 minutos, pero existe el potencial de restringir a una persona entre <b>10 y 15</b> por el simple hecho de esta caracter√≠stica. <br><br>  La distribuci√≥n misma de los mensajes forz√≥ un esquema separado, ya que hay varias opciones para usar este bot, el usuario puede perder de vista algo y el bot le recordar√° cuidadosamente esto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pj/8a/bw/pj8abwsu2zjmkhotgiffi0jldse.jpeg"></div><br>  Es interesante c√≥mo se resolvi√≥ el segundo problema, con la incapacidad de la comunidad para iniciar un di√°logo con el usuario primero: ahora este problema se resuelve mediante dicho mensaje. <br><blockquote>  Pero tengo una condici√≥n!  Para que el destinatario reciba su Valentine, tambi√©n debe escribirme.  Tu tarea ahora es convencerlo de que me escriba algo.  ¬°Esto se hace para que no tengas miedo de hablar con √©l! </blockquote>  En general, el tradicional "¬°No es un error, sino una caracter√≠stica!" <br><br><h2>  Fuegos artificiales al final </h2><br>  Eso es todo!  Si no tiene en cuenta algunas dificultades para comprender la l√≥gica de la API de VK, as√≠ como para confirmar la cuenta con uno de los proveedores, todo sali√≥ demasiado bien. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/gb/yt/-7gbythuuwaf87k6c-v4k5-shok.png"></div><br>  <i>Ejemplo de chat con un bot</i> <br><br>  El bot funciona y har√° las delicias de las personas con San Valent√≠n, haci√©ndolos felices.  Esto se hace para ayudar a las personas a ser m√°s amables entre s√≠.  Puede evaluar todo esto usted mismo en la comunidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Valentinych: vk.com/verylovebot</a> , si lo desea.  Gracias por su atencion! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439218/">https://habr.com/ru/post/439218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439204/index.html">Mejora de la eficiencia de la fotos√≠ntesis por modificaci√≥n gen√©tica de plantas.</a></li>
<li><a href="../439206/index.html">¬øC√≥mo resolvimos el problema de continuar las listas de reproducci√≥n en RecSys Challenge y obtuvimos el 3er lugar?</a></li>
<li><a href="../439208/index.html">Oh, mi c√≥digo: c√≥mo funciona MAPS.ME</a></li>
<li><a href="../439210/index.html">Java despu√©s de la erupci√≥n volc√°nica</a></li>
<li><a href="../439216/index.html">base de datos incrustable de 500 filas de pudge en golang</a></li>
<li><a href="../439220/index.html">Gran ciudad para dispositivos m√≥viles en Unity. Experiencia en desarrollo y optimizaci√≥n.</a></li>
<li><a href="../439222/index.html">¬øQu√© es la gesti√≥n de API?</a></li>
<li><a href="../439224/index.html">De nuevo sobre los diagramas de Voronoi</a></li>
<li><a href="../439226/index.html">Scala + MXNet = Microservicio con neurona en prod</a></li>
<li><a href="../439232/index.html">JAMstack: C√≥mo crear tu propio blog usando Gatsby + Contentful + Netlify</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>