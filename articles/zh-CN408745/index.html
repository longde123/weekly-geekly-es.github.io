<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹 🍛 🤢 免提，但没有电话。 没有足够的双手时要听话 ⛄️ 👨🏾‍🤝‍👨🏼 🍌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="您好，社区！ 

 我希望再次摆弄微控制器并做一些有用的事情。 几乎是在我的公寓里打扰了我的目标。 

 如您所知，电脑桌是观看Drobyshevsky或阅读Giktayms / Green Cat等的餐桌。 在晚餐的同时。 但是有一个问题-我通常会双手忙着走出厨房，然后回来， 因为杯子被 分成 3...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>免提，但没有电话。 没有足够的双手时要听话</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/408745/"> 您好，社区！ <br><br> 我希望再次摆弄微控制器并做一些有用的事情。 几乎是在我的公寓里打扰了我的目标。 <br><br> 如您所知，电脑桌是观看Drobyshevsky或阅读Giktayms / Green Cat等的餐桌。 在晚餐的同时。 但是有一个问题-我通常会双手忙着走出厨房，然后回来， <s>因为杯子被</s> <b>分成</b> <s>3个部分。</s> 打开和关闭厨房中的灯（三联开关-厨房/浴室/卫生间）是肩膀，鼻子，小手指。 也就是说，无论如何都不方便，但是不可能重新布置它。 有一项任务以某种方式进行远程管理。 <br><br> 所有存在和通过的传感器都立即被撤消-准确性不高，所有者无法控制。 解决方案可以在声音控制，语音中找到。 我将立即说我不打算进行语音识别，这里不需要。  80年代电台曾描述过流行音乐打开的灯，但我不想这么做。 事实证明，当手忙时，免提。 详细信息在。 <br><a name="habracut"></a><br><h3> 硬件部分。 </h3><br> 有一块带有Atmega32的板，带有石英和外围设备<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SEM0007M-32A，</a>以及一些电子设备。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/65f/1a8/7e9/65f1a87e9d6aad209f747a4419cab7ad.jpg" width="40%" alt="图片"></div><br> 有一个麦克风和一个运算放大器。 对于输出，板上的sot32封装中有一个晶体管，还有7安培的继电器。 一切都被组装到一个名片盒中，继电器与开关并联，麦克风隐藏在插座下方。 该方案很普通，我什至没有画。 仅使用一个模拟输入和一个离散MK输出。  SEM是多余的，但现在就让它成为现实。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3c0/69f/b83/3c069fb831046a304627595be0730b70.jpg" width="350" alt="图片"></div>  <i>电路板和未组装的电线。</i>  <i>然后他更准确地重做了。</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/7ed/8ee/f59/7ed8eef59421665c5cef7009768a8a46.jpg" width="300" alt="图片"></div>  <i>开关本身，麦克风在拆除的插座下不可见。</i> <br><br><h3> 搜索算法。 </h3><br> 目的：传感器必须响应一个单词，例如“ <i>light！</i>  »用最少的代码。 <br> 任务：在可能的噪音，敲打，点击相同的开关的背景下识别命令字。 也就是说，仅进行幅度分析是不合适的，而频谱分析表明单词中的谐波过多，并且它们当然会发生变化。 因此，有必要寻找一种简单的解决方案，但具有可接受的抗噪能力。 您可以制作几个时频滤波器，并与单词样本进行比较，但是您无需进行识别。 决定仅分析元音的存在，例如声音“ E”或“ E”。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/a55/5e2/6cf/a555e26cf616bfab31872bce1794d612.png" alt="图片"></div>  <i>声音是“ E”。</i>  <i>可见许多谐波，因此分析很困难。</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/18e/d5c/ab8/18ed5cab8307bf96a2fb8d2ae77e64dd.png" alt="图片"></div>  <i>声音是“ A”。</i>  <i>频谱看起来更干净，有一个主频率。</i> <br><br><h3> 软件部分 </h3><br> 为了知道信号的频谱成分，可以使用数字滤波器。 互联网<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上</a>有一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">很好的程序，用于构建数字FIR和IIR滤波器</a>并计算其系数-很明显，该程序可以自动生成C代码。 <br><br><div class="spoiler">  <b class="spoiler_title">但是我拒绝了数字滤波器</b> <div class="spoiler_text"> 对于可接受的滤波（4个或更多个阶），可以获得许多系数，甚至是浮点数。 这样，加上浮点数中的所有过滤器计算： <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ACoef[NCoef+<span class="hljs-number"><span class="hljs-number">1</span></span>] = { <span class="hljs-number"><span class="hljs-number">0.00000347268864059354</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.00001389075456237415</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.00002083613184356122</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">-0.00001389075456237415</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">0.00000347268864059354</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> BCoef[NCoef+<span class="hljs-number"><span class="hljs-number">1</span></span>] = { <span class="hljs-number"><span class="hljs-number">1.00000000000000000000</span></span>, <span class="hljs-number"><span class="hljs-number">-7.09708794063733790000</span></span>, <span class="hljs-number"><span class="hljs-number">22.77454294680684300000</span></span>, <span class="hljs-number"><span class="hljs-number">-43.03321836036351300000</span></span>, <span class="hljs-number"><span class="hljs-number">52.29813665034108500000</span></span>, <span class="hljs-number"><span class="hljs-number">-41.84199842886619100000</span></span>, <span class="hljs-number"><span class="hljs-number">21.53121088556695300000</span></span>, <span class="hljs-number"><span class="hljs-number">-6.52398963450972500000</span></span>, <span class="hljs-number"><span class="hljs-number">0.89383378261285684000</span></span> };</code> </pre> <br> 微控制器可能已经处理了，但是调试会出现问题-突破滤波器的界限并不容易-这些是要计算的新系数。 </div></div><br> 经过一些搜索，我决定在线进行单频傅立叶变换。 也就是说，经典的离散傅里叶变换是在以采样频率（1600 Hz）到达信号的每个样本时执行的，没有频率通过，只有一个频率，因此在调试过程中很容易通过RS-232对其进行配置。 结果，对128Hz的频率进行了分析。 <br><br> 由于样本（块）短且窗口矩形，所以频率分辨率较低，因此选择性灵敏度在114 ... 140 Hz范围内， <u>这是我想要获得的P滤波器。</u> <br><br> 首先，您需要了解语音命令信号在哪里开始<s>尖叫</s> 。 为此，首先，通过使用平滑常数为1/64的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">指数平滑</a>来计算零信号电平。 代码如下。 <br><br><div class="spoiler">  <b class="spoiler_title">定时器代码的一部分，用于信号处理。</b>  <b class="spoiler_title">计时器频率1600 Hz</b> <div class="spoiler_text"> 信号归一化为平均值。 为了确定声强水平，还对信号的绝对值求平均值，其常数为1/16，以便对单个信号半波进行高通滤波（这是RMS的模拟，但更易于计算）。 超过此阈值水平是语音命令的开始，并且开始对5个块的135个样本（84.3 ms）进行顺序分析。 <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Timer 0 output compare interrupt service routine interrupt [TIM0_COMP] void timer0_comp_isr(void) { a = adc_data[0] &lt;&lt; 2 ; //       4   . a0 = (a0*63 + a+ 63) &gt;&gt; 6; // .   "0".   10%  150  ae = (int)(a - a0); // a = ae; //      . ae = abs(ae); if (ae &lt; 32) { //      ae = 0; }; d = (int)((15 * (long int) d + ae + 15) &gt;&gt; 4); //  .  //   10%  35  if (d &gt; 100) { //    if (snd == 0) { Yz=0; snd++; } //    PORTB.1 = 1; //      }; .....</span></span></code> </pre></div></div><br> 下图显示了信号，信号电平，阈值和5个块。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/bc9/b82/572/bc9b82572bd90ddb993e5933489e5f5b.png" alt="图片"></div><br><h3> 干扰防护 </h3><br> 信号被分为多个块，以防止脉冲（喀嗒声或敲击声）。 如您所知，脉冲具有均匀的频率响应，也就是说，在任何频带中都将产生非零结果，并且可能会超过阈值。 但是<s>头发很长，但是头脑的</s>冲动很短。 也就是说，在下一个块中将不再有脉冲，这意味着频带中的电平将低于阈值。 同时具有这一优势，短块会<u>降低</u>频率<u>分辨率</u> 。 因此，信号中的某些频率差仍然落入所选频率线。 <br><br><h3> 频率转换 </h3><br> 在每个块中，对一个频率f执行单频傅里叶变换。 <br><br> 传统上，为了加快计算速度，将sin和cos函数制成表格并缩放为-127 .. + 127。 <br>  <code>si(ps)</code>数组的<code>ps</code>索引是根据参数sin（2 *π* f * t / T）计算得出的，当然，在同一时间段内也会发生环回。 将cos（2 *π* f * t / T）的<code>pc</code>索引简单地在同一<code>si</code>数组中向前推12个位置。 <br><br> 结果<b>Y-</b>频谱线的电平是一个块期间实部和虚部的绝对值的总和。 <div class="spoiler">  <b class="spoiler_title">所以</b> <div class="spoiler_text"> 以正确的方式，您需要对平方和根进行求和，但这对于8位MK来说是很糟糕的。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">在同一计时器中：</b> <div class="spoiler_text"><pre> <code class="cs hljs"> a_si = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (a * si[ps]) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-comment"><span class="hljs-comment">// a*sin a_co = (long int) (a * si[pc]) &gt;&gt; 4; // a*cos Ysi = Ysi + a_si ; // Yco = Yco + a_co; Y = (labs(Ysi) + labs(Yco)) &gt;&gt; 7; //   128    int    rs-232.</span></span></code> </pre></div></div><br> 在每个块的末尾，将<b>Y</b>与阈值进行比较，计算出超过阈值的块数-触发的块。 经过实验后，发现触发块的最小数量为5分之3。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/499/6b1/cbe/4996b1cbe7750d3b010e9b430f391e67.png" alt="图片"></div>  <i>语音命令块中频谱强度的示例。</i>  <i>团队已经通过。</i> <br><br> 三个或更多触发块被解释为正确接收的命令。  MK离散输出上的信号被反转，从而打开或关闭灯。 由于整个分析都在这些块内进行，因此在最后一个块之后没有操作延迟。 <br><br> 计算时间约为1600个周期，每9000个周期将调用一次计时器，因此MK的负载很低-仍有进行识别实验的空间。 或者，您可以在MK较弱的情况下提供较小尺寸的完整解决方案。 <br><br> 通过与VBasic上的程序通过RS-232交换必要变量（对数）来控制算法的正确性。 频率f和阈值存储在eeprom中。 <br><br> 结果：该传感器变得非常方便，它响应来自“ <i>A</i> ”的单词，例如<b>“ <i>Waau</i> ”，“ <i>Taaam</i> ”，“ <i>Laite</i> ”，“ <i>Miaaa</i> ”，“ <i>Yao-Yao</i> ”</b> 。 音量是人类对话的常态。  “ <i>点燃</i> ”这个词固执地拒绝听。 点击，敲门，台阶，倒水忽略。 现在，您可以带着满手的杯子和盘子走路））。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN408745/">https://habr.com/ru/post/zh-CN408745/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN408735/index.html">价值800美元的类人机器人并不像一个人那么大。 对不起...</a></li>
<li><a href="../zh-CN408737/index.html">QardioBase 2智能秤：越来越好</a></li>
<li><a href="../zh-CN408739/index.html">超导光合作用或球形真空马</a></li>
<li><a href="../zh-CN408741/index.html">高通Centriq 2400处理器先驱英特尔杀手?？</a></li>
<li><a href="../zh-CN408743/index.html">最小的GPD WIN游戏笔记本电脑-它有什么功能？谁需要它？</a></li>
<li><a href="../zh-CN408747/index.html">新流浪者的出现，猎鹰重型飞机的首次飞行，对“龙”和“ Starliner”的可靠性表示怀疑</a></li>
<li><a href="../zh-CN408749/index.html">生日快乐，电脑鼠标</a></li>
<li><a href="../zh-CN408751/index.html">亚马逊推出3D，VR和AR开发平台</a></li>
<li><a href="../zh-CN408753/index.html">给不友好的人工智能的信息</a></li>
<li><a href="../zh-CN408755/index.html">如何根据您的睡眠时间计划完美的工作日</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>