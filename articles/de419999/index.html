<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏭️ 👩‍👩‍👧‍👧 ⛔️ Freigabe der Yii1 / yii2-Authentifizierung 🚖 🕵🏼 👇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist ohne den ersten Teil nicht sinnvoll, in dem die Antwort "Warum tun?" 

 Es geht um die Technik der reibungslosen Migration eines Pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Freigabe der Yii1 / yii2-Authentifizierung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419999/"><img src="https://habrastorage.org/webt/ax/qo/vv/axqovvxw6vehedogcejd1obzehs.jpeg" alt="Bild"><br><br>  Dieser Artikel ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ohne den ersten Teil</a> nicht sinnvoll, in dem die Antwort "Warum tun?" <br><br>  Es geht um die Technik der reibungslosen Migration eines Projekts von yii1 nach yii2.  Das Wesentliche ist, dass die Zweige des Projekts auf yii1 und seine neue Version auf yii2 auf derselben Domäne in einem virtuellen Host zusammenarbeiten und die Migration schrittweise in kleinen Schritten (über Seiten, Controller, Module usw.) durchgeführt wird. <br><br>  Im ersten Teil ging es darum, wie ein nacktes Projekt auf yii2 in einem vorhandenen virtuellen Host ausgeführt wird, d. H.  Lassen Sie beide Zweige zusammenarbeiten, ohne sich gegenseitig zu stören. <br><br>  Danach beginnt die psychologisch schwierigste Phase: Sie müssen für den Start eine minimale Infrastruktur erstellen.  Ich würde zwei Aufgaben herausgreifen: doppeltes Design und End-to-End-Benutzerauthentifizierung. <br><br>  Die Vervielfältigung des Designs wird durch Langeweile an erster Stelle gestellt.  Wenn Sie Pech haben, können Sie einfach das alte "1 in 1" kopieren / zurücksetzen.  Persönlich habe ich immer mit dem Redesign kombiniert.  Das heißt,  Die Benutzeroberfläche und das Design wurden erheblich aktualisiert und in dieser Hinsicht ist die Arbeit nicht dumm.  Aber hier für jeden sein eigenes - ich achte sehr auf die Benutzeroberfläche und das Design, im Gegenteil, jemand mag das Backend und die Konsole mehr.  Unabhängig von den Einstellungen gibt es jedoch keine Möglichkeit, an dieser Aufgabe vorbeizukommen. Sie müssen eine Benutzeroberfläche erstellen, und der Arbeitsaufwand ist recht hoch. <br><br>  Die End-to-End-Authentifizierung ist etwas interessanter und es wird weniger Arbeit geben.  Wie im ersten Artikel wird es keine Enthüllungen geben.  Charakter des Artikels: Tutorial für diejenigen, die dieses Problem zum ersten Mal lösen. <br><br>  Wenn dies Ihr Fall ist, dann mehr Details unter dem Schnitt <br><a name="habracut"></a><br>  Zunächst müssen Sie die Funktionalität auf die Zweige aufteilen.  Weil  Es versteht sich, dass sich die Migrationsphase erst am Anfang befindet und dann höchstwahrscheinlich alle Arbeiten mit Benutzern (Registrierung, Authentifizierung, Kennwortwiederherstellung usw.) auf der alten Site verbleiben.  Und der neue Zweig auf yii2 sollte nur bereits authentifizierte Benutzer sehen. <br><br>  Die Authentifizierungsmechanismen von yii1 / yii2 unterscheiden sich geringfügig, und Sie müssen den yii2-Code so anpassen, dass ein authentifizierter Benutzer angezeigt wird.  Weil  Authentifizierungsdaten werden in der Sitzung gespeichert. Sie müssen lediglich die Parameter für das Lesen der Sitzungsdaten festlegen. <br><br>  In einer Sitzung von yii1 wird dies irgendwie wie folgt gespeichert: <br><br><pre><code class="php hljs">print_r($_SESSION); <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__id] =&gt; <span class="hljs-number"><span class="hljs-number">123456</span></span> [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__name] =&gt; tester [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__states] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( ) )</code> </pre> <br>  Wie wird es bei Ihnen gespeichert? Überprüfen Sie beispielsweise, ob prefixKey in verschiedenen Versionen von yii1 unterschiedlich generiert wird. <br><br>  Hier sind die Daten, die Sie von yii1 benötigen <br><br><pre> <code class="php hljs">Yii::app()-&gt;user-&gt;getStateKeyPrefix() Yii::app()-&gt;name Yii::app()-&gt;getBasePath() Yii::app()-&gt;getId() get_class(Yii::app()-&gt;user)</code> </pre><br>  Am einfachsten ist es, eine Testseite zu erstellen und alle erforderlichen Daten darauf anzuzeigen - sie werden in Zukunft benötigt. <br><br><h2>  Authentifizierung in yii2 </h2><br>  In Yii2 befindet sich die gesamte benötigte Funktionalität in der Benutzerkomponente ( <u>\ yii \ web \ User</u> ), die den Authentifizierungsstatus steuert. <br><br><ul><li>  In der Methode <u>getIdentity ()</u> wird <u>erneuerAuthStatus ()</u> aufgerufen, in der die Authentifizierungssitzung vom Schlüssel aus der Variablen <u>$ idParam nachgeschlagen</u> wird (standardmäßig wird dort '__id' gespeichert). </li><li>  In der Sitzungsvariablen wird die Benutzer-ID mit dem Schlüssel <u>$ idParam</u> gespeichert (z. B. aus <u>App / Modell / Benutzer</u> ). </li></ul><br>  <i>Der Authentifizierungsalgorithmus ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im offiziellen Handbuch</a> ausführlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">beschrieben</a> .</i> <br><br>  In yii1 werden Sitzungen natürlich mit einem anderen Schlüssel gespeichert.  Daher müssen Sie yii2 veranlassen, die Benutzer-ID mit denselben Schlüsseln zu suchen, mit denen sie in yii1 gespeichert ist. <br><br>  <b>Dafür:</b> <br><br>  1. Ändern Sie die Klasse der Benutzerkomponente, die für die Verwaltung des Authentifizierungsstatus verantwortlich ist, in unsere eigene, die von <u>yii / web / User</u> in <u>config / web.php geerbt wurde</u> <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\WebUser'</span></span>, <span class="hljs-string"><span class="hljs-string">'identityClass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\User'</span></span>, ], ]</code> </pre><br>  2. Passen Sie den Wert von <u>$ idParam</u> in <u>app \ models \ WebUser an</u> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); }</span></span></code> </pre> <br>  Unter dem Spoiler gibt es einige Methoden, die ein ähnliches Verhalten von yii1 emulieren. <br><br>  Im Allgemeinen könnte man einfach das ursprüngliche <u>_keyPrefix</u> (oder sogar <u>idParam sofort</u> ) von yii1 kopieren und seine Generierung nicht emulieren, aber dann wäre es wie die Anweisung "Kopieren von unverständlichem Müll". <br><br>  Sie können tatsächlich kopieren, da _keyPrefix in yii1 fast statisch ist.  Dies hängt vom Klassennamen der Benutzerkomponente und von der Anwendungs-ID ab, die wiederum vom Speicherort der Anwendung und ihrem Namen abgerufen wird. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   yii1  _keyPrefix $this-&gt;_keyPrefix = md5('Yii.'.get_class($this).'.'.Yii::app()-&gt;getId()); //   - ID  $this-&gt;_id=sprintf('%x',crc32($this-&gt;getBasePath().$this-&gt;name));</span></span></code> </pre><br>  Wenn wir uns nur auf die Authentifizierungsaufgabe beschränken, reduziert das Kopieren des _keyPrefix-Werts den Arbeitsaufwand erheblich.  Aber ich werde Beispiele für eine breitere Verwendung haben. <br><br><div class="spoiler">  <b class="spoiler_title">Benutzerkomponente (app \ models \ WebUser)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebUser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    cookies  yii2, *     yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $autoRenewCookie = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * _keyPrefix    CWebUser  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_keyPrefix; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $paramsYii1 = [ <span class="hljs-comment"><span class="hljs-comment">//    user   Yii1 'classUserComponent' =&gt; 'CWebUser', // ID  Yii1 //  ,  Yii::app()-&gt;getId() 'appId' =&gt; '', //     Yii1 'appName' =&gt; 'My Web Application', //     yii1  \Yii::getAlias('@app') 'relPath' =&gt; '../htdocs/protected', ]; public function init() { //  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); } }</span></span></code> </pre><br>  Und zusätzliche Methoden dazu (WebUser).  <i>Für einfache Anzeige getrennt.</i> <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     Yii1,    ID  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdParamYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getStateKeyPrefix() . <span class="hljs-string"><span class="hljs-string">'__id'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *    Yii 1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStateKeyPrefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix; $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'classUserComponent'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix = md5(<span class="hljs-string"><span class="hljs-string">'Yii.'</span></span> . $class . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAppIdYii1()); } <span class="hljs-comment"><span class="hljs-comment">/** *   getId()  CApplication * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string ID  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppIdYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>] = sprintf(<span class="hljs-string"><span class="hljs-string">'%x'</span></span>, crc32(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePathYii1() . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appName'</span></span>])); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBasePathYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $basePath = realpath(\Yii::getAlias(<span class="hljs-string"><span class="hljs-string">'@app'</span></span>) . DIRECTORY_SEPARATOR . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'relPath'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$basePath) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'basePath  yii1  .'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $basePath; }</code> </pre><br>  <i>Nur für die Aufgabe, " <u>das Format des Sitzungsschlüssels zu vereinbaren</u> ", ist die Zerlegung der Methoden etwas kompliziert, aber sie sind für die folgenden Beispiele nützlich.</i> <br></div></div><br>  Danach beginnt in einem neuen Zweig auf yii2 die Erkennung von Benutzern, die zuvor in yii1 autorisiert wurden, zu funktionieren.  Im Idealfall müsste hier angehalten werden, da der rutschige Weg weiter beginnt. <br><br><h2>  Benutzeranmeldung in yii2 </h2><br>  Nachdem das Speicherformat für die Benutzer-ID in der Sitzung vereinbart wurde, ist es möglich, dass die Benutzeranmeldung sogar „automatisch“ über yii2 funktioniert. <br><br>  <i>Ich halte es für falsch, das Anmeldeformular auf yii2 im Kampfmodus zu verwenden, ohne das entsprechende Formular auf yii1 zu deaktivieren. Die Grundfunktionalität funktioniert jedoch nach ein wenig Koordination.</i> <br><br>  Weil  Wir glauben, dass während die Benutzerregistrierung und das entsprechende Passwort-Hashing in yii1 verbleiben, wir für eine funktionierende Anmeldung über yii2 sicherstellen müssen, dass die Validierungsmethode des in yii2 gespeicherten Passworts verstehen kann, was in Yii1 gehasht und gespeichert wurde. <br><br>  Überprüfen Sie, was diese Methoden tun. <br><br>  Wenn in Yii2 beispielsweise das Benutzermodell mit bedingtem Standardmodell das Kennwort wie folgt überprüft: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \Yii::$app-&gt;getSecurity()-&gt;validatePassword($password, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password); }</code> </pre><br>  Schauen Sie sich dann die <u>validatePassword-</u> <u>Methode</u> <u>($ password, $ hash)</u> unter <u>yii \ base \ Security</u> (Yii2) an. <br><br><div class="spoiler">  <b class="spoiler_title">validatePassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $hash)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($password) || $password === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Password must be a string and cannot be empty.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^\$2[axy]\$(\d\d)\$[\.\/0-9A-Za-z]{22}/'</span></span>, $hash, $matches) || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Hash is invalid.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'password_verify'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> password_verify($password, $hash); } $test = crypt($password, $hash); $n = strlen($test); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($n !== <span class="hljs-number"><span class="hljs-number">60</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($test, $hash); }</code> </pre></div></div><br>  Und wenn auf Yii1 das Passwort-Hashing im Benutzermodell wie folgt durchgeführt wird: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CPasswordHelper::hashPassword($password); }</code> </pre><br>  Vergleichen Sie dann mit <u>verifyPassword ($ password, $ hash)</u> aus <u>yii \ framework \ utils \ CPasswordHelper</u> <br><br><div class="spoiler">  <b class="spoiler_title">hashPassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password,$cost=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::checkBlowfish(); $salt=<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::generateSalt($cost); $hash=crypt($password,$salt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_string($hash) || (function_exists(<span class="hljs-string"><span class="hljs-string">'mb_strlen'</span></span>) ? mb_strlen($hash, <span class="hljs-string"><span class="hljs-string">'8bit'</span></span>) : strlen($hash))&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CException(Yii::t(<span class="hljs-string"><span class="hljs-string">'yii'</span></span>,<span class="hljs-string"><span class="hljs-string">'Internal error while generating hash.'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $hash; }</code> </pre><br></div></div><br>  Wenn sich die Hashing- und Validierungsmethoden unterscheiden, müssen Sie die Validierung in <u>validatePassword ()</u> von <u>app \ model \ User</u> aus ändern. <br><br>  Aus den Feldern der neuesten Versionen des Frameworks sind Yii1 / Yii2-Kennwort-Hashes kompatibel.  Dies bedeutet jedoch keineswegs, dass sie mit Ihnen kompatibel sind oder in Zukunft zusammenfallen werden.  Mit hoher Wahrscheinlichkeit unterscheiden sich die Hashing-Methoden des Projekts in Yii1 und die Validierung im neuen Projekt in Yii2. <br><br><h2>  Autologin in Yii2 auf Cookies von yii1 </h2><br><blockquote>  Da ein Zweig auf Yii2 bereits weiß, wie Benutzerauthentifizierungsdaten von Yii1 transparent verwendet werden, können Sie die automatische Anmeldung per Cookie einrichten. <br></blockquote>  Wenn Ihnen ein solcher Gedanke einfällt, rate ich Ihnen, ihn aufzugeben.  Ich sehe keinen guten Grund, die automatische Anmeldung auf Yii2 zu aktivieren, ohne die Benutzerarbeit (zunächst die Authentifizierung) auf diesen Thread zu übertragen.  Das heißt,  Ich meine den folgenden Fall: <br><br>  <i>Die Benutzerauthentifizierung wird für Yii1 durchgeführt, aber der Yii2-Zweig sollte in der Lage sein, die in Yii1 gespeicherten Cookies automatisch zu registrieren.</i> <i><br></i> <br>  Um ehrlich zu sein, ist dies eine offene Perversion.  Es wird nicht einfach und elegant sein, und genau hier geht die Grenze zwischen der bewussten und gerechtfertigten Aufgabe der Migration und der Erfindung unnötiger Fahrräder. <br><br>  Die Schwierigkeit besteht darin, dass Yii in beiden Zweigen vor gefälschten Cookies geschützt ist, so dass es schwierig ist, Methoden zu vereinbaren. <br><br><ul><li>  Die an Yii2 beteiligten Komponenten sind: Benutzer ( <u>\ yii \ web \ Benutzer</u> ), <u>Anforderung</u> , <u>Sicherheit</u> + <u>CookieCollection</u> </li><li>  In Yii1: <u>CWebUser</u> , <u>CHttpRequest</u> , <u>CSecurityManager</u> , <u>CStatePersister</u> , <u>CCookieCollection</u> </li></ul><br>  Die Fälle sind jedoch unterschiedlich.  Unten finden Sie ein Beispiel für die Erstellung eines Autologins mit Fahrrädern. <br><br>  In yii2 interessieren wir uns für die Methode <u>getIdentityAndDurationFromCookie ()</u> aus <u>\ yii \ web \ User</u> .  In der ersten Zeile dieser Methode sollte der gewünschte Cookie erhalten werden: <br><br><pre> <code class="php hljs">$value = Yii::$app-&gt;getRequest()-&gt;getCookies()-&gt;getValue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]);</code> </pre> <br>  Aber sie wird es nicht sein, weil  Die Sammlung <u>Yii :: $ app-&gt; getRequest () -&gt; getCookies ()</u> ist leer, da in <u>Request</u> Cookies mit der Validierung in <u>loadCookies ()</u> geladen werden und natürlich nicht bestanden werden. <br><br>  Der einfachste Weg zum <u>Verzweigen</u> ist das Standardverhalten durch Überschreiben von <u>getIdentityAndDurationFromCookie ()</u> .  Zum Beispiel so: <br><br><ol><li>  Laden Sie das gewünschte Cookie direkt vom superglobalen $ _COOKIE herunter <s>,</s> um den Standardmechanismus zum Laden von Cookies nicht zu beschädigen. <br><br>  Der Name des Identifikationscookies ist nur _keyPrefix, das wir bereits empfangen (oder kopieren) können.  Daher ändern wir den Standard <u>$ identityCookie</u> in <u>init ()</u> . <br></li><li>  Entschlüsseln Sie das resultierende Cookie "ungefähr wie in yii1".  Wie du willst.  Zum Beispiel habe ich die erforderlichen Methoden aus <u>CSecurityManager</u> kopiert. </li></ol><br>  Unten ist in der Tat der Code. <br><br><div class="spoiler">  <b class="spoiler_title">Wir arbeiten in App / Models / WebUser</b> <div class="spoiler_text">  1. Der gemäß yii1 gesetzte Name identityCookie-Cookies <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;idParam = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdParamYii1(); <span class="hljs-comment"><span class="hljs-comment">//     $this-&gt;identityCookie = ['name' =&gt; $this-&gt;getStateKeyPrefix()]; }</span></span></code> </pre><br><br>  2. Fügen Sie zwei weitere Methoden hinzu <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdentityAndDurationFromCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdIdentityFromCookiesYii1(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityClass; $identity = $class::findOne($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($identity !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; $identity, <span class="hljs-string"><span class="hljs-string">'duration'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *  ID identity  cookies,   yii1 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> null|integer  ID     null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdIdentityFromCookiesYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $cookieValue = $_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]]; <span class="hljs-comment"><span class="hljs-comment">// Cookies  yii1 ,  $utilSecurity = new UtilYii1Security($this-&gt;getBasePathYii1()); $data = $utilSecurity-&gt;validateData($cookieValue); if ($data === false) { return null; } $data = @unserialize($data); if (is_array($data) &amp;&amp; isset($data[0], $data[1], $data[2], $data[3])) { list($id, $name, $duration, $states) = $data; return $id; } return null; }</span></span></code> </pre><br></div></div><br>  Der Code verwendet eine bestimmte <u>UtilYii1Security-</u> Klasse - dies ist ein modifiziertes Kopieren und Einfügen der erforderlichen Methoden aus <u>CSecurityManager</u> , sodass es einerseits wie das Original aussieht, jedoch mit Vereinfachungen.  In <u>CSecurityManager gibt es beispielsweise</u> verschiedene Optionen zum Generieren von HMAC (Hash-basierter Nachrichtenauthentifizierungscode), die von der PHP-Version und dem Vorhandensein von mbstring abhängen.  Aber seitdem  Es ist bekannt, dass yii1 in derselben Umgebung wie yii2 arbeitet, dann wird die Aufgabe vereinfacht und dementsprechend auch der Code. <br><br>  Weil  Es ist ziemlich klar, dass hier eine explizite Krücke geschrieben ist. Dann müssen Sie nicht versuchen, sie universell zu machen und ihr eine anmutige Form zu geben. Es reicht aus, sie unter Ihren Bedingungen „einzusperren“. <br><br><div class="spoiler">  <b class="spoiler_title">UtilYii1Security.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   CSecurityManager  Yii1, *     * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">InvalidConfigException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UtilYii1Security</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * ,   yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATE_VALIDATION_KEY = <span class="hljs-string"><span class="hljs-string">'Yii.CSecurityManager.validationkey'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *  ,    yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $hashAlgorithm = <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   cookies */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_validationKey; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $basePath; <span class="hljs-comment"><span class="hljs-comment">/** *      yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stateFile; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $basePath -    Yii1 *        stateFile */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath = $basePath; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'runtime'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'state.bin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!realpath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'    '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($data)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $len = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data) &gt;= $len) { $hmac = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $len); $data2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, $len, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($hmac, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC($data2, $key)) ? $data2 : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeHMAC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($key === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) $key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValidationKey(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash_hmac(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hashAlgorithm, $data, $key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValidationKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadStateValidationKey(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATE_VALIDATION_KEY)) !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey = $key; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; } <span class="hljs-comment"><span class="hljs-comment">//  validationKey    Yii1 private function loadStateValidationKey($key) { $content = $this-&gt;loadState(); if ($content) { $content = unserialize($content); if (isset($content[$key])) return $content[$key]; } return false; } //      Yii1 protected function loadState() { $filename = $this-&gt;stateFile; $file = fopen($filename, "r"); if ($file &amp;&amp; flock($file, LOCK_SH)) { $contents = @file_get_contents($filename); flock($file, LOCK_UN); fclose($file); return $contents; } return false; } public function compareString($expected, $actual) { $expected .= "\0"; $actual .= "\0"; $expectedLength = $this-&gt;strlen($expected); $actualLength = $this-&gt;strlen($actual); $diff = $expectedLength - $actualLength; for ($i = 0; $i &lt; $actualLength; $i++) $diff |= (ord($actual[$i]) ^ ord($expected[$i % $expectedLength])); return $diff === 0; } private function strlen($string) { return mb_strlen($string, '8bit'); } private function substr($string, $start, $length) { return mb_substr($string, $start, $length, '8bit'); } }</span></span></code> </pre><br></div></div><br><h2>  Reihenfolge der Aktionen </h2><br>  Bei der Migration von yii1 nach yii2 hinsichtlich der Authentifizierung habe ich die folgende Reihenfolge befolgt: <br><br><ol><li>  Machen Sie eine transparente Benutzerauthentifizierung zwischen Zweigen. <br>  Das heißt,  Damit akzeptiert der Zweig yii2 Benutzer, die mit yii1 authentifiziert sind.  Es ist schnell, nicht schwierig. <br></li><li>  Übertragen Sie die Authentifizierung (Benutzeranmeldung) von yii1 nach yii2. <br>  Gleichzeitig im alten Zweig deaktivieren.  Beachten Sie, dass danach die Autologin für Cookies nicht mehr funktioniert, weil  Cookies von yii1 sind nicht mehr geeignet und es gibt noch wenige neue Seiten auf yii2. </li><li>  Portieren Sie mindestens die Hauptseite der Site auf yii2 <br>  Damit Sie das Autologin für die neuen Cookies verwenden können, die in yii2 gespeichert sind. <br>  Das Vorhandensein eines Autologins, zumindest des Hauptautologins, hilft dabei, das fehlende Autologin im vorherigen Zweig zu maskieren. <br></li><li>  Überprüfen Sie, ob yii1 die Authentifizierung in yii2 versteht. <br>  Durch Aushandlung von Sitzungsschlüsseln. <br></li><li>  Übertragen Sie die Benutzerregistrierung auf yii2. <br>  Die Übertragung muss unter Koordination der zuvor gespeicherten Passwort-Hashes erfolgen.  Behalten Sie möglicherweise das alte Hash-Format bei oder führen Sie ein neues ein, damit der Login beide Typen versteht. </li><li>  Erwägen Sie, der Site einen Dienst hinzuzufügen, der yii2 "out of the box" bietet. <br>  Ich meine die Implementierung der <u>IdentityInterface-</u> Oberfläche des Benutzers, die die Authentifizierung durch Token, die Wiederherstellung von Passwörtern usw. ermöglicht.  Vielleicht haben Sie schon das passende Geschirr, aber plötzlich nicht mehr?  Dann ist dies eine großartige Option, um den Service mit minimalem Aufwand zu verbessern. <br><br>  Wenn ja, führt dies (zumindest teilweise) zur Implementierung (Migration) des persönlichen Kontos in yii2. <br>  Wenn "Nein", sollten Sie immer noch über die Migration Ihres persönlichen Kontos nachdenken (auch ohne neue Produkte). <br></li></ol><br><h4>  PS: </h4><br>  Es werden nicht immer eindeutige Lösungen für eine bestimmte Aufgabe beschrieben, und nicht alle müssen angewendet werden. <br><br>  Sie werden nicht beschrieben, um zu sagen: "Tu, was ich tue."  Zum Beispiel ist es möglich, yii2-Autologin für Cookies von yii1 zu erstellen, aber gelinde gesagt nicht gut (und eine solche Krücke sollte in irgendeiner Weise gerechtfertigt sein). <br><br>  Aber ich habe bereits Zeit mit dieser schrittweisen Migration von Projekten verbracht und werde mich freuen, wenn jemand, der meine Erfahrungen betrachtet, ihn rettet. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de419999/">https://habr.com/ru/post/de419999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de419989/index.html">Neuseeland verbietet Plastiktüten</a></li>
<li><a href="../de419991/index.html">Autonome Drohnen werden Vogelschwärme von Flughäfen treiben</a></li>
<li><a href="../de419993/index.html">TypeScript-Interview: 20 Fragen und Antworten</a></li>
<li><a href="../de419995/index.html">Eine Studie von Ivy, dem neuen Angular-Compiler</a></li>
<li><a href="../de419997/index.html">Analysieren des Musters "Modul" in JavaScript</a></li>
<li><a href="../de420001/index.html">Einführung in 3CX v15.5 Update 6 BETA und WebRTC Browser Softphone</a></li>
<li><a href="../de420003/index.html">Fenster mit Schaltflächen in JavaFX:</a></li>
<li><a href="../de420005/index.html">Die unprofessionelle Videoüberwachung der Wohnung ist unterhaltsam und kostengünstig</a></li>
<li><a href="../de420007/index.html">FidgetPen, seltsame Lampen- und Splitterwürfel: Allocacoc kennenlernen</a></li>
<li><a href="../de420009/index.html">Die Feinheiten des Produktdesigns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>