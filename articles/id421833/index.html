<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ŸğŸ¾ ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ğŸ—¡ï¸ Kami menulis program kami yang paling sederhana untuk ARM Cortex-M3 ğŸ—¯ï¸ ğŸ’Ÿ ğŸ”µ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang Hari ini saya ingin memberi tahu Anda cara menulis program minimal yang berjalan pada ARM Cortex-M3 dan mencetak "Halo, Dunia!". Kami ak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami menulis program kami yang paling sederhana untuk ARM Cortex-M3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/421833/"><img src="https://habrastorage.org/files/c92/874/069/c92874069b4e49d4ae65eb48e6d6af19.png" alt="gambar" align="right">  Selamat siang  Hari ini saya ingin memberi tahu Anda cara menulis program minimal yang berjalan pada ARM Cortex-M3 dan mencetak "Halo, Dunia!".  Kami akan mencoba membuat langkah-langkah minimum yang diperlukan yang kami butuhkan untuk ini.  Kami akan berjalan pada emulator QEMU.  Karena itu, siapa pun dapat bereproduksi, walaupun ia tidak memiliki sepotong besi. <br><br>  Jadi ayo pergi! <br><a name="habracut"></a><br>  Emulator QEMU mendukung inti Cortex-M3 dan mengemulasi platform Stellaris LM3S811 dari Texas Instruments berdasarkan itu.  Kami akan berjalan di platform ini.  Kami membutuhkan arm-none-eabi- toolchain (Anda dapat mengunduhnya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ).  Selanjutnya, kita perlu menulis logika utama program kita, kode awal, yang akan mentransfer kontrol ke program, dan skrip linker. <br><br>  Pada habr sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel yang</a> cukup <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagus</a> tentang cara mengedipkan dioda pada sepotong besi dari awal.  Oleh karena itu, di sini saya tidak akan menyelidiki apa dan bagaimana cara kerjanya, tetapi saya hanya akan memberikan set minimum pengetahuan yang diperlukan untuk memulai. <br><br>  Halo world kami di file test.c: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UART_DR = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *)<span class="hljs-number"><span class="hljs-number">0x4000c000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uart_print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*s != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) { *UART_DR = *s; s++; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ uart_print(<span class="hljs-string"><span class="hljs-string">"Hello, World!\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) ; }</code> </pre> <br>  Alamat 0x4000c000 ini diambil dari dokumentasi, di situlah DR register nol nol.  <b>Kami tidak akan terlibat dalam pengaturan UART</b> (ini perlu dilakukan pada perangkat keras), tetapi kami akan mencoba untuk segera menempatkan simbol di dalamnya secara langsung. <br><br>  Sekarang, kita perlu mentransfer kontrol ke fungsi kita with_entry di file test.c.  Untuk melakukan ini, buat kode berikut (file startup.S), dan kemudian taruh di gambar ELF akhir di awal. <br><br><pre> <code class="cpp hljs">.type start, %function .word stack_top <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> .word start <span class="hljs-comment"><span class="hljs-comment">/*    PC */</span></span> .global start start: ldr r1, =c_entry bx r1</code> </pre><br>  Kata pertama pada 0x0 harus menjadi penunjuk ke atas tumpukan (SP).  Pada 0x4 ada PC, yang, seperti SP, dimuat ke register.  Perhatikan bahwa mulai dinyatakan tepat sebagai fungsi, dan bukan sebagai label karena kode Cortex-M dieksekusi dalam mode Thumb (ini adalah seperangkat perintah ARM yang disederhanakan), dan diperlukan bahwa alamat fungsi dalam vektor interupsi berada dalam bentuk (alamat | 0x1) - yaitu  bit terakhir dari alamat tersebut harus 1. <br><br>  Selanjutnya, fungsi mulai hanya memuat alamat fungsi c_entry () kami dari file test.c dan melewati kontrol melalui "bx r1" di sana. <br><br>  Tinggal menyambungkan program kami dengan sukses.  Untuk melakukan ini, Anda perlu mengatur kartu memori mikrokontroler kami.  Dalam dokumentasi Anda dapat menemukan alamat dan ukuran memori flash (ROM) dan RAM (RAM).  Berikut ini skrip linker test.ld: <br><br><pre> <code class="cpp hljs">SECTIONS { . = <span class="hljs-number"><span class="hljs-number">0x0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   (ROM) */</span></span> .text : { startup.o(.text) test.o(.text) } . = <span class="hljs-number"><span class="hljs-number">0x20000000</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     RAM */</span></span> .data : { *(.data) } .bss : { *(.bss) } . = ALIGN(<span class="hljs-number"><span class="hljs-number">8</span></span>); . = . + <span class="hljs-number"><span class="hljs-number">0x1000</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    4 */</span></span> stack_top = .; }</code> </pre><br>  Penting untuk memperhatikan alamat.  "."  di skrip tautan menunjukkan posisi saat ini.  Kami menempatkan bagian .text di awal ROM (alamat 0x0), mengikuti urutan - startup.o (.text) yang lebih dulu.  Selanjutnya, buka RAM (. = 0x20000000;) dan letakkan data di sana (data global yang diinisialisasi) dan bss (data global yang tidak diinisialisasi).  Di bawah ini kita melihat ALIGN (8) - ARM membutuhkan penyelarasan SP (Stack Pointer) oleh 8. Karena tumpukan turun, alokasi ruang di bawah tumpukan hanyalah tambahan. "  =.  + 0x1000 â€.  Kami tahu program kami dengan baik, jadi tumpukan 4kB sudah cukup dengan margin besar. <br><br>  Itu saja, masih harus disatukan.  Saya membawa build.sh: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh arm-none-eabi-as -c -mthumb -mlittle-endian -march=armv7-m -mcpu=cortex-m3 startup.S -o startup.o arm-none-eabi-gcc -c -mthumb -ffreestanding -mlittle-endian -march=armv7-m -mcpu=cortex-m3 test.c -o test.o arm-none-eabi-ld -T test.ld test.o startup.o -o test.elf</span></span></code> </pre><br>  Segala sesuatu di sini harus lebih atau kurang dipahami, dengan pengecualian dari bendera-berdiri.  Dalam hal ini, Anda tidak perlu menambahkannya (Anda dapat memeriksanya), tetapi karena kami sedang menyiapkan gambar baremetal dari awal, lebih baik memberi tahu kompiler sehingga tidak memperhatikan fungsi seperti main (). <br><br>  Akibatnya, kami mendapat file ELF test.elf.  Jalankan di QEMU: <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> qemu<span class="hljs-literal"><span class="hljs-literal">-system</span></span><span class="hljs-literal"><span class="hljs-literal">-arm</span></span> <span class="hljs-literal"><span class="hljs-literal">-M</span></span> lm3s811evb <span class="hljs-literal"><span class="hljs-literal">-kernel</span></span> test.elf <span class="hljs-literal"><span class="hljs-literal">-nographic</span></span> Hello, World!</code> </pre><br>  Itu bekerja. <br><br>  Tentu saja, ini adalah studi kasus yang dirancang untuk memahami apa yang terjadi.  Jika Anda membutuhkan fungsionalitas yang lebih bermakna, Anda harus menggunakan hal-hal yang sudah jadi.  Kami telah menambahkan dukungan untuk platform ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Embox</a> .  Template ini disebut platform / stellaris / lm3s811evb.  Karena itu, jika seseorang ingin mencoba menjalankan hal yang sedikit lebih serius (konsol, timer, interupsi), maka Anda dapat mengumpulkan dan mencoba.  Dalam hal ini, saya ulangi, Anda tidak perlu memiliki papan perangkat keras. <br><br>  Dan mereka yang masih belum memiliki cukup emulator, atau yang ingin mengajukan pertanyaan kepada kami dan bermain dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">potongan</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">potongan besi,</a> kami akan menunggu hari Sabtu dan Minggu ini di festival IT <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">techtrain.ru</a> di St. Petersburg.  Kami akan memiliki berbagai potongan besi di dudukan, dan di zona demo kami akan mencoba memberi tahu cara memprogramnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id421833/">https://habr.com/ru/post/id421833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id421819/index.html">Stack ELK untuk menyimpan log aplikasi Django</a></li>
<li><a href="../id421821/index.html">Kami menggunakan mosaik, pikselasi, dan topeng geometri Voronoi di shader untuk menghias situs</a></li>
<li><a href="../id421823/index.html">Bagaimana kami membawa X-Ray x64</a></li>
<li><a href="../id421827/index.html">Apa yang harus dibaca tentang Java sekarang?</a></li>
<li><a href="../id421829/index.html">Anomali Frango - romansa fantastis dengan orang-orang nyata dari IT</a></li>
<li><a href="../id421835/index.html">Komisi Antarlembaga mengembangkan teknologi baru untuk memblokir Telegram</a></li>
<li><a href="../id421837/index.html">Membuat kekacauan 1k intro untuk ZX-Spectrum</a></li>
<li><a href="../id421839/index.html">Pemrograman Java Fungsional dengan Vavr</a></li>
<li><a href="../id421841/index.html">Robotaxi Waymo tidak cukup siap untuk mengakses jalan umum</a></li>
<li><a href="../id421845/index.html">Apa yang sebenarnya dilakukan analis data? Temuan dari 35 Wawancara</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>