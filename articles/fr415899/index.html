<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤦🏽 👩🏻 👌🏾 Office 365 Outlook a trouvé des API non documentées avec des journaux d'activité utilisateur détaillés 🏂🏾 👨🏾‍🍳 🍶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Journaux détaillés d'Office 365 Outlook extraits par Magic-Unicorn-Tool : un attaquant recherche une facture de paiement. La première lettre de la req...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Office 365 Outlook a trouvé des API non documentées avec des journaux d'activité utilisateur détaillés</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/415899/"><img src="https://habrastorage.org/webt/ss/4n/1h/ss4n1hztnfofodcmqntzih5xmee.png"><br><br>  <i><font color="gray">Journaux détaillés d'Office 365 Outlook extraits par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Magic-Unicorn-Tool</a> : un attaquant recherche une facture de paiement.</font></i>  <i><font color="gray">La première lettre de la requête de recherche a été entrée à 10: 42: 44.548, la dernière à 10: 43: 07.214.</font></i>  <i><font color="gray">Les informations sur l'activité sont stockées dans les journaux pendant six mois.</font></i> <br><br>  Pendant longtemps, il y avait des rumeurs selon lesquelles Office 365 dispose d'un outil secret intégré pour enregistrer l'activité des utilisateurs.  En juin 2018, ces rumeurs ont été pleinement confirmées.  Tout a commencé avec une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vidéo</a> publiée par <i>Anonymous</i> , puis les spécialistes de CrowdSrtike ont téléchargé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport détaillé</a> . <br><br>  Microsoft a implémenté l'API Activities dans le client de messagerie non à des fins malveillantes, mais pour les tâches de la criminalistique numérique, c'est-à-dire enquêter sur les incidents impliquant le piratage des e-mails d'entreprise et d'autres fuites de données.  Pour ce faire, un journal d'activité détaillé est conservé pendant six mois, <i>même si l'utilisateur a désactivé la journalisation</i> . <br><a name="habracut"></a><br><h1>  Compte de messagerie piratage épidémie </h1><br>  Le piratage de comptes de messagerie d'entreprise dans le monde est devenu si répandu que certains experts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">appellent cela une épidémie</a> .  Les attaquants ont accès à des feuilles de calcul avec des numéros de sécurité sociale, des informations détaillées sur les factures financières et les secrets commerciaux.  Ils recherchent des informations sur les virements bancaires et volent de l'argent, profitant de l'absence de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">signature numérique sur les documents</a> .  Les différents types de fraude par compromission du courrier professionnel sont décrits dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">brochure CrowdStrike</a> . <br><br>  Par exemple, au début de juin, le FBI a mené une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">opération internationale</a> et détenu 74 personnes dans plusieurs pays impliqués dans cette activité. <br><br>  Lorsque le fait de pirater est connu, il est important de comprendre: à quelles données le pirate a-t-il eu accès, ce qu'il a vu et quelles informations il a copiées.  Des données confidentielles ont-elles fui?  L'enquête sur les incidents est rendue plus difficile car la journalisation dans Office 365 est désactivée par défaut.  En l'absence de toute information réelle, la société est tenue par la loi d'annoncer publiquement une fuite de données avec toutes les conséquences qui en découlent - frais de réputation, amendes, etc. <br><br>  Mais maintenant, on sait qu'il existe une API d'activités avec une journalisation détaillée dans Office 365, et bon nombre de ces scandales pourraient être évités si les entreprises connaissaient cette API.  Peut-être, l'accès à ces journaux secrets n'a été reçu que par certains clients privilégiés.  Il y a des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">informations</a> que certaines entreprises spécialisées dans la criminalistique numérique connaissaient l'outil d'audit secret d'Office 365 l'année dernière, ou même plus tôt.  Quelqu'un a considéré que leurs déclarations étaient de la bravade marketing, mais cela s'est avéré vrai.  Étonnamment, l'API Activities existait et Microsoft a vraiment caché l'existence d'un outil aussi important et utile, appelé Magic Unicorn professionnel, d'où le nom du programme d'auto-analyse des journaux, qui est mentionné ci-dessous. <br><br> <a href=""><img src="https://habrastorage.org/webt/ji/-f/e0/ji-fe0abu-a7c-v-x6xnh6cbogc.png"></a> <br><br>  <i><font color="gray">Un attaquant scanne les messages contenant une facture de paiement et le formulaire W-9.</font></i>  <i><font color="gray">Journaux détaillés extraits par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Magic-Unicorn-Tool</a></font></i> <br><br><h1>  Enquête CrowdStrike </h1><br>  CrowdStrike a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">décrit en détail le</a> fonctionnement par défaut de la journalisation Office 365 pour tous les utilisateurs.  La fonctionnalité se compose d'une API Web qui récupère les informations d'activité d'Office 365 Outlook via les services Web Exchange (EWS).  L'accès à l'API est ouvert à toute personne connaissant le point de terminaison et l'en-tête HTTP spécifique. <br><br>  L'API Activités non documentées est un sous-ensemble des trois versions de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API REST Outlook</a> (1.0, 2.0 et bêta).  Comme pour les autres sous-ensembles, l'appel d'API doit être authentifié à l'aide d'OAuth 2.0 ou d'une authentification de base. <br><br>  Le point final est le suivant: <br><br><pre><code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/</span></span>{user_context}/Activities</code> </pre> <br>  Toutes les demandes sont envoyées sous forme de paquets HTTP GET, qui doivent inclure l'en-tête HTTP suivant: <br><br><pre> <code class="hljs objectivec">Prefer: exchange.behavior=<span class="hljs-string"><span class="hljs-string">"ActivityAccess"</span></span></code> </pre> <br>  Les requêtes sans cet en-tête renverront une <code>HTTP 400 Bad Request</code> . <br><br>  L'en-tête d' <code>Authorization</code> est également <code>Authorization</code> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Authorization</span></span>: Bearer &lt;<span class="hljs-keyword"><span class="hljs-keyword">access</span></span> token&gt;</code> </pre> <br>  Les demandes sans cet en-tête <code>HTTP 403 Unauthorized</code> réponse <code>HTTP 403 Unauthorized</code> . <br><br>  À des fins de test, un jeton d'accès OAuth 2.0 peut être généré dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sandbox Oauth</a> .  Il est valable 60 minutes. <br><br>  L'appel le plus simple à l'API est de demander les dix dernières de ses activités. <br><br><pre> <code class="hljs ruby">GET <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/me</span></span><span class="hljs-regexp"><span class="hljs-regexp">/Activities</span></span></code> </pre> <br>  Un exemple de réponse de l'API au format JSON montre les propriétés d'activité standard: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"Id"</span></span>:<span class="hljs-string"><span class="hljs-string">"WOGVSAiPKrfJ4apAPcBksT2en7whzDz4NIbUs3=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityCreationTime"</span></span>:<span class="hljs-string"><span class="hljs-string">"2010-04-01T12:34:56.789Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityIdType"</span></span>:<span class="hljs-string"><span class="hljs-string">"ReadingPaneDisplayStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AppIdType"</span></span>:<span class="hljs-string"><span class="hljs-string">"Outlook"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ClientVersion"</span></span>:<span class="hljs-string"><span class="hljs-string">"15.00.0000.000"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ClientSessionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"679126f3-02de-3513-e336-0eac1294b120"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"NjKG5m6OmaCjGKq6WlbjIzvp94czUDg30qGopD=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TimeStamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"2010-04-01T12:34:56.789Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TenantId"</span></span>:<span class="hljs-string"><span class="hljs-string">"679126f3-02de-3513-e336-0eac1294b120"</span></span>, } ] }</code> </pre> <br>  Grâce à l'API, vous pouvez demander une activité non seulement pour vous-même, mais aussi pour d'autres utilisateurs, si l'autorisation est obtenue via Shared Mailbox ou Application Permission: <br><br><pre> <code class="hljs ruby">GET <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/</span></span>Users(<span class="hljs-string"><span class="hljs-string">'victim@contoso.com'</span></span>)/Activities</code> </pre> <br>  L'API Activités prend en charge plusieurs paramètres de requête: <br><br><ul><li>  <code>$orderby</code> : trie les résultats par expression donnée </li><li>  <code>$filter</code> : filtre les résultats par date et / ou type d'activité </li><li>  <code>$select</code> : sélectionnez les propriétés de retour </li><li>  <code>$top</code> : nombre maximum d'activités retournées </li><li>  <code>$skip</code> : nombre d'activités sautées dans les résultats </li></ul><br>  À l'heure actuelle, CrowdStrike a identifié 30 types d'activités, mais en réalité, il peut y en avoir plus.  Voici les plus utiles: <br><br><ul><li>  <code>Delete</code> : supprimer une lettre </li><li>  <code>Forward</code> : transfert de courrier électronique </li><li>  <code>LinkClicked</code> : cliquer sur un lien dans un e-mail </li><li>  <code>MarkAsRead</code> : message marqué comme lu </li><li>  <code>MarkAsUnread</code> : message marqué comme non lu </li><li>  <code>MessageDelivered</code> : lettre remise à la boîte aux lettres </li><li>  <code>MessageSent</code> : e-mail envoyé depuis la boîte aux lettres </li><li>  <code>Move</code> : la lettre est transférée </li><li>  <code>OpenedAnAttachment</code> : application ouverte </li><li>  <code>ReadingPaneDisplayEnd</code> : <code>ReadingPaneDisplayEnd</code> lettre dans le volet d'affichage </li><li>  <code>ReadingPaneDisplayStart</code> : sélectionnez une surbrillance à écrire dans le volet d'affichage. </li><li>  <code>Reply</code> : réponse à la lettre </li><li>  <code>SearchResult</code> : génération de résultats de recherche </li><li>  <code>ServerLogon</code> : événement d'autorisation </li></ul><br>  Il existe d'autres types intéressants d'activités utiles pour enquêter sur les incidents: <code>SenderSmtpAddress</code> , <code>Recipients</code> , <code>Subject</code> , <code>SentTime</code> , <code>InternetMessageId</code> , <code>ClientIP</code> , <code>UserAgent</code> , etc. <br><br>  Les spécialistes de CrowdStrike ont publié <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un module Python</a> qui extrait des informations de l'API Office 365 Outlook Activities et écrit les données reçues dans un fichier CSV. <br><br><h1>  Magic-Unicorn-Tool </h1><br>  Le programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Magic-Unicorn-Tool</a> analyse les journaux d'API d'activités obtenus par le module Python susmentionné.  Pour le moment, il est capable d'analyser et d'afficher les informations suivantes: <br><br><ul><li>  Recherchez les requêtes dans la boîte aux lettres, l'heure de visualisation des messages et / ou des sessions autorisées </li><li>  Événements d'autorisation (ouverture de session et ouverture de session serveur), date, heure, adresse IP et type de navigateur. </li><li>  Toutes les activités de courrier sont livrées et marquées comme des lettres lues. </li><li>  Recherchez les événements enregistrés à partir de l'ID de session en référence au dernier événement d'autorisation. </li><li>  Lecture du panneau. </li><li>  Afficher les pièces jointes. </li></ul><br><img src="https://habrastorage.org/webt/fj/xw/n9/fjxwn9xwhiceprwy0hk8whevtu4.png"><br>  <i><font color="gray">Connectez-vous à votre compte depuis différentes adresses IP</font></i> <br><br>  Magic-Unicorn-Tool est distribué sans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">signature de code</a> , mais avec l'open source. <br><br>  La mise en œuvre d'outils comme l'API Activities à l'insu des utilisateurs soulève un certain nombre de problèmes pratiques et éthiques pour l'ensemble de l'industrie de la criminalistique numérique.  Par défaut, la journalisation est désactivée sur les comptes Office 365. Elle ne fait pas partie des plans ProPlus et E1 standard.  Les entreprises doivent payer plus d'argent pour l'audit des comptes, et en raison du manque de journaux (comme elles le pensaient), de nombreuses entreprises ont subi des pertes.  Dans le même temps, la granularité du journal de l'API d'activité dépasse de loin la granularité des méthodes de consignation documentées telles que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le journal d'audit unifié</a> . <br><br>  Les experts en criminalistique numérique de LMG Security <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demandent l'</a> adoption de normes pour la journalisation des activités et la placent comme une charge obligatoire pour les fournisseurs de cloud, car le système d'alarme incendie dans les centres de données est désormais une charge obligatoire. <br><br>  L'adoption de normes est nécessaire pour que les fournisseurs non seulement tiennent des journaux, mais les fournissent également sous une forme standard pour les clients et les sociétés d'audit, et ne gardent pas le secret pour les clients sélectionnés dans le cadre d'un plan tarifaire plus coûteux ou en tant que service payant distinct. <br><br><hr><br>  <b>GMO GlobalSign Russia ACTION pour les abonnés Habr</b> <b><br><img src="https://habrastorage.org/webt/u3/my/b4/u3myb4ifqihiox-vpuqxbx4kij0.jpeg"></b> <br><br>  Vous pouvez obtenir des informations supplémentaires en contactant le responsable GlobalSign par téléphone: +7 (499) 678 2210, ou remplissez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formulaire sur le site Internet en</a> indiquant le code promo CS002HBFR. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415899/">https://habr.com/ru/post/fr415899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415887/index.html">Quel genre de robots araignées survolent les stades et tirent sur le football. Entretien avec le créateur de Robycam</a></li>
<li><a href="../fr415891/index.html">Quels sont les jeux de suite sympas?</a></li>
<li><a href="../fr415893/index.html">Comment rendre les processus Java exécutés sur Linux / Docker simples et directs</a></li>
<li><a href="../fr415895/index.html">Le modèle le plus important dans la programmation</a></li>
<li><a href="../fr415897/index.html">Fonctions de documentation des bases de données PostgreSQL. Deuxième partie</a></li>
<li><a href="../fr415901/index.html">La Commission du Conseil de la Fédération a soutenu l'idée de créer une base IMEI pour tous les téléphones blancs</a></li>
<li><a href="../fr415903/index.html">Bienvenue au Meetup DIYorDIE d'été le 7 juillet</a></li>
<li><a href="../fr415905/index.html">Comment faire pousser un produit sain (exemple Juno)</a></li>
<li><a href="../fr415907/index.html">Comment licencier des employés sans risquer l'image de l'entreprise</a></li>
<li><a href="../fr415909/index.html">Extension Web multi-navigateur pour les scripts personnalisés Partie 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>